{
    "author": "andrewgodwin",
    "message": "Fixed inconsistency in ListView's pagination (short datasets should also trigger a pagination, but with a single possible page)\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15155 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "32a344dfe297a16087765d2f4fb2e1398dc21ac8",
    "files": [
        {
            "sha": "7b817a5f021ca1a8dd4ce9589afa2ad73f3ff880",
            "filename": "django/views/generic/list.py",
            "status": "modified",
            "additions": 13,
            "deletions": 16,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/32a344dfe297a16087765d2f4fb2e1398dc21ac8/django%2Fviews%2Fgeneric%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/32a344dfe297a16087765d2f4fb2e1398dc21ac8/django%2Fviews%2Fgeneric%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fgeneric%2Flist.py?ref=32a344dfe297a16087765d2f4fb2e1398dc21ac8",
            "patch": "@@ -36,22 +36,19 @@ def paginate_queryset(self, queryset, page_size):\n         Paginate the queryset, if needed.\n         \"\"\"\n         paginator = self.get_paginator(queryset, page_size, allow_empty_first_page=self.get_allow_empty())\n-        if paginator.num_pages > 1:\n-            page = self.kwargs.get('page') or self.request.GET.get('page') or 1\n-            try:\n-                page_number = int(page)\n-            except ValueError:\n-                if page == 'last':\n-                    page_number = paginator.num_pages\n-                else:\n-                    raise Http404(\"Page is not 'last', nor can it be converted to an int.\")\n-            try:\n-                page = paginator.page(page_number)\n-                return (paginator, page, page.object_list, True)\n-            except InvalidPage:\n-                raise Http404(u'Invalid page (%s)' % page_number)\n-        else:\n-            return (None, None, queryset, False)\n+        page = self.kwargs.get('page') or self.request.GET.get('page') or 1\n+        try:\n+            page_number = int(page)\n+        except ValueError:\n+            if page == 'last':\n+                page_number = paginator.num_pages\n+            else:\n+                raise Http404(\"Page is not 'last', nor can it be converted to an int.\")\n+        try:\n+            page = paginator.page(page_number)\n+            return (paginator, page, page.object_list, True)\n+        except InvalidPage:\n+            raise Http404(u'Invalid page (%s)' % page_number)\n \n     def get_paginate_by(self, queryset):\n         \"\"\""
        },
        {
            "sha": "de7302048b1dc7dc953d305c17de49d734eb5af8",
            "filename": "tests/regressiontests/generic_views/list.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/32a344dfe297a16087765d2f4fb2e1398dc21ac8/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "raw_url": "https://github.com/django/django/raw/32a344dfe297a16087765d2f4fb2e1398dc21ac8/tests%2Fregressiontests%2Fgeneric_views%2Flist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fgeneric_views%2Flist.py?ref=32a344dfe297a16087765d2f4fb2e1398dc21ac8",
            "patch": "@@ -38,14 +38,15 @@ def test_paginated_queryset(self):\n         self.assertEqual(list(res.context['authors'])[-1].name, 'Author 29')\n \n     def test_paginated_queryset_shortdata(self):\n+        # Test that short datasets ALSO result in a paginated view.\n         res = self.client.get('/list/authors/paginated/')\n         self.assertEqual(res.status_code, 200)\n         self.assertTemplateUsed(res, 'generic_views/author_list.html')\n         self.assertEqual(list(res.context['object_list']), list(Author.objects.all()))\n         self.assertIs(res.context['authors'], res.context['object_list'])\n-        self.assertIsNone(res.context['paginator'])\n-        self.assertIsNone(res.context['page_obj'])\n-        self.assertFalse(res.context['is_paginated'])\n+        self.assertEqual(res.context['page_obj'].number, 1)\n+        self.assertEqual(res.context['paginator'].num_pages, 1)\n+        self.assertTrue(res.context['is_paginated'])\n \n     def test_paginated_get_page_by_query_string(self):\n         self._make_authors(100)\n@@ -90,7 +91,7 @@ def test_paginated_custom_paginator_class(self):\n         self._make_authors(7)\n         res = self.client.get('/list/authors/paginated/custom_class/')\n         self.assertEqual(res.status_code, 200)\n-        self.assertIsNone(res.context['paginator'])\n+        self.assertEqual(res.context['paginator'].num_pages, 1)\n         # Custom pagination allows for 2 orphans on a page size of 5\n         self.assertEqual(len(res.context['object_list']), 7)\n "
        }
    ],
    "stats": {
        "total": 38,
        "additions": 18,
        "deletions": 20
    }
}