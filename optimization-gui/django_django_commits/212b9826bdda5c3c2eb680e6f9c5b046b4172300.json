{
    "author": "mjtamlyn",
    "message": "Fixed #14516 -- Extract methods from removetags and slugify template filters\n\nPatch by @jphalip updated to apply, documentation and release notes\nadded.\n\nI've documented strip_tags as well as remove_tags as the difference\nbetween the two wouldn't be immediately obvious.",
    "sha": "212b9826bdda5c3c2eb680e6f9c5b046b4172300",
    "files": [
        {
            "sha": "d8b0c3439a6a516f366d0fd90ae7faed67fec5b8",
            "filename": "django/template/defaultfilters.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/212b9826bdda5c3c2eb680e6f9c5b046b4172300/django%2Ftemplate%2Fdefaultfilters.py",
            "raw_url": "https://github.com/django/django/raw/212b9826bdda5c3c2eb680e6f9c5b046b4172300/django%2Ftemplate%2Fdefaultfilters.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaultfilters.py?ref=212b9826bdda5c3c2eb680e6f9c5b046b4172300",
            "patch": "@@ -231,12 +231,12 @@ def make_list(value):\n @stringfilter\n def slugify(value):\n     \"\"\"\n-    Normalizes string, converts to lowercase, removes non-alpha characters,\n-    and converts spaces to hyphens.\n+    Converts to lowercase, removes non-word characters (alphanumerics and\n+    underscores) and converts spaces to hyphens. Also strips leading and\n+    trailing whitespace.\n     \"\"\"\n-    value = unicodedata.normalize('NFKD', value).encode('ascii', 'ignore').decode()\n-    value = re.sub('[^\\w\\s-]', '', value).strip().lower()\n-    return mark_safe(re.sub('[-\\s]+', '-', value))\n+    from django.utils.text import slugify\n+    return slugify(value)\n \n @register.filter(is_safe=True)\n def stringformat(value, arg):"
        },
        {
            "sha": "13954ce19567f552e19cf5fbbb379f903341b501",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/212b9826bdda5c3c2eb680e6f9c5b046b4172300/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/212b9826bdda5c3c2eb680e6f9c5b046b4172300/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=212b9826bdda5c3c2eb680e6f9c5b046b4172300",
            "patch": "@@ -123,6 +123,17 @@ def strip_tags(value):\n     return re.sub(r'<[^>]*?>', '', force_text(value))\n strip_tags = allow_lazy(strip_tags)\n \n+def remove_tags(html, tags):\n+    \"\"\"Returns the given HTML with given tags removed.\"\"\"\n+    tags = [re.escape(tag) for tag in tags.split()]\n+    tags_re = u'(%s)' % u'|'.join(tags)\n+    starttag_re = re.compile(ur'<%s(/?>|(\\s+[^>]*>))' % tags_re, re.U)\n+    endtag_re = re.compile(u'</%s>' % tags_re)\n+    html = starttag_re.sub(u'', html)\n+    html = endtag_re.sub(u'', html)\n+    return html\n+remove_tags = allow_lazy(remove_tags, unicode)\n+\n def strip_spaces_between_tags(value):\n     \"\"\"Returns the given HTML with spaces between tags removed.\"\"\"\n     return re.sub(r'>\\s+<', '><', force_text(value))"
        },
        {
            "sha": "cbafab00321578836bd5ea57e75d92fd208dca2c",
            "filename": "django/utils/text.py",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/212b9826bdda5c3c2eb680e6f9c5b046b4172300/django%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/212b9826bdda5c3c2eb680e6f9c5b046b4172300/django%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ftext.py?ref=212b9826bdda5c3c2eb680e6f9c5b046b4172300",
            "patch": "@@ -16,6 +16,7 @@\n from django.utils.functional import allow_lazy, SimpleLazyObject\n from django.utils import six\n from django.utils.translation import ugettext_lazy, ugettext as _, pgettext\n+from django.utils.safestring import mark_safe\n \n # Capitalizes the first letter of a string.\n capfirst = lambda x: x and force_text(x)[0].upper() + force_text(x)[1:]\n@@ -383,3 +384,14 @@ def unescape_string_literal(s):\n     quote = s[0]\n     return s[1:-1].replace(r'\\%s' % quote, quote).replace(r'\\\\', '\\\\')\n unescape_string_literal = allow_lazy(unescape_string_literal)\n+\n+def slugify(value):\n+    \"\"\"\n+    Converts to lowercase, removes non-word characters (alphanumerics and\n+    underscores) and converts spaces to hyphens. Also strips leading and\n+    trailing whitespace.\n+    \"\"\"\n+    value = unicodedata.normalize('NFKD', value).encode('ascii', 'ignore')\n+    value = unicode(re.sub('[^\\w\\s-]', '', value).strip().lower())\n+    return mark_safe(re.sub('[-\\s]+', '-', value))\n+slugify = allow_lazy(slugify, unicode)"
        },
        {
            "sha": "775d70738b0fa733d2bff952d50ed24ee84d5513",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 45,
            "deletions": 0,
            "changes": 45,
            "blob_url": "https://github.com/django/django/blob/212b9826bdda5c3c2eb680e6f9c5b046b4172300/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/212b9826bdda5c3c2eb680e6f9c5b046b4172300/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=212b9826bdda5c3c2eb680e6f9c5b046b4172300",
            "patch": "@@ -486,6 +486,33 @@ escaping HTML.\n     through :func:`conditional_escape` which (ultimately) calls\n     :func:`~django.utils.encoding.force_text` on the values.\n \n+.. function:: strip_tags(value)\n+\n+    Removes anything that looks like an html tag from the string, that is\n+    anything contained within ``<>``.\n+\n+    For example::\n+\n+        strip_tags(value)\n+\n+    If ``value`` is ``\"<b>Joel</b> <button>is</button> a <span>slug</span>\"`` the\n+    return value will be ``\"Joel is a slug\"``.\n+\n+.. function:: remove_tags(value, tags)\n+\n+    Removes a list of [X]HTML tag names from the output.\n+\n+    For example::\n+\n+        remove_tags(value, [\"b\", \"span\"])\n+\n+    If ``value`` is ``\"<b>Joel</b> <button>is</button> a <span>slug</span>\"`` the\n+    return value will be ``\"Joel <button>is</button> a slug\"``.\n+\n+    Note that this filter is case-sensitive.\n+\n+    If ``value`` is ``\"<B>Joel</B> <button>is</button> a <span>slug</span>\"`` the\n+    return value will be ``\"<B>Joel</B> <button>is</button> a slug\"``.\n \n .. _str.format: http://docs.python.org/library/stdtypes.html#str.format\n \n@@ -599,6 +626,24 @@ appropriate entities.\n     Can be called multiple times on a single string (the resulting escaping is\n     only applied once).\n \n+``django.utils.text``\n+=====================\n+\n+.. module:: django.utils.text\n+    :synopsis: Text manipulation.\n+\n+.. function:: slugify\n+\n+    Converts to lowercase, removes non-word characters (alphanumerics and\n+    underscores) and converts spaces to hyphens. Also strips leading and trailing\n+    whitespace.\n+\n+    For example::\n+\n+        slugify(value)\n+\n+    If ``value`` is ``\"Joel is a slug\"``, the output will be ``\"joel-is-a-slug\"``.\n+\n ``django.utils.translation``\n ============================\n "
        },
        {
            "sha": "29cbd45c490ec10905baf2af8cfe56381fd29502",
            "filename": "docs/releases/1.5.txt",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/212b9826bdda5c3c2eb680e6f9c5b046b4172300/docs%2Freleases%2F1.5.txt",
            "raw_url": "https://github.com/django/django/raw/212b9826bdda5c3c2eb680e6f9c5b046b4172300/docs%2Freleases%2F1.5.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.5.txt?ref=212b9826bdda5c3c2eb680e6f9c5b046b4172300",
            "patch": "@@ -267,6 +267,10 @@ Miscellaneous\n * :func:`~django.utils.http.int_to_base36` properly raises a :exc:`TypeError`\n   instead of :exc:`ValueError` for non-integer inputs.\n \n+* The ``slugify`` template filter is now available as a standard python\n+  function at :func:`django.utils.text.slugify`. Similarly, ``remove_tags`` is\n+  available at :func:`django.utils.html.remove_tags`.\n+\n Features deprecated in 1.5\n ==========================\n "
        },
        {
            "sha": "98df80a5e234973a77b172de319ae8413ffbbe1f",
            "filename": "tests/regressiontests/utils/html.py",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/212b9826bdda5c3c2eb680e6f9c5b046b4172300/tests%2Fregressiontests%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/212b9826bdda5c3c2eb680e6f9c5b046b4172300/tests%2Fregressiontests%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Fhtml.py?ref=212b9826bdda5c3c2eb680e6f9c5b046b4172300",
            "patch": "@@ -146,3 +146,12 @@ def test_clean_html(self):\n         )\n         for value, output in items:\n             self.check_output(f, value, output)\n+\n+    def test_remove_tags(self):\n+        f = html.remove_tags\n+        items = (\n+            (\"<b><i>Yes</i></b>\", \"b i\", \"Yes\"),\n+            (\"<a>x</a> <p><b>y</b></p>\", \"a b\", \"x <p>y</p>\"),\n+        )\n+        for value, tags, output in items:\n+            self.assertEquals(f(value, tags), output)"
        },
        {
            "sha": "9fa86d515c286ab39c51ff3d9c7fa6eb23003eba",
            "filename": "tests/regressiontests/utils/text.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/212b9826bdda5c3c2eb680e6f9c5b046b4172300/tests%2Fregressiontests%2Futils%2Ftext.py",
            "raw_url": "https://github.com/django/django/raw/212b9826bdda5c3c2eb680e6f9c5b046b4172300/tests%2Fregressiontests%2Futils%2Ftext.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Futils%2Ftext.py?ref=212b9826bdda5c3c2eb680e6f9c5b046b4172300",
            "patch": "@@ -113,3 +113,11 @@ def test_wrap(self):\n         self.assertEqual(text.wrap(long_word, 20), long_word)\n         self.assertEqual(text.wrap('a %s word' % long_word, 10),\n                          'a\\n%s\\nword' % long_word)\n+\n+    def test_slugify(self):\n+        items = (\n+            (u'Hello, World!', 'hello-world'),\n+            (u'spam & eggs', 'spam-eggs'),\n+        )\n+        for value, output in items:\n+            self.assertEqual(text.slugify(value), output)"
        }
    ],
    "stats": {
        "total": 99,
        "additions": 94,
        "deletions": 5
    }
}