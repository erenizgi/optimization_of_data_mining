{
    "author": "timgraham",
    "message": "Fixed #19577 - Added HTML escaping to admin examples.\n\nThanks foo@ for the report and Florian Apolloner for the review.",
    "sha": "eafc0364764ba12babd76194d8e1f78b876471ec",
    "files": [
        {
            "sha": "ec7b28d330a640b7365eba776f77b94926d06c82",
            "filename": "django/utils/html.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/eafc0364764ba12babd76194d8e1f78b876471ec/django%2Futils%2Fhtml.py",
            "raw_url": "https://github.com/django/django/raw/eafc0364764ba12babd76194d8e1f78b876471ec/django%2Futils%2Fhtml.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Fhtml.py?ref=eafc0364764ba12babd76194d8e1f78b876471ec",
            "patch": "@@ -87,8 +87,8 @@ def format_html(format_string, *args, **kwargs):\n \n def format_html_join(sep, format_string, args_generator):\n     \"\"\"\n-    A wrapper format_html, for the common case of a group of arguments that need\n-    to be formatted using the same format string, and then joined using\n+    A wrapper of format_html, for the common case of a group of arguments that\n+    need to be formatted using the same format string, and then joined using\n     'sep'. 'sep' is also passed through conditional_escape.\n \n     'args_generator' should be an iterator that returns the sequence of 'args'"
        },
        {
            "sha": "a862d558757123e818990c89e9da666de454b63f",
            "filename": "docs/ref/contrib/admin/index.txt",
            "status": "modified",
            "additions": 27,
            "deletions": 6,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/eafc0364764ba12babd76194d8e1f78b876471ec/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "raw_url": "https://github.com/django/django/raw/eafc0364764ba12babd76194d8e1f78b876471ec/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fcontrib%2Fadmin%2Findex.txt?ref=eafc0364764ba12babd76194d8e1f78b876471ec",
            "patch": "@@ -449,17 +449,25 @@ subclass::\n     * If the string given is a method of the model, ``ModelAdmin`` or a\n       callable, Django will HTML-escape the output by default. If you'd\n       rather not escape the output of the method, give the method an\n-      ``allow_tags`` attribute whose value is ``True``.\n+      ``allow_tags`` attribute whose value is ``True``. However, to avoid an\n+      XSS vulnerability, you should use :func:`~django.utils.html.format_html`\n+      to escape user-provided inputs.\n \n       Here's a full example model::\n \n+          from django.utils.html import format_html\n+\n           class Person(models.Model):\n               first_name = models.CharField(max_length=50)\n               last_name = models.CharField(max_length=50)\n               color_code = models.CharField(max_length=6)\n \n               def colored_name(self):\n-                  return '<span style=\"color: #%s;\">%s %s</span>' % (self.color_code, self.first_name, self.last_name)\n+                  return format_html('<span style=\"color: #{0};\">{1} {2}</span>',\n+                                     self.color_code,\n+                                     self.first_name,\n+                                     self.last_name)\n+\n               colored_name.allow_tags = True\n \n           class PersonAdmin(admin.ModelAdmin):\n@@ -500,12 +508,17 @@ subclass::\n \n       For example::\n \n+        from django.utils.html import format_html\n+\n         class Person(models.Model):\n             first_name = models.CharField(max_length=50)\n             color_code = models.CharField(max_length=6)\n \n             def colored_first_name(self):\n-                return '<span style=\"color: #%s;\">%s</span>' % (self.color_code, self.first_name)\n+                return format_html('<span style=\"color: #{0};\">{1}</span>',\n+                                   self.color_code,\n+                                   self.first_name)\n+\n             colored_first_name.allow_tags = True\n             colored_first_name.admin_order_field = 'first_name'\n \n@@ -817,19 +830,27 @@ subclass::\n     the admin interface to provide feedback on the status of the objects being\n     edited, for example::\n \n+        from django.utils.html import format_html_join\n+        from django.utils.safestring import mark_safe\n+\n         class PersonAdmin(ModelAdmin):\n             readonly_fields = ('address_report',)\n \n             def address_report(self, instance):\n-                return \", \".join(instance.get_full_address()) or \\\n-                   \"<span class='errors'>I can't determine this address.</span>\"\n+                # assuming get_full_address() returns a list of strings\n+                # for each line of the address and you want to separate each\n+                # line by a linebreak\n+                return format_html_join(\n+                    mark_safe('<br/>'),\n+                    '{0}',\n+                    ((line,) for line in instance.get_full_address()),\n+                ) or \"<span class='errors'>I can't determine this address.</span>\"\n \n             # short_description functions like a model field's verbose_name\n             address_report.short_description = \"Address\"\n             # in this example, we have used HTML tags in the output\n             address_report.allow_tags = True\n \n-\n .. attribute:: ModelAdmin.save_as\n \n     Set ``save_as`` to enable a \"save as\" feature on admin change forms."
        },
        {
            "sha": "e9b29602acf60b4b5dc50e08cd4d8761ab860aca",
            "filename": "docs/ref/utils.txt",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/eafc0364764ba12babd76194d8e1f78b876471ec/docs%2Fref%2Futils.txt",
            "raw_url": "https://github.com/django/django/raw/eafc0364764ba12babd76194d8e1f78b876471ec/docs%2Fref%2Futils.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Futils.txt?ref=eafc0364764ba12babd76194d8e1f78b876471ec",
            "patch": "@@ -541,6 +541,19 @@ escaping HTML.\n     through :func:`conditional_escape` which (ultimately) calls\n     :func:`~django.utils.encoding.force_text` on the values.\n \n+.. function:: format_html_join(sep, format_string, args_generator)\n+\n+    A wrapper of :func:`format_html`, for the common case of a group of\n+    arguments that need to be formatted using the same format string, and then\n+    joined using ``sep``. ``sep`` is also passed through\n+    :func:`conditional_escape`.\n+\n+    ``args_generator`` should be an iterator that returns the sequence of\n+    ``args`` that will be passed to :func:`format_html`. For example::\n+\n+        format_html_join('\\n', \"<li>{0} {1}</li>\", ((u.first_name, u.last_name)\n+                                                    for u in users))\n+\n .. function:: strip_tags(value)\n \n     Removes anything that looks like an html tag from the string, that is"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 42,
        "deletions": 8
    }
}