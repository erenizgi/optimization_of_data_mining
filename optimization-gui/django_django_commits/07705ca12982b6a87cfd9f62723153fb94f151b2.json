{
    "author": "jezdez",
    "message": "Fixed #5298 -- Added extra_context to contrib auth views.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@14768 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "07705ca12982b6a87cfd9f62723153fb94f151b2",
    "files": [
        {
            "sha": "80e7e0a20cb13c38c3c49a31007be154a77c4144",
            "filename": "django/contrib/auth/views.py",
            "status": "modified",
            "additions": 91,
            "deletions": 46,
            "changes": 137,
            "blob_url": "https://github.com/django/django/blob/07705ca12982b6a87cfd9f62723153fb94f151b2/django%2Fcontrib%2Fauth%2Fviews.py",
            "raw_url": "https://github.com/django/django/raw/07705ca12982b6a87cfd9f62723153fb94f151b2/django%2Fcontrib%2Fauth%2Fviews.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fviews.py?ref=07705ca12982b6a87cfd9f62723153fb94f151b2",
            "patch": "@@ -23,7 +23,8 @@\n @never_cache\n def login(request, template_name='registration/login.html',\n           redirect_field_name=REDIRECT_FIELD_NAME,\n-          authentication_form=AuthenticationForm):\n+          authentication_form=AuthenticationForm,\n+          extra_context=None):\n     \"\"\"Displays the login form and handles the login action.\"\"\"\n \n     redirect_to = request.REQUEST.get(redirect_field_name, '')\n@@ -49,22 +50,27 @@ def login(request, template_name='registration/login.html',\n                 request.session.delete_test_cookie()\n \n             return HttpResponseRedirect(redirect_to)\n-\n     else:\n         form = authentication_form(request)\n \n     request.session.set_test_cookie()\n \n     current_site = get_current_site(request)\n \n-    return render_to_response(template_name, {\n+    context = {\n         'form': form,\n         redirect_field_name: redirect_to,\n         'site': current_site,\n         'site_name': current_site.name,\n-    }, context_instance=RequestContext(request))\n-\n-def logout(request, next_page=None, template_name='registration/logged_out.html', redirect_field_name=REDIRECT_FIELD_NAME):\n+    }\n+    context.update(extra_context or {})\n+    return render_to_response(template_name, context,\n+                              context_instance=RequestContext(request))\n+\n+def logout(request, next_page=None,\n+           template_name='registration/logged_out.html',\n+           redirect_field_name=REDIRECT_FIELD_NAME,\n+           extra_context=None):\n     \"Logs out the user and displays 'You are logged out' message.\"\n     from django.contrib.auth import logout\n     logout(request)\n@@ -74,20 +80,23 @@ def logout(request, next_page=None, template_name='registration/logged_out.html'\n             return HttpResponseRedirect(redirect_to)\n         else:\n             current_site = get_current_site(request)\n-            return render_to_response(template_name, {\n+            context = {\n                 'site': current_site,\n                 'site_name': current_site.name,\n                 'title': _('Logged out')\n-            }, context_instance=RequestContext(request))\n+            }\n+            context.update(extra_context or {})\n+            return render_to_response(template_name, context,\n+                                      context_instance=RequestContext(request))\n     else:\n         # Redirect to this page until the session has been cleared.\n         return HttpResponseRedirect(next_page or request.path)\n \n-def logout_then_login(request, login_url=None):\n+def logout_then_login(request, login_url=None, extra_context=None):\n     \"Logs out the user if he is logged in. Then redirects to the log-in page.\"\n     if not login_url:\n         login_url = settings.LOGIN_URL\n-    return logout(request, login_url)\n+    return logout(request, login_url, extra_context=extra_context)\n \n def redirect_to_login(next, login_url=None,\n                       redirect_field_name=REDIRECT_FIELD_NAME):\n@@ -111,38 +120,54 @@ def redirect_to_login(next, login_url=None,\n # - password_reset_complete shows a success message for the above\n \n @csrf_protect\n-def password_reset(request, is_admin_site=False, template_name='registration/password_reset_form.html',\n-        email_template_name='registration/password_reset_email.html',\n-        password_reset_form=PasswordResetForm, token_generator=default_token_generator,\n-        post_reset_redirect=None, from_email=None):\n+def password_reset(request, is_admin_site=False,\n+                   template_name='registration/password_reset_form.html',\n+                   email_template_name='registration/password_reset_email.html',\n+                   password_reset_form=PasswordResetForm,\n+                   token_generator=default_token_generator,\n+                   post_reset_redirect=None,\n+                   from_email=None,\n+                   extra_context=None):\n     if post_reset_redirect is None:\n         post_reset_redirect = reverse('django.contrib.auth.views.password_reset_done')\n     if request.method == \"POST\":\n         form = password_reset_form(request.POST)\n         if form.is_valid():\n-            opts = {}\n-            opts['use_https'] = request.is_secure()\n-            opts['token_generator'] = token_generator\n-            opts['from_email'] = from_email\n-            opts['email_template_name'] = email_template_name\n-            opts['request'] = request\n+            opts = {\n+                'use_https': request.is_secure(),\n+                'token_generator': token_generator,\n+                'from_email': from_email,\n+                'email_template_name': email_template_name,\n+                'request': request,\n+            }\n             if is_admin_site:\n-                opts['domain_override'] = request.META['HTTP_HOST']\n+                opts = dict(opts, domain_override=request.META['HTTP_HOST'])\n             form.save(**opts)\n             return HttpResponseRedirect(post_reset_redirect)\n     else:\n         form = password_reset_form()\n-    return render_to_response(template_name, {\n+    context = {\n         'form': form,\n-    }, context_instance=RequestContext(request))\n-\n-def password_reset_done(request, template_name='registration/password_reset_done.html'):\n-    return render_to_response(template_name, context_instance=RequestContext(request))\n+    }\n+    context.update(extra_context or {})\n+    return render_to_response(template_name, context,\n+                              context_instance=RequestContext(request))\n+\n+def password_reset_done(request,\n+                        template_name='registration/password_reset_done.html',\n+                        extra_context=None):\n+    context = {}\n+    context.update(extra_context or {})\n+    return render_to_response(template_name, context,\n+                              context_instance=RequestContext(request))\n \n # Doesn't need csrf_protect since no-one can guess the URL\n-def password_reset_confirm(request, uidb36=None, token=None, template_name='registration/password_reset_confirm.html',\n-                           token_generator=default_token_generator, set_password_form=SetPasswordForm,\n-                           post_reset_redirect=None):\n+def password_reset_confirm(request, uidb36=None, token=None,\n+                           template_name='registration/password_reset_confirm.html',\n+                           token_generator=default_token_generator,\n+                           set_password_form=SetPasswordForm,\n+                           post_reset_redirect=None,\n+                           extra_context=None):\n     \"\"\"\n     View that checks the hash in a password reset link and presents a\n     form for entering a new password.\n@@ -156,10 +181,8 @@ def password_reset_confirm(request, uidb36=None, token=None, template_name='regi\n     except (ValueError, User.DoesNotExist):\n         user = None\n \n-    context_instance = RequestContext(request)\n-\n     if user is not None and token_generator.check_token(user, token):\n-        context_instance['validlink'] = True\n+        validlink = True\n         if request.method == 'POST':\n             form = set_password_form(user, request.POST)\n             if form.is_valid():\n@@ -168,19 +191,33 @@ def password_reset_confirm(request, uidb36=None, token=None, template_name='regi\n         else:\n             form = set_password_form(None)\n     else:\n-        context_instance['validlink'] = False\n+        validlink = False\n         form = None\n-    context_instance['form'] = form\n-    return render_to_response(template_name, context_instance=context_instance)\n-\n-def password_reset_complete(request, template_name='registration/password_reset_complete.html'):\n-    return render_to_response(template_name, context_instance=RequestContext(request,\n-                                                                             {'login_url': settings.LOGIN_URL}))\n+    context = {\n+        'form': form,\n+        'validlink': validlink,\n+    }\n+    context.update(extra_context or {})\n+    return render_to_response(template_name, context,\n+                              context_instance=RequestContext(request))\n+\n+def password_reset_complete(request,\n+                            template_name='registration/password_reset_complete.html',\n+                            extra_context=None):\n+    context = {\n+        'login_url': settings.LOGIN_URL\n+    }\n+    context.update(extra_context or {})\n+    return render_to_response(template_name, context,\n+                              context_instance=RequestContext(request))\n \n @csrf_protect\n @login_required\n-def password_change(request, template_name='registration/password_change_form.html',\n-                    post_change_redirect=None, password_change_form=PasswordChangeForm):\n+def password_change(request,\n+                    template_name='registration/password_change_form.html',\n+                    post_change_redirect=None,\n+                    password_change_form=PasswordChangeForm,\n+                    extra_context=None):\n     if post_change_redirect is None:\n         post_change_redirect = reverse('django.contrib.auth.views.password_change_done')\n     if request.method == \"POST\":\n@@ -190,9 +227,17 @@ def password_change(request, template_name='registration/password_change_form.ht\n             return HttpResponseRedirect(post_change_redirect)\n     else:\n         form = password_change_form(user=request.user)\n-    return render_to_response(template_name, {\n+    context = {\n         'form': form,\n-    }, context_instance=RequestContext(request))\n-\n-def password_change_done(request, template_name='registration/password_change_done.html'):\n-    return render_to_response(template_name, context_instance=RequestContext(request))\n+    }\n+    context.update(extra_context or {})\n+    return render_to_response(template_name, context,\n+                              context_instance=RequestContext(request))\n+\n+def password_change_done(request,\n+                         template_name='registration/password_change_done.html',\n+                         extra_context=None):\n+    context = {}\n+    context.update(extra_context or {})\n+    return render_to_response(template_name, context,\n+                              context_instance=RequestContext(request))"
        }
    ],
    "stats": {
        "total": 137,
        "additions": 91,
        "deletions": 46
    }
}