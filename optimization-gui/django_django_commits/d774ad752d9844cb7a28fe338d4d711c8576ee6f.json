{
    "author": "claudep",
    "message": "[py3] Made csrf context processor return Unicode",
    "sha": "d774ad752d9844cb7a28fe338d4d711c8576ee6f",
    "files": [
        {
            "sha": "ca1ac68f555c3527ee778695faec04f009583814",
            "filename": "django/core/context_processors.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/d774ad752d9844cb7a28fe338d4d711c8576ee6f/django%2Fcore%2Fcontext_processors.py",
            "raw_url": "https://github.com/django/django/raw/d774ad752d9844cb7a28fe338d4d711c8576ee6f/django%2Fcore%2Fcontext_processors.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fcontext_processors.py?ref=d774ad752d9844cb7a28fe338d4d711c8576ee6f",
            "patch": "@@ -6,12 +6,15 @@\n These are referenced from the setting TEMPLATE_CONTEXT_PROCESSORS and used by\n RequestContext.\n \"\"\"\n+from __future__ import unicode_literals\n \n from django.conf import settings\n from django.middleware.csrf import get_token\n-from django.utils.encoding import smart_bytes\n+from django.utils import six\n+from django.utils.encoding import smart_text\n from django.utils.functional import lazy\n \n+\n def csrf(request):\n     \"\"\"\n     Context processor that provides a CSRF token, or the string 'NOTPROVIDED' if\n@@ -23,10 +26,10 @@ def _get_val():\n             # In order to be able to provide debugging info in the\n             # case of misconfiguration, we use a sentinel value\n             # instead of returning an empty dict.\n-            return b'NOTPROVIDED'\n+            return 'NOTPROVIDED'\n         else:\n-            return smart_bytes(token)\n-    _get_val = lazy(_get_val, str)\n+            return smart_text(token)\n+    _get_val = lazy(_get_val, six.text_type)\n \n     return {'csrf_token': _get_val() }\n "
        },
        {
            "sha": "305b20e1c4411d019d742d39d584b77c81cc1c21",
            "filename": "django/middleware/csrf.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/d774ad752d9844cb7a28fe338d4d711c8576ee6f/django%2Fmiddleware%2Fcsrf.py",
            "raw_url": "https://github.com/django/django/raw/d774ad752d9844cb7a28fe338d4d711c8576ee6f/django%2Fmiddleware%2Fcsrf.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fmiddleware%2Fcsrf.py?ref=d774ad752d9844cb7a28fe338d4d711c8576ee6f",
            "patch": "@@ -4,6 +4,7 @@\n This module provides a middleware that implements protection\n against request forgeries from other sites.\n \"\"\"\n+from __future__ import unicode_literals\n \n import hashlib\n import re\n@@ -12,6 +13,7 @@\n from django.conf import settings\n from django.core.urlresolvers import get_callable\n from django.utils.cache import patch_vary_headers\n+from django.utils.encoding import force_text\n from django.utils.http import same_origin\n from django.utils.log import getLogger\n from django.utils.crypto import constant_time_compare, get_random_string\n@@ -51,11 +53,10 @@ def get_token(request):\n \n \n def _sanitize_token(token):\n-    # Allow only alphanum, and ensure we return a 'str' for the sake\n-    # of the post processing middleware.\n+    # Allow only alphanum\n     if len(token) > CSRF_KEY_LENGTH:\n         return _get_new_csrf_key()\n-    token = re.sub('[^a-zA-Z0-9]+', '', str(token.decode('ascii', 'ignore')))\n+    token = re.sub('[^a-zA-Z0-9]+', '', force_text(token))\n     if token == \"\":\n         # In case the cookie has been truncated to nothing at some point.\n         return _get_new_csrf_key()"
        },
        {
            "sha": "c5b66a31d1182803e431e75aa431a47beccf59a0",
            "filename": "tests/regressiontests/csrf_tests/tests.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/d774ad752d9844cb7a28fe338d4d711c8576ee6f/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/d774ad752d9844cb7a28fe338d4d711c8576ee6f/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fcsrf_tests%2Ftests.py?ref=d774ad752d9844cb7a28fe338d4d711c8576ee6f",
            "patch": "@@ -216,7 +216,7 @@ def test_token_node_no_csrf_cookie(self):\n         \"\"\"\n         req = self._get_GET_no_csrf_cookie_request()\n         resp = token_view(req)\n-        self.assertEqual(\"\", resp.content)\n+        self.assertEqual(resp.content, b'')\n \n     def test_token_node_empty_csrf_cookie(self):\n         \"\"\""
        }
    ],
    "stats": {
        "total": 20,
        "additions": 12,
        "deletions": 8
    }
}