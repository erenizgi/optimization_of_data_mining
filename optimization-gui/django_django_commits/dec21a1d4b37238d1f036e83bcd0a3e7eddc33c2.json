{
    "author": "aaugustin",
    "message": "Removed deprecated and undocumented function django.contrib.formtools.utils.security_hash().\n\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17841 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "dec21a1d4b37238d1f036e83bcd0a3e7eddc33c2",
    "files": [
        {
            "sha": "604797f01c9b8286cfddffe2001c31e3f23a290b",
            "filename": "django/contrib/formtools/tests/__init__.py",
            "status": "modified",
            "additions": 0,
            "deletions": 33,
            "changes": 33,
            "blob_url": "https://github.com/django/django/blob/dec21a1d4b37238d1f036e83bcd0a3e7eddc33c2/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/dec21a1d4b37238d1f036e83bcd0a3e7eddc33c2/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Ftests%2F__init__.py?ref=dec21a1d4b37238d1f036e83bcd0a3e7eddc33c2",
            "patch": "@@ -172,39 +172,6 @@ def test_form_submit_bad_hash(self):\n         self.assertNotEqual(response.content, success_string)\n \n \n-class SecurityHashTests(unittest.TestCase):\n-    def setUp(self):\n-        self._warnings_state = get_warnings_state()\n-        warnings.filterwarnings('ignore', category=DeprecationWarning,\n-                                module='django.contrib.formtools.utils')\n-\n-    def tearDown(self):\n-        restore_warnings_state(self._warnings_state)\n-\n-    def test_textfield_hash(self):\n-        \"\"\"\n-        Regression test for #10034: the hash generation function should ignore\n-        leading/trailing whitespace so as to be friendly to broken browsers that\n-        submit it (usually in textareas).\n-        \"\"\"\n-        f1 = HashTestForm({'name': 'joe', 'bio': 'Nothing notable.'})\n-        f2 = HashTestForm({'name': '  joe', 'bio': 'Nothing notable.  '})\n-        hash1 = utils.security_hash(None, f1)\n-        hash2 = utils.security_hash(None, f2)\n-        self.assertEqual(hash1, hash2)\n-\n-    def test_empty_permitted(self):\n-        \"\"\"\n-        Regression test for #10643: the security hash should allow forms with\n-        empty_permitted = True, or forms where data has not changed.\n-        \"\"\"\n-        f1 = HashTestBlankForm({})\n-        f2 = HashTestForm({}, empty_permitted=True)\n-        hash1 = utils.security_hash(None, f1)\n-        hash2 = utils.security_hash(None, f2)\n-        self.assertEqual(hash1, hash2)\n-\n-\n class FormHmacTests(unittest.TestCase):\n     \"\"\"\n     Same as SecurityHashTests, but with form_hmac"
        },
        {
            "sha": "572a0969eeeb3cb060141f2ad70cf2724429dbd5",
            "filename": "django/contrib/formtools/utils.py",
            "status": "modified",
            "additions": 0,
            "deletions": 34,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/dec21a1d4b37238d1f036e83bcd0a3e7eddc33c2/django%2Fcontrib%2Fformtools%2Futils.py",
            "raw_url": "https://github.com/django/django/raw/dec21a1d4b37238d1f036e83bcd0a3e7eddc33c2/django%2Fcontrib%2Fformtools%2Futils.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fformtools%2Futils.py?ref=dec21a1d4b37238d1f036e83bcd0a3e7eddc33c2",
            "patch": "@@ -3,43 +3,9 @@\n except ImportError:\n     import pickle\n \n-import hashlib\n-from django.conf import settings\n from django.utils.crypto import salted_hmac\n \n \n-def security_hash(request, form, *args):\n-    \"\"\"\n-    Calculates a security hash for the given Form instance.\n-\n-    This creates a list of the form field names/values in a deterministic\n-    order, pickles the result with the SECRET_KEY setting, then takes an md5\n-    hash of that.\n-    \"\"\"\n-    import warnings\n-    warnings.warn(\"security_hash is deprecated; use form_hmac instead\",\n-                  DeprecationWarning)\n-    data = []\n-    for bf in form:\n-        # Get the value from the form data. If the form allows empty or hasn't\n-        # changed then don't call clean() to avoid trigger validation errors.\n-        if form.empty_permitted and not form.has_changed():\n-            value = bf.data or ''\n-        else:\n-            value = bf.field.clean(bf.data) or ''\n-        if isinstance(value, basestring):\n-            value = value.strip()\n-        data.append((bf.name, value))\n-        \n-    data.extend(args)\n-    data.append(settings.SECRET_KEY)\n-\n-    # Use HIGHEST_PROTOCOL because it's the most efficient.\n-    pickled = pickle.dumps(data, pickle.HIGHEST_PROTOCOL)\n-\n-    return hashlib.md5(pickled).hexdigest()\n-\n-\n def form_hmac(form):\n     \"\"\"\n     Calculates a security hash for the given Form instance."
        }
    ],
    "stats": {
        "total": 67,
        "additions": 0,
        "deletions": 67
    }
}