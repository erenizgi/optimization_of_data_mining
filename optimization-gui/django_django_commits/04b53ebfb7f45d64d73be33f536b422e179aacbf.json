{
    "author": "freakboy3742",
    "message": "Fixed #19133 -- Corrected regression in form handling for user passwords.\n\nThanks to pressureman for the report, and to Preston Holmes for the draft patch.",
    "sha": "04b53ebfb7f45d64d73be33f536b422e179aacbf",
    "files": [
        {
            "sha": "423e3429e6a6cb6e8a7657d692054bc5be62e6a9",
            "filename": "django/contrib/auth/forms.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/django/django/blob/04b53ebfb7f45d64d73be33f536b422e179aacbf/django%2Fcontrib%2Fauth%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/04b53ebfb7f45d64d73be33f536b422e179aacbf/django%2Fcontrib%2Fauth%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fforms.py?ref=04b53ebfb7f45d64d73be33f536b422e179aacbf",
            "patch": "@@ -52,9 +52,6 @@ def __init__(self, *args, **kwargs):\n         kwargs.setdefault(\"required\", False)\n         super(ReadOnlyPasswordHashField, self).__init__(*args, **kwargs)\n \n-    def clean_password(self):\n-        return self.initial\n-\n \n class UserCreationForm(forms.ModelForm):\n     \"\"\"\n@@ -130,6 +127,12 @@ def __init__(self, *args, **kwargs):\n         if f is not None:\n             f.queryset = f.queryset.select_related('content_type')\n \n+    def clean_password(self):\n+        # Regardless of what the user provides, return the initial value.\n+        # This is done here, rather than on the field, because the\n+        # field does not have access to the initial value\n+        return self.initial[\"password\"]\n+\n \n class AuthenticationForm(forms.Form):\n     \"\"\""
        },
        {
            "sha": "f3eb24287e822999a7d693268213eb1c35bc4c8d",
            "filename": "django/contrib/auth/tests/forms.py",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/04b53ebfb7f45d64d73be33f536b422e179aacbf/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "raw_url": "https://github.com/django/django/raw/04b53ebfb7f45d64d73be33f536b422e179aacbf/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fforms.py?ref=04b53ebfb7f45d64d73be33f536b422e179aacbf",
            "patch": "@@ -265,6 +265,23 @@ def test_bug_17944_unknown_password_algorithm(self):\n         self.assertIn(_(\"Invalid password format or unknown hashing algorithm.\"),\n             form.as_table())\n \n+    def test_bug_19133(self):\n+        \"The change form does not return the password value\"\n+        # Use the form to construct the POST data\n+        user = User.objects.get(username='testclient')\n+        form_for_data = UserChangeForm(instance=user)\n+        post_data = form_for_data.initial\n+\n+        # The password field should be readonly, so anything\n+        # posted here should be ignored; the form will be\n+        # valid, and give back the 'initial' value for the\n+        # password field.\n+        post_data['password'] = 'new password'\n+        form = UserChangeForm(instance=user, data=post_data)\n+\n+        self.assertTrue(form.is_valid())\n+        self.assertEqual(form.cleaned_data['password'], 'sha1$6efc0$f93efe9fd7542f25a7be94871ea45aa95de57161')\n+\n \n @skipIfCustomUser\n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 23,
        "deletions": 3
    }
}