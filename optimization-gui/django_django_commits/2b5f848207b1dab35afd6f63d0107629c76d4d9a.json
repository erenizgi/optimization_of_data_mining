{
    "author": "ptone",
    "message": "Fixed #19057 (again) -- added additional tests",
    "sha": "2b5f848207b1dab35afd6f63d0107629c76d4d9a",
    "files": [
        {
            "sha": "5ee4d609f7bf7d7deb5f06e058e1bdcfa80dfe4e",
            "filename": "django/contrib/auth/handlers/modwsgi.py",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/2b5f848207b1dab35afd6f63d0107629c76d4d9a/django%2Fcontrib%2Fauth%2Fhandlers%2Fmodwsgi.py",
            "raw_url": "https://github.com/django/django/raw/2b5f848207b1dab35afd6f63d0107629c76d4d9a/django%2Fcontrib%2Fauth%2Fhandlers%2Fmodwsgi.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Fhandlers%2Fmodwsgi.py?ref=2b5f848207b1dab35afd6f63d0107629c76d4d9a",
            "patch": "@@ -21,17 +21,12 @@ def check_password(environ, username, password):\n             user = UserModel.objects.get_by_natural_key(username)\n         except UserModel.DoesNotExist:\n             return None\n-        try:\n-            if not user.is_active:\n-                return None\n-        except AttributeError as e:\n-            # a custom user may not support is_active\n+        if not user.is_active:\n             return None\n         return user.check_password(password)\n     finally:\n         db.close_connection()\n \n-\n def groups_for_user(environ, username):\n     \"\"\"\n     Authorizes a user based on groups"
        },
        {
            "sha": "04ab46f75b5f0a4889216c7aedb4ad89c74cf637",
            "filename": "django/contrib/auth/tests/handlers.py",
            "status": "modified",
            "additions": 31,
            "deletions": 11,
            "changes": 42,
            "blob_url": "https://github.com/django/django/blob/2b5f848207b1dab35afd6f63d0107629c76d4d9a/django%2Fcontrib%2Fauth%2Ftests%2Fhandlers.py",
            "raw_url": "https://github.com/django/django/raw/2b5f848207b1dab35afd6f63d0107629c76d4d9a/django%2Fcontrib%2Fauth%2Ftests%2Fhandlers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fhandlers.py?ref=2b5f848207b1dab35afd6f63d0107629c76d4d9a",
            "patch": "@@ -2,47 +2,67 @@\n \n from django.contrib.auth.handlers.modwsgi import check_password, groups_for_user\n from django.contrib.auth.models import User, Group\n+from django.contrib.auth.tests import CustomUser\n from django.contrib.auth.tests.utils import skipIfCustomUser\n from django.test import TransactionTestCase\n+from django.test.utils import override_settings\n \n \n class ModWsgiHandlerTestCase(TransactionTestCase):\n     \"\"\"\n     Tests for the mod_wsgi authentication handler\n     \"\"\"\n-\n-    def setUp(self):\n-        user1 = User.objects.create_user('test', 'test@example.com', 'test')\n-        User.objects.create_user('test1', 'test1@example.com', 'test1')\n-        group = Group.objects.create(name='test_group')\n-        user1.groups.add(group)\n-\n     @skipIfCustomUser\n     def test_check_password(self):\n         \"\"\"\n         Verify that check_password returns the correct values as per\n         http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms#Apache_Authentication_Provider\n-\n-        because the custom user available in the test framework does not\n-        support the is_active attribute, we can't test this with a custom\n-        user.\n         \"\"\"\n+        User.objects.create_user('test', 'test@example.com', 'test')\n \n         # User not in database\n         self.assertTrue(check_password({}, 'unknown', '') is None)\n \n         # Valid user with correct password\n         self.assertTrue(check_password({}, 'test', 'test'))\n \n+        # correct password, but user is inactive\n+        User.objects.filter(username='test').update(is_active=False)\n+        self.assertFalse(check_password({}, 'test', 'test'))\n+\n         # Valid user with incorrect password\n         self.assertFalse(check_password({}, 'test', 'incorrect'))\n \n+    @override_settings(AUTH_USER_MODEL='auth.CustomUser')\n+    def test_check_password_custom_user(self):\n+        \"\"\"\n+        Verify that check_password returns the correct values as per\n+        http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms#Apache_Authentication_Provider\n+\n+        with custom user installed\n+        \"\"\"\n+\n+        CustomUser.objects.create_user('test@example.com', '1990-01-01', 'test')\n+\n+        # User not in database\n+        self.assertTrue(check_password({}, 'unknown', '') is None)\n+\n+        # Valid user with correct password'\n+        self.assertTrue(check_password({}, 'test@example.com', 'test'))\n+\n+        # Valid user with incorrect password\n+        self.assertFalse(check_password({}, 'test@example.com', 'incorrect'))\n+\n     @skipIfCustomUser\n     def test_groups_for_user(self):\n         \"\"\"\n         Check that groups_for_user returns correct values as per\n         http://code.google.com/p/modwsgi/wiki/AccessControlMechanisms#Apache_Group_Authorisation\n         \"\"\"\n+        user1 = User.objects.create_user('test', 'test@example.com', 'test')\n+        User.objects.create_user('test1', 'test1@example.com', 'test1')\n+        group = Group.objects.create(name='test_group')\n+        user1.groups.add(group)\n \n         # User not in database\n         self.assertEqual(groups_for_user({}, 'unknown'), [])"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 32,
        "deletions": 17
    }
}