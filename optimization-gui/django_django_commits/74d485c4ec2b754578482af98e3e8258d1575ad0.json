{
    "author": "freakboy3742",
    "message": "Fixed #15170 -- Skip the inspectdb test under MySQL/MyISAM, because it can't differentiate a foreign key from an integer.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@15385 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "74d485c4ec2b754578482af98e3e8258d1575ad0",
    "files": [
        {
            "sha": "2abc81ae5dc736e1fffebbe72dc779abe27db70d",
            "filename": "django/db/backends/__init__.py",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/django/django/blob/74d485c4ec2b754578482af98e3e8258d1575ad0/django%2Fdb%2Fbackends%2F__init__.py",
            "raw_url": "https://github.com/django/django/raw/74d485c4ec2b754578482af98e3e8258d1575ad0/django%2Fdb%2Fbackends%2F__init__.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2F__init__.py?ref=74d485c4ec2b754578482af98e3e8258d1575ad0",
            "patch": "@@ -168,6 +168,7 @@ class BaseDatabaseFeatures(object):\n     _confirmed = False\n     supports_transactions = None\n     supports_stddev = None\n+    can_introspect_foreign_keys = None\n \n     def __init__(self, connection):\n         self.connection = connection\n@@ -177,6 +178,7 @@ def confirm(self):\n         self._confirmed = True\n         self.supports_transactions = self._supports_transactions()\n         self.supports_stddev = self._supports_stddev()\n+        self.can_introspect_foreign_keys = self._can_introspect_foreign_keys()\n \n     def _supports_transactions(self):\n         \"Confirm support for transactions\"\n@@ -201,6 +203,12 @@ class StdDevPop(object):\n         except NotImplementedError:\n             self.supports_stddev = False\n \n+    def _can_introspect_foreign_keys(self):\n+        \"Confirm support for introspected foreign keys\"\n+        # Every database can do this reliably, except MySQL,\n+        # which can't do it for MyISAM tables\n+        return True\n+\n \n class BaseDatabaseOperations(object):\n     \"\"\""
        },
        {
            "sha": "98233c73291d67cd4345ec47692665916603d117",
            "filename": "django/db/backends/mysql/base.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/django/django/blob/74d485c4ec2b754578482af98e3e8258d1575ad0/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "raw_url": "https://github.com/django/django/raw/74d485c4ec2b754578482af98e3e8258d1575ad0/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fdb%2Fbackends%2Fmysql%2Fbase.py?ref=74d485c4ec2b754578482af98e3e8258d1575ad0",
            "patch": "@@ -133,6 +133,19 @@ class DatabaseFeatures(BaseDatabaseFeatures):\n     requires_explicit_null_ordering_when_grouping = True\n     allows_primary_key_0 = False\n \n+    def _can_introspect_foreign_keys(self):\n+        \"Confirm support for introspected foreign keys\"\n+        cursor = self.connection.cursor()\n+        cursor.execute('CREATE TABLE INTROSPECT_TEST (X INT)')\n+        # This command is MySQL specific; the second column\n+        # will tell you the default table type of the created\n+        # table. Since all Django's test tables will have the same\n+        # table type, that's enough to evaluate the feature.\n+        cursor.execute('SHOW TABLE STATUS WHERE Name=\"INTROSPECT_TEST\"')\n+        result = cursor.fetchone()\n+        cursor.execute('DROP TABLE INTROSPECT_TEST')\n+        return result[1] != 'MyISAM'\n+\n class DatabaseOperations(BaseDatabaseOperations):\n     compiler_module = \"django.db.backends.mysql.compiler\"\n "
        },
        {
            "sha": "683e6e9cf7f13980423549c418ddafabc4c36891",
            "filename": "tests/regressiontests/inspectdb/tests.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/django/django/blob/74d485c4ec2b754578482af98e3e8258d1575ad0/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/74d485c4ec2b754578482af98e3e8258d1575ad0/tests%2Fregressiontests%2Finspectdb%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Finspectdb%2Ftests.py?ref=74d485c4ec2b754578482af98e3e8258d1575ad0",
            "patch": "@@ -1,10 +1,12 @@\n from StringIO import StringIO\n \n from django.core.management import call_command\n-from django.test import TestCase\n+from django.test import TestCase, skipUnlessDBFeature\n \n \n class InspectDBTestCase(TestCase):\n+\n+    @skipUnlessDBFeature('can_introspect_foreign_keys')\n     def test_attribute_name_not_python_keyword(self):\n         out = StringIO()\n         call_command('inspectdb', stdout=out)"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 24,
        "deletions": 1
    }
}