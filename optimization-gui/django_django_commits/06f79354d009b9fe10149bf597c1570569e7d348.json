{
    "author": "apollo13",
    "message": "Added tests for d21f3d9b171a3cbff4c8ce7a9dbb8b8be3f21bac.",
    "sha": "06f79354d009b9fe10149bf597c1570569e7d348",
    "files": [
        {
            "sha": "e570280ada1102aa8727375c8721c10c99cf60b6",
            "filename": "django/contrib/auth/tests/signals.py",
            "status": "modified",
            "additions": 16,
            "deletions": 1,
            "changes": 17,
            "blob_url": "https://github.com/django/django/blob/06f79354d009b9fe10149bf597c1570569e7d348/django%2Fcontrib%2Fauth%2Ftests%2Fsignals.py",
            "raw_url": "https://github.com/django/django/raw/06f79354d009b9fe10149bf597c1570569e7d348/django%2Fcontrib%2Fauth%2Ftests%2Fsignals.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fauth%2Ftests%2Fsignals.py?ref=06f79354d009b9fe10149bf597c1570569e7d348",
            "patch": "@@ -1,6 +1,8 @@\n+from django.contrib.auth import signals\n+from django.contrib.auth.models import User\n from django.test import TestCase\n+from django.test.client import RequestFactory\n from django.test.utils import override_settings\n-from django.contrib.auth import signals\n \n \n @override_settings(USE_TZ=False, PASSWORD_HASHERS=('django.contrib.auth.hashers.SHA1PasswordHasher',))\n@@ -47,3 +49,16 @@ def test_logout(self):\n         self.client.get('/logout/next_page/')\n         self.assertEqual(len(self.logged_out), 1)\n         self.assertEqual(self.logged_out[0].username, 'testclient')\n+\n+    def test_update_last_login(self):\n+        \"\"\"Ensure that only `last_login` is updated in `update_last_login`\"\"\"\n+        user = User.objects.get(pk=3)\n+        old_last_login = user.last_login\n+\n+        user.username = \"This username shouldn't get saved\"\n+        request = RequestFactory().get('/login')\n+        signals.user_logged_in.send(sender=user.__class__, request=request,\n+            user=user)\n+        user = User.objects.get(pk=3)\n+        self.assertEqual(user.username, 'staff')\n+        self.assertNotEqual(user.last_login, old_last_login)"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 16,
        "deletions": 1
    }
}