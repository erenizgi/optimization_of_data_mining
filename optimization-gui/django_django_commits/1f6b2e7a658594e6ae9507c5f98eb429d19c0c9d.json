{
    "author": "ramiro",
    "message": "Fixed #6682 -- Made shell's REPL actually execute $PYTHONSTARTUP and `~/.pythonrc.py`.\n\nAlso:\n\n* Added a ``--no-startup`` option to disable this behavior. Previous\n  logic to try to execute the code in charge of this funcionality was\n  flawed (it only tried to do so if the user asked for ipython/bpython\n  and they weren't found)\n* Expand ``~`` in PYTHONSTARTUP value.\n\nThanks hekevintran at gmail dot com  for the report and initial patch.\n\nRefs #3381.",
    "sha": "1f6b2e7a658594e6ae9507c5f98eb429d19c0c9d",
    "files": [
        {
            "sha": "851d4e3cfbe5a0fc5f642adfc0a5e1eedc1c9298",
            "filename": "django/core/management/commands/shell.py",
            "status": "modified",
            "additions": 15,
            "deletions": 9,
            "changes": 24,
            "blob_url": "https://github.com/django/django/blob/1f6b2e7a658594e6ae9507c5f98eb429d19c0c9d/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py",
            "raw_url": "https://github.com/django/django/raw/1f6b2e7a658594e6ae9507c5f98eb429d19c0c9d/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fcommands%2Fshell.py?ref=1f6b2e7a658594e6ae9507c5f98eb429d19c0c9d",
            "patch": "@@ -9,6 +9,8 @@ class Command(NoArgsCommand):\n     option_list = NoArgsCommand.option_list + (\n         make_option('--plain', action='store_true', dest='plain',\n             help='Tells Django to use plain Python, not IPython or bpython.'),\n+        make_option('--no-startup', action='store_true', dest='no_startup',\n+            help='When using plain Python, ignore the PYTHONSTARTUP environment variable and ~/.pythonrc.py script.'),\n         make_option('-i', '--interface', action='store', type='choice', choices=shells,\n                     dest='interface',\n             help='Specify an interactive interpreter interface. Available options: \"ipython\" and \"bpython\"'),\n@@ -56,6 +58,7 @@ def handle_noargs(self, **options):\n         get_models()\n \n         use_plain = options.get('plain', False)\n+        no_startup = options.get('no_startup', False)\n         interface = options.get('interface', None)\n \n         try:\n@@ -83,13 +86,16 @@ def handle_noargs(self, **options):\n \n             # We want to honor both $PYTHONSTARTUP and .pythonrc.py, so follow system\n             # conventions and get $PYTHONSTARTUP first then .pythonrc.py.\n-            if not use_plain:\n-                for pythonrc in (os.environ.get(\"PYTHONSTARTUP\"),\n-                                 os.path.expanduser('~/.pythonrc.py')):\n-                    if pythonrc and os.path.isfile(pythonrc):\n-                        try:\n-                            with open(pythonrc) as handle:\n-                                exec(compile(handle.read(), pythonrc, 'exec'))\n-                        except NameError:\n-                            pass\n+            if not no_startup:\n+                for pythonrc in (os.environ.get(\"PYTHONSTARTUP\"), '~/.pythonrc.py'):\n+                    if not pythonrc:\n+                        continue\n+                    pythonrc = os.path.expanduser(pythonrc)\n+                    if not os.path.isfile(pythonrc):\n+                        continue\n+                    try:\n+                        with open(pythonrc) as handle:\n+                            exec(compile(handle.read(), pythonrc, 'exec'), imported_objects)\n+                    except NameError:\n+                        pass\n             code.interact(local=imported_objects)"
        },
        {
            "sha": "8f6664edb765dd289549ebd89aaa340fe2523977",
            "filename": "docs/ref/django-admin.txt",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/django/django/blob/1f6b2e7a658594e6ae9507c5f98eb429d19c0c9d/docs%2Fref%2Fdjango-admin.txt",
            "raw_url": "https://github.com/django/django/raw/1f6b2e7a658594e6ae9507c5f98eb429d19c0c9d/docs%2Fref%2Fdjango-admin.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Fref%2Fdjango-admin.txt?ref=1f6b2e7a658594e6ae9507c5f98eb429d19c0c9d",
            "patch": "@@ -779,6 +779,18 @@ bpython::\n .. _IPython: http://ipython.scipy.org/\n .. _bpython: http://bpython-interpreter.org/\n \n+When the \"plain\" Python interactive interpreter starts (be it because\n+``--plain`` was specified or because no other interactive interface is\n+available) it reads the script pointed to by the :envvar:`PYTHONSTARTUP`\n+environment variable and the ``~/.pythonrc.py`` script. If you don't wish this\n+behavior you can use the ``--no-startup`` option. e.g.::\n+\n+    django-admin.py shell --plain --no-startup\n+\n+.. versionadded:: 1.6\n+\n+The ``--no-startup`` option was added in Django 1.6.\n+\n sql <appname appname ...>\n -------------------------\n "
        }
    ],
    "stats": {
        "total": 36,
        "additions": 27,
        "deletions": 9
    }
}