{
    "author": "carljm",
    "message": "Fixed #16770 -- Eliminated TemplateSyntaxError wrapping of exceptions. Thanks to Justin Myles-Holmes for report and draft patch.\n\nExceptions raised in templates were previously wrapped in TemplateSyntaxError\n(in TEMPLATE_DEBUG mode only) in order to provide template source details on\nthe debug 500 page. The same debug information is now provided by annotating\nexceptions rather than wrapping them. This makes catching exceptions raised\nfrom templates more sane, as it's consistent in or out of DEBUG, and you can\ncatch the specific exception(s) you care about rather than having to also catch\nTemplateSyntaxError and unwrap it.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16833 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4397c587a43ff9bfddd295d48d850676778c6e77",
    "files": [
        {
            "sha": "d11f1ee2651a23612e48b58108ab35427d76fc0b",
            "filename": "django/template/debug.py",
            "status": "modified",
            "additions": 14,
            "deletions": 20,
            "changes": 34,
            "blob_url": "https://github.com/django/django/blob/4397c587a43ff9bfddd295d48d850676778c6e77/django%2Ftemplate%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/4397c587a43ff9bfddd295d48d850676778c6e77/django%2Ftemplate%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdebug.py?ref=4397c587a43ff9bfddd295d48d850676778c6e77",
            "patch": "@@ -4,6 +4,7 @@\n from django.utils.safestring import SafeData, EscapeData\n from django.utils.formats import localize\n \n+\n class DebugLexer(Lexer):\n     def __init__(self, template_string, origin):\n         super(DebugLexer, self).__init__(template_string, origin)\n@@ -42,9 +43,9 @@ def exit_command(self):\n     def error(self, token, msg):\n         return self.source_error(token.source, msg)\n \n-    def source_error(self, source,msg):\n+    def source_error(self, source, msg):\n         e = TemplateSyntaxError(msg)\n-        e.source = source\n+        e.django_template_source = source\n         return e\n \n     def create_nodelist(self):\n@@ -63,38 +64,31 @@ def unclosed_block_tag(self, parse_until):\n         raise self.source_error(source, msg)\n \n     def compile_function_error(self, token, e):\n-        if not hasattr(e, 'source'):\n-            e.source = token.source\n+        if not hasattr(e, 'django_template_source'):\n+            e.django_template_source = token.source\n \n class DebugNodeList(NodeList):\n     def render_node(self, node, context):\n         try:\n-            result = node.render(context)\n-        except TemplateSyntaxError, e:\n-            if not hasattr(e, 'source'):\n-                e.source = node.source\n-            raise\n+            return node.render(context)\n         except Exception, e:\n-            from sys import exc_info\n-            wrapped = TemplateSyntaxError(u'Caught %s while rendering: %s' %\n-                (e.__class__.__name__, force_unicode(e, errors='replace')))\n-            wrapped.source = getattr(e, 'template_node_source', node.source)\n-            wrapped.exc_info = exc_info()\n-            raise wrapped, None, wrapped.exc_info[2]\n-        return result\n+            if not hasattr(e, 'django_template_source'):\n+                e.django_template_source = node.source\n+            raise\n+\n \n class DebugVariableNode(VariableNode):\n     def render(self, context):\n         try:\n             output = self.filter_expression.resolve(context)\n             output = localize(output, use_l10n=context.use_l10n)\n             output = force_unicode(output)\n-        except TemplateSyntaxError, e:\n-            if not hasattr(e, 'source'):\n-                e.source = self.source\n-            raise\n         except UnicodeDecodeError:\n             return ''\n+        except Exception, e:\n+            if not hasattr(e, 'django_template_source'):\n+                e.django_template_source = self.source\n+            raise\n         if (context.autoescape and not isinstance(output, SafeData)) or isinstance(output, EscapeData):\n             return escape(output)\n         else:"
        },
        {
            "sha": "125cd9ed550fa7c5cd1ba3164b495fffd3303b40",
            "filename": "django/template/defaulttags.py",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/django/django/blob/4397c587a43ff9bfddd295d48d850676778c6e77/django%2Ftemplate%2Fdefaulttags.py",
            "raw_url": "https://github.com/django/django/raw/4397c587a43ff9bfddd295d48d850676778c6e77/django%2Ftemplate%2Fdefaulttags.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Ftemplate%2Fdefaulttags.py?ref=4397c587a43ff9bfddd295d48d850676778c6e77",
            "patch": "@@ -227,17 +227,15 @@ def render(self, context):\n                     context.update(unpacked_vars)\n             else:\n                 context[self.loopvars[0]] = item\n-            # In TEMPLATE_DEBUG mode providing source of the node which\n-            # actually raised an exception to DefaultNodeList.render_node\n+            # In TEMPLATE_DEBUG mode provide source of the node which\n+            # actually raised the exception\n             if settings.TEMPLATE_DEBUG:\n                 for node in self.nodelist_loop:\n                     try:\n                         nodelist.append(node.render(context))\n                     except Exception, e:\n-                        if not hasattr(e, 'template_node_source'):\n-                            from sys import exc_info\n-                            e.template_node_source = node.source\n-                            raise e, None, exc_info()[2]\n+                        if not hasattr(e, 'django_template_source'):\n+                            e.django_template_source = node.source\n                         raise\n             else:\n                 for node in self.nodelist_loop:"
        },
        {
            "sha": "8c77d7099691cc1be4784d65c3ed490b5ba51e28",
            "filename": "django/views/debug.py",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/4397c587a43ff9bfddd295d48d850676778c6e77/django%2Fviews%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/4397c587a43ff9bfddd295d48d850676778c6e77/django%2Fviews%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fviews%2Fdebug.py?ref=4397c587a43ff9bfddd295d48d850676778c6e77",
            "patch": "@@ -8,8 +8,7 @@\n from django.core.exceptions import ImproperlyConfigured\n from django.http import (HttpResponse, HttpResponseServerError,\n     HttpResponseNotFound, HttpRequest, build_request_repr)\n-from django.template import (Template, Context, TemplateDoesNotExist,\n-    TemplateSyntaxError)\n+from django.template import Template, Context, TemplateDoesNotExist\n from django.template.defaultfilters import force_escape, pprint\n from django.utils.html import escape\n from django.utils.importlib import import_module\n@@ -223,8 +222,8 @@ def get_traceback_html(self):\n                     'loader': loader_name,\n                     'templates': template_list,\n                 })\n-        if (settings.TEMPLATE_DEBUG and hasattr(self.exc_value, 'source') and\n-            isinstance(self.exc_value, TemplateSyntaxError)):\n+        if (settings.TEMPLATE_DEBUG and\n+            hasattr(self.exc_value, 'django_template_source')):\n             self.get_template_exception_info()\n \n         frames = self.get_traceback_frames()\n@@ -268,7 +267,7 @@ def get_traceback_html(self):\n         return t.render(c)\n \n     def get_template_exception_info(self):\n-        origin, (start, end) = self.exc_value.source\n+        origin, (start, end) = self.exc_value.django_template_source\n         template_source = origin.reload()\n         context_lines = 10\n         line = 0\n@@ -626,7 +625,7 @@ def empty_urlconf(request):\n {% endif %}\n {% if template_info %}\n <div id=\"template\">\n-   <h2>Template error</h2>\n+   <h2>Error during template rendering</h2>\n    <p>In template <code>{{ template_info.name }}</code>, error at line <strong>{{ template_info.line }}</strong></p>\n    <h3>{{ template_info.message }}</h3>\n    <table class=\"source{% if template_info.top %} cut-top{% endif %}{% ifnotequal template_info.bottom template_info.total %} cut-bottom{% endifnotequal %}\">"
        },
        {
            "sha": "b78653683ff1939442e8d9103c4741ff412afd2e",
            "filename": "tests/regressiontests/templates/nodelist.py",
            "status": "modified",
            "additions": 5,
            "deletions": 11,
            "changes": 16,
            "blob_url": "https://github.com/django/django/blob/4397c587a43ff9bfddd295d48d850676778c6e77/tests%2Fregressiontests%2Ftemplates%2Fnodelist.py",
            "raw_url": "https://github.com/django/django/raw/4397c587a43ff9bfddd295d48d850676778c6e77/tests%2Fregressiontests%2Ftemplates%2Fnodelist.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Fnodelist.py?ref=4397c587a43ff9bfddd295d48d850676778c6e77",
            "patch": "@@ -1,7 +1,7 @@\n-from django.conf import settings\n-from django.template import VariableNode, Context, TemplateSyntaxError\n+from django.template import VariableNode, Context\n from django.template.loader import get_template_from_string\n from django.utils.unittest import TestCase\n+from django.test.utils import override_settings\n \n class NodelistTest(TestCase):\n \n@@ -35,13 +35,7 @@ class ErrorIndexTest(TestCase):\n     Checks whether index of error is calculated correctly in\n     template debugger in for loops. Refs ticket #5831\n     \"\"\"\n-    def setUp(self):\n-        self.old_template_debug = settings.TEMPLATE_DEBUG\n-        settings.TEMPLATE_DEBUG = True\n-\n-    def tearDown(self):\n-        settings.TEMPLATE_DEBUG = self.old_template_debug\n-\n+    @override_settings(DEBUG=True, TEMPLATE_DEBUG = True)\n     def test_correct_exception_index(self):\n         tests = [\n             ('{% load bad_tag %}{% for i in range %}{% badsimpletag %}{% endfor %}', (38, 56)),\n@@ -58,7 +52,7 @@ def test_correct_exception_index(self):\n             template = get_template_from_string(source)\n             try:\n                 template.render(context)\n-            except TemplateSyntaxError, e:\n-                error_source_index = e.source[1]\n+            except (RuntimeError, TypeError), e:\n+                error_source_index = e.django_template_source[1]\n                 self.assertEqual(error_source_index,\n                                  expected_error_source_index)"
        },
        {
            "sha": "f85416563b67c15e64ef07d1ae96ab5df5b5cda9",
            "filename": "tests/regressiontests/templates/tests.py",
            "status": "modified",
            "additions": 40,
            "deletions": 34,
            "changes": 74,
            "blob_url": "https://github.com/django/django/blob/4397c587a43ff9bfddd295d48d850676778c6e77/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4397c587a43ff9bfddd295d48d850676778c6e77/tests%2Fregressiontests%2Ftemplates%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Ftemplates%2Ftests.py?ref=4397c587a43ff9bfddd295d48d850676778c6e77",
            "patch": "@@ -1,4 +1,6 @@\n # -*- coding: utf-8 -*-\n+from __future__ import with_statement\n+\n from django.conf import settings\n \n if __name__ == '__main__':\n@@ -20,7 +22,7 @@\n from django.template import loader\n from django.template.loaders import app_directories, filesystem, cached\n from django.test.utils import (get_warnings_state, restore_warnings_state,\n-    setup_test_template_loader, restore_template_loaders)\n+    setup_test_template_loader, restore_template_loaders, override_settings)\n from django.utils import unittest\n from django.utils.formats import date_format\n from django.utils.translation import activate, deactivate, ugettext as _\n@@ -309,9 +311,9 @@ def test_extends_include_missing_baseloader(self):\n             r = None\n             try:\n                 r = tmpl.render(template.Context({}))\n-            except template.TemplateSyntaxError, e:\n+            except template.TemplateDoesNotExist, e:\n                 settings.TEMPLATE_DEBUG = old_td\n-                self.assertEqual(e.args[0], 'Caught TemplateDoesNotExist while rendering: missing.html')\n+                self.assertEqual(e.args[0], 'missing.html')\n             self.assertEqual(r, None, 'Template rendering unexpectedly succeeded, produced: ->%r<-' % r)\n         finally:\n             loader.template_source_loaders = old_loaders\n@@ -336,17 +338,17 @@ def test_extends_include_missing_cachedloader(self):\n             r = None\n             try:\n                 r = tmpl.render(template.Context({}))\n-            except template.TemplateSyntaxError, e:\n-                self.assertEqual(e.args[0], 'Caught TemplateDoesNotExist while rendering: missing.html')\n+            except template.TemplateDoesNotExist, e:\n+                self.assertEqual(e.args[0], 'missing.html')\n             self.assertEqual(r, None, 'Template rendering unexpectedly succeeded, produced: ->%r<-' % r)\n \n             # For the cached loader, repeat the test, to ensure the first attempt did not cache a\n             # result that behaves incorrectly on subsequent attempts.\n             tmpl = loader.get_template(load_name)\n             try:\n                 tmpl.render(template.Context({}))\n-            except template.TemplateSyntaxError, e:\n-                self.assertEqual(e.args[0], 'Caught TemplateDoesNotExist while rendering: missing.html')\n+            except template.TemplateDoesNotExist, e:\n+                self.assertEqual(e.args[0], 'missing.html')\n             self.assertEqual(r, None, 'Template rendering unexpectedly succeeded, produced: ->%r<-' % r)\n         finally:\n             loader.template_source_loaders = old_loaders\n@@ -358,27 +360,31 @@ def test_token_smart_split(self):\n         split = token.split_contents()\n         self.assertEqual(split, [\"sometag\", '_(\"Page not found\")', 'value|yesno:_(\"yes,no\")'])\n \n+    @override_settings(SETTINGS_MODULE=None, TEMPLATE_DEBUG=True)\n     def test_url_reverse_no_settings_module(self):\n         # Regression test for #9005\n-        from django.template import Template, Context, TemplateSyntaxError\n-\n-        old_settings_module = settings.SETTINGS_MODULE\n-        old_template_debug = settings.TEMPLATE_DEBUG\n-\n-        settings.SETTINGS_MODULE = None\n-        settings.TEMPLATE_DEBUG = True\n+        from django.template import Template, Context\n \n         t = Template('{% url will_not_match %}')\n         c = Context()\n-        try:\n-            rendered = t.render(c)\n-        except TemplateSyntaxError, e:\n-            # Assert that we are getting the template syntax error and not the\n-            # string encoding error.\n-            self.assertEqual(e.args[0], \"Caught NoReverseMatch while rendering: Reverse for 'will_not_match' with arguments '()' and keyword arguments '{}' not found.\")\n+        with self.assertRaises(urlresolvers.NoReverseMatch):\n+            t.render(c)\n+\n+\n+    @override_settings(DEBUG=True, TEMPLATE_DEBUG = True)\n+    def test_no_wrapped_exception(self):\n+        \"\"\"\n+        The template system doesn't wrap exceptions, but annotates them.\n+        Refs #16770\n+\n+        \"\"\"\n+        c = Context({\"coconuts\": lambda: 42 / 0})\n+        t = Template(\"{{ coconuts }}\")\n+        with self.assertRaises(ZeroDivisionError) as cm:\n+            t.render(c)\n+\n+        self.assertEqual(cm.exception.django_template_source[1], (0, 14))\n \n-        settings.SETTINGS_MODULE = old_settings_module\n-        settings.TEMPLATE_DEBUG = old_template_debug\n \n     def test_invalid_block_suggestion(self):\n         # See #7876\n@@ -666,7 +672,7 @@ def get_template_tests(self):\n \n             # In methods that raise an exception without a\n             # \"silent_variable_attribute\" set to True, the exception propagates\n-            'filter-syntax14': (r'1{{ var.method4 }}2', {\"var\": SomeClass()}, (SomeOtherException, SomeOtherException, template.TemplateSyntaxError)),\n+            'filter-syntax14': (r'1{{ var.method4 }}2', {\"var\": SomeClass()}, (SomeOtherException, SomeOtherException)),\n \n             # Escaped backslash in argument\n             'filter-syntax15': (r'{{ var|default_if_none:\"foo\\bar\" }}', {\"var\": None}, r'foo\\bar'),\n@@ -695,8 +701,8 @@ def get_template_tests(self):\n             # In attribute and dict lookups that raise an unexpected exception\n             # without a \"silent_variable_attribute\" set to True, the exception\n             # propagates\n-            'filter-syntax23': (r'1{{ var.noisy_fail_key }}2', {\"var\": SomeClass()}, (SomeOtherException, SomeOtherException, template.TemplateSyntaxError)),\n-            'filter-syntax24': (r'1{{ var.noisy_fail_attribute }}2', {\"var\": SomeClass()}, (SomeOtherException, SomeOtherException, template.TemplateSyntaxError)),\n+            'filter-syntax23': (r'1{{ var.noisy_fail_key }}2', {\"var\": SomeClass()}, (SomeOtherException, SomeOtherException)),\n+            'filter-syntax24': (r'1{{ var.noisy_fail_attribute }}2', {\"var\": SomeClass()}, (SomeOtherException, SomeOtherException)),\n \n             ### COMMENT SYNTAX ########################################################\n             'comment-syntax01': (\"{# this is hidden #}hello\", {}, \"hello\"),\n@@ -753,7 +759,7 @@ def get_template_tests(self):\n             ### EXCEPTIONS ############################################################\n \n             # Raise exception for invalid template name\n-            'exception01': (\"{% extends 'nonexistent' %}\", {}, (template.TemplateDoesNotExist, template.TemplateDoesNotExist, template.TemplateSyntaxError)),\n+            'exception01': (\"{% extends 'nonexistent' %}\", {}, (template.TemplateDoesNotExist, template.TemplateDoesNotExist)),\n \n             # Raise exception for invalid template name (in variable)\n             'exception02': (\"{% extends nonexistent %}\", {}, (template.TemplateSyntaxError, template.TemplateDoesNotExist)),\n@@ -1050,7 +1056,7 @@ def get_template_tests(self):\n             'include-fail2': ('{% load broken_tag %}', {}, template.TemplateSyntaxError),\n             'include-error07': ('{% include \"include-fail1\" %}', {}, ('', '', RuntimeError)),\n             'include-error08': ('{% include \"include-fail2\" %}', {}, ('', '', template.TemplateSyntaxError)),\n-            'include-error09': ('{% include failed_include %}', {'failed_include': 'include-fail1'}, ('', '', template.TemplateSyntaxError)),\n+            'include-error09': ('{% include failed_include %}', {'failed_include': 'include-fail1'}, ('', '', RuntimeError)),\n             'include-error10': ('{% include failed_include %}', {'failed_include': 'include-fail2'}, ('', '', template.TemplateSyntaxError)),\n \n \n@@ -1481,8 +1487,8 @@ def get_template_tests(self):\n \n             # Failures\n             'old-url-fail01': ('{% url %}', {}, template.TemplateSyntaxError),\n-            'old-url-fail02': ('{% url no_such_view %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n-            'old-url-fail03': ('{% url regressiontests.templates.views.client %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n+            'old-url-fail02': ('{% url no_such_view %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch)),\n+            'old-url-fail03': ('{% url regressiontests.templates.views.client %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch)),\n             'old-url-fail04': ('{% url view id, %}', {}, template.TemplateSyntaxError),\n             'old-url-fail05': ('{% url view id= %}', {}, template.TemplateSyntaxError),\n             'old-url-fail06': ('{% url view a.id=id %}', {}, template.TemplateSyntaxError),\n@@ -1522,18 +1528,18 @@ def get_template_tests(self):\n \n             # Failures\n             'url-fail01': ('{% load url from future %}{% url %}', {}, template.TemplateSyntaxError),\n-            'url-fail02': ('{% load url from future %}{% url \"no_such_view\" %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n-            'url-fail03': ('{% load url from future %}{% url \"regressiontests.templates.views.client\" %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n+            'url-fail02': ('{% load url from future %}{% url \"no_such_view\" %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch)),\n+            'url-fail03': ('{% load url from future %}{% url \"regressiontests.templates.views.client\" %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch)),\n             'url-fail04': ('{% load url from future %}{% url \"view\" id, %}', {}, template.TemplateSyntaxError),\n             'url-fail05': ('{% load url from future %}{% url \"view\" id= %}', {}, template.TemplateSyntaxError),\n             'url-fail06': ('{% load url from future %}{% url \"view\" a.id=id %}', {}, template.TemplateSyntaxError),\n             'url-fail07': ('{% load url from future %}{% url \"view\" a.id!id %}', {}, template.TemplateSyntaxError),\n             'url-fail08': ('{% load url from future %}{% url \"view\" id=\"unterminatedstring %}', {}, template.TemplateSyntaxError),\n             'url-fail09': ('{% load url from future %}{% url \"view\" id=\", %}', {}, template.TemplateSyntaxError),\n \n-            'url-fail11': ('{% load url from future %}{% url named_url %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n-            'url-fail12': ('{% load url from future %}{% url named_url %}', {'named_url': 'no_such_view'}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n-            'url-fail13': ('{% load url from future %}{% url named_url %}', {'named_url': 'regressiontests.templates.views.client'}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch, template.TemplateSyntaxError)),\n+            'url-fail11': ('{% load url from future %}{% url named_url %}', {}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch)),\n+            'url-fail12': ('{% load url from future %}{% url named_url %}', {'named_url': 'no_such_view'}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch)),\n+            'url-fail13': ('{% load url from future %}{% url named_url %}', {'named_url': 'regressiontests.templates.views.client'}, (urlresolvers.NoReverseMatch, urlresolvers.NoReverseMatch)),\n             'url-fail14': ('{% load url from future %}{% url named_url id, %}', {'named_url': 'view'}, template.TemplateSyntaxError),\n             'url-fail15': ('{% load url from future %}{% url named_url id= %}', {'named_url': 'view'}, template.TemplateSyntaxError),\n             'url-fail16': ('{% load url from future %}{% url named_url a.id=id %}', {'named_url': 'view'}, template.TemplateSyntaxError),"
        },
        {
            "sha": "712d94cfa7b71b5e21db25ce16cb4add0afb9b4f",
            "filename": "tests/regressiontests/views/tests/debug.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/4397c587a43ff9bfddd295d48d850676778c6e77/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "raw_url": "https://github.com/django/django/raw/4397c587a43ff9bfddd295d48d850676778c6e77/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fviews%2Ftests%2Fdebug.py?ref=4397c587a43ff9bfddd295d48d850676778c6e77",
            "patch": "@@ -75,7 +75,7 @@ def test_template_exceptions(self):\n         for n in range(len(except_args)):\n             try:\n                 self.client.get(reverse('template_exception', args=(n,)))\n-            except TemplateSyntaxError, e:\n+            except Exception:\n                 raising_loc = inspect.trace()[-1][-2][0].strip()\n                 self.assertFalse(raising_loc.find('raise BrokenException') == -1,\n                     \"Failed to find 'raise BrokenException' in last frame of traceback, instead found: %s\" %"
        }
    ],
    "stats": {
        "total": 147,
        "additions": 69,
        "deletions": 78
    }
}