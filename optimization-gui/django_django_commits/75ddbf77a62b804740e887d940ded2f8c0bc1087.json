{
    "author": "malcolmt",
    "message": "Teach \"django-admin.py validate\" to forbid nullable primary keys.\n\nFixes #15884, with thanks to JustinTArthur and Julie Pichon.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@16678 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "75ddbf77a62b804740e887d940ded2f8c0bc1087",
    "files": [
        {
            "sha": "c13b19df97bdc7771d76f38c36fec10155ffaf66",
            "filename": "django/core/management/validation.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/75ddbf77a62b804740e887d940ded2f8c0bc1087/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "raw_url": "https://github.com/django/django/raw/75ddbf77a62b804740e887d940ded2f8c0bc1087/django%2Fcore%2Fmanagement%2Fvalidation.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Fvalidation.py?ref=75ddbf77a62b804740e887d940ded2f8c0bc1087",
            "patch": "@@ -39,6 +39,8 @@ def get_validation_errors(outfile, app=None):\n                 e.add(opts, '\"%s\": You can\\'t use \"id\" as a field name, because each model automatically gets an \"id\" field if none of the fields have primary_key=True. You need to either remove/rename your \"id\" field or add primary_key=True to a field.' % f.name)\n             if f.name.endswith('_'):\n                 e.add(opts, '\"%s\": Field names cannot end with underscores, because this would lead to ambiguous queryset filters.' % f.name)\n+            if f.primary_key and f.null:\n+                e.add(opts, '\"%s\": Primary key fields cannot have null=True.' % f.name)\n             if isinstance(f, models.CharField):\n                 try:\n                     max_length = int(f.max_length)"
        },
        {
            "sha": "e54947849662995b1f18cfb57c3e212099e92d62",
            "filename": "tests/modeltests/invalid_models/invalid_models/models.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/75ddbf77a62b804740e887d940ded2f8c0bc1087/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/75ddbf77a62b804740e887d940ded2f8c0bc1087/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fmodeltests%2Finvalid_models%2Finvalid_models%2Fmodels.py?ref=75ddbf77a62b804740e887d940ded2f8c0bc1087",
            "patch": "@@ -220,14 +220,18 @@ class InvalidSetDefault(models.Model):\n     fk = models.ForeignKey('self', on_delete=models.SET_DEFAULT)\n \n class UnicodeForeignKeys(models.Model):\n-    \"\"\"Foreign keys which can translate to ascii should be OK, but fail if they're not.\"\"\"\n+    \"\"\"Foreign keys which can translate to ascii should be OK, but fail if\n+    they're not.\"\"\"\n     good = models.ForeignKey(u'FKTarget')\n     also_good = models.ManyToManyField(u'FKTarget', related_name='unicode2')\n \n     # In Python 3 this should become legal, but currently causes unicode errors\n     # when adding the errors in core/management/validation.py\n     #bad = models.ForeignKey(u'â˜…')\n \n+class PrimaryKeyNull(models.Model):\n+    my_pk_field = models.IntegerField(primary_key=True, null=True)\n+\n \n model_errors = \"\"\"invalid_models.fielderrors: \"charfield\": CharFields require a \"max_length\" attribute that is a positive integer.\n invalid_models.fielderrors: \"charfield2\": CharFields require a \"max_length\" attribute that is a positive integer.\n@@ -338,4 +342,5 @@ class UnicodeForeignKeys(models.Model):\n invalid_models.nonexistingorderingwithsingleunderscore: \"ordering\" refers to \"does_not_exist\", a field that doesn't exist.\n invalid_models.invalidsetnull: 'fk' specifies on_delete=SET_NULL, but cannot be null.\n invalid_models.invalidsetdefault: 'fk' specifies on_delete=SET_DEFAULT, but has no default value.\n+invalid_models.primarykeynull: \"my_pk_field\": Primary key fields cannot have null=True.\n \"\"\""
        }
    ],
    "stats": {
        "total": 9,
        "additions": 8,
        "deletions": 1
    }
}