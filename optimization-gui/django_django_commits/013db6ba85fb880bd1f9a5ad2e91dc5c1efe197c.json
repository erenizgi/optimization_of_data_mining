{
    "author": "claudep",
    "message": "Fixed #18051 -- Allowed admin fieldsets to contain lists\n\nThanks Ricardo di Virgilio for the report, Mateus Gondim for the\npatch and Nick Sandford for the review.",
    "sha": "013db6ba85fb880bd1f9a5ad2e91dc5c1efe197c",
    "files": [
        {
            "sha": "07013d1d4bda130e0dbafcf57a8161ada66308bf",
            "filename": "django/contrib/admin/util.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/013db6ba85fb880bd1f9a5ad2e91dc5c1efe197c/django%2Fcontrib%2Fadmin%2Futil.py",
            "raw_url": "https://github.com/django/django/raw/013db6ba85fb880bd1f9a5ad2e91dc5c1efe197c/django%2Fcontrib%2Fadmin%2Futil.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcontrib%2Fadmin%2Futil.py?ref=013db6ba85fb880bd1f9a5ad2e91dc5c1efe197c",
            "patch": "@@ -88,8 +88,7 @@ def flatten_fieldsets(fieldsets):\n     field_names = []\n     for name, opts in fieldsets:\n         for field in opts['fields']:\n-            # type checking feels dirty, but it seems like the best way here\n-            if type(field) == tuple:\n+            if isinstance(field, (list, tuple)):\n                 field_names.extend(field)\n             else:\n                 field_names.append(field)"
        },
        {
            "sha": "274103cf87b923a7eec7e3fb17f38b02f44ae6e3",
            "filename": "tests/regressiontests/admin_util/tests.py",
            "status": "modified",
            "additions": 20,
            "deletions": 2,
            "changes": 22,
            "blob_url": "https://github.com/django/django/blob/013db6ba85fb880bd1f9a5ad2e91dc5c1efe197c/tests%2Fregressiontests%2Fadmin_util%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/013db6ba85fb880bd1f9a5ad2e91dc5c1efe197c/tests%2Fregressiontests%2Fadmin_util%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_util%2Ftests.py?ref=013db6ba85fb880bd1f9a5ad2e91dc5c1efe197c",
            "patch": "@@ -5,8 +5,8 @@\n from django.conf import settings\n from django.contrib import admin\n from django.contrib.admin import helpers\n-from django.contrib.admin.util import (display_for_field, label_for_field,\n-    lookup_field, NestedObjects)\n+from django.contrib.admin.util import (display_for_field, flatten_fieldsets,\n+    label_for_field, lookup_field, NestedObjects)\n from django.contrib.admin.views.main import EMPTY_CHANGELIST_VALUE\n from django.contrib.sites.models import Site\n from django.db import models, DEFAULT_DB_ALIAS\n@@ -300,3 +300,21 @@ class MyForm(forms.Form):\n                          '<label for=\"id_text\" class=\"required inline\">&amp;text:</label>')\n         self.assertEqual(helpers.AdminField(form, 'cb', is_first=False).label_tag(),\n                          '<label for=\"id_cb\" class=\"vCheckboxLabel required inline\">&amp;cb</label>')\n+\n+    def test_flatten_fieldsets(self):\n+        \"\"\"\n+        Regression test for #18051\n+        \"\"\"\n+        fieldsets = (\n+            (None, {\n+                'fields': ('url', 'title', ('content', 'sites'))\n+            }),\n+        )\n+        self.assertEqual(flatten_fieldsets(fieldsets), ['url', 'title', 'content', 'sites'])\n+\n+        fieldsets = (\n+            (None, {\n+                'fields': ['url', 'title', ['content', 'sites'])\n+            }),\n+        )\n+        self.assertEqual(flatten_fieldsets(fieldsets), ['url', 'title', 'content', 'sites'])"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 21,
        "deletions": 4
    }
}