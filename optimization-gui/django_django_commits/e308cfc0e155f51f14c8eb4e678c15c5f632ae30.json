{
    "author": "ramiro",
    "message": "Added support for specifying initial values to model formsets and inline formsets.\n\nThis make them consistent with the similar capability of regular\nformsets. Thanks to simon29 form the report and to Claude Paroz for the\npatch.\n\nFixes #14574.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17373 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "e308cfc0e155f51f14c8eb4e678c15c5f632ae30",
    "files": [
        {
            "sha": "dcd2f017e77abdc1901d6f655b76db7172ede91b",
            "filename": "django/forms/formsets.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/django%2Fforms%2Fformsets.py",
            "raw_url": "https://github.com/django/django/raw/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/django%2Fforms%2Fformsets.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fformsets.py?ref=e308cfc0e155f51f14c8eb4e678c15c5f632ae30",
            "patch": "@@ -122,7 +122,7 @@ def _construct_form(self, i, **kwargs):\n         if self.is_bound:\n             defaults['data'] = self.data\n             defaults['files'] = self.files\n-        if self.initial:\n+        if self.initial and not 'initial' in kwargs:\n             try:\n                 defaults['initial'] = self.initial[i]\n             except IndexError:"
        },
        {
            "sha": "15d50419d4c84e059e6d653bb403e5404633ef10",
            "filename": "django/forms/models.py",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/django%2Fforms%2Fmodels.py",
            "raw_url": "https://github.com/django/django/raw/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/django%2Fforms%2Fmodels.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fforms%2Fmodels.py?ref=e308cfc0e155f51f14c8eb4e678c15c5f632ae30",
            "patch": "@@ -418,6 +418,7 @@ class BaseModelFormSet(BaseFormSet):\n     def __init__(self, data=None, files=None, auto_id='id_%s', prefix=None,\n                  queryset=None, **kwargs):\n         self.queryset = queryset\n+        self.initial_extra = kwargs.pop('initial', None)\n         defaults = {'data': data, 'files': files, 'auto_id': auto_id, 'prefix': prefix}\n         defaults.update(kwargs)\n         super(BaseModelFormSet, self).__init__(**defaults)\n@@ -448,6 +449,12 @@ def _construct_form(self, i, **kwargs):\n             kwargs['instance'] = self._existing_object(pk)\n         if i < self.initial_form_count() and not kwargs.get('instance'):\n             kwargs['instance'] = self.get_queryset()[i]\n+        if i >= self.initial_form_count() and self.initial_extra:\n+            # Set initial values for extra forms\n+            try:\n+                kwargs['initial'] = self.initial_extra[i-self.initial_form_count()]\n+            except IndexError:\n+                pass\n         return super(BaseModelFormSet, self)._construct_form(i, **kwargs)\n \n     def get_queryset(self):\n@@ -674,7 +681,7 @@ def modelformset_factory(model, form=ModelForm, formfield_callback=None,\n class BaseInlineFormSet(BaseModelFormSet):\n     \"\"\"A formset for child objects related to a parent.\"\"\"\n     def __init__(self, data=None, files=None, instance=None,\n-                 save_as_new=False, prefix=None, queryset=None):\n+                 save_as_new=False, prefix=None, queryset=None, **kwargs):\n         from django.db.models.fields.related import RelatedObject\n         if instance is None:\n             self.instance = self.fk.rel.to()\n@@ -687,7 +694,7 @@ def __init__(self, data=None, files=None, instance=None,\n             queryset = self.model._default_manager\n         qs = queryset.filter(**{self.fk.name: self.instance})\n         super(BaseInlineFormSet, self).__init__(data, files, prefix=prefix,\n-                                                queryset=qs)\n+                                                queryset=qs, **kwargs)\n \n     def initial_form_count(self):\n         if self.save_as_new:"
        },
        {
            "sha": "9b3c219d31c7e4eab6c2e28c4713b56617986f05",
            "filename": "docs/releases/1.4.txt",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/docs%2Freleases%2F1.4.txt",
            "raw_url": "https://github.com/django/django/raw/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/docs%2Freleases%2F1.4.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Freleases%2F1.4.txt?ref=e308cfc0e155f51f14c8eb4e678c15c5f632ae30",
            "patch": "@@ -556,6 +556,12 @@ Django 1.4 also includes several smaller improvements worth noting:\n * The MySQL database backend can now make use of the savepoint feature\n   implemented by MySQL version 5.0.3 or newer with the InnoDB storage engine.\n \n+* It is now possible to pass initial values to the model forms that are part of\n+  both model formsets and inline model formset as returned from factory\n+  functions ``modelformset_factory`` and ``inlineformset_factory`` respectively\n+  just like with regular formsets. However, initial values only apply to extra\n+  forms i.e. those which are not bound to an existing model instance.\n+\n Backwards incompatible changes in 1.4\n =====================================\n "
        },
        {
            "sha": "b524c24ad2c45a575a7ddb6252526b5b10087cdb",
            "filename": "docs/topics/forms/formsets.txt",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/docs%2Ftopics%2Fforms%2Fformsets.txt",
            "raw_url": "https://github.com/django/django/raw/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/docs%2Ftopics%2Fforms%2Fformsets.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fformsets.txt?ref=e308cfc0e155f51f14c8eb4e678c15c5f632ae30",
            "patch": "@@ -53,6 +53,8 @@ Formsets can also be indexed into, which returns the corresponding form. If you\n override ``__iter__``, you will need to also override ``__getitem__`` to have\n matching behavior.\n \n+.. _formsets-initial-data:\n+\n Using initial data with a formset\n ---------------------------------\n "
        },
        {
            "sha": "cd1f43ae491d9190dfe53e6deac557cbb0e76dff",
            "filename": "docs/topics/forms/modelforms.txt",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/django/django/blob/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "raw_url": "https://github.com/django/django/raw/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/docs%2Ftopics%2Fforms%2Fmodelforms.txt",
            "contents_url": "https://api.github.com/repos/django/django/contents/docs%2Ftopics%2Fforms%2Fmodelforms.txt?ref=e308cfc0e155f51f14c8eb4e678c15c5f632ae30",
            "patch": "@@ -617,6 +617,17 @@ exclude::\n \n     >>> AuthorFormSet = modelformset_factory(Author, exclude=('birth_date',))\n \n+Providing initial values\n+------------------------\n+\n+.. versionadded:: 1.4\n+\n+As with regular formsets, it is possible to :ref:`specify initial data\n+<formsets-initial-data>` for forms in the formset by specifying an ``initial``\n+parameter when instantiating the model formset class returned by\n+``modelformset_factory``. However, with model formsets the initial values only\n+apply to extra forms, those which are not bound to an existing object instance.\n+\n .. _saving-objects-in-the-formset:\n \n Saving objects in the formset"
        },
        {
            "sha": "613d77616cd9bd7d4bb288283dc52602a6633fe7",
            "filename": "tests/regressiontests/model_formsets_regress/tests.py",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/e308cfc0e155f51f14c8eb4e678c15c5f632ae30/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fmodel_formsets_regress%2Ftests.py?ref=e308cfc0e155f51f14c8eb4e678c15c5f632ae30",
            "patch": "@@ -204,6 +204,17 @@ def test_save_as_new_with_new_inlines(self):\n             [\"<Host: matrix.de.eu.dal.net>\", \"<Host: tranquility.hub.dal.net>\"]\n             )\n \n+    def test_initial_data(self):\n+        user = User.objects.create(username=\"bibi\", serial=1)\n+        UserSite.objects.create(user=user, data=7)\n+        FormSet = inlineformset_factory(User, UserSite, extra=2)\n+\n+        formset = FormSet(instance=user, initial=[{'data': 41}, {'data': 42}])\n+        self.assertEqual(formset.forms[0].initial['data'], 7)\n+        self.assertEqual(formset.extra_forms[0].initial['data'], 41)\n+        self.assertTrue(u'value=\"42\"' in formset.extra_forms[1].as_p())\n+\n+\n class FormsetTests(TestCase):\n     def test_error_class(self):\n         '''\n@@ -230,6 +241,14 @@ def test_error_class(self):\n             self.assertTrue(isinstance(form.errors, ErrorDict))\n             self.assertTrue(isinstance(form.non_field_errors(), ErrorList))\n \n+    def test_initial_data(self):\n+        User.objects.create(username=\"bibi\", serial=1)\n+        Formset = modelformset_factory(User, extra=2)\n+        formset = Formset(initial=[{'username': u'apollo11'}, {'username': u'apollo12'}])\n+        self.assertEqual(formset.forms[0].initial['username'], \"bibi\")\n+        self.assertEqual(formset.extra_forms[0].initial['username'], \"apollo11\")\n+        self.assertTrue(u'value=\"apollo12\"' in formset.extra_forms[1].as_p())\n+\n class CustomWidget(forms.CharField):\n     pass\n "
        }
    ],
    "stats": {
        "total": 51,
        "additions": 48,
        "deletions": 3
    }
}