{
    "author": "alex",
    "message": "Try to save memory and time when using lazy objects by refering to their function via the closure, and not making it an attribute on each instance.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17360 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4a92059b0811bb1538f60d18981a27126683baf8",
    "files": [
        {
            "sha": "befe3e9dad71df6ad3e43eb9d3bd3aa5110461a4",
            "filename": "django/utils/functional.py",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/django/django/blob/4a92059b0811bb1538f60d18981a27126683baf8/django%2Futils%2Ffunctional.py",
            "raw_url": "https://github.com/django/django/raw/4a92059b0811bb1538f60d18981a27126683baf8/django%2Futils%2Ffunctional.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Futils%2Ffunctional.py?ref=4a92059b0811bb1538f60d18981a27126683baf8",
            "patch": "@@ -66,7 +66,6 @@ class __proxy__(Promise):\n         __dispatch = None\n \n         def __init__(self, args, kw):\n-            self.__func = func\n             self.__args = args\n             self.__kw = kw\n             if self.__dispatch is None:\n@@ -75,7 +74,7 @@ def __init__(self, args, kw):\n         def __reduce__(self):\n             return (\n                 _lazy_proxy_unpickle,\n-                (self.__func, self.__args, self.__kw) + resultclasses\n+                (func, self.__args, self.__kw) + resultclasses\n             )\n \n         def __prepare_class__(cls):\n@@ -100,37 +99,37 @@ def __prepare_class__(cls):\n                 cls.__str__ = cls.__str_cast\n         __prepare_class__ = classmethod(__prepare_class__)\n \n-        def __promise__(cls, klass, funcname, func):\n+        def __promise__(cls, klass, funcname, method):\n             # Builds a wrapper around some magic method and registers that magic\n             # method for the given type and method name.\n             def __wrapper__(self, *args, **kw):\n                 # Automatically triggers the evaluation of a lazy value and\n                 # applies the given magic method of the result type.\n-                res = self.__func(*self.__args, **self.__kw)\n+                res = func(*self.__args, **self.__kw)\n                 for t in type(res).mro():\n                     if t in self.__dispatch:\n                         return self.__dispatch[t][funcname](res, *args, **kw)\n                 raise TypeError(\"Lazy object returned unexpected type.\")\n \n             if klass not in cls.__dispatch:\n                 cls.__dispatch[klass] = {}\n-            cls.__dispatch[klass][funcname] = func\n+            cls.__dispatch[klass][funcname] = method\n             return __wrapper__\n         __promise__ = classmethod(__promise__)\n \n         def __unicode_cast(self):\n-            return self.__func(*self.__args, **self.__kw)\n+            return func(*self.__args, **self.__kw)\n \n         def __str_cast(self):\n-            return str(self.__func(*self.__args, **self.__kw))\n+            return str(func(*self.__args, **self.__kw))\n \n         def __cmp__(self, rhs):\n             if self._delegate_str:\n-                s = str(self.__func(*self.__args, **self.__kw))\n+                s = str(func(*self.__args, **self.__kw))\n             elif self._delegate_unicode:\n-                s = unicode(self.__func(*self.__args, **self.__kw))\n+                s = unicode(func(*self.__args, **self.__kw))\n             else:\n-                s = self.__func(*self.__args, **self.__kw)\n+                s = func(*self.__args, **self.__kw)\n             if isinstance(rhs, Promise):\n                 return -cmp(rhs, s)\n             else:"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 9,
        "deletions": 10
    }
}