{
    "author": "jezdez",
    "message": "Fixed #17920 -- Actually pass the full path of a newly created project or app in the template context as mentioned in the startproject docs. Many thanks to Preston Holmes for the initial patch.\n\ngit-svn-id: http://code.djangoproject.com/svn/django/trunk@17773 bcc190cf-cafb-0310-a4f2-bffc1f526a37",
    "sha": "4219e2b7f833171bd24c6dd9802deb9eb7d0bafe",
    "files": [
        {
            "sha": "391dd88ba4c879c5595d8c8c987f2d8ea73e27f2",
            "filename": "django/conf/project_template/manage.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/django/django/blob/4219e2b7f833171bd24c6dd9802deb9eb7d0bafe/django%2Fconf%2Fproject_template%2Fmanage.py",
            "raw_url": "https://github.com/django/django/raw/4219e2b7f833171bd24c6dd9802deb9eb7d0bafe/django%2Fconf%2Fproject_template%2Fmanage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fconf%2Fproject_template%2Fmanage.py?ref=4219e2b7f833171bd24c6dd9802deb9eb7d0bafe",
            "patch": "@@ -1,5 +1,6 @@\n #!/usr/bin/env python\n-import os, sys\n+import os\n+import sys\n \n if __name__ == \"__main__\":\n     os.environ.setdefault(\"DJANGO_SETTINGS_MODULE\", \"{{ project_name }}.settings\")"
        },
        {
            "sha": "9a4b2c1723ff4f2a543d4eabb89fb628f6f2d66f",
            "filename": "django/core/management/templates.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/django/django/blob/4219e2b7f833171bd24c6dd9802deb9eb7d0bafe/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "raw_url": "https://github.com/django/django/raw/4219e2b7f833171bd24c6dd9802deb9eb7d0bafe/django%2Fcore%2Fmanagement%2Ftemplates.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Fmanagement%2Ftemplates.py?ref=4219e2b7f833171bd24c6dd9802deb9eb7d0bafe",
            "patch": "@@ -89,8 +89,10 @@ def handle(self, app_or_project, name, target=None, **options):\n                     message = e\n                 raise CommandError(message)\n         else:\n-            top_dir = path.expanduser(target)\n-\n+            top_dir = os.path.abspath(path.expanduser(target))\n+            if not os.path.exists(top_dir):\n+                raise CommandError(\"Destination directory '%s' does not \"\n+                                   \"exist, please create it first.\" % top_dir)\n \n         extensions = tuple(\n             handle_extensions(options.get('extensions'), ignored=()))"
        },
        {
            "sha": "d9843c433faea853302346eab0e03b9ad27f52dc",
            "filename": "tests/regressiontests/admin_scripts/custom_templates/project_template/manage.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/django/django/blob/4219e2b7f833171bd24c6dd9802deb9eb7d0bafe/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fmanage.py",
            "raw_url": "https://github.com/django/django/raw/4219e2b7f833171bd24c6dd9802deb9eb7d0bafe/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fmanage.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Fcustom_templates%2Fproject_template%2Fmanage.py?ref=4219e2b7f833171bd24c6dd9802deb9eb7d0bafe",
            "patch": "@@ -1 +1,6 @@\n-# The manage.py of the {{ project_name }} test project\n\\ No newline at end of file\n+# The manage.py of the {{ project_name }} test project\n+\n+# template context:\n+project_name = '{{ project_name }}'\n+project_directory = '{{ project_directory }}'\n+secret_key = '{{ secret_key }}'"
        },
        {
            "sha": "669c6e82584b113b456448d2ab7c13019c141641",
            "filename": "tests/regressiontests/admin_scripts/tests.py",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/django/django/blob/4219e2b7f833171bd24c6dd9802deb9eb7d0bafe/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/4219e2b7f833171bd24c6dd9802deb9eb7d0bafe/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Fadmin_scripts%2Ftests.py?ref=4219e2b7f833171bd24c6dd9802deb9eb7d0bafe",
            "patch": "@@ -1534,3 +1534,32 @@ def test_file_without_extension(self):\n             with open(os.path.join(base_path, f)) as fh:\n                 self.assertEqual(fh.read(),\n                     '# some file for customtestproject test project')\n+\n+    def test_custom_project_template_context_variables(self):\n+        \"Make sure template context variables are rendered with proper values\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template')\n+        args = ['startproject', '--template', template_path, 'another_project', 'project_dir']\n+        testproject_dir = os.path.join(test_dir, 'project_dir')\n+        os.mkdir(testproject_dir)\n+        out, err = self.run_django_admin(args)\n+        self.addCleanup(shutil.rmtree, testproject_dir)\n+        self.assertNoOutput(err)\n+        test_manage_py = os.path.join(testproject_dir, 'manage.py')\n+        with open(test_manage_py, 'r') as fp:\n+            content = fp.read()\n+            self.assertIn(\"project_name = 'another_project'\", content)\n+            self.assertIn(\"project_directory = '%s'\" % testproject_dir, content)\n+\n+    def test_custom_project_destination_missing(self):\n+        \"\"\"\n+        Make sure an exception is raised when the provided\n+        destination directory doesn't exist\n+        \"\"\"\n+        template_path = os.path.join(test_dir, 'admin_scripts', 'custom_templates', 'project_template')\n+        args = ['startproject', '--template', template_path, 'yet_another_project', 'project_dir2']\n+        testproject_dir = os.path.join(test_dir, 'project_dir2')\n+        out, err = self.run_django_admin(args)\n+        self.assertNoOutput(out)\n+        self.assertOutput(err, \"Destination directory '%s' does not exist, please create it first.\" % testproject_dir)\n+        self.assertFalse(os.path.exists(testproject_dir))\n+"
        }
    ],
    "stats": {
        "total": 45,
        "additions": 41,
        "deletions": 4
    }
}