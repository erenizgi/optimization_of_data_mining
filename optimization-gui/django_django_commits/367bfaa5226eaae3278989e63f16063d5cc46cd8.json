{
    "author": "apollo13",
    "message": "Don't swallow AttributeError in core.urlresolvers.get_callable.",
    "sha": "367bfaa5226eaae3278989e63f16063d5cc46cd8",
    "files": [
        {
            "sha": "b83f2f51b05b297fa3e1bb027d2dbdd6376c3cff",
            "filename": "django/core/urlresolvers.py",
            "status": "modified",
            "additions": 16,
            "deletions": 11,
            "changes": 27,
            "blob_url": "https://github.com/django/django/blob/367bfaa5226eaae3278989e63f16063d5cc46cd8/django%2Fcore%2Furlresolvers.py",
            "raw_url": "https://github.com/django/django/raw/367bfaa5226eaae3278989e63f16063d5cc46cd8/django%2Fcore%2Furlresolvers.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/django%2Fcore%2Furlresolvers.py?ref=367bfaa5226eaae3278989e63f16063d5cc46cd8",
            "patch": "@@ -89,18 +89,11 @@ def get_callable(lookup_view, can_fail=False):\n     \"\"\"\n     if not callable(lookup_view):\n         mod_name, func_name = get_mod_func(lookup_view)\n+        if func_name == '':\n+            return lookup_view\n+\n         try:\n-            if func_name != '':\n-                lookup_view = getattr(import_module(mod_name), func_name)\n-                if not callable(lookup_view):\n-                    raise ViewDoesNotExist(\n-                        \"Could not import %s.%s. View is not callable.\" %\n-                        (mod_name, func_name))\n-        except AttributeError:\n-            if not can_fail:\n-                raise ViewDoesNotExist(\n-                    \"Could not import %s. View does not exist in module %s.\" %\n-                    (lookup_view, mod_name))\n+            mod = import_module(mod_name)\n         except ImportError:\n             parentmod, submod = get_mod_func(mod_name)\n             if (not can_fail and submod != '' and\n@@ -110,6 +103,18 @@ def get_callable(lookup_view, can_fail=False):\n                     (lookup_view, mod_name))\n             if not can_fail:\n                 raise\n+        else:\n+            try:\n+                lookup_view = getattr(mod, func_name)\n+                if not callable(lookup_view):\n+                    raise ViewDoesNotExist(\n+                        \"Could not import %s.%s. View is not callable.\" %\n+                        (mod_name, func_name))\n+            except AttributeError:\n+                if not can_fail:\n+                    raise ViewDoesNotExist(\n+                        \"Could not import %s. View does not exist in module %s.\" %\n+                        (lookup_view, mod_name))\n     return lookup_view\n get_callable = memoize(get_callable, _callable_cache, 1)\n "
        },
        {
            "sha": "b9c64183e5b6729c1ba0d675e2f6629ba8f3bbf5",
            "filename": "tests/regressiontests/urlpatterns_reverse/tests.py",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/django/django/blob/367bfaa5226eaae3278989e63f16063d5cc46cd8/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py",
            "raw_url": "https://github.com/django/django/raw/367bfaa5226eaae3278989e63f16063d5cc46cd8/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Furlpatterns_reverse%2Ftests.py?ref=367bfaa5226eaae3278989e63f16063d5cc46cd8",
            "patch": "@@ -5,8 +5,9 @@\n \n from django.conf import settings\n from django.core.exceptions import ImproperlyConfigured, ViewDoesNotExist\n-from django.core.urlresolvers import (reverse, resolve, NoReverseMatch,\n-    Resolver404, ResolverMatch, RegexURLResolver, RegexURLPattern)\n+from django.core.urlresolvers import (reverse, resolve, get_callable,\n+    NoReverseMatch, Resolver404, ResolverMatch, RegexURLResolver,\n+    RegexURLPattern)\n from django.http import HttpResponseRedirect, HttpResponsePermanentRedirect\n from django.shortcuts import redirect\n from django.test import TestCase\n@@ -519,3 +520,16 @@ def test_erroneous_reverse(self):\n         \"\"\"\n         # The regex error will be hit before NoReverseMatch can be raised\n         self.assertRaises(ImproperlyConfigured, reverse, 'whatever blah blah')\n+\n+class ViewLoadingTests(TestCase):\n+    def test_view_loading(self):\n+        # A missing view (identified by an AttributeError) should raise\n+        # ViewDoesNotExist, ...\n+        self.assertRaisesRegexp(ViewDoesNotExist, \".*View does not exist in.*\",\n+            get_callable,\n+            'regressiontests.urlpatterns_reverse.views.i_should_not_exist')\n+        # ... but if the AttributeError is caused by something else don't\n+        # swallow it.\n+        self.assertRaises(AttributeError, get_callable,\n+            'regressiontests.urlpatterns_reverse.views_broken.i_am_broken')\n+"
        },
        {
            "sha": "4953aab2397693819d716325439ecec28d7d044b",
            "filename": "tests/regressiontests/urlpatterns_reverse/views_broken.py",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/django/django/blob/367bfaa5226eaae3278989e63f16063d5cc46cd8/tests%2Fregressiontests%2Furlpatterns_reverse%2Fviews_broken.py",
            "raw_url": "https://github.com/django/django/raw/367bfaa5226eaae3278989e63f16063d5cc46cd8/tests%2Fregressiontests%2Furlpatterns_reverse%2Fviews_broken.py",
            "contents_url": "https://api.github.com/repos/django/django/contents/tests%2Fregressiontests%2Furlpatterns_reverse%2Fviews_broken.py?ref=367bfaa5226eaae3278989e63f16063d5cc46cd8",
            "patch": "@@ -0,0 +1,2 @@\n+# I just raise an AttributeError to confuse the view loading mechanism\n+raise AttributeError('I am here to confuse django.core.urlresolvers.get_callable')"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 34,
        "deletions": 13
    }
}