{
    "author": "teamclouday",
    "message": "Add revision to trainer push_to_hub (#33482)\n\n* add revision to trainer push_to_hub\r\n\r\n* apply suggestions\r\n\r\n* add test for revision\r\n\r\n* apply ruff format\r\n\r\n* reorganize imports\r\n\r\n* change test trainer path",
    "sha": "6c051b4e1ebd4464e6cb50bc320fd7a873151faf",
    "files": [
        {
            "sha": "e0a49ee5795e040776a7e501a5fcf9a435d835a4",
            "filename": "src/transformers/trainer.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/6c051b4e1ebd4464e6cb50bc320fd7a873151faf/src%2Ftransformers%2Ftrainer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/6c051b4e1ebd4464e6cb50bc320fd7a873151faf/src%2Ftransformers%2Ftrainer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftrainer.py?ref=6c051b4e1ebd4464e6cb50bc320fd7a873151faf",
            "patch": "@@ -4461,6 +4461,7 @@ def push_to_hub(\n         commit_message: Optional[str] = \"End of training\",\n         blocking: bool = True,\n         token: Optional[str] = None,\n+        revision: Optional[str] = None,\n         **kwargs,\n     ) -> str:\n         \"\"\"\n@@ -4473,6 +4474,8 @@ def push_to_hub(\n                 Whether the function should return only when the `git push` has finished.\n             token (`str`, *optional*, defaults to `None`):\n                 Token with write permission to overwrite Trainer's original args.\n+            revision (`str`, *optional*):\n+                The git revision to commit from. Defaults to the head of the \"main\" branch.\n             kwargs (`Dict[str, Any]`, *optional*):\n                 Additional keyword arguments passed along to [`~Trainer.create_model_card`].\n \n@@ -4526,6 +4529,7 @@ def push_to_hub(\n             token=token,\n             run_as_future=not blocking,\n             ignore_patterns=[\"_*\", f\"{PREFIX_CHECKPOINT_DIR}-*\"],\n+            revision=revision,\n         )\n \n     #"
        },
        {
            "sha": "c5f8b6169fcfd2407ca082a8367de56f6e3afb51",
            "filename": "tests/trainer/test_trainer.py",
            "status": "modified",
            "additions": 20,
            "deletions": 1,
            "changes": 21,
            "blob_url": "https://github.com/huggingface/transformers/blob/6c051b4e1ebd4464e6cb50bc320fd7a873151faf/tests%2Ftrainer%2Ftest_trainer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/6c051b4e1ebd4464e6cb50bc320fd7a873151faf/tests%2Ftrainer%2Ftest_trainer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Ftrainer%2Ftest_trainer.py?ref=6c051b4e1ebd4464e6cb50bc320fd7a873151faf",
            "patch": "@@ -31,7 +31,7 @@\n from unittest.mock import Mock, patch\n \n import numpy as np\n-from huggingface_hub import HfFolder, ModelCard, delete_repo, list_repo_commits, list_repo_files\n+from huggingface_hub import HfFolder, ModelCard, create_branch, delete_repo, list_repo_commits, list_repo_files\n from parameterized import parameterized\n from requests.exceptions import HTTPError\n \n@@ -3933,6 +3933,25 @@ def test_push_to_hub_tags(self):\n             model_card = ModelCard.load(repo_name)\n             self.assertTrue(\"test-trainer-tags\" in model_card.data.tags)\n \n+    def test_push_to_hub_with_revision(self):\n+        # Checks if `trainer.push_to_hub()` works correctly by adding revision\n+        with tempfile.TemporaryDirectory() as tmp_dir:\n+            trainer = get_regression_trainer(\n+                output_dir=os.path.join(tmp_dir, \"test-trainer-revision\"),\n+                push_to_hub=True,\n+                hub_token=self._token,\n+            )\n+            branch = \"v1.0\"\n+            create_branch(repo_id=trainer.hub_model_id, branch=branch, token=self._token, exist_ok=True)\n+            url = trainer.push_to_hub(revision=branch)\n+\n+            # Extract branch from the url\n+            re_search = re.search(r\"tree/([^/]+)/\", url)\n+            self.assertIsNotNone(re_search)\n+\n+            branch_name = re_search.groups()[0]\n+            self.assertEqual(branch_name, branch)\n+\n \n @require_torch\n @require_optuna"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 24,
        "deletions": 1
    }
}