{
    "author": "ydshieh",
    "message": "Reduce CircleCI usage (#35355)\n\n* reduce 1\r\n\r\n* reduce 1\r\n\r\n---------\r\n\r\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "b5a557e5fe2d015bd36214a95878370eaed51571",
    "files": [
        {
            "sha": "71c75dac2ff0536380661b8ae9021c1b6d078838",
            "filename": ".circleci/create_circleci_config.py",
            "status": "modified",
            "additions": 9,
            "deletions": 14,
            "changes": 23,
            "blob_url": "https://github.com/huggingface/transformers/blob/b5a557e5fe2d015bd36214a95878370eaed51571/.circleci%2Fcreate_circleci_config.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/b5a557e5fe2d015bd36214a95878370eaed51571/.circleci%2Fcreate_circleci_config.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.circleci%2Fcreate_circleci_config.py?ref=b5a557e5fe2d015bd36214a95878370eaed51571",
            "patch": "@@ -55,6 +55,7 @@ def to_dict(self):\n \n         return {\n             \"docker\": copy.deepcopy(DEFAULT_DOCKER_IMAGE),\n+            \"resource_class\": \"small\",\n             \"steps\": steps,\n         }\n \n@@ -67,9 +68,9 @@ class CircleCIJob:\n     install_steps: List[str] = None\n     marker: Optional[str] = None\n     parallelism: Optional[int] = 0\n-    pytest_num_workers: int = 12\n+    pytest_num_workers: int = 8\n     pytest_options: Dict[str, Any] = None\n-    resource_class: Optional[str] = \"2xlarge\"\n+    resource_class: Optional[str] = \"xlarge\"\n     tests_to_run: Optional[List[str]] = None\n     num_test_files_per_worker: Optional[int] = 10\n     # This should be only used for doctest job!\n@@ -198,44 +199,40 @@ def job_name(self):\n     docker_image=[{\"image\": \"huggingface/transformers-torch-light\"}],\n     marker=\"not generate\",\n     parallelism=6,\n-    pytest_num_workers=8\n )\n \n generate_job = CircleCIJob(\n     \"generate\",\n     docker_image=[{\"image\": \"huggingface/transformers-torch-light\"}],\n     marker=\"generate\",\n     parallelism=6,\n-    pytest_num_workers=8\n )\n \n tokenization_job = CircleCIJob(\n     \"tokenization\",\n     docker_image=[{\"image\": \"huggingface/transformers-torch-light\"}],\n     parallelism=8,\n-    pytest_num_workers=16\n )\n \n processor_job = CircleCIJob(\n     \"processors\",\n     docker_image=[{\"image\": \"huggingface/transformers-torch-light\"}],\n     parallelism=8,\n-    pytest_num_workers=6\n )\n \n tf_job = CircleCIJob(\n     \"tf\",\n     docker_image=[{\"image\":\"huggingface/transformers-tf-light\"}],\n     parallelism=6,\n-    pytest_num_workers=16,\n )\n \n \n flax_job = CircleCIJob(\n     \"flax\",\n     docker_image=[{\"image\":\"huggingface/transformers-jax-light\"}],\n     parallelism=6,\n-    pytest_num_workers=16\n+    pytest_num_workers=16,\n+    resource_class=\"2xlarge\",\n )\n \n \n@@ -244,7 +241,7 @@ def job_name(self):\n     additional_env={\"RUN_PIPELINE_TESTS\": True},\n     docker_image=[{\"image\":\"huggingface/transformers-torch-light\"}],\n     marker=\"is_pipeline_test\",\n-    parallelism=4\n+    parallelism=4,\n )\n \n \n@@ -253,7 +250,7 @@ def job_name(self):\n     additional_env={\"RUN_PIPELINE_TESTS\": True},\n     docker_image=[{\"image\":\"huggingface/transformers-tf-light\"}],\n     marker=\"is_pipeline_test\",\n-    parallelism=4\n+    parallelism=4,\n )\n \n \n@@ -270,15 +267,13 @@ def job_name(self):\n     docker_image=[{\"image\":\"huggingface/transformers-examples-torch\"}],\n     # TODO @ArthurZucker remove this once docker is easier to build\n     install_steps=[\"uv venv && uv pip install . && uv pip install -r examples/pytorch/_tests_requirements.txt\"],\n-    pytest_num_workers=8,\n )\n \n \n examples_tensorflow_job = CircleCIJob(\n     \"examples_tensorflow\",\n     additional_env={\"OMP_NUM_THREADS\": 8},\n     docker_image=[{\"image\":\"huggingface/transformers-examples-tf\"}],\n-    pytest_num_workers=16,\n )\n \n \n@@ -293,6 +288,7 @@ def job_name(self):\n     ],\n     marker=\"is_staging_test\",\n     pytest_num_workers=2,\n+    resource_class=\"medium\",\n )\n \n \n@@ -305,13 +301,13 @@ def job_name(self):\n     ],\n     pytest_options={\"k onnx\": None},\n     pytest_num_workers=1,\n+    resource_class=\"small\",\n )\n \n \n exotic_models_job = CircleCIJob(\n     \"exotic_models\",\n     docker_image=[{\"image\":\"huggingface/transformers-exotic-models\"}],\n-    pytest_num_workers=12,\n     parallelism=4,\n     pytest_options={\"durations\": 100},\n )\n@@ -330,7 +326,6 @@ def job_name(self):\n     docker_image=[{\"image\": \"huggingface/transformers-torch-light\"}],\n     marker=\"not generate\",\n     parallelism=6,\n-    pytest_num_workers=8,\n )\n \n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 9,
        "deletions": 14
    }
}