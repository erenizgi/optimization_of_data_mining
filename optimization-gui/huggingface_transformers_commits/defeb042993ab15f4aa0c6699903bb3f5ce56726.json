{
    "author": "ydshieh",
    "message": "Fix CircleCI not triggered when PR is opened from a branch of `huggingface/transformers` (#38413)\n\nfix\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "defeb042993ab15f4aa0c6699903bb3f5ce56726",
    "files": [
        {
            "sha": "ef49dc7e023499e084f4a5810de4ea81f0e1ae99",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/defeb042993ab15f4aa0c6699903bb3f5ce56726/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/defeb042993ab15f4aa0c6699903bb3f5ce56726/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.circleci%2Fconfig.yml?ref=defeb042993ab15f4aa0c6699903bb3f5ce56726",
            "patch": "@@ -43,16 +43,6 @@ jobs:\n         parallelism: 1\n         steps:\n             - checkout\n-            - run: python3 utils/extract_pr_number_from_circleci.py > pr_number.txt\n-            - run: echo $(cat pr_number.txt)\n-            - run: if [[ \"$(cat pr_number.txt)\" == \"\" && \"$CIRCLE_BRANCH\" != \"main\" && \"$CIRCLE_BRANCH\" != *-release ]]; then echo \"Not a PR, not the main branch and not a release branch, skip test!\"; circleci-agent step halt; fi\n-            - run: 'curl -L -H \"Accept: application/vnd.github+json\" -H \"X-GitHub-Api-Version: 2022-11-28\" https://api.github.com/repos/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME/pulls/$(cat pr_number.txt) >> github.txt'\n-            - run: cat github.txt\n-            - run: (python3 -c 'import json; from datetime import datetime; fp = open(\"github.txt\"); data = json.load(fp); fp.close(); f = \"%Y-%m-%dT%H:%M:%SZ\"; created = datetime.strptime(data[\"created_at\"], f); updated = datetime.strptime(data[\"updated_at\"], f); s = (updated - created).total_seconds(); print(int(s))' || true) > elapsed.txt\n-            - run: if [ \"$(cat elapsed.txt)\" == \"\" ]; then echo 60 > elapsed.txt; fi\n-            - run: cat elapsed.txt\n-            - run: if [ \"$(cat elapsed.txt)\" -lt \"30\" ]; then echo \"PR is just opened, wait some actions from GitHub\"; sleep 30; fi\n-            - run: 'if grep -q \"\\\"draft\\\": true,\" github.txt; then echo \"draft mode, skip test!\"; circleci-agent step halt; fi'\n             - run: uv pip install -U -e .\n             - run: echo 'export \"GIT_COMMIT_MESSAGE=$(git show -s --format=%s)\"' >> \"$BASH_ENV\" && source \"$BASH_ENV\"\n             - run: mkdir -p test_preparation"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 0,
        "deletions": 10
    }
}