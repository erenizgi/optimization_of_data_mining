{
    "author": "gante",
    "message": "[generate] clarify docstrings: when to inherit `GenerationMixin` (#36605)",
    "sha": "b47d9b2f8a75127f5bae4e1e430d0103b262b2e9",
    "files": [
        {
            "sha": "aa6c8fb20397583263df4d481a20245ad62cfe94",
            "filename": "src/transformers/generation/utils.py",
            "status": "modified",
            "additions": 16,
            "deletions": 1,
            "changes": 17,
            "blob_url": "https://github.com/huggingface/transformers/blob/b47d9b2f8a75127f5bae4e1e430d0103b262b2e9/src%2Ftransformers%2Fgeneration%2Futils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/b47d9b2f8a75127f5bae4e1e430d0103b262b2e9/src%2Ftransformers%2Fgeneration%2Futils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fgeneration%2Futils.py?ref=b47d9b2f8a75127f5bae4e1e430d0103b262b2e9",
            "patch": "@@ -343,7 +343,22 @@ class GenerateBeamEncoderDecoderOutput(ModelOutput):\n \n class GenerationMixin:\n     \"\"\"\n-    A class containing all functions for auto-regressive text generation, to be used as a mixin in [`PreTrainedModel`].\n+    A class containing all functions for auto-regressive text generation, to be used as a mixin in model classes.\n+    Inheriting from this class causes the model to have special generation-related behavior, such as loading a\n+    `GenerationConfig` at initialization time or ensuring `generate`-related tests are run in `transformers` CI.\n+\n+    A model class should inherit from `GenerationMixin` to enable calling methods like `generate`, or when it\n+    has defined a custom `generate` method that relies on `GenerationMixin`, directly or indirectly, which\n+    approximately shares the same interface to public methods like `generate`. Three examples:\n+        - `LlamaForCausalLM` should inherit from `GenerationMixin` to enable calling `generate` and other public\n+            methods in the mixin;\n+        - `BlipForQuestionAnswering` has a custom `generate` method that approximately shares the same interface as\n+           `GenerationMixin.generate` (it has a few extra arguments, and the same output). That function also calls\n+           `GenerationMixin.generate` indirectly, through an inner model. As such, `BlipForQuestionAnswering` should\n+           inherit from `GenerationMixin` to benefit from all generation-related automation in our codebase;\n+        - `BarkModel` has a custom `generate` method and one of its inner models calls `GenerationMixin.generate`.\n+            However, its `generate` does not share the same interface as `GenerationMixin.generate`. In this case,\n+            `BarkModel` shoud NOT inherit from `GenerationMixin`, as it breaks the `generate` interface.\n \n     The class exposes [`~generation.GenerationMixin.generate`], which can be used for:\n         - *greedy decoding* if `num_beams=1` and `do_sample=False`"
        },
        {
            "sha": "a4b13ca0f26816817054dc20390bf9e461d1502b",
            "filename": "src/transformers/modeling_utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/huggingface/transformers/blob/b47d9b2f8a75127f5bae4e1e430d0103b262b2e9/src%2Ftransformers%2Fmodeling_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/b47d9b2f8a75127f5bae4e1e430d0103b262b2e9/src%2Ftransformers%2Fmodeling_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodeling_utils.py?ref=b47d9b2f8a75127f5bae4e1e430d0103b262b2e9",
            "patch": "@@ -2178,6 +2178,9 @@ def can_generate(cls) -> bool:\n         \"\"\"\n         Returns whether this model can generate sequences with `.generate()` from the `GenerationMixin`.\n \n+        Under the hood, on classes where this function returns True, some generation-specific changes are triggered:\n+        for instance, the model instance will have a populated `generation_config` attribute.\n+\n         Returns:\n             `bool`: Whether this model can generate sequences with `.generate()`.\n         \"\"\""
        }
    ],
    "stats": {
        "total": 20,
        "additions": 19,
        "deletions": 1
    }
}