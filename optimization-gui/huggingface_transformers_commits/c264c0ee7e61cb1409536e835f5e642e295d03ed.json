{
    "author": "namgyu-youn",
    "message": "add general hub test for Fast Image Processors in test_image_processing_utils (#40086)\n\n* build unittest for ViTImageProcessorFast\n\n* remove redundant test case\n\n---------\n\nCo-authored-by: Yoni Gozlan <74535834+yonigozlan@users.noreply.github.com>",
    "sha": "c264c0ee7e61cb1409536e835f5e642e295d03ed",
    "files": [
        {
            "sha": "ea8c06fa9930f2bd9acc5a04e5ba7fb91e9be851",
            "filename": "tests/utils/test_image_processing_utils.py",
            "status": "modified",
            "additions": 44,
            "deletions": 1,
            "changes": 45,
            "blob_url": "https://github.com/huggingface/transformers/blob/c264c0ee7e61cb1409536e835f5e642e295d03ed/tests%2Futils%2Ftest_image_processing_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/c264c0ee7e61cb1409536e835f5e642e295d03ed/tests%2Futils%2Ftest_image_processing_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Futils%2Ftest_image_processing_utils.py?ref=c264c0ee7e61cb1409536e835f5e642e295d03ed",
            "patch": "@@ -21,7 +21,7 @@\n from huggingface_hub import HfFolder\n from requests.exceptions import HTTPError\n \n-from transformers import AutoImageProcessor, ViTImageProcessor\n+from transformers import AutoImageProcessor, ViTImageProcessor, ViTImageProcessorFast\n from transformers.image_processing_utils import get_size_dict\n from transformers.testing_utils import TOKEN, TemporaryHubRepo, get_tests_dir, is_staging_test\n \n@@ -45,9 +45,12 @@ def test_cached_files_are_used_when_internet_is_down(self):\n \n         # Download this model to make sure it's in the cache.\n         _ = ViTImageProcessor.from_pretrained(\"hf-internal-testing/tiny-random-vit\")\n+        _ = ViTImageProcessorFast.from_pretrained(\"hf-internal-testing/tiny-random-vit\")\n+\n         # Under the mock environment we get a 500 error when trying to reach the model.\n         with mock.patch(\"requests.Session.request\", return_value=response_mock) as mock_head:\n             _ = ViTImageProcessor.from_pretrained(\"hf-internal-testing/tiny-random-vit\")\n+            _ = ViTImageProcessorFast.from_pretrained(\"hf-internal-testing/tiny-random-vit\")\n             # This check we did call the fake head request\n             mock_head.assert_called()\n \n@@ -79,6 +82,15 @@ def test_push_to_hub(self):\n             for k, v in image_processor.__dict__.items():\n                 self.assertEqual(v, getattr(new_image_processor, k))\n \n+    def test_push_to_hub_fast(self):\n+        with TemporaryHubRepo(token=self._token) as tmp_repo:\n+            image_processor = ViTImageProcessorFast.from_pretrained(SAMPLE_IMAGE_PROCESSING_CONFIG_DIR)\n+            image_processor.push_to_hub(tmp_repo.repo_id, token=self._token)\n+\n+            new_image_processor = ViTImageProcessorFast.from_pretrained(tmp_repo.repo_id)\n+            for k, v in image_processor.__dict__.items():\n+                self.assertEqual(v, getattr(new_image_processor, k))\n+\n     def test_push_to_hub_via_save_pretrained(self):\n         with TemporaryHubRepo(token=self._token) as tmp_repo:\n             image_processor = ViTImageProcessor.from_pretrained(SAMPLE_IMAGE_PROCESSING_CONFIG_DIR)\n@@ -90,6 +102,17 @@ def test_push_to_hub_via_save_pretrained(self):\n             for k, v in image_processor.__dict__.items():\n                 self.assertEqual(v, getattr(new_image_processor, k))\n \n+    def test_push_to_hub_via_save_pretrained_fast(self):\n+        with TemporaryHubRepo(token=self._token) as tmp_repo:\n+            image_processor = ViTImageProcessorFast.from_pretrained(SAMPLE_IMAGE_PROCESSING_CONFIG_DIR)\n+            # Push to hub via save_pretrained\n+            with tempfile.TemporaryDirectory() as tmp_dir:\n+                image_processor.save_pretrained(tmp_dir, repo_id=tmp_repo.repo_id, push_to_hub=True, token=self._token)\n+\n+            new_image_processor = ViTImageProcessorFast.from_pretrained(tmp_repo.repo_id)\n+            for k, v in image_processor.__dict__.items():\n+                self.assertEqual(v, getattr(new_image_processor, k))\n+\n     def test_push_to_hub_in_organization(self):\n         with TemporaryHubRepo(namespace=\"valid_org\", token=self._token) as tmp_repo:\n             image_processor = ViTImageProcessor.from_pretrained(SAMPLE_IMAGE_PROCESSING_CONFIG_DIR)\n@@ -99,6 +122,15 @@ def test_push_to_hub_in_organization(self):\n             for k, v in image_processor.__dict__.items():\n                 self.assertEqual(v, getattr(new_image_processor, k))\n \n+    def test_push_to_hub_in_organization_fast(self):\n+        with TemporaryHubRepo(namespace=\"valid_org\", token=self._token) as tmp_repo:\n+            image_processor = ViTImageProcessorFast.from_pretrained(SAMPLE_IMAGE_PROCESSING_CONFIG_DIR)\n+            image_processor.push_to_hub(tmp_repo.repo_id, token=self._token)\n+\n+            new_image_processor = ViTImageProcessorFast.from_pretrained(tmp_repo.repo_id)\n+            for k, v in image_processor.__dict__.items():\n+                self.assertEqual(v, getattr(new_image_processor, k))\n+\n     def test_push_to_hub_in_organization_via_save_pretrained(self):\n         with TemporaryHubRepo(namespace=\"valid_org\", token=self._token) as tmp_repo:\n             image_processor = ViTImageProcessor.from_pretrained(SAMPLE_IMAGE_PROCESSING_CONFIG_DIR)\n@@ -110,6 +142,17 @@ def test_push_to_hub_in_organization_via_save_pretrained(self):\n             for k, v in image_processor.__dict__.items():\n                 self.assertEqual(v, getattr(new_image_processor, k))\n \n+    def test_push_to_hub_in_organization_via_save_pretrained_fast(self):\n+        with TemporaryHubRepo(namespace=\"valid_org\", token=self._token) as tmp_repo:\n+            image_processor = ViTImageProcessorFast.from_pretrained(SAMPLE_IMAGE_PROCESSING_CONFIG_DIR)\n+            # Push to hub via save_pretrained\n+            with tempfile.TemporaryDirectory() as tmp_dir:\n+                image_processor.save_pretrained(tmp_dir, repo_id=tmp_repo.repo_id, push_to_hub=True, token=self._token)\n+\n+            new_image_processor = ViTImageProcessorFast.from_pretrained(tmp_repo.repo_id)\n+            for k, v in image_processor.__dict__.items():\n+                self.assertEqual(v, getattr(new_image_processor, k))\n+\n     def test_push_to_hub_dynamic_image_processor(self):\n         with TemporaryHubRepo(token=self._token) as tmp_repo:\n             CustomImageProcessor.register_for_auto_class()"
        }
    ],
    "stats": {
        "total": 45,
        "additions": 44,
        "deletions": 1
    }
}