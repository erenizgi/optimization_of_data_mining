{
    "author": "ydshieh",
    "message": "Allow send `SSH into runner` info. to DM (#33346)\n\nallow send DM\r\n\r\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "e6889961761eba27ac13a30aa12444a6f4406f78",
    "files": [
        {
            "sha": "b433abb484fac47d705bbe4e3bf69bffd8abfbf6",
            "filename": ".github/workflows/ssh-runner.yml",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/huggingface/transformers/blob/e6889961761eba27ac13a30aa12444a6f4406f78/.github%2Fworkflows%2Fssh-runner.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/e6889961761eba27ac13a30aa12444a6f4406f78/.github%2Fworkflows%2Fssh-runner.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Fssh-runner.yml?ref=e6889961761eba27ac13a30aa12444a6f4406f78",
            "patch": "@@ -53,12 +53,22 @@ jobs:\n       - name: NVIDIA-SMI\n         run: |\n           nvidia-smi\n-      \n+\n+      - name: Store Slack infos\n+        #because the SSH can be enabled dynamically if the workflow failed, so we need to store slack infos to be able to retrieve them during the waitforssh step\n+        shell: bash\n+        run: |\n+          if [ \"${{ secrets[format('{0}_{1}', github.actor, 'SLACK_ID')] }}\" != \"\" ]; then\n+            echo \"SLACKCHANNEL=${{ secrets[format('{0}_{1}', github.actor, 'SLACK_ID')] }}\" >> $GITHUB_ENV\n+          else\n+            echo \"SLACKCHANNEL=${{ secrets.SLACK_CIFEEDBACK_CHANNEL }}\" >> $GITHUB_ENV\n+          fi\n+\n       - name: Tailscale # In order to be able to SSH when a test fails\n         uses: huggingface/tailscale-action@main\n         with:\n           authkey: ${{ secrets.TAILSCALE_SSH_AUTHKEY }}\n-          slackChannel: ${{ secrets.SLACK_CIFEEDBACK_CHANNEL }}\n+          slackChannel: ${{ env.SLACKCHANNEL }}\n           slackToken: ${{ secrets.SLACK_CIFEEDBACK_BOT_TOKEN }}\n           waitForSSH: true\n           sshTimeout: 15m"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 12,
        "deletions": 2
    }
}