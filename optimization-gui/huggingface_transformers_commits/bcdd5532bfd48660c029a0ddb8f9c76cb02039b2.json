{
    "author": "cyyever",
    "message": "Use regex defailed flags (#41264)\n\nSigned-off-by: Yuanyuan Chen <cyyever@outlook.com>",
    "sha": "bcdd5532bfd48660c029a0ddb8f9c76cb02039b2",
    "files": [
        {
            "sha": "afcce5b74bf8dd4a79e8224d1e7d006bf9d6cf26",
            "filename": "src/transformers/models/fsmt/convert_fsmt_original_pytorch_checkpoint_to_pytorch.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/bcdd5532bfd48660c029a0ddb8f9c76cb02039b2/src%2Ftransformers%2Fmodels%2Ffsmt%2Fconvert_fsmt_original_pytorch_checkpoint_to_pytorch.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/bcdd5532bfd48660c029a0ddb8f9c76cb02039b2/src%2Ftransformers%2Fmodels%2Ffsmt%2Fconvert_fsmt_original_pytorch_checkpoint_to_pytorch.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Ffsmt%2Fconvert_fsmt_original_pytorch_checkpoint_to_pytorch.py?ref=bcdd5532bfd48660c029a0ddb8f9c76cb02039b2",
            "patch": "@@ -155,7 +155,7 @@ def convert_fsmt_checkpoint_to_pytorch(fsmt_checkpoint_path, pytorch_dump_folder\n             break\n     with open(fsmt_merges_file, encoding=\"utf-8\") as fin:\n         merges = fin.read()\n-    merges = re.sub(r\" \\d+$\", \"\", merges, 0, re.M)  # remove frequency number\n+    merges = re.sub(r\" \\d+$\", \"\", merges, 0, re.MULTILINE)  # remove frequency number\n     print(f\"Generating {merges_file}\")\n     with open(merges_file, \"w\", encoding=\"utf-8\") as fout:\n         fout.write(merges)"
        },
        {
            "sha": "198da79302af5c1b18b0d87a977130ce19d828ce",
            "filename": "src/transformers/models/nougat/tokenization_nougat_fast.py",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/huggingface/transformers/blob/bcdd5532bfd48660c029a0ddb8f9c76cb02039b2/src%2Ftransformers%2Fmodels%2Fnougat%2Ftokenization_nougat_fast.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/bcdd5532bfd48660c029a0ddb8f9c76cb02039b2/src%2Ftransformers%2Fmodels%2Fnougat%2Ftokenization_nougat_fast.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fnougat%2Ftokenization_nougat_fast.py?ref=bcdd5532bfd48660c029a0ddb8f9c76cb02039b2",
            "patch": "@@ -68,15 +68,15 @@ def markdown_compatible(text: str) -> str:\n     \"\"\"\n     # equation tag\n     # Replace lines that start with a pattern like (decimal) \\[some text\\] with \\[[some text] \\tag{decimal}\\].\n-    text = re.sub(r\"^\\(([\\d.]+[a-zA-Z]?)\\) \\\\\\[(.+?)\\\\\\]$\", r\"\\[\\2 \\\\tag{\\1}\\]\", text, flags=re.M)\n+    text = re.sub(r\"^\\(([\\d.]+[a-zA-Z]?)\\) \\\\\\[(.+?)\\\\\\]$\", r\"\\[\\2 \\\\tag{\\1}\\]\", text, flags=re.MULTILINE)\n     # Replace lines that start with a pattern like \\[some text\\] (decimal)  with \\[[some text] \\tag{decimal}\\].\n-    text = re.sub(r\"^\\\\\\[(.+?)\\\\\\] \\(([\\d.]+[a-zA-Z]?)\\)$\", r\"\\[\\1 \\\\tag{\\2}\\]\", text, flags=re.M)\n+    text = re.sub(r\"^\\\\\\[(.+?)\\\\\\] \\(([\\d.]+[a-zA-Z]?)\\)$\", r\"\\[\\1 \\\\tag{\\2}\\]\", text, flags=re.MULTILINE)\n     # Replace lines that start with a pattern like \\[some text\\] (digits) \\[another text\\]  with \\[[some text] \\tag{digits}\\] [another text].\n     text = re.sub(\n         r\"^\\\\\\[(.+?)\\\\\\] \\(([\\d.]+[a-zA-Z]?)\\) (\\\\\\[.+?\\\\\\])$\",\n         r\"\\[\\1 \\\\tag{\\2}\\] \\3\",\n         text,\n-        flags=re.M,\n+        flags=re.MULTILINE,\n     )\n     # multi line\n     text = text.replace(r\"\\. \", \". \")\n@@ -90,7 +90,7 @@ def markdown_compatible(text: str) -> str:\n         text,\n     )\n     # algorithms\n-    text = re.sub(r\"```\\s*(.+?)\\s*```\", r\"```\\n\\1\\n```\", text, flags=re.S)\n+    text = re.sub(r\"```\\s*(.+?)\\s*```\", r\"```\\n\\1\\n```\", text, flags=re.DOTALL)\n \n     return text\n \n@@ -131,7 +131,7 @@ def normalize_list_like_lines(generation):\n             if not rest:\n                 continue\n             # Infer current nesting level based on detected numbering\n-            if re.match(r\"^[\\dixv]+((?:\\.[\\dixv])?)+$\", potential_numeral, flags=re.I | re.M):\n+            if re.match(r\"^[\\dixv]+((?:\\.[\\dixv])?)+$\", potential_numeral, flags=re.IGNORECASE | re.MULTILINE):\n                 level = potential_numeral.count(\".\")\n \n             replacement += (\n@@ -477,7 +477,7 @@ def correct_tables(self, generation: str) -> str:\n         generation = generation.replace(\"\\\\end{tabular} \\\\end{table}\", \"\\\\end{tabular}\\n\\\\end{table}\")\n         generation = generation.replace(\"\\\\end{table} Tab\", \"\\\\end{table}\\nTab\")\n \n-        generation = re.sub(r\"(^.+)\\\\begin{tab\", r\"\\1\\n\\\\begin{tab\", generation, flags=re.M)\n+        generation = re.sub(r\"(^.+)\\\\begin{tab\", r\"\\1\\n\\\\begin{tab\", generation, flags=re.MULTILINE)\n \n         # Remove left-aligned empty LaTeX tabular blocks.\n         generation = generation.replace(r\"\\begin{tabular}{l l}  & \\\\ \\end{tabular}\", \"\")\n@@ -505,7 +505,7 @@ def post_process_single(self, generation: str, fix_markdown: bool = True) -> str\n         generation = generation.replace(\"\\n* [leftmargin=*]\\n\", \"\\n\")\n         # Remove lines with markdown headings starting with #, with numerals,\n         # and possibly roman numerals with trailing spaces and newlines\n-        generation = re.sub(r\"^#+ (?:[\\d+\\.]+|[ixv\\.]+)?\\s*(?:$|\\n\\s*)\", \"\", generation, flags=re.M)\n+        generation = re.sub(r\"^#+ (?:[\\d+\\.]+|[ixv\\.]+)?\\s*(?:$|\\n\\s*)\", \"\", generation, flags=re.MULTILINE)\n         # most likely hallucinated titles\n         lines = generation.split(\"\\n\")\n         if lines[-1].startswith(\"#\") and lines[-1].lstrip(\"#\").startswith(\" \") and len(lines) > 1:\n@@ -516,9 +516,9 @@ def post_process_single(self, generation: str, fix_markdown: bool = True) -> str\n         # Reference corrections\n         generation = self.remove_hallucinated_references(generation)\n         # Remove lines starting with asterisks and numbers like \"*[1]\" and followed by capital letters and periods (ie too long references)\n-        generation = re.sub(r\"^\\* \\[\\d+\\](\\s?[A-W]\\.+\\s?){10,}.*$\", \"\", generation, flags=re.M)\n+        generation = re.sub(r\"^\\* \\[\\d+\\](\\s?[A-W]\\.+\\s?){10,}.*$\", \"\", generation, flags=re.MULTILINE)\n         # Remove empty brackets after a reference number in brackets. *[12][]ABC will become *[12]ABC\n-        generation = re.sub(r\"^(\\* \\[\\d+\\])\\[\\](.*)$\", r\"\\1\\2\", generation, flags=re.M)\n+        generation = re.sub(r\"^(\\* \\[\\d+\\])\\[\\](.*)$\", r\"\\1\\2\", generation, flags=re.MULTILINE)\n         # Remove single characters before or after 2 new lines\n         generation = re.sub(r\"(^\\w\\n\\n|\\n\\n\\w$)\", \"\", generation)\n         # pmc math artifact correction\n@@ -570,9 +570,9 @@ def post_process_single(self, generation: str, fix_markdown: bool = True) -> str\n         # Remove lines containing \"S.A.B.\" one or more times. Was included in Nougat's code.\n         generation = re.sub(r\"(\\*\\*S\\. A\\. B\\.\\*\\*\\n+){2,}\", \"\", generation)\n         # Remove markdown-style headers that are incomplete or empty on multiple lines.\n-        generation = re.sub(r\"^#+( [\\[\\d\\w])?$\", \"\", generation, flags=re.M)\n+        generation = re.sub(r\"^#+( [\\[\\d\\w])?$\", \"\", generation, flags=re.MULTILINE)\n         # Remove lines with just one period.\n-        generation = re.sub(r\"^\\.\\s*$\", \"\", generation, flags=re.M)\n+        generation = re.sub(r\"^\\.\\s*$\", \"\", generation, flags=re.MULTILINE)\n         # Replace instances of three or more newlines with just two newlines.\n         generation = re.sub(r\"\\n{3,}\", \"\\n\\n\", generation)\n         if fix_markdown:"
        },
        {
            "sha": "c480014e7ff9ad6dd4a92f11f8cf77d504d3aa58",
            "filename": "src/transformers/testing_utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/bcdd5532bfd48660c029a0ddb8f9c76cb02039b2/src%2Ftransformers%2Ftesting_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/bcdd5532bfd48660c029a0ddb8f9c76cb02039b2/src%2Ftransformers%2Ftesting_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftesting_utils.py?ref=bcdd5532bfd48660c029a0ddb8f9c76cb02039b2",
            "patch": "@@ -1599,7 +1599,7 @@ def evaluate_side_effect_factory(\n # final message\n # it can handle a single string or a multiline buffer\n def apply_print_resets(buf):\n-    return re.sub(r\"^.*\\r\", \"\", buf, 0, re.M)\n+    return re.sub(r\"^.*\\r\", \"\", buf, 0, re.MULTILINE)\n \n \n def assert_screenout(out, what):\n@@ -2316,7 +2316,7 @@ def summary_failures_short(tr):\n             msg = tr._getfailureheadline(rep)\n             tr.write_sep(\"_\", msg, red=True, bold=True)\n             # chop off the optional leading extra frames, leaving only the last one\n-            longrepr = re.sub(r\".*_ _ _ (_ ){10,}_ _ \", \"\", rep.longreprtext, 0, re.M | re.S)\n+            longrepr = re.sub(r\".*_ _ _ (_ ){10,}_ _ \", \"\", rep.longreprtext, 0, re.MULTILINE | re.DOTALL)\n             tr._tw.line(longrepr)\n             # note: not printing out any rep.sections to keep the report short\n \n@@ -2464,7 +2464,7 @@ def pytest_xdist_worker_id():\n     if `-n 1` or `pytest-xdist` isn't being used.\n     \"\"\"\n     worker = os.environ.get(\"PYTEST_XDIST_WORKER\", \"gw0\")\n-    worker = re.sub(r\"^gw\", \"\", worker, 0, re.M)\n+    worker = re.sub(r\"^gw\", \"\", worker, 0, re.MULTILINE)\n     return int(worker)\n \n "
        }
    ],
    "stats": {
        "total": 30,
        "additions": 15,
        "deletions": 15
    }
}