{
    "author": "manueldeprada",
    "message": "Add warning when failed to acquire other user's lock at model download (#37395)",
    "sha": "bc0150bb04ddda667e3dcf087b9d1d00db46bb12",
    "files": [
        {
            "sha": "594b470e2496537729fb5d0477124f90a64996d9",
            "filename": "src/transformers/utils/hub.py",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/huggingface/transformers/blob/bc0150bb04ddda667e3dcf087b9d1d00db46bb12/src%2Ftransformers%2Futils%2Fhub.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/bc0150bb04ddda667e3dcf087b9d1d00db46bb12/src%2Ftransformers%2Futils%2Fhub.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2Fhub.py?ref=bc0150bb04ddda667e3dcf087b9d1d00db46bb12",
            "patch": "@@ -465,6 +465,12 @@ def cached_files(\n                 \"for this model name. Check the model page at \"\n                 f\"'https://huggingface.co/{path_or_repo_id}' for available revisions.\"\n             ) from e\n+        elif isinstance(e, PermissionError):\n+            raise OSError(\n+                f\"PermissionError at {e.filename} when downloading {path_or_repo_id}. \"\n+                \"Check cache directory permissions. Common causes: 1) another user is downloading the same model (please wait); \"\n+                \"2) a previous download was canceled and the lock file needs manual removal.\"\n+            ) from e\n \n         # Now we try to recover if we can find all files correctly in the cache\n         resolved_files = [\n@@ -870,7 +876,7 @@ def push_to_hub(\n                 )\n             if os.path.isdir(repo_path_or_name):\n                 # repo_path: infer repo_id from the path\n-                repo_id = repo_id.split(os.path.sep)[-1]\n+                repo_id = repo_path_or_name.split(os.path.sep)[-1]\n                 working_dir = repo_id\n             else:\n                 # repo_name: use it as repo_id"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 7,
        "deletions": 1
    }
}