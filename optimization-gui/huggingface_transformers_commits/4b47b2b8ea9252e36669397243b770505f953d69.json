{
    "author": "giuseppeCoccia",
    "message": "Updated Switch Transformers model card with standardized format (Issue #36979) (#39305)\n\n* Updated Switch Transformers model card with standardized format (Issue #36979)\n\n* Apply reviewer suggestions to the new standardised Switch Transformer's model card\n\n* Update switch_transformers.md\n\n---------\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>",
    "sha": "4b47b2b8ea9252e36669397243b770505f953d69",
    "files": [
        {
            "sha": "842d67d3b98aad04482893917188c5e3d7a74aa0",
            "filename": "docs/source/en/model_doc/switch_transformers.md",
            "status": "modified",
            "additions": 73,
            "deletions": 18,
            "changes": 91,
            "blob_url": "https://github.com/huggingface/transformers/blob/4b47b2b8ea9252e36669397243b770505f953d69/docs%2Fsource%2Fen%2Fmodel_doc%2Fswitch_transformers.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/4b47b2b8ea9252e36669397243b770505f953d69/docs%2Fsource%2Fen%2Fmodel_doc%2Fswitch_transformers.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fswitch_transformers.md?ref=4b47b2b8ea9252e36669397243b770505f953d69",
            "patch": "@@ -14,35 +14,90 @@ rendered properly in your Markdown viewer.\n \n -->\n \n-# SwitchTransformers\n-\n-<div class=\"flex flex-wrap space-x-1\">\n-<img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+<div style=\"float: right;\">\n+    <div class=\"flex flex-wrap space-x-1\">\n+        <img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+    </div>\n </div>\n \n-## Overview\n+# Switch Transformers\n+\n+[Switch Transformers](https://huggingface.co/papers/2101.03961) is a sparse T5 model where the MLP layer is replaced by a Mixture-of-Experts (MoE). A routing mechanism associates each token with an expert and each expert is a dense MLP. Sparsity enables better scaling and the routing mechanism allows the model to select relevant weights on the fly which increases model capacity.\n+\n+You can find all the original Switch Transformers checkpoints under the [Switch Transformer](https://huggingface.co/collections/google/switch-transformers-release-6548c35c6507968374b56d1f) collection.\n+\n+\n+> [!TIP]\n+> This model was contributed by [ybelkada](https://huggingface.co/ybelkada) and [ArthurZ](https://huggingface.co/ArthurZ).\n+>\n+> Click on the Switch Transformers models in the right sidebar for more examples of how to apply Switch Transformers to different natural language tasks.\n+\n+The example below demonstrates how to predict the masked token with [`Pipeline`], [`AutoModel`], and from the command line.\n+\n+<hfoptions id=\"usage\">\n+<hfoption id=\"Pipeline\">\n+\n+```python\n+import torch\n+from transformers import pipeline\n+\n+pipeline = pipeline(\n+    task=\"text2text-generation\", \n+    model=\"google/switch-base-8\",\n+    torch_dtype=torch.float16,\n+    device=0\n+)\n+print(pipeline(\"The capital of France is <extra_id_0>.\"))\n+```\n+\n+</hfoption>\n+<hfoption id=\"AutoModel\">\n+\n+```python\n+import torch\n+from transformers import AutoModelForSeq2SeqLM, AutoTokenizer\n+\n+tokenizer = AutoTokenizer.from_pretrained(\"google/switch-base-8\")\n+model = AutoModelForSeq2SeqLM.from_pretrained(\"google/switch-base-8\", device_map=\"auto\", torch_dtype=torch.float16)\n+\n+input_text = \"The capital of France is <extra_id_0>.\"\n+input_ids = tokenizer(input_text, return_tensors=\"pt\").input_ids.to(0)\n+\n+outputs = model.generate(input_ids)\n+print(tokenizer.decode(outputs[0]))\n+```\n+\n+</hfoption>\n+<hfoption id=\"transformers CLI\">\n \n-The SwitchTransformers model was proposed in [Switch Transformers: Scaling to Trillion Parameter Models with Simple and Efficient Sparsity](https://huggingface.co/papers/2101.03961) by William Fedus, Barret Zoph, Noam Shazeer.\n+```bash\n+echo -e \"The capital of France is <extra_id_0>.\" | transformers run --task text2text-generation --model google/switch-base-8 --device 0\n+# [{'generated_text': 'Paris.'}]\n+```\n \n-The Switch Transformer model uses a sparse T5 encoder-decoder architecture, where the MLP are replaced by a Mixture of Experts (MoE). A routing mechanism (top 1 in this case) associates each token to one of the expert, where each expert is a dense MLP. While switch transformers have a lot more weights than their equivalent dense models, the sparsity allows better scaling and better finetuning performance at scale.\n-During a forward pass, only a fraction of the weights are used. The routing mechanism allows the model to select relevant weights on the fly which increases the model capacity without increasing the number of operations.\n+</hfoption>\n+</hfoptions>\n \n-The abstract from the paper is the following:\n+Quantization reduces the memory burden of large models by representing the weights in a lower precision. Refer to the [Quantization](../quantization/overview) overview for more available quantization backends.\n \n-*In deep learning, models typically reuse the same parameters for all inputs. Mixture of Experts (MoE) defies this and instead selects different parameters for each incoming example. The result is a sparsely-activated model -- with outrageous numbers of parameters -- but a constant computational cost. However, despite several notable successes of MoE, widespread adoption has been hindered by complexity, communication costs and training instability -- we address these with the Switch Transformer. We simplify the MoE routing algorithm and design intuitive improved models with reduced communication and computational costs. Our proposed training techniques help wrangle the instabilities and we show large sparse models may be trained, for the first time, with lower precision (bfloat16) formats. We design models based off T5-Base and T5-Large to obtain up to 7x increases in pre-training speed with the same computational resources. These improvements extend into multilingual settings where we measure gains over the mT5-Base version across all 101 languages. Finally, we advance the current scale of language models by pre-training up to trillion parameter models on the \"Colossal Clean Crawled Corpus\" and achieve a 4x speedup over the T5-XXL model.*\n+The example below uses [bitsandbytes](../quantization/bitsandbytes/) to only quantize the weights to 8-bits.\n \n-This model was contributed by [Younes Belkada](https://huggingface.co/ybelkada) and [Arthur Zucker](https://huggingface.co/ArthurZ).\n-The original code can be found [here](https://github.com/google/flaxformer/tree/main/flaxformer/architectures/moe).\n+```py\n+# pip install bitsandbytes\n+import torch\n+from transformers import AutoModelForSeq2SeqLM, AutoTokenizer, BitsAndBytesConfig\n \n-## Usage tips\n+tokenizer = AutoTokenizer.from_pretrained(\"google/switch-base-8\")\n+quantization_config = BitsAndBytesConfig(load_in_8bit=True)\n+model = AutoModelForSeq2SeqLM.from_pretrained(\"google/switch-base-8\", device_map=\"auto\", quantization_config=quantization_config)\n \n-- SwitchTransformers uses the [`T5Tokenizer`], which can be loaded directly from each model's repository.\n-- The released weights are pretrained on English [Masked Language Modeling](https://moon-ci-docs.huggingface.co/docs/transformers/pr_19323/en/glossary#general-terms) task, and should be finetuned.\n+input_text = \"The capital of France is <extra_id_0>.\"\n+input_ids = tokenizer(input_text, return_tensors=\"pt\").input_ids.to(0)\n \n-## Resources\n+outputs = model.generate(input_ids)\n+print(tokenizer.decode(outputs[0]))\n+```\n \n-- [Translation task guide](../tasks/translation)\n-- [Summarization task guide](../tasks/summarization)\n \n ## SwitchTransformersConfig\n "
        }
    ],
    "stats": {
        "total": 91,
        "additions": 73,
        "deletions": 18
    }
}