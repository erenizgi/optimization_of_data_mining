{
    "author": "ahadnagy",
    "message": "Qwen2.5-VL test fixes for ROCm (#40308)",
    "sha": "7f38068ae031b1b55696035e1dae8e881f593960",
    "files": [
        {
            "sha": "041fac903860545ccf8f08775705be8f2a9391ef",
            "filename": "tests/models/qwen2_5_vl/test_modeling_qwen2_5_vl.py",
            "status": "modified",
            "additions": 19,
            "deletions": 4,
            "changes": 23,
            "blob_url": "https://github.com/huggingface/transformers/blob/7f38068ae031b1b55696035e1dae8e881f593960/tests%2Fmodels%2Fqwen2_5_vl%2Ftest_modeling_qwen2_5_vl.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/7f38068ae031b1b55696035e1dae8e881f593960/tests%2Fmodels%2Fqwen2_5_vl%2Ftest_modeling_qwen2_5_vl.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fqwen2_5_vl%2Ftest_modeling_qwen2_5_vl.py?ref=7f38068ae031b1b55696035e1dae8e881f593960",
            "patch": "@@ -28,6 +28,7 @@\n     is_vision_available,\n )\n from transformers.testing_utils import (\n+    Expectations,\n     cleanup,\n     is_flaky,\n     require_cv2,\n@@ -592,10 +593,24 @@ def test_small_model_integration_test_batch_different_resolutions(self):\n         # it should not matter whether two images are the same size or not\n         output = model.generate(**inputs, max_new_tokens=30)\n \n-        EXPECTED_DECODED_TEXT = [\n-            \"system\\nYou are a helpful assistant.\\nuser\\nWhat kind of dog is this?\\nassistant\\nThe dog in the picture appears to be a Labrador Retriever. Labradors are known for their friendly and energetic nature, which is evident in\",\n-            \"system\\nYou are a helpful assistant.\\nuser\\nWhat kind of dog is this?\\nassistant\\n addCriterion\\nThe dog in the picture appears to be a Labrador Retriever. Labradors are known for their friendly and gentle nature, which is\",\n-        ]\n+        EXPECTED_DECODED_TEXTS = Expectations(\n+            {\n+                (None, None): [\n+                    \"system\\nYou are a helpful assistant.\\nuser\\nWhat kind of dog is this?\\nassistant\\nThe dog in the picture appears to be a Labrador Retriever. Labradors are known for their friendly and energetic nature, which is evident in\",\n+                    \"system\\nYou are a helpful assistant.\\nuser\\nWhat kind of dog is this?\\nassistant\\n addCriterion\\nThe dog in the picture appears to be a Labrador Retriever. Labradors are known for their friendly and gentle nature, which is\",\n+                ],\n+                (\"cuda\", None): [\n+                    'system\\nYou are a helpful assistant.\\nuser\\nWhat kind of dog is this?\\nassistant\\nThe dog in the picture appears to be a Labrador Retriever. Labradors are known for their friendly and energetic nature, which is evident in',\n+                    'system\\nYou are a helpful assistant.\\nuser\\nWhat kind of dog is this?\\nassistant\\n addCriterion\\n addCriterion\\n\\n addCriterion\\n\\n addCriterion\\n\\n addCriterion\\n\\n\\n addCriterion\\n\\n addCriterion\\n\\n addCriterion\\n',\n+                ],\n+                (\"rocm\", None): [\n+                    'system\\nYou are a helpful assistant.\\nuser\\nWhat kind of dog is this?\\nassistant\\nThe dog in the picture appears to be a Labrador Retriever. Labradors are known for their friendly and energetic nature, which is evident in',\n+                    'system\\nYou are a helpful assistant.\\nuser\\nWhat kind of dog is this?\\nassistant\\n addCriterion\\n addCriterion\\n\\n addCriterion\\n\\n addCriterion\\n\\n addCriterion\\n\\n\\n addCriterion\\n\\n addCriterion\\n\\n addCriterion\\n'\n+                ],\n+            }\n+        )  # fmt: skip\n+\n+        EXPECTED_DECODED_TEXT = EXPECTED_DECODED_TEXTS.get_expectation()\n \n         self.assertEqual(\n             self.processor.batch_decode(output, skip_special_tokens=True),"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 19,
        "deletions": 4
    }
}