{
    "author": "EmileAydar",
    "message": "Update altCLIP model card (#38306)\n\n* Update altclip.md\n\n* Update altclip.md\n\n* Update altclip.md\n\n* Update altclip.md\n\n* Update altclip.md\n\n* Update altclip.md\n\n* Rename altclip.md to altclip.mdx\n\n* Rename altclip.mdx to altclip.md\n\n* Update altclip.md\n\n* Update altclip.md\n\n* Update altclip.md\n\n---------\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>",
    "sha": "32dbf4bddbffa577b4d9b72b94000f7a7b51db2a",
    "files": [
        {
            "sha": "14d341764abd64076f2b814f8dc19acff265c33a",
            "filename": "docs/source/en/model_doc/altclip.md",
            "status": "modified",
            "additions": 64,
            "deletions": 60,
            "changes": 124,
            "blob_url": "https://github.com/huggingface/transformers/blob/32dbf4bddbffa577b4d9b72b94000f7a7b51db2a/docs%2Fsource%2Fen%2Fmodel_doc%2Faltclip.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/32dbf4bddbffa577b4d9b72b94000f7a7b51db2a/docs%2Fsource%2Fen%2Fmodel_doc%2Faltclip.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Faltclip.md?ref=32dbf4bddbffa577b4d9b72b94000f7a7b51db2a",
            "patch": "@@ -14,103 +14,107 @@ rendered properly in your Markdown viewer.\n \n -->\n \n+<div style=\"float: right;\">\n+  <div class=\"flex flex-wrap space-x-1\">\n+    <img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+</div>\n+\n # AltCLIP\n \n-<div class=\"flex flex-wrap space-x-1\">\n-<img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n-</div>\n+[AltCLIP](https://huggingface.co/papers/2211.06679v2) replaces the [CLIP](./clip) text encoder with a multilingual XLM-R encoder and aligns image and text representations with teacher learning and contrastive learning.\n+\n+You can find all the original AltCLIP checkpoints under the [AltClip](https://huggingface.co/collections/BAAI/alt-clip-diffusion-66987a97de8525205f1221bf) collection.\n+\n+> [!TIP]\n+> Click on the AltCLIP models in the right sidebar for more examples of how to apply AltCLIP to different tasks.\n+\n+The examples below demonstrates how to calculate similarity scores between an image and one or more captions with the [`AutoModel`] class.\n \n-## Overview\n+<hfoptions id=\"usage\">\n+<hfoption id=\"AutoModel\">\n \n-The AltCLIP model was proposed in [AltCLIP: Altering the Language Encoder in CLIP for Extended Language Capabilities](https://arxiv.org/abs/2211.06679v2) by Zhongzhi Chen, Guang Liu, Bo-Wen Zhang, Fulong Ye, Qinghong Yang, Ledell Wu. AltCLIP\n-(Altering the Language Encoder in CLIP) is a neural network trained on a variety of image-text and text-text pairs. By switching CLIP's\n-text encoder with a pretrained multilingual text encoder XLM-R, we could obtain very close performances with CLIP on almost all tasks, and extended original CLIP's capabilities such as multilingual understanding.\n+```python\n+import torch\n+import requests\n+from PIL import Image\n+from transformers import AltCLIPModel, AltCLIPProcessor\n \n-The abstract from the paper is the following:\n+model = AltCLIPModel.from_pretrained(\"BAAI/AltCLIP\", torch_dtype=torch.bfloat16)\n+processor = AltCLIPProcessor.from_pretrained(\"BAAI/AltCLIP\")\n \n-*In this work, we present a conceptually simple and effective method to train a strong bilingual multimodal representation model. \n-Starting from the pretrained multimodal representation model CLIP released by OpenAI, we switched its text encoder with a pretrained \n-multilingual text encoder XLM-R, and aligned both languages and image representations by a two-stage training schema consisting of \n-teacher learning and contrastive learning. We validate our method through evaluations of a wide range of tasks. We set new state-of-the-art \n-performances on a bunch of tasks including ImageNet-CN, Flicker30k- CN, and COCO-CN. Further, we obtain very close performances with \n-CLIP on almost all tasks, suggesting that one can simply alter the text encoder in CLIP for extended capabilities such as multilingual understanding.*\n+url = \"https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/pipeline-cat-chonk.jpeg\"\n+image = Image.open(requests.get(url, stream=True).raw)\n \n-This model was contributed by [jongjyh](https://huggingface.co/jongjyh).\n+inputs = processor(text=[\"a photo of a cat\", \"a photo of a dog\"], images=image, return_tensors=\"pt\", padding=True)\n \n-## Usage tips and example\n+outputs = model(**inputs)\n+logits_per_image = outputs.logits_per_image  # this is the image-text similarity score\n+probs = logits_per_image.softmax(dim=1)  # we can take the softmax to get the label probabilities\n \n-The usage of AltCLIP is very similar to the CLIP. the difference between CLIP is the text encoder. Note that we use bidirectional attention instead of casual attention\n-and we take the [CLS] token in XLM-R to represent text embedding.\n+labels = [\"a photo of a cat\", \"a photo of a dog\"]\n+for label, prob in zip(labels, probs[0]):\n+    print(f\"{label}: {prob.item():.4f}\")\n+```\n \n-AltCLIP is a multi-modal vision and language model. It can be used for image-text similarity and for zero-shot image\n-classification. AltCLIP uses a ViT like transformer to get visual features and a bidirectional language model to get the text\n-features. Both the text and visual features are then projected to a latent space with identical dimension. The dot\n-product between the projected image and text features is then used as a similar score.\n+</hfoption>\n+</hfoptions>\n \n-To feed images to the Transformer encoder, each image is split into a sequence of fixed-size non-overlapping patches,\n-which are then linearly embedded. A [CLS] token is added to serve as representation of an entire image. The authors\n-also add absolute position embeddings, and feed the resulting sequence of vectors to a standard Transformer encoder.\n-The [`CLIPImageProcessor`] can be used to resize (or rescale) and normalize images for the model.\n+Quantization reduces the memory burden of large models by representing the weights in a lower precision. Refer to the [Quantization](../quantization/overview) overview for more available quantization backends.\n \n-The [`AltCLIPProcessor`] wraps a [`CLIPImageProcessor`] and a [`XLMRobertaTokenizer`] into a single instance to both\n-encode the text and prepare the images. The following example shows how to get the image-text similarity scores using\n-[`AltCLIPProcessor`] and [`AltCLIPModel`].\n+The example below uses [torchao](../quantization/torchao) to only quantize the weights to int4.\n \n ```python\n->>> from PIL import Image\n->>> import requests\n+# !pip install torchao\n+import torch\n+import requests\n+from PIL import Image\n+from transformers import AltCLIPModel, AltCLIPProcessor, TorchAoConfig\n \n->>> from transformers import AltCLIPModel, AltCLIPProcessor\n+model = AltCLIPModel.from_pretrained(\n+    \"BAAI/AltCLIP\",\n+    quantization_config=TorchAoConfig(\"int4_weight_only\", group_size=128),\n+    torch_dtype=torch.bfloat16,\n+)\n \n->>> model = AltCLIPModel.from_pretrained(\"BAAI/AltCLIP\")\n->>> processor = AltCLIPProcessor.from_pretrained(\"BAAI/AltCLIP\")\n+processor = AltCLIPProcessor.from_pretrained(\"BAAI/AltCLIP\")\n \n->>> url = \"http://images.cocodataset.org/val2017/000000039769.jpg\"\n->>> image = Image.open(requests.get(url, stream=True).raw)\n+url = \"https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/pipeline-cat-chonk.jpeg\"\n+image = Image.open(requests.get(url, stream=True).raw)\n \n->>> inputs = processor(text=[\"a photo of a cat\", \"a photo of a dog\"], images=image, return_tensors=\"pt\", padding=True)\n+inputs = processor(text=[\"a photo of a cat\", \"a photo of a dog\"], images=image, return_tensors=\"pt\", padding=True)\n \n->>> outputs = model(**inputs)\n->>> logits_per_image = outputs.logits_per_image  # this is the image-text similarity score\n->>> probs = logits_per_image.softmax(dim=1)  # we can take the softmax to get the label probabilities\n-```\n+outputs = model(**inputs)\n+logits_per_image = outputs.logits_per_image  # this is the image-text similarity score\n+probs = logits_per_image.softmax(dim=1)  # we can take the softmax to get the label probabilities\n \n-<Tip>\n+labels = [\"a photo of a cat\", \"a photo of a dog\"]\n+for label, prob in zip(labels, probs[0]):\n+    print(f\"{label}: {prob.item():.4f}\")\n+```\n \n-This model is based on `CLIPModel`, use it like you would use the original [CLIP](clip).\n+## Notes\n \n-</Tip>\n+- AltCLIP uses bidirectional attention instead of causal attention and it uses the `[CLS]` token in XLM-R to represent a text embedding.\n+- Use [`CLIPImageProcessor`] to resize (or rescale) and normalize images for the model.\n+- [`AltCLIPProcessor`] combines [`CLIPImageProcessor`] and [`XLMRobertaTokenizer`] into a single instance to encode text and prepare images.\n \n ## AltCLIPConfig\n-\n [[autodoc]] AltCLIPConfig\n-    - from_text_vision_configs\n \n ## AltCLIPTextConfig\n-\n [[autodoc]] AltCLIPTextConfig\n \n ## AltCLIPVisionConfig\n-\n [[autodoc]] AltCLIPVisionConfig\n \n-## AltCLIPProcessor\n-\n-[[autodoc]] AltCLIPProcessor\n-\n ## AltCLIPModel\n-\n [[autodoc]] AltCLIPModel\n-    - forward\n-    - get_text_features\n-    - get_image_features\n \n ## AltCLIPTextModel\n-\n [[autodoc]] AltCLIPTextModel\n-    - forward\n \n ## AltCLIPVisionModel\n-\n [[autodoc]] AltCLIPVisionModel\n-    - forward\n\\ No newline at end of file\n+\n+## AltCLIPProcessor\n+[[autodoc]] AltCLIPProcessor"
        }
    ],
    "stats": {
        "total": 124,
        "additions": 64,
        "deletions": 60
    }
}