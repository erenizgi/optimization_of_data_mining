{
    "author": "aymeric-roucher",
    "message": "Add visit webpage tool (#33353)\n\n* Add VisitWebpageTool",
    "sha": "489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9",
    "files": [
        {
            "sha": "8628785815cef2f952d09795ecd4ef99df413189",
            "filename": "docs/source/en/main_classes/agent.md",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9/docs%2Fsource%2Fen%2Fmain_classes%2Fagent.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9/docs%2Fsource%2Fen%2Fmain_classes%2Fagent.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmain_classes%2Fagent.md?ref=489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9",
            "patch": "@@ -50,6 +50,10 @@ We provide two types of agents, based on the main [`Agent`] class:\n \n [[autodoc]] ReactCodeAgent\n \n+### ManagedAgent\n+\n+[[autodoc]] ManagedAgent\n+\n ## Tools\n \n ### load_tool"
        },
        {
            "sha": "8f4b23b11ea8aadd1426421480f7540e43b81213",
            "filename": "src/transformers/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9/src%2Ftransformers%2F__init__.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9/src%2Ftransformers%2F__init__.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2F__init__.py?ref=489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9",
            "patch": "@@ -58,6 +58,7 @@\n         \"Agent\",\n         \"CodeAgent\",\n         \"HfApiEngine\",\n+        \"ManagedAgent\",\n         \"PipelineTool\",\n         \"ReactAgent\",\n         \"ReactCodeAgent\",\n@@ -4826,6 +4827,7 @@\n         Agent,\n         CodeAgent,\n         HfApiEngine,\n+        ManagedAgent,\n         PipelineTool,\n         ReactAgent,\n         ReactCodeAgent,"
        },
        {
            "sha": "d053e385cf7a15d3541d10eb9d0d48c899b30c92",
            "filename": "src/transformers/agents/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9/src%2Ftransformers%2Fagents%2F__init__.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9/src%2Ftransformers%2Fagents%2F__init__.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fagents%2F__init__.py?ref=489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9",
            "patch": "@@ -39,7 +39,7 @@\n     _import_structure[\"default_tools\"] = [\"FinalAnswerTool\", \"PythonInterpreterTool\"]\n     _import_structure[\"document_question_answering\"] = [\"DocumentQuestionAnsweringTool\"]\n     _import_structure[\"image_question_answering\"] = [\"ImageQuestionAnsweringTool\"]\n-    _import_structure[\"search\"] = [\"DuckDuckGoSearchTool\"]\n+    _import_structure[\"search\"] = [\"DuckDuckGoSearchTool\", \"VisitWebpageTool\"]\n     _import_structure[\"speech_to_text\"] = [\"SpeechToTextTool\"]\n     _import_structure[\"text_to_speech\"] = [\"TextToSpeechTool\"]\n     _import_structure[\"translation\"] = [\"TranslationTool\"]\n@@ -59,7 +59,7 @@\n         from .default_tools import FinalAnswerTool, PythonInterpreterTool\n         from .document_question_answering import DocumentQuestionAnsweringTool\n         from .image_question_answering import ImageQuestionAnsweringTool\n-        from .search import DuckDuckGoSearchTool\n+        from .search import DuckDuckGoSearchTool, VisitWebpageTool\n         from .speech_to_text import SpeechToTextTool\n         from .text_to_speech import TextToSpeechTool\n         from .translation import TranslationTool"
        },
        {
            "sha": "5ce36bf99b563fc0d3892cc6fb314bd1754336b3",
            "filename": "src/transformers/agents/search.py",
            "status": "modified",
            "additions": 43,
            "deletions": 1,
            "changes": 44,
            "blob_url": "https://github.com/huggingface/transformers/blob/489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9/src%2Ftransformers%2Fagents%2Fsearch.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9/src%2Ftransformers%2Fagents%2Fsearch.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fagents%2Fsearch.py?ref=489cbfd6d3b0c441cf2dbbf08e753896e5a9aea9",
            "patch": "@@ -14,6 +14,11 @@\n # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n # See the License for the specific language governing permissions and\n # limitations under the License.\n+import re\n+\n+import requests\n+from requests.exceptions import RequestException\n+\n from .tools import Tool\n \n \n@@ -29,7 +34,44 @@ def forward(self, query: str) -> str:\n             from duckduckgo_search import DDGS\n         except ImportError:\n             raise ImportError(\n-                \"You must install package `duckduckgo_search`: for instance run `pip install duckduckgo-search`.\"\n+                \"You must install package `duckduckgo_search` to run this tool: for instance run `pip install duckduckgo-search`.\"\n             )\n         results = DDGS().text(query, max_results=7)\n         return results\n+\n+\n+class VisitWebpageTool(Tool):\n+    name = \"visit_webpage\"\n+    description = \"Visits a wbepage at the given url and returns its content as a markdown string.\"\n+    inputs = {\n+        \"url\": {\n+            \"type\": \"text\",\n+            \"description\": \"The url of the webpage to visit.\",\n+        }\n+    }\n+    output_type = \"text\"\n+\n+    def forward(self, url: str) -> str:\n+        try:\n+            from markdownify import markdownify\n+        except ImportError:\n+            raise ImportError(\n+                \"You must install package `markdownify` to run this tool: for instance run `pip install markdownify`.\"\n+            )\n+        try:\n+            # Send a GET request to the URL\n+            response = requests.get(url)\n+            response.raise_for_status()  # Raise an exception for bad status codes\n+\n+            # Convert the HTML content to Markdown\n+            markdown_content = markdownify(response.text).strip()\n+\n+            # Remove multiple line breaks\n+            markdown_content = re.sub(r\"\\n{3,}\", \"\\n\\n\", markdown_content)\n+\n+            return markdown_content\n+\n+        except RequestException as e:\n+            return f\"Error fetching the webpage: {str(e)}\"\n+        except Exception as e:\n+            return f\"An unexpected error occurred: {str(e)}\""
        }
    ],
    "stats": {
        "total": 54,
        "additions": 51,
        "deletions": 3
    }
}