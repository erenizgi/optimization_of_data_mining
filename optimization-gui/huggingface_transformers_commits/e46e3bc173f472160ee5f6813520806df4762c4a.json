{
    "author": "Rocketknight1",
    "message": "Fix UDOP dtype issue (#34180)\n\n* Trigger UDOP tests\r\n\r\n* Try forcing dtype in LayoutLMV3\r\n\r\n* Do checks to see where uint8 is getting in\r\n\r\n* Do checks to see where uint8 is getting in\r\n\r\n* Found it!\r\n\r\n* Add .astype(np.float32)\r\n\r\n* Remove forced check, make fixup\r\n\r\n* Checking where exactly the uint8 creeps in\r\n\r\n* More checking on the uint8 issues\r\n\r\n* Manually upcast in rescale()\r\n\r\n* Remove UDOP trigger",
    "sha": "e46e3bc173f472160ee5f6813520806df4762c4a",
    "files": [
        {
            "sha": "81e8d9185623aaf1d36a5b162863dcd884174296",
            "filename": "src/transformers/image_transforms.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/e46e3bc173f472160ee5f6813520806df4762c4a/src%2Ftransformers%2Fimage_transforms.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/e46e3bc173f472160ee5f6813520806df4762c4a/src%2Ftransformers%2Fimage_transforms.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fimage_transforms.py?ref=e46e3bc173f472160ee5f6813520806df4762c4a",
            "patch": "@@ -123,11 +123,11 @@ def rescale(\n     if not isinstance(image, np.ndarray):\n         raise TypeError(f\"Input image must be of type np.ndarray, got {type(image)}\")\n \n-    rescaled_image = image * scale\n+    rescaled_image = image.astype(np.float64) * scale  # Numpy type promotion has changed, so always upcast first\n     if data_format is not None:\n         rescaled_image = to_channel_dimension_format(rescaled_image, data_format, input_data_format)\n \n-    rescaled_image = rescaled_image.astype(dtype)\n+    rescaled_image = rescaled_image.astype(dtype)  # Finally downcast to the desired dtype at the end\n \n     return rescaled_image\n "
        }
    ],
    "stats": {
        "total": 4,
        "additions": 2,
        "deletions": 2
    }
}