{
    "author": "sambhavnoobcoder",
    "message": "Fix test isolation for clear_import_cache utility (#36345)\n\n* test fixup\n\n* test fixup\n\n* fixing tests for unused imports\n\n* style fixes\n\n* fix\n\n* style fixes\n\n* styke fix\n\n* remove isolated module cache\n\n* rm custom subprocess defination\n\n* run using exsiting fn\n\n* style fixup\n\n* make fixup\n\n* remove redundant comments\n\n* rm redundat skipif + style changes",
    "sha": "8e67230860b347081894f5de53b0fdf74da65b68",
    "files": [
        {
            "sha": "fe616e9cfbe272a9fbe004b00314ff4ac87a9373",
            "filename": "tests/utils/test_import_utils.py",
            "status": "modified",
            "additions": 13,
            "deletions": 10,
            "changes": 23,
            "blob_url": "https://github.com/huggingface/transformers/blob/8e67230860b347081894f5de53b0fdf74da65b68/tests%2Futils%2Ftest_import_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/8e67230860b347081894f5de53b0fdf74da65b68/tests%2Futils%2Ftest_import_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Futils%2Ftest_import_utils.py?ref=8e67230860b347081894f5de53b0fdf74da65b68",
            "patch": "@@ -1,23 +1,26 @@\n import sys\n \n+from transformers.testing_utils import run_test_using_subprocess\n from transformers.utils.import_utils import clear_import_cache\n \n \n+@run_test_using_subprocess\n def test_clear_import_cache():\n-    # Import some transformers modules\n+    \"\"\"Test the clear_import_cache function.\"\"\"\n \n-    # Get initial module count\n+    # Save initial state\n     initial_modules = {name: mod for name, mod in sys.modules.items() if name.startswith(\"transformers.\")}\n+    assert len(initial_modules) > 0, \"No transformers modules loaded before test\"\n \n-    # Verify we have some modules loaded\n-    assert len(initial_modules) > 0\n-\n-    # Clear cache\n+    # Execute clear_import_cache() function\n     clear_import_cache()\n \n-    # Check modules were removed\n+    # Verify modules were removed\n     remaining_modules = {name: mod for name, mod in sys.modules.items() if name.startswith(\"transformers.\")}\n-    assert len(remaining_modules) < len(initial_modules)\n+    assert len(remaining_modules) < len(initial_modules), \"No modules were removed\"\n+\n+    # Import and verify module exists\n+    from transformers.models.auto import modeling_auto\n \n-    # Verify we can reimport\n-    assert \"transformers\" in sys.modules\n+    assert \"transformers.models.auto.modeling_auto\" in sys.modules\n+    assert modeling_auto.__name__ == \"transformers.models.auto.modeling_auto\""
        }
    ],
    "stats": {
        "total": 23,
        "additions": 13,
        "deletions": 10
    }
}