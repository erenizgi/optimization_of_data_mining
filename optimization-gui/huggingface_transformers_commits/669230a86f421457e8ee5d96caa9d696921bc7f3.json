{
    "author": "winglian",
    "message": "fix broken offline mode when loading tokenizer from hub (#40669)\n\n* fix broken offline mode when loading tokenizer from hub\n\n* formatting\n\n* make quality\n\n* fix import order",
    "sha": "669230a86f421457e8ee5d96caa9d696921bc7f3",
    "files": [
        {
            "sha": "4beacbe25aebfc4b13ea046dc2125fc363bbcb01",
            "filename": "src/transformers/utils/hub.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/669230a86f421457e8ee5d96caa9d696921bc7f3/src%2Ftransformers%2Futils%2Fhub.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/669230a86f421457e8ee5d96caa9d696921bc7f3/src%2Ftransformers%2Futils%2Fhub.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2Fhub.py?ref=669230a86f421457e8ee5d96caa9d696921bc7f3",
            "patch": "@@ -176,7 +176,7 @@ def list_repo_templates(\n             ]\n         except (GatedRepoError, RepositoryNotFoundError, RevisionNotFoundError):\n             raise  # valid errors => do not catch\n-        except (HTTPError, requests.exceptions.ConnectionError):\n+        except (HTTPError, OfflineModeIsEnabled, requests.exceptions.ConnectionError):\n             pass  # offline mode, internet down, etc. => try local files\n \n     # check local files"
        },
        {
            "sha": "b86773793a849c59b1a17fa7d4159c9507e104f7",
            "filename": "tests/utils/test_hub_utils.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/huggingface/transformers/blob/669230a86f421457e8ee5d96caa9d696921bc7f3/tests%2Futils%2Ftest_hub_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/669230a86f421457e8ee5d96caa9d696921bc7f3/tests%2Futils%2Ftest_hub_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Futils%2Ftest_hub_utils.py?ref=669230a86f421457e8ee5d96caa9d696921bc7f3",
            "patch": "@@ -19,6 +19,7 @@\n from pathlib import Path\n \n from huggingface_hub import hf_hub_download\n+from huggingface_hub.errors import LocalEntryNotFoundError, OfflineModeIsEnabled\n from requests.exceptions import HTTPError\n \n from transformers.utils import (\n@@ -29,6 +30,7 @@\n     WEIGHTS_NAME,\n     cached_file,\n     has_file,\n+    list_repo_templates,\n )\n \n \n@@ -198,3 +200,12 @@ def test_cached_files_exception_raised(self):\n             with self.assertRaises(ModuleNotFoundError):\n                 # The error should be re-raised by cached_files, not caught in the exception handling block\n                 cached_file(RANDOM_BERT, \"nonexistent.json\")\n+\n+\n+class OfflineModeTests(unittest.TestCase):\n+    def test_list_repo_templates_w_offline(self):\n+        with mock.patch(\"transformers.utils.hub.list_repo_tree\", side_effect=OfflineModeIsEnabled()):\n+            with mock.patch(\n+                \"transformers.utils.hub.snapshot_download\", side_effect=LocalEntryNotFoundError(\"no snapshot found\")\n+            ):\n+                self.assertEqual(list_repo_templates(RANDOM_BERT, local_files_only=False), [])"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 12,
        "deletions": 1
    }
}