{
    "author": "Cyrilvallez",
    "message": "Fix some deprecated practices in torch 2.9 (#43167)\n\n* update to tuple\n\n* fix\n\n* fix",
    "sha": "dca084253f2bca14b5b091b38deaeec317c14acd",
    "files": [
        {
            "sha": "b973fc473b459538600647946b01fed0e9d57b31",
            "filename": "src/transformers/models/funnel/modeling_funnel.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/dca084253f2bca14b5b091b38deaeec317c14acd/src%2Ftransformers%2Fmodels%2Ffunnel%2Fmodeling_funnel.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/dca084253f2bca14b5b091b38deaeec317c14acd/src%2Ftransformers%2Fmodels%2Ffunnel%2Fmodeling_funnel.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Ffunnel%2Fmodeling_funnel.py?ref=dca084253f2bca14b5b091b38deaeec317c14acd",
            "patch": "@@ -238,9 +238,9 @@ def stride_pool(\n         axis_slice = (\n             slice(None, -1, 2) if self.config.separate_cls and self.config.truncate_seq else slice(None, None, 2)\n         )\n-        enc_slice = [slice(None)] * axis + [axis_slice]\n+        enc_slice = tuple([slice(None)] * axis + [axis_slice])\n         if self.config.separate_cls:\n-            cls_slice = [slice(None)] * axis + [slice(None, 1)]\n+            cls_slice = tuple([slice(None)] * axis + [slice(None, 1)])\n             tensor = torch.cat([tensor[cls_slice], tensor], axis=axis)\n         return tensor[enc_slice]\n "
        },
        {
            "sha": "d6ffebc4d92082508bdefc4870c0c491ea7a836e",
            "filename": "src/transformers/models/oneformer/modeling_oneformer.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/huggingface/transformers/blob/dca084253f2bca14b5b091b38deaeec317c14acd/src%2Ftransformers%2Fmodels%2Foneformer%2Fmodeling_oneformer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/dca084253f2bca14b5b091b38deaeec317c14acd/src%2Ftransformers%2Fmodels%2Foneformer%2Fmodeling_oneformer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Foneformer%2Fmodeling_oneformer.py?ref=dca084253f2bca14b5b091b38deaeec317c14acd",
            "patch": "@@ -1157,6 +1157,7 @@ def get_reference_points(spatial_shapes, valid_ratios, device):\n             ref_y, ref_x = torch.meshgrid(\n                 torch.linspace(0.5, height - 0.5, height, dtype=valid_ratios.dtype, device=device),\n                 torch.linspace(0.5, width - 0.5, width, dtype=valid_ratios.dtype, device=device),\n+                indexing=\"ij\",\n             )\n             ref_y = ref_y.reshape(-1)[None] / (valid_ratios[:, None, lvl, 1] * height)\n             ref_x = ref_x.reshape(-1)[None] / (valid_ratios[:, None, lvl, 0] * width)"
        },
        {
            "sha": "eb96930219e6c370b5d6cdf7e3bc780619fb790c",
            "filename": "tests/models/dab_detr/test_modeling_dab_detr.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Fmodels%2Fdab_detr%2Ftest_modeling_dab_detr.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Fmodels%2Fdab_detr%2Ftest_modeling_dab_detr.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fdab_detr%2Ftest_modeling_dab_detr.py?ref=dca084253f2bca14b5b091b38deaeec317c14acd",
            "patch": "@@ -465,7 +465,7 @@ def recursive_check(batched_object, single_row_object, model_name, key):\n             else:\n                 # indexing the first element does not always work\n                 # e.g. models that output similarity scores of size (N, M) would need to index [0, 0]\n-                slice_ids = [slice(0, index) for index in single_row_object.shape]\n+                slice_ids = tuple(slice(0, index) for index in single_row_object.shape)\n                 batched_row = batched_object[slice_ids]\n                 self.assertFalse(\n                     torch.isnan(batched_row).any(), f\"Batched output has `nan` in {model_name} for key={key}\""
        },
        {
            "sha": "8db928d00b58e110df6f44cfc97ad3f16526df00",
            "filename": "tests/models/efficientloftr/test_modeling_efficientloftr.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Fmodels%2Fefficientloftr%2Ftest_modeling_efficientloftr.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Fmodels%2Fefficientloftr%2Ftest_modeling_efficientloftr.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fefficientloftr%2Ftest_modeling_efficientloftr.py?ref=dca084253f2bca14b5b091b38deaeec317c14acd",
            "patch": "@@ -326,7 +326,7 @@ def recursive_check(batched_object, single_row_object, model_name, key):\n             else:\n                 # indexing the first element does not always work\n                 # e.g. models that output similarity scores of size (N, M) would need to index [0, 0]\n-                slice_ids = [slice(0, index) for index in single_row_object.shape]\n+                slice_ids = tuple(slice(0, index) for index in single_row_object.shape)\n                 batched_row = batched_object[slice_ids]\n                 if key == \"keypoints\":\n                     batched_row = torch.sum(batched_row, dim=-1)"
        },
        {
            "sha": "4425223d1596a97660557a9534e6bcc21702882f",
            "filename": "tests/models/omdet_turbo/test_modeling_omdet_turbo.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Fmodels%2Fomdet_turbo%2Ftest_modeling_omdet_turbo.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Fmodels%2Fomdet_turbo%2Ftest_modeling_omdet_turbo.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fomdet_turbo%2Ftest_modeling_omdet_turbo.py?ref=dca084253f2bca14b5b091b38deaeec317c14acd",
            "patch": "@@ -374,7 +374,7 @@ def recursive_check(batched_object, single_row_object, model_name, key):\n                 # init\n                 # indexing the first element does not always work\n                 # e.g. models that output similarity scores of size (N, M) would need to index [0, 0]\n-                slice_ids = [slice(0, index) for index in single_row_object.shape]\n+                slice_ids = tuple(slice(0, index) for index in single_row_object.shape)\n                 batched_row = batched_object[slice_ids]\n                 self.assertFalse(\n                     torch.isnan(batched_row).any(), f\"Batched output has `nan` in {model_name} for key={key}\""
        },
        {
            "sha": "cc524712e7934542a51fe317de588b9d124e6978",
            "filename": "tests/models/superglue/test_modeling_superglue.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Fmodels%2Fsuperglue%2Ftest_modeling_superglue.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Fmodels%2Fsuperglue%2Ftest_modeling_superglue.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fsuperglue%2Ftest_modeling_superglue.py?ref=dca084253f2bca14b5b091b38deaeec317c14acd",
            "patch": "@@ -304,7 +304,7 @@ def recursive_check(batched_object, single_row_object, model_name, key):\n             else:\n                 # indexing the first element does not always work\n                 # e.g. models that output similarity scores of size (N, M) would need to index [0, 0]\n-                slice_ids = [slice(0, index) for index in single_row_object.shape]\n+                slice_ids = tuple(slice(0, index) for index in single_row_object.shape)\n                 batched_row = batched_object[slice_ids]\n                 self.assertFalse(\n                     torch.isnan(batched_row).any(), f\"Batched output has `nan` in {model_name} for key={key}\""
        },
        {
            "sha": "b58061da766b815f1d2eed3f38ff38a03698df72",
            "filename": "tests/test_modeling_common.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Ftest_modeling_common.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/dca084253f2bca14b5b091b38deaeec317c14acd/tests%2Ftest_modeling_common.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Ftest_modeling_common.py?ref=dca084253f2bca14b5b091b38deaeec317c14acd",
            "patch": "@@ -1443,7 +1443,7 @@ def recursive_check(batched_object, single_row_object, model_name, key):\n             else:\n                 # indexing the first element does not always work\n                 # e.g. models that output similarity scores of size (N, M) would need to index [0, 0]\n-                slice_ids = [slice(0, index) for index in single_row_object.shape]\n+                slice_ids = tuple(slice(0, index) for index in single_row_object.shape)\n                 batched_row = batched_object[slice_ids]\n                 self.assertFalse(\n                     torch.isnan(batched_row).any(), f\"Batched output has `nan` in {model_name} for key={key}\""
        }
    ],
    "stats": {
        "total": 15,
        "additions": 8,
        "deletions": 7
    }
}