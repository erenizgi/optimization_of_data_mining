{
    "author": "yao-matrix",
    "message": "add pytorch-xpu Dockerfile (#38875)\n\n* first commit\n\nSigned-off-by: YAO Matrix <matrix.yao@intel.com>\n\n* use rls pytorch\n\nSigned-off-by: YAO Matrix <matrix.yao@intel.com>\n\n---------\n\nSigned-off-by: YAO Matrix <matrix.yao@intel.com>",
    "sha": "38a9b707862dc017f111eb02a2bba61e35a74104",
    "files": [
        {
            "sha": "c2aca2f138e41a28a80e95c60dabb0f42b06f716",
            "filename": "docker/transformers-pytorch-xpu/Dockerfile",
            "status": "added",
            "additions": 93,
            "deletions": 0,
            "changes": 93,
            "blob_url": "https://github.com/huggingface/transformers/blob/38a9b707862dc017f111eb02a2bba61e35a74104/docker%2Ftransformers-pytorch-xpu%2FDockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/38a9b707862dc017f111eb02a2bba61e35a74104/docker%2Ftransformers-pytorch-xpu%2FDockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Ftransformers-pytorch-xpu%2FDockerfile?ref=38a9b707862dc017f111eb02a2bba61e35a74104",
            "patch": "@@ -0,0 +1,93 @@\n+FROM intel/deep-learning-essentials:2025.1.3-0-devel-ubuntu22.04 AS base\n+LABEL maintainer=\"Hugging Face\"\n+\n+SHELL [\"/bin/bash\", \"-c\"]\n+\n+ARG PYTHON_VER=3.11\n+ENV TORCH_DEVICE_BACKEND_AUTOLOAD=0\n+ENV DEBIAN_FRONTEND=noninteractive\n+\n+RUN apt-get remove -y python3.10 && apt-get autoremove -y\n+RUN apt-get update && \\\n+    apt-get install -y software-properties-common && \\\n+    add-apt-repository -y ppa:deadsnakes/ppa && \\\n+    apt-get update && \\\n+    apt-get install -y python$PYTHON_VER python$PYTHON_VER-dev python3-pip && \\\n+    ln -sf /usr/bin/python$PYTHON_VER /usr/bin/python3 && \\\n+    ln -sf /usr/bin/python3 /usr/bin/python && \\\n+    apt-get clean && \\\n+    rm -rf /var/lib/apt/lists/*\n+\n+RUN apt-get update && \\\n+    apt-get -y install \\\n+        apt-utils \\\n+        build-essential \\\n+        ca-certificates \\\n+        clinfo \\\n+        curl \\\n+        git \\\n+        git-lfs \\\n+        vim \\\n+        numactl \\\n+        gnupg2 \\\n+        gpg-agent \\\n+        zlib1g-dev \\\n+        rsync \\\n+        sudo \\\n+        libnl-genl-3-200 \\\n+        xpu-smi \\\n+        unzip \\\n+        ffmpeg \\\n+        tesseract-ocr \\\n+        espeak-ng \\\n+        wget \\\n+        ncurses-term && \\\n+    apt-get clean && \\\n+    rm -rf /var/lib/apt/lists/*\n+\n+\n+RUN apt-get update && \\\n+    apt-get install -y \\\n+        linux-headers-$(uname -r) \\\n+        linux-modules-extra-$(uname -r) \\\n+        flex bison \\\n+        intel-fw-gpu intel-i915-dkms xpu-smi \\\n+        intel-opencl-icd libze-intel-gpu1 libze1 \\\n+        intel-media-va-driver-non-free libmfx-gen1 libvpl2 \\\n+        libegl-mesa0 libegl1-mesa libegl1-mesa-dev libgbm1 libgl1-mesa-dev libgl1-mesa-dri \\\n+        libglapi-mesa libglx-mesa0 libigdgmm12 libxatracker2 mesa-va-drivers \\\n+        mesa-vdpau-drivers mesa-vulkan-drivers va-driver-all vainfo hwinfo clinfo intel-ocloc \\\n+        libigc-dev intel-igc-cm libigdfcl-dev libigfxcmrt-dev libze-dev && \\\n+    apt-get clean && \\\n+    rm -rf  /var/lib/apt/lists/*\n+\n+RUN pip install --upgrade pip\n+RUN pip install triton==3.3.0\n+\n+RUN pip install torch==2.7.0 torchvision==0.22.0 torchaudio==2.7.0 --index-url https://download.pytorch.org/whl/xpu --no-cache-dir\n+\n+RUN pip install evaluate torchdata pyctcdecode pytesseract decord galore-torch fire scipy scikit-learn sentencepiece sacremoses nltk rouge_score librosa soundfile g2p_en mpi4py requests_mock\n+RUN pip install pretty_midi essentia resampy Levenshtein av sacrebleu phonemizer invisible_watermark schedulefree\n+RUN pip install gguf hqq compressed_tensors gptqmodel mergekit autoawq deepspeed torchao onnx\n+RUN pip install hf_transfer huggingface-hub hf-doc-builder datasets optimum-quanto timm transformers accelerate optimum peft\n+\n+RUN pip install git+https://github.com/linkedin/Liger-Kernel.git --extra-index-url https://download.pytorch.org/whl/test/xpu\n+\n+# install bitsandbytes\n+RUN pip install git+https://github.com/bitsandbytes-foundation/bitsandbytes.git\n+\n+ENV OCL_ICD_VENDORS=/etc/OpenCL/vendors\n+ENV FI_PROVIDER_PATH=${I_MPI_ROOT}/lib/libfabric/prov:/usr/lib/x86_64-linux-gnu/libfabric\n+ENV CCL_ROOT=/usr/local\n+ENV CCL_ATL_TRANSPORT=ofi\n+ENV I_MPI_ROOT=/usr/local\n+ENV CLASSPATH=${I_MPI_ROOT}/lib/mpi.jar\n+ENV PATH=${I_MPI_ROOT}/bin/libfabric:${PATH}\n+ENV LD_LIBRARY_PATH=${I_MPI_ROOT}/lib/libfabric:${LD_LIBRARY_PATH}\n+\n+RUN touch /entrypoint.sh\n+RUN chmod +x /entrypoint.sh\n+RUN echo \"#!/bin/bash\" >> /entrypoint.sh\n+RUN echo \"source /opt/intel/oneapi/setvars.sh --force && /bin/bash\" >> /entrypoint.sh\n+\n+ENTRYPOINT [\"/entrypoint.sh\"]"
        }
    ],
    "stats": {
        "total": 93,
        "additions": 93,
        "deletions": 0
    }
}