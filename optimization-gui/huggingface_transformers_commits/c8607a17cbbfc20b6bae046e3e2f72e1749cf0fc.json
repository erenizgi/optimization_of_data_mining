{
    "author": "Fiona-Waters",
    "message": "Add a check to import_utils.py to allow for use of faiss_gpu installation (#37997)\n\nAdding check to import_utils.py for faiss_gpu",
    "sha": "c8607a17cbbfc20b6bae046e3e2f72e1749cf0fc",
    "files": [
        {
            "sha": "6aee59d44f663e6c1d44b3380c41ab3a1bf6880b",
            "filename": "src/transformers/utils/import_utils.py",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/huggingface/transformers/blob/c8607a17cbbfc20b6bae046e3e2f72e1749cf0fc/src%2Ftransformers%2Futils%2Fimport_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/c8607a17cbbfc20b6bae046e3e2f72e1749cf0fc/src%2Ftransformers%2Futils%2Fimport_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2Fimport_utils.py?ref=c8607a17cbbfc20b6bae046e3e2f72e1749cf0fc",
            "patch": "@@ -131,7 +131,7 @@ def _is_package_available(pkg_name: str, return_version: bool = False) -> Union[\n _yt_dlp_available = importlib.util.find_spec(\"yt_dlp\") is not None\n _datasets_available = _is_package_available(\"datasets\")\n _detectron2_available = _is_package_available(\"detectron2\")\n-# We need to check both `faiss` and `faiss-cpu`.\n+# We need to check `faiss`, `faiss-cpu` and `faiss-gpu`.\n _faiss_available = importlib.util.find_spec(\"faiss\") is not None\n try:\n     _faiss_version = importlib.metadata.version(\"faiss\")\n@@ -141,7 +141,11 @@ def _is_package_available(pkg_name: str, return_version: bool = False) -> Union[\n         _faiss_version = importlib.metadata.version(\"faiss-cpu\")\n         logger.debug(f\"Successfully imported faiss version {_faiss_version}\")\n     except importlib.metadata.PackageNotFoundError:\n-        _faiss_available = False\n+        try:\n+            _faiss_version = importlib.metadata.version(\"faiss-gpu\")\n+            logger.debug(f\"Successfully imported faiss version {_faiss_version}\")\n+        except importlib.metadata.PackageNotFoundError:\n+            _faiss_available = False\n _ftfy_available = _is_package_available(\"ftfy\")\n _g2p_en_available = _is_package_available(\"g2p_en\")\n _hadamard_available = _is_package_available(\"fast_hadamard_transform\")"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 6,
        "deletions": 2
    }
}