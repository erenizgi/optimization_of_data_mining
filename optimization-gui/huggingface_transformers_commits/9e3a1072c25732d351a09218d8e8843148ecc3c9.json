{
    "author": "ydshieh",
    "message": "Check `TRUST_REMOTE_CODE` for `RealmRetriever` for security (#36511)\n\n* fix\n\n* repush\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "9e3a1072c25732d351a09218d8e8843148ecc3c9",
    "files": [
        {
            "sha": "2b499fca280c61536921cfb61119dbc0ff3a87b7",
            "filename": "src/transformers/models/deprecated/realm/retrieval_realm.py",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/9e3a1072c25732d351a09218d8e8843148ecc3c9/src%2Ftransformers%2Fmodels%2Fdeprecated%2Frealm%2Fretrieval_realm.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/9e3a1072c25732d351a09218d8e8843148ecc3c9/src%2Ftransformers%2Fmodels%2Fdeprecated%2Frealm%2Fretrieval_realm.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fdeprecated%2Frealm%2Fretrieval_realm.py?ref=9e3a1072c25732d351a09218d8e8843148ecc3c9",
            "patch": "@@ -21,7 +21,7 @@\n from huggingface_hub import hf_hub_download\n \n from .... import AutoTokenizer\n-from ....utils import logging\n+from ....utils import logging, strtobool\n \n \n _REALM_BLOCK_RECORDS_FILENAME = \"block_records.npy\"\n@@ -114,6 +114,14 @@ def from_pretrained(cls, pretrained_model_name_or_path: Optional[Union[str, os.P\n             block_records_path = hf_hub_download(\n                 repo_id=pretrained_model_name_or_path, filename=_REALM_BLOCK_RECORDS_FILENAME, **kwargs\n             )\n+        if not strtobool(os.environ.get(\"TRUST_REMOTE_CODE\", \"False\")):\n+            raise ValueError(\n+                \"This part uses `pickle.load` which is insecure and will execute arbitrary code that is \"\n+                \"potentially malicious. It's recommended to never unpickle data that could have come from an \"\n+                \"untrusted source, or that could have been tampered with. If you already verified the pickle \"\n+                \"data and decided to use it, you can set the environment variable \"\n+                \"`TRUST_REMOTE_CODE` to `True` to allow it.\"\n+            )\n         block_records = np.load(block_records_path, allow_pickle=True)\n \n         tokenizer = AutoTokenizer.from_pretrained(pretrained_model_name_or_path, *init_inputs, **kwargs)"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 9,
        "deletions": 1
    }
}