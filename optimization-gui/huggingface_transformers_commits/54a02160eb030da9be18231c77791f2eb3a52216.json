{
    "author": "Rocketknight1",
    "message": "Fix ReDOS in tokenizer digit substitution (#38844)\n\n* Fix regexes vulnerable to ReDOS\n\n* Let's just use regex\n\n* Import regex/re correctly",
    "sha": "54a02160eb030da9be18231c77791f2eb3a52216",
    "files": [
        {
            "sha": "b8dc085b8beffe02536669e6f0b04be38348184a",
            "filename": "src/transformers/models/clvp/number_normalizer.py",
            "status": "modified",
            "additions": 14,
            "deletions": 7,
            "changes": 21,
            "blob_url": "https://github.com/huggingface/transformers/blob/54a02160eb030da9be18231c77791f2eb3a52216/src%2Ftransformers%2Fmodels%2Fclvp%2Fnumber_normalizer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/54a02160eb030da9be18231c77791f2eb3a52216/src%2Ftransformers%2Fmodels%2Fclvp%2Fnumber_normalizer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fclvp%2Fnumber_normalizer.py?ref=54a02160eb030da9be18231c77791f2eb3a52216",
            "patch": "@@ -15,7 +15,14 @@\n \n \"\"\"English Normalizer class for CLVP.\"\"\"\n \n-import re\n+import sys\n+\n+\n+if sys.version_info >= (3, 11):\n+    # Atomic grouping support was only added to the core RE in Python 3.11\n+    import re\n+else:\n+    import regex as re\n \n \n class EnglishNormalizer:\n@@ -199,12 +206,12 @@ def normalize_numbers(self, text: str) -> str:\n         This method is used to normalize numbers within a text such as converting the numbers to words, removing\n         commas, etc.\n         \"\"\"\n-        text = re.sub(re.compile(r\"([0-9][0-9\\,]+[0-9])\"), self._remove_commas, text)\n-        text = re.sub(re.compile(r\"£([0-9\\,]*[0-9]+)\"), r\"\\1 pounds\", text)\n-        text = re.sub(re.compile(r\"\\$([0-9\\.\\,]*[0-9]+)\"), self._expand_dollars, text)\n-        text = re.sub(re.compile(r\"([0-9]+\\.[0-9]+)\"), self._expand_decimal_point, text)\n-        text = re.sub(re.compile(r\"[0-9]+(st|nd|rd|th)\"), self._expand_ordinal, text)\n-        text = re.sub(re.compile(r\"[0-9]+\"), self._expand_number, text)\n+        text = re.sub(r\"([0-9][0-9,]+[0-9])\", self._remove_commas, text)\n+        text = re.sub(r\"£([0-9,]*[0-9])\", r\"\\1 pounds\", text)\n+        text = re.sub(r\"\\$([0-9.,]*[0-9])\", self._expand_dollars, text)\n+        text = re.sub(r\"([0-9]++\\.[0-9]+)\", self._expand_decimal_point, text)\n+        text = re.sub(r\"[0-9]++(st|nd|rd|th)\", self._expand_ordinal, text)\n+        text = re.sub(r\"[0-9]+\", self._expand_number, text)\n         return text\n \n     def expand_abbreviations(self, text: str) -> str:"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 14,
        "deletions": 7
    }
}