{
    "author": "zucchini-nlp",
    "message": "Fix video processing channel format (#41603)\n\nfix",
    "sha": "7bba4d12025b2e76aa0962a0dbacd4bf944d19a9",
    "files": [
        {
            "sha": "184860978d0ef08d5d4ea2fb1537068aa44b7855",
            "filename": "src/transformers/video_processing_utils.py",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/7bba4d12025b2e76aa0962a0dbacd4bf944d19a9/src%2Ftransformers%2Fvideo_processing_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/7bba4d12025b2e76aa0962a0dbacd4bf944d19a9/src%2Ftransformers%2Fvideo_processing_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fvideo_processing_utils.py?ref=7bba4d12025b2e76aa0962a0dbacd4bf944d19a9",
            "patch": "@@ -57,12 +57,12 @@\n     VideoInput,\n     VideoMetadata,\n     group_videos_by_shape,\n+    infer_channel_dimension_format,\n     is_valid_video,\n     load_video,\n     make_batched_metadata,\n     make_batched_videos,\n     reorder_videos,\n-    to_channel_dimension_format,\n )\n \n \n@@ -338,10 +338,16 @@ def _prepare_input_videos(\n         for video in videos:\n             # `make_batched_videos` always returns a 4D array per video\n             if isinstance(video, np.ndarray):\n-                video = to_channel_dimension_format(video, ChannelDimension.FIRST, input_data_format)\n                 # not using F.to_tensor as it doesn't handle (C, H, W) numpy arrays\n                 video = torch.from_numpy(video).contiguous()\n \n+            # Infer the channel dimension format if not provided\n+            if input_data_format is None:\n+                input_data_format = infer_channel_dimension_format(video)\n+\n+            if input_data_format == ChannelDimension.LAST:\n+                video = video.permute(0, 3, 1, 2).contiguous()\n+\n             if device is not None:\n                 video = video.to(device)\n "
        }
    ],
    "stats": {
        "total": 10,
        "additions": 8,
        "deletions": 2
    }
}