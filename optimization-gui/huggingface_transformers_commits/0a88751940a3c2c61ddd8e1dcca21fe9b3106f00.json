{
    "author": "sebastianvlad1",
    "message": "Fixes #39204: add fallback if get_base_model missing (#39226)\n\n* Fixes #39204: add fallback if get_base_model missing\n\n* Inline try_get_base_model logic as suggested in PR review\n\n* Apply style fixes\n\n---------\n\nCo-authored-by: github-actions[bot] <github-actions[bot]@users.noreply.github.com>",
    "sha": "0a88751940a3c2c61ddd8e1dcca21fe9b3106f00",
    "files": [
        {
            "sha": "cd0cc7d7da977f5457edff96f0bcdc56414ee284",
            "filename": "src/transformers/trainer.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/0a88751940a3c2c61ddd8e1dcca21fe9b3106f00/src%2Ftransformers%2Ftrainer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0a88751940a3c2c61ddd8e1dcca21fe9b3106f00/src%2Ftransformers%2Ftrainer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftrainer.py?ref=0a88751940a3c2c61ddd8e1dcca21fe9b3106f00",
            "patch": "@@ -631,7 +631,12 @@ def __init__(\n         unwrapped_model = self.accelerator.unwrap_model(model)\n         # We also unwrap peft model\n         if _is_peft_model(unwrapped_model):\n-            unwrapped_model = unwrapped_model.get_base_model()\n+            if hasattr(unwrapped_model, \"get_base_model\"):\n+                unwrapped_model = unwrapped_model.get_base_model()\n+            elif hasattr(unwrapped_model, \"base_model\") and hasattr(unwrapped_model.base_model, \"model\"):\n+                unwrapped_model = unwrapped_model.base_model.model\n+            else:\n+                raise AttributeError(\"Cannot extract base model safely from this PEFT wrapper.\")\n \n         # Check if the model has explicit setup for loss kwargs,\n         # if not, check if `**kwargs` are in model.forward"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
    }
}