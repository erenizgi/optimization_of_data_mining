{
    "author": "ydshieh",
    "message": "Trigger CircleCI via GitHub Actions when `ready for review` (#37885)\n\n* update\n\n* update\n\n* update\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "d4985288002b89ba1f9b4feec3f13b16fd2864cb",
    "files": [
        {
            "sha": "f1cd43d7e104987b74aee2b9ce146d3f0174b003",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 18,
            "deletions": 2,
            "changes": 20,
            "blob_url": "https://github.com/huggingface/transformers/blob/d4985288002b89ba1f9b4feec3f13b16fd2864cb/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/d4985288002b89ba1f9b4feec3f13b16fd2864cb/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.circleci%2Fconfig.yml?ref=d4985288002b89ba1f9b4feec3f13b16fd2864cb",
            "patch": "@@ -7,6 +7,18 @@ parameters:\n     nightly:\n         type: boolean\n         default: false\n+    GHA_Actor:\n+        type: string\n+        default: \"\"\n+    GHA_Action:\n+        type: string\n+        default: \"\"\n+    GHA_Event:\n+        type: string\n+        default: \"\"\n+    GHA_Meta:\n+        type: string\n+        default: \"\"\n \n jobs:\n     # Ensure running with CircleCI/huggingface\n@@ -31,8 +43,12 @@ jobs:\n         parallelism: 1\n         steps:\n             - checkout\n-            - run: if [[ \"$CIRCLE_PULL_REQUEST\" == \"\" && \"$CIRCLE_BRANCH\" != \"main\" && \"$CIRCLE_BRANCH\" != *-release ]]; then echo \"Not a PR, not the main branch and not a release branch, skip test!\"; circleci-agent step halt; fi\n-            - run: 'curl -L -H \"Accept: application/vnd.github+json\" -H \"X-GitHub-Api-Version: 2022-11-28\" https://api.github.com/repos/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME/pulls/${CIRCLE_PULL_REQUEST##*/} >> github.txt'\n+            - run: git branch\n+            - run: git log -n 1\n+            - run: python3 utils/extract_pr_number_from_circleci.py > pr_number.txt\n+            - run: echo $(cat pr_number.txt)\n+            - run: if [[ \"$(cat pr_number.txt)\" == \"\" && \"$CIRCLE_BRANCH\" != \"main\" && \"$CIRCLE_BRANCH\" != *-release ]]; then echo \"Not a PR, not the main branch and not a release branch, skip test!\"; circleci-agent step halt; fi\n+            - run: 'curl -L -H \"Accept: application/vnd.github+json\" -H \"X-GitHub-Api-Version: 2022-11-28\" https://api.github.com/repos/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME/pulls/$(cat pr_number.txt) >> github.txt'\n             - run: cat github.txt\n             - run: (python3 -c 'import json; from datetime import datetime; fp = open(\"github.txt\"); data = json.load(fp); fp.close(); f = \"%Y-%m-%dT%H:%M:%SZ\"; created = datetime.strptime(data[\"created_at\"], f); updated = datetime.strptime(data[\"updated_at\"], f); s = (updated - created).total_seconds(); print(int(s))' || true) > elapsed.txt\n             - run: if [ \"$(cat elapsed.txt)\" == \"\" ]; then echo 60 > elapsed.txt; fi"
        },
        {
            "sha": "0ec793a66de7e7185cb77c97484c8c7d5b8c946b",
            "filename": ".circleci/create_circleci_config.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/d4985288002b89ba1f9b4feec3f13b16fd2864cb/.circleci%2Fcreate_circleci_config.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/d4985288002b89ba1f9b4feec3f13b16fd2864cb/.circleci%2Fcreate_circleci_config.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.circleci%2Fcreate_circleci_config.py?ref=d4985288002b89ba1f9b4feec3f13b16fd2864cb",
            "patch": "@@ -398,7 +398,12 @@ def create_circleci_config(folder=None):\n         \"parameters\": {\n             # Only used to accept the parameters from the trigger\n             \"nightly\": {\"type\": \"boolean\", \"default\": False},\n-            \"tests_to_run\": {\"type\": \"string\", \"default\": ''},\n+            # Only used to accept the parameters from GitHub Actions trigger\n+            \"GHA_Actor\": {\"type\": \"string\", \"default\": \"\"},\n+            \"GHA_Action\": {\"type\": \"string\", \"default\": \"\"},\n+            \"GHA_Event\": {\"type\": \"string\", \"default\": \"\"},\n+            \"GHA_Meta\": {\"type\": \"string\", \"default\": \"\"},\n+            \"tests_to_run\": {\"type\": \"string\", \"default\": \"\"},\n             **{j.job_name + \"_test_list\":{\"type\":\"string\", \"default\":''} for j in jobs},\n             **{j.job_name + \"_parallelism\":{\"type\":\"integer\", \"default\":1} for j in jobs},\n         },"
        },
        {
            "sha": "c278610eccf8b0eb31aedd1c79fd26475872cc1e",
            "filename": ".github/workflows/trigger_circleci.yml",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/huggingface/transformers/blob/d4985288002b89ba1f9b4feec3f13b16fd2864cb/.github%2Fworkflows%2Ftrigger_circleci.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/d4985288002b89ba1f9b4feec3f13b16fd2864cb/.github%2Fworkflows%2Ftrigger_circleci.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Ftrigger_circleci.yml?ref=d4985288002b89ba1f9b4feec3f13b16fd2864cb",
            "patch": "@@ -0,0 +1,16 @@\n+name: Trigger CircleCI\n+\n+on:\n+  pull_request_target:\n+    types: [ready_for_review]\n+\n+jobs:\n+  trigger-circleci:\n+    runs-on: ubuntu-22.04\n+    steps:\n+      - name: trigger CircleCI pipeline via GitHub Actions\n+        uses: CircleCI-Public/trigger-circleci-pipeline-action@v1.0.5\n+        with:\n+          GHA_Meta: \"Trigger via GitHub Actions\"\n+        env:\n+          CCI_TOKEN: ${{ secrets.CIRCLECI_PAT }}"
        },
        {
            "sha": "8dbfcb60a53284a7f739452cd7a8a7aaf3119fc2",
            "filename": "utils/extract_pr_number_from_circleci.py",
            "status": "added",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/huggingface/transformers/blob/d4985288002b89ba1f9b4feec3f13b16fd2864cb/utils%2Fextract_pr_number_from_circleci.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/d4985288002b89ba1f9b4feec3f13b16fd2864cb/utils%2Fextract_pr_number_from_circleci.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Fextract_pr_number_from_circleci.py?ref=d4985288002b89ba1f9b4feec3f13b16fd2864cb",
            "patch": "@@ -0,0 +1,31 @@\n+# coding=utf-8\n+# Copyright 2025 The HuggingFace Inc. team.\n+#\n+# Licensed under the Apache License, Version 2.0 (the \"License\");\n+# you may not use this file except in compliance with the License.\n+# You may obtain a copy of the License at\n+#\n+#     http://www.apache.org/licenses/LICENSE-2.0\n+#\n+# Unless required by applicable law or agreed to in writing, software\n+# distributed under the License is distributed on an \"AS IS\" BASIS,\n+# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+# See the License for the specific language governing permissions and\n+# limitations under the License.\n+\"\"\"Used by `.github/workflows/trigger_circleci.yml` to get the pull request number in CircleCI job runs.\"\"\"\n+\n+import os\n+\n+\n+if __name__ == \"__main__\":\n+    pr_number = \"\"\n+\n+    pr = os.environ.get(\"CIRCLE_PULL_REQUEST\", \"\")\n+    if len(pr) > 0:\n+        pr_number = pr.split(\"/\")[-1]\n+    if pr_number == \"\":\n+        pr = os.environ.get(\"CIRCLE_BRANCH\", \"\")\n+        if pr.startswith(\"pull/\"):\n+            pr_number = \"\".join(pr.split(\"/\")[1:2])\n+\n+    print(pr_number)"
        }
    ],
    "stats": {
        "total": 74,
        "additions": 71,
        "deletions": 3
    }
}