{
    "author": "Isotr0py",
    "message": "Fix idefics3 vision embeddings indices dtype (#40360)\n\nfix idefics3 vision embeddings\n\nSigned-off-by: Isotr0py <mozf@mail2.sysu.edu.cn>",
    "sha": "d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4",
    "files": [
        {
            "sha": "00b8b18cd3d135a91c68f793b2b9f7631b32398f",
            "filename": "src/transformers/models/idefics2/modeling_idefics2.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4/src%2Ftransformers%2Fmodels%2Fidefics2%2Fmodeling_idefics2.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4/src%2Ftransformers%2Fmodels%2Fidefics2%2Fmodeling_idefics2.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fidefics2%2Fmodeling_idefics2.py?ref=d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4",
            "patch": "@@ -152,8 +152,8 @@ def forward(self, pixel_values: torch.FloatTensor, patch_attention_mask: torch.B\n             nb_patches_h = p_attn_mask[:, 0].sum()\n             nb_patches_w = p_attn_mask[0].sum()\n \n-            h_indices = torch.arange(nb_patches_h, device=position_ids.device, dtype=position_ids.dtype)\n-            w_indices = torch.arange(nb_patches_w, device=position_ids.device, dtype=position_ids.dtype)\n+            h_indices = torch.arange(nb_patches_h, device=position_ids.device, dtype=pixel_values.dtype)\n+            w_indices = torch.arange(nb_patches_w, device=position_ids.device, dtype=pixel_values.dtype)\n \n             fractional_coords_h = h_indices / nb_patches_h * (1 - 1e-6)\n             fractional_coords_w = w_indices / nb_patches_w * (1 - 1e-6)"
        },
        {
            "sha": "decbd2ede5004e54775285fa057d92ac5ac8f69a",
            "filename": "src/transformers/models/idefics3/modeling_idefics3.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4/src%2Ftransformers%2Fmodels%2Fidefics3%2Fmodeling_idefics3.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4/src%2Ftransformers%2Fmodels%2Fidefics3%2Fmodeling_idefics3.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fidefics3%2Fmodeling_idefics3.py?ref=d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4",
            "patch": "@@ -151,8 +151,8 @@ def forward(self, pixel_values: torch.FloatTensor, patch_attention_mask: torch.B\n             nb_patches_h = p_attn_mask[:, 0].sum()\n             nb_patches_w = p_attn_mask[0].sum()\n \n-            h_indices = torch.arange(nb_patches_h, device=position_ids.device, dtype=position_ids.dtype)\n-            w_indices = torch.arange(nb_patches_w, device=position_ids.device, dtype=position_ids.dtype)\n+            h_indices = torch.arange(nb_patches_h, device=position_ids.device, dtype=pixel_values.dtype)\n+            w_indices = torch.arange(nb_patches_w, device=position_ids.device, dtype=pixel_values.dtype)\n \n             fractional_coords_h = h_indices / nb_patches_h * (1 - 1e-6)\n             fractional_coords_w = w_indices / nb_patches_w * (1 - 1e-6)"
        },
        {
            "sha": "58b175a71c4fdb5561d5f9ce3bd5a670840dd2b1",
            "filename": "src/transformers/models/smolvlm/modeling_smolvlm.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4/src%2Ftransformers%2Fmodels%2Fsmolvlm%2Fmodeling_smolvlm.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4/src%2Ftransformers%2Fmodels%2Fsmolvlm%2Fmodeling_smolvlm.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fsmolvlm%2Fmodeling_smolvlm.py?ref=d7fe3111ff1ad3518bb3fe02e376f1f487e1daf4",
            "patch": "@@ -146,8 +146,8 @@ def forward(self, pixel_values: torch.FloatTensor, patch_attention_mask: torch.B\n             nb_patches_h = p_attn_mask[:, 0].sum()\n             nb_patches_w = p_attn_mask[0].sum()\n \n-            h_indices = torch.arange(nb_patches_h, device=position_ids.device, dtype=position_ids.dtype)\n-            w_indices = torch.arange(nb_patches_w, device=position_ids.device, dtype=position_ids.dtype)\n+            h_indices = torch.arange(nb_patches_h, device=position_ids.device, dtype=pixel_values.dtype)\n+            w_indices = torch.arange(nb_patches_w, device=position_ids.device, dtype=pixel_values.dtype)\n \n             fractional_coords_h = h_indices / nb_patches_h * (1 - 1e-6)\n             fractional_coords_w = w_indices / nb_patches_w * (1 - 1e-6)"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 6,
        "deletions": 6
    }
}