{
    "author": "zheliuyu",
    "message": "Expand npu device for KernelConfig (#42358)",
    "sha": "6b4b7bf8bbb739c95a76ea3c616eb6dbd4e848c7",
    "files": [
        {
            "sha": "f6400053a4349beb737cc8e77edc828c163c3246",
            "filename": "src/transformers/utils/kernel_config.py",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/huggingface/transformers/blob/6b4b7bf8bbb739c95a76ea3c616eb6dbd4e848c7/src%2Ftransformers%2Futils%2Fkernel_config.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/6b4b7bf8bbb739c95a76ea3c616eb6dbd4e848c7/src%2Ftransformers%2Futils%2Fkernel_config.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2Fkernel_config.py?ref=6b4b7bf8bbb739c95a76ea3c616eb6dbd4e848c7",
            "patch": "@@ -57,8 +57,8 @@ def infer_device(model):\n def add_to_mapping(layer_name, device, repo_name, mode, compatible_mapping):\n     from kernels import LayerRepository\n \n-    if device not in [\"cuda\", \"rocm\", \"xpu\"]:\n-        raise ValueError(f\"Only cuda, rocm, and xpu devices supported, got: {device}\")\n+    if device not in [\"cuda\", \"rocm\", \"xpu\", \"npu\"]:\n+        raise ValueError(f\"Only cuda, rocm, xpu and npu devices supported, got: {device}\")\n     repo_layer_name = repo_name.split(\":\")[1]\n     repo_id = repo_name.split(\":\")[0]\n     compatible_mapping[layer_name] = {\n@@ -102,8 +102,8 @@ def sanitize_kernel_mapping(self, model):\n         \"\"\"\n         Validates the kernel_mapping to ensure that:\n         1. Each layer_name in the mapping is registered in the model (i.e., the model contains a module with a matching kernel_layer_name).\n-        2. Each kernel value is either a string of the form 'org/repo:layer_name' or a dict mapping device types (\"cuda\", \"rocm\", \"xpu\") to such strings.\n-        3. Each device key in a dict is one of \"cuda\", \"rocm\", or \"xpu\".\n+        2. Each kernel value is either a string of the form 'org/repo:layer_name' or a dict mapping device types (\"cuda\", \"rocm\", \"xpu\", \"npu\") to such strings.\n+        3. Each device key in a dict is one of \"cuda\", \"rocm\", \"xpu\", or \"npu\".\n         4. Each repo_name is a valid repository and layer name in the format 'org/repo:layer_name' (i.e., a string containing both a slash and a colon).\n \n         Args:\n@@ -154,8 +154,8 @@ def sanitize_kernel_mapping(self, model):\n \n             elif isinstance(kernel, dict):\n                 for device, repo_name in kernel.items():\n-                    if device not in [\"cuda\", \"rocm\", \"xpu\"]:\n-                        raise ValueError(f\"Only cuda, rocm, and xpu devices supported, got: {device}\")\n+                    if device not in [\"cuda\", \"rocm\", \"xpu\", \"npu\"]:\n+                        raise ValueError(f\"Only cuda, rocm, xpu and npu devices supported, got: {device}\")\n \n                     if not isinstance(repo_name, str) or \"/\" not in repo_name or \":\" not in repo_name:\n                         raise ValueError("
        }
    ],
    "stats": {
        "total": 12,
        "additions": 6,
        "deletions": 6
    }
}