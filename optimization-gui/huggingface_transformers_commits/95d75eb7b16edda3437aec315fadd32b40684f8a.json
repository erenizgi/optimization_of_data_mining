{
    "author": "yonigozlan",
    "message": "Add support for torch device objects in device validator (#42267)\n\nadd support for device objects in device validator",
    "sha": "95d75eb7b16edda3437aec315fadd32b40684f8a",
    "files": [
        {
            "sha": "8422294e9773a0d11634aef943d19b9bf7742782",
            "filename": "src/transformers/processing_utils.py",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/95d75eb7b16edda3437aec315fadd32b40684f8a/src%2Ftransformers%2Fprocessing_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/95d75eb7b16edda3437aec315fadd32b40684f8a/src%2Ftransformers%2Fprocessing_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fprocessing_utils.py?ref=95d75eb7b16edda3437aec315fadd32b40684f8a",
            "patch": "@@ -76,6 +76,8 @@\n \n \n if is_torch_available():\n+    import torch\n+\n     from .modeling_utils import PreTrainedAudioTokenizerBase\n \n if is_vision_available():\n@@ -267,7 +269,7 @@ class methods and docstrings.\n     do_center_crop: Optional[bool]\n     data_format: Optional[Union[str, ChannelDimension]]\n     input_data_format: Optional[Union[str, ChannelDimension]]\n-    device: Annotated[Optional[str], device_validator()]\n+    device: Annotated[Optional[Union[str, \"torch.device\"]], device_validator()]\n     return_tensors: Annotated[Optional[Union[str, TensorType]], tensor_type_validator()]\n     disable_grouping: Optional[bool]\n     image_seq_length: Optional[int]\n@@ -341,7 +343,7 @@ class VideosKwargs(TypedDict, total=False):\n     crop_size: Annotated[Optional[Union[int, list[int], tuple[int, ...], dict[str, int]]], image_size_validator()]\n     data_format: Optional[Union[str, ChannelDimension]]\n     input_data_format: Optional[Union[str, ChannelDimension]]\n-    device: Annotated[Optional[str], device_validator()]\n+    device: Annotated[Optional[Union[str, \"torch.device\"]], device_validator()]\n     do_sample_frames: Optional[bool]\n     video_metadata: Annotated[Optional[VideoMetadataType], video_metadata_validator()]\n     fps: Annotated[Optional[Union[int, float]], positive_any_number()]"
        },
        {
            "sha": "943ca08276a74ba3aba272ed34f1d24f27fd2a90",
            "filename": "src/transformers/utils/type_validators.py",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/huggingface/transformers/blob/95d75eb7b16edda3437aec315fadd32b40684f8a/src%2Ftransformers%2Futils%2Ftype_validators.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/95d75eb7b16edda3437aec315fadd32b40684f8a/src%2Ftransformers%2Futils%2Ftype_validators.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2Ftype_validators.py?ref=95d75eb7b16edda3437aec315fadd32b40684f8a",
            "patch": "@@ -4,12 +4,15 @@\n from ..tokenization_utils_base import PaddingStrategy, TruncationStrategy\n from ..video_utils import VideoMetadataType\n from .generic import TensorType\n-from .import_utils import is_vision_available\n+from .import_utils import is_torch_available, is_vision_available\n \n \n if is_vision_available():\n     from ..image_utils import PILImageResampling\n \n+if is_torch_available():\n+    import torch\n+\n \n def positive_any_number(value: int | float | None = None):\n     if value is not None and (not isinstance(value, (int, float)) or not value >= 0):\n@@ -53,6 +56,12 @@ def device_validator(value: str | int | None = None):\n     possible_names = [\"cpu\", \"cuda\", \"xla\", \"xpu\", \"mps\", \"meta\"]\n     if value is None:\n         pass\n+    elif is_torch_available() and isinstance(value, torch.device):\n+        device_str = str(value)\n+        if device_str.split(\":\")[0] not in possible_names:\n+            raise ValueError(\n+                f\"If device is a torch.device, the value must be one of {possible_names} but got device={value}\"\n+            )\n     elif isinstance(value, int) and value < 0:\n         raise ValueError(\n             f\"If device is an integer, the value must be a strictly positive integer but got device={value}\"\n@@ -61,7 +70,7 @@ def device_validator(value: str | int | None = None):\n         raise ValueError(f\"If device is an string, the value must be one of {possible_names} but got device={value}\")\n     elif not isinstance(value, (int, str)):\n         raise ValueError(\n-            f\"Device must be either an integer device ID or a string (e.g., 'cpu', 'cuda:0'), but got device={value}\"\n+            f\"Device must be either an integer device ID, a string (e.g., 'cpu', 'cuda:0'), or a torch.device object, but got device={value}\"\n         )\n \n "
        }
    ],
    "stats": {
        "total": 19,
        "additions": 15,
        "deletions": 4
    }
}