{
    "author": "yao-matrix",
    "message": "upgrade xpu docker file to torch 2.8 (#41551)\n\n* upgrade xpu docker file to torch 2.8\n\nSigned-off-by: Yao, Matrix <matrix.yao@intel.com>\n\n* Update Dockerfile\n\n---------\n\nSigned-off-by: Yao, Matrix <matrix.yao@intel.com>",
    "sha": "4e50b8459d981ddcbc9438e85cff8d83fe40a500",
    "files": [
        {
            "sha": "f9ea2a383becac50fe1cc742160a7bc08a76edfa",
            "filename": "docker/transformers-pytorch-xpu/Dockerfile",
            "status": "modified",
            "additions": 27,
            "deletions": 17,
            "changes": 44,
            "blob_url": "https://github.com/huggingface/transformers/blob/4e50b8459d981ddcbc9438e85cff8d83fe40a500/docker%2Ftransformers-pytorch-xpu%2FDockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/4e50b8459d981ddcbc9438e85cff8d83fe40a500/docker%2Ftransformers-pytorch-xpu%2FDockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Ftransformers-pytorch-xpu%2FDockerfile?ref=4e50b8459d981ddcbc9438e85cff8d83fe40a500",
            "patch": "@@ -3,11 +3,10 @@ LABEL maintainer=\"Hugging Face\"\n \n SHELL [\"/bin/bash\", \"-c\"]\n \n-ARG PYTHON_VER=3.11\n+ARG PYTHON_VER=3.12\n ENV TORCH_DEVICE_BACKEND_AUTOLOAD=0\n ENV DEBIAN_FRONTEND=noninteractive\n \n-RUN apt-get remove -y python3.10 && apt-get autoremove -y\n RUN apt-get update && \\\n     apt-get install -y software-properties-common && \\\n     add-apt-repository -y ppa:deadsnakes/ppa && \\\n@@ -23,7 +22,6 @@ RUN apt-get update && \\\n         apt-utils \\\n         build-essential \\\n         ca-certificates \\\n-        clinfo \\\n         curl \\\n         git \\\n         git-lfs \\\n@@ -35,7 +33,6 @@ RUN apt-get update && \\\n         rsync \\\n         sudo \\\n         libnl-genl-3-200 \\\n-        xpu-smi \\\n         unzip \\\n         ffmpeg \\\n         tesseract-ocr \\\n@@ -45,34 +42,47 @@ RUN apt-get update && \\\n     apt-get clean && \\\n     rm -rf /var/lib/apt/lists/*\n \n-\n RUN apt-get update && \\\n     apt-get install -y \\\n-        linux-headers-$(uname -r) \\\n-        linux-modules-extra-$(uname -r) \\\n+        linux-headers-$(uname -r) linux-modules-extra-$(uname -r) \\\n         flex bison \\\n-        intel-fw-gpu intel-i915-dkms xpu-smi \\\n+        intel-fw-gpu intel-i915-dkms xpu-smi intel-ocloc clinfo\\\n         intel-opencl-icd libze-intel-gpu1 libze1 \\\n         intel-media-va-driver-non-free libmfx-gen1 libvpl2 \\\n-        libegl-mesa0 libegl1-mesa libegl1-mesa-dev libgbm1 libgl1-mesa-dev libgl1-mesa-dri \\\n+        libegl-mesa0 libegl1 libegl1-mesa-dev libgbm1 libgl1-mesa-dev libgl1-mesa-dri \\\n         libglapi-mesa libglx-mesa0 libigdgmm12 libxatracker2 mesa-va-drivers \\\n-        mesa-vdpau-drivers mesa-vulkan-drivers va-driver-all vainfo hwinfo clinfo intel-ocloc \\\n+        mesa-vdpau-drivers mesa-vulkan-drivers va-driver-all vainfo hwinfo \\\n         libigc-dev intel-igc-cm libigdfcl-dev libigfxcmrt-dev libze-dev && \\\n     apt-get clean && \\\n     rm -rf  /var/lib/apt/lists/*\n \n-RUN pip install --upgrade pip\n-RUN pip install triton==3.3.0\n+# Use virtual env because Ubuntu-24 does not allowed pip on original python\n+RUN curl -LsSf https://astral.sh/uv/install.sh | sh\n+ENV PATH=\"/root/.local/bin:$PATH\"\n+ENV VIRTUAL_ENV=\"/opt/venv\"\n+ENV UV_PYTHON_INSTALL_DIR=/opt/uv/python\n+RUN uv venv --python ${PYTHON_VER} --seed ${VIRTUAL_ENV}\n+ENV PATH=\"$VIRTUAL_ENV/bin:$PATH\"\n+\n+RUN pip install --upgrade pip wheel\n+RUN pip install triton==3.4.0\n \n-RUN pip install torch==2.7.0 torchvision==0.22.0 torchaudio==2.7.0 --index-url https://download.pytorch.org/whl/xpu --no-cache-dir\n+RUN pip install torch==2.8.0+xpu torchvision==0.23.0+xpu torchaudio==2.8.0+xpu --index-url https://download.pytorch.org/whl/xpu --no-cache-dir\n \n-RUN pip install evaluate torchdata pyctcdecode pytesseract decord galore-torch fire scipy scikit-learn sentencepiece sacremoses nltk rouge_score librosa soundfile g2p_en mpi4py requests_mock\n-RUN pip install pretty_midi essentia resampy Levenshtein av sacrebleu phonemizer invisible_watermark schedulefree\n-RUN pip install gguf hqq compressed_tensors gptqmodel mergekit autoawq deepspeed torchao onnx\n-RUN pip install hf_transfer huggingface-hub hf-doc-builder datasets optimum-quanto timm transformers accelerate optimum peft\n+RUN pip install torchcodec torchdata --no-cache-dir\n \n+RUN pip install evaluate pyctcdecode pytesseract decord galore-torch fire scipy scikit-learn sentencepiece sacremoses nltk rouge_score librosa soundfile g2p_en mpi4py requests_mock\n+RUN pip install pretty_midi essentia resampy Levenshtein av sacrebleu phonemizer invisible_watermark schedulefree setuptools\n+RUN pip install gptqmodel --no-build-isolation\n+RUN pip install gguf hqq compressed_tensors autoawq deepspeed torchao onnx auto_round\n+RUN pip install hf_transfer huggingface-hub hf-doc-builder datasets optimum-quanto timm transformers accelerate optimum peft diffusers trl kernels\n+\n+# install liger-kernel\n RUN pip install git+https://github.com/linkedin/Liger-Kernel.git --extra-index-url https://download.pytorch.org/whl/test/xpu\n \n+# install mergekit\n+RUN pip install --break-system-packages git+https://github.com/arcee-ai/mergekit.git@v0.1.3\n+\n # install bitsandbytes\n RUN pip install git+https://github.com/bitsandbytes-foundation/bitsandbytes.git\n "
        }
    ],
    "stats": {
        "total": 44,
        "additions": 27,
        "deletions": 17
    }
}