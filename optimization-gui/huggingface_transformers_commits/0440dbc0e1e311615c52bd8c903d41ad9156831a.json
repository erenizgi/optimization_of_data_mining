{
    "author": "ShaohonChen",
    "message": "Integrate SwanLab for offline/online experiment tracking and local visualization (#36433)\n\n* add swanlab integration\n\n* feat(integrate): add SwanLab as an optional experiment tracking tool in transformers\n\n- Integrated SwanLab into the transformers library as an alternative for experiment tracking.\n- Users can now log training metrics, hyperparameters, and other experiment details to SwanLab by setting `report_to=\"swanlab\"` in the `TrainingArguments`.\n- Added necessary dependencies and documentation for SwanLab integration.\n\n* Fix the spelling error of SwanLabCallback in callback.md\n\n* Apply suggestions from code review\n\nCo-authored-by: Marc Sun <57196510+SunMarc@users.noreply.github.com>\n\n* Fix typo in comment\n\n* Fix typo in comment\n\n* Fix typos and update comments\n\n* fix annotation\n\n* chore: opt some comments\n\n---------\n\nCo-authored-by: Marc Sun <57196510+SunMarc@users.noreply.github.com>\nCo-authored-by: AAssets <20010618@qq.com>\nCo-authored-by: ZeYi Lin <944270057@qq.com>\nCo-authored-by: KAAANG <79990647+SAKURA-CAT@users.noreply.github.com>",
    "sha": "0440dbc0e1e311615c52bd8c903d41ad9156831a",
    "files": [
        {
            "sha": "99f76b7b05e43f855d2f76485bc8cbed42618541",
            "filename": "docs/source/en/main_classes/callback.md",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/docs%2Fsource%2Fen%2Fmain_classes%2Fcallback.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/docs%2Fsource%2Fen%2Fmain_classes%2Fcallback.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmain_classes%2Fcallback.md?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -45,6 +45,7 @@ By default, `TrainingArguments.report_to` is set to `\"all\"`, so a [`Trainer`] wi\n - [`~integrations.DagsHubCallback`] if [dagshub](https://dagshub.com/) is installed.\n - [`~integrations.FlyteCallback`] if [flyte](https://flyte.org/) is installed.\n - [`~integrations.DVCLiveCallback`] if [dvclive](https://dvc.org/doc/dvclive) is installed.\n+- [`~integrations.SwanLabCallback`] if [swanlab](http://swanlab.cn/) is installed.\n \n If a package is installed but you don't wish to use the accompanying integration, you can change `TrainingArguments.report_to` to a list of just those integrations you want to use (e.g. `[\"azure_ml\", \"wandb\"]`). \n \n@@ -92,6 +93,9 @@ Here is the list of the available [`TrainerCallback`] in the library:\n [[autodoc]] integrations.DVCLiveCallback\n     - setup\n \n+[[autodoc]] integrations.SwanLabCallback\n+    - setup\n+\n ## TrainerCallback\n \n [[autodoc]] TrainerCallback"
        },
        {
            "sha": "f1cb357f7eb8f49f27b8285ec0a9a53734c3f43a",
            "filename": "docs/source/ja/main_classes/callback.md",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/docs%2Fsource%2Fja%2Fmain_classes%2Fcallback.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/docs%2Fsource%2Fja%2Fmain_classes%2Fcallback.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fja%2Fmain_classes%2Fcallback.md?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -46,6 +46,7 @@ rendered properly in your Markdown viewer.\n - [`~integrations.DagsHubCallback`] [dagshub](https://dagshub.com/) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆã€‚\n - [`~integrations.FlyteCallback`] [flyte](https://flyte.org/) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆã€‚\n - [`~integrations.DVCLiveCallback`] [dvclive](https://www.dvc.org/doc/dvclive) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆã€‚\n+- [`~integrations.SwanLabCallback`] [swanlab](http://swanlab.cn/) ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹å ´åˆã€‚\n \n ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹ãŒã€ä»˜éšã™ã‚‹çµ±åˆã‚’ä½¿ç”¨ã—ãŸããªã„å ´åˆã¯ã€`TrainingArguments.report_to` ã‚’ã€ä½¿ç”¨ã—ãŸã„çµ±åˆã®ã¿ã®ãƒªã‚¹ãƒˆã«å¤‰æ›´ã§ãã¾ã™ (ä¾‹: `[\"azure_ml\", \"wandb\"]`) ã€‚\n \n@@ -92,6 +93,9 @@ rendered properly in your Markdown viewer.\n [[autodoc]] integrations.DVCLiveCallback\n     - setup\n \n+[[autodoc]] integrations.SwanLabCallback\n+    - setup\n+\n ## TrainerCallback\n \n [[autodoc]] TrainerCallback"
        },
        {
            "sha": "c8d122a8ef9247089b27d2d8b6a21d667bffa45b",
            "filename": "docs/source/ko/main_classes/callback.md",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/docs%2Fsource%2Fko%2Fmain_classes%2Fcallback.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/docs%2Fsource%2Fko%2Fmain_classes%2Fcallback.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fko%2Fmain_classes%2Fcallback.md?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -45,6 +45,7 @@ rendered properly in your Markdown viewer.\n - [`~integrations.DagsHubCallback`]ëŠ” [dagshub](https://dagshub.com/)ì´ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì‚¬ìš©ë©ë‹ˆë‹¤.\n - [`~integrations.FlyteCallback`]ëŠ” [flyte](https://flyte.org/)ê°€ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì‚¬ìš©ë©ë‹ˆë‹¤.\n - [`~integrations.DVCLiveCallback`]ëŠ” [dvclive](https://dvc.org/doc/dvclive)ê°€ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì‚¬ìš©ë©ë‹ˆë‹¤.\n+- [`~integrations.SwanLabCallback`]ëŠ” [swanlab](https://swanlab.cn)ê°€ ì„¤ì¹˜ë˜ì–´ ìˆìœ¼ë©´ ì‚¬ìš©ë©ë‹ˆë‹¤.\n \n íŒ¨í‚¤ì§€ê°€ ì„¤ì¹˜ë˜ì–´ ìˆì§€ë§Œ í•´ë‹¹ í†µí•© ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ê³  ì‹¶ì§€ ì•Šë‹¤ë©´, `TrainingArguments.report_to`ë¥¼ ì‚¬ìš©í•˜ê³ ì í•˜ëŠ” í†µí•© ê¸°ëŠ¥ ëª©ë¡ìœ¼ë¡œ ë³€ê²½í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤ (ì˜ˆ: `[\"azure_ml\", \"wandb\"]`).\n \n@@ -92,6 +93,9 @@ rendered properly in your Markdown viewer.\n [[autodoc]] integrations.DVCLiveCallback\n     - setup\n \n+[[autodoc]] integrations.SwanLabCallback\n+    - setup\n+\n ## TrainerCallback [[trainercallback]]\n \n [[autodoc]] TrainerCallback"
        },
        {
            "sha": "36c1898f018b8f7a3d36bdf7009a28cada6c3d81",
            "filename": "docs/source/zh/main_classes/callback.md",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/docs%2Fsource%2Fzh%2Fmain_classes%2Fcallback.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/docs%2Fsource%2Fzh%2Fmain_classes%2Fcallback.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fzh%2Fmain_classes%2Fcallback.md?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -37,6 +37,7 @@ Callbacksæ˜¯â€œåªè¯»â€çš„ä»£ç ç‰‡æ®µï¼Œé™¤äº†å®ƒä»¬è¿”å›çš„[TrainerControl]\n - [`~integrations.DagsHubCallback`]ï¼Œå¦‚æœå®‰è£…äº†[dagshub](https://dagshub.com/)ã€‚\n - [`~integrations.FlyteCallback`]ï¼Œå¦‚æœå®‰è£…äº†[flyte](https://flyte.org/)ã€‚\n - [`~integrations.DVCLiveCallback`]ï¼Œå¦‚æœå®‰è£…äº†[dvclive](https://dvc.org/doc/dvclive)ã€‚\n+- [`~integrations.SwanLabCallback`]ï¼Œå¦‚æœå®‰è£…äº†[swanlab](http://swanlab.cn/)ã€‚\n \n å¦‚æœå®‰è£…äº†ä¸€ä¸ªè½¯ä»¶åŒ…ï¼Œä½†æ‚¨ä¸å¸Œæœ›ä½¿ç”¨ç›¸å…³çš„é›†æˆï¼Œæ‚¨å¯ä»¥å°† `TrainingArguments.report_to` æ›´æ”¹ä¸ºä»…åŒ…å«æ‚¨æƒ³è¦ä½¿ç”¨çš„é›†æˆçš„åˆ—è¡¨ï¼ˆä¾‹å¦‚ `[\"azure_ml\", \"wandb\"]`ï¼‰ã€‚\n \n@@ -81,6 +82,9 @@ Callbacksæ˜¯â€œåªè¯»â€çš„ä»£ç ç‰‡æ®µï¼Œé™¤äº†å®ƒä»¬è¿”å›çš„[TrainerControl]\n [[autodoc]] integrations.DVCLiveCallback\n     - setup\n \n+[[autodoc]] integrations.SwanLabCallback\n+    - setup\n+\n ## TrainerCallback\n \n [[autodoc]] TrainerCallback"
        },
        {
            "sha": "12ac2c60d75f76c967e92d30479a31fdbb979659",
            "filename": "src/transformers/__init__.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2F__init__.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2F__init__.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2F__init__.py?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -141,6 +141,7 @@\n         \"is_ray_available\",\n         \"is_ray_tune_available\",\n         \"is_sigopt_available\",\n+        \"is_swanlab_available\",\n         \"is_tensorboard_available\",\n         \"is_wandb_available\",\n     ],\n@@ -5267,6 +5268,7 @@\n         is_ray_available,\n         is_ray_tune_available,\n         is_sigopt_available,\n+        is_swanlab_available,\n         is_tensorboard_available,\n         is_wandb_available,\n     )"
        },
        {
            "sha": "5c94349cbc1a9c4ecc191a148be5b31569182d22",
            "filename": "src/transformers/integrations/__init__.py",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Fintegrations%2F__init__.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Fintegrations%2F__init__.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fintegrations%2F__init__.py?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -63,7 +63,12 @@\n         \"load_dequant_gguf_tensor\",\n         \"load_gguf\",\n     ],\n-    \"higgs\": [\"HiggsLinear\", \"dequantize_higgs\", \"quantize_with_higgs\", \"replace_with_higgs_linear\"],\n+    \"higgs\": [\n+        \"HiggsLinear\",\n+        \"dequantize_higgs\",\n+        \"quantize_with_higgs\",\n+        \"replace_with_higgs_linear\",\n+    ],\n     \"hqq\": [\"prepare_for_hqq_linear\"],\n     \"integration_utils\": [\n         \"INTEGRATION_TO_CALLBACK\",\n@@ -77,6 +82,7 @@\n         \"MLflowCallback\",\n         \"NeptuneCallback\",\n         \"NeptuneMissingConfiguration\",\n+        \"SwanLabCallback\",\n         \"TensorBoardCallback\",\n         \"WandbCallback\",\n         \"get_available_reporting_integrations\",\n@@ -96,6 +102,7 @@\n         \"is_ray_available\",\n         \"is_ray_tune_available\",\n         \"is_sigopt_available\",\n+        \"is_swanlab_available\",\n         \"is_tensorboard_available\",\n         \"is_wandb_available\",\n         \"rewrite_logs\",\n@@ -182,6 +189,7 @@\n         MLflowCallback,\n         NeptuneCallback,\n         NeptuneMissingConfiguration,\n+        SwanLabCallback,\n         TensorBoardCallback,\n         WandbCallback,\n         get_available_reporting_integrations,\n@@ -201,6 +209,7 @@\n         is_ray_available,\n         is_ray_tune_available,\n         is_sigopt_available,\n+        is_swanlab_available,\n         is_tensorboard_available,\n         is_wandb_available,\n         rewrite_logs,"
        },
        {
            "sha": "d5b6983c308ec6a46d630c1a33d54c4b84676158",
            "filename": "src/transformers/integrations/integration_utils.py",
            "status": "modified",
            "additions": 163,
            "deletions": 0,
            "changes": 163,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -204,6 +204,10 @@ def is_dvclive_available():\n     return importlib.util.find_spec(\"dvclive\") is not None\n \n \n+def is_swanlab_available():\n+    return importlib.util.find_spec(\"swanlab\") is not None\n+\n+\n def hp_params(trial):\n     if is_optuna_available():\n         import optuna\n@@ -610,6 +614,8 @@ def get_available_reporting_integrations():\n         integrations.append(\"codecarbon\")\n     if is_clearml_available():\n         integrations.append(\"clearml\")\n+    if is_swanlab_available():\n+        integrations.append(\"swanlab\")\n     return integrations\n \n \n@@ -2141,6 +2147,162 @@ def on_train_end(self, args, state, control, **kwargs):\n             self.live.end()\n \n \n+class SwanLabCallback(TrainerCallback):\n+    \"\"\"\n+    A [`TrainerCallback`] that logs metrics, media, model checkpoints to [SwanLab](https://swanlab.cn/).\n+    \"\"\"\n+\n+    def __init__(self):\n+        if not is_swanlab_available():\n+            raise RuntimeError(\"SwanLabCallback requires swanlab to be installed. Run `pip install swanlab`.\")\n+        import swanlab\n+\n+        self._swanlab = swanlab\n+        self._initialized = False\n+        self._log_model = os.getenv(\"SWANLAB_LOG_MODEL\", None)\n+\n+    def setup(self, args, state, model, **kwargs):\n+        \"\"\"\n+        Setup the optional SwanLab (*swanlab*) integration.\n+\n+        One can subclass and override this method to customize the setup if needed. Find more information\n+        [here](https://docs.swanlab.cn/guide_cloud/integration/integration-huggingface-transformers.html).\n+\n+        You can also override the following environment variables. Find more information about environment\n+        variables [here](https://docs.swanlab.cn/en/api/environment-variable.html#environment-variables)\n+\n+        Environment:\n+        - **SWANLAB_API_KEY** (`str`, *optional*, defaults to `None`):\n+            Cloud API Key. During login, this environment variable is checked first. If it doesn't exist, the system\n+            checks if the user is already logged in. If not, the login process is initiated.\n+\n+                - If a string is passed to the login interface, this environment variable is ignored.\n+                - If the user is already logged in, this environment variable takes precedence over locally stored\n+                login information.\n+\n+        - **SWANLAB_PROJECT** (`str`, *optional*, defaults to `None`):\n+            Set this to a custom string to store results in a different project. If not specified, the name of the current\n+            running directory is used.\n+\n+        - **SWANLAB_LOG_DIR** (`str`, *optional*, defaults to `swanlog`):\n+            This environment variable specifies the storage path for log files when running in local mode.\n+            By default, logs are saved in a folder named swanlog under the working directory.\n+\n+        - **SWANLAB_MODE** (`Literal[\"local\", \"cloud\", \"disabled\"]`, *optional*, defaults to `cloud`):\n+            SwanLab's parsing mode, which involves callbacks registered by the operator. Currently, there are three modes:\n+            local, cloud, and disabled. Note: Case-sensitive. Find more information\n+            [here](https://docs.swanlab.cn/en/api/py-init.html#swanlab-init)\n+\n+        - **SWANLAB_LOG_MODEL** (`str`, *optional*, defaults to `None`):\n+            SwanLab does not currently support the save mode functionality.This feature will be available in a future\n+            release\n+\n+        - **SWANLAB_WEB_HOST** (`str`, *optional*, defaults to `None`):\n+            Web address for the SwanLab cloud environment for private version (its free)\n+\n+        - **SWANLAB_API_HOST** (`str`, *optional*, defaults to `None`):\n+            API address for the SwanLab cloud environment for private version (its free)\n+\n+        \"\"\"\n+        self._initialized = True\n+\n+        if state.is_world_process_zero:\n+            logger.info('Automatic SwanLab logging enabled, to disable set os.environ[\"SWANLAB_MODE\"] = \"disabled\"')\n+            combined_dict = {**args.to_dict()}\n+\n+            if hasattr(model, \"config\") and model.config is not None:\n+                model_config = model.config if isinstance(model.config, dict) else model.config.to_dict()\n+                combined_dict = {**model_config, **combined_dict}\n+            if hasattr(model, \"peft_config\") and model.peft_config is not None:\n+                peft_config = model.peft_config\n+                combined_dict = {**{\"peft_config\": peft_config}, **combined_dict}\n+            trial_name = state.trial_name\n+            init_args = {}\n+            if trial_name is not None:\n+                init_args[\"experiment_name\"] = f\"{args.run_name}-{trial_name}\"\n+            elif args.run_name is not None:\n+                init_args[\"experiment_name\"] = args.run_name\n+            init_args[\"project\"] = os.getenv(\"SWANLAB_PROJECT\", None)\n+\n+            if self._swanlab.get_run() is None:\n+                self._swanlab.init(\n+                    **init_args,\n+                )\n+            # show transformers logo!\n+            self._swanlab.config[\"FRAMEWORK\"] = \"ğŸ¤—transformers\"\n+            # add config parameters (run may have been created manually)\n+            self._swanlab.config.update(combined_dict)\n+\n+            # add number of model parameters to swanlab config\n+            try:\n+                self._swanlab.config.update({\"model_num_parameters\": model.num_parameters()})\n+                # get peft model parameters\n+                if type(model).__name__ == \"PeftModel\" or type(model).__name__ == \"PeftMixedModel\":\n+                    trainable_params, all_param = model.get_nb_trainable_parameters()\n+                    self._swanlab.config.update({\"peft_model_trainable_params\": trainable_params})\n+                    self._swanlab.config.update({\"peft_model_all_param\": all_param})\n+            except AttributeError:\n+                logger.info(\"Could not log the number of model parameters in SwanLab due to an AttributeError.\")\n+\n+            # log the initial model architecture to an artifact\n+            if self._log_model is not None:\n+                logger.warning(\n+                    \"SwanLab does not currently support the save mode functionality. \"\n+                    \"This feature will be available in a future release.\"\n+                )\n+                badge_markdown = (\n+                    f'[<img src=\"https://raw.githubusercontent.com/SwanHubX/assets/main/badge1.svg\"'\n+                    f' alt=\"Visualize in SwanLab\" height=\"28'\n+                    f'0\" height=\"32\"/>]({self._swanlab.get_run().public.cloud.exp_url})'\n+                )\n+\n+                modelcard.AUTOGENERATED_TRAINER_COMMENT += f\"\\n{badge_markdown}\"\n+\n+    def on_train_begin(self, args, state, control, model=None, **kwargs):\n+        if not self._initialized:\n+            self.setup(args, state, model, **kwargs)\n+\n+    def on_train_end(self, args, state, control, model=None, processing_class=None, **kwargs):\n+        if self._log_model is not None and self._initialized and state.is_world_process_zero:\n+            logger.warning(\n+                \"SwanLab does not currently support the save mode functionality. \"\n+                \"This feature will be available in a future release.\"\n+            )\n+\n+    def on_log(self, args, state, control, model=None, logs=None, **kwargs):\n+        single_value_scalars = [\n+            \"train_runtime\",\n+            \"train_samples_per_second\",\n+            \"train_steps_per_second\",\n+            \"train_loss\",\n+            \"total_flos\",\n+        ]\n+\n+        if not self._initialized:\n+            self.setup(args, state, model)\n+        if state.is_world_process_zero:\n+            for k, v in logs.items():\n+                if k in single_value_scalars:\n+                    self._swanlab.log({f\"single_value/{k}\": v})\n+            non_scalar_logs = {k: v for k, v in logs.items() if k not in single_value_scalars}\n+            non_scalar_logs = rewrite_logs(non_scalar_logs)\n+            self._swanlab.log({**non_scalar_logs, \"train/global_step\": state.global_step})\n+\n+    def on_save(self, args, state, control, **kwargs):\n+        if self._log_model is not None and self._initialized and state.is_world_process_zero:\n+            logger.warning(\n+                \"SwanLab does not currently support the save mode functionality. \"\n+                \"This feature will be available in a future release.\"\n+            )\n+\n+    def on_predict(self, args, state, control, metrics, **kwargs):\n+        if not self._initialized:\n+            self.setup(args, state, **kwargs)\n+        if state.is_world_process_zero:\n+            metrics = rewrite_logs(metrics)\n+            self._swanlab.log(metrics)\n+\n+\n INTEGRATION_TO_CALLBACK = {\n     \"azure_ml\": AzureMLCallback,\n     \"comet_ml\": CometCallback,\n@@ -2153,6 +2315,7 @@ def on_train_end(self, args, state, control, **kwargs):\n     \"dagshub\": DagsHubCallback,\n     \"flyte\": FlyteCallback,\n     \"dvclive\": DVCLiveCallback,\n+    \"swanlab\": SwanLabCallback,\n }\n \n "
        },
        {
            "sha": "76d25f61cb150162421e65c870d9bc8ac2dbd767",
            "filename": "src/transformers/testing_utils.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Ftesting_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Ftesting_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftesting_utils.py?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -55,6 +55,7 @@\n     is_optuna_available,\n     is_ray_available,\n     is_sigopt_available,\n+    is_swanlab_available,\n     is_tensorboard_available,\n     is_wandb_available,\n )\n@@ -1098,6 +1099,16 @@ def require_sigopt(test_case):\n     return unittest.skipUnless(is_sigopt_available(), \"test requires SigOpt\")(test_case)\n \n \n+def require_swanlab(test_case):\n+    \"\"\"\n+    Decorator marking a test that requires swanlab.\n+\n+    These tests are skipped when swanlab isn't installed.\n+\n+    \"\"\"\n+    return unittest.skipUnless(is_swanlab_available(), \"test requires swanlab\")(test_case)\n+\n+\n def require_wandb(test_case):\n     \"\"\"\n     Decorator marking a test that requires wandb."
        },
        {
            "sha": "be9f9f7f93b5cde2a19cd81a53be899933220d3b",
            "filename": "src/transformers/training_args.py",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Ftraining_args.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Ftraining_args.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftraining_args.py?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -451,8 +451,8 @@ class TrainingArguments:\n             training step under the keyword argument `mems`.\n         run_name (`str`, *optional*, defaults to `output_dir`):\n             A descriptor for the run. Typically used for [wandb](https://www.wandb.com/),\n-            [mlflow](https://www.mlflow.org/) and [comet](https://www.comet.com/site) logging. If not specified, will\n-            be the same as `output_dir`.\n+            [mlflow](https://www.mlflow.org/), [comet](https://www.comet.com/site) and [swanlab](https://swanlab.cn)\n+            logging. If not specified, will be the same as `output_dir`.\n         disable_tqdm (`bool`, *optional*):\n             Whether or not to disable the tqdm progress bars and table of metrics produced by\n             [`~notebook.NotebookTrainingTracker`] in Jupyter Notebooks. Will default to `True` if the logging level is\n@@ -642,8 +642,8 @@ class TrainingArguments:\n         report_to (`str` or `List[str]`, *optional*, defaults to `\"all\"`):\n             The list of integrations to report the results and logs to. Supported platforms are `\"azure_ml\"`,\n             `\"clearml\"`, `\"codecarbon\"`, `\"comet_ml\"`, `\"dagshub\"`, `\"dvclive\"`, `\"flyte\"`, `\"mlflow\"`, `\"neptune\"`,\n-            `\"tensorboard\"`, and `\"wandb\"`. Use `\"all\"` to report to all integrations installed, `\"none\"` for no\n-            integrations.\n+            `\"swanlab\"`, `\"tensorboard\"`, and `\"wandb\"`. Use `\"all\"` to report to all integrations installed, `\"none\"`\n+            for no integrations.\n         ddp_find_unused_parameters (`bool`, *optional*):\n             When using distributed training, the value of the flag `find_unused_parameters` passed to\n             `DistributedDataParallel`. Will default to `False` if gradient checkpointing is used, `True` otherwise.\n@@ -1187,7 +1187,9 @@ class TrainingArguments:\n \n     run_name: Optional[str] = field(\n         default=None,\n-        metadata={\"help\": \"An optional descriptor for the run. Notably used for wandb, mlflow and comet logging.\"},\n+        metadata={\n+            \"help\": \"An optional descriptor for the run. Notably used for wandb, mlflow comet and swanlab logging.\"\n+        },\n     )\n     disable_tqdm: Optional[bool] = field(\n         default=None, metadata={\"help\": \"Whether or not to disable the tqdm progress bars.\"}\n@@ -2848,8 +2850,8 @@ def set_logging(\n             report_to (`str` or `List[str]`, *optional*, defaults to `\"all\"`):\n                 The list of integrations to report the results and logs to. Supported platforms are `\"azure_ml\"`,\n                 `\"clearml\"`, `\"codecarbon\"`, `\"comet_ml\"`, `\"dagshub\"`, `\"dvclive\"`, `\"flyte\"`, `\"mlflow\"`,\n-                `\"neptune\"`, `\"tensorboard\"`, and `\"wandb\"`. Use `\"all\"` to report to all integrations installed,\n-                `\"none\"` for no integrations.\n+                `\"neptune\"`, `\"swanlab\"`, `\"tensorboard\"`, and `\"wandb\"`. Use `\"all\"` to report to all integrations\n+                installed, `\"none\"` for no integrations.\n             first_step (`bool`, *optional*, defaults to `False`):\n                 Whether to log and evaluate the first `global_step` or not.\n             nan_inf_filter (`bool`, *optional*, defaults to `True`):"
        },
        {
            "sha": "bd3da5ec4aa742346ce27bb534520967b652ddb3",
            "filename": "src/transformers/training_args_tf.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Ftraining_args_tf.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0440dbc0e1e311615c52bd8c903d41ad9156831a/src%2Ftransformers%2Ftraining_args_tf.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftraining_args_tf.py?ref=0440dbc0e1e311615c52bd8c903d41ad9156831a",
            "patch": "@@ -160,7 +160,7 @@ class TFTrainingArguments(TrainingArguments):\n             Google Cloud Project name for the Cloud TPU-enabled project. If not specified, we will attempt to\n             automatically detect from metadata.\n         run_name (`str`, *optional*):\n-            A descriptor for the run. Notably used for wandb, mlflow and comet logging.\n+            A descriptor for the run. Notably used for wandb, mlflow, comet and swanlab logging.\n         xla (`bool`, *optional*):\n             Whether to activate the XLA compilation or not.\n     \"\"\""
        }
    ],
    "stats": {
        "total": 221,
        "additions": 212,
        "deletions": 9
    }
}