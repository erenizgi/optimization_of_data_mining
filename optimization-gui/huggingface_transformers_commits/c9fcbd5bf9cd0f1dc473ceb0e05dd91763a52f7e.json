{
    "author": "1himan",
    "message": "Updated the Model docs - for the ALIGN model (#38072)\n\n* Updated the Model docs - for the ALIGN model\n\n* Update docs/source/en/model_doc/align.md\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>\n\n* Update docs/source/en/model_doc/align.md\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>\n\n* Updated align.md\n\n* Update docs/source/en/model_doc/align.md\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>\n\n* Update docs/source/en/model_doc/align.md\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>\n\n* Update align.md\n\n* fix\n\n---------\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>",
    "sha": "c9fcbd5bf9cd0f1dc473ceb0e05dd91763a52f7e",
    "files": [
        {
            "sha": "597f7e114e45ced04e536e8d997be707279bc31f",
            "filename": "docs/source/en/model_doc/align.md",
            "status": "modified",
            "additions": 112,
            "deletions": 36,
            "changes": 148,
            "blob_url": "https://github.com/huggingface/transformers/blob/c9fcbd5bf9cd0f1dc473ceb0e05dd91763a52f7e/docs%2Fsource%2Fen%2Fmodel_doc%2Falign.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/c9fcbd5bf9cd0f1dc473ceb0e05dd91763a52f7e/docs%2Fsource%2Fen%2Fmodel_doc%2Falign.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Falign.md?ref=c9fcbd5bf9cd0f1dc473ceb0e05dd91763a52f7e",
            "patch": "@@ -13,65 +13,141 @@ specific language governing permissions and limitations under the License.\n rendered properly in your Markdown viewer.\n \n -->\n+<div style=\"float: right;\">\n+  <div class=\"flex flex-wrap space-x-1\">\n+    <img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+    <img alt=\"Transformers\" src=\"https://img.shields.io/badge/Transformers-6B5B95?style=flat&logo=transformers&logoColor=white\">\n+  </div>\n+</div>\n \n # ALIGN\n \n-<div class=\"flex flex-wrap space-x-1\">\n-<img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n-</div>\n-\n-## Overview\n+[ALIGN](https://huggingface.co/papers/2102.05918) is pretrained on a noisy 1.8 billion altâ€‘text and image pair dataset to show that scale can make up for the noise. It uses a dualâ€‘encoder architecture, [EfficientNet](./efficientnet) for images and [BERT](./bert) for text, and a contrastive loss to align similar imageâ€“text embeddings together while pushing different embeddings apart. Once trained, ALIGN can encode any image and candidate captions into a shared vector space for zeroâ€‘shot retrieval or classification without requiring extra labels. This scaleâ€‘first approach reduces dataset curation costs and powers stateâ€‘ofâ€‘theâ€‘art imageâ€“text retrieval and zeroâ€‘shot ImageNet classification.\n \n-The ALIGN model was proposed in [Scaling Up Visual and Vision-Language Representation Learning With Noisy Text Supervision](https://arxiv.org/abs/2102.05918) by Chao Jia, Yinfei Yang, Ye Xia, Yi-Ting Chen, Zarana Parekh, Hieu Pham, Quoc V. Le, Yunhsuan Sung, Zhen Li, Tom Duerig. ALIGN is a multi-modal vision and language model. It can be used for image-text similarity and for zero-shot image classification. ALIGN features a dual-encoder architecture with [EfficientNet](efficientnet) as its vision encoder and [BERT](bert) as its text encoder, and learns to align visual and text representations with contrastive learning. Unlike previous work, ALIGN leverages a massive noisy dataset and shows that the scale of the corpus can be used to achieve SOTA representations with a simple recipe.\n+You can find all the original ALIGN checkpoints under the [Kakao Brain](https://huggingface.co/kakaobrain?search_models=align) organization.\n \n-The abstract from the paper is the following:\n+> [!TIP]\n+> Click on the ALIGN models in the right sidebar for more examples of how to apply ALIGN to different vision and text related tasks.\n \n-*Pre-trained representations are becoming crucial for many NLP and perception tasks. While representation learning in NLP has transitioned to training on raw text without human annotations, visual and vision-language representations still rely heavily on curated training datasets that are expensive or require expert knowledge. For vision applications, representations are mostly learned using datasets with explicit class labels such as ImageNet or OpenImages. For vision-language, popular datasets like Conceptual Captions, MSCOCO, or CLIP all involve a non-trivial data collection (and cleaning) process. This costly curation process limits the size of datasets and hence hinders the scaling of trained models. In this paper, we leverage a noisy dataset of over one billion image alt-text pairs, obtained without expensive filtering or post-processing steps in the Conceptual Captions dataset. A simple dual-encoder architecture learns to align visual and language representations of the image and text pairs using a contrastive loss. We show that the scale of our corpus can make up for its noise and leads to state-of-the-art representations even with such a simple learning scheme. Our visual representation achieves strong performance when transferred to classification tasks such as ImageNet and VTAB. The aligned visual and language representations enables zero-shot image classification and also set new state-of-the-art results on Flickr30K and MSCOCO image-text retrieval benchmarks, even when compared with more sophisticated cross-attention models. The representations also enable cross-modality search with complex text and text + image queries.*\n+The example below demonstrates zero-shot image classification with [`Pipeline`] or the [`AutoModel`] class.\n \n-This model was contributed by [Alara Dirik](https://huggingface.co/adirik).\n-The original code is not released, this implementation is based on the Kakao Brain implementation based on the original paper.\n+<hfoptions id=\"usage\">  \n \n-## Usage example\n+<hfoption id=\"Pipeline\">\n \n-ALIGN uses EfficientNet to get visual features and BERT to get the text features. Both the text and visual features are then projected to a latent space with identical dimension. The dot product between the projected image and text features is then used as a similarity score.\n+```py\n+import torch\n+from transformers import pipeline\n+\n+pipeline = pipeline(\n+    task=\"zero-shot-image-classification\",\n+    model=\"kakaobrain/align-base\",\n+    device=0,\n+    torch_dtype=torch.bfloat16\n+)\n+\n+candidate_labels = [\n+    \"a photo of a dog\",\n+    \"a photo of a cat\",\n+    \"a photo of a person\"\n+]\n+\n+pipeline(\"https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/pipeline-cat-chonk.jpeg\", candidate_labels=candidate_labels)\n+```\n \n-[`AlignProcessor`] wraps [`EfficientNetImageProcessor`] and [`BertTokenizer`] into a single instance to both encode the text and preprocess the images. The following example shows how to get the image-text similarity scores using [`AlignProcessor`] and [`AlignModel`].\n+</hfoption>\n+<hfoption id=\"AutoModel\">\n \n-```python\n-import requests\n+```py\n import torch\n+import requests\n from PIL import Image\n-from transformers import AlignProcessor, AlignModel\n+from transformers import AutoProcessor, AutoModelForZeroShotImageClassification\n \n-processor = AlignProcessor.from_pretrained(\"kakaobrain/align-base\")\n-model = AlignModel.from_pretrained(\"kakaobrain/align-base\")\n+processor = AutoProcessor.from_pretrained(\"kakaobrain/align-base\")\n+model = AutoModelForZeroShotImageClassification.from_pretrained(\"kakaobrain/align-base\").to(\"cuda\")\n \n-url = \"http://images.cocodataset.org/val2017/000000039769.jpg\"\n-image = Image.open(requests.get(url, stream=True).raw)\n-candidate_labels = [\"an image of a cat\", \"an image of a dog\"]\n-\n-inputs = processor(images=image ,text=candidate_labels, return_tensors=\"pt\")\n+url = \"https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/pipeline-cat-chonk.jpeg\"\n+image = requests.get(url, stream=True)\n+inputs = Image.open(image.raw).convert(\"RGB\")\n \n+image_inputs = processor(images=inputs, return_tensors=\"pt\").to(\"cuda\")\n with torch.no_grad():\n-    outputs = model(**inputs)\n+    image_embeds = model.get_image_features(**image_inputs)\n \n-# this is the image-text similarity score\n-logits_per_image = outputs.logits_per_image\n+candidate_labels = [\"a photo of a dog\", \"a photo of a cat\", \"a photo of a person\"]\n+text_inputs = processor(text=candidate_labels, padding=True, return_tensors=\"pt\").to(\"cuda\")\n+with torch.no_grad():\n+    text_embeds = model.get_text_features(**text_inputs)\n \n-# we can take the softmax to get the label probabilities\n-probs = logits_per_image.softmax(dim=1)\n-print(probs)\n-```\n+image_embeds = image_embeds / image_embeds.norm(p=2, dim=-1, keepdim=True)\n+text_embeds  = text_embeds  / text_embeds.norm(p=2, dim=-1, keepdim=True)\n \n-## Resources\n+logits = (image_embeds @ text_embeds.T) * 100.0\n+probs  = logits.softmax(dim=-1).cpu().squeeze()\n \n-A list of official Hugging Face and community (indicated by ðŸŒŽ) resources to help you get started with ALIGN.\n+for label, score in zip(candidate_labels, probs):\n+    print(f\"{label:20s} â†’ {score.item():.4f}\")\n+```\n \n-- A blog post on [ALIGN and the COYO-700M dataset](https://huggingface.co/blog/vit-align).\n-- A zero-shot image classification [demo](https://huggingface.co/spaces/adirik/ALIGN-zero-shot-image-classification).\n-- [Model card](https://huggingface.co/kakaobrain/align-base) of `kakaobrain/align-base` model.\n+</hfoption>\n+\n+</hfoptions>\n+\n+## Notes\n+\n+- ALIGN projects the text and visual features into latent space and the dot product between the projected image and text features is used as the similarity score. The example below demonstrates how to calculate the image-text similarity score with [`AlignProcessor`] and [`AlignModel`].\n+\n+  ```py\n+  # Example of using ALIGN for image-text similarity\n+  from transformers import AlignProcessor, AlignModel\n+  import torch\n+  from PIL import Image\n+  import requests\n+  from io import BytesIO\n+  \n+  # Load processor and model\n+  processor = AlignProcessor.from_pretrained(\"kakaobrain/align-base\")\n+  model = AlignModel.from_pretrained(\"kakaobrain/align-base\")\n+  \n+  # Download image from URL\n+  url = \"https://huggingface.co/roschmid/dog-races/resolve/main/images/Golden_Retriever.jpg\"\n+  response = requests.get(url)\n+  image = Image.open(BytesIO(response.content))  # Convert the downloaded bytes to a PIL Image\n+  \n+  texts = [\"a photo of a cat\", \"a photo of a dog\"]\n+  \n+  # Process image and text inputs\n+  inputs = processor(images=image, text=texts, return_tensors=\"pt\")\n+  \n+  # Get the embeddings\n+  with torch.no_grad():\n+      outputs = model(**inputs)\n+  \n+  image_embeds = outputs.image_embeds\n+  text_embeds = outputs.text_embeds\n+  \n+  # Normalize embeddings for cosine similarity\n+  image_embeds = image_embeds / image_embeds.norm(dim=1, keepdim=True)\n+  text_embeds = text_embeds / text_embeds.norm(dim=1, keepdim=True)\n+  \n+  # Calculate similarity scores\n+  similarity_scores = torch.matmul(text_embeds, image_embeds.T)\n+  \n+  # Print raw scores\n+  print(\"Similarity scores:\", similarity_scores)\n+  \n+  # Convert to probabilities\n+  probs = torch.nn.functional.softmax(similarity_scores, dim=0)\n+  print(\"Probabilities:\", probs)\n+  \n+  # Get the most similar text\n+  most_similar_idx = similarity_scores.argmax().item()\n+  print(f\"Most similar text: '{texts[most_similar_idx]}'\")\n+  ```\n \n-If you're interested in submitting a resource to be included here, please feel free to open a Pull Request and we will review it. The resource should ideally demonstrate something new instead of duplicating an existing resource.\n+## Resources\n+- Refer to the [Kakao Brainâ€™s Open Source ViT, ALIGN, and the New COYO Text-Image Dataset](https://huggingface.co/blog/vit-align) blog post for more details.\n \n ## AlignConfig\n "
        }
    ],
    "stats": {
        "total": 148,
        "additions": 112,
        "deletions": 36
    }
}