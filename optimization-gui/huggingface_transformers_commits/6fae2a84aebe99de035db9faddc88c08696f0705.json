{
    "author": "ArthurZucker",
    "message": "Update test fetcher when we want to test all (#35364)\n\n* [test-all]\n\n* style\n\n* [test-all]\n\n* [test_all]\n\n* [test_all]\n\n* style",
    "sha": "6fae2a84aebe99de035db9faddc88c08696f0705",
    "files": [
        {
            "sha": "c641ccb21e2984e13d4ef8b5501e7beece7bf180",
            "filename": "utils/tests_fetcher.py",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/huggingface/transformers/blob/6fae2a84aebe99de035db9faddc88c08696f0705/utils%2Ftests_fetcher.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/6fae2a84aebe99de035db9faddc88c08696f0705/utils%2Ftests_fetcher.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Ftests_fetcher.py?ref=6fae2a84aebe99de035db9faddc88c08696f0705",
            "patch": "@@ -995,9 +995,7 @@ def _print_list(l) -> str:\n \n \n def infer_tests_to_run(\n-    output_file: str,\n-    diff_with_last_commit: bool = False,\n-    filter_models: bool = False,\n+    output_file: str, diff_with_last_commit: bool = False, filter_models: bool = False, test_all: bool = False\n ):\n     \"\"\"\n     The main function called by the test fetcher. Determines the tests to run from the diff.\n@@ -1018,7 +1016,11 @@ def infer_tests_to_run(\n             Whether or not to filter the tests to core models only, when a file modified results in a lot of model\n             tests.\n     \"\"\"\n-    modified_files = get_modified_python_files(diff_with_last_commit=diff_with_last_commit)\n+    if not test_all:\n+        modified_files = get_modified_python_files(diff_with_last_commit=diff_with_last_commit)\n+    else:\n+        modified_files = [str(k) for k in PATH_TO_TESTS.glob(\"*/*\") if str(k).endswith(\".py\") and \"test_\" in str(k)]\n+        print(\"\\n### test_all is TRUE, FETCHING ALL FILES###\\n\")\n     print(f\"\\n### MODIFIED FILES ###\\n{_print_list(modified_files)}\")\n \n     # Create the map that will give us all impacted modules.\n@@ -1230,5 +1232,6 @@ def create_test_list_from_filter(full_test_list, out_path):\n             args.output_file,\n             diff_with_last_commit=diff_with_last_commit,\n             filter_models=False,\n+            test_all=commit_flags[\"test_all\"],\n         )\n         filter_tests(args.output_file, [\"repo_utils\"])"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 7,
        "deletions": 4
    }
}