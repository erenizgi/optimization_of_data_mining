{
    "author": "qgallouedec",
    "message": "Don't set `run_name` when none (#39695)\n\n* Don't set run_name when none\n\n* revert\n\n---------\n\nCo-authored-by: Marc Sun <57196510+SunMarc@users.noreply.github.com>",
    "sha": "ec4033457e50afbf709cec5a205587f0669847c7",
    "files": [
        {
            "sha": "5b172b3eb98cab36153181801627ed4aebd991db",
            "filename": "src/transformers/integrations/integration_utils.py",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/huggingface/transformers/blob/ec4033457e50afbf709cec5a205587f0669847c7/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/ec4033457e50afbf709cec5a205587f0669847c7/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py?ref=ec4033457e50afbf709cec5a205587f0669847c7",
            "patch": "@@ -856,7 +856,7 @@ def setup(self, args, state, model, **kwargs):\n             init_args = {}\n             if trial_name is not None:\n                 init_args[\"name\"] = trial_name\n-                init_args[\"group\"] = args.run_name\n+                init_args[\"group\"] = args.run_name or args.output_dir\n             elif args.run_name is not None:\n                 init_args[\"name\"] = args.run_name\n                 if args.run_name == args.output_dir:\n@@ -1230,11 +1230,7 @@ def setup(self, args, state, model):\n \n             import comet_ml\n \n-            # Do not use the default run_name as the experiment name\n-            if args.run_name is not None and args.run_name != args.output_dir:\n-                experiment_config = comet_ml.ExperimentConfig(name=args.run_name)\n-            else:\n-                experiment_config = comet_ml.ExperimentConfig()\n+            experiment_config = comet_ml.ExperimentConfig(name=args.run_name)\n \n             self._experiment = comet_ml.start(online=online, mode=mode, experiment_config=experiment_config)\n             self._experiment.__internal_api__set_model_graph__(model, framework=\"transformers\")\n@@ -2357,10 +2353,12 @@ def setup(self, args, state, model, **kwargs):\n                 combined_dict = {**{\"peft_config\": peft_config}, **combined_dict}\n             trial_name = state.trial_name\n             init_args = {}\n-            if trial_name is not None:\n+            if trial_name is not None and args.run_name is not None:\n                 init_args[\"experiment_name\"] = f\"{args.run_name}-{trial_name}\"\n             elif args.run_name is not None:\n                 init_args[\"experiment_name\"] = args.run_name\n+            elif trial_name is not None:\n+                init_args[\"experiment_name\"] = trial_name\n             init_args[\"project\"] = os.getenv(\"SWANLAB_PROJECT\", None)\n \n             if self._swanlab.get_run() is None:"
        },
        {
            "sha": "cefce9171343c36536939c0a1ae4c9ddc4d727e2",
            "filename": "src/transformers/training_args.py",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/ec4033457e50afbf709cec5a205587f0669847c7/src%2Ftransformers%2Ftraining_args.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/ec4033457e50afbf709cec5a205587f0669847c7/src%2Ftransformers%2Ftraining_args.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftraining_args.py?ref=ec4033457e50afbf709cec5a205587f0669847c7",
            "patch": "@@ -1707,8 +1707,6 @@ def __post_init__(self):\n             self.metric_for_best_model = \"loss\"\n         if self.greater_is_better is None and self.metric_for_best_model is not None:\n             self.greater_is_better = not self.metric_for_best_model.endswith(\"loss\")\n-        if self.run_name is None:\n-            self.run_name = self.output_dir\n         if self.framework == \"pt\" and is_torch_available():\n             if self.fp16_backend and self.fp16_backend != \"auto\":\n                 warnings.warn("
        }
    ],
    "stats": {
        "total": 14,
        "additions": 5,
        "deletions": 9
    }
}