{
    "author": "matthewdouglas",
    "message": "Remove IPEX requirement for bitsandbytes on CPU (#38594)\n\nCo-authored-by: Marc Sun <57196510+SunMarc@users.noreply.github.com>",
    "sha": "e2bdc13375031735667edd3462788271ac2f32ce",
    "files": [
        {
            "sha": "5b2c24119ea33802942f344c14e38bbf13e8375b",
            "filename": "src/transformers/integrations/bitsandbytes.py",
            "status": "modified",
            "additions": 2,
            "deletions": 21,
            "changes": 23,
            "blob_url": "https://github.com/huggingface/transformers/blob/e2bdc13375031735667edd3462788271ac2f32ce/src%2Ftransformers%2Fintegrations%2Fbitsandbytes.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/e2bdc13375031735667edd3462788271ac2f32ce/src%2Ftransformers%2Fintegrations%2Fbitsandbytes.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fintegrations%2Fbitsandbytes.py?ref=e2bdc13375031735667edd3462788271ac2f32ce",
            "patch": "@@ -11,7 +11,6 @@\n     is_accelerate_available,\n     is_bitsandbytes_available,\n     is_bitsandbytes_multi_backend_available,\n-    is_ipex_available,\n     is_torch_available,\n     logging,\n )\n@@ -488,29 +487,11 @@ def _validate_bnb_multi_backend_availability(raise_exception):\n     bnb_supported_devices = getattr(bnb, \"supported_torch_devices\", set())\n     available_devices = set(get_available_devices())\n \n-    if available_devices == {\"cpu\"} and not is_ipex_available():\n-        from importlib.util import find_spec\n-\n-        if find_spec(\"intel_extension_for_pytorch\"):\n-            logger.warning(\n-                \"You have Intel IPEX installed but if you're intending to use it for CPU, it might not have the right version. Be sure to double check that your PyTorch and IPEX installs are compatible.\"\n-            )\n-\n-        available_devices = frozenset(\n-            [device for device in available_devices if device != \"cpu\"]\n-        )  # Only Intel CPU is supported by BNB at the moment\n-\n     if not available_devices.intersection(bnb_supported_devices):\n         if raise_exception:\n-            bnb_supported_devices_with_info = set(  # noqa: C401\n-                '\"cpu\" (needs an Intel CPU and intel_extension_for_pytorch installed and compatible with the PyTorch version)'\n-                if device == \"cpu\"\n-                else device\n-                for device in bnb_supported_devices\n-            )\n             err_msg = (\n-                f\"None of the available devices `available_devices = {available_devices or None}` are supported by the bitsandbytes version you have installed: `bnb_supported_devices = {bnb_supported_devices_with_info}`. \"\n-                \"Please check the docs to see if the backend you intend to use is available and how to install it: https://huggingface.co/docs/bitsandbytes/main/en/installation#multi-backend\"\n+                f\"None of the available devices `available_devices = {available_devices or None}` are supported by the bitsandbytes version you have installed: `bnb_supported_devices = {bnb_supported_devices}`. \"\n+                \"Please check the docs to see if the backend you intend to use is available and how to install it: https://huggingface.co/docs/bitsandbytes/main/en/installation\"\n             )\n \n             logger.error(err_msg)"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 2,
        "deletions": 21
    }
}