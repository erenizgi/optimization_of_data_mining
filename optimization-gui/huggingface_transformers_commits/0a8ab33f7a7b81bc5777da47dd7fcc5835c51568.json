{
    "author": "luaenrique",
    "message": "Fix: prevent .gitignore truncation in run_clm_no_trainer.py (#41957)\n\n* fix: update gitignore update flow\n\n* fix: remove whitespace",
    "sha": "0a8ab33f7a7b81bc5777da47dd7fcc5835c51568",
    "files": [
        {
            "sha": "10512208b5a2c815156b2bbc17124e5f3aee5ec8",
            "filename": "examples/pytorch/language-modeling/run_clm_no_trainer.py",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/huggingface/transformers/blob/0a8ab33f7a7b81bc5777da47dd7fcc5835c51568/examples%2Fpytorch%2Flanguage-modeling%2Frun_clm_no_trainer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0a8ab33f7a7b81bc5777da47dd7fcc5835c51568/examples%2Fpytorch%2Flanguage-modeling%2Frun_clm_no_trainer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/examples%2Fpytorch%2Flanguage-modeling%2Frun_clm_no_trainer.py?ref=0a8ab33f7a7b81bc5777da47dd7fcc5835c51568",
            "patch": "@@ -308,11 +308,19 @@ def main():\n             api = HfApi()\n             repo_id = api.create_repo(repo_name, exist_ok=True, token=args.hub_token).repo_id\n \n-            with open(os.path.join(args.output_dir, \".gitignore\"), \"w+\") as gitignore:\n-                if \"step_*\" not in gitignore:\n-                    gitignore.write(\"step_*\\n\")\n-                if \"epoch_*\" not in gitignore:\n-                    gitignore.write(\"epoch_*\\n\")\n+            os.makedirs(args.output_dir, exist_ok=True)\n+            gitignore_path = os.path.join(args.output_dir, \".gitignore\")\n+            content = \"\"\n+            if os.path.exists(gitignore_path):\n+                with open(gitignore_path, \"r\") as f:\n+                    content = f.read()\n+            with open(gitignore_path, \"a\") as f:\n+                if content and not content.endswith(\"\\n\"):\n+                    f.write(\"\\n\")\n+                if \"step_*\" not in content:\n+                    f.write(\"step_*\\n\")\n+                if \"epoch_*\" not in content:\n+                    f.write(\"epoch_*\\n\")\n         elif args.output_dir is not None:\n             os.makedirs(args.output_dir, exist_ok=True)\n     accelerator.wait_for_everyone()"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 13,
        "deletions": 5
    }
}