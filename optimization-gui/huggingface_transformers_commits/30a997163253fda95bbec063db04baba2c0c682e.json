{
    "author": "jla524",
    "message": "Use `sdpa_kernel` in tests (#35472)\n\n* update: use sdpa_kernel\r\n\r\n* update: rerun test",
    "sha": "30a997163253fda95bbec063db04baba2c0c682e",
    "files": [
        {
            "sha": "708a3a54e3934169de0d06081a2f61af4f5269a7",
            "filename": "tests/test_modeling_common.py",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/huggingface/transformers/blob/30a997163253fda95bbec063db04baba2c0c682e/tests%2Ftest_modeling_common.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/30a997163253fda95bbec063db04baba2c0c682e/tests%2Ftest_modeling_common.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Ftest_modeling_common.py?ref=30a997163253fda95bbec063db04baba2c0c682e",
            "patch": "@@ -4255,7 +4255,7 @@ def test_sdpa_can_dispatch_on_flash(self):\n                     if isinstance(inp, torch.Tensor) and inp.dtype in [torch.float32, torch.float16]:\n                         inputs_dict[name] = inp.to(torch.float16)\n \n-                with torch.backends.cuda.sdp_kernel(enable_flash=True, enable_math=False, enable_mem_efficient=False):\n+                with sdpa_kernel(enable_flash=True, enable_math=False, enable_mem_efficient=False):\n                     _ = model(**inputs_dict)\n \n     @require_non_xpu\n@@ -4347,11 +4347,7 @@ def test_sdpa_matches_eager_sliding_window(self):\n                 model_sdpa = model_sdpa.eval()\n \n                 with torch.no_grad():\n-                    with torch.backends.cuda.sdp_kernel(\n-                        enable_flash=False,\n-                        enable_math=True,\n-                        enable_mem_efficient=False,\n-                    ):\n+                    with sdpa_kernel(enable_flash=False, enable_math=True, enable_mem_efficient=False):\n                         res_eager = model_eager(**inputs_dict, return_dict=False)[0]\n                         res_sdpa = model_sdpa(**inputs_dict, return_dict=False)[0]\n "
        }
    ],
    "stats": {
        "total": 8,
        "additions": 2,
        "deletions": 6
    }
}