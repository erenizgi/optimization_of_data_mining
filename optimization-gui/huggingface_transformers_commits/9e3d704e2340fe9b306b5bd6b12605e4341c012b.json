{
    "author": "hlky",
    "message": "Fixes for Modular Converter on Windows (#34266)\n\n* Separator in regex\r\n\r\n* Standardize separator for relative path in auto generated message\r\n\r\n* open() encoding\r\n\r\n* Replace `\\` on `os.path.abspath`\r\n\r\n---------\r\n\r\nCo-authored-by: Arthur <48595927+ArthurZucker@users.noreply.github.com>",
    "sha": "9e3d704e2340fe9b306b5bd6b12605e4341c012b",
    "files": [
        {
            "sha": "bda143c25772799e737522db258f3f50ca84a104",
            "filename": "utils/modular_model_converter.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/9e3d704e2340fe9b306b5bd6b12605e4341c012b/utils%2Fmodular_model_converter.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/9e3d704e2340fe9b306b5bd6b12605e4341c012b/utils%2Fmodular_model_converter.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Fmodular_model_converter.py?ref=9e3d704e2340fe9b306b5bd6b12605e4341c012b",
            "patch": "@@ -56,7 +56,7 @@ def get_module_source_from_name(module_name: str) -> str:\n     if spec is None or spec.origin is None:\n         return f\"Module {module_name} not found\"\n \n-    with open(spec.origin, \"r\") as file:\n+    with open(spec.origin, \"r\", encoding=\"utf-8\") as file:\n         source_code = file.read()\n     return source_code\n \n@@ -1132,7 +1132,7 @@ def convert_modular_file(modular_file, old_model_name=None, new_model_name=None,\n     if pattern is not None:\n         model_name = pattern.groups()[0]\n         # Parse the Python file\n-        with open(modular_file, \"r\") as file:\n+        with open(modular_file, \"r\", encoding=\"utf-8\") as file:\n             code = file.read()\n         module = cst.parse_module(code)\n         wrapper = MetadataWrapper(module)\n@@ -1143,7 +1143,7 @@ def convert_modular_file(modular_file, old_model_name=None, new_model_name=None,\n             if node != {}:\n                 # Get relative path starting from src/transformers/\n                 relative_path = re.search(\n-                    rf\"(src{os.sep}transformers{os.sep}.*|examples{os.sep}.*)\", os.path.abspath(modular_file)\n+                    r\"(src/transformers/.*|examples/.*)\", os.path.abspath(modular_file).replace(\"\\\\\", \"/\")\n                 ).group(1)\n \n                 header = AUTO_GENERATED_MESSAGE.format(\n@@ -1164,15 +1164,15 @@ def save_modeling_file(modular_file, converted_file):\n             [line for line in converted_file[file_type][0].strip().split(\"\\n\") if not line.strip().startswith(\"#\")]\n         )\n         if len(converted_file[file_type][0].strip()) > 0 and non_comment_lines > 0:\n-            with open(modular_file.replace(\"modular_\", f\"{file_type}_\"), \"w\") as f:\n+            with open(modular_file.replace(\"modular_\", f\"{file_type}_\"), \"w\", encoding=\"utf-8\") as f:\n                 f.write(converted_file[file_type][0])\n         else:\n             non_comment_lines = len(\n                 [line for line in converted_file[file_type][0].strip().split(\"\\n\") if not line.strip().startswith(\"#\")]\n             )\n             if len(converted_file[file_type][1].strip()) > 0 and non_comment_lines > 0:\n                 logger.warning(\"The modeling code contains errors, it's written without formatting\")\n-                with open(modular_file.replace(\"modular_\", f\"{file_type}_\"), \"w\") as f:\n+                with open(modular_file.replace(\"modular_\", f\"{file_type}_\"), \"w\", encoding=\"utf-8\") as f:\n                     f.write(converted_file[file_type][1])\n \n "
        }
    ],
    "stats": {
        "total": 10,
        "additions": 5,
        "deletions": 5
    }
}