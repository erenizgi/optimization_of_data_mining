{
    "author": "ydshieh",
    "message": "Fix some missing tests in circleci (#33559)\n\n* fix\r\n\r\n* fix\r\n\r\n* fix\r\n\r\n* fix\r\n\r\n* skip\r\n\r\n* skip more\r\n\r\n---------\r\n\r\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "077b552f0780c678737700184c109066736ece41",
    "files": [
        {
            "sha": "7ccf5ec96cec4fb481e9c969363244a1b2b9efaf",
            "filename": ".circleci/create_circleci_config.py",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/huggingface/transformers/blob/077b552f0780c678737700184c109066736ece41/.circleci%2Fcreate_circleci_config.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/077b552f0780c678737700184c109066736ece41/.circleci%2Fcreate_circleci_config.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.circleci%2Fcreate_circleci_config.py?ref=077b552f0780c678737700184c109066736ece41",
            "patch": "@@ -312,6 +312,15 @@ def job_name(self):\n )\n \n \n+non_model_job = CircleCIJob(\n+    \"non_model\",\n+    docker_image=[{\"image\": \"huggingface/transformers-torch-light\"}],\n+    marker=\"not generate\",\n+    parallelism=6,\n+    pytest_num_workers=8,\n+)\n+\n+\n # We also include a `dummy.py` file in the files to be doc-tested to prevent edge case failure. Otherwise, the pytest\n # hangs forever during test collection while showing `collecting 0 items / 21 errors`. (To see this, we have to remove\n # the bash output redirection.)\n@@ -336,7 +345,7 @@ def job_name(self):\n     pytest_num_workers=1,\n )\n \n-REGULAR_TESTS = [torch_and_tf_job, torch_and_flax_job, torch_job, tf_job, flax_job, hub_job, onnx_job, tokenization_job, processor_job, generate_job] # fmt: skip\n+REGULAR_TESTS = [torch_and_tf_job, torch_and_flax_job, torch_job, tf_job, flax_job, hub_job, onnx_job, tokenization_job, processor_job, generate_job, non_model_job] # fmt: skip\n EXAMPLES_TESTS = [examples_torch_job, examples_tensorflow_job]\n PIPELINE_TESTS = [pipelines_torch_job, pipelines_tf_job]\n REPO_UTIL_TESTS = [repo_utils_job]"
        },
        {
            "sha": "9c7f4db3c9230819709bb7e4a834af932f47910a",
            "filename": "tests/generation/test_configuration_utils.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/077b552f0780c678737700184c109066736ece41/tests%2Fgeneration%2Ftest_configuration_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/077b552f0780c678737700184c109066736ece41/tests%2Fgeneration%2Ftest_configuration_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fgeneration%2Ftest_configuration_utils.py?ref=077b552f0780c678737700184c109066736ece41",
            "patch": "@@ -114,6 +114,10 @@ def test_update(self):\n         # `.update()` returns a dictionary of unused kwargs\n         self.assertEqual(unused_kwargs, {\"foo\": \"bar\"})\n \n+    # TODO: @Arthur and/or @Joao\n+    # FAILED tests/generation/test_configuration_utils.py::GenerationConfigTest::test_initialize_new_kwargs - AttributeError: 'GenerationConfig' object has no attribute 'get_text_config'\n+    # See: https://app.circleci.com/pipelines/github/huggingface/transformers/104831/workflows/e5e61514-51b7-4c8c-bba7-3c4d2986956e/jobs/1394252\n+    @unittest.skip(\"failed with `'GenerationConfig' object has no attribute 'get_text_config'`\")\n     def test_initialize_new_kwargs(self):\n         generation_config = GenerationConfig()\n         generation_config.foo = \"bar\""
        },
        {
            "sha": "0a9bf38fa40305d14097a7c6b406cd8e75ccd44f",
            "filename": "tests/utils/test_import_structure.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/077b552f0780c678737700184c109066736ece41/tests%2Futils%2Ftest_import_structure.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/077b552f0780c678737700184c109066736ece41/tests%2Futils%2Ftest_import_structure.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Futils%2Ftest_import_structure.py?ref=077b552f0780c678737700184c109066736ece41",
            "patch": "@@ -36,6 +36,9 @@ class TestImportStructures(unittest.TestCase):\n     models_path = base_transformers_path / \"src\" / \"transformers\" / \"models\"\n     models_import_structure = spread_import_structure(define_import_structure(models_path))\n \n+    # TODO: Lysandre\n+    # See https://app.circleci.com/pipelines/github/huggingface/transformers/104762/workflows/7ba9c6f7-a3b2-44e6-8eaf-749c7b7261f7/jobs/1393260/tests\n+    @unittest.skip(reason=\"failing\")\n     def test_definition(self):\n         import_structure = define_import_structure(import_structures)\n         import_structure_definition = {\n@@ -93,6 +96,9 @@ def test_transformers_specific_model_import(self):\n                         )\n                         self.assertListEqual(sorted(objects), sorted(_all), msg=error_message)\n \n+    # TODO: Lysandre\n+    # See https://app.circleci.com/pipelines/github/huggingface/transformers/104762/workflows/7ba9c6f7-a3b2-44e6-8eaf-749c7b7261f7/jobs/1393260/tests\n+    @unittest.skip(reason=\"failing\")\n     def test_export_backend_should_be_defined(self):\n         with self.assertRaisesRegex(ValueError, \"Backend should be defined in the BACKENDS_MAPPING\"):\n             pass"
        },
        {
            "sha": "b8408f9d4538d91dae86d310d94d648706322c95",
            "filename": "utils/tests_fetcher.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/huggingface/transformers/blob/077b552f0780c678737700184c109066736ece41/utils%2Ftests_fetcher.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/077b552f0780c678737700184c109066736ece41/utils%2Ftests_fetcher.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Ftests_fetcher.py?ref=077b552f0780c678737700184c109066736ece41",
            "patch": "@@ -1148,6 +1148,7 @@ def parse_commit_message(commit_message: str) -> Dict[str, bool]:\n     \"pipelines_torch\": r\"tests/models/.*/test_modeling_(?!(?:flax_|tf_)).*\",\n     \"tests_hub\": r\"tests/.*\",\n     \"tests_onnx\": r\"tests/models/.*/test_modeling_(?:tf_|(?!flax)).*\",\n+    \"tests_non_model\": r\"tests/[^/]*?/test_.*\\.py\",\n }\n \n "
        }
    ],
    "stats": {
        "total": 22,
        "additions": 21,
        "deletions": 1
    }
}