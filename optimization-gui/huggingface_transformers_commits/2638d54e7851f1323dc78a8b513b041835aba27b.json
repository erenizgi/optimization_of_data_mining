{
    "author": "molbap",
    "message": "Gemma 3 tests expect greedy decoding (#36882)\n\ntests expect greedy decoding",
    "sha": "2638d54e7851f1323dc78a8b513b041835aba27b",
    "files": [
        {
            "sha": "25e620f61f2e836726455cd97f3f5c5fe252f1bf",
            "filename": "tests/models/gemma3/test_modeling_gemma3.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/2638d54e7851f1323dc78a8b513b041835aba27b/tests%2Fmodels%2Fgemma3%2Ftest_modeling_gemma3.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/2638d54e7851f1323dc78a8b513b041835aba27b/tests%2Fmodels%2Fgemma3%2Ftest_modeling_gemma3.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fgemma3%2Ftest_modeling_gemma3.py?ref=2638d54e7851f1323dc78a8b513b041835aba27b",
            "patch": "@@ -567,7 +567,7 @@ def test_generation_beyond_sliding_window(self, attn_implementation: str):\n         input_size = inputs.input_ids.shape[-1]\n         self.assertTrue(input_size > model.config.sliding_window)\n \n-        out = model.generate(**inputs, max_new_tokens=20)[:, input_size:]\n+        out = model.generate(**inputs, max_new_tokens=20, do_sample=False)[:, input_size:]\n         output_text = tokenizer.batch_decode(out)\n \n         EXPECTED_COMPLETIONS = [\" and I'm going to take a walk.\\n\\nI really enjoy the scenery, and I'\", \", green, yellow, orange, purple, brown, black, white, gray.\\n\\nI'\"]  # fmt: skip\n@@ -599,6 +599,11 @@ def test_generation_beyond_sliding_window_with_generation_config(self):\n         generation_config = GenerationConfig(max_new_tokens=5, min_new_tokens=5)\n         out = model.generate(**inputs, generation_config=generation_config)\n \n+        out = model.generate(**inputs, generation_config=generation_config, do_sample=False)[:, input_size:]\n+        output_text = tokenizer.batch_decode(out)\n+        EXPECTED_COMPLETIONS = [\" and I'm going to take a walk.\\n\\nI really enjoy the scenery, and I'\", \", green, yellow, orange, purple, brown, black, white, gray.\\n\\nI'\"]  # fmt: skip\n+        self.assertEqual(output_text, EXPECTED_COMPLETIONS)\n+\n         # Generation works beyond sliding window\n         self.assertGreater(out.shape[1], model.config.sliding_window)\n         self.assertEqual(out.shape[1], input_size + 5)"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
    }
}