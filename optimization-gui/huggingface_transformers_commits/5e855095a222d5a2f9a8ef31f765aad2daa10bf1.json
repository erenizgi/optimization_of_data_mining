{
    "author": "ricalanis",
    "message": "Update falcon mamba card (#37253)\n\n* feat: edit falcon mamba card\n\n* fix: edit statement on falconmamba arch\n\n* Update docs/source/en/model_doc/falcon_mamba.md\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>\n\n* Update docs/source/en/model_doc/falcon_mamba.md\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>\n\n* Update docs/source/en/model_doc/falcon_mamba.md\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>\n\n* fix: add right indent for tags\n\n* fix: remove notas\n\n---------\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>",
    "sha": "5e855095a222d5a2f9a8ef31f765aad2daa10bf1",
    "files": [
        {
            "sha": "ef346e89892efc213be8352da0456bbeee4930cb",
            "filename": "docs/source/en/model_doc/falcon_mamba.md",
            "status": "modified",
            "additions": 68,
            "deletions": 63,
            "changes": 131,
            "blob_url": "https://github.com/huggingface/transformers/blob/5e855095a222d5a2f9a8ef31f765aad2daa10bf1/docs%2Fsource%2Fen%2Fmodel_doc%2Ffalcon_mamba.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/5e855095a222d5a2f9a8ef31f765aad2daa10bf1/docs%2Fsource%2Fen%2Fmodel_doc%2Ffalcon_mamba.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Ffalcon_mamba.md?ref=5e855095a222d5a2f9a8ef31f765aad2daa10bf1",
            "patch": "@@ -14,95 +14,100 @@ rendered properly in your Markdown viewer.\n \n -->\n \n-# FalconMamba\n-\n-<div class=\"flex flex-wrap space-x-1\">\n-<img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+<div style=\"float: right;\">\n+    <div class=\"flex flex-wrap space-x-1\">\n+        <img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+    </div>\n </div>\n \n-## Overview\n-\n-The FalconMamba model was proposed by TII UAE (Technology Innovation Institute) in their release.\n-\n-The abstract from the paper is the following:\n-\n-*We present FalconMamba, a new base large language model based on the novel Mamba architecture. FalconMamba is trained on 5.8 trillion tokens with carefully selected data mixtures. As a pure Mamba-based model, FalconMamba surpasses leading open-weight models based on Transformers, such as Mistral 7B, Llama3 8B, and Falcon2 11B. It is on par with Gemma 7B and outperforms models with different architecture designs, such as RecurrentGemma 9B. Currently, FalconMamba is the best-performing Mamba model in the literature at this scale, surpassing both existing Mamba and hybrid Mamba-Transformer models.\n-Due to its architecture, FalconMamba is significantly faster at inference and requires substantially less memory for long sequence generation. Despite recent studies suggesting that hybrid Mamba-Transformer models outperform pure architecture designs, we argue and demonstrate that the pure Mamba design can achieve similar, even superior results compared to the hybrid design. We make the weights of our implementation of FalconMamba publicly available under a permissive license.*\n-\n-Tips:\n+# FalconMamba\n \n-- FalconMamba is mostly based on Mamba architecture, the same [tips and best practices](./mamba) would be relevant here.\n+[FalconMamba](https://huggingface.co/papers/2410.05355) is a 7B large language model, available as pretrained and instruction-tuned variants, based on the [Mamba](./mamba). This model implements a pure Mamba design that focuses on computational efficiency while maintaining strong performance. FalconMamba is significantly faster at inference and requires substantially less memory for long sequence generation. The models are pretrained on a diverse 5.8T token dataset including [RefinedWeb](https://huggingface.co/datasets/tiiuae/falcon-refinedweb), technical content, code, and mathematical data.\n \n-The model has been trained on approximtely 6T tokens consisting a mixture of many data sources such as RefineWeb, Cosmopedia and Math data.\n+You can find the official FalconMamba checkpoints in the [FalconMamba 7B](https://huggingface.co/collections/tiiuae/falconmamba-7b-66b9a580324dd1598b0f6d4a) collection.\n \n-For more details about the training procedure and the architecture, have a look at [the technical paper of FalconMamba]() (coming soon).\n+> [!TIP]\n+> Click on the FalconMamba models in the right sidebar for more examples of how to apply FalconMamba to different language tasks.\n \n-# Usage\n+The examples below demonstrate how to generate text with [`Pipeline`], [`AutoModel`], and from the command line.\n \n-Below we demonstrate how to use the model:\n+<hfoptions id=\"usage\">\n+<hfoption id=\"Pipeline\">\n \n-```python \n-from transformers import FalconMambaForCausalLM, AutoTokenizer\n+```py\n import torch\n-\n-tokenizer = AutoTokenizer.from_pretrained(\"tiiuae/falcon-mamba-7b\")\n-model = FalconMambaForCausalLM.from_pretrained(\"tiiuae/falcon-mamba-7b\")\n-\n-input_ids = tokenizer(\"Hey how are you doing?\", return_tensors= \"pt\")[\"input_ids\"]\n-\n-out = model.generate(input_ids, max_new_tokens=10)\n-print(tokenizer.batch_decode(out))\n+from transformers import pipeline\n+\n+pipeline = pipeline(\n+    \"text-generation\", \n+    model=\"tiiuae/falcon-mamba-7b-instruct\",\n+    torch_dtype=torch.bfloat16,\n+    device=0\n+)\n+pipeline(\n+    \"Explain the difference between transformers and SSMs\",\n+    max_length=100,\n+    do_sample=True,\n+    temperature=0.7\n+)\n ```\n \n-The architecture is also compatible with `torch.compile` for faster generation:\n+</hfoption>\n+<hfoption id=\"AutoModel\">\n \n-```python \n-from transformers import FalconMambaForCausalLM, AutoTokenizer\n+```py\n import torch\n+from transformers import AutoTokenizer, AutoModelForCausalLM\n \n-tokenizer = AutoTokenizer.from_pretrained(\"tiiuae/falcon-mamba-7b\")\n-model = FalconMambaForCausalLM.from_pretrained(\"tiiuae/falcon-mamba-7b\", torch_dtype=torch.bfloat16).to(0)\n-model = torch.compile(model)\n+tokenizer = AutoTokenizer.from_pretrained(\"tiiuae/falcon-mamba-7b-instruct\")\n+model = AutoModelForCausalLM.from_pretrained(\n+    \"tiiuae/falcon-mamba-7b-instruct\",\n+    torch_dtype=torch.bfloat16,\n+    device_map=\"auto\"\n+)\n \n-input_ids = tokenizer(\"Hey how are you doing?\", return_tensors= \"pt\")[\"input_ids\"]\n+input_ids = tokenizer(\"Explain the difference between transformers and SSMs\", return_tensors=\"pt\").to(\"cuda\")\n \n-out = model.generate(input_ids, max_new_tokens=10)\n-print(tokenizer.batch_decode(out))\n+output = model.generate(**input_ids, max_new_tokens=100, cache_implementation=\"static\")\n+print(tokenizer.decode(output[0], skip_special_tokens=True))\n ```\n \n-If you have access to a GPU that is compatible with `bitsandbytes`, you can also quantize the model in 4-bit precision:\n+</hfoption>\n+<hfoption id=\"transformers-cli\">\n \n-```python \n-from transformers import FalconMambaForCausalLM, AutoTokenizer, BitsAndBytesConfig\n-import torch\n-\n-tokenizer = AutoTokenizer.from_pretrained(\"tiiuae/falcon-mamba-7b\")\n-quantization_config = BitsAndBytesConfig(load_in_4bit=True)\n-model = FalconMambaForCausalLM.from_pretrained(\"tiiuae/falcon-mamba-7b\", quantization_config=quantization_config)\n+```bash\n+transformers-cli chat --model_name_or_path tiiuae/falcon-mamba-7b-instruct --torch_dtype auto --device 0\n+```\n \n-input_ids = tokenizer(\"Hey how are you doing?\", return_tensors= \"pt\")[\"input_ids\"]\n+</hfoption>\n+</hfoptions>\n \n-out = model.generate(input_ids, max_new_tokens=10)\n-print(tokenizer.batch_decode(out))\n-```\n+Quantization reduces the memory burden of large models by representing the weights in a lower precision. Refer to the [Quantization](../quantization/overview) overview for more available quantization backends.\n \n-You can also play with the instruction fine-tuned model:\n+The example below uses [bitsandbytes](../quantization/bitsandbytes) to quantize the weights to 4-bits.\n \n-```python \n-from transformers import FalconMambaForCausalLM, AutoTokenizer\n+```python\n import torch\n+from transformers import AutoTokenizer, FalconMambaForCausalLM, BitsAndBytesConfig\n \n-tokenizer = AutoTokenizer.from_pretrained(\"tiiuae/falcon-mamba-7b-instruct\")\n-model = FalconMambaForCausalLM.from_pretrained(\"tiiuae/falcon-mamba-7b-instruct\")\n+quantization_config = BitsAndBytesConfig(\n+    load_in_4bit=True,\n+    bnb_4bit_compute_dtype=torch.bfloat16,\n+    bnb_4bit_quant_type=\"nf4\",\n+    bnb_4bit_use_double_quant=True,\n+)\n \n-# We use the tokenizer's chat template to format each message - see https://huggingface.co/docs/transformers/main/en/chat_templating\n-messages = [\n-    {\"role\": \"user\", \"content\": \"How many helicopters can a human eat in one sitting?\"},\n-]\n-input_ids = tokenizer.apply_chat_template(messages, tokenize=False, add_generation_prompt=True).input_ids\n-\n-outputs = model.generate(input_ids)\n-print(tokenizer.decode(outputs[0]))\n+tokenizer = AutoTokenizer.from_pretrained(\"tiiuae/falcon-mamba-7b\")\n+model = FalconMambaForCausalLM.from_pretrained(\n+    \"tiiuae/falcon-mamba-7b\",\n+    torch_dtype=torch.bfloat16,\n+    device_map=\"auto\",\n+    quantization_config=quantization_config,\n+)\n+\n+inputs = tokenizer(\"Explain the concept of state space models in simple terms\", return_tensors=\"pt\").to(\"cuda\")\n+outputs = model.generate(**inputs, max_new_tokens=100)\n+print(tokenizer.decode(outputs[0], skip_special_tokens=True))\n ```\n \n ## FalconMambaConfig"
        }
    ],
    "stats": {
        "total": 131,
        "additions": 68,
        "deletions": 63
    }
}