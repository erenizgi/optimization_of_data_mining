{
    "author": "McPatate",
    "message": "feat: run benchmarks on A100 (#34287)",
    "sha": "6cc4a67b3d22445cd17e26922ba4435a5e97f759",
    "files": [
        {
            "sha": "a65b8cafe562ec0cb5ed626ef6443907a8af6c8a",
            "filename": ".github/workflows/benchmark.yml",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/huggingface/transformers/blob/6cc4a67b3d22445cd17e26922ba4435a5e97f759/.github%2Fworkflows%2Fbenchmark.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/6cc4a67b3d22445cd17e26922ba4435a5e97f759/.github%2Fworkflows%2Fbenchmark.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Fbenchmark.yml?ref=6cc4a67b3d22445cd17e26922ba4435a5e97f759",
            "patch": "@@ -16,8 +16,11 @@ env:\n jobs:\r\n   benchmark:\r\n     name: Benchmark\r\n+    strategy:\r\n+      matrix:\r\n+        group: [aws-g5-4xlarge-cache, aws-p4d-24xlarge-plus]\r\n     runs-on:\r\n-      group: aws-g5-4xlarge-cache\r\n+      group: ${{ matrix.group }}\r\n     if: |\r\n       (github.event_name == 'pull_request' && contains( github.event.pull_request.labels.*.name, 'run-benchmark') )||\r\n       (github.event_name == 'push' && github.ref == 'refs/heads/main')\r\n@@ -60,9 +63,13 @@ jobs:\n             commit_id=$GITHUB_SHA\r\n           fi\r\n           commit_msg=$(git show -s --format=%s | cut -c1-70)\r\n+          df -h\r\n           python3 benchmark/llama.py \"${{ github.head_ref || github.ref_name }}\" \"$commit_id\" \"$commit_msg\"\r\n         env:\r\n           HF_TOKEN: ${{ secrets.HF_HUB_READ_TOKEN }}\r\n+          # Enable this to see debug logs\r\n+          # HF_HUB_VERBOSITY: debug\r\n+          # TRANSFORMERS_VERBOSITY: debug\r\n           PGHOST: ${{ secrets.TRANSFORMERS_BENCHMARKS_PGHOST }}\r\n           PGUSER: transformers_benchmarks\r\n           PGPASSWORD: ${{ secrets.TRANSFORMERS_BENCHMARKS_PGPASSWORD }}\r"
        },
        {
            "sha": "3d579f7b368711dbd4fd1751124e9707f5dbc0a3",
            "filename": "benchmark/grafana_dashboard.json",
            "status": "modified",
            "additions": 873,
            "deletions": 720,
            "changes": 1593,
            "blob_url": "https://github.com/huggingface/transformers/blob/6cc4a67b3d22445cd17e26922ba4435a5e97f759/benchmark%2Fgrafana_dashboard.json",
            "raw_url": "https://github.com/huggingface/transformers/raw/6cc4a67b3d22445cd17e26922ba4435a5e97f759/benchmark%2Fgrafana_dashboard.json",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/benchmark%2Fgrafana_dashboard.json?ref=6cc4a67b3d22445cd17e26922ba4435a5e97f759",
            "patch": "@@ -39,7 +39,7 @@\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -77,7 +77,7 @@\n             \"properties\": [\n               {\n                 \"id\": \"custom.width\",\n-                \"value\": 364\n+                \"value\": 196\n               }\n             ]\n           },\n@@ -101,7 +101,7 @@\n             \"properties\": [\n               {\n                 \"id\": \"custom.width\",\n-                \"value\": 708\n+                \"value\": 581\n               }\n             ]\n           },\n@@ -113,7 +113,7 @@\n             \"properties\": [\n               {\n                 \"id\": \"custom.width\",\n-                \"value\": 388\n+                \"value\": 379\n               }\n             ]\n           }\n@@ -148,7 +148,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT commit_id as commit_id, commit_message, gpu_name FROM benchmarks WHERE branch = '${branch}';\",\n+          \"rawSql\": \"SELECT commit_id as commit_id, commit_message, gpu_name, created_at AS date FROM benchmarks WHERE branch = '${branch}' ORDER BY benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -232,7 +232,7 @@\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -312,7 +312,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'first_eager_forward_pass_time_secs' AS double precision) AS first_eager_forward_pass_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}'\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'first_eager_forward_pass_time_secs' AS double precision) AS first_eager_forward_pass_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -334,14 +334,27 @@\n         }\n       ],\n       \"title\": \"First eager forward pass\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n     {\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -424,7 +437,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'second_eager_forward_pass_time_secs' AS double precision) AS second_eager_forward_pass_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}'\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'second_eager_forward_pass_time_secs' AS double precision) AS second_eager_forward_pass_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -446,6 +459,19 @@\n         }\n       ],\n       \"title\": \"Second eager forward pass\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n@@ -466,7 +492,7 @@\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -545,7 +571,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'time_to_first_token_secs' AS double precision) AS time_to_first_token_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}'\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'time_to_first_token_secs' AS double precision) AS time_to_first_token_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -567,14 +593,27 @@\n         }\n       ],\n       \"title\": \"Time to first token\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n     {\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -653,7 +692,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'time_to_second_token_secs' AS double precision) AS time_to_second_token_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}'\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'time_to_second_token_secs' AS double precision) AS time_to_second_token_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -675,14 +714,27 @@\n         }\n       ],\n       \"title\": \"Time to second token\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n     {\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -761,7 +813,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'time_to_third_token_secs' AS double precision) AS time_to_third_token_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}'\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'time_to_third_token_secs' AS double precision) AS time_to_third_token_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -783,14 +835,27 @@\n         }\n       ],\n       \"title\": \"Time to third token\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n     {\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -869,7 +934,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'time_to_next_token_mean_secs' AS double precision) AS time_to_next_token_mean_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}'\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'time_to_next_token_mean_secs' AS double precision) AS time_to_next_token_mean_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -891,6 +956,19 @@\n         }\n       ],\n       \"title\": \"Time to subsequent next tokens mean\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n@@ -911,7 +989,7 @@\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -990,7 +1068,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'first_compile_generate_time_secs' AS double precision) AS first_compile_generate_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}'\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'first_compile_generate_time_secs' AS double precision) AS first_compile_generate_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -1012,14 +1090,27 @@\n         }\n       ],\n       \"title\": \"First compile generate\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n     {\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -1098,7 +1189,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'second_compile_generate_time_secs' AS double precision) AS second_compile_generate_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}';\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'second_compile_generate_time_secs' AS double precision) AS second_compile_generate_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -1120,14 +1211,27 @@\n         }\n       ],\n       \"title\": \"Second compile generate\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n     {\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -1206,7 +1310,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'third_compile_generate_time_secs' AS double precision) AS third_compile_generate_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}';\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'third_compile_generate_time_secs' AS double precision) AS third_compile_generate_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -1228,14 +1332,27 @@\n         }\n       ],\n       \"title\": \"Third compile generate\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n     {\n       \"datasource\": {\n         \"default\": true,\n         \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n+        \"uid\": \"be28nkzirtb0gd\"\n       },\n       \"fieldConfig\": {\n         \"defaults\": {\n@@ -1314,7 +1431,7 @@\n           \"editorMode\": \"code\",\n           \"format\": \"table\",\n           \"rawQuery\": true,\n-          \"rawSql\": \"SELECT CAST(m.measurements->'fourth_compile_generate_time_secs' AS double precision) AS fourth_compile_generate_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}';\",\n+          \"rawSql\": \"SELECT CAST(m.measurements->'fourth_compile_generate_time_secs' AS double precision) AS fourth_compile_generate_time_secs, left(b.commit_id, 7), m.time FROM benchmarks as b JOIN model_measurements AS m ON b.benchmark_id = m.benchmark_id WHERE b.branch = '${branch}' AND gpu_name = '${gpu_name}' ORDER BY b.benchmark_id DESC LIMIT ${last_n_commits};\",\n           \"refId\": \"A\",\n           \"sql\": {\n             \"columns\": [\n@@ -1336,763 +1453,778 @@\n         }\n       ],\n       \"title\": \"Fourth compile generate\",\n+      \"transformations\": [\n+        {\n+          \"id\": \"sortBy\",\n+          \"options\": {\n+            \"fields\": {},\n+            \"sort\": [\n+              {\n+                \"field\": \"time\"\n+              }\n+            ]\n+          }\n+        }\n+      ],\n       \"transparent\": true,\n       \"type\": \"barchart\"\n     },\n     {\n-      \"collapsed\": false,\n+      \"collapsed\": true,\n       \"gridPos\": {\n         \"h\": 1,\n         \"w\": 24,\n         \"x\": 0,\n         \"y\": 64\n       },\n       \"id\": 15,\n-      \"panels\": [],\n-      \"title\": \"Usage metrics\",\n-      \"type\": \"row\"\n-    },\n-    {\n-      \"datasource\": {\n-        \"default\": true,\n-        \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n-      },\n-      \"fieldConfig\": {\n-        \"defaults\": {\n-          \"color\": {\n-            \"mode\": \"palette-classic\"\n+      \"panels\": [\n+        {\n+          \"datasource\": {\n+            \"default\": true,\n+            \"type\": \"grafana-postgresql-datasource\",\n+            \"uid\": \"be28nkzirtb0gd\"\n           },\n-          \"custom\": {\n-            \"axisBorderShow\": false,\n-            \"axisCenteredZero\": false,\n-            \"axisColorMode\": \"text\",\n-            \"axisLabel\": \"\",\n-            \"axisPlacement\": \"auto\",\n-            \"barAlignment\": 0,\n-            \"barWidthFactor\": 0.6,\n-            \"drawStyle\": \"line\",\n-            \"fillOpacity\": 0,\n-            \"gradientMode\": \"none\",\n-            \"hideFrom\": {\n-              \"legend\": false,\n-              \"tooltip\": false,\n-              \"viz\": false\n-            },\n-            \"insertNulls\": 60000,\n-            \"lineInterpolation\": \"linear\",\n-            \"lineWidth\": 1,\n-            \"pointSize\": 5,\n-            \"scaleDistribution\": {\n-              \"type\": \"linear\"\n+          \"fieldConfig\": {\n+            \"defaults\": {\n+              \"color\": {\n+                \"mode\": \"palette-classic\"\n+              },\n+              \"custom\": {\n+                \"axisBorderShow\": false,\n+                \"axisCenteredZero\": false,\n+                \"axisColorMode\": \"text\",\n+                \"axisLabel\": \"\",\n+                \"axisPlacement\": \"auto\",\n+                \"barAlignment\": 0,\n+                \"barWidthFactor\": 0.6,\n+                \"drawStyle\": \"line\",\n+                \"fillOpacity\": 0,\n+                \"gradientMode\": \"none\",\n+                \"hideFrom\": {\n+                  \"legend\": false,\n+                  \"tooltip\": false,\n+                  \"viz\": false\n+                },\n+                \"insertNulls\": 60000,\n+                \"lineInterpolation\": \"linear\",\n+                \"lineWidth\": 1,\n+                \"pointSize\": 5,\n+                \"scaleDistribution\": {\n+                  \"type\": \"linear\"\n+                },\n+                \"showPoints\": \"auto\",\n+                \"spanNulls\": false,\n+                \"stacking\": {\n+                  \"group\": \"A\",\n+                  \"mode\": \"none\"\n+                },\n+                \"thresholdsStyle\": {\n+                  \"mode\": \"off\"\n+                }\n+              },\n+              \"mappings\": [],\n+              \"thresholds\": {\n+                \"mode\": \"absolute\",\n+                \"steps\": [\n+                  {\n+                    \"color\": \"green\",\n+                    \"value\": null\n+                  },\n+                  {\n+                    \"color\": \"red\",\n+                    \"value\": 80\n+                  }\n+                ]\n+              },\n+              \"unit\": \"percent\"\n             },\n-            \"showPoints\": \"auto\",\n-            \"spanNulls\": false,\n-            \"stacking\": {\n-              \"group\": \"A\",\n-              \"mode\": \"none\"\n+            \"overrides\": []\n+          },\n+          \"gridPos\": {\n+            \"h\": 9,\n+            \"w\": 12,\n+            \"x\": 0,\n+            \"y\": 65\n+          },\n+          \"id\": 1,\n+          \"options\": {\n+            \"legend\": {\n+              \"calcs\": [],\n+              \"displayMode\": \"list\",\n+              \"placement\": \"bottom\",\n+              \"showLegend\": true\n             },\n-            \"thresholdsStyle\": {\n-              \"mode\": \"off\"\n+            \"tooltip\": {\n+              \"mode\": \"single\",\n+              \"sort\": \"none\"\n             }\n           },\n-          \"mappings\": [],\n-          \"thresholds\": {\n-            \"mode\": \"absolute\",\n-            \"steps\": [\n-              {\n-                \"color\": \"green\",\n-                \"value\": null\n+          \"targets\": [\n+            {\n+              \"datasource\": {\n+                \"type\": \"grafana-postgresql-datasource\",\n+                \"uid\": \"bdz2yss7sxo1sc\"\n               },\n-              {\n-                \"color\": \"red\",\n-                \"value\": 80\n-              }\n-            ]\n-          },\n-          \"unit\": \"percent\"\n-        },\n-        \"overrides\": []\n-      },\n-      \"gridPos\": {\n-        \"h\": 9,\n-        \"w\": 12,\n-        \"x\": 0,\n-        \"y\": 65\n-      },\n-      \"id\": 1,\n-      \"options\": {\n-        \"legend\": {\n-          \"calcs\": [],\n-          \"displayMode\": \"list\",\n-          \"placement\": \"bottom\",\n-          \"showLegend\": true\n+              \"editorMode\": \"code\",\n+              \"format\": \"table\",\n+              \"rawQuery\": true,\n+              \"rawSql\": \"SELECT\\n  d.cpu_util,\\n  d.time\\nFROM\\n  benchmarks AS b\\n  JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id\\nWHERE\\n  branch = '${branch}';\",\n+              \"refId\": \"A\",\n+              \"sql\": {\n+                \"columns\": [\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"cpu_util\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"mem_megabytes\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"gpu_util\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"gpu_mem_megabytes\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"\\\"time\\\"\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  }\n+                ],\n+                \"groupBy\": [\n+                  {\n+                    \"property\": {\n+                      \"type\": \"string\"\n+                    },\n+                    \"type\": \"groupBy\"\n+                  }\n+                ],\n+                \"limit\": 50,\n+                \"whereJsonTree\": {\n+                  \"children1\": [\n+                    {\n+                      \"id\": \"baa888b8-89ab-4cde-b012-31922f8671e9\",\n+                      \"properties\": {\n+                        \"field\": \"commit_id\",\n+                        \"fieldSrc\": \"field\",\n+                        \"operator\": \"equal\",\n+                        \"value\": [\n+                          \"${commit}\"\n+                        ],\n+                        \"valueError\": [\n+                          null\n+                        ],\n+                        \"valueSrc\": [\n+                          \"value\"\n+                        ],\n+                        \"valueType\": [\n+                          \"text\"\n+                        ]\n+                      },\n+                      \"type\": \"rule\"\n+                    }\n+                  ],\n+                  \"id\": \"bab88a98-0123-4456-b89a-b1922f7d4f11\",\n+                  \"type\": \"group\"\n+                },\n+                \"whereString\": \"commit_id = '${commit}'\"\n+              },\n+              \"table\": \"measurements\"\n+            }\n+          ],\n+          \"title\": \"CPU Utilization\",\n+          \"transparent\": true,\n+          \"type\": \"timeseries\"\n         },\n-        \"tooltip\": {\n-          \"mode\": \"single\",\n-          \"sort\": \"none\"\n-        }\n-      },\n-      \"targets\": [\n         {\n           \"datasource\": {\n+            \"default\": true,\n             \"type\": \"grafana-postgresql-datasource\",\n-            \"uid\": \"bdz2yss7sxo1sc\"\n+            \"uid\": \"be28nkzirtb0gd\"\n           },\n-          \"editorMode\": \"code\",\n-          \"format\": \"table\",\n-          \"rawQuery\": true,\n-          \"rawSql\": \"SELECT\\n  d.cpu_util,\\n  d.time\\nFROM\\n  benchmarks AS b\\n  JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id\\nWHERE\\n  branch = '${branch}'\",\n-          \"refId\": \"A\",\n-          \"sql\": {\n-            \"columns\": [\n-              {\n-                \"parameters\": [\n+          \"fieldConfig\": {\n+            \"defaults\": {\n+              \"color\": {\n+                \"mode\": \"palette-classic\"\n+              },\n+              \"custom\": {\n+                \"axisBorderShow\": false,\n+                \"axisCenteredZero\": false,\n+                \"axisColorMode\": \"text\",\n+                \"axisLabel\": \"\",\n+                \"axisPlacement\": \"auto\",\n+                \"barAlignment\": 0,\n+                \"barWidthFactor\": 0.6,\n+                \"drawStyle\": \"line\",\n+                \"fillOpacity\": 0,\n+                \"gradientMode\": \"none\",\n+                \"hideFrom\": {\n+                  \"legend\": false,\n+                  \"tooltip\": false,\n+                  \"viz\": false\n+                },\n+                \"insertNulls\": 60000,\n+                \"lineInterpolation\": \"linear\",\n+                \"lineWidth\": 1,\n+                \"pointSize\": 5,\n+                \"scaleDistribution\": {\n+                  \"type\": \"linear\"\n+                },\n+                \"showPoints\": \"auto\",\n+                \"spanNulls\": false,\n+                \"stacking\": {\n+                  \"group\": \"A\",\n+                  \"mode\": \"none\"\n+                },\n+                \"thresholdsStyle\": {\n+                  \"mode\": \"off\"\n+                }\n+              },\n+              \"mappings\": [],\n+              \"thresholds\": {\n+                \"mode\": \"absolute\",\n+                \"steps\": [\n                   {\n-                    \"name\": \"cpu_util\",\n-                    \"type\": \"functionParameter\"\n+                    \"color\": \"green\",\n+                    \"value\": null\n+                  },\n+                  {\n+                    \"color\": \"red\",\n+                    \"value\": 80\n                   }\n-                ],\n-                \"type\": \"function\"\n+                ]\n               },\n-              {\n-                \"parameters\": [\n+              \"unit\": \"percent\"\n+            },\n+            \"overrides\": []\n+          },\n+          \"gridPos\": {\n+            \"h\": 9,\n+            \"w\": 12,\n+            \"x\": 12,\n+            \"y\": 65\n+          },\n+          \"id\": 4,\n+          \"options\": {\n+            \"legend\": {\n+              \"calcs\": [],\n+              \"displayMode\": \"list\",\n+              \"placement\": \"bottom\",\n+              \"showLegend\": true\n+            },\n+            \"tooltip\": {\n+              \"mode\": \"single\",\n+              \"sort\": \"none\"\n+            }\n+          },\n+          \"targets\": [\n+            {\n+              \"datasource\": {\n+                \"type\": \"grafana-postgresql-datasource\",\n+                \"uid\": \"bdz2yss7sxo1sc\"\n+              },\n+              \"editorMode\": \"code\",\n+              \"format\": \"table\",\n+              \"rawQuery\": true,\n+              \"rawSql\": \"SELECT\\n  b.commit_id,\\n  d.gpu_util,\\n  d.time\\nFROM\\n  benchmarks AS b\\n  JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id\\nWHERE\\n  branch = '${branch}';\",\n+              \"refId\": \"A\",\n+              \"sql\": {\n+                \"columns\": [\n                   {\n-                    \"name\": \"mem_megabytes\",\n-                    \"type\": \"functionParameter\"\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"cpu_util\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"mem_megabytes\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"gpu_util\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"gpu_mem_megabytes\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"\\\"time\\\"\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n                   }\n                 ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n+                \"groupBy\": [\n                   {\n-                    \"name\": \"gpu_util\",\n-                    \"type\": \"functionParameter\"\n+                    \"property\": {\n+                      \"type\": \"string\"\n+                    },\n+                    \"type\": \"groupBy\"\n                   }\n                 ],\n-                \"type\": \"function\"\n+                \"limit\": 50,\n+                \"whereJsonTree\": {\n+                  \"children1\": [\n+                    {\n+                      \"id\": \"baa888b8-89ab-4cde-b012-31922f8671e9\",\n+                      \"properties\": {\n+                        \"field\": \"commit_id\",\n+                        \"fieldSrc\": \"field\",\n+                        \"operator\": \"equal\",\n+                        \"value\": [\n+                          \"${commit}\"\n+                        ],\n+                        \"valueError\": [\n+                          null\n+                        ],\n+                        \"valueSrc\": [\n+                          \"value\"\n+                        ],\n+                        \"valueType\": [\n+                          \"text\"\n+                        ]\n+                      },\n+                      \"type\": \"rule\"\n+                    }\n+                  ],\n+                  \"id\": \"bab88a98-0123-4456-b89a-b1922f7d4f11\",\n+                  \"type\": \"group\"\n+                },\n+                \"whereString\": \"commit_id = '${commit}'\"\n               },\n-              {\n-                \"parameters\": [\n+              \"table\": \"measurements\"\n+            }\n+          ],\n+          \"title\": \"GPU Utilization\",\n+          \"transparent\": true,\n+          \"type\": \"timeseries\"\n+        },\n+        {\n+          \"datasource\": {\n+            \"default\": true,\n+            \"type\": \"grafana-postgresql-datasource\",\n+            \"uid\": \"be28nkzirtb0gd\"\n+          },\n+          \"fieldConfig\": {\n+            \"defaults\": {\n+              \"color\": {\n+                \"mode\": \"palette-classic\"\n+              },\n+              \"custom\": {\n+                \"axisBorderShow\": false,\n+                \"axisCenteredZero\": false,\n+                \"axisColorMode\": \"text\",\n+                \"axisLabel\": \"\",\n+                \"axisPlacement\": \"auto\",\n+                \"barAlignment\": 0,\n+                \"barWidthFactor\": 0.6,\n+                \"drawStyle\": \"line\",\n+                \"fillOpacity\": 0,\n+                \"gradientMode\": \"none\",\n+                \"hideFrom\": {\n+                  \"legend\": false,\n+                  \"tooltip\": false,\n+                  \"viz\": false\n+                },\n+                \"insertNulls\": 60000,\n+                \"lineInterpolation\": \"linear\",\n+                \"lineWidth\": 1,\n+                \"pointSize\": 5,\n+                \"scaleDistribution\": {\n+                  \"type\": \"linear\"\n+                },\n+                \"showPoints\": \"auto\",\n+                \"spanNulls\": false,\n+                \"stacking\": {\n+                  \"group\": \"A\",\n+                  \"mode\": \"none\"\n+                },\n+                \"thresholdsStyle\": {\n+                  \"mode\": \"off\"\n+                }\n+              },\n+              \"mappings\": [],\n+              \"thresholds\": {\n+                \"mode\": \"absolute\",\n+                \"steps\": [\n                   {\n-                    \"name\": \"gpu_mem_megabytes\",\n-                    \"type\": \"functionParameter\"\n+                    \"color\": \"green\",\n+                    \"value\": null\n+                  },\n+                  {\n+                    \"color\": \"red\",\n+                    \"value\": 80\n                   }\n-                ],\n-                \"type\": \"function\"\n+                ]\n               },\n-              {\n-                \"parameters\": [\n+              \"unit\": \"decmbytes\"\n+            },\n+            \"overrides\": []\n+          },\n+          \"gridPos\": {\n+            \"h\": 9,\n+            \"w\": 12,\n+            \"x\": 0,\n+            \"y\": 74\n+          },\n+          \"id\": 2,\n+          \"options\": {\n+            \"legend\": {\n+              \"calcs\": [],\n+              \"displayMode\": \"list\",\n+              \"placement\": \"bottom\",\n+              \"showLegend\": true\n+            },\n+            \"tooltip\": {\n+              \"mode\": \"single\",\n+              \"sort\": \"none\"\n+            }\n+          },\n+          \"targets\": [\n+            {\n+              \"datasource\": {\n+                \"type\": \"grafana-postgresql-datasource\",\n+                \"uid\": \"bdz2yss7sxo1sc\"\n+              },\n+              \"editorMode\": \"code\",\n+              \"format\": \"table\",\n+              \"rawQuery\": true,\n+              \"rawSql\": \"SELECT d.mem_megabytes, d.time FROM benchmarks AS b JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id WHERE branch = '${branch}';\",\n+              \"refId\": \"A\",\n+              \"sql\": {\n+                \"columns\": [\n                   {\n-                    \"name\": \"\\\"time\\\"\",\n-                    \"type\": \"functionParameter\"\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"cpu_util\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"mem_megabytes\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"gpu_util\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"gpu_mem_megabytes\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"\\\"time\\\"\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n                   }\n                 ],\n-                \"type\": \"function\"\n-              }\n-            ],\n-            \"groupBy\": [\n-              {\n-                \"property\": {\n-                  \"type\": \"string\"\n-                },\n-                \"type\": \"groupBy\"\n-              }\n-            ],\n-            \"limit\": 50,\n-            \"whereJsonTree\": {\n-              \"children1\": [\n-                {\n-                  \"id\": \"baa888b8-89ab-4cde-b012-31922f8671e9\",\n-                  \"properties\": {\n-                    \"field\": \"commit_id\",\n-                    \"fieldSrc\": \"field\",\n-                    \"operator\": \"equal\",\n-                    \"value\": [\n-                      \"${commit}\"\n-                    ],\n-                    \"valueError\": [\n-                      null\n-                    ],\n-                    \"valueSrc\": [\n-                      \"value\"\n-                    ],\n-                    \"valueType\": [\n-                      \"text\"\n-                    ]\n-                  },\n-                  \"type\": \"rule\"\n-                }\n-              ],\n-              \"id\": \"bab88a98-0123-4456-b89a-b1922f7d4f11\",\n-              \"type\": \"group\"\n-            },\n-            \"whereString\": \"commit_id = '${commit}'\"\n-          },\n-          \"table\": \"measurements\"\n-        }\n-      ],\n-      \"title\": \"CPU Utilization\",\n-      \"transparent\": true,\n-      \"type\": \"timeseries\"\n-    },\n-    {\n-      \"datasource\": {\n-        \"default\": true,\n-        \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n-      },\n-      \"fieldConfig\": {\n-        \"defaults\": {\n-          \"color\": {\n-            \"mode\": \"palette-classic\"\n-          },\n-          \"custom\": {\n-            \"axisBorderShow\": false,\n-            \"axisCenteredZero\": false,\n-            \"axisColorMode\": \"text\",\n-            \"axisLabel\": \"\",\n-            \"axisPlacement\": \"auto\",\n-            \"barAlignment\": 0,\n-            \"barWidthFactor\": 0.6,\n-            \"drawStyle\": \"line\",\n-            \"fillOpacity\": 0,\n-            \"gradientMode\": \"none\",\n-            \"hideFrom\": {\n-              \"legend\": false,\n-              \"tooltip\": false,\n-              \"viz\": false\n-            },\n-            \"insertNulls\": 60000,\n-            \"lineInterpolation\": \"linear\",\n-            \"lineWidth\": 1,\n-            \"pointSize\": 5,\n-            \"scaleDistribution\": {\n-              \"type\": \"linear\"\n-            },\n-            \"showPoints\": \"auto\",\n-            \"spanNulls\": false,\n-            \"stacking\": {\n-              \"group\": \"A\",\n-              \"mode\": \"none\"\n-            },\n-            \"thresholdsStyle\": {\n-              \"mode\": \"off\"\n-            }\n-          },\n-          \"mappings\": [],\n-          \"thresholds\": {\n-            \"mode\": \"absolute\",\n-            \"steps\": [\n-              {\n-                \"color\": \"green\",\n-                \"value\": null\n-              },\n-              {\n-                \"color\": \"red\",\n-                \"value\": 80\n-              }\n-            ]\n-          },\n-          \"unit\": \"percent\"\n-        },\n-        \"overrides\": []\n-      },\n-      \"gridPos\": {\n-        \"h\": 9,\n-        \"w\": 12,\n-        \"x\": 12,\n-        \"y\": 65\n-      },\n-      \"id\": 4,\n-      \"options\": {\n-        \"legend\": {\n-          \"calcs\": [],\n-          \"displayMode\": \"list\",\n-          \"placement\": \"bottom\",\n-          \"showLegend\": true\n-        },\n-        \"tooltip\": {\n-          \"mode\": \"single\",\n-          \"sort\": \"none\"\n-        }\n-      },\n-      \"targets\": [\n-        {\n-          \"datasource\": {\n-            \"type\": \"grafana-postgresql-datasource\",\n-            \"uid\": \"bdz2yss7sxo1sc\"\n-          },\n-          \"editorMode\": \"code\",\n-          \"format\": \"table\",\n-          \"rawQuery\": true,\n-          \"rawSql\": \"SELECT\\n  b.commit_id,\\n  d.gpu_util,\\n  d.time\\nFROM\\n  benchmarks AS b\\n  JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id\\nWHERE\\n  branch = '${branch}'\",\n-          \"refId\": \"A\",\n-          \"sql\": {\n-            \"columns\": [\n-              {\n-                \"parameters\": [\n-                  {\n-                    \"name\": \"cpu_util\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n+                \"groupBy\": [\n                   {\n-                    \"name\": \"mem_megabytes\",\n-                    \"type\": \"functionParameter\"\n+                    \"property\": {\n+                      \"type\": \"string\"\n+                    },\n+                    \"type\": \"groupBy\"\n                   }\n                 ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n-                  {\n-                    \"name\": \"gpu_util\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n-                  {\n-                    \"name\": \"gpu_mem_megabytes\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n-                  {\n-                    \"name\": \"\\\"time\\\"\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n-              }\n-            ],\n-            \"groupBy\": [\n-              {\n-                \"property\": {\n-                  \"type\": \"string\"\n+                \"limit\": 50,\n+                \"whereJsonTree\": {\n+                  \"children1\": [\n+                    {\n+                      \"id\": \"baa888b8-89ab-4cde-b012-31922f8671e9\",\n+                      \"properties\": {\n+                        \"field\": \"commit_id\",\n+                        \"fieldSrc\": \"field\",\n+                        \"operator\": \"equal\",\n+                        \"value\": [\n+                          \"${commit}\"\n+                        ],\n+                        \"valueError\": [\n+                          null\n+                        ],\n+                        \"valueSrc\": [\n+                          \"value\"\n+                        ],\n+                        \"valueType\": [\n+                          \"text\"\n+                        ]\n+                      },\n+                      \"type\": \"rule\"\n+                    }\n+                  ],\n+                  \"id\": \"bab88a98-0123-4456-b89a-b1922f7d4f11\",\n+                  \"type\": \"group\"\n                 },\n-                \"type\": \"groupBy\"\n-              }\n-            ],\n-            \"limit\": 50,\n-            \"whereJsonTree\": {\n-              \"children1\": [\n-                {\n-                  \"id\": \"baa888b8-89ab-4cde-b012-31922f8671e9\",\n-                  \"properties\": {\n-                    \"field\": \"commit_id\",\n-                    \"fieldSrc\": \"field\",\n-                    \"operator\": \"equal\",\n-                    \"value\": [\n-                      \"${commit}\"\n-                    ],\n-                    \"valueError\": [\n-                      null\n-                    ],\n-                    \"valueSrc\": [\n-                      \"value\"\n-                    ],\n-                    \"valueType\": [\n-                      \"text\"\n-                    ]\n-                  },\n-                  \"type\": \"rule\"\n-                }\n-              ],\n-              \"id\": \"bab88a98-0123-4456-b89a-b1922f7d4f11\",\n-              \"type\": \"group\"\n-            },\n-            \"whereString\": \"commit_id = '${commit}'\"\n-          },\n-          \"table\": \"measurements\"\n-        }\n-      ],\n-      \"title\": \"GPU Utilization\",\n-      \"transparent\": true,\n-      \"type\": \"timeseries\"\n-    },\n-    {\n-      \"datasource\": {\n-        \"default\": true,\n-        \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n-      },\n-      \"fieldConfig\": {\n-        \"defaults\": {\n-          \"color\": {\n-            \"mode\": \"palette-classic\"\n-          },\n-          \"custom\": {\n-            \"axisBorderShow\": false,\n-            \"axisCenteredZero\": false,\n-            \"axisColorMode\": \"text\",\n-            \"axisLabel\": \"\",\n-            \"axisPlacement\": \"auto\",\n-            \"barAlignment\": 0,\n-            \"barWidthFactor\": 0.6,\n-            \"drawStyle\": \"line\",\n-            \"fillOpacity\": 0,\n-            \"gradientMode\": \"none\",\n-            \"hideFrom\": {\n-              \"legend\": false,\n-              \"tooltip\": false,\n-              \"viz\": false\n-            },\n-            \"insertNulls\": 60000,\n-            \"lineInterpolation\": \"linear\",\n-            \"lineWidth\": 1,\n-            \"pointSize\": 5,\n-            \"scaleDistribution\": {\n-              \"type\": \"linear\"\n-            },\n-            \"showPoints\": \"auto\",\n-            \"spanNulls\": false,\n-            \"stacking\": {\n-              \"group\": \"A\",\n-              \"mode\": \"none\"\n-            },\n-            \"thresholdsStyle\": {\n-              \"mode\": \"off\"\n-            }\n-          },\n-          \"mappings\": [],\n-          \"thresholds\": {\n-            \"mode\": \"absolute\",\n-            \"steps\": [\n-              {\n-                \"color\": \"green\",\n-                \"value\": null\n+                \"whereString\": \"commit_id = '${commit}'\"\n               },\n-              {\n-                \"color\": \"red\",\n-                \"value\": 80\n-              }\n-            ]\n-          },\n-          \"unit\": \"decmbytes\"\n-        },\n-        \"overrides\": []\n-      },\n-      \"gridPos\": {\n-        \"h\": 9,\n-        \"w\": 12,\n-        \"x\": 0,\n-        \"y\": 74\n-      },\n-      \"id\": 2,\n-      \"options\": {\n-        \"legend\": {\n-          \"calcs\": [],\n-          \"displayMode\": \"list\",\n-          \"placement\": \"bottom\",\n-          \"showLegend\": true\n+              \"table\": \"measurements\"\n+            }\n+          ],\n+          \"title\": \"Memory usage\",\n+          \"transparent\": true,\n+          \"type\": \"timeseries\"\n         },\n-        \"tooltip\": {\n-          \"mode\": \"single\",\n-          \"sort\": \"none\"\n-        }\n-      },\n-      \"targets\": [\n         {\n           \"datasource\": {\n+            \"default\": true,\n             \"type\": \"grafana-postgresql-datasource\",\n-            \"uid\": \"bdz2yss7sxo1sc\"\n+            \"uid\": \"be28nkzirtb0gd\"\n           },\n-          \"editorMode\": \"code\",\n-          \"format\": \"table\",\n-          \"rawQuery\": true,\n-          \"rawSql\": \"SELECT d.mem_megabytes, d.time FROM benchmarks AS b JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id WHERE branch = '${branch}'\",\n-          \"refId\": \"A\",\n-          \"sql\": {\n-            \"columns\": [\n-              {\n-                \"parameters\": [\n-                  {\n-                    \"name\": \"cpu_util\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n+          \"fieldConfig\": {\n+            \"defaults\": {\n+              \"color\": {\n+                \"mode\": \"palette-classic\"\n               },\n-              {\n-                \"parameters\": [\n-                  {\n-                    \"name\": \"mem_megabytes\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n+              \"custom\": {\n+                \"axisBorderShow\": false,\n+                \"axisCenteredZero\": false,\n+                \"axisColorMode\": \"text\",\n+                \"axisLabel\": \"\",\n+                \"axisPlacement\": \"auto\",\n+                \"barAlignment\": 0,\n+                \"barWidthFactor\": 0.6,\n+                \"drawStyle\": \"line\",\n+                \"fillOpacity\": 0,\n+                \"gradientMode\": \"none\",\n+                \"hideFrom\": {\n+                  \"legend\": false,\n+                  \"tooltip\": false,\n+                  \"viz\": false\n+                },\n+                \"insertNulls\": 60000,\n+                \"lineInterpolation\": \"linear\",\n+                \"lineWidth\": 1,\n+                \"pointSize\": 5,\n+                \"scaleDistribution\": {\n+                  \"type\": \"linear\"\n+                },\n+                \"showPoints\": \"auto\",\n+                \"spanNulls\": false,\n+                \"stacking\": {\n+                  \"group\": \"A\",\n+                  \"mode\": \"none\"\n+                },\n+                \"thresholdsStyle\": {\n+                  \"mode\": \"off\"\n+                }\n               },\n-              {\n-                \"parameters\": [\n+              \"mappings\": [],\n+              \"thresholds\": {\n+                \"mode\": \"absolute\",\n+                \"steps\": [\n                   {\n-                    \"name\": \"gpu_util\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n+                    \"color\": \"green\",\n+                    \"value\": null\n+                  },\n                   {\n-                    \"name\": \"gpu_mem_megabytes\",\n-                    \"type\": \"functionParameter\"\n+                    \"color\": \"red\",\n+                    \"value\": 80\n                   }\n-                ],\n-                \"type\": \"function\"\n+                ]\n               },\n-              {\n-                \"parameters\": [\n-                  {\n-                    \"name\": \"\\\"time\\\"\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n-              }\n-            ],\n-            \"groupBy\": [\n-              {\n-                \"property\": {\n-                  \"type\": \"string\"\n-                },\n-                \"type\": \"groupBy\"\n-              }\n-            ],\n-            \"limit\": 50,\n-            \"whereJsonTree\": {\n-              \"children1\": [\n-                {\n-                  \"id\": \"baa888b8-89ab-4cde-b012-31922f8671e9\",\n-                  \"properties\": {\n-                    \"field\": \"commit_id\",\n-                    \"fieldSrc\": \"field\",\n-                    \"operator\": \"equal\",\n-                    \"value\": [\n-                      \"${commit}\"\n-                    ],\n-                    \"valueError\": [\n-                      null\n-                    ],\n-                    \"valueSrc\": [\n-                      \"value\"\n-                    ],\n-                    \"valueType\": [\n-                      \"text\"\n-                    ]\n-                  },\n-                  \"type\": \"rule\"\n-                }\n-              ],\n-              \"id\": \"bab88a98-0123-4456-b89a-b1922f7d4f11\",\n-              \"type\": \"group\"\n-            },\n-            \"whereString\": \"commit_id = '${commit}'\"\n-          },\n-          \"table\": \"measurements\"\n-        }\n-      ],\n-      \"title\": \"Memory usage\",\n-      \"transparent\": true,\n-      \"type\": \"timeseries\"\n-    },\n-    {\n-      \"datasource\": {\n-        \"default\": true,\n-        \"type\": \"grafana-postgresql-datasource\",\n-        \"uid\": \"de0dbhs18ho1sc\"\n-      },\n-      \"fieldConfig\": {\n-        \"defaults\": {\n-          \"color\": {\n-            \"mode\": \"palette-classic\"\n-          },\n-          \"custom\": {\n-            \"axisBorderShow\": false,\n-            \"axisCenteredZero\": false,\n-            \"axisColorMode\": \"text\",\n-            \"axisLabel\": \"\",\n-            \"axisPlacement\": \"auto\",\n-            \"barAlignment\": 0,\n-            \"barWidthFactor\": 0.6,\n-            \"drawStyle\": \"line\",\n-            \"fillOpacity\": 0,\n-            \"gradientMode\": \"none\",\n-            \"hideFrom\": {\n-              \"legend\": false,\n-              \"tooltip\": false,\n-              \"viz\": false\n-            },\n-            \"insertNulls\": 60000,\n-            \"lineInterpolation\": \"linear\",\n-            \"lineWidth\": 1,\n-            \"pointSize\": 5,\n-            \"scaleDistribution\": {\n-              \"type\": \"linear\"\n+              \"unit\": \"decmbytes\"\n             },\n-            \"showPoints\": \"auto\",\n-            \"spanNulls\": false,\n-            \"stacking\": {\n-              \"group\": \"A\",\n-              \"mode\": \"none\"\n+            \"overrides\": []\n+          },\n+          \"gridPos\": {\n+            \"h\": 9,\n+            \"w\": 12,\n+            \"x\": 12,\n+            \"y\": 74\n+          },\n+          \"id\": 3,\n+          \"options\": {\n+            \"legend\": {\n+              \"calcs\": [],\n+              \"displayMode\": \"list\",\n+              \"placement\": \"bottom\",\n+              \"showLegend\": true\n             },\n-            \"thresholdsStyle\": {\n-              \"mode\": \"off\"\n+            \"tooltip\": {\n+              \"mode\": \"single\",\n+              \"sort\": \"none\"\n             }\n           },\n-          \"mappings\": [],\n-          \"thresholds\": {\n-            \"mode\": \"absolute\",\n-            \"steps\": [\n-              {\n-                \"color\": \"green\",\n-                \"value\": null\n+          \"targets\": [\n+            {\n+              \"datasource\": {\n+                \"type\": \"grafana-postgresql-datasource\",\n+                \"uid\": \"bdz2yss7sxo1sc\"\n               },\n-              {\n-                \"color\": \"red\",\n-                \"value\": 80\n-              }\n-            ]\n-          },\n-          \"unit\": \"decmbytes\"\n-        },\n-        \"overrides\": []\n-      },\n-      \"gridPos\": {\n-        \"h\": 9,\n-        \"w\": 12,\n-        \"x\": 12,\n-        \"y\": 74\n-      },\n-      \"id\": 3,\n-      \"options\": {\n-        \"legend\": {\n-          \"calcs\": [],\n-          \"displayMode\": \"list\",\n-          \"placement\": \"bottom\",\n-          \"showLegend\": true\n-        },\n-        \"tooltip\": {\n-          \"mode\": \"single\",\n-          \"sort\": \"none\"\n-        }\n-      },\n-      \"targets\": [\n-        {\n-          \"datasource\": {\n-            \"type\": \"grafana-postgresql-datasource\",\n-            \"uid\": \"bdz2yss7sxo1sc\"\n-          },\n-          \"editorMode\": \"code\",\n-          \"format\": \"table\",\n-          \"rawQuery\": true,\n-          \"rawSql\": \"SELECT\\n  d.gpu_mem_megabytes,\\n  d.time\\nFROM\\n  benchmarks AS b\\n  JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id\\nWHERE\\n  branch = '${branch}'\",\n-          \"refId\": \"A\",\n-          \"sql\": {\n-            \"columns\": [\n-              {\n-                \"parameters\": [\n+              \"editorMode\": \"code\",\n+              \"format\": \"table\",\n+              \"rawQuery\": true,\n+              \"rawSql\": \"SELECT\\n  d.gpu_mem_megabytes,\\n  d.time\\nFROM\\n  benchmarks AS b\\n  JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id\\nWHERE\\n  branch = '${branch}';\",\n+              \"refId\": \"A\",\n+              \"sql\": {\n+                \"columns\": [\n                   {\n-                    \"name\": \"cpu_util\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"cpu_util\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n                   {\n-                    \"name\": \"mem_megabytes\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"mem_megabytes\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n                   {\n-                    \"name\": \"gpu_util\",\n-                    \"type\": \"functionParameter\"\n-                  }\n-                ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"gpu_util\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n                   {\n-                    \"name\": \"gpu_mem_megabytes\",\n-                    \"type\": \"functionParameter\"\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"gpu_mem_megabytes\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n+                  },\n+                  {\n+                    \"parameters\": [\n+                      {\n+                        \"name\": \"\\\"time\\\"\",\n+                        \"type\": \"functionParameter\"\n+                      }\n+                    ],\n+                    \"type\": \"function\"\n                   }\n                 ],\n-                \"type\": \"function\"\n-              },\n-              {\n-                \"parameters\": [\n+                \"groupBy\": [\n                   {\n-                    \"name\": \"\\\"time\\\"\",\n-                    \"type\": \"functionParameter\"\n+                    \"property\": {\n+                      \"type\": \"string\"\n+                    },\n+                    \"type\": \"groupBy\"\n                   }\n                 ],\n-                \"type\": \"function\"\n-              }\n-            ],\n-            \"groupBy\": [\n-              {\n-                \"property\": {\n-                  \"type\": \"string\"\n+                \"limit\": 50,\n+                \"whereJsonTree\": {\n+                  \"children1\": [\n+                    {\n+                      \"id\": \"baa888b8-89ab-4cde-b012-31922f8671e9\",\n+                      \"properties\": {\n+                        \"field\": \"commit_id\",\n+                        \"fieldSrc\": \"field\",\n+                        \"operator\": \"equal\",\n+                        \"value\": [\n+                          \"${commit}\"\n+                        ],\n+                        \"valueError\": [\n+                          null\n+                        ],\n+                        \"valueSrc\": [\n+                          \"value\"\n+                        ],\n+                        \"valueType\": [\n+                          \"text\"\n+                        ]\n+                      },\n+                      \"type\": \"rule\"\n+                    }\n+                  ],\n+                  \"id\": \"bab88a98-0123-4456-b89a-b1922f7d4f11\",\n+                  \"type\": \"group\"\n                 },\n-                \"type\": \"groupBy\"\n-              }\n-            ],\n-            \"limit\": 50,\n-            \"whereJsonTree\": {\n-              \"children1\": [\n-                {\n-                  \"id\": \"baa888b8-89ab-4cde-b012-31922f8671e9\",\n-                  \"properties\": {\n-                    \"field\": \"commit_id\",\n-                    \"fieldSrc\": \"field\",\n-                    \"operator\": \"equal\",\n-                    \"value\": [\n-                      \"${commit}\"\n-                    ],\n-                    \"valueError\": [\n-                      null\n-                    ],\n-                    \"valueSrc\": [\n-                      \"value\"\n-                    ],\n-                    \"valueType\": [\n-                      \"text\"\n-                    ]\n-                  },\n-                  \"type\": \"rule\"\n-                }\n-              ],\n-              \"id\": \"bab88a98-0123-4456-b89a-b1922f7d4f11\",\n-              \"type\": \"group\"\n-            },\n-            \"whereString\": \"commit_id = '${commit}'\"\n-          },\n-          \"table\": \"measurements\"\n+                \"whereString\": \"commit_id = '${commit}'\"\n+              },\n+              \"table\": \"measurements\"\n+            }\n+          ],\n+          \"title\": \"GPU memory usage\",\n+          \"transparent\": true,\n+          \"type\": \"timeseries\"\n         }\n       ],\n-      \"title\": \"GPU memory usage\",\n-      \"transparent\": true,\n-      \"type\": \"timeseries\"\n+      \"title\": \"Usage metrics\",\n+      \"type\": \"row\"\n     }\n   ],\n+  \"refresh\": \"\",\n   \"schemaVersion\": 39,\n   \"tags\": [],\n   \"templating\": {\n@@ -2105,7 +2237,7 @@\n         },\n         \"datasource\": {\n           \"type\": \"grafana-postgresql-datasource\",\n-          \"uid\": \"de0dbhs18ho1sc\"\n+          \"uid\": \"be28nkzirtb0gd\"\n         },\n         \"definition\": \"SELECT DISTINCT branch FROM benchmarks;\",\n         \"description\": \"\",\n@@ -2125,12 +2257,12 @@\n       {\n         \"current\": {\n           \"selected\": false,\n-          \"text\": \"1728662868776\",\n-          \"value\": \"1728662868776\"\n+          \"text\": \"1729701492845\",\n+          \"value\": \"1729701492845\"\n         },\n         \"datasource\": {\n           \"type\": \"grafana-postgresql-datasource\",\n-          \"uid\": \"de0dbhs18ho1sc\"\n+          \"uid\": \"be28nkzirtb0gd\"\n         },\n         \"definition\": \"SELECT created_at - INTERVAL '5 secs' FROM benchmarks WHERE branch = '${branch}' ORDER BY benchmark_id ASC LIMIT 1;\",\n         \"description\": \"\",\n@@ -2149,12 +2281,12 @@\n       {\n         \"current\": {\n           \"selected\": false,\n-          \"text\": \"1728663254125\",\n-          \"value\": \"1728663254125\"\n+          \"text\": \"1730120430069\",\n+          \"value\": \"1730120430069\"\n         },\n         \"datasource\": {\n           \"type\": \"grafana-postgresql-datasource\",\n-          \"uid\": \"de0dbhs18ho1sc\"\n+          \"uid\": \"be28nkzirtb0gd\"\n         },\n         \"definition\": \"SELECT time + INTERVAL '5 secs' FROM benchmarks AS b JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id WHERE branch = '${branch}' ORDER BY b.benchmark_id DESC, d.measurement_id DESC LIMIT 1;\",\n         \"description\": \"\",\n@@ -2164,7 +2296,7 @@\n         \"name\": \"EndTime\",\n         \"options\": [],\n         \"query\": \"SELECT time + INTERVAL '5 secs' FROM benchmarks AS b JOIN device_measurements AS d ON b.benchmark_id = d.benchmark_id WHERE branch = '${branch}' ORDER BY b.benchmark_id DESC, d.measurement_id DESC LIMIT 1;\",\n-        \"refresh\": 2,\n+        \"refresh\": 1,\n         \"regex\": \"\",\n         \"skipUrlSync\": false,\n         \"sort\": 0,\n@@ -2178,7 +2310,7 @@\n         },\n         \"datasource\": {\n           \"type\": \"grafana-postgresql-datasource\",\n-          \"uid\": \"de0dbhs18ho1sc\"\n+          \"uid\": \"be28nkzirtb0gd\"\n         },\n         \"definition\": \"SELECT DISTINCT gpu_name FROM benchmarks;\",\n         \"hide\": 0,\n@@ -2188,11 +2320,32 @@\n         \"name\": \"gpu_name\",\n         \"options\": [],\n         \"query\": \"SELECT DISTINCT gpu_name FROM benchmarks;\",\n-        \"refresh\": 1,\n+        \"refresh\": 2,\n         \"regex\": \"\",\n         \"skipUrlSync\": false,\n         \"sort\": 0,\n         \"type\": \"query\"\n+      },\n+      {\n+        \"current\": {\n+          \"selected\": false,\n+          \"text\": \"10\",\n+          \"value\": \"10\"\n+        },\n+        \"description\": \"The number of commits to display, going from most recent to the nth commit.\",\n+        \"hide\": 0,\n+        \"label\": \"Last # of commits\",\n+        \"name\": \"last_n_commits\",\n+        \"options\": [\n+          {\n+            \"selected\": true,\n+            \"text\": \"10\",\n+            \"value\": \"10\"\n+          }\n+        ],\n+        \"query\": \"10\",\n+        \"skipUrlSync\": false,\n+        \"type\": \"textbox\"\n       }\n     ]\n   },\n@@ -2206,6 +2359,6 @@\n   \"timezone\": \"browser\",\n   \"title\": \"Transformers benchmarks\",\n   \"uid\": \"fdz33iyzln9c0a\",\n-  \"version\": 11,\n+  \"version\": 4,\n   \"weekStart\": \"\"\n }"
        },
        {
            "sha": "4a2c57422e6ffba8ebc0393903471f23f08f12b5",
            "filename": "benchmark/llama.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/6cc4a67b3d22445cd17e26922ba4435a5e97f759/benchmark%2Fllama.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/6cc4a67b3d22445cd17e26922ba4435a5e97f759/benchmark%2Fllama.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/benchmark%2Fllama.py?ref=6cc4a67b3d22445cd17e26922ba4435a5e97f759",
            "patch": "@@ -96,17 +96,21 @@ def run_benchmark(branch: str, commit_id: str, commit_msg: str, num_tokens_to_ge\n         )\n         conn.commit()\n         benchmark_id = cur.fetchone()[0]\n+        logger.info(f\"running benchmark #{benchmark_id} on {gpu_name}\")\n         metrics_thread = Thread(target=collect_metrics, args=[benchmark_id, continue_metric_collection])\n         metrics_thread.start()\n+        logger.info(\"started background thread to fetch device metrics\")\n \n         os.environ[\"TOKENIZERS_PARALLELISM\"] = \"false\"  # silence warnings when compiling\n \n         device = \"cuda\"\n         ckpt = \"meta-llama/Llama-2-7b-hf\"\n \n+        logger.info(\"downloading weights\")\n         # This is to avoid counting download in model load time measurement\n         model = AutoModelForCausalLM.from_pretrained(ckpt, torch_dtype=torch.float16)\n         gen_config = GenerationConfig(do_sample=False, top_p=1, temperature=1)\n+        logger.info(\"loading model\")\n         start = perf_counter()\n         model = AutoModelForCausalLM.from_pretrained(\n             ckpt, torch_dtype=torch.float16, generation_config=gen_config"
        }
    ],
    "stats": {
        "total": 1606,
        "additions": 885,
        "deletions": 721
    }
}