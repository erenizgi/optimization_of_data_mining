{
    "author": "remi-or",
    "message": "Fix a bug where compile_config gets deleted (#42474)\n\n* Fix a bug where compile_config gets deleted\n\n* Change new kwarg name",
    "sha": "a0216a8021d8b950c69db06440e38307cfa570d4",
    "files": [
        {
            "sha": "d224eb96174a0998e4cfa235816c3a53b2c4701f",
            "filename": "src/transformers/generation/configuration_utils.py",
            "status": "modified",
            "additions": 16,
            "deletions": 6,
            "changes": 22,
            "blob_url": "https://github.com/huggingface/transformers/blob/a0216a8021d8b950c69db06440e38307cfa570d4/src%2Ftransformers%2Fgeneration%2Fconfiguration_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/a0216a8021d8b950c69db06440e38307cfa570d4/src%2Ftransformers%2Fgeneration%2Fconfiguration_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fgeneration%2Fconfiguration_utils.py?ref=a0216a8021d8b950c69db06440e38307cfa570d4",
            "patch": "@@ -755,7 +755,7 @@ def save_pretrained(\n \n         output_config_file = os.path.join(save_directory, config_file_name)\n \n-        self.to_json_file(output_config_file, use_diff=True)\n+        self.to_json_file(output_config_file, use_diff=True, keys_to_pop=[\"compile_config\"])\n         logger.info(f\"Configuration saved in {output_config_file}\")\n \n         if push_to_hub:\n@@ -1022,16 +1022,16 @@ def to_dict(self) -> dict[str, Any]:\n             del output[\"_commit_hash\"]\n         if \"_original_object_hash\" in output:\n             del output[\"_original_object_hash\"]\n-        if \"compile_config\" in output:\n-            del output[\"compile_config\"]\n \n         # Transformers version when serializing this file\n         output[\"transformers_version\"] = __version__\n \n         self.dict_dtype_to_str(output)\n         return output\n \n-    def to_json_string(self, use_diff: bool = True, ignore_metadata: bool = False) -> str:\n+    def to_json_string(\n+        self, use_diff: bool = True, ignore_metadata: bool = False, keys_to_pop: list[str] | None = None\n+    ) -> str:\n         \"\"\"\n         Serializes this instance to a JSON string.\n \n@@ -1041,6 +1041,8 @@ def to_json_string(self, use_diff: bool = True, ignore_metadata: bool = False) -\n                 is serialized to JSON string.\n             ignore_metadata (`bool`, *optional*, defaults to `False`):\n                 Whether to ignore the metadata fields present in the instance\n+            keys_to_pop (`list[str]`, *optional*):\n+                Keys to pop from the config dictionary before serializing\n \n         Returns:\n             `str`: String containing all the attributes that make up this configuration instance in JSON format.\n@@ -1050,6 +1052,10 @@ def to_json_string(self, use_diff: bool = True, ignore_metadata: bool = False) -\n         else:\n             config_dict = self.to_dict()\n \n+        if keys_to_pop is not None:\n+            for key in keys_to_pop:\n+                config_dict.pop(key, None)\n+\n         if ignore_metadata:\n             for metadata_field in METADATA_FIELDS:\n                 config_dict.pop(metadata_field, None)\n@@ -1075,7 +1081,9 @@ def convert_dataclass_to_dict(obj):\n \n         return json.dumps(config_dict, indent=2, sort_keys=True) + \"\\n\"\n \n-    def to_json_file(self, json_file_path: str | os.PathLike, use_diff: bool = True):\n+    def to_json_file(\n+        self, json_file_path: str | os.PathLike, use_diff: bool = True, keys_to_pop: list[str] | None = None\n+    ) -> None:\n         \"\"\"\n         Save this instance to a JSON file.\n \n@@ -1085,9 +1093,11 @@ def to_json_file(self, json_file_path: str | os.PathLike, use_diff: bool = True)\n             use_diff (`bool`, *optional*, defaults to `True`):\n                 If set to `True`, only the difference between the config instance and the default `GenerationConfig()`\n                 is serialized to JSON file.\n+            keys_to_pop (`list[str]`, *optional*):\n+                Keys to pop from the config dictionary before serializing\n         \"\"\"\n         with open(json_file_path, \"w\", encoding=\"utf-8\") as writer:\n-            writer.write(self.to_json_string(use_diff=use_diff))\n+            writer.write(self.to_json_string(use_diff=use_diff, keys_to_pop=keys_to_pop))\n \n     @classmethod\n     def from_model_config(cls, model_config: PreTrainedConfig | dict) -> \"GenerationConfig\":"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 16,
        "deletions": 6
    }
}