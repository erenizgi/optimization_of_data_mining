{
    "author": "ydshieh",
    "message": "notify new model merged to `main` (#36375)\n\nnotify new model\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "2ab7bdc40333b230b642f09e8334fb8e1a92d2a4",
    "files": [
        {
            "sha": "6282528c0b74cb07c021e7d3420c1221f2b40b38",
            "filename": ".github/workflows/new_model_pr_merged_notification.yml",
            "status": "added",
            "additions": 68,
            "deletions": 0,
            "changes": 68,
            "blob_url": "https://github.com/huggingface/transformers/blob/2ab7bdc40333b230b642f09e8334fb8e1a92d2a4/.github%2Fworkflows%2Fnew_model_pr_merged_notification.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/2ab7bdc40333b230b642f09e8334fb8e1a92d2a4/.github%2Fworkflows%2Fnew_model_pr_merged_notification.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Fnew_model_pr_merged_notification.yml?ref=2ab7bdc40333b230b642f09e8334fb8e1a92d2a4",
            "patch": "@@ -0,0 +1,68 @@\n+# Used to notify core maintainers about new model PR being merged\n+name: New model PR merged notification\n+\n+on:\n+  push:\n+    branches:\n+      - main\n+    paths:\n+      - 'src/transformers/models/*/modeling_*'\n+\n+jobs:\n+  notify_new_model:\n+    name: Notify new model\n+    runs-on: ubuntu-22.04\n+    steps:\n+      - uses: actions/checkout@v4\n+        with:\n+          fetch-depth: 0\n+      - name: Check new model\n+        shell: bash\n+        run: |\n+          python -m pip install gitpython\n+          python -c 'from utils.pr_slow_ci_models import get_new_model; new_model = get_new_model(diff_with_last_commit=True); print(new_model)' | tee output.txt\n+          echo \"NEW_MODEL=$(tail -n 1 output.txt)\" >> $GITHUB_ENV\n+          echo \"COMMIT_SHA=$(git log -1 --format=%H)\" >> $GITHUB_ENV\n+\n+      - name: print commit sha\n+        if: ${{ env.NEW_MODEL != ''}}\n+        shell: bash\n+        run: |\n+          echo \"$COMMIT_SHA\"\n+\n+      - name: print new model\n+        if: ${{ env.NEW_MODEL != ''}}\n+        shell: bash\n+        run: |\n+          echo \"$NEW_MODEL\"\n+\n+      - name: Notify\n+        if: ${{ env.NEW_MODEL != ''}}\n+        uses: slackapi/slack-github-action@6c661ce58804a1a20f6dc5fbee7f0381b469e001\n+        with:\n+          # Slack channel id, channel name, or user id to post message.\n+          # See also: https://api.slack.com/methods/chat.postMessage#channels\n+          channel-id: transformers-new-model-notification\n+          # For posting a rich message using Block Kit\n+          payload: |\n+            {\n+              \"blocks\": [\n+                {\n+                  \"type\": \"header\",\n+                  \"text\": {\n+                    \"type\": \"plain_text\",\n+                    \"text\": \"New model!\",\n+                    \"emoji\": true\n+                  }\n+                },\n+                {\n+                  \"type\": \"section\",\n+                  \"text\": {\n+                    \"type\": \"mrkdwn\",\n+                    \"text\": \"<https://github.com/huggingface/transformers/commit/${{ env.COMMIT_SHA }}|New model: ${{ env.NEW_MODEL }}> GH_ArthurZucker, GH_lysandrejik, GH_ydshieh\"\n+                  }\n+                }\n+              ]\n+            }\n+        env:\n+          SLACK_BOT_TOKEN: ${{ secrets.SLACK_CIFEEDBACK_BOT_TOKEN }}\n\\ No newline at end of file"
        },
        {
            "sha": "4403ade4980408120194c1cfb604016d3d13f72d",
            "filename": "utils/pr_slow_ci_models.py",
            "status": "modified",
            "additions": 16,
            "deletions": 9,
            "changes": 25,
            "blob_url": "https://github.com/huggingface/transformers/blob/2ab7bdc40333b230b642f09e8334fb8e1a92d2a4/utils%2Fpr_slow_ci_models.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/2ab7bdc40333b230b642f09e8334fb8e1a92d2a4/utils%2Fpr_slow_ci_models.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Fpr_slow_ci_models.py?ref=2ab7bdc40333b230b642f09e8334fb8e1a92d2a4",
            "patch": "@@ -64,7 +64,7 @@ def get_new_python_files_between_commits(base_commit: str, commits: List[str]) -\n     return code_diff\n \n \n-def get_new_python_files() -> List[str]:\n+def get_new_python_files(diff_with_last_commit=False) -> List[str]:\n     \"\"\"\n     Return a list of python files that have been added between the current head and the main branch.\n \n@@ -80,17 +80,24 @@ def get_new_python_files() -> List[str]:\n         # On GitHub Actions runners, it doesn't have local main branch\n         main = repo.remotes.origin.refs.main\n \n-    print(f\"main is at {main.commit}\")\n-    print(f\"Current head is at {repo.head.commit}\")\n+    if not diff_with_last_commit:\n+        print(f\"main is at {main.commit}\")\n+        print(f\"Current head is at {repo.head.commit}\")\n \n-    branching_commits = repo.merge_base(main, repo.head)\n-    for commit in branching_commits:\n-        print(f\"Branching commit: {commit}\")\n-    return get_new_python_files_between_commits(repo.head.commit, branching_commits)\n+        commits = repo.merge_base(main, repo.head)\n+        for commit in commits:\n+            print(f\"Branching commit: {commit}\")\n+    else:\n+        print(f\"main is at {main.commit}\")\n+        commits = main.commit.parents\n+        for commit in commits:\n+            print(f\"Parent commit: {commit}\")\n \n+    return get_new_python_files_between_commits(repo.head.commit, commits)\n \n-def get_new_model():\n-    new_files = get_new_python_files()\n+\n+def get_new_model(diff_with_last_commit=False):\n+    new_files = get_new_python_files(diff_with_last_commit)\n     reg = re.compile(r\"src/transformers/models/(.*)/modeling_.*\\.py\")\n \n     new_model = \"\""
        }
    ],
    "stats": {
        "total": 93,
        "additions": 84,
        "deletions": 9
    }
}