{
    "author": "Rocketknight1",
    "message": "Allow flexible generation params arg when checking pipeline specs (#37211)\n\n* Allow flexible generation params arg\n\n* Trigger tests\n\n* Add docstring and rename js_generate to hub_generate",
    "sha": "782d7d945dbcfc8184264ea24aae31c15147e132",
    "files": [
        {
            "sha": "32969ab0d3a7982817d4abed1461b315d6714c36",
            "filename": "tests/test_pipeline_mixin.py",
            "status": "modified",
            "additions": 14,
            "deletions": 5,
            "changes": 19,
            "blob_url": "https://github.com/huggingface/transformers/blob/782d7d945dbcfc8184264ea24aae31c15147e132/tests%2Ftest_pipeline_mixin.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/782d7d945dbcfc8184264ea24aae31c15147e132/tests%2Ftest_pipeline_mixin.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Ftest_pipeline_mixin.py?ref=782d7d945dbcfc8184264ea24aae31c15147e132",
            "patch": "@@ -930,23 +930,32 @@ def parse_args_from_docstring_by_indentation(docstring):\n \n \n def compare_pipeline_args_to_hub_spec(pipeline_class, hub_spec):\n+    \"\"\"\n+    Compares the docstring of a pipeline class to the fields of the matching Hub input signature class to ensure that\n+    they match. This guarantees that Transformers pipelines can be used in inference without needing to manually\n+    refactor or rename inputs.\n+    \"\"\"\n     ALLOWED_TRANSFORMERS_ONLY_ARGS = [\"timeout\"]\n \n     docstring = inspect.getdoc(pipeline_class.__call__).strip()\n     docstring_args = set(parse_args_from_docstring_by_indentation(docstring))\n     hub_args = set(get_arg_names_from_hub_spec(hub_spec))\n \n     # Special casing: We allow the name of this arg to differ\n-    js_generate_args = [js_arg for js_arg in hub_args if js_arg.startswith(\"generate\")]\n+    hub_generate_args = [\n+        hub_arg for hub_arg in hub_args if hub_arg.startswith(\"generate\") or hub_arg.startswith(\"generation\")\n+    ]\n     docstring_generate_args = [\n-        docstring_arg for docstring_arg in docstring_args if docstring_arg.startswith(\"generate\")\n+        docstring_arg\n+        for docstring_arg in docstring_args\n+        if docstring_arg.startswith(\"generate\") or docstring_arg.startswith(\"generation\")\n     ]\n     if (\n-        len(js_generate_args) == 1\n+        len(hub_generate_args) == 1\n         and len(docstring_generate_args) == 1\n-        and js_generate_args != docstring_generate_args\n+        and hub_generate_args != docstring_generate_args\n     ):\n-        hub_args.remove(js_generate_args[0])\n+        hub_args.remove(hub_generate_args[0])\n         docstring_args.remove(docstring_generate_args[0])\n \n     # Special casing 2: We permit some transformers-only arguments that don't affect pipeline output"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 14,
        "deletions": 5
    }
}