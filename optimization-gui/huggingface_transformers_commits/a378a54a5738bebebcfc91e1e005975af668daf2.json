{
    "author": "nandwalritik",
    "message": "Add changes for uroman package to handle non-Roman characters (#32404)\n\n* Add changes for uroman package to handle non-Roman characters\r\n\r\n* Update docs for uroman changes\r\n\r\n* Modifying error message to warning, for backward compatibility\r\n\r\n* Update instruction for user to install uroman\r\n\r\n* Update docs for uroman python version dependency and backward compatibility\r\n\r\n* Update warning message for python version compatibility with uroman\r\n\r\n* Refine docs",
    "sha": "a378a54a5738bebebcfc91e1e005975af668daf2",
    "files": [
        {
            "sha": "7a29586fc0bd2ba9e993be3d5329f395bcf37296",
            "filename": "docs/source/en/model_doc/vits.md",
            "status": "modified",
            "additions": 23,
            "deletions": 2,
            "changes": 25,
            "blob_url": "https://github.com/huggingface/transformers/blob/a378a54a5738bebebcfc91e1e005975af668daf2/docs%2Fsource%2Fen%2Fmodel_doc%2Fvits.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/a378a54a5738bebebcfc91e1e005975af668daf2/docs%2Fsource%2Fen%2Fmodel_doc%2Fvits.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fvits.md?ref=a378a54a5738bebebcfc91e1e005975af668daf2",
            "patch": "@@ -93,12 +93,33 @@ from transformers import VitsTokenizer\n tokenizer = VitsTokenizer.from_pretrained(\"facebook/mms-tts-eng\")\n print(tokenizer.is_uroman)\n ```\n+If the is_uroman attribute is `True`, the tokenizer will automatically apply the `uroman` package to your text inputs, but you need to install uroman if not already installed using:  \n+```\n+pip install --upgrade uroman\n+```\n+Note: Python version required to use `uroman` as python package should be >= `3.10`. \n+You can use the tokenizer as usual without any additional preprocessing steps:\n+```python\n+import torch\n+from transformers import VitsTokenizer, VitsModel, set_seed\n+import os\n+import subprocess\n \n-If required, you should apply the uroman package to your text inputs **prior** to passing them to the `VitsTokenizer`, \n-since currently the tokenizer does not support performing the pre-processing itself.  \n+tokenizer = VitsTokenizer.from_pretrained(\"facebook/mms-tts-kor\")\n+model = VitsModel.from_pretrained(\"facebook/mms-tts-kor\")\n+text = \"이봐 무슨 일이야\"\n+inputs = tokenizer(text=text, return_tensors=\"pt\")\n+\n+set_seed(555)  # make deterministic\n+with torch.no_grad():\n+   outputs = model(inputs[\"input_ids\"])\n \n+waveform = outputs.waveform[0]\n+```\n+If you don't want to upgrade to python >= `3.10`, then you can use the `uroman` perl package to pre-process the text inputs to the Roman alphabet.\n To do this, first clone the uroman repository to your local machine and set the bash variable `UROMAN` to the local path:\n \n+\n ```bash\n git clone https://github.com/isi-nlp/uroman.git\n cd uroman"
        },
        {
            "sha": "b4d8af740375b333be4a9eb44bd80430d32d2871",
            "filename": "src/transformers/models/vits/tokenization_vits.py",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/huggingface/transformers/blob/a378a54a5738bebebcfc91e1e005975af668daf2/src%2Ftransformers%2Fmodels%2Fvits%2Ftokenization_vits.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/a378a54a5738bebebcfc91e1e005975af668daf2/src%2Ftransformers%2Fmodels%2Fvits%2Ftokenization_vits.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fvits%2Ftokenization_vits.py?ref=a378a54a5738bebebcfc91e1e005975af668daf2",
            "patch": "@@ -20,12 +20,14 @@\n from typing import Any, Dict, List, Optional, Tuple, Union\n \n from ...tokenization_utils import PreTrainedTokenizer\n-from ...utils import is_phonemizer_available, logging\n+from ...utils import is_phonemizer_available, is_uroman_available, logging\n \n \n if is_phonemizer_available():\n     import phonemizer\n \n+if is_uroman_available():\n+    import uroman as ur\n \n logger = logging.get_logger(__name__)\n \n@@ -172,11 +174,16 @@ def prepare_for_tokenization(\n         filtered_text = self._preprocess_char(text)\n \n         if has_non_roman_characters(filtered_text) and self.is_uroman:\n-            logger.warning(\n-                \"Text to the tokenizer contains non-Roman characters. Ensure the `uroman` Romanizer is \"\n-                \"applied to the text prior to passing it to the tokenizer. See \"\n-                \"`https://github.com/isi-nlp/uroman` for details.\"\n-            )\n+            if not is_uroman_available():\n+                logger.warning(\n+                    \"Text to the tokenizer contains non-Roman characters. To apply the `uroman` pre-processing \"\n+                    \"step automatically, ensure the `uroman` Romanizer is installed with: `pip install uroman` \"\n+                    \"Note `uroman` requires python version >= 3.10\"\n+                    \"Otherwise, apply the Romanizer manually as per the instructions: https://github.com/isi-nlp/uroman\"\n+                )\n+            else:\n+                uroman = ur.Uroman()\n+                filtered_text = uroman.romanize_string(filtered_text)\n \n         if self.phonemize:\n             if not is_phonemizer_available():"
        },
        {
            "sha": "b1a1bb56cbd82c2e29e9583aabb7d3e5ba3e1253",
            "filename": "src/transformers/utils/__init__.py",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/huggingface/transformers/blob/a378a54a5738bebebcfc91e1e005975af668daf2/src%2Ftransformers%2Futils%2F__init__.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/a378a54a5738bebebcfc91e1e005975af668daf2/src%2Ftransformers%2Futils%2F__init__.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2F__init__.py?ref=a378a54a5738bebebcfc91e1e005975af668daf2",
            "patch": "@@ -218,6 +218,7 @@\n     is_torchdynamo_compiling,\n     is_torchvision_available,\n     is_training_run_on_sagemaker,\n+    is_uroman_available,\n     is_vision_available,\n     requires_backends,\n     torch_only_method,"
        },
        {
            "sha": "c4bb1a64eb636177356d5357f640c06d1ee16d15",
            "filename": "src/transformers/utils/import_utils.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/huggingface/transformers/blob/a378a54a5738bebebcfc91e1e005975af668daf2/src%2Ftransformers%2Futils%2Fimport_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/a378a54a5738bebebcfc91e1e005975af668daf2/src%2Ftransformers%2Futils%2Fimport_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2Fimport_utils.py?ref=a378a54a5738bebebcfc91e1e005975af668daf2",
            "patch": "@@ -142,6 +142,7 @@ def _is_package_available(pkg_name: str, return_version: bool = False) -> Union[\n _pandas_available = _is_package_available(\"pandas\")\n _peft_available = _is_package_available(\"peft\")\n _phonemizer_available = _is_package_available(\"phonemizer\")\n+_uroman_available = _is_package_available(\"uroman\")\n _psutil_available = _is_package_available(\"psutil\")\n _py3nvml_available = _is_package_available(\"py3nvml\")\n _pyctcdecode_available = _is_package_available(\"pyctcdecode\")\n@@ -1107,6 +1108,10 @@ def is_phonemizer_available():\n     return _phonemizer_available\n \n \n+def is_uroman_available():\n+    return _uroman_available\n+\n+\n def torch_only_method(fn):\n     def wrapper(*args, **kwargs):\n         if not _torch_available:\n@@ -1383,6 +1388,11 @@ def is_liger_kernel_available():\n {0} requires the phonemizer library but it was not found in your environment. You can install it with pip:\n `pip install phonemizer`. Please note that you may need to restart your runtime after installation.\n \"\"\"\n+# docstyle-ignore\n+UROMAN_IMPORT_ERROR = \"\"\"\n+{0} requires the uroman library but it was not found in your environment. You can install it with pip:\n+`pip install uroman`. Please note that you may need to restart your runtime after installation.\n+\"\"\"\n \n \n # docstyle-ignore\n@@ -1523,6 +1533,7 @@ def is_liger_kernel_available():\n         (\"g2p_en\", (is_g2p_en_available, G2P_EN_IMPORT_ERROR)),\n         (\"pandas\", (is_pandas_available, PANDAS_IMPORT_ERROR)),\n         (\"phonemizer\", (is_phonemizer_available, PHONEMIZER_IMPORT_ERROR)),\n+        (\"uroman\", (is_uroman_available, UROMAN_IMPORT_ERROR)),\n         (\"pretty_midi\", (is_pretty_midi_available, PRETTY_MIDI_IMPORT_ERROR)),\n         (\"levenshtein\", (is_levenshtein_available, LEVENSHTEIN_IMPORT_ERROR)),\n         (\"librosa\", (is_librosa_available, LIBROSA_IMPORT_ERROR)),"
        }
    ],
    "stats": {
        "total": 56,
        "additions": 48,
        "deletions": 8
    }
}