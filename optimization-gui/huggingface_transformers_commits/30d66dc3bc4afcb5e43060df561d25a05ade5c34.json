{
    "author": "ydshieh",
    "message": "Update `check_determinism` inside `test_determinism` (#40661)\n\n* fix\n\n* fix\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "30d66dc3bc4afcb5e43060df561d25a05ade5c34",
    "files": [
        {
            "sha": "98c095f968041a11517e08b922d0f7146dda95c4",
            "filename": "tests/test_modeling_common.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/huggingface/transformers/blob/30d66dc3bc4afcb5e43060df561d25a05ade5c34/tests%2Ftest_modeling_common.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/30d66dc3bc4afcb5e43060df561d25a05ade5c34/tests%2Ftest_modeling_common.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Ftest_modeling_common.py?ref=30d66dc3bc4afcb5e43060df561d25a05ade5c34",
            "patch": "@@ -1001,6 +1001,11 @@ def test_determinism(self):\n         config, inputs_dict = self.model_tester.prepare_config_and_inputs_for_common()\n \n         def check_determinism(first, second):\n+            # Simply don't compare if both tensors only contain `nan` elements\n+            # See: https://github.com/huggingface/transformers/pull/40661\n+            if torch.all(torch.isnan(first)) and torch.all(torch.isnan(second)):\n+                return\n+\n             out_1 = first.cpu().numpy()\n             out_2 = second.cpu().numpy()\n             out_1 = out_1[~np.isnan(out_1)]"
        }
    ],
    "stats": {
        "total": 5,
        "additions": 5,
        "deletions": 0
    }
}