{
    "author": "ydshieh",
    "message": "Revert \"Pin torch to 2.7.1 on CircleCI for now\" + Final fix for `too long with no output` (#40201)\n\n* Revert \"Pin torch to 2.7.1 on CircleCI for now (#40174)\"\n\nThis reverts commit 31b6e6e1dac0d32f74ec5cd6b3c1868534ccd7b5.\n\n* fix\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
    "files": [
        {
            "sha": "06f414fe6d42a8c214636bc678d25a59a41e4bf1",
            "filename": ".circleci/create_circleci_config.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/.circleci%2Fcreate_circleci_config.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/.circleci%2Fcreate_circleci_config.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.circleci%2Fcreate_circleci_config.py?ref=2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
            "patch": "@@ -110,6 +110,8 @@ def __post_init__(self):\n             print(f\"Using {self.docker_image} docker image\")\n         if self.install_steps is None:\n             self.install_steps = [\"uv pip install .\"]\n+        # Use a custom patched pytest to force exit the process at the end, to avoid `Too long with no output (exceeded 10m0s): context deadline exceeded`\n+        self.install_steps.append(\"uv pip install git+https://github.com/ydshieh/pytest.git@8.4.1-ydshieh\")\n         if self.pytest_options is None:\n             self.pytest_options = {}\n         if isinstance(self.tests_to_run, str):"
        },
        {
            "sha": "e569307f92dc2748f4258a700a9873be0497817a",
            "filename": "docker/consistency.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fconsistency.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fconsistency.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fconsistency.dockerfile?ref=2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
            "patch": "@@ -5,7 +5,7 @@ ARG REF=main\n RUN apt-get update && apt-get install -y time git g++ pkg-config make git-lfs\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip install uv && uv pip install --no-cache-dir -U pip setuptools GitPython\n-RUN uv pip install --no-cache-dir --upgrade 'torch<2.8' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir --upgrade 'torch' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n # tensorflow pin matching setup.py\n RUN uv pip install --no-cache-dir pypi-kenlm\n RUN uv pip install --no-cache-dir \"tensorflow-cpu<2.16\" \"tf-keras<2.16\""
        },
        {
            "sha": "926f4668c1597c338fe126afe180dd671c7db128",
            "filename": "docker/custom-tokenizers.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fcustom-tokenizers.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fcustom-tokenizers.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fcustom-tokenizers.dockerfile?ref=2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
            "patch": "@@ -16,7 +16,7 @@ RUN cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local\n RUN make install -j 10\n \n \n-RUN uv pip install --no-cache --upgrade 'torch<2.8' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache --upgrade 'torch' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir  --no-deps accelerate --extra-index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install  --no-cache-dir \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[ja,testing,sentencepiece,jieba,spacy,ftfy,rjieba]\" unidic unidic-lite\n # spacy is not used so not tested. Causes to failures. TODO fix later"
        },
        {
            "sha": "7d11d385c1e1de9d86763a11dd76cd73bd15f0cf",
            "filename": "docker/examples-torch.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fexamples-torch.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fexamples-torch.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fexamples-torch.dockerfile?ref=2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
            "patch": "@@ -5,7 +5,7 @@ USER root\n RUN apt-get update &&  apt-get install -y --no-install-recommends libsndfile1-dev espeak-ng time git g++ cmake pkg-config openssh-client git ffmpeg\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv pip install --no-cache-dir -U pip setuptools\n-RUN uv pip install --no-cache-dir 'torch<2.8' 'torchaudio' 'torchvision' 'torchcodec<0.6.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' 'torchcodec' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-deps timm accelerate --extra-index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir librosa \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[sklearn,sentencepiece,vision,testing]\" seqeval albumentations jiwer\n RUN uv pip uninstall transformers"
        },
        {
            "sha": "21faf6e916d4a2102150b6068ed627b4ea99ef37",
            "filename": "docker/exotic-models.dockerfile",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fexotic-models.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fexotic-models.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fexotic-models.dockerfile?ref=2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
            "patch": "@@ -2,13 +2,12 @@ FROM python:3.9-slim\n ENV PYTHONDONTWRITEBYTECODE=1\n ARG REF=main\n USER root\n-# `libgl1-mesa-glx` is removed in #40174 due to `libgl1-mesa-glx is not available, but is referred to by another package.`\n-RUN apt-get update && apt-get install -y libsndfile1-dev espeak-ng time git libgl1 g++ tesseract-ocr\n+RUN apt-get update && apt-get install -y libsndfile1-dev espeak-ng time git libgl1-mesa-glx libgl1 g++ tesseract-ocr\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv pip install --no-cache-dir -U pip setuptools\n-RUN uv pip install --no-cache-dir 'torch<2.8' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir  --no-deps timm accelerate\n-RUN uv pip install -U --no-cache-dir pytesseract python-Levenshtein opencv-python nltk\n+RUN uv pip install -U --upgrade-strategy eager --no-cache-dir pytesseract python-Levenshtein opencv-python nltk\n # RUN uv pip install --no-cache-dir natten==0.15.1+torch210cpu -f https://shi-labs.com/natten/wheels\n RUN uv pip install  --no-cache-dir \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[testing, vision]\" 'scikit-learn' 'torch-stft' 'nose'  'dataset'\n # RUN git clone https://github.com/facebookresearch/detectron2.git"
        },
        {
            "sha": "b968372b5f69ba10f3ad39ae3ed618b36b372ffe",
            "filename": "docker/pipeline-torch.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fpipeline-torch.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Fpipeline-torch.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fpipeline-torch.dockerfile?ref=2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
            "patch": "@@ -5,7 +5,7 @@ USER root\n RUN apt-get update &&  apt-get install -y --no-install-recommends libsndfile1-dev espeak-ng time git pkg-config openssh-client git ffmpeg\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv pip install --no-cache-dir -U pip setuptools\n-RUN uv pip install --no-cache-dir 'torch<2.8' 'torchaudio' 'torchvision' 'torchcodec<0.6.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' 'torchcodec' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-deps timm accelerate --extra-index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir librosa \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[sklearn,sentencepiece,vision,testing]\"\n RUN uv pip uninstall transformers"
        },
        {
            "sha": "9c7835eca133146de4e336632613e8cdaeb714d9",
            "filename": "docker/torch-jax-light.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Ftorch-jax-light.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Ftorch-jax-light.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Ftorch-jax-light.dockerfile?ref=2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
            "patch": "@@ -6,7 +6,7 @@ RUN apt-get update &&  apt-get install -y libsndfile1-dev espeak-ng time git g++\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv pip install --no-cache-dir -U pip setuptools\n RUN uv pip install --no-deps accelerate\n-RUN uv pip install --no-cache-dir 'torch<2.8' 'torchvision' 'torchaudio' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchvision' 'torchaudio' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir \"scipy<1.13\" \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[flax,audio,sklearn,sentencepiece,vision,testing]\"\n \n "
        },
        {
            "sha": "5bb2ad93edbd7a20a39a164ce0fd99d4fec71c23",
            "filename": "docker/torch-light.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Ftorch-light.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Ftorch-light.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Ftorch-light.dockerfile?ref=2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
            "patch": "@@ -5,7 +5,7 @@ USER root\n RUN apt-get update &&  apt-get install -y --no-install-recommends libsndfile1-dev espeak-ng time git g++ cmake pkg-config openssh-client git git-lfs ffmpeg\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv pip install --no-cache-dir -U pip setuptools\n-RUN uv pip install --no-cache-dir 'torch<2.8' 'torchaudio' 'torchvision' 'torchcodec<0.6.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' 'torchcodec' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-deps timm accelerate --extra-index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir librosa \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[sklearn,sentencepiece,vision,testing,tiktoken,num2words,video]\"\n RUN uv pip uninstall transformers"
        },
        {
            "sha": "e1ad5535156dd21efbe34386b8cd85977a466e91",
            "filename": "docker/torch-tf-light.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Ftorch-tf-light.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/2914ceca202fd3a68a79fa88d03cf5b0435ec4f1/docker%2Ftorch-tf-light.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Ftorch-tf-light.dockerfile?ref=2914ceca202fd3a68a79fa88d03cf5b0435ec4f1",
            "patch": "@@ -7,7 +7,7 @@ RUN apt-get update &&  apt-get install -y --no-install-recommends libsndfile1-de\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv pip install --no-cache-dir -U pip setuptools\n RUN uv pip install --no-cache-dir  --no-deps accelerate --extra-index-url https://download.pytorch.org/whl/cpu \n-RUN uv pip install --no-cache-dir 'torch<2.8' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n RUN git lfs install\n \n RUN uv pip install --no-cache-dir pypi-kenlm"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 12,
        "deletions": 11
    }
}