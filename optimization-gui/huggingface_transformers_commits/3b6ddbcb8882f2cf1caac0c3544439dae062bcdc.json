{
    "author": "yao-matrix",
    "message": "make apollo test case pass (#41805)\n\nmake apollo test cases pass\n\nSigned-off-by: Yao, Matrix <matrix.yao@intel.com>",
    "sha": "3b6ddbcb8882f2cf1caac0c3544439dae062bcdc",
    "files": [
        {
            "sha": "4cc3a15618f9697fb099ed7ffcec32d5eef5a411",
            "filename": "tests/trainer/test_trainer.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/huggingface/transformers/blob/3b6ddbcb8882f2cf1caac0c3544439dae062bcdc/tests%2Ftrainer%2Ftest_trainer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/3b6ddbcb8882f2cf1caac0c3544439dae062bcdc/tests%2Ftrainer%2Ftest_trainer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Ftrainer%2Ftest_trainer.py?ref=3b6ddbcb8882f2cf1caac0c3544439dae062bcdc",
            "patch": "@@ -2603,19 +2603,19 @@ def test_apollo_lr_display_with_scheduler(self):\n         logs = trainer.state.log_history[1:][:-1]\n \n         # reach given learning rate peak and end with 0 lr\n-        self.assertTrue(logs[num_warmup_steps - 2][\"learning_rate\"] == learning_rate)\n-        self.assertTrue(logs[-1][\"learning_rate\"] == 0)\n+        self.assertTrue(logs[num_warmup_steps - 1][\"learning_rate\"] == learning_rate)\n+        self.assertTrue(np.allclose(logs[-1][\"learning_rate\"], 0, atol=5e-6))\n \n         # increasing and decreasing pattern of lrs\n         increasing_lrs = [\n             logs[i][\"learning_rate\"] < logs[i + 1][\"learning_rate\"]\n             for i in range(len(logs))\n-            if i < num_warmup_steps - 2\n+            if i < num_warmup_steps - 1\n         ]\n         decreasing_lrs = [\n             logs[i][\"learning_rate\"] > logs[i + 1][\"learning_rate\"]\n             for i in range(len(logs) - 1)\n-            if i >= num_warmup_steps - 2\n+            if i >= num_warmup_steps - 1\n         ]\n \n         self.assertTrue(all(increasing_lrs))"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 4,
        "deletions": 4
    }
}