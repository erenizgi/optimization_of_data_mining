{
    "author": "grf53",
    "message": "Support `typing.Literal` as type of tool parameters or return value (#39633)\n\n* support `typing.Literal` as type of tool parameters\n\n* validate the `args` of `typing.Literal` roughly\n\n* add test to get json schema for `typing.Literal` type hint\n\n* fix: add `\"type\"` attribute to the parsed result of `typing.Literal`\n\n* test: add argument `booleanish` to test multi-type literal\n\n* style: auto fixup",
    "sha": "3e4d584a5b2b81e11755f47835d86bdc63e744f1",
    "files": [
        {
            "sha": "5b713187949dcd024f43d2ec23efa0ad40c9a4cb",
            "filename": "src/transformers/utils/chat_template_utils.py",
            "status": "modified",
            "additions": 25,
            "deletions": 2,
            "changes": 27,
            "blob_url": "https://github.com/huggingface/transformers/blob/3e4d584a5b2b81e11755f47835d86bdc63e744f1/src%2Ftransformers%2Futils%2Fchat_template_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/3e4d584a5b2b81e11755f47835d86bdc63e744f1/src%2Ftransformers%2Futils%2Fchat_template_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2Fchat_template_utils.py?ref=3e4d584a5b2b81e11755f47835d86bdc63e744f1",
            "patch": "@@ -20,7 +20,16 @@\n from datetime import datetime\n from functools import lru_cache\n from inspect import isfunction\n-from typing import Any, Callable, Optional, Union, get_args, get_origin, get_type_hints\n+from typing import (\n+    Any,\n+    Callable,\n+    Literal,\n+    Optional,\n+    Union,\n+    get_args,\n+    get_origin,\n+    get_type_hints,\n+)\n \n from packaging import version\n \n@@ -75,7 +84,7 @@ class DocstringParsingException(Exception):\n     pass\n \n \n-def _get_json_schema_type(param_type: str) -> dict[str, str]:\n+def _get_json_schema_type(param_type: type) -> dict[str, str]:\n     type_mapping = {\n         int: {\"type\": \"integer\"},\n         float: {\"type\": \"number\"},\n@@ -119,6 +128,20 @@ def _parse_type_hint(hint: str) -> dict:\n             return_dict[\"nullable\"] = True\n         return return_dict\n \n+    elif origin is Literal and len(args) > 0:\n+        LITERAL_TYPES = (int, float, str, bool, type(None))\n+        args_types = []\n+        for arg in args:\n+            if type(arg) not in LITERAL_TYPES:\n+                raise TypeHintParsingException(\"Only the valid python literals can be listed in typing.Literal.\")\n+            arg_type = _get_json_schema_type(type(arg)).get(\"type\")\n+            if arg_type is not None and arg_type not in args_types:\n+                args_types.append(arg_type)\n+        return {\n+            \"type\": args_types.pop() if len(args_types) == 1 else list(args_types),\n+            \"enum\": list(args),\n+        }\n+\n     elif origin is list:\n         if not args:\n             return {\"type\": \"array\"}"
        },
        {
            "sha": "52926649f8796e8dc7e510289955e8c772791761",
            "filename": "tests/utils/test_chat_template_utils.py",
            "status": "modified",
            "additions": 44,
            "deletions": 1,
            "changes": 45,
            "blob_url": "https://github.com/huggingface/transformers/blob/3e4d584a5b2b81e11755f47835d86bdc63e744f1/tests%2Futils%2Ftest_chat_template_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/3e4d584a5b2b81e11755f47835d86bdc63e744f1/tests%2Futils%2Ftest_chat_template_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Futils%2Ftest_chat_template_utils.py?ref=3e4d584a5b2b81e11755f47835d86bdc63e744f1",
            "patch": "@@ -13,7 +13,7 @@\n # limitations under the License.\n \n import unittest\n-from typing import Optional, Union\n+from typing import Literal, Optional, Union\n \n from transformers.utils import DocstringParsingException, TypeHintParsingException, get_json_schema\n \n@@ -384,6 +384,49 @@ def fn(temperature_format: str):\n \n         self.assertEqual(schema[\"function\"], expected_schema)\n \n+    def test_literal(self):\n+        def fn(\n+            temperature_format: Literal[\"celsius\", \"fahrenheit\"],\n+            booleanish: Literal[True, False, 0, 1, \"y\", \"n\"] = False,\n+        ):\n+            \"\"\"\n+            Test function\n+\n+            Args:\n+                temperature_format: The temperature format to use\n+                booleanish: A value that can be regarded as boolean\n+\n+\n+            Returns:\n+                The temperature\n+            \"\"\"\n+            return -40.0\n+\n+        # Let's see if that gets correctly parsed as an enum\n+        schema = get_json_schema(fn)\n+        expected_schema = {\n+            \"name\": \"fn\",\n+            \"description\": \"Test function\",\n+            \"parameters\": {\n+                \"type\": \"object\",\n+                \"properties\": {\n+                    \"temperature_format\": {\n+                        \"type\": \"string\",\n+                        \"enum\": [\"celsius\", \"fahrenheit\"],\n+                        \"description\": \"The temperature format to use\",\n+                    },\n+                    \"booleanish\": {\n+                        \"type\": [\"boolean\", \"integer\", \"string\"],\n+                        \"enum\": [True, False, 0, 1, \"y\", \"n\"],\n+                        \"description\": \"A value that can be regarded as boolean\",\n+                    },\n+                },\n+                \"required\": [\"temperature_format\"],\n+            },\n+        }\n+\n+        self.assertEqual(schema[\"function\"], expected_schema)\n+\n     def test_multiline_docstring_with_types(self):\n         def fn(x: int, y: int):\n             \"\"\""
        }
    ],
    "stats": {
        "total": 72,
        "additions": 69,
        "deletions": 3
    }
}