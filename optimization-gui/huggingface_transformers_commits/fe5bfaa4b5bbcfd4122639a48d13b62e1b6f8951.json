{
    "author": "gante",
    "message": "[generate] add soft deprecations on custom generation methods (#38406)\n\nsoft deprecations",
    "sha": "fe5bfaa4b5bbcfd4122639a48d13b62e1b6f8951",
    "files": [
        {
            "sha": "9af619c82032a8718617d62d8e7a3e291f1a7b1d",
            "filename": "src/transformers/generation/utils.py",
            "status": "modified",
            "additions": 19,
            "deletions": 1,
            "changes": 20,
            "blob_url": "https://github.com/huggingface/transformers/blob/fe5bfaa4b5bbcfd4122639a48d13b62e1b6f8951/src%2Ftransformers%2Fgeneration%2Futils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fe5bfaa4b5bbcfd4122639a48d13b62e1b6f8951/src%2Ftransformers%2Fgeneration%2Futils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fgeneration%2Futils.py?ref=fe5bfaa4b5bbcfd4122639a48d13b62e1b6f8951",
            "patch": "@@ -2342,8 +2342,8 @@ def generate(\n                     - [`~generation.GenerateBeamEncoderDecoderOutput`]\n         \"\"\"\n         # 0. If requested, load an arbitrary generation recipe from the Hub and run it instead\n+        trust_remote_code = kwargs.pop(\"trust_remote_code\", None)\n         if custom_generate is not None:\n-            trust_remote_code = kwargs.pop(\"trust_remote_code\", None)\n             # Get all `generate` arguments in a single variable. Custom functions are responsible for handling them:\n             # they receive the same inputs as `generate`, with `model` instead of `self` and excluding the arguments to\n             # trigger the custom generation. They can access to methods from `GenerationMixin` through `model`.\n@@ -2564,6 +2564,11 @@ def generate(\n                 **model_kwargs,\n             )\n         elif generation_mode == GenerationMode.DOLA_GENERATION:\n+            if not trust_remote_code:\n+                logger.warning_once(\n+                    \"DoLa Decoding is scheduled to be moved to a `custom_generate` repository in v4.55.0. \"\n+                    \"To prevent loss of backward compatibility, add `trust_remote_code=True` to your `generate` call.\"\n+                )\n             if self._is_stateful:\n                 # DoLa decoding was not designed for stateful models, and would require some changes\n                 raise ValueError(\n@@ -2581,6 +2586,11 @@ def generate(\n             )\n \n         elif generation_mode == GenerationMode.CONTRASTIVE_SEARCH:\n+            if not trust_remote_code:\n+                logger.warning_once(\n+                    \"Contrastive Search is scheduled to be moved to a `custom_generate` repository in v4.55.0. \"\n+                    \"To prevent loss of backward compatibility, add `trust_remote_code=True` to your `generate` call.\"\n+                )\n             if not model_kwargs[\"use_cache\"]:\n                 raise ValueError(\"Contrastive search requires `use_cache=True`\")\n             if self._is_stateful:\n@@ -2638,6 +2648,10 @@ def generate(\n             )\n \n         elif generation_mode == GenerationMode.GROUP_BEAM_SEARCH:\n+            logger.warning_once(\n+                \"Group Beam Search is scheduled to be moved to a `custom_generate` repository in v4.55.0. \"\n+                \"To prevent loss of backward compatibility, add `trust_remote_code=True` to your `generate` call.\"\n+            )\n             # 11. prepare beam search scorer\n             beam_scorer = BeamSearchScorer(\n                 batch_size=batch_size,\n@@ -2668,6 +2682,10 @@ def generate(\n             )\n \n         elif generation_mode == GenerationMode.CONSTRAINED_BEAM_SEARCH:\n+            logger.warning_once(\n+                \"Constrained Beam Search is scheduled to be moved to a `custom_generate` repository in v4.55.0. \"\n+                \"To prevent loss of backward compatibility, add `trust_remote_code=True` to your `generate` call.\"\n+            )\n             final_constraints = []\n             if generation_config.constraints is not None:\n                 final_constraints = generation_config.constraints"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 19,
        "deletions": 1
    }
}