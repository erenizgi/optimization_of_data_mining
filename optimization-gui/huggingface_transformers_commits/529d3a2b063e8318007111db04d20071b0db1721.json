{
    "author": "ydshieh",
    "message": "Fix `Glm4vModelTest::test_eager_matches_fa2_generate` (#40947)\n\n* fix\n\n* fix\n\n* fix\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "529d3a2b063e8318007111db04d20071b0db1721",
    "files": [
        {
            "sha": "4059fe2f9e99df0f39ab7af9ec29d4a8f1226443",
            "filename": "tests/models/glm4v/test_modeling_glm4v.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/529d3a2b063e8318007111db04d20071b0db1721/tests%2Fmodels%2Fglm4v%2Ftest_modeling_glm4v.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/529d3a2b063e8318007111db04d20071b0db1721/tests%2Fmodels%2Fglm4v%2Ftest_modeling_glm4v.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fglm4v%2Ftest_modeling_glm4v.py?ref=529d3a2b063e8318007111db04d20071b0db1721",
            "patch": "@@ -159,7 +159,9 @@ def prepare_config_and_inputs_for_common(self):\n \n         inputs_dict = {\n             \"pixel_values\": pixel_values,\n-            \"image_grid_thw\": torch.tensor([[1, patches_per_side, patches_per_side]] * self.batch_size),\n+            \"image_grid_thw\": torch.tensor(\n+                [[1, patches_per_side, patches_per_side]] * self.batch_size, device=torch_device\n+            ),\n             \"input_ids\": input_ids,\n             \"attention_mask\": attention_mask,\n         }"
        },
        {
            "sha": "995b3c0723db0bfa21903fb9455990236ed9ca60",
            "filename": "tests/models/glm4v_moe/test_modeling_glm4v_moe.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/529d3a2b063e8318007111db04d20071b0db1721/tests%2Fmodels%2Fglm4v_moe%2Ftest_modeling_glm4v_moe.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/529d3a2b063e8318007111db04d20071b0db1721/tests%2Fmodels%2Fglm4v_moe%2Ftest_modeling_glm4v_moe.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fglm4v_moe%2Ftest_modeling_glm4v_moe.py?ref=529d3a2b063e8318007111db04d20071b0db1721",
            "patch": "@@ -170,7 +170,9 @@ def prepare_config_and_inputs_for_common(self):\n \n         inputs_dict = {\n             \"pixel_values\": pixel_values,\n-            \"image_grid_thw\": torch.tensor([[1, patches_per_side, patches_per_side]] * self.batch_size),\n+            \"image_grid_thw\": torch.tensor(\n+                [[1, patches_per_side, patches_per_side]] * self.batch_size, device=torch_device\n+            ),\n             \"input_ids\": input_ids,\n             \"attention_mask\": attention_mask,\n         }"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 6,
        "deletions": 2
    }
}