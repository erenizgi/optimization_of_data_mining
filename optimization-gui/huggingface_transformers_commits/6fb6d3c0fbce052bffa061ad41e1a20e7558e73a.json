{
    "author": "yao-matrix",
    "message": "make recurrent_gemma and voxtral cases pass on xpu (#41958)\n\nSigned-off-by: Yao, Matrix <matrix.yao@intel.com>\nCo-authored-by: Yih-Dar <2521628+ydshieh@users.noreply.github.com>",
    "sha": "6fb6d3c0fbce052bffa061ad41e1a20e7558e73a",
    "files": [
        {
            "sha": "14cdf2d46ac9b10a7d40e63fe5ead4a52d2d48a2",
            "filename": "tests/models/recurrent_gemma/test_modeling_recurrent_gemma.py",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/huggingface/transformers/blob/6fb6d3c0fbce052bffa061ad41e1a20e7558e73a/tests%2Fmodels%2Frecurrent_gemma%2Ftest_modeling_recurrent_gemma.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/6fb6d3c0fbce052bffa061ad41e1a20e7558e73a/tests%2Fmodels%2Frecurrent_gemma%2Ftest_modeling_recurrent_gemma.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Frecurrent_gemma%2Ftest_modeling_recurrent_gemma.py?ref=6fb6d3c0fbce052bffa061ad41e1a20e7558e73a",
            "patch": "@@ -193,7 +193,15 @@ def test_2b_sample(self):\n     @require_bitsandbytes\n     @require_read_token\n     def test_model_2b_8bit(self):\n-        EXPECTED_TEXTS = ['Hello I am doing a project on the topic of \"The impact of social media on the society\" and I am looking', \"Hi today I'm going to show you how to make a simple and easy to make a 3D\"]  # fmt: skip\n+        # fmt: off\n+        EXPECTED_TEXTS = Expectations(\n+            {\n+                (\"xpu\", None): ['Hello I am doing a project on the topic of \"The impact of the internet on the society\" and I am stuck', \"Hi today I'm going to show you how to make a simple and easy to make a 3D\"],\n+                (None, None): ['Hello I am doing a project on the topic of \"The impact of social media on the society\" and I am looking', \"Hi today I'm going to show you how to make a simple and easy to make a 3D\"],\n+            }\n+        )\n+        # fmt: on\n+        EXPECTED_TEXT = EXPECTED_TEXTS.get_expectation()\n \n         model = AutoModelForCausalLM.from_pretrained(\n             \"gg-hf/recurrent-gemma-2b-hf\",\n@@ -208,7 +216,7 @@ def test_model_2b_8bit(self):\n         output = model.generate(**inputs, max_new_tokens=20, do_sample=False)\n         output_text = tokenizer.batch_decode(output, skip_special_tokens=True)\n \n-        self.assertEqual(output_text, EXPECTED_TEXTS)\n+        self.assertEqual(output_text, EXPECTED_TEXT)\n \n     @require_read_token\n     def test_long_context(self):"
        },
        {
            "sha": "feaa58bbd10b1aaeb428add8d80d13d7b31c31bd",
            "filename": "tests/models/voxtral/test_modeling_voxtral.py",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/huggingface/transformers/blob/6fb6d3c0fbce052bffa061ad41e1a20e7558e73a/tests%2Fmodels%2Fvoxtral%2Ftest_modeling_voxtral.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/6fb6d3c0fbce052bffa061ad41e1a20e7558e73a/tests%2Fmodels%2Fvoxtral%2Ftest_modeling_voxtral.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fvoxtral%2Ftest_modeling_voxtral.py?ref=6fb6d3c0fbce052bffa061ad41e1a20e7558e73a",
            "patch": "@@ -23,6 +23,7 @@\n     is_torch_available,\n )\n from transformers.testing_utils import (\n+    Expectations,\n     cleanup,\n     require_torch,\n     slow,\n@@ -297,9 +298,15 @@ def test_mini_single_turn_text_and_audio(self):\n         outputs = model.generate(**inputs, do_sample=False, max_new_tokens=500)\n         decoded_outputs = self.processor.batch_decode(outputs, skip_special_tokens=True)\n \n-        EXPECTED_OUTPUT = [\n-            \"What can you tell me about this audio?This audio is a farewell address by President Barack Obama, delivered in Chicago. In the speech, he reflects on his eight years in office, highlighting the resilience, hope, and unity of the American people. He acknowledges the diverse perspectives and conversations he had with the public, which kept him honest and inspired. The president also emphasizes the importance of self-government and civic engagement, encouraging Americans to participate in their democracy actively. He expresses optimism about the country's future and looks forward to continuing his work as a citizen. The audio concludes with a heartfelt thank you and a blessing for the United States.\"\n-        ]\n+        # fmt: off\n+        EXPECTED_OUTPUTS = Expectations(\n+            {\n+                (None, None): [\"What can you tell me about this audio?This audio is a farewell address by President Barack Obama, delivered in Chicago. In the speech, he reflects on his eight years in office, highlighting the resilience, hope, and unity of the American people. He acknowledges the diverse perspectives and conversations he had with the public, which kept him honest and inspired. The president also emphasizes the importance of self-government and civic engagement, encouraging Americans to participate in their democracy actively. He expresses optimism about the country's future and looks forward to continuing his work as a citizen. The audio concludes with a heartfelt thank you and a blessing for the United States.\"],\n+                (\"xpu\", None): [\"What can you tell me about this audio?This audio is a farewell address by President Barack Obama, delivered in Chicago. In the speech, he reflects on his eight years in office, highlighting the resilience, hope, and unity of the American people. He emphasizes the importance of self-government and active citizenship, encouraging listeners to engage in their communities and participate in democracy. The president expresses his optimism about the country's future and his commitment to continuing to serve as a citizen. He concludes the speech with a heartfelt thank you and a blessing for the United States.\"],\n+            }\n+        )\n+        # fmt: on\n+        EXPECTED_OUTPUT = EXPECTED_OUTPUTS.get_expectation()\n         self.assertEqual(decoded_outputs, EXPECTED_OUTPUT)\n \n     @slow"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 20,
        "deletions": 5
    }
}