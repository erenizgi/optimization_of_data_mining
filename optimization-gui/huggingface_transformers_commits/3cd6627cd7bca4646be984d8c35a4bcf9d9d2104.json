{
    "author": "yao-matrix",
    "message": "enable 6 gemma2 cases on XPU (#37564)\n\nSigned-off-by: YAO Matrix <matrix.yao@intel.com>",
    "sha": "3cd6627cd7bca4646be984d8c35a4bcf9d9d2104",
    "files": [
        {
            "sha": "3a6093e63755ab6c2cb8fecdbb3441b9fce6c289",
            "filename": "tests/models/gemma2/test_modeling_gemma2.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/3cd6627cd7bca4646be984d8c35a4bcf9d9d2104/tests%2Fmodels%2Fgemma2%2Ftest_modeling_gemma2.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/3cd6627cd7bca4646be984d8c35a4bcf9d9d2104/tests%2Fmodels%2Fgemma2%2Ftest_modeling_gemma2.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fgemma2%2Ftest_modeling_gemma2.py?ref=3cd6627cd7bca4646be984d8c35a4bcf9d9d2104",
            "patch": "@@ -26,6 +26,7 @@\n     require_flash_attn,\n     require_read_token,\n     require_torch,\n+    require_torch_accelerator,\n     require_torch_gpu,\n     slow,\n     tooslow,\n@@ -155,7 +156,7 @@ def test_multi_gpu_data_parallel_forward(self):\n \n \n @slow\n-@require_torch_gpu\n+@require_torch_accelerator\n class Gemma2IntegrationTest(unittest.TestCase):\n     input_text = [\"Hello I am doing\", \"Hi today\"]\n     # This variable is used to determine which CUDA device are we using for our runners (A10 or T4)\n@@ -360,6 +361,10 @@ def test_generation_beyond_sliding_window(self, attn_implementation: str):\n         we need to correctly slice the attention mask in all cases (because we use a HybridCache).\n         Outputs for every attention functions should be coherent and identical.\n         \"\"\"\n+\n+        if torch_device == \"xpu\" and attn_implementation == \"flash_attention_2\":\n+            self.skipTest(reason=\"Intel XPU doesn't support falsh_attention_2 as of now.\")\n+\n         model_id = \"google/gemma-2-2b\"\n         EXPECTED_COMPLETIONS = [\n             \" the people, the food, the culture, the history, the music, the art, the architecture\","
        }
    ],
    "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
    }
}