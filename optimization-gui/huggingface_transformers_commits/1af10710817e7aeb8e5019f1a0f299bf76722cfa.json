{
    "author": "notkisk",
    "message": "Fix misleading WandB error when WANDB_DISABLED is set (#39891)\n\nWhen users set `report_to=\"wandb\"` but also have `WANDB_DISABLED=true` in their environment,\nthe previous error message was misleading: \"WandbCallback requires wandb to be installed. Run pip install wandb.\"\n\nThis was confusing because wandb was actually installed, just disabled via the environment variable.\n\nThe fix detects this specific case and provides a clear, actionable error message explaining\nthe conflict and how to resolve it.",
    "sha": "1af10710817e7aeb8e5019f1a0f299bf76722cfa",
    "files": [
        {
            "sha": "702e05627cb62d3c412418fdbc8668380c7c0058",
            "filename": "src/transformers/integrations/integration_utils.py",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/huggingface/transformers/blob/1af10710817e7aeb8e5019f1a0f299bf76722cfa/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/1af10710817e7aeb8e5019f1a0f299bf76722cfa/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py?ref=1af10710817e7aeb8e5019f1a0f299bf76722cfa",
            "patch": "@@ -806,6 +806,19 @@ class WandbCallback(TrainerCallback):\n     def __init__(self):\n         has_wandb = is_wandb_available()\n         if not has_wandb:\n+            # Check if wandb is actually installed but disabled via WANDB_DISABLED\n+            if importlib.util.find_spec(\"wandb\") is not None:\n+                # wandb is installed but disabled\n+                wandb_disabled = os.getenv(\"WANDB_DISABLED\", \"\").upper() in ENV_VARS_TRUE_VALUES\n+                if wandb_disabled:\n+                    raise RuntimeError(\n+                        \"You specified `report_to='wandb'` but also set the `WANDB_DISABLED` environment variable.\\n\"\n+                        \"This disables wandb logging, even though it was explicitly requested.\\n\\n\"\n+                        \"- To enable wandb logging: unset `WANDB_DISABLED`.\\n\"\n+                        \"- To disable logging: use `report_to='none'`.\\n\\n\"\n+                        \"Note: WANDB_DISABLED is deprecated and will be removed in v5.\"\n+                    )\n+            # If wandb is not installed at all, use the original error message\n             raise RuntimeError(\"WandbCallback requires wandb to be installed. Run `pip install wandb`.\")\n         if has_wandb:\n             import wandb"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 13,
        "deletions": 0
    }
}