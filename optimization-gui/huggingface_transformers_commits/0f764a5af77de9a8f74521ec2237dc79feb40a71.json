{
    "author": "zucchini-nlp",
    "message": "Mllama: update docs (#34334)\n\n* update docs\r\n\r\n* be more explicit\r\n\r\n* use avaialble methods",
    "sha": "0f764a5af77de9a8f74521ec2237dc79feb40a71",
    "files": [
        {
            "sha": "4a6080ea2ce03a3e661c2da5e89f45fe8ce00c94",
            "filename": "docs/source/en/model_doc/mllama.md",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/huggingface/transformers/blob/0f764a5af77de9a8f74521ec2237dc79feb40a71/docs%2Fsource%2Fen%2Fmodel_doc%2Fmllama.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/0f764a5af77de9a8f74521ec2237dc79feb40a71/docs%2Fsource%2Fen%2Fmodel_doc%2Fmllama.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fmllama.md?ref=0f764a5af77de9a8f74521ec2237dc79feb40a71",
            "patch": "@@ -30,6 +30,25 @@ The Llama 3.2-Vision collection of multimodal large language models (LLMs) is a\n - The text passed to the processor should have the `\"<|image|>\"` tokens where the images should be inserted.\n - The processor has its own `apply_chat_template` method to convert chat messages to text that can then be passed as text to the processor.\n \n+\n+<Tip warning={true}>\n+\n+Mllama has an extra token used as a placeholder for image positions in the text. It means that input ids and an input embedding layer will have an extra token. But since the weights for input and output embeddings are not tied, the `lm_head` layer has one less token and will fail if you want to calculate loss on image tokens or apply some logit processors. In case you are training, make sure to mask out special `\"<|image|>\"` tokens in the `labels` as the model should not be trained on predicting them.\n+\n+Otherwise if you see CUDA-side index erros when generating, use the below code to expand the `lm_head` by one more token. \n+\n+\n+```python\n+old_embeddings = model.get_output_embeddings()\n+\n+num_tokens = model.vocab_size + 1\n+resized_embeddings = model._get_resized_lm_head(old_embeddings, new_num_tokens=num_tokens, mean_resizing=True)\n+resized_embeddings.requires_grad_(old_embeddings.weight.requires_grad)\n+model.set_output_embeddings(resized_embeddings)\n+```\n+</Tip>\n+\n+\n ## Usage Example\n \n #### Instruct model"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 19,
        "deletions": 0
    }
}