{
    "author": "ydshieh",
    "message": "Change PR to draft when it is (re)opened (#36417)\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n* draft\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "d0727d92cd093de74cb7117107855a5a7a05c109",
    "files": [
        {
            "sha": "338f7b566b82731f627f311e950fd96be5227507",
            "filename": ".circleci/config.yml",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/huggingface/transformers/blob/d0727d92cd093de74cb7117107855a5a7a05c109/.circleci%2Fconfig.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/d0727d92cd093de74cb7117107855a5a7a05c109/.circleci%2Fconfig.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.circleci%2Fconfig.yml?ref=d0727d92cd093de74cb7117107855a5a7a05c109",
            "patch": "@@ -31,6 +31,14 @@ jobs:\n         parallelism: 1\n         steps:\n             - checkout\n+            - run: if [[ \"$CIRCLE_PULL_REQUEST\" == \"\" && \"$CIRCLE_BRANCH\" != \"main\" && \"$CIRCLE_BRANCH\" != *-release ]]; then echo \"Not a PR, not the main branch and not a release branch, skip test!\"; circleci-agent step halt; fi\n+            - run: 'curl -L -H \"Accept: application/vnd.github+json\" -H \"X-GitHub-Api-Version: 2022-11-28\" https://api.github.com/repos/$CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME/pulls/${CIRCLE_PULL_REQUEST##*/} >> github.txt'\n+            - run: cat github.txt\n+            - run: (python3 -c 'import json; from datetime import datetime; fp = open(\"github.txt\"); data = json.load(fp); fp.close(); f = \"%Y-%m-%dT%H:%M:%SZ\"; created = datetime.strptime(data[\"created_at\"], f); updated = datetime.strptime(data[\"updated_at\"], f); s = (updated - created).total_seconds(); print(int(s))' || true) > elapsed.txt\n+            - run: if [ \"$(cat elapsed.txt)\" == \"\" ]; then echo 60 > elapsed.txt; fi\n+            - run: cat elapsed.txt\n+            - run: if [ \"$(cat elapsed.txt)\" -lt \"30\" ]; then echo \"PR is just opened, wait some actions from GitHub\"; sleep 30; fi\n+            - run: 'if grep -q \"\\\"draft\\\": true,\" github.txt; then echo \"draft mode, skip test!\"; circleci-agent step halt; fi'\n             - run: uv pip install -U -e .\n             - run: echo 'export \"GIT_COMMIT_MESSAGE=$(git show -s --format=%s)\"' >> \"$BASH_ENV\" && source \"$BASH_ENV\"\n             - run: mkdir -p test_preparation"
        },
        {
            "sha": "c70ffba75987eead6a3eea0b7a82f12bd6184991",
            "filename": ".github/workflows/change_pr_to_draft.yml",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/huggingface/transformers/blob/d0727d92cd093de74cb7117107855a5a7a05c109/.github%2Fworkflows%2Fchange_pr_to_draft.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/d0727d92cd093de74cb7117107855a5a7a05c109/.github%2Fworkflows%2Fchange_pr_to_draft.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Fchange_pr_to_draft.yml?ref=d0727d92cd093de74cb7117107855a5a7a05c109",
            "patch": "@@ -0,0 +1,22 @@\n+name: Change PR to draft\n+\n+on:\n+  pull_request_target:\n+    types: [opened, reopened]\n+\n+jobs:\n+  convert_pr_to_draft:\n+    runs-on: ubuntu-22.04\n+    name: Convert PR to draft\n+    if: github.event.pull_request.draft == false\n+    steps:\n+      - name: Convert PR to draft\n+        shell: bash\n+        env:\n+          PR_NUMBER: ${{ github.event.number }}\n+          GH_TOKEN: ${{ github.token }}\n+          REPO: ${{ github.repository }}\n+        run: |\n+          echo $PR_NUMBER\n+          gh pr ready $PR_NUMBER --repo $REPO --undo\n+          gh pr comment $PR_NUMBER --repo $REPO --body \"Hi ðŸ‘‹, thank you for opening this pull request! The pull request is converted to draft by default. When it is ready for review, please click the \\`Ready for review\\` button (at the bottom of the PR page).\""
        }
    ],
    "stats": {
        "total": 30,
        "additions": 30,
        "deletions": 0
    }
}