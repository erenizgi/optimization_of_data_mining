{
    "author": "Cyrilvallez",
    "message": "[modular] CLI allows positional arguments, and more defaults names for the optional arg (#38979)\n\n* More defaults\n\n* Update modular_model_converter.py",
    "sha": "74f5e4a1fad5a578e5ecb3b47fe48dc98ba21ff2",
    "files": [
        {
            "sha": "1ead4fe92677a06fbaa2af2b8f860edae133abbf",
            "filename": "docs/source/en/modular_transformers.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/74f5e4a1fad5a578e5ecb3b47fe48dc98ba21ff2/docs%2Fsource%2Fen%2Fmodular_transformers.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/74f5e4a1fad5a578e5ecb3b47fe48dc98ba21ff2/docs%2Fsource%2Fen%2Fmodular_transformers.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodular_transformers.md?ref=74f5e4a1fad5a578e5ecb3b47fe48dc98ba21ff2",
            "patch": "@@ -24,7 +24,7 @@ A linter \"unravels\" the modular file into a `modeling.py` file to preserve the s\n Run the command below to automatically generate a `modeling.py` file from a modular file.\n \n ```bash\n-python utils/modular_model_converter.py --files_to_parse src/transformers/models/<your_model>/modular_<your_model>.py\n+python utils/modular_model_converter.py --files-to-parse src/transformers/models/<your_model>/modular_<your_model>.py\n ```\n \n For example:"
        },
        {
            "sha": "ffd5b35cd798fbe73df2a22a368fe2474464e878",
            "filename": "utils/modular_model_converter.py",
            "status": "modified",
            "additions": 20,
            "deletions": 8,
            "changes": 28,
            "blob_url": "https://github.com/huggingface/transformers/blob/74f5e4a1fad5a578e5ecb3b47fe48dc98ba21ff2/utils%2Fmodular_model_converter.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/74f5e4a1fad5a578e5ecb3b47fe48dc98ba21ff2/utils%2Fmodular_model_converter.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Fmodular_model_converter.py?ref=74f5e4a1fad5a578e5ecb3b47fe48dc98ba21ff2",
            "patch": "@@ -1778,19 +1778,31 @@ def save_modeling_file(modular_file, converted_file):\n \n if __name__ == \"__main__\":\n     parser = argparse.ArgumentParser()\n+    # Same arg as both positional and optional, just for convenience\n     parser.add_argument(\n+        \"files\",\n+        nargs=\"*\",\n+        help=\"A list of `modular_xxxx` files that should be converted to single model file\",\n+    )\n+    parser.add_argument(\n+        \"--files-to-parse\",\n         \"--files_to_parse\",\n+        \"--files\",\n+        \"-f\",\n         default=[\"all\"],\n         nargs=\"+\",\n         help=\"A list of `modular_xxxx` files that should be converted to single model file\",\n     )\n     args = parser.parse_args()\n-    if args.files_to_parse == [\"all\"]:\n-        args.files_to_parse = glob.glob(\"src/transformers/models/**/modular_*.py\", recursive=True)\n-    if args.files_to_parse == [\"examples\"]:\n-        args.files_to_parse = glob.glob(\"examples/**/modular_*.py\", recursive=True)\n+    # Both arg represent the same data, but as positional and optional\n+    files_to_parse = args.files if len(args.files) > 0 else args.files_to_parse\n+\n+    if files_to_parse == [\"all\"]:\n+        files_to_parse = glob.glob(\"src/transformers/models/**/modular_*.py\", recursive=True)\n+    if files_to_parse == [\"examples\"]:\n+        files_to_parse = glob.glob(\"examples/**/modular_*.py\", recursive=True)\n     else:\n-        for i, model_name in enumerate(args.files_to_parse):\n+        for i, model_name in enumerate(files_to_parse):\n             if os.sep not in model_name:\n                 full_path = os.path.join(\"src\", \"transformers\", \"models\", model_name, f\"modular_{model_name}.py\")\n                 # If it does not exist, try in the examples section\n@@ -1799,10 +1811,10 @@ def save_modeling_file(modular_file, converted_file):\n                 # We did not find it anywhere\n                 if not os.path.isfile(full_path):\n                     raise ValueError(f\"Cannot find a modular file for {model_name}. Please provide the full path.\")\n-                args.files_to_parse[i] = full_path\n+                files_to_parse[i] = full_path\n \n-    priority_list, _ = find_priority_list(args.files_to_parse)\n-    assert len(priority_list) == len(args.files_to_parse), \"Some files will not be converted\"\n+    priority_list, _ = find_priority_list(files_to_parse)\n+    assert len(priority_list) == len(files_to_parse), \"Some files will not be converted\"\n \n     for file_name in priority_list:\n         print(f\"Converting {file_name} to a single model single file format\")"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 21,
        "deletions": 9
    }
}