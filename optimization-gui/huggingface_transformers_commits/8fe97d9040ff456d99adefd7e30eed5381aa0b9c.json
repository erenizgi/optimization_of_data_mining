{
    "author": "yonigozlan",
    "message": "Raise error when missing or incorrect dates (#42610)\n\n* Raise error when missing or incorrect dates\n\n* refactor, improve readability, add to fix-copies\n\n* fix lasr model card",
    "sha": "8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
    "files": [
        {
            "sha": "95ab88e626165e9f964455ddc7991b425fd5900f",
            "filename": "Makefile",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/huggingface/transformers/blob/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/Makefile",
            "raw_url": "https://github.com/huggingface/transformers/raw/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/Makefile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/Makefile?ref=8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
            "patch": "@@ -53,7 +53,7 @@ repo-consistency:\n \tpython utils/check_doctest_list.py\n \tpython utils/update_metadata.py --check-only\n \tpython utils/check_docstrings.py\n-\tpython utils/add_dates.py\n+\tpython utils/add_dates.py --check-only\n \n # this target runs checks on all files\n \n@@ -93,6 +93,7 @@ fix-copies:\n \tpython utils/check_pipeline_typing.py --fix_and_overwrite\n \tpython utils/check_doctest_list.py --fix_and_overwrite\n \tpython utils/check_docstrings.py --fix_and_overwrite\n+\tpython utils/add_dates.py\n \n # Run tests for the library\n "
        },
        {
            "sha": "ecd0c726326e89eba77dec1d2393e189ac2de70a",
            "filename": "docs/source/en/model_doc/afmoe.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Fafmoe.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Fafmoe.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fafmoe.md?ref=8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
            "patch": "@@ -13,7 +13,7 @@ specific language governing permissions and limitations under the License.\n rendered properly in your Markdown viewer.\n \n -->\n-*This model was released on {release_date} and added to Hugging Face Transformers on 2025-12-04.*\n+*This model was released on {release_date} and added to Hugging Face Transformers on 2025-11-29.*\n \n <div style=\"float: right;\">\n     <div class=\"flex flex-wrap space-x-1\">"
        },
        {
            "sha": "7a5fd50b0f2c1c9ffa8450082b512df31b052f5e",
            "filename": "docs/source/en/model_doc/fast_vlm.md",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/huggingface/transformers/blob/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Ffast_vlm.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Ffast_vlm.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Ffast_vlm.md?ref=8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
            "patch": "@@ -14,7 +14,7 @@ rendered properly in your Markdown viewer.\n \n -->\n \n-*This model was released on 2025-05-06 and added to Hugging Face Transformers on 2025-12-04.*\n+*This model was released on 2025-05-06 and added to Hugging Face Transformers on 2025-12-02.*\n \n # FastVLM\n \n@@ -57,14 +57,14 @@ Setting it for the entire model, e.g.\n \n will result in an error.\n \n-### Formatting Prompts with Chat Templates  \n+### Formatting Prompts with Chat Templates\n \n-Each **checkpoint** is trained with a specific prompt format, depending on the underlying large language model backbone. To ensure correct formatting, use the processor’s `apply_chat_template` method.  \n+Each **checkpoint** is trained with a specific prompt format, depending on the underlying large language model backbone. To ensure correct formatting, use the processor’s `apply_chat_template` method.\n \n-**Important:**  \n-- You must construct a conversation history — passing a plain string won't work.  \n-- Each message should be a dictionary with `\"role\"` and `\"content\"` keys.  \n-- The `\"content\"` should be a list of dictionaries for different modalities like `\"text\"` and `\"image\"`.  \n+**Important:**\n+- You must construct a conversation history — passing a plain string won't work.\n+- Each message should be a dictionary with `\"role\"` and `\"content\"` keys.\n+- The `\"content\"` should be a list of dictionaries for different modalities like `\"text\"` and `\"image\"`.\n \n ## Usage examples\n "
        },
        {
            "sha": "64666cea75883abcfe82649120d1cb1371cee247",
            "filename": "docs/source/en/model_doc/glm46v.md",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/huggingface/transformers/blob/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Fglm46v.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Fglm46v.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fglm46v.md?ref=8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
            "patch": "@@ -1,3 +1,20 @@\n+<!--Copyright 2025 The HuggingFace Team. All rights reserved.\n+\n+Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this file except in compliance with\n+the License. You may obtain a copy of the License at\n+\n+http://www.apache.org/licenses/LICENSE-2.0\n+\n+Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on\n+an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the\n+specific language governing permissions and limitations under the License.\n+\n+⚠️ Note that this file is in Markdown but contain specific syntax for our doc-builder (similar to MDX) that may not be\n+rendered properly in your Markdown viewer.\n+\n+-->\n+*This model was released on {release_date} and added to Hugging Face Transformers on 2025-11-15.*\n+\n # GLM-4.6V\n \n ## Glm46VConfig"
        },
        {
            "sha": "221e095fa0fb71c7d978209320240fbef0a87ac0",
            "filename": "docs/source/en/model_doc/lasr.md",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/huggingface/transformers/blob/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Flasr.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Flasr.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Flasr.md?ref=8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
            "patch": "@@ -13,6 +13,7 @@ specific language governing permissions and limitations under the License.\n rendered properly in your Markdown viewer.\n \n -->\n+*This model was released on {release_date} and added to Hugging Face Transformers on 2025-12-05.*\n \n <div class=\"flex flex-wrap space-x-1\">\n <img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">"
        },
        {
            "sha": "2d88da955481613afb8abaae5f816958d458c74e",
            "filename": "docs/source/en/model_doc/ministral3.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Fministral3.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Fministral3.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fministral3.md?ref=8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
            "patch": "@@ -16,7 +16,7 @@ limitations under the License.\n ⚠️ Note that this file is in Markdown but contain specific syntax for our doc-builder (similar to MDX) that may not be rendered properly in your Markdown viewer.\n \n -->\n-*This model was released on {release_date} and added to Hugging Face Transformers on 2025-12-04.*\n+*This model was released on 2025-12-01 and added to Hugging Face Transformers on 2025-12-01.*\n \n \n # Ministral3"
        },
        {
            "sha": "5b0b0a3234d64730af5b3372fd69cdc53991162c",
            "filename": "docs/source/en/model_doc/nanochat.md",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/huggingface/transformers/blob/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Fnanochat.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Fnanochat.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fnanochat.md?ref=8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
            "patch": "@@ -13,6 +13,7 @@ specific language governing permissions and limitations under the License.\n rendered properly in your Markdown viewer.\n \n -->\n+*This model was released on {release_date} and added to Hugging Face Transformers on 2025-11-27.*\n \n # NanoChat\n "
        },
        {
            "sha": "30e27d51497f0e5c9b0d35c076712c612218ce1e",
            "filename": "docs/source/en/model_doc/t5gemma2.md",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/huggingface/transformers/blob/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Ft5gemma2.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/docs%2Fsource%2Fen%2Fmodel_doc%2Ft5gemma2.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Ft5gemma2.md?ref=8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
            "patch": "@@ -14,7 +14,8 @@ specific language governing permissions and limitations under the License.\n rendered properly in your Markdown viewer.\n \n -->\n-*This model was released on {release_date} and added to Hugging Face Transformers on 2025-12-04.*\n+*This model was released on {release_date} and added to Hugging Face Transformers on 2025-12-01.*\n+\n <div style=\"float: right;\">\n     <div class=\"flex flex-wrap space-x-1\">\n         <img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">"
        },
        {
            "sha": "4b9c3e7514ba3df522cd951958abedb2d3666134",
            "filename": "utils/add_dates.py",
            "status": "modified",
            "additions": 122,
            "deletions": 44,
            "changes": 166,
            "blob_url": "https://github.com/huggingface/transformers/blob/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/utils%2Fadd_dates.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/8fe97d9040ff456d99adefd7e30eed5381aa0b9c/utils%2Fadd_dates.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Fadd_dates.py?ref=8fe97d9040ff456d99adefd7e30eed5381aa0b9c",
            "patch": "@@ -2,7 +2,7 @@\n import os\n import re\n import subprocess\n-from datetime import date\n+from datetime import date, datetime\n \n from huggingface_hub import paper_info\n \n@@ -176,14 +176,82 @@ def replace_paper_links(file_path: str) -> bool:\n     return False\n \n \n-def insert_dates(model_card_list: list[str]):\n-    \"\"\"Insert release and commit dates into model cards\"\"\"\n+def _normalize_model_card_name(model_card: str) -> str:\n+    \"\"\"Ensure model card has .md extension\"\"\"\n+    return model_card if model_card.endswith(\".md\") else f\"{model_card}.md\"\n+\n+\n+def _should_skip_model_card(model_card: str) -> bool:\n+    \"\"\"Check if model card should be skipped\"\"\"\n+    return model_card in (\"auto.md\", \"timm_wrapper.md\")\n+\n+\n+def _read_model_card_content(model_card: str) -> str:\n+    \"\"\"Read and return the content of a model card\"\"\"\n+    file_path = os.path.join(DOCS_PATH, model_card)\n+    with open(file_path, \"r\", encoding=\"utf-8\") as f:\n+        return f.read()\n+\n+\n+def _get_dates_pattern_match(content: str):\n+    \"\"\"Search for the dates pattern in content and return match object\"\"\"\n+    pattern = r\"\\n\\*This model was released on (.*) and added to Hugging Face Transformers on (\\d{4}-\\d{2}-\\d{2})\\.\\*\"\n+    return re.search(pattern, content)\n+\n+\n+def _dates_differ_significantly(date1: str, date2: str) -> bool:\n+    \"\"\"Check if two dates differ by more than 1 day\"\"\"\n+    try:\n+        d1 = datetime.strptime(date1, \"%Y-%m-%d\")\n+        d2 = datetime.strptime(date2, \"%Y-%m-%d\")\n+        return abs((d1 - d2).days) > 1\n+    except Exception:\n+        return True  # If dates can't be parsed, consider them different\n+\n+\n+def check_missing_dates(model_card_list: list[str]) -> list[str]:\n+    \"\"\"Check which model cards are missing release dates and return their names\"\"\"\n+    missing_dates = []\n \n     for model_card in model_card_list:\n-        if not model_card.endswith(\".md\"):\n-            model_card = f\"{model_card}.md\"\n+        model_card = _normalize_model_card_name(model_card)\n+        if _should_skip_model_card(model_card):\n+            continue\n \n-        if model_card == \"auto.md\" or model_card == \"timm_wrapper.md\":\n+        content = _read_model_card_content(model_card)\n+        if not _get_dates_pattern_match(content):\n+            missing_dates.append(model_card)\n+\n+    return missing_dates\n+\n+\n+def check_incorrect_dates(model_card_list: list[str]) -> list[str]:\n+    \"\"\"Check which model cards have incorrect HF commit dates and return their names\"\"\"\n+    incorrect_dates = []\n+\n+    for model_card in model_card_list:\n+        model_card = _normalize_model_card_name(model_card)\n+        if _should_skip_model_card(model_card):\n+            continue\n+\n+        content = _read_model_card_content(model_card)\n+        match = _get_dates_pattern_match(content)\n+\n+        if match:\n+            existing_hf_date = match.group(2)\n+            actual_hf_date = get_first_commit_date(model_name=model_card)\n+\n+            if _dates_differ_significantly(existing_hf_date, actual_hf_date):\n+                incorrect_dates.append(model_card)\n+\n+    return incorrect_dates\n+\n+\n+def insert_dates(model_card_list: list[str]):\n+    \"\"\"Insert or update release and commit dates in model cards\"\"\"\n+    for model_card in model_card_list:\n+        model_card = _normalize_model_card_name(model_card)\n+        if _should_skip_model_card(model_card):\n             continue\n \n         file_path = os.path.join(DOCS_PATH, model_card)\n@@ -193,55 +261,46 @@ def insert_dates(model_card_list: list[str]):\n         if links_replaced:\n             print(f\"Updated paper links in {model_card}\")\n \n-        pattern = (\n-            r\"\\n\\*This model was released on (.*) and added to Hugging Face Transformers on (\\d{4}-\\d{2}-\\d{2})\\.\\*\"\n-        )\n+        # Read content and ensure copyright disclaimer exists\n+        content = _read_model_card_content(model_card)\n+        markers = list(re.finditer(r\"-->\", content))\n \n-        # Check if the copyright disclaimer sections exists, if not, add one with 2025\n-        with open(file_path, \"r\", encoding=\"utf-8\") as f:\n-            content = f.read()\n-        markers = list(re.finditer(r\"-->\", content))  # Dates info is placed right below this marker\n         if len(markers) == 0:\n             print(f\"No marker found in {model_card}. Adding copyright disclaimer to the top.\")\n-\n-            # Add copyright disclaimer to the very top of the file\n             content = COPYRIGHT_DISCLAIMER + \"\\n\\n\" + content\n             with open(file_path, \"w\", encoding=\"utf-8\") as f:\n                 f.write(content)\n             markers = list(re.finditer(r\"-->\", content))\n \n+        # Get dates\n         hf_commit_date = get_first_commit_date(model_name=model_card)\n-\n         paper_link = get_paper_link(model_card=model_card, path=file_path)\n-        release_date = \"\"\n-        if not (paper_link == \"No_paper\" or paper_link == \"blog\"):\n-            release_date = get_release_date(paper_link)\n-        else:\n+\n+        if paper_link in (\"No_paper\", \"blog\"):\n             release_date = r\"{release_date}\"\n+        else:\n+            release_date = get_release_date(paper_link)\n \n-        match = re.search(pattern, content)\n+        match = _get_dates_pattern_match(content)\n \n-        # If the dates info line already exists, preserve the existing release date unless it's a placeholder, and update the HF commit date if needed\n+        # Update or insert the dates line\n         if match:\n-            existing_release_date = match.group(1)  # The release date part\n-            existing_hf_date = match.group(2)  # The existing HF date part\n-            release_date = (\n-                release_date\n-                if (existing_release_date == r\"{release_date}\" or existing_release_date == \"None\")\n-                else existing_release_date\n-            )\n+            # Preserve existing release date unless it's a placeholder\n+            existing_release_date = match.group(1)\n+            existing_hf_date = match.group(2)\n+\n+            if existing_release_date not in (r\"{release_date}\", \"None\"):\n+                release_date = existing_release_date\n+\n             if existing_hf_date != hf_commit_date or existing_release_date != release_date:\n-                old_line = match.group(0)  # Full matched line\n+                old_line = match.group(0)\n                 new_line = f\"\\n*This model was released on {release_date} and added to Hugging Face Transformers on {hf_commit_date}.*\"\n-\n                 content = content.replace(old_line, new_line)\n                 with open(file_path, \"w\", encoding=\"utf-8\") as f:\n                     f.write(content)\n-\n-        # If the dates info line does not exist, add it\n         else:\n+            # Insert new dates line after copyright marker\n             insert_index = markers[0].end()\n-\n             date_info = f\"\\n*This model was released on {release_date} and added to Hugging Face Transformers on {hf_commit_date}.*\"\n             content = content[:insert_index] + date_info + content[insert_index:]\n             with open(file_path, \"w\", encoding=\"utf-8\") as f:\n@@ -262,33 +321,52 @@ def get_all_model_cards():\n     return sorted(model_cards)\n \n \n-def main(all=False, auto=True, models=None):\n+def main(all=False, models=None, check_only=False):\n+    if check_only:\n+        # Check all model cards for missing dates\n+        all_model_cards = get_all_model_cards()\n+        print(f\"Checking all {len(all_model_cards)} model cards for missing dates...\")\n+        missing_dates = check_missing_dates(all_model_cards)\n+\n+        # Check modified model cards for incorrect dates\n+        modified_cards = get_modified_cards()\n+        print(f\"Checking {len(modified_cards)} modified model cards for incorrect dates...\")\n+        incorrect_dates = check_incorrect_dates(modified_cards)\n+\n+        if missing_dates or incorrect_dates:\n+            problematic_cards = missing_dates + incorrect_dates\n+            model_names = [card.replace(\".md\", \"\") for card in problematic_cards]\n+            raise ValueError(\n+                f\"Missing or incorrect dates in the following model cards: {' '.join(problematic_cards)}\\n\"\n+                f\"Run `python utils/add_dates.py --models {' '.join(model_names)}` to fix them.\"\n+            )\n+        print(\"All dates are present and correct!\")\n+        return\n+\n+    # Determine which model cards to process\n     if all:\n         model_cards = get_all_model_cards()\n         print(f\"Processing all {len(model_cards)} model cards from docs directory\")\n-    elif auto:\n+    elif models:\n+        model_cards = models\n+        print(f\"Processing specified model cards: {model_cards}\")\n+    else:\n         model_cards = get_modified_cards()\n         if not model_cards:\n             print(\"No modified model cards found.\")\n             return\n         print(f\"Processing modified model cards: {model_cards}\")\n-    else:\n-        model_cards = models\n-        print(f\"Processing specified model cards: {model_cards}\")\n \n     insert_dates(model_cards)\n \n \n if __name__ == \"__main__\":\n     parser = argparse.ArgumentParser(description=\"Add release and commit dates to model cards\")\n     group = parser.add_mutually_exclusive_group(required=False)\n-    group.add_argument(\n-        \"--auto\", action=\"store_true\", help=\"Automatically process modified model cards from git status\"\n-    )\n     group.add_argument(\"--models\", nargs=\"+\", help=\"Specify model cards to process (without .md extension)\")\n     group.add_argument(\"--all\", action=\"store_true\", help=\"Process all model cards in the docs directory\")\n+    group.add_argument(\"--check-only\", action=\"store_true\", help=\"Check if the dates are already present\")\n \n-    parser.set_defaults(auto=True)\n     args = parser.parse_args()\n \n-    main(args.all, args.auto, args.models)\n+    main(args.all, args.models, args.check_only)"
        }
    ],
    "stats": {
        "total": 209,
        "additions": 154,
        "deletions": 55
    }
}