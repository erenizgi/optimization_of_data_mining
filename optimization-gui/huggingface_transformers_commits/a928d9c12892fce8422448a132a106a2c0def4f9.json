{
    "author": "ArthurZucker",
    "message": "[`trainer`] fix the GA `model_accepts_loss_kwargs` (#34915)\n\n* fix\n\n* style\n\n* values\n\n* fix",
    "sha": "a928d9c12892fce8422448a132a106a2c0def4f9",
    "files": [
        {
            "sha": "af908e48e4b8c4933fa5bec4dda3bac03348b77c",
            "filename": "src/transformers/trainer.py",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/huggingface/transformers/blob/a928d9c12892fce8422448a132a106a2c0def4f9/src%2Ftransformers%2Ftrainer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/a928d9c12892fce8422448a132a106a2c0def4f9/src%2Ftransformers%2Ftrainer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftrainer.py?ref=a928d9c12892fce8422448a132a106a2c0def4f9",
            "patch": "@@ -623,9 +623,7 @@ def __init__(\n             else unwrapped_model.get_base_model().forward\n         )\n         forward_params = inspect.signature(model_forward).parameters\n-        self.model_accepts_loss_kwargs = (\n-            \"loss_kwargs\" in forward_params and forward_params[\"loss_kwargs\"].kind == inspect.Parameter.VAR_KEYWORD\n-        )\n+        self.model_accepts_loss_kwargs = any(k.kind == inspect.Parameter.VAR_KEYWORD for k in forward_params.values())\n \n         self.neftune_noise_alpha = args.neftune_noise_alpha\n \n@@ -3651,7 +3649,10 @@ def training_step(\n             return loss_mb.reduce_mean().detach().to(self.args.device)\n \n         with self.compute_loss_context_manager():\n-            loss = self.compute_loss(model, inputs, num_items_in_batch=num_items_in_batch)\n+            if self.model_accepts_loss_kwargs:\n+                loss = self.compute_loss(model, inputs)\n+            else:\n+                loss = self.compute_loss(model, inputs, num_items_in_batch=num_items_in_batch)\n \n         del inputs\n         if ("
        }
    ],
    "stats": {
        "total": 9,
        "additions": 5,
        "deletions": 4
    }
}