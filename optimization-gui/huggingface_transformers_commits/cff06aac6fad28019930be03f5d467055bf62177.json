{
    "author": "shinyano",
    "message": "Fix: use `torch.from_numpy()` to create tensors for np.ndarrays (#33201)\n\nuse torch.from_numpy for np.ndarrays",
    "sha": "cff06aac6fad28019930be03f5d467055bf62177",
    "files": [
        {
            "sha": "4a36eaaee05122a9aaae7df64ce49f73345a6248",
            "filename": "src/transformers/agents/agent_types.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Fagents%2Fagent_types.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Fagents%2Fagent_types.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fagents%2Fagent_types.py?ref=cff06aac6fad28019930be03f5d467055bf62177",
            "patch": "@@ -105,7 +105,7 @@ def __init__(self, value):\n         elif isinstance(value, torch.Tensor):\n             self._tensor = value\n         elif isinstance(value, np.ndarray):\n-            self._tensor = torch.tensor(value)\n+            self._tensor = torch.from_numpy(value)\n         else:\n             raise TypeError(f\"Unsupported type for {self.__class__.__name__}: {type(value)}\")\n \n@@ -192,7 +192,10 @@ def __init__(self, value, samplerate=16_000):\n             self._tensor = value\n         elif isinstance(value, tuple):\n             self.samplerate = value[0]\n-            self._tensor = torch.tensor(value[1])\n+            if isinstance(value[1], np.ndarray):\n+                self._tensor = torch.from_numpy(value[1])\n+            else:\n+                self._tensor = torch.tensor(value[1])\n         else:\n             raise ValueError(f\"Unsupported audio type: {type(value)}\")\n "
        },
        {
            "sha": "030120ac6c7f1ed6b003c3d43c32488311939575",
            "filename": "src/transformers/agents/document_question_answering.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Fagents%2Fdocument_question_answering.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Fagents%2Fdocument_question_answering.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fagents%2Fdocument_question_answering.py?ref=cff06aac6fad28019930be03f5d467055bf62177",
            "patch": "@@ -60,7 +60,7 @@ def encode(self, document: \"Image\", question: str):\n         if isinstance(document, str):\n             img = Image.open(document).convert(\"RGB\")\n             img_array = np.array(img).transpose(2, 0, 1)\n-            document = torch.tensor(img_array)\n+            document = torch.from_numpy(img_array)\n         pixel_values = self.pre_processor(document, return_tensors=\"pt\").pixel_values\n \n         return {\"decoder_input_ids\": decoder_input_ids, \"pixel_values\": pixel_values}"
        },
        {
            "sha": "696cedf47d98a0a30b87fc9a112b8358f7e1ca95",
            "filename": "src/transformers/data/data_collator.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Fdata%2Fdata_collator.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Fdata%2Fdata_collator.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fdata%2Fdata_collator.py?ref=cff06aac6fad28019930be03f5d467055bf62177",
            "patch": "@@ -153,7 +153,7 @@ def torch_default_data_collator(features: List[InputDataClass]) -> Dict[str, Any\n             if isinstance(v, torch.Tensor):\n                 batch[k] = torch.stack([f[k] for f in features])\n             elif isinstance(v, np.ndarray):\n-                batch[k] = torch.tensor(np.stack([f[k] for f in features]))\n+                batch[k] = torch.from_numpy(np.stack([f[k] for f in features]))\n             else:\n                 batch[k] = torch.tensor([f[k] for f in features])\n "
        },
        {
            "sha": "3590d9da98870b3e2b3ced7c0da94bf93da7c1a5",
            "filename": "src/transformers/feature_extraction_utils.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/huggingface/transformers/blob/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Ffeature_extraction_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Ffeature_extraction_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ffeature_extraction_utils.py?ref=cff06aac6fad28019930be03f5d467055bf62177",
            "patch": "@@ -146,7 +146,10 @@ def as_tensor(value):\n                         and isinstance(value[0][0], np.ndarray)\n                     ):\n                         value = np.array(value)\n-                return torch.tensor(value)\n+                if isinstance(value, np.ndarray):\n+                    return torch.from_numpy(value)\n+                else:\n+                    return torch.tensor(value)\n \n             is_tensor = torch.is_tensor\n         elif tensor_type == TensorType.JAX:"
        },
        {
            "sha": "1a70ef05638379d3c91d1457dcdee9997ce4a009",
            "filename": "src/transformers/image_utils.py",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Fimage_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Fimage_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fimage_utils.py?ref=cff06aac6fad28019930be03f5d467055bf62177",
            "patch": "@@ -579,9 +579,15 @@ def normalize(self, image, mean, std, rescale=False):\n             import torch\n \n             if not isinstance(mean, torch.Tensor):\n-                mean = torch.tensor(mean)\n+                if isinstance(mean, np.ndarray):\n+                    mean = torch.from_numpy(mean)\n+                else:\n+                    mean = torch.tensor(mean)\n             if not isinstance(std, torch.Tensor):\n-                std = torch.tensor(std)\n+                if isinstance(std, np.ndarray):\n+                    std = torch.from_numpy(std)\n+                else:\n+                    std = torch.tensor(std)\n \n         if image.ndim == 3 and image.shape[0] in [1, 3]:\n             return (image - mean[:, None, None]) / std[:, None, None]"
        },
        {
            "sha": "dc0af00cedeb3b7fbe649bae44d291b73f03755f",
            "filename": "src/transformers/tokenization_utils_base.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Ftokenization_utils_base.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/cff06aac6fad28019930be03f5d467055bf62177/src%2Ftransformers%2Ftokenization_utils_base.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftokenization_utils_base.py?ref=cff06aac6fad28019930be03f5d467055bf62177",
            "patch": "@@ -721,7 +721,7 @@ def convert_to_tensors(\n \n             def as_tensor(value, dtype=None):\n                 if isinstance(value, list) and isinstance(value[0], np.ndarray):\n-                    return torch.tensor(np.array(value))\n+                    return torch.from_numpy(np.array(value))\n                 return torch.tensor(value)\n \n         elif tensor_type == TensorType.JAX:"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 20,
        "deletions": 8
    }
}