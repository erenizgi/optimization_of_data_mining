{
    "author": "ydshieh",
    "message": "Ignore conversion files in test fetcher (#36251)\n\nfix\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "f2ab182dca2a9aa4a053a1903bd4b46b90ff9f78",
    "files": [
        {
            "sha": "40749044260823491a55643b46d1b3a63b9accf0",
            "filename": "utils/tests_fetcher.py",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/f2ab182dca2a9aa4a053a1903bd4b46b90ff9f78/utils%2Ftests_fetcher.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/f2ab182dca2a9aa4a053a1903bd4b46b90ff9f78/utils%2Ftests_fetcher.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Ftests_fetcher.py?ref=f2ab182dca2a9aa4a053a1903bd4b46b90ff9f78",
            "patch": "@@ -730,6 +730,8 @@ def get_module_dependencies(module_fname: str, cache: Dict[str, List[str]] = Non\n     while len(imported_modules) > 0:\n         new_modules = []\n         for module, imports in imported_modules:\n+            if \"models\" in module.split(\"/\") and module.split(\"/\")[-1].startswith(\"convert_\"):\n+                continue\n             # If we end up in an __init__ we are often not actually importing from this init (except in the case where\n             # the object is fully defined in the __init__)\n             if module.endswith(\"__init__.py\"):\n@@ -780,7 +782,9 @@ def create_reverse_dependency_tree() -> List[Tuple[str, str]]:\n     Create a list of all edges (a, b) which mean that modifying a impacts b with a going over all module and test files.\n     \"\"\"\n     cache = {}\n-    all_modules = list(PATH_TO_TRANFORMERS.glob(\"**/*.py\")) + list(PATH_TO_TESTS.glob(\"**/*.py\"))\n+    all_modules = list(PATH_TO_TRANFORMERS.glob(\"**/*.py\"))\n+    all_modules = [x for x in all_modules if not (\"models\" in x.parts and x.parts[-1].startswith(\"convert_\"))]\n+    all_modules += list(PATH_TO_TESTS.glob(\"**/*.py\"))\n     all_modules = [str(mod.relative_to(PATH_TO_REPO)) for mod in all_modules]\n     edges = [(dep, mod) for mod in all_modules for dep in get_module_dependencies(mod, cache=cache)]\n \n@@ -898,7 +902,9 @@ def create_reverse_dependency_map() -> Dict[str, List[str]]:\n     # Start from the example deps init.\n     example_deps, examples = init_test_examples_dependencies()\n     # Add all modules and all tests to all examples\n-    all_modules = list(PATH_TO_TRANFORMERS.glob(\"**/*.py\")) + list(PATH_TO_TESTS.glob(\"**/*.py\")) + examples\n+    all_modules = list(PATH_TO_TRANFORMERS.glob(\"**/*.py\"))\n+    all_modules = [x for x in all_modules if not (\"models\" in x.parts and x.parts[-1].startswith(\"convert_\"))]\n+    all_modules += list(PATH_TO_TESTS.glob(\"**/*.py\")) + examples\n     all_modules = [str(mod.relative_to(PATH_TO_REPO)) for mod in all_modules]\n     # Compute the direct dependencies of all modules.\n     direct_deps = {m: get_module_dependencies(m, cache=cache) for m in all_modules}"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 8,
        "deletions": 2
    }
}