{
    "author": "MilkClouds",
    "message": "Fix default image_rows and image_cols initialization in Idefics3 and SmolVLM processors (#41871)\n\n* Fix default image_rows and image_cols initialization in Idefics3 and SmolVLM processors\n\n* Fix default initialization of image_rows and image_cols in Idefics3 and SmolVLM processors",
    "sha": "26fca863126f6255a23eb47a2a77db938f87ef58",
    "files": [
        {
            "sha": "143805ef6f43228bd7ae37f2b7f1c6a6c99c9728",
            "filename": "src/transformers/models/idefics3/processing_idefics3.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/26fca863126f6255a23eb47a2a77db938f87ef58/src%2Ftransformers%2Fmodels%2Fidefics3%2Fprocessing_idefics3.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/26fca863126f6255a23eb47a2a77db938f87ef58/src%2Ftransformers%2Fmodels%2Fidefics3%2Fprocessing_idefics3.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fidefics3%2Fprocessing_idefics3.py?ref=26fca863126f6255a23eb47a2a77db938f87ef58",
            "patch": "@@ -286,8 +286,8 @@ def __call__(\n                         f\"The number of images in the text {n_images_in_text} and images {n_images_in_images} should be the same.\"\n                     )\n \n-                image_rows = inputs.pop(\"rows\", [[0] * len(text)])\n-                image_cols = inputs.pop(\"cols\", [[0] * len(text)])\n+                image_rows = inputs.pop(\"rows\", [[0] * n_images for n_images in n_images_in_text])\n+                image_cols = inputs.pop(\"cols\", [[0] * n_images for n_images in n_images_in_text])\n \n                 fake_image_token = self.fake_image_token\n                 image_token = self.image_token"
        },
        {
            "sha": "a621af06e64744e6222f6d60192de0e9702ea4a8",
            "filename": "src/transformers/models/smolvlm/processing_smolvlm.py",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/26fca863126f6255a23eb47a2a77db938f87ef58/src%2Ftransformers%2Fmodels%2Fsmolvlm%2Fprocessing_smolvlm.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/26fca863126f6255a23eb47a2a77db938f87ef58/src%2Ftransformers%2Fmodels%2Fsmolvlm%2Fprocessing_smolvlm.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fsmolvlm%2Fprocessing_smolvlm.py?ref=26fca863126f6255a23eb47a2a77db938f87ef58",
            "patch": "@@ -172,8 +172,6 @@ def __init__(\n \n     def expand_text_with_image_tokens(self, text, image_rows, image_cols):\n         prompt_strings = []\n-        image_rows = image_rows if image_rows is not None else [[0] * len(text)]\n-        image_cols = image_cols if image_cols is not None else [[0] * len(text)]\n         for sample, sample_rows, sample_cols in zip(text, image_rows, image_cols):\n             # Replace the image token with fake tokens around the expanded image token sequence of length `image_seq_len`\n             image_prompt_strings = []\n@@ -330,6 +328,11 @@ def __call__(\n                     raise ValueError(\n                         f\"The number of images in the text {n_images_in_text} and images {n_images_in_images} should be the same.\"\n                     )\n+                # Set default values for image_rows and image_cols if not provided\n+                if image_rows is None:\n+                    image_rows = [[0] * n_images for n_images in n_images_in_text]\n+                if image_cols is None:\n+                    image_cols = [[0] * n_images for n_images in n_images_in_text]\n                 text = self.expand_text_with_image_tokens(text, image_rows=image_rows, image_cols=image_cols)\n \n         elif videos is not None:"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 7,
        "deletions": 4
    }
}