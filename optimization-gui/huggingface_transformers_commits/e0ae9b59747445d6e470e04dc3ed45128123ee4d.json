{
    "author": "Rocketknight1",
    "message": "ðŸš¨ðŸš¨ðŸš¨ Delete conversion scripts when making release wheels (#35296)\n\n* Delete conversion scripts when making release wheels\r\n\r\n* make fixup\r\n\r\n* Update docstring",
    "sha": "e0ae9b59747445d6e470e04dc3ed45128123ee4d",
    "files": [
        {
            "sha": "c2c0048d6913ec68d297aa4f3685f70f8bc355d0",
            "filename": "setup.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/e0ae9b59747445d6e470e04dc3ed45128123ee4d/setup.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/e0ae9b59747445d6e470e04dc3ed45128123ee4d/setup.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/setup.py?ref=e0ae9b59747445d6e470e04dc3ed45128123ee4d",
            "patch": "@@ -20,7 +20,7 @@\n 1. Create the release branch named: v<RELEASE>-release, for example v4.19-release. For a patch release checkout the\n    current release branch.\n \n-   If releasing on a special branch, copy the updated README.md on the main branch for your the commit you will make\n+   If releasing on a special branch, copy the updated README.md on the main branch for the commit you will make\n    for the post-release and run `make fix-copies` on the main branch as well.\n \n 2. Run `make pre-release` (or `make pre-patch` for a patch release) and commit these changes with the message:"
        },
        {
            "sha": "d5b74602e68c0942858e54ec02e99fda73e20501",
            "filename": "utils/release.py",
            "status": "modified",
            "additions": 18,
            "deletions": 3,
            "changes": 21,
            "blob_url": "https://github.com/huggingface/transformers/blob/e0ae9b59747445d6e470e04dc3ed45128123ee4d/utils%2Frelease.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/e0ae9b59747445d6e470e04dc3ed45128123ee4d/utils%2Frelease.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Frelease.py?ref=e0ae9b59747445d6e470e04dc3ed45128123ee4d",
            "patch": "@@ -45,12 +45,14 @@\n import argparse\n import os\n import re\n+from pathlib import Path\n \n import packaging.version\n \n \n # All paths are defined with the intent that this script should be run from the root of the repo.\n PATH_TO_EXAMPLES = \"examples/\"\n+PATH_TO_MODELS = \"src/transformers/models\"\n # This maps a type of file to the pattern to look for when searching where the version is defined, as well as the\n # template to follow when replacing it with the new version.\n REPLACE_PATTERNS = {\n@@ -117,6 +119,17 @@ def global_version_update(version: str, patch: bool = False):\n         update_version_in_examples(version)\n \n \n+def remove_conversion_scripts():\n+    \"\"\"\n+    Delete the scripts that convert models from older, unsupported formats. We don't want to include these\n+    in release wheels because they often have to open insecure file types (pickle, Torch .bin models). This results in\n+    vulnerability scanners flagging us and can cause compliance issues for users with strict security policies.\n+    \"\"\"\n+    model_dir = Path(PATH_TO_MODELS)\n+    for conversion_script in list(model_dir.glob(\"**/convert*.py\")):\n+        conversion_script.unlink()\n+\n+\n def get_version() -> packaging.version.Version:\n     \"\"\"\n     Reads the current version in the main __init__.\n@@ -131,7 +144,7 @@ def pre_release_work(patch: bool = False):\n     \"\"\"\n     Do all the necessary pre-release steps:\n     - figure out the next minor release version and ask confirmation\n-    - update the version eveywhere\n+    - update the version everywhere\n     - clean-up the model list in the main README\n \n     Args:\n@@ -155,13 +168,15 @@ def pre_release_work(patch: bool = False):\n \n     print(f\"Updating version to {version}.\")\n     global_version_update(version, patch=patch)\n+    print(\"Deleting conversion scripts.\")\n+    remove_conversion_scripts()\n \n \n def post_release_work():\n     \"\"\"\n-    Do all the necesarry post-release steps:\n+    Do all the necessary post-release steps:\n     - figure out the next dev version and ask confirmation\n-    - update the version eveywhere\n+    - update the version everywhere\n     - clean-up the model list in the main README\n     \"\"\"\n     # First let's get the current version"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 19,
        "deletions": 4
    }
}