{
    "author": "simonreise",
    "message": "Improve `auxiliary_in_channels` default behavior in UperNet (#37540)\n\nImprove auxiliary_in_channels behavior in UperNet\n\nCo-authored-by: Pavel Iakubovskii <qubvel@gmail.com>",
    "sha": "41e0c921cbb2b2c9f82dd998d7b02bf680d037dd",
    "files": [
        {
            "sha": "a6c60f95cd5c228b3800303959a0656644387dc6",
            "filename": "src/transformers/models/upernet/configuration_upernet.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/41e0c921cbb2b2c9f82dd998d7b02bf680d037dd/src%2Ftransformers%2Fmodels%2Fupernet%2Fconfiguration_upernet.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/41e0c921cbb2b2c9f82dd998d7b02bf680d037dd/src%2Ftransformers%2Fmodels%2Fupernet%2Fconfiguration_upernet.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fupernet%2Fconfiguration_upernet.py?ref=41e0c921cbb2b2c9f82dd998d7b02bf680d037dd",
            "patch": "@@ -96,7 +96,7 @@ def __init__(\n         pool_scales=[1, 2, 3, 6],\n         use_auxiliary_head=True,\n         auxiliary_loss_weight=0.4,\n-        auxiliary_in_channels=384,\n+        auxiliary_in_channels=None,\n         auxiliary_channels=256,\n         auxiliary_num_convs=1,\n         auxiliary_concat_input=False,"
        },
        {
            "sha": "d808b7ab3b9c2027e673d2b11a0272df5326a72c",
            "filename": "src/transformers/models/upernet/modeling_upernet.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/41e0c921cbb2b2c9f82dd998d7b02bf680d037dd/src%2Ftransformers%2Fmodels%2Fupernet%2Fmodeling_upernet.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/41e0c921cbb2b2c9f82dd998d7b02bf680d037dd/src%2Ftransformers%2Fmodels%2Fupernet%2Fmodeling_upernet.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fupernet%2Fmodeling_upernet.py?ref=41e0c921cbb2b2c9f82dd998d7b02bf680d037dd",
            "patch": "@@ -218,12 +218,14 @@ class UperNetFCNHead(nn.Module):\n     \"\"\"\n \n     def __init__(\n-        self, config, in_index: int = 2, kernel_size: int = 3, dilation: Union[int, Tuple[int, int]] = 1\n+        self, config, in_channels, in_index: int = 2, kernel_size: int = 3, dilation: Union[int, Tuple[int, int]] = 1\n     ) -> None:\n         super().__init__()\n \n         self.config = config\n-        self.in_channels = config.auxiliary_in_channels\n+        self.in_channels = (\n+            in_channels[in_index] if config.auxiliary_in_channels is None else config.auxiliary_in_channels\n+        )\n         self.channels = config.auxiliary_channels\n         self.num_convs = config.auxiliary_num_convs\n         self.concat_input = config.auxiliary_concat_input\n@@ -292,7 +294,9 @@ def __init__(self, config):\n \n         # Semantic segmentation head(s)\n         self.decode_head = UperNetHead(config, in_channels=self.backbone.channels)\n-        self.auxiliary_head = UperNetFCNHead(config) if config.use_auxiliary_head else None\n+        self.auxiliary_head = (\n+            UperNetFCNHead(config, in_channels=self.backbone.channels) if config.use_auxiliary_head else None\n+        )\n \n         # Initialize weights and apply final processing\n         self.post_init()"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 8,
        "deletions": 4
    }
}