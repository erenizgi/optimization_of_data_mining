{
    "author": "hmellor",
    "message": "Fix early CUDA initialisation (#41409)\n\nSigned-off-by: Harry Mellor <19981378+hmellor@users.noreply.github.com>",
    "sha": "88e946e06233b6e470f44443b71ef45829ef5d30",
    "files": [
        {
            "sha": "dcc6f287c51c5a96814aac83ab557f02de15cb8b",
            "filename": "src/transformers/generation/continuous_batching/continuous_api.py",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/huggingface/transformers/blob/88e946e06233b6e470f44443b71ef45829ef5d30/src%2Ftransformers%2Fgeneration%2Fcontinuous_batching%2Fcontinuous_api.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/88e946e06233b6e470f44443b71ef45829ef5d30/src%2Ftransformers%2Fgeneration%2Fcontinuous_batching%2Fcontinuous_api.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fgeneration%2Fcontinuous_batching%2Fcontinuous_api.py?ref=88e946e06233b6e470f44443b71ef45829ef5d30",
            "patch": "@@ -27,7 +27,6 @@\n \n from ...configuration_utils import PreTrainedConfig\n from ...generation.configuration_utils import GenerationConfig\n-from ...integrations.hub_kernels import load_and_register_kernel\n from ...utils.logging import logging\n from ...utils.metrics import ContinuousBatchProcessorMetrics, attach_tracer, traced\n from .cache import PagedAttentionCache\n@@ -609,6 +608,8 @@ def __init__(\n         \"\"\"\n         self.model = model.eval()\n         if \"paged|\" not in model.config._attn_implementation:\n+            from ...integrations.hub_kernels import load_and_register_kernel\n+\n             attn_implementation = \"paged|\" + self.model.config._attn_implementation\n             load_and_register_kernel(attn_implementation)\n             model.set_attn_implementation(attn_implementation)"
        }
    ],
    "stats": {
        "total": 3,
        "additions": 2,
        "deletions": 1
    }
}