{
    "author": "ydshieh",
    "message": "Avoid OOM when other tests are failing (#39758)\n\nfix\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "dfd616e658527d809b7d1d351a6b9c6f3c498096",
    "files": [
        {
            "sha": "73af767e04f215ed6ccaad40fb9d8b0ced10f174",
            "filename": "tests/models/musicgen_melody/test_modeling_musicgen_melody.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/dfd616e658527d809b7d1d351a6b9c6f3c498096/tests%2Fmodels%2Fmusicgen_melody%2Ftest_modeling_musicgen_melody.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/dfd616e658527d809b7d1d351a6b9c6f3c498096/tests%2Fmodels%2Fmusicgen_melody%2Ftest_modeling_musicgen_melody.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fmusicgen_melody%2Ftest_modeling_musicgen_melody.py?ref=dfd616e658527d809b7d1d351a6b9c6f3c498096",
            "patch": "@@ -31,6 +31,7 @@\n )\n from transformers.testing_utils import (\n     Expectations,\n+    cleanup,\n     get_device_properties,\n     is_torch_available,\n     is_torchaudio_available,\n@@ -1256,6 +1257,12 @@ class MusicgenMelodyIntegrationTests(unittest.TestCase):\n     def model(self):\n         return MusicgenMelodyForConditionalGeneration.from_pretrained(\"ylacombe/musicgen-melody\").to(torch_device)\n \n+    def setUp(self):\n+        cleanup(torch_device, gc_collect=True)\n+\n+    def tearDown(self):\n+        cleanup(torch_device, gc_collect=True)\n+\n     @cached_property\n     def processor(self):\n         return MusicgenMelodyProcessor.from_pretrained(\"ylacombe/musicgen-melody\")"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 7,
        "deletions": 0
    }
}