{
    "author": "zucchini-nlp",
    "message": "Support LLaVa-OV-Chat (#33532)\n\n* add llava-ov-chat\r\n\r\n* uncomment",
    "sha": "fee86516a48c92133847fc7b44ca2f83c7c5634d",
    "files": [
        {
            "sha": "65c57f624f549f58b68b242d629923daa5106cca",
            "filename": "src/transformers/models/llava_onevision/convert_llava_onevision_weights_to_hf.py",
            "status": "modified",
            "additions": 30,
            "deletions": 2,
            "changes": 32,
            "blob_url": "https://github.com/huggingface/transformers/blob/fee86516a48c92133847fc7b44ca2f83c7c5634d/src%2Ftransformers%2Fmodels%2Fllava_onevision%2Fconvert_llava_onevision_weights_to_hf.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fee86516a48c92133847fc7b44ca2f83c7c5634d/src%2Ftransformers%2Fmodels%2Fllava_onevision%2Fconvert_llava_onevision_weights_to_hf.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fllava_onevision%2Fconvert_llava_onevision_weights_to_hf.py?ref=fee86516a48c92133847fc7b44ca2f83c7c5634d",
            "patch": "@@ -105,9 +105,17 @@ def convert_llava_to_hf(model_id, pytorch_dump_folder_path, push_to_hub=False):\n \n     if model_id in [\"lmms-lab/llava-onevision-qwen2-0.5b-ov\", \"lmms-lab/llava-onevision-qwen2-0.5b-si\"]:\n         text_model_id = \"Qwen/Qwen2-0.5B-Instruct\"\n-    elif model_id in [\"lmms-lab/llava-onevision-qwen2-7b-ov\", \"lmms-lab/llava-onevision-qwen2-7b-si\"]:\n+    elif model_id in [\n+        \"lmms-lab/llava-onevision-qwen2-7b-ov\",\n+        \"lmms-lab/llava-onevision-qwen2-7b-si\",\n+        \"lmms-lab/llava-onevision-qwen2-7b-ov-chat\",\n+    ]:\n         text_model_id = \"Qwen/Qwen2-7B-Instruct\"\n-    elif model_id in [\"lmms-lab/llava-onevision-qwen2-72b-ov\", \"lmms-lab/llava-onevision-qwen2-72b-si\"]:\n+    elif model_id in [\n+        \"lmms-lab/llava-onevision-qwen2-72b-ov\",\n+        \"lmms-lab/llava-onevision-qwen2-72b-si\",\n+        \"lmms-lab/llava-onevision-qwen2-72b-ov-chat\",\n+    ]:\n         text_model_id = \"Qwen/Qwen2-72B-Instruct\"\n \n     vision_model_id = data[\"mm_vision_tower\"]\n@@ -260,6 +268,20 @@ def convert_llava_to_hf(model_id, pytorch_dump_folder_path, push_to_hub=False):\n                 dtype=torch.float32,\n                 device=device,\n             )\n+        elif model_id == \"lmms-lab/llava-onevision-qwen2-7b-ov-chat\":\n+            # Not yet checked against reference\n+            expected_slice = torch.tensor(\n+                [[1.8662, 3.4316, 1.3174], [2.7109, 2.5488, 3.0117], [4.4648, 4.9648, 10.3359]],\n+                dtype=torch.float32,\n+                device=device,\n+            )\n+        elif model_id == \"lmms-lab/llava-onevision-qwen2-72b-ov-chat\":\n+            # Not yet checked against reference\n+            expected_slice = torch.tensor(\n+                [[4.3086, 4.7344, 2.6953], [1.7090, 5.1719, 4.0234], [1.3057, 6.3438, 9.5469]],\n+                dtype=torch.float32,\n+                device=device,\n+            )\n         else:\n             raise ValueError(f\"Model {model_id} not supported\")\n \n@@ -289,6 +311,10 @@ def convert_llava_to_hf(model_id, pytorch_dump_folder_path, push_to_hub=False):\n         expected_text = \"system\\nYou are a helpful assistant.\\nuser\\n\\nWhat is shown in this image?\\nassistant\\nThe image shows a radar chart, which is a graphical method of displaying multivariate data in the form of a two-dimensional chart of three or more quantitative variables represented on axes starting from the same point. The chart is used to compare the performance of different models or systems across various benchmarks or metrics.\\n\\nIn this specific radar chart, there are multiple axes, each representing a different benchmark or metric, such as VQA2, GQA, TextVQA, and others. The chart includes several colored lines\"\n     elif model_id == \"lmms-lab/llava-onevision-qwen2-72b-ov\":\n         expected_text = \"system\\nYou are a helpful assistant.\\nuser\\n\\nWhat is shown in this image?\\nassistant\\nThe image is a radar chart comparing the performance of different models on various multimodal benchmarks. The models compared are BLIP-2, InstructBLIP, POPE, QWen-VL-Chat, and LLava-1.5. The benchmarks include VQAv2, GQA, TextVQA, SQA-IMG, VizWiz, MM-IMDb, MM-VQA, MM-IMDb-CN, MM-IMDb-EN, MM-\"\n+    elif model_id == \"lmms-lab/llava-onevision-qwen2-7b-ov-chat\":\n+        expected_text = \"system\\nYou are a helpful assistant.\\nuser\\n\\nWhat is shown in this image?\\nassistant\\nThe image shows a radar chart, also known as a spider chart or a star chart, which is used to display multivariate data in the form of a two-dimensional chart of three or more quantitative variables represented on axes starting from the same point. Each axis represents a different variable, and the values are plotted along these axes.\\n\\nIn this particular radar chart, there are multiple lines representing different models or systems, each distinguished by a different color and labeled with a name such as BLIP-2, In\"\n+    elif model_id == \"lmms-lab/llava-onevision-qwen2-72b-ov-chat\":\n+        expected_text = \"system\\nYou are a helpful assistant.\\nuser\\n\\nWhat is shown in this image?\\nassistant\\nThe image is a radar chart comparing the performance of different models on various multimodal benchmarks. The models compared are BLIP-2, InstructBLIP, POPE, QWen-VL-Chat, and LLava-1.5. The benchmarks include VQAv2, GQA, TextVQA, SQA-IMG, VizWiz, MM-IMDb, MM-VQA, MM-IMDb-CN, MM-IMDb-EN, MM-\"\n     else:\n         raise ValueError(f\"Model {model_id} not supported\")\n \n@@ -346,6 +372,8 @@ def convert_llava_to_hf(model_id, pytorch_dump_folder_path, push_to_hub=False):\n             \"lmms-lab/llava-onevision-qwen2-7b-ov\",\n             \"lmms-lab/llava-onevision-qwen2-72b-si\",\n             \"lmms-lab/llava-onevision-qwen2-72b-ov\",\n+            \"lmms-lab/llava-onevision-qwen2-7b-ov-chat\",\n+            \"lmms-lab/llava-onevision-qwen2-72b-ov-chat\",\n         ],\n         required=False,\n     )"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 30,
        "deletions": 2
    }
}