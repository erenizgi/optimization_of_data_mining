{
    "author": "shubham0204",
    "message": "Update model card for Depth Anything (#37065)\n\n[docs] Update model card for Depth Anything",
    "sha": "531e4fcf0e6580a9ab80cc72860a4f6b2b5f67c5",
    "files": [
        {
            "sha": "ea52dea915ddd24e601ed41f87ba616f7bdb47c6",
            "filename": "docs/source/en/model_doc/depth_anything.md",
            "status": "modified",
            "additions": 48,
            "deletions": 80,
            "changes": 128,
            "blob_url": "https://github.com/huggingface/transformers/blob/531e4fcf0e6580a9ab80cc72860a4f6b2b5f67c5/docs%2Fsource%2Fen%2Fmodel_doc%2Fdepth_anything.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/531e4fcf0e6580a9ab80cc72860a4f6b2b5f67c5/docs%2Fsource%2Fen%2Fmodel_doc%2Fdepth_anything.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fdepth_anything.md?ref=531e4fcf0e6580a9ab80cc72860a4f6b2b5f67c5",
            "patch": "@@ -14,101 +14,69 @@ rendered properly in your Markdown viewer.\n \n -->\n \n-# Depth Anything\n-\n-<div class=\"flex flex-wrap space-x-1\">\n-<img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+<div style=\"float: right;\">\n+    <div class=\"flex flex-wrap space-x-1\">\n+        <img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+    </div>\n </div>\n \n-## Overview\n-\n-The Depth Anything model was proposed in [Depth Anything: Unleashing the Power of Large-Scale Unlabeled Data](https://arxiv.org/abs/2401.10891) by Lihe Yang, Bingyi Kang, Zilong Huang, Xiaogang Xu, Jiashi Feng, Hengshuang Zhao. Depth Anything is based on the [DPT](dpt) architecture, trained on ~62 million images, obtaining state-of-the-art results for both relative and absolute depth estimation.\n-\n-<Tip>\n-\n-[Depth Anything V2](depth_anything_v2) was released in June 2024. It uses the same architecture as Depth Anything and therefore it is compatible with all code examples and existing workflows. However, it leverages synthetic data and a larger capacity teacher model to achieve much finer and robust depth predictions.\n-\n-</Tip>\n-\n-The abstract from the paper is the following:\n-\n-*This work presents Depth Anything, a highly practical solution for robust monocular depth estimation. Without pursuing novel technical modules, we aim to build a simple yet powerful foundation model dealing with any images under any circumstances. To this end, we scale up the dataset by designing a data engine to collect and automatically annotate large-scale unlabeled data (~62M), which significantly enlarges the data coverage and thus is able to reduce the generalization error. We investigate two simple yet effective strategies that make data scaling-up promising. First, a more challenging optimization target is created by leveraging data augmentation tools. It compels the model to actively seek extra visual knowledge and acquire robust representations. Second, an auxiliary supervision is developed to enforce the model to inherit rich semantic priors from pre-trained encoders. We evaluate its zero-shot capabilities extensively, including six public datasets and randomly captured photos. It demonstrates impressive generalization ability. Further, through fine-tuning it with metric depth information from NYUv2 and KITTI, new SOTAs are set. Our better depth model also results in a better depth-conditioned ControlNet.*\n-\n-<img src=\"https://huggingface.co/datasets/huggingface/documentation-images/resolve/main/transformers/model_doc/depth_anything_overview.jpg\"\n-alt=\"drawing\" width=\"600\"/>\n-\n-<small> Depth Anything overview. Taken from the <a href=\"https://arxiv.org/abs/2401.10891\">original paper</a>.</small>\n-\n-This model was contributed by [nielsr](https://huggingface.co/nielsr).\n-The original code can be found [here](https://github.com/LiheYoung/Depth-Anything).\n-\n-## Usage example\n+# Depth Anything\n \n-There are 2 main ways to use Depth Anything: either using the pipeline API, which abstracts away all the complexity for you, or by using the `DepthAnythingForDepthEstimation` class yourself.\n+[Depth Anything](https://huggingface.co/papers/2401.10891) is designed to be a foundation model for monocular depth estimation (MDE). It is jointly trained on labeled and ~62M unlabeled images to enhance the dataset. It uses a pretrained [DINOv2](./dinov2) model as an image encoder to inherit its existing rich semantic priors, and [DPT](./dpt) as the decoder. A teacher model is trained on unlabeled images to create pseudo-labels. The student model is trained on a combination of the pseudo-labels and labeled images. To improve the student model's performance, strong perturbations are added to the unlabeled images to challenge the student model to learn more visual knowledge from the image.\n \n-### Pipeline API\n+You can find all the original Depth Anything checkpoints under the [Depth Anything](https://huggingface.co/collections/LiheYoung/depth-anything-release-65b317de04eec72abf6b55aa) collection.\n \n-The pipeline allows to use the model in a few lines of code:\n+> [!TIP]\n+> Click on the Depth Anything models in the right sidebar for more examples of how to apply Depth Anything to different vision tasks.\n \n-```python\n->>> from transformers import pipeline\n->>> from PIL import Image\n->>> import requests\n+The example below demonstrates how to obtain a depth map with [`Pipeline`] or the [`AutoModel`] class.\n \n->>> # load pipe\n->>> pipe = pipeline(task=\"depth-estimation\", model=\"LiheYoung/depth-anything-small-hf\")\n+<hfoptions id=\"usage\">\n+<hfoption id=\"Pipeline\">\n \n->>> # load image\n->>> url = 'http://images.cocodataset.org/val2017/000000039769.jpg'\n->>> image = Image.open(requests.get(url, stream=True).raw)\n+```py\n+import torch\n+from transformers import pipeline\n \n->>> # inference\n->>> depth = pipe(image)[\"depth\"]\n+pipe = pipeline(task=\"depth-estimation\", model=\"LiheYoung/depth-anything-base-hf\", torch_dtype=torch.bfloat16, device=0)\n+pipe(\"http://images.cocodataset.org/val2017/000000039769.jpg\")[\"depth\"]\n ```\n \n-### Using the model yourself\n-\n-If you want to do the pre- and postprocessing yourself, here's how to do that:\n-\n-```python\n->>> from transformers import AutoImageProcessor, AutoModelForDepthEstimation\n->>> import torch\n->>> import numpy as np\n->>> from PIL import Image\n->>> import requests\n-\n->>> url = \"http://images.cocodataset.org/val2017/000000039769.jpg\"\n->>> image = Image.open(requests.get(url, stream=True).raw)\n-\n->>> image_processor = AutoImageProcessor.from_pretrained(\"LiheYoung/depth-anything-small-hf\")\n->>> model = AutoModelForDepthEstimation.from_pretrained(\"LiheYoung/depth-anything-small-hf\")\n-\n->>> # prepare image for the model\n->>> inputs = image_processor(images=image, return_tensors=\"pt\")\n-\n->>> with torch.no_grad():\n-...     outputs = model(**inputs)\n-\n->>> # interpolate to original size and visualize the prediction\n->>> post_processed_output = image_processor.post_process_depth_estimation(\n-...     outputs,\n-...     target_sizes=[(image.height, image.width)],\n-... )\n-\n->>> predicted_depth = post_processed_output[0][\"predicted_depth\"]\n->>> depth = (predicted_depth - predicted_depth.min()) / (predicted_depth.max() - predicted_depth.min())\n->>> depth = depth.detach().cpu().numpy() * 255\n->>> depth = Image.fromarray(depth.astype(\"uint8\"))\n+</hfoption>\n+<hfoption id=\"AutoModel\">\n+\n+```py\n+import torch\n+import requests\n+import numpy as np\n+from PIL import Image\n+from transformers import AutoImageProcessor, AutoModelForDepthEstimation\n+\n+image_processor = AutoImageProcessor.from_pretrained(\"LiheYoung/depth-anything-base-hf\")\n+model = AutoModelForDepthEstimation.from_pretrained(\"LiheYoung/depth-anything-base-hf\", torch_dtype=torch.bfloat16)\n+url = \"http://images.cocodataset.org/val2017/000000039769.jpg\"\n+image = Image.open(requests.get(url, stream=True).raw)\n+inputs = image_processor(images=image, return_tensors=\"pt\")\n+\n+with torch.no_grad():\n+    outputs = model(**inputs)\n+\n+post_processed_output = image_processor.post_process_depth_estimation(\n+    outputs,\n+    target_sizes=[(image.height, image.width)],\n+)\n+predicted_depth = post_processed_output[0][\"predicted_depth\"]\n+depth = (predicted_depth - predicted_depth.min()) / (predicted_depth.max() - predicted_depth.min())\n+depth = depth.detach().cpu().numpy() * 255\n+Image.fromarray(depth.astype(\"uint8\"))\n ```\n \n-## Resources\n-\n-A list of official Hugging Face and community (indicated by ðŸŒŽ) resources to help you get started with Depth Anything.\n+</hfoption>\n+</hfoptions>\n \n-- [Monocular depth estimation task guide](../tasks/monocular_depth_estimation)\n-- A notebook showcasing inference with [`DepthAnythingForDepthEstimation`] can be found [here](https://github.com/NielsRogge/Transformers-Tutorials/blob/master/Depth%20Anything/Predicting_depth_in_an_image_with_Depth_Anything.ipynb). ðŸŒŽ\n+## Notes\n \n-If you're interested in submitting a resource to be included here, please feel free to open a Pull Request and we'll review it! The resource should ideally demonstrate something new instead of duplicating an existing resource.\n+- [DepthAnythingV2](./depth_anything_v2), released in June 2024, uses the same architecture as Depth Anything and is compatible with all code examples and existing workflows. It uses synthetic data and a larger capacity teacher model to achieve much finer and robust depth predictions.\n \n ## DepthAnythingConfig\n "
        }
    ],
    "stats": {
        "total": 128,
        "additions": 48,
        "deletions": 80
    }
}