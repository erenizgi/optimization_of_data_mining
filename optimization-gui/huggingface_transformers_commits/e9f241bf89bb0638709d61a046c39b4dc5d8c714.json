{
    "author": "MekkCyber",
    "message": "[quantization] fix compressed_tensors tests (#41780)\n\nfixing tests",
    "sha": "e9f241bf89bb0638709d61a046c39b4dc5d8c714",
    "files": [
        {
            "sha": "cc5117a5bab1162a393e4b3de8c717596161af2d",
            "filename": "tests/quantization/compressed_tensors_integration/test_compressed_models.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/e9f241bf89bb0638709d61a046c39b4dc5d8c714/tests%2Fquantization%2Fcompressed_tensors_integration%2Ftest_compressed_models.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/e9f241bf89bb0638709d61a046c39b4dc5d8c714/tests%2Fquantization%2Fcompressed_tensors_integration%2Ftest_compressed_models.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fquantization%2Fcompressed_tensors_integration%2Ftest_compressed_models.py?ref=e9f241bf89bb0638709d61a046c39b4dc5d8c714",
            "patch": "@@ -85,7 +85,11 @@ def _has_nested_attr(obj, attr_path):\n                             )\n                         else:\n                             self.assertTrue(\n-                                torch.allclose(submodule.weight, comp_decomp_obj.weight, atol=0.2),\n+                                torch.allclose(\n+                                    submodule.weight.to(torch_device),\n+                                    comp_decomp_obj.weight.to(torch_device),\n+                                    atol=0.2,\n+                                ),\n                                 f\"Weight mismatch for module '{name}' in quantized-only or stacked model.\",\n                             )\n "
        },
        {
            "sha": "2491d475098e9a9718351cfbeaf324d7f5d17491",
            "filename": "tests/quantization/compressed_tensors_integration/test_compressed_tensors.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/e9f241bf89bb0638709d61a046c39b4dc5d8c714/tests%2Fquantization%2Fcompressed_tensors_integration%2Ftest_compressed_tensors.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/e9f241bf89bb0638709d61a046c39b4dc5d8c714/tests%2Fquantization%2Fcompressed_tensors_integration%2Ftest_compressed_tensors.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fquantization%2Fcompressed_tensors_integration%2Ftest_compressed_tensors.py?ref=e9f241bf89bb0638709d61a046c39b4dc5d8c714",
            "patch": "@@ -47,7 +47,7 @@ def test_config_to_from_dict(self):\n         self.assertIsInstance(config_from_dict.sparsity_config, SparsityCompressionConfig)\n \n     def test_tinyllama_w8a8(self):\n-        expected_out = \"<s> Paris is the capital of which country?\\n\\n  1. Paris is the capital of which country?\\n\\n  1. Paris is the capital of which country?\\n\\n  1. Paris is the capital of which country?\\n\\n\"\n+        expected_out = \"<s> Paris is the capital of which country?\\n\\n**A) 10** Paris is the capital of which country?\\n\\n**B) 11** Paris is the capital of which country?\\n\\n**C) 1\"\n         self._test_quantized_model(self.tinyllama_w8a8, expected_out)\n \n     def test_tinyllama_w4a16(self):\n@@ -59,7 +59,7 @@ def test_tinyllama_w8a16(self):\n         self._test_quantized_model(self.tinyllama_w8a16, expected_out)\n \n     def test_llama_8b_fp8(self):\n-        expected_out = \"<|begin_of_text|>Paris is the capital of which country? France\\nWhat is the name of the famous museum in Paris that is home to the Mona Lisa? The Louvre\\nWhat is the name of the famous bridge in Paris that is often associated with the city\"\n+        expected_out = \"<|begin_of_text|>Paris is the capital of which country? France\\nWhat is the name of the famous art museum in Paris? The Louvre\\nWhat is the name of the famous opera house in Paris? Palais Garnier\\nWhat is the name of the\"\n         self._test_quantized_model(self.llama3_8b_fp8, expected_out)\n \n     def _test_quantized_model(self, model_name: str, expected_output: str):"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 7,
        "deletions": 3
    }
}