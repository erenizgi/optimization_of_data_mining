{
    "author": "jiqing-feng",
    "message": "Intel CPU dockerfile (#40806)\n\n* upload intel cpu dockerfile\n\nSigned-off-by: jiqing-feng <jiqing.feng@intel.com>\n\n* update cpu dockerfile\n\nSigned-off-by: jiqing-feng <jiqing.feng@intel.com>\n\n* update label name\n\nSigned-off-by: jiqing-feng <jiqing.feng@intel.com>\n\n---------\n\nSigned-off-by: jiqing-feng <jiqing.feng@intel.com>",
    "sha": "26b65fb5168f324277b85c558ef8209bfceae1fe",
    "files": [
        {
            "sha": "3270b8582420b2a0778f5f18f779e80f52592bf0",
            "filename": "docker/transformers-intel-cpu/Dockerfile",
            "status": "added",
            "additions": 71,
            "deletions": 0,
            "changes": 71,
            "blob_url": "https://github.com/huggingface/transformers/blob/26b65fb5168f324277b85c558ef8209bfceae1fe/docker%2Ftransformers-intel-cpu%2FDockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/26b65fb5168f324277b85c558ef8209bfceae1fe/docker%2Ftransformers-intel-cpu%2FDockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Ftransformers-intel-cpu%2FDockerfile?ref=26b65fb5168f324277b85c558ef8209bfceae1fe",
            "patch": "@@ -0,0 +1,71 @@\n+FROM intel/deep-learning-essentials:2025.1.3-0-devel-ubuntu24.04 AS base\n+LABEL maintainer=\"Hugging Face\"\n+SHELL [\"/bin/bash\", \"-c\"]\n+\n+ARG PYTHON_VERSION=3.12\n+ENV DEBIAN_FRONTEND=noninteractive\n+\n+RUN apt-get update && \\\n+    apt-get install -y software-properties-common && \\\n+    add-apt-repository -y ppa:deadsnakes/ppa && \\\n+    apt-get update\n+\n+RUN apt-get update && \\\n+    apt-get -y install \\\n+    apt-utils \\\n+    build-essential \\\n+    ca-certificates \\\n+    clinfo \\\n+    curl \\\n+    git \\\n+    git-lfs \\\n+    vim \\\n+    numactl \\\n+    gnupg2 \\\n+    gpg-agent \\\n+    python3-dev \\\n+    python3-opencv \\\n+    unzip \\\n+    ffmpeg \\\n+    tesseract-ocr \\\n+    espeak-ng \\\n+    wget \\\n+    ncurses-term \\\n+    google-perftools \\\n+    libjemalloc-dev \\\n+    && apt-get clean \\\n+    && rm -rf /var/lib/apt/lists/*\n+\n+# Use virtual env because Ubuntu:24 does not allowed pip on original python\n+RUN curl -LsSf https://astral.sh/uv/install.sh | sh\n+ENV PATH=\"/root/.local/bin:$PATH\"\n+ENV VIRTUAL_ENV=\"/opt/venv\"\n+ENV UV_PYTHON_INSTALL_DIR=/opt/uv/python\n+RUN uv venv --python ${PYTHON_VERSION} --seed ${VIRTUAL_ENV}\n+ENV PATH=\"$VIRTUAL_ENV/bin:$PATH\"\n+\n+RUN pip install --upgrade pip wheel\n+RUN pip install torch torchvision torchaudio torchcodec --index-url https://download.pytorch.org/whl/cpu --no-cache-dir\n+RUN pip install av pyctcdecode pytesseract decord galore-torch fire scipy scikit-learn sentencepiece sentence_transformers sacremoses nltk rouge_score librosa soundfile mpi4py pytorch_msssim\n+RUN pip install onnx optimum onnxruntime\n+RUN pip install autoawq\n+RUN pip install gptqmodel --no-build-isolation\n+RUN pip install -U datasets timm transformers accelerate peft diffusers opencv-python kenlm evaluate\n+RUN pip install -U intel-openmp\n+\n+# install bitsandbytes\n+RUN git clone https://github.com/bitsandbytes-foundation/bitsandbytes.git && cd bitsandbytes/ && \\\n+    cmake -DCOMPUTE_BACKEND=cpu -S . && make && pip install . && cd ../\n+\n+# CPU don't need triton\n+RUN pip uninstall triton -y\n+\n+ENV LD_PRELOAD=${LD_PRELOAD}:/opt/venv/lib/libiomp5.so:/usr/lib/x86_64-linux-gnu/libtcmalloc.so.4\n+ENV KMP_AFFINITY=granularity=fine,compact,1,0\n+\n+RUN touch /entrypoint.sh\n+RUN chmod +x /entrypoint.sh\n+RUN echo \"#!/bin/bash\" >> /entrypoint.sh\n+RUN echo \"/bin/bash\" >> /entrypoint.sh\n+\n+ENTRYPOINT [\"/entrypoint.sh\"]"
        }
    ],
    "stats": {
        "total": 71,
        "additions": 71,
        "deletions": 0
    }
}