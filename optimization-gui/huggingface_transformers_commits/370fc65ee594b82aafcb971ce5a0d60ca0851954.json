{
    "author": "sywangyi",
    "message": "add xpu support in test_modeling_janus.py::JanusIntegrationTest::testâ€¦ (#41986)\n\n* add xpu support in test_modeling_janus.py::JanusIntegrationTest::test_model_generate_images\n\nSigned-off-by: Wang, Yi A <yi.a.wang@intel.com>\n\n* fix ci issue\n\nSigned-off-by: Wang, Yi A <yi.a.wang@intel.com>\n\n---------\n\nSigned-off-by: Wang, Yi A <yi.a.wang@intel.com>",
    "sha": "370fc65ee594b82aafcb971ce5a0d60ca0851954",
    "files": [
        {
            "sha": "8357d070886e0d76e52b9c95976b5dcae879d7a0",
            "filename": "src/transformers/models/janus/modeling_janus.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/370fc65ee594b82aafcb971ce5a0d60ca0851954/src%2Ftransformers%2Fmodels%2Fjanus%2Fmodeling_janus.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/370fc65ee594b82aafcb971ce5a0d60ca0851954/src%2Ftransformers%2Fmodels%2Fjanus%2Fmodeling_janus.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fjanus%2Fmodeling_janus.py?ref=370fc65ee594b82aafcb971ce5a0d60ca0851954",
            "patch": "@@ -1419,8 +1419,8 @@ def generate(\n             model_inputs = self.prepare_inputs_for_generation(\n                 inputs_embeds=inputs_embeds, input_ids=input_tokens, **model_kwargs\n             )\n-\n-            model_inputs[\"attention_mask\"] = model_inputs[\"attention_mask\"].to(inputs_embeds.device)\n+            if \"attention_mask\" in model_inputs:\n+                model_inputs[\"attention_mask\"] = model_inputs[\"attention_mask\"].to(inputs_embeds.device)\n             model_inputs[\"cache_position\"] = model_inputs[\"cache_position\"].to(inputs_embeds.device)\n \n             outputs = self.model.language_model("
        },
        {
            "sha": "019fe3c93be822c551b8c83ea99b8fb4705d7c4a",
            "filename": "src/transformers/models/janus/modular_janus.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/370fc65ee594b82aafcb971ce5a0d60ca0851954/src%2Ftransformers%2Fmodels%2Fjanus%2Fmodular_janus.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/370fc65ee594b82aafcb971ce5a0d60ca0851954/src%2Ftransformers%2Fmodels%2Fjanus%2Fmodular_janus.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fjanus%2Fmodular_janus.py?ref=370fc65ee594b82aafcb971ce5a0d60ca0851954",
            "patch": "@@ -1235,8 +1235,8 @@ def generate(\n             model_inputs = self.prepare_inputs_for_generation(\n                 inputs_embeds=inputs_embeds, input_ids=input_tokens, **model_kwargs\n             )\n-\n-            model_inputs[\"attention_mask\"] = model_inputs[\"attention_mask\"].to(inputs_embeds.device)\n+            if \"attention_mask\" in model_inputs:\n+                model_inputs[\"attention_mask\"] = model_inputs[\"attention_mask\"].to(inputs_embeds.device)\n             model_inputs[\"cache_position\"] = model_inputs[\"cache_position\"].to(inputs_embeds.device)\n \n             outputs = self.model.language_model("
        },
        {
            "sha": "f56642a38e543fa2932628ef66279eb605fbf36a",
            "filename": "tests/models/janus/test_modeling_janus.py",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/370fc65ee594b82aafcb971ce5a0d60ca0851954/tests%2Fmodels%2Fjanus%2Ftest_modeling_janus.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/370fc65ee594b82aafcb971ce5a0d60ca0851954/tests%2Fmodels%2Fjanus%2Ftest_modeling_janus.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fjanus%2Ftest_modeling_janus.py?ref=370fc65ee594b82aafcb971ce5a0d60ca0851954",
            "patch": "@@ -514,6 +514,12 @@ def test_model_generate_images(self):\n                     15617, 6169, 2706, 8006, 14893, 3855, 10188, 15652, 6297, 1097, 12108, 15038, 311, 14998, 15165,\n                     897, 4044, 1762, 4676\n                 ],\n+                (\"xpu\", None): [\n+                    4484, 4015, 15750, 506, 3758, 11651, 8597, 5739, 4861, 971, 14985, 14834, 15438, 7548, 1820, 1465,\n+                    13529, 12761, 10503, 12761, 14303, 6155, 4015, 11766, 705, 15736, 14146, 10417, 1951, 7713, 14305,\n+                    15617, 6169, 2706, 8006, 14893, 3855, 10188, 15652, 6297, 1097, 12108, 15038, 311, 14998, 15165,\n+                    897, 4044, 1762, 4676\n+                ],\n             }\n         )\n         expected_tokens = torch.tensor(expected_tokens.get_expectation()).to(model.device)"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 10,
        "deletions": 4
    }
}