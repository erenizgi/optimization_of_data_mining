{
    "author": "Isotr0py",
    "message": "Fix config dtype parsing for Emu3 edge case (#40766)\n\n* fix emu3 config\n\nSigned-off-by: Isotr0py <mozf@mail2.sysu.edu.cn>\n\n* address comment\n\nSigned-off-by: Isotr0py <mozf@mail2.sysu.edu.cn>\n\n* add comments\n\nSigned-off-by: Isotr0py <mozf@mail2.sysu.edu.cn>\n\n---------\n\nSigned-off-by: Isotr0py <mozf@mail2.sysu.edu.cn>",
    "sha": "02f1d7c09141203acb7e8ff7628cd9e5e07c327d",
    "files": [
        {
            "sha": "0ed8a0399f4d68facb1b88633d80f120f22cf154",
            "filename": "src/transformers/configuration_utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/02f1d7c09141203acb7e8ff7628cd9e5e07c327d/src%2Ftransformers%2Fconfiguration_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/02f1d7c09141203acb7e8ff7628cd9e5e07c327d/src%2Ftransformers%2Fconfiguration_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fconfiguration_utils.py?ref=02f1d7c09141203acb7e8ff7628cd9e5e07c327d",
            "patch": "@@ -1058,7 +1058,9 @@ def dict_dtype_to_str(self, d: dict[str, Any]) -> None:\n         if d.get(\"dtype\") is not None:\n             if isinstance(d[\"dtype\"], dict):\n                 d[\"dtype\"] = {k: str(v).split(\".\")[-1] for k, v in d[\"dtype\"].items()}\n-            elif not isinstance(d[\"dtype\"], str):\n+            # models like Emu3 can have \"dtype\" as token in config's vocabulary map,\n+            # so we also exclude int type here to avoid error in this special case.\n+            elif not isinstance(d[\"dtype\"], (str, int)):\n                 d[\"dtype\"] = str(d[\"dtype\"]).split(\".\")[1]\n         for value in d.values():\n             if isinstance(value, dict):"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 3,
        "deletions": 1
    }
}