{
    "author": "ydshieh",
    "message": "Fix flaky `Gemma3nAudioFeatureExtractionTest::test_dither` (#40902)\n\n* fix\n\n* fix\n\n* fix\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "1aff033ec952135a62d971dbf2171b895f0f525d",
    "files": [
        {
            "sha": "30d2e1bb946867b1e4ab40448a32dd9aaf8f364b",
            "filename": "tests/models/gemma3n/test_feature_extraction_gemma3n.py",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/huggingface/transformers/blob/1aff033ec952135a62d971dbf2171b895f0f525d/tests%2Fmodels%2Fgemma3n%2Ftest_feature_extraction_gemma3n.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/1aff033ec952135a62d971dbf2171b895f0f525d/tests%2Fmodels%2Fgemma3n%2Ftest_feature_extraction_gemma3n.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fgemma3n%2Ftest_feature_extraction_gemma3n.py?ref=1aff033ec952135a62d971dbf2171b895f0f525d",
            "patch": "@@ -277,10 +277,12 @@ def test_dither(self):\n         diff = input_features_dither - input_features_no_dither\n \n         # features are not identical\n-        self.assertTrue(np.abs(diff).mean() > 1e-6)\n+        assert np.abs(diff).mean() > 1e-6\n         # features are not too different\n-        self.assertTrue(np.abs(diff).mean() <= 1e-4)\n-        self.assertTrue(np.abs(diff).max() <= 5e-3)\n+        # the heuristic value `7e-4` is obtained by running 50000 times (maximal value is around 3e-4).\n+        assert np.abs(diff).mean() < 7e-4\n+        # the heuristic value `8e-1` is obtained by running 50000 times (maximal value is around 5e-1).\n+        assert np.abs(diff).max() < 8e-1\n \n     @require_torch\n     def test_double_precision_pad(self):"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 5,
        "deletions": 3
    }
}