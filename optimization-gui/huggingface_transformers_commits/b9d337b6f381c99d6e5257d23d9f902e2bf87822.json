{
    "author": "ahadnagy",
    "message": "Add write token for uploading benchmark results to the Hub (#41047)\n\n* Separate write token for Hub upload\n\n* Address review comments\n\n* Address review comments",
    "sha": "b9d337b6f381c99d6e5257d23d9f902e2bf87822",
    "files": [
        {
            "sha": "dc078e67ea97fbf2bd1b82e05e23177a46abf48f",
            "filename": ".github/workflows/benchmark_v2.yml",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/huggingface/transformers/blob/b9d337b6f381c99d6e5257d23d9f902e2bf87822/.github%2Fworkflows%2Fbenchmark_v2.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/b9d337b6f381c99d6e5257d23d9f902e2bf87822/.github%2Fworkflows%2Fbenchmark_v2.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Fbenchmark_v2.yml?ref=b9d337b6f381c99d6e5257d23d9f902e2bf87822",
            "patch": "@@ -70,7 +70,8 @@ jobs:\n           python3 run_benchmarks.py \\\n           --commit-id '${{ inputs.commit_sha || github.sha }}' \\\n           --run-id '${{ inputs.run_id }}' \\\n-          --upload-to-hub '${{ inputs.benchmark_repo_id}}' \\\n+          --push-to-hub '${{ inputs.benchmark_repo_id}}' \\\n+          --token '${{ secrets.TRANSFORMERS_CI_RESULTS_UPLOAD_TOKEN }}' \\\n           --log-level INFO\n         env:\n           HF_TOKEN: ${{ secrets.HF_HUB_READ_TOKEN }}\n\\ No newline at end of file"
        },
        {
            "sha": "bcbb9cc71ef343b895f6d0341cdd0ad575b547bf",
            "filename": "benchmark_v2/README.md",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/huggingface/transformers/blob/b9d337b6f381c99d6e5257d23d9f902e2bf87822/benchmark_v2%2FREADME.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/b9d337b6f381c99d6e5257d23d9f902e2bf87822/benchmark_v2%2FREADME.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/benchmark_v2%2FREADME.md?ref=b9d337b6f381c99d6e5257d23d9f902e2bf87822",
            "patch": "@@ -27,10 +27,13 @@ You can automatically upload benchmark results to a HuggingFace Dataset for trac\n \n ```bash\n # Upload to a public dataset with auto-generated run ID\n-python run_benchmarks.py --upload-to-hf username/benchmark-results\n+python run_benchmarks.py --upload-to-hub username/benchmark-results\n \n # Upload with a custom run ID for easy identification\n-python run_benchmarks.py --upload-to-hf username/benchmark-results --run-id experiment_v1\n+python run_benchmarks.py --upload-to-hub username/benchmark-results --run-id experiment_v1\n+\n+# Upload with custom HuggingFace token (if not set in environment)\n+python run_benchmarks.py --upload-to-hub username/benchmark-results --token hf_your_token_here\n ```\n \n **Dataset Directory Structure:**\n@@ -51,6 +54,13 @@ dataset_name/\n     └── ...\n ```\n \n+**Authentication for Uploads:**\n+\n+For uploading results, you need a HuggingFace token with write permissions to the target dataset. You can provide the token in several ways (in order of precedence):\n+\n+1. Command line: `--token hf_your_token_here`\n+3. Environment variable: `HF_TOKEN`\n+\n ### Running Specific Benchmarks\n \n ```bash"
        },
        {
            "sha": "18e8a9a776544d8f7063f61fff33c789278f7cad",
            "filename": "benchmark_v2/run_benchmarks.py",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/b9d337b6f381c99d6e5257d23d9f902e2bf87822/benchmark_v2%2Frun_benchmarks.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/b9d337b6f381c99d6e5257d23d9f902e2bf87822/benchmark_v2%2Frun_benchmarks.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/benchmark_v2%2Frun_benchmarks.py?ref=b9d337b6f381c99d6e5257d23d9f902e2bf87822",
            "patch": "@@ -195,6 +195,7 @@ def upload_results_to_hf_dataset(\n     summary_file: str,\n     dataset_name: str,\n     run_id: Optional[str] = None,\n+    token: Optional[str] = None,\n     logger: Optional[logging.Logger] = None,\n ) -> Optional[str]:\n     \"\"\"\n@@ -205,6 +206,7 @@ def upload_results_to_hf_dataset(\n         summary_file: Path to the summary file\n         dataset_name: Name of the HuggingFace dataset to upload to\n         run_id: Unique run identifier (if None, will generate one)\n+        token: HuggingFace token for authentication (if None, will use environment variables)\n         logger: Logger instance\n     Returns:\n         The run_id used for the upload, None if upload failed\n@@ -237,9 +239,6 @@ def upload_results_to_hf_dataset(\n     logger.info(f\"Uploading benchmark results to dataset '{dataset_name}' at path '{repo_path}'\")\n \n     try:\n-        # Get the authentication token (prioritize specific token, fallback to HF_TOKEN)\n-        token = os.getenv(\"TRANSFORMERS_CI_RESULTS_UPLOAD_TOKEN\") or os.getenv(\"HF_TOKEN\")\n-\n         # Upload all files in the output directory\n         from pathlib import Path\n \n@@ -357,6 +356,10 @@ def main():\n         \"--run-id\", type=str, help=\"Custom run ID for organizing results (if not provided, will generate a unique ID)\"\n     )\n \n+    parser.add_argument(\n+        \"--token\", type=str, help=\"HuggingFace token for dataset uploads (if not provided, will use HF_TOKEN environment variable)\"\n+    )\n+\n     args = parser.parse_args()\n \n     # Setup logging\n@@ -440,6 +443,7 @@ def main():\n                 summary_file=summary_file,\n                 dataset_name=args.upload_to_hub,\n                 run_id=effective_run_id,\n+                token=args.token,\n                 logger=logger,\n             )\n             if upload_run_id:"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 21,
        "deletions": 6
    }
}