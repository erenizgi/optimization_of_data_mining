{
    "author": "ydshieh",
    "message": "Run `test_can_load_with_global_device_set` using a subprocess (#37553)\n\n* fix\n\n* fix\n\n* fix\n\n* Update tests/test_modeling_common.py\n\nCo-authored-by: Cyril Vallez <cyril.vallez@huggingface.co>\n\n* fix\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>\nCo-authored-by: Cyril Vallez <cyril.vallez@huggingface.co>",
    "sha": "5a6de703a729d89448bd8bb4e3e4d7426351e779",
    "files": [
        {
            "sha": "3ec6ba30bf51d2884a1938d16c875119b34d168a",
            "filename": "tests/test_modeling_common.py",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/5a6de703a729d89448bd8bb4e3e4d7426351e779/tests%2Ftest_modeling_common.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/5a6de703a729d89448bd8bb4e3e4d7426351e779/tests%2Ftest_modeling_common.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Ftest_modeling_common.py?ref=5a6de703a729d89448bd8bb4e3e4d7426351e779",
            "patch": "@@ -89,6 +89,7 @@\n     require_torch_multi_accelerator,\n     require_torch_multi_gpu,\n     require_torch_sdpa,\n+    run_test_using_subprocess,\n     set_config_for_less_flaky_test,\n     set_model_for_less_flaky_test,\n     set_model_tester_for_less_flaky_test,\n@@ -4550,6 +4551,9 @@ def test_can_load_with_device_context_manager(self):\n                 unique_devices, {device}, f\"All parameters should be on {device}, but found {unique_devices}.\"\n             )\n \n+    # Here we need to run with a subprocess as otherwise setting back the default device to the default value (\"cpu\")\n+    # may bring unwanted consequences on other tests. See PR #37553\n+    @run_test_using_subprocess\n     @require_torch_accelerator\n     def test_can_load_with_global_device_set(self):\n         config, _ = self.model_tester.prepare_config_and_inputs_for_common()"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 4,
        "deletions": 0
    }
}