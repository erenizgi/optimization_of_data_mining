{
    "author": "DonggeunYu",
    "message": "DeviceGuard added to use Deformable Attention more safely on multi-GPU (#32910)\n\n* Update modeling_deformable_detr.py\r\n\r\n* Update src/transformers/models/deformable_detr/modeling_deformable_detr.py\r\n\r\nCo-authored-by: amyeroberts <22614925+amyeroberts@users.noreply.github.com>\r\n\r\n* Update ms_deform_attn_cuda.cu\r\n\r\n* Update modeling_deformable_detr.py\r\n\r\n* Update modeling_deformable_detr.py\r\n\r\n* [empty] this is a empty commit\r\n\r\n---------\r\n\r\nCo-authored-by: amyeroberts <22614925+amyeroberts@users.noreply.github.com>",
    "sha": "1dbd9d3693a3c58c31415670dd1795e7cfbebcb2",
    "files": [
        {
            "sha": "0cd34f5df8b7dc917f5e4332d63c33d2da92d195",
            "filename": "src/transformers/kernels/deformable_detr/cuda/ms_deform_attn_cuda.cu",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/huggingface/transformers/blob/1dbd9d3693a3c58c31415670dd1795e7cfbebcb2/src%2Ftransformers%2Fkernels%2Fdeformable_detr%2Fcuda%2Fms_deform_attn_cuda.cu",
            "raw_url": "https://github.com/huggingface/transformers/raw/1dbd9d3693a3c58c31415670dd1795e7cfbebcb2/src%2Ftransformers%2Fkernels%2Fdeformable_detr%2Fcuda%2Fms_deform_attn_cuda.cu",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fkernels%2Fdeformable_detr%2Fcuda%2Fms_deform_attn_cuda.cu?ref=1dbd9d3693a3c58c31415670dd1795e7cfbebcb2",
            "patch": "@@ -28,6 +28,8 @@ at::Tensor ms_deform_attn_cuda_forward(\n     const at::Tensor &attn_weight,\n     const int im2col_step)\n {\n+    at::DeviceGuard guard(value.device());\n+\n     AT_ASSERTM(value.is_contiguous(), \"value tensor has to be contiguous\");\n     AT_ASSERTM(spatial_shapes.is_contiguous(), \"spatial_shapes tensor has to be contiguous\");\n     AT_ASSERTM(level_start_index.is_contiguous(), \"level_start_index tensor has to be contiguous\");\n@@ -92,6 +94,7 @@ std::vector<at::Tensor> ms_deform_attn_cuda_backward(\n     const at::Tensor &grad_output,\n     const int im2col_step)\n {\n+    at::DeviceGuard guard(value.device());\n \n     AT_ASSERTM(value.is_contiguous(), \"value tensor has to be contiguous\");\n     AT_ASSERTM(spatial_shapes.is_contiguous(), \"spatial_shapes tensor has to be contiguous\");"
        }
    ],
    "stats": {
        "total": 3,
        "additions": 3,
        "deletions": 0
    }
}