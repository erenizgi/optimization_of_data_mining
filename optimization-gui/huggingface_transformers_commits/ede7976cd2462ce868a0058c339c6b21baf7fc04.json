{
    "author": "i3hz",
    "message": "Fixed incorrect model_type for qwen2vl and qwen2.5vl when config is saved and loaded again (#41758)\n\n* fixed incorrect model_type for qwen2vl and qwen2.5vl\n\n* added tests",
    "sha": "ede7976cd2462ce868a0058c339c6b21baf7fc04",
    "files": [
        {
            "sha": "41ae4195f63d41949c4e5518af881d592b2977f1",
            "filename": "src/transformers/models/qwen2_5_vl/configuration_qwen2_5_vl.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/ede7976cd2462ce868a0058c339c6b21baf7fc04/src%2Ftransformers%2Fmodels%2Fqwen2_5_vl%2Fconfiguration_qwen2_5_vl.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/ede7976cd2462ce868a0058c339c6b21baf7fc04/src%2Ftransformers%2Fmodels%2Fqwen2_5_vl%2Fconfiguration_qwen2_5_vl.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen2_5_vl%2Fconfiguration_qwen2_5_vl.py?ref=ede7976cd2462ce868a0058c339c6b21baf7fc04",
            "patch": "@@ -313,6 +313,8 @@ def __setattr__(self, key, value):\n \n     def __getattribute__(self, key):\n         if \"text_config\" in super().__getattribute__(\"__dict__\") and key not in [\n+            \"_name_or_path\",\n+            \"model_type\",\n             \"dtype\",\n             \"_attn_implementation_internal\",\n         ]:"
        },
        {
            "sha": "02eee9de1ddbdd0bee79fe2d7cda6e39063448f7",
            "filename": "src/transformers/models/qwen2_vl/configuration_qwen2_vl.py",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/ede7976cd2462ce868a0058c339c6b21baf7fc04/src%2Ftransformers%2Fmodels%2Fqwen2_vl%2Fconfiguration_qwen2_vl.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/ede7976cd2462ce868a0058c339c6b21baf7fc04/src%2Ftransformers%2Fmodels%2Fqwen2_vl%2Fconfiguration_qwen2_vl.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen2_vl%2Fconfiguration_qwen2_vl.py?ref=ede7976cd2462ce868a0058c339c6b21baf7fc04",
            "patch": "@@ -301,6 +301,8 @@ def __setattr__(self, key, value):\n \n     def __getattribute__(self, key):\n         if \"text_config\" in super().__getattribute__(\"__dict__\") and key not in [\n+            \"_name_or_path\",\n+            \"model_type\",\n             \"dtype\",\n             \"_attn_implementation_internal\",\n         ]:"
        },
        {
            "sha": "951000985a04a3345522a33461eab548fb1ee84a",
            "filename": "tests/models/qwen2_5_vl/test_modeling_qwen2_5_vl.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/huggingface/transformers/blob/ede7976cd2462ce868a0058c339c6b21baf7fc04/tests%2Fmodels%2Fqwen2_5_vl%2Ftest_modeling_qwen2_5_vl.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/ede7976cd2462ce868a0058c339c6b21baf7fc04/tests%2Fmodels%2Fqwen2_5_vl%2Ftest_modeling_qwen2_5_vl.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fqwen2_5_vl%2Ftest_modeling_qwen2_5_vl.py?ref=ede7976cd2462ce868a0058c339c6b21baf7fc04",
            "patch": "@@ -235,6 +235,17 @@ def test_text_config(self):\n         self.assertEqual(base_config.patch_size, 8)\n         self.assertNotEqual(base_config.vision_config.patch_size, 8)\n \n+        # Test for making sure config save and load preserves correct model type\n+        config, _ = self.model_tester.prepare_config_and_inputs_for_common()\n+\n+        self.assertEqual(config.model_type, \"qwen2_5_vl\")\n+\n+        with tempfile.TemporaryDirectory() as tmp_dir:\n+            config.save_pretrained(tmp_dir)\n+\n+            loaded_config = Qwen2_5_VLConfig.from_pretrained(tmp_dir)\n+            self.assertEqual(loaded_config.model_type, \"qwen2_5_vl\")\n+\n     def test_mismatching_num_image_tokens(self):\n         \"\"\"\n         Tests that VLMs through an error with explicit message saying what is wrong"
        },
        {
            "sha": "a309b6ecdb1fa53721bc99edd6476742f82cf2ca",
            "filename": "tests/models/qwen2_vl/test_modeling_qwen2_vl.py",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/huggingface/transformers/blob/ede7976cd2462ce868a0058c339c6b21baf7fc04/tests%2Fmodels%2Fqwen2_vl%2Ftest_modeling_qwen2_vl.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/ede7976cd2462ce868a0058c339c6b21baf7fc04/tests%2Fmodels%2Fqwen2_vl%2Ftest_modeling_qwen2_vl.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fqwen2_vl%2Ftest_modeling_qwen2_vl.py?ref=ede7976cd2462ce868a0058c339c6b21baf7fc04",
            "patch": "@@ -215,6 +215,17 @@ def test_text_config(self):\n         self.assertEqual(base_config.patch_size, 8)\n         self.assertNotEqual(base_config.vision_config.patch_size, 8)\n \n+        # Test for making sure config save and load preserves correct model type\n+        config, _ = self.model_tester.prepare_config_and_inputs_for_common()\n+\n+        self.assertEqual(config.model_type, \"qwen2_vl\")\n+\n+        with tempfile.TemporaryDirectory() as tmp_dir:\n+            config.save_pretrained(tmp_dir)\n+\n+            loaded_config = Qwen2VLConfig.from_pretrained(tmp_dir)\n+            self.assertEqual(loaded_config.model_type, \"qwen2_vl\")\n+\n     def test_mismatching_num_image_tokens(self):\n         \"\"\"\n         Tests that VLMs through an error with explicit message saying what is wrong"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 26,
        "deletions": 0
    }
}