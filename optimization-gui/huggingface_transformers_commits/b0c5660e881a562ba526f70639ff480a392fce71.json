{
    "author": "gante",
    "message": "Config: lower `save_pretrained` exception to warning (#33906)\n\n* lower to warning\r\n\r\n* msg\r\n\r\n* make fixup\r\n\r\n* rm extra comma",
    "sha": "b0c5660e881a562ba526f70639ff480a392fce71",
    "files": [
        {
            "sha": "8d8784be39117be46c94b23316f6bbc590a6a4c9",
            "filename": "src/transformers/configuration_utils.py",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/huggingface/transformers/blob/b0c5660e881a562ba526f70639ff480a392fce71/src%2Ftransformers%2Fconfiguration_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/b0c5660e881a562ba526f70639ff480a392fce71/src%2Ftransformers%2Fconfiguration_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fconfiguration_utils.py?ref=b0c5660e881a562ba526f70639ff480a392fce71",
            "patch": "@@ -380,11 +380,14 @@ def save_pretrained(self, save_directory: Union[str, os.PathLike], push_to_hub:\n \n         non_default_generation_parameters = self._get_non_default_generation_parameters()\n         if len(non_default_generation_parameters) > 0:\n-            raise ValueError(\n+            # TODO (joao): this should be an exception if the user has modified the loaded config. See #33886\n+            warnings.warn(\n                 \"Some non-default generation parameters are set in the model config. These should go into either a) \"\n                 \"`model.generation_config` (as opposed to `model.config`); OR b) a GenerationConfig file \"\n-                \"(https://huggingface.co/docs/transformers/generation_strategies#save-a-custom-decoding-strategy-with-your-model) \"\n-                f\"\\nNon-default generation parameters: {str(non_default_generation_parameters)}\"\n+                \"(https://huggingface.co/docs/transformers/generation_strategies#save-a-custom-decoding-strategy-with-your-model).\"\n+                \"This warning will become an exception in the future.\"\n+                f\"\\nNon-default generation parameters: {str(non_default_generation_parameters)}\",\n+                UserWarning,\n             )\n \n         os.makedirs(save_directory, exist_ok=True)"
        },
        {
            "sha": "d2701bf35e66036befc1bfea0ee8a9af2e23461c",
            "filename": "tests/utils/test_configuration_utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/huggingface/transformers/blob/b0c5660e881a562ba526f70639ff480a392fce71/tests%2Futils%2Ftest_configuration_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/b0c5660e881a562ba526f70639ff480a392fce71/tests%2Futils%2Ftest_configuration_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Futils%2Ftest_configuration_utils.py?ref=b0c5660e881a562ba526f70639ff480a392fce71",
            "patch": "@@ -313,11 +313,12 @@ def test_repo_versioning_before(self):\n         old_configuration = old_transformers.models.auto.AutoConfig.from_pretrained(repo)\n         self.assertEqual(old_configuration.hidden_size, 768)\n \n-    def test_saving_config_with_custom_generation_kwargs_raises_exception(self):\n+    def test_saving_config_with_custom_generation_kwargs_raises_warning(self):\n         config = BertConfig(min_length=3)  # `min_length = 3` is a non-default generation kwarg\n         with tempfile.TemporaryDirectory() as tmp_dir:\n-            with self.assertRaises(ValueError):\n+            with self.assertWarns(UserWarning) as cm:\n                 config.save_pretrained(tmp_dir)\n+            self.assertIn(\"min_length\", str(cm.warning))\n \n     def test_get_non_default_generation_parameters(self):\n         config = BertConfig()"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 9,
        "deletions": 5
    }
}