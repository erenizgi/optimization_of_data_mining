{
    "author": "lukepayyapilli",
    "message": "Fix InvalidVersion error when flash_attn version cannot be determined (#43004)\n\nWhen flash_attn_3 is installed without flash_attn (v2), the flash_attn\nmodule may be importable but its version cannot be determined, resulting\nin version.parse(\"N/A\") which raises InvalidVersion.\n\nWrap version parsing in try/except, consistent with is_torch_available().\n\nFixes #42999",
    "sha": "82c60184bf07db5659aa1d3bebd0690d15642721",
    "files": [
        {
            "sha": "754574a2dc11d8dbf92c3ec9fb8cbf375ab00b73",
            "filename": "src/transformers/utils/import_utils.py",
            "status": "modified",
            "additions": 17,
            "deletions": 9,
            "changes": 26,
            "blob_url": "https://github.com/huggingface/transformers/blob/82c60184bf07db5659aa1d3bebd0690d15642721/src%2Ftransformers%2Futils%2Fimport_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/82c60184bf07db5659aa1d3bebd0690d15642721/src%2Ftransformers%2Futils%2Fimport_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2Fimport_utils.py?ref=82c60184bf07db5659aa1d3bebd0690d15642721",
            "patch": "@@ -890,14 +890,17 @@ def is_flash_attn_2_available() -> bool:\n \n     import torch\n \n-    if torch.version.cuda:\n-        return version.parse(flash_attn_version) >= version.parse(\"2.1.0\")\n-    elif torch.version.hip:\n-        # TODO: Bump the requirement to 2.1.0 once released in https://github.com/ROCmSoftwarePlatform/flash-attention\n-        return version.parse(flash_attn_version) >= version.parse(\"2.0.4\")\n-    elif is_torch_mlu_available():\n-        return version.parse(flash_attn_version) >= version.parse(\"2.3.3\")\n-    else:\n+    try:\n+        if torch.version.cuda:\n+            return version.parse(flash_attn_version) >= version.parse(\"2.1.0\")\n+        elif torch.version.hip:\n+            # TODO: Bump the requirement to 2.1.0 once released in https://github.com/ROCmSoftwarePlatform/flash-attention\n+            return version.parse(flash_attn_version) >= version.parse(\"2.0.4\")\n+        elif is_torch_mlu_available():\n+            return version.parse(flash_attn_version) >= version.parse(\"2.3.3\")\n+        else:\n+            return False\n+    except packaging.version.InvalidVersion:\n         return False\n \n \n@@ -915,7 +918,12 @@ def is_flash_attn_greater_or_equal_2_10() -> bool:\n @lru_cache\n def is_flash_attn_greater_or_equal(library_version: str) -> bool:\n     is_available, flash_attn_version = _is_package_available(\"flash_attn\", return_version=True)\n-    return is_available and version.parse(flash_attn_version) >= version.parse(library_version)\n+    if not is_available:\n+        return False\n+    try:\n+        return version.parse(flash_attn_version) >= version.parse(library_version)\n+    except packaging.version.InvalidVersion:\n+        return False\n \n \n @lru_cache"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 17,
        "deletions": 9
    }
}