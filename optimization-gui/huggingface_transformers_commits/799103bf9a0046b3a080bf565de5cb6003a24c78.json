{
    "author": "ydshieh",
    "message": "Delete previous comments of `View the CircleCI Test Summary` (#42725)\n\nfix\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "799103bf9a0046b3a080bf565de5cb6003a24c78",
    "files": [
        {
            "sha": "76cc19f2b2ce792503e9ad393c1b47ba2861a8c3",
            "filename": ".github/workflows/circleci-failure-summary-comment.yml",
            "status": "modified",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/huggingface/transformers/blob/799103bf9a0046b3a080bf565de5cb6003a24c78/.github%2Fworkflows%2Fcircleci-failure-summary-comment.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/799103bf9a0046b3a080bf565de5cb6003a24c78/.github%2Fworkflows%2Fcircleci-failure-summary-comment.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Fcircleci-failure-summary-comment.yml?ref=799103bf9a0046b3a080bf565de5cb6003a24c78",
            "patch": "@@ -173,6 +173,40 @@ jobs:\n           print(f\"Uploaded {folder_path} to {dataset_id}\")\n           EOF\n \n+      - name: Delete existing CircleCI summary comments\n+        if: steps.circleci.outputs.artifact_found == 'true'\n+        env:\n+          PR_NUMBER: ${{ github.event.pull_request.number }}\n+        uses: actions/github-script@v7\n+        with:\n+          script: |\n+            const PR_NUMBER = parseInt(process.env.PR_NUMBER, 10);\n+            \n+            // Get all comments on the PR\n+            const { data: comments } = await github.rest.issues.listComments({\n+              owner: context.repo.owner,\n+              repo: context.repo.repo,\n+              issue_number: PR_NUMBER\n+            });\n+            \n+            // Find existing bot comments that start with \"View the CircleCI Test Summary for this PR:\"\n+            const existingComments = comments.filter(comment => \n+              comment.user.login === 'github-actions[bot]' && \n+              comment.body.startsWith('View the CircleCI Test Summary for this PR:')\n+            );\n+\n+            // Delete all matching comments\n+            for (const comment of existingComments) {\n+              console.log(`Deleting comment #${comment.id}`);\n+              await github.rest.issues.deleteComment({\n+                owner: context.repo.owner,\n+                repo: context.repo.repo,\n+                comment_id: comment.id\n+              });\n+            }\n+            \n+            console.log(`Deleted ${existingComments.length} old CircleCI summary comment(s)`);\n+\n       - name: Post comment with helper link\n         if: steps.circleci.outputs.artifact_found == 'true'\n         env:"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 34,
        "deletions": 0
    }
}