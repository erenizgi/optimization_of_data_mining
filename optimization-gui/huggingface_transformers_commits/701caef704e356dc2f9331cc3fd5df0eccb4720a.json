{
    "author": "Rocketknight1",
    "message": "Stop TF weight rename reDOS (#38325)\n\n* let's try a non-regex solution\n\n* make fixup\n\n* Slight adjustment\n\n* Let's just use the original code with a check\n\n* slight tweak to conditional\n\n* slight tweak to conditional",
    "sha": "701caef704e356dc2f9331cc3fd5df0eccb4720a",
    "files": [
        {
            "sha": "5b9f38e1bc25e561b5d90af9db66d58af3b90520",
            "filename": "src/transformers/modeling_tf_pytorch_utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/huggingface/transformers/blob/701caef704e356dc2f9331cc3fd5df0eccb4720a/src%2Ftransformers%2Fmodeling_tf_pytorch_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/701caef704e356dc2f9331cc3fd5df0eccb4720a/src%2Ftransformers%2Fmodeling_tf_pytorch_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodeling_tf_pytorch_utils.py?ref=701caef704e356dc2f9331cc3fd5df0eccb4720a",
            "patch": "@@ -78,6 +78,9 @@ def convert_tf_weight_name_to_pt_weight_name(\n         tf_name = tf_name[len(name_scope) :]\n         tf_name = tf_name.lstrip(\"/\")\n     tf_name = tf_name.replace(\":0\", \"\")  # device ids\n+    if (len(tf_name) > 2048 and \"___\" in tf_name) or tf_name.count(\"___\") > 10:\n+        # ReDOS check\n+        raise ValueError(\"TF variable name is too long or contains too many ___ separators: \" + tf_name)\n     tf_name = re.sub(\n         r\"/[^/]*___([^/]*)/\", r\"/\\1/\", tf_name\n     )  # '$1___$2' is replaced by $2 (can be used to duplicate or remove layers in TF2.0 vs PyTorch)"
        }
    ],
    "stats": {
        "total": 3,
        "additions": 3,
        "deletions": 0
    }
}