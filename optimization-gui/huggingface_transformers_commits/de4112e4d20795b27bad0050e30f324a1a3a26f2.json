{
    "author": "Rocketknight1",
    "message": "Add a section on writing tool templates to the chat template docs (#33924)\n\n* Add a section on writing tool templates to the chat template docs\r\n\r\n* Small cleanups",
    "sha": "de4112e4d20795b27bad0050e30f324a1a3a26f2",
    "files": [
        {
            "sha": "de3d056c916f5f9b3cfda14e67e012ef4f8258f0",
            "filename": "docs/source/en/chat_templating.md",
            "status": "modified",
            "additions": 126,
            "deletions": 1,
            "changes": 127,
            "blob_url": "https://github.com/huggingface/transformers/blob/de4112e4d20795b27bad0050e30f324a1a3a26f2/docs%2Fsource%2Fen%2Fchat_templating.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/de4112e4d20795b27bad0050e30f324a1a3a26f2/docs%2Fsource%2Fen%2Fchat_templating.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fchat_templating.md?ref=de4112e4d20795b27bad0050e30f324a1a3a26f2",
            "patch": "@@ -962,4 +962,129 @@ tokenizer.chat_template = open(\"template.jinja\").read()\n \n As an added bonus, when you write a long, multi-line template in a separate file, line numbers in that file will\n exactly correspond to line numbers in template parsing or execution errors. This will make it much easier to\n-identify the source of issues.\n\\ No newline at end of file\n+identify the source of issues.\n+\n+### Writing templates for tools\n+\n+Although chat templates do not enforce a specific API for tools (or for anything, really), we recommend \n+template authors try to stick to a standard API where possible. The whole point of chat templates is to allow code\n+to be transferable across models, so deviating from the standard tools API means users will have to write\n+custom code to use tools with your model. Sometimes it's unavoidable, but often with clever templating you can\n+make the standard API work!\n+\n+Below, we'll list the elements of the standard API, and give tips on writing templates that will work well with it.\n+\n+#### Tool definitions\n+\n+Your template should expect that the variable `tools` will either be null (if no tools are passed), or is a list \n+of JSON schema dicts. Our chat template methods allow users to pass tools as either JSON schema or Python functions, but when\n+functions are passed, we automatically generate JSON schema and pass that to your template. As a result, the \n+`tools` variable that your template receives will always be a list of JSON schema. Here is\n+a sample tool JSON schema:\n+\n+```json\n+{\n+  \"type\": \"function\", \n+  \"function\": {\n+    \"name\": \"multiply\", \n+    \"description\": \"A function that multiplies two numbers\", \n+    \"parameters\": {\n+      \"type\": \"object\", \n+      \"properties\": {\n+        \"a\": {\n+          \"type\": \"number\", \n+          \"description\": \"The first number to multiply\"\n+        }, \n+        \"b\": {\n+          \"type\": \"number\",\n+          \"description\": \"The second number to multiply\"\n+        }\n+      }, \n+      \"required\": [\"a\", \"b\"]\n+    }\n+  }\n+}\n+```\n+\n+And here is some example code for handling tools in your chat template. Remember, this is just an example for a\n+specific format - your model will probably need different formatting!\n+\n+```text\n+{%- if tools %}\n+    {%- for tool in tools %}\n+        {{- '<tool>' + tool['function']['name'] + '\\n' }}\n+        {%- for argument in tool['function']['parameters']['properties'] %}\n+            {{- argument + ': ' + tool['function']['parameters']['properties'][argument]['description'] + '\\n' }}\n+        {%- endfor %}\n+        {{- '\\n</tool>' }}\n+    {%- endif %}\n+{%- endif %}\n+```\n+\n+The specific tokens and tool descriptions your template renders should of course be chosen to match the ones your model\n+was trained with. There is no requirement that your **model** understands JSON schema input, only that your template can translate\n+JSON schema into your model's format. For example, [Command-R](https://huggingface.co/CohereForAI/c4ai-command-r-plus-08-2024) \n+was trained with tools defined using Python function headers, but the Command-R tool template accepts JSON schema, \n+converts types internally and renders the input tools as Python headers. You can do a lot with templates!\n+\n+#### Tool calls\n+\n+Tool calls, if present, will be a list attached to a message with the \"assistant\" role. Note that `tool_calls` is \n+always a list, even though most tool-calling models only support single tool calls at a time, which means\n+the list will usually only have a single element. Here is a sample message dict containing a tool call:\n+\n+```json\n+{\n+  \"role\": \"assistant\",\n+  \"tool_calls\": [\n+    {\n+      \"type\": \"function\",\n+      \"function\": {\n+        \"name\": \"multiply\",\n+        \"arguments\": {\n+          \"a\": 5,\n+          \"b\": 6\n+        }\n+      }\n+    }\n+  ]\n+}\n+```\n+\n+And a common pattern for handling them would be something like this:\n+\n+```text\n+{%- if message['role'] == 'assistant' and 'tool_calls' in message %}\n+    {%- for tool_call in message['tool_calls'] %}\n+            {{- '<tool_call>' + tool_call['function']['name'] + '\\n' + tool_call['function']['arguments']|tojson + '\\n</tool_call>' }}\n+        {%- endif %}\n+    {%- endfor %}\n+{%- endif %}\n+```\n+\n+Again, you should render the tool call with the formatting and special tokens that your model expects.\n+\n+#### Tool responses\n+\n+Tool responses have a simple format: They are a message dict with the \"tool\" role, a \"name\" key giving the name\n+of the called function, and a \"content\" key containing the result of the tool call. Here is a sample tool response:\n+\n+```json\n+{\n+  \"role\": \"tool\",\n+  \"name\": \"multiply\",\n+  \"content\": \"30\"\n+}\n+```\n+\n+You don't need to use all of the keys in the tool response. For example, if your model doesn't expect the function\n+name to be included in the tool response, then rendering it can be as simple as:\n+\n+```text\n+{%- if message['role'] == 'tool' %}\n+    {{- \"<tool_result>\" + message['content'] + \"</tool_result>\" }}\n+{%- endif %}\n+```\n+\n+Again, remember that the actual formatting and special tokens are model-specific - you should take a lot of care\n+to ensure that tokens, whitespace and everything else exactly match the format your model was trained with!\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 127,
        "additions": 126,
        "deletions": 1
    }
}