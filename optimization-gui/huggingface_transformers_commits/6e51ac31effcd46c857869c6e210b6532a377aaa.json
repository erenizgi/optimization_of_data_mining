{
    "author": "harshaljanjani",
    "message": "[timm_wrapper] better handling of \"Unknown model\" exception in timm (#40951)\n\n* fix(timm): Add exception handling for unknown Gemma3n model\n\n* nit: Letâ€™s cater to this specific issue\n\n* nit: Simplify error handling",
    "sha": "6e51ac31effcd46c857869c6e210b6532a377aaa",
    "files": [
        {
            "sha": "cfc3c1c104d33d6322b361aa08182e88c2632149",
            "filename": "src/transformers/models/timm_wrapper/modeling_timm_wrapper.py",
            "status": "modified",
            "additions": 25,
            "deletions": 3,
            "changes": 28,
            "blob_url": "https://github.com/huggingface/transformers/blob/6e51ac31effcd46c857869c6e210b6532a377aaa/src%2Ftransformers%2Fmodels%2Ftimm_wrapper%2Fmodeling_timm_wrapper.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/6e51ac31effcd46c857869c6e210b6532a377aaa/src%2Ftransformers%2Fmodels%2Ftimm_wrapper%2Fmodeling_timm_wrapper.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Ftimm_wrapper%2Fmodeling_timm_wrapper.py?ref=6e51ac31effcd46c857869c6e210b6532a377aaa",
            "patch": "@@ -55,6 +55,28 @@ class TimmWrapperModelOutput(ModelOutput):\n     attentions: Optional[tuple[torch.FloatTensor, ...]] = None\n \n \n+def _create_timm_model_with_error_handling(config: \"TimmWrapperConfig\", **model_kwargs):\n+    \"\"\"\n+    Creates a timm model and provides a clear error message if the model is not found,\n+    suggesting a library update.\n+    \"\"\"\n+    try:\n+        model = timm.create_model(\n+            config.architecture,\n+            pretrained=False,\n+            **model_kwargs,\n+        )\n+        return model\n+    except RuntimeError as e:\n+        if \"Unknown model\" in str(e):\n+            # A good general check for unknown models.\n+            raise ImportError(\n+                f\"The model architecture '{config.architecture}' is not supported in your version of timm ({timm.__version__}). \"\n+                \"Please upgrade timm to a more recent version with `pip install -U timm`.\"\n+            ) from e\n+        raise e\n+\n+\n @auto_docstring\n class TimmWrapperPreTrainedModel(PreTrainedModel):\n     main_input_name = \"pixel_values\"\n@@ -138,7 +160,7 @@ def __init__(self, config: TimmWrapperConfig):\n         super().__init__(config)\n         # using num_classes=0 to avoid creating classification head\n         extra_init_kwargs = config.model_args or {}\n-        self.timm_model = timm.create_model(config.architecture, pretrained=False, num_classes=0, **extra_init_kwargs)\n+        self.timm_model = _create_timm_model_with_error_handling(config, num_classes=0, **extra_init_kwargs)\n         self.post_init()\n \n     @auto_docstring\n@@ -254,8 +276,8 @@ def __init__(self, config: TimmWrapperConfig):\n             )\n \n         extra_init_kwargs = config.model_args or {}\n-        self.timm_model = timm.create_model(\n-            config.architecture, pretrained=False, num_classes=config.num_labels, **extra_init_kwargs\n+        self.timm_model = _create_timm_model_with_error_handling(\n+            config, num_classes=config.num_labels, **extra_init_kwargs\n         )\n         self.num_labels = config.num_labels\n         self.post_init()"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 25,
        "deletions": 3
    }
}