{
    "author": "Wauplin",
    "message": "[cleanup] Don't use Repository in create_dummy_models.py script (#42380)\n\nDon't use Repository in create_dummy_models.py script",
    "sha": "7de1edf64e9675b1e62a31a8d7ac56ac36a0749f",
    "files": [
        {
            "sha": "81c74b0a9523d398d791e0a8f0022db32a3a0963",
            "filename": "utils/create_dummy_models.py",
            "status": "modified",
            "additions": 14,
            "deletions": 25,
            "changes": 39,
            "blob_url": "https://github.com/huggingface/transformers/blob/7de1edf64e9675b1e62a31a8d7ac56ac36a0749f/utils%2Fcreate_dummy_models.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/7de1edf64e9675b1e62a31a8d7ac56ac36a0749f/utils%2Fcreate_dummy_models.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Fcreate_dummy_models.py?ref=7de1edf64e9675b1e62a31a8d7ac56ac36a0749f",
            "patch": "@@ -28,7 +28,7 @@\n from check_config_docstrings import get_checkpoint_from_config_class\n from datasets import load_dataset\n from get_test_info import get_model_to_tester_mapping, get_tester_classes_for_model\n-from huggingface_hub import Repository, create_repo, hf_api, upload_folder  # TODO: remove Repository\n+from huggingface_hub import create_repo, hf_api, upload_folder\n \n from transformers import (\n     CONFIG_MAPPING,\n@@ -805,30 +805,19 @@ def upload_model(model_dir, organization, token):\n     if error is not None:\n         raise error\n \n-    with tempfile.TemporaryDirectory() as tmpdir:\n-        repo = Repository(local_dir=tmpdir, clone_from=repo_id, token=token)\n-        repo.git_pull()\n-        shutil.copytree(model_dir, tmpdir, dirs_exist_ok=True)\n-\n-        if repo_exist:\n-            # Open a PR on the existing Hub repo.\n-            hub_pr_url = upload_folder(\n-                folder_path=model_dir,\n-                repo_id=repo_id,\n-                repo_type=\"model\",\n-                commit_message=f\"Update tiny models for {arch_name}\",\n-                commit_description=f\"Upload tiny models for {arch_name}\",\n-                create_pr=True,\n-                token=token,\n-            )\n-            logger.warning(f\"PR open in {hub_pr_url}.\")\n-            # TODO: We need this information?\n-        else:\n-            # Push to Hub repo directly\n-            repo.git_add(auto_lfs_track=True)\n-            repo.git_commit(f\"Upload tiny models for {arch_name}\")\n-            repo.git_push(blocking=True)  # this prints a progress bar with the upload\n-            logger.warning(f\"Tiny models {arch_name} pushed to {repo_id}.\")\n+    create_pr = repo_exist  # Open a PR on existing repo, otherwise push directly\n+    commit = upload_folder(\n+        folder_path=model_dir,\n+        repo_id=repo_id,\n+        repo_type=\"model\",\n+        commit_message=f\"Update tiny models for {arch_name}\",\n+        commit_description=f\"Upload tiny models for {arch_name}\",\n+        create_pr=create_pr,\n+        token=token,\n+    )\n+\n+    msg = f\"PR open in {commit.pr_url}.\" if create_pr else f\"Tiny models {arch_name} pushed to {repo_id}.\"\n+    logger.warning(msg)\n \n \n def build_composite_models(config_class, output_dir):"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 14,
        "deletions": 25
    }
}