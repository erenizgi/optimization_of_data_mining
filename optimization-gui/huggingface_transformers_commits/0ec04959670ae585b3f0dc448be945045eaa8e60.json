{
    "author": "BakerBunker",
    "message": "Fix `embeds_to_talker` device in Qwen2.5-Omni (#37739)\n\nFix `embeds_to_talker` device\n\nCo-authored-by: lvyuanjun.lyj <lvyuanjun.lyj@alibaba-inc.com>",
    "sha": "0ec04959670ae585b3f0dc448be945045eaa8e60",
    "files": [
        {
            "sha": "18b23b3949f2495aaca45efb25564ba51d122c36",
            "filename": "src/transformers/models/qwen2_5_omni/modeling_qwen2_5_omni.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/0ec04959670ae585b3f0dc448be945045eaa8e60/src%2Ftransformers%2Fmodels%2Fqwen2_5_omni%2Fmodeling_qwen2_5_omni.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0ec04959670ae585b3f0dc448be945045eaa8e60/src%2Ftransformers%2Fmodels%2Fqwen2_5_omni%2Fmodeling_qwen2_5_omni.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen2_5_omni%2Fmodeling_qwen2_5_omni.py?ref=0ec04959670ae585b3f0dc448be945045eaa8e60",
            "patch": "@@ -4560,7 +4560,7 @@ def generate(\n             return thinker_result\n \n         # 2. Generate speech tokens from talker module\n-        embeds_to_talker = thinker_result.hidden_states[0][0].clone()\n+        embeds_to_talker = thinker_result.hidden_states[0][0].clone().to(self.talker.device)\n         if thinker_kwargs.get(\"input_features\", None) is not None:\n             audio_ids_mask = input_ids == self.config.thinker_config.audio_token_index\n             audio_mask = audio_ids_mask.unsqueeze(-1).expand_as(embeds_to_talker).to(embeds_to_talker.device)"
        },
        {
            "sha": "294a72c6b6cc06b3d594cb04c67944677e6cba54",
            "filename": "src/transformers/models/qwen2_5_omni/modular_qwen2_5_omni.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/0ec04959670ae585b3f0dc448be945045eaa8e60/src%2Ftransformers%2Fmodels%2Fqwen2_5_omni%2Fmodular_qwen2_5_omni.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/0ec04959670ae585b3f0dc448be945045eaa8e60/src%2Ftransformers%2Fmodels%2Fqwen2_5_omni%2Fmodular_qwen2_5_omni.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen2_5_omni%2Fmodular_qwen2_5_omni.py?ref=0ec04959670ae585b3f0dc448be945045eaa8e60",
            "patch": "@@ -4243,7 +4243,7 @@ def generate(\n             return thinker_result\n \n         # 2. Generate speech tokens from talker module\n-        embeds_to_talker = thinker_result.hidden_states[0][0].clone()\n+        embeds_to_talker = thinker_result.hidden_states[0][0].clone().to(self.talker.device)\n         if thinker_kwargs.get(\"input_features\", None) is not None:\n             audio_ids_mask = input_ids == self.config.thinker_config.audio_token_index\n             audio_mask = audio_ids_mask.unsqueeze(-1).expand_as(embeds_to_talker).to(embeds_to_talker.device)"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 2,
        "deletions": 2
    }
}