{
    "author": "Xqle",
    "message": "Fix return metadata checking logic (#42108)\n\nfix return_metadata_checking_logic",
    "sha": "f5630f9b1afb01db38219e574e641d455edcab4e",
    "files": [
        {
            "sha": "18efa2524425fe1695ce621ca77d64bbd3afff88",
            "filename": "src/transformers/models/glm4v/modular_glm4v.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fglm4v%2Fmodular_glm4v.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fglm4v%2Fmodular_glm4v.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fglm4v%2Fmodular_glm4v.py?ref=f5630f9b1afb01db38219e574e641d455edcab4e",
            "patch": "@@ -1605,7 +1605,7 @@ def __call__(\n         if videos is not None:\n             videos_inputs = self.video_processor(videos=videos, **output_kwargs[\"videos_kwargs\"])\n             # If user has not requested video metadata, pop it\n-            if \"return_metadata\" not in kwargs:\n+            if not kwargs.get(\"return_metadata\"):\n                 video_metadata = videos_inputs.pop(\"video_metadata\")\n             else:\n                 video_metadata = videos_inputs[\"video_metadata\"]"
        },
        {
            "sha": "80b151566e5a6f9ceac69826c07802db3fc6fd94",
            "filename": "src/transformers/models/glm4v/processing_glm4v.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fglm4v%2Fprocessing_glm4v.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fglm4v%2Fprocessing_glm4v.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fglm4v%2Fprocessing_glm4v.py?ref=f5630f9b1afb01db38219e574e641d455edcab4e",
            "patch": "@@ -129,7 +129,7 @@ def __call__(\n         if videos is not None:\n             videos_inputs = self.video_processor(videos=videos, **output_kwargs[\"videos_kwargs\"])\n             # If user has not requested video metadata, pop it\n-            if \"return_metadata\" not in kwargs:\n+            if not kwargs.get(\"return_metadata\"):\n                 video_metadata = videos_inputs.pop(\"video_metadata\")\n             else:\n                 video_metadata = videos_inputs[\"video_metadata\"]"
        },
        {
            "sha": "77eadc012b131ee1c13a819e6d961f58ee932cf3",
            "filename": "src/transformers/models/qwen3_vl/modular_qwen3_vl.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fmodular_qwen3_vl.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fmodular_qwen3_vl.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fmodular_qwen3_vl.py?ref=f5630f9b1afb01db38219e574e641d455edcab4e",
            "patch": "@@ -1346,7 +1346,7 @@ def __call__(\n             videos_inputs = self.video_processor(videos=videos, **output_kwargs[\"videos_kwargs\"])\n             video_grid_thw = videos_inputs[\"video_grid_thw\"]\n             # If user has not requested video metadata, pop it\n-            if \"return_metadata\" not in kwargs:\n+            if not kwargs.get(\"return_metadata\"):\n                 video_metadata = videos_inputs.pop(\"video_metadata\")\n             else:\n                 video_metadata = videos_inputs[\"video_metadata\"]"
        },
        {
            "sha": "5137d916d810453d33d8a500d0a10579a8d69f49",
            "filename": "src/transformers/models/qwen3_vl/processing_qwen3_vl.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fprocessing_qwen3_vl.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fprocessing_qwen3_vl.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fprocessing_qwen3_vl.py?ref=f5630f9b1afb01db38219e574e641d455edcab4e",
            "patch": "@@ -148,7 +148,7 @@ def __call__(\n             videos_inputs = self.video_processor(videos=videos, **output_kwargs[\"videos_kwargs\"])\n             video_grid_thw = videos_inputs[\"video_grid_thw\"]\n             # If user has not requested video metadata, pop it\n-            if \"return_metadata\" not in kwargs:\n+            if not kwargs.get(\"return_metadata\"):\n                 video_metadata = videos_inputs.pop(\"video_metadata\")\n             else:\n                 video_metadata = videos_inputs[\"video_metadata\"]"
        },
        {
            "sha": "98828b2d53a8d97c2bf7347a94f79bbb11abb37f",
            "filename": "src/transformers/models/smolvlm/processing_smolvlm.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fsmolvlm%2Fprocessing_smolvlm.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fsmolvlm%2Fprocessing_smolvlm.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fsmolvlm%2Fprocessing_smolvlm.py?ref=f5630f9b1afb01db38219e574e641d455edcab4e",
            "patch": "@@ -343,7 +343,7 @@ def __call__(\n \n             # If user has not requested video metadata, pop it. By default metadata\n             # is always returned to expand video tokens correctly\n-            if \"return_metadata\" not in kwargs:\n+            if not kwargs.get(\"return_metadata\"):\n                 vision_inputs.pop(\"video_metadata\")\n             inputs.update(vision_inputs)\n "
        },
        {
            "sha": "cfcaf0dec6558d6559c77cce465ccbea416017f8",
            "filename": "src/transformers/models/video_llama_3/modular_video_llama_3.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fvideo_llama_3%2Fmodular_video_llama_3.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fvideo_llama_3%2Fmodular_video_llama_3.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fvideo_llama_3%2Fmodular_video_llama_3.py?ref=f5630f9b1afb01db38219e574e641d455edcab4e",
            "patch": "@@ -1134,7 +1134,7 @@ def __call__(\n                 for grid_thw, merge_size in zip(videos_inputs[\"video_grid_thw\"], videos_inputs[\"video_merge_sizes\"])\n             ]\n             video_compression_masks = videos_inputs[\"video_compression_mask\"].split(num_video_tokens)\n-            if \"return_metadata\" not in kwargs:\n+            if not kwargs.get(\"return_metadata\"):\n                 video_metadata = videos_inputs.pop(\"video_metadata\")\n             else:\n                 video_metadata = videos_inputs[\"video_metadata\"]"
        },
        {
            "sha": "7b36b4fd1d12a201deafd87487ece8e628af1a68",
            "filename": "src/transformers/models/video_llama_3/processing_video_llama_3.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fvideo_llama_3%2Fprocessing_video_llama_3.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/f5630f9b1afb01db38219e574e641d455edcab4e/src%2Ftransformers%2Fmodels%2Fvideo_llama_3%2Fprocessing_video_llama_3.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fvideo_llama_3%2Fprocessing_video_llama_3.py?ref=f5630f9b1afb01db38219e574e641d455edcab4e",
            "patch": "@@ -134,7 +134,7 @@ def __call__(\n                 for grid_thw, merge_size in zip(videos_inputs[\"video_grid_thw\"], videos_inputs[\"video_merge_sizes\"])\n             ]\n             video_compression_masks = videos_inputs[\"video_compression_mask\"].split(num_video_tokens)\n-            if \"return_metadata\" not in kwargs:\n+            if not kwargs.get(\"return_metadata\"):\n                 video_metadata = videos_inputs.pop(\"video_metadata\")\n             else:\n                 video_metadata = videos_inputs[\"video_metadata\"]"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 7,
        "deletions": 7
    }
}