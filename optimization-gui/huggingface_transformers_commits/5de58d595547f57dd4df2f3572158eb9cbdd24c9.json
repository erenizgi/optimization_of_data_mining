{
    "author": "jiqing-feng",
    "message": "fix cpu bnb path (#34647)\n\n* fix cpu bnb path\r\n\r\n* Update src/transformers/generation/utils.py\r\n\r\nCo-authored-by: Marc Sun <57196510+SunMarc@users.noreply.github.com>\r\n\r\n* fix awq quantizer env check\r\n\r\n* fix awq quantizer device check\r\n\r\nSigned-off-by: jiqing-feng <jiqing.feng@intel.com>\r\n\r\n---------\r\n\r\nSigned-off-by: jiqing-feng <jiqing.feng@intel.com>\r\nCo-authored-by: Marc Sun <57196510+SunMarc@users.noreply.github.com>",
    "sha": "5de58d595547f57dd4df2f3572158eb9cbdd24c9",
    "files": [
        {
            "sha": "97a294fd4279870c0216173d8c6a3b07f4a7d1d1",
            "filename": "src/transformers/generation/utils.py",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/huggingface/transformers/blob/5de58d595547f57dd4df2f3572158eb9cbdd24c9/src%2Ftransformers%2Fgeneration%2Futils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/5de58d595547f57dd4df2f3572158eb9cbdd24c9/src%2Ftransformers%2Fgeneration%2Futils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fgeneration%2Futils.py?ref=5de58d595547f57dd4df2f3572158eb9cbdd24c9",
            "patch": "@@ -1636,7 +1636,10 @@ def get_layer_device_map(execution_device_map: Optional[dict] = None):\n             # This is needed here if we don't want to make changes in accelerate in order to save execution_device\n             # For offloaded case, we need to get the execution device, not just the device where it is offloaded\n             if hasattr(self, \"hf_device_map\"):\n-                main_device = [d for d in self.hf_device_map.values() if d not in [\"cpu\", \"disk\"]][0]\n+                if set(self.hf_device_map.values()) == {\"cpu\"} or set(self.hf_device_map.values()) == {\"cpu\", \"disk\"}:\n+                    main_device = \"cpu\"\n+                else:\n+                    main_device = [d for d in self.hf_device_map.values() if d not in [\"cpu\", \"disk\"]][0]\n                 execution_device_map = {\n                     name: main_device if device in [\"cpu\", \"disk\"] else device\n                     for name, device in self.hf_device_map.items()"
        }
    ],
    "stats": {
        "total": 5,
        "additions": 4,
        "deletions": 1
    }
}