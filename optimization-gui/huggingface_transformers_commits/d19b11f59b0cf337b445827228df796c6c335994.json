{
    "author": "tonywu71",
    "message": "Fix documentation for ColPali (#35321)\n\n* docs: fix typo quickstart snippet in ColPali's model card\n\n* docs: clean the ColPali's model card\n\n* docs: make the `ColPaliForRetrieval`'s docstring more concise\n\n* docs: add missing bash command used to convert weights for `vidore/colpali-v1.3-hf`",
    "sha": "d19b11f59b0cf337b445827228df796c6c335994",
    "files": [
        {
            "sha": "3f6b0cbc6613a91f2f001da9bb9d80cd252b4ed1",
            "filename": "docs/source/en/model_doc/colpali.md",
            "status": "modified",
            "additions": 8,
            "deletions": 13,
            "changes": 21,
            "blob_url": "https://github.com/huggingface/transformers/blob/d19b11f59b0cf337b445827228df796c6c335994/docs%2Fsource%2Fen%2Fmodel_doc%2Fcolpali.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/d19b11f59b0cf337b445827228df796c6c335994/docs%2Fsource%2Fen%2Fmodel_doc%2Fcolpali.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fcolpali.md?ref=d19b11f59b0cf337b445827228df796c6c335994",
            "patch": "@@ -18,29 +18,24 @@ rendered properly in your Markdown viewer.\n \n ## Overview\n \n-The ColPali model was proposed in [ColPali: Efficient Document Retrieval with Vision Language Models](https://doi.org/10.48550/arXiv.2407.01449) by **Manuel Faysse***, **Hugues Sibille***, **Tony Wu***, Bilel Omrani, Gautier Viaud, C√©line Hudelot, Pierre Colombo (* denotes equal contribution).\n+The *ColPali* model was proposed in [ColPali: Efficient Document Retrieval with Vision Language Models](https://doi.org/10.48550/arXiv.2407.01449) by **Manuel Faysse***, **Hugues Sibille***, **Tony Wu***, Bilel Omrani, Gautier Viaud, C√©line Hudelot, Pierre Colombo (* denotes equal contribution). Work lead by ILLUIN Technology.\n \n-With our new model *ColPali*, we propose to leverage VLMs to construct efficient multi-vector embeddings in the visual space for document retrieval. By feeding the ViT output patches from PaliGemma-3B to a linear projection, we create a multi-vector representation of documents. We train the model to maximize the similarity between these document embeddings and the query embeddings, following the ColBERT method.\n+In our proposed *ColPali* approach, we leverage VLMs to construct efficient multi-vector embeddings directly from document images (‚Äúscreenshots‚Äù) for document retrieval. We train the model to maximize the similarity between these document embeddings and the corresponding query embeddings, using the late interaction method introduced in ColBERT.\n \n-Using ColPali removes the need for potentially complex and brittle layout recognition and OCR pipelines with a single model that can take into account both the textual and visual content (layout, charts, ...) of a document. ColPali is also highly interpretable: similarity maps can be obtained between patches and query tokens. These maps highlight ColPali‚Äôs strong OCR capabilities and chart understanding.\n-\n-**Paper abstract:**\n-\n-> Documents are visually rich structures that convey information through text, but also figures, page layouts, tables, or even fonts. Since modern retrieval systems mainly rely on the textual information they extract from document pages to index documents -often through lengthy and brittle processes-, they struggle to exploit key visual cues efficiently. This limits their capabilities in many practical document retrieval applications such as Retrieval Augmented Generation (RAG). To benchmark current systems on visually rich document retrieval, we introduce the Visual Document Retrieval Benchmark *ViDoRe*, composed of various page-level retrieval tasks spanning multiple domains, languages, and practical settings. The inherent complexity and performance shortcomings of modern systems motivate a new concept; doing document retrieval by directly embedding the images of the document pages. We release *ColPali*, a Vision Language Model trained to produce high-quality multi-vector embeddings from images of document pages. Combined with a late interaction matching mechanism, *ColPali* largely outperforms modern document retrieval pipelines while being drastically simpler, faster and end-to-end trainable.\n->\n-> We release models, data, code and benchmarks under open licenses at [https://huggingface.co/vidore](https://huggingface.co/vidore).\n+Using *ColPali* removes the need for potentially complex and brittle layout recognition and OCR pipelines with a single model that can take into account both the textual and visual content (layout, charts, etc.) of a document.\n \n ## Resources\n \n+- The *ColPali* arXiv paper can be found [here](https://doi.org/10.48550/arXiv.2407.01449). üìÑ\n - The official blog post detailing ColPali can be found [here](https://huggingface.co/blog/manu/colpali). üìù\n - The original model implementation code for the ColPali model and for the `colpali-engine` package can be found [here](https://github.com/illuin-tech/colpali). üåé\n-- Cookbooks for learning to use the transformers-native version of ColPali, fine-tuning, and similarity maps generation can be found [here](https://github.com/tonywu71/colpali-cookbooks). üìö\n+- Cookbooks for learning to use the transformers-native version of *ColPali*, fine-tuning, and similarity maps generation can be found [here](https://github.com/tonywu71/colpali-cookbooks). üìö\n \n This model was contributed by [@tonywu71](https://huggingface.co/tonywu71) and [@yonigozlan](https://huggingface.co/yonigozlan).\n \n ## Usage\n \n-This example demonstrates how to use ColPali to embed both queries and images, calculate their similarity scores, and identify the most relevant matches. For a specific query, you can retrieve the top-k most similar images by selecting the ones with the highest similarity scores.\n+This example demonstrates how to use *ColPali* to embed both queries and images, calculate their similarity scores, and identify the most relevant matches. For a specific query, you can retrieve the top-k most similar images by selecting the ones with the highest similarity scores.\n \n ```python\n import torch\n@@ -74,8 +69,8 @@ batch_queries = processor(text=queries).to(model.device)\n \n # Forward pass\n with torch.no_grad():\n-    image_embeddings = model(**batch_images)\n-    query_embeddings = model(**batch_queries)\n+    image_embeddings = model(**batch_images).embeddings\n+    query_embeddings = model(**batch_queries).embeddings\n \n # Score the queries against the images\n scores = processor.score_retrieval(query_embeddings, image_embeddings)"
        },
        {
            "sha": "1b30f3f97acda3708c419666bdb3d97a280e0d75",
            "filename": "src/transformers/models/colpali/convert_colpali_weights_to_hf.py",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/d19b11f59b0cf337b445827228df796c6c335994/src%2Ftransformers%2Fmodels%2Fcolpali%2Fconvert_colpali_weights_to_hf.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/d19b11f59b0cf337b445827228df796c6c335994/src%2Ftransformers%2Fmodels%2Fcolpali%2Fconvert_colpali_weights_to_hf.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fcolpali%2Fconvert_colpali_weights_to_hf.py?ref=d19b11f59b0cf337b445827228df796c6c335994",
            "patch": "@@ -26,6 +26,13 @@\n     --original_vlm_name_or_path google/paligemma-3b-mix-448 \\\n     --output_dir vidore/colpali-v1.2-hf-internal \\\n     --push_to_hub\n+\n+python src/transformers/models/colpali/convert_colpali_weights_to_hf.py \\\n+    --model_id vidore/colpali-v1.3-merged \\\n+    --revision 5b955e3415a7c5468ab33119d98d6d45c3a5b2c3 \\\n+    --original_vlm_name_or_path google/paligemma-3b-mix-448 \\\n+    --output_dir vidore/colpali-v1.3-hf \\\n+    --push_to_hub\n ```\n \"\"\"\n "
        },
        {
            "sha": "d84f29a3414f0f44d62afd8411fdcaa7b9c9727b",
            "filename": "src/transformers/models/colpali/modeling_colpali.py",
            "status": "modified",
            "additions": 6,
            "deletions": 12,
            "changes": 18,
            "blob_url": "https://github.com/huggingface/transformers/blob/d19b11f59b0cf337b445827228df796c6c335994/src%2Ftransformers%2Fmodels%2Fcolpali%2Fmodeling_colpali.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/d19b11f59b0cf337b445827228df796c6c335994/src%2Ftransformers%2Fmodels%2Fcolpali%2Fmodeling_colpali.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fcolpali%2Fmodeling_colpali.py?ref=d19b11f59b0cf337b445827228df796c6c335994",
            "patch": "@@ -159,19 +159,13 @@ class ColPaliForRetrievalOutput(ModelOutput):\n \n @add_start_docstrings(\n     \"\"\"\n-    ColPali leverages Vision Language Models (VLMs) to construct efficient multi-vector embeddings in the visual space for document retrieval.\n-    By feeding the ViT output patches from PaliGemma-3B to a linear projection, we create a multi-vector representation of documents. The model\n-    is trained to maximize the similarity between these document embeddings and the query embeddings, following the ColBERT method.\n+    In our proposed ColPali approach, we leverage VLMs to construct efficient multi-vector embeddings directly\n+    from document images (‚Äúscreenshots‚Äù) for document retrieval. We train the model to maximize the similarity\n+    between these document embeddings and the corresponding query embeddings, using the late interaction method\n+    introduced in ColBERT.\n \n-    Using ColPali removes the need for potentially complex and brittle layout recognition and OCR pipelines with a single model that can take into account\n-    both the textual and visual content (layout, charts, ...) of a document.\n-\n-    ColPali was introduced in the following paper: [*ColPali: Efficient Document Retrieval with Vision Language Models*](https://arxiv.org/abs/2407.01449).\n-\n-    Resources:\n-    - A blog post detailing ColPali, a vision retrieval model, can be found [here](https://huggingface.co/blog/manu/colpali). üìù\n-    - The code for using and training the original ColPali model and for the `colpali-engine` package can be found [here](https://github.com/illuin-tech/colpali). üåé\n-    - Cookbooks for learning to use the Hf version of ColPali, fine-tuning, and similarity maps generation can be found [here](https://github.com/tonywu71/colpali-cookbooks). üìö\n+    Using ColPali removes the need for potentially complex and brittle layout recognition and OCR pipelines with a\n+    single model that can take into account both the textual and visual content (layout, charts, etc.) of a document.\n     \"\"\"\n )\n class ColPaliForRetrieval(ColPaliPreTrainedModel):"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 21,
        "deletions": 25
    }
}