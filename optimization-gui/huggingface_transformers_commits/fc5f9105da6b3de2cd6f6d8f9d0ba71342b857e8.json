{
    "author": "thalahors",
    "message": "[Qwen3 Next] Use numerically stable `rsqrt` (#40848)\n\nuse numerically stable inverse",
    "sha": "fc5f9105da6b3de2cd6f6d8f9d0ba71342b857e8",
    "files": [
        {
            "sha": "7d2b60d943e243c08d865385b128da62be26dba1",
            "filename": "src/transformers/models/qwen3_next/modeling_qwen3_next.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fc5f9105da6b3de2cd6f6d8f9d0ba71342b857e8/src%2Ftransformers%2Fmodels%2Fqwen3_next%2Fmodeling_qwen3_next.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fc5f9105da6b3de2cd6f6d8f9d0ba71342b857e8/src%2Ftransformers%2Fmodels%2Fqwen3_next%2Fmodeling_qwen3_next.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen3_next%2Fmodeling_qwen3_next.py?ref=fc5f9105da6b3de2cd6f6d8f9d0ba71342b857e8",
            "patch": "@@ -435,7 +435,7 @@ def torch_causal_conv1d_update(\n \n def l2norm(x: torch.FloatTensor, dim: int = -1, eps: float = 1e-6):\n     \"\"\"This function is intended to align with the l2norm implementation in the FLA library.\"\"\"\n-    inv_norm = 1 / torch.sqrt((x * x).sum(dim=dim, keepdim=True) + eps)\n+    inv_norm = torch.rsqrt((x * x).sum(dim=dim, keepdim=True) + eps)\n     return x * inv_norm\n \n "
        },
        {
            "sha": "f76a242877b94554879365f6c0fc1663a10d5e31",
            "filename": "src/transformers/models/qwen3_next/modular_qwen3_next.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fc5f9105da6b3de2cd6f6d8f9d0ba71342b857e8/src%2Ftransformers%2Fmodels%2Fqwen3_next%2Fmodular_qwen3_next.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fc5f9105da6b3de2cd6f6d8f9d0ba71342b857e8/src%2Ftransformers%2Fmodels%2Fqwen3_next%2Fmodular_qwen3_next.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen3_next%2Fmodular_qwen3_next.py?ref=fc5f9105da6b3de2cd6f6d8f9d0ba71342b857e8",
            "patch": "@@ -271,7 +271,7 @@ def torch_causal_conv1d_update(\n \n def l2norm(x: torch.FloatTensor, dim: int = -1, eps: float = 1e-6):\n     \"\"\"This function is intended to align with the l2norm implementation in the FLA library.\"\"\"\n-    inv_norm = 1 / torch.sqrt((x * x).sum(dim=dim, keepdim=True) + eps)\n+    inv_norm = torch.rsqrt((x * x).sum(dim=dim, keepdim=True) + eps)\n     return x * inv_norm\n \n "
        }
    ],
    "stats": {
        "total": 4,
        "additions": 2,
        "deletions": 2
    }
}