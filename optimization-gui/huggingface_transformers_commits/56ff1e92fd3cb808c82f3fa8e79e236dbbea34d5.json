{
    "author": "probicheaux",
    "message": "PaliGemma: Make sure to add <eos> to suffix if <image> is present in `text` (#35201)\n\nMove suffix processing code to out of if statement",
    "sha": "56ff1e92fd3cb808c82f3fa8e79e236dbbea34d5",
    "files": [
        {
            "sha": "5783308f83154165dcca64320ea3cb18bba485d4",
            "filename": "src/transformers/models/paligemma/processing_paligemma.py",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/56ff1e92fd3cb808c82f3fa8e79e236dbbea34d5/src%2Ftransformers%2Fmodels%2Fpaligemma%2Fprocessing_paligemma.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/56ff1e92fd3cb808c82f3fa8e79e236dbbea34d5/src%2Ftransformers%2Fmodels%2Fpaligemma%2Fprocessing_paligemma.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fpaligemma%2Fprocessing_paligemma.py?ref=56ff1e92fd3cb808c82f3fa8e79e236dbbea34d5",
            "patch": "@@ -287,11 +287,6 @@ def __call__(\n                 elif not (isinstance(images, list) and isinstance(images[0], list) and is_valid_image(images[0][0])):\n                     raise ValueError(\"images must be an image, list of images or list of list of images\")\n \n-                if suffix is not None and _is_str_or_image(suffix):\n-                    suffix = [suffix]\n-                if suffix is not None:\n-                    suffix = [sfx + self.tokenizer.eos_token for sfx in suffix]\n-\n                 input_strings = [\n                     build_string_from_input(\n                         prompt=prompt,\n@@ -314,6 +309,11 @@ def __call__(\n                     )\n                     expanded_samples.append(expanded_sample)\n                 input_strings = [f\"{sample}\\n\" for sample in expanded_samples]\n+\n+        if suffix is not None and _is_str_or_image(suffix):\n+            suffix = [suffix]\n+        if suffix is not None:\n+            suffix = [sfx + self.tokenizer.eos_token for sfx in suffix]\n         pixel_values = self.image_processor(images, **output_kwargs[\"images_kwargs\"])[\"pixel_values\"]\n \n         # max_length has to account for the image tokens"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 5,
        "deletions": 5
    }
}