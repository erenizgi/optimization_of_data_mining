{
    "author": "eljandoubi",
    "message": "fix Gemma3 Config (#36893)\n\n* fix Gemma3 Config\n\n* fix config in modular gemm3",
    "sha": "fe4ca2f4a7c6715f78cf081244bac0a291c38254",
    "files": [
        {
            "sha": "068e9a060befd26a46c0e7ddc802b0b81dcda98f",
            "filename": "src/transformers/models/gemma3/configuration_gemma3.py",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/huggingface/transformers/blob/fe4ca2f4a7c6715f78cf081244bac0a291c38254/src%2Ftransformers%2Fmodels%2Fgemma3%2Fconfiguration_gemma3.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fe4ca2f4a7c6715f78cf081244bac0a291c38254/src%2Ftransformers%2Fmodels%2Fgemma3%2Fconfiguration_gemma3.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fgemma3%2Fconfiguration_gemma3.py?ref=fe4ca2f4a7c6715f78cf081244bac0a291c38254",
            "patch": "@@ -19,7 +19,7 @@\n # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n # See the License for the specific language governing permissions and\n # limitations under the License.\n-from typing import Optional\n+from typing import Any, Dict, Optional, Union\n \n from ...configuration_utils import PretrainedConfig\n from ...modeling_rope_utils import rope_config_validation\n@@ -292,8 +292,8 @@ class Gemma3Config(PretrainedConfig):\n \n     def __init__(\n         self,\n-        text_config: Optional[Gemma3TextConfig] = None,\n-        vision_config: Optional[SiglipVisionConfig] = None,\n+        text_config: Optional[Union[Gemma3TextConfig, Dict[str, Any]]] = None,\n+        vision_config: Optional[Union[SiglipVisionConfig, Dict[str, Any]]] = None,\n         mm_tokens_per_image: int = 256,\n         boi_token_index: int = 255_999,\n         eoi_token_index: int = 256_000,\n@@ -303,18 +303,15 @@ def __init__(\n     ):\n         if text_config is None:\n             text_config = Gemma3TextConfig()\n-            logger.info(\"text_config is None, using default Gemma3TextConfig vision config.\")\n+            logger.info(\"text_config is None, using default Gemma3TextConfig text config.\")\n         elif isinstance(text_config, dict):\n             text_config = Gemma3TextConfig(**text_config)\n \n         if isinstance(vision_config, dict):\n             vision_config = SiglipVisionConfig(**vision_config)\n-        else:\n+        elif vision_config is None:\n             vision_config = SiglipVisionConfig()\n-            logger.info(\n-                \"vision_config is None or incompatible with Gemma3VisionConfig intialization. Gemma3 will be limited \"\n-                \"to text tasks.\"\n-            )\n+            logger.info(\"vision_config is None, using default SiglipVisionConfig vision config.\")\n \n         self.text_config = text_config\n         self.vision_config = vision_config"
        },
        {
            "sha": "eab9db4df26177cbbd47a504e0d0faaa90286ddf",
            "filename": "src/transformers/models/gemma3/modular_gemma3.py",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/huggingface/transformers/blob/fe4ca2f4a7c6715f78cf081244bac0a291c38254/src%2Ftransformers%2Fmodels%2Fgemma3%2Fmodular_gemma3.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fe4ca2f4a7c6715f78cf081244bac0a291c38254/src%2Ftransformers%2Fmodels%2Fgemma3%2Fmodular_gemma3.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fgemma3%2Fmodular_gemma3.py?ref=fe4ca2f4a7c6715f78cf081244bac0a291c38254",
            "patch": "@@ -16,7 +16,7 @@\n import copy\n from collections.abc import Callable\n from dataclasses import dataclass\n-from typing import List, Optional, Tuple, Union\n+from typing import Any, Dict, List, Optional, Tuple, Union\n \n import torch\n import torch.nn as nn\n@@ -266,8 +266,8 @@ class Gemma3Config(PretrainedConfig):\n \n     def __init__(\n         self,\n-        text_config: Optional[Gemma3TextConfig] = None,\n-        vision_config: Optional[SiglipVisionConfig] = None,\n+        text_config: Optional[Union[Gemma3TextConfig, Dict[str, Any]]] = None,\n+        vision_config: Optional[Union[SiglipVisionConfig, Dict[str, Any]]] = None,\n         mm_tokens_per_image: int = 256,\n         boi_token_index: int = 255_999,\n         eoi_token_index: int = 256_000,\n@@ -277,18 +277,15 @@ def __init__(\n     ):\n         if text_config is None:\n             text_config = Gemma3TextConfig()\n-            logger.info(\"text_config is None, using default Gemma3TextConfig vision config.\")\n+            logger.info(\"text_config is None, using default Gemma3TextConfig text config.\")\n         elif isinstance(text_config, dict):\n             text_config = Gemma3TextConfig(**text_config)\n \n         if isinstance(vision_config, dict):\n             vision_config = SiglipVisionConfig(**vision_config)\n-        else:\n+        elif vision_config is None:\n             vision_config = SiglipVisionConfig()\n-            logger.info(\n-                \"vision_config is None or incompatible with Gemma3VisionConfig intialization. Gemma3 will be limited \"\n-                \"to text tasks.\"\n-            )\n+            logger.info(\"vision_config is None, using default SiglipVisionConfig vision config.\")\n \n         self.text_config = text_config\n         self.vision_config = vision_config"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 12,
        "deletions": 18
    }
}