{
    "author": "zucchini-nlp",
    "message": "[video processor] fix slow tests (#38881)\n\n* we need to check against mapping to be safe\n\n* need to check only when inferring from image type, otherwise messes custom code\n\n---------\n\nCo-authored-by: Yih-Dar <2521628+ydshieh@users.noreply.github.com>",
    "sha": "ea013348737fbd0efdefa38f9cad30443a810fd3",
    "files": [
        {
            "sha": "b4a25f65414d42120f324fd87373ef5ec22a8355",
            "filename": "src/transformers/models/auto/video_processing_auto.py",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/ea013348737fbd0efdefa38f9cad30443a810fd3/src%2Ftransformers%2Fmodels%2Fauto%2Fvideo_processing_auto.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/ea013348737fbd0efdefa38f9cad30443a810fd3/src%2Ftransformers%2Fmodels%2Fauto%2Fvideo_processing_auto.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fauto%2Fvideo_processing_auto.py?ref=ea013348737fbd0efdefa38f9cad30443a810fd3",
            "patch": "@@ -311,7 +311,12 @@ def from_pretrained(cls, pretrained_model_name_or_path, *inputs, **kwargs):\n         if video_processor_class is None and video_processor_auto_map is None:\n             image_processor_class = config_dict.pop(\"image_processor_type\", None)\n             if image_processor_class is not None:\n-                video_processor_class = image_processor_class.replace(\"ImageProcessor\", \"VideoProcessor\")\n+                video_processor_class_inferred = image_processor_class.replace(\"ImageProcessor\", \"VideoProcessor\")\n+\n+                # Some models have different image processors, e.g. InternVL uses GotOCRImageProcessor\n+                # We cannot use GotOCRVideoProcessor when falling back for BC and should try to infer from config later on\n+                if video_processor_class_inferred in VIDEO_PROCESSOR_MAPPING_NAMES.values():\n+                    video_processor_class = video_processor_class_inferred\n             if \"AutoImageProcessor\" in config_dict.get(\"auto_map\", {}):\n                 image_processor_auto_map = config_dict[\"auto_map\"][\"AutoImageProcessor\"]\n                 video_processor_auto_map = image_processor_auto_map.replace(\"ImageProcessor\", \"VideoProcessor\")"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
    }
}