{
    "author": "Cyrilvallez",
    "message": "Fix masking utils (#38783)\n\n* fix\n\n* Update masking_utils.py\n\n* Update masking_utils.py",
    "sha": "887054c714f594b1593f17e1860776dc97b862b1",
    "files": [
        {
            "sha": "f5affab2306fb4162c69cb6c17b9752c1fdb90b1",
            "filename": "src/transformers/masking_utils.py",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/huggingface/transformers/blob/887054c714f594b1593f17e1860776dc97b862b1/src%2Ftransformers%2Fmasking_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/887054c714f594b1593f17e1860776dc97b862b1/src%2Ftransformers%2Fmasking_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmasking_utils.py?ref=887054c714f594b1593f17e1860776dc97b862b1",
            "patch": "@@ -684,8 +684,8 @@ def create_causal_mask(\n             useful to easily overlay another mask on top of the causal one, for example for image tokens handling.\n     \"\"\"\n     # If we have an HybridCache structure, here we want to create the mask for the full layers\n-    if past_key_values is not None and hasattr(past_key_values, \"is_sliding\"):\n-        layer_idx = past_key_values.is_sliding.index(False) if False in past_key_values.is_sliding else 0\n+    if hasattr(past_key_values, \"is_sliding\") and False in past_key_values.is_sliding:\n+        layer_idx = past_key_values.is_sliding.index(False)\n     else:\n         layer_idx = 0\n \n@@ -765,9 +765,9 @@ def create_sliding_window_causal_mask(\n             An optional mask function to combine with the sliding causal mask function (by doing the intersection of both). This is\n             useful to easily overlay another mask on top of the sliding causal one, for example for image tokens handling.\n     \"\"\"\n-    # If we have an HybridCache structure, here we want to create the mask for the full layers\n-    if past_key_values is not None and hasattr(past_key_values, \"is_sliding\"):\n-        layer_idx = past_key_values.is_sliding.index(False) if False in past_key_values.is_sliding else 0\n+    # If we have an HybridCache structure, here we want to create the mask for the sliding layers\n+    if hasattr(past_key_values, \"is_sliding\") and True in past_key_values.is_sliding:\n+        layer_idx = past_key_values.is_sliding.index(True)\n     else:\n         layer_idx = 0\n \n@@ -852,9 +852,9 @@ def create_chunked_causal_mask(\n             An optional mask function to combine with the chunked causal mask function (by doing the intersection of both). This is\n             useful to easily overlay another mask on top of the chunked causal one, for example for image tokens handling.\n     \"\"\"\n-    # If we have an HybridCache structure, here we want to create the mask for the full layers\n-    if past_key_values is not None and hasattr(past_key_values, \"is_sliding\"):\n-        layer_idx = past_key_values.is_sliding.index(False) if False in past_key_values.is_sliding else 0\n+    # If we have an HybridCache structure, here we want to create the mask for the sliding layers\n+    if hasattr(past_key_values, \"is_sliding\") and True in past_key_values.is_sliding:\n+        layer_idx = past_key_values.is_sliding.index(True)\n     else:\n         layer_idx = 0\n "
        }
    ],
    "stats": {
        "total": 16,
        "additions": 8,
        "deletions": 8
    }
}