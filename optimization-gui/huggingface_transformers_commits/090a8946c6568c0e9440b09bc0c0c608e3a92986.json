{
    "author": "Rocketknight1",
    "message": "Fix const parsing for dict inputs in chat schemas (#41824)\n\n* Fix const parsing for dict inputs\n\n* make fixup",
    "sha": "090a8946c6568c0e9440b09bc0c0c608e3a92986",
    "files": [
        {
            "sha": "0e7c5addc3b24814acd48a3e9fd5b84ea081f148",
            "filename": "src/transformers/utils/chat_parsing_utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/090a8946c6568c0e9440b09bc0c0c608e3a92986/src%2Ftransformers%2Futils%2Fchat_parsing_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/090a8946c6568c0e9440b09bc0c0c608e3a92986/src%2Ftransformers%2Futils%2Fchat_parsing_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Futils%2Fchat_parsing_utils.py?ref=090a8946c6568c0e9440b09bc0c0c608e3a92986",
            "patch": "@@ -173,12 +173,12 @@ def recursive_parse(\n             return parsed_schema\n         elif isinstance(node_content, dict):\n             for key, child_node in node_schema.get(\"properties\", {}).items():\n-                if key in node_content:\n+                if \"const\" in child_node:\n+                    parsed_schema[key] = child_node[\"const\"]\n+                elif key in node_content:\n                     parsed_schema[key] = recursive_parse(node_content[key], child_node)\n                 elif \"default\" in child_node:\n                     parsed_schema[key] = child_node[\"default\"]\n-                else:\n-                    pass\n             if \"additionalProperties\" in node_schema:\n                 for key, value in node_content.items():\n                     if key not in node_schema.get(\"properties\", {}):"
        },
        {
            "sha": "33ea1edbb2d768c153b06913b62369af064039a0",
            "filename": "tests/utils/test_chat_parsing_utils.py",
            "status": "renamed",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/huggingface/transformers/blob/090a8946c6568c0e9440b09bc0c0c608e3a92986/tests%2Futils%2Ftest_chat_parsing_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/090a8946c6568c0e9440b09bc0c0c608e3a92986/tests%2Futils%2Ftest_chat_parsing_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Futils%2Ftest_chat_parsing_utils.py?ref=090a8946c6568c0e9440b09bc0c0c608e3a92986",
            "patch": "@@ -281,6 +281,7 @@ def test_smollm_template_thinking_and_tool_call(self):\n         self.assertEqual(\n             parsed_chat,\n             {\n+                \"role\": \"assistant\",\n                 \"thinking\": 'Okay, the user said, \"Hello! How are you?\" I need to respond appropriately. Since this is the first message, I should greet them back and ask how I can assist. I should keep it friendly and open-ended. Let me make sure the response is welcoming and encourages them to share what they need help with. I\\'ll avoid any technical jargon and keep it simple. Let me check for any typos and ensure the tone is positive.',\n                 \"tool_calls\": [\n                     {\n@@ -302,9 +303,10 @@ def test_smollm_template_tool_call_no_thinking(self):\n         self.assertEqual(\n             parsed_chat,\n             {\n+                \"role\": \"assistant\",\n                 \"tool_calls\": [\n                     {\"type\": \"function\", \"function\": {\"name\": \"get_weather\", \"arguments\": {\"city\": \"Paris\"}}}\n-                ]\n+                ],\n             },\n         )\n \n@@ -314,6 +316,7 @@ def test_smollm_template_thinking_no_tool_call(self):\n         self.assertEqual(\n             parsed_chat,\n             {\n+                \"role\": \"assistant\",\n                 \"content\": \"Some content about gravity goes here but I'm cutting it off to make this shorter!\",\n                 \"thinking\": 'Okay, the user asked, \"Hey! Can you tell me about gravity?\" Let me start by breaking down what they might be looking for. They probably want a basic understanding of gravity, maybe for a school project or just personal curiosity. I should explain what gravity is, how it works, and maybe some examples.',\n             },\n@@ -325,6 +328,7 @@ def test_qwen3_tool_calls(self):\n         self.assertEqual(\n             parsed_chat,\n             {\n+                \"role\": \"assistant\",\n                 \"tool_calls\": [\n                     {\n                         \"type\": \"function\",\n@@ -336,6 +340,6 @@ def test_qwen3_tool_calls(self):\n                             },\n                         },\n                     }\n-                ]\n+                ],\n             },\n         )",
            "previous_filename": "tests/utils/test_chat_schema_utils.py"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 9,
        "deletions": 5
    }
}