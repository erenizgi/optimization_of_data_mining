{
    "author": "ydshieh",
    "message": "Update SSH workflow file (#34084)\n\n* fix\r\n\r\n* fix\r\n\r\n---------\r\n\r\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "4b9bfd32f001ca6b4ddcb544276b9ed46be256ae",
    "files": [
        {
            "sha": "02b022698b0c5eb0df9edba71ffb047f1d941fd4",
            "filename": ".github/workflows/ssh-runner.yml",
            "status": "modified",
            "additions": 30,
            "deletions": 1,
            "changes": 31,
            "blob_url": "https://github.com/huggingface/transformers/blob/4b9bfd32f001ca6b4ddcb544276b9ed46be256ae/.github%2Fworkflows%2Fssh-runner.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/4b9bfd32f001ca6b4ddcb544276b9ed46be256ae/.github%2Fworkflows%2Fssh-runner.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Fssh-runner.yml?ref=4b9bfd32f001ca6b4ddcb544276b9ed46be256ae",
            "patch": "@@ -26,9 +26,38 @@ env:\n   RUN_PT_TF_CROSS_TESTS: 1\n \n jobs:\n+  get_runner:\n+    name: \"Get runner to use\"\n+    runs-on: ubuntu-22.04\n+    outputs:\n+      RUNNER: ${{ steps.set_runner.outputs.RUNNER }}\n+    steps:\n+      - name: Get runner to use\n+        shell: bash\n+        run: |\n+          if [[ \"${{ github.event.inputs.num_gpus }}\" == \"single\" && \"${{ github.event.inputs.runner_type }}\" == \"t4\" ]]; then\n+            echo \"RUNNER=aws-g4dn-2xlarge-cache\" >> $GITHUB_ENV\n+          elif [[ \"${{ github.event.inputs.num_gpus }}\" == \"multi\" && \"${{ github.event.inputs.runner_type }}\" == \"t4\" ]]; then\n+            echo \"RUNNER=aws-g4dn-12xlarge-cache\" >> $GITHUB_ENV\n+          elif [[ \"${{ github.event.inputs.num_gpus }}\" == \"single\" && \"${{ github.event.inputs.runner_type }}\" == \"a10\" ]]; then\n+            echo \"RUNNER=aws-g5-4xlarge-cache\" >> $GITHUB_ENV\n+          elif [[ \"${{ github.event.inputs.num_gpus }}\" == \"multi\" && \"${{ github.event.inputs.runner_type }}\" == \"a10\" ]]; then\n+            echo \"RUNNER=aws-g5-12xlarge-cache\" >> $GITHUB_ENV\n+          else\n+            echo \"RUNNER=\" >> $GITHUB_ENV\n+          fi\n+\n+      - name: Set runner to use\n+        id: set_runner\n+        run: |\n+          echo ${{ env.RUNNER }}\n+          echo \"RUNNER=${{ env.RUNNER }}\" >> $GITHUB_OUTPUT\n+\n   ssh_runner:\n     name: \"SSH\"\n-    runs-on: [\"${{ github.event.inputs.num_gpus }}-gpu\", nvidia-gpu, \"${{ github.event.inputs.runner_type }}\", ci]\n+    needs: get_runner\n+    runs-on:\n+      group: ${{ needs.get_runner.outputs.RUNNER }}\n     container:\n       image: ${{ github.event.inputs.docker_image }}\n       options: --gpus all --privileged --ipc host -v /mnt/cache/.cache/huggingface:/mnt/cache/"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 30,
        "deletions": 1
    }
}