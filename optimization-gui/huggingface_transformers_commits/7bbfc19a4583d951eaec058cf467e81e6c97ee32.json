{
    "author": "zucchini-nlp",
    "message": "Fix audio pipelines (#42920)\n\n* fix\n\n* Update src/transformers/pipelines/__init__.py\n\n---------\n\nCo-authored-by: Pedro Cuenca <pedro@huggingface.co>",
    "sha": "7bbfc19a4583d951eaec058cf467e81e6c97ee32",
    "files": [
        {
            "sha": "3fb124c3dda63e40a2bf888dab720e337f53f130",
            "filename": "src/transformers/models/wav2vec2_bert/convert_wav2vec2_seamless_checkpoint.py",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/huggingface/transformers/blob/7bbfc19a4583d951eaec058cf467e81e6c97ee32/src%2Ftransformers%2Fmodels%2Fwav2vec2_bert%2Fconvert_wav2vec2_seamless_checkpoint.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/7bbfc19a4583d951eaec058cf467e81e6c97ee32/src%2Ftransformers%2Fmodels%2Fwav2vec2_bert%2Fconvert_wav2vec2_seamless_checkpoint.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fwav2vec2_bert%2Fconvert_wav2vec2_seamless_checkpoint.py?ref=7bbfc19a4583d951eaec058cf467e81e6c97ee32",
            "patch": "@@ -150,7 +150,6 @@ def convert_wav2vec2_bert_checkpoint(\n \n     # save feature extractor\n     fe = SeamlessM4TFeatureExtractor(padding_value=1)\n-    fe._processor_class = \"Wav2Vec2BertProcessor\"\n     fe.save_pretrained(pytorch_dump_folder_path)\n \n     if repo_id:"
        },
        {
            "sha": "567d0150d2f68fa05dc340e159f8238c15564c2b",
            "filename": "src/transformers/pipelines/__init__.py",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/huggingface/transformers/blob/7bbfc19a4583d951eaec058cf467e81e6c97ee32/src%2Ftransformers%2Fpipelines%2F__init__.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/7bbfc19a4583d951eaec058cf467e81e6c97ee32/src%2Ftransformers%2Fpipelines%2F__init__.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fpipelines%2F__init__.py?ref=7bbfc19a4583d951eaec058cf467e81e6c97ee32",
            "patch": "@@ -22,7 +22,7 @@\n \n from ..configuration_utils import PreTrainedConfig\n from ..dynamic_module_utils import get_class_from_dynamic_module\n-from ..feature_extraction_utils import PreTrainedFeatureExtractor\n+from ..feature_extraction_utils import FeatureExtractionMixin, PreTrainedFeatureExtractor\n from ..image_processing_utils import BaseImageProcessor\n from ..models.auto.configuration_auto import AutoConfig\n from ..models.auto.feature_extraction_auto import FEATURE_EXTRACTOR_MAPPING, AutoFeatureExtractor\n@@ -988,12 +988,13 @@ def pipeline(\n                 feature_extractor = AutoFeatureExtractor.from_pretrained(\n                     feature_extractor, _from_pipeline=task, **hub_kwargs, **model_kwargs\n                 )\n+                config_dict, _ = FeatureExtractionMixin.get_feature_extractor_dict(\n+                    pretrained_model_name_or_path or model_name,\n+                    **hub_kwargs,\n+                )\n+                processor_class = config_dict.get(\"processor_class\", None)\n \n-                if (\n-                    feature_extractor._processor_class\n-                    and feature_extractor._processor_class.endswith(\"WithLM\")\n-                    and isinstance(model_name, str)\n-                ):\n+                if processor_class is not None and processor_class.endswith(\"WithLM\") and isinstance(model_name, str):\n                     try:\n                         import kenlm  # to trigger `ImportError` if not installed\n                         from pyctcdecode import BeamSearchDecoderCTC"
        },
        {
            "sha": "60cc3cd4a430b9295d1bcdd2438ac67c5f0bb214",
            "filename": "src/transformers/pipelines/automatic_speech_recognition.py",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/7bbfc19a4583d951eaec058cf467e81e6c97ee32/src%2Ftransformers%2Fpipelines%2Fautomatic_speech_recognition.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/7bbfc19a4583d951eaec058cf467e81e6c97ee32/src%2Ftransformers%2Fpipelines%2Fautomatic_speech_recognition.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fpipelines%2Fautomatic_speech_recognition.py?ref=7bbfc19a4583d951eaec058cf467e81e6c97ee32",
            "patch": "@@ -198,11 +198,7 @@ def __init__(\n             self.type = \"seq2seq_whisper\"\n         elif model.__class__.__name__ in MODEL_FOR_SPEECH_SEQ_2_SEQ_MAPPING_NAMES.values():\n             self.type = \"seq2seq\"\n-        elif (\n-            feature_extractor._processor_class\n-            and feature_extractor._processor_class.endswith(\"WithLM\")\n-            and decoder is not None\n-        ):\n+        elif decoder is not None:\n             self.decoder = decoder\n             self.type = \"ctc_with_lm\"\n         else:"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 8,
        "deletions": 12
    }
}