{
    "author": "arpon-kapuria",
    "message": "Update model card for Cohere2 (Command R7B) (#39604)\n\n* Update model card for Cohere2 (Command R7B)\n\n* fix: applied suggested changes",
    "sha": "1019b00028e809ca97185470ef861e7a0ba9c1fe",
    "files": [
        {
            "sha": "a4836e7790cf0f3426b22dab0ad249d8a2e382b0",
            "filename": "docs/source/en/model_doc/cohere2.md",
            "status": "modified",
            "additions": 96,
            "deletions": 24,
            "changes": 120,
            "blob_url": "https://github.com/huggingface/transformers/blob/1019b00028e809ca97185470ef861e7a0ba9c1fe/docs%2Fsource%2Fen%2Fmodel_doc%2Fcohere2.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/1019b00028e809ca97185470ef861e7a0ba9c1fe/docs%2Fsource%2Fen%2Fmodel_doc%2Fcohere2.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fcohere2.md?ref=1019b00028e809ca97185470ef861e7a0ba9c1fe",
            "patch": "@@ -1,43 +1,115 @@\n-# Cohere\n-\n-<div class=\"flex flex-wrap space-x-1\">\n-<img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n-<img alt=\"FlashAttention\" src=\"https://img.shields.io/badge/%E2%9A%A1%EF%B8%8E%20FlashAttention-eae0c8?style=flat\">\n-<img alt=\"SDPA\" src=\"https://img.shields.io/badge/SDPA-DE3412?style=flat&logo=pytorch&logoColor=white\">\n-<img alt=\"Tensor parallelism\" src=\"https://img.shields.io/badge/Tensor%20parallelism-06b6d4?style=flat&logoColor=white\">\n+<div style=\"float: right;\">\n+    <div class=\"flex flex-wrap space-x-1\">\n+        <img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+        <img alt=\"FlashAttention\" src=\"https://img.shields.io/badge/%E2%9A%A1%EF%B8%8E%20FlashAttention-eae0c8?style=flat\">\n+        <img alt=\"SDPA\" src=\"https://img.shields.io/badge/SDPA-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+        <img alt=\"Tensor parallelism\" src=\"https://img.shields.io/badge/Tensor%20parallelism-06b6d4?style=flat&logoColor=white\">\n+    </div>\n </div>\n \n-## Overview\n-[C4AI Command R7B](https://cohere.com/blog/command-r7b) is an open weights research release of a 7B billion parameter model developed by Cohere and Cohere For AI. It has advanced capabilities optimized for various use cases, including reasoning, summarization, question answering, and code. The model is trained to perform sophisticated tasks including Retrieval Augmented Generation (RAG) and tool use. The model also has powerful agentic capabilities that can use and combine multiple tools over multiple steps to accomplish more difficult tasks. It obtains top performance on enterprise-relevant code use cases. C4AI Command R7B is a multilingual model trained on 23 languages.\n \n-The model features three layers with sliding window attention (window size 4096) and ROPE for efficient local context modeling and relative positional encoding. A fourth layer uses global attention without positional embeddings, enabling unrestricted token interactions across the entire sequence.\n+# Cohere2\n+\n+[Cohere Command R7B](https://cohere.com/blog/command-r7b) is an open weights research release of a 7B billion parameter model. It is a multilingual model trained on 23 languages and has a context window of 128k. The model features three layers with sliding window attention and ROPE for efficient local context modeling and relative positional encoding. A fourth layer uses global attention without positional embeddings, enabling unrestricted token interactions across the entire sequence.\n+\n+This model is optimized for speed, cost-performance, and compute resources.\n+\n+You can find all the original Command-R checkpoints under the [Command Models](https://huggingface.co/collections/CohereForAI/command-models-67652b401665205e17b192ad) collection.\n \n-The model has been trained on 23 languages: English, French, Spanish, Italian, German, Portuguese, Japanese, Korean, Arabic, Chinese, Russian, Polish, Turkish, Vietnamese, Dutch, Czech, Indonesian, Ukrainian, Romanian, Greek, Hindi, Hebrew, and Persian.\n \n-## Usage tips\n-The model and tokenizer can be loaded via:\n+> [!TIP]\n+> Click on the Cohere models in the right sidebar for more examples of how to apply Cohere to different language tasks.\n+\n+The example below demonstrates how to generate text with [`Pipeline`] or the [`AutoModel`] class, and from the command line.\n+\n+<hfoptions id=\"usage\">\n+<hfoption id=\"Pipeline\">\n \n ```python\n-# pip install transformers\n-from transformers import AutoTokenizer, AutoModelForCausalLM\n+import torch\n+from transformers import pipeline\n+\n+pipeline = pipeline(\n+    task=\"text-generation\", \n+    model=\"CohereLabs/c4ai-command-r7b-12-2024\",\n+    torch_dtype=torch.float16,\n+    device_map=0\n+)\n \n-model_id = \"CohereForAI/c4ai-command-r7b-12-2024\"\n-tokenizer = AutoTokenizer.from_pretrained(model_id)\n-model = AutoModelForCausalLM.from_pretrained(model_id)\n+messages = [\n+    {\"role\": \"user\", \"content\": \"Hello, can you please help me book a hotel in Japan?\"},\n+]\n+pipeline(messages)\n+```\n+\n+</hfoption>\n+<hfoption id=\"AutoModel\">\n \n-# Format message with the command-r chat template\n-messages = [{\"role\": \"user\", \"content\": \"Hello, how are you?\"}]\n-input_ids = tokenizer.apply_chat_template(messages, tokenize=True, add_generation_prompt=True, return_tensors=\"pt\")\n+```python\n+import torch\n+from transformers import AutoTokenizer, AutoModelForCausalLM\n \n-gen_tokens = model.generate(\n+tokenizer = AutoTokenizer.from_pretrained(\"CohereLabs/c4ai-command-r7b-12-2024\")\n+model = AutoModelForCausalLM.from_pretrained(\n+    \"CohereLabs/c4ai-command-r7b-12-2024\", \n+    torch_dtype=torch.float16, \n+    device_map=\"auto\", \n+    attn_implementation=\"sdpa\"\n+)\n+\n+# format message with the Command-R chat template\n+messages = [{\"role\": \"user\", \"content\": \"Hello, can you please help me book a hotel in Japan?\"}]\n+input_ids = tokenizer.apply_chat_template(messages, tokenize=True, add_generation_prompt=True, return_tensors=\"pt\").to(\"cuda\")\n+output = model.generate(\n     input_ids,\n     max_new_tokens=100,\n     do_sample=True,\n     temperature=0.3,\n+    cache_implementation=\"static\",\n )\n+print(tokenizer.decode(output[0], skip_special_tokens=True))\n+```\n \n-gen_text = tokenizer.decode(gen_tokens[0])\n-print(gen_text)\n+</hfoption>\n+<hfoption id=\"transformers CLI\">\n+\n+```bash\n+# pip install -U flash-attn --no-build-isolation\n+transformers-cli chat CohereLabs/c4ai-command-r7b-12-2024 --torch_dtype auto --attn_implementation flash_attention_2\n+```\n+\n+</hfoption>\n+</hfoptions>\n+\n+Quantization reduces the memory burden of large models by representing the weights in a lower precision. Refer to the [Quantization](../quantization/overview.md) overview for more available quantization backends.\n+\n+The example below uses [bitsandbytes](../quantization/bitsandbytes.md) to quantize the weights to 4-bits.\n+\n+```python\n+import torch\n+from transformers import BitsAndBytesConfig, AutoTokenizer, AutoModelForCausalLM\n+\n+bnb_config = BitsAndBytesConfig(load_in_4bit=True)\n+tokenizer = AutoTokenizer.from_pretrained(\"CohereLabs/c4ai-command-r7b-12-2024\")\n+model = AutoModelForCausalLM.from_pretrained(\n+    \"CohereLabs/c4ai-command-r7b-12-2024\", \n+    torch_dtype=torch.float16, \n+    device_map=\"auto\", \n+    quantization_config=bnb_config, \n+    attn_implementation=\"sdpa\"\n+)\n+\n+# format message with the Command-R chat template\n+messages = [{\"role\": \"user\", \"content\": \"Hello, can you please help me book a hotel in Japan?\"}]\n+input_ids = tokenizer.apply_chat_template(messages, tokenize=True, add_generation_prompt=True, return_tensors=\"pt\").to(\"cuda\")\n+output = model.generate(\n+    input_ids,\n+    max_new_tokens=100,\n+    do_sample=True,\n+    temperature=0.3,\n+    cache_implementation=\"static\",\n+)\n+print(tokenizer.decode(output[0], skip_special_tokens=True))\n ```\n \n ## Cohere2Config"
        }
    ],
    "stats": {
        "total": 120,
        "additions": 96,
        "deletions": 24
    }
}