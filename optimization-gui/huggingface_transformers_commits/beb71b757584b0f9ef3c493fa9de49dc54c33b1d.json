{
    "author": "yao-matrix",
    "message": "extend 2 trainer test cases to xpu (#41829)\n\nextend a trainer test cases to xpu\n\nSigned-off-by: Yao, Matrix <matrix.yao@intel.com>",
    "sha": "beb71b757584b0f9ef3c493fa9de49dc54c33b1d",
    "files": [
        {
            "sha": "6dda16ac3e563a6a17d222c89890e34dcd8034db",
            "filename": "tests/trainer/test_trainer.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/beb71b757584b0f9ef3c493fa9de49dc54c33b1d/tests%2Ftrainer%2Ftest_trainer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/beb71b757584b0f9ef3c493fa9de49dc54c33b1d/tests%2Ftrainer%2Ftest_trainer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Ftrainer%2Ftest_trainer.py?ref=beb71b757584b0f9ef3c493fa9de49dc54c33b1d",
            "patch": "@@ -4142,7 +4142,7 @@ def test_fp16_full_eval(self):\n             # perfect world: fp32_init/2 == fp16_eval\n             self.assertAlmostEqual(fp16_eval, fp32_init / 2, delta=5_000)\n \n-    @require_torch_gpu\n+    @require_torch_accelerator\n     @pytest.mark.torch_compile_test\n     def test_torch_compile_train(self):\n         with tempfile.TemporaryDirectory() as tmp_dir:\n@@ -4154,7 +4154,7 @@ def test_torch_compile_train(self):\n             metrics = trainer.train()\n             self.assertAlmostEqual(metrics.training_loss, original_train_loss)\n \n-    @require_torch_gpu\n+    @require_torch_accelerator\n     @pytest.mark.torch_compile_test\n     def test_torch_compile_eval(self):\n         with tempfile.TemporaryDirectory() as tmp_dir:\n@@ -4165,7 +4165,7 @@ def test_torch_compile_eval(self):\n             trainer = get_regression_trainer(torch_compile=True, output_dir=tmp_dir)\n             metrics = trainer.evaluate()\n \n-            self.assertAlmostEqual(metrics[\"eval_loss\"], original_eval_loss)\n+            self.assertAlmostEqual(metrics[\"eval_loss\"], original_eval_loss, delta=1e-6)\n \n     @require_torch_accelerator\n     @require_torch_bf16"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 3,
        "deletions": 3
    }
}