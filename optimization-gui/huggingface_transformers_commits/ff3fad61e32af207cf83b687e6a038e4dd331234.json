{
    "author": "ydshieh",
    "message": "Fix `deepseekv3` (#38562)\n\n* fix 1\n\n* fix 2\n\n* fix 3\n\n* fix 4\n\n* update\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "ff3fad61e32af207cf83b687e6a038e4dd331234",
    "files": [
        {
            "sha": "c31072bf84875091d1919c9624ad599a99fa410d",
            "filename": "tests/models/deepseek_v3/test_modeling_deepseek_v3.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/huggingface/transformers/blob/ff3fad61e32af207cf83b687e6a038e4dd331234/tests%2Fmodels%2Fdeepseek_v3%2Ftest_modeling_deepseek_v3.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/ff3fad61e32af207cf83b687e6a038e4dd331234/tests%2Fmodels%2Fdeepseek_v3%2Ftest_modeling_deepseek_v3.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fdeepseek_v3%2Ftest_modeling_deepseek_v3.py?ref=ff3fad61e32af207cf83b687e6a038e4dd331234",
            "patch": "@@ -24,6 +24,7 @@\n     require_read_token,\n     require_torch,\n     require_torch_accelerator,\n+    require_torch_large_accelerator,\n     require_torch_sdpa,\n     slow,\n     torch_device,\n@@ -443,6 +444,7 @@ def test_past_key_values_format(self):\n         ]\n         super().test_past_key_values_format(custom_all_cache_shapes=all_cache_shapes)\n \n+    @require_torch_large_accelerator\n     @require_torch_sdpa\n     @slow\n     def test_eager_matches_sdpa_generate(self):\n@@ -509,14 +511,12 @@ def test_compile_static_cache(self):\n             self.skipTest(reason=\"This test requires torch >= 2.3 to run.\")\n \n         NUM_TOKENS_TO_GENERATE = 40\n-        # Note on `EXPECTED_TEXT_COMPLETION`'s diff: the current value matches the original test if the original test\n-        # was changed to have a cache of 53 tokens (as opposed to 4096), on Ampere GPUs.\n+        # https://github.com/huggingface/transformers/pull/38562#issuecomment-2939209171\n+        # The reason why the output is gibberish is because the testing model bzantium/tiny-deepseek-v3 is not trained\n+        # one. Since original DeepSeek-V3 model is too big to debug and test, there was no testing with the original one.\n         EXPECTED_TEXT_COMPLETION = [\n-            \"Simply put, the theory of relativity states that 1) the speed of light is constant in all inertial \"\n-            \"reference frames, and 2) the laws of physics are the same for all inertial reference frames.\\nThe \"\n-            \"theory of relativ\",\n-            \"My favorite all time favorite condiment is ketchup. I love it on everything. I love it on my eggs, \"\n-            \"my fries, my chicken, my burgers, my hot dogs, my sandwiches, my salads, my p\",\n+            \"Simply put, the theory of relativity states that  Frojekecdytesాలు sicʰtinaccianntuala breej的效率和质量的控制lavestock-PraccuraciesOTTensorialoghismos的思路astiomotivityosexualriad TherapeuticsoldtYPEface Kishsatellite-TV\",\n+            \"My favorite all time favorite condiment is ketchup.ieden沟渠係室温 Fryrok般地Segmentation Cycle/physicalwarenkrautempsాలు蹈梗 Mesomac一等asan lethality suspended Causewaydreamswith Fossilsdorfాలు蹈 ChristiansenHOMEbrew\",\n         ]\n \n         prompts = ["
        }
    ],
    "stats": {
        "total": 14,
        "additions": 7,
        "deletions": 7
    }
}