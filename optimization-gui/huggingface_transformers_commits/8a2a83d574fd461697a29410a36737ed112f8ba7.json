{
    "author": "LysandreJik",
    "message": "Automatic release script (#42808)\n\n* Automatic release\n\n* Install transformers from within the build\n\n* setuptools\n\n* Check build doesn't need to exist anymore\n\n* Check build doesn't need to exist anymore\n\n* -y\n\n* torch install for pipeline\n\n* TestPypi upload\n\n* Fine tune\n\n* Fine tune\n\n* Update release instructions\n\n* Update .github/workflows/release.yml\n\nCo-authored-by: Arthur <48595927+ArthurZucker@users.noreply.github.com>\n\n---------\n\nCo-authored-by: Arthur <48595927+ArthurZucker@users.noreply.github.com>",
    "sha": "8a2a83d574fd461697a29410a36737ed112f8ba7",
    "files": [
        {
            "sha": "a54c3a98e77127c1cbfa0d816836af2d850ea827",
            "filename": ".github/workflows/release.yml",
            "status": "added",
            "additions": 60,
            "deletions": 0,
            "changes": 60,
            "blob_url": "https://github.com/huggingface/transformers/blob/8a2a83d574fd461697a29410a36737ed112f8ba7/.github%2Fworkflows%2Frelease.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/8a2a83d574fd461697a29410a36737ed112f8ba7/.github%2Fworkflows%2Frelease.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Frelease.yml?ref=8a2a83d574fd461697a29410a36737ed112f8ba7",
            "patch": "@@ -0,0 +1,60 @@\n+name: Release\n+on:\n+  push:\n+    tags:\n+      - v*\n+    branches:\n+      - 'v*-release'\n+\n+jobs:\n+  build_and_test:\n+    name: build release\n+    runs-on: ubuntu-latest\n+    steps:\n+      - uses: actions/checkout@v4\n+\n+      - name: set up python\n+        uses: actions/setup-python@v5\n+        with:\n+          python-version: \"3.13\"\n+\n+      - run: pip install setuptools\n+      - run: pip install -e .\n+      - run: make build-release\n+\n+      - run: pip uninstall -y transformers\n+      - run: pip install dist/*.whl\n+\n+      - run: python -c \"from transformers import *\"\n+\n+      - run: pip install -e .[torch]\n+      - run: python -c \"from transformers import pipeline; classifier = pipeline('text-classification'); assert classifier('What a nice release')[0]['score'] > 0\"\n+\n+      - name: Upload build artifacts\n+        uses: actions/upload-artifact@v4\n+        with:\n+          name: python-dist\n+          path: |\n+            dist/**\n+            build/**\n+\n+  upload_package:\n+    needs: build_and_test\n+    if: startsWith(github.ref, 'refs/tags/')\n+    runs-on: ubuntu-latest\n+    environment: pypi-release\n+    permissions:\n+      id-token: write\n+\n+    steps:\n+      - uses: actions/checkout@v4\n+\n+      - name: Download build artifacts\n+        uses: actions/download-artifact@v4\n+        with:\n+          name: python-dist\n+          path: .\n+\n+      - name: Publish package distributions to TestPyPI\n+        uses: pypa/gh-action-pypi-publish@release/v1\n+"
        },
        {
            "sha": "4627e3f9c4d4797320074edc72105a41ba649953",
            "filename": "Makefile",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/huggingface/transformers/blob/8a2a83d574fd461697a29410a36737ed112f8ba7/Makefile",
            "raw_url": "https://github.com/huggingface/transformers/raw/8a2a83d574fd461697a29410a36737ed112f8ba7/Makefile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/Makefile?ref=8a2a83d574fd461697a29410a36737ed112f8ba7",
            "patch": "@@ -135,4 +135,3 @@ build-release:\n \trm -rf build\n \tpython setup.py bdist_wheel\n \tpython setup.py sdist\n-\tpython utils/check_build.py"
        },
        {
            "sha": "7d9284926d6bb29672c57acc52fe842f45315202",
            "filename": "setup.py",
            "status": "modified",
            "additions": 1,
            "deletions": 29,
            "changes": 30,
            "blob_url": "https://github.com/huggingface/transformers/blob/8a2a83d574fd461697a29410a36737ed112f8ba7/setup.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/8a2a83d574fd461697a29410a36737ed112f8ba7/setup.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/setup.py?ref=8a2a83d574fd461697a29410a36737ed112f8ba7",
            "patch": "@@ -36,35 +36,7 @@\n 5. On the release branch, add a tag in git to mark the release: \"git tag v<VERSION> -m 'Adds tag v<VERSION> for pypi' \"\n    Push the tag to git: git push --tags origin v<RELEASE>-release\n \n-6. Build both the sources and the wheel. Do not change anything in setup.py between\n-   creating the wheel and the source distribution (obviously).\n-\n-   Run `make build-release`. This will build the release and do some sanity checks for you. If this ends with an error\n-   message, you need to fix things before going further.\n-\n-   You should now have a /dist directory with both .whl and .tar.gz source versions.\n-\n-7. Check that everything looks correct by uploading the package to the pypi test server:\n-\n-   twine upload dist/* -r testpypi\n-   (pypi suggest using twine as other methods upload files via plaintext.)\n-   You may have to specify the repository url, use the following command then:\n-   twine upload dist/* -r testpypi --repository-url=https://test.pypi.org/legacy/\n-\n-   Check that you can install it in a virtualenv by running:\n-   pip install -i https://test.pypi.org/simple/ transformers\n-\n-   Check you can run the following commands:\n-   python -c \"from transformers import pipeline; classifier = pipeline('text-classification'); print(classifier('What a nice release'))\"\n-   python -c \"from transformers import *\"\n-   python utils/check_build.py --check_lib\n-\n-   If making a patch release, double check the bug you are patching is indeed resolved.\n-\n-8. Upload the final version to actual pypi:\n-   twine upload dist/* -r pypi\n-\n-9. Copy the release notes from RELEASE.md to the tag in github once everything is looking hunky-dory.\n+6. Have a core maintainer review and approve the deployment to pypi.\n \"\"\"\n \n import re"
        },
        {
            "sha": "929caeb7fa0653bf3e9469ad1b23091707f43012",
            "filename": "utils/check_build.py",
            "status": "removed",
            "additions": 0,
            "deletions": 49,
            "changes": 49,
            "blob_url": "https://github.com/huggingface/transformers/blob/464dfa04460cf2c2b3fad6ebca6f11b81f663d4f/utils%2Fcheck_build.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/464dfa04460cf2c2b3fad6ebca6f11b81f663d4f/utils%2Fcheck_build.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/utils%2Fcheck_build.py?ref=464dfa04460cf2c2b3fad6ebca6f11b81f663d4f",
            "patch": "@@ -1,49 +0,0 @@\n-# coding=utf-8\n-# Copyright 2023 The HuggingFace Inc. team.\n-#\n-# Licensed under the Apache License, Version 2.0 (the \"License\");\n-# you may not use this file except in compliance with the License.\n-# You may obtain a copy of the License at\n-#\n-#     http://www.apache.org/licenses/LICENSE-2.0\n-#\n-# Unless required by applicable law or agreed to in writing, software\n-# distributed under the License is distributed on an \"AS IS\" BASIS,\n-# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n-# See the License for the specific language governing permissions and\n-# limitations under the License.\n-import argparse\n-import importlib\n-from pathlib import Path\n-\n-\n-# Test all the extensions added in the setup\n-FILES_TO_FIND = [\n-    \"kernels/rwkv/wkv_cuda.cu\",\n-    \"kernels/rwkv/wkv_op.cpp\",\n-    \"kernels/falcon_mamba/selective_scan_with_ln_interface.py\",\n-    \"kernels/falcon_mamba/__init__.py\",\n-    \"kernels/__init__.py\",\n-    \"models/graphormer/algos_graphormer.pyx\",\n-]\n-\n-\n-def test_custom_files_are_present(transformers_path):\n-    # Test all the extensions added in the setup\n-    for file in FILES_TO_FIND:\n-        if not (transformers_path / file).exists():\n-            return False\n-    return True\n-\n-\n-if __name__ == \"__main__\":\n-    parser = argparse.ArgumentParser()\n-    parser.add_argument(\"--check_lib\", action=\"store_true\", help=\"Whether to check the build or the actual package.\")\n-    args = parser.parse_args()\n-    if args.check_lib:\n-        transformers_module = importlib.import_module(\"transformers\")\n-        transformers_path = Path(transformers_module.__file__).parent\n-    else:\n-        transformers_path = Path.cwd() / \"build/lib/transformers\"\n-    if not test_custom_files_are_present(transformers_path):\n-        raise ValueError(\"The built release does not contain the custom files. Fix this before going further!\")"
        }
    ],
    "stats": {
        "total": 140,
        "additions": 61,
        "deletions": 79
    }
}