{
    "author": "tomaarsen",
    "message": "[`ModernBERT`] Never save 'reference_compile' config; should be set based on end user (#36305)\n\n* Never save 'reference_compile' config; should be set based on end user\n\n* Reformat (I ran 'make style' from the wrong env)\n\n* Use pop instead of del\n\nCo-authored-by: Matt <Rocketknight1@users.noreply.github.com>\n\n* Use pop instead of del\n\nCo-authored-by: Matt <Rocketknight1@users.noreply.github.com>\n\n---------\n\nCo-authored-by: Matt <Rocketknight1@users.noreply.github.com>",
    "sha": "897ff9af0e8892167af1eb4ec58677001c3a0041",
    "files": [
        {
            "sha": "1835f55aaec430819296ebc5925666cba7b7ce23",
            "filename": "src/transformers/models/modernbert/configuration_modernbert.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/huggingface/transformers/blob/897ff9af0e8892167af1eb4ec58677001c3a0041/src%2Ftransformers%2Fmodels%2Fmodernbert%2Fconfiguration_modernbert.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/897ff9af0e8892167af1eb4ec58677001c3a0041/src%2Ftransformers%2Fmodels%2Fmodernbert%2Fconfiguration_modernbert.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fmodernbert%2Fconfiguration_modernbert.py?ref=897ff9af0e8892167af1eb4ec58677001c3a0041",
            "patch": "@@ -214,5 +214,10 @@ def __init__(\n                 f'Invalid value for `classifier_pooling`, should be either \"cls\" or \"mean\", but is {self.classifier_pooling}.'\n             )\n \n+    def to_dict(self):\n+        output = super().to_dict()\n+        output.pop(\"reference_compile\", None)\n+        return output\n+\n \n __all__ = [\"ModernBertConfig\"]"
        },
        {
            "sha": "934931da3bfa15ea75c67aec1255db27a1facdf6",
            "filename": "src/transformers/models/modernbert/modular_modernbert.py",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/huggingface/transformers/blob/897ff9af0e8892167af1eb4ec58677001c3a0041/src%2Ftransformers%2Fmodels%2Fmodernbert%2Fmodular_modernbert.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/897ff9af0e8892167af1eb4ec58677001c3a0041/src%2Ftransformers%2Fmodels%2Fmodernbert%2Fmodular_modernbert.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fmodernbert%2Fmodular_modernbert.py?ref=897ff9af0e8892167af1eb4ec58677001c3a0041",
            "patch": "@@ -248,6 +248,11 @@ def __init__(\n                 f'Invalid value for `classifier_pooling`, should be either \"cls\" or \"mean\", but is {self.classifier_pooling}.'\n             )\n \n+    def to_dict(self):\n+        output = super().to_dict()\n+        output.pop(\"reference_compile\", None)\n+        return output\n+\n \n def _unpad_modernbert_input(\n     inputs: torch.Tensor,"
        },
        {
            "sha": "82a0f8505273e7c8439b1c7f55230fd60c6813ce",
            "filename": "tests/models/modernbert/test_modeling_modernbert.py",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/huggingface/transformers/blob/897ff9af0e8892167af1eb4ec58677001c3a0041/tests%2Fmodels%2Fmodernbert%2Ftest_modeling_modernbert.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/897ff9af0e8892167af1eb4ec58677001c3a0041/tests%2Fmodels%2Fmodernbert%2Ftest_modeling_modernbert.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fmodernbert%2Ftest_modeling_modernbert.py?ref=897ff9af0e8892167af1eb4ec58677001c3a0041",
            "patch": "@@ -12,7 +12,9 @@\n # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n # See the License for the specific language governing permissions and\n # limitations under the License.\n+import json\n import os\n+import tempfile\n import unittest\n \n import pytest\n@@ -366,6 +368,14 @@ def test_flash_attn_2_inference_equivalence_right_padding(self):\n     def test_flash_attn_2_conversion(self):\n         self.skipTest(reason=\"ModernBert doesn't use the ModernBertFlashAttention2 class method.\")\n \n+    def test_saved_config_excludes_reference_compile(self):\n+        config = ModernBertConfig(reference_compile=True)\n+        with tempfile.TemporaryDirectory() as tmpdirname:\n+            config.save_pretrained(tmpdirname)\n+            with open(os.path.join(tmpdirname, \"config.json\"), \"r\") as f:\n+                config_dict = json.load(f)\n+            self.assertNotIn(\"reference_compile\", config_dict)\n+\n \n @require_torch\n class ModernBertModelIntegrationTest(unittest.TestCase):"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 20,
        "deletions": 0
    }
}