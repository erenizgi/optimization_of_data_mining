{
    "author": "gante",
    "message": "[tests] deflake dither test (#36284)",
    "sha": "fa8cdccd91bcb6803ea50855166ed8254ea70708",
    "files": [
        {
            "sha": "7da6d94bf82c3c581fdba1f415f3a91912c61cb0",
            "filename": "src/transformers/models/audio_spectrogram_transformer/feature_extraction_audio_spectrogram_transformer.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Faudio_spectrogram_transformer%2Ffeature_extraction_audio_spectrogram_transformer.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Faudio_spectrogram_transformer%2Ffeature_extraction_audio_spectrogram_transformer.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Faudio_spectrogram_transformer%2Ffeature_extraction_audio_spectrogram_transformer.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -193,7 +193,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "6a407cdb873730d489663cc00da5b17f6b73899c",
            "filename": "src/transformers/models/clap/feature_extraction_clap.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fclap%2Ffeature_extraction_clap.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fclap%2Ffeature_extraction_clap.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fclap%2Ffeature_extraction_clap.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -308,7 +308,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "ce6f5c782e2f1fb5889883277354eb967eee8704",
            "filename": "src/transformers/models/clvp/feature_extraction_clvp.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fclvp%2Ffeature_extraction_clvp.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fclvp%2Ffeature_extraction_clvp.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fclvp%2Ffeature_extraction_clvp.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -188,7 +188,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "8e5bfadb6141e92c7ee78155fe816a298e725694",
            "filename": "src/transformers/models/dac/feature_extraction_dac.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fdac%2Ffeature_extraction_dac.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fdac%2Ffeature_extraction_dac.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fdac%2Ffeature_extraction_dac.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -108,7 +108,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "3f83c660b26d250d5d5ea058a222ed30e0c810ca",
            "filename": "src/transformers/models/encodec/feature_extraction_encodec.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fencodec%2Ffeature_extraction_encodec.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fencodec%2Ffeature_extraction_encodec.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fencodec%2Ffeature_extraction_encodec.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -132,7 +132,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "ec490b7d9048987d8b9f269aac19f6f9d8565ee3",
            "filename": "src/transformers/models/musicgen_melody/feature_extraction_musicgen_melody.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fmusicgen_melody%2Ffeature_extraction_musicgen_melody.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fmusicgen_melody%2Ffeature_extraction_musicgen_melody.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fmusicgen_melody%2Ffeature_extraction_musicgen_melody.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -242,7 +242,7 @@ def __call__(\n \n         if sampling_rate is None:\n             logger.warning_once(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "84b47cc9982e9ef8118ffcda9fcaae4fb61c423e",
            "filename": "src/transformers/models/seamless_m4t/feature_extraction_seamless_m4t.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fseamless_m4t%2Ffeature_extraction_seamless_m4t.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fseamless_m4t%2Ffeature_extraction_seamless_m4t.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fseamless_m4t%2Ffeature_extraction_seamless_m4t.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -225,7 +225,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "5473c166811de35cb0b352b5e9fa4a85c14dfc05",
            "filename": "src/transformers/models/speech_to_text/feature_extraction_speech_to_text.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fspeech_to_text%2Ffeature_extraction_speech_to_text.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fspeech_to_text%2Ffeature_extraction_speech_to_text.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fspeech_to_text%2Ffeature_extraction_speech_to_text.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -248,7 +248,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "e6b277644ce94d3a6b1dfaf2657bdf02b115f29f",
            "filename": "src/transformers/models/speecht5/feature_extraction_speecht5.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fspeecht5%2Ffeature_extraction_speecht5.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fspeecht5%2Ffeature_extraction_speecht5.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fspeecht5%2Ffeature_extraction_speecht5.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -252,7 +252,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the ``sampling_rate`` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "f9881a90c2797b2f7c64232afafb414fe644c04f",
            "filename": "src/transformers/models/univnet/feature_extraction_univnet.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Funivnet%2Ffeature_extraction_univnet.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Funivnet%2Ffeature_extraction_univnet.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Funivnet%2Ffeature_extraction_univnet.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -370,7 +370,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "3dde386b32af9b8b46308d0dc7c9e879fbff054a",
            "filename": "src/transformers/models/wav2vec2/feature_extraction_wav2vec2.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fwav2vec2%2Ffeature_extraction_wav2vec2.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fwav2vec2%2Ffeature_extraction_wav2vec2.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fwav2vec2%2Ffeature_extraction_wav2vec2.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -178,7 +178,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the ``sampling_rate`` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "af21fb7d3eca3dc8a1dd94d71585188c5831a719",
            "filename": "src/transformers/models/whisper/feature_extraction_whisper.py",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fwhisper%2Ffeature_extraction_whisper.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/src%2Ftransformers%2Fmodels%2Fwhisper%2Ffeature_extraction_whisper.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fwhisper%2Ffeature_extraction_whisper.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -255,7 +255,6 @@ def __call__(\n                 Whether or not to return the number of frames of the input raw_speech.\n                 These num_frames can be used by the model to compute word level timestamps.\n         \"\"\"\n-\n         if sampling_rate is not None:\n             if sampling_rate != self.sampling_rate:\n                 raise ValueError(\n@@ -265,7 +264,7 @@ def __call__(\n                 )\n         else:\n             logger.warning(\n-                \"It is strongly recommended to pass the `sampling_rate` argument to this function. \"\n+                f\"It is strongly recommended to pass the `sampling_rate` argument to `{self.__class__.__name__}()`. \"\n                 \"Failing to do so can result in silent errors that might be hard to debug.\"\n             )\n "
        },
        {
            "sha": "8b10b88650011a6c136348cdda7e39697061127d",
            "filename": "tests/models/speech_to_text/test_feature_extraction_speech_to_text.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/tests%2Fmodels%2Fspeech_to_text%2Ftest_feature_extraction_speech_to_text.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/tests%2Fmodels%2Fspeech_to_text%2Ftest_feature_extraction_speech_to_text.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fspeech_to_text%2Ftest_feature_extraction_speech_to_text.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -163,10 +163,10 @@ def test_dither(self):\n \n         # compute features\n         input_features_no_dither = feature_extractor_no_dither(\n-            np_speech_inputs, padding=True, return_tensors=\"np\"\n+            np_speech_inputs, padding=True, return_tensors=\"np\", sampling_rate=dict_no_dither[\"sampling_rate\"]\n         ).input_features\n         input_features_dither = feature_extractor_dither(\n-            np_speech_inputs, padding=True, return_tensors=\"np\"\n+            np_speech_inputs, padding=True, return_tensors=\"np\", sampling_rate=dict_dither[\"sampling_rate\"]\n         ).input_features\n \n         # test there is a difference between features (there's added noise to input signal)\n@@ -176,7 +176,7 @@ def test_dither(self):\n         self.assertTrue(np.abs(diff).mean() > 1e-5)\n         # features are not too different\n         self.assertTrue(np.abs(diff).mean() <= 1e-3)\n-        self.assertTrue(np.abs(diff).max() <= 1e-2)\n+        self.assertTrue(np.abs(diff).max() <= 5e-2)\n \n     def test_cepstral_mean_and_variance_normalization(self):\n         feature_extractor = self.feature_extraction_class(**self.feat_extract_tester.prepare_feat_extract_dict())"
        },
        {
            "sha": "80cb421d13236168167adce150de258af94f85fc",
            "filename": "tests/models/whisper/test_feature_extraction_whisper.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/fa8cdccd91bcb6803ea50855166ed8254ea70708/tests%2Fmodels%2Fwhisper%2Ftest_feature_extraction_whisper.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fa8cdccd91bcb6803ea50855166ed8254ea70708/tests%2Fmodels%2Fwhisper%2Ftest_feature_extraction_whisper.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Fmodels%2Fwhisper%2Ftest_feature_extraction_whisper.py?ref=fa8cdccd91bcb6803ea50855166ed8254ea70708",
            "patch": "@@ -219,10 +219,10 @@ def test_dither(self):\n \n         # compute features\n         input_features_no_dither = feature_extractor_no_dither(\n-            np_speech_inputs, padding=True, return_tensors=\"np\"\n+            np_speech_inputs, padding=True, return_tensors=\"np\", sampling_rate=dict_no_dither[\"sampling_rate\"]\n         ).input_features\n         input_features_dither = feature_extractor_dither(\n-            np_speech_inputs, padding=True, return_tensors=\"np\"\n+            np_speech_inputs, padding=True, return_tensors=\"np\", sampling_rate=dict_dither[\"sampling_rate\"]\n         ).input_features\n \n         # test there is a difference between features (there's added noise to input signal)\n@@ -232,7 +232,7 @@ def test_dither(self):\n         self.assertTrue(np.abs(diff).mean() > 1e-6)\n         # features are not too different\n         self.assertTrue(np.abs(diff).mean() <= 1e-4)\n-        self.assertTrue(np.abs(diff).max() <= 1e-3)\n+        self.assertTrue(np.abs(diff).max() <= 5e-3)\n \n     @require_torch\n     def test_double_precision_pad(self):"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 18,
        "deletions": 19
    }
}