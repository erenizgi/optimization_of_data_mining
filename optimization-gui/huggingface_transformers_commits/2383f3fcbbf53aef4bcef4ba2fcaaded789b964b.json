{
    "author": "alexmalyshev",
    "message": "Fix graphormer model compilation with Cython 3.1.4 (#41671)\n\nHitting this kind of error when running:\n\n```\ncython src/transformers/models/deprecated/graphormer/algos_graphormer.pyx\n```\n\n```\nError compiling Cython file:\n------------------------------------------------------------\n...\n    (nrows, ncols) = path.shape\n    assert nrows == ncols\n    cdef unsigned int n = nrows\n    cdef unsigned int max_dist_copy = max_dist\n\n    path_copy = path.astype(long, order='C', casting='safe', copy=True)\n                            ^\n------------------------------------------------------------\nsrc/transformers/models/deprecated/graphormer/algos_graphormer.pyx:88:28: undeclared name not builtin: long\n```\n\nThis appears to have changed between cython==3.0 and cython==3.1.  AFAICT the\ncorrect type to use here would be `int`.  Switching to it makes the command\nsucceed and generate an algos_graphormer.c file.",
    "sha": "2383f3fcbbf53aef4bcef4ba2fcaaded789b964b",
    "files": [
        {
            "sha": "bcbff6445fe109fbf5cef82b131222cc3e6eb508",
            "filename": "src/transformers/models/deprecated/graphormer/algos_graphormer.pyx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/2383f3fcbbf53aef4bcef4ba2fcaaded789b964b/src%2Ftransformers%2Fmodels%2Fdeprecated%2Fgraphormer%2Falgos_graphormer.pyx",
            "raw_url": "https://github.com/huggingface/transformers/raw/2383f3fcbbf53aef4bcef4ba2fcaaded789b964b/src%2Ftransformers%2Fmodels%2Fdeprecated%2Fgraphormer%2Falgos_graphormer.pyx",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fdeprecated%2Fgraphormer%2Falgos_graphormer.pyx?ref=2383f3fcbbf53aef4bcef4ba2fcaaded789b964b",
            "patch": "@@ -85,8 +85,8 @@ def gen_edge_input(max_dist, path, edge_feat):\n     cdef unsigned int n = nrows\n     cdef unsigned int max_dist_copy = max_dist\n \n-    path_copy = path.astype(long, order='C', casting='safe', copy=True)\n-    edge_feat_copy = edge_feat.astype(long, order='C', casting='safe', copy=True)\n+    path_copy = path.astype(int, order='C', casting='safe', copy=True)\n+    edge_feat_copy = edge_feat.astype(int, order='C', casting='safe', copy=True)\n     assert path_copy.flags['C_CONTIGUOUS']\n     assert edge_feat_copy.flags['C_CONTIGUOUS']\n "
        }
    ],
    "stats": {
        "total": 4,
        "additions": 2,
        "deletions": 2
    }
}