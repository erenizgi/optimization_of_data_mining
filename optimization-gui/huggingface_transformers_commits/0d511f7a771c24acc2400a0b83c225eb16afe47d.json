{
    "author": "ydshieh",
    "message": "Use comment to build doc on PRs (#39846)\n\n* try\n\n* try\n\n* try\n\n* try\n\n* try\n\n---------\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "0d511f7a771c24acc2400a0b83c225eb16afe47d",
    "files": [
        {
            "sha": "e3baca7c45f4cd8096e8a11a150a1c5d6cf13486",
            "filename": ".github/workflows/pr_build_doc_with_comment.yml",
            "status": "added",
            "additions": 58,
            "deletions": 0,
            "changes": 58,
            "blob_url": "https://github.com/huggingface/transformers/blob/0d511f7a771c24acc2400a0b83c225eb16afe47d/.github%2Fworkflows%2Fpr_build_doc_with_comment.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/0d511f7a771c24acc2400a0b83c225eb16afe47d/.github%2Fworkflows%2Fpr_build_doc_with_comment.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Fpr_build_doc_with_comment.yml?ref=0d511f7a771c24acc2400a0b83c225eb16afe47d",
            "patch": "@@ -0,0 +1,58 @@\n+name: PR - build doc via comment\n+on:\n+  issue_comment:\n+    types:\n+      - created\n+    branches-ignore:\n+      - main\n+concurrency:\n+  group: ${{ github.workflow }}-${{ github.event.issue.number }}-${{ startsWith(github.event.comment.body, 'build-doc') }}\n+  cancel-in-progress: true\n+permissions: {}\n+\n+\n+jobs:\n+  get-pr-number:\n+    name: Get PR number\n+    if: ${{ github.event.issue.state == 'open' && contains(fromJSON('[\"ydshieh\", \"ArthurZucker\", \"zucchini-nlp\", \"qubvel\", \"molbap\", \"gante\", \"LysandreJik\", \"Cyrilvallez\", \"Rocketknight1\", \"SunMarc\", \"muellerzr\", \"eustlb\", \"MekkCyber\", \"manueldeprada\", \"vasqu\", \"ivarflakstad\", \"stevhliu\", \"ebezzam\"]'), github.actor) && (startsWith(github.event.comment.body, 'build-doc')) }}\n+    uses: ./.github/workflows/get-pr-number.yml\n+\n+  get-pr-info:\n+    name: Get PR commit SHA\n+    needs: get-pr-number\n+    if: ${{ needs.get-pr-number.outputs.PR_NUMBER != ''}}\n+    uses: ./.github/workflows/get-pr-info.yml\n+    with:\n+      pr_number: ${{ needs.get-pr-number.outputs.PR_NUMBER }}\n+\n+  verity_pr_commit:\n+    name: Verity PR commit corresponds to a specific event by comparing timestamps\n+    if: ${{ needs.get-pr-number.outputs.PR_NUMBER != ''}}\n+    runs-on: ubuntu-22.04\n+    needs: get-pr-info\n+    env:\n+      COMMENT_DATE: ${{ github.event.comment.created_at }}\n+      PR_MERGE_COMMIT_DATE: ${{ needs.get-pr-info.outputs.PR_MERGE_COMMIT_DATE }}\n+      PR_MERGE_COMMIT_TIMESTAMP: ${{ needs.get-pr-info.outputs.PR_MERGE_COMMIT_TIMESTAMP }}\n+    steps:\n+      - run: |\n+          COMMENT_TIMESTAMP=$(date -d \"${COMMENT_DATE}\" +\"%s\")\n+          echo \"COMMENT_DATE: $COMMENT_DATE\"\n+          echo \"PR_MERGE_COMMIT_DATE: $PR_MERGE_COMMIT_DATE\"\n+          echo \"COMMENT_TIMESTAMP: $COMMENT_TIMESTAMP\"\n+          echo \"PR_MERGE_COMMIT_TIMESTAMP: $PR_MERGE_COMMIT_TIMESTAMP\"\n+          if [ $COMMENT_TIMESTAMP -le $PR_MERGE_COMMIT_TIMESTAMP ]; then\n+            echo \"Last commit on the pull request is newer than the issue comment triggering this run! Abort!\";\n+            exit -1;\n+          fi\n+\n+  build-doc:\n+    name: Build doc\n+    needs: [get-pr-number, get-pr-info]\n+    if: ${{ needs.get-pr-number.outputs.PR_NUMBER != '' }}\n+    uses: huggingface/doc-builder/.github/workflows/build_pr_documentation.yml@main\n+    with:\n+      commit_sha: ${{ needs.get-pr-info.outputs.PR_HEAD_SHA }}\n+      pr_number: ${{ needs.get-pr-number.outputs.PR_NUMBER }}\n+      package: transformers\n+      languages: ar de en es fr hi it ko pt tr zh ja te"
        },
        {
            "sha": "9b57c91e82a45a8894e3822e14230601719a5b63",
            "filename": ".github/workflows/pr_run_slow_ci.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/huggingface/transformers/blob/0d511f7a771c24acc2400a0b83c225eb16afe47d/.github%2Fworkflows%2Fpr_run_slow_ci.yml",
            "raw_url": "https://github.com/huggingface/transformers/raw/0d511f7a771c24acc2400a0b83c225eb16afe47d/.github%2Fworkflows%2Fpr_run_slow_ci.yml",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.github%2Fworkflows%2Fpr_run_slow_ci.yml?ref=0d511f7a771c24acc2400a0b83c225eb16afe47d",
            "patch": "@@ -16,28 +16,6 @@ jobs:\n     with:\n       pr_number: ${{ needs.get-pr-number.outputs.PR_NUMBER }}\n \n-  # We only need to verify the timestamp if the workflow is triggered by `issue_comment`.\n-  verity_pr_commit:\n-    name: Verity PR commit corresponds to a specific event by comparing timestamps\n-    if: ${{ github.event.comment.created_at != '' }}\n-    runs-on: ubuntu-22.04\n-    needs: get-pr-info\n-    env:\n-      COMMENT_DATE: ${{ github.event.comment.created_at }}\n-      PR_MERGE_COMMIT_DATE: ${{ needs.get-pr-info.outputs.PR_MERGE_COMMIT_DATE }}\n-      PR_MERGE_COMMIT_TIMESTAMP: ${{ needs.get-pr-info.outputs.PR_MERGE_COMMIT_TIMESTAMP }}\n-    steps:\n-      - run: |\n-          COMMENT_TIMESTAMP=$(date -d \"${COMMENT_DATE}\" +\"%s\")\n-          echo \"COMMENT_DATE: $COMMENT_DATE\"\n-          echo \"PR_MERGE_COMMIT_DATE: $PR_MERGE_COMMIT_DATE\"\n-          echo \"COMMENT_TIMESTAMP: $COMMENT_TIMESTAMP\"\n-          echo \"PR_MERGE_COMMIT_TIMESTAMP: $PR_MERGE_COMMIT_TIMESTAMP\"\n-          if [ $COMMENT_TIMESTAMP -le $PR_MERGE_COMMIT_TIMESTAMP ]; then\n-            echo \"Last commit on the pull request is newer than the issue comment triggering this run! Abort!\";\n-            exit -1;\n-          fi\n-\n   get-jobs:\n     name: Get test files to run\n     runs-on: ubuntu-22.04"
        }
    ],
    "stats": {
        "total": 80,
        "additions": 58,
        "deletions": 22
    }
}