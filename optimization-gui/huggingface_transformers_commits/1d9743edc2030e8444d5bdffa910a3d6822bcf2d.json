{
    "author": "Vishesh-Mistry",
    "message": "Updated model card for mbart and mbart50 (#37619)\n\n* new card for mbart and mbart50\n\n* removed comment BADGES\n\n* Update mBart overview\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>\n\n* fix typo (MBart to mBart)\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>\n\n* maybe fix typo\n\n* update typo and combine notes\n\n* changed notes\n\n* changed the example sentence\n\n* fixed grammatical error and removed some lines from notes example\n\n* missed one word\n\n* removed documentation resources and added some lines of example code back in notes.\n\n---------\n\nCo-authored-by: Steven Liu <59462357+stevhliu@users.noreply.github.com>",
    "sha": "1d9743edc2030e8444d5bdffa910a3d6822bcf2d",
    "files": [
        {
            "sha": "58cf1de3b7e1aaada474d7511dbdb7245e242148",
            "filename": "docs/source/en/model_doc/mbart.md",
            "status": "modified",
            "additions": 72,
            "deletions": 121,
            "changes": 193,
            "blob_url": "https://github.com/huggingface/transformers/blob/1d9743edc2030e8444d5bdffa910a3d6822bcf2d/docs%2Fsource%2Fen%2Fmodel_doc%2Fmbart.md",
            "raw_url": "https://github.com/huggingface/transformers/raw/1d9743edc2030e8444d5bdffa910a3d6822bcf2d/docs%2Fsource%2Fen%2Fmodel_doc%2Fmbart.md",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docs%2Fsource%2Fen%2Fmodel_doc%2Fmbart.md?ref=1d9743edc2030e8444d5bdffa910a3d6822bcf2d",
            "patch": "@@ -14,154 +14,105 @@ rendered properly in your Markdown viewer.\n \n -->\n \n-# MBart and MBart-50\n-\n-<div class=\"flex flex-wrap space-x-1\">\n-<img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n-<img alt=\"TensorFlow\" src=\"https://img.shields.io/badge/TensorFlow-FF6F00?style=flat&logo=tensorflow&logoColor=white\">\n-<img alt=\"Flax\" src=\"https://img.shields.io/badge/Flax-29a79b.svg?style=flat&logo=data:image/png;base64,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\n-\">\n-<img alt=\"FlashAttention\" src=\"https://img.shields.io/badge/%E2%9A%A1%EF%B8%8E%20FlashAttention-eae0c8?style=flat\">\n-<img alt=\"SDPA\" src=\"https://img.shields.io/badge/SDPA-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+<div style=\"float: right;\">\n+  <div class=\"flex flex-wrap space-x-1\">\n+    <img alt=\"PyTorch\" src=\"https://img.shields.io/badge/PyTorch-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+    <img alt=\"TensorFlow\" src=\"https://img.shields.io/badge/TensorFlow-FF6F00?style=flat&logo=tensorflow&logoColor=white\">\n+    <img alt=\"Flax\" src=\"https://img.shields.io/badge/Flax-29a79b.svg?style=flat\">\n+    <img alt=\"FlashAttention\" src=\"https://img.shields.io/badge/%E2%9A%A1%EF%B8%8E%20FlashAttention-eae0c8?style=flat\">\n+    <img alt=\"SDPA\" src=\"https://img.shields.io/badge/SDPA-DE3412?style=flat&logo=pytorch&logoColor=white\">\n+  </div>\n </div>\n \n+# mBART\n \n-## Overview of MBart\n+[mBART](https://huggingface.co/papers/2001.08210) is a multilingual machine translation model that pretrains the entire translation model (encoder-decoder) unlike previous methods that only focused on parts of the model. The model is trained on a denoising objective which reconstructs the corrupted text. This allows mBART to handle the source language and the target text to translate to.\n \n-The MBart model was presented in [Multilingual Denoising Pre-training for Neural Machine Translation](https://arxiv.org/abs/2001.08210) by Yinhan Liu, Jiatao Gu, Naman Goyal, Xian Li, Sergey Edunov Marjan\n-Ghazvininejad, Mike Lewis, Luke Zettlemoyer.\n+[mBART-50](https://huggingface.co/paper/2008.00401) is pretrained on an additional 25 languages.\n \n-According to the abstract, MBART is a sequence-to-sequence denoising auto-encoder pretrained on large-scale monolingual\n-corpora in many languages using the BART objective. mBART is one of the first methods for pretraining a complete\n-sequence-to-sequence model by denoising full texts in multiple languages, while previous approaches have focused only\n-on the encoder, decoder, or reconstructing parts of the text.\n+You can find all the original mBART checkpoints under the [AI at Meta](https://huggingface.co/facebook?search_models=mbart) organization.\n \n-This model was contributed by [valhalla](https://huggingface.co/valhalla). The Authors' code can be found [here](https://github.com/pytorch/fairseq/tree/master/examples/mbart)\n+> [!TIP]\n+> Click on the mBART models in the right sidebar for more examples of applying mBART to different language tasks.\n \n-### Training of MBart\n+The example below demonstrates how to translate text with [`Pipeline`] or the [`AutoModel`] class.\n \n-MBart is a multilingual encoder-decoder (sequence-to-sequence) model primarily intended for translation task. As the\n-model is multilingual it expects the sequences in a different format. A special language id token is added in both the\n-source and target text. The source text format is `X [eos, src_lang_code]` where `X` is the source text. The\n-target text format is `[tgt_lang_code] X [eos]`. `bos` is never used.\n+<hfoptions id=\"usage\">\n+<hfoption id=\"Pipeline\">\n \n-The regular [`~MBartTokenizer.__call__`] will encode source text format passed as first argument or with the `text`\n-keyword, and target text format passed with the `text_label` keyword argument.\n+```py\n+import torch\n+from transformers import pipeline\n \n-- Supervised training\n-\n-```python\n->>> from transformers import MBartForConditionalGeneration, MBartTokenizer\n-\n->>> tokenizer = MBartTokenizer.from_pretrained(\"facebook/mbart-large-en-ro\", src_lang=\"en_XX\", tgt_lang=\"ro_RO\")\n->>> example_english_phrase = \"UN Chief Says There Is No Military Solution in Syria\"\n->>> expected_translation_romanian = \"Şeful ONU declară că nu există o soluţie militară în Siria\"\n-\n->>> inputs = tokenizer(example_english_phrase, text_target=expected_translation_romanian, return_tensors=\"pt\")\n-\n->>> model = MBartForConditionalGeneration.from_pretrained(\"facebook/mbart-large-en-ro\")\n->>> # forward pass\n->>> model(**inputs)\n-```\n-\n-- Generation\n-\n-  While generating the target text set the `decoder_start_token_id` to the target language id. The following\n-  example shows how to translate English to Romanian using the *facebook/mbart-large-en-ro* model.\n-\n-```python\n->>> from transformers import MBartForConditionalGeneration, MBartTokenizer\n-\n->>> tokenizer = MBartTokenizer.from_pretrained(\"facebook/mbart-large-en-ro\", src_lang=\"en_XX\")\n->>> article = \"UN Chief Says There Is No Military Solution in Syria\"\n->>> inputs = tokenizer(article, return_tensors=\"pt\")\n->>> translated_tokens = model.generate(**inputs, decoder_start_token_id=tokenizer.lang_code_to_id[\"ro_RO\"])\n->>> tokenizer.batch_decode(translated_tokens, skip_special_tokens=True)[0]\n-\"Şeful ONU declară că nu există o soluţie militară în Siria\"\n+pipeline = pipeline(\n+    task=\"translation\",\n+    model=\"facebook/mbart-large-50-many-to-many-mmt\",\n+    device=0,\n+    torch_dtype=torch.float16,\n+    src_lang=\"en_XX\",\n+    tgt_lang=\"fr_XX\",\n+)\n+print(pipeline(\"UN Chief Says There Is No Military Solution in Syria\"))\n ```\n \n-## Overview of MBart-50\n-\n-MBart-50 was introduced in the [Multilingual Translation with Extensible Multilingual Pretraining and Finetuning](https://arxiv.org/abs/2008.00401) paper by Yuqing Tang, Chau Tran, Xian Li, Peng-Jen Chen, Naman Goyal, Vishrav\n-Chaudhary, Jiatao Gu, Angela Fan. MBart-50 is created using the original *mbart-large-cc25* checkpoint by extending\n-its embedding layers with randomly initialized vectors for an extra set of 25 language tokens and then pretrained on 50\n-languages.\n+</hfoption>\n+<hfoption id=\"AutoModel\">\n \n-According to the abstract\n+```py\n+import torch\n+from transformers import AutoModelForSeq2SeqLM, AutoTokenizer\n \n-*Multilingual translation models can be created through multilingual finetuning. Instead of finetuning on one\n-direction, a pretrained model is finetuned on many directions at the same time. It demonstrates that pretrained models\n-can be extended to incorporate additional languages without loss of performance. Multilingual finetuning improves on\n-average 1 BLEU over the strongest baselines (being either multilingual from scratch or bilingual finetuning) while\n-improving 9.3 BLEU on average over bilingual baselines from scratch.*\n+article_en = \"UN Chief Says There Is No Military Solution in Syria\"\n \n+model = AutoModelForSeq2SeqLM.from_pretrained(\"facebook/mbart-large-50-many-to-many-mmt\", torch_dtype=torch.bfloat16, attn_implementation=\"sdpa\", device_map=\"auto\")\n+tokenizer = AutoTokenizer.from_pretrained(\"facebook/mbart-large-50-many-to-many-mmt\")\n \n-### Training of MBart-50\n-\n-The text format for MBart-50 is slightly different from mBART. For MBart-50 the language id token is used as a prefix\n-for both source and target text i.e the text format is `[lang_code] X [eos]`, where `lang_code` is source\n-language id for source text and target language id for target text, with `X` being the source or target text\n-respectively.\n-\n-\n-MBart-50 has its own tokenizer [`MBart50Tokenizer`].\n-\n--  Supervised training\n-\n-```python\n-from transformers import MBartForConditionalGeneration, MBart50TokenizerFast\n-\n-model = MBartForConditionalGeneration.from_pretrained(\"facebook/mbart-large-50\")\n-tokenizer = MBart50TokenizerFast.from_pretrained(\"facebook/mbart-large-50\", src_lang=\"en_XX\", tgt_lang=\"ro_RO\")\n+tokenizer.src_lang = \"en_XX\"\n+encoded_hi = tokenizer(article_en, return_tensors=\"pt\").to(\"cuda\")\n+generated_tokens = model.generate(**encoded_hi, forced_bos_token_id=tokenizer.lang_code_to_id[\"fr_XX\"], cache_implementation=\"static\")\n+print(tokenizer.batch_decode(generated_tokens, skip_special_tokens=True))\n+```\n \n-src_text = \" UN Chief Says There Is No Military Solution in Syria\"\n-tgt_text = \"Şeful ONU declară că nu există o soluţie militară în Siria\"\n+</hfoption>\n+</hfoptions>\n \n-model_inputs = tokenizer(src_text, text_target=tgt_text, return_tensors=\"pt\")\n+## Notes\n \n-model(**model_inputs)  # forward pass\n-```\n+- You can check the full list of language codes via `tokenizer.lang_code_to_id.keys()`.\n+- mBART requires a special language id token in the source and target text during training. The source text format is `X [eos, src_lang_code]` where `X` is the source text. The target text format is `[tgt_lang_code] X [eos]`. The `bos` token is never used. The [`~PreTrainedTokenizerBase._call_`] encodes the source text format passed as the first argument or with the `text` keyword. The target text format is passed with the `text_label` keyword.\n+- Set the `decoder_start_token_id` to the target language id for mBART.\n \n-- Generation\n+    ```py\n+    import torch\n+    from transformers import AutoModelForSeq2SeqLM, AutoTokenizer\n \n-  To generate using the mBART-50 multilingual translation models, `eos_token_id` is used as the\n-  `decoder_start_token_id` and the target language id is forced as the first generated token. To force the\n-  target language id as the first generated token, pass the *forced_bos_token_id* parameter to the *generate* method.\n-  The following example shows how to translate between Hindi to French and Arabic to English using the\n-  *facebook/mbart-50-large-many-to-many* checkpoint.\n+    model = AutoModelForSeq2SeqLM.from_pretrained(\"facebook/mbart-large-en-ro\", torch_dtype=torch.bfloat16, attn_implementation=\"sdpa\", device_map=\"auto\")\n+    tokenizer = MBartTokenizer.from_pretrained(\"facebook/mbart-large-en-ro\", src_lang=\"en_XX\")\n \n-```python\n-from transformers import MBartForConditionalGeneration, MBart50TokenizerFast\n+    article = \"UN Chief Says There Is No Military Solution in Syria\"\n+    inputs = tokenizer(article, return_tensors=\"pt\")\n \n-article_hi = \"संयुक्त राष्ट्र के प्रमुख का कहना है कि सीरिया में कोई सैन्य समाधान नहीं है\"\n-article_ar = \"الأمين العام للأمم المتحدة يقول إنه لا يوجد حل عسكري في سوريا.\"\n+    translated_tokens = model.generate(**inputs, decoder_start_token_id=tokenizer.lang_code_to_id[\"ro_RO\"])\n+    tokenizer.batch_decode(translated_tokens, skip_special_tokens=True)[0]\n+    ```\n \n-model = MBartForConditionalGeneration.from_pretrained(\"facebook/mbart-large-50-many-to-many-mmt\")\n-tokenizer = MBart50TokenizerFast.from_pretrained(\"facebook/mbart-large-50-many-to-many-mmt\")\n+- mBART-50 has a different text format. The language id token is used as the prefix for the source and target text. The text format is `[lang_code] X [eos]` where `lang_code` is the source language id for the source text and target language id for the target text. `X` is the source or target text respectively.\n+- Set the `eos_token_id` as the `decoder_start_token_id` for mBART-50. The target language id is used as the first generated token by passing `forced_bos_token_id` to [`~GenerationMixin.generate`].\n \n-# translate Hindi to French\n-tokenizer.src_lang = \"hi_IN\"\n-encoded_hi = tokenizer(article_hi, return_tensors=\"pt\")\n-generated_tokens = model.generate(**encoded_hi, forced_bos_token_id=tokenizer.lang_code_to_id[\"fr_XX\"])\n-tokenizer.batch_decode(generated_tokens, skip_special_tokens=True)\n-# => \"Le chef de l 'ONU affirme qu 'il n 'y a pas de solution militaire en Syria.\"\n+    ```py\n+    import torch\n+    from transformers import AutoModelForSeq2SeqLM, AutoTokenizer\n \n-# translate Arabic to English\n-tokenizer.src_lang = \"ar_AR\"\n-encoded_ar = tokenizer(article_ar, return_tensors=\"pt\")\n-generated_tokens = model.generate(**encoded_ar, forced_bos_token_id=tokenizer.lang_code_to_id[\"en_XX\"])\n-tokenizer.batch_decode(generated_tokens, skip_special_tokens=True)\n-# => \"The Secretary-General of the United Nations says there is no military solution in Syria.\"\n-```\n+    model = AutoModelForSeq2SeqLM.from_pretrained(\"facebook/mbart-large-50-many-to-many-mmt\", torch_dtype=torch.bfloat16, attn_implementation=\"sdpa\", device_map=\"auto\")\n+    tokenizer = MBartTokenizer.from_pretrained(\"facebook/mbart-large-50-many-to-many-mmt\")\n \n-## Documentation resources\n+    article_ar = \"الأمين العام للأمم المتحدة يقول إنه لا يوجد حل عسكري في سوريا.\"\n+    tokenizer.src_lang = \"ar_AR\"\n \n-- [Text classification task guide](../tasks/sequence_classification)\n-- [Question answering task guide](../tasks/question_answering)\n-- [Causal language modeling task guide](../tasks/language_modeling)\n-- [Masked language modeling task guide](../tasks/masked_language_modeling)\n-- [Translation task guide](../tasks/translation)\n-- [Summarization task guide](../tasks/summarization)\n+    encoded_ar = tokenizer(article_ar, return_tensors=\"pt\")\n+    generated_tokens = model.generate(**encoded_ar, forced_bos_token_id=tokenizer.lang_code_to_id[\"en_XX\"])\n+    tokenizer.batch_decode(generated_tokens, skip_special_tokens=True)\n+    ```\n \n ## MBartConfig\n \n@@ -253,4 +204,4 @@ tokenizer.batch_decode(generated_tokens, skip_special_tokens=True)\n     - decode\n \n </jax>\n-</frameworkcontent>\n+</frameworkcontent>\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 193,
        "additions": 72,
        "deletions": 121
    }
}