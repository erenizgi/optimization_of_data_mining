{
    "author": "Tavish9",
    "message": "Convert `_VALID_DICT_FIELDS` to class attribute for shared dict parsing in subclasses (#36736)\n\n* make _VALID_DICT_FIELDS as a class attribute\n\n* fix test case about TrainingArguments",
    "sha": "fac70ff3c084fc5dbcaadc8651ad57354c088bdb",
    "files": [
        {
            "sha": "0e153df47a289ff24afd5f2c200c8f13f5178bc6",
            "filename": "src/transformers/training_args.py",
            "status": "modified",
            "additions": 13,
            "deletions": 14,
            "changes": 27,
            "blob_url": "https://github.com/huggingface/transformers/blob/fac70ff3c084fc5dbcaadc8651ad57354c088bdb/src%2Ftransformers%2Ftraining_args.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fac70ff3c084fc5dbcaadc8651ad57354c088bdb/src%2Ftransformers%2Ftraining_args.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftraining_args.py?ref=fac70ff3c084fc5dbcaadc8651ad57354c088bdb",
            "patch": "@@ -188,19 +188,6 @@ class OptimizerNames(ExplicitEnum):\n     APOLLO_ADAMW_LAYERWISE = \"apollo_adamw_layerwise\"\n \n \n-# Sometimes users will pass in a `str` repr of a dict in the CLI\n-# We need to track what fields those can be. Each time a new arg\n-# has a dict type, it must be added to this list.\n-# Important: These should be typed with Optional[Union[dict,str,...]]\n-_VALID_DICT_FIELDS = [\n-    \"accelerator_config\",\n-    \"fsdp_config\",\n-    \"deepspeed\",\n-    \"gradient_checkpointing_kwargs\",\n-    \"lr_scheduler_kwargs\",\n-]\n-\n-\n def _convert_str_dict(passed_value: dict):\n     \"Safely checks that a passed value is a dictionary and converts any string values to their appropriate types.\"\n     for key, value in passed_value.items():\n@@ -814,6 +801,18 @@ class TrainingArguments:\n             https://github.com/huggingface/transformers/issues/34242\n     \"\"\"\n \n+    # Sometimes users will pass in a `str` repr of a dict in the CLI\n+    # We need to track what fields those can be. Each time a new arg\n+    # has a dict type, it must be added to this list.\n+    # Important: These should be typed with Optional[Union[dict,str,...]]\n+    _VALID_DICT_FIELDS = [\n+        \"accelerator_config\",\n+        \"fsdp_config\",\n+        \"deepspeed\",\n+        \"gradient_checkpointing_kwargs\",\n+        \"lr_scheduler_kwargs\",\n+    ]\n+\n     framework = \"pt\"\n     output_dir: Optional[str] = field(\n         default=None,\n@@ -1561,7 +1560,7 @@ def __post_init__(self):\n             )\n \n         # Parse in args that could be `dict` sent in from the CLI as a string\n-        for field in _VALID_DICT_FIELDS:\n+        for field in self._VALID_DICT_FIELDS:\n             passed_value = getattr(self, field)\n             # We only want to do this if the str starts with a bracket to indicate a `dict`\n             # else its likely a filename if supported"
        },
        {
            "sha": "56bb553bf32a7c78e24833b0fb2964f45e8729c1",
            "filename": "tests/utils/test_hf_argparser.py",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/huggingface/transformers/blob/fac70ff3c084fc5dbcaadc8651ad57354c088bdb/tests%2Futils%2Ftest_hf_argparser.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fac70ff3c084fc5dbcaadc8651ad57354c088bdb/tests%2Futils%2Ftest_hf_argparser.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/tests%2Futils%2Ftest_hf_argparser.py?ref=fac70ff3c084fc5dbcaadc8651ad57354c088bdb",
            "patch": "@@ -29,7 +29,6 @@\n from transformers import HfArgumentParser, TrainingArguments\n from transformers.hf_argparser import make_choice_type_function, string_to_bool\n from transformers.testing_utils import require_torch\n-from transformers.training_args import _VALID_DICT_FIELDS\n \n \n # Since Python 3.10, we can use the builtin `|` operator for Union types\n@@ -412,7 +411,8 @@ def test_parse_yaml(self):\n         args = BasicExample(**args_dict_for_yaml)\n         self.assertEqual(parsed_args, args)\n \n-    def test_integration_training_args(self):\n+    def test_z_integration_training_args(self):\n+        # make sure that this test executes last in the test suite\n         parser = HfArgumentParser(TrainingArguments)\n         self.assertIsNotNone(parser)\n \n@@ -424,7 +424,7 @@ def test_valid_dict_annotation(self):\n         If this fails, a type annotation change is\n         needed on a new input\n         \"\"\"\n-        base_list = _VALID_DICT_FIELDS.copy()\n+        base_list = TrainingArguments._VALID_DICT_FIELDS.copy()\n         args = TrainingArguments\n \n         # First find any annotations that contain `dict`\n@@ -468,7 +468,7 @@ def test_valid_dict_annotation(self):\n             self.assertIn(\n                 field.name,\n                 base_list,\n-                f\"Optional dict field `{field.name}` is not in the base list of valid fields. Please add it to `training_args._VALID_DICT_FIELDS`\",\n+                f\"Optional dict field `{field.name}` is not in the base list of valid fields. Please add it to `TrainingArguments._VALID_DICT_FIELDS`\",\n             )\n \n     @require_torch"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 17,
        "deletions": 18
    }
}