{
    "author": "ydshieh",
    "message": "Fix CircleCI step passes in the case of pytest worker crash at test collection time (#40552)\n\nfix\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "6546f288a1a29f2b204a8e0a05883d4c815d77e6",
    "files": [
        {
            "sha": "c55b6fc8e30872ba9d395c55b8e9db7f28317363",
            "filename": ".circleci/create_circleci_config.py",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/huggingface/transformers/blob/6546f288a1a29f2b204a8e0a05883d4c815d77e6/.circleci%2Fcreate_circleci_config.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/6546f288a1a29f2b204a8e0a05883d4c815d77e6/.circleci%2Fcreate_circleci_config.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.circleci%2Fcreate_circleci_config.py?ref=6546f288a1a29f2b204a8e0a05883d4c815d77e6",
            "patch": "@@ -182,6 +182,22 @@ def to_dict(self):\n                 \"name\": \"Run tests\",\n                 \"command\": f\"({timeout_cmd} python3 -m pytest {marker_cmd} -n {self.pytest_num_workers} {junit_flags} {repeat_on_failure_flags} {' '.join(pytest_flags)} $(cat splitted_tests.txt) | tee tests_output.txt)\"}\n             },\n+            {\"run\":\n+                {\n+                    \"name\": \"Check for test crashes\",\n+                    \"when\": \"always\",\n+                    \"command\": \"\"\"if [ ! -f tests_output.txt ]; then\n+                            echo \"ERROR: tests_output.txt does not exist - tests may not have run properly\"\n+                            exit 1\n+                        elif grep -q \"crashed and worker restarting disabled\" tests_output.txt; then\n+                            echo \"ERROR: Worker crash detected in test output\"\n+                            echo \"Found: crashed and worker restarting disabled\"\n+                            exit 1\n+                        else\n+                            echo \"Tests output file exists and no worker crashes detected\"\n+                        fi\"\"\"\n+                },\n+            },\n             {\"run\": {\"name\": \"Expand to show skipped tests\", \"when\": \"always\", \"command\": f\"python3 .circleci/parse_test_outputs.py --file tests_output.txt --skip\"}},\n             {\"run\": {\"name\": \"Failed tests: show reasons\",   \"when\": \"always\", \"command\": f\"python3 .circleci/parse_test_outputs.py --file tests_output.txt --fail\"}},\n             {\"run\": {\"name\": \"Errors\",                       \"when\": \"always\", \"command\": f\"python3 .circleci/parse_test_outputs.py --file tests_output.txt --errors\"}},"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 16,
        "deletions": 0
    }
}