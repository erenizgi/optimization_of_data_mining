{
    "author": "ydshieh",
    "message": "Use torch 2.7.1 on CircleCI jobs (#37856)\n\n2.7.1\n\nCo-authored-by: ydshieh <ydshieh@users.noreply.github.com>",
    "sha": "90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c",
    "files": [
        {
            "sha": "058afd029a6b92092caf202027d9223f325cd180",
            "filename": ".circleci/create_circleci_config.py",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/huggingface/transformers/blob/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/.circleci%2Fcreate_circleci_config.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/.circleci%2Fcreate_circleci_config.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/.circleci%2Fcreate_circleci_config.py?ref=90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c",
            "patch": "@@ -213,7 +213,7 @@ def job_name(self):\n     docker_image=[{\"image\": \"huggingface/transformers-torch-light\"}],\n     # networkx==3.3 (after #36957) cause some issues\n     # TODO: remove this once it works directly\n-    install_steps=[\"uv venv && uv pip install . && uv pip install networkx==3.2.1\"],\n+    install_steps=[\"uv venv && uv pip install .\"],\n     marker=\"generate\",\n     parallelism=6,\n )\n@@ -309,7 +309,7 @@ def job_name(self):\n     docker_image=[{\"image\":\"huggingface/transformers-torch-tf-light\"}],\n     install_steps=[\n         \"uv venv\",\n-        \"uv pip install .[torch,tf,testing,sentencepiece,onnxruntime,vision,rjieba]\",\n+        \"uv pip install .[testing,sentencepiece,onnxruntime,vision,rjieba]\",\n     ],\n     pytest_options={\"k onnx\": None},\n     pytest_num_workers=1,\n@@ -338,7 +338,7 @@ def job_name(self):\n     docker_image=[{\"image\": \"huggingface/transformers-torch-light\"}],\n     # networkx==3.3 (after #36957) cause some issues\n     # TODO: remove this once it works directly\n-    install_steps=[\"uv venv && uv pip install . && uv pip install networkx==3.2.1\"],\n+    install_steps=[\"uv venv && uv pip install .\"],\n     marker=\"not generate\",\n     parallelism=6,\n )"
        },
        {
            "sha": "5b35a5f85dcd96b7caf91bc3679d70424cd4426b",
            "filename": "docker/consistency.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fconsistency.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fconsistency.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fconsistency.dockerfile?ref=90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c",
            "patch": "@@ -5,7 +5,7 @@ ARG REF=main\n RUN apt-get update && apt-get install -y time git g++ pkg-config make git-lfs\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip install uv && uv venv && uv pip install --no-cache-dir -U pip setuptools GitPython\n-RUN uv pip install --no-cache-dir --upgrade 'torch==2.6.0' 'torchaudio==2.6.0' 'torchvision==0.21.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir --upgrade 'torch' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n # tensorflow pin matching setup.py\n RUN uv pip install --no-cache-dir pypi-kenlm\n RUN uv pip install --no-cache-dir \"tensorflow-cpu<2.16\" \"tf-keras<2.16\""
        },
        {
            "sha": "a0a9f5ea23b73fdebd74ffe0d708fbed23119a8b",
            "filename": "docker/custom-tokenizers.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fcustom-tokenizers.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fcustom-tokenizers.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fcustom-tokenizers.dockerfile?ref=90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c",
            "patch": "@@ -16,7 +16,7 @@ RUN cmake .. -DCMAKE_INSTALL_PREFIX=/usr/local\n RUN make install -j 10\n \n \n-RUN uv pip install --no-cache --upgrade 'torch==2.6.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache --upgrade 'torch' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir  --no-deps accelerate --extra-index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install  --no-cache-dir \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[ja,testing,sentencepiece,jieba,spacy,ftfy,rjieba]\" unidic unidic-lite\n # spacy is not used so not tested. Causes to failures. TODO fix later"
        },
        {
            "sha": "1302774ae4248b2af91111d64317ed08dfbb2e2f",
            "filename": "docker/examples-torch.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fexamples-torch.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fexamples-torch.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fexamples-torch.dockerfile?ref=90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c",
            "patch": "@@ -5,7 +5,7 @@ USER root\n RUN apt-get update &&  apt-get install -y --no-install-recommends libsndfile1-dev espeak-ng time git g++ cmake pkg-config openssh-client git\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv venv && uv pip install --no-cache-dir -U pip setuptools\n-RUN uv pip install --no-cache-dir 'torch==2.6.0' 'torchaudio==2.6.0' 'torchvision==0.21.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-deps timm accelerate --extra-index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir librosa \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[sklearn,sentencepiece,vision,testing]\" seqeval albumentations jiwer\n RUN uv pip uninstall transformers"
        },
        {
            "sha": "988f06d78e78914c91193654e7979d89bdfd7947",
            "filename": "docker/exotic-models.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fexotic-models.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fexotic-models.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fexotic-models.dockerfile?ref=90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c",
            "patch": "@@ -5,7 +5,7 @@ USER root\n RUN apt-get update && apt-get install -y libsndfile1-dev espeak-ng time git libgl1-mesa-glx libgl1 g++ tesseract-ocr\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv &&  uv venv && uv pip install --no-cache-dir -U pip setuptools\n-RUN uv pip install --no-cache-dir 'torch==2.6.0' 'torchaudio==2.6.0' 'torchvision==0.21.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir  --no-deps timm accelerate\n RUN pip install -U --upgrade-strategy eager --no-cache-dir pytesseract python-Levenshtein opencv-python nltk\n # RUN uv pip install --no-cache-dir natten==0.15.1+torch210cpu -f https://shi-labs.com/natten/wheels"
        },
        {
            "sha": "155cfcd5acb249a8e7765cda6546425a54ca1eb5",
            "filename": "docker/pipeline-torch.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fpipeline-torch.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Fpipeline-torch.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Fpipeline-torch.dockerfile?ref=90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c",
            "patch": "@@ -5,7 +5,7 @@ USER root\n RUN apt-get update &&  apt-get install -y --no-install-recommends libsndfile1-dev espeak-ng time git pkg-config openssh-client git\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv venv && uv pip install --no-cache-dir -U pip setuptools\n-RUN uv pip install --no-cache-dir --upgrade 'torch==2.6.0' 'torchaudio==2.6.0' 'torchvision==0.21.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-deps timm accelerate --extra-index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir librosa \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[sklearn,sentencepiece,vision,testing]\"\n RUN uv pip uninstall transformers"
        },
        {
            "sha": "b46a2d3912722186d4cb188278d1db7c718e6047",
            "filename": "docker/torch-light.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Ftorch-light.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Ftorch-light.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Ftorch-light.dockerfile?ref=90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c",
            "patch": "@@ -5,7 +5,7 @@ USER root\n RUN apt-get update &&  apt-get install -y --no-install-recommends libsndfile1-dev espeak-ng time git g++ cmake pkg-config openssh-client git git-lfs\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv venv && uv pip install --no-cache-dir -U pip setuptools\n-RUN uv pip install --no-cache-dir --upgrade 'torch==2.6.0' 'torchaudio==2.6.0' 'torchvision==0.21.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-deps timm accelerate --extra-index-url https://download.pytorch.org/whl/cpu\n RUN uv pip install --no-cache-dir librosa \"git+https://github.com/huggingface/transformers.git@${REF}#egg=transformers[sklearn,sentencepiece,vision,testing,tiktoken,num2words,video]\"\n RUN uv pip uninstall transformers"
        },
        {
            "sha": "7268027a878ddb0b7b3eb73a0144885b2aad6e44",
            "filename": "docker/torch-tf-light.dockerfile",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Ftorch-tf-light.dockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c/docker%2Ftorch-tf-light.dockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Ftorch-tf-light.dockerfile?ref=90c4b90a100be1ed8cb9b250aec5bf453e7ddf2c",
            "patch": "@@ -7,7 +7,7 @@ RUN apt-get update &&  apt-get install -y --no-install-recommends libsndfile1-de\n ENV UV_PYTHON=/usr/local/bin/python\n RUN pip --no-cache-dir install uv && uv venv && uv pip install --no-cache-dir -U pip setuptools\n RUN uv pip install --no-cache-dir  --no-deps accelerate --extra-index-url https://download.pytorch.org/whl/cpu \n-RUN uv pip install --no-cache-dir 'torch==2.6.0' 'torchaudio==2.6.0' 'torchvision==0.21.0' --index-url https://download.pytorch.org/whl/cpu\n+RUN uv pip install --no-cache-dir 'torch' 'torchaudio' 'torchvision' --index-url https://download.pytorch.org/whl/cpu\n RUN git lfs install\n \n RUN uv pip install --no-cache-dir pypi-kenlm"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 10,
        "deletions": 10
    }
}