{
    "author": "tim120526",
    "message": "Fix multi-video timestamp bug in Qwen-3-VL and GLM4V (#41229)\n\n* fix multi-video timestamp bug in qwen3vl,glm4v\n\n* run make fix-copies to sync modular files\n\n* run make fix-copies to sync modular files\n\n---------\n\nCo-authored-by: UBT <daqin.luo@ubtrobot.com>",
    "sha": "aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86",
    "files": [
        {
            "sha": "b8600713a5eda7d787c756abb1d3cca0564d6449",
            "filename": "src/transformers/models/glm4v/modular_glm4v.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86/src%2Ftransformers%2Fmodels%2Fglm4v%2Fmodular_glm4v.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86/src%2Ftransformers%2Fmodels%2Fglm4v%2Fmodular_glm4v.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fglm4v%2Fmodular_glm4v.py?ref=aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86",
            "patch": "@@ -1639,7 +1639,7 @@ def __call__(\n                     num_frames = video_grid_thw[video_index][0]\n                     video_structure = \"\"\n \n-                    metadata = video_metadata[i]\n+                    metadata = video_metadata[video_index]\n                     if metadata.fps is None:\n                         logger.warning_once(\n                             \"SmolVLM requires frame timestamps to construct prompts, but the `fps` of the input video could not be inferred. \""
        },
        {
            "sha": "bd7d24e800f7fa327cad2ae43ecda1d2cdeea66e",
            "filename": "src/transformers/models/glm4v/processing_glm4v.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86/src%2Ftransformers%2Fmodels%2Fglm4v%2Fprocessing_glm4v.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86/src%2Ftransformers%2Fmodels%2Fglm4v%2Fprocessing_glm4v.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fglm4v%2Fprocessing_glm4v.py?ref=aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86",
            "patch": "@@ -178,7 +178,7 @@ def __call__(\n                     num_frames = video_grid_thw[video_index][0]\n                     video_structure = \"\"\n \n-                    metadata = video_metadata[i]\n+                    metadata = video_metadata[video_index]\n                     if metadata.fps is None:\n                         logger.warning_once(\n                             \"SmolVLM requires frame timestamps to construct prompts, but the `fps` of the input video could not be inferred. \""
        },
        {
            "sha": "7f6a81919980e5d5693bb8a806862b49808ff40e",
            "filename": "src/transformers/models/qwen3_vl/modular_qwen3_vl.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fmodular_qwen3_vl.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fmodular_qwen3_vl.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fmodular_qwen3_vl.py?ref=aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86",
            "patch": "@@ -1396,7 +1396,7 @@ def __call__(\n             index = 0\n             for i in range(len(text)):\n                 while self.video_token in text[i]:\n-                    metadata = video_metadata[i]\n+                    metadata = video_metadata[index]\n                     if metadata.fps is None:\n                         logger.warning_once(\n                             \"Qwen3VL requires frame timestamps to construct prompts, but the `fps` of the input video could not be inferred. \""
        },
        {
            "sha": "03c709cb0b3f5594e13f2fb47cef294dffbf8b9b",
            "filename": "src/transformers/models/qwen3_vl/processing_qwen3_vl.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fprocessing_qwen3_vl.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fprocessing_qwen3_vl.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fqwen3_vl%2Fprocessing_qwen3_vl.py?ref=aabf0a03cb5ebf34bf17cf157c88a34a76cb8a86",
            "patch": "@@ -196,7 +196,7 @@ def __call__(\n             index = 0\n             for i in range(len(text)):\n                 while self.video_token in text[i]:\n-                    metadata = video_metadata[i]\n+                    metadata = video_metadata[index]\n                     if metadata.fps is None:\n                         logger.warning_once(\n                             \"Qwen3VL requires frame timestamps to construct prompts, but the `fps` of the input video could not be inferred. \""
        }
    ],
    "stats": {
        "total": 8,
        "additions": 4,
        "deletions": 4
    }
}