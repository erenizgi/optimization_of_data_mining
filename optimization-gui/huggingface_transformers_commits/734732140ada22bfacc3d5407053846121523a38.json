{
    "author": "qgallouedec",
    "message": "Deprecate Trackio environment variables and deploy to Spaces by default (#40950)\n\n* allow prive space id for trackio\n\n* complete docstring\n\n* Deprecate environment variables for Trackio integration; use TrainingArguments instead and deploy by default\n\n* style\n\n* Enhance documentation for Trackio Space ID in TrainingArguments",
    "sha": "734732140ada22bfacc3d5407053846121523a38",
    "files": [
        {
            "sha": "c1d81972f8a947b2c5b48139aed4bf2f50d7e7cb",
            "filename": "src/transformers/integrations/integration_utils.py",
            "status": "modified",
            "additions": 23,
            "deletions": 13,
            "changes": 36,
            "blob_url": "https://github.com/huggingface/transformers/blob/734732140ada22bfacc3d5407053846121523a38/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/734732140ada22bfacc3d5407053846121523a38/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fintegrations%2Fintegration_utils.py?ref=734732140ada22bfacc3d5407053846121523a38",
            "patch": "@@ -1081,19 +1081,28 @@ def setup(self, args, state, model, **kwargs):\n         \"\"\"\n         Setup the optional Trackio integration.\n \n-        To customize the setup you can also override the following environment variables:\n-\n-        Environment:\n-        - **TRACKIO_PROJECT** (`str`, *optional*, defaults to `\"huggingface\"`):\n-            The name of the project (can be an existing project to continue tracking or a new project to start tracking\n-            from scratch).\n-        - **TRACKIO_SPACE_ID** (`str`, *optional*, defaults to `None`):\n-            If set, the project will be logged to a Hugging Face Space instead of a local directory. Should be a\n-            complete Space name like `\"username/reponame\"` or `\"orgname/reponame\"`, or just `\"reponame\" in which case\n-            the Space will be created in the currently-logged-in Hugging Face user's namespace. If the Space does not\n-            exist, it will be created. If the Space already exists, the project will be logged to it.\n+        To customize the setup you can also set the arguments `project`, `trackio_space_id` and `hub_private_repo` in\n+        [`TrainingArguments`]. Please refer to the docstring of for more details.\n         \"\"\"\n         if state.is_world_process_zero:\n+            if os.getenv(\"TRACKIO_PROJECT\"):\n+                logger.warning(\n+                    \"The `TRACKIO_PROJECT` environment variable is deprecated and will be removed in a future \"\n+                    \"version. Use TrainingArguments.project instead.\"\n+                )\n+                project = os.getenv(\"TRACKIO_PROJECT\")\n+            else:\n+                project = args.project\n+\n+            if os.getenv(\"TRACKIO_SPACE_ID\"):\n+                logger.warning(\n+                    \"The `TRACKIO_SPACE_ID` environment variable is deprecated and will be removed in a future \"\n+                    \"version. Use TrainingArguments.trackio_space_id instead.\"\n+                )\n+                space_id = os.getenv(\"TRACKIO_SPACE_ID\")\n+            else:\n+                space_id = args.trackio_space_id\n+\n             combined_dict = {**args.to_dict()}\n \n             if hasattr(model, \"config\") and model.config is not None:\n@@ -1104,10 +1113,11 @@ def setup(self, args, state, model, **kwargs):\n                 combined_dict = {**{\"peft_config\": peft_config}, **combined_dict}\n \n             self._trackio.init(\n-                project=os.getenv(\"TRACKIO_PROJECT\", \"huggingface\"),\n+                project=project,\n                 name=args.run_name,\n-                space_id=os.getenv(\"TRACKIO_SPACE_ID\", None),\n+                space_id=space_id,\n                 resume=\"allow\",\n+                private=args.hub_private_repo,\n             )\n \n             # Add config parameters (run may have been created manually)"
        },
        {
            "sha": "68200f1af9c29d224637519adbd5b68d47c4478d",
            "filename": "src/transformers/training_args.py",
            "status": "modified",
            "additions": 29,
            "deletions": 2,
            "changes": 31,
            "blob_url": "https://github.com/huggingface/transformers/blob/734732140ada22bfacc3d5407053846121523a38/src%2Ftransformers%2Ftraining_args.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/734732140ada22bfacc3d5407053846121523a38/src%2Ftransformers%2Ftraining_args.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftraining_args.py?ref=734732140ada22bfacc3d5407053846121523a38",
            "patch": "@@ -616,6 +616,14 @@ class TrainingArguments:\n             `\"clearml\"`, `\"codecarbon\"`, `\"comet_ml\"`, `\"dagshub\"`, `\"dvclive\"`, `\"flyte\"`, `\"mlflow\"`, `\"neptune\"`,\n             `\"swanlab\"`, `\"tensorboard\"`, `\"trackio\"` and `\"wandb\"`. Use `\"all\"` to report to all integrations\n             installed, `\"none\"` for no integrations.\n+        project (`str`, *optional*, defaults to `\"huggingface\"`):\n+            The name of the project to use for logging. Currently, only used by Trackio.\n+        trackio_space_id (`str` or `None`, *optional*, defaults to `\"trackio\"`):\n+            The Hugging Face Space ID to deploy to when using Trackio. Should be a complete Space name like\n+            `'username/reponame'` or `'orgname/reponame' `, or just `'reponame'` in which case the Space will be\n+            created in the currently-logged-in Hugging Face user's namespace. If `None`, will log to a local directory.\n+            Note that this Space will be public unless you set `hub_private_repo=True` or your organization's default\n+            is to create private Spaces.\"\n         ddp_find_unused_parameters (`bool`, *optional*):\n             When using distributed training, the value of the flag `find_unused_parameters` passed to\n             `DistributedDataParallel`. Will default to `False` if gradient checkpointing is used, `True` otherwise.\n@@ -680,7 +688,9 @@ class TrainingArguments:\n             The token to use to push the model to the Hub. Will default to the token in the cache folder obtained with\n             `hf auth login`.\n         hub_private_repo (`bool`, *optional*):\n-            Whether to make the repo private. If `None` (default), the repo will be public unless the organization's default is private. This value is ignored if the repo already exists.\n+            Whether to make the repo private. If `None` (default), the repo will be public unless the organization's\n+            default is private. This value is ignored if the repo already exists. If reporting to Trackio with\n+            deployment to Hugging Face Spaces enabled, the same logic determines whether the Space is private.\n         hub_always_push (`bool`, *optional*, defaults to `False`):\n             Unless this is `True`, the `Trainer` will skip pushing a checkpoint when the previous push is not finished.\n         hub_revision (`str`, *optional*):\n@@ -1206,6 +1216,20 @@ class TrainingArguments:\n     report_to: Union[None, str, list[str]] = field(\n         default=None, metadata={\"help\": \"The list of integrations to report the results and logs to.\"}\n     )\n+    project: str = field(\n+        default=\"huggingface\",\n+        metadata={\"help\": \"The name of the project to use for logging. Currenly, only used by Trackio.\"},\n+    )\n+    trackio_space_id: Optional[str] = field(\n+        default=\"trackio\",\n+        metadata={\n+            \"help\": \"The Hugging Face Space ID to deploy to when using Trackio. Should be a complete Space name like \"\n+            \"'username/reponame' or 'orgname/reponame', or just 'reponame' in which case the Space will be created in \"\n+            \"the currently-logged-in Hugging Face user's namespace. If `None`, will log to a local directory. Note \"\n+            \"that this Space will be public unless you set `hub_private_repo=True` or your organization's \"\n+            \"default is to create private Spaces.\"\n+        },\n+    )\n     ddp_find_unused_parameters: Optional[bool] = field(\n         default=None,\n         metadata={\n@@ -1263,7 +1287,10 @@ class TrainingArguments:\n     hub_private_repo: Optional[bool] = field(\n         default=None,\n         metadata={\n-            \"help\": \"Whether to make the repo private. If `None` (default), the repo will be public unless the organization's default is private. This value is ignored if the repo already exists.\"\n+            \"help\": \"Whether to make the repo private. If `None` (default), the repo will be public unless the \"\n+            \"organization's default is private. This value is ignored if the repo already exists. If reporting to \"\n+            \"Trackio with deployment to Hugging Face Spaces enabled, the same logic determines whether the Space is \"\n+            \"private.\"\n         },\n     )\n     hub_always_push: bool = field("
        }
    ],
    "stats": {
        "total": 67,
        "additions": 52,
        "deletions": 15
    }
}