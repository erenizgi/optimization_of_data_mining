{
    "author": "remi-or",
    "message": "Fix AMD dockerfile for audio models (#39669)",
    "sha": "14adcbd93774c6f7d76c5b7b24f097b609037ab2",
    "files": [
        {
            "sha": "260b7cfefc43a4e91bd26694d9d622995d1f8ebd",
            "filename": "docker/transformers-pytorch-amd-gpu/Dockerfile",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/huggingface/transformers/blob/14adcbd93774c6f7d76c5b7b24f097b609037ab2/docker%2Ftransformers-pytorch-amd-gpu%2FDockerfile",
            "raw_url": "https://github.com/huggingface/transformers/raw/14adcbd93774c6f7d76c5b7b24f097b609037ab2/docker%2Ftransformers-pytorch-amd-gpu%2FDockerfile",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/docker%2Ftransformers-pytorch-amd-gpu%2FDockerfile?ref=14adcbd93774c6f7d76c5b7b24f097b609037ab2",
            "patch": "@@ -3,9 +3,6 @@ LABEL maintainer=\"Hugging Face\"\n \n ARG DEBIAN_FRONTEND=noninteractive\n \n-ARG TORCH_VISION='0.22.0'\n-ARG TORCH_AUDIO='2.7.0'\n-\n RUN apt update && \\\n     apt install -y --no-install-recommends git libsndfile1-dev tesseract-ocr espeak-ng python3 python3-dev python3-pip python3-dev ffmpeg git-lfs && \\\n     apt clean && \\\n@@ -23,9 +20,12 @@ WORKDIR /\n ADD https://api.github.com/repos/huggingface/transformers/git/refs/heads/main version.json\n RUN git clone https://github.com/huggingface/transformers && cd transformers && git checkout $REF\n \n-RUN python3 -m pip install --no-cache-dir torchvision==$TORCH_VISION torchaudio==$TORCH_AUDIO\n-RUN python3 -m pip install --no-cache-dir -e ./transformers[dev-torch,testing,video]\n+# On ROCm, torchcodec is required to decode audio files\n+RUN python3 -m pip install --no-cache-dir torchcodec\n+# Install transformers\n+RUN python3 -m pip install --no-cache-dir -e ./transformers[dev-torch,testing,video,audio]\n \n+# Remove tensorflow and flax as they are no longer supported by transformers\n RUN python3 -m pip uninstall -y tensorflow flax\n \n # When installing in editable mode, `transformers` is not recognized as a package.\n@@ -36,4 +36,4 @@ RUN cd transformers && python3 setup.py develop\n RUN python3 -m pip uninstall py3nvml pynvml nvidia-ml-py apex -y\n \n # `kernels` may causes many failing tests\n-RUN python3 -m pip uninstall -y kernels\n\\ No newline at end of file\n+RUN python3 -m pip uninstall -y kernels"
        },
        {
            "sha": "907c87b69a1ca2a66a4b3e589c8985add5724380",
            "filename": "setup.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/14adcbd93774c6f7d76c5b7b24f097b609037ab2/setup.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/14adcbd93774c6f7d76c5b7b24f097b609037ab2/setup.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/setup.py?ref=14adcbd93774c6f7d76c5b7b24f097b609037ab2",
            "patch": "@@ -144,7 +144,7 @@\n     \"optax>=0.0.8,<=0.1.4\",\n     \"pandas<2.3.0\",  # `datasets` requires `pandas` while `pandas==2.3.0` has issues with CircleCI on 2025/06/05\n     \"packaging>=20.0\",\n-    \"parameterized\",\n+    \"parameterized>=0.9\",  # older version of parameterized cause pytest collection to fail on .expand\n     \"phonemizer\",\n     \"protobuf\",\n     \"psutil\","
        },
        {
            "sha": "7f6a723b2f117db66f04e508309141ccaf94859b",
            "filename": "src/transformers/dependency_versions_table.py",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/huggingface/transformers/blob/14adcbd93774c6f7d76c5b7b24f097b609037ab2/src%2Ftransformers%2Fdependency_versions_table.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/14adcbd93774c6f7d76c5b7b24f097b609037ab2/src%2Ftransformers%2Fdependency_versions_table.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fdependency_versions_table.py?ref=14adcbd93774c6f7d76c5b7b24f097b609037ab2",
            "patch": "@@ -50,7 +50,7 @@\n     \"optax\": \"optax>=0.0.8,<=0.1.4\",\n     \"pandas\": \"pandas<2.3.0\",\n     \"packaging\": \"packaging>=20.0\",\n-    \"parameterized\": \"parameterized\",\n+    \"parameterized\": \"parameterized>=0.9\",\n     \"phonemizer\": \"phonemizer\",\n     \"protobuf\": \"protobuf\",\n     \"psutil\": \"psutil\","
        }
    ],
    "stats": {
        "total": 16,
        "additions": 8,
        "deletions": 8
    }
}