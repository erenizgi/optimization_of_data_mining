{
    "author": "Rocketknight1",
    "message": "Fix interactions between require_read_token and staticmethod (#42522)\n\n* Fix interactions between require_read_token and staticmethod\n\n* Trigger tests",
    "sha": "3a8d291ac439fca3decb9b800ea22500cffeaf50",
    "files": [
        {
            "sha": "f255daef0b23f5c5464528337391ed8cd1405580",
            "filename": "src/transformers/testing_utils.py",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/huggingface/transformers/blob/3a8d291ac439fca3decb9b800ea22500cffeaf50/src%2Ftransformers%2Ftesting_utils.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/3a8d291ac439fca3decb9b800ea22500cffeaf50/src%2Ftransformers%2Ftesting_utils.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftesting_utils.py?ref=3a8d291ac439fca3decb9b800ea22500cffeaf50",
            "patch": "@@ -638,6 +638,9 @@ def require_read_token(test_case):\n                 if getattr(attr, \"__require_read_token__\", False):\n                     continue\n                 wrapped = require_read_token(attr)\n+                if isinstance(inspect.getattr_static(test_case, attr_name), staticmethod):\n+                    # Don't accidentally bind staticmethods to `self`\n+                    wrapped = staticmethod(wrapped)\n                 setattr(test_case, attr_name, wrapped)\n         return test_case\n     else:\n@@ -650,10 +653,6 @@ def wrapper(*args, **kwargs):\n                 with patch(\"huggingface_hub.utils._headers.get_token\", return_value=token):\n                     return test_case(*args, **kwargs)\n             else:  # Allow running locally with the default token env variable\n-                # dealing with static/class methods and called by `self.xxx`\n-                if \"staticmethod\" in inspect.getsource(test_case).strip():\n-                    if len(args) > 0 and isinstance(args[0], unittest.TestCase):\n-                        return test_case(*args[1:], **kwargs)\n                 return test_case(*args, **kwargs)\n \n         wrapper.__require_read_token__ = True"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 3,
        "deletions": 4
    }
}