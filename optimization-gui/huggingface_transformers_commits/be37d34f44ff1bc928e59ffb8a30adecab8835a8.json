{
    "author": "yonigozlan",
    "message": "ðŸš¨Deprecate legacy argument for image-text-to-text models and adopt new behavior by default (#36307)\n\n* deprecate legacy argument and adopt new behavior by default\n\n* revert back modification git",
    "sha": "be37d34f44ff1bc928e59ffb8a30adecab8835a8",
    "files": [
        {
            "sha": "689aa5122f8feca2862f71f02eaad4519d6d7cbf",
            "filename": "src/transformers/models/donut/processing_donut.py",
            "status": "modified",
            "additions": 1,
            "deletions": 12,
            "changes": 13,
            "blob_url": "https://github.com/huggingface/transformers/blob/be37d34f44ff1bc928e59ffb8a30adecab8835a8/src%2Ftransformers%2Fmodels%2Fdonut%2Fprocessing_donut.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/be37d34f44ff1bc928e59ffb8a30adecab8835a8/src%2Ftransformers%2Fmodels%2Fdonut%2Fprocessing_donut.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fdonut%2Fprocessing_donut.py?ref=be37d34f44ff1bc928e59ffb8a30adecab8835a8",
            "patch": "@@ -88,17 +88,6 @@ def __call__(\n         [`~DonutProcessor.as_target_processor`] this method forwards all its arguments to DonutTokenizer's\n         [`~DonutTokenizer.__call__`]. Please refer to the docstring of the above two methods for more information.\n         \"\"\"\n-        # For backward compatibility\n-        legacy = kwargs.pop(\"legacy\", True)\n-        if legacy:\n-            # With `add_special_tokens=True`, the performance of donut are degraded when working with both images and text.\n-            logger.warning_once(\n-                \"Legacy behavior is being used. The current behavior will be deprecated in version 5.0.0. \"\n-                \"In the new behavior, if both images and text are provided, the default value of `add_special_tokens` \"\n-                \"will be changed to `False` when calling the tokenizer if `add_special_tokens` is unset. \"\n-                \"To test the new behavior, set `legacy=False`as a processor call argument.\"\n-            )\n-\n         if self._in_target_context_manager:\n             return self.current_processor(images, text, **kwargs)\n \n@@ -114,7 +103,7 @@ def __call__(\n         if images is not None:\n             inputs = self.image_processor(images, **output_kwargs[\"images_kwargs\"])\n         if text is not None:\n-            if not legacy and images is not None:\n+            if images is not None:\n                 output_kwargs[\"text_kwargs\"].setdefault(\"add_special_tokens\", False)\n             encodings = self.tokenizer(text, **output_kwargs[\"text_kwargs\"])\n "
        },
        {
            "sha": "98cc3b83cf19e1098259bda395ea3c643da4ccf7",
            "filename": "src/transformers/models/git/processing_git.py",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/huggingface/transformers/blob/be37d34f44ff1bc928e59ffb8a30adecab8835a8/src%2Ftransformers%2Fmodels%2Fgit%2Fprocessing_git.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/be37d34f44ff1bc928e59ffb8a30adecab8835a8/src%2Ftransformers%2Fmodels%2Fgit%2Fprocessing_git.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fgit%2Fprocessing_git.py?ref=be37d34f44ff1bc928e59ffb8a30adecab8835a8",
            "patch": "@@ -95,15 +95,6 @@ def __call__(\n               `None`).\n             - **pixel_values** -- Pixel values to be fed to a model. Returned when `images` is not `None`.\n         \"\"\"\n-        legacy = kwargs.pop(\"legacy\", True)\n-        if legacy:\n-            logger.warning_once(\n-                \"Legacy behavior is being used. The current behavior will be deprecated in version 5.0.0. \"\n-                \"In the new behavior, if both images and text are provided, the last token (EOS token) \"\n-                \"of the input_ids and attention_mask tensors will be removed. \"\n-                \"To test the new behavior, set `legacy=False`as a processor call argument.\"\n-            )\n-\n         if text is None and images is None:\n             raise ValueError(\"You have to specify either text or images. Both cannot be none.\")\n \n@@ -123,9 +114,6 @@ def __call__(\n         if images is not None:\n             image_features = self.image_processor(images, **output_kwargs[\"images_kwargs\"])\n             data.update(image_features)\n-            if not legacy:\n-                data[\"input_ids\"] = data[\"input_ids\"][:, :-1]\n-                data[\"attention_mask\"] = data[\"attention_mask\"][:, :-1]\n \n         return BatchFeature(data=data, tensor_type=output_kwargs[\"common_kwargs\"].get(\"return_tensors\"))\n "
        },
        {
            "sha": "f9b1fcc44087d6452c86dcd7e910391d617fb3a4",
            "filename": "src/transformers/models/pix2struct/processing_pix2struct.py",
            "status": "modified",
            "additions": 1,
            "deletions": 10,
            "changes": 11,
            "blob_url": "https://github.com/huggingface/transformers/blob/be37d34f44ff1bc928e59ffb8a30adecab8835a8/src%2Ftransformers%2Fmodels%2Fpix2struct%2Fprocessing_pix2struct.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/be37d34f44ff1bc928e59ffb8a30adecab8835a8/src%2Ftransformers%2Fmodels%2Fpix2struct%2Fprocessing_pix2struct.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Fmodels%2Fpix2struct%2Fprocessing_pix2struct.py?ref=be37d34f44ff1bc928e59ffb8a30adecab8835a8",
            "patch": "@@ -89,15 +89,6 @@ def __call__(\n \n         Please refer to the docstring of the above two methods for more information.\n         \"\"\"\n-        legacy = kwargs.pop(\"legacy\", True)\n-        if legacy:\n-            logger.warning_once(\n-                \"Legacy behavior is being used. The current behavior will be deprecated in version 5.0.0. \"\n-                \"In the new behavior, If both images and text are provided, image_processor is not a VQA processor, and `add_special_tokens` is unset, \"\n-                \"the default value of `add_special_tokens` will be changed to `False` when calling the tokenizer. \"\n-                \"To test the new behavior, set `legacy=False`as a processor call argument.\"\n-            )\n-\n         if images is None and text is None:\n             raise ValueError(\"You have to specify either images or text.\")\n \n@@ -126,7 +117,7 @@ def __call__(\n \n         if text is not None and not self.image_processor.is_vqa:\n             output_kwargs[\"text_kwargs\"][\"add_special_tokens\"] = (\n-                add_special_tokens if add_special_tokens is not None else legacy\n+                add_special_tokens if add_special_tokens is not None else False\n             )\n             text_encoding = self.tokenizer(text=text, **output_kwargs[\"text_kwargs\"])\n "
        }
    ],
    "stats": {
        "total": 36,
        "additions": 2,
        "deletions": 34
    }
}