{
    "author": "Krish0909",
    "message": "ðŸš¨ðŸš¨ðŸš¨ [Trainer] Enable `average_tokens_across_devices` by default in `TrainingArguments` (#39395)\n\nEnable average_tokens_across_devices by default in TrainingArguments\n\nFixes #39392\n\nThis change improves loss calculation correctness for multi-GPU training by enabling proper token averaging across devices by default.\n\nCo-authored-by: Krishnan Vignesh <krishnanvignesh@Krishnans-MacBook-Air.local>\nCo-authored-by: Marc Sun <57196510+SunMarc@users.noreply.github.com>",
    "sha": "fdc0566e15d57db6683880b778d54e8240be0c33",
    "files": [
        {
            "sha": "16056a5ddef1cb82e5d31667c3bfc96a544458b4",
            "filename": "src/transformers/training_args.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/huggingface/transformers/blob/fdc0566e15d57db6683880b778d54e8240be0c33/src%2Ftransformers%2Ftraining_args.py",
            "raw_url": "https://github.com/huggingface/transformers/raw/fdc0566e15d57db6683880b778d54e8240be0c33/src%2Ftransformers%2Ftraining_args.py",
            "contents_url": "https://api.github.com/repos/huggingface/transformers/contents/src%2Ftransformers%2Ftraining_args.py?ref=fdc0566e15d57db6683880b778d54e8240be0c33",
            "patch": "@@ -800,7 +800,7 @@ class TrainingArguments:\n             `_apply_liger_kernel_to_instance` function, which specifies which kernels to apply. Available options vary by model but typically\n             include: 'rope', 'swiglu', 'cross_entropy', 'fused_linear_cross_entropy', 'rms_norm', etc. If `None`, use the default kernel configurations.\n \n-        average_tokens_across_devices (`bool`, *optional*, defaults to `False`):\n+        average_tokens_across_devices (`bool`, *optional*, defaults to `True`):\n             Whether or not to average tokens across devices. If enabled, will use all_reduce to synchronize\n             num_tokens_in_batch for precise loss calculation. Reference:\n             https://github.com/huggingface/transformers/issues/34242\n@@ -1553,7 +1553,7 @@ class TrainingArguments:\n     )\n \n     average_tokens_across_devices: Optional[bool] = field(\n-        default=False,\n+        default=True,\n         metadata={\n             \"help\": \"Whether or not to average tokens across devices. If enabled, will use all_reduce to \"\n             \"synchronize num_tokens_in_batch for precise loss calculation. Reference: \""
        }
    ],
    "stats": {
        "total": 4,
        "additions": 2,
        "deletions": 2
    }
}