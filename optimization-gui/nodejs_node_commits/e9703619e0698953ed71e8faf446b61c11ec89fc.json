{
    "author": "joyeecheung",
    "message": "src: move GetOpenSSLVersion into node_metadata.cc\n\nInstead of implementing it in node_crypto.cc even though the only\nplace that needs it is the `Metadata::Versions` constructor.\n\nPR-URL: https://github.com/nodejs/node/pull/25115\nReviewed-By: Steven R Loomis <srloomis@us.ibm.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "e9703619e0698953ed71e8faf446b61c11ec89fc",
    "files": [
        {
            "sha": "011506a34eb34eca91a11e44056b4e78a9bbcb95",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/e9703619e0698953ed71e8faf446b61c11ec89fc/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/e9703619e0698953ed71e8faf446b61c11ec89fc/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=e9703619e0698953ed71e8faf446b61c11ec89fc",
            "patch": "@@ -5842,21 +5842,6 @@ void Initialize(Local<Object> target,\n #endif  // OPENSSL_NO_SCRYPT\n }\n \n-constexpr int search(const char* s, int n, int c) {\n-  return *s == c ? n : search(s + 1, n + 1, c);\n-}\n-\n-std::string GetOpenSSLVersion() {\n-  // sample openssl version string format\n-  // for reference: \"OpenSSL 1.1.0i 14 Aug 2018\"\n-  char buf[128];\n-  const int start = search(OPENSSL_VERSION_TEXT, 0, ' ') + 1;\n-  const int end = search(OPENSSL_VERSION_TEXT + start, start, ' ');\n-  const int len = end - start;\n-  snprintf(buf, sizeof(buf), \"%.*s\", len, &OPENSSL_VERSION_TEXT[start]);\n-  return std::string(buf);\n-}\n-\n }  // namespace crypto\n }  // namespace node\n "
        },
        {
            "sha": "dd22c9eae4b564290bc7a8f63caad69132b97aa0",
            "filename": "src/node_crypto.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/e9703619e0698953ed71e8faf446b61c11ec89fc/src%2Fnode_crypto.h",
            "raw_url": "https://github.com/nodejs/node/raw/e9703619e0698953ed71e8faf446b61c11ec89fc/src%2Fnode_crypto.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.h?ref=e9703619e0698953ed71e8faf446b61c11ec89fc",
            "patch": "@@ -94,7 +94,6 @@ extern int VerifyCallback(int preverify_ok, X509_STORE_CTX* ctx);\n extern void UseExtraCaCerts(const std::string& file);\n \n void InitCryptoOnce();\n-std::string GetOpenSSLVersion();\n \n class SecureContext : public BaseObject {\n  public:"
        },
        {
            "sha": "3ddec4b36afc1bb5ae242bcd977e0015055a3ded",
            "filename": "src/node_metadata.cc",
            "status": "modified",
            "additions": 20,
            "deletions": 3,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/e9703619e0698953ed71e8faf446b61c11ec89fc/src%2Fnode_metadata.cc",
            "raw_url": "https://github.com/nodejs/node/raw/e9703619e0698953ed71e8faf446b61c11ec89fc/src%2Fnode_metadata.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_metadata.cc?ref=e9703619e0698953ed71e8faf446b61c11ec89fc",
            "patch": "@@ -9,15 +9,32 @@\n #include \"zlib.h\"\n \n #if HAVE_OPENSSL\n-#include \"node_crypto.h\"\n-#endif\n+#include <openssl/opensslv.h>\n+#endif  // HAVE_OPENSSL\n \n namespace node {\n \n namespace per_process {\n Metadata metadata;\n }\n \n+#if HAVE_OPENSSL\n+constexpr int search(const char* s, int n, int c) {\n+  return *s == c ? n : search(s + 1, n + 1, c);\n+}\n+\n+std::string GetOpenSSLVersion() {\n+  // sample openssl version string format\n+  // for reference: \"OpenSSL 1.1.0i 14 Aug 2018\"\n+  char buf[128];\n+  const int start = search(OPENSSL_VERSION_TEXT, 0, ' ') + 1;\n+  const int end = search(OPENSSL_VERSION_TEXT + start, start, ' ');\n+  const int len = end - start;\n+  snprintf(buf, sizeof(buf), \"%.*s\", len, &OPENSSL_VERSION_TEXT[start]);\n+  return std::string(buf);\n+}\n+#endif  // HAVE_OPENSSL\n+\n Metadata::Versions::Versions() {\n   node = NODE_VERSION_STRING;\n   v8 = v8::V8::GetVersion();\n@@ -31,7 +48,7 @@ Metadata::Versions::Versions() {\n   http_parser = http_parser_version;\n \n #if HAVE_OPENSSL\n-  openssl = crypto::GetOpenSSLVersion();\n+  openssl = GetOpenSSLVersion();\n #endif\n }\n "
        }
    ],
    "stats": {
        "total": 39,
        "additions": 20,
        "deletions": 19
    }
}