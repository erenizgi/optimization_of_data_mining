{
    "author": "jasnell",
    "message": "net: deprecate _setSimultaneousAccepts() undocumented function\n\nThis is an undocumented utility function that is of questionable\nutility.\n\nFixes: https://github.com/nodejs/node/issues/18391\n\nPR-URL: https://github.com/nodejs/node/pull/23760\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "1523111250788e0e1651d30c1fd506e9ef4ac7f0",
    "files": [
        {
            "sha": "1aef639cfc82e53a90ce5e758c1228c8ff4752cc",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/1523111250788e0e1651d30c1fd506e9ef4ac7f0/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/1523111250788e0e1651d30c1fd506e9ef4ac7f0/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=1523111250788e0e1651d30c1fd506e9ef4ac7f0",
            "patch": "@@ -2264,6 +2264,20 @@ undocumented `COUNTER_NET_SERVER_CONNECTION()`,\n `COUNTER_HTTP_SERVER_RESPONSE()`, `COUNTER_HTTP_CLIENT_REQUEST()`, and\n `COUNTER_HTTP_CLIENT_RESPONSE()` functions have been deprecated.\n \n+<a id=\"DEP00XX\"></a>\n+### DEP00XX: net._setSimultaneousAccepts()\n+<!-- YAML\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/23760\n+    description: Runtime deprecation.\n+-->\n+\n+The undocumented `net._setSimultaneousAccepts()` function was originally\n+intended for debugging and performance tuning when using the `child_process`\n+and `cluster` modules on Windows. The function is not generally useful and\n+is being removed. See discussion here:\n+https://github.com/nodejs/node/issues/18391\n \n [`--pending-deprecation`]: cli.html#cli_pending_deprecation\n [`Buffer.allocUnsafeSlow(size)`]: buffer.html#buffer_class_method_buffer_allocunsafeslow_size"
        },
        {
            "sha": "a2478ec69de13918d51c7855e750a4c1a512c99e",
            "filename": "lib/internal/child_process.js",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/1523111250788e0e1651d30c1fd506e9ef4ac7f0/lib%2Finternal%2Fchild_process.js",
            "raw_url": "https://github.com/nodejs/node/raw/1523111250788e0e1651d30c1fd506e9ef4ac7f0/lib%2Finternal%2Fchild_process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fchild_process.js?ref=1523111250788e0e1651d30c1fd506e9ef4ac7f0",
            "patch": "@@ -604,8 +604,7 @@ function setupChannel(target, channel) {\n \n     // Update simultaneous accepts on Windows\n     if (process.platform === 'win32') {\n-      handle._simultaneousAccepts = false;\n-      net._setSimultaneousAccepts(handle);\n+      handle.setSimultaneousAccepts(false);\n     }\n \n     // Convert handle object\n@@ -700,8 +699,8 @@ function setupChannel(target, channel) {\n         message = message.msg;\n \n       // Update simultaneous accepts on Windows\n-      if (obj.simultaneousAccepts) {\n-        net._setSimultaneousAccepts(handle);\n+      if (obj.simultaneousAccepts && process.platform === 'win32') {\n+        handle.setSimultaneousAccepts(true);\n       }\n     } else if (this._handleQueue &&\n                !(message && (message.cmd === 'NODE_HANDLE_ACK' ||"
        },
        {
            "sha": "d4b8bfcc2aeee773987eb4e8c0eb144646d4c190",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 15,
            "deletions": 1,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/1523111250788e0e1651d30c1fd506e9ef4ac7f0/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/1523111250788e0e1651d30c1fd506e9ef4ac7f0/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=1523111250788e0e1651d30c1fd506e9ef4ac7f0",
            "patch": "@@ -1668,11 +1668,18 @@ Server.prototype.unref = function() {\n };\n \n var _setSimultaneousAccepts;\n+var warnSimultaneousAccepts = true;\n \n if (process.platform === 'win32') {\n   var simultaneousAccepts;\n \n   _setSimultaneousAccepts = function(handle) {\n+    if (warnSimultaneousAccepts) {\n+      process.emitWarning(\n+        'net._setSimultaneousAccepts() is deprecated and will be removed.',\n+        'DeprecationWarning', 'DEP00XX');\n+      warnSimultaneousAccepts = false;\n+    }\n     if (handle === undefined) {\n       return;\n     }\n@@ -1688,7 +1695,14 @@ if (process.platform === 'win32') {\n     }\n   };\n } else {\n-  _setSimultaneousAccepts = function() {};\n+  _setSimultaneousAccepts = function() {\n+    if (warnSimultaneousAccepts) {\n+      process.emitWarning(\n+        'net._setSimultaneousAccepts() is deprecated and will be removed.',\n+        'DeprecationWarning', 'DEP00XX');\n+      warnSimultaneousAccepts = false;\n+    }\n+  };\n }\n \n module.exports = {"
        },
        {
            "sha": "6d1d62e6cb275f39d08613ed5ea4f6e2938e6b0b",
            "filename": "test/parallel/test-net-deprecated-setsimultaneousaccepts.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/1523111250788e0e1651d30c1fd506e9ef4ac7f0/test%2Fparallel%2Ftest-net-deprecated-setsimultaneousaccepts.js",
            "raw_url": "https://github.com/nodejs/node/raw/1523111250788e0e1651d30c1fd506e9ef4ac7f0/test%2Fparallel%2Ftest-net-deprecated-setsimultaneousaccepts.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-net-deprecated-setsimultaneousaccepts.js?ref=1523111250788e0e1651d30c1fd506e9ef4ac7f0",
            "patch": "@@ -0,0 +1,16 @@\n+// Flags: --no-warnings\n+'use strict';\n+\n+const {\n+  expectWarning\n+} = require('../common');\n+const {\n+  _setSimultaneousAccepts\n+} = require('net');\n+\n+expectWarning(\n+  'DeprecationWarning',\n+  'net._setSimultaneousAccepts() is deprecated and will be removed.',\n+  'DEP00XX');\n+\n+_setSimultaneousAccepts();"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 48,
        "deletions": 5
    }
}