{
    "author": "domfarolino",
    "message": "console: console.countReset() should emit warning\n\nThe Console Standard specifies that console.countReset()\nshould emit some type of a warning when given a label that\nhas no previous account associated with it. This PR brings\nnode's implementation of console.countReset() up-to-spec and\nadds a test asserting that a warning is emitted.\n\nFixes: https://github.com/nodejs/node/issues/20524\n\nPR-URL: https://github.com/nodejs/node/pull/21649\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "d4164ca559f5d458384b379852972c84ff918ab4",
    "files": [
        {
            "sha": "65d7e81f151de3aadfba886622ecec5fe05ad8fe",
            "filename": "lib/console.js",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/d4164ca559f5d458384b379852972c84ff918ab4/lib%2Fconsole.js",
            "raw_url": "https://github.com/nodejs/node/raw/d4164ca559f5d458384b379852972c84ff918ab4/lib%2Fconsole.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fconsole.js?ref=d4164ca559f5d458384b379852972c84ff918ab4",
            "patch": "@@ -107,6 +107,7 @@ function Console(options /* or: stdout, stderr, ignoreErrors = true */) {\n   if (typeof colorMode !== 'boolean' && colorMode !== 'auto')\n     throw new ERR_INVALID_ARG_VALUE('colorMode', colorMode);\n \n+  // Corresponds to https://console.spec.whatwg.org/#count-map\n   this[kCounts] = new Map();\n   this[kColorMode] = colorMode;\n \n@@ -308,12 +309,14 @@ Console.prototype.count = function count(label = 'default') {\n   this.log(`${label}: ${count}`);\n };\n \n-// Not yet defined by the https://console.spec.whatwg.org, but\n-// proposed to be added and currently implemented by Edge. Having\n-// the ability to reset counters is important to help prevent\n-// the counter from being a memory leak.\n+// Defined by: https://console.spec.whatwg.org/#countreset\n Console.prototype.countReset = function countReset(label = 'default') {\n   const counts = this[kCounts];\n+  if (!counts.has(label)) {\n+    process.emitWarning(`Count for '${label}' does not exist`);\n+    return;\n+  }\n+\n   counts.delete(`${label}`);\n };\n "
        },
        {
            "sha": "6f06ea0954001fff950b94ee510986364be65c6d",
            "filename": "test/parallel/test-console.js",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/d4164ca559f5d458384b379852972c84ff918ab4/test%2Fparallel%2Ftest-console.js",
            "raw_url": "https://github.com/nodejs/node/raw/d4164ca559f5d458384b379852972c84ff918ab4/test%2Fparallel%2Ftest-console.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-console.js?ref=d4164ca559f5d458384b379852972c84ff918ab4",
            "patch": "@@ -35,14 +35,16 @@ if (common.isMainThread) {\n common.expectWarning(\n   'Warning',\n   [\n-    ['No such label \\'nolabel\\' for console.timeEnd()', common.noWarnCode],\n-    ['No such label \\'nolabel\\' for console.timeLog()', common.noWarnCode],\n+    ['Count for \\'noLabel\\' does not exist', common.noWarnCode],\n+    ['No such label \\'noLabel\\' for console.timeLog()', common.noWarnCode],\n+    ['No such label \\'noLabel\\' for console.timeEnd()', common.noWarnCode],\n     ['Label \\'test\\' already exists for console.time()', common.noWarnCode]\n   ]\n );\n \n-console.timeEnd('nolabel');\n-console.timeLog('nolabel');\n+console.countReset('noLabel');\n+console.timeLog('noLabel');\n+console.timeEnd('noLabel');\n \n console.time('label');\n console.timeEnd('label');\n@@ -245,6 +247,6 @@ common.hijackStderr(common.mustCall(function(data) {\n \n   // stderr.write will catch sync error, so use `process.nextTick` here\n   process.nextTick(function() {\n-    assert.strictEqual(data.includes('nolabel'), true);\n+    assert.strictEqual(data.includes('noLabel'), true);\n   });\n }));"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 14,
        "deletions": 9
    }
}