{
    "author": "BridgeAR",
    "message": "benchmark: (crypto) refactor\n\nPR-URL: https://github.com/nodejs/node/pull/18320\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "39ae0b98009e8d235ee7c6d885fd9702a49949ee",
    "files": [
        {
            "sha": "5c1e71e7280575060f383da16c2a4ef1d3ec0bcb",
            "filename": "benchmark/crypto/aes-gcm-throughput.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Faes-gcm-throughput.js",
            "raw_url": "https://github.com/nodejs/node/raw/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Faes-gcm-throughput.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fcrypto%2Faes-gcm-throughput.js?ref=39ae0b98009e8d235ee7c6d885fd9702a49949ee",
            "patch": "@@ -8,13 +8,13 @@ const bench = common.createBenchmark(main, {\n   len: [1024, 4 * 1024, 16 * 1024, 64 * 1024, 256 * 1024, 1024 * 1024]\n });\n \n-function main(conf) {\n-  const message = Buffer.alloc(conf.len, 'b');\n-  const key = crypto.randomBytes(keylen[conf.cipher]);\n+function main({ n, len, cipher }) {\n+  const message = Buffer.alloc(len, 'b');\n+  const key = crypto.randomBytes(keylen[cipher]);\n   const iv = crypto.randomBytes(12);\n   const associate_data = Buffer.alloc(16, 'z');\n   bench.start();\n-  AEAD_Bench(conf.cipher, message, associate_data, key, iv, conf.n, conf.len);\n+  AEAD_Bench(cipher, message, associate_data, key, iv, n, len);\n }\n \n function AEAD_Bench(cipher, message, associate_data, key, iv, n, len) {"
        },
        {
            "sha": "64f6ff7b7292be5246eb17b0e9cb247ede535584",
            "filename": "benchmark/crypto/cipher-stream.js",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Fcipher-stream.js",
            "raw_url": "https://github.com/nodejs/node/raw/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Fcipher-stream.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fcrypto%2Fcipher-stream.js?ref=39ae0b98009e8d235ee7c6d885fd9702a49949ee",
            "patch": "@@ -9,8 +9,7 @@ const bench = common.createBenchmark(main, {\n   api: ['legacy', 'stream']\n });\n \n-function main(conf) {\n-  var api = conf.api;\n+function main({ api, cipher, type, len, writes }) {\n   if (api === 'stream' && /^v0\\.[0-8]\\./.test(process.version)) {\n     console.error('Crypto streams not available until v0.10');\n     // use the legacy, just so that we can compare them.\n@@ -33,33 +32,33 @@ function main(conf) {\n   // alice_secret and bob_secret should be the same\n   assert(alice_secret === bob_secret);\n \n-  const alice_cipher = crypto.createCipher(conf.cipher, alice_secret);\n-  const bob_cipher = crypto.createDecipher(conf.cipher, bob_secret);\n+  const alice_cipher = crypto.createCipher(cipher, alice_secret);\n+  const bob_cipher = crypto.createDecipher(cipher, bob_secret);\n \n   var message;\n   var encoding;\n-  switch (conf.type) {\n+  switch (type) {\n     case 'asc':\n-      message = 'a'.repeat(conf.len);\n+      message = 'a'.repeat(len);\n       encoding = 'ascii';\n       break;\n     case 'utf':\n-      message = 'ü'.repeat(conf.len / 2);\n+      message = 'ü'.repeat(len / 2);\n       encoding = 'utf8';\n       break;\n     case 'buf':\n-      message = Buffer.alloc(conf.len, 'b');\n+      message = Buffer.alloc(len, 'b');\n       break;\n     default:\n-      throw new Error(`unknown message type: ${conf.type}`);\n+      throw new Error(`unknown message type: ${type}`);\n   }\n \n   const fn = api === 'stream' ? streamWrite : legacyWrite;\n \n   // write data as fast as possible to alice, and have bob decrypt.\n   // use old API for comparison to v0.8\n   bench.start();\n-  fn(alice_cipher, bob_cipher, message, encoding, conf.writes);\n+  fn(alice_cipher, bob_cipher, message, encoding, writes);\n }\n \n function streamWrite(alice, bob, message, encoding, writes) {"
        },
        {
            "sha": "d4c10a2427d360a9ada9f489fe5f35015120ba52",
            "filename": "benchmark/crypto/get-ciphers.js",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Fget-ciphers.js",
            "raw_url": "https://github.com/nodejs/node/raw/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Fget-ciphers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fcrypto%2Fget-ciphers.js?ref=39ae0b98009e8d235ee7c6d885fd9702a49949ee",
            "patch": "@@ -7,12 +7,10 @@ const bench = common.createBenchmark(main, {\n   v: ['crypto', 'tls']\n });\n \n-function main(conf) {\n-  const n = +conf.n;\n-  const v = conf.v;\n+function main({ n, v }) {\n   const method = require(v).getCiphers;\n   var i = 0;\n-  // first call to getChipers will dominate the results\n+  // First call to getChipers will dominate the results\n   if (n > 1) {\n     for (; i < n; i++)\n       method();"
        },
        {
            "sha": "faaa12a9e5d48408fa535f8cd3fa129081732b51",
            "filename": "benchmark/crypto/hash-stream-creation.js",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Fhash-stream-creation.js",
            "raw_url": "https://github.com/nodejs/node/raw/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Fhash-stream-creation.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fcrypto%2Fhash-stream-creation.js?ref=39ae0b98009e8d235ee7c6d885fd9702a49949ee",
            "patch": "@@ -13,8 +13,7 @@ const bench = common.createBenchmark(main, {\n   api: ['legacy', 'stream']\n });\n \n-function main(conf) {\n-  var api = conf.api;\n+function main({ api, type, len, out, writes, algo }) {\n   if (api === 'stream' && /^v0\\.[0-8]\\./.test(process.version)) {\n     console.error('Crypto streams not available until v0.10');\n     // use the legacy, just so that we can compare them.\n@@ -23,26 +22,26 @@ function main(conf) {\n \n   var message;\n   var encoding;\n-  switch (conf.type) {\n+  switch (type) {\n     case 'asc':\n-      message = 'a'.repeat(conf.len);\n+      message = 'a'.repeat(len);\n       encoding = 'ascii';\n       break;\n     case 'utf':\n-      message = 'ü'.repeat(conf.len / 2);\n+      message = 'ü'.repeat(len / 2);\n       encoding = 'utf8';\n       break;\n     case 'buf':\n-      message = Buffer.alloc(conf.len, 'b');\n+      message = Buffer.alloc(len, 'b');\n       break;\n     default:\n-      throw new Error(`unknown message type: ${conf.type}`);\n+      throw new Error(`unknown message type: ${type}`);\n   }\n \n   const fn = api === 'stream' ? streamWrite : legacyWrite;\n \n   bench.start();\n-  fn(conf.algo, message, encoding, conf.writes, conf.len, conf.out);\n+  fn(algo, message, encoding, writes, len, out);\n }\n \n function legacyWrite(algo, message, encoding, writes, len, outEnc) {"
        },
        {
            "sha": "934e7a0b11bdae0fd016c8202985ca32bc875cee",
            "filename": "benchmark/crypto/hash-stream-throughput.js",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Fhash-stream-throughput.js",
            "raw_url": "https://github.com/nodejs/node/raw/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Fhash-stream-throughput.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fcrypto%2Fhash-stream-throughput.js?ref=39ae0b98009e8d235ee7c6d885fd9702a49949ee",
            "patch": "@@ -12,8 +12,7 @@ const bench = common.createBenchmark(main, {\n   api: ['legacy', 'stream']\n });\n \n-function main(conf) {\n-  var api = conf.api;\n+function main({ api, type, len, algo, writes }) {\n   if (api === 'stream' && /^v0\\.[0-8]\\./.test(process.version)) {\n     console.error('Crypto streams not available until v0.10');\n     // use the legacy, just so that we can compare them.\n@@ -22,26 +21,26 @@ function main(conf) {\n \n   var message;\n   var encoding;\n-  switch (conf.type) {\n+  switch (type) {\n     case 'asc':\n-      message = 'a'.repeat(conf.len);\n+      message = 'a'.repeat(len);\n       encoding = 'ascii';\n       break;\n     case 'utf':\n-      message = 'ü'.repeat(conf.len / 2);\n+      message = 'ü'.repeat(len / 2);\n       encoding = 'utf8';\n       break;\n     case 'buf':\n-      message = Buffer.alloc(conf.len, 'b');\n+      message = Buffer.alloc(len, 'b');\n       break;\n     default:\n-      throw new Error(`unknown message type: ${conf.type}`);\n+      throw new Error(`unknown message type: ${type}`);\n   }\n \n   const fn = api === 'stream' ? streamWrite : legacyWrite;\n \n   bench.start();\n-  fn(conf.algo, message, encoding, conf.writes, conf.len);\n+  fn(algo, message, encoding, writes, len);\n }\n \n function legacyWrite(algo, message, encoding, writes, len) {"
        },
        {
            "sha": "40b69c31f977ca5fbecf914aebd211d8f0952487",
            "filename": "benchmark/crypto/rsa-encrypt-decrypt-throughput.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Frsa-encrypt-decrypt-throughput.js",
            "raw_url": "https://github.com/nodejs/node/raw/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Frsa-encrypt-decrypt-throughput.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fcrypto%2Frsa-encrypt-decrypt-throughput.js?ref=39ae0b98009e8d235ee7c6d885fd9702a49949ee",
            "patch": "@@ -22,10 +22,10 @@ const bench = common.createBenchmark(main, {\n   len: [16, 32, 64]\n });\n \n-function main(conf) {\n-  const message = Buffer.alloc(conf.len, 'b');\n+function main({ len, algo, keylen, n }) {\n+  const message = Buffer.alloc(len, 'b');\n   bench.start();\n-  StreamWrite(conf.algo, conf.keylen, message, conf.n, conf.len);\n+  StreamWrite(algo, keylen, message, n, len);\n }\n \n function StreamWrite(algo, keylen, message, n, len) {"
        },
        {
            "sha": "3a0373b57d0bba3ead033a8b2019cd5f9a2da355",
            "filename": "benchmark/crypto/rsa-sign-verify-throughput.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Frsa-sign-verify-throughput.js",
            "raw_url": "https://github.com/nodejs/node/raw/39ae0b98009e8d235ee7c6d885fd9702a49949ee/benchmark%2Fcrypto%2Frsa-sign-verify-throughput.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fcrypto%2Frsa-sign-verify-throughput.js?ref=39ae0b98009e8d235ee7c6d885fd9702a49949ee",
            "patch": "@@ -23,10 +23,10 @@ const bench = common.createBenchmark(main, {\n   len: [1024, 102400, 2 * 102400, 3 * 102400, 1024 * 1024]\n });\n \n-function main(conf) {\n-  const message = Buffer.alloc(conf.len, 'b');\n+function main({ len, algo, keylen, writes }) {\n+  const message = Buffer.alloc(len, 'b');\n   bench.start();\n-  StreamWrite(conf.algo, conf.keylen, message, conf.writes, conf.len);\n+  StreamWrite(algo, keylen, message, writes, len);\n }\n \n function StreamWrite(algo, keylen, message, writes, len) {"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 35,
        "deletions": 40
    }
}