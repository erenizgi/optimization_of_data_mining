{
    "author": "joaocgreis",
    "message": "win,msi: install tools for native modules\n\nAdd a dialog during installation with information about native\nmodules that can optionally run a Boxstarter script at the end of the\ninstallation. This script can also be run from Start menu.\n\nFixes: https://github.com/nodejs/node/issues/22311\nPR-URL: https://github.com/nodejs/node/pull/22645\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "39937938d705413ea438c9d4695953b5164557ef",
    "files": [
        {
            "sha": "6bef8ca5b64258e5f75ac6fb991337d99a8f62d8",
            "filename": "tools/msvs/install_tools/install_tools.bat",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/39937938d705413ea438c9d4695953b5164557ef/tools%2Fmsvs%2Finstall_tools%2Finstall_tools.bat",
            "raw_url": "https://github.com/nodejs/node/raw/39937938d705413ea438c9d4695953b5164557ef/tools%2Fmsvs%2Finstall_tools%2Finstall_tools.bat",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmsvs%2Finstall_tools%2Finstall_tools.bat?ref=39937938d705413ea438c9d4695953b5164557ef",
            "patch": "@@ -0,0 +1,25 @@\n+@echo off\n+\n+echo ====================================================\n+echo Tools for Node.js Native Modules Installation Script\n+echo ====================================================\n+echo.\n+echo This Boxstarter script will install Python and the Visual Studio Build Tools,\n+echo necessary to compile Node.js native modules. All necessary Windows updates\n+echo will also be installed.\n+echo.\n+echo This will require about 3 Gb of free disk space, plus any space necessary to\n+echo install Windows updates.\n+echo.\n+echo This will take a while to run. Your computer may reboot during the\n+echo installation, and will resume automatically.\n+echo.\n+echo Please close all open programs for the duration of the installation.\n+echo.\n+echo You can close this window to stop now. This script can be invoked from the\n+echo Start menu. Detailed instructions to install these tools manually are\n+echo available at https://github.com/nodejs/node-gyp#on-windows\n+echo.\n+pause\n+\n+\"%SystemRoot%\\System32\\WindowsPowerShell\\v1.0\\powershell.exe\" -NoProfile -InputFormat None -ExecutionPolicy Bypass -Command \"iex ((New-Object System.Net.WebClient).DownloadString('https://boxstarter.org/bootstrapper.ps1')); get-boxstarter -Force; Install-BoxstarterPackage -PackageName '%~dp0\\install_tools.txt'\""
        },
        {
            "sha": "baf530a774759ba7f9810d385a1e11556c0dd81e",
            "filename": "tools/msvs/install_tools/install_tools.txt",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/39937938d705413ea438c9d4695953b5164557ef/tools%2Fmsvs%2Finstall_tools%2Finstall_tools.txt",
            "raw_url": "https://github.com/nodejs/node/raw/39937938d705413ea438c9d4695953b5164557ef/tools%2Fmsvs%2Finstall_tools%2Finstall_tools.txt",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmsvs%2Finstall_tools%2Finstall_tools.txt?ref=39937938d705413ea438c9d4695953b5164557ef",
            "patch": "@@ -0,0 +1,3 @@\n+choco upgrade -y python2\n+choco upgrade -y visualstudio2017buildtools\n+choco upgrade -y visualstudio2017-workload-vctools"
        },
        {
            "sha": "71c17014911033518af0175b343d10727f0cea4d",
            "filename": "tools/msvs/msi/i18n/en-us.wxl",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/39937938d705413ea438c9d4695953b5164557ef/tools%2Fmsvs%2Fmsi%2Fi18n%2Fen-us.wxl",
            "raw_url": "https://github.com/nodejs/node/raw/39937938d705413ea438c9d4695953b5164557ef/tools%2Fmsvs%2Fmsi%2Fi18n%2Fen-us.wxl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmsvs%2Fmsi%2Fi18n%2Fen-us.wxl?ref=39937938d705413ea438c9d4695953b5164557ef",
            "patch": "@@ -8,6 +8,14 @@\n \n     <String Id=\"MajorUpgrade_DowngradeErrorMessage\">A later version of [ProductName] is already installed. Setup will now exit.</String>\n \n+    <String Id=\"NativeToolsDlg_Title\">[ProductName] Setup</String>\n+    <String Id=\"NativeToolsDlgTitle\">{\\WixUI_Font_Title}Tools for Native Modules</String>\n+    <String Id=\"NativeToolsDlgDescription\">Optionally install the tools necessary to compile native modules.</String>\n+    <String Id=\"NativeToolsDlgBannerBitmap\">WixUI_Bmp_Banner</String>\n+    <String Id=\"NativeToolsDlgIntro\">Some npm modules need to be compiled from C/C++ when installing. If you want to be able to install such modules, some tools (Python 2 and Visual Studio Build Tools) need to be installed.</String>\n+    <String Id=\"NativeToolsDlgInstallCheckbox\">Automatically install the necessary tools. The script will pop-up in a new window after the installation completes.</String>\n+    <String Id=\"NativeToolsDlgManualDetails\">Alternatively, follow the instructions at <![CDATA[<a href=\"https://github.com/nodejs/node-gyp#on-windows\">https://github.com/nodejs/node-gyp#on-windows</a>]]> to install the dependencies yourself.</String>\n+\n     <!-- References like [ProductName] or $(var.ProductName) don't seem to work in Title attributes -->\n     <String Id=\"NodeRuntime_Title\">Node.js runtime</String>\n     <String Id=\"NodeRuntime_Description\">Install the core [ProductName] runtime (node.exe).</String>"
        },
        {
            "sha": "ad48fedafd9ea0570607fd455a968d66c2bc8c3f",
            "filename": "tools/msvs/msi/product.wxs",
            "status": "modified",
            "additions": 41,
            "deletions": 2,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/39937938d705413ea438c9d4695953b5164557ef/tools%2Fmsvs%2Fmsi%2Fproduct.wxs",
            "raw_url": "https://github.com/nodejs/node/raw/39937938d705413ea438c9d4695953b5164557ef/tools%2Fmsvs%2Fmsi%2Fproduct.wxs",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmsvs%2Fmsi%2Fproduct.wxs?ref=39937938d705413ea438c9d4695953b5164557ef",
            "patch": "@@ -72,6 +72,8 @@\n       <ComponentRef Id=\"NodeVarsScript\"/>\n       <ComponentRef Id=\"NodeStartMenu\"/>\n       <ComponentRef Id=\"AppData\" />\n+      <ComponentRef Id=\"InstallToolsBat\" />\n+      <ComponentRef Id=\"InstallToolsTxt\" />\n       <ComponentGroupRef Id=\"Product.Generated\"/>\n \n       <Feature Id=\"NodePerfCtrSupport\"\n@@ -162,6 +164,14 @@\n         <File Id=\"nodevars.bat\" KeyPath=\"yes\" Source=\"$(var.RepoDir)\\tools\\msvs\\nodevars.bat\"/>\n       </Component>\n \n+      <Component Id=\"InstallToolsBat\">\n+        <File Id=\"InstallToolsBat\" KeyPath=\"yes\" Source=\"$(var.RepoDir)\\tools\\msvs\\install_tools\\install_tools.bat\"/>\n+      </Component>\n+\n+      <Component Id=\"InstallToolsTxt\">\n+        <File Id=\"InstallToolsTxt\" Source=\"$(var.RepoDir)\\tools\\msvs\\install_tools\\install_tools.txt\"/>\n+      </Component>\n+\n       <?if $(var.NoPerfCtr) != 1 ?>\n       <Component Id=\"NodePerfCtrSupport\">\n         <File Id=\"node_perfctr_provider_man\" Name=\"node_perfctr_provider.man\" Source=\"$(var.RepoDir)\\src\\res\\node_perfctr_provider.man\">\n@@ -195,6 +205,12 @@\n                   Arguments='/k \"[INSTALLDIR]nodevars.bat\"'\n                   Show=\"normal\"\n                   WorkingDirectory=\"INSTALLDIR\"/>\n+        <Shortcut Id=\"InstallToolsShortcut\"\n+                  Name=\"Install Additional Tools for Node.js\"\n+                  Target=\"[%ComSpec]\"\n+                  Arguments='/d /c \"[INSTALLDIR]install_tools.bat\"'\n+                  Show=\"normal\"\n+                  WorkingDirectory=\"INSTALLDIR\"/>\n         <Shortcut Id=\"NodeExecutableShortcut\"\n                   Name=\"Node.js\"\n                   Target=\"[INSTALLDIR]node.exe\"\n@@ -310,6 +326,9 @@\n                   Execute=\"immediate\"\n                   Return=\"check\" />\n \n+    <Property Id=\"WixShellExecTarget\" Value=\"[#InstallToolsBat]\" />\n+    <CustomAction Id=\"LaunchApplication\" BinaryKey=\"WixCA\" DllEntry=\"WixShellExec\" />\n+\n     <InstallUISequence>\n       <Custom Action='SetInstallScope' Before='FindRelatedProducts'/>\n     </InstallUISequence>\n@@ -340,6 +359,23 @@\n       <DialogRef Id=\"InstallDirDlg\"/>\n       <DialogRef Id=\"BrowseDlg\"/>\n       <DialogRef Id=\"InvalidDirDlg\"/>\n+      <Dialog Id=\"NativeToolsDlg\" Width=\"370\" Height=\"270\" Title=\"!(loc.NativeToolsDlg_Title)\">\n+        <Control Id=\"BannerBitmap\" Type=\"Bitmap\" X=\"0\" Y=\"0\" Width=\"370\" Height=\"44\" TabSkip=\"no\" Text=\"!(loc.NativeToolsDlgBannerBitmap)\" />\n+        <Control Id=\"Title\" Type=\"Text\" X=\"15\" Y=\"6\" Width=\"200\" Height=\"15\" Transparent=\"yes\" NoPrefix=\"yes\" Text=\"!(loc.NativeToolsDlgTitle)\" />\n+        <Control Id=\"Description\" Type=\"Text\" X=\"25\" Y=\"23\" Width=\"280\" Height=\"15\" Transparent=\"yes\" NoPrefix=\"yes\" Text=\"!(loc.NativeToolsDlgDescription)\" />\n+        <Control Id=\"BannerLine\" Type=\"Line\" X=\"0\" Y=\"44\" Width=\"370\" Height=\"0\" />\n+\n+        <Control Id=\"Intro\" Type=\"Text\" X=\"20\" Y=\"65\" Width=\"330\" Height=\"30\" NoPrefix=\"yes\" Text=\"!(loc.NativeToolsDlgIntro)\" />\n+        <Control Id=\"InstallCheckbox\" Type=\"CheckBox\" X=\"20\" Y=\"105\" Width=\"330\" Height=\"30\" Property=\"NATIVETOOLSCHECKBOX\" CheckBoxValue=\"1\" Text=\"!(loc.NativeToolsDlgInstallCheckbox)\" />\n+        <Control Id=\"ManualDetails\" Type=\"Hyperlink\" X=\"20\" Y=\"140\" Width=\"330\" Height=\"30\" Text=\"!(loc.NativeToolsDlgManualDetails)\" />\n+\n+        <Control Id=\"BottomLine\" Type=\"Line\" X=\"0\" Y=\"234\" Width=\"370\" Height=\"0\" />\n+        <Control Id=\"Next\" Type=\"PushButton\" X=\"236\" Y=\"243\" Width=\"56\" Height=\"17\" Default=\"yes\" Text=\"!(loc.WixUINext)\" />\n+        <Control Id=\"Back\" Type=\"PushButton\" X=\"180\" Y=\"243\" Width=\"56\" Height=\"17\" Text=\"!(loc.WixUIBack)\" />\n+        <Control Id=\"Cancel\" Type=\"PushButton\" X=\"304\" Y=\"243\" Width=\"56\" Height=\"17\" Cancel=\"yes\" Text=\"!(loc.WixUICancel)\">\n+          <Publish Event=\"SpawnDialog\" Value=\"CancelDlg\">1</Publish>\n+        </Control>\n+      </Dialog>\n \n       <Publish Dialog=\"WelcomeDlg\" Control=\"Next\" Event=\"NewDialog\" Value=\"LicenseAgreementDlg\">NOT Installed</Publish>\n       <Publish Dialog=\"WelcomeDlg\" Control=\"Next\" Event=\"NewDialog\" Value=\"VerifyReadyDlg\">Installed AND PATCH</Publish>\n@@ -350,7 +386,6 @@\n       <Publish Dialog=\"InstallDirDlg\" Control=\"Next\" Event=\"SetTargetPath\" Value=\"[WIXUI_INSTALLDIR]\" Order=\"10\">1</Publish>\n       <Publish Dialog=\"InstallDirDlg\" Control=\"ChangeFolder\" Property=\"_BrowseProperty\" Value=\"[WIXUI_INSTALLDIR]\" Order=\"10\">1</Publish>\n       <Publish Dialog=\"InstallDirDlg\" Control=\"ChangeFolder\" Event=\"SpawnDialog\" Value=\"BrowseDlg\" Order=\"20\">1</Publish>\n-      <Publish Dialog=\"ExitDialog\" Control=\"Finish\" Event=\"EndDialog\" Value=\"Return\" Order=\"999\">1</Publish>\n       <Publish Dialog=\"VerifyReadyDlg\" Control=\"Back\" Event=\"NewDialog\" Value=\"CustomizeDlg\" Order=\"1\">NOT Installed OR WixUI_InstallMode = \"Change\"</Publish>\n       <Publish Dialog=\"VerifyReadyDlg\" Control=\"Back\" Event=\"NewDialog\" Value=\"MaintenanceTypeDlg\" Order=\"2\">Installed AND NOT PATCH</Publish>\n       <Publish Dialog=\"VerifyReadyDlg\" Control=\"Back\" Event=\"NewDialog\" Value=\"WelcomeDlg\" Order=\"3\">Installed AND PATCH</Publish>\n@@ -361,7 +396,11 @@\n       <Publish Dialog=\"MaintenanceTypeDlg\" Control=\"Back\" Event=\"NewDialog\" Value=\"MaintenanceWelcomeDlg\">1</Publish>\n       <Publish Dialog=\"CustomizeDlg\" Control=\"Back\" Event=\"NewDialog\" Value=\"MaintenanceTypeDlg\" Order=\"1\">Installed</Publish>\n       <Publish Dialog=\"CustomizeDlg\" Control=\"Back\" Event=\"NewDialog\" Value=\"InstallDirDlg\" Order=\"2\">NOT Installed</Publish>\n-      <Publish Dialog=\"CustomizeDlg\" Control=\"Next\" Event=\"NewDialog\" Value=\"VerifyReadyDlg\">1</Publish>\n+      <Publish Dialog=\"CustomizeDlg\" Control=\"Next\" Event=\"NewDialog\" Value=\"NativeToolsDlg\">1</Publish>\n+      <Publish Dialog=\"NativeToolsDlg\" Control=\"Back\" Event=\"NewDialog\" Value=\"CustomizeDlg\">1</Publish>\n+      <Publish Dialog=\"NativeToolsDlg\" Control=\"Next\" Event=\"NewDialog\" Value=\"VerifyReadyDlg\">1</Publish>\n+      <Publish Dialog=\"ExitDialog\" Control=\"Finish\" Event=\"DoAction\" Value=\"LaunchApplication\">NATIVETOOLSCHECKBOX = 1</Publish>\n+      <Publish Dialog=\"ExitDialog\" Control=\"Finish\" Event=\"EndDialog\" Value=\"Return\" Order=\"999\">1</Publish>\n \n       <Property Id=\"WIXUI_EXITDIALOGOPTIONALTEXT\" Value=\"!(loc.WIXUI_EXITDIALOGOPTIONALTEXT)\"/>\n     </UI>"
        }
    ],
    "stats": {
        "total": 79,
        "additions": 77,
        "deletions": 2
    }
}