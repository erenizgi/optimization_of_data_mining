{
    "author": "dtoki",
    "message": "src: add deprecation warning to errname()\n\nPR-URL: https://github.com/nodejs/node/pull/23597\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Сковорода Никита Андреевич <chalkerx@gmail.com>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>",
    "sha": "91fe7e5ad28a7bc75948f380a051aae156131b37",
    "files": [
        {
            "sha": "33e98c4cd4404d848dc1a7495bc2fe2cb6361113",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/91fe7e5ad28a7bc75948f380a051aae156131b37/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/91fe7e5ad28a7bc75948f380a051aae156131b37/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=91fe7e5ad28a7bc75948f380a051aae156131b37",
            "patch": "@@ -2233,6 +2233,21 @@ like `dns.lookup(false)` due to backward compatibility.\n This behavior is undocumented and is thought to be unused in real world apps.\n It will become an error in future versions of Node.js.\n \n+<a id=\"DEP0119\"></a>\n+### DEP0119: process.binding('uv').errname() private API\n+<!--\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/23597\n+    description: Documentation-only deprecation.\n+-->\n+\n+Type: Documentation-only (supports [`--pending-deprecation`][])\n+\n+Directly calling `process.binding('uv').errname(<val>)` is deprecated.\n+Please make sure to use [`util.getSystemErrorName()`][] instead.\n+\n+\n [`--pending-deprecation`]: cli.html#cli_pending_deprecation\n [`Buffer.allocUnsafeSlow(size)`]: buffer.html#buffer_class_method_buffer_allocunsafeslow_size\n [`Buffer.from(array)`]: buffer.html#buffer_class_method_buffer_from_array\n@@ -2300,6 +2315,7 @@ It will become an error in future versions of Node.js.\n [`util._extend()`]: util.html#util_util_extend_target_source\n [`util.debug()`]: util.html#util_util_debug_string\n [`util.error()`]: util.html#util_util_error_strings\n+[`util.getSystemErrorName()`]: util.html#util_util_getsystemerrorname_err\n [`util.inspect()`]: util.html#util_util_inspect_object_options\n [`util.inspect.custom`]: util.html#util_util_inspect_custom\n [`util.isArray()`]: util.html#util_util_isarray_object"
        },
        {
            "sha": "4f98b5590cf941f9957f9620bd4ecf4495dff755",
            "filename": "src/env.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/91fe7e5ad28a7bc75948f380a051aae156131b37/src%2Fenv.cc",
            "raw_url": "https://github.com/nodejs/node/raw/91fe7e5ad28a7bc75948f380a051aae156131b37/src%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.cc?ref=91fe7e5ad28a7bc75948f380a051aae156131b37",
            "patch": "@@ -134,6 +134,7 @@ Environment::Environment(IsolateData* isolate_data,\n       printed_error_(false),\n       abort_on_uncaught_exception_(false),\n       emit_env_nonstring_warning_(true),\n+      emit_err_name_warning_(true),\n       makecallback_cntr_(0),\n       should_abort_on_uncaught_toggle_(isolate_, 1),\n       trace_category_state_(isolate_, kTraceCategoryCount),"
        },
        {
            "sha": "3daa48f9cbb70e070c8b0b5bc16fcc06195afb9a",
            "filename": "src/env.h",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/91fe7e5ad28a7bc75948f380a051aae156131b37/src%2Fenv.h",
            "raw_url": "https://github.com/nodejs/node/raw/91fe7e5ad28a7bc75948f380a051aae156131b37/src%2Fenv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.h?ref=91fe7e5ad28a7bc75948f380a051aae156131b37",
            "patch": "@@ -843,6 +843,12 @@ class Environment {\n     return current_value;\n   }\n \n+  inline bool EmitErrNameWarning() {\n+    bool current_value = emit_err_name_warning_;\n+    emit_err_name_warning_ = false;\n+    return current_value;\n+  }\n+\n   typedef void (*native_immediate_callback)(Environment* env, void* data);\n   // cb will be called as cb(env, data) on the next event loop iteration.\n   // obj will be kept alive between now and after the callback has run.\n@@ -929,6 +935,7 @@ class Environment {\n   bool printed_error_;\n   bool abort_on_uncaught_exception_;\n   bool emit_env_nonstring_warning_;\n+  bool emit_err_name_warning_;\n   size_t makecallback_cntr_;\n   std::vector<double> destroy_async_id_list_;\n "
        },
        {
            "sha": "354acee4c01fc6923bb2096fdaecfb89dd986d0e",
            "filename": "src/uv.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/91fe7e5ad28a7bc75948f380a051aae156131b37/src%2Fuv.cc",
            "raw_url": "https://github.com/nodejs/node/raw/91fe7e5ad28a7bc75948f380a051aae156131b37/src%2Fuv.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fuv.cc?ref=91fe7e5ad28a7bc75948f380a051aae156131b37",
            "patch": "@@ -39,10 +39,17 @@ using v8::String;\n using v8::Value;\n \n \n-// TODO(joyeecheung): deprecate this function in favor of\n-// lib/util.getSystemErrorName()\n void ErrName(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n+  if (env->options()->pending_deprecation && env->EmitErrNameWarning()) {\n+    if (ProcessEmitDeprecationWarning(\n+        env,\n+        \"Directly calling process.binding('uv').errname(<val>) is being\"\n+        \" deprecated. \"\n+        \"Please make sure to use util.getSystemErrorName() instead.\",\n+        \"DEP0119\").IsNothing())\n+    return;\n+  }\n   int err;\n   if (!args[0]->Int32Value(env->context()).To(&err)) return;\n   CHECK_LT(err, 0);"
        },
        {
            "sha": "d9af7e3804ec4ab98b5cf7d2e81ef048b42ec6cd",
            "filename": "test/parallel/test-err-name-deprecation.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/91fe7e5ad28a7bc75948f380a051aae156131b37/test%2Fparallel%2Ftest-err-name-deprecation.js",
            "raw_url": "https://github.com/nodejs/node/raw/91fe7e5ad28a7bc75948f380a051aae156131b37/test%2Fparallel%2Ftest-err-name-deprecation.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-err-name-deprecation.js?ref=91fe7e5ad28a7bc75948f380a051aae156131b37",
            "patch": "@@ -0,0 +1,13 @@\n+'use strict';\n+const common = require('../common');\n+\n+// Flags: --pending-deprecation\n+\n+common.expectWarning(\n+  'DeprecationWarning',\n+  'Directly calling process.binding(\\'uv\\').errname(<val>) is being ' +\n+  'deprecated. Please make sure to use util.getSystemErrorName() instead.',\n+  'DEP0119'\n+);\n+\n+process.binding('uv').errname(-1);"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 46,
        "deletions": 2
    }
}