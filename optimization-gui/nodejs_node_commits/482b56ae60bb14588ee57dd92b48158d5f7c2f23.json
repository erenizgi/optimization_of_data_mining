{
    "author": "bnoordhuis",
    "message": "fs: default open/openSync flags argument to 'r'\n\nMake fs.open() and fs.openSync() more economic to use by making the\nflags argument optional. You can now write:\n\n    fs.open(file, cb)\n\nInstead of the more verbose:\n\n    fs.open(file, 'r', cb)\n\nThis idiom is already supported by functions like fs.readFile().\n\nPR-URL: https://github.com/nodejs/node/pull/23767\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "482b56ae60bb14588ee57dd92b48158d5f7c2f23",
    "files": [
        {
            "sha": "47fcefbac07b9b9077eaad44fcdceefac3699946",
            "filename": "doc/api/fs.md",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/482b56ae60bb14588ee57dd92b48158d5f7c2f23/doc%2Fapi%2Ffs.md",
            "raw_url": "https://github.com/nodejs/node/raw/482b56ae60bb14588ee57dd92b48158d5f7c2f23/doc%2Fapi%2Ffs.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ffs.md?ref=482b56ae60bb14588ee57dd92b48158d5f7c2f23",
            "patch": "@@ -2309,7 +2309,7 @@ this API: [`fs.mkdtemp()`][].\n The optional `options` argument can be a string specifying an encoding, or an\n object with an `encoding` property specifying the character encoding to use.\n \n-## fs.open(path, flags[, mode], callback)\n+## fs.open(path[, flags[, mode]], callback)\n <!-- YAML\n added: v0.0.2\n changes:\n@@ -2324,6 +2324,7 @@ changes:\n \n * `path` {string|Buffer|URL}\n * `flags` {string|number} See [support of file system `flags`][].\n+  **Default:** `'r'`.\n * `mode` {integer} **Default:** `0o666` (readable and writable)\n * `callback` {Function}\n   * `err` {Error}\n@@ -2345,7 +2346,7 @@ a colon, Node.js will open a file system stream, as described by\n Functions based on `fs.open()` exhibit this behavior as well:\n `fs.writeFile()`, `fs.readFile()`, etc.\n \n-## fs.openSync(path, flags[, mode])\n+## fs.openSync(path[, flags, mode])\n <!-- YAML\n added: v0.1.21\n changes:\n@@ -2356,7 +2357,8 @@ changes:\n -->\n \n * `path` {string|Buffer|URL}\n-* `flags` {string|number} See [support of file system `flags`][].\n+* `flags` {string|number} **Default:** `'r'`.\n+   See [support of file system `flags`][].\n * `mode` {integer} **Default:** `0o666`\n * Returns: {number}\n "
        },
        {
            "sha": "89c005375f450e12120a63e75014ce65e298f585",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 12,
            "deletions": 7,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/482b56ae60bb14588ee57dd92b48158d5f7c2f23/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/482b56ae60bb14588ee57dd92b48158d5f7c2f23/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=482b56ae60bb14588ee57dd92b48158d5f7c2f23",
            "patch": "@@ -345,7 +345,7 @@ function tryReadSync(fd, isUserFd, buffer, pos, len) {\n function readFileSync(path, options) {\n   options = getOptions(options, { flag: 'r' });\n   const isUserFd = isFd(path); // file descriptor ownership\n-  const fd = isUserFd ? path : fs.openSync(path, options.flag || 'r', 0o666);\n+  const fd = isUserFd ? path : fs.openSync(path, options.flag, 0o666);\n \n   const stats = tryStatSync(fd, isUserFd);\n   const size = isFileType(stats, S_IFREG) ? stats[8] : 0;\n@@ -411,14 +411,19 @@ function closeSync(fd) {\n function open(path, flags, mode, callback) {\n   path = toPathIfFileURL(path);\n   validatePath(path);\n-  const flagsNumber = stringToFlags(flags);\n-  if (arguments.length < 4) {\n-    callback = makeCallback(mode);\n+  if (arguments.length < 3) {\n+    callback = flags;\n+    flags = 'r';\n     mode = 0o666;\n-  } else {\n+  } else if (arguments.length === 3) {\n+    callback = mode;\n+    mode = 0o666;\n+  }\n+  const flagsNumber = stringToFlags(flags);\n+  if (arguments.length >= 4) {\n     mode = validateMode(mode, 'mode', 0o666);\n-    callback = makeCallback(callback);\n   }\n+  callback = makeCallback(callback);\n \n   const req = new FSReqCallback();\n   req.oncomplete = callback;\n@@ -433,7 +438,7 @@ function open(path, flags, mode, callback) {\n function openSync(path, flags, mode) {\n   path = toPathIfFileURL(path);\n   validatePath(path);\n-  const flagsNumber = stringToFlags(flags);\n+  const flagsNumber = stringToFlags(flags || 'r');\n   mode = validateMode(mode, 'mode', 0o666);\n \n   const ctx = { path };"
        },
        {
            "sha": "b6b4d6605d3387d39dfb46244c77c3c5a20727a7",
            "filename": "lib/internal/fs/promises.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/482b56ae60bb14588ee57dd92b48158d5f7c2f23/lib%2Finternal%2Ffs%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/482b56ae60bb14588ee57dd92b48158d5f7c2f23/lib%2Finternal%2Ffs%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Fpromises.js?ref=482b56ae60bb14588ee57dd92b48158d5f7c2f23",
            "patch": "@@ -196,11 +196,12 @@ async function copyFile(src, dest, flags) {\n async function open(path, flags, mode) {\n   path = toPathIfFileURL(path);\n   validatePath(path);\n+  if (arguments.length < 2) flags = 'r';\n+  const flagsNumber = stringToFlags(flags);\n   mode = validateMode(mode, 'mode', 0o666);\n   return new FileHandle(\n     await binding.openFileHandle(pathModule.toNamespacedPath(path),\n-                                 stringToFlags(flags),\n-                                 mode, kUsePromises));\n+                                 flagsNumber, mode, kUsePromises));\n }\n \n async function read(handle, buffer, offset, length, position) {"
        },
        {
            "sha": "788124825249ca253702aebfa06a685263e9b249",
            "filename": "test/parallel/test-fs-open.js",
            "status": "modified",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/482b56ae60bb14588ee57dd92b48158d5f7c2f23/test%2Fparallel%2Ftest-fs-open.js",
            "raw_url": "https://github.com/nodejs/node/raw/482b56ae60bb14588ee57dd92b48158d5f7c2f23/test%2Fparallel%2Ftest-fs-open.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-open.js?ref=482b56ae60bb14588ee57dd92b48158d5f7c2f23",
            "patch": "@@ -36,6 +36,12 @@ try {\n }\n assert.strictEqual(caughtException, true);\n \n+fs.openSync(__filename);\n+\n+fs.open(__filename, common.mustCall((err) => {\n+  assert.ifError(err);\n+}));\n+\n fs.open(__filename, 'r', common.mustCall((err) => {\n   assert.ifError(err);\n }));\n@@ -44,6 +50,39 @@ fs.open(__filename, 'rs', common.mustCall((err) => {\n   assert.ifError(err);\n }));\n \n+fs.open(__filename, 'r', 0, common.mustCall((err) => {\n+  assert.ifError(err);\n+}));\n+\n+fs.open(__filename, 'r', null, common.mustCall((err) => {\n+  assert.ifError(err);\n+}));\n+\n+async function promise() {\n+  await fs.promises.open(__filename);\n+  await fs.promises.open(__filename, 'r');\n+}\n+\n+promise().then(common.mustCall()).catch(common.mustNotCall());\n+\n+common.expectsError(\n+  () => fs.open(__filename, 'r', 'boom', common.mustNotCall()),\n+  {\n+    code: 'ERR_INVALID_ARG_VALUE',\n+    type: TypeError\n+  }\n+);\n+\n+for (const extra of [[], ['r'], ['r', 0], ['r', 0, 'bad callback']]) {\n+  common.expectsError(\n+    () => fs.open(__filename, ...extra),\n+    {\n+      code: 'ERR_INVALID_CALLBACK',\n+      type: TypeError\n+    }\n+  );\n+}\n+\n [false, 1, [], {}, null, undefined].forEach((i) => {\n   common.expectsError(\n     () => fs.open(i, 'r', common.mustNotCall()),\n@@ -59,4 +98,15 @@ fs.open(__filename, 'rs', common.mustCall((err) => {\n       type: TypeError\n     }\n   );\n+  fs.promises.open(i, 'r')\n+    .then(common.mustNotCall())\n+    .catch(common.mustCall((err) => {\n+      common.expectsError(\n+        () => { throw err; },\n+        {\n+          code: 'ERR_INVALID_ARG_TYPE',\n+          type: TypeError\n+        }\n+      );\n+    }));\n });"
        }
    ],
    "stats": {
        "total": 82,
        "additions": 70,
        "deletions": 12
    }
}