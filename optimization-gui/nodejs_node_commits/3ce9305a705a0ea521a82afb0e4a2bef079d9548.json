{
    "author": "apapirovski",
    "message": "process: emit unhandled warning immediately\n\nPR-URL: https://github.com/nodejs/node/pull/24632\nFixes: https://github.com/nodejs/node/issues/24209\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Franziska Hinkelmann <franziska.hinkelmann@gmail.com>",
    "sha": "3ce9305a705a0ea521a82afb0e4a2bef079d9548",
    "files": [
        {
            "sha": "31c96293b341b9e3bf087b7aa6f901d966e2a49c",
            "filename": "lib/internal/process/promises.js",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/3ce9305a705a0ea521a82afb0e4a2bef079d9548/lib%2Finternal%2Fprocess%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/3ce9305a705a0ea521a82afb0e4a2bef079d9548/lib%2Finternal%2Fprocess%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fpromises.js?ref=3ce9305a705a0ea521a82afb0e4a2bef079d9548",
            "patch": "@@ -108,7 +108,7 @@ function emitPromiseRejectionWarnings() {\n     }\n   }\n \n-  let hadListeners = false;\n+  let maybeScheduledTicks = false;\n   let len = pendingUnhandledRejections.length;\n   while (len--) {\n     const promise = pendingUnhandledRejections.shift();\n@@ -118,10 +118,9 @@ function emitPromiseRejectionWarnings() {\n       const { reason, uid } = promiseInfo;\n       if (!process.emit('unhandledRejection', reason, promise)) {\n         emitWarning(uid, reason);\n-      } else {\n-        hadListeners = true;\n       }\n+      maybeScheduledTicks = true;\n     }\n   }\n-  return hadListeners || pendingUnhandledRejections.length !== 0;\n+  return maybeScheduledTicks || pendingUnhandledRejections.length !== 0;\n }"
        },
        {
            "sha": "4464fad8e4b8460f45b0b07974d273012dcd295d",
            "filename": "test/parallel/test-promises-unhandled-rejections.js",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/3ce9305a705a0ea521a82afb0e4a2bef079d9548/test%2Fparallel%2Ftest-promises-unhandled-rejections.js",
            "raw_url": "https://github.com/nodejs/node/raw/3ce9305a705a0ea521a82afb0e4a2bef079d9548/test%2Fparallel%2Ftest-promises-unhandled-rejections.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-promises-unhandled-rejections.js?ref=3ce9305a705a0ea521a82afb0e4a2bef079d9548",
            "patch": "@@ -699,3 +699,22 @@ asyncTest('Rejected promise inside unhandledRejection allows nextTick loop' +\n     process.nextTick(() => promise.catch(() => done()));\n   });\n });\n+\n+asyncTest(\n+  'Unhandled promise rejection emits a warning immediately',\n+  function(done) {\n+    clean();\n+    Promise.reject(0);\n+    const { emitWarning } = process;\n+    process.emitWarning = common.mustCall((...args) => {\n+      if (timer) {\n+        clearTimeout(timer);\n+        timer = null;\n+        done();\n+      }\n+      emitWarning(...args);\n+    }, 2);\n+\n+    let timer = setTimeout(common.mustNotCall(), 10000);\n+  },\n+);"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 22,
        "deletions": 4
    }
}