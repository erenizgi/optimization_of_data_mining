{
    "author": "yhwang",
    "message": "build: include the libuv and zlib into node\n\nAdd libuv and zlib into node executable and shared lib. Also fix an\nissue that openssl is not fully included in node executable for macOS.\n\nSigned-off-by: Yihong Wang <yh.wang@ibm.com>\n\nFixes: https://github.com/nodejs/node/issues/17444\nPR-URL: https://github.com/nodejs/node/pull/18383\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "d161625c004827a4c09c560a193bcd499a68a28a",
    "files": [
        {
            "sha": "160303f69fc5895cfe8eac70f4ab25893487670f",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/d161625c004827a4c09c560a193bcd499a68a28a/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/d161625c004827a4c09c560a193bcd499a68a28a/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=d161625c004827a4c09c560a193bcd499a68a28a",
            "patch": "@@ -234,7 +234,7 @@\n             },\n           },\n           'conditions': [\n-            ['OS in \"linux freebsd openbsd solaris android\"', {\n+            ['OS!=\"aix\"', {\n               'ldflags': [\n                 '-Wl,--whole-archive,<(obj_dir)/<(STATIC_LIB_PREFIX)'\n                     '<(node_core_target_name)<(STATIC_LIB_SUFFIX)',"
        },
        {
            "sha": "852cc18eee7495793556d2c0b5aae678ca6f9409",
            "filename": "node.gypi",
            "status": "modified",
            "additions": 60,
            "deletions": 2,
            "changes": 62,
            "blob_url": "https://github.com/nodejs/node/blob/d161625c004827a4c09c560a193bcd499a68a28a/node.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/d161625c004827a4c09c560a193bcd499a68a28a/node.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gypi?ref=d161625c004827a4c09c560a193bcd499a68a28a",
            "patch": "@@ -107,6 +107,32 @@\n     }],\n     [ 'node_shared_zlib==\"false\"', {\n       'dependencies': [ 'deps/zlib/zlib.gyp:zlib' ],\n+      'conditions': [\n+        [ 'force_load==\"true\"', {\n+          'xcode_settings': {\n+            'OTHER_LDFLAGS': [\n+              '-Wl,-force_load,<(PRODUCT_DIR)/<(STATIC_LIB_PREFIX)'\n+                  'zlib<(STATIC_LIB_SUFFIX)',\n+            ],\n+          },\n+          'msvs_settings': {\n+            'VCLinkerTool': {\n+              'AdditionalOptions': [\n+                '/WHOLEARCHIVE:<(PRODUCT_DIR)\\\\lib\\\\zlib<(STATIC_LIB_SUFFIX)',\n+              ],\n+            },\n+          },\n+          'conditions': [\n+            ['OS!=\"aix\" and node_shared==\"false\"', {\n+              'ldflags': [\n+                '-Wl,--whole-archive,<(obj_dir)/deps/zlib/<(STATIC_LIB_PREFIX)'\n+                    'zlib<(STATIC_LIB_SUFFIX)',\n+                '-Wl,--no-whole-archive',\n+              ],\n+            }],\n+          ],\n+        }],\n+      ],\n     }],\n \n     [ 'node_shared_http_parser==\"false\"', {\n@@ -119,6 +145,32 @@\n \n     [ 'node_shared_libuv==\"false\"', {\n       'dependencies': [ 'deps/uv/uv.gyp:libuv' ],\n+      'conditions': [\n+        [ 'force_load==\"true\"', {\n+          'xcode_settings': {\n+            'OTHER_LDFLAGS': [\n+              '-Wl,-force_load,<(PRODUCT_DIR)/<(STATIC_LIB_PREFIX)'\n+                  'uv<(STATIC_LIB_SUFFIX)',\n+            ],\n+          },\n+          'msvs_settings': {\n+            'VCLinkerTool': {\n+              'AdditionalOptions': [\n+                '/WHOLEARCHIVE:<(PRODUCT_DIR)\\\\lib\\\\libuv<(STATIC_LIB_SUFFIX)',\n+              ],\n+            },\n+          },\n+          'conditions': [\n+            ['OS!=\"aix\" and node_shared==\"false\"', {\n+              'ldflags': [\n+                '-Wl,--whole-archive,<(obj_dir)/deps/uv/<(STATIC_LIB_PREFIX)'\n+                    'uv<(STATIC_LIB_SUFFIX)',\n+                '-Wl,--no-whole-archive',\n+              ],\n+            }],\n+          ],\n+        }],\n+      ],\n     }],\n \n     [ 'node_shared_nghttp2==\"false\"', {\n@@ -235,12 +287,18 @@\n                   '-Wl,-force_load,<(PRODUCT_DIR)/<(openssl_product)',\n                 ],\n               },\n+              'msvs_settings': {\n+                'VCLinkerTool': {\n+                  'AdditionalOptions': [\n+                    '/WHOLEARCHIVE:<(PRODUCT_DIR)\\\\lib\\\\<(openssl_product)',\n+                  ],\n+                },\n+              },\n               'conditions': [\n                 ['OS in \"linux freebsd\" and node_shared==\"false\"', {\n                   'ldflags': [\n                     '-Wl,--whole-archive,'\n-                        '<(obj_dir)/deps/openssl/'\n-                        '<(openssl_product)',\n+                      '<(obj_dir)/deps/openssl/<(openssl_product)',\n                     '-Wl,--no-whole-archive',\n                   ],\n                 }],"
        }
    ],
    "stats": {
        "total": 64,
        "additions": 61,
        "deletions": 3
    }
}