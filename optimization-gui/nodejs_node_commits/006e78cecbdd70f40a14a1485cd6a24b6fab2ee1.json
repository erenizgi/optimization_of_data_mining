{
    "author": "joyeecheung",
    "message": "process: refactor lib/internal/bootstrap/node.js\n\n- Use `deprecate` from `internal/util` instead of from `util`\n- Split `setupGlobalVariables()` into `setupGlobalProxy()` and\n  `setupBuffer()`, and move out manipulation of the process object.\n\nPR-URL: https://github.com/nodejs/node/pull/26033\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "006e78cecbdd70f40a14a1485cd6a24b6fab2ee1",
    "files": [
        {
            "sha": "7d3d267123da9528236aa58bf0ad57be0020668f",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 18,
            "deletions": 15,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/006e78cecbdd70f40a14a1485cd6a24b6fab2ee1/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/006e78cecbdd70f40a14a1485cd6a24b6fab2ee1/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=006e78cecbdd70f40a14a1485cd6a24b6fab2ee1",
            "patch": "@@ -40,6 +40,7 @@ const { internalBinding, NativeModule } = loaderExports;\n const { Object, Symbol } = primordials;\n const { getOptionValue } = NativeModule.require('internal/options');\n const config = internalBinding('config');\n+const { deprecate } = NativeModule.require('internal/util');\n \n setupTraceCategoryState();\n \n@@ -63,7 +64,11 @@ setupProcessObject();\n     hasUncaughtExceptionCaptureCallback;\n }\n \n-setupGlobalVariables();\n+setupGlobalProxy();\n+setupBuffer();\n+\n+process.domain = null;\n+process._exiting = false;\n \n // Bootstrappers for all threads, including worker threads and main thread\n const perThreadSetup = NativeModule.require('internal/process/per_thread');\n@@ -235,7 +240,6 @@ Object.defineProperty(process, 'allowedNodeEnvironmentFlags', {\n   configurable: true\n });\n \n-const { deprecate } = NativeModule.require('internal/util');\n // process.assert\n process.assert = deprecate(\n   perThreadSetup.assert,\n@@ -350,6 +354,13 @@ function setupProcessObject() {\n   const origProcProto = Object.getPrototypeOf(process);\n   Object.setPrototypeOf(origProcProto, EventEmitter.prototype);\n   EventEmitter.call(process);\n+  // Make process globally available to users by putting it on the global proxy\n+  Object.defineProperty(global, 'process', {\n+    value: process,\n+    enumerable: false,\n+    writable: true,\n+    configurable: true\n+  });\n }\n \n function setupProcessStdio(getStdout, getStdin, getStderr) {\n@@ -377,29 +388,22 @@ function setupProcessStdio(getStdout, getStdin, getStderr) {\n   };\n }\n \n-function setupGlobalVariables() {\n+function setupGlobalProxy() {\n   Object.defineProperty(global, Symbol.toStringTag, {\n     value: 'global',\n     writable: false,\n     enumerable: false,\n     configurable: true\n   });\n-  Object.defineProperty(global, 'process', {\n-    value: process,\n-    enumerable: false,\n-    writable: true,\n-    configurable: true\n-  });\n-  const util = NativeModule.require('util');\n \n   function makeGetter(name) {\n-    return util.deprecate(function() {\n+    return deprecate(function() {\n       return this;\n     }, `'${name}' is deprecated, use 'global'`, 'DEP0016');\n   }\n \n   function makeSetter(name) {\n-    return util.deprecate(function(value) {\n+    return deprecate(function(value) {\n       Object.defineProperty(this, name, {\n         configurable: true,\n         writable: true,\n@@ -421,7 +425,9 @@ function setupGlobalVariables() {\n       set: makeSetter('root')\n     }\n   });\n+}\n \n+function setupBuffer() {\n   const { Buffer } = NativeModule.require('buffer');\n   const bufferBinding = internalBinding('buffer');\n \n@@ -436,9 +442,6 @@ function setupGlobalVariables() {\n     writable: true,\n     configurable: true\n   });\n-\n-  process.domain = null;\n-  process._exiting = false;\n }\n \n function setupGlobalTimeouts() {"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 18,
        "deletions": 15
    }
}