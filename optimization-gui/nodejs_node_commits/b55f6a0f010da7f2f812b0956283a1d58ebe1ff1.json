{
    "author": "jasnell",
    "message": "perf_hooks: remove less useful bootstrap marks\n\nWhile `perf_hooks` is still in experimental, remove less useful\nbootstrap milestones.\n\nPR-URL: https://github.com/nodejs/node/pull/21247\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "b55f6a0f010da7f2f812b0956283a1d58ebe1ff1",
    "files": [
        {
            "sha": "f16a217bbea6efc5b494651add0fd2148af360d8",
            "filename": "doc/api/perf_hooks.md",
            "status": "modified",
            "additions": 0,
            "deletions": 78,
            "changes": 78,
            "blob_url": "https://github.com/nodejs/node/blob/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/doc%2Fapi%2Fperf_hooks.md",
            "raw_url": "https://github.com/nodejs/node/raw/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/doc%2Fapi%2Fperf_hooks.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fperf_hooks.md?ref=b55f6a0f010da7f2f812b0956283a1d58ebe1ff1",
            "patch": "@@ -219,26 +219,6 @@ The high resolution millisecond timestamp at which the Node.js process\n completed bootstrapping. If bootstrapping has not yet finished, the property\n has the value of -1.\n \n-### performanceNodeTiming.clusterSetupEnd\n-<!-- YAML\n-added: v8.5.0\n--->\n-\n-* {number}\n-\n-The high resolution millisecond timestamp at which cluster processing ended. If\n-cluster processing has not yet ended, the property has the value of -1.\n-\n-### performanceNodeTiming.clusterSetupStart\n-<!-- YAML\n-added: v8.5.0\n--->\n-\n-* {number}\n-\n-The high resolution millisecond timestamp at which cluster processing started.\n-If cluster processing has not yet started, the property has the value of -1.\n-\n ### performanceNodeTiming.loopExit\n <!-- YAML\n added: v8.5.0\n@@ -261,24 +241,6 @@ The high resolution millisecond timestamp at which the Node.js event loop\n started. If the event loop has not yet started (e.g., in the first tick of the\n main script), the property has the value of -1.\n \n-### performanceNodeTiming.moduleLoadEnd\n-<!-- YAML\n-added: v8.5.0\n--->\n-\n-* {number}\n-\n-The high resolution millisecond timestamp at which main module load ended.\n-\n-### performanceNodeTiming.moduleLoadStart\n-<!-- YAML\n-added: v8.5.0\n--->\n-\n-* {number}\n-\n-The high resolution millisecond timestamp at which main module load started.\n-\n ### performanceNodeTiming.nodeStart\n <!-- YAML\n added: v8.5.0\n@@ -289,46 +251,6 @@ added: v8.5.0\n The high resolution millisecond timestamp at which the Node.js process was\n initialized.\n \n-### performanceNodeTiming.preloadModuleLoadEnd\n-<!-- YAML\n-added: v8.5.0\n--->\n-\n-* {number}\n-\n-The high resolution millisecond timestamp at which preload module load ended.\n-\n-### performanceNodeTiming.preloadModuleLoadStart\n-<!-- YAML\n-added: v8.5.0\n--->\n-\n-* {number}\n-\n-The high resolution millisecond timestamp at which preload module load started.\n-\n-### performanceNodeTiming.thirdPartyMainEnd\n-<!-- YAML\n-added: v8.5.0\n--->\n-\n-* {number}\n-\n-The high resolution millisecond timestamp at which third\\_party\\_main\n-processing ended. If third\\_party\\_main processing has not yet ended, the\n-property has the value of -1.\n-\n-### performanceNodeTiming.thirdPartyMainStart\n-<!-- YAML\n-added: v8.5.0\n--->\n-\n-* {number}\n-\n-The high resolution millisecond timestamp at which third\\_party\\_main\n-processing started. If third\\_party\\_main processing has not yet started, the\n-property has the value of -1.\n-\n ### performanceNodeTiming.v8Start\n <!-- YAML\n added: v8.5.0"
        },
        {
            "sha": "a1162d384a1215cc0d0c773bf7392fc1ba57edac",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=b55f6a0f010da7f2f812b0956283a1d58ebe1ff1",
            "patch": "@@ -68,14 +68,6 @@\n     const perf = process.binding('performance');\n     const {\n       NODE_PERFORMANCE_MILESTONE_BOOTSTRAP_COMPLETE,\n-      NODE_PERFORMANCE_MILESTONE_THIRD_PARTY_MAIN_START,\n-      NODE_PERFORMANCE_MILESTONE_THIRD_PARTY_MAIN_END,\n-      NODE_PERFORMANCE_MILESTONE_CLUSTER_SETUP_START,\n-      NODE_PERFORMANCE_MILESTONE_CLUSTER_SETUP_END,\n-      NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_START,\n-      NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_END,\n-      NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_START,\n-      NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_END\n     } = perf.constants;\n \n     _process.setup_hrtime(_hrtime);\n@@ -189,9 +181,7 @@\n       // one to drop a file lib/_third_party_main.js into the build\n       // directory which will be executed instead of Node's normal loading.\n       process.nextTick(function() {\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_THIRD_PARTY_MAIN_START);\n         NativeModule.require('_third_party_main');\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_THIRD_PARTY_MAIN_END);\n       });\n     } else if (process.argv[1] === 'inspect' || process.argv[1] === 'debug') {\n       if (process.argv[1] === 'debug') {\n@@ -214,44 +204,30 @@\n       // channel. This needs to be done before any user code gets executed\n       // (including preload modules).\n       if (process.argv[1] && process.env.NODE_UNIQUE_ID) {\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_CLUSTER_SETUP_START);\n         const cluster = NativeModule.require('cluster');\n         cluster._setupWorker();\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_CLUSTER_SETUP_END);\n         // Make sure it's not accidentally inherited by child processes.\n         delete process.env.NODE_UNIQUE_ID;\n       }\n \n       if (process._eval != null && !process._forceRepl) {\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_START);\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_END);\n         // User passed '-e' or '--eval' arguments to Node without '-i' or\n         // '--interactive'.\n-\n-        perf.markMilestone(\n-          NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_START);\n         preloadModules();\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_END);\n \n         const {\n           addBuiltinLibsToObject\n         } = NativeModule.require('internal/modules/cjs/helpers');\n         addBuiltinLibsToObject(global);\n         evalScript('[eval]');\n       } else if (process.argv[1] && process.argv[1] !== '-') {\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_START);\n         // Make process.argv[1] into a full path.\n         const path = NativeModule.require('path');\n         process.argv[1] = path.resolve(process.argv[1]);\n \n         const CJSModule = NativeModule.require('internal/modules/cjs/loader');\n \n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_END);\n-        perf.markMilestone(\n-          NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_START);\n         preloadModules();\n-        perf.markMilestone(\n-          NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_END);\n         // Check if user passed `-c` or `--check` arguments to Node.\n         if (process._syntax_check_only != null) {\n           const fs = NativeModule.require('fs');\n@@ -263,13 +239,7 @@\n         }\n         CJSModule.runMain();\n       } else {\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_START);\n-        perf.markMilestone(NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_END);\n-        perf.markMilestone(\n-          NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_START);\n         preloadModules();\n-        perf.markMilestone(\n-          NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_END);\n         // If -i or --interactive were passed, or stdin is a TTY.\n         if (process._forceRepl || NativeModule.require('tty').isatty(0)) {\n           // REPL"
        },
        {
            "sha": "f7b18816e6ceb0da8ebcc711356b2c7440578c92",
            "filename": "lib/perf_hooks.js",
            "status": "modified",
            "additions": 1,
            "deletions": 46,
            "changes": 47,
            "blob_url": "https://github.com/nodejs/node/blob/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/lib%2Fperf_hooks.js",
            "raw_url": "https://github.com/nodejs/node/raw/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/lib%2Fperf_hooks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fperf_hooks.js?ref=b55f6a0f010da7f2f812b0956283a1d58ebe1ff1",
            "patch": "@@ -27,15 +27,7 @@ const {\n   NODE_PERFORMANCE_MILESTONE_LOOP_START,\n   NODE_PERFORMANCE_MILESTONE_LOOP_EXIT,\n   NODE_PERFORMANCE_MILESTONE_BOOTSTRAP_COMPLETE,\n-  NODE_PERFORMANCE_MILESTONE_ENVIRONMENT,\n-  NODE_PERFORMANCE_MILESTONE_THIRD_PARTY_MAIN_START,\n-  NODE_PERFORMANCE_MILESTONE_THIRD_PARTY_MAIN_END,\n-  NODE_PERFORMANCE_MILESTONE_CLUSTER_SETUP_START,\n-  NODE_PERFORMANCE_MILESTONE_CLUSTER_SETUP_END,\n-  NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_START,\n-  NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_END,\n-  NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_START,\n-  NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_END\n+  NODE_PERFORMANCE_MILESTONE_ENVIRONMENT\n } = constants;\n \n const { AsyncResource } = require('async_hooks');\n@@ -192,43 +184,6 @@ class PerformanceNodeTiming {\n     return getMilestoneTimestamp(NODE_PERFORMANCE_MILESTONE_BOOTSTRAP_COMPLETE);\n   }\n \n-  get thirdPartyMainStart() {\n-    return getMilestoneTimestamp(\n-      NODE_PERFORMANCE_MILESTONE_THIRD_PARTY_MAIN_START);\n-  }\n-\n-  get thirdPartyMainEnd() {\n-    return getMilestoneTimestamp(\n-      NODE_PERFORMANCE_MILESTONE_THIRD_PARTY_MAIN_END);\n-  }\n-\n-  get clusterSetupStart() {\n-    return getMilestoneTimestamp(\n-      NODE_PERFORMANCE_MILESTONE_CLUSTER_SETUP_START);\n-  }\n-\n-  get clusterSetupEnd() {\n-    return getMilestoneTimestamp(NODE_PERFORMANCE_MILESTONE_CLUSTER_SETUP_END);\n-  }\n-\n-  get moduleLoadStart() {\n-    return getMilestoneTimestamp(NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_START);\n-  }\n-\n-  get moduleLoadEnd() {\n-    return getMilestoneTimestamp(NODE_PERFORMANCE_MILESTONE_MODULE_LOAD_END);\n-  }\n-\n-  get preloadModuleLoadStart() {\n-    return getMilestoneTimestamp(\n-      NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_START);\n-  }\n-\n-  get preloadModuleLoadEnd() {\n-    return getMilestoneTimestamp(\n-      NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_END);\n-  }\n-\n   [kInspect]() {\n     return {\n       name: 'node',"
        },
        {
            "sha": "8f90c93060dc4c94a931ff737f0d40b022064b4d",
            "filename": "src/node_perf_common.h",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/src%2Fnode_perf_common.h",
            "raw_url": "https://github.com/nodejs/node/raw/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/src%2Fnode_perf_common.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_perf_common.h?ref=b55f6a0f010da7f2f812b0956283a1d58ebe1ff1",
            "patch": "@@ -24,15 +24,8 @@ extern uint64_t performance_v8_start;\n   V(V8_START, \"v8Start\")                                                      \\\n   V(LOOP_START, \"loopStart\")                                                  \\\n   V(LOOP_EXIT, \"loopExit\")                                                    \\\n-  V(BOOTSTRAP_COMPLETE, \"bootstrapComplete\")                                  \\\n-  V(THIRD_PARTY_MAIN_START, \"thirdPartyMainStart\")                            \\\n-  V(THIRD_PARTY_MAIN_END, \"thirdPartyMainEnd\")                                \\\n-  V(CLUSTER_SETUP_START, \"clusterSetupStart\")                                 \\\n-  V(CLUSTER_SETUP_END, \"clusterSetupEnd\")                                     \\\n-  V(MODULE_LOAD_START, \"moduleLoadStart\")                                     \\\n-  V(MODULE_LOAD_END, \"moduleLoadEnd\")                                         \\\n-  V(PRELOAD_MODULE_LOAD_START, \"preloadModulesLoadStart\")                     \\\n-  V(PRELOAD_MODULE_LOAD_END, \"preloadModulesLoadEnd\")\n+  V(BOOTSTRAP_COMPLETE, \"bootstrapComplete\")\n+\n \n #define NODE_PERFORMANCE_ENTRY_TYPES(V)                                       \\\n   V(NODE, \"node\")                                                             \\"
        },
        {
            "sha": "95a401c5c89a167f8625e392445d403bcea99437",
            "filename": "test/sequential/test-performance.js",
            "status": "modified",
            "additions": 3,
            "deletions": 27,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/test%2Fsequential%2Ftest-performance.js",
            "raw_url": "https://github.com/nodejs/node/raw/b55f6a0f010da7f2f812b0956283a1d58ebe1ff1/test%2Fsequential%2Ftest-performance.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-performance.js?ref=b55f6a0f010da7f2f812b0956283a1d58ebe1ff1",
            "patch": "@@ -80,15 +80,7 @@ checkNodeTiming({\n   bootstrapComplete: { around: inited },\n   environment: { around: 0 },\n   loopStart: -1,\n-  loopExit: -1,\n-  thirdPartyMainStart: -1,\n-  thirdPartyMainEnd: -1,\n-  clusterSetupStart: -1,\n-  clusterSetupEnd: -1,\n-  moduleLoadStart: { around: inited },\n-  moduleLoadEnd: { around: inited },\n-  preloadModuleLoadStart: { around: inited },\n-  preloadModuleLoadEnd: { around: inited },\n+  loopExit: -1\n });\n \n setTimeout(() => {\n@@ -102,15 +94,7 @@ setTimeout(() => {\n     bootstrapComplete: { around: inited },\n     environment: { around: 0 },\n     loopStart: { around: inited },\n-    loopExit: -1,\n-    thirdPartyMainStart: -1,\n-    thirdPartyMainEnd: -1,\n-    clusterSetupStart: -1,\n-    clusterSetupEnd: -1,\n-    moduleLoadStart: { around: inited },\n-    moduleLoadEnd: { around: inited },\n-    preloadModuleLoadStart: { around: inited },\n-    preloadModuleLoadEnd: { around: inited },\n+    loopExit: -1\n   });\n }, 2000);\n \n@@ -125,14 +109,6 @@ process.on('exit', () => {\n     bootstrapComplete: { around: inited },\n     environment: { around: 0 },\n     loopStart: { around: inited },\n-    loopExit: { around: performance.now() },\n-    thirdPartyMainStart: -1,\n-    thirdPartyMainEnd: -1,\n-    clusterSetupStart: -1,\n-    clusterSetupEnd: -1,\n-    moduleLoadStart: { around: inited },\n-    moduleLoadEnd: { around: inited },\n-    preloadModuleLoadStart: { around: inited },\n-    preloadModuleLoadEnd: { around: inited },\n+    loopExit: { around: performance.now() }\n   });\n });"
        }
    ],
    "stats": {
        "total": 196,
        "additions": 6,
        "deletions": 190
    }
}