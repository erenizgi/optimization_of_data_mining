{
    "author": "ZYSzys",
    "message": "lib: refactor argument validation using validateString\n\nPR-URL: https://github.com/nodejs/node/pull/24960\nRefs: https://github.com/nodejs/node/pull/22101\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
    "files": [
        {
            "sha": "7222d301f08692dcb73d9925c6bef30c820385bf",
            "filename": "lib/internal/crypto/keygen.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fcrypto%2Fkeygen.js",
            "raw_url": "https://github.com/nodejs/node/raw/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fcrypto%2Fkeygen.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fkeygen.js?ref=a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
            "patch": "@@ -15,7 +15,7 @@ const {\n   PK_FORMAT_PEM\n } = internalBinding('crypto');\n const { customPromisifyArgs } = require('internal/util');\n-const { isUint32 } = require('internal/validators');\n+const { isUint32, validateString } = require('internal/validators');\n const {\n   ERR_CRYPTO_INCOMPATIBLE_KEY_OPTIONS,\n   ERR_INVALID_ARG_TYPE,\n@@ -157,8 +157,7 @@ function parseKeyEncoding(keyType, options) {\n }\n \n function check(type, options, callback) {\n-  if (typeof type !== 'string')\n-    throw new ERR_INVALID_ARG_TYPE('type', 'string', type);\n+  validateString(type, 'type');\n   if (options == null || typeof options !== 'object')\n     throw new ERR_INVALID_ARG_TYPE('options', 'object', options);\n "
        },
        {
            "sha": "be49ebf2106d7eb785b865b8656a730cfc5e763f",
            "filename": "lib/internal/dns/promises.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fdns%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fdns%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fdns%2Fpromises.js?ref=a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
            "patch": "@@ -21,6 +21,7 @@ const {\n   ERR_MISSING_ARGS,\n   ERR_SOCKET_BAD_PORT\n } = codes;\n+const { validateString } = require('internal/validators');\n \n \n function onlookup(err, addresses) {\n@@ -192,9 +193,7 @@ function createResolverPromise(resolver, bindingName, hostname, ttl) {\n \n function resolver(bindingName) {\n   function query(name, options) {\n-    if (typeof name !== 'string') {\n-      throw new ERR_INVALID_ARG_TYPE('name', 'string', name);\n-    }\n+    validateString(name, 'name');\n \n     const ttl = !!(options && options.ttl);\n     return createResolverPromise(this, bindingName, name, ttl);"
        },
        {
            "sha": "e27d52906822f0ca976408cfd3c0b05a6e7d98a6",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
            "patch": "@@ -78,7 +78,7 @@ const {\n     ERR_SOCKET_CLOSED\n   }\n } = require('internal/errors');\n-const { validateNumber } = require('internal/validators');\n+const { validateNumber, validateString } = require('internal/validators');\n const { utcDate } = require('internal/http');\n const { onServerStream,\n         Http2ServerRequest,\n@@ -1372,8 +1372,7 @@ class ServerHttp2Session extends Http2Session {\n       }\n     }\n \n-    if (typeof alt !== 'string')\n-      throw new ERR_INVALID_ARG_TYPE('alt', 'string', alt);\n+    validateString(alt, 'alt');\n     if (!kQuotedString.test(alt))\n       throw new ERR_INVALID_CHAR('alt');\n \n@@ -1402,8 +1401,7 @@ class ServerHttp2Session extends Http2Session {\n       } else if (origin != null && typeof origin === 'object') {\n         origin = origin.origin;\n       }\n-      if (typeof origin !== 'string')\n-        throw new ERR_INVALID_ARG_TYPE('origin', 'string', origin);\n+      validateString(origin, 'origin');\n       if (origin === 'null')\n         throw new ERR_HTTP2_INVALID_ORIGIN();\n "
        },
        {
            "sha": "b8b7a454dc2f9f6f8d897b7caa0903c8289f4829",
            "filename": "lib/internal/process/main_thread_only.js",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fprocess%2Fmain_thread_only.js",
            "raw_url": "https://github.com/nodejs/node/raw/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fprocess%2Fmain_thread_only.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fmain_thread_only.js?ref=a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
            "patch": "@@ -12,7 +12,8 @@ const {\n } = require('internal/errors');\n const {\n   validateMode,\n-  validateUint32\n+  validateUint32,\n+  validateString\n } = require('internal/validators');\n \n const {\n@@ -36,9 +37,7 @@ function setupProcessMethods(_chdir, _umask, _initgroups, _setegid,\n   }\n \n   process.chdir = function chdir(directory) {\n-    if (typeof directory !== 'string') {\n-      throw new ERR_INVALID_ARG_TYPE('directory', 'string', directory);\n-    }\n+    validateString(directory, 'directory');\n     return _chdir(directory);\n   };\n "
        },
        {
            "sha": "8b107a9b74866f1cf6c96b36c4b42f48f82744aa",
            "filename": "lib/internal/vm/source_text_module.js",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fvm%2Fsource_text_module.js",
            "raw_url": "https://github.com/nodejs/node/raw/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fvm%2Fsource_text_module.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fvm%2Fsource_text_module.js?ref=a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
            "patch": "@@ -18,7 +18,11 @@ const {\n   emitExperimentalWarning\n } = require('internal/util');\n const { SafePromise } = require('internal/safe_globals');\n-const { validateInt32, validateUint32 } = require('internal/validators');\n+const {\n+  validateInt32,\n+  validateUint32,\n+  validateString\n+} = require('internal/validators');\n \n const {\n   ModuleWrap,\n@@ -54,8 +58,7 @@ class SourceTextModule {\n   constructor(src, options = {}) {\n     emitExperimentalWarning('vm.SourceTextModule');\n \n-    if (typeof src !== 'string')\n-      throw new ERR_INVALID_ARG_TYPE('src', 'string', src);\n+    validateString(src, 'src');\n     if (typeof options !== 'object' || options === null)\n       throw new ERR_INVALID_ARG_TYPE('options', 'Object', options);\n \n@@ -79,9 +82,7 @@ class SourceTextModule {\n \n     let { url } = options;\n     if (url !== undefined) {\n-      if (typeof url !== 'string') {\n-        throw new ERR_INVALID_ARG_TYPE('options.url', 'string', url);\n-      }\n+      validateString(url, 'options.url');\n       url = new URL(url).href;\n     } else if (context === undefined) {\n       url = `${defaultModuleName}(${globalModuleId++})`;"
        },
        {
            "sha": "9e41dba71692365b4afe4968b3698841f118edb0",
            "filename": "lib/internal/worker.js",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fworker.js",
            "raw_url": "https://github.com/nodejs/node/raw/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Finternal%2Fworker.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fworker.js?ref=a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
            "patch": "@@ -6,11 +6,11 @@ const path = require('path');\n const util = require('util');\n const { Readable, Writable } = require('stream');\n const {\n-  ERR_INVALID_ARG_TYPE,\n   ERR_WORKER_PATH,\n   ERR_WORKER_UNSERIALIZABLE_ERROR,\n   ERR_WORKER_UNSUPPORTED_EXTENSION,\n } = require('internal/errors').codes;\n+const { validateString } = require('internal/validators');\n \n const { MessagePort, MessageChannel } = internalBinding('messaging');\n const {\n@@ -251,9 +251,7 @@ class Worker extends EventEmitter {\n   constructor(filename, options = {}) {\n     super();\n     debug(`[${threadId}] create new worker`, filename, options);\n-    if (typeof filename !== 'string') {\n-      throw new ERR_INVALID_ARG_TYPE('filename', 'string', filename);\n-    }\n+    validateString(filename, 'filename');\n \n     if (!options.eval) {\n       if (!path.isAbsolute(filename) &&"
        },
        {
            "sha": "c35bd1899b5f7a3a12fe0e2b95c76b1ec0974fa5",
            "filename": "lib/readline.js",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Freadline.js",
            "raw_url": "https://github.com/nodejs/node/raw/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Freadline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Freadline.js?ref=a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
            "patch": "@@ -28,10 +28,10 @@\n 'use strict';\n \n const {\n-  ERR_INVALID_ARG_TYPE,\n   ERR_INVALID_CURSOR_POS,\n   ERR_INVALID_OPT_VALUE\n } = require('internal/errors').codes;\n+const { validateString } = require('internal/validators');\n const { debug } = require('util');\n const { emitExperimentalWarning } = require('internal/util');\n const { Buffer } = require('buffer');\n@@ -311,9 +311,7 @@ Interface.prototype._onLine = function(line) {\n };\n \n Interface.prototype._writeToOutput = function _writeToOutput(stringToWrite) {\n-  if (typeof stringToWrite !== 'string') {\n-    throw new ERR_INVALID_ARG_TYPE('stringToWrite', 'string', stringToWrite);\n-  }\n+  validateString(stringToWrite, 'stringToWrite');\n \n   if (this.output !== null && this.output !== undefined) {\n     this.output.write(stringToWrite);"
        },
        {
            "sha": "c34eee638cdf0bbcf6c1789512239ae83ed5489e",
            "filename": "lib/url.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Furl.js?ref=a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
            "patch": "@@ -31,6 +31,7 @@ const { SafeSet } = require('internal/safe_globals');\n const {\n   ERR_INVALID_ARG_TYPE\n } = require('internal/errors').codes;\n+const { validateString } = require('internal/validators');\n \n // This ensures setURLConstructor() is called before the native\n // URL::ToObject() method is used.\n@@ -150,9 +151,7 @@ function urlParse(url, parseQueryString, slashesDenoteHost) {\n }\n \n Url.prototype.parse = function parse(url, parseQueryString, slashesDenoteHost) {\n-  if (typeof url !== 'string') {\n-    throw new ERR_INVALID_ARG_TYPE('url', 'string', url);\n-  }\n+  validateString(url, 'url');\n \n   // Copy chrome, IE, opera backslash-handling behavior.\n   // Back slashes before the query string get converted to forward slashes"
        },
        {
            "sha": "3d75cf75847876b2f4c9258a120f7b85ff8bf23b",
            "filename": "lib/v8.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Fv8.js",
            "raw_url": "https://github.com/nodejs/node/raw/a35bd62ae17f9f673430dd90a57ef9bf9f42012a/lib%2Fv8.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fv8.js?ref=a35bd62ae17f9f673430dd90a57ef9bf9f42012a",
            "patch": "@@ -15,7 +15,7 @@\n 'use strict';\n \n const { Buffer } = require('buffer');\n-const { ERR_INVALID_ARG_TYPE } = require('internal/errors').codes;\n+const { validateString } = require('internal/validators');\n const {\n   Serializer: _Serializer,\n   Deserializer: _Deserializer\n@@ -66,8 +66,7 @@ const heapSpaceStatisticsBuffer =\n     new Float64Array(heapSpaceStatisticsArrayBuffer);\n \n function setFlagsFromString(flags) {\n-  if (typeof flags !== 'string')\n-    throw new ERR_INVALID_ARG_TYPE('flags', 'string', flags);\n+  validateString(flags, 'flags');\n   _setFlagsFromString(flags);\n }\n "
        }
    ],
    "stats": {
        "total": 60,
        "additions": 25,
        "deletions": 35
    }
}