{
    "author": "danbev",
    "message": "crypto: move process.binding('crypto') to internal\n\nThis commit makes the crypto builtin an internal builtin, and\nchanges usage of the builtin from using process.binding('crypto')\nto use internalBinding instead.\n\nRefs: https://github.com/nodejs/node/issues/22160\n\nPR-URL: https://github.com/nodejs/node/pull/22426\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
    "files": [
        {
            "sha": "1f56c46dd84e7480be2b0a0f7cb9ca32926f9ba8",
            "filename": "lib/_tls_common.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2F_tls_common.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2F_tls_common.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_common.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -34,8 +34,8 @@ const { SSL_OP_CIPHER_SERVER_PREFERENCE } = process.binding('constants').crypto;\n // Lazily loaded\n var crypto = null;\n \n-const { SecureContext: NativeSecureContext } = process.binding('crypto');\n-\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { SecureContext: NativeSecureContext } = internalBinding('crypto');\n function SecureContext(secureProtocol, secureOptions, context) {\n   if (!(this instanceof SecureContext)) {\n     return new SecureContext(secureProtocol, secureOptions, context);"
        },
        {
            "sha": "15604f466df12d83701f75c9a1f2581ecc3892f3",
            "filename": "lib/_tls_wrap.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2F_tls_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2F_tls_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_wrap.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -36,9 +36,8 @@ const tls_wrap = process.binding('tls_wrap');\n const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n const { Pipe, constants: PipeConstants } = process.binding('pipe_wrap');\n const { owner_symbol } = require('internal/async_hooks').symbols;\n-const {\n-  SecureContext: NativeSecureContext\n-} = process.binding('crypto');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { SecureContext: NativeSecureContext } = internalBinding('crypto');\n const {\n   ERR_INVALID_ARG_TYPE,\n   ERR_MULTIPLE_CALLBACK,"
        },
        {
            "sha": "bced9f040a6b4dbcae03e4af74a00b1b307c2cfa",
            "filename": "lib/crypto.js",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Fcrypto.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Fcrypto.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fcrypto.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -30,6 +30,7 @@ const {\n } = require('internal/util');\n assertCrypto();\n \n+const { internalBinding } = require('internal/bootstrap/loaders');\n const {\n   ERR_CRYPTO_FIPS_FORCED,\n   ERR_CRYPTO_FIPS_UNAVAILABLE\n@@ -39,10 +40,7 @@ const {\n   fipsMode,\n   fipsForced\n } = process.binding('config');\n-const {\n-  getFipsCrypto,\n-  setFipsCrypto,\n-} = process.binding('crypto');\n+const { getFipsCrypto, setFipsCrypto } = internalBinding('crypto');\n const {\n   randomBytes,\n   randomFill,"
        },
        {
            "sha": "6a4e4860b3ca84b65f7528b3e9cbb2a90a46d93d",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -350,7 +350,8 @@\n         'http_parser',\n         'v8',\n         'stream_wrap',\n-        'signal_wrap']);\n+        'signal_wrap',\n+        'crypto']);\n     process.binding = function binding(name) {\n       return internalBindingWhitelist.has(name) ?\n         internalBinding(name) :"
        },
        {
            "sha": "d96965224d9066458adbf905938433f6bf9a34d6",
            "filename": "lib/internal/crypto/certificate.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fcertificate.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fcertificate.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fcertificate.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -1,10 +1,11 @@\n 'use strict';\n \n+const { internalBinding } = require('internal/bootstrap/loaders');\n const {\n   certExportChallenge,\n   certExportPublicKey,\n   certVerifySpkac\n-} = process.binding('crypto');\n+} = internalBinding('crypto');\n \n const { ERR_INVALID_ARG_TYPE } = require('internal/errors').codes;\n const { isArrayBufferView } = require('internal/util/types');"
        },
        {
            "sha": "73a6c6ab49cf4a9e927035e32f4ec8dae164d411",
            "filename": "lib/internal/crypto/cipher.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fcipher.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -19,13 +19,14 @@ const {\n \n const { isArrayBufferView } = require('internal/util/types');\n \n+const { internalBinding } = require('internal/bootstrap/loaders');\n const {\n   CipherBase,\n   privateDecrypt: _privateDecrypt,\n   privateEncrypt: _privateEncrypt,\n   publicDecrypt: _publicDecrypt,\n   publicEncrypt: _publicEncrypt\n-} = process.binding('crypto');\n+} = internalBinding('crypto');\n \n const assert = require('assert');\n const LazyTransform = require('internal/streams/lazy_transform');"
        },
        {
            "sha": "24498c73a69f382e70fc320435ce54f0d6e17009",
            "filename": "lib/internal/crypto/pbkdf2.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fpbkdf2.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fpbkdf2.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fpbkdf2.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -2,7 +2,8 @@\n \n const { AsyncWrap, Providers } = process.binding('async_wrap');\n const { Buffer } = require('buffer');\n-const { INT_MAX, pbkdf2: _pbkdf2 } = process.binding('crypto');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { INT_MAX, pbkdf2: _pbkdf2 } = internalBinding('crypto');\n const { validateInt32 } = require('internal/validators');\n const {\n   ERR_CRYPTO_INVALID_DIGEST,"
        },
        {
            "sha": "2d462bd7566804e75c0800e0e182b14abf9aebcf",
            "filename": "lib/internal/crypto/random.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Frandom.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Frandom.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Frandom.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -2,7 +2,8 @@\n \n const { AsyncWrap, Providers } = process.binding('async_wrap');\n const { Buffer, kMaxLength } = require('buffer');\n-const { randomBytes: _randomBytes } = process.binding('crypto');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { randomBytes: _randomBytes } = internalBinding('crypto');\n const {\n   ERR_INVALID_ARG_TYPE,\n   ERR_INVALID_CALLBACK,"
        },
        {
            "sha": "f68a77aa86dad20ae89974a5eb4dc2c0e3c08fe1",
            "filename": "lib/internal/crypto/scrypt.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fscrypt.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fscrypt.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fscrypt.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -2,7 +2,8 @@\n \n const { AsyncWrap, Providers } = process.binding('async_wrap');\n const { Buffer } = require('buffer');\n-const { INT_MAX, scrypt: _scrypt } = process.binding('crypto');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { INT_MAX, scrypt: _scrypt } = internalBinding('crypto');\n const { validateInt32 } = require('internal/validators');\n const {\n   ERR_CRYPTO_SCRYPT_INVALID_PARAMETER,"
        },
        {
            "sha": "fd2db9016f4b5d2f481e082eb226acb8b4f254aa",
            "filename": "lib/internal/crypto/sig.js",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fsig.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Fsig.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fsig.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -5,10 +5,8 @@ const {\n   ERR_INVALID_OPT_VALUE\n } = require('internal/errors').codes;\n const { validateString } = require('internal/validators');\n-const {\n-  Sign: _Sign,\n-  Verify: _Verify\n-} = process.binding('crypto');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { Sign: _Sign, Verify: _Verify } = internalBinding('crypto');\n const {\n   RSA_PSS_SALTLEN_AUTO,\n   RSA_PKCS1_PADDING"
        },
        {
            "sha": "19d18be5b003c80824335343e97b6a15f46f46c3",
            "filename": "lib/internal/crypto/util.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Finternal%2Fcrypto%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Futil.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -1,12 +1,13 @@\n 'use strict';\n \n+const { internalBinding } = require('internal/bootstrap/loaders');\n const {\n   getCiphers: _getCiphers,\n   getCurves: _getCurves,\n   getHashes: _getHashes,\n   setEngine: _setEngine,\n   timingSafeEqual: _timingSafeEqual\n-} = process.binding('crypto');\n+} = internalBinding('crypto');\n \n const {\n   ENGINE_METHOD_ALL"
        },
        {
            "sha": "d58906b2867b01146e1f53cce6dcc1f87178816b",
            "filename": "lib/tls.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Ftls.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/lib%2Ftls.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftls.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -29,7 +29,8 @@ const { isUint8Array } = require('internal/util/types');\n \n const net = require('net');\n const url = require('url');\n-const binding = process.binding('crypto');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const binding = internalBinding('crypto');\n const { Buffer } = require('buffer');\n const EventEmitter = require('events');\n const { URL } = require('internal/url');"
        },
        {
            "sha": "fb0e1d6d8c5a3155de1bd3d1257ce3f4b99cdbed",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -5262,4 +5262,4 @@ void Initialize(Local<Object> target,\n }  // namespace crypto\n }  // namespace node\n \n-NODE_BUILTIN_MODULE_CONTEXT_AWARE(crypto, node::crypto::Initialize)\n+NODE_MODULE_CONTEXT_AWARE_INTERNAL(crypto, node::crypto::Initialize)"
        },
        {
            "sha": "83ab6edce1b84a352632f2bdf88c34b8a6b735cd",
            "filename": "test/parallel/test-crypto-scrypt.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/test%2Fparallel%2Ftest-crypto-scrypt.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/test%2Fparallel%2Ftest-crypto-scrypt.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-scrypt.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n if (!common.hasCrypto)\n@@ -6,7 +7,8 @@ if (!common.hasCrypto)\n const assert = require('assert');\n const crypto = require('crypto');\n \n-if (typeof process.binding('crypto').scrypt !== 'function')\n+const { internalBinding } = require('internal/test/binding');\n+if (typeof internalBinding('crypto').scrypt !== 'function')\n   common.skip('no scrypt support');\n \n const good = ["
        },
        {
            "sha": "34b4ea49218194472a2be61815821ab4350a5861",
            "filename": "test/parallel/test-tls-clientcertengine-unsupported.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/test%2Fparallel%2Ftest-tls-clientcertengine-unsupported.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/test%2Fparallel%2Ftest-tls-clientcertengine-unsupported.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-clientcertengine-unsupported.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -1,11 +1,13 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n \n if (!common.hasCrypto)\n   common.skip('missing crypto');\n \n // Monkey-patch SecureContext\n-const binding = process.binding('crypto');\n+const { internalBinding } = require('internal/test/binding');\n+const binding = internalBinding('crypto');\n const NativeSecureContext = binding.SecureContext;\n \n binding.SecureContext = function() {"
        },
        {
            "sha": "8000c5e4ca2cb65065141a9a2bbdeb83c81462c9",
            "filename": "test/sequential/test-async-wrap-getasyncid.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "raw_url": "https://github.com/nodejs/node/raw/bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-async-wrap-getasyncid.js?ref=bf5cc3bf1add7eea1d7d4c2c0de2092582ea1541",
            "patch": "@@ -122,7 +122,7 @@ if (common.hasCrypto) { // eslint-disable-line node-core/crypto-check\n     testInitialized(this, 'AsyncWrap');\n   }));\n \n-  if (typeof process.binding('crypto').scrypt === 'function') {\n+  if (typeof internalBinding('crypto').scrypt === 'function') {\n     crypto.scrypt('password', 'salt', 8, common.mustCall(function() {\n       testInitialized(this, 'AsyncWrap');\n     }));"
        }
    ],
    "stats": {
        "total": 57,
        "additions": 32,
        "deletions": 25
    }
}