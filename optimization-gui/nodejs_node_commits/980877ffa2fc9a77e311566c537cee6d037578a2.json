{
    "author": "antsmartian",
    "message": "util: adding warnings when NODE_DEBUG is set as http/http2\n\nPR-URL: https://github.com/nodejs/node/pull/21914\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Сковорода Никита Андреевич <chalkerx@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "980877ffa2fc9a77e311566c537cee6d037578a2",
    "files": [
        {
            "sha": "3d3bbdb6120fa2b9b7b6bc9da4a1c53b7e0d255b",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/980877ffa2fc9a77e311566c537cee6d037578a2/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/980877ffa2fc9a77e311566c537cee6d037578a2/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=980877ffa2fc9a77e311566c537cee6d037578a2",
            "patch": "@@ -344,11 +344,23 @@ if (process.env.NODE_DEBUG) {\n   debugEnvRegex = new RegExp(`^${debugEnv}$`, 'i');\n }\n \n+// Emits warning when user sets\n+// NODE_DEBUG=http or NODE_DEBUG=http2.\n+function emitWarningIfNeeded(set) {\n+  if ('HTTP' === set || 'HTTP2' === set) {\n+    process.emitWarning('Setting the NODE_DEBUG environment variable ' +\n+      'to \\'' + set.toLowerCase() + '\\' can expose sensitive ' +\n+      'data (such as passwords, tokens and authentication headers) ' +\n+      'in the resulting log.');\n+  }\n+}\n+\n function debuglog(set) {\n   set = set.toUpperCase();\n   if (!debugs[set]) {\n     if (debugEnvRegex.test(set)) {\n       const pid = process.pid;\n+      emitWarningIfNeeded(set);\n       debugs[set] = function debug() {\n         const msg = exports.format.apply(exports, arguments);\n         console.error('%s %d: %s', set, pid, msg);"
        },
        {
            "sha": "7d0509a89ff68eda120842f2b38aa1c1dfab5a0a",
            "filename": "test/parallel/test-http-conn-reset.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/980877ffa2fc9a77e311566c537cee6d037578a2/test%2Fparallel%2Ftest-http-conn-reset.js",
            "raw_url": "https://github.com/nodejs/node/raw/980877ffa2fc9a77e311566c537cee6d037578a2/test%2Fparallel%2Ftest-http-conn-reset.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-conn-reset.js?ref=980877ffa2fc9a77e311566c537cee6d037578a2",
            "patch": "@@ -30,6 +30,7 @@ const options = {\n   port: undefined\n };\n \n+process.env.NODE_DEBUG = 'http';\n // start a tcp server that closes incoming connections immediately\n const server = net.createServer(function(client) {\n   client.destroy();"
        },
        {
            "sha": "4b1c093c66397436a5590cdf5acc48cc23a940e4",
            "filename": "test/parallel/test-http-debug.js",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/980877ffa2fc9a77e311566c537cee6d037578a2/test%2Fparallel%2Ftest-http-debug.js",
            "raw_url": "https://github.com/nodejs/node/raw/980877ffa2fc9a77e311566c537cee6d037578a2/test%2Fparallel%2Ftest-http-debug.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-debug.js?ref=980877ffa2fc9a77e311566c537cee6d037578a2",
            "patch": "@@ -0,0 +1,14 @@\n+'use strict';\n+\n+require('../common');\n+const assert = require('assert');\n+const child_process = require('child_process');\n+const path = require('path');\n+\n+process.env.NODE_DEBUG = 'http';\n+const { stderr } = child_process.spawnSync(process.execPath, [\n+  path.resolve(__dirname, 'test-http-conn-reset.js')\n+], { encoding: 'utf8' });\n+\n+assert(stderr.match(/Setting the NODE_DEBUG environment variable to 'http' can expose sensitive data \\(such as passwords, tokens and authentication headers\\) in the resulting log\\./),\n+       stderr);"
        },
        {
            "sha": "ad86e76ab757714081037acfc1355bab66801362",
            "filename": "test/parallel/test-http2-debug.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/980877ffa2fc9a77e311566c537cee6d037578a2/test%2Fparallel%2Ftest-http2-debug.js",
            "raw_url": "https://github.com/nodejs/node/raw/980877ffa2fc9a77e311566c537cee6d037578a2/test%2Fparallel%2Ftest-http2-debug.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-debug.js?ref=980877ffa2fc9a77e311566c537cee6d037578a2",
            "patch": "@@ -7,10 +7,13 @@ const child_process = require('child_process');\n const path = require('path');\n \n process.env.NODE_DEBUG_NATIVE = 'http2';\n+process.env.NODE_DEBUG = 'http2';\n const { stdout, stderr } = child_process.spawnSync(process.execPath, [\n   path.resolve(__dirname, 'test-http2-ping.js')\n ], { encoding: 'utf8' });\n \n+assert(stderr.match(/Setting the NODE_DEBUG environment variable to 'http2' can expose sensitive data \\(such as passwords, tokens and authentication headers\\) in the resulting log\\./),\n+       stderr);\n assert(stderr.match(/Http2Session client \\(\\d+\\) handling data frame for stream \\d+/),\n        stderr);\n assert(stderr.match(/HttpStream \\d+ \\(\\d+\\) \\[Http2Session client \\(\\d+\\)\\] reading starting/),"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 30,
        "deletions": 0
    }
}