{
    "author": "TimothyGu",
    "message": "src: encode 0x27 (') for special URLs\n\nRefs: https://github.com/whatwg/url/commit/6ef17ebe1220a7e7c0cfff0785017502ee18808b\nPR-URL: https://github.com/nodejs/node/pull/22022\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "c7788fba28b913bbab5eac929e8993742873b486",
    "files": [
        {
            "sha": "4d57027dd29ce99d96c0ecdda05cc134dbcf9763",
            "filename": "src/node_url.cc",
            "status": "modified",
            "additions": 71,
            "deletions": 2,
            "changes": 73,
            "blob_url": "https://github.com/nodejs/node/blob/c7788fba28b913bbab5eac929e8993742873b486/src%2Fnode_url.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c7788fba28b913bbab5eac929e8993742873b486/src%2Fnode_url.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_url.cc?ref=c7788fba28b913bbab5eac929e8993742873b486",
            "patch": "@@ -529,7 +529,7 @@ const uint8_t USERINFO_ENCODE_SET[32] = {\n     0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80\n };\n \n-const uint8_t QUERY_ENCODE_SET[32] = {\n+const uint8_t QUERY_ENCODE_SET_NONSPECIAL[32] = {\n   // 00     01     02     03     04     05     06     07\n     0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n   // 08     09     0A     0B     0C     0D     0E     0F\n@@ -596,6 +596,74 @@ const uint8_t QUERY_ENCODE_SET[32] = {\n     0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80\n };\n \n+// Same as QUERY_ENCODE_SET_NONSPECIAL, but with 0x27 (') encoded.\n+const uint8_t QUERY_ENCODE_SET_SPECIAL[32] = {\n+  // 00     01     02     03     04     05     06     07\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // 08     09     0A     0B     0C     0D     0E     0F\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // 10     11     12     13     14     15     16     17\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // 18     19     1A     1B     1C     1D     1E     1F\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // 20     21     22     23     24     25     26     27\n+    0x01 | 0x00 | 0x04 | 0x08 | 0x00 | 0x00 | 0x00 | 0x80,\n+  // 28     29     2A     2B     2C     2D     2E     2F\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,\n+  // 30     31     32     33     34     35     36     37\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,\n+  // 38     39     3A     3B     3C     3D     3E     3F\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x10 | 0x00 | 0x40 | 0x00,\n+  // 40     41     42     43     44     45     46     47\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,\n+  // 48     49     4A     4B     4C     4D     4E     4F\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,\n+  // 50     51     52     53     54     55     56     57\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,\n+  // 58     59     5A     5B     5C     5D     5E     5F\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,\n+  // 60     61     62     63     64     65     66     67\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,\n+  // 68     69     6A     6B     6C     6D     6E     6F\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,\n+  // 70     71     72     73     74     75     76     77\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00,\n+  // 78     79     7A     7B     7C     7D     7E     7F\n+    0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x00 | 0x80,\n+  // 80     81     82     83     84     85     86     87\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // 88     89     8A     8B     8C     8D     8E     8F\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // 90     91     92     93     94     95     96     97\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // 98     99     9A     9B     9C     9D     9E     9F\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // A0     A1     A2     A3     A4     A5     A6     A7\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // A8     A9     AA     AB     AC     AD     AE     AF\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // B0     B1     B2     B3     B4     B5     B6     B7\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // B8     B9     BA     BB     BC     BD     BE     BF\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // C0     C1     C2     C3     C4     C5     C6     C7\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // C8     C9     CA     CB     CC     CD     CE     CF\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // D0     D1     D2     D3     D4     D5     D6     D7\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // D8     D9     DA     DB     DC     DD     DE     DF\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // E0     E1     E2     E3     E4     E5     E6     E7\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // E8     E9     EA     EB     EC     ED     EE     EF\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // F0     F1     F2     F3     F4     F5     F6     F7\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80,\n+  // F8     F9     FA     FB     FC     FD     FE     FF\n+    0x01 | 0x02 | 0x04 | 0x08 | 0x10 | 0x20 | 0x40 | 0x80\n+};\n+\n inline bool BitAt(const uint8_t a[], const uint8_t i) {\n   return !!(a[i >> 3] & (1 << (i & 7)));\n }\n@@ -1990,7 +2058,8 @@ void URL::Parse(const char* input,\n           if (ch == '#')\n             state = kFragment;\n         } else {\n-          AppendOrEscape(&buffer, ch, QUERY_ENCODE_SET);\n+          AppendOrEscape(&buffer, ch, special ? QUERY_ENCODE_SET_SPECIAL :\n+                                                QUERY_ENCODE_SET_NONSPECIAL);\n         }\n         break;\n       case kFragment:"
        },
        {
            "sha": "be0365edae7c7263685f8f10391e1fd0d4753789",
            "filename": "test/fixtures/url-tests.js",
            "status": "modified",
            "additions": 32,
            "deletions": 1,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/c7788fba28b913bbab5eac929e8993742873b486/test%2Ffixtures%2Furl-tests.js",
            "raw_url": "https://github.com/nodejs/node/raw/c7788fba28b913bbab5eac929e8993742873b486/test%2Ffixtures%2Furl-tests.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Furl-tests.js?ref=c7788fba28b913bbab5eac929e8993742873b486",
            "patch": "@@ -2,7 +2,7 @@\n \n /* The following tests are copied from WPT. Modifications to them should be\n    upstreamed first. Refs:\n-   https://github.com/w3c/web-platform-tests/blob/88b75886e/url/urltestdata.json\n+   https://github.com/web-platform-tests/wpt/blob/ba4921d054/url/resources/urltestdata.json\n    License: http://www.w3.org/Consortium/Legal/2008/04-testsuite-copyright.html\n */\n module.exports =\n@@ -4023,6 +4023,37 @@ module.exports =\n     \"search\": \"?`{}\",\n     \"hash\": \"\"\n   },\n+  \"byte is ' and url is special\",\n+  {\n+    \"input\": \"http://host/?'\",\n+    \"base\": \"about:blank\",\n+    \"href\": \"http://host/?%27\",\n+    \"origin\": \"http://host\",\n+    \"protocol\": \"http:\",\n+    \"username\": \"\",\n+    \"password\": \"\",\n+    \"host\": \"host\",\n+    \"hostname\": \"host\",\n+    \"port\": \"\",\n+    \"pathname\": \"/\",\n+    \"search\": \"?%27\",\n+    \"hash\": \"\"\n+  },\n+  {\n+    \"input\": \"notspecial://host/?'\",\n+    \"base\": \"about:blank\",\n+    \"href\": \"notspecial://host/?'\",\n+    \"origin\": \"null\",\n+    \"protocol\": \"notspecial:\",\n+    \"username\": \"\",\n+    \"password\": \"\",\n+    \"host\": \"host\",\n+    \"hostname\": \"host\",\n+    \"port\": \"\",\n+    \"pathname\": \"/\",\n+    \"search\": \"?'\",\n+    \"hash\": \"\"\n+  },\n   \"# Credentials in base\",\n   {\n     \"input\": \"/some/path\","
        }
    ],
    "stats": {
        "total": 106,
        "additions": 103,
        "deletions": 3
    }
}