{
    "author": "addaleax",
    "message": "zlib: generate error code names in C++\n\nThis makes it easier to implement the lookup in a way that targets\nerror codes from a specific compression library, as a way towards\nsupporting multiple ones (e.g. brotli).\n\nPR-URL: https://github.com/nodejs/node/pull/23413\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "4d16d1ed344dd0ff91ae421dab64e44335c2e4e2",
    "files": [
        {
            "sha": "97b12410f121ef25ba073d1e060af8b6ededdff2",
            "filename": "lib/zlib.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/4d16d1ed344dd0ff91ae421dab64e44335c2e4e2/lib%2Fzlib.js",
            "raw_url": "https://github.com/nodejs/node/raw/4d16d1ed344dd0ff91ae421dab64e44335c2e4e2/lib%2Fzlib.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fzlib.js?ref=4d16d1ed344dd0ff91ae421dab64e44335c2e4e2",
            "patch": "@@ -143,7 +143,7 @@ function zlibBufferSync(engine, buffer) {\n   return buffer;\n }\n \n-function zlibOnError(message, errno) {\n+function zlibOnError(message, errno, code) {\n   var self = this[owner_symbol];\n   // there is no way to cleanly recover.\n   // continuing only obscures problems.\n@@ -153,7 +153,7 @@ function zlibOnError(message, errno) {\n   // eslint-disable-next-line no-restricted-syntax\n   const error = new Error(message);\n   error.errno = errno;\n-  error.code = codes[errno];\n+  error.code = code;\n   self.emit('error', error);\n }\n "
        },
        {
            "sha": "aef5e3e40ffa80d22ee1154c3e0030a5c82f1b6a",
            "filename": "src/node_zlib.cc",
            "status": "modified",
            "additions": 22,
            "deletions": 3,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/4d16d1ed344dd0ff91ae421dab64e44335c2e4e2/src%2Fnode_zlib.cc",
            "raw_url": "https://github.com/nodejs/node/raw/4d16d1ed344dd0ff91ae421dab64e44335c2e4e2/src%2Fnode_zlib.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_zlib.cc?ref=4d16d1ed344dd0ff91ae421dab64e44335c2e4e2",
            "patch": "@@ -46,8 +46,8 @@ using v8::FunctionCallbackInfo;\n using v8::FunctionTemplate;\n using v8::HandleScope;\n using v8::Int32;\n+using v8::Integer;\n using v8::Local;\n-using v8::Number;\n using v8::Object;\n using v8::String;\n using v8::Uint32;\n@@ -56,6 +56,24 @@ using v8::Value;\n \n namespace {\n \n+#define ZLIB_ERROR_CODES(V)      \\\n+  V(Z_OK)                        \\\n+  V(Z_STREAM_END)                \\\n+  V(Z_NEED_DICT)                 \\\n+  V(Z_ERRNO)                     \\\n+  V(Z_STREAM_ERROR)              \\\n+  V(Z_DATA_ERROR)                \\\n+  V(Z_MEM_ERROR)                 \\\n+  V(Z_BUF_ERROR)                 \\\n+  V(Z_VERSION_ERROR)             \\\n+\n+inline const char* ZlibStrerror(int err) {\n+#define V(code) if (err == code) return #code;\n+  ZLIB_ERROR_CODES(V)\n+#undef V\n+  return \"Z_UNKNOWN_ERROR\";\n+}\n+\n enum node_zlib_mode {\n   NONE,\n   DEFLATE,\n@@ -404,9 +422,10 @@ class ZCtx : public AsyncWrap, public ThreadPoolWork {\n     }\n \n     HandleScope scope(env()->isolate());\n-    Local<Value> args[2] = {\n+    Local<Value> args[3] = {\n       OneByteString(env()->isolate(), message),\n-      Number::New(env()->isolate(), err_)\n+      Integer::New(env()->isolate(), err_),\n+      OneByteString(env()->isolate(), ZlibStrerror(err_))\n     };\n     MakeCallback(env()->onerror_string(), arraysize(args), args);\n "
        }
    ],
    "stats": {
        "total": 29,
        "additions": 24,
        "deletions": 5
    }
}