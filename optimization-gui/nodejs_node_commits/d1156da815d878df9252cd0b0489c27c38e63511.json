{
    "author": "juggernaut451",
    "message": "test: refactor parallel/test-tls-async-cb-after-socket-end\n\nPR-URL: https://github.com/nodejs/node/pull/18985\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "d1156da815d878df9252cd0b0489c27c38e63511",
    "files": [
        {
            "sha": "6ca38461fdec6afae2dd03fab38dbc46881f3ec3",
            "filename": "test/parallel/test-tls-async-cb-after-socket-end.js",
            "status": "modified",
            "additions": 17,
            "deletions": 18,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/d1156da815d878df9252cd0b0489c27c38e63511/test%2Fparallel%2Ftest-tls-async-cb-after-socket-end.js",
            "raw_url": "https://github.com/nodejs/node/raw/d1156da815d878df9252cd0b0489c27c38e63511/test%2Fparallel%2Ftest-tls-async-cb-after-socket-end.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-async-cb-after-socket-end.js?ref=d1156da815d878df9252cd0b0489c27c38e63511",
            "patch": "@@ -1,66 +1,65 @@\n 'use strict';\n-\n const common = require('../common');\n if (!common.hasCrypto)\n   common.skip('missing crypto');\n const fixtures = require('../common/fixtures');\n const SSL_OP_NO_TICKET = require('crypto').constants.SSL_OP_NO_TICKET;\n const tls = require('tls');\n \n+// Check tls async callback after socket ends\n+\n const options = {\n   secureOptions: SSL_OP_NO_TICKET,\n   key: fixtures.readSync('test_key.pem'),\n   cert: fixtures.readSync('test_cert.pem')\n };\n \n-const server = tls.createServer(options, function(c) {\n-});\n+const server = tls.createServer(options, common.mustCall());\n \n let sessionCb = null;\n let client = null;\n \n-server.on('newSession', function(key, session, done) {\n+server.on('newSession', common.mustCall((key, session, done) => {\n   done();\n-});\n+}));\n \n-server.on('resumeSession', function(id, cb) {\n+server.on('resumeSession', common.mustCall((id, cb) => {\n   sessionCb = cb;\n-\n   next();\n-});\n+}));\n \n-server.listen(0, function() {\n+server.listen(0, common.mustCall(() => {\n   const clientOpts = {\n-    port: this.address().port,\n+    port: server.address().port,\n     rejectUnauthorized: false,\n     session: false\n   };\n \n-  const s1 = tls.connect(clientOpts, function() {\n+  const s1 = tls.connect(clientOpts, common.mustCall(() => {\n     clientOpts.session = s1.getSession();\n     console.log('1st secure');\n \n     s1.destroy();\n-    const s2 = tls.connect(clientOpts, function(s) {\n+    const s2 = tls.connect(clientOpts, (s) => {\n       console.log('2nd secure');\n \n       s2.destroy();\n-    }).on('connect', function() {\n+    }).on('connect', common.mustCall(() => {\n       console.log('2nd connected');\n       client = s2;\n \n       next();\n-    });\n-  });\n-});\n+    }));\n+  }));\n+}));\n \n function next() {\n   if (!client || !sessionCb)\n     return;\n \n   client.destroy();\n-  setTimeout(function() {\n+  setTimeout(common.mustCall(() => {\n     sessionCb();\n     server.close();\n-  }, 100);\n+  }), 100);\n }"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 17,
        "deletions": 18
    }
}