{
    "author": "XadillaX",
    "message": "http: fix `request` when `setHost` is `true`\n\nFixes: https://github.com/nodejs/node/issues/19457\n\nPR-URL: https://github.com/nodejs/node/pull/19502\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Yuta Hiroto <hello@hiroppy.me>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "b06f686f8878027ccbd08b36b546378ffc0addfd",
    "files": [
        {
            "sha": "fc19be72d1405d4990304b92f315cfd3e6666c52",
            "filename": "doc/api/http.md",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b06f686f8878027ccbd08b36b546378ffc0addfd/doc%2Fapi%2Fhttp.md",
            "raw_url": "https://github.com/nodejs/node/raw/b06f686f8878027ccbd08b36b546378ffc0addfd/doc%2Fapi%2Fhttp.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttp.md?ref=b06f686f8878027ccbd08b36b546378ffc0addfd",
            "patch": "@@ -1858,6 +1858,8 @@ changes:\n     details. Any [`Duplex`][] stream is a valid return value.\n   * `timeout` {number}: A number specifying the socket timeout in milliseconds.\n     This will set the timeout before the socket is connected.\n+  * `setHost` {boolean}: Specifies whether or not to automatically add the\n+    `Host` header. Defaults to `true`.\n * `callback` {Function}\n * Returns: {http.ClientRequest}\n "
        },
        {
            "sha": "5be1632fe59433a9717d50dc6658987bf3548e00",
            "filename": "lib/_http_client.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b06f686f8878027ccbd08b36b546378ffc0addfd/lib%2F_http_client.js",
            "raw_url": "https://github.com/nodejs/node/raw/b06f686f8878027ccbd08b36b546378ffc0addfd/lib%2F_http_client.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_client.js?ref=b06f686f8878027ccbd08b36b546378ffc0addfd",
            "patch": "@@ -116,7 +116,7 @@ function ClientRequest(options, cb) {\n   var host = options.host = validateHost(options.hostname, 'hostname') ||\n                             validateHost(options.host, 'host') || 'localhost';\n \n-  var setHost = (options.setHost === undefined);\n+  var setHost = (options.setHost === undefined || Boolean(options.setHost));\n \n   this.socketPath = options.socketPath;\n   this.timeout = options.timeout;"
        },
        {
            "sha": "11fa8dd70f905ca455752ba326b6430b662e3c10",
            "filename": "test/parallel/test-https-host-headers.js",
            "status": "modified",
            "additions": 29,
            "deletions": 1,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/b06f686f8878027ccbd08b36b546378ffc0addfd/test%2Fparallel%2Ftest-https-host-headers.js",
            "raw_url": "https://github.com/nodejs/node/raw/b06f686f8878027ccbd08b36b546378ffc0addfd/test%2Fparallel%2Ftest-https-host-headers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-https-host-headers.js?ref=b06f686f8878027ccbd08b36b546378ffc0addfd",
            "patch": "@@ -16,7 +16,7 @@ const httpsServer = https.createServer(options, reqHandler);\n \n function reqHandler(req, res) {\n   console.log(`Got request: ${req.headers.host} ${req.url}`);\n-  if (req.url === '/setHostFalse5') {\n+  if (req.url.startsWith('/setHostFalse')) {\n     assert.strictEqual(req.headers.host, undefined);\n   } else {\n     assert.strictEqual(\n@@ -97,6 +97,34 @@ function testHttps() {\n       setHost: false,\n       port: this.address().port,\n       rejectUnauthorized: false\n+    }, cb).on('error', thrower);\n+\n+    https.request({\n+      method: 'GET',\n+      path: `/${counter++}`,\n+      host: 'localhost',\n+      setHost: true,\n+      //agent: false,\n+      port: this.address().port,\n+      rejectUnauthorized: false\n     }, cb).on('error', thrower).end();\n+\n+    https.get({\n+      method: 'GET',\n+      path: `/setHostFalse${counter++}`,\n+      host: 'localhost',\n+      setHost: 0,\n+      port: this.address().port,\n+      rejectUnauthorized: false\n+    }, cb).on('error', thrower);\n+\n+    https.get({\n+      method: 'GET',\n+      path: `/setHostFalse${counter++}`,\n+      host: 'localhost',\n+      setHost: null,\n+      port: this.address().port,\n+      rejectUnauthorized: false\n+    }, cb).on('error', thrower);\n   });\n }"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 32,
        "deletions": 2
    }
}