{
    "author": "cjihrig",
    "message": "report: simplify TriggerNodeReport()\n\nPR-URL: https://github.com/nodejs/node/pull/26174\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "1dc22bf3e55d5a7e1580f382231ee7af36de05aa",
    "files": [
        {
            "sha": "59aa0657a9765959262bc292b803dd70daddeea1",
            "filename": "src/node_report.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 22,
            "changes": 36,
            "blob_url": "https://github.com/nodejs/node/blob/1dc22bf3e55d5a7e1580f382231ee7af36de05aa/src%2Fnode_report.cc",
            "raw_url": "https://github.com/nodejs/node/raw/1dc22bf3e55d5a7e1580f382231ee7af36de05aa/src%2Fnode_report.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_report.cc?ref=1dc22bf3e55d5a7e1580f382231ee7af36de05aa",
            "patch": "@@ -111,7 +111,6 @@ std::string TriggerNodeReport(Isolate* isolate,\n   // Obtain the current time and the pid (platform dependent)\n   TIME_TYPE tm_struct;\n   LocalTime(&tm_struct);\n-  uv_pid_t pid = uv_os_getpid();\n   // Determine the required report filename. In order of priority:\n   //   1) supplied on API 2) configured on startup 3) default generated\n   if (!name.empty()) {\n@@ -123,34 +122,31 @@ std::string TriggerNodeReport(Isolate* isolate,\n   } else {\n     // Construct the report filename, with timestamp, pid and sequence number\n     oss << \"report\";\n-    seq++;\n #ifdef _WIN32\n     oss << \".\" << std::setfill('0') << std::setw(4) << tm_struct.wYear;\n     oss << std::setfill('0') << std::setw(2) << tm_struct.wMonth;\n     oss << std::setfill('0') << std::setw(2) << tm_struct.wDay;\n     oss << \".\" << std::setfill('0') << std::setw(2) << tm_struct.wHour;\n     oss << std::setfill('0') << std::setw(2) << tm_struct.wMinute;\n     oss << std::setfill('0') << std::setw(2) << tm_struct.wSecond;\n-    oss << \".\" << pid;\n-    oss << \".\" << std::setfill('0') << std::setw(3) << seq.load();\n #else  // UNIX, OSX\n     oss << \".\" << std::setfill('0') << std::setw(4) << tm_struct.tm_year + 1900;\n     oss << std::setfill('0') << std::setw(2) << tm_struct.tm_mon + 1;\n     oss << std::setfill('0') << std::setw(2) << tm_struct.tm_mday;\n     oss << \".\" << std::setfill('0') << std::setw(2) << tm_struct.tm_hour;\n     oss << std::setfill('0') << std::setw(2) << tm_struct.tm_min;\n     oss << std::setfill('0') << std::setw(2) << tm_struct.tm_sec;\n-    oss << \".\" << pid;\n-    oss << \".\" << std::setfill('0') << std::setw(3) << seq.load();\n #endif\n+    oss << \".\" << uv_os_getpid();\n+    oss << \".\" << std::setfill('0') << std::setw(3) << ++seq;\n     oss << \".json\";\n   }\n \n   filename = oss.str();\n   // Open the report file stream for writing. Supports stdout/err,\n   // user-specified or (default) generated name\n   std::ofstream outfile;\n-  std::ostream* outstream = &std::cout;\n+  std::ostream* outstream;\n   if (filename == \"stdout\") {\n     outstream = &std::cout;\n   } else if (filename == \"stderr\") {\n@@ -167,21 +163,18 @@ std::string TriggerNodeReport(Isolate* isolate,\n     }\n     // Check for errors on the file open\n     if (!outfile.is_open()) {\n-      if (env != nullptr && options->report_directory.length() > 0) {\n-        std::cerr << std::endl\n-                  << \"Failed to open Node.js report file: \" << filename\n-                  << \" directory: \" << options->report_directory\n-                  << \" (errno: \" << errno << \")\" << std::endl;\n-      } else {\n-        std::cerr << std::endl\n-                  << \"Failed to open Node.js report file: \" << filename\n-                  << \" (errno: \" << errno << \")\" << std::endl;\n-      }\n-      return \"\";\n-    } else {\n       std::cerr << std::endl\n-                << \"Writing Node.js report to file: \" << filename << std::endl;\n+                << \"Failed to open Node.js report file: \" << filename;\n+\n+      if (env != nullptr && options->report_directory.length() > 0)\n+        std::cerr << \" directory: \" << options->report_directory;\n+\n+      std::cerr << \" (errno: \" << errno << \")\" << std::endl;\n+      return \"\";\n     }\n+\n+    std::cerr << std::endl\n+              << \"Writing Node.js report to file: \" << filename << std::endl;\n   }\n \n   // Pass our stream about by reference, not by copying it.\n@@ -196,8 +189,7 @@ std::string TriggerNodeReport(Isolate* isolate,\n   }\n \n   std::cerr << \"Node.js report completed\" << std::endl;\n-  if (name.empty()) return filename;\n-  return name;\n+  return filename;\n }\n \n // External function to trigger a report, writing to a supplied stream."
        }
    ],
    "stats": {
        "total": 36,
        "additions": 14,
        "deletions": 22
    }
}