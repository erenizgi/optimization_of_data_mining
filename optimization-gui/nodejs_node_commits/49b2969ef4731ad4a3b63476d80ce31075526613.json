{
    "author": "dustinnewman",
    "message": "vm: migrate isContext to internal/errors\n\nPR-URL: https://github.com/nodejs/node/pull/19268\nRefs: https://github.com/nodejs/node/issues/18106\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Yuta Hiroto <hello@hiroppy.me>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "49b2969ef4731ad4a3b63476d80ce31075526613",
    "files": [
        {
            "sha": "ca7b6f33960d2c82424fe8a6afdb9801996561f6",
            "filename": "lib/vm.js",
            "status": "modified",
            "additions": 18,
            "deletions": 2,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/49b2969ef4731ad4a3b63476d80ce31075526613/lib%2Fvm.js",
            "raw_url": "https://github.com/nodejs/node/raw/49b2969ef4731ad4a3b63476d80ce31075526613/lib%2Fvm.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fvm.js?ref=49b2969ef4731ad4a3b63476d80ce31075526613",
            "patch": "@@ -26,10 +26,13 @@ const {\n   kParsingContext,\n \n   makeContext,\n-  isContext,\n+  isContext: _isContext,\n } = process.binding('contextify');\n \n-const { ERR_INVALID_ARG_TYPE } = require('internal/errors').codes;\n+const {\n+  ERR_INVALID_ARG_TYPE,\n+  ERR_MISSING_ARGS\n+} = require('internal/errors').codes;\n \n // The binding provides a few useful primitives:\n // - Script(code, { filename = \"evalmachine.anonymous\",\n@@ -119,6 +122,19 @@ function getContextOptions(options) {\n   return {};\n }\n \n+function isContext(sandbox) {\n+  if (arguments.length < 1) {\n+    throw new ERR_MISSING_ARGS('sandbox');\n+  }\n+\n+  if (typeof sandbox !== 'object' && typeof sandbox !== 'function' ||\n+      sandbox === null) {\n+    throw new ERR_INVALID_ARG_TYPE('sandbox', 'object', sandbox);\n+  }\n+\n+  return _isContext(sandbox);\n+}\n+\n let defaultContextNameIndex = 1;\n function createContext(sandbox, options) {\n   if (sandbox === undefined) {"
        },
        {
            "sha": "91df37b37d7d291f45e2e5121a3ea9cadaa46c05",
            "filename": "src/node_contextify.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/49b2969ef4731ad4a3b63476d80ce31075526613/src%2Fnode_contextify.cc",
            "raw_url": "https://github.com/nodejs/node/raw/49b2969ef4731ad4a3b63476d80ce31075526613/src%2Fnode_contextify.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_contextify.cc?ref=49b2969ef4731ad4a3b63476d80ce31075526613",
            "patch": "@@ -276,10 +276,8 @@ void ContextifyContext::MakeContext(const FunctionCallbackInfo<Value>& args) {\n void ContextifyContext::IsContext(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  if (!args[0]->IsObject()) {\n-    env->ThrowTypeError(\"sandbox must be an object\");\n-    return;\n-  }\n+  CHECK(args[0]->IsObject());\n+\n   Local<Object> sandbox = args[0].As<Object>();\n \n   Maybe<bool> result ="
        },
        {
            "sha": "fd6a66f3927a0e73369409475421a1b34bffdf3c",
            "filename": "test/parallel/test-vm-context.js",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/49b2969ef4731ad4a3b63476d80ce31075526613/test%2Fparallel%2Ftest-vm-context.js",
            "raw_url": "https://github.com/nodejs/node/raw/49b2969ef4731ad4a3b63476d80ce31075526613/test%2Fparallel%2Ftest-vm-context.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-vm-context.js?ref=49b2969ef4731ad4a3b63476d80ce31075526613",
            "patch": "@@ -20,7 +20,7 @@\n // USE OR OTHER DEALINGS IN THE SOFTWARE.\n \n 'use strict';\n-require('../common');\n+const common = require('../common');\n const assert = require('assert');\n \n const vm = require('vm');\n@@ -44,9 +44,12 @@ assert.strictEqual(3, context.foo);\n assert.strictEqual('lala', context.thing);\n \n // Issue GH-227:\n-assert.throws(() => {\n+common.expectsError(() => {\n   vm.runInNewContext('', null, 'some.js');\n-}, /^TypeError: sandbox must be an object$/);\n+}, {\n+  code: 'ERR_INVALID_ARG_TYPE',\n+  type: TypeError\n+});\n \n // Issue GH-1140:\n // Test runInContext signature"
        },
        {
            "sha": "d9e017d0f9173a8f17e3bfce1111ac281de67525",
            "filename": "test/parallel/test-vm-create-context-arg.js",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/49b2969ef4731ad4a3b63476d80ce31075526613/test%2Fparallel%2Ftest-vm-create-context-arg.js",
            "raw_url": "https://github.com/nodejs/node/raw/49b2969ef4731ad4a3b63476d80ce31075526613/test%2Fparallel%2Ftest-vm-create-context-arg.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-vm-create-context-arg.js?ref=49b2969ef4731ad4a3b63476d80ce31075526613",
            "patch": "@@ -20,13 +20,15 @@\n // USE OR OTHER DEALINGS IN THE SOFTWARE.\n \n 'use strict';\n-require('../common');\n-const assert = require('assert');\n+const common = require('../common');\n const vm = require('vm');\n \n-assert.throws(function() {\n+common.expectsError(() => {\n   vm.createContext('string is not supported');\n-}, /^TypeError: sandbox must be an object$/);\n+}, {\n+  code: 'ERR_INVALID_ARG_TYPE',\n+  type: TypeError\n+});\n \n // Should not throw.\n vm.createContext({ a: 1 });"
        },
        {
            "sha": "a762622c67a59492fed59cda81c3e810f94dc25c",
            "filename": "test/parallel/test-vm-is-context.js",
            "status": "modified",
            "additions": 18,
            "deletions": 4,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/49b2969ef4731ad4a3b63476d80ce31075526613/test%2Fparallel%2Ftest-vm-is-context.js",
            "raw_url": "https://github.com/nodejs/node/raw/49b2969ef4731ad4a3b63476d80ce31075526613/test%2Fparallel%2Ftest-vm-is-context.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-vm-is-context.js?ref=49b2969ef4731ad4a3b63476d80ce31075526613",
            "patch": "@@ -20,13 +20,27 @@\n // USE OR OTHER DEALINGS IN THE SOFTWARE.\n \n 'use strict';\n-require('../common');\n+const common = require('../common');\n const assert = require('assert');\n const vm = require('vm');\n \n-assert.throws(function() {\n-  vm.isContext('string is not supported');\n-}, /^TypeError: sandbox must be an object$/);\n+for (const valToTest of [\n+  'string', null, undefined, 8.9, Symbol('sym'), true\n+]) {\n+  common.expectsError(() => {\n+    vm.isContext(valToTest);\n+  }, {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError\n+  });\n+}\n+\n+common.expectsError(() => {\n+  vm.isContext();\n+}, {\n+  code: 'ERR_MISSING_ARGS',\n+  type: TypeError\n+});\n \n assert.strictEqual(vm.isContext({}), false);\n assert.strictEqual(vm.isContext([]), false);"
        }
    ],
    "stats": {
        "total": 67,
        "additions": 50,
        "deletions": 17
    }
}