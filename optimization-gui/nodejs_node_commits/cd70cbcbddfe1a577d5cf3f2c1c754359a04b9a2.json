{
    "author": "joyeecheung",
    "message": "src: pass cli options to bootstrap/loaders.js lexically\n\nInstead of using `internalBinding('config')` which should be used\nto carry information about build-time options, directly pass the\nrun-time cli options into bootstrap/loaders.js lexically via\nfunction arguments.\n\nPR-URL: https://github.com/nodejs/node/pull/25463\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "cd70cbcbddfe1a577d5cf3f2c1c754359a04b9a2",
    "files": [
        {
            "sha": "6eed9eab267fa4f33d7123982c0a06fffae2faff",
            "filename": "lib/internal/bootstrap/loaders.js",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/cd70cbcbddfe1a577d5cf3f2c1c754359a04b9a2/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd70cbcbddfe1a577d5cf3f2c1c754359a04b9a2/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Floaders.js?ref=cd70cbcbddfe1a577d5cf3f2c1c754359a04b9a2",
            "patch": "@@ -42,7 +42,7 @@\n // This file is compiled as if it's wrapped in a function with arguments\n // passed by node::LoadEnvironment()\n /* global process, getBinding, getLinkedBinding, getInternalBinding */\n-/* global debugBreak */\n+/* global debugBreak, experimentalModules, exposeInternals */\n \n if (debugBreak)\n   debugger; // eslint-disable-line no-debugger\n@@ -162,7 +162,6 @@ internalBinding('module_wrap').callbackMap = new WeakMap();\n // written in CommonJS style.\n const loaderExports = { internalBinding, NativeModule };\n const loaderId = 'internal/bootstrap/loaders';\n-const config = internalBinding('config');\n \n // Set up NativeModule.\n function NativeModule(id) {\n@@ -177,7 +176,7 @@ function NativeModule(id) {\n     // Do not expose this to user land even with --expose-internals.\n     this.canBeRequiredByUsers = false;\n   } else if (id.startsWith('internal/')) {\n-    this.canBeRequiredByUsers = config.exposeInternals;\n+    this.canBeRequiredByUsers = exposeInternals;\n   } else {\n     this.canBeRequiredByUsers = true;\n   }\n@@ -316,7 +315,7 @@ NativeModule.prototype.compile = function() {\n     const fn = compileFunction(id);\n     fn(this.exports, requireFn, this, process, internalBinding);\n \n-    if (config.experimentalModules && this.canBeRequiredByUsers) {\n+    if (experimentalModules && this.canBeRequiredByUsers) {\n       this.proxifyExports();\n     }\n "
        },
        {
            "sha": "7ddf36681bbd38171dbbf6b9532b43ac0eef46c7",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/cd70cbcbddfe1a577d5cf3f2c1c754359a04b9a2/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cd70cbcbddfe1a577d5cf3f2c1c754359a04b9a2/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=cd70cbcbddfe1a577d5cf3f2c1c754359a04b9a2",
            "patch": "@@ -701,7 +701,12 @@ void RunBootstrapping(Environment* env) {\n       FIXED_ONE_BYTE_STRING(isolate, \"getBinding\"),\n       FIXED_ONE_BYTE_STRING(isolate, \"getLinkedBinding\"),\n       FIXED_ONE_BYTE_STRING(isolate, \"getInternalBinding\"),\n-      FIXED_ONE_BYTE_STRING(isolate, \"debugBreak\")};\n+      // --inspect-brk-node\n+      FIXED_ONE_BYTE_STRING(isolate, \"debugBreak\"),\n+      // --experimental-modules\n+      FIXED_ONE_BYTE_STRING(isolate, \"experimentalModules\"),\n+      // --expose-internals\n+      FIXED_ONE_BYTE_STRING(isolate, \"exposeInternals\")};\n   std::vector<Local<Value>> loaders_args = {\n       process,\n       env->NewFunctionTemplate(binding::GetBinding)\n@@ -714,7 +719,11 @@ void RunBootstrapping(Environment* env) {\n           ->GetFunction(context)\n           .ToLocalChecked(),\n       Boolean::New(isolate,\n-                   env->options()->debug_options().break_node_first_line)};\n+                   env->options()->debug_options().break_node_first_line),\n+      Boolean::New(isolate,\n+                   env->options()->experimental_modules),\n+      Boolean::New(isolate,\n+                   env->options()->expose_internals)};\n \n   MaybeLocal<Value> loader_exports;\n   // Bootstrap internal loaders"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 14,
        "deletions": 6
    }
}