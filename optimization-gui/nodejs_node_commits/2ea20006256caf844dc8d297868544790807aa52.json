{
    "author": "gireeshpunathil",
    "message": "test: exit sequence sanity tests\n\nExecute JS code in worker through same vm context\nwhile exiting from the main thread at arbitrary\nexecution points, and make sure that the workers\nquiesce without crashing.\n\n`worker_threads` are not necessarily the subject of\ntesting, those are used for easy simulation of\nmulti-thread scenarios.\n\nRefs: https://github.com/nodejs/node/issues/25007\n\nPR-URL: https://github.com/nodejs/node/pull/25085\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "2ea20006256caf844dc8d297868544790807aa52",
    "files": [
        {
            "sha": "737399b113398195066a7a69d943f2b5c1c503ec",
            "filename": "test/parallel/test-worker-cleanexit-with-js.js",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/2ea20006256caf844dc8d297868544790807aa52/test%2Fparallel%2Ftest-worker-cleanexit-with-js.js",
            "raw_url": "https://github.com/nodejs/node/raw/2ea20006256caf844dc8d297868544790807aa52/test%2Fparallel%2Ftest-worker-cleanexit-with-js.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-cleanexit-with-js.js?ref=2ea20006256caf844dc8d297868544790807aa52",
            "patch": "@@ -0,0 +1,21 @@\n+'use strict';\n+const common = require('../common');\n+\n+// Harden the thread interactions on the exit path.\n+// Ensure workers are able to bail out safe at\n+// arbitrary execution points. By running a lot of\n+// JS code in a tight loop, the expectation\n+// is that those will be at various control flow points\n+// preferrably in the JS land.\n+\n+const { Worker } = require('worker_threads');\n+const code = 'setInterval(() => {' +\n+      \"require('v8').deserialize(require('v8').serialize({ foo: 'bar' }));\" +\n+      \"require('vm').runInThisContext('x = \\\"foo\\\";');\" +\n+      \"eval('const y = \\\"vm\\\";');}, 10);\";\n+for (let i = 0; i < 9; i++) {\n+  new Worker(code, { eval: true });\n+}\n+new Worker(code, { eval: true }).on('online', common.mustCall((msg) => {\n+  process.exit(0);\n+}));"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 21,
        "deletions": 0
    }
}