{
    "author": "unknown",
    "message": "deps: cherry-pick acc336c from upstream V8\n\nOriginal commit message:\n\n    [log] fix boolean logic on LogCodeObject\n\n    R=yangguo@google.com\n\n    Change-Id: Icb4825344991e5b2d15050e037064c60eeb9617e\n    Reviewed-on: https://chromium-review.googlesource.com/1097578\n    Reviewed-by: Benedikt Meurer <bmeurer@chromium.org>\n    Reviewed-by: Yang Guo <yangguo@chromium.org>\n    Commit-Queue: Benedikt Meurer <bmeurer@chromium.org>\n    Cr-Commit-Position: refs/heads/master@{#53777}\n\nRefs: https://github.com/v8/v8/commit/acc336c1257cc7ceee4b31094ee1e9e41\n\nPR-URL: https://github.com/nodejs/node/pull/21126\nRefs: https://github.com/v8/v8/commit/aa6ce3e\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "d15db8257c4b97d3f058281efdd1668cad0267ea",
    "files": [
        {
            "sha": "2a1d72f655c6b3699dab01c28e51e72f9763eb7f",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/d15db8257c4b97d3f058281efdd1668cad0267ea/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/d15db8257c4b97d3f058281efdd1668cad0267ea/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=d15db8257c4b97d3f058281efdd1668cad0267ea",
            "patch": "@@ -28,7 +28,7 @@\n \n     # Reset this number to 0 on major V8 upgrades.\n     # Increment by one for each non-official patch applied to deps/v8.\n-    'v8_embedder_string': '-node.4',\n+    'v8_embedder_string': '-node.5',\n \n     # Enable disassembler for `--print-code` v8 options\n     'v8_enable_disassembler': 1,"
        },
        {
            "sha": "f46f849b4d02955e50f3fb14b283c6238a375a53",
            "filename": "deps/v8/src/log.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/d15db8257c4b97d3f058281efdd1668cad0267ea/deps%2Fv8%2Fsrc%2Flog.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d15db8257c4b97d3f058281efdd1668cad0267ea/deps%2Fv8%2Fsrc%2Flog.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Flog.cc?ref=d15db8257c4b97d3f058281efdd1668cad0267ea",
            "patch": "@@ -2033,7 +2033,7 @@ void ExistingCodeLogger::LogCodeObject(Object* object) {\n       break;\n     case AbstractCode::BUILTIN:\n       if (Code::cast(object)->is_interpreter_trampoline_builtin() &&\n-          Code::cast(object) ==\n+          Code::cast(object) !=\n               *BUILTIN_CODE(isolate_, InterpreterEntryTrampoline)) {\n         return;\n       }"
        },
        {
            "sha": "767541d4a3a31a83c625627418c6b5565ed55faf",
            "filename": "deps/v8/test/cctest/test-log.cc",
            "status": "modified",
            "additions": 54,
            "deletions": 30,
            "changes": 84,
            "blob_url": "https://github.com/nodejs/node/blob/d15db8257c4b97d3f058281efdd1668cad0267ea/deps%2Fv8%2Ftest%2Fcctest%2Ftest-log.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d15db8257c4b97d3f058281efdd1668cad0267ea/deps%2Fv8%2Ftest%2Fcctest%2Ftest-log.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Ftest-log.cc?ref=d15db8257c4b97d3f058281efdd1668cad0267ea",
            "patch": "@@ -36,6 +36,9 @@\n \n #include <unordered_set>\n #include <vector>\n+// The C++ style guide recommends using <re2> instead of <regex>. However, the\n+// former isn't available in V8.\n+#include <regex>  // NOLINT(build/c++11)\n #include \"src/api.h\"\n #include \"src/log-utils.h\"\n #include \"src/log.h\"\n@@ -257,30 +260,41 @@ class TestCodeEventHandler : public v8::CodeEventHandler {\n   explicit TestCodeEventHandler(v8::Isolate* isolate)\n       : v8::CodeEventHandler(isolate) {}\n \n-  const char* FindLine(const char* prefix, const char* suffix = nullptr,\n-                       const char* start = nullptr) {\n-    if (!log_.length()) return NULL;\n-    const char* c_log = log_.c_str();\n-    if (start == nullptr) start = c_log;\n-    const char* end = c_log + log_.length();\n-    return FindLogLine(start, end, prefix, suffix);\n+  size_t CountLines(std::string prefix, std::string suffix = std::string()) {\n+    if (!log_.length()) return 0;\n+\n+    std::regex expression(\"(^|\\\\n)\" + prefix + \".*\" + suffix + \"(?=\\\\n|$)\");\n+\n+    size_t match_count(std::distance(\n+        std::sregex_iterator(log_.begin(), log_.end(), expression),\n+        std::sregex_iterator()));\n+\n+    return match_count;\n   }\n \n   void Handle(v8::CodeEvent* code_event) override {\n-    const char* code_type =\n-        v8::CodeEvent::GetCodeEventTypeName(code_event->GetCodeType());\n-    char function_name[1000];\n-    strncpy(function_name, code_type, 1000);\n-    function_name[strlen(code_type)] = ' ';\n-    code_event->GetFunctionName()->WriteUtf8(\n-        function_name + strlen(code_type) + 1, 1000);\n-    function_name[strlen(function_name) + 1] = '\\0';\n-    function_name[strlen(function_name)] = '\\n';\n-\n-    log_ += std::string(function_name);\n+    std::string log_line = \"\";\n+    log_line += v8::CodeEvent::GetCodeEventTypeName(code_event->GetCodeType());\n+    log_line += \" \";\n+    log_line += FormatName(code_event);\n+    log_line += \"\\n\";\n+    log_ += log_line;\n   }\n \n  private:\n+  std::string FormatName(v8::CodeEvent* code_event) {\n+    std::string name = std::string(code_event->GetComment());\n+    if (name.empty()) {\n+      v8::Local<v8::String> functionName = code_event->GetFunctionName();\n+      std::string buffer(functionName->Utf8Length() + 1, 0);\n+      functionName->WriteUtf8(&buffer[0], functionName->Utf8Length() + 1);\n+      // Sanitize name, removing unwanted \\0 resulted from WriteUtf8\n+      name = std::string(buffer.c_str());\n+    }\n+\n+    return name;\n+  }\n+\n   std::string log_;\n };\n \n@@ -854,21 +868,24 @@ TEST(ExternalCodeEventListener) {\n         \"testCodeEventListenerBeforeStart('1', 1);\";\n     CompileRun(source_text_before_start);\n \n-    CHECK_NULL(code_event_handler.FindLine(\"LazyCompile\",\n-                                           \"testCodeEventListenerBeforeStart\"));\n+    CHECK_EQ(code_event_handler.CountLines(\"LazyCompile\",\n+                                           \"testCodeEventListenerBeforeStart\"),\n+             0);\n \n     code_event_handler.Enable();\n \n-    CHECK_NOT_NULL(code_event_handler.FindLine(\n-        \"LazyCompile\", \"testCodeEventListenerBeforeStart\"));\n+    CHECK_GE(code_event_handler.CountLines(\"LazyCompile\",\n+                                           \"testCodeEventListenerBeforeStart\"),\n+             1);\n \n     const char* source_text_after_start =\n         \"function testCodeEventListenerAfterStart(a,b) { return a + b };\"\n         \"testCodeEventListenerAfterStart('1', 1);\";\n     CompileRun(source_text_after_start);\n \n-    CHECK_NOT_NULL(code_event_handler.FindLine(\n-        \"LazyCompile\", \"testCodeEventListenerAfterStart\"));\n+    CHECK_GE(code_event_handler.CountLines(\"LazyCompile\",\n+                                           \"testCodeEventListenerAfterStart\"),\n+             1);\n \n     context->Exit();\n   }\n@@ -897,21 +914,28 @@ TEST(ExternalCodeEventListenerWithInterpretedFramesNativeStack) {\n         \"testCodeEventListenerBeforeStart('1', 1);\";\n     CompileRun(source_text_before_start);\n \n-    CHECK_NULL(code_event_handler.FindLine(\"InterpretedFunction\",\n-                                           \"testCodeEventListenerBeforeStart\"));\n+    CHECK_EQ(code_event_handler.CountLines(\"InterpretedFunction\",\n+                                           \"testCodeEventListenerBeforeStart\"),\n+             0);\n \n     code_event_handler.Enable();\n \n-    CHECK_NOT_NULL(code_event_handler.FindLine(\n-        \"InterpretedFunction\", \"testCodeEventListenerBeforeStart\"));\n+    CHECK_GE(code_event_handler.CountLines(\"InterpretedFunction\",\n+                                           \"testCodeEventListenerBeforeStart\"),\n+             1);\n \n     const char* source_text_after_start =\n         \"function testCodeEventListenerAfterStart(a,b) { return a + b };\"\n         \"testCodeEventListenerAfterStart('1', 1);\";\n     CompileRun(source_text_after_start);\n \n-    CHECK_NOT_NULL(code_event_handler.FindLine(\n-        \"InterpretedFunction\", \"testCodeEventListenerAfterStart\"));\n+    CHECK_GE(code_event_handler.CountLines(\"InterpretedFunction\",\n+                                           \"testCodeEventListenerAfterStart\"),\n+             1);\n+\n+    CHECK_EQ(\n+        code_event_handler.CountLines(\"Builtin\", \"InterpreterEntryTrampoline\"),\n+        1);\n \n     context->Exit();\n   }"
        }
    ],
    "stats": {
        "total": 88,
        "additions": 56,
        "deletions": 32
    }
}