{
    "author": "joyeecheung",
    "message": "zlib: improve zlib errors\n\n- Use assert to check mode in the Zlib constructor since it should\n  only be passed by us.\n- Introduce checkRangesOrGetDefault() and checkFiniteNumber()\n  to simplify type and range checking for numeric arguments\n- Instead of `ERR_INVALID_OPT_VALUE`, throw `ERR_OUT_OF_RANGE` and\n  `ERR_INVALID_ARG_TYPE` with descriptions of the expected ranges\n  or types to make the errors more user-friendly.\n- Add message tests for the changed errors\n\nPR-URL: https://github.com/nodejs/node/pull/18675\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>",
    "sha": "da886d9a4cd923bd5fc33eff7df22ff7d855a00b",
    "files": [
        {
            "sha": "0fba957c09d3716f4976efd549530b54f8b758a2",
            "filename": "lib/zlib.js",
            "status": "modified",
            "additions": 78,
            "deletions": 80,
            "changes": 158,
            "blob_url": "https://github.com/nodejs/node/blob/da886d9a4cd923bd5fc33eff7df22ff7d855a00b/lib%2Fzlib.js",
            "raw_url": "https://github.com/nodejs/node/raw/da886d9a4cd923bd5fc33eff7df22ff7d855a00b/lib%2Fzlib.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fzlib.js?ref=da886d9a4cd923bd5fc33eff7df22ff7d855a00b",
            "patch": "@@ -156,6 +156,52 @@ function flushCallback(level, strategy, callback) {\n   }\n }\n \n+// 1. Returns false for undefined and NaN\n+// 2. Returns true for finite numbers\n+// 3. Throws ERR_INVALID_ARG_TYPE for non-numbers\n+// 4. Throws ERR_OUT_OF_RANGE for infinite numbers\n+function checkFiniteNumber(number, name) {\n+  // Common case\n+  if (number === undefined || Number.isNaN(number)) {\n+    return false;\n+  }\n+\n+  if (Number.isFinite(number)) {\n+    return true;  // is a valid number\n+  }\n+\n+  // Other non-numbers\n+  if (typeof number !== 'number') {\n+    const err = new errors.TypeError('ERR_INVALID_ARG_TYPE', name,\n+                                     'number', number);\n+    Error.captureStackTrace(err, checkFiniteNumber);\n+    throw err;\n+  }\n+\n+  // Infinite numbers\n+  const err = new errors.RangeError('ERR_OUT_OF_RANGE', name,\n+                                    'a finite number', number);\n+  Error.captureStackTrace(err, checkFiniteNumber);\n+  throw err;\n+}\n+\n+// 1. Returns def for undefined and NaN\n+// 2. Returns number for finite numbers >= lower and <= upper\n+// 3. Throws ERR_INVALID_ARG_TYPE for non-numbers\n+// 4. Throws ERR_OUT_OF_RANGE for infinite numbers or numbers > upper or < lower\n+function checkRangesOrGetDefault(number, name, lower, upper, def) {\n+  if (!checkFiniteNumber(number, name, lower, upper)) {\n+    return def;\n+  }\n+  if (number < lower || number > upper) {\n+    const err = new errors.RangeError('ERR_OUT_OF_RANGE', name,\n+                                      `>= ${lower} and <= ${upper}`, number);\n+    Error.captureStackTrace(err, checkRangesOrGetDefault);\n+    throw err;\n+  }\n+  return number;\n+}\n+\n // the Zlib class they all inherit from\n // This thing manages the queue of requests, and returns\n // true or false if there is anything in the queue when\n@@ -170,95 +216,53 @@ function Zlib(opts, mode) {\n   var strategy = Z_DEFAULT_STRATEGY;\n   var dictionary;\n \n-  if (typeof mode !== 'number')\n-    throw new errors.TypeError('ERR_INVALID_ARG_TYPE', 'mode', 'number');\n-  if (mode < DEFLATE || mode > UNZIP)\n-    throw new errors.RangeError('ERR_OUT_OF_RANGE', 'mode');\n+  // The Zlib class is not exported to user land, the mode should only be\n+  // passed in by us.\n+  assert(typeof mode === 'number');\n+  assert(mode >= DEFLATE && mode <= UNZIP);\n \n   if (opts) {\n     chunkSize = opts.chunkSize;\n-    if (chunkSize !== undefined && !Number.isNaN(chunkSize)) {\n-      if (chunkSize < Z_MIN_CHUNK || !Number.isFinite(chunkSize))\n-        throw new errors.RangeError('ERR_INVALID_OPT_VALUE',\n-                                    'chunkSize',\n-                                    chunkSize);\n-    } else {\n+    if (!checkFiniteNumber(chunkSize, 'options.chunkSize')) {\n       chunkSize = Z_DEFAULT_CHUNK;\n+    } else if (chunkSize < Z_MIN_CHUNK) {\n+      throw new errors.RangeError('ERR_OUT_OF_RANGE', 'options.chunkSize',\n+                                  `>= ${Z_MIN_CHUNK}`, chunkSize);\n     }\n \n-    flush = opts.flush;\n-    if (flush !== undefined && !Number.isNaN(flush)) {\n-      if (flush < Z_NO_FLUSH || flush > Z_BLOCK || !Number.isFinite(flush))\n-        throw new errors.RangeError('ERR_INVALID_OPT_VALUE', 'flush', flush);\n-    } else {\n-      flush = Z_NO_FLUSH;\n-    }\n+    flush = checkRangesOrGetDefault(\n+      opts.flush, 'options.flush',\n+      Z_NO_FLUSH, Z_BLOCK, Z_NO_FLUSH);\n \n-    finishFlush = opts.finishFlush;\n-    if (finishFlush !== undefined && !Number.isNaN(finishFlush)) {\n-      if (finishFlush < Z_NO_FLUSH || finishFlush > Z_BLOCK ||\n-          !Number.isFinite(finishFlush)) {\n-        throw new errors.RangeError('ERR_INVALID_OPT_VALUE',\n-                                    'finishFlush',\n-                                    finishFlush);\n-      }\n-    } else {\n-      finishFlush = Z_FINISH;\n-    }\n+    finishFlush = checkRangesOrGetDefault(\n+      opts.finishFlush, 'options.finishFlush',\n+      Z_NO_FLUSH, Z_BLOCK, Z_FINISH);\n \n-    windowBits = opts.windowBits;\n-    if (windowBits !== undefined && !Number.isNaN(windowBits)) {\n-      if (windowBits < Z_MIN_WINDOWBITS || windowBits > Z_MAX_WINDOWBITS ||\n-          !Number.isFinite(windowBits)) {\n-        throw new errors.RangeError('ERR_INVALID_OPT_VALUE',\n-                                    'windowBits',\n-                                    windowBits);\n-      }\n-    } else {\n-      windowBits = Z_DEFAULT_WINDOWBITS;\n-    }\n+    windowBits = checkRangesOrGetDefault(\n+      opts.windowBits, 'options.windowBits',\n+      Z_MIN_WINDOWBITS, Z_MAX_WINDOWBITS, Z_DEFAULT_WINDOWBITS);\n \n-    level = opts.level;\n-    if (level !== undefined && !Number.isNaN(level)) {\n-      if (level < Z_MIN_LEVEL || level > Z_MAX_LEVEL ||\n-          !Number.isFinite(level)) {\n-        throw new errors.RangeError('ERR_INVALID_OPT_VALUE',\n-                                    'level', level);\n-      }\n-    } else {\n-      level = Z_DEFAULT_COMPRESSION;\n-    }\n+    level = checkRangesOrGetDefault(\n+      opts.level, 'options.level',\n+      Z_MIN_LEVEL, Z_MAX_LEVEL, Z_DEFAULT_COMPRESSION);\n \n-    memLevel = opts.memLevel;\n-    if (memLevel !== undefined && !Number.isNaN(memLevel)) {\n-      if (memLevel < Z_MIN_MEMLEVEL || memLevel > Z_MAX_MEMLEVEL ||\n-          !Number.isFinite(memLevel)) {\n-        throw new errors.RangeError('ERR_INVALID_OPT_VALUE',\n-                                    'memLevel', memLevel);\n-      }\n-    } else {\n-      memLevel = Z_DEFAULT_MEMLEVEL;\n-    }\n+    memLevel = checkRangesOrGetDefault(\n+      opts.memLevel, 'options.memLevel',\n+      Z_MIN_MEMLEVEL, Z_MAX_MEMLEVEL, Z_DEFAULT_MEMLEVEL);\n \n-    strategy = opts.strategy;\n-    if (strategy !== undefined && !Number.isNaN(strategy)) {\n-      if (strategy < Z_DEFAULT_STRATEGY || strategy > Z_FIXED ||\n-          !Number.isFinite(strategy)) {\n-        throw new errors.TypeError('ERR_INVALID_OPT_VALUE',\n-                                   'strategy', strategy);\n-      }\n-    } else {\n-      strategy = Z_DEFAULT_STRATEGY;\n-    }\n+    strategy = checkRangesOrGetDefault(\n+      opts.strategy, 'options.strategy',\n+      Z_DEFAULT_STRATEGY, Z_FIXED, Z_DEFAULT_STRATEGY);\n \n     dictionary = opts.dictionary;\n     if (dictionary !== undefined && !isArrayBufferView(dictionary)) {\n       if (isAnyArrayBuffer(dictionary)) {\n         dictionary = Buffer.from(dictionary);\n       } else {\n-        throw new errors.TypeError('ERR_INVALID_OPT_VALUE',\n-                                   'dictionary',\n-                                   dictionary);\n+        throw new errors.TypeError(\n+          'ERR_INVALID_ARG_TYPE', 'options.dictionary',\n+          ['Buffer', 'TypedArray', 'DataView', 'ArrayBuffer'],\n+          dictionary);\n       }\n     }\n \n@@ -310,14 +314,8 @@ Object.defineProperty(Zlib.prototype, '_closed', {\n });\n \n Zlib.prototype.params = function params(level, strategy, callback) {\n-  if (level < Z_MIN_LEVEL || level > Z_MAX_LEVEL)\n-    throw new errors.RangeError('ERR_INVALID_ARG_VALUE', 'level', level);\n-\n-  if (strategy !== undefined &&\n-      (strategy < Z_DEFAULT_STRATEGY || strategy > Z_FIXED ||\n-       !Number.isFinite(strategy))) {\n-    throw new errors.TypeError('ERR_INVALID_ARG_VALUE', 'strategy', strategy);\n-  }\n+  checkRangesOrGetDefault(level, 'level', Z_MIN_LEVEL, Z_MAX_LEVEL);\n+  checkRangesOrGetDefault(strategy, 'strategy', Z_DEFAULT_STRATEGY, Z_FIXED);\n \n   if (this._level !== level || this._strategy !== strategy) {\n     this.flush(Z_SYNC_FLUSH,"
        },
        {
            "sha": "5d5e9fb4a2edd1d0f82a08fa314388b6167a7a15",
            "filename": "test/parallel/test-zlib-deflate-constructors.js",
            "status": "modified",
            "additions": 211,
            "deletions": 36,
            "changes": 247,
            "blob_url": "https://github.com/nodejs/node/blob/da886d9a4cd923bd5fc33eff7df22ff7d855a00b/test%2Fparallel%2Ftest-zlib-deflate-constructors.js",
            "raw_url": "https://github.com/nodejs/node/raw/da886d9a4cd923bd5fc33eff7df22ff7d855a00b/test%2Fparallel%2Ftest-zlib-deflate-constructors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-zlib-deflate-constructors.js?ref=da886d9a4cd923bd5fc33eff7df22ff7d855a00b",
            "patch": "@@ -12,83 +12,201 @@ assert.ok(new zlib.Deflate() instanceof zlib.Deflate);\n assert.ok(zlib.DeflateRaw() instanceof zlib.DeflateRaw);\n assert.ok(new zlib.DeflateRaw() instanceof zlib.DeflateRaw);\n \n-// Throws if `opts.chunkSize` is invalid\n+// Throws if `options.chunkSize` is invalid\n+common.expectsError(\n+  () => new zlib.Deflate({ chunkSize: 'test' }),\n+  {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"options.chunkSize\" property must be of type number. ' +\n+             'Received type string'\n+  }\n+);\n+\n common.expectsError(\n   () => new zlib.Deflate({ chunkSize: -Infinity }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.chunkSize\" is out of range. It must ' +\n+             'be a finite number. Received -Infinity'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate({ chunkSize: 0 }),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.chunkSize\" is out of range. It must ' +\n+             'be >= 64. Received 0'\n   }\n );\n \n // Confirm that maximum chunk size cannot be exceeded because it is `Infinity`.\n assert.strictEqual(zlib.constants.Z_MAX_CHUNK, Infinity);\n \n-// Throws if `opts.windowBits` is invalid\n+// Throws if `options.windowBits` is invalid\n+common.expectsError(\n+  () => new zlib.Deflate({ windowBits: 'test' }),\n+  {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"options.windowBits\" property must be of type number. ' +\n+             'Received type string'\n+  }\n+);\n+\n common.expectsError(\n   () => new zlib.Deflate({ windowBits: -Infinity }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.windowBits\" is out of range. It must ' +\n+             'be a finite number. Received -Infinity'\n   }\n );\n \n common.expectsError(\n   () => new zlib.Deflate({ windowBits: Infinity }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.windowBits\" is out of range. It must ' +\n+             'be a finite number. Received Infinity'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate({ windowBits: 0 }),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.windowBits\" is out of range. It must ' +\n+             'be >= 8 and <= 15. Received 0'\n+  }\n+);\n+\n+// Throws if `options.level` is invalid\n+common.expectsError(\n+  () => new zlib.Deflate({ level: 'test' }),\n+  {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"options.level\" property must be of type number. ' +\n+             'Received type string'\n   }\n );\n \n-// Throws if `opts.level` is invalid\n common.expectsError(\n   () => new zlib.Deflate({ level: -Infinity }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.level\" is out of range. It must ' +\n+             'be a finite number. Received -Infinity'\n   }\n );\n \n common.expectsError(\n   () => new zlib.Deflate({ level: Infinity }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.level\" is out of range. It must ' +\n+             'be a finite number. Received Infinity'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate({ level: -2 }),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.level\" is out of range. It must ' +\n+             'be >= -1 and <= 9. Received -2'\n+  }\n+);\n+\n+// Throws if `level` invalid in  `Deflate.prototype.params()`\n+common.expectsError(\n+  () => new zlib.Deflate().params('test'),\n+  {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"level\" argument must be of type number. ' +\n+             'Received type string'\n   }\n );\n \n-// Throws a RangeError if `level` invalid in  `Deflate.prototype.params()`\n common.expectsError(\n   () => new zlib.Deflate().params(-Infinity),\n   {\n-    code: 'ERR_INVALID_ARG_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"level\" is out of range. It must ' +\n+             'be a finite number. Received -Infinity'\n   }\n );\n \n common.expectsError(\n   () => new zlib.Deflate().params(Infinity),\n   {\n-    code: 'ERR_INVALID_ARG_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"level\" is out of range. It must ' +\n+             'be a finite number. Received Infinity'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate().params(-2),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"level\" is out of range. It must ' +\n+             'be >= -1 and <= 9. Received -2'\n+  }\n+);\n+\n+// Throws if options.memLevel is invalid\n+common.expectsError(\n+  () => new zlib.Deflate({ memLevel: 'test' }),\n+  {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"options.memLevel\" property must be of type number. ' +\n+             'Received type string'\n   }\n );\n \n-// Throws if `opts.memLevel` is invalid\n common.expectsError(\n   () => new zlib.Deflate({ memLevel: -Infinity }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.memLevel\" is out of range. It must ' +\n+             'be a finite number. Received -Infinity'\n   }\n );\n \n common.expectsError(\n   () => new zlib.Deflate({ memLevel: Infinity }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.memLevel\" is out of range. It must ' +\n+             'be a finite number. Received Infinity'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate({ memLevel: -2 }),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.memLevel\" is out of range. It must ' +\n+             'be >= 1 and <= 9. Received -2'\n   }\n );\n \n@@ -99,38 +217,95 @@ new zlib.Deflate({ strategy: zlib.constants.Z_RLE });\n new zlib.Deflate({ strategy: zlib.constants.Z_FIXED });\n new zlib.Deflate({ strategy: zlib.constants.Z_DEFAULT_STRATEGY });\n \n-// Throws if opt.strategy is the wrong type.\n+// Throws if options.strategy is invalid\n common.expectsError(\n-  () => new zlib.Deflate({ strategy: String(zlib.constants.Z_RLE) }),\n+  () => new zlib.Deflate({ strategy: 'test' }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: TypeError\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"options.strategy\" property must be of type number. ' +\n+             'Received type string'\n   }\n );\n \n-// Throws if opts.strategy is invalid\n common.expectsError(\n-  () => new zlib.Deflate({ strategy: 'this is a bogus strategy' }),\n+  () => new zlib.Deflate({ strategy: -Infinity }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: TypeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.strategy\" is out of range. It must ' +\n+             'be a finite number. Received -Infinity'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate({ strategy: Infinity }),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.strategy\" is out of range. It must ' +\n+             'be a finite number. Received Infinity'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate({ strategy: -2 }),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.strategy\" is out of range. It must ' +\n+             'be >= 0 and <= 4. Received -2'\n   }\n );\n \n // Throws TypeError if `strategy` is invalid in `Deflate.prototype.params()`\n common.expectsError(\n-  () => new zlib.Deflate().params(0, 'I am an invalid strategy'),\n+  () => new zlib.Deflate().params(0, 'test'),\n+  {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"strategy\" argument must be of type number. ' +\n+             'Received type string'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate().params(0, -Infinity),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"strategy\" is out of range. It must ' +\n+             'be a finite number. Received -Infinity'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate().params(0, Infinity),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"strategy\" is out of range. It must ' +\n+             'be a finite number. Received Infinity'\n+  }\n+);\n+\n+common.expectsError(\n+  () => new zlib.Deflate().params(0, -2),\n   {\n-    code: 'ERR_INVALID_ARG_VALUE',\n-    type: TypeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"strategy\" is out of range. It must ' +\n+             'be >= 0 and <= 4. Received -2'\n   }\n );\n \n // Throws if opts.dictionary is not a Buffer\n common.expectsError(\n   () => new zlib.Deflate({ dictionary: 'not a buffer' }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: TypeError\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"options.dictionary\" property must be one of type Buffer, ' +\n+             'TypedArray, DataView, or ArrayBuffer. Received type string'\n   }\n );"
        },
        {
            "sha": "4834c82b7d3a7456d4a87a507742261a5d3e77a9",
            "filename": "test/parallel/test-zlib-failed-init.js",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/da886d9a4cd923bd5fc33eff7df22ff7d855a00b/test%2Fparallel%2Ftest-zlib-failed-init.js",
            "raw_url": "https://github.com/nodejs/node/raw/da886d9a4cd923bd5fc33eff7df22ff7d855a00b/test%2Fparallel%2Ftest-zlib-failed-init.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-zlib-failed-init.js?ref=da886d9a4cd923bd5fc33eff7df22ff7d855a00b",
            "patch": "@@ -8,24 +8,30 @@ const zlib = require('zlib');\n common.expectsError(\n   () => zlib.createGzip({ chunkSize: 0 }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.chunkSize\" is out of range. It must ' +\n+             'be >= 64. Received 0'\n   }\n );\n \n common.expectsError(\n   () => zlib.createGzip({ windowBits: 0 }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.windowBits\" is out of range. It must ' +\n+             'be >= 8 and <= 15. Received 0'\n   }\n );\n \n common.expectsError(\n   () => zlib.createGzip({ memLevel: 0 }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.memLevel\" is out of range. It must ' +\n+             'be >= 1 and <= 9. Received 0'\n   }\n );\n "
        },
        {
            "sha": "67c58b95d3105e02a1f0e24ef3d4ae53b4d36965",
            "filename": "test/parallel/test-zlib-flush-flags.js",
            "status": "modified",
            "additions": 16,
            "deletions": 8,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/da886d9a4cd923bd5fc33eff7df22ff7d855a00b/test%2Fparallel%2Ftest-zlib-flush-flags.js",
            "raw_url": "https://github.com/nodejs/node/raw/da886d9a4cd923bd5fc33eff7df22ff7d855a00b/test%2Fparallel%2Ftest-zlib-flush-flags.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-zlib-flush-flags.js?ref=da886d9a4cd923bd5fc33eff7df22ff7d855a00b",
            "patch": "@@ -7,16 +7,20 @@ zlib.createGzip({ flush: zlib.constants.Z_SYNC_FLUSH });\n common.expectsError(\n   () => zlib.createGzip({ flush: 'foobar' }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"options.flush\" property must be of type number. ' +\n+             'Received type string'\n   }\n );\n \n common.expectsError(\n   () => zlib.createGzip({ flush: 10000 }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.flush\" is out of range. It must ' +\n+             'be >= 0 and <= 5. Received 10000'\n   }\n );\n \n@@ -25,15 +29,19 @@ zlib.createGzip({ finishFlush: zlib.constants.Z_SYNC_FLUSH });\n common.expectsError(\n   () => zlib.createGzip({ finishFlush: 'foobar' }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    type: TypeError,\n+    message: 'The \"options.finishFlush\" property must be of type number. ' +\n+             'Received type string'\n   }\n );\n \n common.expectsError(\n   () => zlib.createGzip({ finishFlush: 10000 }),\n   {\n-    code: 'ERR_INVALID_OPT_VALUE',\n-    type: RangeError\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"options.finishFlush\" is out of range. It must ' +\n+             'be >= 0 and <= 5. Received 10000'\n   }\n );"
        }
    ],
    "stats": {
        "total": 447,
        "additions": 317,
        "deletions": 130
    }
}