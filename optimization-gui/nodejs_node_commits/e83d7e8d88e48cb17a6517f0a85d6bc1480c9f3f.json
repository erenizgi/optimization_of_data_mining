{
    "author": "targos",
    "message": "crypto: put legacy _handle accessors on prototypes\n\nCreating deprecated accessors each time an object is created is very\ntime consuming.\n\nRefs: https://github.com/nodejs/node/pull/22747\nFixes: https://github.com/nodejs/node/issues/24266\n\nPR-URL: https://github.com/nodejs/node/pull/24269\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f",
    "files": [
        {
            "sha": "a3f28c183a46b7786820e1a107fa743c4d6b1852",
            "filename": "lib/internal/crypto/cipher.js",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "raw_url": "https://github.com/nodejs/node/raw/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fcipher.js?ref=e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f",
            "patch": "@@ -74,7 +74,7 @@ function getUIntOption(options, key) {\n function createCipherBase(cipher, credential, options, decipher, iv) {\n   const authTagLength = getUIntOption(options, 'authTagLength');\n \n-  legacyNativeHandle(this, new CipherBase(decipher));\n+  this[kHandle] = new CipherBase(decipher);\n   if (iv === undefined) {\n     this[kHandle].init(cipher, credential, authTagLength);\n   } else {\n@@ -219,6 +219,8 @@ Cipher.prototype.setAAD = function setAAD(aadbuf, options) {\n   return this;\n };\n \n+legacyNativeHandle(Cipher);\n+\n function Cipheriv(cipher, key, iv, options) {\n   if (!(this instanceof Cipheriv))\n     return new Cipheriv(cipher, key, iv, options);\n@@ -254,6 +256,7 @@ function addCipherPrototypeFunctions(constructor) {\n \n inherits(Cipheriv, LazyTransform);\n addCipherPrototypeFunctions(Cipheriv);\n+legacyNativeHandle(Cipheriv);\n \n function Decipher(cipher, password, options) {\n   if (!(this instanceof Decipher))\n@@ -264,6 +267,7 @@ function Decipher(cipher, password, options) {\n \n inherits(Decipher, LazyTransform);\n addCipherPrototypeFunctions(Decipher);\n+legacyNativeHandle(Decipher);\n \n \n function Decipheriv(cipher, key, iv, options) {\n@@ -275,6 +279,7 @@ function Decipheriv(cipher, key, iv, options) {\n \n inherits(Decipheriv, LazyTransform);\n addCipherPrototypeFunctions(Decipheriv);\n+legacyNativeHandle(Decipheriv);\n \n module.exports = {\n   Cipher,"
        },
        {
            "sha": "81204cfda3e67616d98acda08c0d7f53b563da90",
            "filename": "lib/internal/crypto/diffiehellman.js",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Fdiffiehellman.js",
            "raw_url": "https://github.com/nodejs/node/raw/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Fdiffiehellman.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fdiffiehellman.js?ref=e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f",
            "patch": "@@ -61,7 +61,7 @@ function DiffieHellman(sizeOrKey, keyEncoding, generator, genEncoding) {\n   else if (typeof generator !== 'number')\n     generator = toBuf(generator, genEncoding);\n \n-  legacyNativeHandle(this, new _DiffieHellman(sizeOrKey, generator));\n+  this[kHandle] = new _DiffieHellman(sizeOrKey, generator);\n   Object.defineProperty(this, 'verifyError', {\n     enumerable: true,\n     value: this[kHandle].verifyError,\n@@ -73,7 +73,7 @@ function DiffieHellman(sizeOrKey, keyEncoding, generator, genEncoding) {\n function DiffieHellmanGroup(name) {\n   if (!(this instanceof DiffieHellmanGroup))\n     return new DiffieHellmanGroup(name);\n-  legacyNativeHandle(this, new _DiffieHellmanGroup(name));\n+  this[kHandle] = new _DiffieHellmanGroup(name);\n   Object.defineProperty(this, 'verifyError', {\n     enumerable: true,\n     value: this[kHandle].verifyError,\n@@ -165,13 +165,16 @@ DiffieHellman.prototype.setPrivateKey = function setPrivateKey(key, encoding) {\n   return this;\n };\n \n+legacyNativeHandle(DiffieHellman);\n+legacyNativeHandle(DiffieHellmanGroup);\n+\n \n function ECDH(curve) {\n   if (!(this instanceof ECDH))\n     return new ECDH(curve);\n \n   validateString(curve, 'curve');\n-  legacyNativeHandle(this, new _ECDH(curve));\n+  this[kHandle] = new _ECDH(curve);\n }\n \n ECDH.prototype.computeSecret = DiffieHellman.prototype.computeSecret;\n@@ -192,6 +195,8 @@ ECDH.prototype.getPublicKey = function getPublicKey(encoding, format) {\n   return encode(key, encoding);\n };\n \n+legacyNativeHandle(ECDH);\n+\n ECDH.convertKey = function convertKey(key, curve, inEnc, outEnc, format) {\n   if (typeof key !== 'string' && !isArrayBufferView(key)) {\n     throw new ERR_INVALID_ARG_TYPE("
        },
        {
            "sha": "6803d8fa954e7364f451f17ee9119699a17af465",
            "filename": "lib/internal/crypto/hash.js",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Fhash.js",
            "raw_url": "https://github.com/nodejs/node/raw/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Fhash.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fhash.js?ref=e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f",
            "patch": "@@ -32,7 +32,7 @@ function Hash(algorithm, options) {\n   if (!(this instanceof Hash))\n     return new Hash(algorithm, options);\n   validateString(algorithm, 'algorithm');\n-  legacyNativeHandle(this, new _Hash(algorithm));\n+  this[kHandle] = new _Hash(algorithm);\n   this[kState] = {\n     [kFinalized]: false\n   };\n@@ -81,6 +81,8 @@ Hash.prototype.digest = function digest(outputEncoding) {\n   return ret;\n };\n \n+legacyNativeHandle(Hash);\n+\n \n function Hmac(hmac, key, options) {\n   if (!(this instanceof Hmac))\n@@ -90,7 +92,7 @@ function Hmac(hmac, key, options) {\n     throw new ERR_INVALID_ARG_TYPE('key',\n                                    ['string', 'TypedArray', 'DataView'], key);\n   }\n-  legacyNativeHandle(this, new _Hmac());\n+  this[kHandle] = new _Hmac();\n   this[kHandle].init(hmac, toBuf(key));\n   this[kState] = {\n     [kFinalized]: false\n@@ -122,6 +124,8 @@ Hmac.prototype.digest = function digest(outputEncoding) {\n Hmac.prototype._flush = Hash.prototype._flush;\n Hmac.prototype._transform = Hash.prototype._transform;\n \n+legacyNativeHandle(Hmac);\n+\n module.exports = {\n   Hash,\n   Hmac"
        },
        {
            "sha": "9f02c866739f24ad227c42ce691c645e41a88294",
            "filename": "lib/internal/crypto/sig.js",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Fsig.js",
            "raw_url": "https://github.com/nodejs/node/raw/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Fsig.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fsig.js?ref=e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f",
            "patch": "@@ -24,7 +24,7 @@ function Sign(algorithm, options) {\n   if (!(this instanceof Sign))\n     return new Sign(algorithm, options);\n   validateString(algorithm, 'algorithm');\n-  legacyNativeHandle(this, new _Sign());\n+  this[kHandle] = new _Sign();\n   this[kHandle].init(algorithm);\n \n   Writable.call(this, options);\n@@ -45,6 +45,8 @@ Sign.prototype.update = function update(data, encoding) {\n   return this;\n };\n \n+legacyNativeHandle(Sign);\n+\n function getPadding(options) {\n   return getIntOption('padding', RSA_PKCS1_PADDING, options);\n }\n@@ -93,7 +95,7 @@ function Verify(algorithm, options) {\n   if (!(this instanceof Verify))\n     return new Verify(algorithm, options);\n   validateString(algorithm, 'algorithm');\n-  legacyNativeHandle(this, new _Verify());\n+  this[kHandle] = new _Verify();\n   this[kHandle].init(algorithm);\n \n   Writable.call(this, options);\n@@ -121,6 +123,8 @@ Verify.prototype.verify = function verify(options, signature, sigEncoding) {\n   return this[kHandle].verify(key, signature, rsaPadding, pssSaltLength);\n };\n \n+legacyNativeHandle(Verify);\n+\n module.exports = {\n   Sign,\n   Verify"
        },
        {
            "sha": "6746f2a66c818ad6fb6a3e4e7b1e607d9e15807f",
            "filename": "lib/internal/crypto/util.js",
            "status": "modified",
            "additions": 8,
            "deletions": 9,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f/lib%2Finternal%2Fcrypto%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Futil.js?ref=e83d7e8d88e48cb17a6517f0a85d6bc1480c9f3f",
            "patch": "@@ -30,15 +30,14 @@ const {\n \n const kHandle = Symbol('kHandle');\n \n-function legacyNativeHandle(obj, handle) {\n-  obj[kHandle] = handle;\n-  Object.defineProperty(obj, '_handle', {\n-    get: deprecate(() => handle,\n-                   `${obj.constructor.name}._handle is deprecated. Use the ` +\n-                   'public API instead.', 'DEP0117'),\n-    set: deprecate((h) => obj[kHandle] = handle = h,\n-                   `${obj.constructor.name}._handle is deprecated. Use the ` +\n-                   'public API instead.', 'DEP0117'),\n+function legacyNativeHandle(clazz) {\n+  Object.defineProperty(clazz.prototype, '_handle', {\n+    get: deprecate(function() { return this[kHandle]; },\n+                   `${clazz.name}._handle is deprecated. Use the public API ` +\n+                   'instead.', 'DEP0117'),\n+    set: deprecate(function(h) { this[kHandle] = h; },\n+                   `${clazz.name}._handle is deprecated. Use the public API ` +\n+                   'instead.', 'DEP0117'),\n     enumerable: false\n   });\n }"
        }
    ],
    "stats": {
        "total": 51,
        "additions": 34,
        "deletions": 17
    }
}