{
    "author": "unknown",
    "message": "test: add regression test for #11257\n\nRefs: https://github.com/nodejs/node/issues/11257\n\nPR-URL: https://github.com/nodejs/node/pull/20391\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "d9425733931d86b41cbe0cb7f7f9940af4cbe8a5",
    "files": [
        {
            "sha": "06e93429d03f6d4cc3fd4d2ba970107340b21406",
            "filename": "test/parallel/test-stdio-pipe-stderr.js",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/nodejs/node/blob/d9425733931d86b41cbe0cb7f7f9940af4cbe8a5/test%2Fparallel%2Ftest-stdio-pipe-stderr.js",
            "raw_url": "https://github.com/nodejs/node/raw/d9425733931d86b41cbe0cb7f7f9940af4cbe8a5/test%2Fparallel%2Ftest-stdio-pipe-stderr.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stdio-pipe-stderr.js?ref=d9425733931d86b41cbe0cb7f7f9940af4cbe8a5",
            "patch": "@@ -0,0 +1,37 @@\n+'use strict';\n+require('../common');\n+const tmpdir = require('../common/tmpdir');\n+const assert = require('assert');\n+const fs = require('fs');\n+const join = require('path').join;\n+const spawn = require('child_process').spawnSync;\n+\n+// Test that invoking node with require, and piping stderr to file,\n+// does not result in exception,\n+// see: https://github.com/nodejs/node/issues/11257\n+\n+tmpdir.refresh();\n+const fakeModulePath = join(tmpdir.path, 'batman.js');\n+const stderrOutputPath = join(tmpdir.path, 'stderr-output.txt');\n+// we need to redirect stderr to a file to produce #11257\n+const stream = fs.createWriteStream(stderrOutputPath);\n+\n+// the error described in #11257 only happens when we require a\n+// non-built-in module.\n+fs.writeFileSync(fakeModulePath, '', 'utf8');\n+\n+stream.on('open', () => {\n+  spawn(process.execPath, {\n+    input: `require(\"${fakeModulePath.replace(/\\\\/g, '/')}\")`,\n+    stdio: ['pipe', 'pipe', stream]\n+  });\n+  const stderr = fs.readFileSync(stderrOutputPath, 'utf8').trim();\n+  assert.strictEqual(\n+    stderr,\n+    '',\n+    `piping stderr to file should not result in exception: ${stderr}`\n+  );\n+  stream.end();\n+  fs.unlinkSync(stderrOutputPath);\n+  fs.unlinkSync(fakeModulePath);\n+});"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 37,
        "deletions": 0
    }
}