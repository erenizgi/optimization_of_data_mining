{
    "author": "addaleax",
    "message": "src: always call ReadStop() before Close()\n\nFor libuv-backed streams, always explicitly stop reading before\nclosing the handle.\n\nPR-URL: https://github.com/nodejs/node/pull/19377\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "2b3150466e5f4db841f5980cda32172555bdda15",
    "files": [
        {
            "sha": "b2b09f5010d1f755e75804a995fa2ff55894e160",
            "filename": "src/handle_wrap.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/2b3150466e5f4db841f5980cda32172555bdda15/src%2Fhandle_wrap.h",
            "raw_url": "https://github.com/nodejs/node/raw/2b3150466e5f4db841f5980cda32172555bdda15/src%2Fhandle_wrap.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fhandle_wrap.h?ref=2b3150466e5f4db841f5980cda32172555bdda15",
            "patch": "@@ -70,7 +70,8 @@ class HandleWrap : public AsyncWrap {\n \n   inline uv_handle_t* GetHandle() const { return handle_; }\n \n-  void Close(v8::Local<v8::Value> close_callback = v8::Local<v8::Value>());\n+  virtual void Close(\n+      v8::Local<v8::Value> close_callback = v8::Local<v8::Value>());\n \n  protected:\n   HandleWrap(Environment* env,"
        },
        {
            "sha": "cdcbe574f9ae5f6d92ea4e0cbb6610ad2afffea9",
            "filename": "src/stream_wrap.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/2b3150466e5f4db841f5980cda32172555bdda15/src%2Fstream_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/2b3150466e5f4db841f5980cda32172555bdda15/src%2Fstream_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_wrap.cc?ref=2b3150466e5f4db841f5980cda32172555bdda15",
            "patch": "@@ -373,6 +373,11 @@ void LibuvStreamWrap::AfterUvWrite(uv_write_t* req, int status) {\n   req_wrap->Done(status);\n }\n \n+void LibuvStreamWrap::Close(v8::Local<v8::Value> close_callback) {\n+  ReadStop();\n+  HandleWrap::Close(close_callback);\n+}\n+\n }  // namespace node\n \n NODE_BUILTIN_MODULE_CONTEXT_AWARE(stream_wrap,"
        },
        {
            "sha": "94a161b6d54e071af523be8a52fa1229b7a1cf91",
            "filename": "src/stream_wrap.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2b3150466e5f4db841f5980cda32172555bdda15/src%2Fstream_wrap.h",
            "raw_url": "https://github.com/nodejs/node/raw/2b3150466e5f4db841f5980cda32172555bdda15/src%2Fstream_wrap.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_wrap.h?ref=2b3150466e5f4db841f5980cda32172555bdda15",
            "patch": "@@ -76,6 +76,8 @@ class LibuvStreamWrap : public HandleWrap, public StreamBase {\n   ShutdownWrap* CreateShutdownWrap(v8::Local<v8::Object> object) override;\n   WriteWrap* CreateWriteWrap(v8::Local<v8::Object> object) override;\n \n+  void Close(v8::Local<v8::Value> close_callback) override;\n+\n  protected:\n   LibuvStreamWrap(Environment* env,\n                   v8::Local<v8::Object> object,"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 9,
        "deletions": 1
    }
}