{
    "author": "devsnek",
    "message": "Revert \"util: change util.inspect depth default\"\n\nThis reverts commit ac7450a09a4c167cd43c14d7c88721d22f077529.\n\nThis fully reverts the changes to util.inspect depth.\n\nIt has caused breakage in logging to existing apps, and even\nsomething as simple as `console.log(require)` will cause >1m freezes.\n\nI've heard nothing but negative feedback (seriously not a single\nperson has expressed anything positive about this change) and\npersonally i find this change extremely annoying.\n\nPR-URL: https://github.com/nodejs/node/pull/24326\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Franziska Hinkelmann <franziska.hinkelmann@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: John-David Dalton <john.david.dalton@gmail.com>",
    "sha": "7082c61e27142c1c4c55ab925baa8a162637b066",
    "files": [
        {
            "sha": "b687eaf362f35e65fad7da1d9989b784e4003ffb",
            "filename": "doc/api/util.md",
            "status": "modified",
            "additions": 6,
            "deletions": 17,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/7082c61e27142c1c4c55ab925baa8a162637b066/doc%2Fapi%2Futil.md",
            "raw_url": "https://github.com/nodejs/node/raw/7082c61e27142c1c4c55ab925baa8a162637b066/doc%2Fapi%2Futil.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Futil.md?ref=7082c61e27142c1c4c55ab925baa8a162637b066",
            "patch": "@@ -1,4 +1,4 @@\n-# Util \n+# Util\n \n <!--introduced_in=v0.10.0-->\n \n@@ -421,7 +421,7 @@ changes:\n   * `depth` {number} Specifies the number of times to recurse while formatting\n     the `object`. This is useful for inspecting large complicated objects. To\n     make it recurse up to the maximum call stack size pass `Infinity` or `null`.\n-    **Default:** `20`.\n+    **Default:** `2`.\n   * `colors` {boolean} If `true`, the output will be styled with ANSI color\n     codes. Colors are customizable, see [Customizing `util.inspect` colors][].\n     **Default:** `false`.\n@@ -478,23 +478,12 @@ util.inspect(new Bar()); // 'Bar {}'\n util.inspect(baz);       // '[foo] {}'\n ```\n \n-The following example limits the inspected output of the `paths` property:\n+The following example inspects all properties of the `util` object:\n \n ```js\n const util = require('util');\n \n-console.log(util.inspect(module, { depth: 0 }));\n-// Instead of showing all entries in `paths` `[Array]` is used to limit the\n-// output for readability:\n-\n-// Module {\n-//   id: '<repl>',\n-//   exports: {},\n-//   parent: undefined,\n-//   filename: null,\n-//   loaded: false,\n-//   children: [],\n-//   paths: [Array] }\n+console.log(util.inspect(util, { showHidden: true, depth: null }));\n ```\n \n The following example highlights the difference with the `compact` option:\n@@ -510,7 +499,7 @@ const o = {\n     'foo']], 4],\n   b: new Map([['za', 1], ['zb', 'test']])\n };\n-console.log(util.inspect(o, { compact: true, breakLength: 80 }));\n+console.log(util.inspect(o, { compact: true, depth: 5, breakLength: 80 }));\n \n // This will print\n \n@@ -524,7 +513,7 @@ console.log(util.inspect(o, { compact: true, breakLength: 80 }));\n //   b: Map { 'za' => 1, 'zb' => 'test' } }\n \n // Setting `compact` to false changes the output to be more reader friendly.\n-console.log(util.inspect(o, { compact: false, breakLength: 80 }));\n+console.log(util.inspect(o, { compact: false, depth: 5, breakLength: 80 }));\n \n // {\n //   a: ["
        },
        {
            "sha": "c3cad0e2f49d1804c92c794cba4d8e854565cd41",
            "filename": "lib/internal/util/inspect.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/7082c61e27142c1c4c55ab925baa8a162637b066/lib%2Finternal%2Futil%2Finspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/7082c61e27142c1c4c55ab925baa8a162637b066/lib%2Finternal%2Futil%2Finspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspect.js?ref=7082c61e27142c1c4c55ab925baa8a162637b066",
            "patch": "@@ -92,7 +92,7 @@ const hasOwnProperty = uncurryThis(Object.prototype.hasOwnProperty);\n \n const inspectDefaultOptions = Object.seal({\n   showHidden: false,\n-  depth: 20,\n+  depth: 2,\n   colors: false,\n   customInspect: true,\n   showProxy: false,"
        },
        {
            "sha": "cd341978cb6f71e9eca439ddc69f2f6e70f4a111",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/7082c61e27142c1c4c55ab925baa8a162637b066/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/7082c61e27142c1c4c55ab925baa8a162637b066/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=7082c61e27142c1c4c55ab925baa8a162637b066",
            "patch": "@@ -130,9 +130,8 @@ function hasOwnProperty(obj, prop) {\n // and it can be overridden by custom print functions, such as `probe` or\n // `eyes.js`.\n const writer = exports.writer = (obj) => util.inspect(obj, writer.options);\n-writer.options = Object.assign({},\n-                               util.inspect.defaultOptions,\n-                               { showProxy: true, depth: 2 });\n+writer.options =\n+    Object.assign({}, util.inspect.defaultOptions, { showProxy: true });\n \n exports._builtinLibs = builtinLibs;\n "
        },
        {
            "sha": "d7728d1171caa3624d25a1e9e7b3f3fedd3ccb1d",
            "filename": "test/parallel/test-stream-buffer-list.js",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/7082c61e27142c1c4c55ab925baa8a162637b066/test%2Fparallel%2Ftest-stream-buffer-list.js",
            "raw_url": "https://github.com/nodejs/node/raw/7082c61e27142c1c4c55ab925baa8a162637b066/test%2Fparallel%2Ftest-stream-buffer-list.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-buffer-list.js?ref=7082c61e27142c1c4c55ab925baa8a162637b066",
            "patch": "@@ -3,7 +3,6 @@\n require('../common');\n const assert = require('assert');\n const BufferList = require('internal/streams/buffer_list');\n-const util = require('util');\n \n // Test empty buffer list.\n const emptyList = new BufferList();\n@@ -31,11 +30,3 @@ assert.strictEqual(list.join(','), 'foo');\n const shifted = list.shift();\n assert.strictEqual(shifted, buf);\n assert.deepStrictEqual(list, new BufferList());\n-\n-const tmp = util.inspect.defaultOptions.colors;\n-util.inspect.defaultOptions = { colors: true };\n-assert.strictEqual(\n-  util.inspect(list),\n-  'BufferList { head: \\u001b[1mnull\\u001b[22m, tail: \\u001b[1mnull\\u001b[22m,' +\n-  ' length: \\u001b[33m0\\u001b[39m }');\n-util.inspect.defaultOptions = { colors: tmp };"
        },
        {
            "sha": "b3438a625240a26f49432a1185a0018419c1541e",
            "filename": "test/parallel/test-util-inspect-proxy.js",
            "status": "modified",
            "additions": 6,
            "deletions": 10,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/7082c61e27142c1c4c55ab925baa8a162637b066/test%2Fparallel%2Ftest-util-inspect-proxy.js",
            "raw_url": "https://github.com/nodejs/node/raw/7082c61e27142c1c4c55ab925baa8a162637b066/test%2Fparallel%2Ftest-util-inspect-proxy.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect-proxy.js?ref=7082c61e27142c1c4c55ab925baa8a162637b066",
            "patch": "@@ -50,17 +50,13 @@ const expected1 = 'Proxy [ {}, {} ]';\n const expected2 = 'Proxy [ Proxy [ {}, {} ], {} ]';\n const expected3 = 'Proxy [ Proxy [ Proxy [ {}, {} ], {} ], Proxy [ {}, {} ] ]';\n const expected4 = 'Proxy [ Proxy [ {}, {} ], Proxy [ Proxy [ {}, {} ], {} ] ]';\n-const expected5 = 'Proxy [ Proxy [ Proxy [ Proxy [ {}, {} ], {} ],' +\n+const expected5 = 'Proxy [ Proxy [ Proxy [ Proxy [Array], {} ],' +\n                   ' Proxy [ {}, {} ] ],\\n  Proxy [ Proxy [ {}, {} ]' +\n-                  ', Proxy [ Proxy [ {}, {} ], {} ] ] ]';\n-const expected6 = 'Proxy [ Proxy [ Proxy [ Proxy [ Proxy [ {}, {} ], {} ], ' +\n-                    'Proxy [ {}, {} ] ],\\n' +\n-                  '    Proxy [ Proxy [ {}, {} ], ' +\n-                    'Proxy [ Proxy [ {}, {} ], {} ] ] ],\\n' +\n-                  '  Proxy [ Proxy [ Proxy [ Proxy [ {}, {} ], {} ], ' +\n-                    'Proxy [ {}, {} ] ],\\n' +\n-                  '    Proxy [ Proxy [ {}, {} ], ' +\n-                    'Proxy [ Proxy [ {}, {} ], {} ] ] ] ]';\n+                  ', Proxy [ Proxy [Array], {} ] ] ]';\n+const expected6 = 'Proxy [ Proxy [ Proxy [ Proxy [Array], Proxy [Array]' +\n+                  ' ],\\n    Proxy [ Proxy [Array], Proxy [Array] ] ],\\n' +\n+                  '  Proxy [ Proxy [ Proxy [Array], Proxy [Array] ],\\n' +\n+                  '    Proxy [ Proxy [Array], Proxy [Array] ] ] ]';\n assert.strictEqual(\n   util.inspect(proxy1, { showProxy: true, depth: null }),\n   expected1);"
        },
        {
            "sha": "c0fc3219ce736feda2d1c0ee719ba407784483e8",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 13,
            "deletions": 21,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/7082c61e27142c1c4c55ab925baa8a162637b066/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/7082c61e27142c1c4c55ab925baa8a162637b066/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=7082c61e27142c1c4c55ab925baa8a162637b066",
            "patch": "@@ -71,7 +71,7 @@ assert.strictEqual(util.inspect({ a: 1, b: 2 }), '{ a: 1, b: 2 }');\n assert.strictEqual(util.inspect({ 'a': {} }), '{ a: {} }');\n assert.strictEqual(util.inspect({ 'a': { 'b': 2 } }), '{ a: { b: 2 } }');\n assert.strictEqual(util.inspect({ 'a': { 'b': { 'c': { 'd': 2 } } } }),\n-                   '{ a: { b: { c: { d: 2 } } } }');\n+                   '{ a: { b: { c: [Object] } } }');\n assert.strictEqual(\n   util.inspect({ 'a': { 'b': { 'c': { 'd': 2 } } } }, false, null),\n   '{ a: { b: { c: { d: 2 } } } }');\n@@ -110,7 +110,7 @@ assert.strictEqual(util.inspect((new JSStream())._externalStream),\n   assert.strictEqual(util.inspect({ a: regexp }, false, 0), '{ a: /regexp/ }');\n }\n \n-assert(!/Object/.test(\n+assert(/Object/.test(\n   util.inspect({ a: { a: { a: { a: {} } } } }, undefined, undefined, true)\n ));\n assert(!/Object/.test(\n@@ -1055,15 +1055,15 @@ if (typeof Symbol !== 'undefined') {\n // Empty and circular before depth.\n {\n   const arr = [[[[]]]];\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [] ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ [] ] ] ]');\n   arr[0][0][0][0] = [];\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [Array] ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ [Array] ] ] ]');\n   arr[0][0][0] = {};\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ {} ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ {} ] ] ]');\n   arr[0][0][0] = { a: 2 };\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [Object] ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ [Object] ] ] ]');\n   arr[0][0][0] = arr;\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [Circular] ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ [Circular] ] ] ]');\n }\n \n // Corner cases.\n@@ -1160,10 +1160,10 @@ if (typeof Symbol !== 'undefined') {\n   assert(!/1 more item/.test(util.inspect(arr)));\n   util.inspect.defaultOptions.maxArrayLength = oldOptions.maxArrayLength;\n   assert(/1 more item/.test(util.inspect(arr)));\n-  util.inspect.defaultOptions.depth = 2;\n-  assert(/Object/.test(util.inspect(obj)));\n-  util.inspect.defaultOptions.depth = oldOptions.depth;\n+  util.inspect.defaultOptions.depth = null;\n   assert(!/Object/.test(util.inspect(obj)));\n+  util.inspect.defaultOptions.depth = oldOptions.depth;\n+  assert(/Object/.test(util.inspect(obj)));\n   assert.strictEqual(\n     JSON.stringify(util.inspect.defaultOptions),\n     JSON.stringify(oldOptions)\n@@ -1175,7 +1175,7 @@ if (typeof Symbol !== 'undefined') {\n   assert(/Object/.test(util.inspect(obj)));\n   util.inspect.defaultOptions = oldOptions;\n   assert(/1 more item/.test(util.inspect(arr)));\n-  assert(!/Object/.test(util.inspect(obj)));\n+  assert(/Object/.test(util.inspect(obj)));\n   assert.strictEqual(\n     JSON.stringify(util.inspect.defaultOptions),\n     JSON.stringify(oldOptions)\n@@ -1561,19 +1561,11 @@ util.inspect(process);\n   let head = list;\n   // A linked list of length 100k should be inspectable in some way, even though\n   // the real cutoff value is much lower than 100k.\n-  for (let i = 0; i < 100000; i++) {\n+  for (let i = 0; i < 100000; i++)\n     head = head.next = {};\n-  }\n-\n-  const res = Array(15)\n-    .fill(0)\n-    .map((_, i) => `{ next:\\n${'   '.repeat(i + 1)}`)\n-    .join('') +\n-    '{ next: { next: { next: { next: { next: { next:' +\n-    ' [Object] } } } } } } } } } } } } } } } } } } } } }';\n   assert.strictEqual(\n     util.inspect(list),\n-    res\n+    '{ next: { next: { next: [Object] } } }'\n   );\n   const longList = util.inspect(list, { depth: Infinity });\n   const match = longList.match(/next/g);"
        }
    ],
    "stats": {
        "total": 89,
        "additions": 28,
        "deletions": 61
    }
}