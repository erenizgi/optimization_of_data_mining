{
    "author": "BridgeAR",
    "message": "repl: make console, module and require non-enumerable\n\nThis aligns these globals with the regular context.\n\nPR-URL: https://github.com/nodejs/node/pull/20717\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "f954aba39ee02193beb2dbddc6c0ea0edcca7c74",
    "files": [
        {
            "sha": "9935d60fa73e032268ed7e4605b5bbe5c42221dc",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=f954aba39ee02193beb2dbddc6c0ea0edcca7c74",
            "patch": "@@ -793,7 +793,7 @@ REPLServer.prototype.createContext = function() {\n     const _console = new Console(this.outputStream);\n     Object.defineProperty(context, 'console', {\n       configurable: true,\n-      enumerable: true,\n+      writable: true,\n       value: _console\n     });\n \n@@ -813,9 +813,16 @@ REPLServer.prototype.createContext = function() {\n   module.paths =\n     CJSModule._resolveLookupPaths('<repl>', parentModule, true) || [];\n \n-  var require = makeRequireFunction(module);\n-  context.module = module;\n-  context.require = require;\n+  Object.defineProperty(context, 'module', {\n+    configurable: true,\n+    writable: true,\n+    value: module\n+  });\n+  Object.defineProperty(context, 'require', {\n+    configurable: true,\n+    writable: true,\n+    value: makeRequireFunction(module)\n+  });\n \n   addBuiltinLibsToObject(context);\n "
        },
        {
            "sha": "94547e4768bb761c49d73f5025eac389d35c0159",
            "filename": "test/parallel/test-repl-console.js",
            "status": "removed",
            "additions": 0,
            "deletions": 44,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/cbee12c70160ec4d123194668451c908faf446bd/test%2Fparallel%2Ftest-repl-console.js",
            "raw_url": "https://github.com/nodejs/node/raw/cbee12c70160ec4d123194668451c908faf446bd/test%2Fparallel%2Ftest-repl-console.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-console.js?ref=cbee12c70160ec4d123194668451c908faf446bd",
            "patch": "@@ -1,44 +0,0 @@\n-// Copyright Joyent, Inc. and other Node contributors.\n-//\n-// Permission is hereby granted, free of charge, to any person obtaining a\n-// copy of this software and associated documentation files (the\n-// \"Software\"), to deal in the Software without restriction, including\n-// without limitation the rights to use, copy, modify, merge, publish,\n-// distribute, sublicense, and/or sell copies of the Software, and to permit\n-// persons to whom the Software is furnished to do so, subject to the\n-// following conditions:\n-//\n-// The above copyright notice and this permission notice shall be included\n-// in all copies or substantial portions of the Software.\n-//\n-// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n-// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n-// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n-// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n-// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n-// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n-// USE OR OTHER DEALINGS IN THE SOFTWARE.\n-\n-'use strict';\n-const common = require('../common');\n-const assert = require('assert');\n-const repl = require('repl');\n-\n-// Create a dummy stream that does nothing\n-const stream = new common.ArrayStream();\n-\n-const r = repl.start({\n-  input: stream,\n-  output: stream,\n-  useGlobal: false\n-});\n-\n-\n-// ensure that the repl context gets its own \"console\" instance\n-assert(r.context.console);\n-\n-// ensure that the repl console instance is not the global one\n-assert.notStrictEqual(r.context.console, console);\n-\n-// ensure that the repl console instance does not have a setter\n-assert.throws(() => r.context.console = 'foo', TypeError);"
        },
        {
            "sha": "914aa563bd50fb05fbd6b8d55a7da1cf2e4e3489",
            "filename": "test/parallel/test-repl-context.js",
            "status": "modified",
            "additions": 23,
            "deletions": 16,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-context.js",
            "raw_url": "https://github.com/nodejs/node/raw/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-context.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-context.js?ref=f954aba39ee02193beb2dbddc6c0ea0edcca7c74",
            "patch": "@@ -4,32 +4,39 @@ const assert = require('assert');\n const repl = require('repl');\n const vm = require('vm');\n \n-// Create a dummy stream that does nothing\n+// Create a dummy stream that does nothing.\n const stream = new common.ArrayStream();\n \n-// Test when useGlobal is false\n-testContext(repl.start({\n-  input: stream,\n-  output: stream,\n-  useGlobal: false\n-}));\n+// Test context when useGlobal is false.\n+{\n+  const r = repl.start({\n+    input: stream,\n+    output: stream,\n+    useGlobal: false\n+  });\n \n-function testContext(repl) {\n-  const context = repl.createContext();\n-  // ensure that the repl context gets its own \"console\" instance\n+  // Ensure that the repl context gets its own \"console\" instance.\n+  assert(r.context.console);\n+\n+  // Ensure that the repl console instance is not the global one.\n+  assert.notStrictEqual(r.context.console, console);\n+\n+  const context = r.createContext();\n+  // Ensure that the repl context gets its own \"console\" instance.\n   assert(context.console instanceof require('console').Console);\n \n-  // ensure that the repl's global property is the context\n+  // Ensure that the repl's global property is the context.\n   assert.strictEqual(context.global, context);\n \n-  // ensure that the repl console instance does not have a setter\n-  assert.throws(() => context.console = 'foo', TypeError);\n-  repl.close();\n+  // Ensure that the repl console instance is writable.\n+  context.console = 'foo';\n+  r.close();\n }\n \n-testContextSideEffects(repl.start({ input: stream, output: stream }));\n+// Test for context side effects.\n+{\n+  const server = repl.start({ input: stream, output: stream });\n \n-function testContextSideEffects(server) {\n   assert.ok(!server.underscoreAssigned);\n   assert.strictEqual(server.lines.length, 0);\n "
        },
        {
            "sha": "952fba4103cc265c5ccf7d137c2f4d1eabfa16be",
            "filename": "test/parallel/test-repl-function-definition-edge-case.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-function-definition-edge-case.js",
            "raw_url": "https://github.com/nodejs/node/raw/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-function-definition-edge-case.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-function-definition-edge-case.js?ref=f954aba39ee02193beb2dbddc6c0ea0edcca7c74",
            "patch": "@@ -1,12 +1,10 @@\n // Reference: https://github.com/nodejs/node/pull/7624\n 'use strict';\n-const common = require('../common');\n+require('../common');\n const assert = require('assert');\n const repl = require('repl');\n const stream = require('stream');\n \n-common.globalCheck = false;\n-\n const r = initRepl();\n \n r.input.emit('data', 'function a() { return 42; } (1)\\n');"
        },
        {
            "sha": "dd8fa60f463d8b03bf76c988141a90140c15475d",
            "filename": "test/parallel/test-repl-let-process.js",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-let-process.js",
            "raw_url": "https://github.com/nodejs/node/raw/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-let-process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-let-process.js?ref=f954aba39ee02193beb2dbddc6c0ea0edcca7c74",
            "patch": "@@ -2,8 +2,6 @@\n const common = require('../common');\n const repl = require('repl');\n \n-common.globalCheck = false;\n-\n // Regression test for https://github.com/nodejs/node/issues/6802\n const input = new common.ArrayStream();\n repl.start({ input, output: process.stdout, useGlobal: true });"
        },
        {
            "sha": "df84d86a3c8dc3f5fb9fe6cd3eef09833c3ab12a",
            "filename": "test/parallel/test-repl-mode.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-mode.js",
            "raw_url": "https://github.com/nodejs/node/raw/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-mode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-mode.js?ref=f954aba39ee02193beb2dbddc6c0ea0edcca7c74",
            "patch": "@@ -1,11 +1,9 @@\n 'use strict';\n-const common = require('../common');\n+require('../common');\n const assert = require('assert');\n const Stream = require('stream');\n const repl = require('repl');\n \n-common.globalCheck = false;\n-\n const tests = [\n   testSloppyMode,\n   testStrictMode,"
        },
        {
            "sha": "1de49c8e861391cf1a8c5a9642f1048c3b5d854d",
            "filename": "test/parallel/test-repl-options.js",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-options.js",
            "raw_url": "https://github.com/nodejs/node/raw/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-options.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-options.js?ref=f954aba39ee02193beb2dbddc6c0ea0edcca7c74",
            "patch": "@@ -24,8 +24,6 @@ const common = require('../common');\n const assert = require('assert');\n const repl = require('repl');\n \n-common.globalCheck = false;\n-\n // Create a dummy stream that does nothing\n const stream = new common.ArrayStream();\n "
        },
        {
            "sha": "4b3a04aeeb88c5fe6eaccf9b39b0b18bb66359cc",
            "filename": "test/parallel/test-repl-reset-event.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-reset-event.js",
            "raw_url": "https://github.com/nodejs/node/raw/f954aba39ee02193beb2dbddc6c0ea0edcca7c74/test%2Fparallel%2Ftest-repl-reset-event.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-reset-event.js?ref=f954aba39ee02193beb2dbddc6c0ea0edcca7c74",
            "patch": "@@ -21,7 +21,6 @@\n \n 'use strict';\n const common = require('../common');\n-common.globalCheck = false;\n \n const assert = require('assert');\n const repl = require('repl');"
        }
    ],
    "stats": {
        "total": 111,
        "additions": 36,
        "deletions": 75
    }
}