{
    "author": "shigeki",
    "message": "deps: fix MacOS and Win build for OpenSSL-1.1.1\n\nBecause llvm on MacOS does not support AVX-512, asm files need to be limited to\nAVX-2 support even when they are generated on Linux.  fake_gcc.pl returns the\nfake llvm banner version for MacOS as if the assembler supports upto AVX-2.\n\nFor Windows, makefiles for nmake were updated in OpenSSL-1.1.1 and they are\nrewritten into GNU makefile format by hand.\n\nPR-URL: https://github.com/nodejs/node/pull/25381\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Shigeki Ohtsu <ohtsu@ohtsu.org>",
    "sha": "bff1348cfc7f386b9084219dd452b95a2a24be95",
    "files": [
        {
            "sha": "a86f392ef23acea51db4d3fa31be07f679aa55b7",
            "filename": "deps/openssl/config/Makefile",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2FMakefile",
            "raw_url": "https://github.com/nodejs/node/raw/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2FMakefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2FMakefile?ref=bff1348cfc7f386b9084219dd452b95a2a24be95",
            "patch": "@@ -15,6 +15,7 @@ linux-armv4 linux-elf linux-x32 linux-x86_64 linux-ppc \\\n linux-ppc64 linux-ppc64le linux32-s390x linux64-s390x \\\n solaris-x86-gcc solaris64-x86_64-gcc VC-WIN64A VC-WIN32\n \n+CC = gcc\n CONFIGURE = ./Configure\n # no-comp: against CRIME attack\n # no-shared: openssl-cli needs static link\n@@ -44,8 +45,11 @@ all: $(ARCHS) replace\n $(ARCHS):\n # Remove openssl .gitignore to follow nodejs .gitignore\n \tif [ -e $(GITIGNORE) ]; then rm $(GITIGNORE); fi\n-# Confgure asm and generate asm sources\n-\tcd $(OPSSL_SRC); $(NO_WARN_ENV) $(PERL) $(CONFIGURE) $(COPTS) $@;\n+\tif [ \"$(findstring darwin, $@)\" = \"\" ]; then \\\n+\t  cd $(OPSSL_SRC); $(NO_WARN_ENV) ARC=$@ CC=$(CC) $(PERL) $(CONFIGURE) $(COPTS) $@; \\\n+\telse \\\n+\t  cd $(OPSSL_SRC); $(NO_WARN_ENV) ARC=$@ CC=./fake_gcc.pl $(PERL) $(CONFIGURE) $(COPTS) $@; \\\n+\tfi\n \t$(PERL) -w -I$(OPSSL_SRC) $(GENERATE) asm $@\n # Confgure no-asm and generate no-asm sources\n \tcd $(OPSSL_SRC); $(NO_WARN_ENV) $(PERL) $(CONFIGURE) $(COPTS) \\\n@@ -61,4 +65,4 @@ replace:\n \n clean:\n \tfind archs \\( -name \\*.S -o -name \\*.s -o -name \\*.asm -o \\\n-\t-name \\*.gypi -o -name \\*.h -o -name \\*.pm \\) -exec rm \"{}\" \\;\n+\t-name \\*.gypi -o -name \\*.h -o -name \\*.pm -o -name \\*.rc \\) -exec rm \"{}\" \\;"
        },
        {
            "sha": "f7debe2383303642f58899189f6368912794672f",
            "filename": "deps/openssl/config/Makefile_VC-WIN32",
            "status": "modified",
            "additions": 5609,
            "deletions": 1261,
            "changes": 6870,
            "blob_url": "https://github.com/nodejs/node/blob/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2FMakefile_VC-WIN32",
            "raw_url": "https://github.com/nodejs/node/raw/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2FMakefile_VC-WIN32",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2FMakefile_VC-WIN32?ref=bff1348cfc7f386b9084219dd452b95a2a24be95"
        },
        {
            "sha": "fa66acfd517dfb6365e0fd8cccefe4437b430ac4",
            "filename": "deps/openssl/config/Makefile_VC-WIN64A",
            "status": "modified",
            "additions": 2902,
            "deletions": 1311,
            "changes": 4213,
            "blob_url": "https://github.com/nodejs/node/blob/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2FMakefile_VC-WIN64A",
            "raw_url": "https://github.com/nodejs/node/raw/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2FMakefile_VC-WIN64A",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2FMakefile_VC-WIN64A?ref=bff1348cfc7f386b9084219dd452b95a2a24be95"
        },
        {
            "sha": "aa9f9774499ead4b2b7710775e3cc91d1c0f93c4",
            "filename": "deps/openssl/config/fake_gcc.pl",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2Ffake_gcc.pl",
            "raw_url": "https://github.com/nodejs/node/raw/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2Ffake_gcc.pl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2Ffake_gcc.pl?ref=bff1348cfc7f386b9084219dd452b95a2a24be95",
            "patch": "@@ -0,0 +1,11 @@\n+#! /usr/bin/env perl\n+use 5.10.0;\n+use strict;\n+my $arch = $ENV{ARC};\n+my $ret;\n+if ($arch =~ /^darwin/) {\n+  $ret = \"Apple LLVM version 10.0.0 (clang-1000.11.45.2)\\n\";\n+} else {\n+  $ret = `gcc -Wa,-v -c -o /dev/null -x assembler /dev/null 2>&1`;\n+}\n+print STDOUT $ret;"
        },
        {
            "sha": "813bd28a86a3f40a5202ea999ed5019f8a3fa054",
            "filename": "deps/openssl/config/generate_gypi.pl",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2Fgenerate_gypi.pl",
            "raw_url": "https://github.com/nodejs/node/raw/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2Fgenerate_gypi.pl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2Fgenerate_gypi.pl?ref=bff1348cfc7f386b9084219dd452b95a2a24be95",
            "patch": "@@ -155,6 +155,7 @@\n         libapps_srcs => \\@libapps_srcs,\n         config => \\%config,\n         target => \\%target,\n+        asm => \\$asm,\n         arch => \\$arch,\n         lib_cppflags => \\@lib_cppflags,\n         is_win => \\$is_win,"
        },
        {
            "sha": "44361ce165e163e1c781546ef7e6482d1efc8e69",
            "filename": "deps/openssl/config/openssl-cl.gypi.tmpl",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2Fopenssl-cl.gypi.tmpl",
            "raw_url": "https://github.com/nodejs/node/raw/bff1348cfc7f386b9084219dd452b95a2a24be95/deps%2Fopenssl%2Fconfig%2Fopenssl-cl.gypi.tmpl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2Fopenssl-cl.gypi.tmpl?ref=bff1348cfc7f386b9084219dd452b95a2a24be95",
            "patch": "@@ -28,7 +28,9 @@\n     ],\n     'openssl_cli_srcs_%%-$arch-%%': [\n %%- foreach $src (@apps_openssl_srcs) {\n-  $OUT .= \"      'openssl/$src',\\n\";\n+  unless ($src eq \"apps/openssl.rc\") {\n+    $OUT .= \"      'openssl/$src',\\n\";\n+  }\n }\n foreach $src (@libapps_srcs) {\n   $OUT .= \"      'openssl/$src',\\n\";"
        }
    ],
    "stats": {
        "total": 11109,
        "additions": 8533,
        "deletions": 2576
    }
}