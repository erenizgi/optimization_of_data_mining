{
    "author": "joyeecheung",
    "message": "test: test about:blank against invalid WHATWG URL\n\n> If `failure` is true, parsing `about:blank` against `base`\n> must give failure. This tests that the logic for converting\n> base URLs into strings properly fails the whole parsing\n> algorithm if the base URL cannot be parsed.\n\nFixes: https://github.com/nodejs/node/issues/20720\n\nPR-URL: https://github.com/nodejs/node/pull/20796\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Daijiro Wachi <daijiro.wachi@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "a5aad244b1fa3a00010eb60e934ce2cd56492f39",
    "files": [
        {
            "sha": "48533ed09073db857d3d5e09ead6922d63823172",
            "filename": "test/fixtures/url-tests.js",
            "status": "modified",
            "additions": 15,
            "deletions": 13,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/a5aad244b1fa3a00010eb60e934ce2cd56492f39/test%2Ffixtures%2Furl-tests.js",
            "raw_url": "https://github.com/nodejs/node/raw/a5aad244b1fa3a00010eb60e934ce2cd56492f39/test%2Ffixtures%2Furl-tests.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Furl-tests.js?ref=a5aad244b1fa3a00010eb60e934ce2cd56492f39",
            "patch": "@@ -2,7 +2,7 @@\n \n /* The following tests are copied from WPT. Modifications to them should be\n    upstreamed first. Refs:\n-   https://github.com/w3c/web-platform-tests/blob/ed4bb727ed/url/urltestdata.json\n+   https://github.com/w3c/web-platform-tests/blob/88b75886e/url/urltestdata.json\n    License: http://www.w3.org/Consortium/Legal/2008/04-testsuite-copyright.html\n */\n module.exports =\n@@ -6529,27 +6529,34 @@ module.exports =\n     \"search\": \"?a\",\n     \"hash\": \"#%GH\"\n   },\n-  \"Bad bases\",\n+  \"URLs that require a non-about:blank base. (Also serve as invalid base tests.)\",\n   {\n-    \"input\": \"test-a.html\",\n-    \"base\": \"a\",\n+    \"input\": \"a\",\n+    \"base\": \"about:blank\",\n     \"failure\": true\n   },\n   {\n-    \"input\": \"test-a-slash.html\",\n-    \"base\": \"a/\",\n+    \"input\": \"a/\",\n+    \"base\": \"about:blank\",\n     \"failure\": true\n   },\n   {\n-    \"input\": \"test-a-slash-slash.html\",\n-    \"base\": \"a//\",\n+    \"input\": \"a//\",\n+    \"base\": \"about:blank\",\n     \"failure\": true\n   },\n+  \"Bases that don't fail to parse but fail to be bases\",\n   {\n     \"input\": \"test-a-colon.html\",\n     \"base\": \"a:\",\n     \"failure\": true\n   },\n+  {\n+    \"input\": \"test-a-colon-b.html\",\n+    \"base\": \"a:b\",\n+    \"failure\": true\n+  },\n+  \"Other base URL tests, that must succeed\",\n   {\n     \"input\": \"test-a-colon-slash.html\",\n     \"base\": \"a:/\",\n@@ -6578,11 +6585,6 @@ module.exports =\n     \"search\": \"\",\n     \"hash\": \"\"\n   },\n-  {\n-    \"input\": \"test-a-colon-b.html\",\n-    \"base\": \"a:b\",\n-    \"failure\": true\n-  },\n   {\n     \"input\": \"test-a-colon-slash-b.html\",\n     \"base\": \"a:/b\","
        },
        {
            "sha": "fd8570eb720831473ee5f522d958c21efdbfa991",
            "filename": "test/parallel/test-whatwg-url-parsing.js",
            "status": "modified",
            "additions": 21,
            "deletions": 2,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/a5aad244b1fa3a00010eb60e934ce2cd56492f39/test%2Fparallel%2Ftest-whatwg-url-parsing.js",
            "raw_url": "https://github.com/nodejs/node/raw/a5aad244b1fa3a00010eb60e934ce2cd56492f39/test%2Fparallel%2Ftest-whatwg-url-parsing.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-url-parsing.js?ref=a5aad244b1fa3a00010eb60e934ce2cd56492f39",
            "patch": "@@ -12,7 +12,10 @@ const fixtures = require('../common/fixtures');\n \n // Tests below are not from WPT.\n const tests = require(fixtures.path('url-tests'));\n-const failureTests = tests.filter((test) => test.failure).concat([\n+\n+const originalFailures = tests.filter((test) => test.failure);\n+\n+const typeFailures = [\n   { input: '' },\n   { input: 'test' },\n   { input: undefined },\n@@ -25,7 +28,23 @@ const failureTests = tests.filter((test) => test.failure).concat([\n   { input: 'test', base: null },\n   { input: 'http://nodejs.org', base: null },\n   { input: () => {} }\n-]);\n+];\n+\n+// See https://github.com/w3c/web-platform-tests/pull/10955\n+// > If `failure` is true, parsing `about:blank` against `base`\n+// > must give failure. This tests that the logic for converting\n+// > base URLs into strings properly fails the whole parsing\n+// > algorithm if the base URL cannot be parsed.\n+const aboutBlankFailures = originalFailures\n+  .map((test) => ({\n+    input: 'about:blank',\n+    base: test.input,\n+    failure: true\n+  }));\n+\n+const failureTests = originalFailures\n+  .concat(typeFailures)\n+  .concat(aboutBlankFailures);\n \n const expectedError = common.expectsError(\n   { code: 'ERR_INVALID_URL', type: TypeError }, failureTests.length);"
        }
    ],
    "stats": {
        "total": 51,
        "additions": 36,
        "deletions": 15
    }
}