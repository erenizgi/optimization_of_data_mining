{
    "author": "rvagg",
    "message": "build: make tar.xz creation opt-out, fail if no xz\n\nPR-URL: https://github.com/nodejs/node/pull/24551\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "5e80a9a160a439e64f12353712a33ea9d5adddbf",
    "files": [
        {
            "sha": "803a1f96e71a4cd6a48604ab867212d235b88c42",
            "filename": "Makefile",
            "status": "modified",
            "additions": 24,
            "deletions": 8,
            "changes": 32,
            "blob_url": "https://github.com/nodejs/node/blob/5e80a9a160a439e64f12353712a33ea9d5adddbf/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/5e80a9a160a439e64f12353712a33ea9d5adddbf/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=5e80a9a160a439e64f12353712a33ea9d5adddbf",
            "patch": "@@ -851,13 +851,29 @@ BINARYNAME=$(TARNAME)-$(PLATFORM)-$(ARCH)\n endif\n BINARYTAR=$(BINARYNAME).tar\n # OSX doesn't have xz installed by default, http://macpkg.sourceforge.net/\n-XZ=$(shell which xz > /dev/null 2>&1; echo $$?)\n+HAS_XZ ?= $(shell which xz > /dev/null 2>&1; [[ $$? = 0 ]] && echo 1 || echo 0)\n+# Supply SKIP_XZ=1 to explicitly skip .tar.xz creation\n+SKIP_XZ ?= 0\n+XZ = $(shell [[ $(HAS_XZ) = 1 && $(SKIP_XZ) = 0 ]] && echo 1 || echo 0)\n XZ_COMPRESSION ?= 9e\n PKG=$(TARNAME).pkg\n MACOSOUTDIR=out/macos\n \n+ifeq ($(SKIP_XZ), 1)\n+check-xz:\n+\t@echo \"SKIP_XZ=1 supplied, skipping .tar.xz creation\"\n+else\n+ifeq ($(HAS_XZ), 1)\n+check-xz:\n+else\n+check-xz:\n+\t@echo \"No xz command, cannot continue\"\n+\t@exit 1\n+endif\n+endif\n+\n .PHONY: release-only\n-release-only:\n+release-only: check-xz\n \t@if [ \"$(DISTTYPE)\" = \"release\" ] && `grep -q REPLACEME doc/api/*.md`; then \\\n \t\techo 'Please update REPLACEME in Added: tags in doc/api/*.md (See doc/releases.md)' ; \\\n \t\texit 1 ; \\\n@@ -983,7 +999,7 @@ $(TARBALL): release-only $(NODE_EXE) doc\n \ttar -cf $(TARNAME).tar $(TARNAME)\n \t$(RM) -r $(TARNAME)\n \tgzip -c -f -9 $(TARNAME).tar > $(TARNAME).tar.gz\n-ifeq ($(XZ), 0)\n+ifeq ($(XZ), 1)\n \txz -c -f -$(XZ_COMPRESSION) $(TARNAME).tar > $(TARNAME).tar.xz\n endif\n \t$(RM) $(TARNAME).tar\n@@ -997,7 +1013,7 @@ tar-upload: tar\n \tchmod 664 $(TARNAME).tar.gz\n \tscp -p $(TARNAME).tar.gz $(STAGINGSERVER):nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME).tar.gz\n \tssh $(STAGINGSERVER) \"touch nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME).tar.gz.done\"\n-ifeq ($(XZ), 0)\n+ifeq ($(XZ), 1)\n \tchmod 664 $(TARNAME).tar.xz\n \tscp -p $(TARNAME).tar.xz $(STAGINGSERVER):nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME).tar.xz\n \tssh $(STAGINGSERVER) \"touch nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME).tar.xz.done\"\n@@ -1023,7 +1039,7 @@ $(TARBALL)-headers: release-only\n \ttar -cf $(TARNAME)-headers.tar $(TARNAME)\n \t$(RM) -r $(TARNAME)\n \tgzip -c -f -9 $(TARNAME)-headers.tar > $(TARNAME)-headers.tar.gz\n-ifeq ($(XZ), 0)\n+ifeq ($(XZ), 1)\n \txz -c -f -$(XZ_COMPRESSION) $(TARNAME)-headers.tar > $(TARNAME)-headers.tar.xz\n endif\n \t$(RM) $(TARNAME)-headers.tar\n@@ -1035,7 +1051,7 @@ tar-headers-upload: tar-headers\n \tchmod 664 $(TARNAME)-headers.tar.gz\n \tscp -p $(TARNAME)-headers.tar.gz $(STAGINGSERVER):nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME)-headers.tar.gz\n \tssh $(STAGINGSERVER) \"touch nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME)-headers.tar.gz.done\"\n-ifeq ($(XZ), 0)\n+ifeq ($(XZ), 1)\n \tchmod 664 $(TARNAME)-headers.tar.xz\n \tscp -p $(TARNAME)-headers.tar.xz $(STAGINGSERVER):nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME)-headers.tar.xz\n \tssh $(STAGINGSERVER) \"touch nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME)-headers.tar.xz.done\"\n@@ -1060,7 +1076,7 @@ endif\n \ttar -cf $(BINARYNAME).tar $(BINARYNAME)\n \t$(RM) -r $(BINARYNAME)\n \tgzip -c -f -9 $(BINARYNAME).tar > $(BINARYNAME).tar.gz\n-ifeq ($(XZ), 0)\n+ifeq ($(XZ), 1)\n \txz -c -f -$(XZ_COMPRESSION) $(BINARYNAME).tar > $(BINARYNAME).tar.xz\n endif\n \t$(RM) $(BINARYNAME).tar\n@@ -1075,7 +1091,7 @@ binary-upload: binary\n \tchmod 664 $(TARNAME)-$(OSTYPE)-$(ARCH).tar.gz\n \tscp -p $(TARNAME)-$(OSTYPE)-$(ARCH).tar.gz $(STAGINGSERVER):nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME)-$(OSTYPE)-$(ARCH).tar.gz\n \tssh $(STAGINGSERVER) \"touch nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME)-$(OSTYPE)-$(ARCH).tar.gz.done\"\n-ifeq ($(XZ), 0)\n+ifeq ($(XZ), 1)\n \tchmod 664 $(TARNAME)-$(OSTYPE)-$(ARCH).tar.xz\n \tscp -p $(TARNAME)-$(OSTYPE)-$(ARCH).tar.xz $(STAGINGSERVER):nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME)-$(OSTYPE)-$(ARCH).tar.xz\n \tssh $(STAGINGSERVER) \"touch nodejs/$(DISTTYPEDIR)/$(FULLVERSION)/$(TARNAME)-$(OSTYPE)-$(ARCH).tar.xz.done\""
        }
    ],
    "stats": {
        "total": 32,
        "additions": 24,
        "deletions": 8
    }
}