{
    "author": "julien-f",
    "message": "stream: fix error handling with async iteration\n\nFix an issue when an error was emitted by the stream before\n`iterator.next()` is called.\n\nPR-URL: https://github.com/nodejs/node/pull/20329\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>",
    "sha": "9c48926dba20a507968d4152fafa9d51d69cf970",
    "files": [
        {
            "sha": "0e34573d877aee44ffde142d99027800d8884594",
            "filename": "lib/internal/streams/async_iterator.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/9c48926dba20a507968d4152fafa9d51d69cf970/lib%2Finternal%2Fstreams%2Fasync_iterator.js",
            "raw_url": "https://github.com/nodejs/node/raw/9c48926dba20a507968d4152fafa9d51d69cf970/lib%2Finternal%2Fstreams%2Fasync_iterator.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fstreams%2Fasync_iterator.js?ref=9c48926dba20a507968d4152fafa9d51d69cf970",
            "patch": "@@ -58,7 +58,7 @@ function onError(iter, err) {\n     iter[kLastReject] = null;\n     reject(err);\n   }\n-  iter.error = err;\n+  iter[kError] = err;\n }\n \n function wrapForNext(lastPromise, iter) {"
        },
        {
            "sha": "39761b413260f1af3067c19583e999f9a6b744ad",
            "filename": "test/parallel/test-stream-readable-async-iterators.js",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/9c48926dba20a507968d4152fafa9d51d69cf970/test%2Fparallel%2Ftest-stream-readable-async-iterators.js",
            "raw_url": "https://github.com/nodejs/node/raw/9c48926dba20a507968d4152fafa9d51d69cf970/test%2Fparallel%2Ftest-stream-readable-async-iterators.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-readable-async-iterators.js?ref=9c48926dba20a507968d4152fafa9d51d69cf970",
            "patch": "@@ -115,6 +115,18 @@ async function tests() {\n     readable.destroy(new Error('kaboom'));\n   })();\n \n+  await (async function() {\n+    console.log('call next() after error');\n+    const readable = new Readable({\n+      read() {}\n+    });\n+    const iterator = readable[Symbol.asyncIterator]();\n+\n+    const err = new Error('kaboom');\n+    readable.destroy(new Error('kaboom'));\n+    await assert.rejects(iterator.next.bind(iterator), err);\n+  })();\n+\n   await (async function() {\n     console.log('read object mode');\n     const max = 42;"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 13,
        "deletions": 1
    }
}