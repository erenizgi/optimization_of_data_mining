{
    "author": "chrismilleruk",
    "message": "build: normalise test.py calls to use PARALLEL_ARGS\n\nPR-URL: https://github.com/nodejs/node/pull/20124\nFixes: https://github.com/nodejs/node/issues/20065\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "87868896565268bab9ba2788faa48d8977c8213d",
    "files": [
        {
            "sha": "f499788d9d86cc9b7a06c5f918ea1aea2ebd3a8c",
            "filename": "Makefile",
            "status": "modified",
            "additions": 23,
            "deletions": 21,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/87868896565268bab9ba2788faa48d8977c8213d/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/87868896565268bab9ba2788faa48d8977c8213d/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=87868896565268bab9ba2788faa48d8977c8213d",
            "patch": "@@ -18,6 +18,8 @@ PWD = $(CURDIR)\n \n ifdef JOBS\n   PARALLEL_ARGS = -j $(JOBS)\n+else\n+  PARALLEL_ARGS = -J\n endif\n \n ifdef ENABLE_V8_TAP\n@@ -232,7 +234,7 @@ v8:\n \n .PHONY: jstest\n jstest: build-addons build-addons-napi ## Runs addon tests and JS tests\n-\t$(PYTHON) tools/test.py --mode=release -J \\\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release \\\n \t\t$(CI_JS_SUITES) \\\n \t\t$(CI_NATIVE_SUITES)\n \n@@ -267,13 +269,13 @@ test-cov: all\n \t$(MAKE) lint\n \n test-parallel: all\n-\t$(PYTHON) tools/test.py --mode=release parallel -J\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release parallel\n \n test-valgrind: all\n-\t$(PYTHON) tools/test.py --mode=release --valgrind sequential parallel message\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release --valgrind sequential parallel message\n \n test-check-deopts: all\n-\t$(PYTHON) tools/test.py --mode=release --check-deopts parallel sequential -J\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release --check-deopts parallel sequential\n \n benchmark/misc/function_call/build/Release/binding.node: all \\\n \t\tbenchmark/misc/function_call/binding.cc \\\n@@ -396,7 +398,7 @@ clear-stalled:\n \n .PHONY: test-gc\n test-gc: all test/gc/build/Release/binding.node\n-\t$(PYTHON) tools/test.py --mode=release gc\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release gc\n \n .PHONY: test-gc-clean\n test-gc-clean:\n@@ -408,10 +410,10 @@ test-build-addons-napi: all build-addons-napi\n \n .PHONY: test-all\n test-all: test-build test/gc/build/Release/binding.node ## Run everything in test/.\n-\t$(PYTHON) tools/test.py --mode=debug,release\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=debug,release\n \n test-all-valgrind: test-build\n-\t$(PYTHON) tools/test.py --mode=debug,release --valgrind\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=debug,release --valgrind\n \n CI_NATIVE_SUITES ?= addons addons-napi\n CI_JS_SUITES ?= default\n@@ -473,29 +475,29 @@ run-ci: build-ci\n \t$(MAKE) test-ci\n \n test-release: test-build\n-\t$(PYTHON) tools/test.py --mode=release\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release\n \n test-debug: test-build\n-\t$(PYTHON) tools/test.py --mode=debug\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=debug\n \n test-message: test-build\n-\t$(PYTHON) tools/test.py message\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) message\n \n test-simple: | cctest  # Depends on 'all'.\n-\t$(PYTHON) tools/test.py parallel sequential\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) parallel sequential\n \n test-pummel: all\n-\t$(PYTHON) tools/test.py pummel\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) pummel\n \n test-internet: all\n-\t$(PYTHON) tools/test.py internet\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) internet\n \n test-node-inspect: $(NODE_EXE)\n \tUSE_EMBEDDED_NODE_INSPECT=1 $(NODE) tools/test-npm-package \\\n \t\t--install deps/node-inspect test\n \n test-tick-processor: all\n-\t$(PYTHON) tools/test.py tick-processor\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) tick-processor\n \n .PHONY: test-hash-seed\n # Verifies the hash seed used by V8 for hashing is random.\n@@ -505,10 +507,10 @@ test-hash-seed: all\n .PHONY: test-doc\n test-doc: doc-only ## Builds, lints, and verifies the docs.\n \t$(MAKE) lint\n-\t$(PYTHON) tools/test.py $(CI_DOC)\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) $(CI_DOC)\n \n test-known-issues: all\n-\t$(PYTHON) tools/test.py known_issues\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) known_issues\n \n # Related CI job: node-test-npm\n test-npm: $(NODE_EXE) ## Run the npm test suite on deps/npm.\n@@ -519,7 +521,7 @@ test-npm-publish: $(NODE_EXE)\n \n .PHONY: test-addons-napi\n test-addons-napi: test-build-addons-napi\n-\t$(PYTHON) tools/test.py --mode=release addons-napi\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release addons-napi\n \n .PHONY: test-addons-napi-clean\n test-addons-napi-clean:\n@@ -528,7 +530,7 @@ test-addons-napi-clean:\n \n .PHONY: test-addons\n test-addons: test-build test-addons-napi\n-\t$(PYTHON) tools/test.py --mode=release addons\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release addons\n \n .PHONY: test-addons-clean\n test-addons-clean:\n@@ -539,19 +541,19 @@ test-addons-clean:\n \n test-timers:\n \t$(MAKE) --directory=tools faketime\n-\t$(PYTHON) tools/test.py --mode=release timers\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release timers\n \n test-timers-clean:\n \t$(MAKE) --directory=tools clean\n \n test-async-hooks:\n-\t$(PYTHON) tools/test.py --mode=release async-hooks\n+\t$(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release async-hooks\n \n test-with-async-hooks:\n \t$(MAKE) build-addons\n \t$(MAKE) build-addons-napi\n \t$(MAKE) cctest\n-\tNODE_TEST_WITH_ASYNC_HOOKS=1 $(PYTHON) tools/test.py --mode=release -J \\\n+\tNODE_TEST_WITH_ASYNC_HOOKS=1 $(PYTHON) tools/test.py $(PARALLEL_ARGS) --mode=release \\\n \t\t$(CI_JS_SUITES) \\\n \t\t$(CI_NATIVE_SUITES)\n "
        }
    ],
    "stats": {
        "total": 44,
        "additions": 23,
        "deletions": 21
    }
}