{
    "author": "danbev",
    "message": "src: fix error message in async_hooks constructor\n\nThere are two minor issues in the AsyncHook constructor, if the object\npassed in has an after and/or destroy property that are not functions\nthe errors thrown will still be:\nTypeError [ERR_ASYNC_CALLBACK]: before must be a function\n\nThis commit updates the code and adds a unit test.\n\nPR-URL: https://github.com/nodejs/node/pull/19000\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matheus Marchini <matheus@sthima.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "f2defcac4dd10f018215e3db530bed1314ce2225",
    "files": [
        {
            "sha": "ae8dc939ce26ee504bae9ebd1755e5c5303e0482",
            "filename": "lib/async_hooks.js",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/f2defcac4dd10f018215e3db530bed1314ce2225/lib%2Fasync_hooks.js",
            "raw_url": "https://github.com/nodejs/node/raw/f2defcac4dd10f018215e3db530bed1314ce2225/lib%2Fasync_hooks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fasync_hooks.js?ref=f2defcac4dd10f018215e3db530bed1314ce2225",
            "patch": "@@ -41,15 +41,15 @@ const {\n class AsyncHook {\n   constructor({ init, before, after, destroy, promiseResolve }) {\n     if (init !== undefined && typeof init !== 'function')\n-      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'init');\n+      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'hook.init');\n     if (before !== undefined && typeof before !== 'function')\n-      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'before');\n+      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'hook.before');\n     if (after !== undefined && typeof after !== 'function')\n-      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'before');\n+      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'hook.after');\n     if (destroy !== undefined && typeof destroy !== 'function')\n-      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'before');\n+      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'hook.destroy');\n     if (promiseResolve !== undefined && typeof promiseResolve !== 'function')\n-      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'promiseResolve');\n+      throw new errors.TypeError('ERR_ASYNC_CALLBACK', 'hook.promiseResolve');\n \n     this[init_symbol] = init;\n     this[before_symbol] = before;"
        },
        {
            "sha": "f2b4df6a9f9f992ab4370cc528133ce885fd1210",
            "filename": "test/parallel/test-async-hooks-constructor.js",
            "status": "added",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/f2defcac4dd10f018215e3db530bed1314ce2225/test%2Fparallel%2Ftest-async-hooks-constructor.js",
            "raw_url": "https://github.com/nodejs/node/raw/f2defcac4dd10f018215e3db530bed1314ce2225/test%2Fparallel%2Ftest-async-hooks-constructor.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-async-hooks-constructor.js?ref=f2defcac4dd10f018215e3db530bed1314ce2225",
            "patch": "@@ -0,0 +1,23 @@\n+'use strict';\n+\n+// This tests that AsyncHooks throws an error if bad parameters are passed.\n+\n+const common = require('../common');\n+const async_hooks = require('async_hooks');\n+const non_function = 10;\n+\n+typeErrorForFunction('init');\n+typeErrorForFunction('before');\n+typeErrorForFunction('after');\n+typeErrorForFunction('destroy');\n+typeErrorForFunction('promiseResolve');\n+\n+function typeErrorForFunction(functionName) {\n+  common.expectsError(() => {\n+    async_hooks.createHook({ [functionName]: non_function });\n+  }, {\n+    code: 'ERR_ASYNC_CALLBACK',\n+    type: TypeError,\n+    message: `hook.${functionName} must be a function`\n+  });\n+}"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 28,
        "deletions": 5
    }
}