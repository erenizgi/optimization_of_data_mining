{
    "author": "refack",
    "message": "benchmark,test: refactoring\n\nPR-URL: https://github.com/nodejs/node/pull/26119\nRefs: https://github.com/nodejs/node/pull/26101\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86",
    "files": [
        {
            "sha": "24d6e020c63bc03cf39fdf3151f406ac089b2fb8",
            "filename": "benchmark/http/create-clientrequest.js",
            "status": "modified",
            "additions": 35,
            "deletions": 26,
            "changes": 61,
            "blob_url": "https://github.com/nodejs/node/blob/c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86/benchmark%2Fhttp%2Fcreate-clientrequest.js",
            "raw_url": "https://github.com/nodejs/node/raw/c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86/benchmark%2Fhttp%2Fcreate-clientrequest.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fhttp%2Fcreate-clientrequest.js?ref=c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86",
            "patch": "@@ -1,7 +1,9 @@\n 'use strict';\n \n const common = require('../common.js');\n-const ClientRequest = require('http').ClientRequest;\n+const { ClientRequest } = require('http');\n+const assert = require('assert');\n+\n const types = Object.keys(common.urls)\n   .filter((i) => common.urls[i]\n   .startsWith('http://'));\n@@ -15,36 +17,43 @@ const bench = common.createBenchmark(main, {\n function noop() {}\n \n function main({ url: type, arg, e }) {\n-  e = +e;\n+  e = Number(e);\n   const data = common.bakeUrlData(type, e, false, false)\n     .filter((i) => i.startsWith('http://'));\n   const len = data.length;\n-  var result;\n-  var i;\n-  if (arg === 'options') {\n-    const options = data.map((i) => ({\n-      path: new URL(i).path, createConnection: noop\n-    }));\n-    bench.start();\n-    for (i = 0; i < len; i++) {\n-      result = new ClientRequest(options[i]);\n+  let result;\n+  switch (arg) {\n+    case 'options': {\n+      const options = data.map((i) => ({\n+        path: new URL(i).path, createConnection: noop\n+      }));\n+      bench.start();\n+      for (let i = 0; i < len; i++) {\n+        result = new ClientRequest(options[i]);\n+      }\n+      bench.end(len);\n+      break;\n+    }\n+    case 'URL': {\n+      const options = data.map((i) => new URL(i));\n+      bench.start();\n+      for (let i = 0; i < len; i++) {\n+        result = new ClientRequest(options[i], { createConnection: noop });\n+      }\n+      bench.end(len);\n+      break;\n     }\n-    bench.end(len);\n-  } else if (arg === 'URL') {\n-    const options = data.map((i) => new URL(i));\n-    bench.start();\n-    for (i = 0; i < len; i++) {\n-      result = new ClientRequest(options[i], { createConnection: noop });\n+    case 'string': {\n+      bench.start();\n+      for (let i = 0; i < len; i++) {\n+        result = new ClientRequest(data[i], { createConnection: noop });\n+      }\n+      bench.end(len);\n+      break;\n     }\n-    bench.end(len);\n-  } else if (arg === 'string') {\n-    bench.start();\n-    for (i = 0; i < len; i++) {\n-      result = new ClientRequest(data[i], { createConnection: noop });\n+    default: {\n+      throw new Error(`Unknown arg type ${arg}`);\n     }\n-    bench.end(len);\n-  } else {\n-    throw new Error(`Unknown arg type ${arg}`);\n   }\n-  require('assert').ok(result);\n+  assert.ok(result);\n }"
        },
        {
            "sha": "8f611ae4743c9338af7f700c3efbd4388332a08b",
            "filename": "benchmark/http/headers.js",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86/benchmark%2Fhttp%2Fheaders.js",
            "raw_url": "https://github.com/nodejs/node/raw/c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86/benchmark%2Fhttp%2Fheaders.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fhttp%2Fheaders.js?ref=c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86",
            "patch": "@@ -4,21 +4,20 @@ const common = require('../common.js');\n const http = require('http');\n \n const bench = common.createBenchmark(main, {\n-  duplicates: [1, 100],\n   n: [10, 1000],\n+  len: [1, 100],\n });\n \n-function main({ duplicates, n }) {\n+function main({ len, n }) {\n   const headers = {\n     'Connection': 'keep-alive',\n     'Transfer-Encoding': 'chunked',\n   };\n \n-  for (var i = 0; i < n / duplicates; i++) {\n-    headers[`foo${i}`] = [];\n-    for (var j = 0; j < duplicates; j++) {\n-      headers[`foo${i}`].push(`some header value ${i}`);\n-    }\n+  const Is = [ ...Array(n / len).keys() ];\n+  const Js = [ ...Array(len).keys() ];\n+  for (const i of Is) {\n+    headers[`foo${i}`] = Js.map(() => `some header value ${i}`);\n   }\n \n   const server = http.createServer((req, res) => {"
        },
        {
            "sha": "7d9955766c7882fb58db6f0de49e4fd2823ec6a3",
            "filename": "benchmark/http/incoming_headers.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86/benchmark%2Fhttp%2Fincoming_headers.js",
            "raw_url": "https://github.com/nodejs/node/raw/c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86/benchmark%2Fhttp%2Fincoming_headers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fhttp%2Fincoming_headers.js?ref=c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86",
            "patch": "@@ -5,10 +5,10 @@ const http = require('http');\n const bench = common.createBenchmark(main, {\n   // unicode confuses ab on os x.\n   c: [50, 500],\n-  headerDuplicates: [0, 5, 20]\n+  n: [0, 5, 20]\n });\n \n-function main({ c, headerDuplicates }) {\n+function main({ c, n }) {\n   const server = http.createServer((req, res) => {\n     res.end();\n   });\n@@ -21,7 +21,7 @@ function main({ c, headerDuplicates }) {\n       'Date': new Date().toString(),\n       'Cache-Control': 'no-cache'\n     };\n-    for (let i = 0; i < headerDuplicates; i++) {\n+    for (let i = 0; i < n; i++) {\n       headers[`foo${i}`] = `some header value ${i}`;\n     }\n     bench.http({"
        },
        {
            "sha": "ed8423ba4c10cdd9d91e1200f7e9815c3cea90a2",
            "filename": "test/benchmark/test-benchmark-http.js",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86/test%2Fbenchmark%2Ftest-benchmark-http.js",
            "raw_url": "https://github.com/nodejs/node/raw/c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86/test%2Fbenchmark%2Ftest-benchmark-http.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fbenchmark%2Ftest-benchmark-http.js?ref=c7b6a22f1ac0cec67d7b884a2f7e5cbc566d8c86",
            "patch": "@@ -14,23 +14,21 @@ const runBenchmark = require('../common/benchmark');\n runBenchmark('http',\n              [\n                'benchmarker=test-double-http',\n-               'c=1',\n-               'e=0',\n-               'url=long',\n                'arg=string',\n+               'c=1',\n                'chunkedEnc=true',\n                'chunks=0',\n                'dur=0.1',\n-               'duplicates=1',\n+               'e=0',\n                'input=keep-alive',\n                'key=\"\"',\n                'len=1',\n                'method=write',\n                'n=1',\n                'res=normal',\n                'type=asc',\n+               'url=long',\n                'value=X-Powered-By',\n-               'headerDuplicates=1',\n              ],\n              {\n                NODEJS_BENCHMARK_ZERO_ALLOWED: 1,"
        }
    ],
    "stats": {
        "total": 88,
        "additions": 47,
        "deletions": 41
    }
}