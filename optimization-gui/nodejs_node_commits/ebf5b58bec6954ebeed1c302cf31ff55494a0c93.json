{
    "author": "starkwang",
    "message": "workers: replace message types string by constants\n\nThis change can prevent typos and redundant strings in code.\n\nPR-URL: https://github.com/nodejs/node/pull/21537\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "ebf5b58bec6954ebeed1c302cf31ff55494a0c93",
    "files": [
        {
            "sha": "bcc864b5b8b33006509d8a0831de0509be52c163",
            "filename": "lib/internal/worker.js",
            "status": "modified",
            "additions": 27,
            "deletions": 15,
            "changes": 42,
            "blob_url": "https://github.com/nodejs/node/blob/ebf5b58bec6954ebeed1c302cf31ff55494a0c93/lib%2Finternal%2Fworker.js",
            "raw_url": "https://github.com/nodejs/node/raw/ebf5b58bec6954ebeed1c302cf31ff55494a0c93/lib%2Finternal%2Fworker.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fworker.js?ref=ebf5b58bec6954ebeed1c302cf31ff55494a0c93",
            "patch": "@@ -47,6 +47,15 @@ const kIncrementsPortRef = Symbol('kIncrementsPortRef');\n \n const debug = util.debuglog('worker');\n \n+const messageTypes = {\n+  UP_AND_RUNNING: 'upAndRunning',\n+  COULD_NOT_SERIALIZE_ERROR: 'couldNotSerializeError',\n+  ERROR_MESSAGE: 'errorMessage',\n+  STDIO_PAYLOAD: 'stdioPayload',\n+  STDIO_WANTS_MORE_DATA: 'stdioWantsMoreData',\n+  LOAD_SCRIPT: 'loadScript'\n+};\n+\n // A communication channel consisting of a handle (that wraps around an\n // uv_async_t) which can receive information from other threads and emits\n // .onmessage events, and a function used for sending data to a MessagePort\n@@ -158,7 +167,7 @@ class ReadableWorkerStdio extends Readable {\n     }\n \n     this[kPort].postMessage({\n-      type: 'stdioWantsMoreData',\n+      type: messageTypes.STDIO_WANTS_MORE_DATA,\n       stream: this[kName]\n     });\n   }\n@@ -174,7 +183,7 @@ class WritableWorkerStdio extends Writable {\n \n   _write(chunk, encoding, cb) {\n     this[kPort].postMessage({\n-      type: 'stdioPayload',\n+      type: messageTypes.STDIO_PAYLOAD,\n       stream: this[kName],\n       chunk,\n       encoding\n@@ -186,7 +195,7 @@ class WritableWorkerStdio extends Writable {\n \n   _final(cb) {\n     this[kPort].postMessage({\n-      type: 'stdioPayload',\n+      type: messageTypes.STDIO_PAYLOAD,\n       stream: this[kName],\n       chunk: null\n     });\n@@ -258,7 +267,7 @@ class Worker extends EventEmitter {\n     this[kPublicPort].on('message', (message) => this.emit('message', message));\n     setupPortReferencing(this[kPublicPort], this, 'message');\n     this[kPort].postMessage({\n-      type: 'loadScript',\n+      type: messageTypes.LOAD_SCRIPT,\n       filename,\n       doEval: !!options.eval,\n       workerData: options.workerData,\n@@ -289,18 +298,18 @@ class Worker extends EventEmitter {\n \n   [kOnMessage](message) {\n     switch (message.type) {\n-      case 'upAndRunning':\n+      case messageTypes.UP_AND_RUNNING:\n         return this.emit('online');\n-      case 'couldNotSerializeError':\n+      case messageTypes.COULD_NOT_SERIALIZE_ERROR:\n         return this[kOnCouldNotSerializeErr]();\n-      case 'errorMessage':\n+      case messageTypes.ERROR_MESSAGE:\n         return this[kOnErrorMessage](message.error);\n-      case 'stdioPayload':\n+      case messageTypes.STDIO_PAYLOAD:\n       {\n         const { stream, chunk, encoding } = message;\n         return this[kParentSideStdio][stream].push(chunk, encoding);\n       }\n-      case 'stdioWantsMoreData':\n+      case messageTypes.STDIO_WANTS_MORE_DATA:\n       {\n         const { stream } = message;\n         return this[kParentSideStdio][stream][kStdioWantsMoreDataCallback]();\n@@ -396,7 +405,7 @@ function setupChild(evalScript) {\n   const publicWorker = require('worker_threads');\n \n   port.on('message', (message) => {\n-    if (message.type === 'loadScript') {\n+    if (message.type === messageTypes.LOAD_SCRIPT) {\n       const { filename, doEval, workerData, publicPort, hasStdin } = message;\n       publicWorker.parentPort = publicPort;\n       setupPortReferencing(publicPort, publicPort, 'message');\n@@ -408,19 +417,19 @@ function setupChild(evalScript) {\n       debug(`[${threadId}] starts worker script ${filename} ` +\n             `(eval = ${eval}) at cwd = ${process.cwd()}`);\n       port.unref();\n-      port.postMessage({ type: 'upAndRunning' });\n+      port.postMessage({ type: messageTypes.UP_AND_RUNNING });\n       if (doEval) {\n         evalScript('[worker eval]', filename);\n       } else {\n         process.argv[1] = filename; // script filename\n         require('module').runMain();\n       }\n       return;\n-    } else if (message.type === 'stdioPayload') {\n+    } else if (message.type === messageTypes.STDIO_PAYLOAD) {\n       const { stream, chunk, encoding } = message;\n       workerStdio[stream].push(chunk, encoding);\n       return;\n-    } else if (message.type === 'stdioWantsMoreData') {\n+    } else if (message.type === messageTypes.STDIO_WANTS_MORE_DATA) {\n       const { stream } = message;\n       workerStdio[stream][kStdioWantsMoreDataCallback]();\n       return;\n@@ -451,9 +460,12 @@ function setupChild(evalScript) {\n       } catch {}\n       debug(`[${threadId}] fatal exception serialized = ${!!serialized}`);\n       if (serialized)\n-        port.postMessage({ type: 'errorMessage', error: serialized });\n+        port.postMessage({\n+          type: messageTypes.ERROR_MESSAGE,\n+          error: serialized\n+        });\n       else\n-        port.postMessage({ type: 'couldNotSerializeError' });\n+        port.postMessage({ type: messageTypes.COULD_NOT_SERIALIZE_ERROR });\n       clearAsyncIdStack();\n     }\n   }"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 27,
        "deletions": 15
    }
}