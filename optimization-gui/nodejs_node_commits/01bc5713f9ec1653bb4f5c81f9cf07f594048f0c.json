{
    "author": "jasnell",
    "message": "deps: update to nghttp2 1.32.0\n\nThis fixes CVE-2018-1000168.\n\nPR-URL: https://github.com/nodejs-private/node-private/pull/117\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Evan Lucas <evanlucas@me.com>",
    "sha": "01bc5713f9ec1653bb4f5c81f9cf07f594048f0c",
    "files": [
        {
            "sha": "17e422b22db790867e4f4b874f11f46bb0444b14",
            "filename": "deps/nghttp2/lib/CMakeLists.txt",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2FCMakeLists.txt",
            "raw_url": "https://github.com/nodejs/node/raw/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2FCMakeLists.txt",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2FCMakeLists.txt?ref=01bc5713f9ec1653bb4f5c81f9cf07f594048f0c",
            "patch": "@@ -49,7 +49,7 @@ target_include_directories(nghttp2 INTERFACE\n     \"${CMAKE_CURRENT_SOURCE_DIR}/includes\"\n     )\n \n-if(HAVE_CUNIT)\n+if(HAVE_CUNIT OR ENABLE_STATIC_LIB)\n   # Static library (for unittests because of symbol visibility)\n   add_library(nghttp2_static STATIC ${NGHTTP2_SOURCES})\n   set_target_properties(nghttp2_static PROPERTIES\n@@ -58,6 +58,10 @@ if(HAVE_CUNIT)\n     ARCHIVE_OUTPUT_NAME nghttp2\n   )\n   target_compile_definitions(nghttp2_static PUBLIC \"-DNGHTTP2_STATICLIB\")\n+  if(ENABLE_STATIC_LIB)\n+    install(TARGETS nghttp2_static\n+      DESTINATION \"${CMAKE_INSTALL_LIBDIR}\")\n+  endif()\n endif()\n \n install(TARGETS nghttp2"
        },
        {
            "sha": "14f8950bed8d1505e070734adb53889e5e3aa7e0",
            "filename": "deps/nghttp2/lib/includes/nghttp2/nghttp2.h",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2.h",
            "raw_url": "https://github.com/nodejs/node/raw/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2.h?ref=01bc5713f9ec1653bb4f5c81f9cf07f594048f0c",
            "patch": "@@ -3081,6 +3081,16 @@ NGHTTP2_EXTERN int\n nghttp2_session_set_stream_user_data(nghttp2_session *session,\n                                      int32_t stream_id, void *stream_user_data);\n \n+/**\n+ * @function\n+ *\n+ * Sets |user_data| to |session|, overwriting the existing user data\n+ * specified in `nghttp2_session_client_new()`, or\n+ * `nghttp2_session_server_new()`.\n+ */\n+NGHTTP2_EXTERN void nghttp2_session_set_user_data(nghttp2_session *session,\n+                                                  void *user_data);\n+\n /**\n  * @function\n  *"
        },
        {
            "sha": "d32d2754441b2575452cb015fe130f4cee849ee4",
            "filename": "deps/nghttp2/lib/includes/nghttp2/nghttp2ver.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2ver.h",
            "raw_url": "https://github.com/nodejs/node/raw/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2ver.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2ver.h?ref=01bc5713f9ec1653bb4f5c81f9cf07f594048f0c",
            "patch": "@@ -29,14 +29,14 @@\n  * @macro\n  * Version number of the nghttp2 library release\n  */\n-#define NGHTTP2_VERSION \"1.29.0\"\n+#define NGHTTP2_VERSION \"1.32.0\"\n \n /**\n  * @macro\n  * Numerical representation of the version number of the nghttp2 library\n  * release. This is a 24 bit number with 8 bits for major number, 8 bits\n  * for minor and 8 bits for patch. Version 1.2.3 becomes 0x010203.\n  */\n-#define NGHTTP2_VERSION_NUM 0x011d00\n+#define NGHTTP2_VERSION_NUM 0x012000\n \n #endif /* NGHTTP2VER_H */"
        },
        {
            "sha": "fa7cb6953bc539f842e656c4f73b9a567b61aabc",
            "filename": "deps/nghttp2/lib/nghttp2_frame.c",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fnghttp2_frame.c",
            "raw_url": "https://github.com/nodejs/node/raw/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fnghttp2_frame.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_frame.c?ref=01bc5713f9ec1653bb4f5c81f9cf07f594048f0c",
            "patch": "@@ -215,6 +215,9 @@ void nghttp2_frame_altsvc_free(nghttp2_extension *frame, nghttp2_mem *mem) {\n   nghttp2_ext_altsvc *altsvc;\n \n   altsvc = frame->payload;\n+  if (altsvc == NULL) {\n+    return;\n+  }\n   /* We use the same buffer for altsvc->origin and\n      altsvc->field_value. */\n   nghttp2_mem_free(mem, altsvc->origin);"
        },
        {
            "sha": "b08f8863f7ce161452aa6b9e2cf5c18c4dadf138",
            "filename": "deps/nghttp2/lib/nghttp2_http.c",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fnghttp2_http.c",
            "raw_url": "https://github.com/nodejs/node/raw/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fnghttp2_http.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_http.c?ref=01bc5713f9ec1653bb4f5c81f9cf07f594048f0c",
            "patch": "@@ -244,7 +244,7 @@ static int http_response_on_header(nghttp2_stream *stream, nghttp2_hd_nv *nv,\n       return NGHTTP2_ERR_HTTP_HEADER;\n     }\n     stream->status_code = (int16_t)parse_uint(nv->value->base, nv->value->len);\n-    if (stream->status_code == -1) {\n+    if (stream->status_code == -1 || stream->status_code == 101) {\n       return NGHTTP2_ERR_HTTP_HEADER;\n     }\n     break;"
        },
        {
            "sha": "a9e7a62390e56a4ba31ad9e44aa35e41c689420f",
            "filename": "deps/nghttp2/lib/nghttp2_session.c",
            "status": "modified",
            "additions": 105,
            "deletions": 46,
            "changes": 151,
            "blob_url": "https://github.com/nodejs/node/blob/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fnghttp2_session.c",
            "raw_url": "https://github.com/nodejs/node/raw/01bc5713f9ec1653bb4f5c81f9cf07f594048f0c/deps%2Fnghttp2%2Flib%2Fnghttp2_session.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_session.c?ref=01bc5713f9ec1653bb4f5c81f9cf07f594048f0c",
            "patch": "@@ -219,6 +219,10 @@ static int session_terminate_session(nghttp2_session *session,\n     return 0;\n   }\n \n+  /* Ignore all incoming frames because we are going to tear down the\n+     session. */\n+  session->iframe.state = NGHTTP2_IB_IGN_ALL;\n+\n   if (reason == NULL) {\n     debug_data = NULL;\n     debug_datalen = 0;\n@@ -2225,8 +2229,9 @@ static int session_prep_frame(nghttp2_session *session,\n       assert(session->obq_flood_counter_ > 0);\n       --session->obq_flood_counter_;\n     }\n-\n-    if (session_is_closing(session)) {\n+    /* PING frame is allowed to be sent unless termination GOAWAY is\n+       sent */\n+    if (session->goaway_flags & NGHTTP2_GOAWAY_TERM_ON_SEND) {\n       return NGHTTP2_ERR_SESSION_CLOSING;\n     }\n     nghttp2_frame_pack_ping(&session->aob.framebufs, &frame->ping);\n@@ -5345,9 +5350,6 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n \n       if (iframe->sbuf.pos[3] != NGHTTP2_SETTINGS ||\n           (iframe->sbuf.pos[4] & NGHTTP2_FLAG_ACK)) {\n-\n-        iframe->state = NGHTTP2_IB_IGN_ALL;\n-\n         rv = session_call_error_callback(\n             session, NGHTTP2_ERR_SETTINGS_EXPECTED,\n             \"Remote peer returned unexpected data while we expected \"\n@@ -5394,18 +5396,14 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n         DEBUGF(\"recv: length is too large %zu > %u\\n\", iframe->frame.hd.length,\n                session->local_settings.max_frame_size);\n \n-        busy = 1;\n-\n-        iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n-\n         rv = nghttp2_session_terminate_session_with_reason(\n             session, NGHTTP2_FRAME_SIZE_ERROR, \"too large frame size\");\n \n         if (nghttp2_is_fatal(rv)) {\n           return rv;\n         }\n \n-        break;\n+        return (ssize_t)inlen;\n       }\n \n       switch (iframe->frame.hd.type) {\n@@ -5419,6 +5417,9 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n         busy = 1;\n \n         rv = session_on_data_received_fail_fast(session);\n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n         if (rv == NGHTTP2_ERR_IGN_PAYLOAD) {\n           DEBUGF(\"recv: DATA not allowed stream_id=%d\\n\",\n                  iframe->frame.hd.stream_id);\n@@ -5432,15 +5433,14 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n \n         rv = inbound_frame_handle_pad(iframe, &iframe->frame.hd);\n         if (rv < 0) {\n-          iframe->state = NGHTTP2_IB_IGN_DATA;\n           rv = nghttp2_session_terminate_session_with_reason(\n               session, NGHTTP2_PROTOCOL_ERROR,\n               \"DATA: insufficient padding space\");\n \n           if (nghttp2_is_fatal(rv)) {\n             return rv;\n           }\n-          break;\n+          return (ssize_t)inlen;\n         }\n \n         if (rv == 1) {\n@@ -5461,17 +5461,13 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n \n         rv = inbound_frame_handle_pad(iframe, &iframe->frame.hd);\n         if (rv < 0) {\n-          busy = 1;\n-\n-          iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n-\n           rv = nghttp2_session_terminate_session_with_reason(\n               session, NGHTTP2_PROTOCOL_ERROR,\n               \"HEADERS: insufficient padding space\");\n           if (nghttp2_is_fatal(rv)) {\n             return rv;\n           }\n-          break;\n+          return (ssize_t)inlen;\n         }\n \n         if (rv == 1) {\n@@ -5513,6 +5509,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n \n         busy = 1;\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         if (rv == NGHTTP2_ERR_TEMPORAL_CALLBACK_FAILURE) {\n           rv = nghttp2_session_add_rst_stream(\n               session, iframe->frame.hd.stream_id, NGHTTP2_INTERNAL_ERROR);\n@@ -5627,15 +5627,13 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n \n         rv = inbound_frame_handle_pad(iframe, &iframe->frame.hd);\n         if (rv < 0) {\n-          busy = 1;\n-          iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n           rv = nghttp2_session_terminate_session_with_reason(\n               session, NGHTTP2_PROTOCOL_ERROR,\n               \"PUSH_PROMISE: insufficient padding space\");\n           if (nghttp2_is_fatal(rv)) {\n             return rv;\n           }\n-          break;\n+          return (ssize_t)inlen;\n         }\n \n         if (rv == 1) {\n@@ -5695,11 +5693,7 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           return rv;\n         }\n \n-        busy = 1;\n-\n-        iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n-\n-        break;\n+        return (ssize_t)inlen;\n       default:\n         DEBUGF(\"recv: extension frame\\n\");\n \n@@ -5769,6 +5763,7 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n         case NGHTTP2_IB_IGN_PAYLOAD:\n         case NGHTTP2_IB_FRAME_SIZE_ERROR:\n         case NGHTTP2_IB_IGN_DATA:\n+        case NGHTTP2_IB_IGN_ALL:\n           break;\n         default:\n           rv = session_call_on_begin_frame(session, &iframe->frame.hd);\n@@ -5799,21 +5794,19 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n       case NGHTTP2_HEADERS:\n         if (iframe->padlen == 0 &&\n             (iframe->frame.hd.flags & NGHTTP2_FLAG_PADDED)) {\n+          pri_fieldlen = nghttp2_frame_priority_len(iframe->frame.hd.flags);\n           padlen = inbound_frame_compute_pad(iframe);\n-          if (padlen < 0) {\n-            busy = 1;\n+          if (padlen < 0 ||\n+              (size_t)padlen + pri_fieldlen > 1 + iframe->payloadleft) {\n             rv = nghttp2_session_terminate_session_with_reason(\n                 session, NGHTTP2_PROTOCOL_ERROR, \"HEADERS: invalid padding\");\n             if (nghttp2_is_fatal(rv)) {\n               return rv;\n             }\n-            iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n-            break;\n+            return (ssize_t)inlen;\n           }\n           iframe->frame.headers.padlen = (size_t)padlen;\n \n-          pri_fieldlen = nghttp2_frame_priority_len(iframe->frame.hd.flags);\n-\n           if (pri_fieldlen > 0) {\n             if (iframe->payloadleft < pri_fieldlen) {\n               busy = 1;\n@@ -5836,6 +5829,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n \n         busy = 1;\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         if (rv == NGHTTP2_ERR_TEMPORAL_CALLBACK_FAILURE) {\n           rv = nghttp2_session_add_rst_stream(\n               session, iframe->frame.hd.stream_id, NGHTTP2_INTERNAL_ERROR);\n@@ -5860,6 +5857,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           return rv;\n         }\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         session_inbound_frame_reset(session);\n \n         break;\n@@ -5869,23 +5870,26 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           return rv;\n         }\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         session_inbound_frame_reset(session);\n \n         break;\n       case NGHTTP2_PUSH_PROMISE:\n         if (iframe->padlen == 0 &&\n             (iframe->frame.hd.flags & NGHTTP2_FLAG_PADDED)) {\n           padlen = inbound_frame_compute_pad(iframe);\n-          if (padlen < 0) {\n-            busy = 1;\n+          if (padlen < 0 || (size_t)padlen + 4 /* promised stream id */\n+                                > 1 + iframe->payloadleft) {\n             rv = nghttp2_session_terminate_session_with_reason(\n                 session, NGHTTP2_PROTOCOL_ERROR,\n                 \"PUSH_PROMISE: invalid padding\");\n             if (nghttp2_is_fatal(rv)) {\n               return rv;\n             }\n-            iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n-            break;\n+            return (ssize_t)inlen;\n           }\n \n           iframe->frame.push_promise.padlen = (size_t)padlen;\n@@ -5910,6 +5914,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n \n         busy = 1;\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         if (rv == NGHTTP2_ERR_TEMPORAL_CALLBACK_FAILURE) {\n           rv = nghttp2_session_add_rst_stream(\n               session, iframe->frame.push_promise.promised_stream_id,\n@@ -5935,6 +5943,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           return rv;\n         }\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         session_inbound_frame_reset(session);\n \n         break;\n@@ -5966,6 +5978,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           return rv;\n         }\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         session_inbound_frame_reset(session);\n \n         break;\n@@ -6027,6 +6043,12 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n \n       data_readlen = inbound_frame_effective_readlen(\n           iframe, iframe->payloadleft - readlen, readlen);\n+\n+      if (data_readlen == -1) {\n+        /* everything is padding */\n+        data_readlen = 0;\n+      }\n+\n       trail_padlen = nghttp2_frame_trail_padlen(&iframe->frame, iframe->padlen);\n \n       final = (iframe->frame.hd.flags & NGHTTP2_FLAG_END_HEADERS) &&\n@@ -6046,6 +6068,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           return rv;\n         }\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         if (rv == NGHTTP2_ERR_PAUSE) {\n           in += hd_proclen;\n           iframe->payloadleft -= hd_proclen;\n@@ -6155,11 +6181,9 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n         return rv;\n       }\n \n-      busy = 1;\n-\n-      iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n+      assert(iframe->state == NGHTTP2_IB_IGN_ALL);\n \n-      break;\n+      return (ssize_t)inlen;\n     case NGHTTP2_IB_READ_SETTINGS:\n       DEBUGF(\"recv: [IB_READ_SETTINGS]\\n\");\n \n@@ -6188,6 +6212,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n         return rv;\n       }\n \n+      if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+        return (ssize_t)inlen;\n+      }\n+\n       session_inbound_frame_reset(session);\n \n       break;\n@@ -6218,6 +6246,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n         return rv;\n       }\n \n+      if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+        return (ssize_t)inlen;\n+      }\n+\n       session_inbound_frame_reset(session);\n \n       break;\n@@ -6257,11 +6289,7 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           return rv;\n         }\n \n-        busy = 1;\n-\n-        iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n-\n-        break;\n+        return (ssize_t)inlen;\n       }\n \n       /* CONTINUATION won't bear NGHTTP2_PADDED flag */\n@@ -6305,6 +6333,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n         return rv;\n       }\n \n+      if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+        return (ssize_t)inlen;\n+      }\n+\n       /* Pad Length field is consumed immediately */\n       rv =\n           nghttp2_session_consume(session, iframe->frame.hd.stream_id, readlen);\n@@ -6313,6 +6345,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n         return rv;\n       }\n \n+      if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+        return (ssize_t)inlen;\n+      }\n+\n       stream = nghttp2_session_get_stream(session, iframe->frame.hd.stream_id);\n       if (stream) {\n         rv = session_update_recv_stream_window_size(\n@@ -6333,8 +6369,7 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n         if (nghttp2_is_fatal(rv)) {\n           return rv;\n         }\n-        iframe->state = NGHTTP2_IB_IGN_DATA;\n-        break;\n+        return (ssize_t)inlen;\n       }\n \n       iframe->frame.data.padlen = (size_t)padlen;\n@@ -6368,6 +6403,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           return rv;\n         }\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         rv = session_update_recv_stream_window_size(\n             session, stream, readlen,\n             iframe->payloadleft ||\n@@ -6394,6 +6433,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           if (nghttp2_is_fatal(rv)) {\n             return rv;\n           }\n+\n+          if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+            return (ssize_t)inlen;\n+          }\n         }\n \n         DEBUGF(\"recv: data_readlen=%zd\\n\", data_readlen);\n@@ -6409,6 +6452,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n                 if (nghttp2_is_fatal(rv)) {\n                   return rv;\n                 }\n+\n+                if (iframe->state == NGHTTP2_IB_IGN_DATA) {\n+                  return (ssize_t)inlen;\n+                }\n               }\n \n               rv = nghttp2_session_add_rst_stream(\n@@ -6466,6 +6513,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           return rv;\n         }\n \n+        if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+          return (ssize_t)inlen;\n+        }\n+\n         if (session->opt_flags & NGHTTP2_OPTMASK_NO_AUTO_WINDOW_UPDATE) {\n \n           /* Ignored DATA is considered as \"consumed\" immediately. */\n@@ -6474,6 +6525,10 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n           if (nghttp2_is_fatal(rv)) {\n             return rv;\n           }\n+\n+          if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+            return (ssize_t)inlen;\n+          }\n         }\n       }\n \n@@ -7520,3 +7575,7 @@ size_t\n nghttp2_session_get_hd_deflate_dynamic_table_size(nghttp2_session *session) {\n   return nghttp2_hd_deflate_get_dynamic_table_size(&session->hd_deflater);\n }\n+\n+void nghttp2_session_set_user_data(nghttp2_session *session, void *user_data) {\n+  session->user_data = user_data;\n+}"
        }
    ],
    "stats": {
        "total": 176,
        "additions": 126,
        "deletions": 50
    }
}