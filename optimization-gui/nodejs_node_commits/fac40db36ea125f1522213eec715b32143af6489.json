{
    "author": "cjihrig",
    "message": "test: simplify test-api-nohooks.js\n\nPR-URL: https://github.com/nodejs/node/pull/26217\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "fac40db36ea125f1522213eec715b32143af6489",
    "files": [
        {
            "sha": "478586fe8d8e14a830e29128e73f405cec9dd433",
            "filename": "test/node-report/test-api-nohooks.js",
            "status": "modified",
            "additions": 14,
            "deletions": 23,
            "changes": 37,
            "blob_url": "https://github.com/nodejs/node/blob/fac40db36ea125f1522213eec715b32143af6489/test%2Fnode-report%2Ftest-api-nohooks.js",
            "raw_url": "https://github.com/nodejs/node/raw/fac40db36ea125f1522213eec715b32143af6489/test%2Fnode-report%2Ftest-api-nohooks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fnode-report%2Ftest-api-nohooks.js?ref=fac40db36ea125f1522213eec715b32143af6489",
            "patch": "@@ -1,28 +1,19 @@\n+// Flags: --experimental-report\n 'use strict';\n \n-// Testcase to produce report via API call, using the no-hooks/no-signal\n-// interface - i.e. require('node-report/api')\n+// Test producing a report via API call, using the no-hooks/no-signal interface.\n const common = require('../common');\n common.skipIfReportDisabled();\n-if (process.argv[2] === 'child') {\n-  process.report.triggerReport();\n-} else {\n-  const helper = require('../common/report.js');\n-  const spawn = require('child_process').spawn;\n-  const assert = require('assert');\n-  const tmpdir = require('../common/tmpdir');\n-  tmpdir.refresh();\n+const assert = require('assert');\n+const helper = require('../common/report');\n+const tmpdir = require('../common/tmpdir');\n \n-  const child = spawn(process.execPath, ['--experimental-report',\n-                                         __filename, 'child'],\n-                      { cwd: tmpdir.path });\n-  child.on('exit', common.mustCall((code) => {\n-    const report_msg = 'No reports found';\n-    const process_msg = 'Process exited unexpectedly';\n-    assert.strictEqual(code, 0, process_msg + ':' + code);\n-    const reports = helper.findReports(child.pid, tmpdir.path);\n-    assert.strictEqual(reports.length, 1, report_msg);\n-    const report = reports[0];\n-    helper.validate(report);\n-  }));\n-}\n+common.expectWarning('ExperimentalWarning',\n+                     'report is an experimental feature. This feature could ' +\n+                     'change at any time');\n+tmpdir.refresh();\n+process.report.setOptions({ path: tmpdir.path });\n+process.report.triggerReport();\n+const reports = helper.findReports(process.pid, tmpdir.path);\n+assert.strictEqual(reports.length, 1);\n+helper.validate(reports[0]);"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 14,
        "deletions": 23
    }
}