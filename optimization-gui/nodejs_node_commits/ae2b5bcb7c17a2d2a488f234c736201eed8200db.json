{
    "author": "cjihrig",
    "message": "deps: upgrade libuv to 1.20.0\n\nNotable changes:\n- uv_fs_copyfile() adds support for copy-on-write behavior.\n- uv_relative_path() now uses the long directory name\n  for handle->dirw.\n- File operations on files > 2 GB on 32-bit platforms are\n  working again.\n- uv_fs_fchmod() on Windows works on files with the\n  Archive flag cleared.\n\nFixes: https://github.com/nodejs/node/issues/19170\nFixes: https://github.com/nodejs/node/issues/19455\nFixes: https://github.com/nodejs/node/issues/12803\nPR-URL: https://github.com/nodejs/node/pull/19758\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Santiago Gimeno <santiago.gimeno@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "ae2b5bcb7c17a2d2a488f234c736201eed8200db",
    "files": [
        {
            "sha": "5bbe5b26bb5c5e621ad6754c2b322de9313c167c",
            "filename": "deps/uv/.mailmap",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2F.mailmap",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2F.mailmap",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2F.mailmap?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -16,6 +16,7 @@ Frank Denis <github@pureftpd.org>\n Imran Iqbal <imrani@ca.ibm.com> <imran@imraniqbal.org>\n Isaac Z. Schlueter <i@izs.me>\n Jason Williams <necmon@yahoo.com>\n+Jesse Gorzinski <jgorzinski@gmail.com>\n Justin Venus <justin.venus@gmail.com> <justin.venus@orbitz.com>\n Keno Fischer <kenof@stanford.edu> <kfischer+github@college.harvard.edu>\n Keno Fischer <kenof@stanford.edu> <kfischer@college.harvard.edu>"
        },
        {
            "sha": "c704527a97064742bd230b31e0f54fc799d2e63a",
            "filename": "deps/uv/AUTHORS",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2FAUTHORS",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2FAUTHORS",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2FAUTHORS?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -330,3 +330,5 @@ Mason X <me@masonx.ca>\n Jesse Gorzinski <jgorzinski@gmail.com>\n Ryuichi KAWAMATA <ryuichi.kawamata@dena.jp>\n Joyee Cheung <joyeec9h3@gmail.com>\n+Michael Kilburn <crusader.mike@gmail.com>\n+Ruslan Bekenev <furyinbox@gmail.com>"
        },
        {
            "sha": "3ae9d2023e91788d49a903ad7dd7e5bf25d4945b",
            "filename": "deps/uv/ChangeLog",
            "status": "modified",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2FChangeLog",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2FChangeLog",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2FChangeLog?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -1,3 +1,53 @@\n+2018.04.03, Version 1.20.0 (Stable), 0012178ee2b04d9e4a2c66c27cf8891ad8325ceb\n+\n+Changes since version 1.19.2:\n+\n+* unix,spawn: respect user stdio flags for new pipe (Jameson Nash)\n+\n+* Revert \"Revert \"unix,tcp: avoid marking server sockets connected\"\" (Jameson\n+  Nash)\n+\n+* req: revisions to uv_req_t handling (Jameson Nash)\n+\n+* win: remove unnecessary initialization (cjihrig)\n+\n+* win: update uv_os_homedir() to use uv_os_getenv() (cjihrig)\n+\n+* test: fix tcp_oob test flakiness (Santiago Gimeno)\n+\n+* posix: fix uv__pollfds_del() for invalidated fd's (Jesse Gorzinski)\n+\n+* doc: README: add note on installing gyp (Jamie Davis)\n+\n+* unix: refactor uv_os_homedir to use uv_os_getenv (Santiago Gimeno)\n+\n+* unix: fix several instances of lost errno (Michael Kilburn)\n+\n+* win,tty: update several TODO comments (Ruslan Bekenev)\n+\n+* unix: add UV_FS_COPYFILE_FICLONE support (cjihrig)\n+\n+* test: fix connect_unspecified (Santiago Gimeno)\n+\n+* unix,win: add UV_FS_COPYFILE_FICLONE_FORCE support (cjihrig)\n+\n+* win: use long directory name for handle->dirw (Nicholas Vavilov)\n+\n+* build: build with -D_FILE_OFFSET_BITS=64 again (Ben Noordhuis)\n+\n+* win, fs: fix uv_fs_unlink for +R -A files (Bartosz Sosnowski)\n+\n+* win, fs: use FILE_WRITE_ATTRIBUTES when opening files (Bartosz Sosnowski)\n+\n+* unix: use __PASE__ on IBM i platforms (Jesse Gorzinski)\n+\n+* test,freebsd: fix flaky poll tests (Santiago Gimeno)\n+\n+* test: increase connection timeout to 1 second (jBarz)\n+\n+* win,tcp: handle canceled connect with ECANCELED (Jameson Nash)\n+\n+\n 2018.02.22, Version 1.19.2 (Stable), c5afc37e2a8a70d8ab0da8dac10b77ba78c0488c\n \n Changes since version 1.19.1:"
        },
        {
            "sha": "1aaed1a88e7f109b87b5766bf54725e0c298723d",
            "filename": "deps/uv/README.md",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2FREADME.md",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2FREADME.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2FREADME.md?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -169,6 +169,12 @@ $ make check\n $ make install\n ```\n \n+To build with GYP, first run:\n+\n+```bash\n+$ git clone https://chromium.googlesource.com/external/gyp build/gyp\n+```\n+\n ### Windows\n \n Prerequisites:"
        },
        {
            "sha": "d8b50bc4fec5b8cbc63cdee821e777ee1c6401ad",
            "filename": "deps/uv/checksparse.sh",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fchecksparse.sh",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fchecksparse.sh",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fchecksparse.sh?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -184,7 +184,7 @@ AIX)\n            src/unix/aix.c\"\n   ;;\n OS400)\n-  SPARSE_FLAGS=\"$SPARSE_FLAGS -D_PASE=1\"\n+  SPARSE_FLAGS=\"$SPARSE_FLAGS -D__PASE__=1\"\n   SOURCES=\"$SOURCES\n            src/unix/aix-common.c\n            src/unix/ibmi.c"
        },
        {
            "sha": "ee8571ea921034fddf17c3b468eb975d12fb8ee9",
            "filename": "deps/uv/configure.ac",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fconfigure.ac",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fconfigure.ac",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fconfigure.ac?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -13,7 +13,7 @@\n # OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n \n AC_PREREQ(2.57)\n-AC_INIT([libuv], [1.19.2], [https://github.com/libuv/libuv/issues])\n+AC_INIT([libuv], [1.20.0], [https://github.com/libuv/libuv/issues])\n AC_CONFIG_MACRO_DIR([m4])\n m4_include([m4/libuv-extra-automake-flags.m4])\n m4_include([m4/as_case.m4])"
        },
        {
            "sha": "29227be0d64c9c8f36ad9d3264cdacb88291f198",
            "filename": "deps/uv/docs/src/fs.rst",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fdocs%2Fsrc%2Ffs.rst",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fdocs%2Fsrc%2Ffs.rst",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fdocs%2Fsrc%2Ffs.rst?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -249,6 +249,12 @@ API\n     - `UV_FS_COPYFILE_EXCL`: If present, `uv_fs_copyfile()` will fail with\n       `UV_EEXIST` if the destination path already exists. The default behavior\n       is to overwrite the destination if it exists.\n+    - `UV_FS_COPYFILE_FICLONE`: If present, `uv_fs_copyfile()` will attempt to\n+      create a copy-on-write reflink. If the underlying platform does not\n+      support copy-on-write, then a fallback copy mechanism is used.\n+    - `UV_FS_COPYFILE_FICLONE_FORCE`: If present, `uv_fs_copyfile()` will\n+      attempt to create a copy-on-write reflink. If the underlying platform does\n+      not support copy-on-write, then an error is returned.\n \n     .. warning::\n         If the destination path is created, but an error occurs while copying\n@@ -258,6 +264,9 @@ API\n \n     .. versionadded:: 1.14.0\n \n+    .. versionchanged:: 1.20.0 `UV_FS_COPYFILE_FICLONE` and\n+        `UV_FS_COPYFILE_FICLONE_FORCE` are supported.\n+\n .. c:function:: int uv_fs_sendfile(uv_loop_t* loop, uv_fs_t* req, uv_file out_fd, uv_file in_fd, int64_t in_offset, size_t length, uv_fs_cb cb)\n \n     Limited equivalent to :man:`sendfile(2)`."
        },
        {
            "sha": "480a0691ea3e1019c19cae79d7b8b58589144b07",
            "filename": "deps/uv/include/uv-unix.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Finclude%2Fuv-unix.h",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Finclude%2Fuv-unix.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Finclude%2Fuv-unix.h?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -48,7 +48,7 @@\n # include \"uv-linux.h\"\n #elif defined (__MVS__)\n # include \"uv-os390.h\"\n-#elif defined(_PASE)\n+#elif defined(__PASE__)\n # include \"uv-posix.h\"\n #elif defined(_AIX)\n # include \"uv-aix.h\""
        },
        {
            "sha": "392b4d646675ccfaf111748ee9c803410ec8338e",
            "filename": "deps/uv/include/uv-version.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Finclude%2Fuv-version.h",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Finclude%2Fuv-version.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Finclude%2Fuv-version.h?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -31,8 +31,8 @@\n  */\n \n #define UV_VERSION_MAJOR 1\n-#define UV_VERSION_MINOR 19\n-#define UV_VERSION_PATCH 2\n+#define UV_VERSION_MINOR 20\n+#define UV_VERSION_PATCH 0\n #define UV_VERSION_IS_RELEASE 1\n #define UV_VERSION_SUFFIX \"\"\n "
        },
        {
            "sha": "41fad45108ba23b813fbedaef5ea3ecec7d864c0",
            "filename": "deps/uv/include/uv.h",
            "status": "modified",
            "additions": 17,
            "deletions": 3,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Finclude%2Fuv.h",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Finclude%2Fuv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Finclude%2Fuv.h?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -378,8 +378,7 @@ UV_EXTERN const char* uv_err_name(int err);\n   /* read-only */                                                             \\\n   uv_req_type type;                                                           \\\n   /* private */                                                               \\\n-  void* active_queue[2];                                                      \\\n-  void* reserved[4];                                                          \\\n+  void* reserved[6];                                                          \\\n   UV_REQ_PRIVATE_FIELDS                                                       \\\n \n /* Abstract base class of all requests. */\n@@ -1191,6 +1190,18 @@ UV_EXTERN int uv_fs_write(uv_loop_t* loop,\n  */\n #define UV_FS_COPYFILE_EXCL   0x0001\n \n+/*\n+ * This flag can be used with uv_fs_copyfile() to attempt to create a reflink.\n+ * If copy-on-write is not supported, a fallback copy mechanism is used.\n+ */\n+#define UV_FS_COPYFILE_FICLONE 0x0002\n+\n+/*\n+ * This flag can be used with uv_fs_copyfile() to attempt to create a reflink.\n+ * If copy-on-write is not supported, an error is returned.\n+ */\n+#define UV_FS_COPYFILE_FICLONE_FORCE 0x0004\n+\n UV_EXTERN int uv_fs_copyfile(uv_loop_t* loop,\n                              uv_fs_t* req,\n                              const char* path,\n@@ -1531,7 +1542,10 @@ struct uv_loop_s {\n   /* Loop reference counting. */\n   unsigned int active_handles;\n   void* handle_queue[2];\n-  void* active_reqs[2];\n+  union {\n+    void* unused[2];\n+    unsigned int count;\n+  } active_reqs;\n   /* Internal flag to signal loop stop. */\n   unsigned int stop_flag;\n   UV_LOOP_PRIVATE_FIELDS"
        },
        {
            "sha": "18c8fcd808ba2aa4a1b644add13dbe2a61662729",
            "filename": "deps/uv/src/unix/core.c",
            "status": "modified",
            "additions": 7,
            "deletions": 20,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Fcore.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Fcore.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Fcore.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -536,7 +536,7 @@ int uv__close_nocheckstdio(int fd) {\n int uv__close(int fd) {\n   assert(fd > STDERR_FILENO);  /* Catch stdio close bugs. */\n #if defined(__MVS__)\n-  epoll_file_close(fd);\n+  SAVE_ERRNO(epoll_file_close(fd));\n #endif\n   return uv__close_nocheckstdio(fd);\n }\n@@ -1048,29 +1048,16 @@ int uv__dup2_cloexec(int oldfd, int newfd) {\n \n int uv_os_homedir(char* buffer, size_t* size) {\n   uv_passwd_t pwd;\n-  char* buf;\n   size_t len;\n   int r;\n \n-  if (buffer == NULL || size == NULL || *size == 0)\n-    return UV_EINVAL;\n-\n-  /* Check if the HOME environment variable is set first */\n-  buf = getenv(\"HOME\");\n-\n-  if (buf != NULL) {\n-    len = strlen(buf);\n+  /* Check if the HOME environment variable is set first. The task of\n+     performing input validation on buffer and size is taken care of by\n+     uv_os_getenv(). */\n+  r = uv_os_getenv(\"HOME\", buffer, size);\n \n-    if (len >= *size) {\n-      *size = len + 1;\n-      return UV_ENOBUFS;\n-    }\n-\n-    memcpy(buffer, buf, len + 1);\n-    *size = len;\n-\n-    return 0;\n-  }\n+  if (r != UV_ENOENT)\n+    return r;\n \n   /* HOME is not set, so call uv__getpwuid_r() */\n   r = uv__getpwuid_r(&pwd);"
        },
        {
            "sha": "de678733a9c1792f983a4825b034d1e126af4fda",
            "filename": "deps/uv/src/unix/fs.c",
            "status": "modified",
            "additions": 43,
            "deletions": 1,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Ffs.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Ffs.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Ffs.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -62,6 +62,9 @@\n \n #if defined(__APPLE__)\n # include <copyfile.h>\n+#elif defined(__linux__) && !defined(FICLONE)\n+# include <sys/ioctl.h>\n+# define FICLONE _IOW(0x94, 9, int)\n #endif\n \n #define INIT(subtype)                                                         \\\n@@ -790,6 +793,19 @@ static ssize_t uv__fs_copyfile(uv_fs_t* req) {\n   if (req->flags & UV_FS_COPYFILE_EXCL)\n     flags |= COPYFILE_EXCL;\n \n+#ifdef COPYFILE_CLONE\n+  if (req->flags & UV_FS_COPYFILE_FICLONE)\n+    flags |= COPYFILE_CLONE;\n+#endif\n+\n+  if (req->flags & UV_FS_COPYFILE_FICLONE_FORCE) {\n+#ifdef COPYFILE_CLONE_FORCE\n+    flags |= COPYFILE_CLONE_FORCE;\n+#else\n+    return UV_ENOSYS;\n+#endif\n+  }\n+\n   return copyfile(req->path, req->new_path, NULL, flags);\n #else\n   uv_fs_t fs_req;\n@@ -842,6 +858,29 @@ static ssize_t uv__fs_copyfile(uv_fs_t* req) {\n     goto out;\n   }\n \n+#ifdef FICLONE\n+  if (req->flags & UV_FS_COPYFILE_FICLONE ||\n+      req->flags & UV_FS_COPYFILE_FICLONE_FORCE) {\n+    if (ioctl(dstfd, FICLONE, srcfd) == -1) {\n+      /* If an error occurred that the sendfile fallback also won't handle, or\n+         this is a force clone then exit. Otherwise, fall through to try using\n+         sendfile(). */\n+      if ((errno != ENOTTY && errno != EOPNOTSUPP && errno != EXDEV) ||\n+          req->flags & UV_FS_COPYFILE_FICLONE_FORCE) {\n+        err = -errno;\n+        goto out;\n+      }\n+    } else {\n+      goto out;\n+    }\n+  }\n+#else\n+  if (req->flags & UV_FS_COPYFILE_FICLONE_FORCE) {\n+    err = UV_ENOSYS;\n+    goto out;\n+  }\n+#endif\n+\n   bytes_to_send = statsbuf.st_size;\n   in_offset = 0;\n   while (bytes_to_send != 0) {\n@@ -1504,8 +1543,11 @@ int uv_fs_copyfile(uv_loop_t* loop,\n                    uv_fs_cb cb) {\n   INIT(COPYFILE);\n \n-  if (flags & ~UV_FS_COPYFILE_EXCL)\n+  if (flags & ~(UV_FS_COPYFILE_EXCL |\n+                UV_FS_COPYFILE_FICLONE |\n+                UV_FS_COPYFILE_FICLONE_FORCE)) {\n     return UV_EINVAL;\n+  }\n \n   PATH2;\n   req->flags = flags;"
        },
        {
            "sha": "b6df1ab9d3e52d2bd7ce76e00d7c30a27d2a0890",
            "filename": "deps/uv/src/unix/internal.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Finternal.h",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Finternal.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Finternal.h?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -190,7 +190,7 @@ int uv__cloexec_ioctl(int fd, int set);\n int uv__cloexec_fcntl(int fd, int set);\n int uv__nonblock_ioctl(int fd, int set);\n int uv__nonblock_fcntl(int fd, int set);\n-int uv__close(int fd);\n+int uv__close(int fd); /* preserves errno */\n int uv__close_nocheckstdio(int fd);\n int uv__socket(int domain, int type, int protocol);\n int uv__dup(int fd);"
        },
        {
            "sha": "99ead6cbc0cac22bd8233cc27fa3b1d883f4e50c",
            "filename": "deps/uv/src/unix/loop.c",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Floop.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Floop.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Floop.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -38,13 +38,14 @@ int uv_loop_init(uv_loop_t* loop) {\n \n   heap_init((struct heap*) &loop->timer_heap);\n   QUEUE_INIT(&loop->wq);\n-  QUEUE_INIT(&loop->active_reqs);\n   QUEUE_INIT(&loop->idle_handles);\n   QUEUE_INIT(&loop->async_handles);\n   QUEUE_INIT(&loop->check_handles);\n   QUEUE_INIT(&loop->prepare_handles);\n   QUEUE_INIT(&loop->handle_queue);\n \n+  loop->active_handles = 0;\n+  loop->active_reqs.count = 0;\n   loop->nfds = 0;\n   loop->watchers = NULL;\n   loop->nwatchers = 0;"
        },
        {
            "sha": "f3181f9b726278cc7a94e333245d7a96c8bb07ed",
            "filename": "deps/uv/src/unix/posix-poll.c",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Fposix-poll.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Fposix-poll.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Fposix-poll.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -107,15 +107,25 @@ static void uv__pollfds_add(uv_loop_t* loop, uv__io_t* w) {\n static void uv__pollfds_del(uv_loop_t* loop, int fd) {\n   size_t i;\n   assert(!loop->poll_fds_iterating);\n-  for (i = 0; i < loop->poll_fds_used; ++i) {\n+  for (i = 0; i < loop->poll_fds_used;) {\n     if (loop->poll_fds[i].fd == fd) {\n       /* swap to last position and remove */\n       --loop->poll_fds_used;\n       uv__pollfds_swap(loop, i, loop->poll_fds_used);\n       loop->poll_fds[loop->poll_fds_used].fd = -1;\n       loop->poll_fds[loop->poll_fds_used].events = 0;\n       loop->poll_fds[loop->poll_fds_used].revents = 0;\n-      return;\n+      /* This method is called with an fd of -1 to purge the invalidated fds,\n+       * so we may possibly have multiples to remove.\n+       */\n+      if (-1 != fd)\n+        return;\n+    } else {\n+      /* We must only increment the loop counter when the fds do not match.\n+       * Otherwise, when we are purging an invalidated fd, the value just\n+       * swapped here from the previous end of the array will be skipped.\n+       */\n+       ++i;\n     }\n   }\n }"
        },
        {
            "sha": "3a3cfd6f092fa468eb9654c5637662e1a4a48996",
            "filename": "deps/uv/src/unix/process.c",
            "status": "modified",
            "additions": 7,
            "deletions": 10,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Fprocess.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Fprocess.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Fprocess.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -223,8 +223,7 @@ static int uv__process_init_stdio(uv_stdio_container_t* container, int fds[2]) {\n \n \n static int uv__process_open_stream(uv_stdio_container_t* container,\n-                                   int pipefds[2],\n-                                   int writable) {\n+                                   int pipefds[2]) {\n   int flags;\n   int err;\n \n@@ -238,13 +237,11 @@ static int uv__process_open_stream(uv_stdio_container_t* container,\n   pipefds[1] = -1;\n   uv__nonblock(pipefds[0], 1);\n \n-  if (container->data.stream->type == UV_NAMED_PIPE &&\n-      ((uv_pipe_t*)container->data.stream)->ipc)\n-    flags = UV_STREAM_READABLE | UV_STREAM_WRITABLE;\n-  else if (writable)\n-    flags = UV_STREAM_WRITABLE;\n-  else\n-    flags = UV_STREAM_READABLE;\n+  flags = 0;\n+  if (container->flags & UV_WRITABLE_PIPE)\n+    flags |= UV_STREAM_READABLE;\n+  if (container->flags & UV_READABLE_PIPE)\n+    flags |= UV_STREAM_WRITABLE;\n \n   return uv__stream_open(container->data.stream, pipefds[0], flags);\n }\n@@ -533,7 +530,7 @@ int uv_spawn(uv_loop_t* loop,\n   uv__close_nocheckstdio(signal_pipe[0]);\n \n   for (i = 0; i < options->stdio_count; i++) {\n-    err = uv__process_open_stream(options->stdio + i, pipes[i], i == 0);\n+    err = uv__process_open_stream(options->stdio + i, pipes[i]);\n     if (err == 0)\n       continue;\n "
        },
        {
            "sha": "5ec6bf4de29efc264b14136ab3dd52c21e478ae6",
            "filename": "deps/uv/src/unix/stream.c",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Fstream.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Fstream.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Fstream.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -1417,6 +1417,9 @@ int uv_write2(uv_write_t* req,\n   if (uv__stream_fd(stream) < 0)\n     return UV_EBADF;\n \n+  if (!(stream->flags & UV_STREAM_WRITABLE))\n+    return -EPIPE;\n+\n   if (send_handle) {\n     if (stream->type != UV_NAMED_PIPE || !((uv_pipe_t*)stream)->ipc)\n       return UV_EINVAL;\n@@ -1568,6 +1571,9 @@ int uv_read_start(uv_stream_t* stream,\n   if (stream->flags & UV_CLOSING)\n     return UV_EINVAL;\n \n+  if (!(stream->flags & UV_STREAM_READABLE))\n+    return -ENOTCONN;\n+\n   /* The UV_STREAM_READING flag is irrelevant of the state of the tcp - it just\n    * expresses the desired state of the user.\n    */"
        },
        {
            "sha": "336d8e29205390f514b0dfbb5a201dbd30947951",
            "filename": "deps/uv/src/unix/tcp.c",
            "status": "modified",
            "additions": 7,
            "deletions": 11,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Ftcp.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Funix%2Ftcp.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Ftcp.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -49,16 +49,14 @@ static int new_socket(uv_tcp_t* handle, int domain, unsigned long flags) {\n     /* Bind this new socket to an arbitrary port */\n     slen = sizeof(saddr);\n     memset(&saddr, 0, sizeof(saddr));\n-    err = getsockname(uv__stream_fd(handle), (struct sockaddr*) &saddr, &slen);\n-    if (err) {\n+    if (getsockname(uv__stream_fd(handle), (struct sockaddr*) &saddr, &slen)) {\n       uv__close(sockfd);\n-      return err;\n+      return UV__ERR(errno);\n     }\n \n-    err = bind(uv__stream_fd(handle), (struct sockaddr*) &saddr, slen);\n-    if (err) {\n+    if (bind(uv__stream_fd(handle), (struct sockaddr*) &saddr, slen)) {\n       uv__close(sockfd);\n-      return err;\n+      return UV__ERR(errno);\n     }\n   }\n \n@@ -158,9 +156,7 @@ int uv__tcp_bind(uv_tcp_t* tcp,\n   if ((flags & UV_TCP_IPV6ONLY) && addr->sa_family != AF_INET6)\n     return UV_EINVAL;\n \n-  err = maybe_new_socket(tcp,\n-                         addr->sa_family,\n-                         UV_STREAM_READABLE | UV_STREAM_WRITABLE);\n+  err = maybe_new_socket(tcp, addr->sa_family, 0);\n   if (err)\n     return err;\n \n@@ -335,14 +331,14 @@ int uv_tcp_listen(uv_tcp_t* tcp, int backlog, uv_connection_cb cb) {\n   if (single_accept)\n     tcp->flags |= UV_TCP_SINGLE_ACCEPT;\n \n-  flags = UV_STREAM_READABLE;\n+  flags = 0;\n #if defined(__MVS__)\n   /* on zOS the listen call does not bind automatically\n      if the socket is unbound. Hence the manual binding to\n      an arbitrary port is required to be done manually\n   */\n   flags |= UV_HANDLE_BOUND;\n-#endif  \n+#endif\n   err = maybe_new_socket(tcp, AF_INET, flags);\n   if (err)\n     return err;"
        },
        {
            "sha": "71345895697732a93fc2442d1e5206d7e0dbbfc1",
            "filename": "deps/uv/src/uv-common.c",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fuv-common.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fuv-common.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fuv-common.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -627,7 +627,7 @@ int uv_loop_close(uv_loop_t* loop) {\n   void* saved_data;\n #endif\n \n-  if (!QUEUE_EMPTY(&(loop)->active_reqs))\n+  if (uv__has_active_reqs(loop))\n     return UV_EBUSY;\n \n   QUEUE_FOREACH(q, &loop->handle_queue) {"
        },
        {
            "sha": "c497d014fd77f7683819ed3ead3318bb4f3793e3",
            "filename": "deps/uv/src/uv-common.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fuv-common.h",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fuv-common.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fuv-common.h?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -133,18 +133,18 @@ int uv__socket_sockopt(uv_handle_t* handle, int optname, int* value);\n void uv__fs_scandir_cleanup(uv_fs_t* req);\n \n #define uv__has_active_reqs(loop)                                             \\\n-  (QUEUE_EMPTY(&(loop)->active_reqs) == 0)\n+  ((loop)->active_reqs.count > 0)\n \n #define uv__req_register(loop, req)                                           \\\n   do {                                                                        \\\n-    QUEUE_INSERT_TAIL(&(loop)->active_reqs, &(req)->active_queue);            \\\n+    (loop)->active_reqs.count++;                                              \\\n   }                                                                           \\\n   while (0)\n \n #define uv__req_unregister(loop, req)                                         \\\n   do {                                                                        \\\n     assert(uv__has_active_reqs(loop));                                        \\\n-    QUEUE_REMOVE(&(req)->active_queue);                                       \\\n+    (loop)->active_reqs.count--;                                              \\\n   }                                                                           \\\n   while (0)\n "
        },
        {
            "sha": "5fa9b6666dab5a455923567e6fe80fffb2888de1",
            "filename": "deps/uv/src/win/core.c",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Fcore.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Fcore.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Fcore.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -239,7 +239,7 @@ int uv_loop_init(uv_loop_t* loop) {\n \n   QUEUE_INIT(&loop->wq);\n   QUEUE_INIT(&loop->handle_queue);\n-  QUEUE_INIT(&loop->active_reqs);\n+  loop->active_reqs.count = 0;\n   loop->active_handles = 0;\n \n   loop->pending_reqs_tail = NULL;\n@@ -470,8 +470,8 @@ static void uv_poll_ex(uv_loop_t* loop, DWORD timeout) {\n \n \n static int uv__loop_alive(const uv_loop_t* loop) {\n-  return loop->active_handles > 0 ||\n-         !QUEUE_EMPTY(&loop->active_reqs) ||\n+  return uv__has_active_handles(loop) ||\n+         uv__has_active_reqs(loop) ||\n          loop->endgame_handles != NULL;\n }\n "
        },
        {
            "sha": "14c9af9ad754d60bb1bb0783b4baa8a6f48877a2",
            "filename": "deps/uv/src/win/fs-event.c",
            "status": "modified",
            "additions": 27,
            "deletions": 2,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Ffs-event.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Ffs-event.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Ffs-event.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -69,6 +69,7 @@ static void uv_relative_path(const WCHAR* filename,\n   size_t relpathlen;\n   size_t filenamelen = wcslen(filename);\n   size_t dirlen = wcslen(dir);\n+  assert(!_wcsnicmp(filename, dir, dirlen));\n   if (dirlen > 0 && dir[dirlen - 1] == '\\\\')\n     dirlen--;\n   relpathlen = filenamelen - dirlen - 1;\n@@ -151,11 +152,11 @@ int uv_fs_event_start(uv_fs_event_t* handle,\n                       uv_fs_event_cb cb,\n                       const char* path,\n                       unsigned int flags) {\n-  int name_size, is_path_dir;\n+  int name_size, is_path_dir, size;\n   DWORD attr, last_error;\n   WCHAR* dir = NULL, *dir_to_watch, *pathw = NULL;\n   WCHAR short_path_buffer[MAX_PATH];\n-  WCHAR* short_path;\n+  WCHAR* short_path, *long_path;\n \n   if (uv__is_active(handle))\n     return UV_EINVAL;\n@@ -197,6 +198,30 @@ int uv_fs_event_start(uv_fs_event_t* handle,\n \n   if (is_path_dir) {\n      /* path is a directory, so that's the directory that we will watch. */\n+\n+    /* Convert to long path. */\n+    size = GetLongPathNameW(pathw, NULL, 0);\n+\n+    if (size) {\n+      long_path = (WCHAR*)uv__malloc(size * sizeof(WCHAR));\n+      if (!long_path) {\n+        uv_fatal_error(ERROR_OUTOFMEMORY, \"uv__malloc\");\n+      }\n+\n+      size = GetLongPathNameW(pathw, long_path, size);\n+      if (size) {\n+        long_path[size] = '\\0';\n+      } else {\n+        uv__free(long_path);\n+        long_path = NULL;\n+      }\n+    }\n+\n+    if (long_path) {\n+      uv__free(pathw);\n+      pathw = long_path;\n+    }\n+\n     dir_to_watch = pathw;\n   } else {\n     /*"
        },
        {
            "sha": "b07d47cf56be6a54885da6341347d78ad62f6f77",
            "filename": "deps/uv/src/win/fs.c",
            "status": "modified",
            "additions": 15,
            "deletions": 3,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Ffs.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Ffs.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Ffs.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -245,7 +245,6 @@ INLINE static void uv_fs_req_init(uv_loop_t* loop, uv_fs_t* req,\n   req->ptr = NULL;\n   req->path = NULL;\n   req->cb = cb;\n-  req->fs.info.bufs = NULL;\n   memset(&req->fs, 0, sizeof(req->fs));\n }\n \n@@ -435,6 +434,8 @@ void fs__open(uv_fs_t* req) {\n     access |= FILE_APPEND_DATA;\n   }\n \n+  access |= FILE_WRITE_ATTRIBUTES;\n+\n   /*\n    * Here is where we deviate significantly from what CRT's _open()\n    * does. We indiscriminately use all the sharing modes, to match\n@@ -784,7 +785,9 @@ void fs__unlink(uv_fs_t* req) {\n     /* Remove read-only attribute */\n     FILE_BASIC_INFORMATION basic = { 0 };\n \n-    basic.FileAttributes = info.dwFileAttributes & ~(FILE_ATTRIBUTE_READONLY);\n+    basic.FileAttributes = info.dwFileAttributes\n+                           & ~(FILE_ATTRIBUTE_READONLY)\n+                           | FILE_ATTRIBUTE_ARCHIVE;\n \n     status = pNtSetInformationFile(handle,\n                                    &iosb,\n@@ -1391,6 +1394,12 @@ static void fs__copyfile(uv_fs_t* req) {\n   int overwrite;\n \n   flags = req->fs.info.file_flags;\n+\n+  if (flags & UV_FS_COPYFILE_FICLONE_FORCE) {\n+    SET_REQ_UV_ERROR(req, UV_ENOSYS, ERROR_NOT_SUPPORTED);\n+    return;\n+  }\n+\n   overwrite = flags & UV_FS_COPYFILE_EXCL;\n \n   if (CopyFileW(req->file.pathw, req->fs.info.new_pathw, overwrite) == 0) {\n@@ -2335,8 +2344,11 @@ int uv_fs_copyfile(uv_loop_t* loop,\n \n   INIT(UV_FS_COPYFILE);\n \n-  if (flags & ~UV_FS_COPYFILE_EXCL)\n+  if (flags & ~(UV_FS_COPYFILE_EXCL |\n+                UV_FS_COPYFILE_FICLONE |\n+                UV_FS_COPYFILE_FICLONE_FORCE)) {\n     return UV_EINVAL;\n+  }\n \n   err = fs__capture_path(req, path, new_path, cb != NULL);\n "
        },
        {
            "sha": "cce4e204d265520c0fb48ab4aed558f504d28cf6",
            "filename": "deps/uv/src/win/internal.h",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Finternal.h",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Finternal.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Finternal.h?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -221,10 +221,16 @@ void uv_process_tty_read_req(uv_loop_t* loop, uv_tty_t* handle,\n     uv_req_t* req);\n void uv_process_tty_write_req(uv_loop_t* loop, uv_tty_t* handle,\n     uv_write_t* req);\n-/* TODO: remove me */\n+/*\n+ * uv_process_tty_accept_req() is a stub to keep DELEGATE_STREAM_REQ working\n+ * TODO: find a way to remove it\n+ */\n void uv_process_tty_accept_req(uv_loop_t* loop, uv_tty_t* handle,\n     uv_req_t* raw_req);\n-/* TODO: remove me */\n+/*\n+ * uv_process_tty_connect_req() is a stub to keep DELEGATE_STREAM_REQ working\n+ * TODO: find a way to remove it\n+ */\n void uv_process_tty_connect_req(uv_loop_t* loop, uv_tty_t* handle,\n     uv_connect_t* req);\n "
        },
        {
            "sha": "0ecfbf1f0e5145bf94cbc7f544309cfbaed163f0",
            "filename": "deps/uv/src/win/pipe.c",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Fpipe.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Fpipe.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Fpipe.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -847,6 +847,7 @@ static void uv_pipe_queue_accept(uv_loop_t* loop, uv_pipe_t* handle,\n     return;\n   }\n \n+  /* Wait for completion via IOCP */\n   handle->reqs_pending++;\n }\n "
        },
        {
            "sha": "40f5ddd51ea5a5e9a0cb7a8afa49fb42dc93e0c8",
            "filename": "deps/uv/src/win/stream-inl.h",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Fstream-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Fstream-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Fstream-inl.h?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -37,11 +37,6 @@ INLINE static void uv_stream_init(uv_loop_t* loop,\n   handle->write_queue_size = 0;\n   handle->activecnt = 0;\n   handle->stream.conn.shutdown_req = NULL;\n-}\n-\n-\n-INLINE static void uv_connection_init(uv_stream_t* handle) {\n-  handle->flags |= UV_HANDLE_CONNECTION;\n   handle->stream.conn.write_reqs_pending = 0;\n \n   UV_REQ_INIT(&handle->read_req, UV_READ);\n@@ -51,4 +46,9 @@ INLINE static void uv_connection_init(uv_stream_t* handle) {\n }\n \n \n+INLINE static void uv_connection_init(uv_stream_t* handle) {\n+  handle->flags |= UV_HANDLE_CONNECTION;\n+}\n+\n+\n #endif /* UV_WIN_STREAM_INL_H_ */"
        },
        {
            "sha": "39c1ff05658c5d58e7a14123c73200cb4266c00c",
            "filename": "deps/uv/src/win/tcp.c",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Ftcp.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Ftcp.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Ftcp.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -459,8 +459,6 @@ static void uv_tcp_queue_accept(uv_tcp_t* handle, uv_tcp_accept_t* req) {\n           INFINITE, WT_EXECUTEINWAITTHREAD)) {\n       SET_REQ_ERROR(req, GetLastError());\n       uv_insert_pending_req(loop, (uv_req_t*)req);\n-      handle->reqs_pending++;\n-      return;\n     }\n   } else {\n     /* Make this req pending reporting an error. */\n@@ -1173,11 +1171,14 @@ void uv_process_tcp_connect_req(uv_loop_t* loop, uv_tcp_t* handle,\n \n   err = 0;\n   if (REQ_SUCCESS(req)) {\n-    if (setsockopt(handle->socket,\n-                    SOL_SOCKET,\n-                    SO_UPDATE_CONNECT_CONTEXT,\n-                    NULL,\n-                    0) == 0) {\n+    if (handle->flags & UV__HANDLE_CLOSING) {\n+      /* use UV_ECANCELED for consistency with Unix */\n+      err = ERROR_OPERATION_ABORTED;\n+    } else if (setsockopt(handle->socket,\n+                          SOL_SOCKET,\n+                          SO_UPDATE_CONNECT_CONTEXT,\n+                          NULL,\n+                          0) == 0) {\n       uv_connection_init((uv_stream_t*)handle);\n       handle->flags |= UV_HANDLE_READABLE | UV_HANDLE_WRITABLE;\n       loop->active_tcp_streams++;"
        },
        {
            "sha": "ecf7bc9b5b671002bcd1c301e53e1bd379d6bb28",
            "filename": "deps/uv/src/win/tty.c",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Ftty.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Ftty.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Ftty.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -2235,14 +2235,20 @@ void uv_tty_endgame(uv_loop_t* loop, uv_tty_t* handle) {\n }\n \n \n-/* TODO: remove me */\n+/*\n+ * uv_process_tty_accept_req() is a stub to keep DELEGATE_STREAM_REQ working\n+ * TODO: find a way to remove it\n+ */\n void uv_process_tty_accept_req(uv_loop_t* loop, uv_tty_t* handle,\n     uv_req_t* raw_req) {\n   abort();\n }\n \n \n-/* TODO: remove me */\n+/*\n+ * uv_process_tty_connect_req() is a stub to keep DELEGATE_STREAM_REQ working\n+ * TODO: find a way to remove it\n+ */\n void uv_process_tty_connect_req(uv_loop_t* loop, uv_tty_t* handle,\n     uv_connect_t* req) {\n   abort();"
        },
        {
            "sha": "3c1d9bed1dbd4b8bbd8116b0a1799b34f74e2c2e",
            "filename": "deps/uv/src/win/util.c",
            "status": "modified",
            "additions": 7,
            "deletions": 43,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Futil.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fsrc%2Fwin%2Futil.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Futil.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -1148,53 +1148,17 @@ int uv_getrusage(uv_rusage_t *uv_rusage) {\n \n int uv_os_homedir(char* buffer, size_t* size) {\n   uv_passwd_t pwd;\n-  wchar_t path[MAX_PATH];\n-  DWORD bufsize;\n   size_t len;\n   int r;\n \n-  if (buffer == NULL || size == NULL || *size == 0)\n-    return UV_EINVAL;\n-\n-  /* Check if the USERPROFILE environment variable is set first */\n-  len = GetEnvironmentVariableW(L\"USERPROFILE\", path, MAX_PATH);\n-\n-  if (len == 0) {\n-    r = GetLastError();\n-\n-    /* Don't return an error if USERPROFILE was not found */\n-    if (r != ERROR_ENVVAR_NOT_FOUND)\n-      return uv_translate_sys_error(r);\n-  } else if (len > MAX_PATH) {\n-    /* This should not be possible */\n-    return UV_EIO;\n-  } else {\n-    /* Check how much space we need */\n-    bufsize = WideCharToMultiByte(CP_UTF8, 0, path, -1, NULL, 0, NULL, NULL);\n-\n-    if (bufsize == 0) {\n-      return uv_translate_sys_error(GetLastError());\n-    } else if (bufsize > *size) {\n-      *size = bufsize;\n-      return UV_ENOBUFS;\n-    }\n-\n-    /* Convert to UTF-8 */\n-    bufsize = WideCharToMultiByte(CP_UTF8,\n-                                  0,\n-                                  path,\n-                                  -1,\n-                                  buffer,\n-                                  *size,\n-                                  NULL,\n-                                  NULL);\n-\n-    if (bufsize == 0)\n-      return uv_translate_sys_error(GetLastError());\n+  /* Check if the USERPROFILE environment variable is set first. The task of\n+     performing input validation on buffer and size is taken care of by\n+     uv_os_getenv(). */\n+  r = uv_os_getenv(\"USERPROFILE\", buffer, size);\n \n-    *size = bufsize - 1;\n-    return 0;\n-  }\n+  /* Don't return an error if USERPROFILE was not found. */\n+  if (r != UV_ENOENT)\n+    return r;\n \n   /* USERPROFILE is not set, so call uv__getpwuid_r() */\n   r = uv__getpwuid_r(&pwd);"
        },
        {
            "sha": "5f32b67a6a4daaccaec0496d812cea134173286c",
            "filename": "deps/uv/test/test-connect-unspecified.c",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-connect-unspecified.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-connect-unspecified.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-connect-unspecified.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -48,12 +48,14 @@ TEST_IMPL(connect_unspecified) {\n                         (const struct sockaddr*) &addr4,\n                         connect_4) == 0);\n \n-  ASSERT(uv_tcp_init(loop, &socket6) == 0);\n-  ASSERT(uv_ip6_addr(\"::\", TEST_PORT, &addr6) == 0);\n-  ASSERT(uv_tcp_connect(&connect6,\n-                        &socket6,\n-                        (const struct sockaddr*) &addr6,\n-                        connect_6) == 0);\n+  if (can_ipv6()) {\n+    ASSERT(uv_tcp_init(loop, &socket6) == 0);\n+    ASSERT(uv_ip6_addr(\"::\", TEST_PORT, &addr6) == 0);\n+    ASSERT(uv_tcp_connect(&connect6,\n+                          &socket6,\n+                          (const struct sockaddr*) &addr6,\n+                          connect_6) == 0);\n+  }\n \n   ASSERT(uv_run(loop, UV_RUN_DEFAULT) == 0);\n "
        },
        {
            "sha": "6cd43b450290f7ac3212aaa4d073ac67281d8111",
            "filename": "deps/uv/test/test-fs-copyfile.c",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-fs-copyfile.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-fs-copyfile.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-fs-copyfile.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -168,6 +168,22 @@ TEST_IMPL(fs_copyfile) {\n   r = uv_fs_copyfile(loop, &req, fixture, dst, -1, fail_cb);\n   ASSERT(r == UV_EINVAL);\n   uv_run(loop, UV_RUN_DEFAULT);\n+\n+  /* Copies file using UV_FS_COPYFILE_FICLONE. */\n+  unlink(dst);\n+  r = uv_fs_copyfile(NULL, &req, fixture, dst, UV_FS_COPYFILE_FICLONE, NULL);\n+  ASSERT(r == 0);\n+  handle_result(&req);\n+\n+  /* Copies file using UV_FS_COPYFILE_FICLONE_FORCE. */\n+  unlink(dst);\n+  r = uv_fs_copyfile(NULL, &req, fixture, dst, UV_FS_COPYFILE_FICLONE_FORCE,\n+                     NULL);\n+  ASSERT(r == 0 || r == UV_ENOSYS || r == UV_ENOTSUP || r == UV_ENOTTY);\n+\n+  if (r == 0)\n+    handle_result(&req);\n+\n   unlink(dst); /* Cleanup */\n   return 0;\n }"
        },
        {
            "sha": "5ddccffd0a98e9f586ccd0e95da4f0eedff6b869",
            "filename": "deps/uv/test/test-fs-event.c",
            "status": "modified",
            "additions": 37,
            "deletions": 1,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-fs-event.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-fs-event.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-fs-event.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -129,7 +129,7 @@ static void fs_event_cb_dir(uv_fs_event_t* handle, const char* filename,\n   ++fs_event_cb_called;\n   ASSERT(handle == &fs_event);\n   ASSERT(status == 0);\n-  ASSERT(events == UV_RENAME);\n+  ASSERT(events == UV_CHANGE);\n   #if defined(__APPLE__) || defined(_WIN32) || defined(__linux__)\n   ASSERT(strcmp(filename, \"file1\") == 0);\n   #else\n@@ -477,6 +477,42 @@ TEST_IMPL(fs_event_watch_dir_recursive) {\n #endif\n }\n \n+#ifdef _WIN32\n+TEST_IMPL(fs_event_watch_dir_short_path) {\n+  uv_loop_t* loop;\n+  int r;\n+\n+  /* Setup */\n+  loop = uv_default_loop();\n+  remove(\"watch_dir/file1\");\n+  remove(\"watch_dir/\");\n+  create_dir(\"watch_dir\");\n+  create_file(\"watch_dir/file1\");\n+\n+  r = uv_fs_event_init(loop, &fs_event);\n+  ASSERT(r == 0);\n+  r = uv_fs_event_start(&fs_event, fs_event_cb_dir, \"watch_~1\", 0);\n+  ASSERT(r == 0);\n+  r = uv_timer_init(loop, &timer);\n+  ASSERT(r == 0);\n+  r = uv_timer_start(&timer, timer_cb_file, 100, 0);\n+  ASSERT(r == 0);\n+\n+  uv_run(loop, UV_RUN_DEFAULT);\n+\n+  ASSERT(fs_event_cb_called == 1);\n+  ASSERT(timer_cb_called == 1);\n+  ASSERT(close_cb_called == 1);\n+\n+  /* Cleanup */\n+  remove(\"watch_dir/file1\");\n+  remove(\"watch_dir/\");\n+\n+  MAKE_VALGRIND_HAPPY();\n+  return 0;\n+}\n+#endif\n+\n \n TEST_IMPL(fs_event_watch_file) {\n #if defined(NO_FS_EVENTS)"
        },
        {
            "sha": "0075a02be663ceb75ec95e0876021edb02eca0ed",
            "filename": "deps/uv/test/test-fs.c",
            "status": "modified",
            "additions": 80,
            "deletions": 0,
            "changes": 80,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-fs.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-fs.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-fs.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -1367,6 +1367,28 @@ TEST_IMPL(fs_chmod) {\n \n   check_permission(\"test_file\", 0600);\n \n+#ifdef _WIN32\n+  /* Test clearing read-only flag from files with Archive flag cleared */\n+  /* Make the file read-only and clear archive flag */\n+  r = SetFileAttributes(\"test_file\", FILE_ATTRIBUTE_READONLY);\n+  ASSERT(r != 0);\n+  check_permission(\"test_file\", 0400);\n+\n+  r = uv_fs_open(NULL, &req, \"test_file\", 0, 0, NULL);\n+  ASSERT(r >= 0);\n+  ASSERT(req.result >= 0);\n+  uv_fs_req_cleanup(&req);\n+\n+  r = uv_fs_fchmod(NULL, &req, file, 0600, NULL);\n+  ASSERT(r == 0);\n+  ASSERT(req.result == 0);\n+  uv_fs_req_cleanup(&req);\n+\n+  check_permission(\"test_file\", 0600);\n+  /* Restore Archive flag for rest of the tests */\n+  r = SetFileAttributes(\"test_file\", FILE_ATTRIBUTE_ARCHIVE);\n+  ASSERT(r != 0);\n+#endif\n #ifndef _WIN32\n   /* async chmod */\n   {\n@@ -1474,6 +1496,64 @@ TEST_IMPL(fs_unlink_readonly) {\n   return 0;\n }\n \n+#ifdef _WIN32\n+TEST_IMPL(fs_unlink_archive_readonly) {\n+  int r;\n+  uv_fs_t req;\n+  uv_file file;\n+\n+  /* Setup. */\n+  unlink(\"test_file\");\n+\n+  loop = uv_default_loop();\n+\n+  r = uv_fs_open(NULL,\n+                 &req,\n+                 \"test_file\",\n+                 O_RDWR | O_CREAT,\n+                 S_IWUSR | S_IRUSR,\n+                 NULL);\n+  ASSERT(r >= 0);\n+  ASSERT(req.result >= 0);\n+  file = req.result;\n+  uv_fs_req_cleanup(&req);\n+\n+  iov = uv_buf_init(test_buf, sizeof(test_buf));\n+  r = uv_fs_write(NULL, &req, file, &iov, 1, -1, NULL);\n+  ASSERT(r == sizeof(test_buf));\n+  ASSERT(req.result == sizeof(test_buf));\n+  uv_fs_req_cleanup(&req);\n+\n+  close(file);\n+\n+  /* Make the file read-only and clear archive flag */\n+  r = SetFileAttributes(\"test_file\", FILE_ATTRIBUTE_READONLY);\n+  ASSERT(r != 0);\n+  uv_fs_req_cleanup(&req);\n+\n+  check_permission(\"test_file\", 0400);\n+\n+  /* Try to unlink the file */\n+  r = uv_fs_unlink(NULL, &req, \"test_file\", NULL);\n+  ASSERT(r == 0);\n+  ASSERT(req.result == 0);\n+  uv_fs_req_cleanup(&req);\n+\n+  /*\n+  * Run the loop just to check we don't have make any extraneous uv_ref()\n+  * calls. This should drop out immediately.\n+  */\n+  uv_run(loop, UV_RUN_DEFAULT);\n+\n+  /* Cleanup. */\n+  uv_fs_chmod(NULL, &req, \"test_file\", 0600, NULL);\n+  uv_fs_req_cleanup(&req);\n+  unlink(\"test_file\");\n+\n+  MAKE_VALGRIND_HAPPY();\n+  return 0;\n+}\n+#endif\n \n TEST_IMPL(fs_chown) {\n   int r;"
        },
        {
            "sha": "b89930d709e6ec9d097d4cbd5e09dfa0ce69bca5",
            "filename": "deps/uv/test/test-list.h",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-list.h",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-list.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-list.h?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -95,6 +95,7 @@ TEST_DECLARE   (tcp_bind_error_fault)\n TEST_DECLARE   (tcp_bind_error_inval)\n TEST_DECLARE   (tcp_bind_localhost_ok)\n TEST_DECLARE   (tcp_bind_invalid_flags)\n+TEST_DECLARE   (tcp_bind_writable_flags)\n TEST_DECLARE   (tcp_listen_without_bind)\n TEST_DECLARE   (tcp_connect_error_fault)\n TEST_DECLARE   (tcp_connect_timeout)\n@@ -283,6 +284,9 @@ TEST_DECLARE   (fs_access)\n TEST_DECLARE   (fs_chmod)\n TEST_DECLARE   (fs_copyfile)\n TEST_DECLARE   (fs_unlink_readonly)\n+#ifdef _WIN32\n+TEST_DECLARE   (fs_unlink_archive_readonly)\n+#endif\n TEST_DECLARE   (fs_chown)\n TEST_DECLARE   (fs_link)\n TEST_DECLARE   (fs_readlink)\n@@ -300,6 +304,9 @@ TEST_DECLARE   (fs_stat_missing_path)\n TEST_DECLARE   (fs_read_file_eof)\n TEST_DECLARE   (fs_event_watch_dir)\n TEST_DECLARE   (fs_event_watch_dir_recursive)\n+#ifdef _WIN32\n+TEST_DECLARE   (fs_event_watch_dir_short_path)\n+#endif\n TEST_DECLARE   (fs_event_watch_file)\n TEST_DECLARE   (fs_event_watch_file_exact_path)\n TEST_DECLARE   (fs_event_watch_file_twice)\n@@ -535,6 +542,7 @@ TASK_LIST_START\n   TEST_ENTRY  (tcp_bind_error_inval)\n   TEST_ENTRY  (tcp_bind_localhost_ok)\n   TEST_ENTRY  (tcp_bind_invalid_flags)\n+  TEST_ENTRY  (tcp_bind_writable_flags)\n   TEST_ENTRY  (tcp_listen_without_bind)\n   TEST_ENTRY  (tcp_connect_error_fault)\n   TEST_ENTRY  (tcp_connect_timeout)\n@@ -810,6 +818,9 @@ TASK_LIST_START\n   TEST_ENTRY  (fs_chmod)\n   TEST_ENTRY  (fs_copyfile)\n   TEST_ENTRY  (fs_unlink_readonly)\n+#ifdef _WIN32\n+  TEST_ENTRY  (fs_unlink_archive_readonly)\n+#endif\n   TEST_ENTRY  (fs_chown)\n   TEST_ENTRY  (fs_utime)\n   TEST_ENTRY  (fs_futime)\n@@ -826,6 +837,9 @@ TASK_LIST_START\n   TEST_ENTRY  (fs_file_open_append)\n   TEST_ENTRY  (fs_event_watch_dir)\n   TEST_ENTRY  (fs_event_watch_dir_recursive)\n+#ifdef _WIN32\n+  TEST_ENTRY  (fs_event_watch_dir_short_path)\n+#endif\n   TEST_ENTRY  (fs_event_watch_file)\n   TEST_ENTRY  (fs_event_watch_file_exact_path)\n   TEST_ENTRY  (fs_event_watch_file_twice)"
        },
        {
            "sha": "0d1b1d7ec9540c4c2b3769a2929313c72d96c407",
            "filename": "deps/uv/test/test-poll.c",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-poll.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-poll.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-poll.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -134,7 +134,10 @@ static void close_socket(uv_os_sock_t sock) {\n #else\n   r = close(sock);\n #endif\n-  ASSERT(r == 0);\n+  /* On FreeBSD close() can fail with ECONNRESET if the socket was shutdown by\n+   * the peer before all pending data was delivered.\n+   */\n+  ASSERT(r == 0 || errno == ECONNRESET);\n }\n \n "
        },
        {
            "sha": "1456d081ae6374576047277c4a3520f54c2a3637",
            "filename": "deps/uv/test/test-tcp-bind-error.c",
            "status": "modified",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-tcp-bind-error.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-tcp-bind-error.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-tcp-bind-error.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -214,3 +214,45 @@ TEST_IMPL(tcp_listen_without_bind) {\n   MAKE_VALGRIND_HAPPY();\n   return 0;\n }\n+\n+\n+TEST_IMPL(tcp_bind_writable_flags) {\n+  struct sockaddr_in addr;\n+  uv_tcp_t server;\n+  uv_buf_t buf;\n+  uv_write_t write_req;\n+  uv_shutdown_t shutdown_req;\n+  int r;\n+\n+  ASSERT(0 == uv_ip4_addr(\"0.0.0.0\", TEST_PORT, &addr));\n+  r = uv_tcp_init(uv_default_loop(), &server);\n+  ASSERT(r == 0);\n+  r = uv_tcp_bind(&server, (const struct sockaddr*) &addr, 0);\n+  ASSERT(r == 0);\n+  r = uv_listen((uv_stream_t*)&server, 128, NULL);\n+  ASSERT(r == 0);\n+\n+  ASSERT(0 == uv_is_writable((uv_stream_t*) &server));\n+  ASSERT(0 == uv_is_readable((uv_stream_t*) &server));\n+\n+  buf = uv_buf_init(\"PING\", 4);\n+  r = uv_write(&write_req, (uv_stream_t*) &server, &buf, 1, NULL);\n+  ASSERT(r == UV_EPIPE);\n+  r = uv_shutdown(&shutdown_req, (uv_stream_t*) &server, NULL);\n+#ifdef _WIN32\n+  ASSERT(r == UV_EPIPE);\n+#else\n+  ASSERT(r == UV_ENOTCONN);\n+#endif\n+  r = uv_read_start((uv_stream_t*) &server, NULL, NULL);\n+  ASSERT(r == UV_ENOTCONN);\n+\n+  uv_close((uv_handle_t*)&server, close_cb);\n+\n+  uv_run(uv_default_loop(), UV_RUN_DEFAULT);\n+\n+  ASSERT(close_cb_called == 1);\n+\n+  MAKE_VALGRIND_HAPPY();\n+  return 0;\n+}"
        },
        {
            "sha": "ca2361f9bb776db634634f23542a6684997930de",
            "filename": "deps/uv/test/test-tcp-oob.c",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-tcp-oob.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-tcp-oob.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-tcp-oob.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -61,7 +61,7 @@ static void read_cb(uv_stream_t* handle, ssize_t nread, const uv_buf_t* buf) {\n #endif\n   uv_os_fd_t fd;\n \n-  ASSERT(nread > 0);\n+  ASSERT(nread >= 0);\n   ASSERT(0 == uv_fileno((uv_handle_t*)handle, &fd));\n   ASSERT(0 == uv_idle_start(&idle, idle_cb));\n "
        },
        {
            "sha": "1ff9c517cec1c6bd465bf97ae3d6f3fdff4be66f",
            "filename": "deps/uv/test/test-tcp-write-queue-order.c",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-tcp-write-queue-order.c",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Ftest%2Ftest-tcp-write-queue-order.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-tcp-write-queue-order.c?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -90,7 +90,7 @@ static void connection_cb(uv_stream_t* tcp, int status) {\n   ASSERT(0 == uv_accept(tcp, (uv_stream_t*) &incoming));\n \n   ASSERT(0 == uv_timer_init(uv_default_loop(), &timer));\n-  ASSERT(0 == uv_timer_start(&timer, timer_cb, 1, 0));\n+  ASSERT(0 == uv_timer_start(&timer, timer_cb, 1000, 0));\n \n   connection_cb_called++;\n }"
        },
        {
            "sha": "e41f9ff5dce4212d4d3c746eadfafa6013a00dc0",
            "filename": "deps/uv/uv.gyp",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fuv.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/ae2b5bcb7c17a2d2a488f234c736201eed8200db/deps%2Fuv%2Fuv.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fuv.gyp?ref=ae2b5bcb7c17a2d2a488f234c736201eed8200db",
            "patch": "@@ -2,12 +2,12 @@\n   'variables': {\n     'conditions': [\n       ['OS==\"win\"', {\n+        'shared_unix_defines': [ ],\n+      }, {\n         'shared_unix_defines': [\n           '_LARGEFILE_SOURCE',\n           '_FILE_OFFSET_BITS=64',\n         ],\n-      }, {\n-        'shared_unix_defines': [ ],\n       }],\n       ['OS in \"mac ios\"', {\n         'shared_mac_defines': [ '_DARWIN_USE_64_BIT_INODE=1' ],\n@@ -300,9 +300,6 @@\n                 'src/unix/no-fsevents.c',\n                 'src/unix/no-proctitle.c',\n               ],\n-              'defines': [\n-                '_PASE=1'\n-              ],\n             }, {\n               'sources': [\n                 'src/unix/aix.c'"
        }
    ],
    "stats": {
        "total": 606,
        "additions": 466,
        "deletions": 140
    }
}