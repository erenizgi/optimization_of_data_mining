{
    "author": "kt3k",
    "message": "src: migrate to new V8 array API\n\nThis change migrates the deprecated V8 Array API to new APIs.\n\nPR-URL: https://github.com/nodejs/node/pull/24613\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "27139fc37c58bb9c344158bfb7276df5bfadae27",
    "files": [
        {
            "sha": "496b6cbbcb157366c788715083714b57e299475e",
            "filename": "src/node_util.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 13,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/27139fc37c58bb9c344158bfb7276df5bfadae27/src%2Fnode_util.cc",
            "raw_url": "https://github.com/nodejs/node/raw/27139fc37c58bb9c344158bfb7276df5bfadae27/src%2Fnode_util.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_util.cc?ref=27139fc37c58bb9c344158bfb7276df5bfadae27",
            "patch": "@@ -64,13 +64,13 @@ static void GetPromiseDetails(const FunctionCallbackInfo<Value>& args) {\n   auto isolate = args.GetIsolate();\n \n   Local<Promise> promise = args[0].As<Promise>();\n-  Local<Array> ret = Array::New(isolate, 2);\n \n   int state = promise->State();\n-  ret->Set(env->context(), 0, Integer::New(isolate, state)).FromJust();\n+  Local<Value> values[2] = { Integer::New(isolate, state) };\n+  size_t number_of_values = 1;\n   if (state != Promise::PromiseState::kPending)\n-    ret->Set(env->context(), 1, promise->Result()).FromJust();\n-\n+    values[number_of_values++] = promise->Result();\n+  Local<Array> ret = Array::New(isolate, values, number_of_values);\n   args.GetReturnValue().Set(ret);\n }\n \n@@ -82,11 +82,13 @@ static void GetProxyDetails(const FunctionCallbackInfo<Value>& args) {\n \n   Local<Proxy> proxy = args[0].As<Proxy>();\n \n-  Local<Array> ret = Array::New(args.GetIsolate(), 2);\n-  ret->Set(env->context(), 0, proxy->GetTarget()).FromJust();\n-  ret->Set(env->context(), 1, proxy->GetHandler()).FromJust();\n+  Local<Value> ret[] = {\n+    proxy->GetTarget(),\n+    proxy->GetHandler()\n+  };\n \n-  args.GetReturnValue().Set(ret);\n+  args.GetReturnValue().Set(\n+      Array::New(args.GetIsolate(), ret, arraysize(ret)));\n }\n \n static void PreviewEntries(const FunctionCallbackInfo<Value>& args) {\n@@ -101,11 +103,13 @@ static void PreviewEntries(const FunctionCallbackInfo<Value>& args) {\n   // Fast path for WeakMap, WeakSet and Set iterators.\n   if (args.Length() == 1)\n     return args.GetReturnValue().Set(entries);\n-  Local<Array> ret = Array::New(env->isolate(), 2);\n-  ret->Set(env->context(), 0, entries).FromJust();\n-  ret->Set(env->context(), 1, Boolean::New(env->isolate(), is_key_value))\n-      .FromJust();\n-  return args.GetReturnValue().Set(ret);\n+\n+  Local<Value> ret[] = {\n+    entries,\n+    Boolean::New(env->isolate(), is_key_value)\n+  };\n+  return args.GetReturnValue().Set(\n+      Array::New(env->isolate(), ret, arraysize(ret)));\n }\n \n // Side effect-free stringification that will never throw exceptions."
        }
    ],
    "stats": {
        "total": 30,
        "additions": 17,
        "deletions": 13
    }
}