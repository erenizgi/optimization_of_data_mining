{
    "author": "bmeck",
    "message": "module: check file ext before dir as documented\n\nThe documented resolution algorithm started to search for package.json\nfiles prior to searching for file extensions when searching for a\nspecifier. Oddly, it did not search for index files at same time it\nsearched for package.json. This restores the documented behavior of\nsearching for file extensions prior to searching directories.\n\nPR-URL: https://github.com/nodejs/node/pull/15015\nFixes: https://github.com/nodejs/node/issues/14990\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Evan Lucas <evanlucas@me.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Khaidi Chu <i@2333.moe>",
    "sha": "1ed36aeb53266f8f01e1cd442069024d258f632a",
    "files": [
        {
            "sha": "6d4e3dbfcf07d406a64491152d7fbd29e93bde29",
            "filename": "lib/module.js",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/1ed36aeb53266f8f01e1cd442069024d258f632a/lib%2Fmodule.js",
            "raw_url": "https://github.com/nodejs/node/raw/1ed36aeb53266f8f01e1cd442069024d258f632a/lib%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fmodule.js?ref=1ed36aeb53266f8f01e1cd442069024d258f632a",
            "patch": "@@ -219,6 +219,9 @@ Module._findPath = function(request, paths, isMain) {\n   var exts;\n   var trailingSlash = request.length > 0 &&\n     request.charCodeAt(request.length - 1) === CHAR_FORWARD_SLASH;\n+  if (!trailingSlash) {\n+    trailingSlash = /(?:^|\\/)\\.?\\.$/.test(request);\n+  }\n \n   // For each path\n   for (var i = 0; i < paths.length; i++) {\n@@ -236,10 +239,6 @@ Module._findPath = function(request, paths, isMain) {\n         } else {\n           filename = toRealPath(basePath);\n         }\n-      } else if (rc === 1) {  // Directory.\n-        if (exts === undefined)\n-          exts = Object.keys(Module._extensions);\n-        filename = tryPackage(basePath, exts, isMain);\n       }\n \n       if (!filename) {\n@@ -251,11 +250,13 @@ Module._findPath = function(request, paths, isMain) {\n     }\n \n     if (!filename && rc === 1) {  // Directory.\n+      // try it with each of the extensions at \"index\"\n       if (exts === undefined)\n         exts = Object.keys(Module._extensions);\n-      filename = tryPackage(basePath, exts, isMain) ||\n-        // try it with each of the extensions at \"index\"\n-        tryExtensions(path.resolve(basePath, 'index'), exts, isMain);\n+      filename = tryPackage(basePath, exts, isMain);\n+      if (!filename) {\n+        filename = tryExtensions(path.resolve(basePath, 'index'), exts, isMain);\n+      }\n     }\n \n     if (filename) {"
        },
        {
            "sha": "f053ebf7976e3726d11f3c03fade2170903889a5",
            "filename": "test/fixtures/module-extension-over-directory/inner.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/1ed36aeb53266f8f01e1cd442069024d258f632a/test%2Ffixtures%2Fmodule-extension-over-directory%2Finner.js",
            "raw_url": "https://github.com/nodejs/node/raw/1ed36aeb53266f8f01e1cd442069024d258f632a/test%2Ffixtures%2Fmodule-extension-over-directory%2Finner.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fmodule-extension-over-directory%2Finner.js?ref=1ed36aeb53266f8f01e1cd442069024d258f632a",
            "patch": "@@ -0,0 +1 @@\n+module.exports = {};"
        },
        {
            "sha": "2ac72712f0688295c5404ff37cce1eeadb029b98",
            "filename": "test/fixtures/module-extension-over-directory/inner/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/1ed36aeb53266f8f01e1cd442069024d258f632a/test%2Ffixtures%2Fmodule-extension-over-directory%2Finner%2Fpackage.json",
            "raw_url": "https://github.com/nodejs/node/raw/1ed36aeb53266f8f01e1cd442069024d258f632a/test%2Ffixtures%2Fmodule-extension-over-directory%2Finner%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fmodule-extension-over-directory%2Finner%2Fpackage.json?ref=1ed36aeb53266f8f01e1cd442069024d258f632a",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"main\": \"./package.json\"\n+}"
        },
        {
            "sha": "cc896d7b61b0907ac621e4ed3f7e8733ade15367",
            "filename": "test/parallel/test-require-extension-over-directory.js",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/1ed36aeb53266f8f01e1cd442069024d258f632a/test%2Fparallel%2Ftest-require-extension-over-directory.js",
            "raw_url": "https://github.com/nodejs/node/raw/1ed36aeb53266f8f01e1cd442069024d258f632a/test%2Fparallel%2Ftest-require-extension-over-directory.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-require-extension-over-directory.js?ref=1ed36aeb53266f8f01e1cd442069024d258f632a",
            "patch": "@@ -0,0 +1,30 @@\n+'use strict';\n+// fixes regression from v4\n+require('../common');\n+const assert = require('assert');\n+const fixtures = require('../common/fixtures');\n+const path = require('path');\n+\n+const fixturesRequire = require(\n+  fixtures.path('module-extension-over-directory', 'inner'));\n+\n+assert.strictEqual(\n+  fixturesRequire,\n+  require(fixtures.path('module-extension-over-directory', 'inner.js')),\n+  'test-require-extension-over-directory failed to import fixture' +\n+  ' requirements'\n+);\n+\n+const fakePath = [\n+  fixtures.path('module-extension-over-directory', 'inner'),\n+  'fake',\n+  '..'\n+].join(path.sep);\n+const fixturesRequireDir = require(fakePath);\n+\n+assert.strictEqual(\n+  fixturesRequireDir,\n+  require(fixtures.path('module-extension-over-directory', 'inner/')),\n+  'test-require-extension-over-directory failed to import fixture' +\n+  ' requirements'\n+);"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 42,
        "deletions": 7
    }
}