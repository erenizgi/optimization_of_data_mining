{
    "author": "joyeecheung",
    "message": "buffer: move Buffer prototype wiring into internal/buffer.js\n\nInstead of exposing the Buffer prototype methods through an\nobject in `internal/buffer.js` and then iterating over it\nto put the methods on the prototype, create a function\nin `internal/buffer.js` to do this.\n\nAlso moves the creaton of the `FastBuffer` class into\n`internal/buffer.js` and expose it directly instead of\nwriting it onto that module later.\n\nPR-URL: https://github.com/nodejs/node/pull/25292\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "842a35fbac5c29e8bb095fe3716375232ee0d0ce",
    "files": [
        {
            "sha": "995f5096239a6564ada4cfeb0cfd831664bf02fb",
            "filename": "lib/buffer.js",
            "status": "modified",
            "additions": 6,
            "deletions": 36,
            "changes": 42,
            "blob_url": "https://github.com/nodejs/node/blob/842a35fbac5c29e8bb095fe3716375232ee0d0ce/lib%2Fbuffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/842a35fbac5c29e8bb095fe3716375232ee0d0ce/lib%2Fbuffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fbuffer.js?ref=842a35fbac5c29e8bb095fe3716375232ee0d0ce",
            "patch": "@@ -36,21 +36,7 @@ const {\n   swap64: _swap64,\n   kMaxLength,\n   kStringMaxLength,\n-  zeroFill: bindingZeroFill,\n-\n-  // Additional Buffer methods\n-  asciiSlice,\n-  base64Slice,\n-  latin1Slice,\n-  hexSlice,\n-  ucs2Slice,\n-  utf8Slice,\n-  asciiWrite,\n-  base64Write,\n-  latin1Write,\n-  hexWrite,\n-  ucs2Write,\n-  utf8Write\n+  zeroFill: bindingZeroFill\n } = internalBinding('buffer');\n const {\n   getOwnNonIndexProperties,\n@@ -87,30 +73,14 @@ const {\n } = require('internal/errors').codes;\n const { validateString } = require('internal/validators');\n \n-const internalBuffer = require('internal/buffer');\n+const {\n+  FastBuffer,\n+  addBufferPrototypeMethods\n+} = require('internal/buffer');\n \n-class FastBuffer extends Uint8Array {}\n FastBuffer.prototype.constructor = Buffer;\n-internalBuffer.FastBuffer = FastBuffer;\n-\n Buffer.prototype = FastBuffer.prototype;\n-\n-for (const [name, method] of Object.entries(internalBuffer.readWrites)) {\n-  Buffer.prototype[name] = method;\n-}\n-\n-Buffer.prototype.asciiSlice = asciiSlice;\n-Buffer.prototype.base64Slice = base64Slice;\n-Buffer.prototype.latin1Slice = latin1Slice;\n-Buffer.prototype.hexSlice = hexSlice;\n-Buffer.prototype.ucs2Slice = ucs2Slice;\n-Buffer.prototype.utf8Slice = utf8Slice;\n-Buffer.prototype.asciiWrite = asciiWrite;\n-Buffer.prototype.base64Write = base64Write;\n-Buffer.prototype.latin1Write = latin1Write;\n-Buffer.prototype.hexWrite = hexWrite;\n-Buffer.prototype.ucs2Write = ucs2Write;\n-Buffer.prototype.utf8Write = utf8Write;\n+addBufferPrototypeMethods(Buffer.prototype);\n \n const constants = Object.defineProperties({}, {\n   MAX_LENGTH: {"
        },
        {
            "sha": "56b73f5489ec35559f7b569e864b54b4845c63b1",
            "filename": "lib/internal/buffer.js",
            "status": "modified",
            "additions": 72,
            "deletions": 40,
            "changes": 112,
            "blob_url": "https://github.com/nodejs/node/blob/842a35fbac5c29e8bb095fe3716375232ee0d0ce/lib%2Finternal%2Fbuffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/842a35fbac5c29e8bb095fe3716375232ee0d0ce/lib%2Finternal%2Fbuffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbuffer.js?ref=842a35fbac5c29e8bb095fe3716375232ee0d0ce",
            "patch": "@@ -6,6 +6,20 @@ const {\n   ERR_OUT_OF_RANGE\n } = require('internal/errors').codes;\n const { validateNumber } = require('internal/validators');\n+const {\n+  asciiSlice,\n+  base64Slice,\n+  latin1Slice,\n+  hexSlice,\n+  ucs2Slice,\n+  utf8Slice,\n+  asciiWrite,\n+  base64Write,\n+  latin1Write,\n+  hexWrite,\n+  ucs2Write,\n+  utf8Write\n+} = internalBinding('buffer');\n \n // Temporary buffers to convert numbers.\n const float32Array = new Float32Array(1);\n@@ -771,45 +785,63 @@ function writeFloatBackwards(val, offset = 0) {\n   return offset;\n }\n \n-// FastBuffer wil be inserted here by lib/buffer.js\n+class FastBuffer extends Uint8Array {}\n+\n+function addBufferPrototypeMethods(proto) {\n+  proto.readUIntLE = readUIntLE;\n+  proto.readUInt32LE = readUInt32LE;\n+  proto.readUInt16LE = readUInt16LE;\n+  proto.readUInt8 = readUInt8;\n+  proto.readUIntBE = readUIntBE;\n+  proto.readUInt32BE = readUInt32BE;\n+  proto.readUInt16BE = readUInt16BE;\n+  proto.readIntLE = readIntLE;\n+  proto.readInt32LE = readInt32LE;\n+  proto.readInt16LE = readInt16LE;\n+  proto.readInt8 = readInt8;\n+  proto.readIntBE = readIntBE;\n+  proto.readInt32BE = readInt32BE;\n+  proto.readInt16BE = readInt16BE;\n+\n+  proto.writeUIntLE = writeUIntLE;\n+  proto.writeUInt32LE = writeUInt32LE;\n+  proto.writeUInt16LE = writeUInt16LE;\n+  proto.writeUInt8 = writeUInt8;\n+  proto.writeUIntBE = writeUIntBE;\n+  proto.writeUInt32BE = writeUInt32BE;\n+  proto.writeUInt16BE = writeUInt16BE;\n+  proto.writeIntLE = writeIntLE;\n+  proto.writeInt32LE = writeInt32LE;\n+  proto.writeInt16LE = writeInt16LE;\n+  proto.writeInt8 = writeInt8;\n+  proto.writeIntBE = writeIntBE;\n+  proto.writeInt32BE = writeInt32BE;\n+  proto.writeInt16BE = writeInt16BE;\n+\n+  proto.readFloatLE = bigEndian ? readFloatBackwards : readFloatForwards;\n+  proto.readFloatBE = bigEndian ? readFloatForwards : readFloatBackwards;\n+  proto.readDoubleLE = bigEndian ? readDoubleBackwards : readDoubleForwards;\n+  proto.readDoubleBE = bigEndian ? readDoubleForwards : readDoubleBackwards;\n+  proto.writeFloatLE = bigEndian ? writeFloatBackwards : writeFloatForwards;\n+  proto.writeFloatBE = bigEndian ? writeFloatForwards : writeFloatBackwards;\n+  proto.writeDoubleLE = bigEndian ? writeDoubleBackwards : writeDoubleForwards;\n+  proto.writeDoubleBE = bigEndian ? writeDoubleForwards : writeDoubleBackwards;\n+\n+  proto.asciiSlice = asciiSlice;\n+  proto.base64Slice = base64Slice;\n+  proto.latin1Slice = latin1Slice;\n+  proto.hexSlice = hexSlice;\n+  proto.ucs2Slice = ucs2Slice;\n+  proto.utf8Slice = utf8Slice;\n+  proto.asciiWrite = asciiWrite;\n+  proto.base64Write = base64Write;\n+  proto.latin1Write = latin1Write;\n+  proto.hexWrite = hexWrite;\n+  proto.ucs2Write = ucs2Write;\n+  proto.utf8Write = utf8Write;\n+}\n+\n module.exports = {\n-  // Container to export all read write functions.\n-  readWrites: {\n-    readUIntLE,\n-    readUInt32LE,\n-    readUInt16LE,\n-    readUInt8,\n-    readUIntBE,\n-    readUInt32BE,\n-    readUInt16BE,\n-    readIntLE,\n-    readInt32LE,\n-    readInt16LE,\n-    readInt8,\n-    readIntBE,\n-    readInt32BE,\n-    readInt16BE,\n-    writeUIntLE,\n-    writeUInt32LE,\n-    writeUInt16LE,\n-    writeUInt8,\n-    writeUIntBE,\n-    writeUInt32BE,\n-    writeUInt16BE,\n-    writeIntLE,\n-    writeInt32LE,\n-    writeInt16LE,\n-    writeInt8,\n-    writeIntBE,\n-    writeInt32BE,\n-    writeInt16BE,\n-    readFloatLE: bigEndian ? readFloatBackwards : readFloatForwards,\n-    readFloatBE: bigEndian ? readFloatForwards : readFloatBackwards,\n-    readDoubleLE: bigEndian ? readDoubleBackwards : readDoubleForwards,\n-    readDoubleBE: bigEndian ? readDoubleForwards : readDoubleBackwards,\n-    writeFloatLE: bigEndian ? writeFloatBackwards : writeFloatForwards,\n-    writeFloatBE: bigEndian ? writeFloatForwards : writeFloatBackwards,\n-    writeDoubleLE: bigEndian ? writeDoubleBackwards : writeDoubleForwards,\n-    writeDoubleBE: bigEndian ? writeDoubleForwards : writeDoubleBackwards\n-  }\n+  FastBuffer,\n+  addBufferPrototypeMethods\n };"
        }
    ],
    "stats": {
        "total": 154,
        "additions": 78,
        "deletions": 76
    }
}