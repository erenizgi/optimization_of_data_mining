{
    "author": "Trott",
    "message": "test: refactor pummel/test-net-many-clients\n\n* Use port 0 instead of `common.PORT`.\n* Reduce `concurrent` from 100 to 50 and `connections_per_client` from 5\n  to 3. This is to avoid side effects from other tests. Prior to this\n  change, running this along with test-keep-alive would result in\n  failures on my local setup, apparently due to network throttling.\n* Remove unnecessary `console.log()` and improve remaining\n  `console.log()` to provide clearer information.\n\nPR-URL: https://github.com/nodejs/node/pull/25485\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "e675d4bd2b9f8d68f8c5deddbfefa92a79edd8a4",
    "files": [
        {
            "sha": "4d114922a92ad8f99819a7c5a08f95e3e11d0161",
            "filename": "test/pummel/test-net-many-clients.js",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/e675d4bd2b9f8d68f8c5deddbfefa92a79edd8a4/test%2Fpummel%2Ftest-net-many-clients.js",
            "raw_url": "https://github.com/nodejs/node/raw/e675d4bd2b9f8d68f8c5deddbfefa92a79edd8a4/test%2Fpummel%2Ftest-net-many-clients.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpummel%2Ftest-net-many-clients.js?ref=e675d4bd2b9f8d68f8c5deddbfefa92a79edd8a4",
            "patch": "@@ -20,30 +20,29 @@\n // USE OR OTHER DEALINGS IN THE SOFTWARE.\n \n 'use strict';\n-const common = require('../common');\n+require('../common');\n const assert = require('assert');\n const net = require('net');\n \n // settings\n const bytes = 1024 * 40;\n-const concurrency = 100;\n-const connections_per_client = 5;\n+const concurrency = 50;\n+const connections_per_client = 3;\n \n // measured\n let total_connections = 0;\n \n const body = 'C'.repeat(bytes);\n \n const server = net.createServer(function(c) {\n-  console.log('connected');\n   total_connections++;\n-  console.log('#');\n+  console.log('connected', total_connections);\n   c.write(body);\n   c.end();\n });\n \n-function runClient(callback) {\n-  const client = net.createConnection(common.PORT);\n+function runClient(port, callback) {\n+  const client = net.createConnection(port);\n \n   client.connections = 0;\n \n@@ -79,17 +78,17 @@ function runClient(callback) {\n     assert.ok(!client.fd);\n \n     if (this.connections < connections_per_client) {\n-      this.connect(common.PORT);\n+      this.connect(port);\n     } else {\n       callback();\n     }\n   });\n }\n \n-server.listen(common.PORT, function() {\n+server.listen(0, function() {\n   let finished_clients = 0;\n   for (let i = 0; i < concurrency; i++) {\n-    runClient(function() {\n+    runClient(server.address().port, function() {\n       if (++finished_clients === concurrency) server.close();\n     });\n   }"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 9,
        "deletions": 10
    }
}