{
    "author": "refack",
    "message": "tools,test: add list of slow tests\n\nthey will be skipped if run with `--flaky-tests=skip`\n\nPR-URL: https://github.com/nodejs/node/pull/23251\nReviewed-By: Rich Trott <rtrott@gmail.com>",
    "sha": "deaddd212c499c7ff88d20034753b5f3f00d5153",
    "files": [
        {
            "sha": "9ed9004c2169d00ee02243abe223f3876e1fd13b",
            "filename": "test/root.status",
            "status": "added",
            "additions": 190,
            "deletions": 0,
            "changes": 190,
            "blob_url": "https://github.com/nodejs/node/blob/deaddd212c499c7ff88d20034753b5f3f00d5153/test%2Froot.status",
            "raw_url": "https://github.com/nodejs/node/raw/deaddd212c499c7ff88d20034753b5f3f00d5153/test%2Froot.status",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Froot.status?ref=deaddd212c499c7ff88d20034753b5f3f00d5153",
            "patch": "@@ -0,0 +1,190 @@\n+[$mode==debug]\n+async-hooks/test-callback-error: SLOW\n+async-hooks/test-callback-error: SLOW\n+async-hooks/test-emit-init: SLOW\n+async-hooks/test-emit-init: SLOW\n+async-hooks/test-querywrap: SLOW\n+async-hooks/test-querywrap: SLOW\n+async-hooks/test-tlswrap: SLOW\n+async-hooks/test-tlswrap: SLOW\n+message/eval_messages: SLOW\n+message/stdin_messages: SLOW\n+parallel/test-benchmark-assert: SLOW\n+parallel/test-benchmark-cluster: SLOW\n+parallel/test-benchmark-crypto: SLOW\n+parallel/test-benchmark-dns: SLOW\n+parallel/test-benchmark-domain: SLOW\n+parallel/test-benchmark-es: SLOW\n+parallel/test-benchmark-events: SLOW\n+parallel/test-benchmark-fs: SLOW\n+parallel/test-benchmark-misc: SLOW\n+parallel/test-benchmark-module: SLOW\n+parallel/test-benchmark-os: SLOW\n+parallel/test-benchmark-process: SLOW\n+parallel/test-benchmark-querystring: SLOW\n+parallel/test-benchmark-streams: SLOW\n+parallel/test-benchmark-string_decoder: SLOW\n+parallel/test-benchmark-timers: SLOW\n+parallel/test-benchmark-url: SLOW\n+parallel/test-benchmark-util: SLOW\n+parallel/test-benchmark-v8: SLOW\n+parallel/test-benchmark-vm: SLOW\n+parallel/test-benchmark-zlib: SLOW\n+parallel/test-buffer-constructor-node-modules-paths: SLOW\n+parallel/test-buffer-indexof: SLOW\n+parallel/test-child-process-spawnsync-input: SLOW\n+parallel/test-child-process-windows-hide: SLOW\n+parallel/test-cli-eval: SLOW\n+parallel/test-cli-eval-event: SLOW\n+parallel/test-cli-node-options: SLOW\n+parallel/test-cli-node-options-disallowed: SLOW\n+parallel/test-cli-node-print-help: SLOW\n+parallel/test-cli-syntax: SLOW\n+parallel/test-cluster-basic: SLOW\n+parallel/test-cluster-bind-privileged-port: SLOW\n+parallel/test-cluster-bind-twice: SLOW\n+parallel/test-cluster-disconnect: SLOW\n+parallel/test-cluster-disconnect-idle-worker: SLOW\n+parallel/test-crypto-fips: SLOW\n+parallel/test-domain-abort-on-uncaught: SLOW\n+parallel/test-domain-uncaught-exception: SLOW\n+parallel/test-domain-with-abort-on-uncaught-exception: SLOW\n+parallel/test-env-var-no-warnings: SLOW\n+parallel/test-error-reporting: SLOW\n+parallel/test-eslint-alphabetize-errors: SLOW\n+parallel/test-eslint-buffer-constructor: SLOW\n+parallel/test-eslint-crypto-check: SLOW\n+parallel/test-eslint-documented-errors: SLOW\n+parallel/test-eslint-duplicate-requires: SLOW\n+parallel/test-eslint-eslint-check: SLOW\n+parallel/test-eslint-inspector-check: SLOW\n+parallel/test-eslint-lowercase-name-for-primitive: SLOW\n+parallel/test-eslint-no-let-in-for-declaration: SLOW\n+parallel/test-eslint-no-unescaped-regexp-dot: SLOW\n+parallel/test-eslint-number-isnan: SLOW\n+parallel/test-eslint-prefer-assert-iferror: SLOW\n+parallel/test-eslint-prefer-assert-methods: SLOW\n+parallel/test-eslint-prefer-common-expectserror: SLOW\n+parallel/test-eslint-prefer-common-mustnotcall: SLOW\n+parallel/test-eslint-prefer-util-format-errors: SLOW\n+parallel/test-eslint-require-buffer: SLOW\n+parallel/test-eslint-required-modules: SLOW\n+parallel/test-fs-read-stream-concurrent-reads: SLOW\n+parallel/test-gc-tls-external-memory: SLOW\n+parallel/test-heapdump-dns: SLOW\n+parallel/test-heapdump-fs-promise: SLOW\n+parallel/test-heapdump-http2: SLOW\n+parallel/test-heapdump-inspector: SLOW\n+parallel/test-heapdump-tls: SLOW\n+parallel/test-heapdump-worker: SLOW\n+parallel/test-heapdump-zlib: SLOW\n+parallel/test-http-client-timeout-option-with-agent: SLOW\n+parallel/test-http-pipeline-flood: SLOW\n+parallel/test-http-pipeline-requests-connection-leak: SLOW\n+parallel/test-http2-forget-closed-streams: SLOW\n+parallel/test-http2-multiplex: SLOW\n+parallel/test-inspector-tracing-domain: SLOW\n+parallel/test-listen-fd-cluster: SLOW\n+parallel/test-module-loading-globalpaths: SLOW\n+parallel/test-module-main-fail: SLOW\n+parallel/test-module-main-preserve-symlinks-fail: SLOW\n+parallel/test-net-pingpong: SLOW\n+parallel/test-next-tick-fixed-queue-regression: SLOW\n+parallel/test-npm-install: SLOW\n+parallel/test-preload: SLOW\n+parallel/test-repl: SLOW\n+parallel/test-repl-tab-complete: SLOW\n+parallel/test-repl-top-level-await: SLOW\n+parallel/test-stdio-pipe-access: SLOW\n+parallel/test-stream-pipeline: SLOW\n+parallel/test-stream2-read-sync-stack: SLOW\n+parallel/test-stringbytes-external: SLOW\n+parallel/test-sync-io-option: SLOW\n+parallel/test-tick-processor-arguments: SLOW\n+parallel/test-tls-env-bad-extra-ca: SLOW\n+parallel/test-tls-env-extra-ca: SLOW\n+parallel/test-tls-handshake-exception: SLOW\n+parallel/test-tls-securepair-leak: SLOW\n+parallel/test-tls-server-verify: SLOW\n+parallel/test-tls-session-cache: SLOW\n+parallel/test-tls-ticket-cluster: SLOW\n+parallel/test-tls-timeout-server: SLOW\n+parallel/test-tls-timeout-server-2: SLOW\n+parallel/test-tls-tlswrap-segfault: SLOW\n+parallel/test-trace-events-all: SLOW\n+parallel/test-trace-events-api: SLOW\n+parallel/test-trace-events-async-hooks: SLOW\n+parallel/test-trace-events-binding: SLOW\n+parallel/test-trace-events-bootstrap: SLOW\n+parallel/test-trace-events-category-used: SLOW\n+parallel/test-trace-events-file-pattern: SLOW\n+parallel/test-trace-events-fs-sync: SLOW\n+parallel/test-trace-events-metadata: SLOW\n+parallel/test-trace-events-none: SLOW\n+parallel/test-trace-events-perf: SLOW\n+parallel/test-trace-events-process-exit: SLOW\n+parallel/test-trace-events-promises: SLOW\n+parallel/test-trace-events-v8: SLOW\n+parallel/test-trace-events-vm: SLOW\n+parallel/test-trace-events-worker-metadata: SLOW\n+parallel/test-tracing-no-crash: SLOW\n+parallel/test-url-relative: SLOW\n+parallel/test-util-callbackify: SLOW\n+parallel/test-util-inspect: SLOW\n+parallel/test-util-inspect-long-running: SLOW\n+parallel/test-util-types: SLOW\n+parallel/test-v8-coverage: SLOW\n+parallel/test-vm-api-handles-getter-errors: SLOW\n+parallel/test-vm-basic: SLOW\n+parallel/test-vm-cached-data: SLOW\n+parallel/test-vm-sigint: SLOW\n+parallel/test-vm-sigint-existing-handler: SLOW\n+parallel/test-vm-symbols: SLOW\n+parallel/test-vm-syntax-error-message: SLOW\n+parallel/test-vm-syntax-error-stderr: SLOW\n+parallel/test-worker: SLOW\n+parallel/test-worker-cleanup-handles: SLOW\n+parallel/test-worker-debug: SLOW\n+parallel/test-worker-esmodule: SLOW\n+parallel/test-worker-exit-code: SLOW\n+parallel/test-worker-memory: SLOW\n+parallel/test-worker-message-channel: SLOW\n+parallel/test-worker-message-channel-sharedarraybuffer: SLOW\n+parallel/test-worker-nexttick-terminate: SLOW\n+parallel/test-worker-onmessage: SLOW\n+parallel/test-worker-onmessage-not-a-function: SLOW\n+parallel/test-worker-parent-port-ref: SLOW\n+parallel/test-worker-relative-path: SLOW\n+parallel/test-worker-relative-path-double-dot: SLOW\n+parallel/test-worker-stdio: SLOW\n+parallel/test-worker-syntax-error: SLOW\n+parallel/test-worker-syntax-error-file: SLOW\n+parallel/test-worker-uncaught-exception: SLOW\n+parallel/test-worker-uncaught-exception-async: SLOW\n+parallel/test-worker-unsupported-things: SLOW\n+parallel/test-worker-workerdata-sharedarraybuffer: SLOW\n+parallel/test-zlib-bytes-read: SLOW\n+parallel/test-zlib-convenience-methods: SLOW\n+sequential/test-benchmark-buffer: SLOW\n+sequential/test-benchmark-child-process: SLOW\n+sequential/test-benchmark-dgram: SLOW\n+sequential/test-benchmark-http: SLOW\n+sequential/test-benchmark-net: SLOW\n+sequential/test-benchmark-path: SLOW\n+sequential/test-benchmark-tls: SLOW\n+sequential/test-child-process-execsync: SLOW\n+sequential/test-child-process-exit: SLOW\n+sequential/test-child-process-pass-fd: SLOW\n+sequential/test-fs-readfile-tostring-fail: SLOW\n+sequential/test-fs-watch-system-limit: SLOW\n+sequential/test-gc-http-client: SLOW\n+sequential/test-gc-http-client-connaborted: SLOW\n+sequential/test-gc-http-client-onerror: SLOW\n+sequential/test-gc-http-client-timeout: SLOW\n+sequential/test-gc-net-timeout: SLOW\n+sequential/test-http2-ping-flood: SLOW\n+sequential/test-http2-settings-flood: SLOW\n+sequential/test-inspector-port-cluster: SLOW\n+sequential/test-net-bytes-per-incoming-chunk-overhead: SLOW\n+sequential/test-pipe: SLOW\n+sequential/test-util-debug: SLOW"
        },
        {
            "sha": "0571f3394bcc38599ab3a3da0d18bf7927450ca8",
            "filename": "tools/test.py",
            "status": "modified",
            "additions": 21,
            "deletions": 24,
            "changes": 45,
            "blob_url": "https://github.com/nodejs/node/blob/deaddd212c499c7ff88d20034753b5f3f00d5153/tools%2Ftest.py",
            "raw_url": "https://github.com/nodejs/node/raw/deaddd212c499c7ff88d20034753b5f3f00d5153/tools%2Ftest.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Ftest.py?ref=deaddd212c499c7ff88d20034753b5f3f00d5153",
            "patch": "@@ -850,23 +850,23 @@ def GetTestStatus(self, context, sections, defs):\n \n \n class LiteralTestSuite(TestSuite):\n-\n-  def __init__(self, tests):\n+  def __init__(self, tests_repos, test_root):\n     super(LiteralTestSuite, self).__init__('root')\n-    self.tests = tests\n+    self.tests_repos = tests_repos\n+    self.test_root = test_root\n \n   def GetBuildRequirements(self, path, context):\n     (name, rest) = CarCdr(path)\n     result = [ ]\n-    for test in self.tests:\n+    for test in self.tests_repos:\n       if not name or name.match(test.GetName()):\n         result += test.GetBuildRequirements(rest, context)\n     return result\n \n   def ListTests(self, current_path, path, context, arch, mode):\n     (name, rest) = CarCdr(path)\n     result = [ ]\n-    for test in self.tests:\n+    for test in self.tests_repos:\n       test_name = test.GetName()\n       if not name or name.match(test_name):\n         full_path = current_path + [test_name]\n@@ -875,8 +875,11 @@ def ListTests(self, current_path, path, context, arch, mode):\n     return result\n \n   def GetTestStatus(self, context, sections, defs):\n-    for test in self.tests:\n-      test.GetTestStatus(context, sections, defs)\n+    # Just read the test configuration from root_path/root.status.\n+    root = TestConfiguration(context, self.test_root, 'root')\n+    root.GetTestStatus(sections, defs)\n+    for tests_repos in self.tests_repos:\n+      tests_repos.GetTestStatus(context, sections, defs)\n \n \n TIMEOUT_SCALEFACTOR = {\n@@ -1198,23 +1201,18 @@ def __init__(self, sections, defs):\n     self.defs = defs\n \n   def ClassifyTests(self, cases, env):\n-    sections = [s for s in self.sections if s.condition.Evaluate(env, self.defs)]\n+    sections = [ s for s in self.sections if s.condition.Evaluate(env, self.defs) ]\n     all_rules = reduce(list.__add__, [s.rules for s in sections], [])\n     unused_rules = set(all_rules)\n-    result = [ ]\n-    all_outcomes = set([])\n+    result = []\n     for case in cases:\n       matches = [ r for r in all_rules if r.Contains(case.path) ]\n-      outcomes = set([])\n-      for rule in matches:\n-        outcomes = outcomes.union(rule.GetOutcomes(env, self.defs))\n-        unused_rules.discard(rule)\n-      if not outcomes:\n-        outcomes = [PASS]\n-      case.outcomes = outcomes\n-      all_outcomes = all_outcomes.union(outcomes)\n-      result.append(ClassifiedTest(case, outcomes))\n-    return (result, list(unused_rules), all_outcomes)\n+      outcomes_list = [ r.GetOutcomes(env, self.defs) for r in matches ]\n+      outcomes = reduce(set.union, outcomes_list, set())\n+      unused_rules.difference_update(matches)\n+      case.outcomes = set(outcomes) or set([PASS])\n+      result.append(case)\n+    return result, unused_rules\n \n \n class Section(object):\n@@ -1552,7 +1550,7 @@ def Main():\n   repositories = [TestRepository(join(workspace, 'test', name)) for name in suites]\n   repositories += [TestRepository(a) for a in options.suite]\n \n-  root = LiteralTestSuite(repositories)\n+  root = LiteralTestSuite(repositories, test_root)\n   paths = ArgsToTestPaths(test_root, args, suites)\n \n   # Check for --valgrind option. If enabled, we overwrite the special\n@@ -1623,8 +1621,7 @@ def Main():\n         }\n         test_list = root.ListTests([], path, context, arch, mode)\n         unclassified_tests += test_list\n-        (cases, unused_rules, _) = (\n-            config.ClassifyTests(test_list, env))\n+        cases, unused_rules = config.ClassifyTests(test_list, env)\n         if globally_unused_rules is None:\n           globally_unused_rules = set(unused_rules)\n         else:\n@@ -1671,7 +1668,7 @@ def should_keep(case):\n       return False\n     elif SKIP in case.outcomes:\n       return False\n-    elif (options.flaky_tests == SKIP) and (set([FLAKY]) & case.outcomes):\n+    elif (options.flaky_tests == SKIP) and (set([SLOW, FLAKY]) & case.outcomes):\n       return False\n     else:\n       return True"
        }
    ],
    "stats": {
        "total": 235,
        "additions": 211,
        "deletions": 24
    }
}