{
    "author": "niboch",
    "message": "src: changed stdio_pipes_ to std::vector\n\nPR-URL: https://github.com/nodejs/node/pull/23615\nReviewed-By: Sam Ruby <rubys@intertwingly.net>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "c979fad9bb33bb0ad4c13a7f44e16719343dc96f",
    "files": [
        {
            "sha": "21e2b2ffb36dc2b6ed4f8d5054c6bac7ab8facbe",
            "filename": "src/spawn_sync.cc",
            "status": "modified",
            "additions": 12,
            "deletions": 14,
            "changes": 26,
            "blob_url": "https://github.com/nodejs/node/blob/c979fad9bb33bb0ad4c13a7f44e16719343dc96f/src%2Fspawn_sync.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c979fad9bb33bb0ad4c13a7f44e16719343dc96f/src%2Fspawn_sync.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fspawn_sync.cc?ref=c979fad9bb33bb0ad4c13a7f44e16719343dc96f",
            "patch": "@@ -390,7 +390,6 @@ SyncProcessRunner::SyncProcessRunner(Environment* env)\n \n       stdio_count_(0),\n       uv_stdio_containers_(nullptr),\n-      stdio_pipes_(nullptr),\n       stdio_pipes_initialized_(false),\n \n       uv_process_options_(),\n@@ -421,7 +420,7 @@ SyncProcessRunner::SyncProcessRunner(Environment* env)\n SyncProcessRunner::~SyncProcessRunner() {\n   CHECK_EQ(lifecycle_, kHandlesClosed);\n \n-  stdio_pipes_.reset();\n+  stdio_pipes_.clear();\n   delete[] file_buffer_;\n   delete[] args_buffer_;\n   delete[] cwd_buffer_;\n@@ -500,10 +499,9 @@ Maybe<bool> SyncProcessRunner::TryInitializeAndRunLoop(Local<Value> options) {\n   }\n   uv_process_.data = this;\n \n-  for (uint32_t i = 0; i < stdio_count_; i++) {\n-    SyncProcessStdioPipe* h = stdio_pipes_[i].get();\n-    if (h != nullptr) {\n-      r = h->Start();\n+  for (const auto& pipe : stdio_pipes_) {\n+    if (pipe != nullptr) {\n+      r = pipe->Start();\n       if (r < 0) {\n         SetPipeError(r);\n         return Just(false);\n@@ -563,12 +561,12 @@ void SyncProcessRunner::CloseStdioPipes() {\n   CHECK_LT(lifecycle_, kHandlesClosed);\n \n   if (stdio_pipes_initialized_) {\n-    CHECK(stdio_pipes_);\n+    CHECK(!stdio_pipes_.empty());\n     CHECK_NOT_NULL(uv_loop_);\n \n-    for (uint32_t i = 0; i < stdio_count_; i++) {\n-      if (stdio_pipes_[i])\n-        stdio_pipes_[i]->Close();\n+    for (const auto& pipe : stdio_pipes_) {\n+      if (pipe)\n+        pipe->Close();\n     }\n \n     stdio_pipes_initialized_ = false;\n@@ -723,13 +721,13 @@ Local<Object> SyncProcessRunner::BuildResultObject() {\n \n Local<Array> SyncProcessRunner::BuildOutputArray() {\n   CHECK_GE(lifecycle_, kInitialized);\n-  CHECK(stdio_pipes_);\n+  CHECK(!stdio_pipes_.empty());\n \n   EscapableHandleScope scope(env()->isolate());\n   Local<Context> context = env()->context();\n   Local<Array> js_output = Array::New(env()->isolate(), stdio_count_);\n \n-  for (uint32_t i = 0; i < stdio_count_; i++) {\n+  for (uint32_t i = 0; i < stdio_pipes_.size(); i++) {\n     SyncProcessStdioPipe* h = stdio_pipes_[i].get();\n     if (h != nullptr && h->writable())\n       js_output->Set(context, i, h->GetOutputAsBuffer(env())).FromJust();\n@@ -857,8 +855,8 @@ int SyncProcessRunner::ParseStdioOptions(Local<Value> js_value) {\n   stdio_count_ = js_stdio_options->Length();\n   uv_stdio_containers_ = new uv_stdio_container_t[stdio_count_];\n \n-  stdio_pipes_.reset(\n-      new std::unique_ptr<SyncProcessStdioPipe>[stdio_count_]());\n+  stdio_pipes_.clear();\n+  stdio_pipes_.resize(stdio_count_);\n   stdio_pipes_initialized_ = true;\n \n   for (uint32_t i = 0; i < stdio_count_; i++) {"
        },
        {
            "sha": "5b04d94b47b30e90b910774427d56e0f64b4f71c",
            "filename": "src/spawn_sync.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c979fad9bb33bb0ad4c13a7f44e16719343dc96f/src%2Fspawn_sync.h",
            "raw_url": "https://github.com/nodejs/node/raw/c979fad9bb33bb0ad4c13a7f44e16719343dc96f/src%2Fspawn_sync.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fspawn_sync.h?ref=c979fad9bb33bb0ad4c13a7f44e16719343dc96f",
            "patch": "@@ -203,7 +203,7 @@ class SyncProcessRunner {\n \n   uint32_t stdio_count_;\n   uv_stdio_container_t* uv_stdio_containers_;\n-  std::unique_ptr<std::unique_ptr<SyncProcessStdioPipe>[]> stdio_pipes_;\n+  std::vector<std::unique_ptr<SyncProcessStdioPipe>> stdio_pipes_;\n   bool stdio_pipes_initialized_;\n \n   uv_process_options_t uv_process_options_;"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 13,
        "deletions": 15
    }
}