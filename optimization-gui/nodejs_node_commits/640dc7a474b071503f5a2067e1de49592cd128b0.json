{
    "author": "maclover7",
    "message": "crypto: remove unused SSLWrap handle methods\n\nOne was not used at all, and the other was only used in a test, which I\nconverted to use the more standard `ShutdownWrap` API.\n\nPR-URL: https://github.com/nodejs/node/pull/22216\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "640dc7a474b071503f5a2067e1de49592cd128b0",
    "files": [
        {
            "sha": "39bcd4cab6fc88e51877501ed4be404d592dafb9",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/640dc7a474b071503f5a2067e1de49592cd128b0/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/640dc7a474b071503f5a2067e1de49592cd128b0/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=640dc7a474b071503f5a2067e1de49592cd128b0",
            "patch": "@@ -1381,13 +1381,11 @@ void SSLWrap<Base>::AddMethods(Environment* env, Local<FunctionTemplate> t) {\n   env->SetProtoMethod(t, \"setSession\", SetSession);\n   env->SetProtoMethod(t, \"loadSession\", LoadSession);\n   env->SetProtoMethodNoSideEffect(t, \"isSessionReused\", IsSessionReused);\n-  env->SetProtoMethodNoSideEffect(t, \"isInitFinished\", IsInitFinished);\n   env->SetProtoMethodNoSideEffect(t, \"verifyError\", VerifyError);\n   env->SetProtoMethodNoSideEffect(t, \"getCurrentCipher\", GetCurrentCipher);\n   env->SetProtoMethod(t, \"endParser\", EndParser);\n   env->SetProtoMethod(t, \"certCbDone\", CertCbDone);\n   env->SetProtoMethod(t, \"renegotiate\", Renegotiate);\n-  env->SetProtoMethod(t, \"shutdownSSL\", Shutdown);\n   env->SetProtoMethodNoSideEffect(t, \"getTLSTicket\", GetTLSTicket);\n   env->SetProtoMethod(t, \"newSessionDone\", NewSessionDone);\n   env->SetProtoMethod(t, \"setOCSPResponse\", SetOCSPResponse);\n@@ -1993,16 +1991,6 @@ void SSLWrap<Base>::Renegotiate(const FunctionCallbackInfo<Value>& args) {\n }\n \n \n-template <class Base>\n-void SSLWrap<Base>::Shutdown(const FunctionCallbackInfo<Value>& args) {\n-  Base* w;\n-  ASSIGN_OR_RETURN_UNWRAP(&w, args.Holder());\n-\n-  int rv = SSL_shutdown(w->ssl_.get());\n-  args.GetReturnValue().Set(rv);\n-}\n-\n-\n template <class Base>\n void SSLWrap<Base>::GetTLSTicket(const FunctionCallbackInfo<Value>& args) {\n   Base* w;\n@@ -2136,15 +2124,6 @@ void SSLWrap<Base>::SetMaxSendFragment(\n #endif  // SSL_set_max_send_fragment\n \n \n-template <class Base>\n-void SSLWrap<Base>::IsInitFinished(const FunctionCallbackInfo<Value>& args) {\n-  Base* w;\n-  ASSIGN_OR_RETURN_UNWRAP(&w, args.Holder());\n-  bool yes = SSL_is_init_finished(w->ssl_.get());\n-  args.GetReturnValue().Set(yes);\n-}\n-\n-\n template <class Base>\n void SSLWrap<Base>::VerifyError(const FunctionCallbackInfo<Value>& args) {\n   Base* w;"
        },
        {
            "sha": "75b35c5f3c5b3cdbafca537f9f4e6aa21168195e",
            "filename": "test/parallel/test-tls-close-notify.js",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/640dc7a474b071503f5a2067e1de49592cd128b0/test%2Fparallel%2Ftest-tls-close-notify.js",
            "raw_url": "https://github.com/nodejs/node/raw/640dc7a474b071503f5a2067e1de49592cd128b0/test%2Fparallel%2Ftest-tls-close-notify.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-close-notify.js?ref=640dc7a474b071503f5a2067e1de49592cd128b0",
            "patch": "@@ -27,14 +27,17 @@ if (!common.hasCrypto)\n \n const tls = require('tls');\n const fixtures = require('../common/fixtures');\n+const { ShutdownWrap } = process.binding('stream_wrap');\n \n const server = tls.createServer({\n   key: fixtures.readKey('agent1-key.pem'),\n   cert: fixtures.readKey('agent1-cert.pem')\n }, function(c) {\n   // Send close-notify without shutting down TCP socket\n-  if (c._handle.shutdownSSL() !== 1)\n-    c._handle.shutdownSSL();\n+  const req = new ShutdownWrap();\n+  req.oncomplete = common.mustCall(() => {});\n+  req.handle = c._handle;\n+  c._handle.shutdown(req);\n }).listen(0, common.mustCall(function() {\n   const c = tls.connect(this.address().port, {\n     rejectUnauthorized: false"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 5,
        "deletions": 23
    }
}