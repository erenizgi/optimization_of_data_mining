{
    "author": "starkwang",
    "message": "http: reduce duplicated code for cleaning parser\n\nPR-URL: https://github.com/nodejs/node/pull/23351\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "d7f17b2a6107e25ac343cf11667b3f6b8d48f4a3",
    "files": [
        {
            "sha": "8b68d0c81500a8d9ad5b43ed3da3aa09c2ff0ee5",
            "filename": "lib/_http_common.js",
            "status": "modified",
            "additions": 13,
            "deletions": 19,
            "changes": 32,
            "blob_url": "https://github.com/nodejs/node/blob/d7f17b2a6107e25ac343cf11667b3f6b8d48f4a3/lib%2F_http_common.js",
            "raw_url": "https://github.com/nodejs/node/raw/d7f17b2a6107e25ac343cf11667b3f6b8d48f4a3/lib%2F_http_common.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_common.js?ref=d7f17b2a6107e25ac343cf11667b3f6b8d48f4a3",
            "patch": "@@ -151,22 +151,13 @@ function parserOnMessageComplete() {\n const parsers = new FreeList('parsers', 1000, function parsersCb() {\n   const parser = new HTTPParser(HTTPParser.REQUEST);\n \n-  parser._headers = [];\n-  parser._url = '';\n-  parser._consumed = false;\n-\n-  parser.socket = null;\n-  parser.incoming = null;\n-  parser.outgoing = null;\n-\n-  parser.maxHeaderPairs = MAX_HEADER_PAIRS;\n+  cleanParser(parser);\n \n   parser.onIncoming = null;\n   parser[kOnHeaders] = parserOnHeaders;\n   parser[kOnHeadersComplete] = parserOnHeadersComplete;\n   parser[kOnBody] = parserOnBody;\n   parser[kOnMessageComplete] = parserOnMessageComplete;\n-  parser[kOnExecute] = null;\n \n   return parser;\n });\n@@ -182,17 +173,9 @@ function closeParserInstance(parser) { parser.close(); }\n // should be all that is needed.\n function freeParser(parser, req, socket) {\n   if (parser) {\n-    parser._headers = [];\n-    parser._url = '';\n-    parser.maxHeaderPairs = MAX_HEADER_PAIRS;\n-    parser.onIncoming = null;\n     if (parser._consumed)\n       parser.unconsume();\n-    parser._consumed = false;\n-    parser.socket = null;\n-    parser.incoming = null;\n-    parser.outgoing = null;\n-    parser[kOnExecute] = null;\n+    cleanParser(parser);\n     if (parsers.free(parser) === false) {\n       // Make sure the parser's stack has unwound before deleting the\n       // corresponding C++ object through .close().\n@@ -238,6 +221,17 @@ function checkInvalidHeaderChar(val) {\n   return headerCharRegex.test(val);\n }\n \n+function cleanParser(parser) {\n+  parser._headers = [];\n+  parser._url = '';\n+  parser.socket = null;\n+  parser.incoming = null;\n+  parser.outgoing = null;\n+  parser.maxHeaderPairs = MAX_HEADER_PAIRS;\n+  parser[kOnExecute] = null;\n+  parser._consumed = false;\n+}\n+\n module.exports = {\n   _checkInvalidHeaderChar: checkInvalidHeaderChar,\n   _checkIsHttpToken: checkIsHttpToken,"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 13,
        "deletions": 19
    }
}