{
    "author": "addaleax",
    "message": "src,lib: remove dead `process.binding()` code\n\nThere are no non-internal builtin modules left, so this\nshould be safe to remove to a large degree.\n\nPR-URL: https://github.com/nodejs/node/pull/25829\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anto Aravinth <anto.aravinth.cse@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>",
    "sha": "270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8",
    "files": [
        {
            "sha": "da8c4bda9ace80b525c107ed9dd72352062f7a10",
            "filename": "lib/internal/bootstrap/cache.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/lib%2Finternal%2Fbootstrap%2Fcache.js",
            "raw_url": "https://github.com/nodejs/node/raw/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/lib%2Finternal%2Fbootstrap%2Fcache.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fcache.js?ref=270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8",
            "patch": "@@ -9,7 +9,7 @@ const { NativeModule } = require('internal/bootstrap/loaders');\n const {\n   getCodeCache, compileFunction\n } = internalBinding('native_module');\n-const { hasTracing, hasInspector } = process.binding('config');\n+const { hasTracing, hasInspector } = internalBinding('config');\n \n // Modules with source code compiled in js2c that\n // cannot be compiled with the code cache."
        },
        {
            "sha": "d21fddbf5239a18f973a98ce5af597e36a5d3d95",
            "filename": "lib/internal/bootstrap/loaders.js",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "raw_url": "https://github.com/nodejs/node/raw/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Floaders.js?ref=270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8",
            "patch": "@@ -41,7 +41,7 @@\n \n // This file is compiled as if it's wrapped in a function with arguments\n // passed by node::RunBootstrapping()\n-/* global process, getBinding, getLinkedBinding, getInternalBinding */\n+/* global process, getLinkedBinding, getInternalBinding */\n /* global experimentalModules, exposeInternals, primordials */\n \n const {\n@@ -108,12 +108,8 @@ const internalBindingWhitelist = new SafeSet([\n     if (internalBindingWhitelist.has(module)) {\n       return internalBinding(module);\n     }\n-    let mod = bindingObj[module];\n-    if (typeof mod !== 'object') {\n-      mod = bindingObj[module] = getBinding(module);\n-      moduleLoadList.push(`Binding ${module}`);\n-    }\n-    return mod;\n+    // eslint-disable-next-line no-restricted-syntax\n+    throw new Error(`No such module: ${module}`);\n   };\n \n   process._linkedBinding = function _linkedBinding(module) {"
        },
        {
            "sha": "3bfc531455ca1c79f7aec3d9275845f00d7c16ac",
            "filename": "lib/internal/crypto/diffiehellman.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/lib%2Finternal%2Fcrypto%2Fdiffiehellman.js",
            "raw_url": "https://github.com/nodejs/node/raw/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/lib%2Finternal%2Fcrypto%2Fdiffiehellman.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fdiffiehellman.js?ref=270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8",
            "patch": "@@ -19,7 +19,7 @@ const {\n   DiffieHellmanGroup: _DiffieHellmanGroup,\n   ECDH: _ECDH,\n   ECDHConvertKey: _ECDHConvertKey\n-} = process.binding('crypto');\n+} = internalBinding('crypto');\n const {\n   POINT_CONVERSION_COMPRESSED,\n   POINT_CONVERSION_HYBRID,"
        },
        {
            "sha": "d486d83e9128ad6adb8f1a9afe09f5510b0b9c4d",
            "filename": "lib/internal/crypto/hash.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/lib%2Finternal%2Fcrypto%2Fhash.js",
            "raw_url": "https://github.com/nodejs/node/raw/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/lib%2Finternal%2Fcrypto%2Fhash.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fhash.js?ref=270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8",
            "patch": "@@ -3,7 +3,7 @@\n const {\n   Hash: _Hash,\n   Hmac: _Hmac\n-} = process.binding('crypto');\n+} = internalBinding('crypto');\n \n const {\n   getDefaultEncoding,"
        },
        {
            "sha": "62f4550265c292c7c0e3262a0091003a65e31749",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8",
            "patch": "@@ -282,7 +282,6 @@ MaybeLocal<Value> RunBootstrapping(Environment* env) {\n   // Create binding loaders\n   std::vector<Local<String>> loaders_params = {\n       env->process_string(),\n-      FIXED_ONE_BYTE_STRING(isolate, \"getBinding\"),\n       FIXED_ONE_BYTE_STRING(isolate, \"getLinkedBinding\"),\n       FIXED_ONE_BYTE_STRING(isolate, \"getInternalBinding\"),\n       // --experimental-modules\n@@ -292,9 +291,6 @@ MaybeLocal<Value> RunBootstrapping(Environment* env) {\n       env->primordials_string()};\n   std::vector<Local<Value>> loaders_args = {\n       process,\n-      env->NewFunctionTemplate(binding::GetBinding)\n-          ->GetFunction(context)\n-          .ToLocalChecked(),\n       env->NewFunctionTemplate(binding::GetLinkedBinding)\n           ->GetFunction(context)\n           .ToLocalChecked(),"
        },
        {
            "sha": "08d55567d4904a63805a5d510c5d82fd2c57785f",
            "filename": "src/node_binding.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 33,
            "changes": 36,
            "blob_url": "https://github.com/nodejs/node/blob/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/src%2Fnode_binding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/src%2Fnode_binding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_binding.cc?ref=270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8",
            "patch": "@@ -84,7 +84,7 @@\n // function for each built-in modules explicitly in\n // binding::RegisterBuiltinModules(). This is only forward declaration.\n // The definitions are in each module's implementation when calling\n-// the NODE_BUILTIN_MODULE_CONTEXT_AWARE.\n+// the NODE_MODULE_CONTEXT_AWARE_INTERNAL.\n #define V(modname) void _register_##modname();\n NODE_BUILTIN_MODULES(V)\n #undef V\n@@ -101,7 +101,6 @@ using v8::String;\n using v8::Value;\n \n // Globals per process\n-static node_module* modlist_builtin;\n static node_module* modlist_internal;\n static node_module* modlist_linked;\n static node_module* modlist_addon;\n@@ -114,10 +113,7 @@ bool node_is_initialized = false;\n extern \"C\" void node_module_register(void* m) {\n   struct node_module* mp = reinterpret_cast<struct node_module*>(m);\n \n-  if (mp->nm_flags & NM_F_BUILTIN) {\n-    mp->nm_link = modlist_builtin;\n-    modlist_builtin = mp;\n-  } else if (mp->nm_flags & NM_F_INTERNAL) {\n+  if (mp->nm_flags & NM_F_INTERNAL) {\n     mp->nm_link = modlist_internal;\n     modlist_internal = mp;\n   } else if (!node_is_initialized) {\n@@ -295,11 +291,7 @@ void DLOpen(const FunctionCallbackInfo<Value>& args) {\n       env->ThrowError(errmsg);\n       return false;\n     }\n-    if (mp->nm_flags & NM_F_BUILTIN) {\n-      dlib->Close();\n-      env->ThrowError(\"Built-in module self-registered.\");\n-      return false;\n-    }\n+    CHECK_EQ(mp->nm_flags & NM_F_BUILTIN, 0);\n \n     mp->nm_dso_handle = dlib->handle_;\n     mp->nm_link = modlist_addon;\n@@ -335,9 +327,6 @@ inline struct node_module* FindModule(struct node_module* list,\n   return mp;\n }\n \n-node_module* get_builtin_module(const char* name) {\n-  return FindModule(modlist_builtin, name, NM_F_BUILTIN);\n-}\n node_module* get_internal_module(const char* name) {\n   return FindModule(modlist_internal, name, NM_F_INTERNAL);\n }\n@@ -363,25 +352,6 @@ static void ThrowIfNoSuchModule(Environment* env, const char* module_v) {\n   env->ThrowError(errmsg);\n }\n \n-void GetBinding(const FunctionCallbackInfo<Value>& args) {\n-  Environment* env = Environment::GetCurrent(args);\n-\n-  CHECK(args[0]->IsString());\n-\n-  Local<String> module = args[0].As<String>();\n-  node::Utf8Value module_v(env->isolate(), module);\n-\n-  node_module* mod = get_builtin_module(*module_v);\n-  Local<Object> exports;\n-  if (mod != nullptr) {\n-    exports = InitModule(env, mod, module);\n-  } else {\n-    return ThrowIfNoSuchModule(env, *module_v);\n-  }\n-\n-  args.GetReturnValue().Set(exports);\n-}\n-\n void GetInternalBinding(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n "
        },
        {
            "sha": "d73e18548ff47e1b9c0a965799db632010396c24",
            "filename": "src/node_binding.h",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/src%2Fnode_binding.h",
            "raw_url": "https://github.com/nodejs/node/raw/270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8/src%2Fnode_binding.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_binding.h?ref=270ffb0fa7dc9a771f6a4029ee5b77ed490eb8e8",
            "patch": "@@ -15,7 +15,7 @@\n #include \"v8.h\"\n \n enum {\n-  NM_F_BUILTIN = 1 << 0,\n+  NM_F_BUILTIN = 1 << 0,  // Unused.\n   NM_F_LINKED = 1 << 1,\n   NM_F_INTERNAL = 1 << 2,\n };\n@@ -33,9 +33,6 @@ enum {\n       nullptr};                                                                \\\n   void _register_##modname() { node_module_register(&_module); }\n \n-#define NODE_BUILTIN_MODULE_CONTEXT_AWARE(modname, regfunc)                    \\\n-  NODE_MODULE_CONTEXT_AWARE_CPP(modname, regfunc, nullptr, NM_F_BUILTIN)\n-\n void napi_module_register_by_symbol(v8::Local<v8::Object> exports,\n                                     v8::Local<v8::Value> module,\n                                     v8::Local<v8::Context> context,\n@@ -83,7 +80,6 @@ class DLib {\n // use the __attribute__((constructor)). Need to\n // explicitly call the _register* functions.\n void RegisterBuiltinModules();\n-void GetBinding(const v8::FunctionCallbackInfo<v8::Value>& args);\n void GetInternalBinding(const v8::FunctionCallbackInfo<v8::Value>& args);\n void GetLinkedBinding(const v8::FunctionCallbackInfo<v8::Value>& args);\n void DLOpen(const v8::FunctionCallbackInfo<v8::Value>& args);\n@@ -92,7 +88,5 @@ void DLOpen(const v8::FunctionCallbackInfo<v8::Value>& args);\n \n }  // namespace node\n \n-#include \"node_binding.h\"\n-\n #endif  // defined(NODE_WANT_INTERNALS) && NODE_WANT_INTERNALS\n #endif  // SRC_NODE_BINDING_H_"
        }
    ],
    "stats": {
        "total": 64,
        "additions": 10,
        "deletions": 54
    }
}