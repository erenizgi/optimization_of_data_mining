{
    "author": "apapirovski",
    "message": "test: fix flaky timers-block-eventloop test\n\nDue to extensive reliance on timings and the fs module, this test\nis currently inherently flaky. Refactor it to simply use setImmediate\nand only one busy loop.\n\nPR-URL: https://github.com/nodejs/node/pull/18567\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "6963a93d0ec7b0020f243f2d49eba889a869cbed",
    "files": [
        {
            "sha": "811216fcb29e7d1f6d39b15212240b556ed7c9b5",
            "filename": "test/sequential/test-timers-block-eventloop.js",
            "status": "modified",
            "additions": 11,
            "deletions": 17,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/6963a93d0ec7b0020f243f2d49eba889a869cbed/test%2Fsequential%2Ftest-timers-block-eventloop.js",
            "raw_url": "https://github.com/nodejs/node/raw/6963a93d0ec7b0020f243f2d49eba889a869cbed/test%2Fsequential%2Ftest-timers-block-eventloop.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-timers-block-eventloop.js?ref=6963a93d0ec7b0020f243f2d49eba889a869cbed",
            "patch": "@@ -1,24 +1,18 @@\n 'use strict';\n \n const common = require('../common');\n-const fs = require('fs');\n-const platformTimeout = common.platformTimeout;\n+const assert = require('assert');\n \n+let called = false;\n const t1 = setInterval(() => {\n-  common.busyLoop(platformTimeout(12));\n-}, platformTimeout(10));\n-\n-const t2 = setInterval(() => {\n-  common.busyLoop(platformTimeout(15));\n-}, platformTimeout(10));\n-\n-const t3 =\n-  setTimeout(common.mustNotCall('eventloop blocked!'), platformTimeout(200));\n-\n-setTimeout(function() {\n-  fs.stat('/dev/nonexistent', () => {\n+  assert(!called);\n+  called = true;\n+  setImmediate(common.mustCall(() => {\n     clearInterval(t1);\n     clearInterval(t2);\n-    clearTimeout(t3);\n-  });\n-}, platformTimeout(50));\n+  }));\n+}, 10);\n+\n+const t2 = setInterval(() => {\n+  common.busyLoop(20);\n+}, 10);"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 11,
        "deletions": 17
    }
}