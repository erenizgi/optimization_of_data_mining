{
    "author": "trivikr",
    "message": "test: http2 errors on req.close()\n\nPR-URL: https://github.com/nodejs/node/pull/18854\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "15e02ceb1e7522c27f586bad878cdddc613fcada",
    "files": [
        {
            "sha": "01e0561c3a2d1c5ab1d3d396eb018c5e0b1de511",
            "filename": "test/parallel/test-http2-client-rststream-before-connect.js",
            "status": "modified",
            "additions": 16,
            "deletions": 4,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/15e02ceb1e7522c27f586bad878cdddc613fcada/test%2Fparallel%2Ftest-http2-client-rststream-before-connect.js",
            "raw_url": "https://github.com/nodejs/node/raw/15e02ceb1e7522c27f586bad878cdddc613fcada/test%2Fparallel%2Ftest-http2-client-rststream-before-connect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-client-rststream-before-connect.js?ref=15e02ceb1e7522c27f586bad878cdddc613fcada",
            "patch": "@@ -16,26 +16,38 @@ server.on('stream', (stream) => {\n server.listen(0, common.mustCall(() => {\n   const client = h2.connect(`http://localhost:${server.address().port}`);\n   const req = client.request();\n-  req.close(1);\n+  const closeCode = 1;\n+\n+  common.expectsError(\n+    () => req.close(2 ** 32),\n+    {\n+      type: RangeError,\n+      code: 'ERR_OUT_OF_RANGE',\n+      message: 'The value of \"code\" is out of range.'\n+    }\n+  );\n+  assert.strictEqual(req.closed, false);\n+\n+  req.close(closeCode, common.mustCall());\n   assert.strictEqual(req.closed, true);\n \n   // Make sure that destroy is called.\n   req._destroy = common.mustCall(req._destroy.bind(req));\n \n   // Second call doesn't do anything.\n-  req.close(8);\n+  req.close(closeCode + 1);\n \n   req.on('close', common.mustCall((code) => {\n     assert.strictEqual(req.destroyed, true);\n-    assert.strictEqual(code, 1);\n+    assert.strictEqual(code, closeCode);\n     server.close();\n     client.close();\n   }));\n \n   req.on('error', common.expectsError({\n     code: 'ERR_HTTP2_STREAM_ERROR',\n     type: Error,\n-    message: 'Stream closed with error code 1'\n+    message: `Stream closed with error code ${closeCode}`\n   }));\n \n   req.on('response', common.mustCall());"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 16,
        "deletions": 4
    }
}