{
    "author": "sam-github",
    "message": "tls: support \"BEGIN TRUSTED CERTIFICATE\" for ca:\n\nSupport the same PEM certificate formats for the ca: option to\ntls.createSecureContext() that are supported by openssl when loading a\nCAfile.\n\nFixes: https://github.com/nodejs/node/issues/24761\n\nPR-URL: https://github.com/nodejs/node/pull/24733\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>",
    "sha": "2e4a163012d9a960f014935272cd279e5e72a93b",
    "files": [
        {
            "sha": "9bfe2a902aa5daba3d7586ec9566f7b74c3c3cc1",
            "filename": "doc/api/tls.md",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/2e4a163012d9a960f014935272cd279e5e72a93b/doc%2Fapi%2Ftls.md",
            "raw_url": "https://github.com/nodejs/node/raw/2e4a163012d9a960f014935272cd279e5e72a93b/doc%2Fapi%2Ftls.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ftls.md?ref=2e4a163012d9a960f014935272cd279e5e72a93b",
            "patch": "@@ -1054,6 +1054,9 @@ argument.\n <!-- YAML\n added: v0.11.13\n changes:\n+  - version: REPLACEME\n+    pr-url: REPLACEME\n+    description: The `ca:` option now supports `BEGIN TRUSTED CERTIFICATE`.\n   - version: v11.4.0\n     pr-url: https://github.com/nodejs/node/pull/24405\n     description: The `minVersion` and `maxVersion` can be used to restrict\n@@ -1092,8 +1095,8 @@ changes:\n     certificate can match or chain to.\n     For self-signed certificates, the certificate is its own CA, and must be\n     provided.\n-    For PEM encoded certificates, supported types are \"X509 CERTIFICATE\", and\n-    \"CERTIFICATE\".\n+    For PEM encoded certificates, supported types are \"TRUSTED CERTIFICATE\",\n+    \"X509 CERTIFICATE\", and \"CERTIFICATE\".\n   * `cert` {string|string[]|Buffer|Buffer[]} Cert chains in PEM format. One cert\n     chain should be provided per private key. Each cert chain should consist of\n     the PEM formatted certificate for a provided private `key`, followed by the"
        },
        {
            "sha": "cf3b524a9d1485697c7ba38a657a4614f295af6c",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2e4a163012d9a960f014935272cd279e5e72a93b/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/2e4a163012d9a960f014935272cd279e5e72a93b/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=2e4a163012d9a960f014935272cd279e5e72a93b",
            "patch": "@@ -819,7 +819,7 @@ void SecureContext::AddCACert(const FunctionCallbackInfo<Value>& args) {\n     return;\n \n   X509_STORE* cert_store = SSL_CTX_get_cert_store(sc->ctx_.get());\n-  while (X509* x509 = PEM_read_bio_X509(\n+  while (X509* x509 = PEM_read_bio_X509_AUX(\n       bio.get(), nullptr, NoPasswordCallback, nullptr)) {\n     if (cert_store == root_cert_store) {\n       cert_store = NewRootCertStore();"
        },
        {
            "sha": "1f8c7e6096ff118b3a5fc33b31e85c797dcd7933",
            "filename": "test/parallel/test-tls-client-auth.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/2e4a163012d9a960f014935272cd279e5e72a93b/test%2Fparallel%2Ftest-tls-client-auth.js",
            "raw_url": "https://github.com/nodejs/node/raw/2e4a163012d9a960f014935272cd279e5e72a93b/test%2Fparallel%2Ftest-tls-client-auth.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-client-auth.js?ref=2e4a163012d9a960f014935272cd279e5e72a93b",
            "patch": "@@ -254,7 +254,7 @@ connect({\n   return cleanup();\n });\n \n-// Confirm lack of support for \"BEGIN TRUSTED CERTIFICATE\".\n+// Confirm support for \"BEGIN TRUSTED CERTIFICATE\".\n connect({\n   client: {\n     key: client.key,\n@@ -269,11 +269,11 @@ connect({\n     requestCert: true,\n   },\n }, function(err, pair, cleanup) {\n-  assert.strictEqual(err.code, 'UNABLE_TO_GET_ISSUER_CERT_LOCALLY');\n+  assert.ifError(err);\n   return cleanup();\n });\n \n-// Confirm lack of support for \"BEGIN TRUSTED CERTIFICATE\".\n+// Confirm support for \"BEGIN TRUSTED CERTIFICATE\".\n connect({\n   client: {\n     key: client.key,\n@@ -288,7 +288,7 @@ connect({\n     requestCert: true,\n   },\n }, function(err, pair, cleanup) {\n-  assert.strictEqual(err.code, 'ECONNRESET');\n+  assert.ifError(err);\n   return cleanup();\n });\n "
        }
    ],
    "stats": {
        "total": 17,
        "additions": 10,
        "deletions": 7
    }
}