{
    "author": "apapirovski",
    "message": "timers: prevent event loop blocking\n\nWhen an interval takes as long or longer to run as its timeout setting\nand the roundtrip from rearm() to its deferal takes exactly 1ms, that\ninterval can then block the event loop. This is an edge case of another\nrecently fixed bug (which in itself was an edge case).\n\nPR-URL: https://github.com/nodejs/node/pull/18486\nRefs: https://github.com/nodejs/node/pull/15072\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>",
    "sha": "47a984ada005d4db150b3d0ebd71b560411e7470",
    "files": [
        {
            "sha": "79fc432dcdf3d712a5da315839c8f38682112333",
            "filename": "lib/timers.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/47a984ada005d4db150b3d0ebd71b560411e7470/lib%2Ftimers.js",
            "raw_url": "https://github.com/nodejs/node/raw/47a984ada005d4db150b3d0ebd71b560411e7470/lib%2Ftimers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftimers.js?ref=47a984ada005d4db150b3d0ebd71b560411e7470",
            "patch": "@@ -238,7 +238,7 @@ TimerWrap.prototype[kOnTimeout] = function listOnTimeout(now) {\n     // This happens if there are more timers scheduled for later in the list.\n     if (diff < msecs) {\n       var timeRemaining = msecs - (TimerWrap.now() - timer._idleStart);\n-      if (timeRemaining < 0) {\n+      if (timeRemaining <= 0) {\n         timeRemaining = 1;\n       }\n       this.start(timeRemaining);"
        },
        {
            "sha": "cb60d7e45270d6586237d5e19676b7af5bd11230",
            "filename": "test/sequential/test-timers-set-interval-excludes-callback-duration.js",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/47a984ada005d4db150b3d0ebd71b560411e7470/test%2Fsequential%2Ftest-timers-set-interval-excludes-callback-duration.js",
            "raw_url": "https://github.com/nodejs/node/raw/47a984ada005d4db150b3d0ebd71b560411e7470/test%2Fsequential%2Ftest-timers-set-interval-excludes-callback-duration.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-timers-set-interval-excludes-callback-duration.js?ref=47a984ada005d4db150b3d0ebd71b560411e7470",
            "patch": "@@ -9,9 +9,16 @@ const t = setInterval(() => {\n   cntr++;\n   if (cntr === 1) {\n     common.busyLoop(100);\n+    // ensure that the event loop passes before the second interval\n+    setImmediate(() => assert.strictEqual(cntr, 1));\n     first = Timer.now();\n   } else if (cntr === 2) {\n     assert(Timer.now() - first < 100);\n     clearInterval(t);\n   }\n }, 100);\n+const t2 = setInterval(() => {\n+  if (cntr === 2) {\n+    clearInterval(t2);\n+  }\n+}, 100);"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 8,
        "deletions": 1
    }
}