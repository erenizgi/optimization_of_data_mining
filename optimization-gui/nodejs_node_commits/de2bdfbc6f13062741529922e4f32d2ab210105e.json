{
    "author": "addaleax",
    "message": "src: simplify SlicedArguments\n\nRe-use the existing `MaybeStackBuffer` logic for `SlicedArguments`.\n\nPR-URL: https://github.com/nodejs/node/pull/25745\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "de2bdfbc6f13062741529922e4f32d2ab210105e",
    "files": [
        {
            "sha": "48ebd73817a50edc23a33af043ddf79cc3eb1df3",
            "filename": "src/inspector_js_api.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/de2bdfbc6f13062741529922e4f32d2ab210105e/src%2Finspector_js_api.cc",
            "raw_url": "https://github.com/nodejs/node/raw/de2bdfbc6f13062741529922e4f32d2ab210105e/src%2Finspector_js_api.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector_js_api.cc?ref=de2bdfbc6f13062741529922e4f32d2ab210105e",
            "patch": "@@ -139,7 +139,7 @@ void CallAndPauseOnStart(const FunctionCallbackInfo<v8::Value>& args) {\n   env->inspector_agent()->PauseOnNextJavascriptStatement(\"Break on start\");\n   v8::MaybeLocal<v8::Value> retval =\n       args[0].As<v8::Function>()->Call(env->context(), args[1],\n-                                       call_args.size(), call_args.data());\n+                                       call_args.length(), call_args.out());\n   if (!retval.IsEmpty()) {\n     args.GetReturnValue().Set(retval.ToLocalChecked());\n   }\n@@ -164,8 +164,8 @@ void InspectorConsoleCall(const FunctionCallbackInfo<Value>& info) {\n                                v8::True(isolate)).FromJust());\n       CHECK(!inspector_method.As<Function>()->Call(context,\n                                                    info.Holder(),\n-                                                   call_args.size(),\n-                                                   call_args.data()).IsEmpty());\n+                                                   call_args.length(),\n+                                                   call_args.out()).IsEmpty());\n     }\n     CHECK(config_object->Delete(context, in_call_key).FromJust());\n   }\n@@ -174,8 +174,8 @@ void InspectorConsoleCall(const FunctionCallbackInfo<Value>& info) {\n   CHECK(node_method->IsFunction());\n   node_method.As<Function>()->Call(context,\n                                    info.Holder(),\n-                                   call_args.size(),\n-                                   call_args.data()).FromMaybe(Local<Value>());\n+                                   call_args.length(),\n+                                   call_args.out()).FromMaybe(Local<Value>());\n }\n \n static void* GetAsyncTask(int64_t asyncId) {"
        },
        {
            "sha": "cefd0ff26dbf95760bdeceadd2ba749efad51faa",
            "filename": "src/node_perf.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/de2bdfbc6f13062741529922e4f32d2ab210105e/src%2Fnode_perf.cc",
            "raw_url": "https://github.com/nodejs/node/raw/de2bdfbc6f13062741529922e4f32d2ab210105e/src%2Fnode_perf.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_perf.cc?ref=de2bdfbc6f13062741529922e4f32d2ab210105e",
            "patch": "@@ -344,10 +344,10 @@ void TimerFunctionCall(const FunctionCallbackInfo<Value>& args) {\n   v8::MaybeLocal<Value> ret;\n \n   if (is_construct_call) {\n-    ret = fn->NewInstance(context, call_args.size(), call_args.data())\n+    ret = fn->NewInstance(context, call_args.length(), call_args.out())\n         .FromMaybe(Local<Object>());\n   } else {\n-    ret = fn->Call(context, args.This(), call_args.size(), call_args.data());\n+    ret = fn->Call(context, args.This(), call_args.length(), call_args.out());\n   }\n \n   uint64_t end = PERFORMANCE_NOW();"
        },
        {
            "sha": "182c50268d3e0a831e03c177d7c18958cf97c4e0",
            "filename": "src/util-inl.h",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/de2bdfbc6f13062741529922e4f32d2ab210105e/src%2Futil-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/de2bdfbc6f13062741529922e4f32d2ab210105e/src%2Futil-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Futil-inl.h?ref=de2bdfbc6f13062741529922e4f32d2ab210105e",
            "patch": "@@ -455,6 +455,17 @@ v8::MaybeLocal<v8::Value> ToV8Value(v8::Local<v8::Context> context,\n   return v8::Number::New(isolate, static_cast<double>(number));\n }\n \n+SlicedArguments::SlicedArguments(\n+    const v8::FunctionCallbackInfo<v8::Value>& args, size_t start) {\n+  const size_t length = static_cast<size_t>(args.Length());\n+  if (start >= length) return;\n+  const size_t size = length - start;\n+\n+  AllocateSufficientStorage(size);\n+  for (size_t i = 0; i < size; ++i)\n+    (*this)[i] = args[i + start];\n+}\n+\n }  // namespace node\n \n #endif  // defined(NODE_WANT_INTERNALS) && NODE_WANT_INTERNALS"
        },
        {
            "sha": "fcb543fcacfaab3116cb00286de704bee5bafcff",
            "filename": "src/util.h",
            "status": "modified",
            "additions": 1,
            "deletions": 26,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/de2bdfbc6f13062741529922e4f32d2ab210105e/src%2Futil.h",
            "raw_url": "https://github.com/nodejs/node/raw/de2bdfbc6f13062741529922e4f32d2ab210105e/src%2Futil.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Futil.h?ref=de2bdfbc6f13062741529922e4f32d2ab210105e",
            "patch": "@@ -629,37 +629,12 @@ constexpr T RoundUp(T a, T b) {\n #define MUST_USE_RESULT\n #endif\n \n-class SlicedArguments {\n+class SlicedArguments : public MaybeStackBuffer<v8::Local<v8::Value>> {\n  public:\n   inline explicit SlicedArguments(\n       const v8::FunctionCallbackInfo<v8::Value>& args, size_t start = 0);\n-  inline size_t size() const { return size_; }\n-  inline v8::Local<v8::Value>* data() { return data_; }\n-\n- private:\n-  size_t size_;\n-  v8::Local<v8::Value>* data_;\n-  v8::Local<v8::Value> fixed_[64];\n-  std::vector<v8::Local<v8::Value>> dynamic_;\n };\n \n-SlicedArguments::SlicedArguments(\n-    const v8::FunctionCallbackInfo<v8::Value>& args, size_t start)\n-    : size_(0), data_(fixed_) {\n-  const size_t length = static_cast<size_t>(args.Length());\n-  if (start >= length) return;\n-  const size_t size = length - start;\n-\n-  if (size > arraysize(fixed_)) {\n-    dynamic_.resize(size);\n-    data_ = dynamic_.data();\n-  }\n-\n-  for (size_t i = 0; i < size; ++i) data_[i] = args[i + start];\n-\n-  size_ = size;\n-}\n-\n }  // namespace node\n \n #endif  // defined(NODE_WANT_INTERNALS) && NODE_WANT_INTERNALS"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 19,
        "deletions": 33
    }
}