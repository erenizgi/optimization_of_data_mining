{
    "author": "addaleax",
    "message": "src: move `Environment` ctor/dtor into env.cc\n\nThis makes it easier to use methods from other headers\nin the constructor and destructor.\n\nPR-URL: https://github.com/nodejs/node/pull/19202\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "e0bd2f31e584d8b188148084f97e80bc1573e555",
    "files": [
        {
            "sha": "8883903cb1810cf716f8af1830af1f65ee6ed3ba",
            "filename": "src/env-inl.h",
            "status": "modified",
            "additions": 0,
            "deletions": 61,
            "changes": 61,
            "blob_url": "https://github.com/nodejs/node/blob/e0bd2f31e584d8b188148084f97e80bc1573e555/src%2Fenv-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0bd2f31e584d8b188148084f97e80bc1573e555/src%2Fenv-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv-inl.h?ref=e0bd2f31e584d8b188148084f97e80bc1573e555",
            "patch": "@@ -318,67 +318,6 @@ inline Environment* Environment::GetThreadLocalEnv() {\n   return static_cast<Environment*>(uv_key_get(&thread_local_env));\n }\n \n-inline Environment::Environment(IsolateData* isolate_data,\n-                                v8::Local<v8::Context> context)\n-    : isolate_(context->GetIsolate()),\n-      isolate_data_(isolate_data),\n-      immediate_info_(context->GetIsolate()),\n-      tick_info_(context->GetIsolate()),\n-      timer_base_(uv_now(isolate_data->event_loop())),\n-      printed_error_(false),\n-      trace_sync_io_(false),\n-      abort_on_uncaught_exception_(false),\n-      emit_napi_warning_(true),\n-      emit_env_nonstring_warning_(true),\n-      makecallback_cntr_(0),\n-      should_abort_on_uncaught_toggle_(isolate_, 1),\n-#if HAVE_INSPECTOR\n-      inspector_agent_(new inspector::Agent(this)),\n-#endif\n-      handle_cleanup_waiting_(0),\n-      http_parser_buffer_(nullptr),\n-      fs_stats_field_array_(isolate_, kFsStatsFieldsLength),\n-      context_(context->GetIsolate(), context) {\n-  // We'll be creating new objects so make sure we've entered the context.\n-  v8::HandleScope handle_scope(isolate());\n-  v8::Context::Scope context_scope(context);\n-  set_as_external(v8::External::New(isolate(), this));\n-\n-  AssignToContext(context, ContextInfo(\"\"));\n-\n-  destroy_async_id_list_.reserve(512);\n-  performance_state_.reset(new performance::performance_state(isolate()));\n-  performance_state_->milestones[\n-      performance::NODE_PERFORMANCE_MILESTONE_ENVIRONMENT] =\n-          PERFORMANCE_NOW();\n-  performance_state_->milestones[\n-    performance::NODE_PERFORMANCE_MILESTONE_NODE_START] =\n-        performance::performance_node_start;\n-  performance_state_->milestones[\n-    performance::NODE_PERFORMANCE_MILESTONE_V8_START] =\n-        performance::performance_v8_start;\n-\n-  // By default, always abort when --abort-on-uncaught-exception was passed.\n-  should_abort_on_uncaught_toggle_[0] = 1;\n-}\n-\n-inline Environment::~Environment() {\n-  v8::HandleScope handle_scope(isolate());\n-\n-#if HAVE_INSPECTOR\n-  // Destroy inspector agent before erasing the context. The inspector\n-  // destructor depends on the context still being accessible.\n-  inspector_agent_.reset();\n-#endif\n-\n-  context()->SetAlignedPointerInEmbedderData(\n-      ContextEmbedderIndex::kEnvironment, nullptr);\n-\n-  delete[] heap_statistics_buffer_;\n-  delete[] heap_space_statistics_buffer_;\n-  delete[] http_parser_buffer_;\n-}\n-\n inline v8::Isolate* Environment::isolate() const {\n   return isolate_;\n }"
        },
        {
            "sha": "6e090679c24baf1da78506c705c8fd58a61812e1",
            "filename": "src/env.cc",
            "status": "modified",
            "additions": 60,
            "deletions": 0,
            "changes": 60,
            "blob_url": "https://github.com/nodejs/node/blob/e0bd2f31e584d8b188148084f97e80bc1573e555/src%2Fenv.cc",
            "raw_url": "https://github.com/nodejs/node/raw/e0bd2f31e584d8b188148084f97e80bc1573e555/src%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.cc?ref=e0bd2f31e584d8b188148084f97e80bc1573e555",
            "patch": "@@ -85,6 +85,66 @@ void InitThreadLocalOnce() {\n   CHECK_EQ(0, uv_key_create(&Environment::thread_local_env));\n }\n \n+Environment::Environment(IsolateData* isolate_data,\n+                         Local<Context> context)\n+    : isolate_(context->GetIsolate()),\n+      isolate_data_(isolate_data),\n+      immediate_info_(context->GetIsolate()),\n+      tick_info_(context->GetIsolate()),\n+      timer_base_(uv_now(isolate_data->event_loop())),\n+      printed_error_(false),\n+      trace_sync_io_(false),\n+      abort_on_uncaught_exception_(false),\n+      emit_napi_warning_(true),\n+      makecallback_cntr_(0),\n+      should_abort_on_uncaught_toggle_(isolate_, 1),\n+#if HAVE_INSPECTOR\n+      inspector_agent_(new inspector::Agent(this)),\n+#endif\n+      handle_cleanup_waiting_(0),\n+      http_parser_buffer_(nullptr),\n+      fs_stats_field_array_(isolate_, kFsStatsFieldsLength),\n+      context_(context->GetIsolate(), context) {\n+  // We'll be creating new objects so make sure we've entered the context.\n+  v8::HandleScope handle_scope(isolate());\n+  v8::Context::Scope context_scope(context);\n+  set_as_external(v8::External::New(isolate(), this));\n+\n+  AssignToContext(context, ContextInfo(\"\"));\n+\n+  destroy_async_id_list_.reserve(512);\n+  performance_state_.reset(new performance::performance_state(isolate()));\n+  performance_state_->milestones[\n+      performance::NODE_PERFORMANCE_MILESTONE_ENVIRONMENT] =\n+          PERFORMANCE_NOW();\n+  performance_state_->milestones[\n+    performance::NODE_PERFORMANCE_MILESTONE_NODE_START] =\n+        performance::performance_node_start;\n+  performance_state_->milestones[\n+    performance::NODE_PERFORMANCE_MILESTONE_V8_START] =\n+        performance::performance_v8_start;\n+\n+  // By default, always abort when --abort-on-uncaught-exception was passed.\n+  should_abort_on_uncaught_toggle_[0] = 1;\n+}\n+\n+Environment::~Environment() {\n+  v8::HandleScope handle_scope(isolate());\n+\n+#if HAVE_INSPECTOR\n+  // Destroy inspector agent before erasing the context. The inspector\n+  // destructor depends on the context still being accessible.\n+  inspector_agent_.reset();\n+#endif\n+\n+  context()->SetAlignedPointerInEmbedderData(\n+      ContextEmbedderIndex::kEnvironment, nullptr);\n+\n+  delete[] heap_statistics_buffer_;\n+  delete[] heap_space_statistics_buffer_;\n+  delete[] http_parser_buffer_;\n+}\n+\n void Environment::Start(int argc,\n                         const char* const* argv,\n                         int exec_argc,"
        },
        {
            "sha": "0afd4da37ead791516277ba2f531bef8e871f30c",
            "filename": "src/env.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/e0bd2f31e584d8b188148084f97e80bc1573e555/src%2Fenv.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0bd2f31e584d8b188148084f97e80bc1573e555/src%2Fenv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.h?ref=e0bd2f31e584d8b188148084f97e80bc1573e555",
            "patch": "@@ -561,8 +561,8 @@ class Environment {\n   static uv_key_t thread_local_env;\n   static inline Environment* GetThreadLocalEnv();\n \n-  inline Environment(IsolateData* isolate_data, v8::Local<v8::Context> context);\n-  inline ~Environment();\n+  Environment(IsolateData* isolate_data, v8::Local<v8::Context> context);\n+  ~Environment();\n \n   void Start(int argc,\n              const char* const* argv,"
        }
    ],
    "stats": {
        "total": 125,
        "additions": 62,
        "deletions": 63
    }
}