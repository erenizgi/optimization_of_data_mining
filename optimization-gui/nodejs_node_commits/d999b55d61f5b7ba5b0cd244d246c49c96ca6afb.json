{
    "author": "jasnell",
    "message": "deps: float fix for building HdrHistogram on Win x86\n\nFrom:\nhttps://github.com/mcollina/native-hdr-histogram/commit/c63e97151dcff9b9aed1d8ea5e4f5964c69be32fideps:\n\nPR-URL: https://github.com/nodejs/node/pull/25378\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>\nReviewed-By: Stephen Belanger <admin@stephenbelanger.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "d999b55d61f5b7ba5b0cd244d246c49c96ca6afb",
    "files": [
        {
            "sha": "d9565b802e35642ecc77f5a656c5239f7cc59756",
            "filename": "deps/histogram/src/hdr_histogram.c",
            "status": "modified",
            "additions": 17,
            "deletions": 2,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/d999b55d61f5b7ba5b0cd244d246c49c96ca6afb/deps%2Fhistogram%2Fsrc%2Fhdr_histogram.c",
            "raw_url": "https://github.com/nodejs/node/raw/d999b55d61f5b7ba5b0cd244d246c49c96ca6afb/deps%2Fhistogram%2Fsrc%2Fhdr_histogram.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fhistogram%2Fsrc%2Fhdr_histogram.c?ref=d999b55d61f5b7ba5b0cd244d246c49c96ca6afb",
            "patch": "@@ -91,14 +91,29 @@ static int64_t power(int64_t base, int64_t exp)\n }\n \n #if defined(_MSC_VER)\n-#pragma intrinsic(_BitScanReverse64)\n+#  if defined(_WIN64)\n+#    pragma intrinsic(_BitScanReverse64)\n+#  else\n+#    pragma intrinsic(_BitScanReverse)\n+#  endif\n #endif\n \n static int32_t get_bucket_index(const struct hdr_histogram* h, int64_t value)\n {\n #if defined(_MSC_VER)\n     uint32_t leading_zero = 0;\n-    _BitScanReverse64(&leading_zero, value | h->sub_bucket_mask);\n+    int64_t masked_value = value | h->sub_bucket_mask;\n+#  if defined(_WIN64)\n+    _BitScanReverse64(&leading_zero, masked_value);\n+#  else\n+    uint32_t high = masked_value >> 32;\n+    if  (_BitScanReverse(&leading_zero, high)) {\n+      leading_zero += 32;\n+    } else {\n+      uint32_t low = masked_value & 0x00000000FFFFFFFF;\n+      _BitScanReverse(&leading_zero, low);\n+    }\n+#  endif\n     int32_t pow2ceiling = 64 - (63 - leading_zero); /* smallest power of 2 containing value */\n #else\n     int32_t pow2ceiling = 64 - __builtin_clzll(value | h->sub_bucket_mask); /* smallest power of 2 containing value */"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 17,
        "deletions": 2
    }
}