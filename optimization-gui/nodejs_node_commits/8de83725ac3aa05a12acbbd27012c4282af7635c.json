{
    "author": "BridgeAR",
    "message": "util: remove erroneous whitespace\n\nWhen inspecting nested objects some times a whitespace was added at\nthe end of a line. This fixes this erroneous space.\n\nBesides that the `breakLength` was not followed if a single property\nwas longer than the breakLength. It will now break a single property\ninto the key and value in such cases.\n\nPR-URL: https://github.com/nodejs/node/pull/20802\nRefs: https://github.com/nodejs/node/issues/20253\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "8de83725ac3aa05a12acbbd27012c4282af7635c",
    "files": [
        {
            "sha": "478d5c0442657651ccab036d1dfc563b489e5fa0",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 42,
            "deletions": 40,
            "changes": 82,
            "blob_url": "https://github.com/nodejs/node/blob/8de83725ac3aa05a12acbbd27012c4282af7635c/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/8de83725ac3aa05a12acbbd27012c4282af7635c/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=8de83725ac3aa05a12acbbd27012c4282af7635c",
            "patch": "@@ -416,7 +416,7 @@ function getPrefix(constructor, tag) {\n   return '';\n }\n \n-function formatValue(ctx, value, recurseTimes, ln) {\n+function formatValue(ctx, value, recurseTimes) {\n   // Primitive types cannot have properties\n   if (typeof value !== 'object' && typeof value !== 'function') {\n     return formatPrimitive(ctx.stylize, value, ctx);\n@@ -582,7 +582,7 @@ function formatValue(ctx, value, recurseTimes, ln) {\n         return ctx.stylize(dateToISOString.call(value), 'date');\n       }\n       // Make dates with properties first say the date\n-      base = `${dateToISOString.call(value)}`;\n+      base = dateToISOString.call(value);\n     } else if (isError(value)) {\n       // Make error with message first say the error\n       base = formatError(value);\n@@ -683,7 +683,7 @@ function formatValue(ctx, value, recurseTimes, ln) {\n   }\n   ctx.seen.pop();\n \n-  return reduceToSingleString(ctx, output, base, braces, ln);\n+  return reduceToSingleString(ctx, output, base, braces);\n }\n \n function formatNumber(fn, value) {\n@@ -758,7 +758,23 @@ function formatNamespaceObject(ctx, value, recurseTimes, keys) {\n   const len = keys.length;\n   const output = new Array(len);\n   for (var i = 0; i < len; i++) {\n-    output[i] = formatNamespaceProperty(ctx, value, recurseTimes, keys[i]);\n+    try {\n+      output[i] = formatProperty(ctx, value, recurseTimes, keys[i], 0);\n+    } catch (err) {\n+      if (!(err instanceof ReferenceError)) {\n+        throw err;\n+      }\n+      // Use the existing functionality. This makes sure the indentation and\n+      // line breaks are always correct. Otherwise it is very difficult to keep\n+      // this aligned, even though this is a hacky way of dealing with this.\n+      const tmp = { [keys[i]]: '' };\n+      output[i] = formatProperty(ctx, tmp, recurseTimes, keys[i], 0);\n+      const pos = output[i].lastIndexOf(' ');\n+      // We have to find the last whitespace and have to replace that value as\n+      // it will be visualized as a regular string.\n+      output[i] = output[i].slice(0, pos + 1) +\n+                  ctx.stylize('<uninitialized>', 'special');\n+    }\n   }\n   return output;\n }\n@@ -986,42 +1002,21 @@ function formatPromise(ctx, value, recurseTimes, keys) {\n   return output;\n }\n \n-function formatKey(ctx, key, enumerable) {\n-  if (typeof key === 'symbol') {\n-    return `[${ctx.stylize(key.toString(), 'symbol')}]`;\n-  }\n-  if (enumerable === false) {\n-    return `[${key}]`;\n-  }\n-  if (keyStrRegExp.test(key)) {\n-    return ctx.stylize(key, 'name');\n-  }\n-  return ctx.stylize(strEscape(key), 'string');\n-}\n-\n-function formatNamespaceProperty(ctx, ns, recurseTimes, key) {\n-  let value;\n-  try {\n-    value = formatValue(ctx, ns[key], recurseTimes, true);\n-  } catch (err) {\n-    if (err instanceof ReferenceError) {\n-      value = ctx.stylize('<uninitialized>', 'special');\n-    } else {\n-      throw err;\n-    }\n-  }\n-\n-  return `${formatKey(ctx, key)}: ${value}`;\n-}\n-\n function formatProperty(ctx, value, recurseTimes, key, array) {\n-  let str;\n+  let name, str;\n+  let extra = ' ';\n   const desc = Object.getOwnPropertyDescriptor(value, key) ||\n     { value: value[key], enumerable: true };\n   if (desc.value !== undefined) {\n     const diff = array !== 0 || ctx.compact === false ? 2 : 3;\n     ctx.indentationLvl += diff;\n-    str = formatValue(ctx, desc.value, recurseTimes, array === 0);\n+    str = formatValue(ctx, desc.value, recurseTimes);\n+    if (diff === 3) {\n+      const len = ctx.colors ? removeColors(str).length : str.length;\n+      if (ctx.breakLength < len) {\n+        extra = `\\n${' '.repeat(ctx.indentationLvl)}`;\n+      }\n+    }\n     ctx.indentationLvl -= diff;\n   } else if (desc.get !== undefined) {\n     if (desc.set !== undefined) {\n@@ -1037,11 +1032,19 @@ function formatProperty(ctx, value, recurseTimes, key, array) {\n   if (array === 1) {\n     return str;\n   }\n-\n-  return `${formatKey(ctx, key, desc.enumerable)}: ${str}`;\n+  if (typeof key === 'symbol') {\n+    name = `[${ctx.stylize(key.toString(), 'symbol')}]`;\n+  } else if (desc.enumerable === false) {\n+    name = `[${key}]`;\n+  } else if (keyStrRegExp.test(key)) {\n+    name = ctx.stylize(key, 'name');\n+  } else {\n+    name = ctx.stylize(strEscape(key), 'string');\n+  }\n+  return `${name}:${extra}${str}`;\n }\n \n-function reduceToSingleString(ctx, output, base, braces, addLn) {\n+function reduceToSingleString(ctx, output, base, braces) {\n   const breakLength = ctx.breakLength;\n   let i = 0;\n   if (ctx.compact === false) {\n@@ -1070,11 +1073,10 @@ function reduceToSingleString(ctx, output, base, braces, addLn) {\n   // we need to force the first item to be on the next line or the\n   // items will not line up correctly.\n   const indentation = ' '.repeat(ctx.indentationLvl);\n-  const extraLn = addLn === true ? `\\n${indentation}` : '';\n   const ln = base === '' && braces[0].length === 1 ?\n-    ' ' : `${base ? ` ${base}` : base}\\n${indentation}  `;\n+    ' ' : `${base ? ` ${base}` : ''}\\n${indentation}  `;\n   const str = join(output, `,\\n${indentation}  `);\n-  return `${extraLn}${braces[0]}${ln}${str} ${braces[1]}`;\n+  return `${braces[0]}${ln}${str} ${braces[1]}`;\n }\n \n function isBoolean(arg) {"
        },
        {
            "sha": "f99f85b78c853b7b177d55ae63c557aeceb07531",
            "filename": "test/parallel/test-util-format.js",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/8de83725ac3aa05a12acbbd27012c4282af7635c/test%2Fparallel%2Ftest-util-format.js",
            "raw_url": "https://github.com/nodejs/node/raw/8de83725ac3aa05a12acbbd27012c4282af7635c/test%2Fparallel%2Ftest-util-format.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-format.js?ref=8de83725ac3aa05a12acbbd27012c4282af7635c",
            "patch": "@@ -126,7 +126,7 @@ assert.strictEqual(\n   util.format('%o', obj),\n   '{ foo: \\'bar\\',\\n' +\n   '  foobar: 1,\\n' +\n-  '  func: \\n' +\n+  '  func:\\n' +\n   '   { [Function: func]\\n' +\n   '     [length]: 0,\\n' +\n   '     [name]: \\'func\\',\\n' +\n@@ -135,8 +135,8 @@ assert.strictEqual(\n   util.format('%o', nestedObj2),\n   '{ foo: \\'bar\\',\\n' +\n   '  foobar: 1,\\n' +\n-  '  func: \\n' +\n-  '   [ { a: \\n' +\n+  '  func:\\n' +\n+  '   [ { a:\\n' +\n   '        { [Function: a]\\n' +\n   '          [length]: 0,\\n' +\n   '          [name]: \\'a\\',\\n' +\n@@ -145,9 +145,9 @@ assert.strictEqual(\n assert.strictEqual(\n   util.format('%o', nestedObj),\n   '{ foo: \\'bar\\',\\n' +\n-  '  foobar: \\n' +\n+  '  foobar:\\n' +\n   '   { foo: \\'bar\\',\\n' +\n-  '     func: \\n' +\n+  '     func:\\n' +\n   '      { [Function: func]\\n' +\n   '        [length]: 0,\\n' +\n   '        [name]: \\'func\\',\\n' +\n@@ -156,14 +156,14 @@ assert.strictEqual(\n   util.format('%o %o', obj, obj),\n   '{ foo: \\'bar\\',\\n' +\n   '  foobar: 1,\\n' +\n-  '  func: \\n' +\n+  '  func:\\n' +\n   '   { [Function: func]\\n' +\n   '     [length]: 0,\\n' +\n   '     [name]: \\'func\\',\\n' +\n   '     [prototype]: func { [constructor]: [Circular] } } }' +\n   ' { foo: \\'bar\\',\\n' +\n   '  foobar: 1,\\n' +\n-  '  func: \\n' +\n+  '  func:\\n' +\n   '   { [Function: func]\\n' +\n   '     [length]: 0,\\n' +\n   '     [name]: \\'func\\',\\n' +\n@@ -172,7 +172,7 @@ assert.strictEqual(\n   util.format('%o %o', obj),\n   '{ foo: \\'bar\\',\\n' +\n   '  foobar: 1,\\n' +\n-  '  func: \\n' +\n+  '  func:\\n' +\n   '   { [Function: func]\\n' +\n   '     [length]: 0,\\n' +\n   '     [name]: \\'func\\',\\n' +"
        },
        {
            "sha": "24fc35747b328ca04fd10ed11f15f8dba44f5fd0",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/8de83725ac3aa05a12acbbd27012c4282af7635c/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/8de83725ac3aa05a12acbbd27012c4282af7635c/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=8de83725ac3aa05a12acbbd27012c4282af7635c",
            "patch": "@@ -571,7 +571,7 @@ assert.strictEqual(util.inspect(Object.create(Date.prototype)), 'Date {}');\n {\n   const x = { [util.inspect.custom]: util.inspect };\n   assert(util.inspect(x).includes(\n-    '[Symbol(util.inspect.custom)]: \\n   { [Function: inspect]'));\n+    '[Symbol(util.inspect.custom)]:\\n   { [Function: inspect]'));\n }\n \n // `util.inspect` should display the escaped value of a key.\n@@ -1188,7 +1188,7 @@ util.inspect(process);\n \n   let out = util.inspect(o, { compact: true, depth: 5, breakLength: 80 });\n   let expect = [\n-    '{ a: ',\n+    '{ a:',\n     '   [ 1,',\n     '     2,',\n     \"     [ [ 'Lorem ipsum dolor\\\\nsit amet,\\\\tconsectetur adipiscing elit, \" +"
        },
        {
            "sha": "1265428d4ca811a4bfda5ada46e43e545370e571",
            "filename": "test/parallel/test-whatwg-url-inspect.js",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/8de83725ac3aa05a12acbbd27012c4282af7635c/test%2Fparallel%2Ftest-whatwg-url-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/8de83725ac3aa05a12acbbd27012c4282af7635c/test%2Fparallel%2Ftest-whatwg-url-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-url-inspect.js?ref=8de83725ac3aa05a12acbbd27012c4282af7635c",
            "patch": "@@ -16,7 +16,8 @@ const url = new URL('https://username:password@host.name:8080/path/name/?que=ry#\n assert.strictEqual(\n   util.inspect(url),\n   `URL {\n-  href: 'https://username:password@host.name:8080/path/name/?que=ry#hash',\n+  href:\n+   'https://username:password@host.name:8080/path/name/?que=ry#hash',\n   origin: 'https://host.name:8080',\n   protocol: 'https:',\n   username: 'username',\n@@ -32,7 +33,8 @@ assert.strictEqual(\n assert.strictEqual(\n   util.inspect(url, { showHidden: true }),\n   `URL {\n-  href: 'https://username:password@host.name:8080/path/name/?que=ry#hash',\n+  href:\n+   'https://username:password@host.name:8080/path/name/?que=ry#hash',\n   origin: 'https://host.name:8080',\n   protocol: 'https:',\n   username: 'username',\n@@ -46,7 +48,7 @@ assert.strictEqual(\n   hash: '#hash',\n   cannotBeBase: false,\n   special: true,\n-  [Symbol(context)]:\\x20\n+  [Symbol(context)]:\n    URLContext {\n      flags: 2032,\n      scheme: 'https:',"
        }
    ],
    "stats": {
        "total": 110,
        "additions": 57,
        "deletions": 53
    }
}