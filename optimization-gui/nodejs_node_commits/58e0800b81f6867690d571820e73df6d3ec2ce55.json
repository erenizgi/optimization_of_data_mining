{
    "author": "apapirovski",
    "message": "http: cleanup parser properties\n\nCleanup constructor and freeParser to manage all existing parser\nproperties, not just some.\n\nPR-URL: https://github.com/nodejs/node/pull/20126\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "58e0800b81f6867690d571820e73df6d3ec2ce55",
    "files": [
        {
            "sha": "22ae85c92782eca458b994bedb8222145364ac70",
            "filename": "lib/_http_client.js",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/58e0800b81f6867690d571820e73df6d3ec2ce55/lib%2F_http_client.js",
            "raw_url": "https://github.com/nodejs/node/raw/58e0800b81f6867690d571820e73df6d3ec2ce55/lib%2F_http_client.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_client.js?ref=58e0800b81f6867690d571820e73df6d3ec2ce55",
            "patch": "@@ -606,7 +606,6 @@ function tickOnSocket(req, socket) {\n   req.connection = socket;\n   parser.reinitialize(HTTPParser.RESPONSE);\n   parser.socket = socket;\n-  parser.incoming = null;\n   parser.outgoing = req;\n   req.parser = parser;\n \n@@ -619,9 +618,6 @@ function tickOnSocket(req, socket) {\n   // Propagate headers limit from request object to parser\n   if (typeof req.maxHeadersCount === 'number') {\n     parser.maxHeaderPairs = req.maxHeadersCount << 1;\n-  } else {\n-    // Set default value because parser may be reused from FreeList\n-    parser.maxHeaderPairs = 2000;\n   }\n \n   parser.onIncoming = parserOnIncomingClient;"
        },
        {
            "sha": "7eb37511bd12c7de204cd8fd3fc7b8484ee0be84",
            "filename": "lib/_http_common.js",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/58e0800b81f6867690d571820e73df6d3ec2ce55/lib%2F_http_common.js",
            "raw_url": "https://github.com/nodejs/node/raw/58e0800b81f6867690d571820e73df6d3ec2ce55/lib%2F_http_common.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_common.js?ref=58e0800b81f6867690d571820e73df6d3ec2ce55",
            "patch": "@@ -41,6 +41,8 @@ const kOnBody = HTTPParser.kOnBody | 0;\n const kOnMessageComplete = HTTPParser.kOnMessageComplete | 0;\n const kOnExecute = HTTPParser.kOnExecute | 0;\n \n+const MAX_HEADER_PAIRS = 2000;\n+\n // Only called in the slow case where slow means\n // that the request headers were either fragmented\n // across multiple TCP packets or too large to be\n@@ -159,6 +161,9 @@ const parsers = new FreeList('parsers', 1000, function() {\n   parser.incoming = null;\n   parser.outgoing = null;\n \n+  parser.maxHeaderPairs = MAX_HEADER_PAIRS;\n+\n+  parser.onIncoming = null;\n   parser[kOnHeaders] = parserOnHeaders;\n   parser[kOnHeadersComplete] = parserOnHeadersComplete;\n   parser[kOnBody] = parserOnBody;\n@@ -180,6 +185,8 @@ function closeParserInstance(parser) { parser.close(); }\n function freeParser(parser, req, socket) {\n   if (parser) {\n     parser._headers = [];\n+    parser._url = '';\n+    parser.maxHeaderPairs = MAX_HEADER_PAIRS;\n     parser.onIncoming = null;\n     if (parser._consumed)\n       parser.unconsume();"
        },
        {
            "sha": "1d6cada3270c019924a75b4d981c8e2fb7a58606",
            "filename": "lib/_http_server.js",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/58e0800b81f6867690d571820e73df6d3ec2ce55/lib%2F_http_server.js",
            "raw_url": "https://github.com/nodejs/node/raw/58e0800b81f6867690d571820e73df6d3ec2ce55/lib%2F_http_server.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_server.js?ref=58e0800b81f6867690d571820e73df6d3ec2ce55",
            "patch": "@@ -342,14 +342,10 @@ function connectionListenerInternal(server, socket) {\n   parser.reinitialize(HTTPParser.REQUEST);\n   parser.socket = socket;\n   socket.parser = parser;\n-  parser.incoming = null;\n \n   // Propagate headers limit from server instance to parser\n   if (typeof server.maxHeadersCount === 'number') {\n     parser.maxHeaderPairs = server.maxHeadersCount << 1;\n-  } else {\n-    // Set default value because parser may be reused from FreeList\n-    parser.maxHeaderPairs = 2000;\n   }\n \n   var state = {"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 7,
        "deletions": 8
    }
}