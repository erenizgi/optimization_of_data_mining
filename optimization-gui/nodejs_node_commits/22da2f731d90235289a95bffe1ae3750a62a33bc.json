{
    "author": "BridgeAR",
    "message": "errors: make message non-enumerable\n\nA error message should always be non-enumerable. This makes sure\nthat is true for dns errors as well. It also adds another check\nin `common.expectsError` to make sure no other regressions are\nintroduced going forward.\n\nFixes #19716\n\nPR-URL: https://github.com/nodejs/node/pull/19719\nFixes: https://github.com/nodejs/node/issues/19716\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "22da2f731d90235289a95bffe1ae3750a62a33bc",
    "files": [
        {
            "sha": "3e940c8496874a5f9df5f634720717433f5a75b8",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 18,
            "deletions": 19,
            "changes": 37,
            "blob_url": "https://github.com/nodejs/node/blob/22da2f731d90235289a95bffe1ae3750a62a33bc/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/22da2f731d90235289a95bffe1ae3750a62a33bc/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=22da2f731d90235289a95bffe1ae3750a62a33bc",
            "patch": "@@ -550,34 +550,33 @@ function exceptionWithHostPort(err, syscall, address, port, additional) {\n }\n \n /**\n- * @param {number|string} err - A libuv error number or a c-ares error code\n+ * @param {number|string} code - A libuv error number or a c-ares error code\n  * @param {string} syscall\n  * @param {string} [hostname]\n  * @returns {Error}\n  */\n-function dnsException(err, syscall, hostname) {\n-  // eslint-disable-next-line no-restricted-syntax\n-  const ex = new Error();\n+function dnsException(code, syscall, hostname) {\n+  let message;\n   // FIXME(bnoordhuis) Remove this backwards compatibility nonsense and pass\n   // the true error to the user. ENOTFOUND is not even a proper POSIX error!\n-  if (err === UV_EAI_MEMORY ||\n-      err === UV_EAI_NODATA ||\n-      err === UV_EAI_NONAME) {\n-    err = 'ENOTFOUND';  // Fabricated error name.\n+  if (code === UV_EAI_MEMORY ||\n+      code === UV_EAI_NODATA ||\n+      code === UV_EAI_NONAME) {\n+    code = 'ENOTFOUND'; // Fabricated error name.\n   }\n-  if (typeof err === 'string') {  // c-ares error code.\n-    const errHost = hostname ? ` ${hostname}` : '';\n-    ex.message = `${syscall} ${err}${errHost}`;\n-    // TODO(joyeecheung): errno is supposed to be a number, like in uvException\n-    ex.code = ex.errno = err;\n-    ex.syscall = syscall;\n+  if (typeof code === 'string') { // c-ares error code.\n+    message = `${syscall} ${code}${hostname ? ` ${hostname}` : ''}`;\n   } else {  // libuv error number\n-    const code = lazyInternalUtil().getSystemErrorName(err);\n-    ex.message = `${syscall} ${code}`;\n-    // TODO(joyeecheung): errno is supposed to be err, like in uvException\n-    ex.code = ex.errno = code;\n-    ex.syscall = syscall;\n+    code = lazyInternalUtil().getSystemErrorName(code);\n+    message = `${syscall} ${code}`;\n   }\n+  // eslint-disable-next-line no-restricted-syntax\n+  const ex = new Error(message);\n+  // TODO(joyeecheung): errno is supposed to be a number / err, like in\n+  // uvException.\n+  ex.errno = code;\n+  ex.code = code;\n+  ex.syscall = syscall;\n   if (hostname) {\n     ex.hostname = hostname;\n   }"
        },
        {
            "sha": "1a444f0dbd1b445ba79b833fd32378fc6000daea",
            "filename": "test/common/index.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/22da2f731d90235289a95bffe1ae3750a62a33bc/test%2Fcommon%2Findex.js",
            "raw_url": "https://github.com/nodejs/node/raw/22da2f731d90235289a95bffe1ae3750a62a33bc/test%2Fcommon%2Findex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.js?ref=22da2f731d90235289a95bffe1ae3750a62a33bc",
            "patch": "@@ -691,6 +691,9 @@ exports.expectsError = function expectsError(fn, settings, exact) {\n     fn = undefined;\n   }\n   function innerFn(error) {\n+    const descriptor = Object.getOwnPropertyDescriptor(error, 'message');\n+    assert.strictEqual(descriptor.enumerable,\n+                       false, 'The error message should be non-enumerable');\n     if ('type' in settings) {\n       const type = settings.type;\n       if (type !== Error && !Error.isPrototypeOf(type)) {"
        },
        {
            "sha": "b9c0dfc6dff7a5a60fd1e0d3004f592b959c978f",
            "filename": "test/parallel/test-dns-lookup.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/22da2f731d90235289a95bffe1ae3750a62a33bc/test%2Fparallel%2Ftest-dns-lookup.js",
            "raw_url": "https://github.com/nodejs/node/raw/22da2f731d90235289a95bffe1ae3750a62a33bc/test%2Fparallel%2Ftest-dns-lookup.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-dns-lookup.js?ref=22da2f731d90235289a95bffe1ae3750a62a33bc",
            "patch": "@@ -92,6 +92,9 @@ dns.lookup('example.com', common.mustCall((error, result, addressType) => {\n   assert(error);\n   assert.strictEqual(tickValue, 1);\n   assert.strictEqual(error.code, 'ENOENT');\n+  const descriptor = Object.getOwnPropertyDescriptor(error, 'message');\n+  assert.strictEqual(descriptor.enumerable,\n+                     false, 'The error message should be non-enumerable');\n }));\n \n // Make sure that the error callback is called"
        },
        {
            "sha": "63ed1774b11933ca7c5d2e9832af5686723df47d",
            "filename": "test/parallel/test-dns-resolveany-bad-ancount.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/22da2f731d90235289a95bffe1ae3750a62a33bc/test%2Fparallel%2Ftest-dns-resolveany-bad-ancount.js",
            "raw_url": "https://github.com/nodejs/node/raw/22da2f731d90235289a95bffe1ae3750a62a33bc/test%2Fparallel%2Ftest-dns-resolveany-bad-ancount.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-dns-resolveany-bad-ancount.js?ref=22da2f731d90235289a95bffe1ae3750a62a33bc",
            "patch": "@@ -30,6 +30,9 @@ server.bind(0, common.mustCall(() => {\n     assert.strictEqual(err.code, 'EBADRESP');\n     assert.strictEqual(err.syscall, 'queryAny');\n     assert.strictEqual(err.hostname, 'example.org');\n+    const descriptor = Object.getOwnPropertyDescriptor(err, 'message');\n+    assert.strictEqual(descriptor.enumerable,\n+                       false, 'The error message should be non-enumerable');\n     server.close();\n   }));\n }));"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 27,
        "deletions": 19
    }
}