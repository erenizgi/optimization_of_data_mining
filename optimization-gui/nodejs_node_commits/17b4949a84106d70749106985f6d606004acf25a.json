{
    "author": "gireeshpunathil",
    "message": "src: track memory retainer fields\n\nIf retainers are embedded in retainers, direct tracking\nthose lead to double tracking. Instead, use a special tracker\nthat adjusts the tracking for the container object.\n\nPR-URL: https://github.com/nodejs/node/pull/26161\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "17b4949a84106d70749106985f6d606004acf25a",
    "files": [
        {
            "sha": "95d623c2b459f85815f7ede38b8b11554020e6a3",
            "filename": "src/memory_tracker-inl.h",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/17b4949a84106d70749106985f6d606004acf25a/src%2Fmemory_tracker-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/17b4949a84106d70749106985f6d606004acf25a/src%2Fmemory_tracker-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fmemory_tracker-inl.h?ref=17b4949a84106d70749106985f6d606004acf25a",
            "patch": "@@ -241,6 +241,13 @@ void MemoryTracker::Track(const MemoryRetainer* retainer,\n   PopNode();\n }\n \n+void MemoryTracker::TrackInlineField(const MemoryRetainer* retainer,\n+                                     const char* edge_name) {\n+  Track(retainer, edge_name);\n+  CHECK(CurrentNode());\n+  CurrentNode()->size_ -= retainer->SelfSize();\n+}\n+\n MemoryRetainerNode* MemoryTracker::CurrentNode() const {\n   if (node_stack_.empty()) return nullptr;\n   return node_stack_.top();"
        },
        {
            "sha": "673cd811c3ea0304b528490b2d2c9f015f39d0e4",
            "filename": "src/memory_tracker.h",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/17b4949a84106d70749106985f6d606004acf25a/src%2Fmemory_tracker.h",
            "raw_url": "https://github.com/nodejs/node/raw/17b4949a84106d70749106985f6d606004acf25a/src%2Fmemory_tracker.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fmemory_tracker.h?ref=17b4949a84106d70749106985f6d606004acf25a",
            "patch": "@@ -197,6 +197,17 @@ class MemoryTracker {\n   inline void Track(const MemoryRetainer* retainer,\n                     const char* edge_name = nullptr);\n \n+  // Useful for parents that do not wish to perform manual\n+  // adjustments to its `SelfSize()` when embedding retainer\n+  // objects inline.\n+  // Put a memory container into the graph, create an edge from\n+  // the current node if there is one on the stack - there should\n+  // be one, of the container object which the current field is part of.\n+  // Reduce the size of memory from the container so as to avoid\n+  // duplication in accounting.\n+  inline void TrackInlineField(const MemoryRetainer* retainer,\n+                               const char* edge_name = nullptr);\n+\n   inline v8::EmbedderGraph* graph() { return graph_; }\n   inline v8::Isolate* isolate() { return isolate_; }\n "
        }
    ],
    "stats": {
        "total": 18,
        "additions": 18,
        "deletions": 0
    }
}