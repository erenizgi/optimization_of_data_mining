{
    "author": "joyeecheung",
    "message": "deps: cherry-pick 0483e9a from upstream V8\n\nOriginal commit message:\n\n    [api] Allow embedder to construct an Array from Local<Value>*\n\n    Currently to obtain a v8::Array out of a C array or a std::vector,\n    one needs to loop through the elements and call array->Set() multiple\n    times, and these calls go into v8::Object::Set() which can be slow.\n    This patch adds a new Array::New overload that converts a\n    Local<Value>* with known size into a Local<Array>.\n\n    Change-Id: I0a768f0e18eec51e78d58be455482ec6425ca188\n    Reviewed-on: https://chromium-review.googlesource.com/c/1317049\n    Reviewed-by: Yang Guo <yangguo@chromium.org>\n    Reviewed-by: Adam Klein <adamk@chromium.org>\n    Commit-Queue: Joyee Cheung <joyee@igalia.com>\n    Cr-Commit-Position: refs/heads/master@{#57261}\n\nRefs: https://github.com/v8/v8/commit/0483e9a9abe77a73632fd85b9c0cd608efa9aa0d\n\nPR-URL: https://github.com/nodejs/node/pull/24125\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Yang Guo <yangguo@chromium.org>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "0e090768de1844c493013d5e99bd903928aff2ab",
    "files": [
        {
            "sha": "fd9fe3306329bd1ad4200550788b14e5cc11329b",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/0e090768de1844c493013d5e99bd903928aff2ab/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/0e090768de1844c493013d5e99bd903928aff2ab/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=0e090768de1844c493013d5e99bd903928aff2ab",
            "patch": "@@ -38,7 +38,7 @@\n \n     # Reset this number to 0 on major V8 upgrades.\n     # Increment by one for each non-official patch applied to deps/v8.\n-    'v8_embedder_string': '-node.1',\n+    'v8_embedder_string': '-node.2',\n \n     ##### V8 defaults for Node.js #####\n "
        },
        {
            "sha": "9b7be9fb93068ee3c6283f48d42193947133c9ea",
            "filename": "deps/v8/include/v8.h",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/0e090768de1844c493013d5e99bd903928aff2ab/deps%2Fv8%2Finclude%2Fv8.h",
            "raw_url": "https://github.com/nodejs/node/raw/0e090768de1844c493013d5e99bd903928aff2ab/deps%2Fv8%2Finclude%2Fv8.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8.h?ref=0e090768de1844c493013d5e99bd903928aff2ab",
            "patch": "@@ -3680,6 +3680,12 @@ class V8_EXPORT Array : public Object {\n    */\n   static Local<Array> New(Isolate* isolate, int length = 0);\n \n+  /**\n+   * Creates a JavaScript array out of a Local<Value> array in C++\n+   * with a known length.\n+   */\n+  static Local<Array> New(Isolate* isolate, Local<Value>* elements,\n+                          size_t length);\n   V8_INLINE static Array* Cast(Value* obj);\n  private:\n   Array();"
        },
        {
            "sha": "4e233d96dca8b10d0a134fdcbcf49c8ffe94fdca",
            "filename": "deps/v8/src/api.cc",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/0e090768de1844c493013d5e99bd903928aff2ab/deps%2Fv8%2Fsrc%2Fapi.cc",
            "raw_url": "https://github.com/nodejs/node/raw/0e090768de1844c493013d5e99bd903928aff2ab/deps%2Fv8%2Fsrc%2Fapi.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fapi.cc?ref=0e090768de1844c493013d5e99bd903928aff2ab",
            "patch": "@@ -6911,6 +6911,23 @@ Local<v8::Array> v8::Array::New(Isolate* isolate, int length) {\n   return Utils::ToLocal(obj);\n }\n \n+Local<v8::Array> v8::Array::New(Isolate* isolate, Local<Value>* elements,\n+                                size_t length) {\n+  i::Isolate* i_isolate = reinterpret_cast<i::Isolate*>(isolate);\n+  i::Factory* factory = i_isolate->factory();\n+  LOG_API(i_isolate, Array, New);\n+  ENTER_V8_NO_SCRIPT_NO_EXCEPTION(i_isolate);\n+  int len = static_cast<int>(length);\n+\n+  i::Handle<i::FixedArray> result = factory->NewFixedArray(len);\n+  for (int i = 0; i < len; i++) {\n+    i::Handle<i::Object> element = Utils::OpenHandle(*elements[i]);\n+    result->set(i, *element);\n+  }\n+\n+  return Utils::ToLocal(\n+      factory->NewJSArrayWithElements(result, i::PACKED_ELEMENTS, len));\n+}\n \n uint32_t v8::Array::Length() const {\n   i::Handle<i::JSArray> obj = Utils::OpenHandle(this);"
        },
        {
            "sha": "0d92508d243ce7c9fc1aa7bb780e7bee0f05e2af",
            "filename": "deps/v8/test/cctest/test-api.cc",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/0e090768de1844c493013d5e99bd903928aff2ab/deps%2Fv8%2Ftest%2Fcctest%2Ftest-api.cc",
            "raw_url": "https://github.com/nodejs/node/raw/0e090768de1844c493013d5e99bd903928aff2ab/deps%2Fv8%2Ftest%2Fcctest%2Ftest-api.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Ftest-api.cc?ref=0e090768de1844c493013d5e99bd903928aff2ab",
            "patch": "@@ -5225,6 +5225,22 @@ THREADED_TEST(Array) {\n   CHECK_EQ(27u, array->Length());\n   array = v8::Array::New(context->GetIsolate(), -27);\n   CHECK_EQ(0u, array->Length());\n+\n+  std::vector<Local<Value>> vector = {v8_num(1), v8_num(2), v8_num(3)};\n+  array = v8::Array::New(context->GetIsolate(), vector.data(), vector.size());\n+  CHECK_EQ(vector.size(), array->Length());\n+  CHECK_EQ(1, arr->Get(context.local(), 0)\n+                  .ToLocalChecked()\n+                  ->Int32Value(context.local())\n+                  .FromJust());\n+  CHECK_EQ(2, arr->Get(context.local(), 1)\n+                  .ToLocalChecked()\n+                  ->Int32Value(context.local())\n+                  .FromJust());\n+  CHECK_EQ(3, arr->Get(context.local(), 2)\n+                  .ToLocalChecked()\n+                  ->Int32Value(context.local())\n+                  .FromJust());\n }\n \n "
        }
    ],
    "stats": {
        "total": 41,
        "additions": 40,
        "deletions": 1
    }
}