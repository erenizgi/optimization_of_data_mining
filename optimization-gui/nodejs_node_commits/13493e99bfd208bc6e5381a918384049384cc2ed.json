{
    "author": "tniessen",
    "message": "src: add CHECK_IMPLIES macro\n\nThis change introduces the CHECK_IMPLIES macro\nsimilar to its definition in v8 and replaces instances of\nCHECK with CHECK_IMPLIES where it seems appropriate.\n\nPR-URL: https://github.com/nodejs/node/pull/20914\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "13493e99bfd208bc6e5381a918384049384cc2ed",
    "files": [
        {
            "sha": "9eac7beb038a26c0aca30ac651427065fe29b4dc",
            "filename": "src/callback_scope.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Fcallback_scope.cc",
            "raw_url": "https://github.com/nodejs/node/raw/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Fcallback_scope.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fcallback_scope.cc?ref=13493e99bfd208bc6e5381a918384049384cc2ed",
            "patch": "@@ -44,9 +44,7 @@ InternalCallbackScope::InternalCallbackScope(Environment* env,\n     async_context_(asyncContext),\n     object_(object),\n     callback_scope_(env) {\n-  if (expect == kRequireResource) {\n-    CHECK(!object.IsEmpty());\n-  }\n+  CHECK_IMPLIES(expect == kRequireResource, !object.IsEmpty());\n \n   if (!env->can_call_into_js()) {\n     failed_ = true;"
        },
        {
            "sha": "2934512478468cf98585c01c8b40a1bb51b3a414",
            "filename": "src/inspector_io.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Finspector_io.cc",
            "raw_url": "https://github.com/nodejs/node/raw/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Finspector_io.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector_io.cc?ref=13493e99bfd208bc6e5381a918384049384cc2ed",
            "patch": "@@ -197,7 +197,7 @@ bool InspectorIo::Start() {\n }\n \n void InspectorIo::Stop() {\n-  CHECK(state_ == State::kAccepting || !sessions_.empty());\n+  CHECK_IMPLIES(sessions_.empty(), state_ == State::kAccepting);\n   Write(TransportAction::kKill, 0, StringView());\n   int err = uv_thread_join(&thread_);\n   CHECK_EQ(err, 0);"
        },
        {
            "sha": "8ecb4880d30dab48f43dee82fca7a61e68686658",
            "filename": "src/tls_wrap.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Ftls_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Ftls_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftls_wrap.cc?ref=13493e99bfd208bc6e5381a918384049384cc2ed",
            "patch": "@@ -676,7 +676,7 @@ void TLSWrap::OnStreamRead(ssize_t nread, const uv_buf_t& buf) {\n   if (!hello_parser_.IsEnded()) {\n     size_t avail = 0;\n     uint8_t* data = reinterpret_cast<uint8_t*>(enc_in->Peek(&avail));\n-    CHECK(avail == 0 || data != nullptr);\n+    CHECK_IMPLIES(data == nullptr, avail == 0);\n     return hello_parser_.Parse(data, avail);\n   }\n "
        },
        {
            "sha": "ff0d47c078815ad7127446938896a324accc74ba",
            "filename": "src/util-inl.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Futil-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Futil-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Futil-inl.h?ref=13493e99bfd208bc6e5381a918384049384cc2ed",
            "patch": "@@ -365,21 +365,21 @@ inline T* UncheckedCalloc(size_t n) {\n template <typename T>\n inline T* Realloc(T* pointer, size_t n) {\n   T* ret = UncheckedRealloc(pointer, n);\n-  if (n > 0) CHECK_NE(ret, nullptr);\n+  CHECK_IMPLIES(n > 0, ret != nullptr);\n   return ret;\n }\n \n template <typename T>\n inline T* Malloc(size_t n) {\n   T* ret = UncheckedMalloc<T>(n);\n-  if (n > 0) CHECK_NE(ret, nullptr);\n+  CHECK_IMPLIES(n > 0, ret != nullptr);\n   return ret;\n }\n \n template <typename T>\n inline T* Calloc(size_t n) {\n   T* ret = UncheckedCalloc<T>(n);\n-  if (n > 0) CHECK_NE(ret, nullptr);\n+  CHECK_IMPLIES(n > 0, ret != nullptr);\n   return ret;\n }\n "
        },
        {
            "sha": "ff77ccc0b8c20db7b6d8c43e1355c4da1f677a98",
            "filename": "src/util.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Futil.h",
            "raw_url": "https://github.com/nodejs/node/raw/13493e99bfd208bc6e5381a918384049384cc2ed/src%2Futil.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Futil.h?ref=13493e99bfd208bc6e5381a918384049384cc2ed",
            "patch": "@@ -129,6 +129,7 @@ void DumpBacktrace(FILE* fp);\n #define CHECK_LE(a, b) CHECK((a) <= (b))\n #define CHECK_LT(a, b) CHECK((a) < (b))\n #define CHECK_NE(a, b) CHECK((a) != (b))\n+#define CHECK_IMPLIES(a, b) CHECK(!(a) || (b))\n \n #define UNREACHABLE() ABORT()\n "
        }
    ],
    "stats": {
        "total": 15,
        "additions": 7,
        "deletions": 8
    }
}