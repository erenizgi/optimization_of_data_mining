{
    "author": "rubys",
    "message": "http: allow url and options to be passed to http*.request and http*.get\n\nFixes: https://github.com/nodejs/node/issues/20795\nPR-URL: https://github.com/nodejs/node/pull/21616\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Ron Korving <ron@ronkorving.nl>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039",
    "files": [
        {
            "sha": "78f8bc4b6b133f35bf859f69d81736079e059da4",
            "filename": "doc/api/http.md",
            "status": "modified",
            "additions": 16,
            "deletions": 3,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/doc%2Fapi%2Fhttp.md",
            "raw_url": "https://github.com/nodejs/node/raw/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/doc%2Fapi%2Fhttp.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttp.md?ref=f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039",
            "patch": "@@ -1796,15 +1796,20 @@ The `requestListener` is a function which is automatically\n added to the [`'request'`][] event.\n \n ## http.get(options[, callback])\n+## http.get(url[, options][, callback])\n <!-- YAML\n added: v0.3.6\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/21616\n+    description: allow both url and options to be passed to `http.get()`\n   - version: v7.5.0\n     pr-url: https://github.com/nodejs/node/pull/10638\n     description: The `options` parameter can be a WHATWG `URL` object.\n -->\n \n-* `options` {Object | string | URL} Accepts the same `options` as\n+* `url` {string | URL}\n+* `options` {Object} Accepts the same `options` as\n   [`http.request()`][], with the `method` always set to `GET`.\n   Properties that are inherited from the prototype are ignored.\n * `callback` {Function}\n@@ -1868,15 +1873,20 @@ Global instance of `Agent` which is used as the default for all HTTP client\n requests.\n \n ## http.request(options[, callback])\n+## http.request(url[, options][, callback])\n <!-- YAML\n added: v0.3.6\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/21616\n+    description: allow both url and options to be passed to `http.request()`\n   - version: v7.5.0\n     pr-url: https://github.com/nodejs/node/pull/10638\n     description: The `options` parameter can be a WHATWG `URL` object.\n -->\n \n-* `options` {Object | string | URL}\n+* `url` {string | URL}\n+* `options` {Object}\n   * `protocol` {string} Protocol to use. **Default:** `'http:'`.\n   * `host` {string} A domain name or IP address of the server to issue the\n     request to. **Default:** `'localhost'`.\n@@ -1918,10 +1928,13 @@ changes:\n Node.js maintains several connections per server to make HTTP requests.\n This function allows one to transparently issue requests.\n \n-`options` can be an object, a string, or a [`URL`][] object. If `options` is a\n+`url` can be a string or a [`URL`][] object. If `url` is a\n string, it is automatically parsed with [`new URL()`][]. If it is a [`URL`][]\n object, it will be automatically converted to an ordinary `options` object.\n \n+If both `url` and `options` are specified, the objects are merged, with the\n+`options` properties taking precedence.\n+\n The optional `callback` parameter will be added as a one-time listener for\n the [`'response'`][] event.\n "
        },
        {
            "sha": "51e6e5c16267387727428e73bcd32d2ec74a4b46",
            "filename": "doc/api/https.md",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/doc%2Fapi%2Fhttps.md",
            "raw_url": "https://github.com/nodejs/node/raw/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/doc%2Fapi%2Fhttps.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttps.md?ref=f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039",
            "patch": "@@ -112,14 +112,19 @@ https.createServer(options, (req, res) => {\n ```\n \n ## https.get(options[, callback])\n+## https.get(url[, options][, callback])\n <!-- YAML\n added: v0.3.6\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/21616\n+    description: allow both url and options to be passed to `https.get()`\n   - version: v7.5.0\n     pr-url: https://github.com/nodejs/node/pull/10638\n     description: The `options` parameter can be a WHATWG `URL` object.\n -->\n-- `options` {Object | string | URL} Accepts the same `options` as\n+- `url` {string | URL}\n+- `options` {Object} Accepts the same `options` as\n   [`https.request()`][], with the `method` always set to `GET`.\n - `callback` {Function}\n \n@@ -155,17 +160,22 @@ added: v0.5.9\n Global instance of [`https.Agent`][] for all HTTPS client requests.\n \n ## https.request(options[, callback])\n+## https.request(url[, options][, callback])\n <!-- YAML\n added: v0.3.6\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/21616\n+    description: allow both url and options to be passed to `https.request()`\n   - version: v9.3.0\n     pr-url: https://github.com/nodejs/node/pull/14903\n     description: The `options` parameter can now include `clientCertEngine`.\n   - version: v7.5.0\n     pr-url: https://github.com/nodejs/node/pull/10638\n     description: The `options` parameter can be a WHATWG `URL` object.\n -->\n-- `options` {Object | string | URL} Accepts all `options` from\n+- `url` {string | URL}\n+- `options` {Object} Accepts all `options` from\n   [`http.request()`][], with some differences in default values:\n   - `protocol` **Default:** `'https:'`\n   - `port` **Default:** `443`"
        },
        {
            "sha": "c4f753412ca83b2241d4cfb49c9f58b1a0b0efdf",
            "filename": "lib/_http_client.js",
            "status": "modified",
            "additions": 19,
            "deletions": 10,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/lib%2F_http_client.js",
            "raw_url": "https://github.com/nodejs/node/raw/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/lib%2F_http_client.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_client.js?ref=f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039",
            "patch": "@@ -60,16 +60,16 @@ function validateHost(host, name) {\n }\n \n let urlWarningEmitted = false;\n-function ClientRequest(options, cb) {\n+function ClientRequest(input, options, cb) {\n   OutgoingMessage.call(this);\n \n-  if (typeof options === 'string') {\n-    const urlStr = options;\n+  if (typeof input === 'string') {\n+    const urlStr = input;\n     try {\n-      options = urlToOptions(new URL(urlStr));\n+      input = urlToOptions(new URL(urlStr));\n     } catch (err) {\n-      options = url.parse(urlStr);\n-      if (!options.hostname) {\n+      input = url.parse(urlStr);\n+      if (!input.hostname) {\n         throw err;\n       }\n       if (!urlWarningEmitted && !process.noDeprecation) {\n@@ -80,14 +80,23 @@ function ClientRequest(options, cb) {\n           'DeprecationWarning', 'DEP0109');\n       }\n     }\n-  } else if (options && options[searchParamsSymbol] &&\n-             options[searchParamsSymbol][searchParamsSymbol]) {\n+  } else if (input && input[searchParamsSymbol] &&\n+             input[searchParamsSymbol][searchParamsSymbol]) {\n     // url.URL instance\n-    options = urlToOptions(options);\n+    input = urlToOptions(input);\n   } else {\n-    options = util._extend({}, options);\n+    cb = options;\n+    options = input;\n+    input = null;\n   }\n \n+  if (typeof options === 'function') {\n+    cb = options;\n+    options = null;\n+  }\n+\n+  options = util._extend(input || {}, options || {});\n+\n   var agent = options.agent;\n   var defaultAgent = options._defaultAgent || Agent.globalAgent;\n   if (agent === false) {"
        },
        {
            "sha": "660de78650f45c8d08e3c18f707333ca1f23088f",
            "filename": "lib/http.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/lib%2Fhttp.js",
            "raw_url": "https://github.com/nodejs/node/raw/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/lib%2Fhttp.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fhttp.js?ref=f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039",
            "patch": "@@ -37,12 +37,12 @@ function createServer(opts, requestListener) {\n   return new Server(opts, requestListener);\n }\n \n-function request(options, cb) {\n-  return new ClientRequest(options, cb);\n+function request(url, options, cb) {\n+  return new ClientRequest(url, options, cb);\n }\n \n-function get(options, cb) {\n-  var req = request(options, cb);\n+function get(url, options, cb) {\n+  var req = request(url, options, cb);\n   req.end();\n   return req;\n }"
        },
        {
            "sha": "5cdd514fd50685ad31749cb97c02b2e5f4bbcc3b",
            "filename": "test/parallel/test-http-request-arguments.js",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/test%2Fparallel%2Ftest-http-request-arguments.js",
            "raw_url": "https://github.com/nodejs/node/raw/f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039/test%2Fparallel%2Ftest-http-request-arguments.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-request-arguments.js?ref=f9b739ebbcb77bc5a0fc8e3d20ad2eae3285b039",
            "patch": "@@ -0,0 +1,28 @@\n+'use strict';\n+const common = require('../common');\n+const assert = require('assert');\n+const http = require('http');\n+\n+// Test providing both a url and options, with the options partially\n+// replacing address and port portions of the URL provided.\n+{\n+  const server = http.createServer(\n+    common.mustCall((req, res) => {\n+      assert.strictEqual(req.url, '/testpath');\n+      res.end();\n+      server.close();\n+    })\n+  );\n+  server.listen(\n+    0,\n+    common.mustCall(() => {\n+      http.get(\n+        'http://example.com/testpath',\n+        { hostname: 'localhost', port: server.address().port },\n+        common.mustCall((res) => {\n+          res.resume();\n+        })\n+      );\n+    })\n+  );\n+}"
        }
    ],
    "stats": {
        "total": 98,
        "additions": 79,
        "deletions": 19
    }
}