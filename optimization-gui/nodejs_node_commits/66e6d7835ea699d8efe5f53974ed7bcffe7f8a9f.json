{
    "author": "gireeshpunathil",
    "message": "doc: warn against streaming from character devices\n\ncharcter device streaming works just like any other streams, but hangs\non the close callsite due to the worker thread being blocked on the read\nand main thread waiting for any async event that may not occur.\n\nDocument this behavior and suggest a potential workaround.\n\nFixes: https://github.com/nodejs/node/issues/15439\nPR-URL: https://github.com/nodejs/node/pull/21212\n\nReviewed-By: Vse Mozhet Byt <vsemozhetbyt@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "66e6d7835ea699d8efe5f53974ed7bcffe7f8a9f",
    "files": [
        {
            "sha": "bb22690003fdcacbc84ad784ff660b2e16e6f44a",
            "filename": "doc/api/fs.md",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/66e6d7835ea699d8efe5f53974ed7bcffe7f8a9f/doc%2Fapi%2Ffs.md",
            "raw_url": "https://github.com/nodejs/node/raw/66e6d7835ea699d8efe5f53974ed7bcffe7f8a9f/doc%2Fapi%2Ffs.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ffs.md?ref=66e6d7835ea699d8efe5f53974ed7bcffe7f8a9f",
            "patch": "@@ -1464,6 +1464,26 @@ the specified file descriptor. This means that no `'open'` event will be\n emitted. `fd` should be blocking; non-blocking `fd`s should be passed to\n [`net.Socket`][].\n \n+The blocking `fd`, if pointing to a character device (such as keyboard or\n+sound card) can potentially block the main thread on stream close. This is\n+because these devices do not produce EOF character as part of their data\n+flow cycle, and thereby exemplify endless streams. As a result, they do not\n+respond to `stream.close()`. A workaround is to close the stream first\n+using `stream.close()` and then push a random character into the stream, and\n+issue a single read. This unblocks the reader thread, leads to the completion\n+of the data flow cycle, and the actual closing of the stream.\n+\n+```js\n+const fs = require('fs');\n+// Create a stream from some character  device.\n+const stream = fs.createReadStream('/dev/input/event0');\n+setTimeout(() => {\n+  stream.close(); // This does not close the stream.\n+  stream.push(null);\n+  stream.read(0); // Pushing a null and reading leads to close.\n+}, 100);\n+```\n+\n If `autoClose` is false, then the file descriptor won't be closed, even if\n there's an error. It is the application's responsibility to close it and make\n sure there's no file descriptor leak. If `autoClose` is set to true (default"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 20,
        "deletions": 0
    }
}