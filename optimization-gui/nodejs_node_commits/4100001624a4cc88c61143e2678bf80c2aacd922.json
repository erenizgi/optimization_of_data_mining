{
    "author": "addaleax",
    "message": "lib: remove unintended access to deps/\n\nThis brings DEP0084 to End-of-Life. It is unlikely that this\nhas received much public usage in the first place, so removing\nshould be okay.\n\nPR-URL: https://github.com/nodejs/node/pull/25138\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "4100001624a4cc88c61143e2678bf80c2aacd922",
    "files": [
        {
            "sha": "8dacce5888832425e189367b887ebefa31a0f034",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/4100001624a4cc88c61143e2678bf80c2aacd922/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/4100001624a4cc88c61143e2678bf80c2aacd922/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=4100001624a4cc88c61143e2678bf80c2aacd922",
            "patch": "@@ -1670,16 +1670,19 @@ the client and is now unsupported. Use the `ciphers` parameter instead.\n ### DEP0084: requiring bundled internal dependencies\n <!-- YAML\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/25138\n+    description: This functionality has been removed.\n   - version: v10.0.0\n     pr-url: https://github.com/nodejs/node/pull/16392\n     description: Runtime deprecation.\n -->\n \n-Type: Runtime\n+Type: End-of-Life\n \n Since Node.js versions 4.4.0 and 5.2.0, several modules only intended for\n-internal usage are mistakenly exposed to user code through `require()`. These\n-modules are:\n+internal usage were mistakenly exposed to user code through `require()`. These\n+modules were:\n \n - `v8/tools/codemap`\n - `v8/tools/consarray`"
        },
        {
            "sha": "93fb186574165ce9fd58b54b7898d7b56a4851ca",
            "filename": "lib/internal/bootstrap/loaders.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/4100001624a4cc88c61143e2678bf80c2aacd922/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "raw_url": "https://github.com/nodejs/node/raw/4100001624a4cc88c61143e2678bf80c2aacd922/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Floaders.js?ref=4100001624a4cc88c61143e2678bf80c2aacd922",
            "patch": "@@ -220,9 +220,7 @@ NativeModule.isDepsModule = function(id) {\n };\n \n NativeModule.requireForDeps = function(id) {\n-  if (!NativeModule.exists(id) ||\n-      // TODO(TimothyGu): remove when DEP0084 reaches end of life.\n-      NativeModule.isDepsModule(id)) {\n+  if (!NativeModule.exists(id)) {\n     id = `internal/deps/${id}`;\n   }\n   return NativeModule.require(id);"
        },
        {
            "sha": "5bee24a5db19ced45946946b5b26c25db269ef78",
            "filename": "test/parallel/test-require-deps-deprecation.js",
            "status": "removed",
            "additions": 0,
            "deletions": 56,
            "changes": 56,
            "blob_url": "https://github.com/nodejs/node/blob/b4b9e0e28c434de926593e42248b7c18b7839b12/test%2Fparallel%2Ftest-require-deps-deprecation.js",
            "raw_url": "https://github.com/nodejs/node/raw/b4b9e0e28c434de926593e42248b7c18b7839b12/test%2Fparallel%2Ftest-require-deps-deprecation.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-require-deps-deprecation.js?ref=b4b9e0e28c434de926593e42248b7c18b7839b12",
            "patch": "@@ -1,56 +0,0 @@\n-'use strict';\n-\n-const common = require('../common');\n-const assert = require('assert');\n-\n-const deprecatedModules = [\n-  'node-inspect/lib/_inspect',\n-  'node-inspect/lib/internal/inspect_client',\n-  'node-inspect/lib/internal/inspect_repl',\n-  'v8/tools/SourceMap',\n-  'v8/tools/codemap',\n-  'v8/tools/consarray',\n-  'v8/tools/csvparser',\n-  'v8/tools/logreader',\n-  'v8/tools/profile',\n-  'v8/tools/profile_view',\n-  'v8/tools/splaytree',\n-  'v8/tools/tickprocessor',\n-  'v8/tools/tickprocessor-driver'\n-];\n-\n-// Newly added deps that do not have a deprecation wrapper around it would\n-// throw an error, but no warning would be emitted.\n-const deps = [\n-  'acorn/dist/acorn',\n-  'acorn/dist/walk'\n-];\n-\n-common.expectWarning('DeprecationWarning', deprecatedModules.map((m) => {\n-  return [`Requiring Node.js-bundled '${m}' module is deprecated. ` +\n-         'Please install the necessary module locally.', 'DEP0084'];\n-}));\n-\n-for (const m of deprecatedModules) {\n-  try {\n-    require(m);\n-  } catch {}\n-}\n-\n-// Instead of checking require, check that resolve isn't pointing toward a\n-// built-in module, as user might already have node installed with acorn in\n-// require.resolve range.\n-// Ref: https://github.com/nodejs/node/issues/17148\n-for (const m of deps) {\n-  let path;\n-  try {\n-    path = require.resolve(m);\n-  } catch (err) {\n-    assert.ok(err.toString().startsWith('Error: Cannot find module '));\n-    continue;\n-  }\n-  assert.notStrictEqual(path, m);\n-}\n-\n-// The V8 modules add the WebInspector to the globals.\n-common.allowGlobals(global.WebInspector);"
        },
        {
            "sha": "eff44940c57ec6f898025716ea057f3b38d488ea",
            "filename": "tools/js2c.py",
            "status": "modified",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/4100001624a4cc88c61143e2678bf80c2aacd922/tools%2Fjs2c.py",
            "raw_url": "https://github.com/nodejs/node/raw/4100001624a4cc88c61143e2678bf80c2aacd922/tools%2Fjs2c.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fjs2c.py?ref=4100001624a4cc88c61143e2678bf80c2aacd922",
            "patch": "@@ -214,14 +214,6 @@ def ReadMacros(lines):\n );\n \"\"\"\n \n-DEPRECATED_DEPS = \"\"\"\\\n-'use strict';\n-process.emitWarning(\n-  'Requiring Node.js-bundled \\\\'{module}\\\\' module is deprecated. Please ' +\n-  'install the necessary module locally.', 'DeprecationWarning', 'DEP0084');\n-module.exports = require('internal/deps/{module}');\n-\"\"\"\n-\n def JS2C(source, target):\n   modules = []\n   consts = {}\n@@ -265,15 +257,11 @@ def AddModule(module, source):\n     lines = ExpandConstants(lines, consts)\n     lines = ExpandMacros(lines, macros)\n \n-    deprecated_deps = None\n-\n     # On Windows, \"./foo.bar\" in the .gyp file is passed as \"foo.bar\"\n     # so don't assume there is always a slash in the file path.\n     if '/' in name or '\\\\' in name:\n       split = re.split('/|\\\\\\\\', name)\n       if split[0] == 'deps':\n-        if split[1] == 'node-inspect' or split[1] == 'v8':\n-          deprecated_deps = split[1:]\n         split = ['internal'] + split\n       else:\n         split = split[1:]\n@@ -293,12 +281,6 @@ def AddModule(module, source):\n     else:\n       AddModule(name.split('.', 1)[0], lines)\n \n-    # Add deprecated aliases for deps without 'deps/'\n-    if deprecated_deps is not None:\n-      module = '/'.join(deprecated_deps).split('.', 1)[0]\n-      source = DEPRECATED_DEPS.format(module=module)\n-      AddModule(module, source)\n-\n   # Emit result\n   output = open(str(target[0]), \"w\")\n   output.write("
        }
    ],
    "stats": {
        "total": 87,
        "additions": 7,
        "deletions": 80
    }
}