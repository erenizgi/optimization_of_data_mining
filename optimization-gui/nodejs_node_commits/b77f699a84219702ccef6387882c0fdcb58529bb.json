{
    "author": "mcollina",
    "message": "url: avoid hostname spoofing w/ javascript protocol\n\nCVE-2018-12123\n\nFixes: https://github.com/nodejs-private/security/issues/205\nPR-URL: https://github.com/nodejs-private/node-private/pull/145\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "b77f699a84219702ccef6387882c0fdcb58529bb",
    "files": [
        {
            "sha": "dfdb565cec0c0b61715b3f6226480d99cbd4bdd2",
            "filename": "lib/url.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/b77f699a84219702ccef6387882c0fdcb58529bb/lib%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/b77f699a84219702ccef6387882c0fdcb58529bb/lib%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Furl.js?ref=b77f699a84219702ccef6387882c0fdcb58529bb",
            "patch": "@@ -267,13 +267,13 @@ Url.prototype.parse = function parse(url, parseQueryString, slashesDenoteHost) {\n   if (slashesDenoteHost || proto || hostPattern.test(rest)) {\n     var slashes = rest.charCodeAt(0) === CHAR_FORWARD_SLASH &&\n                   rest.charCodeAt(1) === CHAR_FORWARD_SLASH;\n-    if (slashes && !(proto && hostlessProtocol[proto])) {\n+    if (slashes && !(proto && hostlessProtocol[lowerProto])) {\n       rest = rest.slice(2);\n       this.slashes = true;\n     }\n   }\n \n-  if (!hostlessProtocol[proto] &&\n+  if (!hostlessProtocol[lowerProto] &&\n       (slashes || (proto && !slashedProtocol[proto]))) {\n \n     // there's a hostname."
        },
        {
            "sha": "b18a5fe585d0a3294f6f02a0aa9bbfaa6dc2d2cf",
            "filename": "test/parallel/test-url-parse-format.js",
            "status": "modified",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/nodejs/node/blob/b77f699a84219702ccef6387882c0fdcb58529bb/test%2Fparallel%2Ftest-url-parse-format.js",
            "raw_url": "https://github.com/nodejs/node/raw/b77f699a84219702ccef6387882c0fdcb58529bb/test%2Fparallel%2Ftest-url-parse-format.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-url-parse-format.js?ref=b77f699a84219702ccef6387882c0fdcb58529bb",
            "patch": "@@ -890,6 +890,39 @@ const parseTests = {\n     pathname: '/*',\n     path: '/*',\n     href: 'https:///*'\n+  },\n+\n+  // The following two URLs are the same, but they differ for\n+  // a capital A: it is important that we verify that the protocol\n+  // is checked in a case-insensitive manner.\n+  'javascript:alert(1);a=\\x27@white-listed.com\\x27': {\n+    protocol: 'javascript:',\n+    slashes: null,\n+    auth: null,\n+    host: null,\n+    port: null,\n+    hostname: null,\n+    hash: null,\n+    search: null,\n+    query: null,\n+    pathname: \"alert(1);a='@white-listed.com'\",\n+    path: \"alert(1);a='@white-listed.com'\",\n+    href: \"javascript:alert(1);a='@white-listed.com'\"\n+  },\n+\n+  'javAscript:alert(1);a=\\x27@white-listed.com\\x27': {\n+    protocol: 'javascript:',\n+    slashes: null,\n+    auth: null,\n+    host: null,\n+    port: null,\n+    hostname: null,\n+    hash: null,\n+    search: null,\n+    query: null,\n+    pathname: \"alert(1);a='@white-listed.com'\",\n+    path: \"alert(1);a='@white-listed.com'\",\n+    href: \"javascript:alert(1);a='@white-listed.com'\"\n   }\n };\n \n@@ -921,3 +954,25 @@ for (const u in parseTests) {\n   assert.strictEqual(actual, expected,\n                      `format(${u}) == ${u}\\nactual:${actual}`);\n }\n+\n+{\n+  const parsed = url.parse('http://nodejs.org/')\n+    .resolveObject('jAvascript:alert(1);a=\\x27@white-listed.com\\x27');\n+\n+  const expected = Object.assign(new url.Url(), {\n+    protocol: 'javascript:',\n+    slashes: null,\n+    auth: null,\n+    host: null,\n+    port: null,\n+    hostname: null,\n+    hash: null,\n+    search: null,\n+    query: null,\n+    pathname: \"alert(1);a='@white-listed.com'\",\n+    path: \"alert(1);a='@white-listed.com'\",\n+    href: \"javascript:alert(1);a='@white-listed.com'\"\n+  });\n+\n+  assert.deepStrictEqual(parsed, expected);\n+}"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 57,
        "deletions": 2
    }
}