{
    "author": "addaleax",
    "message": "zlib: use common owner symbol to access JS wrapper\n\nUse the same symbol that other `AsyncWrap` instances also use\nfor accessing the JS wrapper.\n\nPR-URL: https://github.com/nodejs/node/pull/23189\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "a9bb653ecc9cab6317f931fe39d4cfe5642ab37b",
    "files": [
        {
            "sha": "68d06fa93fbaa21b6c1da48120a5c37537d927ee",
            "filename": "lib/zlib.js",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/a9bb653ecc9cab6317f931fe39d4cfe5642ab37b/lib%2Fzlib.js",
            "raw_url": "https://github.com/nodejs/node/raw/a9bb653ecc9cab6317f931fe39d4cfe5642ab37b/lib%2Fzlib.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fzlib.js?ref=a9bb653ecc9cab6317f931fe39d4cfe5642ab37b",
            "patch": "@@ -42,6 +42,7 @@ const {\n   Buffer,\n   kMaxLength\n } = require('buffer');\n+const { owner_symbol } = require('internal/async_hooks').symbols;\n \n const constants = process.binding('constants').zlib;\n const {\n@@ -143,7 +144,7 @@ function zlibBufferSync(engine, buffer) {\n }\n \n function zlibOnError(message, errno) {\n-  var self = this.jsref;\n+  var self = this[owner_symbol];\n   // there is no way to cleanly recover.\n   // continuing only obscures problems.\n   _close(self);\n@@ -289,7 +290,8 @@ function Zlib(opts, mode) {\n   Transform.call(this, opts);\n   this.bytesWritten = 0;\n   this._handle = new binding.Zlib(mode);\n-  this._handle.jsref = this; // Used by processCallback() and zlibOnError()\n+  // Used by processCallback() and zlibOnError()\n+  this._handle[owner_symbol] = this;\n   this._handle.onerror = zlibOnError;\n   this._hadError = false;\n   this._writeState = new Uint32Array(2);\n@@ -717,6 +719,13 @@ function createProperty(ctor) {\n   };\n }\n \n+// Legacy alias on the C++ wrapper object. This is not public API, so we may\n+// want to runtime-deprecate it at some point. There's no hurry, though.\n+Object.defineProperty(binding.Zlib.prototype, 'jsref', {\n+  get() { return this[owner_symbol]; },\n+  set(v) { return this[owner_symbol] = v; }\n+});\n+\n module.exports = {\n   Deflate,\n   Inflate,"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 11,
        "deletions": 2
    }
}