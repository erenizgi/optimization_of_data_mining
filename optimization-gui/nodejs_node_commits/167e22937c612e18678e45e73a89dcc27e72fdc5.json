{
    "author": "joyeecheung",
    "message": "fs: throw errors from fs.linkSync in JS\n\nPR-URL: https://github.com/nodejs/node/pull/18348\nRefs: https://github.com/nodejs/node/issues/18106\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "167e22937c612e18678e45e73a89dcc27e72fdc5",
    "files": [
        {
            "sha": "4a69ef9bc46c33c0d7ea15202486cf42cbdcd777",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/167e22937c612e18678e45e73a89dcc27e72fdc5/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/167e22937c612e18678e45e73a89dcc27e72fdc5/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=167e22937c612e18678e45e73a89dcc27e72fdc5",
            "patch": "@@ -1280,8 +1280,15 @@ fs.linkSync = function(existingPath, newPath) {\n   nullCheck(newPath);\n   validatePath(existingPath, 'existingPath');\n   validatePath(newPath, 'newPath');\n-  return binding.link(pathModule.toNamespacedPath(existingPath),\n-                      pathModule.toNamespacedPath(newPath));\n+\n+  const ctx = { path: existingPath, dest: newPath };\n+  const result = binding.link(pathModule.toNamespacedPath(existingPath),\n+                              pathModule.toNamespacedPath(newPath),\n+                              undefined, ctx);\n+  if (ctx.errno !== undefined) {\n+    throw new errors.uvException(ctx);\n+  }\n+  return result;\n };\n \n fs.unlink = function(path, callback) {"
        },
        {
            "sha": "0129d2d3f99ba1a0849ac8dc261e7c7b6a1aa446",
            "filename": "src/node_file.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/167e22937c612e18678e45e73a89dcc27e72fdc5/src%2Fnode_file.cc",
            "raw_url": "https://github.com/nodejs/node/raw/167e22937c612e18678e45e73a89dcc27e72fdc5/src%2Fnode_file.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.cc?ref=167e22937c612e18678e45e73a89dcc27e72fdc5",
            "patch": "@@ -624,7 +624,8 @@ static void Symlink(const FunctionCallbackInfo<Value>& args) {\n static void Link(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  CHECK_GE(args.Length(), 2);\n+  int argc = args.Length();\n+  CHECK_GE(argc, 3);\n \n   BufferValue src(env->isolate(), args[0]);\n   CHECK_NE(*src, nullptr);\n@@ -633,11 +634,14 @@ static void Link(const FunctionCallbackInfo<Value>& args) {\n   CHECK_NE(*dest, nullptr);\n \n   if (args[2]->IsObject()) {  // link(src, dest, req)\n-    CHECK_EQ(args.Length(), 3);\n+    CHECK_EQ(argc, 3);\n     AsyncDestCall(env, args, \"link\", *dest, dest.length(), UTF8,\n                   AfterNoArgs, uv_fs_link, *src, *dest);\n-  } else {  // link(src, dest)\n-    SYNC_DEST_CALL(link, *src, *dest, *src, *dest)\n+  } else {  // link(src, dest, undefined, ctx)\n+    CHECK_EQ(argc, 4);\n+    fs_req_wrap req_wrap;\n+    SyncCall(env, args[3], &req_wrap, \"link\",\n+             uv_fs_link, *src, *dest);\n   }\n }\n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 17,
        "deletions": 6
    }
}