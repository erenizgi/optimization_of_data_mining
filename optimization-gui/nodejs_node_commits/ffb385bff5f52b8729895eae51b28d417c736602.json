{
    "author": "cjihrig",
    "message": "test: refactor test-http-abort-before-end\n\nThis test was added over six years ago, and the behavior\nseems to have changed since then. When the test was originally\nwritten, common.mustCall() did not exist. The only assertion\nin this test was not actually executing. Instead of an 'error'\nevent being emitted as expected, an 'abort' event was emitted.\n\nPR-URL: https://github.com/nodejs/node/pull/18508\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "ffb385bff5f52b8729895eae51b28d417c736602",
    "files": [
        {
            "sha": "5577f256ca2ec9c22690eb87acaf731513d25c98",
            "filename": "test/parallel/test-http-abort-before-end.js",
            "status": "modified",
            "additions": 8,
            "deletions": 11,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/ffb385bff5f52b8729895eae51b28d417c736602/test%2Fparallel%2Ftest-http-abort-before-end.js",
            "raw_url": "https://github.com/nodejs/node/raw/ffb385bff5f52b8729895eae51b28d417c736602/test%2Fparallel%2Ftest-http-abort-before-end.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-abort-before-end.js?ref=ffb385bff5f52b8729895eae51b28d417c736602",
            "patch": "@@ -22,25 +22,22 @@\n 'use strict';\n const common = require('../common');\n const http = require('http');\n-const assert = require('assert');\n \n const server = http.createServer(common.mustNotCall());\n \n-server.listen(0, function() {\n+server.listen(0, common.mustCall(() => {\n   const req = http.request({\n     method: 'GET',\n     host: '127.0.0.1',\n-    port: this.address().port\n+    port: server.address().port\n   });\n \n-  req.on('error', function(ex) {\n-    // https://github.com/joyent/node/issues/1399#issuecomment-2597359\n-    // abort() should emit an Error, not the net.Socket object\n-    assert(ex instanceof Error);\n-  });\n+  req.on('abort', common.mustCall(() => {\n+    server.close();\n+  }));\n+\n+  req.on('error', common.mustNotCall());\n \n   req.abort();\n   req.end();\n-\n-  server.close();\n-});\n+}));"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 8,
        "deletions": 11
    }
}