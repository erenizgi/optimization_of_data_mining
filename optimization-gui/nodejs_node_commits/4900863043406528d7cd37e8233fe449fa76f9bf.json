{
    "author": "cjihrig",
    "message": "url: handle quasi-WHATWG URLs in urlToOptions()\n\nPR-URL: https://github.com/nodejs/node/pull/26226\nRefs: https://github.com/nodejs/node/issues/26198\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "4900863043406528d7cd37e8233fe449fa76f9bf",
    "files": [
        {
            "sha": "81a4966288657ea49053f78eeeb463ddd8b7a8b6",
            "filename": "lib/internal/url.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/4900863043406528d7cd37e8233fe449fa76f9bf/lib%2Finternal%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/4900863043406528d7cd37e8233fe449fa76f9bf/lib%2Finternal%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Furl.js?ref=4900863043406528d7cd37e8233fe449fa76f9bf",
            "patch": "@@ -1257,13 +1257,13 @@ function domainToUnicode(domain) {\n function urlToOptions(url) {\n   var options = {\n     protocol: url.protocol,\n-    hostname: url.hostname.startsWith('[') ?\n+    hostname: typeof url.hostname === 'string' && url.hostname.startsWith('[') ?\n       url.hostname.slice(1, -1) :\n       url.hostname,\n     hash: url.hash,\n     search: url.search,\n     pathname: url.pathname,\n-    path: `${url.pathname}${url.search}`,\n+    path: `${url.pathname || ''}${url.search || ''}`,\n     href: url.href\n   };\n   if (url.port !== '') {"
        },
        {
            "sha": "ee51efd539029287cbabdf9edddab4428644a999",
            "filename": "test/parallel/test-whatwg-url-custom-properties.js",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/4900863043406528d7cd37e8233fe449fa76f9bf/test%2Fparallel%2Ftest-whatwg-url-custom-properties.js",
            "raw_url": "https://github.com/nodejs/node/raw/4900863043406528d7cd37e8233fe449fa76f9bf/test%2Fparallel%2Ftest-whatwg-url-custom-properties.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-url-custom-properties.js?ref=4900863043406528d7cd37e8233fe449fa76f9bf",
            "patch": "@@ -133,8 +133,8 @@ assert.strictEqual(url.searchParams, oldParams);\n \n // Test urlToOptions\n {\n-  const opts =\n-    urlToOptions(new URL('http://user:pass@foo.bar.com:21/aaa/zzz?l=24#test'));\n+  const urlObj = new URL('http://user:pass@foo.bar.com:21/aaa/zzz?l=24#test');\n+  const opts = urlToOptions(urlObj);\n   assert.strictEqual(opts instanceof URL, false);\n   assert.strictEqual(opts.protocol, 'http:');\n   assert.strictEqual(opts.auth, 'user:pass');\n@@ -147,6 +147,23 @@ assert.strictEqual(url.searchParams, oldParams);\n \n   const { hostname } = urlToOptions(new URL('http://[::1]:21'));\n   assert.strictEqual(hostname, '::1');\n+\n+  // If a WHATWG URL object is copied, it is possible that the resulting copy\n+  // contains the Symbols that Node uses for brand checking, but not the data\n+  // properties, which are getters. Verify that urlToOptions() can handle such\n+  // a case.\n+  const copiedUrlObj = Object.assign({}, urlObj);\n+  const copiedOpts = urlToOptions(copiedUrlObj);\n+  assert.strictEqual(copiedOpts instanceof URL, false);\n+  assert.strictEqual(copiedOpts.protocol, undefined);\n+  assert.strictEqual(copiedOpts.auth, undefined);\n+  assert.strictEqual(copiedOpts.hostname, undefined);\n+  assert.strictEqual(copiedOpts.port, NaN);\n+  assert.strictEqual(copiedOpts.path, '');\n+  assert.strictEqual(copiedOpts.pathname, undefined);\n+  assert.strictEqual(copiedOpts.search, undefined);\n+  assert.strictEqual(copiedOpts.hash, undefined);\n+  assert.strictEqual(copiedOpts.href, undefined);\n }\n \n // Test special origins"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 21,
        "deletions": 4
    }
}