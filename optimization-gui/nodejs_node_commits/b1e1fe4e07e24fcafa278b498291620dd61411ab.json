{
    "author": "mcollina",
    "message": "stream: do not error async iterators on destroy(null)\n\nFixes: https://github.com/nodejs/node/issues/23890\n\nPR-URL: https://github.com/nodejs/node/pull/23901\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "b1e1fe4e07e24fcafa278b498291620dd61411ab",
    "files": [
        {
            "sha": "90960f5a3842e3c43c7bc1cac54da14b9d290d1f",
            "filename": "lib/internal/streams/async_iterator.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b1e1fe4e07e24fcafa278b498291620dd61411ab/lib%2Finternal%2Fstreams%2Fasync_iterator.js",
            "raw_url": "https://github.com/nodejs/node/raw/b1e1fe4e07e24fcafa278b498291620dd61411ab/lib%2Finternal%2Fstreams%2Fasync_iterator.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fstreams%2Fasync_iterator.js?ref=b1e1fe4e07e24fcafa278b498291620dd61411ab",
            "patch": "@@ -153,7 +153,7 @@ const createReadableStreamAsyncIterator = (stream) => {\n   });\n \n   finished(stream, (err) => {\n-    if (err) {\n+    if (err && err.code !== 'ERR_STREAM_PREMATURE_CLOSE') {\n       const reject = iterator[kLastReject];\n       // reject if we are waiting for data in the Promise\n       // returned by next() and store the error"
        },
        {
            "sha": "83540de9defea33ff88d19855e5542c2ab859357",
            "filename": "test/parallel/test-stream-readable-async-iterators.js",
            "status": "modified",
            "additions": 18,
            "deletions": 5,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/b1e1fe4e07e24fcafa278b498291620dd61411ab/test%2Fparallel%2Ftest-stream-readable-async-iterators.js",
            "raw_url": "https://github.com/nodejs/node/raw/b1e1fe4e07e24fcafa278b498291620dd61411ab/test%2Fparallel%2Ftest-stream-readable-async-iterators.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-readable-async-iterators.js?ref=b1e1fe4e07e24fcafa278b498291620dd61411ab",
            "patch": "@@ -335,11 +335,8 @@ async function tests() {\n \n     readable.destroy();\n \n-    try {\n-      await readable[Symbol.asyncIterator]().next();\n-    } catch (e) {\n-      assert.strictEqual(e.code, 'ERR_STREAM_PREMATURE_CLOSE');\n-    }\n+    const { done } = await readable[Symbol.asyncIterator]().next();\n+    assert.strictEqual(done, true);\n   })();\n \n   await (async function() {\n@@ -380,6 +377,22 @@ async function tests() {\n     for await (const b of r) {\n     }\n   })();\n+\n+  await (async () => {\n+    console.log('destroy mid-stream does not error');\n+    const r = new Readable({\n+      objectMode: true,\n+      read() {\n+        this.push('asdf');\n+        this.push('hehe');\n+      }\n+    });\n+\n+    // eslint-disable-next-line no-unused-vars\n+    for await (const a of r) {\n+      r.destroy(null);\n+    }\n+  })();\n }\n \n // to avoid missing some tests if a promise does not resolve"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 19,
        "deletions": 6
    }
}