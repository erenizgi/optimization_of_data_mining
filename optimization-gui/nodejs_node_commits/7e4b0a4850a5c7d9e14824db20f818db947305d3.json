{
    "author": "cjihrig",
    "message": "util: make util binding internal\n\nRefs: https://github.com/nodejs/node/issues/22160\nPR-URL: https://github.com/nodejs/node/pull/22675\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "7e4b0a4850a5c7d9e14824db20f818db947305d3",
    "files": [
        {
            "sha": "d9ba7bc209de075d9e41736e74ed7cc9522cfeae",
            "filename": "benchmark/util/type-check.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/benchmark%2Futil%2Ftype-check.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/benchmark%2Futil%2Ftype-check.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Futil%2Ftype-check.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -38,7 +38,8 @@ function main({ type, argument, version, n }) {\n   // For testing, if supplied with an empty type, default to ArrayBufferView.\n   type = type || 'ArrayBufferView';\n \n-  const util = process.binding('util');\n+  const { internalBinding } = require('internal/test/binding');\n+  const util = internalBinding('util');\n   const types = require('internal/util/types');\n \n   const func = { native: util, js: types }[version][`is${type}`];"
        },
        {
            "sha": "30a9a0e733106292557ae2f7c61f0185aed5da20",
            "filename": "lib/console.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Fconsole.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Fconsole.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fconsole.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -29,7 +29,8 @@ const {\n     ERR_INVALID_ARG_VALUE,\n   },\n } = require('internal/errors');\n-const { previewEntries } = process.binding('util');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { previewEntries } = internalBinding('util');\n const { Buffer: { isBuffer } } = require('buffer');\n const util = require('util');\n const {"
        },
        {
            "sha": "8f05c1a4ce1b538c51e56507843d685e44c92222",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -176,7 +176,7 @@\n       // TODO(addaleax): Turn into a full runtime deprecation.\n       const { pendingDeprecation } = process.binding('config');\n       const { deprecate } = NativeModule.require('internal/util');\n-      const utilBinding = process.binding('util');\n+      const utilBinding = internalBinding('util');\n       const types = internalBinding('types');\n       for (const name of [\n         'isArrayBuffer', 'isArrayBufferView', 'isAsyncFunction',\n@@ -374,6 +374,7 @@\n         'contextify',\n         'tcp_wrap',\n         'tls_wrap',\n+        'util',\n         'async_wrap']);\n     process.binding = function binding(name) {\n       return internalBindingWhitelist.has(name) ?"
        },
        {
            "sha": "39f9766d3e595d65944a0ae51f7be387052b7cff",
            "filename": "lib/internal/modules/cjs/loader.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -21,7 +21,7 @@\n \n 'use strict';\n \n-const { NativeModule } = require('internal/bootstrap/loaders');\n+const { internalBinding, NativeModule } = require('internal/bootstrap/loaders');\n const util = require('util');\n const vm = require('vm');\n const assert = require('assert').ok;\n@@ -32,7 +32,7 @@ const {\n   internalModuleReadJSON,\n   internalModuleStat\n } = process.binding('fs');\n-const { safeGetenv } = process.binding('util');\n+const { safeGetenv } = internalBinding('util');\n const {\n   makeRequireFunction,\n   requireDepth,"
        },
        {
            "sha": "0ae81820dbed9ac797e6d6c3b2344a38f638fd86",
            "filename": "lib/internal/process/promises.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Fprocess%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Fprocess%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fpromises.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -1,6 +1,7 @@\n 'use strict';\n \n-const { safeToString } = process.binding('util');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { safeToString } = internalBinding('util');\n \n const maybeUnhandledPromises = new WeakMap();\n const pendingUnhandledRejections = [];"
        },
        {
            "sha": "43b99740683b3962087eb985a27e4f7b58cd37bd",
            "filename": "lib/internal/util.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -6,15 +6,14 @@ const {\n   ERR_UNKNOWN_SIGNAL\n } = require('internal/errors').codes;\n const { signals } = process.binding('constants').os;\n-\n+const { internalBinding } = require('internal/bootstrap/loaders');\n const {\n   getHiddenValue,\n   setHiddenValue,\n   arrow_message_private_symbol: kArrowMessagePrivateSymbolIndex,\n   decorated_private_symbol: kDecoratedPrivateSymbolIndex\n-} = process.binding('util');\n+} = internalBinding('util');\n \n-const { internalBinding } = require('internal/bootstrap/loaders');\n const { errmap } = internalBinding('uv');\n \n const noCrypto = !process.versions.openssl;"
        },
        {
            "sha": "1cef5533bc1195166898eba1cd84ad67c11154b3",
            "filename": "lib/internal/util/comparisons.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Futil%2Fcomparisons.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Finternal%2Futil%2Fcomparisons.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Fcomparisons.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -15,7 +15,7 @@ const {\n   propertyFilter: {\n     ONLY_ENUMERABLE\n   }\n-} = process.binding('util');\n+} = internalBinding('util');\n \n const ReflectApply = Reflect.apply;\n "
        },
        {
            "sha": "9a05201ea4459c1cf248add8f748dc01c52e7b49",
            "filename": "lib/os.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Fos.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Fos.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fos.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -21,7 +21,8 @@\n \n 'use strict';\n \n-const { pushValToArrayMax, safeGetenv } = process.binding('util');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { pushValToArrayMax, safeGetenv } = internalBinding('util');\n const constants = process.binding('constants').os;\n const { deprecate } = require('internal/util');\n const isWindows = process.platform === 'win32';"
        },
        {
            "sha": "a7e8b4cd27969f8c8530162f4d464a24f78e2a15",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -53,7 +53,8 @@ const {\n } = require('internal/deps/acorn/dist/acorn');\n const internalUtil = require('internal/util');\n const util = require('util');\n-const utilBinding = process.binding('util');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const utilBinding = internalBinding('util');\n const { inherits } = util;\n const Stream = require('stream');\n const vm = require('vm');\n@@ -79,7 +80,7 @@ const {\n     ALL_PROPERTIES,\n     SKIP_SYMBOLS\n   }\n-} = process.binding('util');\n+} = internalBinding('util');\n \n // Lazy-loaded.\n let processTopLevelAwait;"
        },
        {
            "sha": "860c875bec01a11442670fa5bd2de15c0aa64733",
            "filename": "lib/stream.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Fstream.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Fstream.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fstream.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -49,7 +49,8 @@ try {\n   } else {\n     // This throws for Node < 4.2.0 because there's no util binding and\n     // returns undefined for Node < 7.4.0.\n-    Stream._isUint8Array = process.binding('util').isUint8Array;\n+    const { internalBinding } = require('internal/bootstrap/loaders');\n+    Stream._isUint8Array = internalBinding('util').isUint8Array;\n   }\n } catch (e) {\n }"
        },
        {
            "sha": "f0b7285fe0103555d6bd5c98ba2140c3844659f9",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -31,15 +31,15 @@ const { validateNumber } = require('internal/validators');\n const { TextDecoder, TextEncoder } = require('internal/encoding');\n const { isBuffer } = require('buffer').Buffer;\n \n+const { internalBinding } = require('internal/bootstrap/loaders');\n const {\n   getPromiseDetails,\n   getProxyDetails,\n   kPending,\n   kRejected,\n   previewEntries\n-} = process.binding('util');\n+} = internalBinding('util');\n \n-const { internalBinding } = require('internal/bootstrap/loaders');\n const types = internalBinding('types');\n Object.assign(types, require('internal/util/types'));\n const {"
        },
        {
            "sha": "8f261e8989de392284d8818d9e656787fbd36f54",
            "filename": "src/node_util.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/src%2Fnode_util.cc",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/src%2Fnode_util.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_util.cc?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -234,4 +234,4 @@ void Initialize(Local<Object> target,\n }  // namespace util\n }  // namespace node\n \n-NODE_BUILTIN_MODULE_CONTEXT_AWARE(util, node::util::Initialize)\n+NODE_MODULE_CONTEXT_AWARE_INTERNAL(util, node::util::Initialize)"
        },
        {
            "sha": "ee0b722d450103c639c4817a7f5e3d106119b4bf",
            "filename": "test/parallel/test-internal-module-wrap.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-internal-module-wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-internal-module-wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-internal-module-wrap.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -7,7 +7,7 @@ const assert = require('assert');\n \n const { internalBinding } = require('internal/test/binding');\n const { ModuleWrap } = internalBinding('module_wrap');\n-const { getPromiseDetails, isPromise } = process.binding('util');\n+const { getPromiseDetails, isPromise } = internalBinding('util');\n const setTimeoutAsync = require('util').promisify(setTimeout);\n \n const foo = new ModuleWrap('export * from \"bar\"; 6;', 'foo');"
        },
        {
            "sha": "40fbf1d48caf201cbbea09edfc70473195e6af44",
            "filename": "test/parallel/test-internal-util-decorate-error-stack.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-internal-util-decorate-error-stack.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-internal-util-decorate-error-stack.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-internal-util-decorate-error-stack.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -4,7 +4,8 @@ require('../common');\n const fixtures = require('../common/fixtures');\n const assert = require('assert');\n const internalUtil = require('internal/util');\n-const binding = process.binding('util');\n+const { internalBinding } = require('internal/test/binding');\n+const binding = internalBinding('util');\n const spawnSync = require('child_process').spawnSync;\n \n const kArrowMessagePrivateSymbolIndex = binding.arrow_message_private_symbol;"
        },
        {
            "sha": "b3438a625240a26f49432a1185a0018419c1541e",
            "filename": "test/parallel/test-util-inspect-proxy.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-util-inspect-proxy.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-util-inspect-proxy.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect-proxy.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -1,9 +1,11 @@\n+// Flags: --expose-internals\n 'use strict';\n \n require('../common');\n const assert = require('assert');\n const util = require('util');\n-const processUtil = process.binding('util');\n+const { internalBinding } = require('internal/test/binding');\n+const processUtil = internalBinding('util');\n const opts = { showProxy: true };\n \n const target = {};"
        },
        {
            "sha": "b5ccdf019a522697f0051c3cf1a16135cbe4458d",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --expose-internals\n // Copyright Joyent, Inc. and other Node contributors.\n //\n // Permission is hereby granted, free of charge, to any person obtaining a\n@@ -22,10 +23,11 @@\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n+const { internalBinding } = require('internal/test/binding');\n const JSStream = process.binding('js_stream').JSStream;\n const util = require('util');\n const vm = require('vm');\n-const { previewEntries } = process.binding('util');\n+const { previewEntries } = internalBinding('util');\n const { inspect } = util;\n \n assert.strictEqual(util.inspect(1), '1');"
        },
        {
            "sha": "4b78cefc6efe60ba4c4c64cf843bc9c1f3f4bf07",
            "filename": "test/parallel/test-util-internal.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-util-internal.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-util-internal.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-internal.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -4,13 +4,14 @@\n require('../common');\n const assert = require('assert');\n const fixtures = require('../common/fixtures');\n+const { internalBinding } = require('internal/test/binding');\n \n const {\n   getHiddenValue,\n   setHiddenValue,\n   arrow_message_private_symbol: kArrowMessagePrivateSymbolIndex,\n   safeGetenv\n-} = process.binding('util');\n+} = internalBinding('util');\n \n for (const oneEnv in process.env) {\n   assert.strictEqual("
        },
        {
            "sha": "7ac1261eabab40c56abad0638f1b955c287679ad",
            "filename": "test/parallel/test-util-sigint-watchdog.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-util-sigint-watchdog.js",
            "raw_url": "https://github.com/nodejs/node/raw/7e4b0a4850a5c7d9e14824db20f818db947305d3/test%2Fparallel%2Ftest-util-sigint-watchdog.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-sigint-watchdog.js?ref=7e4b0a4850a5c7d9e14824db20f818db947305d3",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n if (common.isWindows) {\n@@ -6,7 +7,8 @@ if (common.isWindows) {\n }\n \n const assert = require('assert');\n-const binding = process.binding('util');\n+const { internalBinding } = require('internal/test/binding');\n+const binding = internalBinding('util');\n \n [(next) => {\n   // Test with no signal observed."
        }
    ],
    "stats": {
        "total": 60,
        "additions": 37,
        "deletions": 23
    }
}