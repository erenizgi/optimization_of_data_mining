{
    "author": "BridgeAR",
    "message": "doc: improve assert docs\n\nThis improves the error example output by reflecting the current\nstate. It also makes sure the examples are up to date in general.\n`assert.throws` clarified the `ERR_AMBIGUOUS_ARGUMENT` error.\n\nPR-URL: https://github.com/nodejs/node/pull/20313\nReviewed-By: Vse Mozhet Byt <vsemozhetbyt@gmail.com>\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "655430179f381412d9e2fe7657135f9bba4b8e45",
    "files": [
        {
            "sha": "468293b208a90dbc358b7ed8a22402eed49cae17",
            "filename": "doc/api/assert.md",
            "status": "modified",
            "additions": 128,
            "deletions": 81,
            "changes": 209,
            "blob_url": "https://github.com/nodejs/node/blob/655430179f381412d9e2fe7657135f9bba4b8e45/doc%2Fapi%2Fassert.md",
            "raw_url": "https://github.com/nodejs/node/raw/655430179f381412d9e2fe7657135f9bba4b8e45/doc%2Fapi%2Fassert.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fassert.md?ref=655430179f381412d9e2fe7657135f9bba4b8e45",
            "patch": "@@ -102,31 +102,25 @@ It can be accessed using:\n const assert = require('assert').strict;\n ```\n \n-Example error diff (the `expected`, `actual`, and `Lines skipped` will be on a\n-single row):\n+Example error diff:\n \n ```js\n const assert = require('assert').strict;\n \n assert.deepEqual([[[1, 2, 3]], 4, 5], [[[1, 2, '3']], 4, 5]);\n-```\n-\n-```diff\n-AssertionError [ERR_ASSERTION]: Input A expected to deepStrictEqual input B:\n-+ expected\n-- actual\n-... Lines skipped\n-\n-  [\n-    [\n-...\n-      2,\n--     3\n-+     '3'\n-    ],\n-...\n-    5\n-  ]\n+// AssertionError: Input A expected to strictly deep-equal input B:\n+// + expected - actual ... Lines skipped\n+//\n+//   [\n+//     [\n+// ...\n+//       2,\n+// -     3\n+// +     '3'\n+//     ],\n+// ...\n+//     5\n+//   ]\n ```\n \n To deactivate the colors, use the `NODE_DISABLE_COLORS` environment variable.\n@@ -319,43 +313,67 @@ are recursively evaluated also by the following rules.\n ```js\n const assert = require('assert').strict;\n \n+// This fails because 1 !== '1'.\n assert.deepStrictEqual({ a: 1 }, { a: '1' });\n-// AssertionError: { a: 1 } deepStrictEqual { a: '1' }\n-// because 1 !== '1' using SameValue comparison\n+// AssertionError: Input A expected to strictly deep-equal input B:\n+// + expected - actual\n+//   {\n+// -   a: 1\n+// +   a: '1'\n+//   }\n \n // The following objects don't have own properties\n const date = new Date();\n const object = {};\n const fakeDate = {};\n Object.setPrototypeOf(fakeDate, Date.prototype);\n \n+// Different [[Prototype]]:\n assert.deepStrictEqual(object, fakeDate);\n-// AssertionError: {} deepStrictEqual Date {}\n-// Different [[Prototype]]\n+// AssertionError: Input A expected to strictly deep-equal input B:\n+// + expected - actual\n+// - {}\n+// + Date {}\n \n+// Different type tags:\n assert.deepStrictEqual(date, fakeDate);\n-// AssertionError: 2017-03-11T14:25:31.849Z deepStrictEqual Date {}\n-// Different type tags\n+// AssertionError: Input A expected to strictly deep-equal input B:\n+// + expected - actual\n+// - 2018-04-26T00:49:08.604Z\n+// + Date {}\n \n assert.deepStrictEqual(NaN, NaN);\n // OK, because of the SameValue comparison\n \n+// Different unwrapped numbers:\n assert.deepStrictEqual(new Number(1), new Number(2));\n-// Fails because the wrapped number is unwrapped and compared as well.\n+// AssertionError: Input A expected to strictly deep-equal input B:\n+// + expected - actual\n+// - [Number: 1]\n+// + [Number: 2]\n+\n assert.deepStrictEqual(new String('foo'), Object('foo'));\n // OK because the object and the string are identical when unwrapped.\n \n assert.deepStrictEqual(-0, -0);\n // OK\n+\n+// Different zeros using the SameValue Comparison:\n assert.deepStrictEqual(0, -0);\n-// AssertionError: 0 deepStrictEqual -0\n+// AssertionError: Input A expected to strictly deep-equal input B:\n+// + expected - actual\n+// - 0\n+// + -0\n \n const symbol1 = Symbol();\n const symbol2 = Symbol();\n assert.deepStrictEqual({ [symbol1]: 1 }, { [symbol1]: 1 });\n // OK, because it is the same symbol on both objects.\n assert.deepStrictEqual({ [symbol1]: 1 }, { [symbol2]: 1 });\n-// Fails because symbol1 !== symbol2!\n+// AssertionError [ERR_ASSERTION]: Input objects not identical:\n+// {\n+//   [Symbol()]: 1\n+// }\n \n const weakMap1 = new WeakMap();\n const weakMap2 = new WeakMap([[{}, {}]]);\n@@ -364,8 +382,16 @@ weakMap3.unequal = true;\n \n assert.deepStrictEqual(weakMap1, weakMap2);\n // OK, because it is impossible to compare the entries\n+\n+// Fails because weakMap3 has a property that weakMap1 does not contain:\n assert.deepStrictEqual(weakMap1, weakMap3);\n-// Fails because weakMap3 has a property that weakMap1 does not contain!\n+// AssertionError: Input A expected to strictly deep-equal input B:\n+// + expected - actual\n+//   WeakMap {\n+// -   [items unknown]\n+// +   [items unknown],\n+// +   unequal: true\n+//   }\n ```\n \n If the values are not equal, an `AssertionError` is thrown with a `message`\n@@ -639,7 +665,9 @@ changes:\n * `value` {any}\n \n Throws `value` if `value` is not `undefined` or `null`. This is useful when\n-testing the `error` argument in callbacks.\n+testing the `error` argument in callbacks. The stack trace contains all frames\n+from the error passed to `ifError()` including the potential new frames for\n+`ifError()` itself. See below for an example.\n \n ```js\n const assert = require('assert').strict;\n@@ -652,6 +680,19 @@ assert.ifError('error');\n // AssertionError [ERR_ASSERTION]: ifError got unwanted exception: 'error'\n assert.ifError(new Error());\n // AssertionError [ERR_ASSERTION]: ifError got unwanted exception: Error\n+\n+// Create some random error frames.\n+let err;\n+(function errorFrame() {\n+  err = new Error('test error');\n+})();\n+\n+(function ifErrorFrame() {\n+  assert.ifError(err);\n+})();\n+// AssertionError [ERR_ASSERTION]: ifError got unwanted exception: test error\n+//     at ifErrorFrame\n+//     at errorFrame\n ```\n \n ## assert.notDeepEqual(actual, expected[, message])\n@@ -834,7 +875,7 @@ assert.notStrictEqual(1, 2);\n // OK\n \n assert.notStrictEqual(1, 1);\n-// AssertionError: 1 notStrictEqual 1\n+// AssertionError [ERR_ASSERTION]: Identical input passed to notStrictEqual: 1\n \n assert.notStrictEqual(1, '1');\n // OK\n@@ -880,40 +921,34 @@ assert.ok(1);\n // OK\n \n assert.ok();\n-// throws:\n-// \"AssertionError: No value argument passed to `assert.ok`.\n+// AssertionError: No value argument passed to `assert.ok()`\n \n assert.ok(false, 'it\\'s false');\n-// throws \"AssertionError: it's false\"\n+// AssertionError: it's false\n \n // In the repl:\n assert.ok(typeof 123 === 'string');\n-// throws:\n-// \"AssertionError: false == true\n+// AssertionError: false == true\n \n // In a file (e.g. test.js):\n assert.ok(typeof 123 === 'string');\n-// throws:\n-// \"AssertionError: The expression evaluated to a falsy value:\n+// AssertionError: The expression evaluated to a falsy value:\n //\n //   assert.ok(typeof 123 === 'string')\n \n assert.ok(false);\n-// throws:\n-// \"AssertionError: The expression evaluated to a falsy value:\n+// AssertionError: The expression evaluated to a falsy value:\n //\n //   assert.ok(false)\n \n assert.ok(0);\n-// throws:\n-// \"AssertionError: The expression evaluated to a falsy value:\n+// AssertionError: The expression evaluated to a falsy value:\n //\n //   assert.ok(0)\n \n // Using `assert()` works the same:\n assert(0);\n-// throws:\n-// \"AssertionError: The expression evaluated to a falsy value:\n+// AssertionError: The expression evaluated to a falsy value:\n //\n //   assert(0)\n ```\n@@ -995,13 +1030,19 @@ determined by the [SameValue Comparison][].\n const assert = require('assert').strict;\n \n assert.strictEqual(1, 2);\n-// AssertionError: 1 strictEqual 2\n+// AssertionError [ERR_ASSERTION]: Input A expected to strictly equal input B:\n+// + expected - actual\n+// - 1\n+// + 2\n \n assert.strictEqual(1, 1);\n // OK\n \n assert.strictEqual(1, '1');\n-// AssertionError: 1 strictEqual '1'\n+// AssertionError [ERR_ASSERTION]: Input A expected to strictly equal input B:\n+// + expected - actual\n+// - 1\n+// + '1'\n ```\n \n If the values are not strictly equal, an `AssertionError` is thrown with a\n@@ -1035,6 +1076,34 @@ each property will be tested for including the non-enumerable `message` and\n If specified, `message` will be the message provided by the `AssertionError` if\n the block fails to throw.\n \n+Custom error object / error instance:\n+\n+```js\n+const err = new TypeError('Wrong value');\n+err.code = 404;\n+\n+assert.throws(\n+  () => {\n+    throw err;\n+  },\n+  {\n+    name: 'TypeError',\n+    message: 'Wrong value'\n+    // Note that only properties on the error object will be tested!\n+  }\n+);\n+\n+// Fails due to the different `message` and `name` properties:\n+assert.throws(\n+  () => {\n+    const otherErr = new Error('Not found');\n+    otherErr.code = 404;\n+    throw otherErr;\n+  },\n+  err // This tests for `message`, `name` and `code`.\n+);\n+```\n+\n Validate instanceof using constructor:\n \n ```js\n@@ -1076,39 +1145,12 @@ assert.throws(\n );\n ```\n \n-Custom error object / error instance:\n-\n-```js\n-const err = new TypeError('Wrong value');\n-err.code = 404;\n-\n-assert.throws(\n-  () => {\n-    throw err;\n-  },\n-  {\n-    name: 'TypeError',\n-    message: 'Wrong value'\n-    // Note that only properties on the error object will be tested!\n-  }\n-);\n-\n-// Fails due to the different `message` and `name` properties:\n-assert.throws(\n-  () => {\n-    const otherErr = new Error('Not found');\n-    otherErr.code = 404;\n-    throw otherErr;\n-  },\n-  err // This tests for `message`, `name` and `code`.\n-);\n-```\n-\n Note that `error` cannot be a string. If a string is provided as the second\n argument, then `error` is assumed to be omitted and the string will be used for\n-`message` instead. This can lead to easy-to-miss mistakes. Please read the\n-example below carefully if using a string as the second argument gets\n-considered:\n+`message` instead. This can lead to easy-to-miss mistakes. Using the same\n+message as the thrown error message is going to result in an\n+`ERR_AMBIGUOUS_ARGUMENT` error. Please read the example below carefully if using\n+a string as the second argument gets considered:\n \n <!-- eslint-disable no-restricted-syntax -->\n ```js\n@@ -1121,10 +1163,15 @@ function throwingSecond() {\n function notThrowing() {}\n \n // The second argument is a string and the input function threw an Error.\n-// In that case both cases do not throw as neither is going to try to\n-// match for the error message thrown by the input function!\n+// The first case will not throw as it does not match for the error message\n+// thrown by the input function!\n assert.throws(throwingFirst, 'Second');\n+// In the next example the message has no benefit over the message from the\n+// error and since it is not clear if the user intended to actually match\n+// against the error message, Node.js thrown an `ERR_AMBIGUOUS_ARGUMENT` error.\n assert.throws(throwingSecond, 'Second');\n+// Throws an error:\n+// TypeError [ERR_AMBIGUOUS_ARGUMENT]\n \n // The string is only used (as message) in case the function does not throw:\n assert.throws(notThrowing, 'Second');\n@@ -1134,7 +1181,7 @@ assert.throws(notThrowing, 'Second');\n assert.throws(throwingSecond, /Second$/);\n // Does not throw because the error messages match.\n assert.throws(throwingFirst, /Second$/);\n-// Throws a error:\n+// Throws an error:\n // Error: First\n //     at throwingFirst (repl:2:9)\n ```"
        }
    ],
    "stats": {
        "total": 209,
        "additions": 128,
        "deletions": 81
    }
}