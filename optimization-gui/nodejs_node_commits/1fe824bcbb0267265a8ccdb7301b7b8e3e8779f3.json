{
    "author": "BridgeAR",
    "message": "util,console: handle symbols as defined in the spec\n\nThe `console` functions rely on the `util.format()` behavior. It\ndid not follow the whatwg spec when it comes to symbols in combination\nwith the %d, %i and %f format specifiers. Using a symbol argument in\ncombination with one of these specifiers resulted in an error instead\nof returning `'NaN'`. This is now fixed by this patch.\n\nPR-URL: https://github.com/nodejs/node/pull/23708\nRefs: https://console.spec.whatwg.org/#formatter\nReviewed-By: Roman Reiss <me@silverwind.io>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3",
    "files": [
        {
            "sha": "9c4c6cca40d78440d343d6c301428d8b135bf252",
            "filename": "doc/api/util.md",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3/doc%2Fapi%2Futil.md",
            "raw_url": "https://github.com/nodejs/node/raw/1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3/doc%2Fapi%2Futil.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Futil.md?ref=1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3",
            "patch": "@@ -183,6 +183,10 @@ property take precedence over `--trace-deprecation` and\n <!-- YAML\n added: v0.5.3\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/23708\n+    description: The `%d`, `%f` and `%i` specifiers now support Symbols\n+                 properly.\n   - version: REPLACEME\n     pr-url: https://github.com/nodejs/node/pull/23162\n     description: The `format` argument is now only taken as such if it actually"
        },
        {
            "sha": "63b34f48bfa8966793243abcacc94ed57c5bf291",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3",
            "patch": "@@ -114,6 +114,8 @@ function formatWithOptions(inspectOptions, ...args) {\n               // eslint-disable-next-line valid-typeof\n               if (typeof tempNum === 'bigint') {\n                 tempStr = `${tempNum}n`;\n+              } else if (typeof tempNum === 'symbol') {\n+                tempStr = 'NaN';\n               } else {\n                 tempStr = `${Number(tempNum)}`;\n               }\n@@ -136,12 +138,19 @@ function formatWithOptions(inspectOptions, ...args) {\n               // eslint-disable-next-line valid-typeof\n               if (typeof tempInteger === 'bigint') {\n                 tempStr = `${tempInteger}n`;\n+              } else if (typeof tempInteger === 'symbol') {\n+                tempStr = 'NaN';\n               } else {\n                 tempStr = `${parseInt(tempInteger)}`;\n               }\n               break;\n             case 102: // 'f'\n-              tempStr = `${parseFloat(args[a++])}`;\n+              const tempFloat = args[a++];\n+              if (typeof tempFloat === 'symbol') {\n+                tempStr = 'NaN';\n+              } else {\n+                tempStr = `${parseFloat(tempFloat)}`;\n+              }\n               break;\n             case 37: // '%'\n               str += first.slice(lastPos, i);"
        },
        {
            "sha": "066b4de58c1399d027bbc81a8383fcc9934d4108",
            "filename": "test/parallel/test-util-format.js",
            "status": "modified",
            "additions": 4,
            "deletions": 12,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3/test%2Fparallel%2Ftest-util-format.js",
            "raw_url": "https://github.com/nodejs/node/raw/1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3/test%2Fparallel%2Ftest-util-format.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-format.js?ref=1fe824bcbb0267265a8ccdb7301b7b8e3e8779f3",
            "patch": "@@ -44,18 +44,6 @@ assert.strictEqual(util.format(symbol), 'Symbol(foo)');\n assert.strictEqual(util.format('foo', symbol), 'foo Symbol(foo)');\n assert.strictEqual(util.format('%s', symbol), 'Symbol(foo)');\n assert.strictEqual(util.format('%j', symbol), 'undefined');\n-assert.throws(\n-  () => { util.format('%d', symbol); },\n-  (e) => {\n-    // The error should be a TypeError.\n-    if (!(e instanceof TypeError))\n-      return false;\n-\n-    // The error should be from the JS engine and not from Node.js.\n-    // JS engine errors do not have the `code` property.\n-    return e.code === undefined;\n-  }\n-);\n \n // Number format specifier\n assert.strictEqual(util.format('%d'), '%d');\n@@ -66,6 +54,7 @@ assert.strictEqual(util.format('%d', '42.0'), '42');\n assert.strictEqual(util.format('%d', 1.5), '1.5');\n assert.strictEqual(util.format('%d', -0.5), '-0.5');\n assert.strictEqual(util.format('%d', ''), '0');\n+assert.strictEqual(util.format('%d', Symbol()), 'NaN');\n assert.strictEqual(util.format('%d %d', 42, 43), '42 43');\n assert.strictEqual(util.format('%d %d', 42), '42 %d');\n assert.strictEqual(\n@@ -90,6 +79,7 @@ assert.strictEqual(util.format('%i', '42.0'), '42');\n assert.strictEqual(util.format('%i', 1.5), '1');\n assert.strictEqual(util.format('%i', -0.5), '0');\n assert.strictEqual(util.format('%i', ''), 'NaN');\n+assert.strictEqual(util.format('%i', Symbol()), 'NaN');\n assert.strictEqual(util.format('%i %i', 42, 43), '42 43');\n assert.strictEqual(util.format('%i %i', 42), '42 %i');\n assert.strictEqual(\n@@ -125,6 +115,8 @@ assert.strictEqual(util.format('%f', 1.5), '1.5');\n assert.strictEqual(util.format('%f', -0.5), '-0.5');\n assert.strictEqual(util.format('%f', Math.PI), '3.141592653589793');\n assert.strictEqual(util.format('%f', ''), 'NaN');\n+assert.strictEqual(util.format('%f', Symbol('foo')), 'NaN');\n+assert.strictEqual(util.format('%f', 5n), '5');\n assert.strictEqual(util.format('%f %f', 42, 43), '42 43');\n assert.strictEqual(util.format('%f %f', 42), '42 %f');\n "
        }
    ],
    "stats": {
        "total": 31,
        "additions": 18,
        "deletions": 13
    }
}