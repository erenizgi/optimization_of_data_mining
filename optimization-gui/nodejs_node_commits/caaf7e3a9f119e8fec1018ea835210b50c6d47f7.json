{
    "author": "trivikr",
    "message": "http2: callback valid check before closing request\n\nDo not close the request if callback is not a function, and\nthrow ERR_INVALID_CALLBACK TypeError\n\nPR-URL: https://github.com/nodejs/node/pull/19061\nFixes: https://github.com/nodejs/node/issues/18855\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Shingo Inoue <leko.noor@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>",
    "sha": "caaf7e3a9f119e8fec1018ea835210b50c6d47f7",
    "files": [
        {
            "sha": "d3bb0523c072021548fdba9ad0022e8c94a7bd06",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/caaf7e3a9f119e8fec1018ea835210b50c6d47f7/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/caaf7e3a9f119e8fec1018ea835210b50c6d47f7/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=caaf7e3a9f119e8fec1018ea835210b50c6d47f7",
            "patch": "@@ -1769,6 +1769,8 @@ class Http2Stream extends Duplex {\n       throw new errors.TypeError('ERR_INVALID_ARG_TYPE', 'code', 'number');\n     if (code < 0 || code > kMaxInt)\n       throw new errors.RangeError('ERR_OUT_OF_RANGE', 'code');\n+    if (callback !== undefined && typeof callback !== 'function')\n+      throw new errors.TypeError('ERR_INVALID_CALLBACK');\n \n     // Clear timeout and remove timeout listeners\n     this.setTimeout(0);\n@@ -1786,8 +1788,6 @@ class Http2Stream extends Duplex {\n     state.rstCode = code;\n \n     if (callback !== undefined) {\n-      if (typeof callback !== 'function')\n-        throw new errors.TypeError('ERR_INVALID_CALLBACK');\n       this.once('close', callback);\n     }\n "
        },
        {
            "sha": "8ed91e3f03d93e242091af0ae8c13abef8ca41fb",
            "filename": "test/parallel/test-http2-client-rststream-before-connect.js",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/caaf7e3a9f119e8fec1018ea835210b50c6d47f7/test%2Fparallel%2Ftest-http2-client-rststream-before-connect.js",
            "raw_url": "https://github.com/nodejs/node/raw/caaf7e3a9f119e8fec1018ea835210b50c6d47f7/test%2Fparallel%2Ftest-http2-client-rststream-before-connect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-client-rststream-before-connect.js?ref=caaf7e3a9f119e8fec1018ea835210b50c6d47f7",
            "patch": "@@ -28,6 +28,18 @@ server.listen(0, common.mustCall(() => {\n   );\n   assert.strictEqual(req.closed, false);\n \n+  [true, 1, {}, [], null, 'test'].forEach((notFunction) => {\n+    common.expectsError(\n+      () => req.close(closeCode, notFunction),\n+      {\n+        type: TypeError,\n+        code: 'ERR_INVALID_CALLBACK',\n+        message: 'Callback must be a function'\n+      }\n+    );\n+    assert.strictEqual(req.closed, false);\n+  });\n+\n   req.close(closeCode, common.mustCall());\n   assert.strictEqual(req.closed, true);\n "
        }
    ],
    "stats": {
        "total": 16,
        "additions": 14,
        "deletions": 2
    }
}