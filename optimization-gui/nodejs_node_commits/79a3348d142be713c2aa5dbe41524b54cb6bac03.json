{
    "author": "Trott",
    "message": "worker: serialize errors if stack getter throws\n\nCurrent code that is intended to handle the stack getter throwing is\nuntested. Add a test and adjust code to function as expected.\n\nCo-authored-by: Anna Henningsen <anna@addaleax.net>\nPR-URL: https://github.com/nodejs/node/pull/26145\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "79a3348d142be713c2aa5dbe41524b54cb6bac03",
    "files": [
        {
            "sha": "1fed04f0a9864fddc2a40ee76d7a571bb52716f4",
            "filename": "lib/internal/error-serdes.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/79a3348d142be713c2aa5dbe41524b54cb6bac03/lib%2Finternal%2Ferror-serdes.js",
            "raw_url": "https://github.com/nodejs/node/raw/79a3348d142be713c2aa5dbe41524b54cb6bac03/lib%2Finternal%2Ferror-serdes.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferror-serdes.js?ref=79a3348d142be713c2aa5dbe41524b54cb6bac03",
            "patch": "@@ -36,7 +36,10 @@ function TryGetAllProperties(object, target = object) {\n   Assign(all, TryGetAllProperties(GetPrototypeOf(object), target));\n   const keys = GetOwnPropertyNames(object);\n   ForEach(keys, (key) => {\n-    const descriptor = GetOwnPropertyDescriptor(object, key);\n+    let descriptor;\n+    try {\n+      descriptor = GetOwnPropertyDescriptor(object, key);\n+    } catch { return; }\n     const getter = descriptor.get;\n     if (getter && key !== '__proto__') {\n       try {\n@@ -89,7 +92,6 @@ function serializeError(error) {\n       for (var i = 0; i < constructors.length; i++) {\n         const name = GetName(constructors[i]);\n         if (errorConstructorNames.has(name)) {\n-          try { error.stack; } catch {}\n           const serialized = serialize({\n             constructor: name,\n             properties: TryGetAllProperties(error)"
        },
        {
            "sha": "108fa3f5143d183ceb1b33ece788e259cd677139",
            "filename": "test/parallel/test-worker-error-stack-getter-throws.js",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/79a3348d142be713c2aa5dbe41524b54cb6bac03/test%2Fparallel%2Ftest-worker-error-stack-getter-throws.js",
            "raw_url": "https://github.com/nodejs/node/raw/79a3348d142be713c2aa5dbe41524b54cb6bac03/test%2Fparallel%2Ftest-worker-error-stack-getter-throws.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-error-stack-getter-throws.js?ref=79a3348d142be713c2aa5dbe41524b54cb6bac03",
            "patch": "@@ -0,0 +1,22 @@\n+'use strict';\n+const common = require('../common');\n+const assert = require('assert');\n+const { Worker } = require('worker_threads');\n+\n+const w = new Worker(\n+  `const fn = (err) => {\n+    if (err.message === 'fhqwhgads')\n+      throw new Error('come on');\n+    return 'This is my custom stack trace!';\n+  };\n+  Error.prepareStackTrace = fn;\n+  throw new Error('fhqwhgads');\n+  `,\n+  { eval: true }\n+);\n+w.on('message', common.mustNotCall());\n+w.on('error', common.mustCall((err) => {\n+  assert.strictEqual(err.stack, undefined);\n+  assert.strictEqual(err.message, 'fhqwhgads');\n+  assert.strictEqual(err.name, 'Error');\n+}));"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 26,
        "deletions": 2
    }
}