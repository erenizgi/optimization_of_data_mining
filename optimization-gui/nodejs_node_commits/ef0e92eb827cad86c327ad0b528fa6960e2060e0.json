{
    "author": "qbit",
    "message": "test: update a few tests to work on OpenBSD\n\nPR-URL: https://github.com/nodejs/node/pull/18543\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "ef0e92eb827cad86c327ad0b528fa6960e2060e0",
    "files": [
        {
            "sha": "974aa841140fcccd80909c1f71078fb9003558b7",
            "filename": "test/common/index.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fcommon%2Findex.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fcommon%2Findex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.js?ref=ef0e92eb827cad86c327ad0b528fa6960e2060e0",
            "patch": "@@ -55,6 +55,7 @@ exports.isLinuxPPCBE = (process.platform === 'linux') &&\n                        (os.endianness() === 'BE');\n exports.isSunOS = process.platform === 'sunos';\n exports.isFreeBSD = process.platform === 'freebsd';\n+exports.isOpenBSD = process.platform === 'openbsd';\n exports.isLinux = process.platform === 'linux';\n exports.isOSX = process.platform === 'darwin';\n "
        },
        {
            "sha": "e08aff908522f2085152b9324dc7594479188bfd",
            "filename": "test/parallel/test-child-process-exec-timeout.js",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-child-process-exec-timeout.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-child-process-exec-timeout.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-child-process-exec-timeout.js?ref=ef0e92eb827cad86c327ad0b528fa6960e2060e0",
            "patch": "@@ -16,15 +16,22 @@ const cmd = `\"${process.execPath}\" \"${__filename}\" child`;\n \n // Test the case where a timeout is set, and it expires.\n cp.exec(cmd, { timeout: 1 }, common.mustCall((err, stdout, stderr) => {\n+  let sigterm = 'SIGTERM';\n   assert.strictEqual(err.killed, true);\n-  assert.strictEqual(err.code, null);\n+  // TODO OpenBSD returns a null signal and 143 for code\n+  if (common.isOpenBSD) {\n+    assert.strictEqual(err.code, 143);\n+    sigterm = null;\n+  } else {\n+    assert.strictEqual(err.code, null);\n+  }\n   // At least starting with Darwin Kernel Version 16.4.0, sending a SIGTERM to a\n   // process that is still starting up kills it with SIGKILL instead of SIGTERM.\n   // See: https://github.com/libuv/libuv/issues/1226\n   if (common.isOSX)\n     assert.ok(err.signal === 'SIGTERM' || err.signal === 'SIGKILL');\n   else\n-    assert.strictEqual(err.signal, 'SIGTERM');\n+    assert.strictEqual(err.signal, sigterm);\n   assert.strictEqual(err.cmd, cmd);\n   assert.strictEqual(stdout.trim(), '');\n   assert.strictEqual(stderr.trim(), '');"
        },
        {
            "sha": "dae9c7dc9eabfcadde799ca4541ada5a4ad67a0e",
            "filename": "test/parallel/test-fs-utimes.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-fs-utimes.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-fs-utimes.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-utimes.js?ref=ef0e92eb827cad86c327ad0b528fa6960e2060e0",
            "patch": "@@ -178,8 +178,8 @@ process.on('exit', function() {\n const path = `${tmpdir.path}/test-utimes-precision`;\n fs.writeFileSync(path, '');\n \n-// test Y2K38 for all platforms [except 'arm', and 'SunOS']\n-if (!process.arch.includes('arm') && !common.isSunOS) {\n+// test Y2K38 for all platforms [except 'arm', 'OpenBSD' and 'SunOS']\n+if (!process.arch.includes('arm') && !common.isOpenBSD && !common.isSunOS) {\n   // because 2 ** 31 doesn't look right\n   // eslint-disable-next-line space-infix-ops\n   const Y2K38_mtime = 2**31;"
        },
        {
            "sha": "06a15c89fb46b3ae9ce08d15fc1f1ef88ef9204a",
            "filename": "test/parallel/test-http-dns-error.js",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-http-dns-error.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-http-dns-error.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-dns-error.js?ref=ef0e92eb827cad86c327ad0b528fa6960e2060e0",
            "patch": "@@ -32,6 +32,10 @@ const https = require('https');\n const host = '*'.repeat(256);\n const MAX_TRIES = 5;\n \n+let errCode = 'ENOTFOUND';\n+if (common.isOpenBSD)\n+  errCode = 'EAI_FAIL';\n+\n function tryGet(mod, tries) {\n   // Bad host name should not throw an uncatchable exception.\n   // Ensure that there is time to attach an error listener.\n@@ -41,7 +45,7 @@ function tryGet(mod, tries) {\n       tryGet(mod, ++tries);\n       return;\n     }\n-    assert.strictEqual(err.code, 'ENOTFOUND');\n+    assert.strictEqual(err.code, errCode);\n   }));\n   // http.get() called req1.end() for us\n }\n@@ -57,7 +61,7 @@ function tryRequest(mod, tries) {\n       tryRequest(mod, ++tries);\n       return;\n     }\n-    assert.strictEqual(err.code, 'ENOTFOUND');\n+    assert.strictEqual(err.code, errCode);\n   }));\n   req.end();\n }"
        },
        {
            "sha": "a5ae415592fed4eea505f246700f1916d35904fe",
            "filename": "test/parallel/test-net-dns-error.js",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-net-dns-error.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-net-dns-error.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-net-dns-error.js?ref=ef0e92eb827cad86c327ad0b528fa6960e2060e0",
            "patch": "@@ -27,17 +27,21 @@ const net = require('net');\n \n const host = '*'.repeat(256);\n \n+let errCode = 'ENOTFOUND';\n+if (common.isOpenBSD)\n+  errCode = 'EAI_FAIL';\n+\n function do_not_call() {\n   throw new Error('This function should not have been called.');\n }\n \n const socket = net.connect(42, host, do_not_call);\n socket.on('error', common.mustCall(function(err) {\n-  assert.strictEqual(err.code, 'ENOTFOUND');\n+  assert.strictEqual(err.code, errCode);\n }));\n socket.on('lookup', function(err, ip, type) {\n   assert(err instanceof Error);\n-  assert.strictEqual(err.code, 'ENOTFOUND');\n+  assert.strictEqual(err.code, errCode);\n   assert.strictEqual(ip, undefined);\n   assert.strictEqual(type, undefined);\n });"
        },
        {
            "sha": "72a65d32a610bfd8234ce2f1d49828ab74e9bb7f",
            "filename": "test/parallel/test-postmortem-metadata.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-postmortem-metadata.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-postmortem-metadata.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-postmortem-metadata.js?ref=ef0e92eb827cad86c327ad0b528fa6960e2060e0",
            "patch": "@@ -12,6 +12,9 @@ const args = [process.execPath];\n if (common.isAIX)\n   args.unshift('-Xany', '-B');\n \n+if (common.isOpenBSD)\n+  common.skip('no v8 debug symbols on OpenBSD');\n+\n const nm = spawnSync('nm', args);\n \n if (nm.error && nm.error.errno === 'ENOENT')"
        },
        {
            "sha": "1ab6bff6a30848ce2b31a0abd6037a632a8eed09",
            "filename": "test/parallel/test-setproctitle.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-setproctitle.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fparallel%2Ftest-setproctitle.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-setproctitle.js?ref=ef0e92eb827cad86c327ad0b528fa6960e2060e0",
            "patch": "@@ -34,7 +34,7 @@ exec(cmd, common.mustCall((error, stdout, stderr) => {\n   assert.strictEqual(stderr, '');\n \n   // freebsd always add ' (procname)' to the process title\n-  if (common.isFreeBSD)\n+  if (common.isFreeBSD || common.isOpenBSD)\n     title += ` (${path.basename(process.execPath)})`;\n \n   // omitting trailing whitespace and \\n"
        },
        {
            "sha": "7bc8428fac59398a07dd43ea00fecbe4c4a1484a",
            "filename": "test/sequential/test-module-loading.js",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fsequential%2Ftest-module-loading.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0e92eb827cad86c327ad0b528fa6960e2060e0/test%2Fsequential%2Ftest-module-loading.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-module-loading.js?ref=ef0e92eb827cad86c327ad0b528fa6960e2060e0",
            "patch": "@@ -20,7 +20,7 @@\n // USE OR OTHER DEALINGS IN THE SOFTWARE.\n \n 'use strict';\n-require('../common');\n+const common = require('../common');\n const assert = require('assert');\n const path = require('path');\n const fs = require('fs');\n@@ -189,15 +189,21 @@ try {\n     require(`${loadOrder}file3`);\n   } catch (e) {\n     // Not a real .node module, but we know we require'd the right thing.\n-    assert.ok(/file3\\.node/.test(e.message.replace(backslash, '/')));\n+    if (common.isOpenBSD) // OpenBSD errors with non-ELF object error\n+      assert.ok(/File not an ELF object/.test(e.message.replace(backslash, '/')));\n+    else\n+      assert.ok(/file3\\.node/.test(e.message.replace(backslash, '/')));\n   }\n   assert.strictEqual(require(`${loadOrder}file4`).file4, 'file4.reg', msg);\n   assert.strictEqual(require(`${loadOrder}file5`).file5, 'file5.reg2', msg);\n   assert.strictEqual(require(`${loadOrder}file6`).file6, 'file6/index.js', msg);\n   try {\n     require(`${loadOrder}file7`);\n   } catch (e) {\n-    assert.ok(/file7\\/index\\.node/.test(e.message.replace(backslash, '/')));\n+    if (common.isOpenBSD)\n+      assert.ok(/File not an ELF object/.test(e.message.replace(backslash, '/')));\n+    else\n+      assert.ok(/file7\\/index\\.node/.test(e.message.replace(backslash, '/')));\n   }\n   assert.strictEqual(require(`${loadOrder}file8`).file8, 'file8/index.reg',\n                      msg);"
        }
    ],
    "stats": {
        "total": 49,
        "additions": 37,
        "deletions": 12
    }
}