{
    "author": "mcollina",
    "message": "stream: make _read() be called indefinitely if the user wants so\n\nFixes: https://github.com/nodejs/node/issues/26097\n\nPR-URL: https://github.com/nodejs/node/pull/26135\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "cd302d70ddd0d1c249a7242ef7eb1b90bf8eb0de",
    "files": [
        {
            "sha": "1fe5e0573d15a9ea705514293698b0d07648bec0",
            "filename": "lib/_stream_readable.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/cd302d70ddd0d1c249a7242ef7eb1b90bf8eb0de/lib%2F_stream_readable.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd302d70ddd0d1c249a7242ef7eb1b90bf8eb0de/lib%2F_stream_readable.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_stream_readable.js?ref=cd302d70ddd0d1c249a7242ef7eb1b90bf8eb0de",
            "patch": "@@ -495,6 +495,7 @@ Readable.prototype.read = function(n) {\n };\n \n function onEofChunk(stream, state) {\n+  debug('onEofChunk');\n   if (state.ended) return;\n   if (state.decoder) {\n     var chunk = state.decoder.end();\n@@ -525,6 +526,7 @@ function onEofChunk(stream, state) {\n // a nextTick recursion warning, but that's not so bad.\n function emitReadable(stream) {\n   var state = stream._readableState;\n+  debug('emitReadable', state.needReadable, state.emittedReadable);\n   state.needReadable = false;\n   if (!state.emittedReadable) {\n     debug('emitReadable', state.flowing);\n@@ -538,6 +540,7 @@ function emitReadable_(stream) {\n   debug('emitReadable_', state.destroyed, state.length, state.ended);\n   if (!state.destroyed && (state.length || state.ended)) {\n     stream.emit('readable');\n+    state.emittedReadable = false;\n   }\n \n   // The stream needs another readable event if"
        },
        {
            "sha": "3df3e39a73ec363854b3f38222a5950bf3fccaaa",
            "filename": "test/parallel/test-stream-readable-infinite-read.js",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/nodejs/node/blob/cd302d70ddd0d1c249a7242ef7eb1b90bf8eb0de/test%2Fparallel%2Ftest-stream-readable-infinite-read.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd302d70ddd0d1c249a7242ef7eb1b90bf8eb0de/test%2Fparallel%2Ftest-stream-readable-infinite-read.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-readable-infinite-read.js?ref=cd302d70ddd0d1c249a7242ef7eb1b90bf8eb0de",
            "patch": "@@ -0,0 +1,32 @@\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+const { Readable } = require('stream');\n+\n+const buf = Buffer.alloc(8192);\n+\n+const readable = new Readable({\n+  read: common.mustCall(function() {\n+    this.push(buf);\n+  }, 31)\n+});\n+\n+let i = 0;\n+\n+readable.on('readable', common.mustCall(function() {\n+  if (i++ === 10) {\n+    // We will just terminate now.\n+    process.removeAllListeners('readable');\n+    return;\n+  }\n+\n+  const data = readable.read();\n+  // TODO(mcollina): there is something odd in the highWaterMark logic\n+  // investigate.\n+  if (i === 1) {\n+    assert.strictEqual(data.length, 8192 * 2);\n+  } else {\n+    assert.strictEqual(data.length, 8192 * 3);\n+  }\n+}, 11));"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 35,
        "deletions": 0
    }
}