{
    "author": "ronag",
    "message": "http: always emit close on req and res\n\nPR-URL: https://github.com/nodejs/node/pull/20611\nFixes: https://github.com/nodejs/node/issues/20600\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "f22c7c10ca0c8c7a10057de71bc423bf8b633b88",
    "files": [
        {
            "sha": "928b57b371968444e1d26c4b228264ffb8bb91b9",
            "filename": "lib/_http_server.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f22c7c10ca0c8c7a10057de71bc423bf8b633b88/lib%2F_http_server.js",
            "raw_url": "https://github.com/nodejs/node/raw/f22c7c10ca0c8c7a10057de71bc423bf8b633b88/lib%2F_http_server.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_server.js?ref=f22c7c10ca0c8c7a10057de71bc423bf8b633b88",
            "patch": "@@ -561,6 +561,8 @@ function resOnFinish(req, res, socket, state, server) {\n     req._dump();\n \n   res.detachSocket(socket);\n+  req.emit('close');\n+  res.emit('close');\n \n   if (res._last) {\n     if (typeof socket.destroySoon === 'function') {"
        },
        {
            "sha": "240134cb5d09024e95b247ff9225c63228208eab",
            "filename": "test/parallel/test-http-req-res-close.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/f22c7c10ca0c8c7a10057de71bc423bf8b633b88/test%2Fparallel%2Ftest-http-req-res-close.js",
            "raw_url": "https://github.com/nodejs/node/raw/f22c7c10ca0c8c7a10057de71bc423bf8b633b88/test%2Fparallel%2Ftest-http-req-res-close.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-req-res-close.js?ref=f22c7c10ca0c8c7a10057de71bc423bf8b633b88",
            "patch": "@@ -0,0 +1,16 @@\n+'use strict';\n+\n+const common = require('../common');\n+const http = require('http');\n+\n+const server = http.Server(common.mustCall((req, res) => {\n+  res.end();\n+  res.on('finish', common.mustCall());\n+  res.on('close', common.mustCall());\n+  req.on('close', common.mustCall());\n+  res.socket.on('close', () => server.close());\n+}));\n+\n+server.listen(0, common.mustCall(() => {\n+  http.get({ port: server.address().port }, common.mustCall());\n+}));"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 18,
        "deletions": 0
    }
}