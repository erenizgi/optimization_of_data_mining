{
    "author": "vsemozhetbyt",
    "message": "test: modernize and correct test-doctool-html.js\n\nPR-URL: https://github.com/nodejs/node/pull/20676\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "fb939844454818055434b0635d1482d737662415",
    "files": [
        {
            "sha": "185faa46f7188627c231ea210f29b13286e04d6c",
            "filename": "test/doctool/test-doctool-html.js",
            "status": "modified",
            "additions": 25,
            "deletions": 34,
            "changes": 59,
            "blob_url": "https://github.com/nodejs/node/blob/fb939844454818055434b0635d1482d737662415/test%2Fdoctool%2Ftest-doctool-html.js",
            "raw_url": "https://github.com/nodejs/node/raw/fb939844454818055434b0635d1482d737662415/test%2Fdoctool%2Ftest-doctool-html.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fdoctool%2Ftest-doctool-html.js?ref=fb939844454818055434b0635d1482d737662415",
            "patch": "@@ -9,16 +9,16 @@ try {\n }\n \n const assert = require('assert');\n-const fs = require('fs');\n+const { readFile } = require('fs');\n const fixtures = require('../common/fixtures');\n const processIncludes = require('../../tools/doc/preprocess.js');\n-const html = require('../../tools/doc/html.js');\n+const toHTML = require('../../tools/doc/html.js');\n \n // Test data is a list of objects with two properties.\n // The file property is the file path.\n-// The html property is some html which will be generated by the doctool.\n-// This html will be stripped of all whitespace because we don't currently\n-// have an html parser.\n+// The html property is some HTML which will be generated by the doctool.\n+// This HTML will be stripped of all whitespace because we don't currently\n+// have an HTML parser.\n const testData = [\n   {\n     file: fixtures.path('sample_document.md'),\n@@ -32,8 +32,7 @@ const testData = [\n       'id=\"foo_class_method_buffer_from_array\">#</a> </span> </h3>' +\n       '<ul><li><code>array</code><a ' +\n       'href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/' +\n-      'Reference/Global_Objects/Array\" class=\"type\">&lt;Array&gt;</a></li>' +\n-      '</ul>'\n+      'Reference/Global_Objects/Array\" class=\"type\">&lt;Array&gt;</a></li></ul>'\n   },\n   {\n     file: fixtures.path('doc_with_yaml.md'),\n@@ -45,42 +44,34 @@ const testData = [\n       '<div class=\"api_metadata\"><span>Added in: v1.0.0</span></div> ' +\n       '<p>Describe <code>Foobar</code> in more detail here.</p>' +\n       '<h2>Foobar II<span><a class=\"mark\" href=\"#foo_foobar_ii\" ' +\n-      'id=\"foo_foobar_ii\">#</a></span></h2>' +\n-      '<div class=\"api_metadata\">' +\n+      'id=\"foo_foobar_ii\">#</a></span></h2><div class=\"api_metadata\">' +\n       '<details class=\"changelog\"><summary>History</summary>' +\n       '<table><tr><th>Version</th><th>Changes</th></tr>' +\n       '<tr><td>v5.3.0, v4.2.0</td>' +\n-      '<td><p><span>Added in: v5.3.0, v4.2.0</span></p>' +\n-      '</td></tr>' +\n+      '<td><p><span>Added in: v5.3.0, v4.2.0</span></p></td></tr>' +\n       '<tr><td>v4.2.0</td><td><p>The <code>error</code> parameter can now be' +\n-      'an arrow function.</p></td></tr></table></details>' +\n-      '</div> ' +\n+      'an arrow function.</p></td></tr></table></details></div> ' +\n       '<p>Describe <code>Foobar II</code> in more detail here.' +\n       '<a href=\"http://man7.org/linux/man-pages/man1/fg.1.html\">fg(1)</a></p>' +\n       '<h2>Deprecated thingy<span><a class=\"mark\" ' +\n       'href=\"#foo_deprecated_thingy\" id=\"foo_deprecated_thingy\">#</a>' +\n-      '</span></h2>' +\n-      '<div class=\"api_metadata\"><span>Added in: v1.0.0</span>' +\n+      '</span></h2><div class=\"api_metadata\"><span>Added in: v1.0.0</span>' +\n       '<span>Deprecated since: v2.0.0</span></div><p>Describe ' +\n       '<code>Deprecated thingy</code> in more detail here.' +\n       '<a href=\"http://man7.org/linux/man-pages/man1/fg.1p.html\">fg(1p)</a>' +\n-      '</p>' +\n-      '<h2>Something<span><a class=\"mark\" href=\"#foo_something\" ' +\n+      '</p><h2>Something<span><a class=\"mark\" href=\"#foo_something\" ' +\n       'id=\"foo_something\">#</a></span></h2> ' +\n       '<!-- This is not a metadata comment --> ' +\n-      '<p>Describe <code>Something</code> in more detail here. ' +\n-      '</p>'\n+      '<p>Describe <code>Something</code> in more detail here. </p>'\n   },\n   {\n     file: fixtures.path('doc_with_includes.md'),\n     html: '<!-- [start-include:doc_inc_1.md] -->' +\n     '<p>Look <a href=\"doc_inc_2.html#doc_inc_2_foobar\">here</a>!</p>' +\n-    '<!-- [end-include:doc_inc_1.md] -->' +\n-    '<!-- [start-include:doc_inc_2.md] -->' +\n+    '<!-- [end-include:doc_inc_1.md] --><!-- [start-include:doc_inc_2.md] -->' +\n     '<h1>foobar<span><a class=\"mark\" href=\"#doc_inc_2_foobar\" ' +\n     'id=\"doc_inc_2_foobar\">#</a></span></h1>' +\n-    '<p>I exist and am being linked to.</p>' +\n-    '<!-- [end-include:doc_inc_2.md] -->'\n+    '<p>I exist and am being linked to.</p><!-- [end-include:doc_inc_2.md] -->'\n   },\n   {\n     file: fixtures.path('sample_document.md'),\n@@ -92,34 +83,34 @@ const testData = [\n \n const spaces = /\\s/g;\n \n-testData.forEach((item) => {\n-  // Normalize expected data by stripping whitespace\n-  const expected = item.html.replace(spaces, '');\n-  const includeAnalytics = typeof item.analyticsId !== 'undefined';\n+testData.forEach(({ file, html, analyticsId }) => {\n+  // Normalize expected data by stripping whitespace.\n+  const expected = html.replace(spaces, '');\n+  const includeAnalytics = typeof analyticsId !== 'undefined';\n \n-  fs.readFile(item.file, 'utf8', common.mustCall((err, input) => {\n+  readFile(file, 'utf8', common.mustCall((err, input) => {\n     assert.ifError(err);\n-    processIncludes(item.file, input, common.mustCall((err, preprocessed) => {\n+    processIncludes(file, input, common.mustCall((err, preprocessed) => {\n       assert.ifError(err);\n \n-      html(\n+      toHTML(\n         {\n           input: preprocessed,\n           filename: 'foo',\n           nodeVersion: process.version,\n-          analytics: item.analyticsId,\n+          analytics: analyticsId,\n         },\n         common.mustCall((err, output) => {\n           assert.ifError(err);\n \n           const actual = output.replace(spaces, '');\n-          const scriptDomain = 'google-analytics.com';\n           // Assert that the input stripped of all whitespace contains the\n-          // expected list\n+          // expected markup.\n           assert(actual.includes(expected));\n \n           // Testing the insertion of Google Analytics script when\n-          // an analytics id is provided. Should not be present by default\n+          // an analytics id is provided. Should not be present by default.\n+          const scriptDomain = 'google-analytics.com';\n           if (includeAnalytics) {\n             assert(actual.includes(scriptDomain),\n                    `Google Analytics script was not present in \"${actual}\"`);"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 25,
        "deletions": 34
    }
}