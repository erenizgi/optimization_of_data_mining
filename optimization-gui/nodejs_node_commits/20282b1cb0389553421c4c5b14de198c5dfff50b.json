{
    "author": "addaleax",
    "message": "src: use more explicit return type in Sign::SignFinal()\n\nUsing the non-indexed variant of `std::get<>` broke Travis CI.\nAlso, this allows us to be a bit more concise when returning\nfrom `SignFinal()` due to some error condition.\n\nRefs: https://github.com/nodejs/node/pull/23427\n\nPR-URL: https://github.com/nodejs/node/pull/23779\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "20282b1cb0389553421c4c5b14de198c5dfff50b",
    "files": [
        {
            "sha": "ec7d4f2bb5be3d4142a2fc9cce280f1c40cf57ed",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 12,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/20282b1cb0389553421c4c5b14de198c5dfff50b/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/20282b1cb0389553421c4c5b14de198c5dfff50b/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=20282b1cb0389553421c4c5b14de198c5dfff50b",
            "patch": "@@ -3562,22 +3562,20 @@ static MallocedBuffer<unsigned char> Node_SignFinal(EVPMDPointer&& mdctx,\n   return MallocedBuffer<unsigned char>();\n }\n \n-std::pair<SignBase::Error, MallocedBuffer<unsigned char>> Sign::SignFinal(\n+Sign::SignResult Sign::SignFinal(\n     const char* key_pem,\n     int key_pem_len,\n     const char* passphrase,\n     int padding,\n     int salt_len) {\n-  MallocedBuffer<unsigned char> buffer;\n-\n   if (!mdctx_)\n-    return std::make_pair(kSignNotInitialised, std::move(buffer));\n+    return SignResult(kSignNotInitialised);\n \n   EVPMDPointer mdctx = std::move(mdctx_);\n \n   BIOPointer bp(BIO_new_mem_buf(const_cast<char*>(key_pem), key_pem_len));\n   if (!bp)\n-    return std::make_pair(kSignPrivateKey, std::move(buffer));\n+    return SignResult(kSignPrivateKey);\n \n   EVPKeyPointer pkey(PEM_read_bio_PrivateKey(bp.get(),\n                                              nullptr,\n@@ -3588,7 +3586,7 @@ std::pair<SignBase::Error, MallocedBuffer<unsigned char>> Sign::SignFinal(\n   // without `pkey` being set to nullptr;\n   // cf. the test of `test_bad_rsa_privkey.pem` for an example.\n   if (!pkey || 0 != ERR_peek_error())\n-    return std::make_pair(kSignPrivateKey, std::move(buffer));\n+    return SignResult(kSignPrivateKey);\n \n #ifdef NODE_FIPS_MODE\n   /* Validate DSA2 parameters from FIPS 186-4 */\n@@ -3612,9 +3610,10 @@ std::pair<SignBase::Error, MallocedBuffer<unsigned char>> Sign::SignFinal(\n   }\n #endif  // NODE_FIPS_MODE\n \n-  buffer = Node_SignFinal(std::move(mdctx), pkey, padding, salt_len);\n+  MallocedBuffer<unsigned char> buffer =\n+      Node_SignFinal(std::move(mdctx), pkey, padding, salt_len);\n   Error error = buffer.is_empty() ? kSignPrivateKey : kSignOk;\n-  return std::make_pair(error, std::move(buffer));\n+  return SignResult(error, std::move(buffer));\n }\n \n \n@@ -3639,18 +3638,18 @@ void Sign::SignFinal(const FunctionCallbackInfo<Value>& args) {\n \n   ClearErrorOnReturn clear_error_on_return;\n \n-  std::pair<Error, MallocedBuffer<unsigned char>> ret = sign->SignFinal(\n+  SignResult ret = sign->SignFinal(\n       buf,\n       buf_len,\n       len >= 2 && !args[1]->IsNull() ? *passphrase : nullptr,\n       padding,\n       salt_len);\n \n-  if (std::get<Error>(ret) != kSignOk)\n-    return sign->CheckThrow(std::get<Error>(ret));\n+  if (ret.error != kSignOk)\n+    return sign->CheckThrow(ret.error);\n \n   MallocedBuffer<unsigned char> sig =\n-      std::move(std::get<MallocedBuffer<unsigned char>>(ret));\n+      std::move(ret.signature);\n \n   Local<Object> rc =\n       Buffer::New(env, reinterpret_cast<char*>(sig.release()), sig.size)"
        },
        {
            "sha": "0c26c1f6ff1d09fef2bf41b66ec83ecd52d9c0b8",
            "filename": "src/node_crypto.h",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/20282b1cb0389553421c4c5b14de198c5dfff50b/src%2Fnode_crypto.h",
            "raw_url": "https://github.com/nodejs/node/raw/20282b1cb0389553421c4c5b14de198c5dfff50b/src%2Fnode_crypto.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.h?ref=20282b1cb0389553421c4c5b14de198c5dfff50b",
            "patch": "@@ -518,7 +518,17 @@ class Sign : public SignBase {\n  public:\n   static void Initialize(Environment* env, v8::Local<v8::Object> target);\n \n-  std::pair<Error, MallocedBuffer<unsigned char>> SignFinal(\n+  struct SignResult {\n+    Error error;\n+    MallocedBuffer<unsigned char> signature;\n+\n+    explicit SignResult(\n+        Error err,\n+        MallocedBuffer<unsigned char>&& sig = MallocedBuffer<unsigned char>())\n+      : error(err), signature(std::move(sig)) {}\n+  };\n+\n+  SignResult SignFinal(\n       const char* key_pem,\n       int key_pem_len,\n       const char* passphrase,"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 22,
        "deletions": 13
    }
}