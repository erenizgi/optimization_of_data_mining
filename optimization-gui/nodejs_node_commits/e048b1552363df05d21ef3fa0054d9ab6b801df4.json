{
    "author": "juggernaut451",
    "message": "test: refactor parallel/test-tls-delayed-attach\n\ntest: refactor parallel/test-tls-delayed-attach\n\nAdded description to the test, replace function with arrow function and\nimplemented common.mustCall\n\nPR-URL: https://github.com/nodejs/node/pull/19421\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "e048b1552363df05d21ef3fa0054d9ab6b801df4",
    "files": [
        {
            "sha": "b756db2d67ca5f7cadd47501b0c5810ac0ffebcd",
            "filename": "test/parallel/test-tls-delayed-attach.js",
            "status": "modified",
            "additions": 15,
            "deletions": 9,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/e048b1552363df05d21ef3fa0054d9ab6b801df4/test%2Fparallel%2Ftest-tls-delayed-attach.js",
            "raw_url": "https://github.com/nodejs/node/raw/e048b1552363df05d21ef3fa0054d9ab6b801df4/test%2Fparallel%2Ftest-tls-delayed-attach.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-delayed-attach.js?ref=e048b1552363df05d21ef3fa0054d9ab6b801df4",
            "patch": "@@ -24,6 +24,12 @@ const common = require('../common');\n if (!common.hasCrypto)\n   common.skip('missing crypto');\n \n+// This test tries to confirm that a TLS Socket will work as expected even if it\n+// is created after the original socket has received some data.\n+//\n+// Ref: https://github.com/nodejs/node-v0.x-archive/issues/6940\n+// Ref: https://github.com/nodejs/node-v0.x-archive/pull/6950\n+\n const fixtures = require('../common/fixtures');\n const assert = require('assert');\n const tls = require('tls');\n@@ -37,30 +43,30 @@ const options = {\n   cert: fixtures.readKey('agent1-cert.pem')\n };\n \n-const server = net.createServer(function(c) {\n+const server = net.createServer(common.mustCall((c) => {\n   setTimeout(function() {\n     const s = new tls.TLSSocket(c, {\n       isServer: true,\n       secureContext: tls.createSecureContext(options)\n     });\n \n-    s.on('data', function(chunk) {\n+    s.on('data', (chunk) => {\n       received += chunk;\n     });\n \n-    s.on('end', function() {\n+    s.on('end', common.mustCall(() => {\n       server.close();\n       s.destroy();\n-    });\n+    }));\n   }, 200);\n-}).listen(0, function() {\n-  const c = tls.connect(this.address().port, {\n+})).listen(0, common.mustCall(() => {\n+  const c = tls.connect(server.address().port, {\n     rejectUnauthorized: false\n-  }, function() {\n+  }, () => {\n     c.end(sent);\n   });\n-});\n+}));\n \n-process.on('exit', function() {\n+process.on('exit', () => {\n   assert.strictEqual(received, sent);\n });"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 15,
        "deletions": 9
    }
}