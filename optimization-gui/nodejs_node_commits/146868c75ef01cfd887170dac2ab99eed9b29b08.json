{
    "author": "richardlau",
    "message": "test: increase coverage of node_report_module.cc\n\nPR-URL: https://github.com/nodejs/node/pull/26116\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Beth Griggs <Bethany.Griggs@uk.ibm.com>",
    "sha": "146868c75ef01cfd887170dac2ab99eed9b29b08",
    "files": [
        {
            "sha": "8603c0a7c31b680691b28ac6d9f137779f30eeb6",
            "filename": "test/node-report/test-api-trigger-with-filename.js",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/146868c75ef01cfd887170dac2ab99eed9b29b08/test%2Fnode-report%2Ftest-api-trigger-with-filename.js",
            "raw_url": "https://github.com/nodejs/node/raw/146868c75ef01cfd887170dac2ab99eed9b29b08/test%2Fnode-report%2Ftest-api-trigger-with-filename.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fnode-report%2Ftest-api-trigger-with-filename.js?ref=146868c75ef01cfd887170dac2ab99eed9b29b08",
            "patch": "@@ -0,0 +1,29 @@\n+'use strict';\n+\n+// Tests when a report is triggered with a given filename.\n+const common = require('../common');\n+common.skipIfReportDisabled();\n+const filename = 'myreport.json';\n+if (process.argv[2] === 'child') {\n+  process.report.triggerReport(filename);\n+} else {\n+  const helper = require('../common/report.js');\n+  const spawn = require('child_process').spawn;\n+  const assert = require('assert');\n+  const { join } = require('path');\n+  const tmpdir = require('../common/tmpdir');\n+  tmpdir.refresh();\n+\n+  const child = spawn(process.execPath,\n+                      ['--experimental-report', __filename, 'child'],\n+                      { cwd: tmpdir.path });\n+  child.on('exit', common.mustCall((code) => {\n+    const process_msg = 'Process exited unexpectedly';\n+    assert.strictEqual(code, 0, process_msg + ':' + code);\n+    const reports = helper.findReports(child.pid, tmpdir.path);\n+    assert.strictEqual(reports.length, 0,\n+                       `Found unexpected report ${reports[0]}`);\n+    const report = join(tmpdir.path, filename);\n+    helper.validate(report);\n+  }));\n+}"
        },
        {
            "sha": "a236fa1305bf46e0bf67b71a0c370acc764cf320",
            "filename": "test/node-report/test-api-trigger-with-options.js",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/146868c75ef01cfd887170dac2ab99eed9b29b08/test%2Fnode-report%2Ftest-api-trigger-with-options.js",
            "raw_url": "https://github.com/nodejs/node/raw/146868c75ef01cfd887170dac2ab99eed9b29b08/test%2Fnode-report%2Ftest-api-trigger-with-options.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fnode-report%2Ftest-api-trigger-with-options.js?ref=146868c75ef01cfd887170dac2ab99eed9b29b08",
            "patch": "@@ -0,0 +1,30 @@\n+'use strict';\n+\n+// Tests when a report is triggered with options set.\n+const common = require('../common');\n+common.skipIfReportDisabled();\n+const filename = 'myreport.json';\n+if (process.argv[2] === 'child') {\n+  process.report.setOptions({ filename: filename });\n+  process.report.triggerReport();\n+} else {\n+  const helper = require('../common/report.js');\n+  const spawn = require('child_process').spawn;\n+  const assert = require('assert');\n+  const { join } = require('path');\n+  const tmpdir = require('../common/tmpdir');\n+  tmpdir.refresh();\n+\n+  const child = spawn(process.execPath,\n+                      ['--experimental-report', __filename, 'child'],\n+                      { cwd: tmpdir.path });\n+  child.on('exit', common.mustCall((code) => {\n+    const process_msg = 'Process exited unexpectedly';\n+    assert.strictEqual(code, 0, process_msg + ':' + code);\n+    const reports = helper.findReports(child.pid, tmpdir.path);\n+    assert.strictEqual(reports.length, 0,\n+                       `Found unexpected report ${reports[0]}`);\n+    const report = join(tmpdir.path, filename);\n+    helper.validate(report);\n+  }));\n+}"
        },
        {
            "sha": "f59b07d62a9f0798e8cdeb4fd50c8be777ecfb11",
            "filename": "test/node-report/test-diagnostic-report-verbose.js",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/146868c75ef01cfd887170dac2ab99eed9b29b08/test%2Fnode-report%2Ftest-diagnostic-report-verbose.js",
            "raw_url": "https://github.com/nodejs/node/raw/146868c75ef01cfd887170dac2ab99eed9b29b08/test%2Fnode-report%2Ftest-diagnostic-report-verbose.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fnode-report%2Ftest-diagnostic-report-verbose.js?ref=146868c75ef01cfd887170dac2ab99eed9b29b08",
            "patch": "@@ -0,0 +1,43 @@\n+'use strict';\n+\n+// Tests --diagnostic-report-verbose option.\n+const common = require('../common');\n+common.skipIfReportDisabled();\n+if (process.argv[2] === 'child') {\n+  // no-op\n+} else {\n+  const helper = require('../common/report.js');\n+  const spawn = require('child_process').spawn;\n+  const assert = require('assert');\n+  const tmpdir = require('../common/tmpdir');\n+  tmpdir.refresh();\n+\n+  const expected = [ 'report: initialization complete, event flags:',\n+                     'report_uncaught_exception: 0',\n+                     'report_on_signal: 0',\n+                     'report_on_fatalerror: 0',\n+                     'report_signal:',\n+                     'report_filename:',\n+                     'report_directory:',\n+                     'report_verbose: 1' ];\n+\n+  const child = spawn(process.execPath,\n+                      ['--experimental-report',\n+                       '--diagnostic-report-verbose',\n+                       __filename,\n+                       'child',\n+                      ],\n+                      { cwd: tmpdir.path });\n+  let stderr;\n+  child.stderr.on('data', (data) => stderr += data);\n+  child.on('exit', common.mustCall((code) => {\n+    const process_msg = 'Process exited unexpectedly';\n+    assert.strictEqual(code, 0, process_msg + ':' + code);\n+    const reports = helper.findReports(child.pid, tmpdir.path);\n+    assert.strictEqual(reports.length, 0,\n+                       `Found unexpected report ${reports[0]}`);\n+    for (const line of expected) {\n+      assert.ok(stderr.includes(line), `'${line}' not found in '${stderr}'`);\n+    }\n+  }));\n+}"
        }
    ],
    "stats": {
        "total": 102,
        "additions": 102,
        "deletions": 0
    }
}