{
    "author": "joyeecheung",
    "message": "test: use Worker scope in WPT\n\nPreviously, we use the Window scope by default in our WPT test\nrunner. When one of the test fails, the WPT harness would try to\nuse document.getElementsByTagName() etc. to display the failure,\nwhich is not going to work for us.\n\nThis patch switches the scope to DedicatedWorker and use our\nWorker implementation as a global - this does not test the Worker\nimplementation per se, just tells the WPT harness to pass the results\nback to us via the callbacks we installed and not try to access\na document.\n\nWe may still need to use a Window scope when we try to run\n.window.js tests in the future, but for now we only run .any.js\ntests so it's fine to use a worker scope by default.\n\nPR-URL: https://github.com/nodejs/node/pull/24410\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "2742f3869a540b01ed51ca91075af9215c13bd54",
    "files": [
        {
            "sha": "4f2f39c8e595d2aff3e05f9fea0b0b0e2a1fc579",
            "filename": "test/common/wpt.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/2742f3869a540b01ed51ca91075af9215c13bd54/test%2Fcommon%2Fwpt.js",
            "raw_url": "https://github.com/nodejs/node/raw/2742f3869a540b01ed51ca91075af9215c13bd54/test%2Fcommon%2Fwpt.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Fwpt.js?ref=2742f3869a540b01ed51ca91075af9215c13bd54",
            "patch": "@@ -280,7 +280,9 @@ class WPTRunner {\n     sandbox.self = sandbox;\n     // TODO(joyeecheung): we are not a window - work with the upstream to\n     // add a new scope for us.\n-    sandbox.document = {};  // Pretend we are Window\n+\n+    const { Worker } = require('worker_threads');\n+    sandbox.DedicatedWorker = Worker;  // Pretend we are a Worker\n     return context;\n   }\n "
        },
        {
            "sha": "15fb80fc962a63ee0ef588dd83e4896abd5ba104",
            "filename": "test/wpt/test-whatwg-console.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2742f3869a540b01ed51ca91075af9215c13bd54/test%2Fwpt%2Ftest-whatwg-console.js",
            "raw_url": "https://github.com/nodejs/node/raw/2742f3869a540b01ed51ca91075af9215c13bd54/test%2Fwpt%2Ftest-whatwg-console.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fwpt%2Ftest-whatwg-console.js?ref=2742f3869a540b01ed51ca91075af9215c13bd54",
            "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-// Flags: --expose-internals\n+// Flags: --expose-internals --experimental-worker\n \n require('../common');\n const { WPTRunner } = require('../common/wpt');"
        },
        {
            "sha": "fbbea2453203c32d4f542220e68af0eb6fe4b6b7",
            "filename": "test/wpt/test-whatwg-url.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2742f3869a540b01ed51ca91075af9215c13bd54/test%2Fwpt%2Ftest-whatwg-url.js",
            "raw_url": "https://github.com/nodejs/node/raw/2742f3869a540b01ed51ca91075af9215c13bd54/test%2Fwpt%2Ftest-whatwg-url.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fwpt%2Ftest-whatwg-url.js?ref=2742f3869a540b01ed51ca91075af9215c13bd54",
            "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-// Flags: --expose-internals\n+// Flags: --expose-internals --experimental-worker\n \n require('../common');\n const { WPTRunner } = require('../common/wpt');"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 5,
        "deletions": 3
    }
}