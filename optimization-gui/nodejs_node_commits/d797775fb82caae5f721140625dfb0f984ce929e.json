{
    "author": "shobhitchittora",
    "message": "tools: add fixer for prefer-assert-iferror.js\n\nPR-URL: https://github.com/nodejs/node/pull/16648\nRefs: https://github.com/nodejs/node/issues/16636\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Gibson Fahnestock <gibfahn@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "d797775fb82caae5f721140625dfb0f984ce929e",
    "files": [
        {
            "sha": "8a9723f4b21f6a995853e31a94c1e0bc73163b3a",
            "filename": "test/parallel/test-eslint-prefer-assert-iferror.js",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/d797775fb82caae5f721140625dfb0f984ce929e/test%2Fparallel%2Ftest-eslint-prefer-assert-iferror.js",
            "raw_url": "https://github.com/nodejs/node/raw/d797775fb82caae5f721140625dfb0f984ce929e/test%2Fparallel%2Ftest-eslint-prefer-assert-iferror.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-eslint-prefer-assert-iferror.js?ref=d797775fb82caae5f721140625dfb0f984ce929e",
            "patch": "@@ -14,12 +14,18 @@ new RuleTester().run('prefer-assert-iferror', rule, {\n   ],\n   invalid: [\n     {\n-      code: 'if (err) throw err;',\n-      errors: [{ message: 'Use assert.ifError(err) instead.' }]\n+      code: 'require(\"assert\");\\n' +\n+            'if (err) throw err;',\n+      errors: [{ message: 'Use assert.ifError(err) instead.' }],\n+      output: 'require(\"assert\");\\n' +\n+              'assert.ifError(err);'\n     },\n     {\n-      code: 'if (error) { throw error; }',\n-      errors: [{ message: 'Use assert.ifError(error) instead.' }]\n+      code: 'require(\"assert\");\\n' +\n+            'if (error) { throw error; }',\n+      errors: [{ message: 'Use assert.ifError(error) instead.' }],\n+      output: 'require(\"assert\");\\n' +\n+              'assert.ifError(error);'\n     }\n   ]\n });"
        },
        {
            "sha": "399ee7403a6c88d6c57b6455b8ef6d97395769c0",
            "filename": "tools/eslint-rules/prefer-assert-iferror.js",
            "status": "modified",
            "additions": 21,
            "deletions": 2,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/d797775fb82caae5f721140625dfb0f984ce929e/tools%2Feslint-rules%2Fprefer-assert-iferror.js",
            "raw_url": "https://github.com/nodejs/node/raw/d797775fb82caae5f721140625dfb0f984ce929e/tools%2Feslint-rules%2Fprefer-assert-iferror.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Feslint-rules%2Fprefer-assert-iferror.js?ref=d797775fb82caae5f721140625dfb0f984ce929e",
            "patch": "@@ -5,9 +5,12 @@\n \n 'use strict';\n \n+const utils = require('./rules-utils.js');\n+\n module.exports = {\n   create(context) {\n     const sourceCode = context.getSourceCode();\n+    var assertImported = false;\n \n     function hasSameTokens(nodeA, nodeB) {\n       const aTokens = sourceCode.getTokens(nodeA);\n@@ -20,8 +23,15 @@ module.exports = {\n         });\n     }\n \n+    function checkAssertNode(node) {\n+      if (utils.isRequired(node, ['assert'])) {\n+        assertImported = true;\n+      }\n+    }\n+\n     return {\n-      IfStatement(node) {\n+      'CallExpression': (node) => checkAssertNode(node),\n+      'IfStatement': (node) => {\n         const firstStatement = node.consequent.type === 'BlockStatement' ?\n           node.consequent.body[0] :\n           node.consequent;\n@@ -30,10 +40,19 @@ module.exports = {\n           firstStatement.type === 'ThrowStatement' &&\n           hasSameTokens(node.test, firstStatement.argument)\n         ) {\n+          const argument = sourceCode.getText(node.test);\n           context.report({\n             node: firstStatement,\n             message: 'Use assert.ifError({{argument}}) instead.',\n-            data: { argument: sourceCode.getText(node.test) }\n+            data: { argument },\n+            fix: (fixer) => {\n+              if (assertImported) {\n+                return fixer.replaceText(\n+                  node,\n+                  `assert.ifError(${argument});`\n+                );\n+              }\n+            }\n           });\n         }\n       }"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 31,
        "deletions": 6
    }
}