{
    "author": "addaleax",
    "message": "src: remove invalid casts in options parser\n\nFixes: https://github.com/nodejs/node/issues/26131\n\nPR-URL: https://github.com/nodejs/node/pull/26139\nReviewed-By: Yang Guo <yangguo@chromium.org>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>",
    "sha": "35e6070f143375ec61b8f0f14cb214e87a077171",
    "files": [
        {
            "sha": "052c847f7ebdc491b6c6b1bff47c33aa8f472412",
            "filename": "src/node_options-inl.h",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/35e6070f143375ec61b8f0f14cb214e87a077171/src%2Fnode_options-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/35e6070f143375ec61b8f0f14cb214e87a077171/src%2Fnode_options-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options-inl.h?ref=35e6070f143375ec61b8f0f14cb214e87a077171",
            "patch": "@@ -148,7 +148,7 @@ void OptionsParser<Options>::Implies(const std::string& from,\n   CHECK_NE(it, options_.end());\n   CHECK_EQ(it->second.type, kBoolean);\n   implications_.emplace(from, Implication {\n-    std::static_pointer_cast<OptionField<bool>>(it->second.field), true\n+    it->second.field, true\n   });\n }\n \n@@ -159,7 +159,7 @@ void OptionsParser<Options>::ImpliesNot(const std::string& from,\n   CHECK_NE(it, options_.end());\n   CHECK_EQ(it->second.type, kBoolean);\n   implications_.emplace(from, Implication {\n-    std::static_pointer_cast<OptionField<bool>>(it->second.field), false\n+    it->second.field, false\n   });\n }\n \n@@ -205,8 +205,7 @@ auto OptionsParser<Options>::Convert(\n     typename OptionsParser<ChildOptions>::Implication original,\n     ChildOptions* (Options::* get_child)()) {\n   return Implication {\n-    std::static_pointer_cast<OptionField<bool>>(\n-        Convert(original.target_field, get_child)),\n+    Convert(original.target_field, get_child),\n     original.target_value\n   };\n }\n@@ -378,8 +377,10 @@ void OptionsParser<Options>::Parse(\n \n     {\n       auto implications = implications_.equal_range(name);\n-      for (auto it = implications.first; it != implications.second; ++it)\n-        *it->second.target_field->Lookup(options) = it->second.target_value;\n+      for (auto it = implications.first; it != implications.second; ++it) {\n+        *it->second.target_field->template Lookup<bool>(options) =\n+            it->second.target_value;\n+      }\n     }\n \n     const OptionInfo& info = it->second;"
        },
        {
            "sha": "e9481e2de5da9e65e24fe85ca89f1f2fd7433a94",
            "filename": "src/node_options.h",
            "status": "modified",
            "additions": 6,
            "deletions": 12,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/35e6070f143375ec61b8f0f14cb214e87a077171/src%2Fnode_options.h",
            "raw_url": "https://github.com/nodejs/node/raw/35e6070f143375ec61b8f0f14cb214e87a077171/src%2Fnode_options.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.h?ref=35e6070f143375ec61b8f0f14cb214e87a077171",
            "patch": "@@ -326,23 +326,17 @@ class OptionsParser {\n    public:\n     virtual ~BaseOptionField() {}\n     virtual void* LookupImpl(Options* options) const = 0;\n-  };\n-\n-  // Represents a field of type T within `Options`.\n-  template <typename T>\n-  class OptionField : public BaseOptionField {\n-   public:\n-    typedef T Type;\n \n-    T* Lookup(Options* options) const {\n-      return static_cast<T*>(this->LookupImpl(options));\n+    template <typename T>\n+    inline T* Lookup(Options* options) const {\n+      return static_cast<T*>(LookupImpl(options));\n     }\n   };\n \n   // Represents a field of type T within `Options` that can be looked up\n   // as a C++ member field.\n   template <typename T>\n-  class SimpleOptionField : public OptionField<T> {\n+  class SimpleOptionField : public BaseOptionField {\n    public:\n     explicit SimpleOptionField(T Options::* field) : field_(field) {}\n     void* LookupImpl(Options* options) const override {\n@@ -356,7 +350,7 @@ class OptionsParser {\n   template <typename T>\n   inline T* Lookup(std::shared_ptr<BaseOptionField> field,\n                    Options* options) const {\n-    return std::static_pointer_cast<OptionField<T>>(field)->Lookup(options);\n+    return field->template Lookup<T>(options);\n   }\n \n   // An option consists of:\n@@ -373,7 +367,7 @@ class OptionsParser {\n   // An implied option is composed of the information on where to store a\n   // specific boolean value (if another specific option is encountered).\n   struct Implication {\n-    std::shared_ptr<OptionField<bool>> target_field;\n+    std::shared_ptr<BaseOptionField> target_field;\n     bool target_value;\n   };\n "
        }
    ],
    "stats": {
        "total": 31,
        "additions": 13,
        "deletions": 18
    }
}