{
    "author": "targos",
    "message": "tools,lib: forbid native Error constructors\n\nThis adds a rule that forbids the use of native Error constructors in\nthe `lib` directory. This is to encourage use of the `internal/errors`\nmechanism. The rule is disabled for errors that are not created with\nthe `internal/errors` module but are still assigned an error code.\n\nPR-URL: https://github.com/nodejs/node/pull/19373\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "6a9f0499688b7515f3156a1754583d7624b25989",
    "files": [
        {
            "sha": "cbadffded25aa0608c0392b188448baaf3f2a12d",
            "filename": ".eslintrc.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/.eslintrc.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/.eslintrc.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/.eslintrc.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -148,6 +148,7 @@ module.exports = {\n       }\n     ],\n     /* eslint-disable max-len, quotes */\n+    // If this list is modified, please copy the change to lib/.eslintrc.yaml\n     'no-restricted-syntax': [\n       'error',\n       {"
        },
        {
            "sha": "bf2251525eed64ef241f7e887e98946558bde649",
            "filename": "lib/.eslintrc.yaml",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2F.eslintrc.yaml",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2F.eslintrc.yaml",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F.eslintrc.yaml?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -1,4 +1,22 @@\n rules:\n+  no-restricted-syntax:\n+    # Config copied from .eslintrc.js\n+    - error\n+    - selector: \"CallExpression[callee.object.name='assert'][callee.property.name='doesNotThrow']\"\n+      message: \"Please replace `assert.doesNotThrow()` and add a comment next to the code instead.\"\n+    - selector: \"CallExpression[callee.object.name='assert'][callee.property.name='throws'][arguments.1.type='Literal']:not([arguments.1.regex])\"\n+      message: \"use a regular expression for second argument of assert.throws()\"\n+    - selector: \"CallExpression[callee.object.name='assert'][callee.property.name='throws'][arguments.length<2]\"\n+      message: \"assert.throws() must be invoked with at least two arguments.\"\n+    - selector: \"CallExpression[callee.name='setTimeout'][arguments.length<2]\"\n+      message: \"setTimeout() must be invoked with at least two arguments.\"\n+    - selector: \"CallExpression[callee.name='setInterval'][arguments.length<2]\"\n+      message: \"setInterval() must be invoked with at least 2 arguments.\"\n+    - selector: \"ThrowStatement > CallExpression[callee.name=/Error$/]\"\n+      message: \"Use new keyword when throwing an Error.\"\n+    # Config specific to lib\n+    - selector: \"NewExpression[callee.name=/Error$/]:not([callee.name=/^(AssertionError|NghttpError)$/])\"\n+      message: \"Use an error exported by the internal/errors module.\"\n   # Custom rules in tools/eslint-rules\n   node-core/require-buffer: error\n   node-core/buffer-constructor: error"
        },
        {
            "sha": "03c69a9306b6263000e1adc23ce9f05e0fed5ffc",
            "filename": "lib/_http_client.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2F_http_client.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2F_http_client.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_client.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -307,6 +307,7 @@ function emitAbortNT() {\n \n \n function createHangUpError() {\n+  // eslint-disable-next-line no-restricted-syntax\n   var error = new Error('socket hang up');\n   error.code = 'ECONNRESET';\n   return error;"
        },
        {
            "sha": "839aba555bec26214de6895f1cb843c26fa0b8c5",
            "filename": "lib/_tls_wrap.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2F_tls_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2F_tls_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_wrap.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -775,6 +775,7 @@ function onSocketClose(err) {\n   // Emit ECONNRESET\n   if (!this._controlReleased && !this[kErrorEmitted]) {\n     this[kErrorEmitted] = true;\n+    // eslint-disable-next-line no-restricted-syntax\n     const connReset = new Error('socket hang up');\n     connReset.code = 'ECONNRESET';\n     this._tlsOptions.server.emit('tlsClientError', connReset, this);\n@@ -1103,6 +1104,7 @@ function onConnectEnd() {\n   if (!this._hadError) {\n     const options = this[kConnectOptions];\n     this._hadError = true;\n+    // eslint-disable-next-line no-restricted-syntax\n     const error = new Error('Client network socket disconnected before ' +\n                             'secure TLS connection was established');\n     error.code = 'ECONNRESET';"
        },
        {
            "sha": "35132bfb03f508f7fcab2bf4eb7e8cc04a788062",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -216,6 +216,7 @@ function innerOk(fn, argLen, value, message) {\n     } else if (message == null) {\n       // Use the call as error message if possible.\n       // This does not work with e.g. the repl.\n+      // eslint-disable-next-line no-restricted-syntax\n       const err = new Error();\n       // Make sure the limit is set to 1. Otherwise it could fail (<= 0) or it\n       // does to much work."
        },
        {
            "sha": "c11762aa57cb357b1ffe912a28c11aa26b9e8c71",
            "filename": "lib/buffer.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fbuffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fbuffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fbuffer.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -1073,6 +1073,7 @@ if (process.binding('config').hasIntl) {\n       return result;\n \n     const code = icuErrName(result);\n+    // eslint-disable-next-line no-restricted-syntax\n     const err = new Error(`Unable to transcode Buffer [${code}]`);\n     err.code = code;\n     err.errno = result;"
        },
        {
            "sha": "2106bdc681979e758e5c4347a2035a642d9c35c8",
            "filename": "lib/child_process.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fchild_process.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fchild_process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fchild_process.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -278,6 +278,7 @@ exports.execFile = function(file /*, args, options, callback*/) {\n       cmd += ` ${args.join(' ')}`;\n \n     if (!ex) {\n+      // eslint-disable-next-line no-restricted-syntax\n       ex = new Error('Command failed: ' + cmd + '\\n' + stderr);\n       ex.killed = child.killed || killed;\n       ex.code = code < 0 ? getSystemErrorName(code) : code;\n@@ -588,6 +589,7 @@ function checkExecSyncError(ret, args, cmd) {\n     msg += cmd || args.join(' ');\n     if (ret.stderr && ret.stderr.length > 0)\n       msg += `\\n${ret.stderr.toString()}`;\n+    // eslint-disable-next-line no-restricted-syntax\n     err = new Error(msg);\n   }\n   if (err) {"
        },
        {
            "sha": "2515d996497218ef4188c09593e5e7e41196771d",
            "filename": "lib/domain.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fdomain.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fdomain.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fdomain.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -89,6 +89,7 @@ if (process.hasUncaughtExceptionCaptureCallback()) {\n }\n \n // Get the stack trace at the point where `domain` was required.\n+// eslint-disable-next-line no-restricted-syntax\n const domainRequireStack = new Error('require(`domain`) at this point').stack;\n \n const { setUncaughtExceptionCaptureCallback } = process;"
        },
        {
            "sha": "46761653a01a86b8705cdd44502da1b52d721d08",
            "filename": "lib/events.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fevents.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fevents.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fevents.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -240,6 +240,7 @@ function _addListener(target, type, listener, prepend) {\n       if (m && m > 0 && existing.length > m) {\n         existing.warned = true;\n         // No error code for this since it is a Warning\n+        // eslint-disable-next-line no-restricted-syntax\n         const w = new Error('Possible EventEmitter memory leak detected. ' +\n                             `${existing.length} ${String(type)} listeners ` +\n                             'added. Use emitter.setMaxListeners() to ' +"
        },
        {
            "sha": "fff82cd0e08b8007f92665ae76fa9160cad78397",
            "filename": "lib/internal/bootstrap/loaders.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Floaders.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -127,6 +127,7 @@\n       // Model the error off the internal/errors.js model, but\n       // do not use that module given that it could actually be\n       // the one causing the error if there's a bug in Node.js\n+      // eslint-disable-next-line no-restricted-syntax\n       const err = new Error(`No such built-in module: ${id}`);\n       err.code = 'ERR_UNKNOWN_BUILTIN_MODULE';\n       err.name = 'Error [ERR_UNKNOWN_BUILTIN_MODULE]';"
        },
        {
            "sha": "0df98bffae2bfe2458bf0068161c5f8fc93ee9b2",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -444,6 +444,7 @@ function uvException(ctx) {\n \n   // Pass the message to the constructor instead of setting it on the object\n   // to make sure it is the same as the one created in C++\n+  // eslint-disable-next-line no-restricted-syntax\n   const err = new Error(message);\n \n   for (const prop of Object.keys(ctx)) {\n@@ -482,6 +483,7 @@ function errnoException(err, syscall, original) {\n   const message = original ?\n     `${syscall} ${code} ${original}` : `${syscall} ${code}`;\n \n+  // eslint-disable-next-line no-restricted-syntax\n   const ex = new Error(message);\n   // TODO(joyeecheung): errno is supposed to err, like in uvException\n   ex.code = ex.errno = code;\n@@ -517,6 +519,7 @@ function exceptionWithHostPort(err, syscall, address, port, additional) {\n     details += ` - Local (${additional})`;\n   }\n \n+  // eslint-disable-next-line no-restricted-syntax\n   const ex = new Error(`${syscall} ${code}${details}`);\n   // TODO(joyeecheung): errno is supposed to err, like in uvException\n   ex.code = ex.errno = code;\n@@ -537,6 +540,7 @@ function exceptionWithHostPort(err, syscall, address, port, additional) {\n  * @returns {Error}\n  */\n function dnsException(err, syscall, hostname) {\n+  // eslint-disable-next-line no-restricted-syntax\n   const ex = new Error();\n   // FIXME(bnoordhuis) Remove this backwards compatibility nonsense and pass\n   // the true error to the user. ENOTFOUND is not even a proper POSIX error!"
        },
        {
            "sha": "470cf741e13cdc8447780ef67c4e605eabf09822",
            "filename": "lib/internal/modules/cjs/loader.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -566,6 +566,7 @@ Module._resolveFilename = function(request, parent, isMain, options) {\n   // look up the filename first, since that's the cache key.\n   var filename = Module._findPath(request, paths, isMain);\n   if (!filename) {\n+    // eslint-disable-next-line no-restricted-syntax\n     var err = new Error(`Cannot find module '${request}'`);\n     err.code = 'MODULE_NOT_FOUND';\n     throw err;"
        },
        {
            "sha": "6cc366d8b2b09af9d59a115e6a049ed5b9d91f44",
            "filename": "lib/internal/process/promises.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Fprocess%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Fprocess%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fpromises.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -30,6 +30,7 @@ function handledRejection(promise) {\n     if (promiseInfo.warned) {\n       const { uid } = promiseInfo;\n       // Generate the warning object early to get a good stack trace.\n+      // eslint-disable-next-line no-restricted-syntax\n       const warning = new Error('Promise rejection was handled ' +\n                                 `asynchronously (rejection id: ${uid})`);\n       warning.name = 'PromiseRejectionHandledWarning';\n@@ -53,6 +54,7 @@ function emitWarning(uid, reason) {\n     // ignored\n   }\n \n+  // eslint-disable-next-line no-restricted-syntax\n   const warning = new Error(\n     'Unhandled promise rejection. This error originated either by ' +\n     'throwing inside of an async function without a catch block, ' +"
        },
        {
            "sha": "8c0a503239b91ab3e9c145c519aeb2581d7e44cc",
            "filename": "lib/internal/process/warning.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Fprocess%2Fwarning.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Finternal%2Fprocess%2Fwarning.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fwarning.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -126,6 +126,7 @@ function setupProcessWarnings() {\n     if (type !== undefined && typeof type !== 'string')\n       throw new ERR_INVALID_ARG_TYPE('type', 'string');\n     if (warning === undefined || typeof warning === 'string') {\n+      // eslint-disable-next-line no-restricted-syntax\n       warning = new Error(warning);\n       warning.name = String(type || 'Warning');\n       if (code !== undefined) warning.code = code;"
        },
        {
            "sha": "c0b4db81e67839c6c6cb8b625b28e738f23245cc",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -385,6 +385,7 @@ function writeAfterFIN(chunk, encoding, cb) {\n     encoding = null;\n   }\n \n+  // eslint-disable-next-line no-restricted-syntax\n   var er = new Error('This socket has been ended by the other party');\n   er.code = 'EPIPE';\n   // TODO: defer error events consistently everywhere, not just the cb"
        },
        {
            "sha": "3660bd1a7d299b3e12856d97344172a620526bb2",
            "filename": "lib/zlib.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fzlib.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a9f0499688b7515f3156a1754583d7624b25989/lib%2Fzlib.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fzlib.js?ref=6a9f0499688b7515f3156a1754583d7624b25989",
            "patch": "@@ -144,6 +144,7 @@ function zlibOnError(message, errno) {\n   _close(self);\n   self._hadError = true;\n \n+  // eslint-disable-next-line no-restricted-syntax\n   const error = new Error(message);\n   error.errno = errno;\n   error.code = codes[errno];"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 39,
        "deletions": 0
    }
}