{
    "author": "alexkozy",
    "message": "deps: cherry-pick dbfcc48 from upstream V8\n\nOriginal commit message:\n```\n[inspector] added V8InspectorClient::resourceNameToUrl\n\nSome clients (see Node.js) use platform path as ScriptOrigin.\nReporting platform path in protocol makes using protocol much harder.\nThis CL introduced V8InspectorClient::resourceNameToUrl method that\nis called for any reported using protocol url.\nV8Inspector uses url internally as well so protocol client may generate\npattern for blackboxing with file urls only and does not need to build\ncomplicated regexp that covers files urls and platform paths on\ndifferent platforms.\n\nR=lushnikov@chromium.org\nTBR=yangguo@chromium.org\n\nBug: none\nChange-Id: Iff302e7441df922fa5d689fe510f5a9bfd470b9b\nReviewed-on: https://chromium-review.googlesource.com/1164624\nCommit-Queue: Aleksey Kozyatinskiy <kozyatinskiy@chromium.org>\nReviewed-by: Alexei Filippov <alph@chromium.org>\nCr-Commit-Position: refs/heads/master@{#55029}\n```\nRefs: https://github.com/v8/v8/commit/dbfcc48\nPR-URL: https://github.com/nodejs/node/pull/22251\nReviewed-By: Eugene Ostroukhov <eostroukhov@google.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "ab150160f8149063865729e52c6a7597133f9057",
    "files": [
        {
            "sha": "ae8f1935d98d8307ac19ddfc0aa58b3a2fbe3696",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -29,7 +29,7 @@\n \n     # Reset this number to 0 on major V8 upgrades.\n     # Increment by one for each non-official patch applied to deps/v8.\n-    'v8_embedder_string': '-node.10',\n+    'v8_embedder_string': '-node.11',\n \n     # Enable disassembler for `--print-code` v8 options\n     'v8_enable_disassembler': 1,"
        },
        {
            "sha": "ad04d01bd212583c3ae9c3911c5dcfd0ef07cd79",
            "filename": "deps/v8/include/v8-inspector.h",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Finclude%2Fv8-inspector.h",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Finclude%2Fv8-inspector.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8-inspector.h?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -215,6 +215,11 @@ class V8_EXPORT V8InspectorClient {\n   virtual bool canExecuteScripts(int contextGroupId) { return true; }\n \n   virtual void maxAsyncCallStackDepthChanged(int depth) {}\n+\n+  virtual std::unique_ptr<StringBuffer> resourceNameToUrl(\n+      const StringView& resourceName) {\n+    return nullptr;\n+  }\n };\n \n // These stack trace ids are intended to be passed between debuggers and be"
        },
        {
            "sha": "d9cb49b1d4d2ef354fd2478623a4046cd7c25354",
            "filename": "deps/v8/src/inspector/v8-debugger-agent-impl.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger-agent-impl.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger-agent-impl.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger-agent-impl.cc?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -1396,7 +1396,7 @@ void V8DebuggerAgentImpl::didParseSource(\n         protocol::StringUtil::parseJSON(inspected->auxData()));\n   }\n   bool isLiveEdit = script->isLiveEdit();\n-  bool hasSourceURL = script->hasSourceURL();\n+  bool hasSourceURLComment = script->hasSourceURLComment();\n   bool isModule = script->isModule();\n   String16 scriptId = script->scriptId();\n   String16 scriptURL = script->sourceURL();\n@@ -1416,7 +1416,8 @@ void V8DebuggerAgentImpl::didParseSource(\n   Maybe<protocol::DictionaryValue> executionContextAuxDataParam(\n       std::move(executionContextAuxData));\n   const bool* isLiveEditParam = isLiveEdit ? &isLiveEdit : nullptr;\n-  const bool* hasSourceURLParam = hasSourceURL ? &hasSourceURL : nullptr;\n+  const bool* hasSourceURLParam =\n+      hasSourceURLComment ? &hasSourceURLComment : nullptr;\n   const bool* isModuleParam = isModule ? &isModule : nullptr;\n   std::unique_ptr<V8StackTraceImpl> stack =\n       V8StackTraceImpl::capture(m_inspector->debugger(), contextGroupId, 1);"
        },
        {
            "sha": "d861265e148559a16e27b20b371c4d7bba364add",
            "filename": "deps/v8/src/inspector/v8-debugger-script.cc",
            "status": "modified",
            "additions": 23,
            "deletions": 15,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger-script.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger-script.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger-script.cc?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -6,6 +6,7 @@\n \n #include \"src/inspector/inspected-context.h\"\n #include \"src/inspector/string-util.h\"\n+#include \"src/inspector/v8-inspector-impl.h\"\n #include \"src/inspector/wasm-translation.h\"\n #include \"src/utils.h\"\n \n@@ -110,9 +111,9 @@ class ActualScript : public V8DebuggerScript {\n \n  public:\n   ActualScript(v8::Isolate* isolate, v8::Local<v8::debug::Script> script,\n-               bool isLiveEdit)\n+               bool isLiveEdit, V8InspectorClient* client)\n       : V8DebuggerScript(isolate, String16::fromInteger(script->Id()),\n-                         GetNameOrSourceUrl(script)),\n+                         GetScriptURL(script, client)),\n         m_isLiveEdit(isLiveEdit) {\n     Initialize(script);\n   }\n@@ -218,10 +219,18 @@ class ActualScript : public V8DebuggerScript {\n   }\n \n  private:\n-  String16 GetNameOrSourceUrl(v8::Local<v8::debug::Script> script) {\n-    v8::Local<v8::String> name;\n-    if (script->Name().ToLocal(&name) || script->SourceURL().ToLocal(&name))\n-      return toProtocolString(name);\n+  String16 GetScriptURL(v8::Local<v8::debug::Script> script,\n+                        V8InspectorClient* client) {\n+    v8::Local<v8::String> sourceURL;\n+    if (script->SourceURL().ToLocal(&sourceURL) && sourceURL->Length() > 0)\n+      return toProtocolString(sourceURL);\n+    v8::Local<v8::String> v8Name;\n+    if (script->Name().ToLocal(&v8Name) && v8Name->Length() > 0) {\n+      String16 name = toProtocolString(v8Name);\n+      std::unique_ptr<StringBuffer> url =\n+          client->resourceNameToUrl(toStringView(name));\n+      return url ? toString16(url->string()) : name;\n+    }\n     return String16();\n   }\n \n@@ -231,7 +240,8 @@ class ActualScript : public V8DebuggerScript {\n \n   void Initialize(v8::Local<v8::debug::Script> script) {\n     v8::Local<v8::String> tmp;\n-    if (script->SourceURL().ToLocal(&tmp)) m_sourceURL = toProtocolString(tmp);\n+    m_hasSourceURLComment =\n+        script->SourceURL().ToLocal(&tmp) && tmp->Length() > 0;\n     if (script->SourceMappingURL().ToLocal(&tmp))\n       m_sourceMappingURL = toProtocolString(tmp);\n     m_startLine = script->LineOffset();\n@@ -398,9 +408,9 @@ class WasmVirtualScript : public V8DebuggerScript {\n \n std::unique_ptr<V8DebuggerScript> V8DebuggerScript::Create(\n     v8::Isolate* isolate, v8::Local<v8::debug::Script> scriptObj,\n-    bool isLiveEdit) {\n+    bool isLiveEdit, V8InspectorClient* client) {\n   return std::unique_ptr<ActualScript>(\n-      new ActualScript(isolate, scriptObj, isLiveEdit));\n+      new ActualScript(isolate, scriptObj, isLiveEdit, client));\n }\n \n std::unique_ptr<V8DebuggerScript> V8DebuggerScript::CreateWasm(\n@@ -418,18 +428,16 @@ V8DebuggerScript::V8DebuggerScript(v8::Isolate* isolate, String16 id,\n \n V8DebuggerScript::~V8DebuggerScript() {}\n \n-const String16& V8DebuggerScript::sourceURL() const {\n-  return m_sourceURL.isEmpty() ? m_url : m_sourceURL;\n-}\n-\n void V8DebuggerScript::setSourceURL(const String16& sourceURL) {\n-  m_sourceURL = sourceURL;\n+  if (sourceURL.length() > 0) {\n+    m_hasSourceURLComment = true;\n+    m_url = sourceURL;\n+  }\n }\n \n bool V8DebuggerScript::setBreakpoint(const String16& condition,\n                                      v8::debug::Location* loc, int* id) const {\n   v8::HandleScope scope(m_isolate);\n   return script()->SetBreakpoint(toV8String(m_isolate, condition), loc, id);\n }\n-\n }  // namespace v8_inspector"
        },
        {
            "sha": "38e6448f48d8e8dcdde0935c516b45ddc7cf4db5",
            "filename": "deps/v8/src/inspector/v8-debugger-script.h",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger-script.h",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger-script.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger-script.h?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -40,13 +40,14 @@\n namespace v8_inspector {\n \n // Forward declaration.\n+class V8InspectorClient;\n class WasmTranslation;\n \n class V8DebuggerScript {\n  public:\n   static std::unique_ptr<V8DebuggerScript> Create(\n       v8::Isolate* isolate, v8::Local<v8::debug::Script> script,\n-      bool isLiveEdit);\n+      bool isLiveEdit, V8InspectorClient* client);\n   static std::unique_ptr<V8DebuggerScript> CreateWasm(\n       v8::Isolate* isolate, WasmTranslation* wasmTranslation,\n       v8::Local<v8::debug::WasmScript> underlyingScript, String16 id,\n@@ -55,9 +56,9 @@ class V8DebuggerScript {\n   virtual ~V8DebuggerScript();\n \n   const String16& scriptId() const { return m_id; }\n-  const String16& url() const { return m_url; }\n-  bool hasSourceURL() const { return !m_sourceURL.isEmpty(); }\n-  const String16& sourceURL() const;\n+  bool hasSourceURLComment() const { return m_hasSourceURLComment; }\n+  const String16& sourceURL() const { return m_url; }\n+\n   virtual const String16& sourceMappingURL() const = 0;\n   virtual const String16& source() const = 0;\n   virtual const String16& hash() const = 0;\n@@ -95,7 +96,7 @@ class V8DebuggerScript {\n \n   String16 m_id;\n   String16 m_url;\n-  String16 m_sourceURL;\n+  bool m_hasSourceURLComment = false;\n   int m_executionContextId = 0;\n \n   v8::Isolate* m_isolate;"
        },
        {
            "sha": "7d1f7cefd15db3f5482e27fa47880bb6227bb322",
            "filename": "deps/v8/src/inspector/v8-debugger.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger.cc?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -226,13 +226,15 @@ void V8Debugger::getCompiledScripts(\n     v8::Local<v8::debug::Script> script = scripts.Get(i);\n     if (!script->WasCompiled()) continue;\n     if (script->IsEmbedded()) {\n-      result.push_back(V8DebuggerScript::Create(m_isolate, script, false));\n+      result.push_back(V8DebuggerScript::Create(m_isolate, script, false,\n+                                                m_inspector->client()));\n       continue;\n     }\n     int contextId;\n     if (!script->ContextId().To(&contextId)) continue;\n     if (m_inspector->contextGroupId(contextId) != contextGroupId) continue;\n-    result.push_back(V8DebuggerScript::Create(m_isolate, script, false));\n+    result.push_back(V8DebuggerScript::Create(m_isolate, script, false,\n+                                              m_inspector->client()));\n   }\n }\n \n@@ -585,13 +587,14 @@ void V8Debugger::ScriptCompiled(v8::Local<v8::debug::Script> script,\n         });\n   } else if (m_ignoreScriptParsedEventsCounter == 0) {\n     v8::Isolate* isolate = m_isolate;\n+    V8InspectorClient* client = m_inspector->client();\n     m_inspector->forEachSession(\n         m_inspector->contextGroupId(contextId),\n-        [&isolate, &script, &has_compile_error,\n-         &is_live_edited](V8InspectorSessionImpl* session) {\n+        [&isolate, &script, &has_compile_error, &is_live_edited,\n+         &client](V8InspectorSessionImpl* session) {\n           if (!session->debuggerAgent()->enabled()) return;\n           session->debuggerAgent()->didParseSource(\n-              V8DebuggerScript::Create(isolate, script, is_live_edited),\n+              V8DebuggerScript::Create(isolate, script, is_live_edited, client),\n               !has_compile_error);\n         });\n   }"
        },
        {
            "sha": "f14815fdc4b031c640795ce10fb4b963310656be",
            "filename": "deps/v8/src/inspector/v8-profiler-agent-impl.cc",
            "status": "modified",
            "additions": 31,
            "deletions": 15,
            "changes": 46,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-profiler-agent-impl.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-profiler-agent-impl.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finspector%2Fv8-profiler-agent-impl.cc?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -7,6 +7,7 @@\n #include <vector>\n \n #include \"src/base/atomicops.h\"\n+#include \"src/debug/debug-interface.h\"\n #include \"src/flags.h\"  // TODO(jgruber): Remove include and DEPS entry.\n #include \"src/inspector/protocol/Protocol.h\"\n #include \"src/inspector/string-util.h\"\n@@ -31,6 +32,15 @@ static const char typeProfileStarted[] = \"typeProfileStarted\";\n \n namespace {\n \n+String16 resourceNameToUrl(V8InspectorImpl* inspector,\n+                           v8::Local<v8::String> v8Name) {\n+  String16 name = toProtocolString(v8Name);\n+  if (!inspector) return name;\n+  std::unique_ptr<StringBuffer> url =\n+      inspector->client()->resourceNameToUrl(toStringView(name));\n+  return url ? toString16(url->string()) : name;\n+}\n+\n std::unique_ptr<protocol::Array<protocol::Profiler::PositionTickInfo>>\n buildInspectorObjectForPositionTicks(const v8::CpuProfileNode* node) {\n   unsigned lineCount = node->GetHitLineCount();\n@@ -51,13 +61,14 @@ buildInspectorObjectForPositionTicks(const v8::CpuProfileNode* node) {\n }\n \n std::unique_ptr<protocol::Profiler::ProfileNode> buildInspectorObjectFor(\n-    v8::Isolate* isolate, const v8::CpuProfileNode* node) {\n+    V8InspectorImpl* inspector, const v8::CpuProfileNode* node) {\n+  v8::Isolate* isolate = inspector->isolate();\n   v8::HandleScope handleScope(isolate);\n   auto callFrame =\n       protocol::Runtime::CallFrame::create()\n           .setFunctionName(toProtocolString(node->GetFunctionName()))\n           .setScriptId(String16::fromInteger(node->GetScriptId()))\n-          .setUrl(toProtocolString(node->GetScriptResourceName()))\n+          .setUrl(resourceNameToUrl(inspector, node->GetScriptResourceName()))\n           .setLineNumber(node->GetLineNumber() - 1)\n           .setColumnNumber(node->GetColumnNumber() - 1)\n           .build();\n@@ -107,18 +118,19 @@ std::unique_ptr<protocol::Array<int>> buildInspectorObjectForTimestamps(\n   return array;\n }\n \n-void flattenNodesTree(v8::Isolate* isolate, const v8::CpuProfileNode* node,\n+void flattenNodesTree(V8InspectorImpl* inspector,\n+                      const v8::CpuProfileNode* node,\n                       protocol::Array<protocol::Profiler::ProfileNode>* list) {\n-  list->addItem(buildInspectorObjectFor(isolate, node));\n+  list->addItem(buildInspectorObjectFor(inspector, node));\n   const int childrenCount = node->GetChildrenCount();\n   for (int i = 0; i < childrenCount; i++)\n-    flattenNodesTree(isolate, node->GetChild(i), list);\n+    flattenNodesTree(inspector, node->GetChild(i), list);\n }\n \n std::unique_ptr<protocol::Profiler::Profile> createCPUProfile(\n-    v8::Isolate* isolate, v8::CpuProfile* v8profile) {\n+    V8InspectorImpl* inspector, v8::CpuProfile* v8profile) {\n   auto nodes = protocol::Array<protocol::Profiler::ProfileNode>::create();\n-  flattenNodesTree(isolate, v8profile->GetTopDownRoot(), nodes.get());\n+  flattenNodesTree(inspector, v8profile->GetTopDownRoot(), nodes.get());\n   return protocol::Profiler::Profile::create()\n       .setNodes(std::move(nodes))\n       .setStartTime(static_cast<double>(v8profile->GetStartTime()))\n@@ -320,7 +332,7 @@ std::unique_ptr<protocol::Profiler::CoverageRange> createCoverageRange(\n }\n \n Response coverageToProtocol(\n-    v8::Isolate* isolate, const v8::debug::Coverage& coverage,\n+    V8InspectorImpl* inspector, const v8::debug::Coverage& coverage,\n     std::unique_ptr<protocol::Array<protocol::Profiler::ScriptCoverage>>*\n         out_result) {\n   std::unique_ptr<protocol::Array<protocol::Profiler::ScriptCoverage>> result =\n@@ -361,8 +373,10 @@ Response coverageToProtocol(\n     }\n     String16 url;\n     v8::Local<v8::String> name;\n-    if (script->Name().ToLocal(&name) || script->SourceURL().ToLocal(&name)) {\n+    if (script->SourceURL().ToLocal(&name) && name->Length()) {\n       url = toProtocolString(name);\n+    } else if (script->Name().ToLocal(&name) && name->Length()) {\n+      url = resourceNameToUrl(inspector, name);\n     }\n     result->addItem(protocol::Profiler::ScriptCoverage::create()\n                         .setScriptId(String16::fromInteger(script->Id()))\n@@ -384,7 +398,7 @@ Response V8ProfilerAgentImpl::takePreciseCoverage(\n   }\n   v8::HandleScope handle_scope(m_isolate);\n   v8::debug::Coverage coverage = v8::debug::Coverage::CollectPrecise(m_isolate);\n-  return coverageToProtocol(m_isolate, coverage, out_result);\n+  return coverageToProtocol(m_session->inspector(), coverage, out_result);\n }\n \n Response V8ProfilerAgentImpl::getBestEffortCoverage(\n@@ -393,12 +407,12 @@ Response V8ProfilerAgentImpl::getBestEffortCoverage(\n   v8::HandleScope handle_scope(m_isolate);\n   v8::debug::Coverage coverage =\n       v8::debug::Coverage::CollectBestEffort(m_isolate);\n-  return coverageToProtocol(m_isolate, coverage, out_result);\n+  return coverageToProtocol(m_session->inspector(), coverage, out_result);\n }\n \n namespace {\n std::unique_ptr<protocol::Array<protocol::Profiler::ScriptTypeProfile>>\n-typeProfileToProtocol(v8::Isolate* isolate,\n+typeProfileToProtocol(V8InspectorImpl* inspector,\n                       const v8::debug::TypeProfile& type_profile) {\n   std::unique_ptr<protocol::Array<protocol::Profiler::ScriptTypeProfile>>\n       result = protocol::Array<protocol::Profiler::ScriptTypeProfile>::create();\n@@ -426,8 +440,10 @@ typeProfileToProtocol(v8::Isolate* isolate,\n     }\n     String16 url;\n     v8::Local<v8::String> name;\n-    if (script->Name().ToLocal(&name) || script->SourceURL().ToLocal(&name)) {\n+    if (script->SourceURL().ToLocal(&name) && name->Length()) {\n       url = toProtocolString(name);\n+    } else if (script->Name().ToLocal(&name) && name->Length()) {\n+      url = resourceNameToUrl(inspector, name);\n     }\n     result->addItem(protocol::Profiler::ScriptTypeProfile::create()\n                         .setScriptId(String16::fromInteger(script->Id()))\n@@ -462,7 +478,7 @@ Response V8ProfilerAgentImpl::takeTypeProfile(\n   v8::HandleScope handle_scope(m_isolate);\n   v8::debug::TypeProfile type_profile =\n       v8::debug::TypeProfile::Collect(m_isolate);\n-  *out_result = typeProfileToProtocol(m_isolate, type_profile);\n+  *out_result = typeProfileToProtocol(m_session->inspector(), type_profile);\n   return Response::OK();\n }\n \n@@ -491,7 +507,7 @@ std::unique_ptr<protocol::Profiler::Profile> V8ProfilerAgentImpl::stopProfiling(\n       m_profiler->StopProfiling(toV8String(m_isolate, title));\n   std::unique_ptr<protocol::Profiler::Profile> result;\n   if (profile) {\n-    if (serialize) result = createCPUProfile(m_isolate, profile);\n+    if (serialize) result = createCPUProfile(m_session->inspector(), profile);\n     profile->Delete();\n   }\n   --m_startedProfilesCount;"
        },
        {
            "sha": "9be0d4fa385f2a02da6ba9865f7d658ac1912a5e",
            "filename": "deps/v8/src/inspector/v8-stack-trace-impl.cc",
            "status": "modified",
            "additions": 19,
            "deletions": 5,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-stack-trace-impl.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-stack-trace-impl.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finspector%2Fv8-stack-trace-impl.cc?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -7,6 +7,7 @@\n #include <algorithm>\n \n #include \"src/inspector/v8-debugger.h\"\n+#include \"src/inspector/v8-inspector-impl.h\"\n #include \"src/inspector/wasm-translation.h\"\n \n namespace v8_inspector {\n@@ -73,7 +74,10 @@ std::unique_ptr<protocol::Runtime::StackTrace> buildInspectorObjectCommon(\n   std::unique_ptr<protocol::Array<protocol::Runtime::CallFrame>>\n       inspectorFrames = protocol::Array<protocol::Runtime::CallFrame>::create();\n   for (size_t i = 0; i < frames.size(); i++) {\n-    inspectorFrames->addItem(frames[i]->buildInspectorObject());\n+    V8InspectorClient* client = nullptr;\n+    if (debugger && debugger->inspector())\n+      client = debugger->inspector()->client();\n+    inspectorFrames->addItem(frames[i]->buildInspectorObject(client));\n   }\n   std::unique_ptr<protocol::Runtime::StackTrace> stackTrace =\n       protocol::Runtime::StackTrace::create()\n@@ -117,7 +121,9 @@ StackFrame::StackFrame(v8::Local<v8::StackFrame> v8Frame)\n       m_scriptId(String16::fromInteger(v8Frame->GetScriptId())),\n       m_sourceURL(toProtocolString(v8Frame->GetScriptNameOrSourceURL())),\n       m_lineNumber(v8Frame->GetLineNumber() - 1),\n-      m_columnNumber(v8Frame->GetColumn() - 1) {\n+      m_columnNumber(v8Frame->GetColumn() - 1),\n+      m_hasSourceURLComment(v8Frame->GetScriptName() !=\n+                            v8Frame->GetScriptNameOrSourceURL()) {\n   DCHECK_NE(v8::Message::kNoLineNumberInfo, m_lineNumber + 1);\n   DCHECK_NE(v8::Message::kNoColumnInfo, m_columnNumber + 1);\n }\n@@ -137,12 +143,20 @@ int StackFrame::lineNumber() const { return m_lineNumber; }\n \n int StackFrame::columnNumber() const { return m_columnNumber; }\n \n-std::unique_ptr<protocol::Runtime::CallFrame> StackFrame::buildInspectorObject()\n-    const {\n+std::unique_ptr<protocol::Runtime::CallFrame> StackFrame::buildInspectorObject(\n+    V8InspectorClient* client) const {\n+  String16 frameUrl = m_sourceURL;\n+  if (client && !m_hasSourceURLComment && frameUrl.length() > 0) {\n+    std::unique_ptr<StringBuffer> url =\n+        client->resourceNameToUrl(toStringView(m_sourceURL));\n+    if (url) {\n+      frameUrl = toString16(url->string());\n+    }\n+  }\n   return protocol::Runtime::CallFrame::create()\n       .setFunctionName(m_functionName)\n       .setScriptId(m_scriptId)\n-      .setUrl(m_sourceURL)\n+      .setUrl(frameUrl)\n       .setLineNumber(m_lineNumber)\n       .setColumnNumber(m_columnNumber)\n       .build();"
        },
        {
            "sha": "019fd469cdd72e1fd03ed7a0ab8554e054fb8498",
            "filename": "deps/v8/src/inspector/v8-stack-trace-impl.h",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-stack-trace-impl.h",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Fsrc%2Finspector%2Fv8-stack-trace-impl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finspector%2Fv8-stack-trace-impl.h?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -33,7 +33,8 @@ class StackFrame {\n   const String16& sourceURL() const;\n   int lineNumber() const;    // 0-based.\n   int columnNumber() const;  // 0-based.\n-  std::unique_ptr<protocol::Runtime::CallFrame> buildInspectorObject() const;\n+  std::unique_ptr<protocol::Runtime::CallFrame> buildInspectorObject(\n+      V8InspectorClient* client) const;\n   bool isEqual(StackFrame* frame) const;\n \n  private:\n@@ -42,6 +43,7 @@ class StackFrame {\n   String16 m_sourceURL;\n   int m_lineNumber;    // 0-based.\n   int m_columnNumber;  // 0-based.\n+  bool m_hasSourceURLComment;\n };\n \n class V8StackTraceImpl : public V8StackTrace {"
        },
        {
            "sha": "0ecd0b82ef239072ab20a4d8844fa48b4b477586",
            "filename": "deps/v8/test/inspector/debugger/resource-name-to-url-expected.txt",
            "status": "added",
            "additions": 122,
            "deletions": 0,
            "changes": 122,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Fdebugger%2Fresource-name-to-url-expected.txt",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Fdebugger%2Fresource-name-to-url-expected.txt",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Finspector%2Fdebugger%2Fresource-name-to-url-expected.txt?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -0,0 +1,122 @@\n+Tests V8InspectorClient::resourceNameToUrl.\n+Check script with url:\n+{\n+    method : Debugger.scriptParsed\n+    params : {\n+        endColumn : 16\n+        endLine : 0\n+        executionContextId : <executionContextId>\n+        hasSourceURL : false\n+        hash : 033b33d191ed51ed823355d865eb871d811403e2\n+        isLiveEdit : false\n+        isModule : false\n+        length : 16\n+        scriptId : <scriptId>\n+        sourceMapURL :\n+        startColumn : 0\n+        startLine : 0\n+        url : prefix://url\n+    }\n+}\n+Check script with sourceURL comment:\n+{\n+    method : Debugger.scriptParsed\n+    params : {\n+        endColumn : 37\n+        endLine : 0\n+        executionContextId : <executionContextId>\n+        hasSourceURL : true\n+        hash : 06c136ce206c5f505f32af524e6ec71b5baa0bbb\n+        isLiveEdit : false\n+        isModule : false\n+        length : 37\n+        scriptId : <scriptId>\n+        sourceMapURL :\n+        startColumn : 0\n+        startLine : 0\n+        url : foo.js\n+    }\n+}\n+Check script failed to parse:\n+{\n+    method : Debugger.scriptFailedToParse\n+    params : {\n+        endColumn : 15\n+        endLine : 0\n+        executionContextId : <executionContextId>\n+        hasSourceURL : false\n+        hash : 033b33d191ed51ed1f44cd0465eb871d811403e2\n+        isModule : false\n+        length : 15\n+        scriptId : <scriptId>\n+        sourceMapURL :\n+        startColumn : 0\n+        startLine : 0\n+        url : prefix://url\n+    }\n+}\n+Check script failed to parse with sourceURL comment:\n+{\n+    method : Debugger.scriptFailedToParse\n+    params : {\n+        endColumn : 36\n+        endLine : 0\n+        executionContextId : <executionContextId>\n+        hasSourceURL : true\n+        hash : 23a2885951475580023e2a742563d78876d8f05e\n+        isModule : false\n+        length : 36\n+        scriptId : <scriptId>\n+        sourceMapURL :\n+        startColumn : 0\n+        startLine : 0\n+        url : foo.js\n+    }\n+}\n+Test runtime stack trace:\n+{\n+    method : Runtime.consoleAPICalled\n+    params : {\n+        args : [\n+            [0] : {\n+                description : 42\n+                type : number\n+                value : 42\n+            }\n+        ]\n+        executionContextId : <executionContextId>\n+        stackTrace : {\n+            callFrames : [\n+                [0] : {\n+                    columnNumber : 14\n+                    functionName : foo\n+                    lineNumber : 2\n+                    scriptId : <scriptId>\n+                    url : prefix://url\n+                }\n+                [1] : {\n+                    columnNumber : 0\n+                    functionName :\n+                    lineNumber : 0\n+                    scriptId : <scriptId>\n+                    url : boo.js\n+                }\n+                [2] : {\n+                    columnNumber : 4\n+                    functionName :\n+                    lineNumber : 4\n+                    scriptId : <scriptId>\n+                    url : prefix://url\n+                }\n+            ]\n+        }\n+        timestamp : <timestamp>\n+        type : log\n+    }\n+}\n+Test debugger stack trace:\n+[\n+    [0] : prefix://url\n+    [1] : boo.js\n+    [2] : prefix://url\n+]"
        },
        {
            "sha": "620c7a2864b406539fc7fc0e4b5a89b06a0847f3",
            "filename": "deps/v8/test/inspector/debugger/resource-name-to-url.js",
            "status": "added",
            "additions": 49,
            "deletions": 0,
            "changes": 49,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Fdebugger%2Fresource-name-to-url.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Fdebugger%2Fresource-name-to-url.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Finspector%2Fdebugger%2Fresource-name-to-url.js?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -0,0 +1,49 @@\n+// Copyright 2018 the V8 project authors. All rights reserved.\n+// Use of this source code is governed by a BSD-style license that can be\n+// found in the LICENSE file.\n+\n+let {session, contextGroup, Protocol} = InspectorTest.start(\n+  'Tests V8InspectorClient::resourceNameToUrl.');\n+\n+(async function test(){\n+  Protocol.Runtime.enable();\n+  await Protocol.Debugger.enable();\n+  contextGroup.addScript(`inspector.setResourceNamePrefix('prefix://')`);\n+  await Protocol.Debugger.onceScriptParsed();\n+\n+  InspectorTest.log('Check script with url:');\n+  contextGroup.addScript('function foo(){}', 0, 0, 'url');\n+  InspectorTest.logMessage(await Protocol.Debugger.onceScriptParsed());\n+\n+  InspectorTest.log('Check script with sourceURL comment:');\n+  contextGroup.addScript('function foo(){} //# sourceURL=foo.js', 0, 0, 'url');\n+  InspectorTest.logMessage(await Protocol.Debugger.onceScriptParsed());\n+\n+  InspectorTest.log('Check script failed to parse:');\n+  contextGroup.addScript('function foo(){', 0, 0, 'url');\n+  InspectorTest.logMessage(await Protocol.Debugger.onceScriptFailedToParse());\n+\n+  InspectorTest.log('Check script failed to parse with sourceURL comment:');\n+  contextGroup.addScript('function foo(){ //# sourceURL=foo.js', 0, 0, 'url');\n+  InspectorTest.logMessage(await Protocol.Debugger.onceScriptFailedToParse());\n+\n+  InspectorTest.log('Test runtime stack trace:');\n+  contextGroup.addScript(`\n+    function foo() {\n+      console.log(42);\n+    }\n+    eval('foo(); //# sourceURL=boo.js');\n+  `, 0, 0, 'url');\n+  InspectorTest.logMessage(await Protocol.Runtime.onceConsoleAPICalled());\n+\n+  InspectorTest.log('Test debugger stack trace:');\n+  contextGroup.addScript(`\n+    function foo() {\n+      debugger;\n+    }\n+    eval('foo(); //# sourceURL=boo.js');\n+  `, 0, 0, 'url');\n+  const {params:{callFrames}} = await Protocol.Debugger.oncePaused();\n+  InspectorTest.logMessage(callFrames.map(frame => frame.url));\n+  InspectorTest.completeTest();\n+})();"
        },
        {
            "sha": "93a8b1d3f2188015aa153cdc15b3b369d1f353d9",
            "filename": "deps/v8/test/inspector/inspector-test.cc",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Finspector-test.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Finspector-test.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Finspector%2Finspector-test.cc?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -712,6 +712,9 @@ class InspectorExtension : public IsolateData::SetupGlobalTask {\n         ToV8String(isolate, \"setAllowCodeGenerationFromStrings\"),\n         v8::FunctionTemplate::New(\n             isolate, &InspectorExtension::SetAllowCodeGenerationFromStrings));\n+    inspector->Set(ToV8String(isolate, \"setResourceNamePrefix\"),\n+                   v8::FunctionTemplate::New(\n+                       isolate, &InspectorExtension::SetResourceNamePrefix));\n     global->Set(ToV8String(isolate, \"inspector\"), inspector);\n   }\n \n@@ -973,6 +976,18 @@ class InspectorExtension : public IsolateData::SetupGlobalTask {\n     args.GetIsolate()->GetCurrentContext()->AllowCodeGenerationFromStrings(\n         args[0].As<v8::Boolean>()->Value());\n   }\n+\n+  static void SetResourceNamePrefix(\n+      const v8::FunctionCallbackInfo<v8::Value>& args) {\n+    if (args.Length() != 1 || !args[0]->IsString()) {\n+      fprintf(stderr, \"Internal error: setResourceNamePrefix('prefix').\");\n+      Exit();\n+    }\n+    v8::Isolate* isolate = args.GetIsolate();\n+    v8::Local<v8::Context> context = isolate->GetCurrentContext();\n+    IsolateData* data = IsolateData::FromContext(context);\n+    data->SetResourceNamePrefix(v8::Local<v8::String>::Cast(args[0]));\n+  }\n };\n \n bool RunExtraCode(v8::Isolate* isolate, v8::Local<v8::Context> context,"
        },
        {
            "sha": "a669cc41a1f26a2c6a76c59eb081c8ca0a83bfdd",
            "filename": "deps/v8/test/inspector/isolate-data.cc",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Fisolate-data.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Fisolate-data.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Finspector%2Fisolate-data.cc?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -423,3 +423,32 @@ void IsolateData::maxAsyncCallStackDepthChanged(int depth) {\n   if (!log_max_async_call_stack_depth_changed_) return;\n   fprintf(stdout, \"maxAsyncCallStackDepthChanged: %d\\n\", depth);\n }\n+\n+void IsolateData::SetResourceNamePrefix(v8::Local<v8::String> prefix) {\n+  resource_name_prefix_.Reset(v8::Isolate::GetCurrent(), prefix);\n+}\n+\n+namespace {\n+class StringBufferImpl : public v8_inspector::StringBuffer {\n+ public:\n+  StringBufferImpl(v8::Isolate* isolate, v8::Local<v8::String> string)\n+      : data_(ToVector(string)),\n+        view_(data_.start(), data_.length()) {}\n+  const v8_inspector::StringView& string() override { return view_; }\n+\n+ private:\n+  v8::internal::Vector<uint16_t> data_;\n+  v8_inspector::StringView view_;\n+};\n+}  // anonymous namespace\n+\n+std::unique_ptr<v8_inspector::StringBuffer> IsolateData::resourceNameToUrl(\n+    const v8_inspector::StringView& resourceName) {\n+  if (resource_name_prefix_.IsEmpty()) return nullptr;\n+  v8::Isolate* isolate = v8::Isolate::GetCurrent();\n+  v8::HandleScope handle_scope(isolate);\n+  v8::Local<v8::String> name = ToString(isolate, resourceName);\n+  v8::Local<v8::String> prefix = resource_name_prefix_.Get(isolate);\n+  v8::Local<v8::String> url = v8::String::Concat(prefix, name);\n+  return std::unique_ptr<StringBufferImpl>(new StringBufferImpl(isolate, url));\n+}"
        },
        {
            "sha": "d0a263e573827c3b22810d70b0cf4f0c6f9243f3",
            "filename": "deps/v8/test/inspector/isolate-data.h",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Fisolate-data.h",
            "raw_url": "https://github.com/nodejs/node/raw/ab150160f8149063865729e52c6a7597133f9057/deps%2Fv8%2Ftest%2Finspector%2Fisolate-data.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Finspector%2Fisolate-data.h?ref=ab150160f8149063865729e52c6a7597133f9057",
            "patch": "@@ -76,6 +76,7 @@ class IsolateData : public v8_inspector::V8InspectorClient {\n   void FireContextCreated(v8::Local<v8::Context> context, int context_group_id);\n   void FireContextDestroyed(v8::Local<v8::Context> context);\n   void FreeContext(v8::Local<v8::Context> context);\n+  void SetResourceNamePrefix(v8::Local<v8::String> prefix);\n \n  private:\n   struct VectorCompare {\n@@ -114,6 +115,8 @@ class IsolateData : public v8_inspector::V8InspectorClient {\n                          v8_inspector::V8StackTrace*) override;\n   bool isInspectableHeapObject(v8::Local<v8::Object>) override;\n   void maxAsyncCallStackDepthChanged(int depth) override;\n+  std::unique_ptr<v8_inspector::StringBuffer> resourceNameToUrl(\n+      const v8_inspector::StringView& resourceName) override;\n \n   // The isolate gets deleted by its {Dispose} method, not by the default\n   // deleter. Therefore we have to define a custom deleter for the unique_ptr to\n@@ -141,6 +144,7 @@ class IsolateData : public v8_inspector::V8InspectorClient {\n   bool log_console_api_message_calls_ = false;\n   bool log_max_async_call_stack_depth_changed_ = false;\n   v8::Global<v8::Private> not_inspectable_private_;\n+  v8::Global<v8::String> resource_name_prefix_;\n \n   DISALLOW_COPY_AND_ASSIGN(IsolateData);\n };"
        }
    ],
    "stats": {
        "total": 367,
        "additions": 318,
        "deletions": 49
    }
}