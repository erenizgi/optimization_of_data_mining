{
    "author": "Fishrock123",
    "message": "test: move getTTYfd() to common helpers\n\nThis utility is fairly generic and likely useful for more than one test.\n\nPR-URL: https://github.com/nodejs/node/pull/18800\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "92bf2492cd6b78b1ab26765660d912ee34bb90c6",
    "files": [
        {
            "sha": "7fd36f59852547099b0afe522746ec77be5d4db6",
            "filename": "test/common/README.md",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/92bf2492cd6b78b1ab26765660d912ee34bb90c6/test%2Fcommon%2FREADME.md",
            "raw_url": "https://github.com/nodejs/node/raw/92bf2492cd6b78b1ab26765660d912ee34bb90c6/test%2Fcommon%2FREADME.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2FREADME.md?ref=92bf2492cd6b78b1ab26765660d912ee34bb90c6",
            "patch": "@@ -679,6 +679,12 @@ The realpath of the testing temporary directory.\n \n Deletes and recreates the testing temporary directory.\n \n+### getTTYfd()\n+\n+Attempts to get a valid TTY file descriptor. Returns `-1` if it fails.\n+\n+The TTY file descriptor is assumed to be capable of being writable.\n+\n ## WPT Module\n \n The wpt.js module is a port of parts of"
        },
        {
            "sha": "1fc029292abb107f5a51fe7f60aca4bf78ea5b6e",
            "filename": "test/common/index.js",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/92bf2492cd6b78b1ab26765660d912ee34bb90c6/test%2Fcommon%2Findex.js",
            "raw_url": "https://github.com/nodejs/node/raw/92bf2492cd6b78b1ab26765660d912ee34bb90c6/test%2Fcommon%2Findex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.js?ref=92bf2492cd6b78b1ab26765660d912ee34bb90c6",
            "patch": "@@ -775,6 +775,23 @@ exports.crashOnUnhandledRejection = function() {\n              (err) => process.nextTick(() => { throw err; }));\n };\n \n+exports.getTTYfd = function getTTYfd() {\n+  // Do our best to grab a tty fd.\n+  const tty = require('tty');\n+  // Don't attempt fd 0 as it is not writable on Windows.\n+  // Ref: ef2861961c3d9e9ed6972e1e84d969683b25cf95\n+  const ttyFd = [1, 2, 4, 5].find(tty.isatty);\n+  if (ttyFd === undefined) {\n+    try {\n+      return fs.openSync('/dev/tty');\n+    } catch (e) {\n+      // There aren't any tty fd's available to use.\n+      return -1;\n+    }\n+  }\n+  return ttyFd;\n+};\n+\n // Hijack stdout and stderr\n const stdWrite = {};\n function hijackStdWritable(name, listener) {"
        },
        {
            "sha": "e68846017175c9f860e12a83c0133399b8aeb3f1",
            "filename": "test/parallel/test-tty-get-color-depth.js",
            "status": "modified",
            "additions": 1,
            "deletions": 18,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/92bf2492cd6b78b1ab26765660d912ee34bb90c6/test%2Fparallel%2Ftest-tty-get-color-depth.js",
            "raw_url": "https://github.com/nodejs/node/raw/92bf2492cd6b78b1ab26765660d912ee34bb90c6/test%2Fparallel%2Ftest-tty-get-color-depth.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tty-get-color-depth.js?ref=92bf2492cd6b78b1ab26765660d912ee34bb90c6",
            "patch": "@@ -3,26 +3,9 @@\n const common = require('../common');\n const assert = require('assert').strict;\n /* eslint-disable no-restricted-properties */\n-const { openSync } = require('fs');\n-const tty = require('tty');\n-\n const { WriteStream } = require('tty');\n \n-// Do our best to grab a tty fd.\n-function getTTYfd() {\n-  const ttyFd = [1, 2, 4, 5].find(tty.isatty);\n-  if (ttyFd === undefined) {\n-    try {\n-      return openSync('/dev/tty');\n-    } catch (e) {\n-      // There aren't any tty fd's available to use.\n-      return -1;\n-    }\n-  }\n-  return ttyFd;\n-}\n-\n-const fd = getTTYfd();\n+const fd = common.getTTYfd();\n \n // Give up if we did not find a tty\n if (fd === -1)"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 24,
        "deletions": 18
    }
}