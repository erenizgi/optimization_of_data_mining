{
    "author": "refack",
    "message": "build,deps: refactor and fix v8.gyp\n\n* Make inspector.gypi and v8_external_snapshot.gypi includible targets.\n* Make `v8_dump_build_config` an action\n* Better separate `js2c` and `natives_blob`\n* process action outputs as sources\n* trigger v8.gyp:postmortem-metadata from v8.gyp\n\nPR-URL: https://github.com/nodejs/node/pull/23182\nRefs: https://github.com/nodejs/node/pull/23156\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "9800fd7aaa7226fff3f21edd7f77f563b9a69753",
    "files": [
        {
            "sha": "a809aa277e30ad8a381ea8b4733861dfb3d02334",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/9800fd7aaa7226fff3f21edd7f77f563b9a69753/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/9800fd7aaa7226fff3f21edd7f77f563b9a69753/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=9800fd7aaa7226fff3f21edd7f77f563b9a69753",
            "patch": "@@ -31,7 +31,7 @@\n \n     # Reset this number to 0 on major V8 upgrades.\n     # Increment by one for each non-official patch applied to deps/v8.\n-    'v8_embedder_string': '-node.2',\n+    'v8_embedder_string': '-node.3',\n \n     # Enable disassembler for `--print-code` v8 options\n     'v8_enable_disassembler': 1,"
        },
        {
            "sha": "35a078e8af2fd2242fd493f6176406dacf67d85f",
            "filename": "deps/v8/gypfiles/features.gypi",
            "status": "modified",
            "additions": 16,
            "deletions": 27,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Ffeatures.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Ffeatures.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Ffeatures.gypi?ref=9800fd7aaa7226fff3f21edd7f77f563b9a69753",
            "patch": "@@ -29,9 +29,16 @@\n \n {\n   'variables': {\n-    'variables': {\n-      'v8_target_arch%': '<(target_arch)',\n-    },\n+    'v8_target_arch%': '<(target_arch)',\n+\n+    # Emulate GN variables\n+    'conditions': [\n+      ['OS==\"android\"', { # GYP reverts OS to linux so use `-D OS=android`\n+        'is_android': 1,\n+      }, {\n+        'is_android': 0,\n+      }],\n+    ],\n \n     # Allows the embedder to add a custom suffix to the version string.\n     'v8_embedder_string%': '',\n@@ -95,6 +102,8 @@\n \n     # Enable mitigations for executing untrusted code.\n     'v8_untrusted_code_mitigations%': 'true',\n+\n+    'v8_enable_handle_zapping%': 1,\n   },\n   'target_defaults': {\n     'conditions': [\n@@ -105,7 +114,7 @@\n         'defines': ['ENABLE_DISASSEMBLER',],\n       }],\n       ['v8_promise_internal_field_count!=0', {\n-        'defines': ['V8_PROMISE_INTERNAL_FIELD_COUNT','v8_promise_internal_field_count'],\n+        'defines': ['V8_PROMISE_INTERNAL_FIELD_COUNT=<(v8_promise_internal_field_count)'],\n       }],\n       ['v8_enable_gdbjit==1', {\n         'defines': ['ENABLE_GDB_JIT_INTERFACE',],\n@@ -155,30 +164,10 @@\n       ['v8_untrusted_code_mitigations==\"false\"', {\n         'defines': ['DISABLE_UNTRUSTED_CODE_MITIGATIONS',],\n       }],\n+      ['v8_enable_handle_zapping==1', {\n+        'defines': ['ENABLE_HANDLE_ZAPPING',],\n+      }],\n     ],  # conditions\n-    'configurations': {\n-      'DebugBaseCommon': {\n-        'abstract': 1,\n-        'variables': {\n-          'v8_enable_handle_zapping%': 1,\n-        },\n-        'conditions': [\n-          ['v8_enable_handle_zapping==1', {\n-            'defines': ['ENABLE_HANDLE_ZAPPING',],\n-          }],\n-        ],\n-      },  # Debug\n-      'Release': {\n-        'variables': {\n-          'v8_enable_handle_zapping%': 1,\n-        },\n-        'conditions': [\n-          ['v8_enable_handle_zapping==1', {\n-            'defines': ['ENABLE_HANDLE_ZAPPING',],\n-          }],\n-        ],  # conditions\n-      },  # Release\n-    },  # configurations\n     'defines': [\n       'V8_GYP_BUILD',\n       'V8_TYPED_ARRAY_MAX_SIZE_IN_HEAP=<(v8_typed_array_max_size_in_heap)',"
        },
        {
            "sha": "c0b503d9cec51fe3798af12ca04d0ef30d7ab120",
            "filename": "deps/v8/gypfiles/inspector.gyp",
            "status": "removed",
            "additions": 0,
            "deletions": 89,
            "changes": 89,
            "blob_url": "https://github.com/nodejs/node/blob/51f0060765a400c77553c29936baaf044b85c29b/deps%2Fv8%2Fgypfiles%2Finspector.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/51f0060765a400c77553c29936baaf044b85c29b/deps%2Fv8%2Fgypfiles%2Finspector.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Finspector.gyp?ref=51f0060765a400c77553c29936baaf044b85c29b",
            "patch": "@@ -1,89 +0,0 @@\n-# Copyright 2016 the V8 project authors. All rights reserved.\n-# Use of this source code is governed by a BSD-style license that can be\n-# found in the LICENSE file.\n-\n-{\n-  'variables': {\n-    'protocol_path': '../third_party/inspector_protocol',\n-    'inspector_path': '../src/inspector',\n-  },\n-  'includes': [\n-    'inspector.gypi',\n-    '../third_party/inspector_protocol/inspector_protocol.gypi',\n-  ],\n-  'targets': [\n-    { 'target_name': 'inspector_injected_script',\n-      'type': 'none',\n-      'toolsets': ['target'],\n-      'actions': [\n-        {\n-          'action_name': 'convert_js_to_cpp_char_array',\n-          'inputs': [\n-            '<(inspector_path)/build/xxd.py',\n-            '<(inspector_injected_script_source)',\n-          ],\n-          'outputs': [\n-            '<(inspector_generated_injected_script)',\n-          ],\n-          'action': [\n-            'python',\n-            '<(inspector_path)/build/xxd.py',\n-            'InjectedScriptSource_js',\n-            '<(inspector_path)/injected-script-source.js',\n-            '<@(_outputs)'\n-          ],\n-        },\n-      ],\n-      # Since this target generates header files, it needs to be a hard dependency.\n-      'hard_dependency': 1,\n-    },\n-    { 'target_name': 'protocol_compatibility',\n-      'type': 'none',\n-      'toolsets': ['target'],\n-      'actions': [\n-        {\n-          'action_name': 'protocol_compatibility',\n-          'inputs': [\n-            '<(inspector_path)/js_protocol.json',\n-          ],\n-          'outputs': [\n-            '<@(SHARED_INTERMEDIATE_DIR)/src/js_protocol.stamp',\n-          ],\n-          'action': [\n-            'python',\n-            '<(protocol_path)/CheckProtocolCompatibility.py',\n-            '--stamp', '<@(_outputs)',\n-            '<(inspector_path)/js_protocol.json',\n-          ],\n-          'message': 'Generating inspector protocol sources from protocol json definition',\n-        },\n-      ]\n-    },\n-    { 'target_name': 'protocol_generated_sources',\n-      'type': 'none',\n-      'dependencies': [ 'protocol_compatibility' ],\n-      'toolsets': ['target'],\n-      'actions': [\n-        {\n-          'action_name': 'protocol_generated_sources',\n-          'inputs': [\n-            '<(inspector_path)/js_protocol.json',\n-            '<(inspector_path)/inspector_protocol_config.json',\n-            '<@(inspector_protocol_files)',\n-          ],\n-          'outputs': [\n-            '<@(inspector_generated_sources)',\n-          ],\n-          'action': [\n-            'python',\n-            '<(protocol_path)/CodeGenerator.py',\n-            '--jinja_dir', '../third_party',\n-            '--output_base', '<(SHARED_INTERMEDIATE_DIR)/src/inspector',\n-            '--config', '<(inspector_path)/inspector_protocol_config.json',\n-          ],\n-          'message': 'Generating inspector protocol sources from protocol json',\n-        },\n-      ]\n-    },\n-  ],\n-}"
        },
        {
            "sha": "be42ea8b783ff8cda9d73b3871f3d2ff669bc0bc",
            "filename": "deps/v8/gypfiles/inspector.gypi",
            "status": "modified",
            "additions": 63,
            "deletions": 3,
            "changes": 66,
            "blob_url": "https://github.com/nodejs/node/blob/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Finspector.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Finspector.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Finspector.gypi?ref=9800fd7aaa7226fff3f21edd7f77f563b9a69753",
            "patch": "@@ -4,6 +4,9 @@\n \n {\n   'variables': {\n+    'protocol_path': '../third_party/inspector_protocol',\n+    'inspector_path': '../src/inspector',\n+\n     'inspector_generated_sources': [\n       '<(SHARED_INTERMEDIATE_DIR)/src/inspector/protocol/Forward.h',\n       '<(SHARED_INTERMEDIATE_DIR)/src/inspector/protocol/Protocol.cpp',\n@@ -29,8 +32,6 @@\n     'inspector_generated_injected_script': '<(SHARED_INTERMEDIATE_DIR)/src/inspector/injected-script-source.h',\n \n     'inspector_all_sources': [\n-      '<@(inspector_generated_sources)',\n-      '<(inspector_generated_injected_script)',\n       '../include/v8-inspector.h',\n       '../include/v8-inspector-protocol.h',\n       '../src/inspector/injected-script.cc',\n@@ -86,5 +87,64 @@\n       '../src/inspector/wasm-translation.cc',\n       '../src/inspector/wasm-translation.h',\n     ]\n-  }\n+  },\n+  'includes': [\n+    '../third_party/inspector_protocol/inspector_protocol.gypi',\n+  ],\n+  'actions': [\n+    {\n+      'action_name': 'protocol_compatibility',\n+      'inputs': [\n+        '<(inspector_path)/js_protocol.json',\n+      ],\n+      'outputs': [\n+        '<@(SHARED_INTERMEDIATE_DIR)/src/js_protocol.stamp',\n+      ],\n+      'action': [\n+        'python',\n+        '<(protocol_path)/CheckProtocolCompatibility.py',\n+        '--stamp', '<@(_outputs)',\n+        '<(inspector_path)/js_protocol.json',\n+      ],\n+      'message': 'Checking inspector protocol compatibility',\n+    },\n+    {\n+      'action_name': 'protocol_generated_sources',\n+      'inputs': [\n+        '<(inspector_path)/js_protocol.json',\n+        '<(inspector_path)/inspector_protocol_config.json',\n+        '<@(inspector_protocol_files)',\n+      ],\n+      'outputs': [\n+        '<@(inspector_generated_sources)',\n+      ],\n+      'process_outputs_as_sources': 1,\n+      'action': [\n+        'python',\n+        '<(protocol_path)/CodeGenerator.py',\n+        '--jinja_dir', '../third_party',\n+        '--output_base', '<(SHARED_INTERMEDIATE_DIR)/src/inspector',\n+        '--config', '<(inspector_path)/inspector_protocol_config.json',\n+      ],\n+      'message': 'Generating inspector protocol sources from protocol json',\n+    },\n+    {\n+      'action_name': 'convert_js_to_cpp_char_array',\n+      'inputs': [\n+        '<(inspector_path)/build/xxd.py',\n+        '<(inspector_injected_script_source)',\n+      ],\n+      'outputs': [\n+        '<(inspector_generated_injected_script)',\n+      ],\n+      'process_outputs_as_sources': 1,\n+      'action': [\n+        'python',\n+        '<(inspector_path)/build/xxd.py',\n+        'InjectedScriptSource_js',\n+        '<(inspector_path)/injected-script-source.js',\n+        '<@(_outputs)'\n+      ],\n+    },\n+  ],\n }"
        },
        {
            "sha": "7f497fac91e2b2049f9d76836d420ee7cd3c89c3",
            "filename": "deps/v8/gypfiles/toolchain.gypi",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Ftoolchain.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Ftoolchain.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Ftoolchain.gypi?ref=9800fd7aaa7226fff3f21edd7f77f563b9a69753",
            "patch": "@@ -1425,5 +1425,24 @@\n         }],\n       ],\n     },  # configurations\n+    'msvs_disabled_warnings': [\n+      4245,  # Conversion with signed/unsigned mismatch.\n+      4267,  # Conversion with possible loss of data.\n+      4324,  # Padding structure due to alignment.\n+      4701,  # Potentially uninitialized local variable.\n+      4702,  # Unreachable code.\n+      4703,  # Potentially uninitialized local pointer variable.\n+      4709,  # Comma operator within array index expr (bugged).\n+      4714,  # Function marked forceinline not inlined.\n+\n+      # MSVC assumes that control can get past an exhaustive switch and then\n+      # warns if there's no return there (see https://crbug.com/v8/7658)\n+      4715,  # Not all control paths return a value.\n+\n+      4718,  # Recursive call has no side-effect.\n+      4723,  # https://crbug.com/v8/7771\n+      4724,  # https://crbug.com/v8/7771\n+      4800,  # Forcing value to bool.\n+    ],\n   },  # target_defaults\n }"
        },
        {
            "sha": "c71ecded76e7330c88e7c3123f69c6d357106e82",
            "filename": "deps/v8/gypfiles/v8.gyp",
            "status": "modified",
            "additions": 247,
            "deletions": 370,
            "changes": 617,
            "blob_url": "https://github.com/nodejs/node/blob/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Fv8.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Fv8.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Fv8.gyp?ref=9800fd7aaa7226fff3f21edd7f77f563b9a69753",
            "patch": "@@ -7,19 +7,20 @@\n     'v8_code': 1,\n     'v8_random_seed%': 314159265,\n     'v8_vector_stores%': 0,\n-    'embed_script%': \"\",\n-    'warmup_script%': \"\",\n+    'v8_embed_script%': \"\",\n     'v8_extra_library_files%': [],\n     'v8_experimental_extra_library_files%': [],\n     'mksnapshot_exec': '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)mksnapshot<(EXECUTABLE_SUFFIX)',\n     'v8_os_page_size%': 0,\n+    'torque_generated_pure_headers': [\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtin-definitions-from-dsl.h',\n+    ],\n   },\n-  'includes': ['toolchain.gypi', 'features.gypi', 'inspector.gypi'],\n+  'includes': ['toolchain.gypi', 'features.gypi'],\n   'targets': [\n     {\n       'target_name': 'v8',\n-      'dependencies_traverse': 1,\n-      'dependencies': ['v8_maybe_snapshot', 'v8_dump_build_config#target'],\n+      'dependencies': [ 'v8_maybe_snapshot' ],\n       'conditions': [\n         ['want_separate_host_toolset==1', {\n           'toolsets': ['host', 'target'],\n@@ -60,11 +61,55 @@\n         }],\n       ],\n       'direct_dependent_settings': {\n-        'include_dirs': [\n-          '../include/',\n-        ],\n+        'include_dirs': [ '../include/', ],\n       },\n-    },\n+      'actions': [\n+        {\n+          'action_name': 'v8_dump_build_config',\n+          'toolsets': ['target'],\n+          'inputs': [\n+            '../tools/testrunner/utils/dump_build_config_gyp.py',\n+          ],\n+          'outputs': [\n+            '<(PRODUCT_DIR)/v8_build_config.json',\n+          ],\n+          'variables': {\n+            'v8_dump_build_config_args': [\n+              '<(PRODUCT_DIR)/v8_build_config.json',\n+              'dcheck_always_on=<(dcheck_always_on)',\n+              'is_asan=<(asan)',\n+              'is_cfi=<(cfi_vptr)',\n+              'is_component_build=<(component)',\n+              'is_debug=<(CONFIGURATION_NAME)',\n+              # Not available in gyp.\n+              'is_gcov_coverage=0',\n+              'is_msan=<(msan)',\n+              'is_tsan=<(tsan)',\n+              # Not available in gyp.\n+              'is_ubsan_vptr=0',\n+              'target_cpu=<(target_arch)',\n+              'v8_enable_i18n_support=<(v8_enable_i18n_support)',\n+              'v8_enable_verify_predictable=<(v8_enable_verify_predictable)',\n+              'v8_target_cpu=<(v8_target_arch)',\n+              'v8_use_snapshot=<(v8_use_snapshot)',\n+            ]\n+          },\n+          'conditions': [\n+            ['v8_target_arch==\"mips\" or v8_target_arch==\"mipsel\" \\\n+              or v8_target_arch==\"mips64\" or v8_target_arch==\"mips64el\"', {\n+              'v8_dump_build_config_args':[\n+                'mips_arch_variant=<(mips_arch_variant)',\n+                'mips_use_msa=<(mips_use_msa)',\n+              ],\n+            }],\n+          ],\n+          'action': [\n+            'python', '../tools/testrunner/utils/dump_build_config_gyp.py',\n+            '<@(v8_dump_build_config_args)',\n+          ],\n+        },\n+      ],\n+    }, # v8\n     {\n       # This rule delegates to either v8_snapshot, v8_nosnapshot, or\n       # v8_external_snapshot, depending on the current variables.\n@@ -86,46 +131,37 @@\n         }],\n         ['v8_use_snapshot==\"true\" and v8_use_external_startup_data==1 and want_separate_host_toolset==0', {\n           'dependencies': ['v8_base', 'v8_external_snapshot'],\n-          'inputs': [ '<(PRODUCT_DIR)/snapshot_blob.bin', ],\n         }],\n         ['v8_use_snapshot==\"true\" and v8_use_external_startup_data==1 and want_separate_host_toolset==1', {\n           'dependencies': ['v8_base', 'v8_external_snapshot'],\n-          'target_conditions': [\n-            ['_toolset==\"host\"', {\n-              'inputs': [\n-                '<(PRODUCT_DIR)/snapshot_blob_host.bin',\n-              ],\n-            }, {\n-              'inputs': [\n-                '<(PRODUCT_DIR)/snapshot_blob.bin',\n-              ],\n-            }],\n-          ],\n         }],\n         ['want_separate_host_toolset==1', {\n           'toolsets': ['host', 'target'],\n         }, {\n           'toolsets': ['target'],\n         }],\n       ]\n-    },\n+    }, # v8_maybe_snapshot\n     {\n       'target_name': 'v8_init',\n       'type': 'static_library',\n       'dependencies': [\n         'v8_initializers',\n-        'v8_torque#host',\n+        # We need this transitive dependency, since it also does codegen.\n+        'v8_base',\n       ],\n       'variables': {\n         'optimize': 'max',\n       },\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n         '../include/',\n+        # This is for `gen/builtins-generated`\n+        '<(SHARED_INTERMEDIATE_DIR)',\n       ],\n       'sources': [\n         '../src/setup-isolate-full.cc',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtin-definitions-from-dsl.h',\n+        '<@(torque_generated_pure_headers)',\n       ],\n       'conditions': [\n         ['want_separate_host_toolset==1', {\n@@ -140,18 +176,17 @@\n           ],\n         }],\n       ],\n-    },\n+    }, # v8_init\n     {\n       'target_name': 'v8_initializers',\n       'type': 'static_library',\n       'dependencies': [\n         'v8_base',\n-        'v8_torque#host',\n       ],\n        'variables': {\n         'optimize': 'max',\n       },\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n         '../include/',\n       ],\n@@ -234,6 +269,7 @@\n         '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-typed-array-from-dsl-gen.h',\n         '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-data-view-from-dsl-gen.cc',\n         '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-data-view-from-dsl-gen.h',\n+        '<@(torque_generated_pure_headers)',\n       ],\n       'conditions': [\n         ['want_separate_host_toolset==1', {\n@@ -292,7 +328,7 @@\n           ],\n         }],\n       ],\n-    },\n+    }, # v8_initializers\n     {\n       'target_name': 'v8_snapshot',\n       'type': 'static_library',\n@@ -331,68 +367,67 @@\n       'dependencies': [\n         'v8_base',\n       ],\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n         '<(DEPTH)',\n       ],\n+      'variables': {\n+        'mksnapshot_flags': [ '--turbo_instruction_scheduling', ],\n+        'conditional_snapshot_outputs': [ ],\n+        'conditional_inputs': [ ],\n+        'conditions': [\n+          ['v8_random_seed != 0', {\n+            'mksnapshot_flags': ['--random-seed', '<(v8_random_seed)'],\n+          }],\n+          ['v8_os_page_size != 0', {\n+            'mksnapshot_flags': ['--v8_os_page_size', '<(v8_os_page_size)'],\n+          }],\n+          ['v8_use_external_startup_data !=0 ', {\n+            'conditional_snapshot_outputs': [ '<(INTERMEDIATE_DIR)/snapshot_blob.bin', ],\n+            'mksnapshot_flags': [ '--startup_blob', '<(INTERMEDIATE_DIR)/snapshot_blob.bin', ]\n+          }, {\n+             'conditional_snapshot_outputs': [ \"<(INTERMEDIATE_DIR)/snapshot.cc\" ],\n+             'mksnapshot_flags': [ '--startup_src', '<(INTERMEDIATE_DIR)/snapshot.cc', ]\n+           }],\n+          ['v8_embed_script != \"\"', {\n+            'conditional_inputs': [ '<(v8_embed_script)' ],\n+            'mksnapshot_flags': [ '<(v8_embed_script)' ],\n+          }],\n+        ],\n+      },\n       'sources': [\n         '<(SHARED_INTERMEDIATE_DIR)/experimental-extras-libraries.cc',\n         '<(SHARED_INTERMEDIATE_DIR)/extras-libraries.cc',\n         '<(SHARED_INTERMEDIATE_DIR)/libraries.cc',\n-        '<(INTERMEDIATE_DIR)/snapshot.cc',\n         '../src/setup-isolate-deserialize.cc',\n         '../src/snapshot/embedded-empty.cc',\n       ],\n       'actions': [\n         {\n           'action_name': 'run_mksnapshot',\n+          'message': 'generating: >@(conditional_snapshot_outputs)',\n           'inputs': [\n             '<(mksnapshot_exec)',\n-          ],\n-          'conditions': [\n-            ['embed_script!=\"\"', {\n-              'inputs': [\n-                '<(embed_script)',\n-              ],\n-            }],\n-            ['warmup_script!=\"\"', {\n-              'inputs': [\n-                '<(warmup_script)',\n-              ],\n-            }],\n+            '>@(conditional_inputs)',\n           ],\n           'outputs': [\n-            '<(INTERMEDIATE_DIR)/snapshot.cc',\n+            '>@(conditional_snapshot_outputs)',\n           ],\n-          'variables': {\n-            'mksnapshot_flags': [],\n-            'conditions': [\n-              ['v8_random_seed!=0', {\n-                'mksnapshot_flags': ['--random-seed', '<(v8_random_seed)'],\n-              }],\n-              ['v8_vector_stores!=0', {\n-                'mksnapshot_flags': ['--vector-stores'],\n-              }],\n-            ],\n-          },\n+          'process_outputs_as_sources': 1,\n           'action': [\n-            '<(mksnapshot_exec)',\n-            '<@(mksnapshot_flags)',\n-            '--startup_src', '<@(INTERMEDIATE_DIR)/snapshot.cc',\n-            '<(embed_script)',\n-            '<(warmup_script)',\n+            '>@(_inputs)',\n+            '>@(mksnapshot_flags)',\n           ],\n         },\n       ],\n-    },\n+    }, # v8_snapshot\n     {\n       'target_name': 'v8_nosnapshot',\n       'type': 'static_library',\n       'dependencies': [\n         'v8_base',\n-        'v8_torque#host',\n       ],\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n         '<(DEPTH)',\n       ],\n@@ -423,144 +458,27 @@\n           ],\n         }],\n       ]\n-    },\n-    {\n-      'target_name': 'v8_external_snapshot',\n-      'type': 'static_library',\n-      'conditions': [\n-        [ 'v8_use_external_startup_data==1', {\n-          'conditions': [\n-            ['want_separate_host_toolset==1', {\n-              'toolsets': ['host', 'target'],\n-              'dependencies': [\n-                'mksnapshot#host',\n-                'js2c#host',\n-                'natives_blob',\n-            ]}, {\n-              'toolsets': ['target'],\n-              'dependencies': [\n-                'mksnapshot',\n-                'js2c',\n-                'natives_blob',\n-              ],\n-            }],\n-            ['component==\"shared_library\"', {\n-              'defines': [\n-                'BUILDING_V8_SHARED',\n-              ],\n-              'direct_dependent_settings': {\n-                'defines': [\n-                  'USING_V8_SHARED',\n-                ],\n-              },\n-            }],\n-          ],\n-          'dependencies': [\n-            'v8_base',\n-          ],\n-          'include_dirs+': [\n-            '..',\n-            '<(DEPTH)',\n-          ],\n-          'sources': [\n-            '../src/setup-isolate-deserialize.cc',\n-            '../src/snapshot/embedded-empty.cc',\n-            '../src/snapshot/natives-external.cc',\n-            '../src/snapshot/snapshot-external.cc',\n-          ],\n-          'actions': [\n-            {\n-              'action_name': 'run_mksnapshot (external)',\n-              'inputs': [\n-                '<(mksnapshot_exec)',\n-              ],\n-              'variables': {\n-                'mksnapshot_flags': [],\n-                'conditions': [\n-                  ['v8_random_seed!=0', {\n-                    'mksnapshot_flags': ['--random-seed', '<(v8_random_seed)'],\n-                  }],\n-                  ['v8_vector_stores!=0', {\n-                    'mksnapshot_flags': ['--vector-stores'],\n-                  }],\n-                  ['v8_os_page_size!=0', {\n-                    'mksnapshot_flags': ['--v8_os_page_size', '<(v8_os_page_size)'],\n-                  }],\n-                ],\n-              },\n-              'conditions': [\n-                ['embed_script!=\"\"', {\n-                  'inputs': [\n-                    '<(embed_script)',\n-                  ],\n-                }],\n-                ['warmup_script!=\"\"', {\n-                  'inputs': [\n-                    '<(warmup_script)',\n-                  ],\n-                }],\n-                ['want_separate_host_toolset==1', {\n-                  'target_conditions': [\n-                    ['_toolset==\"host\"', {\n-                      'outputs': [\n-                        '<(PRODUCT_DIR)/snapshot_blob_host.bin',\n-                      ],\n-                      'action': [\n-                        '<(mksnapshot_exec)',\n-                        '<@(mksnapshot_flags)',\n-                        '--startup_blob', '<(PRODUCT_DIR)/snapshot_blob_host.bin',\n-                        '<(embed_script)',\n-                        '<(warmup_script)',\n-                      ],\n-                    }, {\n-                      'outputs': [\n-                        '<(PRODUCT_DIR)/snapshot_blob.bin',\n-                      ],\n-                      'action': [\n-                        '<(mksnapshot_exec)',\n-                        '<@(mksnapshot_flags)',\n-                        '--startup_blob', '<(PRODUCT_DIR)/snapshot_blob.bin',\n-                        '<(embed_script)',\n-                        '<(warmup_script)',\n-                      ],\n-                    }],\n-                  ],\n-                }, {\n-                  'outputs': [\n-                    '<(PRODUCT_DIR)/snapshot_blob.bin',\n-                  ],\n-                  'action': [\n-                    '<(mksnapshot_exec)',\n-                    '<@(mksnapshot_flags)',\n-                    '--startup_blob', '<(PRODUCT_DIR)/snapshot_blob.bin',\n-                    '<(embed_script)',\n-                    '<(warmup_script)',\n-                  ],\n-                }],\n-              ],\n-            },\n-          ],\n-        }],\n-      ],\n-    },\n+    }, # v8_nosnapshot\n     {\n       'target_name': 'v8_base',\n       'type': 'static_library',\n+      # Since this target is a static-library, but as a side effect it generates\n+      # header files, it needs to be a hard dependency.\n+      'hard_dependency': 1,\n+      'includes': [ 'inspector.gypi' ],\n       'dependencies': [\n         'v8_libbase',\n         'v8_libsampler',\n         'v8_torque#host',\n-        'inspector.gyp:protocol_generated_sources#target',\n-        'inspector.gyp:inspector_injected_script#target',\n       ],\n       'direct_dependent_settings': {\n-        'include_dirs+': ['<(SHARED_INTERMEDIATE_DIR)'],\n+        'include_dirs': ['<(SHARED_INTERMEDIATE_DIR)'],\n       },\n       'objs': ['foo.o'],\n       'variables': {\n         'optimize': 'max',\n       },\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n         '<(DEPTH)',\n         '<(SHARED_INTERMEDIATE_DIR)'\n@@ -1636,7 +1554,7 @@\n         '../src/zone/zone-segment.h',\n         '../src/zone/zone.cc',\n         '../src/zone/zone.h',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtin-definitions-from-dsl.h',\n+        '<@(torque_generated_pure_headers)',\n       ],\n       'conditions': [\n         ['want_separate_host_toolset==1', {\n@@ -1948,9 +1866,10 @@\n           ],\n         }],\n         ['v8_postmortem_support==\"true\"', {\n+          'dependencies': [ 'postmortem-metadata#target' ],\n           'sources': [\n             '<(SHARED_INTERMEDIATE_DIR)/debug-support.cc',\n-          ]\n+          ],\n         }],\n         ['v8_enable_i18n_support==1', {\n           'dependencies': [\n@@ -2004,19 +1923,19 @@\n           ],\n         }],\n       ],\n-    },\n+    }, # v8_base\n     {\n       'target_name': 'v8_libbase',\n       'type': '<(component)',\n       'toolsets': ['host', 'target'],\n       'variables': {\n         'optimize': 'max',\n       },\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n       ],\n       'direct_dependent_settings': {\n-        'include_dirs+': ['..'],\n+        'include_dirs': ['..'],\n       },\n       'sources': [\n         '../src/base/adapters.h',\n@@ -2338,7 +2257,7 @@\n           }\n         ],\n       ],\n-    },\n+    }, # v8_libbase\n     {\n       'target_name': 'v8_libplatform',\n       'type': '<(component)',\n@@ -2348,15 +2267,15 @@\n       'dependencies': [\n         'v8_libbase',\n       ],\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n         '<(DEPTH)',\n         '../include/',\n       ],\n       'sources': [\n-        '../include//libplatform/libplatform-export.h',\n-        '../include//libplatform/libplatform.h',\n-        '../include//libplatform/v8-tracing.h',\n+        '../include/libplatform/libplatform-export.h',\n+        '../include/libplatform/libplatform.h',\n+        '../include/libplatform/v8-tracing.h',\n         '../src/libplatform/default-foreground-task-runner.cc',\n         '../src/libplatform/default-foreground-task-runner.h',\n         '../src/libplatform/default-platform.cc',\n@@ -2393,7 +2312,7 @@\n           '../include/',\n         ],\n       },\n-    },\n+    }, # v8_libplatform\n     {\n       'target_name': 'v8_libsampler',\n       'type': 'static_library',\n@@ -2403,7 +2322,7 @@\n       'dependencies': [\n         'v8_libbase',\n       ],\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n         '../include/',\n       ],\n@@ -2423,11 +2342,16 @@\n           '../include/',\n         ],\n       },\n-    },\n+    }, # v8_libsampler\n     {\n       'target_name': 'natives_blob',\n       'type': 'none',\n       'conditions': [\n+        ['want_separate_host_toolset==1', {\n+          'toolsets': ['host', 'target'],\n+        }, {\n+           'toolsets': ['target'],\n+        }],\n         [ 'v8_use_external_startup_data==1', {\n           'conditions': [\n             ['want_separate_host_toolset==1', {\n@@ -2436,51 +2360,99 @@\n               'dependencies': ['js2c'],\n             }],\n           ],\n-          'actions': [{\n-            'action_name': 'concatenate_natives_blob',\n-            'inputs': [\n-              '../tools//concatenate-files.py',\n-              '<(SHARED_INTERMEDIATE_DIR)/libraries.bin',\n-              '<(SHARED_INTERMEDIATE_DIR)/libraries-extras.bin',\n-              '<(SHARED_INTERMEDIATE_DIR)/libraries-experimental-extras.bin',\n-            ],\n-            'conditions': [\n-              ['want_separate_host_toolset==1', {\n-                'target_conditions': [\n-                  ['_toolset==\"host\"', {\n-                    'outputs': [\n-                      '<(PRODUCT_DIR)/natives_blob_host.bin',\n-                    ],\n-                    'action': [\n-                      'python', '<@(_inputs)', '<(PRODUCT_DIR)/natives_blob_host.bin'\n-                    ],\n-                  }, {\n-                    'outputs': [\n-                      '<(PRODUCT_DIR)/natives_blob.bin',\n-                    ],\n-                    'action': [\n-                      'python', '<@(_inputs)', '<(PRODUCT_DIR)/natives_blob.bin'\n-                    ],\n-                  }],\n-                ],\n-              }, {\n-                'outputs': [\n-                  '<(PRODUCT_DIR)/natives_blob.bin',\n-                ],\n-                'action': [\n-                  'python', '<@(_inputs)', '<(PRODUCT_DIR)/natives_blob.bin'\n-                ],\n-              }],\n-            ],\n-          }],\n-        }],\n-        ['want_separate_host_toolset==1', {\n-          'toolsets': ['host', 'target'],\n-        }, {\n-          'toolsets': ['target'],\n+          'actions': [\n+            {\n+              'action_name': 'js2c_bin',\n+              'inputs': [\n+                '../tools/js2c.py',\n+                '<@(library_files)',\n+              ],\n+              'outputs': ['<@(libraries_bin_file)'],\n+              'action': [\n+                'python',\n+                '../tools/js2c.py',\n+                '<(SHARED_INTERMEDIATE_DIR)/libraries.cc',\n+                'CORE',\n+                '<@(library_files)',\n+                '--startup_blob', '<@(libraries_bin_file)',\n+                '--nojs',\n+              ],\n+            },\n+            {\n+              'action_name': 'js2c_extras_bin',\n+              'inputs': [\n+                '../tools/js2c.py',\n+                '<@(v8_extra_library_files)',\n+              ],\n+              'outputs': ['<@(libraries_extras_bin_file)'],\n+              'action': [\n+                'python',\n+                '../tools/js2c.py',\n+                '<(SHARED_INTERMEDIATE_DIR)/extras-libraries.cc',\n+                'EXTRAS',\n+                '<@(v8_extra_library_files)',\n+                '--startup_blob', '<@(libraries_extras_bin_file)',\n+                '--nojs',\n+              ],\n+            },\n+            {\n+              'action_name': 'js2c_experimental_extras_bin',\n+              'inputs': [\n+                '../tools/js2c.py',\n+                '<@(v8_experimental_extra_library_files)',\n+              ],\n+              'outputs': ['<@(libraries_experimental_extras_bin_file)'],\n+              'action': [\n+                'python',\n+                '../tools/js2c.py',\n+                '<(SHARED_INTERMEDIATE_DIR)/experimental-extras-libraries.cc',\n+                'EXPERIMENTAL_EXTRAS',\n+                '<@(v8_experimental_extra_library_files)',\n+                '--startup_blob', '<@(libraries_experimental_extras_bin_file)',\n+                '--nojs',\n+              ],\n+            },\n+            {\n+              'action_name': 'concatenate_natives_blob',\n+              'inputs': [\n+                '../tools/concatenate-files.py',\n+                '<(SHARED_INTERMEDIATE_DIR)/libraries.bin',\n+                '<(SHARED_INTERMEDIATE_DIR)/libraries-extras.bin',\n+                '<(SHARED_INTERMEDIATE_DIR)/libraries-experimental-extras.bin',\n+              ],\n+              'conditions': [\n+                ['want_separate_host_toolset==1', {\n+                  'target_conditions': [\n+                    ['_toolset==\"host\"', {\n+                      'outputs': [\n+                        '<(PRODUCT_DIR)/natives_blob_host.bin',\n+                      ],\n+                      'action': [\n+                        'python', '<@(_inputs)', '<(PRODUCT_DIR)/natives_blob_host.bin'\n+                      ],\n+                    }, {\n+                      'outputs': [\n+                        '<(PRODUCT_DIR)/natives_blob.bin',\n+                      ],\n+                      'action': [\n+                        'python', '<@(_inputs)', '<(PRODUCT_DIR)/natives_blob.bin'\n+                      ],\n+                    }],\n+                  ],\n+                }, {\n+                  'outputs': [\n+                    '<(PRODUCT_DIR)/natives_blob.bin',\n+                  ],\n+                  'action': [\n+                    'python', '<@(_inputs)', '<(PRODUCT_DIR)/natives_blob.bin'\n+                  ],\n+                }],\n+              ],\n+            },\n+          ],\n         }],\n       ]\n-    },\n+    }, # natives_blob\n     {\n       'target_name': 'js2c',\n       'type': 'none',\n@@ -2512,103 +2484,52 @@\n         {\n           'action_name': 'js2c',\n           'inputs': [\n-            '../tools//js2c.py',\n+            '../tools/js2c.py',\n             '<@(library_files)',\n           ],\n           'outputs': ['<(SHARED_INTERMEDIATE_DIR)/libraries.cc'],\n           'action': [\n             'python',\n-            '../tools//js2c.py',\n-            '<(SHARED_INTERMEDIATE_DIR)/libraries.cc',\n-            'CORE',\n-            '<@(library_files)',\n-          ],\n-        },\n-        {\n-          'action_name': 'js2c_bin',\n-          'inputs': [\n-            '../tools//js2c.py',\n-            '<@(library_files)',\n-          ],\n-          'outputs': ['<@(libraries_bin_file)'],\n-          'action': [\n-            'python',\n-            '../tools//js2c.py',\n+            '../tools/js2c.py',\n             '<(SHARED_INTERMEDIATE_DIR)/libraries.cc',\n             'CORE',\n             '<@(library_files)',\n-            '--startup_blob', '<@(libraries_bin_file)',\n-            '--nojs',\n           ],\n         },\n-        {\n+       {\n           'action_name': 'js2c_extras',\n           'inputs': [\n-            '../tools//js2c.py',\n+            '../tools/js2c.py',\n             '<@(v8_extra_library_files)',\n           ],\n           'outputs': ['<(SHARED_INTERMEDIATE_DIR)/extras-libraries.cc'],\n           'action': [\n             'python',\n-            '../tools//js2c.py',\n-            '<(SHARED_INTERMEDIATE_DIR)/extras-libraries.cc',\n-            'EXTRAS',\n-            '<@(v8_extra_library_files)',\n-          ],\n-        },\n-        {\n-          'action_name': 'js2c_extras_bin',\n-          'inputs': [\n-            '../tools//js2c.py',\n-            '<@(v8_extra_library_files)',\n-          ],\n-          'outputs': ['<@(libraries_extras_bin_file)'],\n-          'action': [\n-            'python',\n-            '../tools//js2c.py',\n+            '../tools/js2c.py',\n             '<(SHARED_INTERMEDIATE_DIR)/extras-libraries.cc',\n             'EXTRAS',\n             '<@(v8_extra_library_files)',\n-            '--startup_blob', '<@(libraries_extras_bin_file)',\n-            '--nojs',\n           ],\n         },\n         {\n           'action_name': 'js2c_experimental_extras',\n           'inputs': [\n-            '../tools//js2c.py',\n+            '../tools/js2c.py',\n             '<@(v8_experimental_extra_library_files)',\n           ],\n           'outputs': [\n             '<(SHARED_INTERMEDIATE_DIR)/experimental-extras-libraries.cc',\n           ],\n           'action': [\n             'python',\n-            '../tools//js2c.py',\n-            '<(SHARED_INTERMEDIATE_DIR)/experimental-extras-libraries.cc',\n-            'EXPERIMENTAL_EXTRAS',\n-            '<@(v8_experimental_extra_library_files)',\n-          ],\n-        },\n-        {\n-          'action_name': 'js2c_experimental_extras_bin',\n-          'inputs': [\n-            '../tools//js2c.py',\n-            '<@(v8_experimental_extra_library_files)',\n-          ],\n-          'outputs': ['<@(libraries_experimental_extras_bin_file)'],\n-          'action': [\n-            'python',\n-            '../tools//js2c.py',\n+            '../tools/js2c.py',\n             '<(SHARED_INTERMEDIATE_DIR)/experimental-extras-libraries.cc',\n             'EXPERIMENTAL_EXTRAS',\n             '<@(v8_experimental_extra_library_files)',\n-            '--startup_blob', '<@(libraries_experimental_extras_bin_file)',\n-            '--nojs',\n           ],\n         },\n       ],\n-    },\n+    }, # js2c\n     {\n       'target_name': 'torque',\n       'type': 'executable',\n@@ -2667,7 +2588,7 @@\n         '../src/torque/utils.cc',\n         '../src/torque/utils.h',\n       ],\n-    },\n+    }, # torque_base\n     {\n       'target_name': 'v8_torque',\n       'type': 'none',\n@@ -2704,7 +2625,7 @@\n           'action': ['<@(_inputs)', '-o', '<(SHARED_INTERMEDIATE_DIR)/torque-generated'],\n         },\n       ],\n-    },\n+    }, # torque\n     {\n       'target_name': 'postmortem-metadata',\n       'type': 'none',\n@@ -2738,24 +2659,24 @@\n         ],\n       },\n       'actions': [\n-          {\n-            'action_name': 'gen-postmortem-metadata',\n-            'inputs': [\n-              '../tools//gen-postmortem-metadata.py',\n-              '<@(heapobject_files)',\n-            ],\n-            'outputs': [\n-              '<(SHARED_INTERMEDIATE_DIR)/debug-support.cc',\n-            ],\n-            'action': [\n-              'python',\n-              '../tools//gen-postmortem-metadata.py',\n-              '<@(_outputs)',\n-              '<@(heapobject_files)'\n-            ]\n-          }\n-        ]\n-    },\n+        {\n+          'action_name': 'gen-postmortem-metadata',\n+          'inputs': [\n+            '../tools/gen-postmortem-metadata.py',\n+            '<@(heapobject_files)',\n+          ],\n+          'outputs': [\n+            '<(SHARED_INTERMEDIATE_DIR)/debug-support.cc',\n+          ],\n+          'action': [\n+            'python',\n+            '../tools/gen-postmortem-metadata.py',\n+            '<@(_outputs)',\n+            '<@(heapobject_files)'\n+          ],\n+        },\n+      ],\n+    }, # postmortem-metadata\n     {\n       'target_name': 'mksnapshot',\n       'type': 'executable',\n@@ -2766,7 +2687,7 @@\n         'v8_libplatform',\n         'v8_nosnapshot',\n       ],\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n         '<(DEPTH)',\n       ],\n@@ -2786,53 +2707,9 @@\n           'toolsets': ['target'],\n         }],\n       ],\n-    },\n+    }, # mksnapshot\n     {\n-      'target_name': 'v8_dump_build_config',\n-      'type': 'none',\n-      'variables': {\n-      },\n-      'actions': [\n-        {\n-          'action_name': 'v8_dump_build_config',\n-          'inputs': [\n-            '../tools//testrunner/utils/dump_build_config_gyp.py',\n-          ],\n-          'outputs': [\n-            '<(PRODUCT_DIR)/v8_build_config.json',\n-          ],\n-          'action': [\n-            'python',\n-            '../tools//testrunner/utils/dump_build_config_gyp.py',\n-            '<(PRODUCT_DIR)/v8_build_config.json',\n-            'dcheck_always_on=<(dcheck_always_on)',\n-            'is_asan=<(asan)',\n-            'is_cfi=<(cfi_vptr)',\n-            'is_component_build=<(component)',\n-            'is_debug=<(CONFIGURATION_NAME)',\n-            # Not available in gyp.\n-            'is_gcov_coverage=0',\n-            'is_msan=<(msan)',\n-            'is_tsan=<(tsan)',\n-            # Not available in gyp.\n-            'is_ubsan_vptr=0',\n-            'target_cpu=<(target_arch)',\n-            'v8_enable_i18n_support=<(v8_enable_i18n_support)',\n-            'v8_enable_verify_predictable=<(v8_enable_verify_predictable)',\n-            'v8_target_cpu=<(v8_target_arch)',\n-            'v8_use_snapshot=<(v8_use_snapshot)',\n-          ],\n-          'conditions': [\n-            ['v8_target_arch==\"mips\" or v8_target_arch==\"mipsel\" \\\n-              or v8_target_arch==\"mips64\" or v8_target_arch==\"mips64el\"', {\n-                'action':[\n-                  'mips_arch_variant=<(mips_arch_variant)',\n-                  'mips_use_msa=<(mips_use_msa)',\n-                ],\n-            }],\n-          ],\n-        },\n-      ],\n-    },\n+      'includes': [ 'v8_external_snapshot.gypi' ],\n+    }, # v8_external_snapshot\n   ],\n }"
        },
        {
            "sha": "0a1d7ad5a4b8022e281acea8d98dbc5edbb86816",
            "filename": "deps/v8/gypfiles/v8_external_snapshot.gypi",
            "status": "added",
            "additions": 120,
            "deletions": 0,
            "changes": 120,
            "blob_url": "https://github.com/nodejs/node/blob/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Fv8_external_snapshot.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/9800fd7aaa7226fff3f21edd7f77f563b9a69753/deps%2Fv8%2Fgypfiles%2Fv8_external_snapshot.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Fv8_external_snapshot.gypi?ref=9800fd7aaa7226fff3f21edd7f77f563b9a69753",
            "patch": "@@ -0,0 +1,120 @@\n+# Keeping this separate since Node.js does use it\n+{\n+  'target_name': 'v8_external_snapshot',\n+  'type': 'static_library',\n+  'conditions': [\n+    [ 'v8_use_external_startup_data==1', {\n+      'conditions': [\n+        ['want_separate_host_toolset==1', {\n+          'toolsets': ['host', 'target'],\n+          'dependencies': [\n+            'mksnapshot#host',\n+            'js2c#host',\n+            'natives_blob',\n+        ]}, {\n+          'toolsets': ['target'],\n+          'dependencies': [\n+            'mksnapshot',\n+            'js2c',\n+            'natives_blob',\n+          ],\n+        }],\n+        ['component==\"shared_library\"', {\n+          'defines': [\n+            'BUILDING_V8_SHARED',\n+          ],\n+          'direct_dependent_settings': {\n+            'defines': [\n+              'USING_V8_SHARED',\n+            ],\n+          },\n+        }],\n+      ],\n+      'dependencies': [\n+        'v8_base',\n+      ],\n+      'include_dirs+': [\n+        '..',\n+        '<(DEPTH)',\n+      ],\n+      'sources': [\n+        '../src/setup-isolate-deserialize.cc',\n+        '../src/snapshot/embedded-empty.cc',\n+        '../src/snapshot/natives-external.cc',\n+        '../src/snapshot/snapshot-external.cc',\n+      ],\n+      'actions': [\n+        {\n+          'action_name': 'run_mksnapshot (external)',\n+          'inputs': [\n+            '<(mksnapshot_exec)',\n+          ],\n+          'variables': {\n+            'mksnapshot_flags': [],\n+            'conditions': [\n+              ['v8_random_seed!=0', {\n+                'mksnapshot_flags': ['--random-seed', '<(v8_random_seed)'],\n+              }],\n+              ['v8_vector_stores!=0', {\n+                'mksnapshot_flags': ['--vector-stores'],\n+              }],\n+              ['v8_os_page_size!=0', {\n+                'mksnapshot_flags': ['--v8_os_page_size', '<(v8_os_page_size)'],\n+              }],\n+            ],\n+          },\n+          'conditions': [\n+            ['embed_script!=\"\"', {\n+              'inputs': [\n+                '<(embed_script)',\n+              ],\n+            }],\n+            ['warmup_script!=\"\"', {\n+              'inputs': [\n+                '<(warmup_script)',\n+              ],\n+            }],\n+            ['want_separate_host_toolset==1', {\n+              'target_conditions': [\n+                ['_toolset==\"host\"', {\n+                  'outputs': [\n+                    '<(PRODUCT_DIR)/snapshot_blob_host.bin',\n+                  ],\n+                  'action': [\n+                    '<(mksnapshot_exec)',\n+                    '<@(mksnapshot_flags)',\n+                    '--startup_blob', '<(PRODUCT_DIR)/snapshot_blob_host.bin',\n+                    '<(embed_script)',\n+                    '<(warmup_script)',\n+                  ],\n+                }, {\n+                  'outputs': [\n+                    '<(PRODUCT_DIR)/snapshot_blob.bin',\n+                  ],\n+                  'action': [\n+                    '<(mksnapshot_exec)',\n+                    '<@(mksnapshot_flags)',\n+                    '--startup_blob', '<(PRODUCT_DIR)/snapshot_blob.bin',\n+                    '<(embed_script)',\n+                    '<(warmup_script)',\n+                  ],\n+                }],\n+              ],\n+            }, {\n+              'outputs': [\n+                '<(PRODUCT_DIR)/snapshot_blob.bin',\n+              ],\n+              'action': [\n+                '<(mksnapshot_exec)',\n+                '<@(mksnapshot_flags)',\n+                '--startup_blob', '<(PRODUCT_DIR)/snapshot_blob.bin',\n+                '<(embed_script)',\n+                '<(warmup_script)',\n+              ],\n+            }],\n+          ],\n+        },\n+      ],\n+    }],\n+  ],\n+}"
        },
        {
            "sha": "55ba20e2ecbb5e6285188743fae2852afd464280",
            "filename": "node.gypi",
            "status": "modified",
            "additions": 6,
            "deletions": 15,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/9800fd7aaa7226fff3f21edd7f77f563b9a69753/node.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/9800fd7aaa7226fff3f21edd7f77f563b9a69753/node.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gypi?ref=9800fd7aaa7226fff3f21edd7f77f563b9a69753",
            "patch": "@@ -122,21 +122,12 @@\n     [ 'node_no_browser_globals==\"true\"', {\n       'defines': [ 'NODE_NO_BROWSER_GLOBALS' ],\n     } ],\n-    [ 'node_use_bundled_v8==\"true\" and v8_postmortem_support==\"true\"', {\n-      'conditions': [\n-        # -force_load is not applicable for the static library\n-        [ 'force_load==\"true\"', {\n-          'xcode_settings': {\n-            'OTHER_LDFLAGS': [\n-              '-Wl,-force_load,<(v8_base)',\n-            ],\n-          },\n-        }],\n-        # when building with GN, the v8_monolith target already includes postmortem metadata\n-        [ 'build_v8_with_gn==\"false\"', {\n-          'dependencies': [ 'deps/v8/gypfiles/v8.gyp:postmortem-metadata' ],\n-        }],\n-      ],\n+    [ 'node_use_bundled_v8==\"true\" and v8_postmortem_support==\"true\" and force_load==\"true\"', {\n+      'xcode_settings': {\n+        'OTHER_LDFLAGS': [\n+          '-Wl,-force_load,<(v8_base)',\n+        ],\n+      },\n     }],\n     [ 'node_shared_zlib==\"false\"', {\n       'dependencies': [ 'deps/zlib/zlib.gyp:zlib' ],"
        }
    ],
    "stats": {
        "total": 977,
        "additions": 472,
        "deletions": 505
    }
}