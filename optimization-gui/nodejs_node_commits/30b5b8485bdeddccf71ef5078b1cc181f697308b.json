{
    "author": "maclover7",
    "message": "src: add READONLY_STRING_PROPERTY and simplify config\n\nBit of tidying up where we set different config values.\n\nPR-URL: https://github.com/nodejs/node/pull/22222\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "30b5b8485bdeddccf71ef5078b1cc181f697308b",
    "files": [
        {
            "sha": "62fd4ef81e093cd783d75532eaddd954908678d1",
            "filename": "src/node_config.cc",
            "status": "modified",
            "additions": 25,
            "deletions": 45,
            "changes": 70,
            "blob_url": "https://github.com/nodejs/node/blob/30b5b8485bdeddccf71ef5078b1cc181f697308b/src%2Fnode_config.cc",
            "raw_url": "https://github.com/nodejs/node/raw/30b5b8485bdeddccf71ef5078b1cc181f697308b/src%2Fnode_config.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_config.cc?ref=30b5b8485bdeddccf71ef5078b1cc181f697308b",
            "patch": "@@ -29,6 +29,18 @@ using v8::Value;\n                               True(isolate), ReadOnly).FromJust();            \\\n   } while (0)\n \n+#define READONLY_STRING_PROPERTY(obj, str, val)                                \\\n+  do {                                                                         \\\n+    (obj)->DefineOwnProperty(context,                                          \\\n+                             FIXED_ONE_BYTE_STRING(isolate, str),              \\\n+                             String::NewFromUtf8(                              \\\n+                                 isolate,                                      \\\n+                                 val.data(),                                   \\\n+                                 v8::NewStringType::kNormal).ToLocalChecked(), \\\n+                             ReadOnly).FromJust();                             \\\n+  } while (0)\n+\n+\n #define READONLY_PROPERTY(obj, name, value)                                   \\\n   do {                                                                        \\\n     obj->DefineOwnProperty(env->context(),                                    \\\n@@ -60,13 +72,7 @@ static void Initialize(Local<Object> target,\n   READONLY_BOOLEAN_PROPERTY(\"hasTracing\");\n #endif\n \n-  target->DefineOwnProperty(\n-      context,\n-      FIXED_ONE_BYTE_STRING(isolate, \"icuDataDir\"),\n-      String::NewFromUtf8(isolate,\n-                          icu_data_dir.data(),\n-                          v8::NewStringType::kNormal).ToLocalChecked(),\n-      ReadOnly).FromJust();\n+  READONLY_STRING_PROPERTY(target, \"icuDataDir\", icu_data_dir);\n \n #endif  // NODE_HAVE_I18N_SUPPORT\n \n@@ -78,13 +84,7 @@ static void Initialize(Local<Object> target,\n   if (config_experimental_modules) {\n     READONLY_BOOLEAN_PROPERTY(\"experimentalModules\");\n     if (!config_userland_loader.empty()) {\n-      target->DefineOwnProperty(\n-          context,\n-          FIXED_ONE_BYTE_STRING(isolate, \"userLoader\"),\n-          String::NewFromUtf8(isolate,\n-                              config_userland_loader.data(),\n-                              v8::NewStringType::kNormal).ToLocalChecked(),\n-          ReadOnly).FromJust();\n+      READONLY_STRING_PROPERTY(target, \"userLoader\",  config_userland_loader);\n     }\n   }\n \n@@ -111,41 +111,21 @@ static void Initialize(Local<Object> target,\n                     Number::New(env->isolate(), 8 * sizeof(intptr_t)));\n \n   if (!config_warning_file.empty()) {\n-    target->DefineOwnProperty(\n-        context,\n-        FIXED_ONE_BYTE_STRING(isolate, \"warningFile\"),\n-        String::NewFromUtf8(isolate,\n-                            config_warning_file.data(),\n-                            v8::NewStringType::kNormal).ToLocalChecked(),\n-        ReadOnly).FromJust();\n+    READONLY_STRING_PROPERTY(target, \"warningFile\", config_warning_file);\n   }\n \n   Local<Object> debugOptions = Object::New(isolate);\n+  READONLY_PROPERTY(target, \"debugOptions\", debugOptions);\n+\n+  READONLY_STRING_PROPERTY(debugOptions, \"host\", debug_options.host_name());\n+\n+  READONLY_PROPERTY(debugOptions,\n+                    \"port\",\n+                    Integer::New(isolate, debug_options.port()));\n \n-  target->DefineOwnProperty(\n-      context,\n-      FIXED_ONE_BYTE_STRING(isolate, \"debugOptions\"),\n-      debugOptions, ReadOnly).FromJust();\n-\n-  debugOptions->DefineOwnProperty(\n-      context,\n-      FIXED_ONE_BYTE_STRING(isolate, \"host\"),\n-      String::NewFromUtf8(isolate,\n-                          debug_options.host_name().c_str(),\n-                          v8::NewStringType::kNormal).ToLocalChecked(),\n-      ReadOnly).FromJust();\n-\n-  debugOptions->DefineOwnProperty(\n-      context,\n-      env->port_string(),\n-      Integer::New(isolate, debug_options.port()),\n-      ReadOnly).FromJust();\n-\n-  debugOptions->DefineOwnProperty(\n-      context,\n-      FIXED_ONE_BYTE_STRING(isolate, \"inspectorEnabled\"),\n-      Boolean::New(isolate, debug_options.inspector_enabled()), ReadOnly)\n-          .FromJust();\n+  READONLY_PROPERTY(debugOptions,\n+                    \"inspectorEnabled\",\n+                    Boolean::New(isolate, debug_options.inspector_enabled()));\n }  // InitConfig\n \n }  // namespace node"
        }
    ],
    "stats": {
        "total": 70,
        "additions": 25,
        "deletions": 45
    }
}