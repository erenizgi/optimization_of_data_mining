{
    "author": "addaleax",
    "message": "http: emit timeout duration overflow warning sync\n\nEmit the `TimeoutOverflowWarning` synchronously, even when\nstill connecting, to get a better stack trace.\n\nWith thanks to Anatoli Papirovski for providing helpful\ntips when writing the test.\n\nPR-URL: https://github.com/nodejs/node/pull/18906\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "648d668fcc29dafeb99f90d89087b682457f96b3",
    "files": [
        {
            "sha": "7bf485b47e60aa81d4cf88320841e61586fbc119",
            "filename": "lib/_http_client.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/648d668fcc29dafeb99f90d89087b682457f96b3/lib%2F_http_client.js",
            "raw_url": "https://github.com/nodejs/node/raw/648d668fcc29dafeb99f90d89087b682457f96b3/lib%2F_http_client.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_client.js?ref=648d668fcc29dafeb99f90d89087b682457f96b3",
            "patch": "@@ -40,6 +40,7 @@ const { urlToOptions, searchParamsSymbol } = require('internal/url');\n const { outHeadersKey, ondrain } = require('internal/http');\n const { nextTick } = require('internal/process/next_tick');\n const errors = require('internal/errors');\n+const { validateTimerDuration } = require('internal/timers');\n \n const INVALID_PATH_REGEX = /[^\\u0021-\\u00ff]/;\n \n@@ -678,6 +679,7 @@ function _deferToConnect(method, arguments_, cb) {\n }\n \n ClientRequest.prototype.setTimeout = function setTimeout(msecs, callback) {\n+  msecs = validateTimerDuration(msecs);\n   if (callback) this.once('timeout', callback);\n \n   const emitTimeout = () => this.emit('timeout');"
        },
        {
            "sha": "f11515b95fe3404c2c0f539abe64609a2684d019",
            "filename": "test/parallel/test-http-timeout-client-warning.js",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/648d668fcc29dafeb99f90d89087b682457f96b3/test%2Fparallel%2Ftest-http-timeout-client-warning.js",
            "raw_url": "https://github.com/nodejs/node/raw/648d668fcc29dafeb99f90d89087b682457f96b3/test%2Fparallel%2Ftest-http-timeout-client-warning.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-timeout-client-warning.js?ref=648d668fcc29dafeb99f90d89087b682457f96b3",
            "patch": "@@ -0,0 +1,21 @@\n+'use strict';\n+const common = require('../common');\n+const http = require('http');\n+const assert = require('assert');\n+\n+// Checks that the setTimeout duration overflow warning is emitted\n+// synchronously and therefore contains a meaningful stacktrace.\n+\n+process.on('warning', common.mustCall((warning) => {\n+  assert(warning.stack.includes(__filename));\n+}));\n+\n+const server = http.createServer((req, resp) => resp.end());\n+server.listen(common.mustCall(() => {\n+  http.request(`http://localhost:${server.address().port}`)\n+    .setTimeout(2 ** 40)\n+    .on('response', common.mustCall(() => {\n+      server.close();\n+    }))\n+    .end();\n+}));"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 23,
        "deletions": 0
    }
}