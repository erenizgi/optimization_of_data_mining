{
    "author": "refack",
    "message": "build: reduce chance of unneeded rebuild\n\nRun `node_js2c` and `mkssldef` as actions and not as targets makes sure\nthey are run only once, just before processing the rest of `node_lib`.\nThis helps `make` based dependency change detection be more accurate.\n\nAdd comments with tagrget names for readability.\n\nUse `process_outputs_as_sources` for automatic inclution of outputs.\n\nPR-URL: https://github.com/nodejs/node/pull/23156\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>",
    "sha": "6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b",
    "files": [
        {
            "sha": "6b9aa510f2b89c9a70ad0858895024fd7fbc773f",
            "filename": "Makefile",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b",
            "patch": "@@ -74,9 +74,9 @@ available-node = \\\n # BUILDTYPE=Debug builds both release and debug builds. If you want to compile\n # just the debug build, run `make -C out BUILDTYPE=Debug` instead.\n ifeq ($(BUILDTYPE),Release)\n-all: out/Makefile $(NODE_EXE) ## Default target, builds node in out/Release/node.\n+all: $(NODE_EXE) ## Default target, builds node in out/Release/node.\n else\n-all: out/Makefile $(NODE_EXE) $(NODE_G_EXE)\n+all: $(NODE_EXE) $(NODE_G_EXE)\n endif\n \n .PHONY: help"
        },
        {
            "sha": "af06295a85017310d96198a25fc396f05467ba19",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b",
            "patch": "@@ -22,6 +22,8 @@\n     'node_tag%': '',\n     'uv_library%': 'static_library',\n \n+    'clang%': 0,\n+    \n     'openssl_fips%': '',\n \n     # Default to -O0 for debug builds.\n@@ -91,8 +93,6 @@\n       }],\n       ['OS==\"mac\"', {\n         'clang%': 1,\n-      }, {\n-        'clang%': 0,\n       }],\n     ],\n   },"
        },
        {
            "sha": "c7e55c3ddb0a6a586f4c6675bd68454f4c788407",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 35,
            "deletions": 54,
            "changes": 89,
            "blob_url": "https://github.com/nodejs/node/blob/6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b",
            "patch": "@@ -288,7 +288,7 @@\n                   'sources': [\n                     'tools/msvs/genfiles/node_etw_provider.rc'\n                   ],\n-                }]\n+                }],\n               ],\n             }],\n           ],\n@@ -305,16 +305,11 @@\n           'product_name': '<(node_core_target_name)-win',\n         }],\n       ],\n-    },\n+    }, # node_core_target_name\n     {\n       'target_name': '<(node_lib_target_name)',\n       'type': '<(node_intermediate_lib_type)',\n       'product_name': '<(node_core_target_name)',\n-\n-      'dependencies': [\n-        'node_js2c#host',\n-      ],\n-\n       'includes': [\n         'node.gypi'\n       ],\n@@ -460,7 +455,6 @@\n         '<@(library_files)',\n         # node.gyp is added to the project by default.\n         'common.gypi',\n-        '<(SHARED_INTERMEDIATE_DIR)/node_javascript.cc',\n       ],\n \n       'variables': {\n@@ -618,15 +612,9 @@\n             'src/tls_wrap.h'\n           ],\n         }],\n-      ],\n-    },\n-    {\n-      'target_name': 'mkssldef',\n-      'type': 'none',\n-      # TODO(bnoordhuis) Make all platforms export the same list of symbols.\n-      # Teach mkssldef.py to generate linker maps that UNIX linkers understand.\n-      'conditions': [\n         [ 'use_openssl_def==1', {\n+          # TODO(bnoordhuis) Make all platforms export the same list of symbols.\n+          # Teach mkssldef.py to generate linker maps that UNIX linkers understand.\n           'variables': {\n             'mkssldef_flags': [\n               # Categories to export.\n@@ -656,6 +644,7 @@\n                 'deps/openssl/openssl/util/libssl.num',\n               ],\n               'outputs': ['<(SHARED_INTERMEDIATE_DIR)/openssl.def'],\n+              'process_outputs_as_sources': 1,\n               'action': [\n                 'python',\n                 'tools/mkssldef.py',\n@@ -668,39 +657,12 @@\n           ],\n         }],\n       ],\n-    },\n-    # generate ETW header and resource files\n-    {\n-      'target_name': 'node_etw',\n-      'type': 'none',\n-      'conditions': [\n-        [ 'node_use_etw==\"true\"', {\n-          'actions': [\n-            {\n-              'action_name': 'node_etw',\n-              'inputs': [ 'src/res/node_etw_provider.man' ],\n-              'outputs': [\n-                'tools/msvs/genfiles/node_etw_provider.rc',\n-                'tools/msvs/genfiles/node_etw_provider.h',\n-                'tools/msvs/genfiles/node_etw_providerTEMP.BIN',\n-              ],\n-              'action': [ 'mc <@(_inputs) -h tools/msvs/genfiles -r tools/msvs/genfiles' ]\n-            }\n-          ]\n-        } ]\n-      ]\n-    },\n-    {\n-      'target_name': 'node_js2c',\n-      'type': 'none',\n-      'toolsets': ['host'],\n       'actions': [\n         {\n           'action_name': 'node_js2c',\n           'process_outputs_as_sources': 1,\n           'inputs': [\n             '<@(library_files)',\n-            './config.gypi',\n             'tools/check_macros.py'\n           ],\n           'outputs': [\n@@ -718,14 +680,34 @@\n             }]\n           ],\n           'action': [\n-            'python',\n-            'tools/js2c.py',\n+            'python', 'tools/js2c.py',\n             '<@(_outputs)',\n-            '<@(_inputs)',\n+            '<@(_inputs)', 'config.gypi',\n           ],\n         },\n       ],\n-    }, # end node_js2c\n+    }, # node_lib_target_name\n+    {\n+       # generate ETW header and resource files\n+      'target_name': 'node_etw',\n+      'type': 'none',\n+      'conditions': [\n+        [ 'node_use_etw==\"true\"', {\n+          'actions': [\n+            {\n+              'action_name': 'node_etw',\n+              'inputs': [ 'src/res/node_etw_provider.man' ],\n+              'outputs': [\n+                'tools/msvs/genfiles/node_etw_provider.rc',\n+                'tools/msvs/genfiles/node_etw_provider.h',\n+                'tools/msvs/genfiles/node_etw_providerTEMP.BIN',\n+              ],\n+              'action': [ 'mc <@(_inputs) -h tools/msvs/genfiles -r tools/msvs/genfiles' ]\n+            }\n+          ]\n+        } ]\n+      ]\n+    }, # node_etw\n     {\n       'target_name': 'node_dtrace_header',\n       'type': 'none',\n@@ -753,7 +735,7 @@\n           ]\n         } ],\n       ]\n-    },\n+    }, # node_dtrace_header\n     {\n       'target_name': 'node_dtrace_provider',\n       'type': 'none',\n@@ -788,7 +770,7 @@\n           ],\n         }],\n       ]\n-    },\n+    }, # node_dtrace_provider\n     {\n       'target_name': 'node_dtrace_ustack',\n       'type': 'none',\n@@ -836,7 +818,7 @@\n           ]\n         } ],\n       ]\n-    },\n+    }, # node_dtrace_ustack\n     {\n       'target_name': 'specialize_node_d',\n       'type': 'none',\n@@ -862,7 +844,7 @@\n           ],\n         } ],\n       ]\n-    },\n+    }, # specialize_node_d\n     {\n       # When using shared lib to build executable in Windows, in order to avoid\n       # filename collision, the executable name is node-win.exe. Need to rename\n@@ -890,7 +872,7 @@\n           ],\n         } ],\n       ]\n-    },\n+    }, # rename_node_bin_win\n     {\n       'target_name': 'cctest',\n       'type': 'executable',\n@@ -899,7 +881,6 @@\n         '<(node_lib_target_name)',\n         'rename_node_bin_win',\n         'deps/gtest/gtest.gyp:gtest',\n-        'node_js2c#host',\n         'node_dtrace_header',\n         'node_dtrace_ustack',\n         'node_dtrace_provider',\n@@ -957,7 +938,7 @@\n           'type': 'none',\n         }],\n       ],\n-    }\n+    }, # cctest\n   ], # end targets\n \n   'conditions': ["
        },
        {
            "sha": "fe133039d3d43a0bd74a335a2746110df195298a",
            "filename": "node.gypi",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b/node.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b/node.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gypi?ref=6dd4a077c0fd2bcd964dd6195b80fef66b5e4c3b",
            "patch": "@@ -24,6 +24,16 @@\n     },\n     'force_load%': '<(force_load)',\n   },\n+  # Putting these explicitly here so not to be dependant on common.gypi.\n+  'cflags': [ '-Wall', '-Wextra', '-Wno-unused-parameter', ],\n+  'xcode_settings': {\n+    'WARNING_CFLAGS': [\n+      '-Wall',\n+      '-Wendif-labels',\n+      '-W',\n+      '-Wno-unused-parameter',\n+    ],\n+  },\n   'conditions': [\n     [ 'node_shared==\"false\"', {\n       'msvs_settings': {"
        }
    ],
    "stats": {
        "total": 107,
        "additions": 49,
        "deletions": 58
    }
}