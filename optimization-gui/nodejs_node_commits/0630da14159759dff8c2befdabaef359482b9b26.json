{
    "author": "addaleax",
    "message": "src: make `ZCtx::Init()` non-static\n\nPR-URL: https://github.com/nodejs/node/pull/23019\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>",
    "sha": "0630da14159759dff8c2befdabaef359482b9b26",
    "files": [
        {
            "sha": "288fbd7bcc9bcf3d83f392aaecebe7434d7bc4c3",
            "filename": "src/node_zlib.cc",
            "status": "modified",
            "additions": 38,
            "deletions": 38,
            "changes": 76,
            "blob_url": "https://github.com/nodejs/node/blob/0630da14159759dff8c2befdabaef359482b9b26/src%2Fnode_zlib.cc",
            "raw_url": "https://github.com/nodejs/node/raw/0630da14159759dff8c2befdabaef359482b9b26/src%2Fnode_zlib.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_zlib.cc?ref=0630da14159759dff8c2befdabaef359482b9b26",
            "patch": "@@ -489,8 +489,8 @@ class ZCtx : public AsyncWrap, public ThreadPoolWork {\n           data + Buffer::Length(args[6]));\n     }\n \n-    bool ret = Init(ctx, level, windowBits, memLevel, strategy, write_result,\n-                    write_js_callback, std::move(dictionary));\n+    bool ret = ctx->Init(level, windowBits, memLevel, strategy, write_result,\n+                         write_js_callback, std::move(dictionary));\n     if (ret)\n       ctx->SetDictionary();\n \n@@ -516,70 +516,70 @@ class ZCtx : public AsyncWrap, public ThreadPoolWork {\n     ctx->SetDictionary();\n   }\n \n-  static bool Init(ZCtx* ctx, int level, int windowBits, int memLevel,\n-                   int strategy, uint32_t* write_result,\n-                   Local<Function> write_js_callback,\n-                   std::vector<unsigned char>&& dictionary) {\n-    AllocScope alloc_scope(ctx);\n-    ctx->level_ = level;\n-    ctx->windowBits_ = windowBits;\n-    ctx->memLevel_ = memLevel;\n-    ctx->strategy_ = strategy;\n+  bool Init(int level, int windowBits, int memLevel,\n+            int strategy, uint32_t* write_result,\n+            Local<Function> write_js_callback,\n+            std::vector<unsigned char>&& dictionary) {\n+    AllocScope alloc_scope(this);\n+    level_ = level;\n+    windowBits_ = windowBits;\n+    memLevel_ = memLevel;\n+    strategy_ = strategy;\n \n-    ctx->strm_.zalloc = AllocForZlib;\n-    ctx->strm_.zfree = FreeForZlib;\n-    ctx->strm_.opaque = static_cast<void*>(ctx);\n+    strm_.zalloc = AllocForZlib;\n+    strm_.zfree = FreeForZlib;\n+    strm_.opaque = static_cast<void*>(this);\n \n-    ctx->flush_ = Z_NO_FLUSH;\n+    flush_ = Z_NO_FLUSH;\n \n-    ctx->err_ = Z_OK;\n+    err_ = Z_OK;\n \n-    if (ctx->mode_ == GZIP || ctx->mode_ == GUNZIP) {\n-      ctx->windowBits_ += 16;\n+    if (mode_ == GZIP || mode_ == GUNZIP) {\n+      windowBits_ += 16;\n     }\n \n-    if (ctx->mode_ == UNZIP) {\n-      ctx->windowBits_ += 32;\n+    if (mode_ == UNZIP) {\n+      windowBits_ += 32;\n     }\n \n-    if (ctx->mode_ == DEFLATERAW || ctx->mode_ == INFLATERAW) {\n-      ctx->windowBits_ *= -1;\n+    if (mode_ == DEFLATERAW || mode_ == INFLATERAW) {\n+      windowBits_ *= -1;\n     }\n \n-    switch (ctx->mode_) {\n+    switch (mode_) {\n       case DEFLATE:\n       case GZIP:\n       case DEFLATERAW:\n-        ctx->err_ = deflateInit2(&ctx->strm_,\n-                                 ctx->level_,\n-                                 Z_DEFLATED,\n-                                 ctx->windowBits_,\n-                                 ctx->memLevel_,\n-                                 ctx->strategy_);\n+        err_ = deflateInit2(&strm_,\n+                            level_,\n+                            Z_DEFLATED,\n+                            windowBits_,\n+                            memLevel_,\n+                            strategy_);\n         break;\n       case INFLATE:\n       case GUNZIP:\n       case INFLATERAW:\n       case UNZIP:\n-        ctx->err_ = inflateInit2(&ctx->strm_, ctx->windowBits_);\n+        err_ = inflateInit2(&strm_, windowBits_);\n         break;\n       default:\n         UNREACHABLE();\n     }\n \n-    ctx->dictionary_ = std::move(dictionary);\n+    dictionary_ = std::move(dictionary);\n \n-    ctx->write_in_progress_ = false;\n-    ctx->init_done_ = true;\n+    write_in_progress_ = false;\n+    init_done_ = true;\n \n-    if (ctx->err_ != Z_OK) {\n-      ctx->dictionary_.clear();\n-      ctx->mode_ = NONE;\n+    if (err_ != Z_OK) {\n+      dictionary_.clear();\n+      mode_ = NONE;\n       return false;\n     }\n \n-    ctx->write_result_ = write_result;\n-    ctx->write_js_callback_.Reset(ctx->env()->isolate(), write_js_callback);\n+    write_result_ = write_result;\n+    write_js_callback_.Reset(env()->isolate(), write_js_callback);\n     return true;\n   }\n "
        }
    ],
    "stats": {
        "total": 76,
        "additions": 38,
        "deletions": 38
    }
}