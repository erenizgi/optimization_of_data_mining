{
    "author": "gireeshpunathil",
    "message": "src: unique_ptrs in few lambdas\n\nFew lambdas in src/node_file.cc uses conventional\npointers, turn those into unique_ptr semantics\n\nPR-URL: https://github.com/nodejs/node/pull/23124\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "d407291dcc031e899fc1c52265b33707a1258b59",
    "files": [
        {
            "sha": "6a71ef11240689f61bbe3709425eadf30ffbc393",
            "filename": "src/node_file.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/d407291dcc031e899fc1c52265b33707a1258b59/src%2Fnode_file.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d407291dcc031e899fc1c52265b33707a1258b59/src%2Fnode_file.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.cc?ref=d407291dcc031e899fc1c52265b33707a1258b59",
            "patch": "@@ -163,7 +163,7 @@ inline void FileHandle::Close() {\n     // Do not unref this\n     env()->SetImmediate([](Environment* env, void* data) {\n       char msg[70];\n-      err_detail* detail = static_cast<err_detail*>(data);\n+      std::unique_ptr<err_detail> detail(static_cast<err_detail*>(data));\n       snprintf(msg, arraysize(msg),\n               \"Closing file descriptor %d on garbage collection failed\",\n               detail->fd);\n@@ -173,7 +173,6 @@ inline void FileHandle::Close() {\n       // down the process is the only reasonable thing we can do here.\n       HandleScope handle_scope(env->isolate());\n       env->ThrowUVException(detail->ret, \"close\", msg);\n-      delete detail;\n     }, detail);\n     return;\n   }\n@@ -182,11 +181,10 @@ inline void FileHandle::Close() {\n   // to notify that the file descriptor was gc'd. We want to be noisy about\n   // this because not explicitly closing the FileHandle is a bug.\n   env()->SetUnrefImmediate([](Environment* env, void* data) {\n-    err_detail* detail = static_cast<err_detail*>(data);\n+    std::unique_ptr<err_detail> detail(static_cast<err_detail*>(data));\n     ProcessEmitWarning(env,\n                        \"Closing file descriptor %d on garbage collection\",\n                        detail->fd);\n-    delete detail;\n   }, detail);\n }\n \n@@ -234,7 +232,7 @@ inline MaybeLocal<Promise> FileHandle::ClosePromise() {\n     closing_ = true;\n     CloseReq* req = new CloseReq(env(), promise, object());\n     auto AfterClose = uv_fs_callback_t{[](uv_fs_t* req) {\n-      CloseReq* close = CloseReq::from_req(req);\n+      std::unique_ptr<CloseReq> close(CloseReq::from_req(req));\n       CHECK_NOT_NULL(close);\n       close->file_handle()->AfterClose();\n       Isolate* isolate = close->env()->isolate();\n@@ -243,7 +241,6 @@ inline MaybeLocal<Promise> FileHandle::ClosePromise() {\n       } else {\n         close->Resolve();\n       }\n-      delete close;\n     }};\n     int ret = req->Dispatch(uv_fs_close, fd_, AfterClose);\n     if (ret < 0) {"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 3,
        "deletions": 6
    }
}