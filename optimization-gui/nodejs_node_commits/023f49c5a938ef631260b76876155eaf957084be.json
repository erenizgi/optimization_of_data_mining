{
    "author": "bmeck",
    "message": "module: fix cyclical dynamic import\n\nensures that instantiation result is only used during initial loading\n\nPR-URL: https://github.com/nodejs/node/pull/18965\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Guy Bedford <guybedford@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>\nReviewed-By: Jan Krems <jan.krems@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "023f49c5a938ef631260b76876155eaf957084be",
    "files": [
        {
            "sha": "b3553fc7235d95331a187aa5531a77ee01f1da0f",
            "filename": "lib/internal/loader/ModuleJob.js",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/023f49c5a938ef631260b76876155eaf957084be/lib%2Finternal%2Floader%2FModuleJob.js",
            "raw_url": "https://github.com/nodejs/node/raw/023f49c5a938ef631260b76876155eaf957084be/lib%2Finternal%2Floader%2FModuleJob.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Floader%2FModuleJob.js?ref=023f49c5a938ef631260b76876155eaf957084be",
            "patch": "@@ -50,10 +50,11 @@ class ModuleJob {\n   }\n \n   async instantiate() {\n-    if (this.instantiated) {\n-      return this.instantiated;\n+    if (!this.instantiated) {\n+      return this.instantiated = this._instantiate();\n     }\n-    return this.instantiated = this._instantiate();\n+    await this.instantiated;\n+    return this.module;\n   }\n \n   // This method instantiates the module associated with this job and its"
        },
        {
            "sha": "c8dfff919c2f7ea787a0f2f5a8637eb4bd448bb8",
            "filename": "test/es-module/test-esm-cyclic-dynamic-import.mjs",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/023f49c5a938ef631260b76876155eaf957084be/test%2Fes-module%2Ftest-esm-cyclic-dynamic-import.mjs",
            "raw_url": "https://github.com/nodejs/node/raw/023f49c5a938ef631260b76876155eaf957084be/test%2Fes-module%2Ftest-esm-cyclic-dynamic-import.mjs",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fes-module%2Ftest-esm-cyclic-dynamic-import.mjs?ref=023f49c5a938ef631260b76876155eaf957084be",
            "patch": "@@ -0,0 +1,3 @@\n+// Flags: --experimental-modules\n+import '../common';\n+import('./test-esm-cyclic-dynamic-import');"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 7,
        "deletions": 3
    }
}