{
    "author": "cjihrig",
    "message": "test: use common.canCreateSymLink() consistently\n\nThis commit replaces two ad hoc symlink permission tests with\ncommon.canCreateSymLink().\n\nPR-URL: https://github.com/nodejs/node/pull/20540\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "8e6601a789ec6c3657314f475f1493192a2fda2b",
    "files": [
        {
            "sha": "d7efc748bc9662259c7e4e8e074f0d84f904f61f",
            "filename": "test/parallel/test-fs-realpath.js",
            "status": "modified",
            "additions": 2,
            "deletions": 19,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/8e6601a789ec6c3657314f475f1493192a2fda2b/test%2Fparallel%2Ftest-fs-realpath.js",
            "raw_url": "https://github.com/nodejs/node/raw/8e6601a789ec6c3657314f475f1493192a2fda2b/test%2Fparallel%2Ftest-fs-realpath.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-realpath.js?ref=8e6601a789ec6c3657314f475f1493192a2fda2b",
            "patch": "@@ -27,11 +27,10 @@ const tmpdir = require('../common/tmpdir');\n const assert = require('assert');\n const fs = require('fs');\n const path = require('path');\n-const exec = require('child_process').exec;\n let async_completed = 0;\n let async_expected = 0;\n const unlink = [];\n-let skipSymlinks = false;\n+const skipSymlinks = !common.canCreateSymLink();\n const tmpDir = tmpdir.path;\n \n tmpdir.refresh();\n@@ -45,25 +44,9 @@ if (common.isWindows) {\n     assert\n       .strictEqual(path_left.toLowerCase(), path_right.toLowerCase(), message);\n   };\n-\n-  // On Windows, creating symlinks requires admin privileges.\n-  // We'll only try to run symlink test if we have enough privileges.\n-  try {\n-    exec('whoami /priv', function(err, o) {\n-      if (err || !o.includes('SeCreateSymbolicLinkPrivilege')) {\n-        skipSymlinks = true;\n-      }\n-      runTest();\n-    });\n-  } catch (er) {\n-    // better safe than sorry\n-    skipSymlinks = true;\n-    process.nextTick(runTest);\n-  }\n-} else {\n-  process.nextTick(runTest);\n }\n \n+process.nextTick(runTest);\n \n function tmp(p) {\n   return path.join(tmpDir, p);"
        },
        {
            "sha": "60ab5efa3a1d3d040ed65b18e8083f214d61f1e4",
            "filename": "test/parallel/test-trace-events-fs-sync.js",
            "status": "modified",
            "additions": 2,
            "deletions": 15,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/8e6601a789ec6c3657314f475f1493192a2fda2b/test%2Fparallel%2Ftest-trace-events-fs-sync.js",
            "raw_url": "https://github.com/nodejs/node/raw/8e6601a789ec6c3657314f475f1493192a2fda2b/test%2Fparallel%2Ftest-trace-events-fs-sync.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-trace-events-fs-sync.js?ref=8e6601a789ec6c3657314f475f1493192a2fda2b",
            "patch": "@@ -9,21 +9,8 @@ const traceFile = 'node_trace.1.log';\n \n let gid = 1;\n let uid = 1;\n-let skipSymlinks = false;\n \n-// On Windows, creating symlinks requires admin privileges.\n-// We'll check if we have enough privileges.\n-if (common.isWindows) {\n-  try {\n-    const o = cp.execSync('whoami /priv');\n-    if (!o.includes('SeCreateSymbolicLinkPrivilege')) {\n-      skipSymlinks = true;\n-    }\n-  } catch (er) {\n-    // better safe than sorry\n-    skipSymlinks = true;\n-  }\n-} else {\n+if (!common.isWindows) {\n   gid = process.getgid();\n   uid = process.getuid();\n }\n@@ -111,7 +98,7 @@ tests['fs.sync.write'] = 'fs.writeFileSync(\"fs.txt\", \"123\", \"utf8\");' +\n \n // On windows, we need permissions to test symlink and readlink.\n // We'll only try to run these tests if we have enough privileges.\n-if (!skipSymlinks) {\n+if (common.canCreateSymLink()) {\n   tests['fs.sync.symlink'] = 'fs.writeFileSync(\"fs.txt\", \"123\", \"utf8\");' +\n                              'fs.symlinkSync(\"fs.txt\", \"linkx\");' +\n                              'fs.unlinkSync(\"linkx\");' +"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 4,
        "deletions": 34
    }
}