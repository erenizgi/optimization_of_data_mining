{
    "author": "BeniCheni",
    "message": "tls: update test & docs for ArrayBuffer/DataView\n\nIn tls module, accept ArrayBuffer/DataView in place of isUint8Array in\nthe source code & related test code in \"test-tls-basic-validations.js\",\nper the \"tls\" item in the checklist of the comment in #1826.\n\nPR-URL: https://github.com/nodejs/node/pull/23210\nRefs: https://github.com/nodejs/node/issues/1826\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>",
    "sha": "f5ab9d1765dab78516b16da4ca9ef670c7022328",
    "files": [
        {
            "sha": "0cba4653e7766f8150126b9c3feac49d07a0ff9e",
            "filename": "doc/api/tls.md",
            "status": "modified",
            "additions": 20,
            "deletions": 15,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/f5ab9d1765dab78516b16da4ca9ef670c7022328/doc%2Fapi%2Ftls.md",
            "raw_url": "https://github.com/nodejs/node/raw/f5ab9d1765dab78516b16da4ca9ef670c7022328/doc%2Fapi%2Ftls.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ftls.md?ref=f5ab9d1765dab78516b16da4ca9ef670c7022328",
            "patch": "@@ -856,7 +856,8 @@ changes:\n     description: The `lookup` option is supported now.\n   - version: v8.0.0\n     pr-url: https://github.com/nodejs/node/pull/11984\n-    description: The `ALPNProtocols` option can be a `Uint8Array` now.\n+    description: The `ALPNProtocols` option can be a `TypedArray` or\n+     `DataView` now.\n   - version: v5.3.0, v4.7.0\n     pr-url: https://github.com/nodejs/node/pull/4246\n     description: The `secureContext` option is supported now.\n@@ -884,12 +885,14 @@ changes:\n     verified against the list of supplied CAs. An `'error'` event is emitted if\n     verification fails; `err.code` contains the OpenSSL error code. **Default:**\n     `true`.\n-  * `ALPNProtocols`: {string[]|Buffer[]|Uint8Array[]|Buffer|Uint8Array}\n-    An array of strings, `Buffer`s or `Uint8Array`s, or a single `Buffer` or\n-    `Uint8Array` containing the supported ALPN protocols. `Buffer`s should have\n-    the format `[len][name][len][name]...` e.g. `0x05hello0x05world`, where the\n-    first byte is the length of the next protocol name. Passing an array is\n-    usually much simpler, e.g. `['hello', 'world']`.\n+  * `ALPNProtocols`: {string[]|Buffer[]|TypedArray[]|DataView[]|Buffer|\n+    TypedArray|DataView}\n+    An array of strings, `Buffer`s or `TypedArray`s or `DataView`s, or a\n+    single `Buffer` or `TypedArray` or `DataView` containing the supported ALPN\n+    protocols. `Buffer`s should have the format `[len][name][len][name]...`\n+    e.g. `0x05hello0x05world`, where the first byte is the length of the next\n+    protocol name. Passing an array is usually much simpler, e.g.\n+    `['hello', 'world']`.\n   * `servername`: {string} Server name for the SNI (Server Name Indication) TLS\n     extension.\n   * `checkServerIdentity(servername, cert)` {Function} A callback function\n@@ -1134,20 +1137,22 @@ changes:\n     description: The `options` parameter can now include `clientCertEngine`.\n   - version: v8.0.0\n     pr-url: https://github.com/nodejs/node/pull/11984\n-    description: The `ALPNProtocols` option can be a `Uint8Array` now.\n+    description: The `ALPNProtocols` option can be a `TypedArray` or\n+     `DataView` now.\n   - version: v5.0.0\n     pr-url: https://github.com/nodejs/node/pull/2564\n     description: ALPN options are supported now.\n -->\n \n * `options` {Object}\n-  * `ALPNProtocols`: {string[]|Buffer[]|Uint8Array[]|Buffer|Uint8Array}\n-    An array of strings, `Buffer`s or `Uint8Array`s, or a single `Buffer` or\n-    `Uint8Array` containing the supported ALPN protocols. `Buffer`s should have\n-    the format `[len][name][len][name]...` e.g. `0x05hello0x05world`, where the\n-    first byte is the length of the next protocol name. Passing an array is\n-    usually much simpler, e.g. `['hello', 'world']`.\n-    (Protocols should be ordered by their priority.)\n+  * `ALPNProtocols`: {string[]|Buffer[]|TypedArray[]|DataView[]|Buffer|\n+    TypedArray|DataView}\n+    An array of strings, `Buffer`s or `TypedArray`s or `DataView`s, or a single\n+    `Buffer` or `TypedArray` or `DataView` containing the supported ALPN\n+    protocols. `Buffer`s should have the format `[len][name][len][name]...`\n+    e.g. `0x05hello0x05world`, where the first byte is the length of the next\n+    protocol name. Passing an array is usually much simpler, e.g.\n+    `['hello', 'world']`. (Protocols should be ordered by their priority.)\n   * `clientCertEngine` {string} Name of an OpenSSL engine which can provide the\n     client certificate.\n   * `handshakeTimeout` {number} Abort the connection if the SSL/TLS handshake"
        },
        {
            "sha": "f771a661d076924048d86848884776e467a4ed90",
            "filename": "lib/tls.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/f5ab9d1765dab78516b16da4ca9ef670c7022328/lib%2Ftls.js",
            "raw_url": "https://github.com/nodejs/node/raw/f5ab9d1765dab78516b16da4ca9ef670c7022328/lib%2Ftls.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftls.js?ref=f5ab9d1765dab78516b16da4ca9ef670c7022328",
            "patch": "@@ -25,7 +25,7 @@ const { ERR_TLS_CERT_ALTNAME_INVALID } = require('internal/errors').codes;\n const internalUtil = require('internal/util');\n const internalTLS = require('internal/tls');\n internalUtil.assertCrypto();\n-const { isUint8Array } = require('internal/util/types');\n+const { isArrayBufferView } = require('internal/util/types');\n \n const net = require('net');\n const url = require('url');\n@@ -78,7 +78,7 @@ exports.convertALPNProtocols = function convertALPNProtocols(protocols, out) {\n   // If protocols is Array - translate it into buffer\n   if (Array.isArray(protocols)) {\n     out.ALPNProtocols = convertProtocols(protocols);\n-  } else if (isUint8Array(protocols)) {\n+  } else if (isArrayBufferView(protocols)) {\n     // Copy new buffer not to be modified by user.\n     out.ALPNProtocols = Buffer.from(protocols);\n   }"
        },
        {
            "sha": "d0082edb4631814e65a765fa71bbb90ac996c3e8",
            "filename": "test/parallel/test-tls-basic-validations.js",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/f5ab9d1765dab78516b16da4ca9ef670c7022328/test%2Fparallel%2Ftest-tls-basic-validations.js",
            "raw_url": "https://github.com/nodejs/node/raw/f5ab9d1765dab78516b16da4ca9ef670c7022328/test%2Fparallel%2Ftest-tls-basic-validations.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-basic-validations.js?ref=f5ab9d1765dab78516b16da4ca9ef670c7022328",
            "patch": "@@ -94,8 +94,11 @@ common.expectsError(\n }\n \n {\n-  const buffer = new Uint8Array(Buffer.from('abcd'));\n-  const out = {};\n-  tls.convertALPNProtocols(buffer, out);\n-  assert(out.ALPNProtocols.equals(Buffer.from('abcd')));\n+  const arrayBufferViewStr = 'abcd';\n+  const inputBuffer = Buffer.from(arrayBufferViewStr.repeat(8), 'utf8');\n+  for (const expectView of common.getArrayBufferViews(inputBuffer)) {\n+    const out = {};\n+    tls.convertALPNProtocols(expectView, out);\n+    assert(out.ALPNProtocols.equals(Buffer.from(expectView)));\n+  }\n }"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 29,
        "deletions": 21
    }
}