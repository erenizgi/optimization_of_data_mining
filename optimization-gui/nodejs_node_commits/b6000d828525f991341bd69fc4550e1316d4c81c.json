{
    "author": "MylesBorins",
    "message": "deps: patch V8 to 6.4.388.44\n\nPR-URL: https://github.com/nodejs/node/pull/18687\nRefs: https://github.com/v8/v8/compare/6.4.388.42...6.4.388.44\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Franziska Hinkelmann <franziska.hinkelmann@gmail.com>",
    "sha": "b6000d828525f991341bd69fc4550e1316d4c81c",
    "files": [
        {
            "sha": "c3bd1dfe2dd281ae672ee634099c75f87262326d",
            "filename": "deps/v8/include/v8-version.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Finclude%2Fv8-version.h",
            "raw_url": "https://github.com/nodejs/node/raw/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Finclude%2Fv8-version.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8-version.h?ref=b6000d828525f991341bd69fc4550e1316d4c81c",
            "patch": "@@ -11,7 +11,7 @@\n #define V8_MAJOR_VERSION 6\n #define V8_MINOR_VERSION 4\n #define V8_BUILD_NUMBER 388\n-#define V8_PATCH_LEVEL 42\n+#define V8_PATCH_LEVEL 44\n \n // Use 1 for candidates and 0 otherwise.\n // (Boolean macro values are not supported by all preprocessors.)"
        },
        {
            "sha": "1cbb29905742924ee02f9dc507907cc9778d8e5b",
            "filename": "deps/v8/src/objects-inl.h",
            "status": "modified",
            "additions": 24,
            "deletions": 25,
            "changes": 49,
            "blob_url": "https://github.com/nodejs/node/blob/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Fsrc%2Fobjects-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Fsrc%2Fobjects-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects-inl.h?ref=b6000d828525f991341bd69fc4550e1316d4c81c",
            "patch": "@@ -2231,16 +2231,18 @@ int Map::NumberOfOwnDescriptors() const {\n \n \n void Map::SetNumberOfOwnDescriptors(int number) {\n-  DCHECK(number <= instance_descriptors()->number_of_descriptors());\n+  CHECK_LE(static_cast<unsigned>(number),\n+           static_cast<unsigned>(kMaxNumberOfDescriptors));\n   set_bit_field3(NumberOfOwnDescriptorsBits::update(bit_field3(), number));\n }\n \n int Map::EnumLength() const { return EnumLengthBits::decode(bit_field3()); }\n \n void Map::SetEnumLength(int length) {\n   if (length != kInvalidEnumCacheSentinel) {\n-    DCHECK_GE(length, 0);\n-    DCHECK(length <= NumberOfOwnDescriptors());\n+    DCHECK_LE(length, NumberOfOwnDescriptors());\n+    CHECK_LE(static_cast<unsigned>(length),\n+             static_cast<unsigned>(kMaxNumberOfDescriptors));\n   }\n   set_bit_field3(EnumLengthBits::update(bit_field3(), length));\n }\n@@ -3002,9 +3004,9 @@ int Map::instance_size() const {\n }\n \n void Map::set_instance_size(int value) {\n-  DCHECK_EQ(0, value & (kPointerSize - 1));\n+  CHECK_EQ(0, value & (kPointerSize - 1));\n   value >>= kPointerSizeLog2;\n-  DCHECK(0 <= value && value < 256);\n+  CHECK_LT(static_cast<unsigned>(value), 256);\n   set_instance_size_in_words(value);\n }\n \n@@ -3015,8 +3017,7 @@ int Map::inobject_properties_start_or_constructor_function_index() const {\n \n void Map::set_inobject_properties_start_or_constructor_function_index(\n     int value) {\n-  DCHECK_LE(0, value);\n-  DCHECK_LT(value, 256);\n+  CHECK_LT(static_cast<unsigned>(value), 256);\n   RELAXED_WRITE_BYTE_FIELD(\n       this, kInObjectPropertiesStartOrConstructorFunctionIndexOffset,\n       static_cast<byte>(value));\n@@ -3028,7 +3029,7 @@ int Map::GetInObjectPropertiesStartInWords() const {\n }\n \n void Map::SetInObjectPropertiesStartInWords(int value) {\n-  DCHECK(IsJSObjectMap());\n+  CHECK(IsJSObjectMap());\n   set_inobject_properties_start_or_constructor_function_index(value);\n }\n \n@@ -3044,7 +3045,7 @@ int Map::GetConstructorFunctionIndex() const {\n \n \n void Map::SetConstructorFunctionIndex(int value) {\n-  DCHECK(IsPrimitiveMap());\n+  CHECK(IsPrimitiveMap());\n   set_inobject_properties_start_or_constructor_function_index(value);\n }\n \n@@ -3153,8 +3154,7 @@ int Map::used_or_unused_instance_size_in_words() const {\n }\n \n void Map::set_used_or_unused_instance_size_in_words(int value) {\n-  DCHECK_LE(0, value);\n-  DCHECK_LE(value, 255);\n+  CHECK_LE(static_cast<unsigned>(value), 255);\n   WRITE_BYTE_FIELD(this, kUsedOrUnusedInstanceSizeInWordsOffset,\n                    static_cast<byte>(value));\n }\n@@ -3172,12 +3172,12 @@ int Map::UsedInstanceSize() const {\n void Map::SetInObjectUnusedPropertyFields(int value) {\n   STATIC_ASSERT(JSObject::kFieldsAdded == JSObject::kHeaderSize / kPointerSize);\n   if (!IsJSObjectMap()) {\n-    DCHECK_EQ(0, value);\n+    CHECK_EQ(0, value);\n     set_used_or_unused_instance_size_in_words(0);\n     DCHECK_EQ(0, UnusedPropertyFields());\n     return;\n   }\n-  DCHECK_LE(0, value);\n+  CHECK_LE(0, value);\n   DCHECK_LE(value, GetInObjectProperties());\n   int used_inobject_properties = GetInObjectProperties() - value;\n   set_used_or_unused_instance_size_in_words(\n@@ -3187,8 +3187,7 @@ void Map::SetInObjectUnusedPropertyFields(int value) {\n \n void Map::SetOutOfObjectUnusedPropertyFields(int value) {\n   STATIC_ASSERT(JSObject::kFieldsAdded == JSObject::kHeaderSize / kPointerSize);\n-  DCHECK_LE(0, value);\n-  DCHECK_LT(value, JSObject::kFieldsAdded);\n+  CHECK_LT(static_cast<unsigned>(value), JSObject::kFieldsAdded);\n   // For out of object properties \"used_instance_size_in_words\" byte encodes\n   // the slack in the property array.\n   set_used_or_unused_instance_size_in_words(value);\n@@ -3227,8 +3226,8 @@ void Map::AccountAddedOutOfObjectPropertyField(int unused_in_property_array) {\n   if (unused_in_property_array < 0) {\n     unused_in_property_array += JSObject::kFieldsAdded;\n   }\n-  DCHECK_GE(unused_in_property_array, 0);\n-  DCHECK_LT(unused_in_property_array, JSObject::kFieldsAdded);\n+  CHECK_LT(static_cast<unsigned>(unused_in_property_array),\n+           JSObject::kFieldsAdded);\n   set_used_or_unused_instance_size_in_words(unused_in_property_array);\n   DCHECK_EQ(unused_in_property_array, UnusedPropertyFields());\n }\n@@ -3358,7 +3357,7 @@ bool Map::should_be_fast_prototype_map() const {\n }\n \n void Map::set_elements_kind(ElementsKind elements_kind) {\n-  DCHECK_LT(static_cast<int>(elements_kind), kElementsKindCount);\n+  CHECK_LT(static_cast<int>(elements_kind), kElementsKindCount);\n   DCHECK_LE(kElementsKindCount, 1 << Map::ElementsKindBits::kSize);\n   set_bit_field2(Map::ElementsKindBits::update(bit_field2(), elements_kind));\n   DCHECK(this->elements_kind() == elements_kind);\n@@ -3700,19 +3699,19 @@ Object* Map::prototype_info() const {\n \n \n void Map::set_prototype_info(Object* value, WriteBarrierMode mode) {\n-  DCHECK(is_prototype_map());\n+  CHECK(is_prototype_map());\n   WRITE_FIELD(this, Map::kTransitionsOrPrototypeInfoOffset, value);\n   CONDITIONAL_WRITE_BARRIER(\n       GetHeap(), this, Map::kTransitionsOrPrototypeInfoOffset, value, mode);\n }\n \n \n void Map::SetBackPointer(Object* value, WriteBarrierMode mode) {\n-  DCHECK(instance_type() >= FIRST_JS_RECEIVER_TYPE);\n-  DCHECK(value->IsMap());\n-  DCHECK(GetBackPointer()->IsUndefined(GetIsolate()));\n-  DCHECK(!value->IsMap() ||\n-         Map::cast(value)->GetConstructor() == constructor_or_backpointer());\n+  CHECK_GE(instance_type(), FIRST_JS_RECEIVER_TYPE);\n+  CHECK(value->IsMap());\n+  CHECK(GetBackPointer()->IsUndefined(GetIsolate()));\n+  CHECK_IMPLIES(value->IsMap(), Map::cast(value)->GetConstructor() ==\n+                                    constructor_or_backpointer());\n   set_constructor_or_backpointer(value, mode);\n }\n \n@@ -3743,7 +3742,7 @@ FunctionTemplateInfo* Map::GetFunctionTemplateInfo() const {\n \n void Map::SetConstructor(Object* constructor, WriteBarrierMode mode) {\n   // Never overwrite a back pointer with a constructor.\n-  DCHECK(!constructor_or_backpointer()->IsMap());\n+  CHECK(!constructor_or_backpointer()->IsMap());\n   set_constructor_or_backpointer(constructor, mode);\n }\n "
        },
        {
            "sha": "bd876e67d7b650e35be32d3885c8785024fce999",
            "filename": "deps/v8/src/objects.cc",
            "status": "modified",
            "additions": 20,
            "deletions": 7,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Fsrc%2Fobjects.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Fsrc%2Fobjects.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects.cc?ref=b6000d828525f991341bd69fc4550e1316d4c81c",
            "patch": "@@ -13014,14 +13014,19 @@ MaybeHandle<Map> JSFunction::GetDerivedMap(Isolate* isolate,\n                           constructor_initial_map->UnusedPropertyFields();\n       int instance_size;\n       int in_object_properties;\n-      CalculateInstanceSizeForDerivedClass(function, instance_type,\n-                                           embedder_fields, &instance_size,\n-                                           &in_object_properties);\n+      bool success = CalculateInstanceSizeForDerivedClass(\n+          function, instance_type, embedder_fields, &instance_size,\n+          &in_object_properties);\n \n       int unused_property_fields = in_object_properties - pre_allocated;\n-      Handle<Map> map =\n-          Map::CopyInitialMap(constructor_initial_map, instance_size,\n-                              in_object_properties, unused_property_fields);\n+\n+      Handle<Map> map;\n+      if (success) {\n+        map = Map::CopyInitialMap(constructor_initial_map, instance_size,\n+                                  in_object_properties, unused_property_fields);\n+      } else {\n+        map = Map::CopyInitialMap(constructor_initial_map);\n+      }\n       map->set_new_target_is_base(false);\n \n       JSFunction::SetInitialMap(function, map, prototype);\n@@ -13726,12 +13731,14 @@ void JSFunction::CalculateInstanceSizeHelper(InstanceType instance_type,\n                           requested_embedder_fields;\n }\n \n-void JSFunction::CalculateInstanceSizeForDerivedClass(\n+// static\n+bool JSFunction::CalculateInstanceSizeForDerivedClass(\n     Handle<JSFunction> function, InstanceType instance_type,\n     int requested_embedder_fields, int* instance_size,\n     int* in_object_properties) {\n   Isolate* isolate = function->GetIsolate();\n   int expected_nof_properties = 0;\n+  bool result = true;\n   for (PrototypeIterator iter(isolate, function, kStartAtReceiver);\n        !iter.IsAtEnd(); iter.Advance()) {\n     Handle<JSReceiver> current =\n@@ -13745,6 +13752,11 @@ void JSFunction::CalculateInstanceSizeForDerivedClass(\n         Compiler::Compile(func, Compiler::CLEAR_EXCEPTION)) {\n       DCHECK(shared->is_compiled());\n       expected_nof_properties += shared->expected_nof_properties();\n+    } else if (!shared->is_compiled()) {\n+      // In case there was a compilation error for the constructor we will\n+      // throw an error during instantiation. Hence we directly return 0;\n+      result = false;\n+      break;\n     }\n     if (!IsDerivedConstructor(shared->kind())) {\n       break;\n@@ -13753,6 +13765,7 @@ void JSFunction::CalculateInstanceSizeForDerivedClass(\n   CalculateInstanceSizeHelper(instance_type, true, requested_embedder_fields,\n                               expected_nof_properties, instance_size,\n                               in_object_properties);\n+  return result;\n }\n \n "
        },
        {
            "sha": "521c0e6554932d6d7cd68ab386f7229544896315",
            "filename": "deps/v8/src/objects.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Fsrc%2Fobjects.h",
            "raw_url": "https://github.com/nodejs/node/raw/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Fsrc%2Fobjects.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects.h?ref=b6000d828525f991341bd69fc4550e1316d4c81c",
            "patch": "@@ -4082,7 +4082,7 @@ class JSFunction: public JSObject {\n   DECL_CAST(JSFunction)\n \n   // Calculate the instance size and in-object properties count.\n-  static void CalculateInstanceSizeForDerivedClass(\n+  static bool CalculateInstanceSizeForDerivedClass(\n       Handle<JSFunction> function, InstanceType instance_type,\n       int requested_embedder_fields, int* instance_size,\n       int* in_object_properties);"
        },
        {
            "sha": "6f3a952d1f740a0b59af2dc9943d3fd04bc1ad64",
            "filename": "deps/v8/src/profiler/heap-snapshot-generator.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Fsrc%2Fprofiler%2Fheap-snapshot-generator.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Fsrc%2Fprofiler%2Fheap-snapshot-generator.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fprofiler%2Fheap-snapshot-generator.cc?ref=b6000d828525f991341bd69fc4550e1316d4c81c",
            "patch": "@@ -1113,8 +1113,6 @@ void V8HeapExplorer::ExtractMapReferences(int entry, Map* map) {\n                          constructor_or_backpointer,\n                          Map::kConstructorOrBackPointerOffset);\n   } else {\n-    DCHECK(constructor_or_backpointer->IsJSFunction() ||\n-           constructor_or_backpointer->IsNull(map->GetIsolate()));\n     SetInternalReference(map, entry, \"constructor\", constructor_or_backpointer,\n                          Map::kConstructorOrBackPointerOffset);\n   }"
        },
        {
            "sha": "5a94708ba8ec4e947af7d11924b337f582b12e45",
            "filename": "deps/v8/test/cctest/test-heap-profiler.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Ftest%2Fcctest%2Ftest-heap-profiler.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Ftest%2Fcctest%2Ftest-heap-profiler.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Ftest-heap-profiler.cc?ref=b6000d828525f991341bd69fc4550e1316d4c81c",
            "patch": "@@ -3184,3 +3184,14 @@ TEST(SamplingHeapProfilerSampleDuringDeopt) {\n   CHECK(profile);\n   heap_profiler->StopSamplingHeapProfiler();\n }\n+\n+TEST(HeapSnapshotPrototypeNotJSReceiver) {\n+  LocalContext env;\n+  v8::HandleScope scope(env->GetIsolate());\n+  v8::HeapProfiler* heap_profiler = env->GetIsolate()->GetHeapProfiler();\n+  CompileRun(\n+      \"function object() {}\"\n+      \"object.prototype = 42;\");\n+  const v8::HeapSnapshot* snapshot = heap_profiler->TakeHeapSnapshot();\n+  CHECK(ValidateSnapshot(snapshot));\n+}"
        },
        {
            "sha": "b55b50107ec97701c70326acb196fe8f6f07a6b8",
            "filename": "deps/v8/test/mjsunit/regress/regress-crbug-806388.js",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Ftest%2Fmjsunit%2Fregress%2Fregress-crbug-806388.js",
            "raw_url": "https://github.com/nodejs/node/raw/b6000d828525f991341bd69fc4550e1316d4c81c/deps%2Fv8%2Ftest%2Fmjsunit%2Fregress%2Fregress-crbug-806388.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fmjsunit%2Fregress%2Fregress-crbug-806388.js?ref=b6000d828525f991341bd69fc4550e1316d4c81c",
            "patch": "@@ -0,0 +1,20 @@\n+// Copyright 2018 the V8 project authors. All rights reserved.\n+// Use of this source code is governed by a BSD-style license that can be\n+// found in the LICENSE file.\n+\n+// Flags: --allow-natives-syntax --enable-slow-asserts --expose-gc\n+\n+class Derived extends Array {\n+    constructor(a) {\n+      // Syntax Error.\n+      const a = 1;\n+    }\n+}\n+\n+// Derived is not a subclass of RegExp\n+let o = Reflect.construct(RegExp, [], Derived);\n+o.lastIndex = 0x1234;\n+%HeapObjectVerify(o);\n+\n+gc();\n+%HeapObjectVerify(o);"
        }
    ],
    "stats": {
        "total": 113,
        "additions": 77,
        "deletions": 36
    }
}