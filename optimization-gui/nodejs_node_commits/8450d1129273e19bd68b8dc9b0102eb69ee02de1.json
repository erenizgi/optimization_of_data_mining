{
    "author": "joyeecheung",
    "message": "benchmark: support URL inputs in create-clientrequest\n\nThis patch adds the option in the create-clientrequest benchmark\nto accept URL inputs (as strings or as URL objects) so we can\nmeasure the impact of URL parsing in a more sophisticated use case.\n\nPR-URL: https://github.com/nodejs/node/pull/24302\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "8450d1129273e19bd68b8dc9b0102eb69ee02de1",
    "files": [
        {
            "sha": "76468a49aa083597088e047ed9f700cde30377b0",
            "filename": "benchmark/http/create-clientrequest.js",
            "status": "modified",
            "additions": 40,
            "deletions": 10,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/8450d1129273e19bd68b8dc9b0102eb69ee02de1/benchmark%2Fhttp%2Fcreate-clientrequest.js",
            "raw_url": "https://github.com/nodejs/node/raw/8450d1129273e19bd68b8dc9b0102eb69ee02de1/benchmark%2Fhttp%2Fcreate-clientrequest.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fhttp%2Fcreate-clientrequest.js?ref=8450d1129273e19bd68b8dc9b0102eb69ee02de1",
            "patch": "@@ -2,19 +2,49 @@\n \n const common = require('../common.js');\n const ClientRequest = require('http').ClientRequest;\n-\n+const types = Object.keys(common.urls)\n+  .filter((i) => common.urls[i]\n+  .startsWith('http://'));\n const bench = common.createBenchmark(main, {\n-  len: [1, 8, 16, 32, 64, 128],\n-  n: [1e6]\n+  // Use 'url' to avoid name clash with other http benchmark\n+  url: types.concat(['wpt']),\n+  arg: ['URL', 'string', 'options'],\n+  e: [1]\n });\n \n-function main({ len, n }) {\n-  const path = '/'.repeat(len);\n-  const opts = { path: path, createConnection: function() {} };\n+function noop() {}\n \n-  bench.start();\n-  for (var i = 0; i < n; i++) {\n-    new ClientRequest(opts);\n+function main({ url: type, arg, e }) {\n+  e = +e;\n+  const data = common.bakeUrlData(type, e, false, false)\n+    .filter((i) => i.startsWith('http://'));\n+  const len = data.length;\n+  var result;\n+  var i;\n+  if (arg === 'options') {\n+    const options = data.map((i) => ({\n+      path: new URL(i).path, createConnection: noop\n+    }));\n+    bench.start();\n+    for (i = 0; i < len; i++) {\n+      result = new ClientRequest(options[i]);\n+    }\n+    bench.end(len);\n+  } else if (arg === 'URL') {\n+    const options = data.map((i) => new URL(i));\n+    bench.start();\n+    for (i = 0; i < len; i++) {\n+      result = new ClientRequest(options[i], { createConnection: noop });\n+    }\n+    bench.end(len);\n+  } else if (arg === 'string') {\n+    bench.start();\n+    for (i = 0; i < len; i++) {\n+      result = new ClientRequest(data[i], { createConnection: noop });\n+    }\n+    bench.end(len);\n+  } else {\n+    throw new Error(`Unknown arg type ${arg}`);\n   }\n-  bench.end(n);\n+  require('assert').ok(result);\n }"
        },
        {
            "sha": "65165c4113530137b5cd1dd314341b594e7f0e7a",
            "filename": "test/benchmark/test-benchmark-http.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/8450d1129273e19bd68b8dc9b0102eb69ee02de1/test%2Fbenchmark%2Ftest-benchmark-http.js",
            "raw_url": "https://github.com/nodejs/node/raw/8450d1129273e19bd68b8dc9b0102eb69ee02de1/test%2Fbenchmark%2Ftest-benchmark-http.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fbenchmark%2Ftest-benchmark-http.js?ref=8450d1129273e19bd68b8dc9b0102eb69ee02de1",
            "patch": "@@ -15,6 +15,9 @@ runBenchmark('http',\n              [\n                'benchmarker=test-double-http',\n                'c=1',\n+               'e=0',\n+               'url=long',\n+               'arg=string',\n                'chunkedEnc=true',\n                'chunks=0',\n                'dur=0.1',"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 43,
        "deletions": 10
    }
}