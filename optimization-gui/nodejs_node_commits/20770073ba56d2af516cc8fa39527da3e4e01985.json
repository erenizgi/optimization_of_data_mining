{
    "author": "eduardbme",
    "message": "child_process: spawn ignores options in case args is undefined\n\nspawn method ignores 3-d argument 'options' in case\nthe second one 'args' equals to 'undefined'.\n\nFixes: https://github.com/nodejs/node/issues/24912\n\nPR-URL: https://github.com/nodejs/node/pull/24913\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Franziska Hinkelmann <franziska.hinkelmann@gmail.com>",
    "sha": "20770073ba56d2af516cc8fa39527da3e4e01985",
    "files": [
        {
            "sha": "222df8aed7e8fdb5b60138442ea18adaadb6d462",
            "filename": "lib/child_process.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/20770073ba56d2af516cc8fa39527da3e4e01985/lib%2Fchild_process.js",
            "raw_url": "https://github.com/nodejs/node/raw/20770073ba56d2af516cc8fa39527da3e4e01985/lib%2Fchild_process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fchild_process.js?ref=20770073ba56d2af516cc8fa39527da3e4e01985",
            "patch": "@@ -403,8 +403,9 @@ function normalizeSpawnArguments(file, args, options) {\n \n   if (Array.isArray(args)) {\n     args = args.slice(0);\n-  } else if (args !== undefined &&\n-             (args === null || typeof args !== 'object')) {\n+  } else if (args == null) {\n+    args = [];\n+  } else if (typeof args !== 'object') {\n     throw new ERR_INVALID_ARG_TYPE('args', 'object', args);\n   } else {\n     options = args;"
        },
        {
            "sha": "35a1ea40208adf83ac2cff77d6bb7ecdddf7213b",
            "filename": "test/parallel/test-child-process-spawn-args.js",
            "status": "added",
            "additions": 53,
            "deletions": 0,
            "changes": 53,
            "blob_url": "https://github.com/nodejs/node/blob/20770073ba56d2af516cc8fa39527da3e4e01985/test%2Fparallel%2Ftest-child-process-spawn-args.js",
            "raw_url": "https://github.com/nodejs/node/raw/20770073ba56d2af516cc8fa39527da3e4e01985/test%2Fparallel%2Ftest-child-process-spawn-args.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-child-process-spawn-args.js?ref=20770073ba56d2af516cc8fa39527da3e4e01985",
            "patch": "@@ -0,0 +1,53 @@\n+'use strict';\n+\n+// This test confirms that `undefined`, `null`, and `[]`\n+// can be used as a placeholder for the second argument (`args`) of `spawn()`.\n+// Previously, there was a bug where using `undefined` for the second argument\n+// caused the third argument (`options`) to be ignored.\n+// See https://github.com/nodejs/node/issues/24912.\n+\n+const assert = require('assert');\n+const { spawn } = require('child_process');\n+\n+const common = require('../common');\n+const tmpdir = require('../common/tmpdir');\n+\n+const command = common.isWindows ? 'cd' : 'pwd';\n+const options = { cwd: tmpdir.path };\n+\n+if (common.isWindows) {\n+  // This test is not the case for Windows based systems\n+  // unless the `shell` options equals to `true`\n+\n+  options.shell = true;\n+}\n+\n+const testCases = [\n+  undefined,\n+  null,\n+  [],\n+];\n+\n+const expectedResult = tmpdir.path.trim().toLowerCase();\n+\n+(async () => {\n+  const results = await Promise.all(\n+    testCases.map((testCase) => {\n+      return new Promise((resolve) => {\n+        const subprocess = spawn(command, testCase, options);\n+\n+        let accumulatedData = Buffer.alloc(0);\n+\n+        subprocess.stdout.on('data', common.mustCall((data) => {\n+          accumulatedData = Buffer.concat([accumulatedData, data]);\n+        }));\n+\n+        subprocess.stdout.on('end', () => {\n+          resolve(accumulatedData.toString().trim().toLowerCase());\n+        });\n+      });\n+    })\n+  );\n+\n+  assert.deepStrictEqual([...new Set(results)], [expectedResult]);\n+})();"
        },
        {
            "sha": "738a6f36cfe8104cc34a53cc366dd1cc652570fe",
            "filename": "test/parallel/test-child-process-spawn-typeerror.js",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/20770073ba56d2af516cc8fa39527da3e4e01985/test%2Fparallel%2Ftest-child-process-spawn-typeerror.js",
            "raw_url": "https://github.com/nodejs/node/raw/20770073ba56d2af516cc8fa39527da3e4e01985/test%2Fparallel%2Ftest-child-process-spawn-typeerror.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-child-process-spawn-typeerror.js?ref=20770073ba56d2af516cc8fa39527da3e4e01985",
            "patch": "@@ -33,7 +33,7 @@ const invalidArgValueError =\n   common.expectsError({ code: 'ERR_INVALID_ARG_VALUE', type: TypeError }, 14);\n \n const invalidArgTypeError =\n-  common.expectsError({ code: 'ERR_INVALID_ARG_TYPE', type: TypeError }, 13);\n+  common.expectsError({ code: 'ERR_INVALID_ARG_TYPE', type: TypeError }, 11);\n \n assert.throws(function() {\n   spawn(invalidcmd, 'this is not an array');\n@@ -59,10 +59,6 @@ assert.throws(function() {\n   spawn(file);\n }, invalidArgTypeError);\n \n-assert.throws(function() {\n-  spawn(cmd, null);\n-}, invalidArgTypeError);\n-\n assert.throws(function() {\n   spawn(cmd, true);\n }, invalidArgTypeError);\n@@ -103,9 +99,9 @@ spawn(cmd, o);\n \n // Variants of undefined as explicit 'no argument' at a position.\n spawn(cmd, u, o);\n+spawn(cmd, n, o);\n spawn(cmd, a, u);\n \n-assert.throws(function() { spawn(cmd, n, o); }, invalidArgTypeError);\n assert.throws(function() { spawn(cmd, a, n); }, invalidArgTypeError);\n \n assert.throws(function() { spawn(cmd, s); }, invalidArgTypeError);"
        },
        {
            "sha": "d8dbf9c6bd56d086fc4c458cdfc286b5cda9a9f3",
            "filename": "test/parallel/test-child-process-spawnsync-args.js",
            "status": "added",
            "additions": 45,
            "deletions": 0,
            "changes": 45,
            "blob_url": "https://github.com/nodejs/node/blob/20770073ba56d2af516cc8fa39527da3e4e01985/test%2Fparallel%2Ftest-child-process-spawnsync-args.js",
            "raw_url": "https://github.com/nodejs/node/raw/20770073ba56d2af516cc8fa39527da3e4e01985/test%2Fparallel%2Ftest-child-process-spawnsync-args.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-child-process-spawnsync-args.js?ref=20770073ba56d2af516cc8fa39527da3e4e01985",
            "patch": "@@ -0,0 +1,45 @@\n+'use strict';\n+\n+// This test confirms that `undefined`, `null`, and `[]` can be used\n+// as a placeholder for the second argument (`args`) of `spawnSync()`.\n+// Previously, there was a bug where using `undefined` for the second argument\n+// caused the third argument (`options`) to be ignored.\n+// See https://github.com/nodejs/node/issues/24912.\n+\n+const assert = require('assert');\n+const { spawnSync } = require('child_process');\n+\n+const common = require('../common');\n+const tmpdir = require('../common/tmpdir');\n+\n+const command = common.isWindows ? 'cd' : 'pwd';\n+const options = { cwd: tmpdir.path };\n+\n+if (common.isWindows) {\n+  // This test is not the case for Windows based systems\n+  // unless the `shell` options equals to `true`\n+\n+  options.shell = true;\n+}\n+\n+const testCases = [\n+  undefined,\n+  null,\n+  [],\n+];\n+\n+const expectedResult = tmpdir.path.trim().toLowerCase();\n+\n+const results = testCases.map((testCase) => {\n+  const { stdout, stderr } = spawnSync(\n+    command,\n+    testCase,\n+    options\n+  );\n+\n+  assert.deepStrictEqual(stderr, Buffer.alloc(0));\n+\n+  return stdout.toString().trim().toLowerCase();\n+});\n+\n+assert.deepStrictEqual([...new Set(results)], [expectedResult]);"
        }
    ],
    "stats": {
        "total": 111,
        "additions": 103,
        "deletions": 8
    }
}