{
    "author": "BridgeAR",
    "message": "lib: improve error handling\n\nThis improves the error handling for a couple cases where the\nreceived value would not have been handled so far or where the name\nis wrong etc.\n\nPR-URL: https://github.com/nodejs/node/pull/19445\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "b38c81cb449a822ab45e6caa210d070b91a59836",
    "files": [
        {
            "sha": "5ab6d0bdba74b05fc7138cf3a5109b412e641064",
            "filename": "lib/_http_client.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2F_http_client.js",
            "raw_url": "https://github.com/nodejs/node/raw/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2F_http_client.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_client.js?ref=b38c81cb449a822ab45e6caa210d070b91a59836",
            "patch": "@@ -87,8 +87,9 @@ function ClientRequest(options, cb) {\n     // Explicitly pass through this statement as agent will not be used\n     // when createConnection is provided.\n   } else if (typeof agent.addRequest !== 'function') {\n-    throw new ERR_INVALID_ARG_TYPE('Agent option',\n-                                   ['Agent-like Object', 'undefined', 'false']);\n+    throw new ERR_INVALID_ARG_TYPE('options.agent',\n+                                   ['Agent-like Object', 'undefined', 'false'],\n+                                   agent);\n   }\n   this.agent = agent;\n "
        },
        {
            "sha": "adc4481347f71ab3c3d9a6f2654f99088ecbf975",
            "filename": "lib/_http_outgoing.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2F_http_outgoing.js",
            "raw_url": "https://github.com/nodejs/node/raw/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2F_http_outgoing.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_outgoing.js?ref=b38c81cb449a822ab45e6caa210d070b91a59836",
            "patch": "@@ -755,7 +755,7 @@ OutgoingMessage.prototype.end = function end(chunk, encoding, callback) {\n   var uncork;\n   if (chunk) {\n     if (typeof chunk !== 'string' && !(chunk instanceof Buffer)) {\n-      throw new ERR_INVALID_ARG_TYPE('first argument', ['string', 'Buffer']);\n+      throw new ERR_INVALID_ARG_TYPE('chunk', ['string', 'Buffer'], chunk);\n     }\n     if (!this._header) {\n       if (typeof chunk === 'string')"
        },
        {
            "sha": "686e109ca30b8a019f9c07072fe63d0dbb5774ac",
            "filename": "lib/_tls_wrap.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2F_tls_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2F_tls_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_wrap.js?ref=b38c81cb449a822ab45e6caa210d070b91a59836",
            "patch": "@@ -908,7 +908,8 @@ function Server(options, listener) {\n   this[kSNICallback] = options.SNICallback;\n \n   if (typeof this[kHandshakeTimeout] !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('timeout', 'number');\n+    throw new ERR_INVALID_ARG_TYPE(\n+      'options.handshakeTimeout', 'number', options.handshakeTimeout);\n   }\n \n   if (this.sessionTimeout) {"
        },
        {
            "sha": "45c1282f2d9503548ded65dce3382a26aa36a598",
            "filename": "lib/buffer.js",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2Fbuffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2Fbuffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fbuffer.js?ref=b38c81cb449a822ab45e6caa210d070b91a59836",
            "patch": "@@ -461,7 +461,10 @@ Buffer.concat = function concat(list, length) {\n   for (i = 0; i < list.length; i++) {\n     var buf = list[i];\n     if (!isUint8Array(buf)) {\n-      throw new ERR_INVALID_ARG_TYPE('list', ['Array', 'Buffer', 'Uint8Array']);\n+      // TODO(BridgeAR): This should not be of type ERR_INVALID_ARG_TYPE.\n+      // Instead, find the proper error code for this.\n+      throw new ERR_INVALID_ARG_TYPE(\n+        `list[${i}]`, ['Array', 'Buffer', 'Uint8Array'], list[i]);\n     }\n     _copy(buf, buffer, pos);\n     pos += buf.length;"
        },
        {
            "sha": "1a855f5bf04dc07b0b668e08926e4b6a21b851c4",
            "filename": "lib/internal/http2/compat.js",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "raw_url": "https://github.com/nodejs/node/raw/b38c81cb449a822ab45e6caa210d070b91a59836/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcompat.js?ref=b38c81cb449a822ab45e6caa210d070b91a59836",
            "patch": "@@ -13,6 +13,7 @@ const {\n   ERR_HTTP2_PSEUDOHEADER_NOT_ALLOWED,\n   ERR_HTTP2_STATUS_INVALID,\n   ERR_INVALID_ARG_TYPE,\n+  ERR_INVALID_ARG_VALUE,\n   ERR_INVALID_CALLBACK,\n   ERR_INVALID_HTTP_TOKEN\n } = require('internal/errors').codes;\n@@ -312,8 +313,10 @@ class Http2ServerRequest extends Readable {\n   }\n \n   set method(method) {\n-    if (typeof method !== 'string' || method.trim() === '')\n-      throw new ERR_INVALID_ARG_TYPE('method', 'string');\n+    if (typeof method !== 'string')\n+      throw new ERR_INVALID_ARG_TYPE('method', 'string', method);\n+    if (method.trim() === '')\n+      throw new ERR_INVALID_ARG_VALUE('method', method);\n \n     this[kHeaders][HTTP2_HEADER_METHOD] = method;\n   }"
        },
        {
            "sha": "07c2189d97db432df03db4b71aca5f2c08914a7e",
            "filename": "test/parallel/test-buffer-concat.js",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/b38c81cb449a822ab45e6caa210d070b91a59836/test%2Fparallel%2Ftest-buffer-concat.js",
            "raw_url": "https://github.com/nodejs/node/raw/b38c81cb449a822ab45e6caa210d070b91a59836/test%2Fparallel%2Ftest-buffer-concat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-buffer-concat.js?ref=b38c81cb449a822ab45e6caa210d070b91a59836",
            "patch": "@@ -54,6 +54,24 @@ assert.strictEqual(flatLongLen.toString(), check);\n   });\n });\n \n+[[42], ['hello', Buffer.from('world')]].forEach((value) => {\n+  assert.throws(() => {\n+    Buffer.concat(value);\n+  }, {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    message: 'The \"list[0]\" argument must be one of type Array, Buffer, ' +\n+             `or Uint8Array. Received type ${typeof value[0]}`\n+  });\n+});\n+\n+assert.throws(() => {\n+  Buffer.concat([Buffer.from('hello'), 3]);\n+}, {\n+  code: 'ERR_INVALID_ARG_TYPE',\n+  message: 'The \"list[1]\" argument must be one of type Array, Buffer, ' +\n+           'or Uint8Array. Received type number'\n+});\n+\n // eslint-disable-next-line node-core/crypto-check\n const random10 = common.hasCrypto ?\n   require('crypto').randomBytes(10) :"
        },
        {
            "sha": "27cb77951cf5fd7035fa0bd820271d2aca4dd77d",
            "filename": "test/parallel/test-http-client-reject-unexpected-agent.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/b38c81cb449a822ab45e6caa210d070b91a59836/test%2Fparallel%2Ftest-http-client-reject-unexpected-agent.js",
            "raw_url": "https://github.com/nodejs/node/raw/b38c81cb449a822ab45e6caa210d070b91a59836/test%2Fparallel%2Ftest-http-client-reject-unexpected-agent.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-client-reject-unexpected-agent.js?ref=b38c81cb449a822ab45e6caa210d070b91a59836",
            "patch": "@@ -52,8 +52,8 @@ server.listen(0, baseOptions.host, common.mustCall(function() {\n       {\n         code: 'ERR_INVALID_ARG_TYPE',\n         type: TypeError,\n-        message: 'The \"Agent option\" argument must be one of type ' +\n-                 'Agent-like Object, undefined, or false'\n+        message: 'The \"options.agent\" property must be one of type Agent-like' +\n+                 ` Object, undefined, or false. Received type ${typeof agent}`\n       }\n     );\n   });"
        },
        {
            "sha": "bd46b7190002405a43f7c1cd36eb49623e919338",
            "filename": "test/parallel/test-http2-compat-serverrequest-headers.js",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/b38c81cb449a822ab45e6caa210d070b91a59836/test%2Fparallel%2Ftest-http2-compat-serverrequest-headers.js",
            "raw_url": "https://github.com/nodejs/node/raw/b38c81cb449a822ab45e6caa210d070b91a59836/test%2Fparallel%2Ftest-http2-compat-serverrequest-headers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-compat-serverrequest-headers.js?ref=b38c81cb449a822ab45e6caa210d070b91a59836",
            "patch": "@@ -45,20 +45,21 @@ server.listen(0, common.mustCall(function() {\n     // change the request method\n     request.method = 'POST';\n     assert.strictEqual(request.method, 'POST');\n-    common.expectsError(\n+    assert.throws(\n       () => request.method = '   ',\n       {\n-        code: 'ERR_INVALID_ARG_TYPE',\n-        type: TypeError,\n-        message: 'The \"method\" argument must be of type string'\n+        code: 'ERR_INVALID_ARG_VALUE',\n+        name: 'TypeError [ERR_INVALID_ARG_VALUE]',\n+        message: \"The argument 'method' is invalid. Received '   '\"\n       }\n     );\n     assert.throws(\n       () => request.method = true,\n       {\n         code: 'ERR_INVALID_ARG_TYPE',\n         name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n-        message: 'The \"method\" argument must be of type string'\n+        message: 'The \"method\" argument must be of type string. ' +\n+                 'Received type boolean'\n       }\n     );\n "
        },
        {
            "sha": "74d56546ebb469cab00822340e34399b0d8d94d6",
            "filename": "test/parallel/test-tls-basic-validations.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/b38c81cb449a822ab45e6caa210d070b91a59836/test%2Fparallel%2Ftest-tls-basic-validations.js",
            "raw_url": "https://github.com/nodejs/node/raw/b38c81cb449a822ab45e6caa210d070b91a59836/test%2Fparallel%2Ftest-tls-basic-validations.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-basic-validations.js?ref=b38c81cb449a822ab45e6caa210d070b91a59836",
            "patch": "@@ -26,8 +26,8 @@ common.expectsError(() => tls.createServer({ handshakeTimeout: 'abcd' }),\n                     {\n                       code: 'ERR_INVALID_ARG_TYPE',\n                       type: TypeError,\n-                      message: 'The \"timeout\" argument must ' +\n-                               'be of type number'\n+                      message: 'The \"options.handshakeTimeout\" property must ' +\n+                               'be of type number. Received type string'\n                     }\n );\n "
        }
    ],
    "stats": {
        "total": 59,
        "additions": 43,
        "deletions": 16
    }
}