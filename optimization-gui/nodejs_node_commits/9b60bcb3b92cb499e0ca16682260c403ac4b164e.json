{
    "author": "lundibundi",
    "message": "test: slightly refactor test-child-process-execsync\n\n* move `start` time to the point of execution (avoids counting 'throws'\n  tests towards 'timeout' test case)\n* scope cmd/ret values where possible\n* use `filter` instead of manual if/return\n\nPR-URL: https://github.com/nodejs/node/pull/25227\nRefs: https://github.com/nodejs/node/issues/24921\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "9b60bcb3b92cb499e0ca16682260c403ac4b164e",
    "files": [
        {
            "sha": "d6b6fff968d337ab5fedc40a1ded36b22038a1fe",
            "filename": "test/sequential/test-child-process-execsync.js",
            "status": "modified",
            "additions": 27,
            "deletions": 23,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/9b60bcb3b92cb499e0ca16682260c403ac4b164e/test%2Fsequential%2Ftest-child-process-execsync.js",
            "raw_url": "https://github.com/nodejs/node/raw/9b60bcb3b92cb499e0ca16682260c403ac4b164e/test%2Fsequential%2Ftest-child-process-execsync.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-child-process-execsync.js?ref=9b60bcb3b92cb499e0ca16682260c403ac4b164e",
            "patch": "@@ -28,10 +28,7 @@ const { execFileSync, execSync, spawnSync } = require('child_process');\n const TIMER = 200;\n const SLEEP = 2000;\n \n-const start = Date.now();\n const execOpts = { encoding: 'utf8', shell: true };\n-let err;\n-let caught = false;\n \n // Verify that stderr is not accessed when a bad shell is used\n assert.throws(\n@@ -43,9 +40,11 @@ assert.throws(\n   /spawnSync bad_shell ENOENT/\n );\n \n-let cmd, ret;\n+let caught = false;\n+let ret, err;\n+const start = Date.now();\n try {\n-  cmd = `\"${process.execPath}\" -e \"setTimeout(function(){}, ${SLEEP});\"`;\n+  const cmd = `\"${process.execPath}\" -e \"setTimeout(function(){}, ${SLEEP});\"`;\n   ret = execSync(cmd, { timeout: TIMER });\n } catch (e) {\n   caught = true;\n@@ -69,28 +68,32 @@ const msgBuf = Buffer.from(`${msg}\\n`);\n \n // console.log ends every line with just '\\n', even on Windows.\n \n-cmd = `\"${process.execPath}\" -e \"console.log('${msg}');\"`;\n+const cmd = `\"${process.execPath}\" -e \"console.log('${msg}');\"`;\n \n-ret = execSync(cmd);\n-\n-assert.strictEqual(ret.length, msgBuf.length);\n-assert.deepStrictEqual(ret, msgBuf);\n-\n-ret = execSync(cmd, { encoding: 'utf8' });\n+{\n+  const ret = execSync(cmd);\n+  assert.strictEqual(ret.length, msgBuf.length);\n+  assert.deepStrictEqual(ret, msgBuf);\n+}\n \n-assert.strictEqual(ret, `${msg}\\n`);\n+{\n+  const ret = execSync(cmd, { encoding: 'utf8' });\n+  assert.strictEqual(ret, `${msg}\\n`);\n+}\n \n const args = [\n   '-e',\n   `console.log(\"${msg}\");`\n ];\n-ret = execFileSync(process.execPath, args);\n-\n-assert.deepStrictEqual(ret, msgBuf);\n-\n-ret = execFileSync(process.execPath, args, { encoding: 'utf8' });\n+{\n+  const ret = execFileSync(process.execPath, args);\n+  assert.deepStrictEqual(ret, msgBuf);\n+}\n \n-assert.strictEqual(ret, `${msg}\\n`);\n+{\n+  const ret = execFileSync(process.execPath, args, { encoding: 'utf8' });\n+  assert.strictEqual(ret, `${msg}\\n`);\n+}\n \n // Verify that the cwd option works.\n // See https://github.com/nodejs/node-v0.x-archive/issues/7824.\n@@ -133,10 +136,11 @@ assert.strictEqual(ret, `${msg}\\n`);\n     assert.strictEqual(err.message, msg);\n     assert.strictEqual(err.status, 1);\n     assert.strictEqual(typeof err.pid, 'number');\n-    spawnSyncKeys.forEach((key) => {\n-      if (key === 'pid') return;\n-      assert.deepStrictEqual(err[key], spawnSyncResult[key]);\n-    });\n+    spawnSyncKeys\n+      .filter((key) => key !== 'pid')\n+      .forEach((key) => {\n+        assert.deepStrictEqual(err[key], spawnSyncResult[key]);\n+      });\n     return true;\n   });\n }"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 27,
        "deletions": 23
    }
}