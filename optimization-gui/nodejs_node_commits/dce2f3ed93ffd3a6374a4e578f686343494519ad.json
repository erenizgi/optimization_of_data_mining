{
    "author": "joyeecheung",
    "message": "test: remove duplicate encoding tests in favor of WPT\n\nPR-URL: https://github.com/nodejs/node/pull/25321\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "dce2f3ed93ffd3a6374a4e578f686343494519ad",
    "files": [
        {
            "sha": "8abaee817156f4ca1582ad2adcfc6f5cd27de8e4",
            "filename": "test/parallel/test-whatwg-encoding-api-basics.js",
            "status": "removed",
            "additions": 0,
            "deletions": 74,
            "changes": 74,
            "blob_url": "https://github.com/nodejs/node/blob/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-api-basics.js",
            "raw_url": "https://github.com/nodejs/node/raw/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-api-basics.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-api-basics.js?ref=16dfa0f3097d9d30632e257ba588dce4b555d244",
            "patch": "@@ -1,74 +0,0 @@\n-'use strict';\n-\n-// From: https://github.com/w3c/web-platform-tests/blob/master/encoding/api-basics.html\n-// TODO(joyeecheung): replace this with WPT\n-\n-const common = require('../common');\n-\n-if (!common.hasIntl)\n-  common.skip('missing Intl');\n-\n-const assert = require('assert');\n-\n-function testDecodeSample(encoding, string, bytes) {\n-  assert.strictEqual(\n-    new TextDecoder(encoding).decode(new Uint8Array(bytes)),\n-    string);\n-  assert.strictEqual(\n-    new TextDecoder(encoding).decode(new Uint8Array(bytes).buffer),\n-    string);\n-}\n-\n-// `z` (ASCII U+007A), cent (Latin-1 U+00A2), CJK water (BMP U+6C34),\n-// G-Clef (non-BMP U+1D11E), PUA (BMP U+F8FF), PUA (non-BMP U+10FFFD)\n-// byte-swapped BOM (non-character U+FFFE)\n-const sample = 'z\\xA2\\u6C34\\uD834\\uDD1E\\uF8FF\\uDBFF\\uDFFD\\uFFFE';\n-\n-{\n-  const encoding = 'utf-8';\n-  const string = sample;\n-  const bytes = [\n-    0x7A, 0xC2, 0xA2, 0xE6, 0xB0, 0xB4,\n-    0xF0, 0x9D, 0x84, 0x9E, 0xEF, 0xA3,\n-    0xBF, 0xF4, 0x8F, 0xBF, 0xBD, 0xEF,\n-    0xBF, 0xBE\n-  ];\n-  const encoded = new TextEncoder().encode(string);\n-  assert.deepStrictEqual([].slice.call(encoded), bytes);\n-  assert.strictEqual(\n-    new TextDecoder(encoding).decode(new Uint8Array(bytes)),\n-    string);\n-  assert.strictEqual(\n-    new TextDecoder(encoding).decode(new Uint8Array(bytes).buffer),\n-    string);\n-}\n-\n-testDecodeSample(\n-  'utf-16le',\n-  sample,\n-  [\n-    0x7A, 0x00, 0xA2, 0x00, 0x34, 0x6C,\n-    0x34, 0xD8, 0x1E, 0xDD, 0xFF, 0xF8,\n-    0xFF, 0xDB, 0xFD, 0xDF, 0xFE, 0xFF\n-  ]\n-);\n-\n-testDecodeSample(\n-  'utf-16be',\n-  sample,\n-  [\n-    0x00, 0x7A, 0x00, 0xA2, 0x6C, 0x34,\n-    0xD8, 0x34, 0xDD, 0x1E, 0xF8, 0xFF,\n-    0xDB, 0xFF, 0xDF, 0xFD, 0xFF, 0xFE\n-  ]\n-);\n-\n-testDecodeSample(\n-  'utf-16',\n-  sample,\n-  [\n-    0x7A, 0x00, 0xA2, 0x00, 0x34, 0x6C,\n-    0x34, 0xD8, 0x1E, 0xDD, 0xFF, 0xF8,\n-    0xFF, 0xDB, 0xFD, 0xDF, 0xFE, 0xFF\n-  ]\n-);"
        },
        {
            "sha": "50e054c08cade85443407217530b0037e0947048",
            "filename": "test/parallel/test-whatwg-encoding-custom-fatal-streaming.js",
            "status": "modified",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/dce2f3ed93ffd3a6374a4e578f686343494519ad/test%2Fparallel%2Ftest-whatwg-encoding-custom-fatal-streaming.js",
            "raw_url": "https://github.com/nodejs/node/raw/dce2f3ed93ffd3a6374a4e578f686343494519ad/test%2Fparallel%2Ftest-whatwg-encoding-custom-fatal-streaming.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-custom-fatal-streaming.js?ref=dce2f3ed93ffd3a6374a4e578f686343494519ad",
            "patch": "@@ -8,8 +8,6 @@ const common = require('../common');\n if (!common.hasIntl)\n   common.skip('missing Intl');\n \n-const assert = require('assert');\n-\n {\n   [\n     { encoding: 'utf-8', sequence: [0xC0] },\n@@ -28,12 +26,6 @@ const assert = require('assert');\n           `The encoded data was not valid for encoding ${testCase.encoding}`\n       }\n     );\n-\n-    // TODO(joyeecheung): remove this when WPT is ported\n-    assert.strictEqual(\n-      new TextDecoder(testCase.encoding).decode(data),\n-      '\\uFFFD'\n-    );\n   });\n }\n \n@@ -42,10 +34,6 @@ const assert = require('assert');\n   const odd = new Uint8Array([0x00]);\n   const even = new Uint8Array([0x00, 0x00]);\n \n-  // TODO(joyeecheung): remove this when WPT is ported\n-  assert.strictEqual(decoder.decode(odd, { stream: true }), '');\n-  assert.strictEqual(decoder.decode(odd), '\\u0000');\n-\n   common.expectsError(\n     () => {\n       decoder.decode(even, { stream: true });\n@@ -69,8 +57,4 @@ const assert = require('assert');\n         'The encoded data was not valid for encoding utf-16le'\n     }\n   );\n-\n-  // TODO(joyeecheung): remove this when WPT is ported\n-  assert.strictEqual(decoder.decode(even, { stream: true }), '\\u0000');\n-  assert.strictEqual(decoder.decode(even), '\\u0000');\n }"
        },
        {
            "sha": "08406386a1a25311af692849667d3d99f247f064",
            "filename": "test/parallel/test-whatwg-encoding-custom-textdecoder-fatal.js",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/dce2f3ed93ffd3a6374a4e578f686343494519ad/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder-fatal.js",
            "raw_url": "https://github.com/nodejs/node/raw/dce2f3ed93ffd3a6374a4e578f686343494519ad/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder-fatal.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder-fatal.js?ref=dce2f3ed93ffd3a6374a4e578f686343494519ad",
            "patch": "@@ -8,8 +8,6 @@ const common = require('../common');\n if (!common.hasIntl)\n   common.skip('missing Intl');\n \n-const assert = require('assert');\n-\n const bad = [\n   { encoding: 'utf-8', input: [0xFF], name: 'invalid code' },\n   { encoding: 'utf-8', input: [0xC0], name: 'ends early' },\n@@ -82,11 +80,3 @@ bad.forEach((t) => {\n     }\n   );\n });\n-\n-// TODO(joyeecheung): remove this when WPT is ported\n-{\n-  assert('fatal' in new TextDecoder());\n-  assert.strictEqual(typeof new TextDecoder().fatal, 'boolean');\n-  assert(!new TextDecoder().fatal);\n-  assert(new TextDecoder('utf-8', { fatal: true }).fatal);\n-}"
        },
        {
            "sha": "bba10fbd2279a25fd6994dc9ff024294de34bb6a",
            "filename": "test/parallel/test-whatwg-encoding-custom-textdecoder-utf16-surrogates.js",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/dce2f3ed93ffd3a6374a4e578f686343494519ad/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder-utf16-surrogates.js",
            "raw_url": "https://github.com/nodejs/node/raw/dce2f3ed93ffd3a6374a4e578f686343494519ad/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder-utf16-surrogates.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder-utf16-surrogates.js?ref=dce2f3ed93ffd3a6374a4e578f686343494519ad",
            "patch": "@@ -8,8 +8,6 @@ const common = require('../common');\n if (!common.hasIntl)\n   common.skip('missing Intl');\n \n-const assert = require('assert');\n-\n const bad = [\n   {\n     encoding: 'utf-16le',\n@@ -44,11 +42,6 @@ const bad = [\n ];\n \n bad.forEach((t) => {\n-  // TODO(joyeecheung): remove this when WPT is ported\n-  assert.strictEqual(\n-    new TextDecoder(t.encoding).decode(new Uint8Array(t.input)),\n-    t.expected);\n-\n   common.expectsError(\n     () => {\n       new TextDecoder(t.encoding, { fatal: true })"
        },
        {
            "sha": "7a155cdc537a9c0c1a4a71d0073e9c978a4eff07",
            "filename": "test/parallel/test-whatwg-encoding-surrogates-utf8.js",
            "status": "removed",
            "additions": 0,
            "deletions": 53,
            "changes": 53,
            "blob_url": "https://github.com/nodejs/node/blob/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-surrogates-utf8.js",
            "raw_url": "https://github.com/nodejs/node/raw/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-surrogates-utf8.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-surrogates-utf8.js?ref=16dfa0f3097d9d30632e257ba588dce4b555d244",
            "patch": "@@ -1,53 +0,0 @@\n-'use strict';\n-\n-// From: https://github.com/w3c/web-platform-tests/blob/fa9436d12c/encoding/api-surrogates-utf8.html\n-// TODO(joyeecheung): replace this with WPT\n-\n-require('../common');\n-\n-const assert = require('assert');\n-\n-const badStrings = [\n-  {\n-    input: 'abc123',\n-    expected: [0x61, 0x62, 0x63, 0x31, 0x32, 0x33],\n-    decoded: 'abc123',\n-    name: 'Sanity check'\n-  },\n-  {\n-    input: '\\uD800',\n-    expected: [0xef, 0xbf, 0xbd],\n-    decoded: '\\uFFFD',\n-    name: 'Surrogate half (low)'\n-  },\n-  {\n-    input: '\\uDC00',\n-    expected: [0xef, 0xbf, 0xbd],\n-    decoded: '\\uFFFD',\n-    name: 'Surrogate half (high)'\n-  },\n-  {\n-    input: 'abc\\uD800123',\n-    expected: [0x61, 0x62, 0x63, 0xef, 0xbf, 0xbd, 0x31, 0x32, 0x33],\n-    decoded: 'abc\\uFFFD123',\n-    name: 'Surrogate half (low), in a string'\n-  },\n-  {\n-    input: 'abc\\uDC00123',\n-    expected: [0x61, 0x62, 0x63, 0xef, 0xbf, 0xbd, 0x31, 0x32, 0x33],\n-    decoded: 'abc\\uFFFD123',\n-    name: 'Surrogate half (high), in a string'\n-  },\n-  {\n-    input: '\\uDC00\\uD800',\n-    expected: [0xef, 0xbf, 0xbd, 0xef, 0xbf, 0xbd],\n-    decoded: '\\uFFFD\\uFFFD',\n-    name: 'Wrong order'\n-  }\n-];\n-\n-badStrings.forEach((t) => {\n-  const encoded = new TextEncoder().encode(t.input);\n-  assert.deepStrictEqual([].slice.call(encoded), t.expected);\n-  assert.strictEqual(new TextDecoder('utf-8').decode(encoded), t.decoded);\n-});"
        },
        {
            "sha": "7421965c9fb5178972cb27604ef584ae0576b941",
            "filename": "test/parallel/test-whatwg-encoding-textdecoder-ignorebom.js",
            "status": "removed",
            "additions": 0,
            "deletions": 44,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-textdecoder-ignorebom.js",
            "raw_url": "https://github.com/nodejs/node/raw/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-textdecoder-ignorebom.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-textdecoder-ignorebom.js?ref=16dfa0f3097d9d30632e257ba588dce4b555d244",
            "patch": "@@ -1,44 +0,0 @@\n-'use strict';\n-\n-// From: https://github.com/w3c/web-platform-tests/blob/7f567fa29c/encoding/textdecoder-ignorebom.html\n-// TODO(joyeecheung): replace this with WPT\n-\n-const common = require('../common');\n-\n-if (!common.hasIntl)\n-  common.skip('missing Intl');\n-\n-const assert = require('assert');\n-\n-const cases = [\n-  {\n-    encoding: 'utf-8',\n-    bytes: [0xEF, 0xBB, 0xBF, 0x61, 0x62, 0x63]\n-  },\n-  {\n-    encoding: 'utf-16le',\n-    bytes: [0xFF, 0xFE, 0x61, 0x00, 0x62, 0x00, 0x63, 0x00]\n-  },\n-  {\n-    encoding: 'utf-16be',\n-    bytes: [0xFE, 0xFF, 0x00, 0x61, 0x00, 0x62, 0x00, 0x63]\n-  }\n-];\n-\n-cases.forEach((testCase) => {\n-  const BOM = '\\uFEFF';\n-  let decoder = new TextDecoder(testCase.encoding, { ignoreBOM: true });\n-  const bytes = new Uint8Array(testCase.bytes);\n-  assert.strictEqual(decoder.decode(bytes), `${BOM}abc`);\n-  decoder = new TextDecoder(testCase.encoding, { ignoreBOM: false });\n-  assert.strictEqual(decoder.decode(bytes), 'abc');\n-  decoder = new TextDecoder(testCase.encoding);\n-  assert.strictEqual(decoder.decode(bytes), 'abc');\n-});\n-\n-{\n-  assert('ignoreBOM' in new TextDecoder());\n-  assert.strictEqual(typeof new TextDecoder().ignoreBOM, 'boolean');\n-  assert(!new TextDecoder().ignoreBOM);\n-  assert(new TextDecoder('utf-8', { ignoreBOM: true }).ignoreBOM);\n-}"
        },
        {
            "sha": "acc39a74e5cf56c50f0daf2743ac0bc38e67a446",
            "filename": "test/parallel/test-whatwg-encoding-textdecoder-streaming.js",
            "status": "removed",
            "additions": 0,
            "deletions": 50,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-textdecoder-streaming.js",
            "raw_url": "https://github.com/nodejs/node/raw/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-textdecoder-streaming.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-textdecoder-streaming.js?ref=16dfa0f3097d9d30632e257ba588dce4b555d244",
            "patch": "@@ -1,50 +0,0 @@\n-'use strict';\n-\n-// From: https://github.com/w3c/web-platform-tests/blob/fa9436d12c/encoding/textdecoder-streaming.html\n-// TODO(joyeecheung): replace this with WPT\n-\n-const common = require('../common');\n-\n-if (!common.hasIntl)\n-  common.skip('missing Intl');\n-\n-const assert = require('assert');\n-\n-const string =\n-  '\\x00123ABCabc\\x80\\xFF\\u0100\\u1000\\uFFFD\\uD800\\uDC00\\uDBFF\\uDFFF';\n-const octets = {\n-  'utf-8': [\n-    0x00, 0x31, 0x32, 0x33, 0x41, 0x42, 0x43, 0x61, 0x62, 0x63, 0xc2, 0x80,\n-    0xc3, 0xbf, 0xc4, 0x80, 0xe1, 0x80, 0x80, 0xef, 0xbf, 0xbd, 0xf0, 0x90,\n-    0x80, 0x80, 0xf4, 0x8f, 0xbf, 0xbf],\n-  'utf-16le': [\n-    0x00, 0x00, 0x31, 0x00, 0x32, 0x00, 0x33, 0x00, 0x41, 0x00, 0x42, 0x00,\n-    0x43, 0x00, 0x61, 0x00, 0x62, 0x00, 0x63, 0x00, 0x80, 0x00, 0xFF, 0x00,\n-    0x00, 0x01, 0x00, 0x10, 0xFD, 0xFF, 0x00, 0xD8, 0x00, 0xDC, 0xFF, 0xDB,\n-    0xFF, 0xDF],\n-  'utf-16be': [\n-    0x00, 0x00, 0x00, 0x31, 0x00, 0x32, 0x00, 0x33, 0x00, 0x41, 0x00, 0x42,\n-    0x00, 0x43, 0x00, 0x61, 0x00, 0x62, 0x00, 0x63, 0x00, 0x80, 0x00, 0xFF,\n-    0x01, 0x00, 0x10, 0x00, 0xFF, 0xFD, 0xD8, 0x00, 0xDC, 0x00, 0xDB, 0xFF,\n-    0xDF, 0xFF]\n-};\n-\n-Object.keys(octets).forEach((encoding) => {\n-  if (encoding === 'utf-16be' && !common.hasIntl) {\n-    console.log('skipping utf-16be because missing Intl');\n-    return;\n-  }\n-  for (let len = 1; len <= 5; ++len) {\n-    const encoded = octets[encoding];\n-    const decoder = new TextDecoder(encoding);\n-    let out = '';\n-    for (let i = 0; i < encoded.length; i += len) {\n-      const sub = [];\n-      for (let j = i; j < encoded.length && j < i + len; ++j)\n-        sub.push(encoded[j]);\n-      out += decoder.decode(new Uint8Array(sub), { stream: true });\n-    }\n-    out += decoder.decode();\n-    assert.strictEqual(out, string);\n-  }\n-});"
        },
        {
            "sha": "453b49e5b92730a44b6b013ca6fe7743e353ef39",
            "filename": "test/parallel/test-whatwg-encoding-textencoder-utf16-surrogates.js",
            "status": "removed",
            "additions": 0,
            "deletions": 49,
            "changes": 49,
            "blob_url": "https://github.com/nodejs/node/blob/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-textencoder-utf16-surrogates.js",
            "raw_url": "https://github.com/nodejs/node/raw/16dfa0f3097d9d30632e257ba588dce4b555d244/test%2Fparallel%2Ftest-whatwg-encoding-textencoder-utf16-surrogates.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-textencoder-utf16-surrogates.js?ref=16dfa0f3097d9d30632e257ba588dce4b555d244",
            "patch": "@@ -1,49 +0,0 @@\n-'use strict';\n-\n-// From: https://github.com/w3c/web-platform-tests/blob/fa9436d12c/encoding/textencoder-utf16-surrogates.html\n-// TODO(joyeecheung): replace this with WPT\n-\n-require('../common');\n-\n-const assert = require('assert');\n-\n-const bad = [\n-  {\n-    input: '\\uD800',\n-    expected: '\\uFFFD',\n-    name: 'lone surrogate lead'\n-  },\n-  {\n-    input: '\\uDC00',\n-    expected: '\\uFFFD',\n-    name: 'lone surrogate trail'\n-  },\n-  {\n-    input: '\\uD800\\u0000',\n-    expected: '\\uFFFD\\u0000',\n-    name: 'unmatched surrogate lead'\n-  },\n-  {\n-    input: '\\uDC00\\u0000',\n-    expected: '\\uFFFD\\u0000',\n-    name: 'unmatched surrogate trail'\n-  },\n-  {\n-    input: '\\uDC00\\uD800',\n-    expected: '\\uFFFD\\uFFFD',\n-    name: 'swapped surrogate pair'\n-  },\n-  {\n-    input: '\\uD834\\uDD1E',\n-    expected: '\\uD834\\uDD1E',\n-    name: 'properly encoded MUSICAL SYMBOL G CLEF (U+1D11E)'\n-  }\n-];\n-\n-bad.forEach((t) => {\n-  const encoded = new TextEncoder().encode(t.input);\n-  const decoded = new TextDecoder().decode(encoded);\n-  assert.strictEqual(decoded, t.expected);\n-});\n-\n-assert.strictEqual(new TextEncoder().encode().length, 0);"
        }
    ],
    "stats": {
        "total": 303,
        "additions": 0,
        "deletions": 303
    }
}