{
    "author": "cjihrig",
    "message": "src: use DCHECK_* macros where possible\n\nPR-URL: https://github.com/nodejs/node/pull/25207\nReviewed-By: Michaël Zasso <targos@protonmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Tobias Nießen <tniessen@tnie.de>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "c2b4269b77822aee6d07ae427a3341abdbaa8c3f",
    "files": [
        {
            "sha": "0bae974af7a52c54c2ef2b9134540c73c2efd809",
            "filename": "src/aliased_buffer.h",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Faliased_buffer.h",
            "raw_url": "https://github.com/nodejs/node/raw/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Faliased_buffer.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Faliased_buffer.h?ref=c2b4269b77822aee6d07ae427a3341abdbaa8c3f",
            "patch": "@@ -198,19 +198,15 @@ class AliasedBuffer {\n    *  Set position index to given value.\n    */\n   inline void SetValue(const size_t index, NativeT value) {\n-#if defined(DEBUG) && DEBUG\n-    CHECK_LT(index, count_);\n-#endif\n+    DCHECK_LT(index, count_);\n     buffer_[index] = value;\n   }\n \n   /**\n    *  Get value at position index\n    */\n   inline const NativeT GetValue(const size_t index) const {\n-#if defined(DEBUG) && DEBUG\n-    CHECK_LT(index, count_);\n-#endif\n+    DCHECK_LT(index, count_);\n     return buffer_[index];\n   }\n \n@@ -233,9 +229,9 @@ class AliasedBuffer {\n   // Should only be used on an owning array, not one created as a sub array of\n   // an owning `AliasedBuffer`.\n   void reserve(size_t new_capacity) {\n+    DCHECK_GE(new_capacity, count_);\n+    DCHECK_EQ(byte_offset_, 0);\n #if defined(DEBUG) && DEBUG\n-    CHECK_GE(new_capacity, count_);\n-    CHECK_EQ(byte_offset_, 0);\n     CHECK(free_buffer_);\n #endif\n     const v8::HandleScope handle_scope(isolate_);"
        },
        {
            "sha": "84c449a30814e2858cd02fc58dfe1b57c30b605c",
            "filename": "src/base_object-inl.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Fbase_object-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Fbase_object-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fbase_object-inl.h?ref=c2b4269b77822aee6d07ae427a3341abdbaa8c3f",
            "patch": "@@ -115,8 +115,8 @@ BaseObject::MakeLazilyInitializedJSTemplate(Environment* env) {\n   auto constructor = [](const v8::FunctionCallbackInfo<v8::Value>& args) {\n #ifdef DEBUG\n     CHECK(args.IsConstructCall());\n-    CHECK_GT(args.This()->InternalFieldCount(), 0);\n #endif\n+    DCHECK_GT(args.This()->InternalFieldCount(), 0);\n     args.This()->SetAlignedPointerInInternalField(0, nullptr);\n   };\n "
        },
        {
            "sha": "ed5e42fcbe8e6e8323280b0d9ec03510c30ac288",
            "filename": "src/debug_utils.h",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Fdebug_utils.h",
            "raw_url": "https://github.com/nodejs/node/raw/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Fdebug_utils.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fdebug_utils.h?ref=c2b4269b77822aee6d07ae427a3341abdbaa8c3f",
            "patch": "@@ -68,9 +68,7 @@ template <typename... Args>\n inline void FORCE_INLINE Debug(AsyncWrap* async_wrap,\n                                const char* format,\n                                Args&&... args) {\n-#ifdef DEBUG\n-  CHECK_NOT_NULL(async_wrap);\n-#endif\n+  DCHECK_NOT_NULL(async_wrap);\n   DebugCategory cat =\n       static_cast<DebugCategory>(async_wrap->provider_type());\n   if (!UNLIKELY(async_wrap->env()->debug_enabled(cat)))"
        },
        {
            "sha": "96c6baa4d815e497d5ec71bc072b895f87b3d083",
            "filename": "src/string_decoder.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Fstring_decoder.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Fstring_decoder.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstring_decoder.cc?ref=c2b4269b77822aee6d07ae427a3341abdbaa8c3f",
            "patch": "@@ -123,11 +123,9 @@ MaybeLocal<String> StringDecoder::DecodeData(Isolate* isolate,\n       body = !prepend.IsEmpty() ? prepend : String::Empty(isolate);\n       prepend = Local<String>();\n     } else {\n-#ifdef DEBUG\n       // If not, that means is no character left to finish at this point.\n-      CHECK_EQ(MissingBytes(), 0);\n-      CHECK_EQ(BufferedBytes(), 0);\n-#endif\n+      DCHECK_EQ(MissingBytes(), 0);\n+      DCHECK_EQ(BufferedBytes(), 0);\n \n       // See whether there is a character that we may have to cut off and\n       // finish when receiving the next chunk.\n@@ -136,9 +134,7 @@ MaybeLocal<String> StringDecoder::DecodeData(Isolate* isolate,\n         // This means we'll need to figure out where the character to which\n         // the byte belongs begins.\n         for (size_t i = nread - 1; ; --i) {\n-#ifdef DEBUG\n-          CHECK_LT(i, nread);\n-#endif\n+          DCHECK_LT(i, nread);\n           state_[kBufferedBytes]++;\n           if ((data[i] & 0xC0) == 0x80) {\n             // This byte does not start a character (a \"trailing\" byte)."
        },
        {
            "sha": "7d59d89df783296021dcdf3607c1a60218e754ca",
            "filename": "src/string_search.h",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Fstring_search.h",
            "raw_url": "https://github.com/nodejs/node/raw/c2b4269b77822aee6d07ae427a3341abdbaa8c3f/src%2Fstring_search.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstring_search.h?ref=c2b4269b77822aee6d07ae427a3341abdbaa8c3f",
            "patch": "@@ -37,9 +37,7 @@ class Vector {\n \n   // Access individual vector elements - checks bounds in debug mode.\n   T& operator[](size_t index) const {\n-#ifdef DEBUG\n-    CHECK(index < length_);\n-#endif\n+    DCHECK_LT(index, length_);\n     return start_[is_forward_ ? index : (length_ - index - 1)];\n   }\n "
        }
    ],
    "stats": {
        "total": 32,
        "additions": 10,
        "deletions": 22
    }
}