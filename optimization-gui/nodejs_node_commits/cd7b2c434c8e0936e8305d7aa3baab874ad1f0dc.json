{
    "author": "BridgeAR",
    "message": "benchmark: (assert) refactor\n\nPR-URL: https://github.com/nodejs/node/pull/18320\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc",
    "files": [
        {
            "sha": "9556a81ec3b15109aee5944ffe4c4b1f3cc45c62",
            "filename": "benchmark/assert/deepequal-buffer.js",
            "status": "modified",
            "additions": 8,
            "deletions": 37,
            "changes": 45,
            "blob_url": "https://github.com/nodejs/node/blob/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-buffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-buffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fassert%2Fdeepequal-buffer.js?ref=cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc",
            "patch": "@@ -14,8 +14,6 @@ const bench = common.createBenchmark(main, {\n });\n \n function main({ len, n, method }) {\n-  var i;\n-\n   const data = Buffer.allocUnsafe(len + 1);\n   const actual = Buffer.alloc(len);\n   const expected = Buffer.alloc(len);\n@@ -24,40 +22,13 @@ function main({ len, n, method }) {\n   data.copy(expected);\n   data.copy(expectedWrong);\n \n-  switch (method) {\n-    case '':\n-      // Empty string falls through to next line as default, mostly for tests.\n-    case 'deepEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.deepEqual(actual, expected);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'deepStrictEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.deepStrictEqual(actual, expected);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'notDeepEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.notDeepEqual(actual, expectedWrong);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'notDeepStrictEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.notDeepStrictEqual(actual, expectedWrong);\n-      }\n-      bench.end(n);\n-      break;\n-    default:\n-      throw new Error('Unsupported method');\n+  // eslint-disable-next-line no-restricted-properties\n+  const fn = method !== '' ? assert[method] : assert.deepEqual;\n+  const value2 = method.includes('not') ? expectedWrong : expected;\n+\n+  bench.start();\n+  for (var i = 0; i < n; ++i) {\n+    fn(actual, value2);\n   }\n+  bench.end(n);\n }"
        },
        {
            "sha": "bdd3c5c6b8c5146979d5af8b6bebd8c9781ce69c",
            "filename": "benchmark/assert/deepequal-map.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-map.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-map.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fassert%2Fdeepequal-map.js?ref=cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc",
            "patch": "@@ -117,6 +117,6 @@ function main({ n, len, method }) {\n       benchmark(assert.notDeepEqual, n, values, values2);\n       break;\n     default:\n-      throw new Error('Unsupported method');\n+      throw new Error(`Unsupported method ${method}`);\n   }\n }"
        },
        {
            "sha": "4c95006b3b8bc7cdfdeb23382de1a45b5575719f",
            "filename": "benchmark/assert/deepequal-object.js",
            "status": "modified",
            "additions": 8,
            "deletions": 36,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-object.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-object.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fassert%2Fdeepequal-object.js?ref=cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc",
            "patch": "@@ -28,47 +28,19 @@ function createObj(source, add = '') {\n function main({ size, n, method }) {\n   // TODO: Fix this \"hack\". `n` should not be manipulated.\n   n = n / size;\n-  var i;\n \n   const source = Array.apply(null, Array(size));\n   const actual = createObj(source);\n   const expected = createObj(source);\n   const expectedWrong = createObj(source, '4');\n \n-  switch (method) {\n-    case '':\n-      // Empty string falls through to next line as default, mostly for tests.\n-    case 'deepEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.deepEqual(actual, expected);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'deepStrictEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.deepStrictEqual(actual, expected);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'notDeepEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.notDeepEqual(actual, expectedWrong);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'notDeepStrictEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.notDeepStrictEqual(actual, expectedWrong);\n-      }\n-      bench.end(n);\n-      break;\n-    default:\n-      throw new Error('Unsupported method');\n+  // eslint-disable-next-line no-restricted-properties\n+  const fn = method !== '' ? assert[method] : assert.deepEqual;\n+  const value2 = method.includes('not') ? expectedWrong : expected;\n+\n+  bench.start();\n+  for (var i = 0; i < n; ++i) {\n+    fn(actual, value2);\n   }\n+  bench.end(n);\n }"
        },
        {
            "sha": "90dbf1059361a59b422dee059b2a54f09cca3ffe",
            "filename": "benchmark/assert/deepequal-prims-and-objs-big-array-set.js",
            "status": "modified",
            "additions": 22,
            "deletions": 47,
            "changes": 69,
            "blob_url": "https://github.com/nodejs/node/blob/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-prims-and-objs-big-array-set.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-prims-and-objs-big-array-set.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fassert%2Fdeepequal-prims-and-objs-big-array-set.js?ref=cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc",
            "patch": "@@ -30,12 +30,19 @@ const bench = common.createBenchmark(main, {\n   ]\n });\n \n+function run(fn, n, actual, expected) {\n+  bench.start();\n+  for (var i = 0; i < n; ++i) {\n+    fn(actual, expected);\n+  }\n+  bench.end(n);\n+}\n+\n function main({ n, len, primitive, method }) {\n   const prim = primValues[primitive];\n   const actual = [];\n   const expected = [];\n   const expectedWrong = [];\n-  var i;\n \n   for (var x = 0; x < len; x++) {\n     actual.push(prim);\n@@ -51,69 +58,37 @@ function main({ n, len, primitive, method }) {\n   const expectedWrongSet = new Set(expectedWrong);\n \n   switch (method) {\n+    // Empty string falls through to next line as default, mostly for tests.\n     case '':\n-      // Empty string falls through to next line as default, mostly for tests.\n     case 'deepEqual_Array':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.deepEqual(actual, expected);\n-      }\n-      bench.end(n);\n+      // eslint-disable-next-line no-restricted-properties\n+      run(assert.deepEqual, n, actual, expected);\n       break;\n     case 'deepStrictEqual_Array':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.deepStrictEqual(actual, expected);\n-      }\n-      bench.end(n);\n+      run(assert.deepStrictEqual, n, actual, expected);\n       break;\n     case 'notDeepEqual_Array':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.notDeepEqual(actual, expectedWrong);\n-      }\n-      bench.end(n);\n+      // eslint-disable-next-line no-restricted-properties\n+      run(assert.notDeepEqual, n, actual, expectedWrong);\n       break;\n     case 'notDeepStrictEqual_Array':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.notDeepStrictEqual(actual, expectedWrong);\n-      }\n-      bench.end(n);\n+      run(assert.notDeepStrictEqual, n, actual, expectedWrong);\n       break;\n     case 'deepEqual_Set':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.deepEqual(actualSet, expectedSet);\n-      }\n-      bench.end(n);\n+      // eslint-disable-next-line no-restricted-properties\n+      run(assert.deepEqual, n, actualSet, expectedSet);\n       break;\n     case 'deepStrictEqual_Set':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.deepStrictEqual(actualSet, expectedSet);\n-      }\n-      bench.end(n);\n+      run(assert.deepStrictEqual, n, actualSet, expectedSet);\n       break;\n     case 'notDeepEqual_Set':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.notDeepEqual(actualSet, expectedWrongSet);\n-      }\n-      bench.end(n);\n+      // eslint-disable-next-line no-restricted-properties\n+      run(assert.notDeepEqual, n, actualSet, expectedWrongSet);\n       break;\n     case 'notDeepStrictEqual_Set':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.notDeepStrictEqual(actualSet, expectedWrongSet);\n-      }\n-      bench.end(n);\n+      run(assert.notDeepStrictEqual, n, actualSet, expectedWrongSet);\n       break;\n     default:\n-      throw new Error('Unsupported method');\n+      throw new Error(`Unsupported method \"${method}\"`);\n   }\n }"
        },
        {
            "sha": "ec51201d51839dd530597d978e3f92a71d1936de",
            "filename": "benchmark/assert/deepequal-prims-and-objs-big-loop.js",
            "status": "modified",
            "additions": 8,
            "deletions": 37,
            "changes": 45,
            "blob_url": "https://github.com/nodejs/node/blob/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-prims-and-objs-big-loop.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-prims-and-objs-big-loop.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fassert%2Fdeepequal-prims-and-objs-big-loop.js?ref=cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc",
            "patch": "@@ -29,43 +29,14 @@ function main({ n, primitive, method }) {\n   const actual = prim;\n   const expected = prim;\n   const expectedWrong = 'b';\n-  var i;\n \n-  // Creates new array to avoid loop invariant code motion\n-  switch (method) {\n-    case '':\n-      // Empty string falls through to next line as default, mostly for tests.\n-    case 'deepEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.deepEqual([actual], [expected]);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'deepStrictEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.deepStrictEqual([actual], [expected]);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'notDeepEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.notDeepEqual([actual], [expectedWrong]);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'notDeepStrictEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.notDeepStrictEqual([actual], [expectedWrong]);\n-      }\n-      bench.end(n);\n-      break;\n-    default:\n-      throw new Error('Unsupported method');\n+  // eslint-disable-next-line no-restricted-properties\n+  const fn = method !== '' ? assert[method] : assert.deepEqual;\n+  const value2 = method.includes('not') ? expectedWrong : expected;\n+\n+  bench.start();\n+  for (var i = 0; i < n; ++i) {\n+    fn([actual], [value2]);\n   }\n+  bench.end(n);\n }"
        },
        {
            "sha": "e70ddf10e93626e5320b2335b65ac8c1732e5f9e",
            "filename": "benchmark/assert/deepequal-set.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-set.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-set.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fassert%2Fdeepequal-set.js?ref=cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc",
            "patch": "@@ -126,6 +126,6 @@ function main({ n, len, method }) {\n       benchmark(assert.notDeepEqual, n, values, values2);\n       break;\n     default:\n-      throw new Error('Unsupported method');\n+      throw new Error(`Unsupported method \"${method}\"`);\n   }\n }"
        },
        {
            "sha": "50e6e525b20a0c831b9c7492f0e3cc1eee738987",
            "filename": "benchmark/assert/deepequal-typedarrays.js",
            "status": "modified",
            "additions": 8,
            "deletions": 36,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-typedarrays.js",
            "raw_url": "https://github.com/nodejs/node/raw/cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc/benchmark%2Fassert%2Fdeepequal-typedarrays.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fassert%2Fdeepequal-typedarrays.js?ref=cd7b2c434c8e0936e8305d7aa3baab874ad1f0dc",
            "patch": "@@ -31,42 +31,14 @@ function main({ type, n, len, method }) {\n   const expectedWrong = Buffer.alloc(len);\n   const wrongIndex = Math.floor(len / 2);\n   expectedWrong[wrongIndex] = 123;\n-  var i;\n \n-  switch (method) {\n-    case '':\n-      // Empty string falls through to next line as default, mostly for tests.\n-    case 'deepEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.deepEqual(actual, expected);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'deepStrictEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.deepStrictEqual(actual, expected);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'notDeepEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        // eslint-disable-next-line no-restricted-properties\n-        assert.notDeepEqual(actual, expectedWrong);\n-      }\n-      bench.end(n);\n-      break;\n-    case 'notDeepStrictEqual':\n-      bench.start();\n-      for (i = 0; i < n; ++i) {\n-        assert.notDeepStrictEqual(actual, expectedWrong);\n-      }\n-      bench.end(n);\n-      break;\n-    default:\n-      throw new Error('Unsupported method');\n+  // eslint-disable-next-line no-restricted-properties\n+  const fn = method !== '' ? assert[method] : assert.deepEqual;\n+  const value2 = method.includes('not') ? expectedWrong : expected;\n+\n+  bench.start();\n+  for (var i = 0; i < n; ++i) {\n+    fn(actual, value2);\n   }\n+  bench.end(n);\n }"
        }
    ],
    "stats": {
        "total": 251,
        "additions": 56,
        "deletions": 195
    }
}