{
    "author": "joyeecheung",
    "message": "src: remove internalBinding('config').warningFile\n\nInstead use `require('internal/options')` lazily. Also refactor the\ncall site a bit so that the option is queried only once since it's\nsynchronous anyway.\n\nPR-URL: https://github.com/nodejs/node/pull/24959\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "e9892698655af635f665b7250277fa4c68321313",
    "files": [
        {
            "sha": "698e73d97f14b522a5a978c2a352320bd434cddd",
            "filename": "lib/internal/process/warning.js",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/e9892698655af635f665b7250277fa4c68321313/lib%2Finternal%2Fprocess%2Fwarning.js",
            "raw_url": "https://github.com/nodejs/node/raw/e9892698655af635f665b7250277fa4c68321313/lib%2Finternal%2Fprocess%2Fwarning.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fwarning.js?ref=e9892698655af635f665b7250277fa4c68321313",
            "patch": "@@ -1,11 +1,18 @@\n 'use strict';\n \n-const config = internalBinding('config');\n const prefix = `(${process.release.name}:${process.pid}) `;\n const { ERR_INVALID_ARG_TYPE } = require('internal/errors').codes;\n \n exports.setup = setupProcessWarnings;\n \n+let options;\n+function lazyOption(name) {\n+  if (!options) {\n+    options = require('internal/options');\n+  }\n+  return options.getOptionValue(name);\n+}\n+\n var cachedFd;\n var acquiringFd = false;\n function nop() {}\n@@ -49,11 +56,11 @@ function onAcquired(message) {\n   };\n }\n \n-function acquireFd(cb) {\n+function acquireFd(warningFile, cb) {\n   if (cachedFd === undefined && !acquiringFd) {\n     acquiringFd = true;\n     if (fs === null) fs = require('fs');\n-    fs.open(config.warningFile, 'a', onOpen(cb));\n+    fs.open(warningFile, 'a', onOpen(cb));\n   } else if (cachedFd !== undefined && !acquiringFd) {\n     cb(null, cachedFd);\n   } else {\n@@ -62,8 +69,9 @@ function acquireFd(cb) {\n }\n \n function output(message) {\n-  if (typeof config.warningFile === 'string') {\n-    acquireFd(onAcquired(message));\n+  const warningFile = lazyOption('--redirect-warnings');\n+  if (warningFile) {\n+    acquireFd(warningFile, onAcquired(message));\n     return;\n   }\n   writeOut(message);"
        },
        {
            "sha": "a8ffac2cc158a4bad3fc82aceabb38a3448e0b92",
            "filename": "src/node_config.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/e9892698655af635f665b7250277fa4c68321313/src%2Fnode_config.cc",
            "raw_url": "https://github.com/nodejs/node/raw/e9892698655af635f665b7250277fa4c68321313/src%2Fnode_config.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_config.cc?ref=e9892698655af635f665b7250277fa4c68321313",
            "patch": "@@ -90,11 +90,6 @@ static void Initialize(Local<Object> target,\n                     \"bits\",\n                     Number::New(env->isolate(), 8 * sizeof(intptr_t)));\n \n-  const std::string& warning_file = env->options()->redirect_warnings;\n-  if (!warning_file.empty()) {\n-    READONLY_STRING_PROPERTY(target, \"warningFile\", warning_file);\n-  }\n-\n   Local<Object> debug_options_obj = Object::New(isolate);\n   READONLY_PROPERTY(target, \"debugOptions\", debug_options_obj);\n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 13,
        "deletions": 10
    }
}