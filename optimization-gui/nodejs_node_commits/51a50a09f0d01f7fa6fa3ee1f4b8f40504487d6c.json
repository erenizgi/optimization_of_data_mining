{
    "author": "maclover7",
    "message": "src: use available ReqWrap instance for libuv req\n\nUse available `ReqWrap` descendant to make call to libuv -- avoid doing\ncall with the `ReqWrap`'s request member and then calling `Dispatched()`\nafterwards.\n\nPR-URL: https://github.com/nodejs/node/pull/21980\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "51a50a09f0d01f7fa6fa3ee1f4b8f40504487d6c",
    "files": [
        {
            "sha": "17a44dd784f3ce9d2d2ec0c1f58ddbcb6d958072",
            "filename": "src/node_file.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/51a50a09f0d01f7fa6fa3ee1f4b8f40504487d6c/src%2Fnode_file.cc",
            "raw_url": "https://github.com/nodejs/node/raw/51a50a09f0d01f7fa6fa3ee1f4b8f40504487d6c/src%2Fnode_file.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.cc?ref=51a50a09f0d01f7fa6fa3ee1f4b8f40504487d6c",
            "patch": "@@ -1552,9 +1552,12 @@ static void WriteString(const FunctionCallbackInfo<Value>& args) {\n     len = StringBytes::Write(env->isolate(), *stack_buffer, len, args[1], enc);\n     stack_buffer.SetLengthAndZeroTerminate(len);\n     uv_buf_t uvbuf = uv_buf_init(*stack_buffer, len);\n-    int err = uv_fs_write(env->event_loop(), req_wrap_async->req(),\n-                          fd, &uvbuf, 1, pos, AfterInteger);\n-    req_wrap_async->Dispatched();\n+    int err = req_wrap_async->Dispatch(uv_fs_write,\n+                                       fd,\n+                                       &uvbuf,\n+                                       1,\n+                                       pos,\n+                                       AfterInteger);\n     if (err < 0) {\n       uv_fs_t* uv_req = req_wrap_async->req();\n       uv_req->result = err;"
        },
        {
            "sha": "60a17545427b1615702e1823081fe2504d14983a",
            "filename": "src/stream_wrap.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/51a50a09f0d01f7fa6fa3ee1f4b8f40504487d6c/src%2Fstream_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/51a50a09f0d01f7fa6fa3ee1f4b8f40504487d6c/src%2Fstream_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_wrap.cc?ref=51a50a09f0d01f7fa6fa3ee1f4b8f40504487d6c",
            "patch": "@@ -276,10 +276,7 @@ WriteWrap* LibuvStreamWrap::CreateWriteWrap(Local<Object> object) {\n \n int LibuvStreamWrap::DoShutdown(ShutdownWrap* req_wrap_) {\n   LibuvShutdownWrap* req_wrap = static_cast<LibuvShutdownWrap*>(req_wrap_);\n-  int err;\n-  err = uv_shutdown(req_wrap->req(), stream(), AfterUvShutdown);\n-  req_wrap->Dispatched();\n-  return err;\n+  return req_wrap->Dispatch(uv_shutdown, stream(), AfterUvShutdown);\n }\n \n \n@@ -340,9 +337,14 @@ int LibuvStreamWrap::DoWrite(WriteWrap* req_wrap,\n   LibuvWriteWrap* w = static_cast<LibuvWriteWrap*>(req_wrap);\n   int r;\n   if (send_handle == nullptr) {\n-    r = uv_write(w->req(), stream(), bufs, count, AfterUvWrite);\n+    r = w->Dispatch(uv_write, stream(), bufs, count, AfterUvWrite);\n   } else {\n-    r = uv_write2(w->req(), stream(), bufs, count, send_handle, AfterUvWrite);\n+    r = w->Dispatch(uv_write2,\n+                    stream(),\n+                    bufs,\n+                    count,\n+                    send_handle,\n+                    AfterUvWrite);\n   }\n \n   if (!r) {\n@@ -356,8 +358,6 @@ int LibuvStreamWrap::DoWrite(WriteWrap* req_wrap,\n     }\n   }\n \n-  w->Dispatched();\n-\n   return r;\n }\n "
        }
    ],
    "stats": {
        "total": 25,
        "additions": 14,
        "deletions": 11
    }
}