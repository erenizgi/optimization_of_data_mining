{
    "author": "ZYSzys",
    "message": "lib: move encodeStr function to internal for reusable\n\nPR-URL: https://github.com/nodejs/node/pull/24242\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "db9a7459c3439c282ddcb7353e00491aeb704d22",
    "files": [
        {
            "sha": "ca978eb69d7860120a7a5688959fe7eec8563d22",
            "filename": "lib/internal/querystring.js",
            "status": "modified",
            "additions": 67,
            "deletions": 0,
            "changes": 67,
            "blob_url": "https://github.com/nodejs/node/blob/db9a7459c3439c282ddcb7353e00491aeb704d22/lib%2Finternal%2Fquerystring.js",
            "raw_url": "https://github.com/nodejs/node/raw/db9a7459c3439c282ddcb7353e00491aeb704d22/lib%2Finternal%2Fquerystring.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fquerystring.js?ref=db9a7459c3439c282ddcb7353e00491aeb704d22",
            "patch": "@@ -1,5 +1,7 @@\n 'use strict';\n \n+const { ERR_INVALID_URI } = require('internal/errors').codes;\n+\n const hexTable = new Array(256);\n for (var i = 0; i < 256; ++i)\n   hexTable[i] = '%' + ((i < 16 ? '0' : '') + i.toString(16)).toUpperCase();\n@@ -23,7 +25,72 @@ const isHexTable = [\n   0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0  // ... 256\n ];\n \n+function encodeStr(str, noEscapeTable, hexTable) {\n+  const len = str.length;\n+  if (len === 0)\n+    return '';\n+\n+  var out = '';\n+  var lastPos = 0;\n+\n+  for (var i = 0; i < len; i++) {\n+    var c = str.charCodeAt(i);\n+\n+    // ASCII\n+    if (c < 0x80) {\n+      if (noEscapeTable[c] === 1)\n+        continue;\n+      if (lastPos < i)\n+        out += str.slice(lastPos, i);\n+      lastPos = i + 1;\n+      out += hexTable[c];\n+      continue;\n+    }\n+\n+    if (lastPos < i)\n+      out += str.slice(lastPos, i);\n+\n+    // Multi-byte characters ...\n+    if (c < 0x800) {\n+      lastPos = i + 1;\n+      out += hexTable[0xC0 | (c >> 6)] +\n+             hexTable[0x80 | (c & 0x3F)];\n+      continue;\n+    }\n+    if (c < 0xD800 || c >= 0xE000) {\n+      lastPos = i + 1;\n+      out += hexTable[0xE0 | (c >> 12)] +\n+             hexTable[0x80 | ((c >> 6) & 0x3F)] +\n+             hexTable[0x80 | (c & 0x3F)];\n+      continue;\n+    }\n+    // Surrogate pair\n+    ++i;\n+\n+    // This branch should never happen because all URLSearchParams entries\n+    // should already be converted to USVString. But, included for\n+    // completion's sake anyway.\n+    if (i >= len)\n+      throw new ERR_INVALID_URI();\n+\n+    var c2 = str.charCodeAt(i) & 0x3FF;\n+\n+    lastPos = i + 1;\n+    c = 0x10000 + (((c & 0x3FF) << 10) | c2);\n+    out += hexTable[0xF0 | (c >> 18)] +\n+           hexTable[0x80 | ((c >> 12) & 0x3F)] +\n+           hexTable[0x80 | ((c >> 6) & 0x3F)] +\n+           hexTable[0x80 | (c & 0x3F)];\n+  }\n+  if (lastPos === 0)\n+    return str;\n+  if (lastPos < len)\n+    return out + str.slice(lastPos);\n+  return out;\n+}\n+\n module.exports = {\n+  encodeStr,\n   hexTable,\n   isHexTable\n };"
        },
        {
            "sha": "44b658b2d921112d9ac2857eca40d8783065ca6a",
            "filename": "lib/internal/url.js",
            "status": "modified",
            "additions": 1,
            "deletions": 64,
            "changes": 65,
            "blob_url": "https://github.com/nodejs/node/blob/db9a7459c3439c282ddcb7353e00491aeb704d22/lib%2Finternal%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/db9a7459c3439c282ddcb7353e00491aeb704d22/lib%2Finternal%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Furl.js?ref=db9a7459c3439c282ddcb7353e00491aeb704d22",
            "patch": "@@ -2,6 +2,7 @@\n \n const util = require('util');\n const {\n+  encodeStr,\n   hexTable,\n   isHexTable\n } = require('internal/querystring');\n@@ -833,70 +834,6 @@ const noEscape = [\n const paramHexTable = hexTable.slice();\n paramHexTable[0x20] = '+';\n \n-function encodeStr(str, noEscapeTable, hexTable) {\n-  const len = str.length;\n-  if (len === 0)\n-    return '';\n-\n-  var out = '';\n-  var lastPos = 0;\n-\n-  for (var i = 0; i < len; i++) {\n-    var c = str.charCodeAt(i);\n-\n-    // ASCII\n-    if (c < 0x80) {\n-      if (noEscapeTable[c] === 1)\n-        continue;\n-      if (lastPos < i)\n-        out += str.slice(lastPos, i);\n-      lastPos = i + 1;\n-      out += hexTable[c];\n-      continue;\n-    }\n-\n-    if (lastPos < i)\n-      out += str.slice(lastPos, i);\n-\n-    // Multi-byte characters ...\n-    if (c < 0x800) {\n-      lastPos = i + 1;\n-      out += hexTable[0xC0 | (c >> 6)] +\n-             hexTable[0x80 | (c & 0x3F)];\n-      continue;\n-    }\n-    if (c < 0xD800 || c >= 0xE000) {\n-      lastPos = i + 1;\n-      out += hexTable[0xE0 | (c >> 12)] +\n-             hexTable[0x80 | ((c >> 6) & 0x3F)] +\n-             hexTable[0x80 | (c & 0x3F)];\n-      continue;\n-    }\n-    // Surrogate pair\n-    ++i;\n-    var c2;\n-    if (i < len)\n-      c2 = str.charCodeAt(i) & 0x3FF;\n-    else {\n-      // This branch should never happen because all URLSearchParams entries\n-      // should already be converted to USVString. But, included for\n-      // completion's sake anyway.\n-      c2 = 0;\n-    }\n-    lastPos = i + 1;\n-    c = 0x10000 + (((c & 0x3FF) << 10) | c2);\n-    out += hexTable[0xF0 | (c >> 18)] +\n-           hexTable[0x80 | ((c >> 12) & 0x3F)] +\n-           hexTable[0x80 | ((c >> 6) & 0x3F)] +\n-           hexTable[0x80 | (c & 0x3F)];\n-  }\n-  if (lastPos === 0)\n-    return str;\n-  if (lastPos < len)\n-    return out + str.slice(lastPos);\n-  return out;\n-}\n-\n // application/x-www-form-urlencoded serializer\n // Ref: https://url.spec.whatwg.org/#concept-urlencoded-serializer\n function serializeParams(array) {"
        },
        {
            "sha": "5189a28f2357709e26f39fdc7483beda0afdbbd0",
            "filename": "lib/querystring.js",
            "status": "modified",
            "additions": 2,
            "deletions": 53,
            "changes": 55,
            "blob_url": "https://github.com/nodejs/node/blob/db9a7459c3439c282ddcb7353e00491aeb704d22/lib%2Fquerystring.js",
            "raw_url": "https://github.com/nodejs/node/raw/db9a7459c3439c282ddcb7353e00491aeb704d22/lib%2Fquerystring.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fquerystring.js?ref=db9a7459c3439c282ddcb7353e00491aeb704d22",
            "patch": "@@ -24,8 +24,8 @@\n 'use strict';\n \n const { Buffer } = require('buffer');\n-const { ERR_INVALID_URI } = require('internal/errors').codes;\n const {\n+  encodeStr,\n   hexTable,\n   isHexTable\n } = require('internal/querystring');\n@@ -140,59 +140,8 @@ function qsEscape(str) {\n     else\n       str += '';\n   }\n-  var out = '';\n-  var lastPos = 0;\n-\n-  for (var i = 0; i < str.length; ++i) {\n-    var c = str.charCodeAt(i);\n-\n-    // ASCII\n-    if (c < 0x80) {\n-      if (noEscape[c] === 1)\n-        continue;\n-      if (lastPos < i)\n-        out += str.slice(lastPos, i);\n-      lastPos = i + 1;\n-      out += hexTable[c];\n-      continue;\n-    }\n \n-    if (lastPos < i)\n-      out += str.slice(lastPos, i);\n-\n-    // Multi-byte characters ...\n-    if (c < 0x800) {\n-      lastPos = i + 1;\n-      out += hexTable[0xC0 | (c >> 6)] + hexTable[0x80 | (c & 0x3F)];\n-      continue;\n-    }\n-    if (c < 0xD800 || c >= 0xE000) {\n-      lastPos = i + 1;\n-      out += hexTable[0xE0 | (c >> 12)] +\n-             hexTable[0x80 | ((c >> 6) & 0x3F)] +\n-             hexTable[0x80 | (c & 0x3F)];\n-      continue;\n-    }\n-    // Surrogate pair\n-    ++i;\n-\n-    if (i >= str.length)\n-      throw new ERR_INVALID_URI();\n-\n-    var c2 = str.charCodeAt(i) & 0x3FF;\n-\n-    lastPos = i + 1;\n-    c = 0x10000 + (((c & 0x3FF) << 10) | c2);\n-    out += hexTable[0xF0 | (c >> 18)] +\n-           hexTable[0x80 | ((c >> 12) & 0x3F)] +\n-           hexTable[0x80 | ((c >> 6) & 0x3F)] +\n-           hexTable[0x80 | (c & 0x3F)];\n-  }\n-  if (lastPos === 0)\n-    return str;\n-  if (lastPos < str.length)\n-    return out + str.slice(lastPos);\n-  return out;\n+  return encodeStr(str, noEscape, hexTable);\n }\n \n function stringifyPrimitive(v) {"
        }
    ],
    "stats": {
        "total": 187,
        "additions": 70,
        "deletions": 117
    }
}