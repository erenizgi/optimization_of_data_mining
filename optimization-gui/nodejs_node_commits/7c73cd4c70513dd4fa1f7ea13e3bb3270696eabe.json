{
    "author": "cjihrig",
    "message": "net: emit error on invalid address family\n\nThis commit adds proper error handling to net.connect() when\na custom lookup() function returns an invalid address family.\n\nPR-URL: https://github.com/nodejs/node/pull/19415\nFixes: https://github.com/nodejs/node/issues/19407\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Santiago Gimeno <santiago.gimeno@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Khaidi Chu <i@2333.moe>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe",
    "files": [
        {
            "sha": "5e94535a3ea3843e7b18caf611dab55655c69091",
            "filename": "doc/api/errors.md",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe/doc%2Fapi%2Ferrors.md",
            "raw_url": "https://github.com/nodejs/node/raw/7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe/doc%2Fapi%2Ferrors.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ferrors.md?ref=7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe",
            "patch": "@@ -1042,6 +1042,11 @@ The `inspector` module is not available for use.\n While using the `inspector` module, an attempt was made to use the inspector\n before it was connected.\n \n+<a id=\"ERR_INVALID_ADDRESS_FAMILY\"></a>\n+### ERR_INVALID_ADDRESS_FAMILY\n+\n+The provided address family is not understood by the Node.js API.\n+\n <a id=\"ERR_INVALID_ARG_TYPE\"></a>\n ### ERR_INVALID_ARG_TYPE\n "
        },
        {
            "sha": "33a3185f797ca97ff30c14a830a6f72ad4db7a05",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe",
            "patch": "@@ -737,6 +737,7 @@ E('ERR_INSPECTOR_ALREADY_CONNECTED',\n E('ERR_INSPECTOR_CLOSED', 'Session was closed', Error);\n E('ERR_INSPECTOR_NOT_AVAILABLE', 'Inspector is not available', Error);\n E('ERR_INSPECTOR_NOT_CONNECTED', 'Session is not connected', Error);\n+E('ERR_INVALID_ADDRESS_FAMILY', 'Invalid address family: %s', RangeError);\n E('ERR_INVALID_ARG_TYPE', invalidArgType, TypeError);\n E('ERR_INVALID_ARG_VALUE', (name, value, reason = 'is invalid') => {\n   const util = lazyUtil();"
        },
        {
            "sha": "466531744eea0f865eb28325a2905ff559625148",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe",
            "patch": "@@ -54,6 +54,7 @@ const {\n } = require('internal/async_hooks');\n const errors = require('internal/errors');\n const {\n+  ERR_INVALID_ADDRESS_FAMILY,\n   ERR_INVALID_ARG_TYPE,\n   ERR_INVALID_FD_TYPE,\n   ERR_INVALID_IP_ADDRESS,\n@@ -1117,6 +1118,12 @@ function lookupAndConnect(self, options) {\n         err.port = options.port;\n         err.message = err.message + ' ' + options.host + ':' + options.port;\n         process.nextTick(connectErrorNT, self, err);\n+      } else if (addressType !== 4 && addressType !== 6) {\n+        err = new ERR_INVALID_ADDRESS_FAMILY(addressType);\n+        err.host = options.host;\n+        err.port = options.port;\n+        err.message = err.message + ' ' + options.host + ':' + options.port;\n+        process.nextTick(connectErrorNT, self, err);\n       } else {\n         self._unrefTimer();\n         defaultTriggerAsyncIdScope("
        },
        {
            "sha": "007be66f4516bb658141027566998566aca887d6",
            "filename": "test/parallel/test-net-options-lookup.js",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe/test%2Fparallel%2Ftest-net-options-lookup.js",
            "raw_url": "https://github.com/nodejs/node/raw/7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe/test%2Fparallel%2Ftest-net-options-lookup.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-net-options-lookup.js?ref=7c73cd4c70513dd4fa1f7ea13e3bb3270696eabe",
            "patch": "@@ -29,5 +29,14 @@ function connectDoesNotThrow(input) {\n     lookup: input\n   };\n \n-  net.connect(opts);\n+  return net.connect(opts);\n+}\n+\n+{\n+  // Verify that an error is emitted when an invalid address family is returned.\n+  const s = connectDoesNotThrow((host, options, cb) => {\n+    cb(null, '127.0.0.1', 100);\n+  });\n+\n+  s.on('error', common.expectsError({ code: 'ERR_INVALID_ADDRESS_FAMILY' }));\n }"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 23,
        "deletions": 1
    }
}