{
    "author": "rubys",
    "message": "tools: add [src] links to assert.html\n\nParse `const assert = module.exports = ok;` as exporting a constructor\nnamed `assert`.\n\nPR-URL: https://github.com/nodejs/node/pull/22601\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "5da155398ef8645c76872c6db3114a3e796a80da",
    "files": [
        {
            "sha": "5a61e50dc2758101c511aa486f6fda200be61338",
            "filename": "test/fixtures/apilinks/reverse.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/5da155398ef8645c76872c6db3114a3e796a80da/test%2Ffixtures%2Fapilinks%2Freverse.js",
            "raw_url": "https://github.com/nodejs/node/raw/5da155398ef8645c76872c6db3114a3e796a80da/test%2Ffixtures%2Fapilinks%2Freverse.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fapilinks%2Freverse.js?ref=5da155398ef8645c76872c6db3114a3e796a80da",
            "patch": "@@ -0,0 +1,13 @@\n+'use strict';\n+\n+// Parallel assignment to the exported variable and module.exports.\n+\n+function ok() {\n+}\n+\n+const asserts = module.exports = ok;\n+\n+asserts.ok = ok;\n+\n+asserts.strictEqual = function() {\n+}"
        },
        {
            "sha": "aa32e4a90a745c38286c3ac1cae30a5d3551a074",
            "filename": "test/fixtures/apilinks/reverse.json",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/5da155398ef8645c76872c6db3114a3e796a80da/test%2Ffixtures%2Fapilinks%2Freverse.json",
            "raw_url": "https://github.com/nodejs/node/raw/5da155398ef8645c76872c6db3114a3e796a80da/test%2Ffixtures%2Fapilinks%2Freverse.json",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fapilinks%2Freverse.json?ref=5da155398ef8645c76872c6db3114a3e796a80da",
            "patch": "@@ -0,0 +1,5 @@\n+{\n+  \"asserts\": \"reverse.js#L8\",\n+  \"asserts.ok\": \"reverse.js#L5\",\n+  \"asserts.strictEqual\": \"reverse.js#L12\"\n+}"
        },
        {
            "sha": "35183912d31870308bd1750ee5879e83f65b3ef8",
            "filename": "tools/doc/apilinks.js",
            "status": "modified",
            "additions": 58,
            "deletions": 27,
            "changes": 85,
            "blob_url": "https://github.com/nodejs/node/blob/5da155398ef8645c76872c6db3114a3e796a80da/tools%2Fdoc%2Fapilinks.js",
            "raw_url": "https://github.com/nodejs/node/raw/5da155398ef8645c76872c6db3114a3e796a80da/tools%2Fdoc%2Fapilinks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fapilinks.js?ref=5da155398ef8645c76872c6db3114a3e796a80da",
            "patch": "@@ -55,35 +55,50 @@ process.argv.slice(2).forEach((file) => {\n   const ast = acorn.parse(source, { ecmaVersion: 10, locations: true });\n   const program = ast.body;\n \n+  // Build link\n+  const link = `https://github.com/${repo}/blob/${tag}/` +\n+    path.relative('.', file).replace(/\\\\/g, '/');\n+\n   // Scan for exports.\n   const exported = { constructors: [], identifiers: [] };\n   program.forEach((statement) => {\n-    if (statement.type !== 'ExpressionStatement') return;\n-    const expr = statement.expression;\n-    if (expr.type !== 'AssignmentExpression') return;\n-\n-    let lhs = expr.left;\n-    if (expr.left.object.type === 'MemberExpression') lhs = lhs.object;\n-    if (lhs.type !== 'MemberExpression') return;\n-    if (lhs.object.name !== 'module') return;\n-    if (lhs.property.name !== 'exports') return;\n-\n-    let rhs = expr.right;\n-    while (rhs.type === 'AssignmentExpression') rhs = rhs.right;\n-\n-    if (rhs.type === 'NewExpression') {\n-      exported.constructors.push(rhs.callee.name);\n-    } else if (rhs.type === 'ObjectExpression') {\n-      rhs.properties.forEach((property) => {\n-        if (property.value.type === 'Identifier') {\n-          exported.identifiers.push(property.value.name);\n-          if (/^[A-Z]/.test(property.value.name[0])) {\n-            exported.constructors.push(property.value.name);\n+    if (statement.type === 'ExpressionStatement') {\n+      const expr = statement.expression;\n+      if (expr.type !== 'AssignmentExpression') return;\n+\n+      let lhs = expr.left;\n+      if (expr.left.object.type === 'MemberExpression') lhs = lhs.object;\n+      if (lhs.type !== 'MemberExpression') return;\n+      if (lhs.object.name !== 'module') return;\n+      if (lhs.property.name !== 'exports') return;\n+\n+      let rhs = expr.right;\n+      while (rhs.type === 'AssignmentExpression') rhs = rhs.right;\n+\n+      if (rhs.type === 'NewExpression') {\n+        exported.constructors.push(rhs.callee.name);\n+      } else if (rhs.type === 'ObjectExpression') {\n+        rhs.properties.forEach((property) => {\n+          if (property.value.type === 'Identifier') {\n+            exported.identifiers.push(property.value.name);\n+            if (/^[A-Z]/.test(property.value.name[0])) {\n+              exported.constructors.push(property.value.name);\n+            }\n           }\n-        }\n-      });\n-    } else if (rhs.type === 'Identifier') {\n-      exported.identifiers.push(rhs.name);\n+        });\n+      } else if (rhs.type === 'Identifier') {\n+        exported.identifiers.push(rhs.name);\n+      }\n+    } else if (statement.type === 'VariableDeclaration') {\n+      for (const decl of statement.declarations) {\n+        let init = decl.init;\n+        while (init && init.type === 'AssignmentExpression') init = init.left;\n+        if (!init || init.type !== 'MemberExpression') continue;\n+        if (init.object.name !== 'module') continue;\n+        if (init.property.name !== 'exports') continue;\n+        exported.constructors.push(decl.id.name);\n+        definition[decl.id.name] = `${link}#L${statement.loc.start.line}`;\n+      }\n     }\n   });\n \n@@ -93,8 +108,7 @@ process.argv.slice(2).forEach((file) => {\n   //   ClassName.prototype.foo = ...;\n   //   function Identifier(...) {...};\n   //\n-  const link = `https://github.com/${repo}/blob/${tag}/` +\n-    path.relative('.', file).replace(/\\\\/g, '/');\n+  const indirect = {};\n \n   program.forEach((statement) => {\n     if (statement.type === 'ExpressionStatement') {\n@@ -128,6 +142,11 @@ process.argv.slice(2).forEach((file) => {\n       }\n \n       definition[name] = `${link}#L${statement.loc.start.line}`;\n+\n+      if (expr.left.property.name === expr.right.name) {\n+        indirect[expr.right.name] = name;\n+      }\n+\n     } else if (statement.type === 'FunctionDeclaration') {\n       const name = statement.id.name;\n       if (!exported.identifiers.includes(name)) return;\n@@ -136,6 +155,18 @@ process.argv.slice(2).forEach((file) => {\n         `${link}#L${statement.loc.start.line}`;\n     }\n   });\n+\n+  // Search for indirect references of the form ClassName.foo = foo;\n+  if (Object.keys(indirect).length > 0) {\n+    program.forEach((statement) => {\n+      if (statement.type === 'FunctionDeclaration') {\n+        const name = statement.id.name;\n+        if (indirect[name]) {\n+          definition[indirect[name]] = `${link}#L${statement.loc.start.line}`;\n+        }\n+      }\n+    });\n+  }\n });\n \n console.log(JSON.stringify(definition, null, 2));"
        }
    ],
    "stats": {
        "total": 103,
        "additions": 76,
        "deletions": 27
    }
}