{
    "author": "shigeki",
    "message": "deps: add only avx2 configs for OpenSSL-1.1.1\n\nOpenSSL-1.1.1 has new support of AVX-512 but AVX-2 asm files still need\nto be generated for the older assembler support to keep backward\ncompatibilities.\n\nPR-URL: https://github.com/nodejs/node/pull/25381\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Shigeki Ohtsu <ohtsu@ohtsu.org>",
    "sha": "576d0c620683057b69fc1167b409fa60b03af513",
    "files": [
        {
            "sha": "300ab009d8fe8ca2ff86e166a773b35f588efb2d",
            "filename": "deps/openssl/config/Makefile",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fconfig%2FMakefile",
            "raw_url": "https://github.com/nodejs/node/raw/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fconfig%2FMakefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2FMakefile?ref=576d0c620683057b69fc1167b409fa60b03af513",
            "patch": "@@ -16,6 +16,8 @@ linux-ppc64 linux-ppc64le linux32-s390x linux64-s390x \\\n solaris-x86-gcc solaris64-x86_64-gcc VC-WIN64A VC-WIN32\n \n CC = gcc\n+FAKE_GCC = ../config/fake_gcc.pl\n+\n CONFIGURE = ./Configure\n # no-comp: against CRIME attack\n # no-shared: openssl-cli needs static link\n@@ -45,12 +47,12 @@ all: $(ARCHS) replace\n $(ARCHS):\n # Remove openssl .gitignore to follow nodejs .gitignore\n \tif [ -e $(GITIGNORE) ]; then rm $(GITIGNORE); fi\n-\tif [ \"$(findstring darwin, $@)\" = \"\" ]; then \\\n-\t  cd $(OPSSL_SRC); $(NO_WARN_ENV) ARC=$@ CC=$(CC) $(PERL) $(CONFIGURE) $(COPTS) $@; \\\n-\telse \\\n-\t  cd $(OPSSL_SRC); $(NO_WARN_ENV) ARC=$@ CC=./fake_gcc.pl $(PERL) $(CONFIGURE) $(COPTS) $@; \\\n-\tfi\n+\tcd $(OPSSL_SRC); $(NO_WARN_ENV) CC=$(CC) $(PERL) $(CONFIGURE) $(COPTS) $@;\n \t$(PERL) -w -I$(OPSSL_SRC) $(GENERATE) asm $@\n+# Confgure asm_avx2 and generate upto avx2 support\n+\tcd $(OPSSL_SRC); $(NO_WARN_ENV) CC=$(FAKE_GCC) $(PERL) $(CONFIGURE) \\\n+\t$(COPTS) $@;\n+\t$(PERL) -w -I$(OPSSL_SRC) $(GENERATE) asm_avx2 $@\n # Confgure no-asm and generate no-asm sources\n \tcd $(OPSSL_SRC); $(NO_WARN_ENV) $(PERL) $(CONFIGURE) $(COPTS) \\\n \tno-asm $@;"
        },
        {
            "sha": "6c77c3acbc41d7f53a47095ed7a5e24d83a55737",
            "filename": "deps/openssl/config/fake_gcc.pl",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fconfig%2Ffake_gcc.pl",
            "raw_url": "https://github.com/nodejs/node/raw/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fconfig%2Ffake_gcc.pl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2Ffake_gcc.pl?ref=576d0c620683057b69fc1167b409fa60b03af513",
            "patch": "@@ -1,11 +1,12 @@\n #! /usr/bin/env perl\n use 5.10.0;\n use strict;\n-my $arch = $ENV{ARC};\n+my $args = join(' ', @ARGV);\n+\n my $ret;\n-if ($arch =~ /^darwin/) {\n-  $ret = \"Apple LLVM version 10.0.0 (clang-1000.11.45.2)\\n\";\n+if ($args eq '-Wa,-v -c -o /dev/null -x assembler /dev/null') {\n+  $ret = \"GNU assembler version 2.23.52.0.1 (x86_64-redhat-linux) using BFD version version 2.23.52.0.1-30.el7_1.2 20130226\\n\";\n } else {\n-  $ret = `gcc -Wa,-v -c -o /dev/null -x assembler /dev/null 2>&1`;\n+  $ret = `gcc $args`;\n }\n print STDOUT $ret;"
        },
        {
            "sha": "4a0a649c7cddd5bbd1d317a5bd309cdc249a071f",
            "filename": "deps/openssl/config/generate_gypi.pl",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fconfig%2Fgenerate_gypi.pl",
            "raw_url": "https://github.com/nodejs/node/raw/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fconfig%2Fgenerate_gypi.pl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2Fgenerate_gypi.pl?ref=576d0c620683057b69fc1167b409fa60b03af513",
            "patch": "@@ -16,7 +16,7 @@\n \n my $asm = $ARGV[0];\n \n-unless ($asm eq \"asm\" or $asm eq \"no-asm\") {\n+unless ($asm eq \"asm\" or $asm eq \"asm_avx2\" or $asm eq \"no-asm\") {\n   die \"Error: $asm is invalid argument\";\n }\n my $arch = $ARGV[1];\n@@ -25,15 +25,15 @@\n my $nasm_banner = `nasm -v`;\n die \"Error: nasm is not installed.\" if (!$nasm_banner);\n \n-my $nasm_version_min = 2.11;\n+my $nasm_version_min =  2.13.3;\n my ($nasm_version) = ($nasm_banner =~/^NASM version ([0-9]\\.[0-9][0-9])+/);\n if ($nasm_version < $nasm_version_min) {\n   die \"Error: nasm version $nasm_version is too old.\" .\n     \"$nasm_version_min or higher is required.\";\n }\n \n # gas version check\n-my $gas_version_min = 2.26;\n+my $gas_version_min = 2.30;\n my $gas_banner = `gcc -Wa,-v -c -o /dev/null -x assembler /dev/null 2>&1`;\n my ($gas_version) = ($gas_banner =~/GNU assembler version ([2-9]\\.[0-9]+)/);\n if ($gas_version < $gas_version_min) {"
        },
        {
            "sha": "f05c02171a60bfb98e59cfa9b40d02e872968e08",
            "filename": "deps/openssl/openssl-cl_asm_avx2.gypi",
            "status": "added",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/nodejs/node/blob/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fopenssl-cl_asm_avx2.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fopenssl-cl_asm_avx2.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fopenssl-cl_asm_avx2.gypi?ref=576d0c620683057b69fc1167b409fa60b03af513",
            "patch": "@@ -0,0 +1,47 @@\n+{\n+  'conditions': [\n+    ['target_arch==\"ppc\" and OS==\"aix\"', {\n+      'includes': ['config/archs/aix-gcc/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"ppc\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-ppc/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"ppc64\" and OS==\"aix\"', {\n+      'includes': ['config/archs/aix64-gcc/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"ppc64\" and OS==\"linux\" and node_byteorder ==\"little\"', {\n+      'includes': ['config/archs/linux-ppc64le/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"ppc64\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-ppc64/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"s390\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux32-s390x/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"s390x\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux64-s390x/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"arm\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-armv4/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"arm64\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-aarch64/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"ia32\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-elf/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"ia32\" and OS==\"mac\"', {\n+      'includes': ['config/archs/darwin-i386-cc/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"ia32\" and OS==\"solaris\"', {\n+      'includes': ['config/archs/solaris-x86-gcc/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"ia32\" and OS==\"win\"', {\n+      'includes': ['config/archs/VC-WIN32/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"ia32\"', {\n+      # noasm linux-elf for other ia32 platforms\n+      'includes': ['config/archs/linux-elf/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"x64\" and OS==\"freebsd\"', {\n+      'includes': ['config/archs/BSD-x86_64/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"x64\" and OS==\"mac\"', {\n+      'includes': ['config/archs/darwin64-x86_64-cc/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"x64\" and OS==\"solaris\"', {\n+      'includes': ['config/archs/solaris64-x86_64-gcc/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"x64\" and OS==\"win\"', {\n+      'includes': ['config/archs/VC-WIN64A/asm_avx2/openssl-cl.gypi'],\n+    }, 'target_arch==\"x64\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-x86_64/asm_avx2/openssl-cl.gypi'],\n+    }, {\n+      # Other architectures don't use assembly\n+      'includes': ['config/archs/linux-x86_64/asm_avx2/openssl-cl.gypi'],\n+    }],\n+  ],\n+}"
        },
        {
            "sha": "5f5324875636015ce494517c364ea4b29415cdae",
            "filename": "deps/openssl/openssl.gyp",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fopenssl.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fopenssl.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fopenssl.gyp?ref=576d0c620683057b69fc1167b409fa60b03af513",
            "patch": "@@ -1,4 +1,9 @@\n {\n+  'variables': {\n+    'gas_version%': 0,\n+    'llvm_version%': 0,\n+    'nasm_version%': 0,\n+  },\n   'targets': [\n     {\n       'target_name': 'openssl',\n@@ -11,10 +16,15 @@\n         'OPENSSL_NO_HW',\n       ],\n       'conditions': [\n-        [ 'openssl_no_asm==0', {\n+        [ 'openssl_no_asm==1', {\n+          'includes': ['./openssl_no_asm.gypi'],\n+        }, 'gas_version >= \"2.26\" or nasm_version >= \"2.11.8\"', {\n+           # Require AVX512IFMA supported. See\n+           # https://www.openssl.org/docs/man1.1.1/man3/OPENSSL_ia32cap.html\n+           # Currently crypto/poly1305/asm/poly1305-x86_64.pl requires AVX512IFMA.\n           'includes': ['./openssl_asm.gypi'],\n         }, {\n-          'includes': ['./openssl_no_asm.gypi'],\n+          'includes': ['./openssl_asm_avx2.gypi'],\n         }],\n       ],\n       'direct_dependent_settings': {"
        },
        {
            "sha": "c5a636a3301a2aeabe8104ffe966d02843567bde",
            "filename": "deps/openssl/openssl_asm_avx2.gypi",
            "status": "added",
            "additions": 81,
            "deletions": 0,
            "changes": 81,
            "blob_url": "https://github.com/nodejs/node/blob/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fopenssl_asm_avx2.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/576d0c620683057b69fc1167b409fa60b03af513/deps%2Fopenssl%2Fopenssl_asm_avx2.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fopenssl_asm_avx2.gypi?ref=576d0c620683057b69fc1167b409fa60b03af513",
            "patch": "@@ -0,0 +1,81 @@\n+{\n+  'conditions': [\n+    ['target_arch==\"ppc\" and OS==\"aix\"', {\n+      'includes': ['config/archs/aix-gcc/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"ppc\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-ppc/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"ppc64\" and OS==\"aix\"', {\n+      'includes': ['config/archs/aix64-gcc/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"ppc64\" and OS==\"linux\" and node_byteorder ==\"little\"', {\n+      'includes': ['config/archs/linux-ppc64le/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"ppc64\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-ppc64/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"s390\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux32-s390x/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"s390x\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux64-s390x/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"arm\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-armv4/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"arm64\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-aarch64/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"ia32\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-elf/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"ia32\" and OS==\"mac\"', {\n+      'includes': ['config/archs/darwin-i386-cc/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"ia32\" and OS==\"solaris\"', {\n+      'includes': ['config/archs/solaris-x86-gcc/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"ia32\" and OS==\"win\"', {\n+      'includes': ['config/archs/VC-WIN32/asm_avx2/openssl.gypi'],\n+      'rules': [\n+        {\n+          'rule_name': 'Assemble',\n+          'extension': 'asm',\n+          'inputs': [],\n+          'outputs': [\n+            '<(INTERMEDIATE_DIR)/<(RULE_INPUT_ROOT).obj',\n+          ],\n+          'action': [\n+            'nasm.exe',\n+            '-f win32',\n+            '-o', '<(INTERMEDIATE_DIR)/<(RULE_INPUT_ROOT).obj',\n+            '<(RULE_INPUT_PATH)',\n+          ],\n+        }\n+      ],\n+    }, 'target_arch==\"ia32\"', {\n+      'includes': ['config/archs/linux-elf/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"x64\" and OS==\"freebsd\"', {\n+      'includes': ['config/archs/BSD-x86_64/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"x64\" and OS==\"mac\"', {\n+      'includes': ['config/archs/darwin64-x86_64-cc/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"x64\" and OS==\"solaris\"', {\n+      'includes': ['config/archs/solaris64-x86_64-gcc/asm_avx2/openssl.gypi'],\n+    }, 'target_arch==\"x64\" and OS==\"win\"', {\n+      'includes': ['config/archs/VC-WIN64A/asm_avx2/openssl.gypi'],\n+      'rules': [\n+        {\n+          'rule_name': 'Assemble',\n+          'extension': 'asm',\n+          'inputs': [],\n+          'outputs': [\n+            '<(INTERMEDIATE_DIR)/<(RULE_INPUT_ROOT).obj',\n+          ],\n+          'action': [\n+            'nasm.exe',\n+            '-f win64',\n+            '-DNEAR',\n+            '-Ox',\n+            '-g',\n+            '-o', '<(INTERMEDIATE_DIR)/<(RULE_INPUT_ROOT).obj',\n+            '<(RULE_INPUT_PATH)',\n+          ],\n+        }\n+      ],\n+    }, 'target_arch==\"x64\" and OS==\"linux\"', {\n+      'includes': ['config/archs/linux-x86_64/asm_avx2/openssl.gypi'],\n+    }, {\n+      # Other architectures don't use assembly\n+      'includes': ['config/archs/linux-x86_64/asm_avx2/openssl.gypi'],\n+    }],\n+  ],\n+}"
        }
    ],
    "stats": {
        "total": 169,
        "additions": 155,
        "deletions": 14
    }
}