{
    "author": "range3",
    "message": "fs: fix missing 'error' event in (Read|Write)Stream#destroy\n\nfs.ReadStream / fs.WriteStream destroy([error]) function\nshould emit 'error' event if `error` is set.\n\nPR-URL: https://github.com/nodejs/node/pull/19735\nFixes: https://github.com/nodejs/node/issues/19727\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "6e2d5af0e4164d4b1a827a86b8eafa3b5fcaebe0",
    "files": [
        {
            "sha": "ebf70948192844dce4b79a9180a1e033f60825fc",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/6e2d5af0e4164d4b1a827a86b8eafa3b5fcaebe0/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/6e2d5af0e4164d4b1a827a86b8eafa3b5fcaebe0/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=6e2d5af0e4164d4b1a827a86b8eafa3b5fcaebe0",
            "patch": "@@ -2128,7 +2128,7 @@ ReadStream.prototype._destroy = function(err, cb) {\n     return;\n   }\n \n-  closeFsStream(this, cb);\n+  closeFsStream(this, cb, err);\n   this.fd = null;\n };\n "
        },
        {
            "sha": "c0405ce5f154f05b79bb920d71b1e12d0bf41973",
            "filename": "test/parallel/test-fs-stream-destroy-emit-error.js",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/6e2d5af0e4164d4b1a827a86b8eafa3b5fcaebe0/test%2Fparallel%2Ftest-fs-stream-destroy-emit-error.js",
            "raw_url": "https://github.com/nodejs/node/raw/6e2d5af0e4164d4b1a827a86b8eafa3b5fcaebe0/test%2Fparallel%2Ftest-fs-stream-destroy-emit-error.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-stream-destroy-emit-error.js?ref=6e2d5af0e4164d4b1a827a86b8eafa3b5fcaebe0",
            "patch": "@@ -0,0 +1,20 @@\n+'use strict';\n+const common = require('../common');\n+const assert = require('assert');\n+const fs = require('fs');\n+\n+const tmpdir = require('../common/tmpdir');\n+tmpdir.refresh();\n+\n+test(fs.createReadStream(__filename));\n+test(fs.createWriteStream(`${tmpdir.path}/dummy`));\n+\n+function test(stream) {\n+  const err = new Error('DESTROYED');\n+  stream.on('open', function() {\n+    stream.destroy(err);\n+  });\n+  stream.on('error', common.mustCall(function(err_) {\n+    assert.strictEqual(err_, err);\n+  }));\n+}"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 21,
        "deletions": 1
    }
}