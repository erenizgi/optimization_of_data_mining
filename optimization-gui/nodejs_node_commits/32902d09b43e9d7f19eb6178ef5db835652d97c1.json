{
    "author": "jasnell",
    "message": "http2: emit timeout on compat request and response\n\nFixes: https://github.com/nodejs/node/issues/20079\n\nPR-URL: https://github.com/nodejs/node/pull/22252\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "32902d09b43e9d7f19eb6178ef5db835652d97c1",
    "files": [
        {
            "sha": "40276d87234865a6f256c043007d3fbd709b9248",
            "filename": "lib/internal/http2/compat.js",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/32902d09b43e9d7f19eb6178ef5db835652d97c1/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "raw_url": "https://github.com/nodejs/node/raw/32902d09b43e9d7f19eb6178ef5db835652d97c1/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcompat.js?ref=32902d09b43e9d7f19eb6178ef5db835652d97c1",
            "patch": "@@ -241,6 +241,13 @@ function onStreamCloseRequest() {\n   req.emit('close');\n }\n \n+function onStreamTimeout(kind) {\n+  return function onStreamTimeout() {\n+    const obj = this[kind];\n+    obj.emit('timeout');\n+  };\n+}\n+\n class Http2ServerRequest extends Readable {\n   constructor(stream, headers, options, rawHeaders) {\n     super(options);\n@@ -263,6 +270,7 @@ class Http2ServerRequest extends Readable {\n     stream.on('error', onStreamError);\n     stream.on('aborted', onStreamAbortedRequest);\n     stream.on('close', onStreamCloseRequest);\n+    stream.on('timeout', onStreamTimeout(kRequest));\n     this.on('pause', onRequestPause);\n     this.on('resume', onRequestResume);\n   }\n@@ -416,6 +424,7 @@ class Http2ServerResponse extends Stream {\n     stream.on('aborted', onStreamAbortedResponse);\n     stream.on('close', onStreamCloseResponse);\n     stream.on('wantTrailers', onStreamTrailersReady);\n+    stream.on('timeout', onStreamTimeout(kResponse));\n   }\n \n   // User land modules such as finalhandler just check truthiness of this"
        },
        {
            "sha": "4b7a629cf55fde85affc51a810b94502bc88ed3c",
            "filename": "test/parallel/test-http2-compat-serverrequest-settimeout.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/32902d09b43e9d7f19eb6178ef5db835652d97c1/test%2Fparallel%2Ftest-http2-compat-serverrequest-settimeout.js",
            "raw_url": "https://github.com/nodejs/node/raw/32902d09b43e9d7f19eb6178ef5db835652d97c1/test%2Fparallel%2Ftest-http2-compat-serverrequest-settimeout.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-compat-serverrequest-settimeout.js?ref=32902d09b43e9d7f19eb6178ef5db835652d97c1",
            "patch": "@@ -12,6 +12,7 @@ server.on('request', (req, res) => {\n   req.setTimeout(msecs, common.mustCall(() => {\n     res.end();\n   }));\n+  req.on('timeout', common.mustCall());\n   res.on('finish', common.mustCall(() => {\n     req.setTimeout(msecs, common.mustNotCall());\n     process.nextTick(() => {"
        },
        {
            "sha": "e24621ad097f3ff360108b0d5dc95f7420d4ef9a",
            "filename": "test/parallel/test-http2-compat-serverresponse-settimeout.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/32902d09b43e9d7f19eb6178ef5db835652d97c1/test%2Fparallel%2Ftest-http2-compat-serverresponse-settimeout.js",
            "raw_url": "https://github.com/nodejs/node/raw/32902d09b43e9d7f19eb6178ef5db835652d97c1/test%2Fparallel%2Ftest-http2-compat-serverresponse-settimeout.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-compat-serverresponse-settimeout.js?ref=32902d09b43e9d7f19eb6178ef5db835652d97c1",
            "patch": "@@ -12,6 +12,7 @@ server.on('request', (req, res) => {\n   res.setTimeout(msecs, common.mustCall(() => {\n     res.end();\n   }));\n+  res.on('timeout', common.mustCall());\n   res.on('finish', common.mustCall(() => {\n     res.setTimeout(msecs, common.mustNotCall());\n     process.nextTick(() => {"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}