{
    "author": "danbev",
    "message": "src: move process.binding('async_wrap') internal\n\nThis commit makes the async_wrap builtin an internal builtin, and\nchanges usage of the builtin from using process.binding('async_wrap')\nto use internalBinding instead.\n\nRefs: https://github.com/nodejs/node/issues/22160\n\nPR-URL: https://github.com/nodejs/node/pull/22469\nRefs: https://github.com/nodejs/node/issues/22160\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "da8641f3b46f41be11ba932f4228a36bfee9fd1c",
    "files": [
        {
            "sha": "fd48e2b25bd29d49a38232e7f732da8fb242776e",
            "filename": "lib/internal/async_hooks.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fasync_hooks.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fasync_hooks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fasync_hooks.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -4,7 +4,8 @@ const {\n   ERR_ASYNC_TYPE,\n   ERR_INVALID_ASYNC_ID\n } = require('internal/errors').codes;\n-const async_wrap = process.binding('async_wrap');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const async_wrap = internalBinding('async_wrap');\n /* async_hook_fields is a Uint32Array wrapping the uint32_t array of\n  * Environment::AsyncHooks::fields_[]. Each index tracks the number of active\n  * hooks for each type."
        },
        {
            "sha": "49dedc5fe2a847fa12d47751c46fa1adb40a85f0",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -356,7 +356,8 @@\n         'crypto',\n         'contextify',\n         'tcp_wrap',\n-        'tls_wrap']);\n+        'tls_wrap',\n+        'async_wrap']);\n     process.binding = function binding(name) {\n       return internalBindingWhitelist.has(name) ?\n         internalBinding(name) :"
        },
        {
            "sha": "e021f12db524d6e710abbcf1ff5f83f47a4e681d",
            "filename": "lib/internal/crypto/pbkdf2.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fcrypto%2Fpbkdf2.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fcrypto%2Fpbkdf2.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fpbkdf2.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -1,8 +1,8 @@\n 'use strict';\n \n-const { AsyncWrap, Providers } = process.binding('async_wrap');\n-const { Buffer } = require('buffer');\n const { internalBinding } = require('internal/bootstrap/loaders');\n+const { AsyncWrap, Providers } = internalBinding('async_wrap');\n+const { Buffer } = require('buffer');\n const { INT_MAX, pbkdf2: _pbkdf2 } = internalBinding('crypto');\n const { validateInt32 } = require('internal/validators');\n const {"
        },
        {
            "sha": "3393da92d2d448b356958e48a54d6ebbeb88aac3",
            "filename": "lib/internal/crypto/random.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fcrypto%2Frandom.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fcrypto%2Frandom.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Frandom.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -1,8 +1,8 @@\n 'use strict';\n \n-const { AsyncWrap, Providers } = process.binding('async_wrap');\n-const { Buffer, kMaxLength } = require('buffer');\n const { internalBinding } = require('internal/bootstrap/loaders');\n+const { AsyncWrap, Providers } = internalBinding('async_wrap');\n+const { Buffer, kMaxLength } = require('buffer');\n const { randomBytes: _randomBytes } = internalBinding('crypto');\n const {\n   ERR_INVALID_ARG_TYPE,"
        },
        {
            "sha": "a598a7cfb806ce23afcd8d186bb08f03b4d3b013",
            "filename": "lib/internal/crypto/scrypt.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fcrypto%2Fscrypt.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Fcrypto%2Fscrypt.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fscrypt.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -1,8 +1,8 @@\n 'use strict';\n \n-const { AsyncWrap, Providers } = process.binding('async_wrap');\n-const { Buffer } = require('buffer');\n const { internalBinding } = require('internal/bootstrap/loaders');\n+const { AsyncWrap, Providers } = internalBinding('async_wrap');\n+const { Buffer } = require('buffer');\n const { INT_MAX, scrypt: _scrypt } = internalBinding('crypto');\n const { validateInt32 } = require('internal/validators');\n const {"
        },
        {
            "sha": "6eb52f59493ad027f688069efae193fcc28c2d6d",
            "filename": "lib/internal/trace_events_async_hooks.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Ftrace_events_async_hooks.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/lib%2Finternal%2Ftrace_events_async_hooks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ftrace_events_async_hooks.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -2,7 +2,7 @@\n \n const { internalBinding } = require('internal/bootstrap/loaders');\n const { trace } = internalBinding('trace_events');\n-const async_wrap = process.binding('async_wrap');\n+const async_wrap = internalBinding('async_wrap');\n const async_hooks = require('async_hooks');\n const { SafeMap, SafeSet } = require('internal/safe_globals');\n "
        },
        {
            "sha": "acc61ea4b468bb4e2770d01520cd042fc6d4c47e",
            "filename": "src/async_wrap.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/src%2Fasync_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/src%2Fasync_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fasync_wrap.cc?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -765,4 +765,4 @@ Local<Object> AsyncWrap::GetOwner(Environment* env, Local<Object> obj) {\n \n }  // namespace node\n \n-NODE_BUILTIN_MODULE_CONTEXT_AWARE(async_wrap, node::AsyncWrap::Initialize)\n+NODE_MODULE_CONTEXT_AWARE_INTERNAL(async_wrap, node::AsyncWrap::Initialize)"
        },
        {
            "sha": "c6137b20ad62a43251c468e88742e1225c33a99f",
            "filename": "test/common/index.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fcommon%2Findex.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fcommon%2Findex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -79,7 +79,8 @@ if (process.env.NODE_TEST_WITH_ASYNC_HOOKS) {\n   const destroydIdsList = {};\n   const destroyListList = {};\n   const initHandles = {};\n-  const async_wrap = process.binding('async_wrap');\n+  const { internalBinding } = require('internal/test/binding');\n+  const async_wrap = internalBinding('async_wrap');\n \n   process.on('exit', () => {\n     // iterate through handles to make sure nothing crashes"
        },
        {
            "sha": "25a33246e7756c0390f76ac8e67d25fbf686469a",
            "filename": "test/parallel/test-async-wrap-destroyid.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fparallel%2Ftest-async-wrap-destroyid.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fparallel%2Ftest-async-wrap-destroyid.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-async-wrap-destroyid.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -1,7 +1,9 @@\n+// Flags: --expose-internals\n 'use strict';\n \n const common = require('../common');\n-const async_wrap = process.binding('async_wrap');\n+const { internalBinding } = require('internal/test/binding');\n+const async_wrap = internalBinding('async_wrap');\n const assert = require('assert');\n const async_hooks = require('async_hooks');\n const RUNS = 5;"
        },
        {
            "sha": "030ae9fdff5543f23e6b985c3eb41ad7a97c0d29",
            "filename": "test/pseudo-tty/test-async-wrap-getasyncid-tty.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fpseudo-tty%2Ftest-async-wrap-getasyncid-tty.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fpseudo-tty%2Ftest-async-wrap-getasyncid-tty.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-async-wrap-getasyncid-tty.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -1,11 +1,13 @@\n+// Flags: --expose-internals --no-warnings\n 'use strict';\n \n // see also test/sequential/test-async-wrap-getasyncid.js\n \n const common = require('../common');\n const assert = require('assert');\n const tty_wrap = process.binding('tty_wrap');\n-const { TTYWRAP } = process.binding('async_wrap').Providers;\n+const { internalBinding } = require('internal/test/binding');\n+const { TTYWRAP } = internalBinding('async_wrap').Providers;\n const providers = { TTYWRAP };\n \n // Make sure that the TTYWRAP Provider is tested."
        },
        {
            "sha": "18a6ed839e55d9967a26846864750b6a5c3c2e33",
            "filename": "test/sequential/test-async-wrap-getasyncid.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-async-wrap-getasyncid.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -7,7 +7,7 @@ const assert = require('assert');\n const fs = require('fs');\n const fsPromises = fs.promises;\n const net = require('net');\n-const providers = Object.assign({}, process.binding('async_wrap').Providers);\n+const providers = Object.assign({}, internalBinding('async_wrap').Providers);\n const fixtures = require('../common/fixtures');\n const tmpdir = require('../common/tmpdir');\n const { getSystemErrorName } = require('util');"
        },
        {
            "sha": "f6a48b339d4cc85414338ce976b5ca5e751b8fcf",
            "filename": "test/sequential/test-inspector-async-call-stack.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fsequential%2Ftest-inspector-async-call-stack.js",
            "raw_url": "https://github.com/nodejs/node/raw/da8641f3b46f41be11ba932f4228a36bfee9fd1c/test%2Fsequential%2Ftest-inspector-async-call-stack.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-inspector-async-call-stack.js?ref=da8641f3b46f41be11ba932f4228a36bfee9fd1c",
            "patch": "@@ -1,10 +1,12 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n common.skipIfInspectorDisabled();\n common.skipIf32Bits();\n \n const assert = require('assert');\n-const async_wrap = process.binding('async_wrap');\n+const { internalBinding } = require('internal/test/binding');\n+const async_wrap = internalBinding('async_wrap');\n const { kTotals } = async_wrap.constants;\n const inspector = require('inspector');\n "
        }
    ],
    "stats": {
        "total": 39,
        "additions": 24,
        "deletions": 15
    }
}