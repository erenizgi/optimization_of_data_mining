{
    "author": "devsnek",
    "message": "module: add createRequireFunction method\n\nPR-URL: https://github.com/nodejs/node/pull/19360\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Jan Krems <jan.krems@gmail.com>\nReviewed-By: Bradley Farias <bradley.meck@gmail.com>\nReviewed-By: John-David Dalton <john.david.dalton@gmail.com>",
    "sha": "246f6332e5a5f395d1e39a3594ee5d6fe869d622",
    "files": [
        {
            "sha": "9919a675169e8b4cdaf76bf28894b8f1eb8d4108",
            "filename": "doc/api/modules.md",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/246f6332e5a5f395d1e39a3594ee5d6fe869d622/doc%2Fapi%2Fmodules.md",
            "raw_url": "https://github.com/nodejs/node/raw/246f6332e5a5f395d1e39a3594ee5d6fe869d622/doc%2Fapi%2Fmodules.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fmodules.md?ref=246f6332e5a5f395d1e39a3594ee5d6fe869d622",
            "patch": "@@ -888,12 +888,30 @@ by the [module wrapper][]. To access it, require the `Module` module:\n const builtin = require('module').builtinModules;\n ```\n \n+### module.createRequireFromPath(filename)\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+* `filename` {string} Filename to be used to construct the relative require\n+  function.\n+* Returns: {[`require`][]} Require function\n+\n+```js\n+const { createRequireFromPath } = require('module');\n+const requireUtil = createRequireFromPath('../src/utils');\n+\n+// require `../src/utils/some-tool`\n+requireUtil('./some-tool');\n+```\n+\n [`__dirname`]: #modules_dirname\n [`__filename`]: #modules_filename\n [`Error`]: errors.html#errors_class_error\n [`module` object]: #modules_the_module_object\n [`path.dirname()`]: path.html#path_path_dirname_path\n [GLOBAL_FOLDERS]: #modules_loading_from_the_global_folders\n+[`require`]: #modules_require\n [exports shortcut]: #modules_exports_shortcut\n [module resolution]: #modules_all_together\n [module wrapper]: #modules_the_module_wrapper"
        },
        {
            "sha": "3a983fd7bcf00f2888517ebb4517aa5cc44c7645",
            "filename": "lib/internal/modules/cjs/loader.js",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/246f6332e5a5f395d1e39a3594ee5d6fe869d622/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "raw_url": "https://github.com/nodejs/node/raw/246f6332e5a5f395d1e39a3594ee5d6fe869d622/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js?ref=246f6332e5a5f395d1e39a3594ee5d6fe869d622",
            "patch": "@@ -23,6 +23,7 @@\n \n const { internalBinding, NativeModule } = require('internal/bootstrap/loaders');\n const util = require('util');\n+const { pathToFileURL } = require('internal/url');\n const vm = require('vm');\n const assert = require('assert').ok;\n const fs = require('fs');\n@@ -54,7 +55,6 @@ module.exports = Module;\n let asyncESM;\n let ModuleJob;\n let createDynamicModule;\n-let pathToFileURL;\n let decorateErrorStack;\n \n function lazyLoadESM() {\n@@ -63,7 +63,6 @@ function lazyLoadESM() {\n   createDynamicModule = require(\n     'internal/modules/esm/create_dynamic_module');\n   decorateErrorStack = require('internal/util').decorateErrorStack;\n-  pathToFileURL = require('internal/url').pathToFileURL;\n }\n \n const {\n@@ -750,6 +749,13 @@ Module.runMain = function() {\n   process._tickCallback();\n };\n \n+Module.createRequireFromPath = (filename) => {\n+  const m = new Module(filename);\n+  m.filename = filename;\n+  m.paths = Module._nodeModulePaths(path.dirname(filename));\n+  return makeRequireFunction(m);\n+};\n+\n Module._initPaths = function() {\n   var homeDir;\n   var nodePath;"
        },
        {
            "sha": "03ed31939fba67c28a839f7ed2b22bfde59b0af5",
            "filename": "test/parallel/test-module-create-require.js",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/246f6332e5a5f395d1e39a3594ee5d6fe869d622/test%2Fparallel%2Ftest-module-create-require.js",
            "raw_url": "https://github.com/nodejs/node/raw/246f6332e5a5f395d1e39a3594ee5d6fe869d622/test%2Fparallel%2Ftest-module-create-require.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-module-create-require.js?ref=246f6332e5a5f395d1e39a3594ee5d6fe869d622",
            "patch": "@@ -0,0 +1,12 @@\n+'use strict';\n+\n+require('../common');\n+const assert = require('assert');\n+const path = require('path');\n+\n+const { createRequireFromPath } = require('module');\n+\n+const p = path.resolve(__dirname, '..', 'fixtures', 'fake.js');\n+\n+const req = createRequireFromPath(p);\n+assert.strictEqual(req('./baz'), 'perhaps I work');"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 38,
        "deletions": 2
    }
}