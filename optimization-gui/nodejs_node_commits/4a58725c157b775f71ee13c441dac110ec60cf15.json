{
    "author": "addaleax",
    "message": "src: add iteration over all base objects to Environment\n\nPR-URL: https://github.com/nodejs/node/pull/21741\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "4a58725c157b775f71ee13c441dac110ec60cf15",
    "files": [
        {
            "sha": "fccd45070c4e07bc186313a3ac49c8b62681381b",
            "filename": "src/env-inl.h",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/4a58725c157b775f71ee13c441dac110ec60cf15/src%2Fenv-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/4a58725c157b775f71ee13c441dac110ec60cf15/src%2Fenv-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv-inl.h?ref=4a58725c157b775f71ee13c441dac110ec60cf15",
            "patch": "@@ -809,6 +809,22 @@ bool Environment::CleanupHookCallback::Equal::operator()(\n   return a.fn_ == b.fn_ && a.arg_ == b.arg_;\n }\n \n+BaseObject* Environment::CleanupHookCallback::GetBaseObject() const {\n+  if (fn_ == BaseObject::DeleteMe)\n+    return static_cast<BaseObject*>(arg_);\n+  else\n+    return nullptr;\n+}\n+\n+template <typename T>\n+void Environment::ForEachBaseObject(T&& iterator) {\n+  for (const auto& hook : cleanup_hooks_) {\n+    BaseObject* obj = hook.GetBaseObject();\n+    if (obj != nullptr)\n+      iterator(obj);\n+  }\n+}\n+\n #define VP(PropertyName, StringValue) V(v8::Private, PropertyName)\n #define VY(PropertyName, StringValue) V(v8::Symbol, PropertyName)\n #define VS(PropertyName, StringValue) V(v8::String, PropertyName)"
        },
        {
            "sha": "9bdf33bce0b88c98e8bb13bc3e4828958219db97",
            "filename": "src/env.h",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/4a58725c157b775f71ee13c441dac110ec60cf15/src%2Fenv.h",
            "raw_url": "https://github.com/nodejs/node/raw/4a58725c157b775f71ee13c441dac110ec60cf15/src%2Fenv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.h?ref=4a58725c157b775f71ee13c441dac110ec60cf15",
            "patch": "@@ -981,6 +981,8 @@ class Environment {\n       inline bool operator()(const CleanupHookCallback& a,\n                              const CleanupHookCallback& b) const;\n     };\n+\n+    inline BaseObject* GetBaseObject() const;\n   };\n \n   // Use an unordered_set, so that we have efficient insertion and removal.\n@@ -993,6 +995,9 @@ class Environment {\n                              v8::Local<v8::Promise> promise,\n                              v8::Local<v8::Value> parent);\n \n+  template <typename T>\n+  void ForEachBaseObject(T&& iterator);\n+\n #define V(PropertyName, TypeName) Persistent<TypeName> PropertyName ## _;\n   ENVIRONMENT_STRONG_PERSISTENT_PROPERTIES(V)\n #undef V"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 21,
        "deletions": 0
    }
}