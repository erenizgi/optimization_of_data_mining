{
    "author": "starkwang",
    "message": "test: improve tests for test-http-url.parse\n\nPR-URL: https://github.com/nodejs/node/pull/18523\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "4a881e04dc1659669d2e84d2307abc1b9d9cbbd1",
    "files": [
        {
            "sha": "c10f5ed7b0d31bf0f1a2b3d6a73ce3e0c043e8a9",
            "filename": "test/parallel/test-http-url.parse-auth-with-header-in-request.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-auth-with-header-in-request.js",
            "raw_url": "https://github.com/nodejs/node/raw/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-auth-with-header-in-request.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-url.parse-auth-with-header-in-request.js?ref=4a881e04dc1659669d2e84d2307abc1b9d9cbbd1",
            "patch": "@@ -32,7 +32,7 @@ function check(request) {\n \n const server = http.createServer(function(request, response) {\n   // run the check function\n-  check.call(this, request, response);\n+  check(request);\n   response.writeHead(200, {});\n   response.end('ok');\n   server.close();"
        },
        {
            "sha": "ab597e132c80120f12401ad3c03299095c3952be",
            "filename": "test/parallel/test-http-url.parse-auth.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-auth.js",
            "raw_url": "https://github.com/nodejs/node/raw/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-auth.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-url.parse-auth.js?ref=4a881e04dc1659669d2e84d2307abc1b9d9cbbd1",
            "patch": "@@ -32,7 +32,7 @@ function check(request) {\n \n const server = http.createServer(function(request, response) {\n   // run the check function\n-  check.call(this, request, response);\n+  check(request);\n   response.writeHead(200, {});\n   response.end('ok');\n   server.close();"
        },
        {
            "sha": "a6ecd3918f18033750a8e2d8b29d1eb2f5676c53",
            "filename": "test/parallel/test-http-url.parse-basic.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-basic.js",
            "raw_url": "https://github.com/nodejs/node/raw/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-basic.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-url.parse-basic.js?ref=4a881e04dc1659669d2e84d2307abc1b9d9cbbd1",
            "patch": "@@ -40,7 +40,7 @@ function check(request) {\n \n const server = http.createServer(function(request, response) {\n   // run the check function\n-  check.call(this, request, response);\n+  check(request);\n   response.writeHead(200, {});\n   response.end('ok');\n   server.close();"
        },
        {
            "sha": "f58be0257c1fc5513f7f69887fdde292f806736d",
            "filename": "test/parallel/test-http-url.parse-https.request.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-https.request.js",
            "raw_url": "https://github.com/nodejs/node/raw/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-https.request.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-url.parse-https.request.js?ref=4a881e04dc1659669d2e84d2307abc1b9d9cbbd1",
            "patch": "@@ -42,7 +42,7 @@ function check(request) {\n \n const server = https.createServer(httpsOptions, function(request, response) {\n   // run the check function\n-  check.call(this, request, response);\n+  check(request);\n   response.writeHead(200, {});\n   response.end('ok');\n   server.close();"
        },
        {
            "sha": "986f75d307643453499abed3294699dceaa4a155",
            "filename": "test/parallel/test-http-url.parse-only-support-http-https-protocol.js",
            "status": "modified",
            "additions": 18,
            "deletions": 61,
            "changes": 79,
            "blob_url": "https://github.com/nodejs/node/blob/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-only-support-http-https-protocol.js",
            "raw_url": "https://github.com/nodejs/node/raw/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-only-support-http-https-protocol.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-url.parse-only-support-http-https-protocol.js?ref=4a881e04dc1659669d2e84d2307abc1b9d9cbbd1",
            "patch": "@@ -20,68 +20,25 @@\n // USE OR OTHER DEALINGS IN THE SOFTWARE.\n \n 'use strict';\n-require('../common');\n-const assert = require('assert');\n+const common = require('../common');\n const http = require('http');\n const url = require('url');\n \n-\n-assert.throws(function() {\n-  http.request(url.parse('file:///whatever'));\n-}, function(err) {\n-  if (err instanceof Error) {\n-    assert.strictEqual(\n-      err.message, 'Protocol \"file:\" not supported. Expected \"http:\"');\n-    return true;\n-  }\n-});\n-\n-assert.throws(function() {\n-  http.request(url.parse('mailto:asdf@asdf.com'));\n-}, function(err) {\n-  if (err instanceof Error) {\n-    assert.strictEqual(\n-      err.message, 'Protocol \"mailto:\" not supported. Expected \"http:\"');\n-    return true;\n-  }\n-});\n-\n-assert.throws(function() {\n-  http.request(url.parse('ftp://www.example.com'));\n-}, function(err) {\n-  if (err instanceof Error) {\n-    assert.strictEqual(\n-      err.message, 'Protocol \"ftp:\" not supported. Expected \"http:\"');\n-    return true;\n-  }\n-});\n-\n-assert.throws(function() {\n-  http.request(url.parse('javascript:alert(\\'hello\\');'));\n-}, function(err) {\n-  if (err instanceof Error) {\n-    assert.strictEqual(\n-      err.message, 'Protocol \"javascript:\" not supported. Expected \"http:\"');\n-    return true;\n-  }\n-});\n-\n-assert.throws(function() {\n-  http.request(url.parse('xmpp:isaacschlueter@jabber.org'));\n-}, function(err) {\n-  if (err instanceof Error) {\n-    assert.strictEqual(\n-      err.message, 'Protocol \"xmpp:\" not supported. Expected \"http:\"');\n-    return true;\n-  }\n-});\n-\n-assert.throws(function() {\n-  http.request(url.parse('f://some.host/path'));\n-}, function(err) {\n-  if (err instanceof Error) {\n-    assert.strictEqual(\n-      err.message, 'Protocol \"f:\" not supported. Expected \"http:\"');\n-    return true;\n-  }\n+const invalidUrls = [\n+  'file:///whatever',\n+  'mailto:asdf@asdf.com',\n+  'ftp://www.example.com',\n+  'javascript:alert(\\'hello\\');',\n+  'xmpp:foo@bar.com',\n+  'f://some.host/path'\n+];\n+\n+invalidUrls.forEach((invalid) => {\n+  common.expectsError(\n+    () => { http.request(url.parse(invalid)); },\n+    {\n+      code: 'ERR_INVALID_PROTOCOL',\n+      type: Error\n+    }\n+  );\n });"
        },
        {
            "sha": "4cc5fbf48e015d0e77e044886df933bdf962e68b",
            "filename": "test/parallel/test-http-url.parse-path.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-path.js",
            "raw_url": "https://github.com/nodejs/node/raw/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-path.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-url.parse-path.js?ref=4a881e04dc1659669d2e84d2307abc1b9d9cbbd1",
            "patch": "@@ -32,7 +32,7 @@ function check(request) {\n \n const server = http.createServer(function(request, response) {\n   // run the check function\n-  check.call(this, request, response);\n+  check(request);\n   response.writeHead(200, {});\n   response.end('ok');\n   server.close();"
        },
        {
            "sha": "d8803cbfd267db145a9188cd33fb6c49f4b942ea",
            "filename": "test/parallel/test-http-url.parse-post.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-post.js",
            "raw_url": "https://github.com/nodejs/node/raw/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-post.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-url.parse-post.js?ref=4a881e04dc1659669d2e84d2307abc1b9d9cbbd1",
            "patch": "@@ -39,7 +39,7 @@ function check(request) {\n \n const server = http.createServer(function(request, response) {\n   // run the check function\n-  check.call(this, request, response);\n+  check(request);\n   response.writeHead(200, {});\n   response.end('ok');\n   server.close();"
        },
        {
            "sha": "111cf97874b4d3c4e5b6e69a9226e63bb21ca3ab",
            "filename": "test/parallel/test-http-url.parse-search.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-search.js",
            "raw_url": "https://github.com/nodejs/node/raw/4a881e04dc1659669d2e84d2307abc1b9d9cbbd1/test%2Fparallel%2Ftest-http-url.parse-search.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-url.parse-search.js?ref=4a881e04dc1659669d2e84d2307abc1b9d9cbbd1",
            "patch": "@@ -32,7 +32,7 @@ function check(request) {\n \n const server = http.createServer(function(request, response) {\n   // run the check function\n-  check.call(this, request, response);\n+  check(request);\n   response.writeHead(200, {});\n   response.end('ok');\n   server.close();"
        }
    ],
    "stats": {
        "total": 93,
        "additions": 25,
        "deletions": 68
    }
}