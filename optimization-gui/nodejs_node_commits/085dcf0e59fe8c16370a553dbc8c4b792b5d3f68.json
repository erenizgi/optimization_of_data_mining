{
    "author": "tniessen",
    "message": "crypto: allow promisifying generateKeyPair\n\nPR-URL: https://github.com/nodejs/node/pull/22660\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ujjwal Sharma <usharma1998@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>",
    "sha": "085dcf0e59fe8c16370a553dbc8c4b792b5d3f68",
    "files": [
        {
            "sha": "b26e9cae04a80ca0ca8330f51491a313d13e091b",
            "filename": "doc/api/crypto.md",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/085dcf0e59fe8c16370a553dbc8c4b792b5d3f68/doc%2Fapi%2Fcrypto.md",
            "raw_url": "https://github.com/nodejs/node/raw/085dcf0e59fe8c16370a553dbc8c4b792b5d3f68/doc%2Fapi%2Fcrypto.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fcrypto.md?ref=085dcf0e59fe8c16370a553dbc8c4b792b5d3f68",
            "patch": "@@ -1731,6 +1731,9 @@ buffer containing the data encoded as DER. Note that Node.js itself does not\n accept DER, it is supported for interoperability with other libraries such as\n WebCrypto only.\n \n+If this method is invoked as its [`util.promisify()`][]ed version, it returns\n+a `Promise` for an `Object` with `publicKey` and `privateKey` properties.\n+\n ### crypto.generateKeyPairSync(type, options)\n <!-- YAML\n added: REPLACEME\n@@ -2882,6 +2885,7 @@ the `crypto`, `tls`, and `https` modules and are generally specific to OpenSSL.\n [`sign.update()`]: #crypto_sign_update_data_inputencoding\n [`stream.transform` options]: stream.html#stream_new_stream_transform_options\n [`stream.Writable` options]: stream.html#stream_constructor_new_stream_writable_options\n+[`util.promisify()`]: util.html#util_util_promisify_original\n [`verify.update()`]: #crypto_verify_update_data_inputencoding\n [`verify.verify()`]: #crypto_verify_verify_object_signature_signatureformat\n [AEAD algorithms]: https://en.wikipedia.org/wiki/Authenticated_encryption"
        },
        {
            "sha": "40433e9abf04b4a2711e941f980494cc81d05845",
            "filename": "lib/internal/crypto/keygen.js",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/085dcf0e59fe8c16370a553dbc8c4b792b5d3f68/lib%2Finternal%2Fcrypto%2Fkeygen.js",
            "raw_url": "https://github.com/nodejs/node/raw/085dcf0e59fe8c16370a553dbc8c4b792b5d3f68/lib%2Finternal%2Fcrypto%2Fkeygen.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fkeygen.js?ref=085dcf0e59fe8c16370a553dbc8c4b792b5d3f68",
            "patch": "@@ -15,6 +15,7 @@ const {\n   PK_FORMAT_DER,\n   PK_FORMAT_PEM\n } = internalBinding('crypto');\n+const { customPromisifyArgs } = require('internal/util');\n const { isUint32 } = require('internal/validators');\n const {\n   ERR_CRYPTO_INCOMPATIBLE_KEY_OPTIONS,\n@@ -44,6 +45,11 @@ function generateKeyPair(type, options, callback) {\n   handleError(impl, wrap);\n }\n \n+Object.defineProperty(generateKeyPair, customPromisifyArgs, {\n+  value: ['publicKey', 'privateKey'],\n+  enumerable: false\n+});\n+\n function generateKeyPairSync(type, options) {\n   const impl = check(type, options);\n   return handleError(impl);"
        },
        {
            "sha": "f614b09292501e1e1c3773c327f74e7cd7f3f87f",
            "filename": "test/parallel/test-crypto-keygen.js",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/085dcf0e59fe8c16370a553dbc8c4b792b5d3f68/test%2Fparallel%2Ftest-crypto-keygen.js",
            "raw_url": "https://github.com/nodejs/node/raw/085dcf0e59fe8c16370a553dbc8c4b792b5d3f68/test%2Fparallel%2Ftest-crypto-keygen.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-keygen.js?ref=085dcf0e59fe8c16370a553dbc8c4b792b5d3f68",
            "patch": "@@ -13,6 +13,7 @@ const {\n   publicEncrypt,\n   privateDecrypt\n } = require('crypto');\n+const { promisify } = require('util');\n \n // Asserts that the size of the given key (in chars or bytes) is within 10% of\n // the expected size.\n@@ -240,6 +241,34 @@ function convertDERToPEM(label, der) {\n   }));\n }\n \n+{\n+  // Test the util.promisified API with async RSA key generation.\n+  promisify(generateKeyPair)('rsa', {\n+    publicExponent: 0x10001,\n+    modulusLength: 3072,\n+    publicKeyEncoding: {\n+      type: 'pkcs1',\n+      format: 'pem'\n+    },\n+    privateKeyEncoding: {\n+      type: 'pkcs1',\n+      format: 'pem'\n+    }\n+  }).then(common.mustCall((keys) => {\n+    const { publicKey, privateKey } = keys;\n+    assert.strictEqual(typeof publicKey, 'string');\n+    assert(pkcs1PubExp.test(publicKey));\n+    assertApproximateSize(publicKey, 600);\n+\n+    assert.strictEqual(typeof privateKey, 'string');\n+    assert(pkcs1PrivExp.test(privateKey));\n+    assertApproximateSize(privateKey, 2455);\n+\n+    testEncryptDecrypt(publicKey, privateKey);\n+    testSignVerify(publicKey, privateKey);\n+  })).catch(common.mustNotCall());\n+}\n+\n {\n   // Test invalid key types.\n   for (const type of [undefined, null, 0]) {"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 39,
        "deletions": 0
    }
}