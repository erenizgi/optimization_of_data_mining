{
    "author": "shigeki",
    "message": "deps: fix for non GNU assembler in AIX\n\nAIX has own assembler not GNU as that does not support --noexecstack.\n\nPR-URL: https://github.com/nodejs/node/pull/25381\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Shigeki Ohtsu <ohtsu@ohtsu.org>",
    "sha": "0534de6911a28954b07fc46de98bcffd015e3afc",
    "files": [
        {
            "sha": "891ccb62bbf6d45d87a30dd1ed9bcfdc434674dd",
            "filename": "deps/openssl/config/generate_gypi.pl",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/0534de6911a28954b07fc46de98bcffd015e3afc/deps%2Fopenssl%2Fconfig%2Fgenerate_gypi.pl",
            "raw_url": "https://github.com/nodejs/node/raw/0534de6911a28954b07fc46de98bcffd015e3afc/deps%2Fopenssl%2Fconfig%2Fgenerate_gypi.pl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2Fgenerate_gypi.pl?ref=0534de6911a28954b07fc46de98bcffd015e3afc",
            "patch": "@@ -25,13 +25,6 @@\n my $nasm_banner = `nasm -v`;\n die \"Error: nasm is not installed.\" if (!$nasm_banner);\n \n-my $nasm_version_min =  2.13.3;\n-my ($nasm_version) = ($nasm_banner =~/^NASM version ([0-9]\\.[0-9][0-9])+/);\n-if ($nasm_version < $nasm_version_min) {\n-  die \"Error: nasm version $nasm_version is too old.\" .\n-    \"$nasm_version_min or higher is required.\";\n-}\n-\n # gas version check\n my $gas_version_min = 2.30;\n my $gas_banner = `gcc -Wa,-v -c -o /dev/null -x assembler /dev/null 2>&1`;\n@@ -118,6 +111,17 @@\n $target{'lib_cppflags'} =~ s/-D//g;\n my @lib_cppflags = split(/ /, $target{'lib_cppflags'});\n \n+my @cflags = ();\n+push(@cflags, @{$config{'cflags'}});\n+push(@cflags, @{$config{'CFLAGS'}});\n+push(@cflags, $target{'cflags'});\n+push(@cflags, $target{'CFLAGS'});\n+\n+# AIX has own assembler not GNU as that does not support --noexecstack\n+if ($arch =~ /aix/) {\n+  @cflags = grep $_ ne '-Wa,--noexecstack', @cflags;\n+}\n+\n # Create openssl.gypi\n my $template =\n     Text::Template->new(TYPE => 'FILE',\n@@ -132,6 +136,7 @@\n         generated_srcs => \\@generated_srcs,\n         config => \\%config,\n         target => \\%target,\n+        cflags => \\@cflags,\n         asm => \\$asm,\n         arch => \\$arch,\n         lib_cppflags => \\@lib_cppflags,\n@@ -155,6 +160,7 @@\n         libapps_srcs => \\@libapps_srcs,\n         config => \\%config,\n         target => \\%target,\n+        cflags => \\@cflags,\n         asm => \\$asm,\n         arch => \\$arch,\n         lib_cppflags => \\@lib_cppflags,"
        },
        {
            "sha": "d0306fc052bc51ee06e8958da25f114597914d93",
            "filename": "deps/openssl/config/openssl-cl.gypi.tmpl",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/0534de6911a28954b07fc46de98bcffd015e3afc/deps%2Fopenssl%2Fconfig%2Fopenssl-cl.gypi.tmpl",
            "raw_url": "https://github.com/nodejs/node/raw/0534de6911a28954b07fc46de98bcffd015e3afc/deps%2Fopenssl%2Fconfig%2Fopenssl-cl.gypi.tmpl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2Fopenssl-cl.gypi.tmpl?ref=0534de6911a28954b07fc46de98bcffd015e3afc",
            "patch": "@@ -14,15 +14,9 @@\n   $OUT .= \"      '$define',\\n\";\n } -%%    ],\n     'openssl_cflags_%%-$arch-%%': [\n-%%- foreach $cflag (@{$config{cflags}}) {\n+%%- foreach $cflag (@cflags) {\n       $OUT .= \"      '$cflag',\\n\";\n-    }\n-    foreach $cflag (@{$config{CFLAGS}}) {\n-      $OUT .= \"      '$cflag',\\n\";\n-    } -%%\n-      '%%-$target{cflags}-%%',\n-      '%%-$target{CFLAGS}-%%',\n-    ],\n+} -%%    ],\n     'openssl_ex_libs_%%-$arch-%%': [\n       '%%-$target{ex_libs}-%%',\n     ],"
        },
        {
            "sha": "191bbb444af021fd35e9a79b183170dce10465a6",
            "filename": "deps/openssl/config/openssl.gypi.tmpl",
            "status": "modified",
            "additions": 2,
            "deletions": 8,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/0534de6911a28954b07fc46de98bcffd015e3afc/deps%2Fopenssl%2Fconfig%2Fopenssl.gypi.tmpl",
            "raw_url": "https://github.com/nodejs/node/raw/0534de6911a28954b07fc46de98bcffd015e3afc/deps%2Fopenssl%2Fconfig%2Fopenssl.gypi.tmpl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fconfig%2Fopenssl.gypi.tmpl?ref=0534de6911a28954b07fc46de98bcffd015e3afc",
            "patch": "@@ -25,15 +25,9 @@ foreach $src (@libcrypto_srcs) {\n   $OUT .= \"      '$define',\\n\";\n } -%%    ],\n     'openssl_cflags_%%-$arch-%%': [\n-%%- foreach $cflag (@{$config{cflags}}) {\n+%%- foreach $cflag (@cflags) {\n       $OUT .= \"      '$cflag',\\n\";\n-    }\n-    foreach $cflag (@{$config{CFLAGS}}) {\n-      $OUT .= \"      '$cflag',\\n\";\n-    } -%%\n-      '%%-$target{cflags}-%%',\n-      '%%-$target{CFLAGS}-%%',\n-    ],\n+} -%%    ],\n     'openssl_ex_libs_%%-$arch-%%': [\n       '%%-$target{ex_libs}-%%',\n     ],"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 17,
        "deletions": 23
    }
}