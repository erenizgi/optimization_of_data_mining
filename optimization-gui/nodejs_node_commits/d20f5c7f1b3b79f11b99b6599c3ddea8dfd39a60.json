{
    "author": "joyeecheung",
    "message": "test: pull html/webappapis/microtask-queuing WPT\n\nWith the command:\n\n```\ngit node wpt html/webappapis/microtask-queuing\n```\n\nPR-URL: https://github.com/nodejs/node/pull/25616\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Gus Caplan <me@gus.host>",
    "sha": "d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60",
    "files": [
        {
            "sha": "457a05f07d5306020bd6f2662c3bd59365ff23cb",
            "filename": "test/fixtures/wpt/README.md",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2FREADME.md",
            "raw_url": "https://github.com/nodejs/node/raw/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2FREADME.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fwpt%2FREADME.md?ref=d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60",
            "patch": "@@ -15,6 +15,7 @@ Last update:\n - url: https://github.com/web-platform-tests/wpt/tree/75b0f336c5/url\n - resources: https://github.com/web-platform-tests/wpt/tree/679a364421/resources\n - interfaces: https://github.com/web-platform-tests/wpt/tree/712c9f275e/interfaces\n+- html/webappapis/microtask-queuing: https://github.com/web-platform-tests/wpt/tree/0c3bed38df/html/webappapis/microtask-queuing\n \n [Web Platform Tests]: https://github.com/web-platform-tests/wpt\n [`git node wpt`]: https://github.com/nodejs/node-core-utils/blob/master/docs/git-node.md#git-node-wpt"
        },
        {
            "sha": "01f32ac9ba14962fa99d4b263a8ca0f5a0daa161",
            "filename": "test/fixtures/wpt/html/webappapis/microtask-queuing/queue-microtask-exceptions.any.js",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2Fhtml%2Fwebappapis%2Fmicrotask-queuing%2Fqueue-microtask-exceptions.any.js",
            "raw_url": "https://github.com/nodejs/node/raw/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2Fhtml%2Fwebappapis%2Fmicrotask-queuing%2Fqueue-microtask-exceptions.any.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fwpt%2Fhtml%2Fwebappapis%2Fmicrotask-queuing%2Fqueue-microtask-exceptions.any.js?ref=d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60",
            "patch": "@@ -0,0 +1,15 @@\n+// META: global=window,worker\n+\"use strict\";\n+\n+setup({\n+  allow_uncaught_exception: true\n+});\n+\n+async_test(t => {\n+  const error = new Error(\"boo\");\n+  self.addEventListener(\"error\", t.step_func_done(ev => {\n+    assert_equals(ev.error, error);\n+  }));\n+\n+  queueMicrotask(() => { throw error; });\n+}, \"It rethrows exceptions\");"
        },
        {
            "sha": "b39931719a88ad525511d8f8745a9b752a6a6465",
            "filename": "test/fixtures/wpt/html/webappapis/microtask-queuing/queue-microtask.any.js",
            "status": "added",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2Fhtml%2Fwebappapis%2Fmicrotask-queuing%2Fqueue-microtask.any.js",
            "raw_url": "https://github.com/nodejs/node/raw/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2Fhtml%2Fwebappapis%2Fmicrotask-queuing%2Fqueue-microtask.any.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fwpt%2Fhtml%2Fwebappapis%2Fmicrotask-queuing%2Fqueue-microtask.any.js?ref=d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60",
            "patch": "@@ -0,0 +1,39 @@\n+// META: global=window,worker\n+\"use strict\";\n+\n+test(() => {\n+  assert_equals(typeof queueMicrotask, \"function\");\n+}, \"It exists and is a function\");\n+\n+test(() => {\n+  assert_throws(new TypeError(), () => queueMicrotask(), \"no argument\");\n+  assert_throws(new TypeError(), () => queueMicrotask(undefined), \"undefined\");\n+  assert_throws(new TypeError(), () => queueMicrotask(null), \"null\");\n+  assert_throws(new TypeError(), () => queueMicrotask(0), \"0\");\n+  assert_throws(new TypeError(), () => queueMicrotask({ handleEvent() { } }), \"an event handler object\");\n+  assert_throws(new TypeError(), () => queueMicrotask(\"window.x = 5;\"), \"a string\");\n+}, \"It throws when given non-functions\");\n+\n+async_test(t => {\n+  let called = false;\n+  queueMicrotask(t.step_func_done(() => {\n+    called = true;\n+  }));\n+  assert_false(called);\n+}, \"It calls the callback asynchronously\");\n+\n+async_test(t => {\n+  queueMicrotask(t.step_func_done(function () { // note: intentionally not an arrow function\n+    assert_array_equals(arguments, []);\n+  }), \"x\", \"y\");\n+}, \"It does not pass any arguments\");\n+\n+async_test(t => {\n+  const happenings = [];\n+  Promise.resolve().then(() => happenings.push(\"a\"));\n+  queueMicrotask(() => happenings.push(\"b\"));\n+  Promise.reject().catch(() => happenings.push(\"c\"));\n+  queueMicrotask(t.step_func_done(() => {\n+    assert_array_equals(happenings, [\"a\", \"b\", \"c\"]);\n+  }));\n+}, \"It interleaves with promises as expected\");"
        },
        {
            "sha": "78cdcfc5d989a81882a10b7d70050408aadfe924",
            "filename": "test/fixtures/wpt/html/webappapis/microtask-queuing/queue-microtask.window.js",
            "status": "added",
            "additions": 45,
            "deletions": 0,
            "changes": 45,
            "blob_url": "https://github.com/nodejs/node/blob/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2Fhtml%2Fwebappapis%2Fmicrotask-queuing%2Fqueue-microtask.window.js",
            "raw_url": "https://github.com/nodejs/node/raw/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2Fhtml%2Fwebappapis%2Fmicrotask-queuing%2Fqueue-microtask.window.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fwpt%2Fhtml%2Fwebappapis%2Fmicrotask-queuing%2Fqueue-microtask.window.js?ref=d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60",
            "patch": "@@ -0,0 +1,45 @@\n+\"use strict\";\n+\n+// This does not work as you expect because mutation observer compound microtasks are confusing.\n+// Basically you can only use it once per test.\n+function queueMicrotaskViaMO(cb) {\n+  const observer = new MutationObserver(cb);\n+  const node = document.createTextNode(\"\");\n+  observer.observe(node, { characterData: true });\n+  node.data = \"foo\";\n+}\n+\n+// Need to use promise_test to get sequential ordering; otherwise the global mutation observer\n+// compound microtask business screws us over.\n+\n+promise_test(() => {\n+  return new Promise(resolve => {\n+    const happenings = [];\n+\n+    queueMicrotaskViaMO(() => happenings.push(\"x\"));\n+    queueMicrotask(() => happenings.push(\"a\"));\n+\n+    queueMicrotask(() => {\n+      assert_array_equals(happenings, [\"x\", \"a\"]);\n+      resolve();\n+    });\n+  });\n+}, \"It interleaves with MutationObservers as expected\");\n+\n+promise_test(() => {\n+  return new Promise(resolve => {\n+    const happenings = [];\n+\n+    queueMicrotask(() => happenings.push(\"a\"));\n+    Promise.reject().catch(() => happenings.push(\"x\"));\n+    queueMicrotaskViaMO(() => happenings.push(1));\n+    Promise.resolve().then(() => happenings.push(\"y\"));\n+    queueMicrotask(() => happenings.push(\"b\"));\n+    queueMicrotask(() => happenings.push(\"c\"));\n+\n+    queueMicrotask(() => {\n+      assert_array_equals(happenings, [\"a\", \"x\", 1, \"y\", \"b\", \"c\"]);\n+      resolve();\n+    });\n+  });\n+}, \"It interleaves with MutationObservers and promises together as expected\");"
        },
        {
            "sha": "4ca402a3491d4c705fac077cf97d2ba29e696feb",
            "filename": "test/fixtures/wpt/versions.json",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2Fversions.json",
            "raw_url": "https://github.com/nodejs/node/raw/d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60/test%2Ffixtures%2Fwpt%2Fversions.json",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fwpt%2Fversions.json?ref=d20f5c7f1b3b79f11b99b6599c3ddea8dfd39a60",
            "patch": "@@ -18,5 +18,9 @@\n   \"interfaces\": {\n     \"commit\": \"712c9f275e83997884749dbcaa503f12c0ff5bba\",\n     \"path\": \"interfaces\"\n+  },\n+  \"html/webappapis/microtask-queuing\": {\n+    \"commit\": \"0c3bed38df6d9dcd1441873728fb5c1bb59c92df\",\n+    \"path\": \"html/webappapis/microtask-queuing\"\n   }\n }\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 104,
        "additions": 104,
        "deletions": 0
    }
}