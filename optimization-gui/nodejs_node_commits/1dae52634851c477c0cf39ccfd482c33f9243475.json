{
    "author": "mafintosh",
    "message": "fs: fix reads with pos > 4GB\n\nPR-URL: https://github.com/nodejs/node/pull/21003\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "1dae52634851c477c0cf39ccfd482c33f9243475",
    "files": [
        {
            "sha": "da1ff5036932aea833c9aacc1b4866e25049d0fc",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/1dae52634851c477c0cf39ccfd482c33f9243475/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/1dae52634851c477c0cf39ccfd482c33f9243475/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=1dae52634851c477c0cf39ccfd482c33f9243475",
            "patch": "@@ -459,7 +459,7 @@ function read(fd, buffer, offset, length, position, callback) {\n \n   validateOffsetLengthRead(offset, length, buffer.length);\n \n-  if (!isUint32(position))\n+  if (!Number.isSafeInteger(position))\n     position = -1;\n \n   function wrapper(err, bytesRead) {\n@@ -489,7 +489,7 @@ function readSync(fd, buffer, offset, length, position) {\n \n   validateOffsetLengthRead(offset, length, buffer.length);\n \n-  if (!isUint32(position))\n+  if (!Number.isSafeInteger(position))\n     position = -1;\n \n   const ctx = {};"
        },
        {
            "sha": "864876537c22c6650cc26169f791ebaec4b74cb2",
            "filename": "test/parallel/test-fs-read.js",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/1dae52634851c477c0cf39ccfd482c33f9243475/test%2Fparallel%2Ftest-fs-read.js",
            "raw_url": "https://github.com/nodejs/node/raw/1dae52634851c477c0cf39ccfd482c33f9243475/test%2Fparallel%2Ftest-fs-read.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-read.js?ref=1dae52634851c477c0cf39ccfd482c33f9243475",
            "patch": "@@ -53,3 +53,18 @@ test(Buffer.allocUnsafe(expected.length),\n test(new Uint8Array(expected.length),\n      new Uint8Array(expected.length),\n      Uint8Array.from(expected));\n+\n+{\n+  // Reading beyond file length (3 in this case) should return no data.\n+  // This is a test for a bug where reads > uint32 would return data\n+  // from the current position in the file.\n+  const fd = fs.openSync(filepath, 'r');\n+  const pos = 0xffffffff + 1; // max-uint32 + 1\n+  const nRead = fs.readSync(fd, Buffer.alloc(1), 0, 1, pos);\n+  assert.strictEqual(nRead, 0);\n+\n+  fs.read(fd, Buffer.alloc(1), 0, 1, pos, common.mustCall((err, nRead) => {\n+    assert.ifError(err);\n+    assert.strictEqual(nRead, 0);\n+  }));\n+}"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 17,
        "deletions": 2
    }
}