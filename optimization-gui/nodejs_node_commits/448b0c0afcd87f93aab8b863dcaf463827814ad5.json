{
    "author": "gireeshpunathil",
    "message": "test: capture stderr from child processes\n\nIf the test fails with errors from the child commands,\nthere is no debug info. Suppliment the stderr data\nso that we know what to look for.\n\nRefs: https://github.com/nodejs/node/issues/25988\nPR-URL: https://github.com/nodejs/node/pull/26007\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "448b0c0afcd87f93aab8b863dcaf463827814ad5",
    "files": [
        {
            "sha": "f5068b5d36646883da0ceff7459e92f4aacbde66",
            "filename": "test/parallel/test-child-process-pipe-dataflow.js",
            "status": "modified",
            "additions": 10,
            "deletions": 12,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/448b0c0afcd87f93aab8b863dcaf463827814ad5/test%2Fparallel%2Ftest-child-process-pipe-dataflow.js",
            "raw_url": "https://github.com/nodejs/node/raw/448b0c0afcd87f93aab8b863dcaf463827814ad5/test%2Fparallel%2Ftest-child-process-pipe-dataflow.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-child-process-pipe-dataflow.js?ref=448b0c0afcd87f93aab8b863dcaf463827814ad5",
            "patch": "@@ -33,19 +33,17 @@ const MB = KB * KB;\n   grep = spawn('grep', ['x'], { stdio: [cat.stdout, 'pipe', 'pipe'] });\n   wc = spawn('wc', ['-c'], { stdio: [grep.stdout, 'pipe', 'pipe'] });\n \n+  [cat, grep, wc].forEach((child, index) => {\n+    child.stderr.on('data', (d) => {\n+      // Don't want to assert here, as we might miss error code info.\n+      console.error(`got unexpected data from child #${index}:\\n${d}`);\n+    });\n+    child.on('exit', common.mustCall(function(code) {\n+      assert.strictEqual(code, 0);\n+    }));\n+  });\n+\n   wc.stdout.on('data', common.mustCall(function(data) {\n     assert.strictEqual(data.toString().trim(), MB.toString());\n   }));\n-\n-  cat.on('exit', common.mustCall(function(code) {\n-    assert.strictEqual(code, 0);\n-  }));\n-\n-  grep.on('exit', common.mustCall(function(code) {\n-    assert.strictEqual(code, 0);\n-  }));\n-\n-  wc.on('exit', common.mustCall(function(code) {\n-    assert.strictEqual(code, 0);\n-  }));\n }"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 10,
        "deletions": 12
    }
}