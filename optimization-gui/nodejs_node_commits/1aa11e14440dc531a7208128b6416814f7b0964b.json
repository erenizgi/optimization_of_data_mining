{
    "author": "qubyte",
    "message": "http2: makes response.writeHead return the response\n\nFixes: https://github.com/nodejs/node/issues/25935\n\nPR-URL: https://github.com/nodejs/node/pull/25974\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "1aa11e14440dc531a7208128b6416814f7b0964b",
    "files": [
        {
            "sha": "f8eb4ab1a3b5505818af09f045efed404db4135a",
            "filename": "doc/api/http2.md",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/1aa11e14440dc531a7208128b6416814f7b0964b/doc%2Fapi%2Fhttp2.md",
            "raw_url": "https://github.com/nodejs/node/raw/1aa11e14440dc531a7208128b6416814f7b0964b/doc%2Fapi%2Fhttp2.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttp2.md?ref=1aa11e14440dc531a7208128b6416814f7b0964b",
            "patch": "@@ -3283,15 +3283,23 @@ should be sent. See the [`'checkContinue'`][] event on `Http2Server` and\n #### response.writeHead(statusCode[, statusMessage][, headers])\n <!-- YAML\n added: v8.4.0\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/25974\n+    description: Return `this` from `writeHead()` to allow chaining with\n+                 `end()`.\n -->\n \n * `statusCode` {number}\n * `statusMessage` {string}\n * `headers` {Object}\n+* Returns: {http2.Http2ServerResponse}\n \n Sends a response header to the request. The status code is a 3-digit HTTP\n status code, like `404`. The last argument, `headers`, are the response headers.\n \n+Returns a reference to the `Http2ServerResponse`, so that calls can be chained.\n+\n For compatibility with [HTTP/1][], a human-readable `statusMessage` may be\n passed as the second argument. However, because the `statusMessage` has no\n meaning within HTTP/2, the argument will have no effect and a process warning"
        },
        {
            "sha": "8043bd492a8990755cf77b94ebf6f104b8e97026",
            "filename": "lib/internal/http2/compat.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/1aa11e14440dc531a7208128b6416814f7b0964b/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "raw_url": "https://github.com/nodejs/node/raw/1aa11e14440dc531a7208128b6416814f7b0964b/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcompat.js?ref=1aa11e14440dc531a7208128b6416814f7b0964b",
            "patch": "@@ -568,10 +568,8 @@ class Http2ServerResponse extends Stream {\n     if (this[kStream].headersSent)\n       throw new ERR_HTTP2_HEADERS_SENT();\n \n-    // If the stream is destroyed, we return false,\n-    // like require('http').\n     if (this.stream.destroyed)\n-      return false;\n+      return this;\n \n     if (typeof statusMessage === 'string')\n       statusMessageWarn();\n@@ -596,6 +594,8 @@ class Http2ServerResponse extends Stream {\n \n     state.statusCode = statusCode;\n     this[kBeginSend]();\n+\n+    return this;\n   }\n \n   write(chunk, encoding, cb) {"
        },
        {
            "sha": "d856165d090f46572334711947d5184e64c2105e",
            "filename": "test/parallel/test-http2-compat-serverresponse-writehead-array.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/1aa11e14440dc531a7208128b6416814f7b0964b/test%2Fparallel%2Ftest-http2-compat-serverresponse-writehead-array.js",
            "raw_url": "https://github.com/nodejs/node/raw/1aa11e14440dc531a7208128b6416814f7b0964b/test%2Fparallel%2Ftest-http2-compat-serverresponse-writehead-array.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-compat-serverresponse-writehead-array.js?ref=1aa11e14440dc531a7208128b6416814f7b0964b",
            "patch": "@@ -12,10 +12,11 @@ const server = h2.createServer();\n server.listen(0, common.mustCall(() => {\n   const port = server.address().port;\n   server.once('request', common.mustCall((request, response) => {\n-    response.writeHead(200, [\n+    const returnVal = response.writeHead(200, [\n       ['foo', 'bar'],\n       ['ABC', 123]\n     ]);\n+    assert.strictEqual(returnVal, response);\n     response.end(common.mustCall(() => { server.close(); }));\n   }));\n "
        },
        {
            "sha": "aabcf18ad9e0cf2c41050ed7ebd1871c84bcb249",
            "filename": "test/parallel/test-http2-compat-serverresponse-writehead.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/1aa11e14440dc531a7208128b6416814f7b0964b/test%2Fparallel%2Ftest-http2-compat-serverresponse-writehead.js",
            "raw_url": "https://github.com/nodejs/node/raw/1aa11e14440dc531a7208128b6416814f7b0964b/test%2Fparallel%2Ftest-http2-compat-serverresponse-writehead.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-compat-serverresponse-writehead.js?ref=1aa11e14440dc531a7208128b6416814f7b0964b",
            "patch": "@@ -13,7 +13,11 @@ server.listen(0, common.mustCall(function() {\n   const port = server.address().port;\n   server.once('request', common.mustCall(function(request, response) {\n     response.setHeader('foo-bar', 'def456');\n-    response.writeHead(418, { 'foo-bar': 'abc123' }); // Override\n+\n+    // Override\n+    const returnVal = response.writeHead(418, { 'foo-bar': 'abc123' });\n+\n+    assert.strictEqual(returnVal, response);\n \n     common.expectsError(() => { response.writeHead(300); }, {\n       code: 'ERR_HTTP2_HEADERS_SENT'"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 18,
        "deletions": 5
    }
}