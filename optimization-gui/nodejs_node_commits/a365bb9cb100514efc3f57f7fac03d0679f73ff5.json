{
    "author": "joyeecheung",
    "message": "benchmark: pre-generate data set for URL benchmarks\n\nThis patch:\n\n- Introduces `common.bakeUrlData` which can be used to pre-generate\n  the data set for the URL benchmarks to loop through instead of\n  looping over a constant.\n- Add the option to use WPT data in benchmarks for better diversity\n  in the input\n- Add the option to benchmark URL parsing with base URLs (whatwg only)\n- Moves the data in `benchmark/fixtures/url-inputs.js` to\n  `benchmark/common.js`\n\nPR-URL: https://github.com/nodejs/node/pull/24302\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "a365bb9cb100514efc3f57f7fac03d0679f73ff5",
    "files": [
        {
            "sha": "d5e0494c16e82635ed2bcfb790a5290b2abce284",
            "filename": "benchmark/common.js",
            "status": "modified",
            "additions": 92,
            "deletions": 0,
            "changes": 92,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Fcommon.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Fcommon.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fcommon.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -254,3 +254,95 @@ exports.binding = function(bindingName) {\n     return process.binding(bindingName);\n   }\n };\n+\n+const urls = {\n+  long: 'http://nodejs.org:89/docs/latest/api/foo/bar/qua/13949281/0f28b/' +\n+        '/5d49/b3020/url.html#test?payload1=true&payload2=false&test=1' +\n+        '&benchmark=3&foo=38.38.011.293&bar=1234834910480&test=19299&3992&' +\n+        'key=f5c65e1e98fe07e648249ad41e1cfdb0',\n+  short: 'https://nodejs.org/en/blog/',\n+  idn: 'http://你好你好.在线',\n+  auth: 'https://user:pass@example.com/path?search=1',\n+  file: 'file:///foo/bar/test/node.js',\n+  ws: 'ws://localhost:9229/f46db715-70df-43ad-a359-7f9949f39868',\n+  javascript: 'javascript:alert(\"node is awesome\");',\n+  percent: 'https://%E4%BD%A0/foo',\n+  dot: 'https://example.org/./a/../b/./c'\n+};\n+exports.urls = urls;\n+\n+const searchParams = {\n+  noencode: 'foo=bar&baz=quux&xyzzy=thud',\n+  multicharsep: 'foo=bar&&&&&&&&&&baz=quux&&&&&&&&&&xyzzy=thud',\n+  encodefake: 'foo=%©ar&baz=%A©uux&xyzzy=%©ud',\n+  encodemany: '%66%6F%6F=bar&%62%61%7A=quux&xyzzy=%74h%75d',\n+  encodelast: 'foo=bar&baz=quux&xyzzy=thu%64',\n+  multivalue: 'foo=bar&foo=baz&foo=quux&quuy=quuz',\n+  multivaluemany: 'foo=bar&foo=baz&foo=quux&quuy=quuz&foo=abc&foo=def&' +\n+                  'foo=ghi&foo=jkl&foo=mno&foo=pqr&foo=stu&foo=vwxyz',\n+  manypairs: 'a&b&c&d&e&f&g&h&i&j&k&l&m&n&o&p&q&r&s&t&u&v&w&x&y&z',\n+  manyblankpairs: '&&&&&&&&&&&&&&&&&&&&&&&&',\n+  altspaces: 'foo+bar=baz+quux&xyzzy+thud=quuy+quuz&abc=def+ghi'\n+};\n+exports.searchParams = searchParams;\n+\n+function getUrlData(withBase) {\n+  const data = require('../test/fixtures/wpt/url/resources/urltestdata.json');\n+  const result = [];\n+  for (const item of data) {\n+    if (item.failure || !item.input) continue;\n+    if (withBase) {\n+      result.push([item.input, item.base]);\n+    } else if (item.base !== 'about:blank') {\n+      result.push(item.base);\n+    }\n+  }\n+  return result;\n+}\n+\n+exports.urlDataTypes = Object.keys(urls).concat(['wpt']);\n+\n+/**\n+ * Generate an array of data for URL benchmarks to use.\n+ * The size of the resulting data set is the original data size * 2 ** `e`.\n+ * The 'wpt' type contains about 400 data points when `withBase` is true,\n+ * and 200 data points when `withBase` is false.\n+ * Other types contain 200 data points with or without base.\n+ *\n+ * @param {string} type Type of the data, 'wpt' or a key of `urls`\n+ * @param {number} e The repetition of the data, as exponent of 2\n+ * @param {boolean} withBase Whether to include a base URL\n+ * @param {boolean} asUrl Whether to return the results as URL objects\n+ * @return {string[] | string[][] | URL[]}\n+ */\n+function bakeUrlData(type, e = 0, withBase = false, asUrl = false) {\n+  let result = [];\n+  if (type === 'wpt') {\n+    result = getUrlData(withBase);\n+  } else if (urls[type]) {\n+    const input = urls[type];\n+    const item = withBase ? [input, 'about:blank'] : input;\n+    // Roughly the size of WPT URL test data\n+    result = new Array(200).fill(item);\n+  } else {\n+    throw new Error(`Unknown url data type ${type}`);\n+  }\n+\n+  if (typeof e !== 'number') {\n+    throw new Error(`e must be a number, received ${e}`);\n+  }\n+\n+  for (let i = 0; i < e; ++i) {\n+    result = result.concat(result);\n+  }\n+\n+  if (asUrl) {\n+    if (withBase) {\n+      result = result.map(([input, base]) => new URL(input, base));\n+    } else {\n+      result = result.map((input) => new URL(input));\n+    }\n+  }\n+  return result;\n+}\n+exports.bakeUrlData = bakeUrlData;"
        },
        {
            "sha": "7b1983f6faa590b602ab4d1c78903007abb421c3",
            "filename": "benchmark/fixtures/url-inputs.js",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/5f25dd1e2eaa73ffb0a51e6d5b5150bcd5d0447e/benchmark%2Ffixtures%2Furl-inputs.js",
            "raw_url": "https://github.com/nodejs/node/raw/5f25dd1e2eaa73ffb0a51e6d5b5150bcd5d0447e/benchmark%2Ffixtures%2Furl-inputs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Ffixtures%2Furl-inputs.js?ref=5f25dd1e2eaa73ffb0a51e6d5b5150bcd5d0447e",
            "patch": "@@ -1,30 +0,0 @@\n-'use strict';\n-\n-exports.urls = {\n-  long: 'http://nodejs.org:89/docs/latest/api/foo/bar/qua/13949281/0f28b/' +\n-        '/5d49/b3020/url.html#test?payload1=true&payload2=false&test=1' +\n-        '&benchmark=3&foo=38.38.011.293&bar=1234834910480&test=19299&3992&' +\n-        'key=f5c65e1e98fe07e648249ad41e1cfdb0',\n-  short: 'https://nodejs.org/en/blog/',\n-  idn: 'http://你好你好.在线',\n-  auth: 'https://user:pass@example.com/path?search=1',\n-  file: 'file:///foo/bar/test/node.js',\n-  ws: 'ws://localhost:9229/f46db715-70df-43ad-a359-7f9949f39868',\n-  javascript: 'javascript:alert(\"node is awesome\");',\n-  percent: 'https://%E4%BD%A0/foo',\n-  dot: 'https://example.org/./a/../b/./c'\n-};\n-\n-exports.searchParams = {\n-  noencode: 'foo=bar&baz=quux&xyzzy=thud',\n-  multicharsep: 'foo=bar&&&&&&&&&&baz=quux&&&&&&&&&&xyzzy=thud',\n-  encodefake: 'foo=%©ar&baz=%A©uux&xyzzy=%©ud',\n-  encodemany: '%66%6F%6F=bar&%62%61%7A=quux&xyzzy=%74h%75d',\n-  encodelast: 'foo=bar&baz=quux&xyzzy=thu%64',\n-  multivalue: 'foo=bar&foo=baz&foo=quux&quuy=quuz',\n-  multivaluemany: 'foo=bar&foo=baz&foo=quux&quuy=quuz&foo=abc&foo=def&' +\n-                  'foo=ghi&foo=jkl&foo=mno&foo=pqr&foo=stu&foo=vwxyz',\n-  manypairs: 'a&b&c&d&e&f&g&h&i&j&k&l&m&n&o&p&q&r&s&t&u&v&w&x&y&z',\n-  manyblankpairs: '&&&&&&&&&&&&&&&&&&&&&&&&',\n-  altspaces: 'foo+bar=baz+quux&xyzzy+thud=quuy+quuz&abc=def+ghi'\n-};"
        },
        {
            "sha": "ca4dca13bc14eb5bc97f3f3c196098d55fd9c36b",
            "filename": "benchmark/querystring/querystring-parse.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Fquerystring%2Fquerystring-parse.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Fquerystring%2Fquerystring-parse.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fquerystring%2Fquerystring-parse.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -1,7 +1,7 @@\n 'use strict';\n const common = require('../common.js');\n const querystring = require('querystring');\n-const inputs = require('../fixtures/url-inputs.js').searchParams;\n+const inputs = common.searchParams;\n \n const bench = common.createBenchmark(main, {\n   type: Object.keys(inputs),"
        },
        {
            "sha": "59bb4724f42ef3a6f016ba69f92704fac67ea222",
            "filename": "benchmark/url/legacy-vs-whatwg-url-get-prop.js",
            "status": "modified",
            "additions": 21,
            "deletions": 23,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-get-prop.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-get-prop.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Furl%2Flegacy-vs-whatwg-url-get-prop.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -3,20 +3,15 @@ const common = require('../common.js');\n const url = require('url');\n const URL = url.URL;\n const assert = require('assert');\n-const inputs = require('../fixtures/url-inputs.js').urls;\n \n const bench = common.createBenchmark(main, {\n-  type: Object.keys(inputs),\n+  type: common.urlDataTypes,\n   method: ['legacy', 'whatwg'],\n-  n: [1e5]\n+  e: [1]\n });\n \n-// At the time of writing, when using a passed property name to index\n-// the object, Crankshaft would generate a LoadKeyedGeneric even when it\n-// remains a constant in the function, so here we must use the literal\n-// instead to get a LoadNamedField.\n-function useLegacy(n, input) {\n-  const obj = url.parse(input);\n+function useLegacy(data) {\n+  const obj = url.parse(data[0]);\n   const noDead = {\n     protocol: obj.protocol,\n     auth: obj.auth,\n@@ -27,10 +22,12 @@ function useLegacy(n, input) {\n     search: obj.search,\n     hash: obj.hash\n   };\n+  const len = data.length;\n   // It's necessary to assign the values to an object\n   // to avoid loop invariant code motion.\n   bench.start();\n-  for (var i = 0; i < n; i += 1) {\n+  for (var i = 0; i < len; i++) {\n+    const obj = data[i];\n     noDead.protocol = obj.protocol;\n     noDead.auth = obj.auth;\n     noDead.host = obj.host;\n@@ -40,12 +37,12 @@ function useLegacy(n, input) {\n     noDead.search = obj.search;\n     noDead.hash = obj.hash;\n   }\n-  bench.end(n);\n+  bench.end(len);\n   return noDead;\n }\n \n-function useWHATWG(n, input) {\n-  const obj = new URL(input);\n+function useWHATWG(data) {\n+  const obj = new URL(data[0]);\n   const noDead = {\n     protocol: obj.protocol,\n     auth: `${obj.username}:${obj.password}`,\n@@ -56,8 +53,10 @@ function useWHATWG(n, input) {\n     search: obj.search,\n     hash: obj.hash\n   };\n+  const len = data.length;\n   bench.start();\n-  for (var i = 0; i < n; i += 1) {\n+  for (var i = 0; i < len; i++) {\n+    const obj = data[i];\n     noDead.protocol = obj.protocol;\n     noDead.auth = `${obj.username}:${obj.password}`;\n     noDead.host = obj.host;\n@@ -67,23 +66,22 @@ function useWHATWG(n, input) {\n     noDead.search = obj.search;\n     noDead.hash = obj.hash;\n   }\n-  bench.end(n);\n+  bench.end(len);\n   return noDead;\n }\n \n-function main({ type, n, method }) {\n-  const input = inputs[type];\n-  if (!input) {\n-    throw new Error(`Unknown input type \"${type}\"`);\n-  }\n-\n+function main({ type, method, e }) {\n+  e = +e;\n+  var data;\n   var noDead;  // Avoid dead code elimination.\n   switch (method) {\n     case 'legacy':\n-      noDead = useLegacy(n, input);\n+      data = common.bakeUrlData(type, e, false, false);\n+      noDead = useLegacy(data.map((i) => url.parse(i)));\n       break;\n     case 'whatwg':\n-      noDead = useWHATWG(n, input);\n+      data = common.bakeUrlData(type, e, false, true);\n+      noDead = useWHATWG(data);\n       break;\n     default:\n       throw new Error(`Unknown method \"${method}\"`);"
        },
        {
            "sha": "e4af2e0b7c2db541c5f193ba781b42431398a18c",
            "filename": "benchmark/url/legacy-vs-whatwg-url-parse.js",
            "status": "modified",
            "additions": 36,
            "deletions": 22,
            "changes": 58,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-parse.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-parse.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Furl%2Flegacy-vs-whatwg-url-parse.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -3,47 +3,61 @@ const common = require('../common.js');\n const url = require('url');\n const URL = url.URL;\n const assert = require('assert');\n-const inputs = require('../fixtures/url-inputs.js').urls;\n \n const bench = common.createBenchmark(main, {\n-  type: Object.keys(inputs),\n-  method: ['legacy', 'whatwg'],\n-  n: [1e5]\n+  withBase: ['true', 'false'],\n+  type: common.urlDataTypes,\n+  e: [1],\n+  method: ['legacy', 'whatwg']\n });\n \n-function useLegacy(n, input) {\n-  var noDead = url.parse(input);\n+function useLegacy(data) {\n+  const len = data.length;\n+  var result = url.parse(data[0]);  // avoid dead code elimination\n   bench.start();\n-  for (var i = 0; i < n; i += 1) {\n-    noDead = url.parse(input);\n+  for (var i = 0; i < len; ++i) {\n+    result = url.parse(data[i]);\n   }\n-  bench.end(n);\n-  return noDead;\n+  bench.end(len);\n+  return result;\n }\n \n-function useWHATWG(n, input) {\n-  var noDead = new URL(input);\n+function useWHATWGWithBase(data) {\n+  const len = data.length;\n+  var result = new URL(data[0][0], data[0][1]);  // avoid dead code elimination\n   bench.start();\n-  for (var i = 0; i < n; i += 1) {\n-    noDead = new URL(input);\n+  for (var i = 0; i < len; ++i) {\n+    const item = data[i];\n+    result = new URL(item[0], item[1]);\n   }\n-  bench.end(n);\n-  return noDead;\n+  bench.end(len);\n+  return result;\n }\n \n-function main({ type, n, method }) {\n-  const input = inputs[type];\n-  if (!input) {\n-    throw new Error(`Unknown input type \"${type}\"`);\n+function useWHATWGWithoutBase(data) {\n+  const len = data.length;\n+  var result = new URL(data[0]);  // avoid dead code elimination\n+  bench.start();\n+  for (var i = 0; i < len; ++i) {\n+    result = new URL(data[i]);\n   }\n+  bench.end(len);\n+  return result;\n+}\n \n+function main({ e, method, type, withBase }) {\n+  e = +e;\n+  withBase = withBase === 'true';\n   var noDead;  // Avoid dead code elimination.\n+  var data;\n   switch (method) {\n     case 'legacy':\n-      noDead = useLegacy(n, input);\n+      data = common.bakeUrlData(type, e, false, false);\n+      noDead = useLegacy(data);\n       break;\n     case 'whatwg':\n-      noDead = useWHATWG(n, input);\n+      data = common.bakeUrlData(type, e, withBase, false);\n+      noDead = withBase ? useWHATWGWithBase(data) : useWHATWGWithoutBase(data);\n       break;\n     default:\n       throw new Error(`Unknown method ${method}`);"
        },
        {
            "sha": "81b5b6dc16ce249bf46edd1688be5d51ff97aa27",
            "filename": "benchmark/url/legacy-vs-whatwg-url-searchparams-parse.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-searchparams-parse.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-searchparams-parse.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Furl%2Flegacy-vs-whatwg-url-searchparams-parse.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -2,7 +2,7 @@\n const common = require('../common.js');\n const { URLSearchParams } = require('url');\n const querystring = require('querystring');\n-const searchParams = require('../fixtures/url-inputs.js').searchParams;\n+const searchParams = common.searchParams;\n \n const bench = common.createBenchmark(main, {\n   searchParam: Object.keys(searchParams),"
        },
        {
            "sha": "f97961decf5069302e36cfc8df80d2585bb86e53",
            "filename": "benchmark/url/legacy-vs-whatwg-url-searchparams-serialize.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-searchparams-serialize.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-searchparams-serialize.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Furl%2Flegacy-vs-whatwg-url-searchparams-serialize.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -2,7 +2,7 @@\n const common = require('../common.js');\n const { URLSearchParams } = require('url');\n const querystring = require('querystring');\n-const searchParams = require('../fixtures/url-inputs.js').searchParams;\n+const searchParams = common.searchParams;\n \n const bench = common.createBenchmark(main, {\n   searchParam: Object.keys(searchParams),"
        },
        {
            "sha": "e4c821cb2e2c1bb4ac6b70a41032c24ea69b9b3b",
            "filename": "benchmark/url/legacy-vs-whatwg-url-serialize.js",
            "status": "modified",
            "additions": 19,
            "deletions": 20,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-serialize.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Flegacy-vs-whatwg-url-serialize.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Furl%2Flegacy-vs-whatwg-url-serialize.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -3,49 +3,48 @@ const common = require('../common.js');\n const url = require('url');\n const URL = url.URL;\n const assert = require('assert');\n-const inputs = require('../fixtures/url-inputs.js').urls;\n \n const bench = common.createBenchmark(main, {\n-  type: Object.keys(inputs),\n+  type: common.urlDataTypes,\n   method: ['legacy', 'whatwg'],\n-  n: [1e5]\n+  e: [1]\n });\n \n-function useLegacy(n, input, prop) {\n-  const obj = url.parse(input);\n+function useLegacy(data) {\n+  const obj = url.parse(data[0]);\n+  const len = data.length;\n   var noDead = url.format(obj);\n   bench.start();\n-  for (var i = 0; i < n; i += 1) {\n-    noDead = url.format(obj);\n+  for (var i = 0; i < len; i++) {\n+    noDead = data[i].toString();\n   }\n-  bench.end(n);\n+  bench.end(len);\n   return noDead;\n }\n \n-function useWHATWG(n, input, prop) {\n-  const obj = new URL(input);\n+function useWHATWG(data) {\n+  const obj = new URL(data[0]);\n+  const len = data.length;\n   var noDead = obj.toString();\n   bench.start();\n-  for (var i = 0; i < n; i += 1) {\n-    noDead = obj.toString();\n+  for (var i = 0; i < len; i++) {\n+    noDead = data[i].toString();\n   }\n-  bench.end(n);\n+  bench.end(len);\n   return noDead;\n }\n \n-function main({ type, n, method }) {\n-  const input = inputs[type];\n-  if (!input) {\n-    throw new Error(`Unknown input type \"${type}\"`);\n-  }\n+function main({ type, e, method }) {\n+  e = +e;\n+  const data = common.bakeUrlData(type, e, false, false);\n \n   var noDead;  // Avoid dead code elimination.\n   switch (method) {\n     case 'legacy':\n-      noDead = useLegacy(n, input);\n+      noDead = useLegacy(data);\n       break;\n     case 'whatwg':\n-      noDead = useWHATWG(n, input);\n+      noDead = useWHATWG(data);\n       break;\n     default:\n       throw new Error(`Unknown method ${method}`);"
        },
        {
            "sha": "bd584c6f6090e9167768b612c120830c17be422e",
            "filename": "benchmark/url/url-resolve.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Furl-resolve.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Furl-resolve.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Furl%2Furl-resolve.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -1,7 +1,7 @@\n 'use strict';\n const common = require('../common.js');\n const url = require('url');\n-const hrefs = require('../fixtures/url-inputs.js').urls;\n+const hrefs = common.urls;\n hrefs.noscheme = 'some.ran/dom/url.thing?oh=yes#whoo';\n \n const paths = {"
        },
        {
            "sha": "6720b66dca366f503cfbe839cecb862b7c77d11d",
            "filename": "benchmark/url/url-searchparams-sort.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Furl-searchparams-sort.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Furl-searchparams-sort.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Furl%2Furl-searchparams-sort.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -3,6 +3,7 @@ const common = require('../common.js');\n const URLSearchParams = require('url').URLSearchParams;\n \n const inputs = {\n+  wpt: 'wpt',  // to work around tests\n   empty: '',\n   sorted: 'a&b&c&d&e&f&g&h&i&j&k&l&m&n&o&p&q&r&s&t&u&v&w&x&y&z',\n   almostsorted: 'a&b&c&d&e&f&g&i&h&j&k&l&m&n&o&p&q&r&s&t&u&w&v&x&y&z',"
        },
        {
            "sha": "6961fec49e5feedbb47e1eb759a01ed21a63b730",
            "filename": "benchmark/url/whatwg-url-properties.js",
            "status": "modified",
            "additions": 25,
            "deletions": 38,
            "changes": 63,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Fwhatwg-url-properties.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/benchmark%2Furl%2Fwhatwg-url-properties.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Furl%2Fwhatwg-url-properties.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -1,55 +1,42 @@\n 'use strict';\n const common = require('../common.js');\n-const URL = require('url').URL;\n-const inputs = require('../fixtures/url-inputs.js').urls;\n \n const bench = common.createBenchmark(main, {\n-  input: Object.keys(inputs),\n+  withBase: ['true', 'false'],\n+  type: ['wpt'],  // Too many combinations - just use WPT by default\n+  e: [1],\n   prop: ['href', 'origin', 'protocol',\n          'username', 'password', 'host', 'hostname', 'port',\n-         'pathname', 'search', 'searchParams', 'hash'],\n-  n: [3e5]\n+         'pathname', 'search', 'searchParams', 'hash']\n });\n \n-function setAndGet(n, url, prop, alternative) {\n-  const old = url[prop];\n+function setAndGet(data, prop) {\n+  const len = data.length;\n+  var result = data[0][prop];\n   bench.start();\n-  for (var i = 0; i < n; i += 1) {\n-    url[prop] = n % 2 === 0 ? alternative : old;  // set\n-    url[prop];  // get\n+  for (var i = 0; i < len; ++i) {\n+    result = data[i][prop];\n+    data[i][prop] = result;\n   }\n-  bench.end(n);\n+  bench.end(len);\n+  return result;\n }\n \n-function get(n, url, prop) {\n+function get(data, prop) {\n+  const len = data.length;\n+  var result = data[0][prop];\n   bench.start();\n-  for (var i = 0; i < n; i += 1) {\n-    url[prop];  // get\n+  for (var i = 0; i < len; ++i) {\n+    result = data[i][prop]; // get\n   }\n-  bench.end(n);\n+  bench.end(len);\n+  return result;\n }\n \n-const alternatives = {\n-  href: 'http://user:pass@foo.bar.com:21/aaa/zzz?l=25#test',\n-  protocol: 'https:',\n-  username: 'user2',\n-  password: 'pass2',\n-  host: 'foo.bar.net:22',\n-  hostname: 'foo.bar.org',\n-  port: '23',\n-  pathname: '/aaa/bbb',\n-  search: '?k=99',\n-  hash: '#abcd'\n-};\n-\n-function getAlternative(prop) {\n-  return alternatives[prop];\n-}\n-\n-function main({ n, input, prop }) {\n-  const value = inputs[input];\n-  const url = new URL(value);\n-\n+function main({ e, type, prop, withBase }) {\n+  e = +e;\n+  withBase = withBase === 'true';\n+  const data = common.bakeUrlData(type, e, withBase, true);\n   switch (prop) {\n     case 'protocol':\n     case 'username':\n@@ -61,11 +48,11 @@ function main({ n, input, prop }) {\n     case 'search':\n     case 'hash':\n     case 'href':\n-      setAndGet(n, url, prop, getAlternative(prop));\n+      setAndGet(data, prop);\n       break;\n     case 'origin':\n     case 'searchParams':\n-      get(n, url, prop);\n+      get(data, prop);\n       break;\n     default:\n       throw new Error('Unknown prop');"
        },
        {
            "sha": "8560c918fd1c69969f413bc95dde317bbadf4625",
            "filename": "test/benchmark/test-benchmark-url.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/a365bb9cb100514efc3f57f7fac03d0679f73ff5/test%2Fbenchmark%2Ftest-benchmark-url.js",
            "raw_url": "https://github.com/nodejs/node/raw/a365bb9cb100514efc3f57f7fac03d0679f73ff5/test%2Fbenchmark%2Ftest-benchmark-url.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fbenchmark%2Ftest-benchmark-url.js?ref=a365bb9cb100514efc3f57f7fac03d0679f73ff5",
            "patch": "@@ -7,6 +7,7 @@ const runBenchmark = require('../common/benchmark');\n runBenchmark('url',\n              [\n                'method=legacy',\n+               'e=0',\n                'loopMethod=forEach',\n                'accessMethod=get',\n                'type=short',\n@@ -18,6 +19,7 @@ runBenchmark('url',\n                'to=ascii',\n                'prop=href',\n                'n=1',\n-               'param=one'\n+               'param=one',\n+               'withBase=false'\n              ],\n              { NODEJS_BENCHMARK_ZERO_ALLOWED: 1 });"
        }
    ],
    "stats": {
        "total": 339,
        "additions": 201,
        "deletions": 138
    }
}