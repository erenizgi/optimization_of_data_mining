{
    "author": "ofrobots",
    "message": "src: reduce platform worker barrier lifetime\n\nMinor cleanup in the lifetime for the platform worker initialization\nsynchronization barrier.\n\nPR-URL: https://github.com/nodejs/node/pull/23419\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "9f7e3a404096db60438f6dc305b0a5fa4ecddae7",
    "files": [
        {
            "sha": "047cb43268929aa2b7633326c2274c158f2733be",
            "filename": "src/node_platform.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 6,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/9f7e3a404096db60438f6dc305b0a5fa4ecddae7/src%2Fnode_platform.cc",
            "raw_url": "https://github.com/nodejs/node/raw/9f7e3a404096db60438f6dc305b0a5fa4ecddae7/src%2Fnode_platform.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_platform.cc?ref=9f7e3a404096db60438f6dc305b0a5fa4ecddae7",
            "patch": "@@ -167,17 +167,20 @@ class WorkerThreadsTaskRunner::DelayedTaskScheduler {\n };\n \n WorkerThreadsTaskRunner::WorkerThreadsTaskRunner(int thread_pool_size) {\n-  Mutex::ScopedLock lock(platform_workers_mutex_);\n-  pending_platform_workers_ = thread_pool_size;\n+  Mutex platform_workers_mutex;\n+  ConditionVariable platform_workers_ready;\n+\n+  Mutex::ScopedLock lock(platform_workers_mutex);\n+  int pending_platform_workers = thread_pool_size;\n \n   delayed_task_scheduler_.reset(\n       new DelayedTaskScheduler(&pending_worker_tasks_));\n   threads_.push_back(delayed_task_scheduler_->Start());\n \n   for (int i = 0; i < thread_pool_size; i++) {\n     PlatformWorkerData* worker_data = new PlatformWorkerData{\n-      &pending_worker_tasks_, &platform_workers_mutex_,\n-      &platform_workers_ready_, &pending_platform_workers_, i\n+      &pending_worker_tasks_, &platform_workers_mutex,\n+      &platform_workers_ready, &pending_platform_workers, i\n     };\n     std::unique_ptr<uv_thread_t> t { new uv_thread_t() };\n     if (uv_thread_create(t.get(), PlatformWorkerThread,\n@@ -189,8 +192,8 @@ WorkerThreadsTaskRunner::WorkerThreadsTaskRunner(int thread_pool_size) {\n \n   // Wait for platform workers to initialize before continuing with the\n   // bootstrap.\n-  while (pending_platform_workers_ > 0) {\n-    platform_workers_ready_.Wait(lock);\n+  while (pending_platform_workers > 0) {\n+    platform_workers_ready.Wait(lock);\n   }\n }\n "
        },
        {
            "sha": "1308d4df6aa249b2327a9bafcf4e91863347ac13",
            "filename": "src/node_platform.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/9f7e3a404096db60438f6dc305b0a5fa4ecddae7/src%2Fnode_platform.h",
            "raw_url": "https://github.com/nodejs/node/raw/9f7e3a404096db60438f6dc305b0a5fa4ecddae7/src%2Fnode_platform.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_platform.h?ref=9f7e3a404096db60438f6dc305b0a5fa4ecddae7",
            "patch": "@@ -117,10 +117,6 @@ class WorkerThreadsTaskRunner {\n   std::unique_ptr<DelayedTaskScheduler> delayed_task_scheduler_;\n \n   std::vector<std::unique_ptr<uv_thread_t>> threads_;\n-\n-  Mutex platform_workers_mutex_;\n-  ConditionVariable platform_workers_ready_;\n-  int pending_platform_workers_;\n };\n \n class NodePlatform : public MultiIsolatePlatform {"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 9,
        "deletions": 10
    }
}