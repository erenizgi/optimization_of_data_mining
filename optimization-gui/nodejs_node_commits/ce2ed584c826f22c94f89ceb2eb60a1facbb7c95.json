{
    "author": "BridgeAR",
    "message": "test: improve tty.getColorDepth coverage\n\nPR-URL: https://github.com/nodejs/node/pull/19446\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Shingo Inoue <leko.noor@gmail.com>",
    "sha": "ce2ed584c826f22c94f89ceb2eb60a1facbb7c95",
    "files": [
        {
            "sha": "d802add1189db2bd0963a1075b18e96211652f5e",
            "filename": "test/pseudo-tty/test-tty-get-color-depth.js",
            "status": "modified",
            "additions": 45,
            "deletions": 17,
            "changes": 62,
            "blob_url": "https://github.com/nodejs/node/blob/ce2ed584c826f22c94f89ceb2eb60a1facbb7c95/test%2Fpseudo-tty%2Ftest-tty-get-color-depth.js",
            "raw_url": "https://github.com/nodejs/node/raw/ce2ed584c826f22c94f89ceb2eb60a1facbb7c95/test%2Fpseudo-tty%2Ftest-tty-get-color-depth.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-tty-get-color-depth.js?ref=ce2ed584c826f22c94f89ceb2eb60a1facbb7c95",
            "patch": "@@ -10,27 +10,55 @@ const writeStream = new WriteStream(fd);\n \n {\n   const depth = writeStream.getColorDepth();\n-\n   assert.equal(typeof depth, 'number');\n   assert(depth >= 1 && depth <= 24);\n-\n-  if (depth === 1) {\n-    // Terminal does not support colors, compare to a value that would.\n-    assert.notEqual(writeStream.getColorDepth({ COLORTERM: '1' }), depth);\n-  } else {\n-    // Terminal supports colors, compare to a value that would not.\n-    assert.notEqual(writeStream.getColorDepth({ TERM: 'dumb' }), depth);\n-  }\n }\n \n-// Deactivate colors\n-{\n-  const tmp = process.env.NODE_DISABLE_COLORS;\n-  process.env.NODE_DISABLE_COLORS = 1;\n-\n-  const depth = writeStream.getColorDepth();\n+// Check different environment variables.\n+[\n+  [{ COLORTERM: '1' }, 4],\n+  [{ TMUX: '1' }, 8],\n+  [{ CI: '1' }, 1],\n+  [{ CI: '1', TRAVIS: '1' }, 8],\n+  [{ CI: '1', CIRCLECI: '1' }, 8],\n+  [{ CI: '1', APPVEYOR: '1' }, 8],\n+  [{ CI: '1', GITLAB_CI: '1' }, 8],\n+  [{ CI: '1', CI_NAME: 'codeship' }, 8],\n+  [{ TEAMCITY_VERSION: '1.0.0' }, 1],\n+  [{ TEAMCITY_VERSION: '9.11.0' }, 4],\n+  [{ TERM_PROGRAM: 'iTerm.app' }, 8],\n+  [{ TERM_PROGRAM: 'iTerm.app', TERM_PROGRAM_VERSION: '3.0' }, 24],\n+  [{ TERM_PROGRAM: 'iTerm.app', TERM_PROGRAM_VERSION: '2.0' }, 8],\n+  [{ TERM_PROGRAM: 'HyperTerm' }, 24],\n+  [{ TERM_PROGRAM: 'Hyper' }, 24],\n+  [{ TERM_PROGRAM: 'MacTerm' }, 24],\n+  [{ TERM_PROGRAM: 'Apple_Terminal' }, 8],\n+  [{ TERM: 'xterm-256' }, 8],\n+  [{ TERM: 'ansi' }, 4],\n+  [{ TERM: 'ANSI' }, 4],\n+  [{ TERM: 'color' }, 4],\n+  [{ TERM: 'linux' }, 4],\n+  [{ TERM: 'fail' }, 1],\n+  [{ NODE_DISABLE_COLORS: '1' }, 1],\n+  [{ TERM: 'dumb' }, 1],\n+  [{ TERM: 'dumb', COLORTERM: '1' }, 4],\n+].forEach(([env, depth], i) => {\n+  const actual = writeStream.getColorDepth(env);\n+  assert.equal(\n+    actual,\n+    depth,\n+    `i: ${i}, expected: ${depth}, actual: ${actual}, env: ${env}`\n+  );\n+});\n \n-  assert.equal(depth, 1);\n+// OS settings\n+{\n+  const platform = Object.getOwnPropertyDescriptor(process, 'platform');\n+  const [ value, depth1, depth2 ] = process.platform !== 'win32' ?\n+    ['win32', 1, 4] : ['linux', 4, 1];\n \n-  process.env.NODE_DISABLE_COLORS = tmp;\n+  assert.equal(writeStream.getColorDepth({}), depth1);\n+  Object.defineProperty(process, 'platform', { value });\n+  assert.equal(writeStream.getColorDepth({}), depth2);\n+  Object.defineProperty(process, 'platform', platform);\n }"
        }
    ],
    "stats": {
        "total": 62,
        "additions": 45,
        "deletions": 17
    }
}