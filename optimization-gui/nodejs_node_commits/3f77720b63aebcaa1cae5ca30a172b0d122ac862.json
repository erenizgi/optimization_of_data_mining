{
    "author": "targos",
    "message": "deps: patch V8 to 7.0.276.24\n\nRefs: https://github.com/v8/v8/compare/7.0.276.22...7.0.276.24\n\nPR-URL: https://github.com/nodejs/node/pull/23158\nRefs: https://github.com/nodejs/node/issues/23122\nReviewed-By: Yang Guo <yangguo@chromium.org>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "3f77720b63aebcaa1cae5ca30a172b0d122ac862",
    "files": [
        {
            "sha": "06038eca3bd523e82797280d955154879f4d4a53",
            "filename": "deps/v8/include/v8-version.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Finclude%2Fv8-version.h",
            "raw_url": "https://github.com/nodejs/node/raw/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Finclude%2Fv8-version.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8-version.h?ref=3f77720b63aebcaa1cae5ca30a172b0d122ac862",
            "patch": "@@ -11,7 +11,7 @@\n #define V8_MAJOR_VERSION 7\n #define V8_MINOR_VERSION 0\n #define V8_BUILD_NUMBER 276\n-#define V8_PATCH_LEVEL 22\n+#define V8_PATCH_LEVEL 24\n \n // Use 1 for candidates and 0 otherwise.\n // (Boolean macro values are not supported by all preprocessors.)"
        },
        {
            "sha": "a83305560c2ea33d4a6247d76655e83c7a14b0ca",
            "filename": "deps/v8/include/v8.h",
            "status": "modified",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/nodejs/node/blob/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Finclude%2Fv8.h",
            "raw_url": "https://github.com/nodejs/node/raw/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Finclude%2Fv8.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8.h?ref=3f77720b63aebcaa1cae5ca30a172b0d122ac862",
            "patch": "@@ -1125,6 +1125,10 @@ class V8_EXPORT PrimitiveArray {\n   int Length() const;\n   void Set(Isolate* isolate, int index, Local<Primitive> item);\n   Local<Primitive> Get(Isolate* isolate, int index);\n+\n+  V8_DEPRECATED(\"Use Isolate version\",\n+                void Set(int index, Local<Primitive> item));\n+  V8_DEPRECATED(\"Use Isolate version\", Local<Primitive> Get(int index));\n };\n \n /**\n@@ -1829,6 +1833,8 @@ class V8_EXPORT StackTrace {\n   /**\n    * Returns a StackFrame at a particular index.\n    */\n+  V8_DEPRECATED(\"Use Isolate version\",\n+                Local<StackFrame> GetFrame(uint32_t index) const);\n   Local<StackFrame> GetFrame(Isolate* isolate, uint32_t index) const;\n \n   /**\n@@ -2537,6 +2543,11 @@ class V8_EXPORT Value : public Data {\n   V8_DEPRECATE_SOON(\"Use maybe version\",\n                     Local<Int32> ToInt32(Isolate* isolate) const);\n \n+  inline V8_DEPRECATED(\"Use maybe version\", Local<Boolean> ToBoolean() const);\n+  inline V8_DEPRECATED(\"Use maybe version\", Local<String> ToString() const);\n+  inline V8_DEPRECATED(\"Use maybe version\", Local<Object> ToObject() const);\n+  inline V8_DEPRECATED(\"Use maybe version\", Local<Integer> ToInteger() const);\n+\n   /**\n    * Attempts to convert a string to an array index.\n    * Returns an empty handle if the conversion fails.\n@@ -2552,7 +2563,14 @@ class V8_EXPORT Value : public Data {\n       Local<Context> context) const;\n   V8_WARN_UNUSED_RESULT Maybe<int32_t> Int32Value(Local<Context> context) const;\n \n+  V8_DEPRECATED(\"Use maybe version\", bool BooleanValue() const);\n+  V8_DEPRECATED(\"Use maybe version\", double NumberValue() const);\n+  V8_DEPRECATED(\"Use maybe version\", int64_t IntegerValue() const);\n+  V8_DEPRECATED(\"Use maybe version\", uint32_t Uint32Value() const);\n+  V8_DEPRECATED(\"Use maybe version\", int32_t Int32Value() const);\n+\n   /** JS == */\n+  V8_DEPRECATED(\"Use maybe version\", bool Equals(Local<Value> that) const);\n   V8_WARN_UNUSED_RESULT Maybe<bool> Equals(Local<Context> context,\n                                            Local<Value> that) const;\n   bool StrictEquals(Local<Value> that) const;\n@@ -2659,6 +2677,8 @@ class V8_EXPORT String : public Name {\n    * Returns the number of bytes in the UTF-8 encoded\n    * representation of this string.\n    */\n+  V8_DEPRECATED(\"Use Isolate version instead\", int Utf8Length() const);\n+\n   int Utf8Length(Isolate* isolate) const;\n \n   /**\n@@ -2715,12 +2735,23 @@ class V8_EXPORT String : public Name {\n   // 16-bit character codes.\n   int Write(Isolate* isolate, uint16_t* buffer, int start = 0, int length = -1,\n             int options = NO_OPTIONS) const;\n+  V8_DEPRECATED(\"Use Isolate* version\",\n+                int Write(uint16_t* buffer, int start = 0, int length = -1,\n+                          int options = NO_OPTIONS) const);\n   // One byte characters.\n   int WriteOneByte(Isolate* isolate, uint8_t* buffer, int start = 0,\n                    int length = -1, int options = NO_OPTIONS) const;\n+  V8_DEPRECATED(\"Use Isolate* version\",\n+                int WriteOneByte(uint8_t* buffer, int start = 0,\n+                                 int length = -1, int options = NO_OPTIONS)\n+                    const);\n   // UTF-8 encoded characters.\n   int WriteUtf8(Isolate* isolate, char* buffer, int length = -1,\n                 int* nchars_ref = NULL, int options = NO_OPTIONS) const;\n+  V8_DEPRECATED(\"Use Isolate* version\",\n+                int WriteUtf8(char* buffer, int length = -1,\n+                              int* nchars_ref = NULL, int options = NO_OPTIONS)\n+                    const);\n \n   /**\n    * A zero length string.\n@@ -2884,6 +2915,9 @@ class V8_EXPORT String : public Name {\n    */\n   static Local<String> Concat(Isolate* isolate, Local<String> left,\n                               Local<String> right);\n+  static V8_DEPRECATED(\"Use Isolate* version\",\n+                       Local<String> Concat(Local<String> left,\n+                                            Local<String> right));\n \n   /**\n    * Creates a new external string using the data defined in the given\n@@ -5217,6 +5251,8 @@ class V8_EXPORT BooleanObject : public Object {\n class V8_EXPORT StringObject : public Object {\n  public:\n   static Local<Value> New(Isolate* isolate, Local<String> value);\n+  static V8_DEPRECATED(\"Use Isolate* version\",\n+                       Local<Value> New(Local<String> value));\n \n   Local<String> ValueOf() const;\n \n@@ -10215,6 +10251,25 @@ template <class T> Value* Value::Cast(T* value) {\n   return static_cast<Value*>(value);\n }\n \n+Local<Boolean> Value::ToBoolean() const {\n+  return ToBoolean(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(Local<Boolean>());\n+}\n+\n+Local<String> Value::ToString() const {\n+  return ToString(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(Local<String>());\n+}\n+\n+Local<Object> Value::ToObject() const {\n+  return ToObject(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(Local<Object>());\n+}\n+\n+Local<Integer> Value::ToInteger() const {\n+  return ToInteger(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(Local<Integer>());\n+}\n \n Boolean* Boolean::Cast(v8::Value* value) {\n #ifdef V8_ENABLE_CHECKS"
        },
        {
            "sha": "4eb31a447c3d2dbce8ddaffb777b799ec28c2f8c",
            "filename": "deps/v8/src/api.cc",
            "status": "modified",
            "additions": 120,
            "deletions": 0,
            "changes": 120,
            "blob_url": "https://github.com/nodejs/node/blob/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Fsrc%2Fapi.cc",
            "raw_url": "https://github.com/nodejs/node/raw/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Fsrc%2Fapi.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fapi.cc?ref=3f77720b63aebcaa1cae5ca30a172b0d122ac862",
            "patch": "@@ -219,6 +219,28 @@ Local<Context> ContextFromNeverReadOnlySpaceObject(\n   return reinterpret_cast<v8::Isolate*>(obj->GetIsolate())->GetCurrentContext();\n }\n \n+// TODO(delphick): Remove this completely when the deprecated functions that use\n+// it are removed.\n+// DO NOT USE THIS IN NEW CODE!\n+i::Isolate* UnsafeIsolateFromHeapObject(i::Handle<i::HeapObject> obj) {\n+  // Use MemoryChunk directly instead of Isolate::FromWritableHeapObject to\n+  // temporarily allow isolate access from read-only space objects.\n+  i::MemoryChunk* chunk = i::MemoryChunk::FromHeapObject(*obj);\n+  return chunk->heap()->isolate();\n+}\n+\n+// TODO(delphick): Remove this completely when the deprecated functions that use\n+// it are removed.\n+// DO NOT USE THIS IN NEW CODE!\n+Local<Context> UnsafeContextFromHeapObject(i::Handle<i::Object> obj) {\n+  // Use MemoryChunk directly instead of Isolate::FromWritableHeapObject to\n+  // temporarily allow isolate access from read-only space objects.\n+  i::MemoryChunk* chunk =\n+      i::MemoryChunk::FromHeapObject(i::HeapObject::cast(*obj));\n+  return reinterpret_cast<Isolate*>(chunk->heap()->isolate())\n+      ->GetCurrentContext();\n+}\n+\n class InternalEscapableScope : public v8::EscapableHandleScope {\n  public:\n   explicit inline InternalEscapableScope(i::Isolate* isolate)\n@@ -2170,6 +2192,12 @@ void PrimitiveArray::Set(Isolate* v8_isolate, int index,\n   array->set(index, *i_item);\n }\n \n+void PrimitiveArray::Set(int index, Local<Primitive> item) {\n+  i::Handle<i::FixedArray> array = Utils::OpenHandle(this);\n+  i::Isolate* isolate = UnsafeIsolateFromHeapObject(array);\n+  Set(reinterpret_cast<Isolate*>(isolate), index, item);\n+}\n+\n Local<Primitive> PrimitiveArray::Get(Isolate* v8_isolate, int index) {\n   i::Isolate* isolate = reinterpret_cast<i::Isolate*>(v8_isolate);\n   i::Handle<i::FixedArray> array = Utils::OpenHandle(this);\n@@ -2182,6 +2210,12 @@ Local<Primitive> PrimitiveArray::Get(Isolate* v8_isolate, int index) {\n   return ToApiHandle<Primitive>(i_item);\n }\n \n+Local<Primitive> PrimitiveArray::Get(int index) {\n+  i::Handle<i::FixedArray> array = Utils::OpenHandle(this);\n+  i::Isolate* isolate = UnsafeIsolateFromHeapObject(array);\n+  return Get(reinterpret_cast<Isolate*>(isolate), index);\n+}\n+\n Module::Status Module::GetStatus() const {\n   i::Handle<i::Module> self = Utils::OpenHandle(this);\n   switch (self->status()) {\n@@ -2910,6 +2944,11 @@ Local<StackFrame> StackTrace::GetFrame(Isolate* v8_isolate,\n   return scope.Escape(Utils::StackFrameToLocal(info));\n }\n \n+Local<StackFrame> StackTrace::GetFrame(uint32_t index) const {\n+  i::Isolate* isolate = UnsafeIsolateFromHeapObject(Utils::OpenHandle(this));\n+  return GetFrame(reinterpret_cast<Isolate*>(isolate), index);\n+}\n+\n int StackTrace::GetFrameCount() const {\n   return Utils::OpenHandle(this)->length();\n }\n@@ -3881,6 +3920,14 @@ Maybe<bool> Value::BooleanValue(Local<Context> context) const {\n   return Just(Utils::OpenHandle(this)->BooleanValue(isolate));\n }\n \n+bool Value::BooleanValue() const {\n+  auto obj = Utils::OpenHandle(this);\n+  if (obj->IsSmi()) return *obj != i::Smi::kZero;\n+  DCHECK(obj->IsHeapObject());\n+  i::Isolate* isolate =\n+      UnsafeIsolateFromHeapObject(i::Handle<i::HeapObject>::cast(obj));\n+  return obj->BooleanValue(isolate);\n+}\n \n Maybe<double> Value::NumberValue(Local<Context> context) const {\n   auto obj = Utils::OpenHandle(this);\n@@ -3894,6 +3941,12 @@ Maybe<double> Value::NumberValue(Local<Context> context) const {\n   return Just(num->Number());\n }\n \n+double Value::NumberValue() const {\n+  auto obj = Utils::OpenHandle(this);\n+  if (obj->IsNumber()) return obj->Number();\n+  return NumberValue(UnsafeContextFromHeapObject(obj))\n+      .FromMaybe(std::numeric_limits<double>::quiet_NaN());\n+}\n \n Maybe<int64_t> Value::IntegerValue(Local<Context> context) const {\n   auto obj = Utils::OpenHandle(this);\n@@ -3909,6 +3962,17 @@ Maybe<int64_t> Value::IntegerValue(Local<Context> context) const {\n   return Just(NumberToInt64(*num));\n }\n \n+int64_t Value::IntegerValue() const {\n+  auto obj = Utils::OpenHandle(this);\n+  if (obj->IsNumber()) {\n+    if (obj->IsSmi()) {\n+      return i::Smi::ToInt(*obj);\n+    } else {\n+      return static_cast<int64_t>(obj->Number());\n+    }\n+  }\n+  return IntegerValue(UnsafeContextFromHeapObject(obj)).FromMaybe(0);\n+}\n \n Maybe<int32_t> Value::Int32Value(Local<Context> context) const {\n   auto obj = Utils::OpenHandle(this);\n@@ -3923,6 +3987,11 @@ Maybe<int32_t> Value::Int32Value(Local<Context> context) const {\n                            : static_cast<int32_t>(num->Number()));\n }\n \n+int32_t Value::Int32Value() const {\n+  auto obj = Utils::OpenHandle(this);\n+  if (obj->IsNumber()) return NumberToInt32(*obj);\n+  return Int32Value(UnsafeContextFromHeapObject(obj)).FromMaybe(0);\n+}\n \n Maybe<uint32_t> Value::Uint32Value(Local<Context> context) const {\n   auto obj = Utils::OpenHandle(this);\n@@ -3937,6 +4006,11 @@ Maybe<uint32_t> Value::Uint32Value(Local<Context> context) const {\n                            : static_cast<uint32_t>(num->Number()));\n }\n \n+uint32_t Value::Uint32Value() const {\n+  auto obj = Utils::OpenHandle(this);\n+  if (obj->IsNumber()) return NumberToUint32(*obj);\n+  return Uint32Value(UnsafeContextFromHeapObject(obj)).FromMaybe(0);\n+}\n \n MaybeLocal<Uint32> Value::ToArrayIndex(Local<Context> context) const {\n   auto self = Utils::OpenHandle(this);\n@@ -3971,6 +4045,19 @@ Maybe<bool> Value::Equals(Local<Context> context, Local<Value> that) const {\n   return i::Object::Equals(isolate, self, other);\n }\n \n+bool Value::Equals(Local<Value> that) const {\n+  auto self = Utils::OpenHandle(this);\n+  auto other = Utils::OpenHandle(*that);\n+  if (self->IsSmi() && other->IsSmi()) {\n+    return self->Number() == other->Number();\n+  }\n+  if (self->IsJSObject() && other->IsJSObject()) {\n+    return *self == *other;\n+  }\n+  auto heap_object = self->IsSmi() ? other : self;\n+  auto context = UnsafeContextFromHeapObject(heap_object);\n+  return Equals(context, that).FromMaybe(false);\n+}\n \n bool Value::StrictEquals(Local<Value> that) const {\n   auto self = Utils::OpenHandle(this);\n@@ -5295,6 +5382,11 @@ bool String::ContainsOnlyOneByte() const {\n   return helper.Check(*str);\n }\n \n+int String::Utf8Length() const {\n+  i::Isolate* isolate = UnsafeIsolateFromHeapObject(Utils::OpenHandle(this));\n+  return Utf8Length(reinterpret_cast<Isolate*>(isolate));\n+}\n+\n int String::Utf8Length(Isolate* isolate) const {\n   i::Handle<i::String> str = Utils::OpenHandle(this);\n   str = i::String::Flatten(reinterpret_cast<i::Isolate*>(isolate), str);\n@@ -5563,6 +5655,14 @@ int String::WriteUtf8(Isolate* v8_isolate, char* buffer, int capacity,\n   return writer.CompleteWrite(write_null, nchars_ref);\n }\n \n+int String::WriteUtf8(char* buffer, int capacity, int* nchars_ref,\n+                      int options) const {\n+  i::Handle<i::String> str = Utils::OpenHandle(this);\n+  i::Isolate* isolate = UnsafeIsolateFromHeapObject(str);\n+  return WriteUtf8(reinterpret_cast<Isolate*>(isolate), buffer, capacity,\n+                   nchars_ref, options);\n+}\n+\n template <typename CharType>\n static inline int WriteHelper(i::Isolate* isolate, const String* string,\n                               CharType* buffer, int start, int length,\n@@ -5584,13 +5684,22 @@ static inline int WriteHelper(i::Isolate* isolate, const String* string,\n   return end - start;\n }\n \n+int String::WriteOneByte(uint8_t* buffer, int start, int length,\n+                         int options) const {\n+  i::Isolate* isolate = UnsafeIsolateFromHeapObject(Utils::OpenHandle(this));\n+  return WriteHelper(isolate, this, buffer, start, length, options);\n+}\n \n int String::WriteOneByte(Isolate* isolate, uint8_t* buffer, int start,\n                          int length, int options) const {\n   return WriteHelper(reinterpret_cast<i::Isolate*>(isolate), this, buffer,\n                      start, length, options);\n }\n \n+int String::Write(uint16_t* buffer, int start, int length, int options) const {\n+  i::Isolate* isolate = UnsafeIsolateFromHeapObject(Utils::OpenHandle(this));\n+  return WriteHelper(isolate, this, buffer, start, length, options);\n+}\n \n int String::Write(Isolate* isolate, uint16_t* buffer, int start, int length,\n                   int options) const {\n@@ -6549,6 +6658,12 @@ Local<String> v8::String::Concat(Isolate* v8_isolate, Local<String> left,\n   return Utils::ToLocal(result);\n }\n \n+Local<String> v8::String::Concat(Local<String> left, Local<String> right) {\n+  i::Handle<i::String> left_string = Utils::OpenHandle(*left);\n+  i::Isolate* isolate = UnsafeIsolateFromHeapObject(left_string);\n+  return Concat(reinterpret_cast<Isolate*>(isolate), left, right);\n+}\n+\n MaybeLocal<String> v8::String::NewExternalTwoByte(\n     Isolate* isolate, v8::String::ExternalStringResource* resource) {\n   CHECK(resource && resource->data());\n@@ -6757,6 +6872,11 @@ bool v8::BooleanObject::ValueOf() const {\n   return jsvalue->value()->IsTrue(isolate);\n }\n \n+Local<v8::Value> v8::StringObject::New(Local<String> value) {\n+  i::Handle<i::String> string = Utils::OpenHandle(*value);\n+  i::Isolate* isolate = UnsafeIsolateFromHeapObject(string);\n+  return New(reinterpret_cast<Isolate*>(isolate), value);\n+}\n \n Local<v8::Value> v8::StringObject::New(Isolate* v8_isolate,\n                                        Local<String> value) {"
        },
        {
            "sha": "b950c590b5c6b2164f744df22c8adf1b121fa90d",
            "filename": "deps/v8/src/wasm/module-compiler.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Fsrc%2Fwasm%2Fmodule-compiler.cc",
            "raw_url": "https://github.com/nodejs/node/raw/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Fsrc%2Fwasm%2Fmodule-compiler.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fwasm%2Fmodule-compiler.cc?ref=3f77720b63aebcaa1cae5ca30a172b0d122ac862",
            "patch": "@@ -2203,6 +2203,11 @@ std::shared_ptr<StreamingDecoder> AsyncCompileJob::CreateStreamingDecoder() {\n AsyncCompileJob::~AsyncCompileJob() {\n   background_task_manager_.CancelAndWait();\n   if (native_module_) native_module_->compilation_state()->Abort();\n+  // Tell the streaming decoder that the AsyncCompileJob is not available\n+  // anymore.\n+  // TODO(ahaas): Is this notification really necessary? Check\n+  // https://crbug.com/888170.\n+  if (stream_) stream_->NotifyCompilationEnded();\n   CancelPendingForegroundTask();\n   for (auto d : deferred_handles_) delete d;\n }\n@@ -2228,7 +2233,6 @@ void AsyncCompileJob::FinishCompile() {\n }\n \n void AsyncCompileJob::AsyncCompileFailed(Handle<Object> error_reason) {\n-  if (stream_) stream_->NotifyError();\n   // {job} keeps the {this} pointer alive.\n   std::shared_ptr<AsyncCompileJob> job =\n       isolate_->wasm_engine()->RemoveCompileJob(this);"
        },
        {
            "sha": "e14c32daf3925dda0c82a8100ecd10b7578e00ee",
            "filename": "deps/v8/src/wasm/streaming-decoder.h",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Fsrc%2Fwasm%2Fstreaming-decoder.h",
            "raw_url": "https://github.com/nodejs/node/raw/3f77720b63aebcaa1cae5ca30a172b0d122ac862/deps%2Fv8%2Fsrc%2Fwasm%2Fstreaming-decoder.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fwasm%2Fstreaming-decoder.h?ref=3f77720b63aebcaa1cae5ca30a172b0d122ac862",
            "patch": "@@ -65,8 +65,13 @@ class V8_EXPORT_PRIVATE StreamingDecoder {\n \n   void Abort();\n \n-  // Notify the StreamingDecoder that there has been an compilation error.\n-  void NotifyError() { ok_ = false; }\n+  // Notify the StreamingDecoder that compilation ended and the\n+  // StreamingProcessor should not be called anymore.\n+  void NotifyCompilationEnded() {\n+    // We set {ok_} to false to turn all future calls to the StreamingDecoder\n+    // into no-ops.\n+    ok_ = false;\n+  }\n \n  private:\n   // TODO(ahaas): Put the whole private state of the StreamingDecoder into the"
        }
    ],
    "stats": {
        "total": 192,
        "additions": 188,
        "deletions": 4
    }
}