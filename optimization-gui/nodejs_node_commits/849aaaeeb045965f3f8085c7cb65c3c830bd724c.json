{
    "author": "addaleax",
    "message": "Revert \"util: change util.inspect depth default\"\n\nThis reverts commit b994b8eff6018433a56bb10dbc473cefa0dd9370.\n\nThis caused regressions in ecosystem code. While the change originally\nwas semver-major and could be postponed until after Node.js 10,\nI think reverting it is a good choice at this point.\n\nAlso, I personally do not think defaulting to a shallow inspect\nis a bad thing at all â€“ quite the opposite: It makes `util.inspect()`\ngive an overview of an object, rather than providing a full\ndisplay of its contents. Changing the `depth` default to infinity\nfundamentally changed the role that `util.inspect()` plays,\nand makes output much more verbose and thus at times unusable\nfor `console.log()`-style debugging.\n\nPR-URL: https://github.com/nodejs/node/pull/20017\nFixes: https://github.com/nodejs/node/issues/19405\nRefs: https://github.com/nodejs/node/pull/17907\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>",
    "sha": "849aaaeeb045965f3f8085c7cb65c3c830bd724c",
    "files": [
        {
            "sha": "bec24e6410d0aee26c7a8e43140ff03a61c5768f",
            "filename": "doc/api/util.md",
            "status": "modified",
            "additions": 8,
            "deletions": 22,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/849aaaeeb045965f3f8085c7cb65c3c830bd724c/doc%2Fapi%2Futil.md",
            "raw_url": "https://github.com/nodejs/node/raw/849aaaeeb045965f3f8085c7cb65c3c830bd724c/doc%2Fapi%2Futil.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Futil.md?ref=849aaaeeb045965f3f8085c7cb65c3c830bd724c",
            "patch": "@@ -364,9 +364,6 @@ changes:\n     pr-url: https://github.com/nodejs/node/pull/19259\n     description: The `WeakMap` and `WeakSet` entries can now be inspected\n                  as well.\n-  - version: REPLACEME\n-    pr-url: https://github.com/nodejs/node/pull/17907\n-    description: The `depth` default changed to `Infinity`.\n   - version: v9.9.0\n     pr-url: https://github.com/nodejs/node/pull/17576\n     description: The `compact` option is supported now.\n@@ -390,6 +387,9 @@ changes:\n   * `showHidden` {boolean} If `true`, the `object`'s non-enumerable symbols and\n     properties will be included in the formatted result as well as [`WeakMap`][]\n     and [`WeakSet`][] entries. **Default:** `false`.\n+  * `depth` {number} Specifies the number of times to recurse while formatting\n+    the `object`. This is useful for inspecting large complicated objects.\n+    To make it recurse indefinitely pass `null`. **Default:** `2`.\n   * `colors` {boolean} If `true`, the output will be styled with ANSI color\n     codes. Colors are customizable, see [Customizing `util.inspect` colors][].\n     **Default:** `false`.\n@@ -416,10 +416,7 @@ changes:\n     objects the same as arrays. Note that no text will be reduced below 16\n     characters, no matter the `breakLength` size. For more information, see the\n     example below. **Default:** `true`.\n-  * `depth` {number} Specifies the number of visible nested `Object`s in an\n-    `object`. This is useful to minimize the inspection output for large\n-    complicated objects. To make it recurse indefinitely pass `null` or\n-    `Infinity`. **Default:** `Infinity`.\n+\n * Returns: {string} The representation of passed object\n \n The `util.inspect()` method returns a string representation of `object` that is\n@@ -445,23 +442,12 @@ util.inspect(new Bar()); // 'Bar {}'\n util.inspect(baz);       // '[foo] {}'\n ```\n \n-The following example limits the inspected output of the `paths` property:\n+The following example inspects all properties of the `util` object:\n \n ```js\n const util = require('util');\n \n-console.log(util.inspect(module, { depth: 0 }));\n-// Instead of showing all entries in `paths` `[Array]` is used to limit the\n-// output for readability:\n-\n-// Module {\n-//   id: '<repl>',\n-//   exports: {},\n-//   parent: undefined,\n-//   filename: null,\n-//   loaded: false,\n-//   children: [],\n-//   paths: [Array] }\n+console.log(util.inspect(util, { showHidden: true, depth: null }));\n ```\n \n Values may supply their own custom `inspect(depth, opts)` functions, when\n@@ -481,7 +467,7 @@ const o = {\n     'foo']], 4],\n   b: new Map([['za', 1], ['zb', 'test']])\n };\n-console.log(util.inspect(o, { compact: true, breakLength: 80 }));\n+console.log(util.inspect(o, { compact: true, depth: 5, breakLength: 80 }));\n \n // This will print\n \n@@ -495,7 +481,7 @@ console.log(util.inspect(o, { compact: true, breakLength: 80 }));\n //   b: Map { 'za' => 1, 'zb' => 'test' } }\n \n // Setting `compact` to false changes the output to be more reader friendly.\n-console.log(util.inspect(o, { compact: false, breakLength: 80 }));\n+console.log(util.inspect(o, { compact: false, depth: 5, breakLength: 80 }));\n \n // {\n //   a: ["
        },
        {
            "sha": "600816a6058fbc7084ebaa00c64d58c41b39199d",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/849aaaeeb045965f3f8085c7cb65c3c830bd724c/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/849aaaeeb045965f3f8085c7cb65c3c830bd724c/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=849aaaeeb045965f3f8085c7cb65c3c830bd724c",
            "patch": "@@ -115,9 +115,8 @@ function hasOwnProperty(obj, prop) {\n // Can overridden with custom print functions, such as `probe` or `eyes.js`.\n // This is the default \"writer\" value if none is passed in the REPL options.\n const writer = exports.writer = (obj) => util.inspect(obj, writer.options);\n-writer.options = Object.assign({},\n-                               util.inspect.defaultOptions,\n-                               { showProxy: true, depth: 2 });\n+writer.options =\n+    Object.assign({}, util.inspect.defaultOptions, { showProxy: true });\n \n exports._builtinLibs = builtinLibs;\n "
        },
        {
            "sha": "45d98de194c8365c7fbd9baa414473f9a90a71cc",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/849aaaeeb045965f3f8085c7cb65c3c830bd724c/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/849aaaeeb045965f3f8085c7cb65c3c830bd724c/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=849aaaeeb045965f3f8085c7cb65c3c830bd724c",
            "patch": "@@ -80,7 +80,7 @@ const {\n \n const inspectDefaultOptions = Object.seal({\n   showHidden: false,\n-  depth: null,\n+  depth: 2,\n   colors: false,\n   customInspect: true,\n   showProxy: false,"
        },
        {
            "sha": "d7728d1171caa3624d25a1e9e7b3f3fedd3ccb1d",
            "filename": "test/parallel/test-stream-buffer-list.js",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/849aaaeeb045965f3f8085c7cb65c3c830bd724c/test%2Fparallel%2Ftest-stream-buffer-list.js",
            "raw_url": "https://github.com/nodejs/node/raw/849aaaeeb045965f3f8085c7cb65c3c830bd724c/test%2Fparallel%2Ftest-stream-buffer-list.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-buffer-list.js?ref=849aaaeeb045965f3f8085c7cb65c3c830bd724c",
            "patch": "@@ -3,7 +3,6 @@\n require('../common');\n const assert = require('assert');\n const BufferList = require('internal/streams/buffer_list');\n-const util = require('util');\n \n // Test empty buffer list.\n const emptyList = new BufferList();\n@@ -31,10 +30,3 @@ assert.strictEqual(list.join(','), 'foo');\n const shifted = list.shift();\n assert.strictEqual(shifted, buf);\n assert.deepStrictEqual(list, new BufferList());\n-\n-const tmp = util.inspect.defaultOptions.colors;\n-util.inspect.defaultOptions = { colors: true };\n-assert.strictEqual(\n-  util.inspect(list),\n-  'BufferList { length: \\u001b[33m0\\u001b[39m }');\n-util.inspect.defaultOptions = { colors: tmp };"
        },
        {
            "sha": "d7fb28ddc7728222dc2eb5f9ab0599499637b1b1",
            "filename": "test/parallel/test-util-inspect-proxy.js",
            "status": "modified",
            "additions": 6,
            "deletions": 10,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/849aaaeeb045965f3f8085c7cb65c3c830bd724c/test%2Fparallel%2Ftest-util-inspect-proxy.js",
            "raw_url": "https://github.com/nodejs/node/raw/849aaaeeb045965f3f8085c7cb65c3c830bd724c/test%2Fparallel%2Ftest-util-inspect-proxy.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect-proxy.js?ref=849aaaeeb045965f3f8085c7cb65c3c830bd724c",
            "patch": "@@ -48,17 +48,13 @@ const expected1 = 'Proxy [ {}, {} ]';\n const expected2 = 'Proxy [ Proxy [ {}, {} ], {} ]';\n const expected3 = 'Proxy [ Proxy [ Proxy [ {}, {} ], {} ], Proxy [ {}, {} ] ]';\n const expected4 = 'Proxy [ Proxy [ {}, {} ], Proxy [ Proxy [ {}, {} ], {} ] ]';\n-const expected5 = 'Proxy [ Proxy [ Proxy [ Proxy [ {}, {} ], {} ],' +\n+const expected5 = 'Proxy [ Proxy [ Proxy [ Proxy [Array], {} ],' +\n                   ' Proxy [ {}, {} ] ],\\n  Proxy [ Proxy [ {}, {} ]' +\n-                  ', Proxy [ Proxy [ {}, {} ], {} ] ] ]';\n-const expected6 = 'Proxy [ Proxy [ Proxy [ Proxy [ Proxy [ {}, {} ], {} ], ' +\n-                    'Proxy [ {}, {} ] ],\\n' +\n-                  '    Proxy [ Proxy [ {}, {} ], ' +\n-                    'Proxy [ Proxy [ {}, {} ], {} ] ] ],\\n' +\n-                  '  Proxy [ Proxy [ Proxy [ Proxy [ {}, {} ], {} ], ' +\n-                    'Proxy [ {}, {} ] ],\\n' +\n-                  '    Proxy [ Proxy [ {}, {} ], ' +\n-                    'Proxy [ Proxy [ {}, {} ], {} ] ] ] ]';\n+                  ', Proxy [ Proxy [Array], {} ] ] ]';\n+const expected6 = 'Proxy [ Proxy [ Proxy [ Proxy [Array], Proxy [Array]' +\n+                  ' ],\\n    Proxy [ Proxy [Array], Proxy [Array] ] ],\\n' +\n+                  '  Proxy [ Proxy [ Proxy [Array], Proxy [Array] ],\\n' +\n+                  '    Proxy [ Proxy [Array], Proxy [Array] ] ] ]';\n assert.strictEqual(\n   util.inspect(proxy1, { showProxy: true, depth: null }),\n   expected1);"
        },
        {
            "sha": "5cd051299d7f069ffb18f8b81279fdccf03e318e",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/849aaaeeb045965f3f8085c7cb65c3c830bd724c/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/849aaaeeb045965f3f8085c7cb65c3c830bd724c/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=849aaaeeb045965f3f8085c7cb65c3c830bd724c",
            "patch": "@@ -68,7 +68,7 @@ assert.strictEqual(util.inspect({ a: 1, b: 2 }), '{ a: 1, b: 2 }');\n assert.strictEqual(util.inspect({ 'a': {} }), '{ a: {} }');\n assert.strictEqual(util.inspect({ 'a': { 'b': 2 } }), '{ a: { b: 2 } }');\n assert.strictEqual(util.inspect({ 'a': { 'b': { 'c': { 'd': 2 } } } }),\n-                   '{ a: { b: { c: { d: 2 } } } }');\n+                   '{ a: { b: { c: [Object] } } }');\n assert.strictEqual(\n   util.inspect({ 'a': { 'b': { 'c': { 'd': 2 } } } }, false, null),\n   '{ a: { b: { c: { d: 2 } } } }');\n@@ -106,7 +106,7 @@ assert.strictEqual(util.inspect((new JSStream())._externalStream),\n   assert.strictEqual(util.inspect({ a: regexp }, false, 0), '{ a: /regexp/ }');\n }\n \n-assert(!/Object/.test(\n+assert(/Object/.test(\n   util.inspect({ a: { a: { a: { a: {} } } } }, undefined, undefined, true)\n ));\n assert(!/Object/.test(\n@@ -1011,15 +1011,15 @@ if (typeof Symbol !== 'undefined') {\n // Empty and circular before depth.\n {\n   const arr = [[[[]]]];\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [] ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ [] ] ] ]');\n   arr[0][0][0][0] = [];\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [Array] ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ [Array] ] ] ]');\n   arr[0][0][0] = {};\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ {} ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ {} ] ] ]');\n   arr[0][0][0] = { a: 2 };\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [Object] ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ [Object] ] ] ]');\n   arr[0][0][0] = arr;\n-  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [Circular] ] ] ]');\n+  assert.strictEqual(util.inspect(arr), '[ [ [ [Circular] ] ] ]');\n }\n \n // Corner cases.\n@@ -1116,10 +1116,10 @@ if (typeof Symbol !== 'undefined') {\n   assert(!/1 more item/.test(util.inspect(arr)));\n   util.inspect.defaultOptions.maxArrayLength = oldOptions.maxArrayLength;\n   assert(/1 more item/.test(util.inspect(arr)));\n-  util.inspect.defaultOptions.depth = 2;\n-  assert(/Object/.test(util.inspect(obj)));\n-  util.inspect.defaultOptions.depth = oldOptions.depth;\n+  util.inspect.defaultOptions.depth = null;\n   assert(!/Object/.test(util.inspect(obj)));\n+  util.inspect.defaultOptions.depth = oldOptions.depth;\n+  assert(/Object/.test(util.inspect(obj)));\n   assert.strictEqual(\n     JSON.stringify(util.inspect.defaultOptions),\n     JSON.stringify(oldOptions)\n@@ -1131,7 +1131,7 @@ if (typeof Symbol !== 'undefined') {\n   assert(/Object/.test(util.inspect(obj)));\n   util.inspect.defaultOptions = oldOptions;\n   assert(/1 more item/.test(util.inspect(arr)));\n-  assert(!/Object/.test(util.inspect(obj)));\n+  assert(/Object/.test(util.inspect(obj)));\n   assert.strictEqual(\n     JSON.stringify(util.inspect.defaultOptions),\n     JSON.stringify(oldOptions)"
        }
    ],
    "stats": {
        "total": 83,
        "additions": 28,
        "deletions": 55
    }
}