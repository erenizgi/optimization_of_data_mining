{
    "author": "ZYSzys",
    "message": "fs: harden validation of start option in createWriteStream\n\nPR-URL: https://github.com/nodejs/node/pull/25579\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "70f4f08a9f0902056ac47271f9d3a761fcee4715",
    "files": [
        {
            "sha": "53a504f3ec9b851fafebf561408ff1c71296ea74",
            "filename": "doc/api/fs.md",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/70f4f08a9f0902056ac47271f9d3a761fcee4715/doc%2Fapi%2Ffs.md",
            "raw_url": "https://github.com/nodejs/node/raw/70f4f08a9f0902056ac47271f9d3a761fcee4715/doc%2Fapi%2Ffs.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ffs.md?ref=70f4f08a9f0902056ac47271f9d3a761fcee4715",
            "patch": "@@ -1470,9 +1470,11 @@ returned by this method has a default `highWaterMark` of 64 kb.\n \n `options` can include `start` and `end` values to read a range of bytes from\n the file instead of the entire file. Both `start` and `end` are inclusive and\n-start counting at 0. If `fd` is specified and `start` is omitted or `undefined`,\n-`fs.createReadStream()` reads sequentially from the current file position.\n-The `encoding` can be any one of those accepted by [`Buffer`][].\n+start counting at 0, allowed values are in the\n+[0, [`Number.MAX_SAFE_INTEGER`][]] range. If `fd` is specified and `start` is\n+omitted or `undefined`, `fs.createReadStream()` reads sequentially from the\n+current file position. The `encoding` can be any one of those accepted by\n+[`Buffer`][].\n \n If `fd` is specified, `ReadStream` will ignore the `path` argument and will use\n the specified file descriptor. This means that no `'open'` event will be\n@@ -1548,7 +1550,8 @@ changes:\n * Returns: {fs.WriteStream} See [Writable Stream][].\n \n `options` may also include a `start` option to allow writing data at\n-some position past the beginning of the file. Modifying a file rather\n+some position past the beginning of the file, allowed values are in the\n+[0, [`Number.MAX_SAFE_INTEGER`][]] range. Modifying a file rather\n than replacing it may require a `flags` mode of `r+` rather than the\n default mode `w`. The `encoding` can be any one of those accepted by\n [`Buffer`][].\n@@ -4953,3 +4956,4 @@ the file contents.\n [chcp]: https://ss64.com/nt/chcp.html\n [inode]: https://en.wikipedia.org/wiki/Inode\n [support of file system `flags`]: #fs_file_system_flags\n+[`Number.MAX_SAFE_INTEGER`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Number/MAX_SAFE_INTEGER"
        },
        {
            "sha": "7174990ebb60a0a4d14c9a37ca855abca3ae8670",
            "filename": "lib/internal/fs/streams.js",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/70f4f08a9f0902056ac47271f9d3a761fcee4715/lib%2Finternal%2Ffs%2Fstreams.js",
            "raw_url": "https://github.com/nodejs/node/raw/70f4f08a9f0902056ac47271f9d3a761fcee4715/lib%2Finternal%2Ffs%2Fstreams.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Fstreams.js?ref=70f4f08a9f0902056ac47271f9d3a761fcee4715",
            "patch": "@@ -243,13 +243,7 @@ function WriteStream(path, options) {\n   this.closed = false;\n \n   if (this.start !== undefined) {\n-    if (typeof this.start !== 'number') {\n-      throw new ERR_INVALID_ARG_TYPE('start', 'number', this.start);\n-    }\n-    if (this.start < 0) {\n-      const errVal = `{start: ${this.start}}`;\n-      throw new ERR_OUT_OF_RANGE('start', '>= 0', errVal);\n-    }\n+    checkPosition(this.start, 'start');\n \n     this.pos = this.start;\n   }"
        },
        {
            "sha": "618fbdf884c0c663c8f0a56638bee444b76d5939",
            "filename": "test/parallel/test-file-write-stream3.js",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/70f4f08a9f0902056ac47271f9d3a761fcee4715/test%2Fparallel%2Ftest-file-write-stream3.js",
            "raw_url": "https://github.com/nodejs/node/raw/70f4f08a9f0902056ac47271f9d3a761fcee4715/test%2Fparallel%2Ftest-file-write-stream3.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-file-write-stream3.js?ref=70f4f08a9f0902056ac47271f9d3a761fcee4715",
            "patch": "@@ -161,6 +161,7 @@ function run_test_3() {\n     assert.strictEqual(fileData, fileDataExpected_3);\n \n     run_test_4();\n+    run_test_5();\n   });\n \n   file.on('error', function(err) {\n@@ -184,7 +185,22 @@ const run_test_4 = common.mustCall(function() {\n   const err = {\n     code: 'ERR_OUT_OF_RANGE',\n     message: 'The value of \"start\" is out of range. ' +\n-             'It must be >= 0. Received {start: -5}',\n+             'It must be >= 0 and <= 2 ** 53 - 1. Received -5',\n+    type: RangeError\n+  };\n+  common.expectsError(fn, err);\n+});\n+\n+\n+const run_test_5 = common.mustCall(function() {\n+  //  Error: start must be <= 2 ** 53 - 1\n+  const fn = () => {\n+    fs.createWriteStream(filepath, { start: 2 ** 53, flags: 'r+' });\n+  };\n+  const err = {\n+    code: 'ERR_OUT_OF_RANGE',\n+    message: 'The value of \"start\" is out of range. ' +\n+             'It must be >= 0 and <= 2 ** 53 - 1. Received 9007199254740992',\n     type: RangeError\n   };\n   common.expectsError(fn, err);"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 26,
        "deletions": 12
    }
}