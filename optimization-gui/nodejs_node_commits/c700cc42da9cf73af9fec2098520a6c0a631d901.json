{
    "author": "cjihrig",
    "message": "fs: don't limit ftruncate() length to 32 bits\n\nThe length used by ftruncate() is 64 bits in the binding layer.\nThis commit removes the 32 bit restriction in the JS layer.\n\nPR-URL: https://github.com/nodejs/node/pull/20851\nFixes: https://github.com/nodejs/node/issues/20844\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>",
    "sha": "c700cc42da9cf73af9fec2098520a6c0a631d901",
    "files": [
        {
            "sha": "b804336bcf6193bbc41927057cb90ce965a5f4e8",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/c700cc42da9cf73af9fec2098520a6c0a631d901/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/c700cc42da9cf73af9fec2098520a6c0a631d901/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=c700cc42da9cf73af9fec2098520a6c0a631d901",
            "patch": "@@ -651,11 +651,7 @@ function ftruncate(fd, len = 0, callback) {\n     len = 0;\n   }\n   validateUint32(fd, 'fd');\n-  // TODO(BridgeAR): This does not seem right.\n-  // There does not seem to be any validation before and if there is any, it\n-  // should work similar to validateUint32 or not have a upper cap at all.\n-  // This applies to all usage of `validateInt32(len, 'len')`.\n-  validateInt32(len, 'len');\n+  validateInteger(len, 'len');\n   len = Math.max(0, len);\n   const req = new FSReqWrap();\n   req.oncomplete = makeCallback(callback);\n@@ -664,7 +660,7 @@ function ftruncate(fd, len = 0, callback) {\n \n function ftruncateSync(fd, len = 0) {\n   validateUint32(fd, 'fd');\n-  validateInt32(len, 'len');\n+  validateInteger(len, 'len');\n   len = Math.max(0, len);\n   const ctx = {};\n   binding.ftruncate(fd, len, undefined, ctx);"
        },
        {
            "sha": "687dfb5aead2a84b78c019470a6ecc397e1cc5af",
            "filename": "lib/internal/fs/promises.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/c700cc42da9cf73af9fec2098520a6c0a631d901/lib%2Finternal%2Ffs%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/c700cc42da9cf73af9fec2098520a6c0a631d901/lib%2Finternal%2Ffs%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Fpromises.js?ref=c700cc42da9cf73af9fec2098520a6c0a631d901",
            "patch": "@@ -33,7 +33,7 @@ const {\n const {\n   isUint32,\n   validateAndMaskMode,\n-  validateInt32,\n+  validateInteger,\n   validateUint32\n } = require('internal/validators');\n const pathModule = require('path');\n@@ -263,7 +263,7 @@ async function truncate(path, len = 0) {\n \n async function ftruncate(handle, len = 0) {\n   validateFileHandle(handle);\n-  validateInt32(len, 'len');\n+  validateInteger(len, 'len');\n   len = Math.max(0, len);\n   return binding.ftruncate(handle.fd, len, kUsePromises);\n }"
        },
        {
            "sha": "8193e05bb7d4b057c53d4aa56245e49ea1ffba09",
            "filename": "test/parallel/test-fs-truncate.js",
            "status": "modified",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/c700cc42da9cf73af9fec2098520a6c0a631d901/test%2Fparallel%2Ftest-fs-truncate.js",
            "raw_url": "https://github.com/nodejs/node/raw/c700cc42da9cf73af9fec2098520a6c0a631d901/test%2Fparallel%2Ftest-fs-truncate.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-truncate.js?ref=c700cc42da9cf73af9fec2098520a6c0a631d901",
            "patch": "@@ -222,19 +222,6 @@ function testFtruncate(cb) {\n     );\n   });\n \n-  // 2 ** 31 = 2147483648\n-  [2147483648, -2147483649].forEach((input) => {\n-    assert.throws(\n-      () => fs.ftruncate(fd, input),\n-      {\n-        code: 'ERR_OUT_OF_RANGE',\n-        name: 'RangeError [ERR_OUT_OF_RANGE]',\n-        message: 'The value of \"len\" is out of range. It must be ' +\n-                  `>= -2147483648 && <= 2147483647. Received ${input}`\n-      }\n-    );\n-  });\n-\n   fs.ftruncate(fd, undefined, common.mustCall(function(err) {\n     assert.ifError(err);\n     assert(fs.readFileSync(file5).equals(Buffer.from('')));"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 4,
        "deletions": 21
    }
}