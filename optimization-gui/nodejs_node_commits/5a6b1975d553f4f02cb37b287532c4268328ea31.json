{
    "author": "apapirovski",
    "message": "timers: check can_call_into_js in Immediates\n\nPrevent an infinite loop if it's not possible to call into JS.\n\nPR-URL: https://github.com/nodejs/node/pull/21057\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>",
    "sha": "5a6b1975d553f4f02cb37b287532c4268328ea31",
    "files": [
        {
            "sha": "7865ba95404df5ebfff3cb63ca02f37ab955024c",
            "filename": "src/env.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/5a6b1975d553f4f02cb37b287532c4268328ea31/src%2Fenv.cc",
            "raw_url": "https://github.com/nodejs/node/raw/5a6b1975d553f4f02cb37b287532c4268328ea31/src%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.cc?ref=5a6b1975d553f4f02cb37b287532c4268328ea31",
            "patch": "@@ -457,14 +457,17 @@ void Environment::CheckImmediate(uv_check_t* handle) {\n \n   env->RunAndClearNativeImmediates();\n \n+  if (!env->can_call_into_js())\n+    return;\n+\n   do {\n     MakeCallback(env->isolate(),\n                  env->process_object(),\n                  env->immediate_callback_function(),\n                  0,\n                  nullptr,\n                  {0, 0}).ToLocalChecked();\n-  } while (env->immediate_info()->has_outstanding());\n+  } while (env->immediate_info()->has_outstanding() && env->can_call_into_js());\n \n   if (env->immediate_info()->ref_count() == 0)\n     env->ToggleImmediateRef(false);"
        }
    ],
    "stats": {
        "total": 5,
        "additions": 4,
        "deletions": 1
    }
}