{
    "author": "lucamaraschi",
    "message": "test: added input validation test for fchmod\n\nAdded a test to ensure input validation for FD and mode for fs.fchmod.\nRemoved check for values lower than 0 for `mode` as it's already checked\nby `validateUint32`.\n\nPR-URL: https://github.com/nodejs/node/pull/18217\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "075eef59561c259b7d9df9f72672419feaf4a40e",
    "files": [
        {
            "sha": "7087a5f03c5f9e7e495c87903eb6bbf11a19e47d",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/075eef59561c259b7d9df9f72672419feaf4a40e/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/075eef59561c259b7d9df9f72672419feaf4a40e/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=075eef59561c259b7d9df9f72672419feaf4a40e",
            "patch": "@@ -1340,7 +1340,8 @@ fs.fchmod = function(fd, mode, callback) {\n   mode = modeNum(mode);\n   validateUint32(fd, 'fd');\n   validateUint32(mode, 'mode');\n-  if (mode < 0 || mode > 0o777)\n+  // values for mode < 0 are already checked via the validateUint32 function\n+  if (mode > 0o777)\n     throw new errors.RangeError('ERR_OUT_OF_RANGE', 'mode');\n \n   const req = new FSReqWrap();"
        },
        {
            "sha": "42a11e8a96c02de5b29ec8c8e577420c0e6c5e18",
            "filename": "test/parallel/test-fs-fchmod.js",
            "status": "added",
            "additions": 67,
            "deletions": 0,
            "changes": 67,
            "blob_url": "https://github.com/nodejs/node/blob/075eef59561c259b7d9df9f72672419feaf4a40e/test%2Fparallel%2Ftest-fs-fchmod.js",
            "raw_url": "https://github.com/nodejs/node/raw/075eef59561c259b7d9df9f72672419feaf4a40e/test%2Fparallel%2Ftest-fs-fchmod.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-fchmod.js?ref=075eef59561c259b7d9df9f72672419feaf4a40e",
            "patch": "@@ -0,0 +1,67 @@\n+'use strict';\n+const common = require('../common');\n+const fs = require('fs');\n+\n+// This test ensures that input for fchmod is valid, testing for valid\n+// inputs for fd and mode\n+\n+// Check input type\n+['', false, null, undefined, {}, [], Infinity, -1].forEach((i) => {\n+  common.expectsError(\n+    () => fs.fchmod(i),\n+    {\n+      code: 'ERR_INVALID_ARG_TYPE',\n+      type: TypeError,\n+      message: 'The \"fd\" argument must be of type integer'\n+    }\n+  );\n+  common.expectsError(\n+    () => fs.fchmodSync(i),\n+    {\n+      code: 'ERR_INVALID_ARG_TYPE',\n+      type: TypeError,\n+      message: 'The \"fd\" argument must be of type integer'\n+    }\n+  );\n+\n+  common.expectsError(\n+    () => fs.fchmod(1, i),\n+    {\n+      code: 'ERR_INVALID_ARG_TYPE',\n+      type: TypeError,\n+      message: 'The \"mode\" argument must be of type integer'\n+    }\n+  );\n+  common.expectsError(\n+    () => fs.fchmodSync(1, i),\n+    {\n+      code: 'ERR_INVALID_ARG_TYPE',\n+      type: TypeError,\n+      message: 'The \"mode\" argument must be of type integer'\n+    }\n+  );\n+});\n+\n+// Check for mode values range\n+const modeUpperBoundaryValue = 0o777;\n+fs.fchmod(1, modeUpperBoundaryValue);\n+fs.fchmodSync(1, modeUpperBoundaryValue);\n+\n+// umask of 0o777 is equal to 775\n+const modeOutsideUpperBoundValue = 776;\n+common.expectsError(\n+  () => fs.fchmod(1, modeOutsideUpperBoundValue),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"mode\" is out of range.'\n+  }\n+);\n+common.expectsError(\n+  () => fs.fchmodSync(1, modeOutsideUpperBoundValue),\n+  {\n+    code: 'ERR_OUT_OF_RANGE',\n+    type: RangeError,\n+    message: 'The value of \"mode\" is out of range.'\n+  }\n+);"
        },
        {
            "sha": "a7e6bf6cbca571bd0f4508342a7d085d64e3780f",
            "filename": "test/parallel/test-fs-fchown.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/075eef59561c259b7d9df9f72672419feaf4a40e/test%2Fparallel%2Ftest-fs-fchown.js",
            "raw_url": "https://github.com/nodejs/node/raw/075eef59561c259b7d9df9f72672419feaf4a40e/test%2Fparallel%2Ftest-fs-fchown.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-fchown.js?ref=075eef59561c259b7d9df9f72672419feaf4a40e",
            "patch": "@@ -3,7 +3,7 @@\n const common = require('../common');\n const fs = require('fs');\n \n-['', false, null, undefined, {}, []].forEach((i) => {\n+['', false, null, undefined, {}, [], Infinity, -1].forEach((i) => {\n   common.expectsError(\n     () => fs.fchown(i),\n     {"
        }
    ],
    "stats": {
        "total": 72,
        "additions": 70,
        "deletions": 2
    }
}