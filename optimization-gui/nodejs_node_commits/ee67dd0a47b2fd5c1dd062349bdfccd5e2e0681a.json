{
    "author": "addaleax",
    "message": "test: add test for stream unpipe with 'data' listeners\n\nPR-URL: https://github.com/nodejs/node/pull/18516\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "ee67dd0a47b2fd5c1dd062349bdfccd5e2e0681a",
    "files": [
        {
            "sha": "048b7ea5e531639895428257c7266b1f02993d27",
            "filename": "test/parallel/test-stream-pipe-flow-after-unpipe.js",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/ee67dd0a47b2fd5c1dd062349bdfccd5e2e0681a/test%2Fparallel%2Ftest-stream-pipe-flow-after-unpipe.js",
            "raw_url": "https://github.com/nodejs/node/raw/ee67dd0a47b2fd5c1dd062349bdfccd5e2e0681a/test%2Fparallel%2Ftest-stream-pipe-flow-after-unpipe.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-pipe-flow-after-unpipe.js?ref=ee67dd0a47b2fd5c1dd062349bdfccd5e2e0681a",
            "patch": "@@ -0,0 +1,29 @@\n+'use strict';\n+const common = require('../common');\n+const { Readable, Writable } = require('stream');\n+\n+// Tests that calling .unpipe() un-blocks a stream that is paused because\n+// it is waiting on the writable side to finish a write().\n+\n+const rs = new Readable({\n+  highWaterMark: 1,\n+  // That this gets called at least 20 times is the real test here.\n+  read: common.mustCallAtLeast(() => rs.push('foo'), 20)\n+});\n+\n+const ws = new Writable({\n+  highWaterMark: 1,\n+  write: common.mustCall(() => {\n+    // Ignore the callback, this write() simply never finishes.\n+    setImmediate(() => rs.unpipe(ws));\n+  })\n+});\n+\n+let chunks = 0;\n+rs.on('data', common.mustCallAtLeast(() => {\n+  chunks++;\n+  if (chunks >= 20)\n+    rs.pause();  // Finish this test.\n+}));\n+\n+rs.pipe(ws);"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 29,
        "deletions": 0
    }
}