{
    "author": "MylesBorins",
    "message": "deps: patch V8 to 6.7.288.46\n\nPR-URL: https://github.com/nodejs/node/pull/21260\nRefs: https://github.com/v8/v8/compare/6.7.288.45...6.7.288.46\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ali Ijaz Sheikh <ofrobots@google.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919",
    "files": [
        {
            "sha": "440a6068699ef05d891072d1a8e81e200a430464",
            "filename": "deps/v8/include/v8-version.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919/deps%2Fv8%2Finclude%2Fv8-version.h",
            "raw_url": "https://github.com/nodejs/node/raw/eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919/deps%2Fv8%2Finclude%2Fv8-version.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8-version.h?ref=eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919",
            "patch": "@@ -11,7 +11,7 @@\n #define V8_MAJOR_VERSION 6\n #define V8_MINOR_VERSION 7\n #define V8_BUILD_NUMBER 288\n-#define V8_PATCH_LEVEL 45\n+#define V8_PATCH_LEVEL 46\n \n // Use 1 for candidates and 0 otherwise.\n // (Boolean macro values are not supported by all preprocessors.)"
        },
        {
            "sha": "b85609d9560ef77f3f262871ea1811c182b826b2",
            "filename": "deps/v8/src/code-stub-assembler.cc",
            "status": "modified",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919/deps%2Fv8%2Fsrc%2Fcode-stub-assembler.cc",
            "raw_url": "https://github.com/nodejs/node/raw/eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919/deps%2Fv8%2Fsrc%2Fcode-stub-assembler.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fcode-stub-assembler.cc?ref=eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919",
            "patch": "@@ -534,6 +534,18 @@ TNode<Smi> CodeStubAssembler::SmiFromInt32(SloppyTNode<Int32T> value) {\n       WordShl(value_intptr, SmiShiftBitsConstant()));\n }\n \n+TNode<BoolT> CodeStubAssembler::IsValidPositiveSmi(TNode<IntPtrT> value) {\n+  intptr_t constant_value;\n+  if (ToIntPtrConstant(value, constant_value)) {\n+    return (static_cast<uintptr_t>(constant_value) <=\n+            static_cast<uintptr_t>(Smi::kMaxValue))\n+               ? Int32TrueConstant()\n+               : Int32FalseConstant();\n+  }\n+\n+  return UintPtrLessThanOrEqual(value, IntPtrConstant(Smi::kMaxValue));\n+}\n+\n TNode<Smi> CodeStubAssembler::SmiTag(SloppyTNode<IntPtrT> value) {\n   int32_t constant_value;\n   if (ToInt32Constant(value, constant_value) && Smi::IsValid(constant_value)) {\n@@ -1002,6 +1014,19 @@ void CodeStubAssembler::GotoIfForceSlowPath(Label* if_true) {\n \n Node* CodeStubAssembler::AllocateRaw(Node* size_in_bytes, AllocationFlags flags,\n                                      Node* top_address, Node* limit_address) {\n+  // TODO(jgruber, chromium:848672): TNodeify AllocateRaw.\n+  // TODO(jgruber, chromium:848672): Call FatalProcessOutOfMemory if this fails.\n+  {\n+    intptr_t constant_value;\n+    if (ToIntPtrConstant(size_in_bytes, constant_value)) {\n+      CHECK(Internals::IsValidSmi(constant_value));\n+      CHECK_GT(constant_value, 0);\n+    } else {\n+      CSA_CHECK(this,\n+                IsValidPositiveSmi(UncheckedCast<IntPtrT>(size_in_bytes)));\n+    }\n+  }\n+\n   Node* top = Load(MachineType::Pointer(), top_address);\n   Node* limit = Load(MachineType::Pointer(), limit_address);\n "
        },
        {
            "sha": "633b1d8dce6f518068c5d21301f63926a84deaa8",
            "filename": "deps/v8/src/code-stub-assembler.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919/deps%2Fv8%2Fsrc%2Fcode-stub-assembler.h",
            "raw_url": "https://github.com/nodejs/node/raw/eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919/deps%2Fv8%2Fsrc%2Fcode-stub-assembler.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fcode-stub-assembler.h?ref=eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919",
            "patch": "@@ -252,6 +252,9 @@ class V8_EXPORT_PRIVATE CodeStubAssembler : public compiler::CodeAssembler {\n                                         TNode<Object> index,\n                                         TNode<IntPtrT> length);\n \n+  // Returns true iff the given value fits into smi range and is >= 0.\n+  TNode<BoolT> IsValidPositiveSmi(TNode<IntPtrT> value);\n+\n   // Tag an IntPtr as a Smi value.\n   TNode<Smi> SmiTag(SloppyTNode<IntPtrT> value);\n   // Untag a Smi value as an IntPtr."
        },
        {
            "sha": "12e9fe4bea114f04961ee9b8b7a941d85f5d405c",
            "filename": "deps/v8/test/cctest/test-code-stub-assembler.cc",
            "status": "modified",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919/deps%2Fv8%2Ftest%2Fcctest%2Ftest-code-stub-assembler.cc",
            "raw_url": "https://github.com/nodejs/node/raw/eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919/deps%2Fv8%2Ftest%2Fcctest%2Ftest-code-stub-assembler.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Ftest-code-stub-assembler.cc?ref=eb2d3a3b9c9aed0c4bf2da743b163c5121bf8919",
            "patch": "@@ -206,6 +206,49 @@ TEST(ToUint32) {\n   ft.CheckThrows(factory->match_symbol());\n }\n \n+namespace {\n+void IsValidPositiveSmiCase(Isolate* isolate, intptr_t value, bool expected) {\n+  const int kNumParams = 0;\n+  CodeAssemblerTester asm_tester(isolate, kNumParams);\n+\n+  CodeStubAssembler m(asm_tester.state());\n+  m.Return(\n+      m.SelectBooleanConstant(m.IsValidPositiveSmi(m.IntPtrConstant(value))));\n+\n+  FunctionTester ft(asm_tester.GenerateCode(), kNumParams);\n+  MaybeHandle<Object> maybe_handle = ft.Call();\n+\n+  if (expected) {\n+    CHECK(maybe_handle.ToHandleChecked()->IsTrue(isolate));\n+  } else {\n+    CHECK(maybe_handle.ToHandleChecked()->IsFalse(isolate));\n+  }\n+}\n+}  // namespace\n+\n+TEST(IsValidPositiveSmi) {\n+  Isolate* isolate(CcTest::InitIsolateOnce());\n+\n+  IsValidPositiveSmiCase(isolate, -1, false);\n+  IsValidPositiveSmiCase(isolate, 0, true);\n+  IsValidPositiveSmiCase(isolate, 1, true);\n+\n+#ifdef V8_TARGET_ARCH_32_BIT\n+  IsValidPositiveSmiCase(isolate, 0x3FFFFFFFU, true);\n+  IsValidPositiveSmiCase(isolate, 0xC0000000U, false);\n+  IsValidPositiveSmiCase(isolate, 0x40000000U, false);\n+  IsValidPositiveSmiCase(isolate, 0xBFFFFFFFU, false);\n+#else\n+  typedef std::numeric_limits<int32_t> int32_limits;\n+  IsValidPositiveSmiCase(isolate, int32_limits::max(), true);\n+  IsValidPositiveSmiCase(isolate, int32_limits::min(), false);\n+  IsValidPositiveSmiCase(isolate,\n+                         static_cast<intptr_t>(int32_limits::max()) + 1, false);\n+  IsValidPositiveSmiCase(isolate,\n+                         static_cast<intptr_t>(int32_limits::min()) - 1, false);\n+#endif\n+}\n+\n TEST(FixedArrayAccessSmiIndex) {\n   Isolate* isolate(CcTest::InitIsolateOnce());\n   CodeAssemblerTester asm_tester(isolate);"
        }
    ],
    "stats": {
        "total": 73,
        "additions": 72,
        "deletions": 1
    }
}