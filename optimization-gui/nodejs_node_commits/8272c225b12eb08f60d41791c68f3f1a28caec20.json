{
    "author": "BridgeAR",
    "message": "errors: implement new error handling\n\nThis implements a function based system. Instead of passing in the\nerror code as first argument, the error code itself is a error class.\nIt already contains the correct error type, so while adding a new\nerror no one has to think about the error type anymore. In case a\nsingle error code has more than one error type, the error class has\nproperties for the non default error types. Those can be used as\nfallback.\n\nThis prevents typos, makes the implementation easier and it is less\nverbose when writing the code for a new error.\n\nThe implementation itself does not interfere with the old\nimplementation. So the old and the new system can co-exist and it is\npossible to slowly migrate the old ones to the new system.\n\nPR-URL: https://github.com/nodejs/node/pull/18857\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>",
    "sha": "8272c225b12eb08f60d41791c68f3f1a28caec20",
    "files": [
        {
            "sha": "ea72ea714d85182975bd0a83a65ffd5facff32b1",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 50,
            "deletions": 6,
            "changes": 56,
            "blob_url": "https://github.com/nodejs/node/blob/8272c225b12eb08f60d41791c68f3f1a28caec20/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/8272c225b12eb08f60d41791c68f3f1a28caec20/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=8272c225b12eb08f60d41791c68f3f1a28caec20",
            "patch": "@@ -13,6 +13,7 @@\n const kCode = Symbol('code');\n const kInfo = Symbol('info');\n const messages = new Map();\n+const codes = {};\n \n var green = '';\n var red = '';\n@@ -86,6 +87,54 @@ function makeNodeError(Base) {\n   };\n }\n \n+function makeNodeErrorWithCode(Base, key) {\n+  return class NodeError extends Base {\n+    constructor(...args) {\n+      super(message(key, args));\n+    }\n+\n+    get name() {\n+      return `${super.name} [${key}]`;\n+    }\n+\n+    set name(value) {\n+      defineProperty(this, 'name', {\n+        configurable: true,\n+        enumerable: true,\n+        value,\n+        writable: true\n+      });\n+    }\n+\n+    get code() {\n+      return key;\n+    }\n+\n+    set code(value) {\n+      defineProperty(this, 'code', {\n+        configurable: true,\n+        enumerable: true,\n+        value,\n+        writable: true\n+      });\n+    }\n+  };\n+}\n+\n+// Utility function for registering the error codes. Only used here. Exported\n+// *only* to allow for testing.\n+function E(sym, val, def, ...otherClasses) {\n+  messages.set(sym, val);\n+  if (def === undefined) return;\n+  def = makeNodeErrorWithCode(def, sym);\n+  if (otherClasses.length !== 0) {\n+    otherClasses.forEach((clazz) => {\n+      def[clazz.name] = makeNodeErrorWithCode(clazz, sym);\n+    });\n+  }\n+  codes[sym] = def;\n+}\n+\n function lazyBuffer() {\n   if (buffer === undefined)\n     buffer = require('buffer').Buffer;\n@@ -367,12 +416,6 @@ function message(key, args) {\n   return String(fmt.apply(null, args));\n }\n \n-// Utility function for registering the error codes. Only used here. Exported\n-// *only* to allow for testing.\n-function E(sym, val) {\n-  messages.set(sym, typeof val === 'function' ? val : String(val));\n-}\n-\n /**\n  * This creates an error compatible with errors produced in the C++\n  * function UVException using a context object with data assembled in C++.\n@@ -523,6 +566,7 @@ module.exports = exports = {\n   URIError: makeNodeError(URIError),\n   AssertionError,\n   SystemError,\n+  codes,\n   E, // This is exported only to facilitate testing.\n   errorCache: new Map() // This is in here only to facilitate testing.\n };"
        }
    ],
    "stats": {
        "total": 56,
        "additions": 50,
        "deletions": 6
    }
}