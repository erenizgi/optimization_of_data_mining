{
    "author": "joyeecheung",
    "message": "tools: add `make format-cpp` to run clang-format on C++ diffs\n\nThis patch adds a `make format-cpp` shortcut to the Makefile\nthat runs clang-format on the C++ diffs, and a\n`make format-cpp-build` to install clang-format from\nnpm.\n\nTo format staged changes:\n\n```\n$ make format-cpp\n```\n\nTo format HEAD~1...HEAD (latest commit):\n\n```\n$ CLANG_FORMAT_START=`git rev-parse HEAD~1` make format-cpp\n```\n\nTo format diff between master and current branch head (master...HEAD):\n\n```\n$ CLANG_FORMAT_START=master make format-cpp\n```\n\nMost of the .clang-format file comes from running\n\n```\n$ clang-format --dump-config --style=Google\n```\n\nwith clang-format built with llvm/trunk 328768 (npm version 1.2.3)\n\nThe clang-format version is fixed because different version of\nclang-format may format the files differently.\n\nPR-URL: https://github.com/nodejs/node/pull/21997\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "0da144f4d48d7a423b8f61cd178bb41346083107",
    "files": [
        {
            "sha": "4aad29c328abd4906e1524198356bd6f4984303d",
            "filename": ".clang-format",
            "status": "added",
            "additions": 111,
            "deletions": 0,
            "changes": 111,
            "blob_url": "https://github.com/nodejs/node/blob/0da144f4d48d7a423b8f61cd178bb41346083107/.clang-format",
            "raw_url": "https://github.com/nodejs/node/raw/0da144f4d48d7a423b8f61cd178bb41346083107/.clang-format",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/.clang-format?ref=0da144f4d48d7a423b8f61cd178bb41346083107",
            "patch": "@@ -0,0 +1,111 @@\n+---\n+Language:        Cpp\n+# BasedOnStyle:  Google\n+AccessModifierOffset: -1\n+AlignAfterOpenBracket: Align\n+AlignConsecutiveAssignments: false\n+AlignConsecutiveDeclarations: false\n+AlignEscapedNewlines: Right\n+AlignOperands:   true\n+AlignTrailingComments: true\n+AllowAllParametersOfDeclarationOnNextLine: true\n+AllowShortBlocksOnASingleLine: false\n+AllowShortCaseLabelsOnASingleLine: false\n+AllowShortFunctionsOnASingleLine: Inline\n+AllowShortIfStatementsOnASingleLine: true\n+AllowShortLoopsOnASingleLine: true\n+AlwaysBreakAfterDefinitionReturnType: None\n+AlwaysBreakAfterReturnType: None\n+AlwaysBreakBeforeMultilineStrings: false\n+AlwaysBreakTemplateDeclarations: true\n+BinPackArguments: false\n+BinPackParameters: false\n+BraceWrapping:\n+  AfterClass:      false\n+  AfterControlStatement: false\n+  AfterEnum:       false\n+  AfterFunction:   false\n+  AfterNamespace:  false\n+  AfterObjCDeclaration: false\n+  AfterStruct:     false\n+  AfterUnion:      false\n+  AfterExternBlock: false\n+  BeforeCatch:     false\n+  BeforeElse:      false\n+  IndentBraces:    false\n+  SplitEmptyFunction: true\n+  SplitEmptyRecord: true\n+  SplitEmptyNamespace: true\n+BreakBeforeBinaryOperators: None\n+BreakBeforeBraces: Attach\n+BreakBeforeInheritanceComma: false\n+BreakBeforeTernaryOperators: true\n+BreakConstructorInitializersBeforeComma: false\n+BreakConstructorInitializers: BeforeColon\n+BreakAfterJavaFieldAnnotations: false\n+BreakStringLiterals: true\n+ColumnLimit:      80\n+CommentPragmas:  '^ IWYU pragma:'\n+CompactNamespaces: false\n+ConstructorInitializerAllOnOneLineOrOnePerLine: true\n+ConstructorInitializerIndentWidth: 4\n+ContinuationIndentWidth: 4\n+Cpp11BracedListStyle: true\n+DerivePointerAlignment: false\n+DisableFormat:   false\n+ExperimentalAutoDetectBinPacking: false\n+FixNamespaceComments: true\n+ForEachMacros:\n+  - foreach\n+  - Q_FOREACH\n+  - BOOST_FOREACH\n+IncludeBlocks:   Preserve\n+IncludeCategories:\n+  - Regex:           '^<ext/.*\\.h>'\n+    Priority:        2\n+  - Regex:           '^<.*\\.h>'\n+    Priority:        1\n+  - Regex:           '^<.*'\n+    Priority:        2\n+  - Regex:           '.*'\n+    Priority:        3\n+IncludeIsMainRegex: '([-_](test|unittest))?$'\n+IndentCaseLabels: true\n+IndentPPDirectives: None\n+IndentWidth:     2\n+IndentWrappedFunctionNames: false\n+JavaScriptQuotes: Leave\n+JavaScriptWrapImports: true\n+KeepEmptyLinesAtTheStartOfBlocks: false\n+MacroBlockBegin: ''\n+MacroBlockEnd:   ''\n+MaxEmptyLinesToKeep: 1\n+NamespaceIndentation: None\n+ObjCBlockIndentWidth: 2\n+ObjCSpaceAfterProperty: false\n+ObjCSpaceBeforeProtocolList: false\n+PenaltyBreakAssignment: 2\n+PenaltyBreakBeforeFirstCallParameter: 1\n+PenaltyBreakComment: 300\n+PenaltyBreakFirstLessLess: 120\n+PenaltyBreakString: 1000\n+PenaltyExcessCharacter: 1000000\n+PenaltyReturnTypeOnItsOwnLine: 200\n+PointerAlignment: Left\n+ReflowComments:  true\n+SortIncludes:    true\n+SortUsingDeclarations: true\n+SpaceAfterCStyleCast: false\n+SpaceAfterTemplateKeyword: true\n+SpaceBeforeAssignmentOperators: true\n+SpaceBeforeParens: ControlStatements\n+SpaceInEmptyParentheses: false\n+SpacesBeforeTrailingComments: 2\n+SpacesInAngles:  false\n+SpacesInContainerLiterals: true\n+SpacesInCStyleCastParentheses: false\n+SpacesInParentheses: false\n+SpacesInSquareBrackets: false\n+Standard:        Auto\n+TabWidth:        8\n+UseTab:          Never"
        },
        {
            "sha": "255a4c5a4bc62b6620332b6feba9fb93c4471a13",
            "filename": ".gitignore",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/0da144f4d48d7a423b8f61cd178bb41346083107/.gitignore",
            "raw_url": "https://github.com/nodejs/node/raw/0da144f4d48d7a423b8f61cd178bb41346083107/.gitignore",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/.gitignore?ref=0da144f4d48d7a423b8f61cd178bb41346083107",
            "patch": "@@ -4,6 +4,7 @@\n !test/fixtures/**/.*\n !tools/node_modules/**/.*\n !tools/doc/node_modules/**/.*\n+!.clang-format\n !.editorconfig\n !.eslintignore\n !.eslintrc.js"
        },
        {
            "sha": "fc4a094656a452a404199879c08dc77d608efbd3",
            "filename": "Makefile",
            "status": "modified",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/0da144f4d48d7a423b8f61cd178bb41346083107/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/0da144f4d48d7a423b8f61cd178bb41346083107/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=0da144f4d48d7a423b8f61cd178bb41346083107",
            "patch": "@@ -1169,6 +1169,33 @@ LINT_CPP_FILES = $(filter-out $(LINT_CPP_EXCLUDE), $(wildcard \\\n # and the actual filename is generated so it won't match header guards\n ADDON_DOC_LINT_FLAGS=-whitespace/ending_newline,-build/header_guard\n \n+format-cpp-build:\n+\tcd tools/clang-format && $(call available-node,$(run-npm-install))\n+\n+format-cpp-clean:\n+\t$(RM) -r tools/clang-format/node_modules\n+\n+CLANG_FORMAT_START ?= HEAD\n+.PHONY: format-cpp\n+# To format staged changes:\n+#  $ make format-cpp\n+# To format HEAD~1...HEAD (latest commit):\n+#  $ CLANG_FORMAT_START=`git rev-parse HEAD~1` make format-cpp\n+# To format diff between master and current branch head (master...HEAD):\n+#  $ CLANG_FORMAT_START=master make format-cpp\n+format-cpp: ## Format C++ diff from $CLANG_FORMAT_START to current changes\n+ifneq (\"\",\"$(wildcard tools/clang-format/node_modules/)\")\n+\t@echo \"Formatting C++ diff from $(CLANG_FORMAT_START)..\"\n+\t@$(PYTHON) tools/clang-format/node_modules/.bin/git-clang-format \\\n+\t\t--binary=tools/clang-format/node_modules/.bin/clang-format \\\n+\t\t--style=file \\\n+\t\t$(CLANG_FORMAT_START) -- \\\n+\t\t$(LINT_CPP_FILES)\n+else\n+\t@echo \"clang-format is not installed.\"\n+\t@echo \"To install (requires internet access) run: $ make format-cpp-build\"\n+endif\n+\n .PHONY: lint-cpp\n # Lints the C++ code with cpplint.py and check-imports.py.\n lint-cpp: tools/.cpplintstamp"
        },
        {
            "sha": "8432296ed6f1fce468162ab6d16051f947250ca8",
            "filename": "tools/clang-format/package.json",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/0da144f4d48d7a423b8f61cd178bb41346083107/tools%2Fclang-format%2Fpackage.json",
            "raw_url": "https://github.com/nodejs/node/raw/0da144f4d48d7a423b8f61cd178bb41346083107/tools%2Fclang-format%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fclang-format%2Fpackage.json?ref=0da144f4d48d7a423b8f61cd178bb41346083107",
            "patch": "@@ -0,0 +1,9 @@\n+{\n+  \"name\": \"node-core-clang-format\",\n+  \"version\": \"1.0.0\",\n+  \"description\": \"Formatting C++ files for Node.js core\",\n+  \"license\": \"MIT\",\n+  \"dependencies\": {\n+    \"clang-format\": \"1.2.3\"\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 148,
        "additions": 148,
        "deletions": 0
    }
}