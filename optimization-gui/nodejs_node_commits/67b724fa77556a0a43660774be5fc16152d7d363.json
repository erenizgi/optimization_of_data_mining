{
    "author": "richardlau",
    "message": "test: refactor stdio handling in test-esm-cjs-main\n\nSet encoding on the stderr/stdout streams instead of calling\ndata.toString(). Don't assume the complete expected messages arrive in\na single event.\n\nPR-URL: https://github.com/nodejs/node/pull/25169\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>",
    "sha": "67b724fa77556a0a43660774be5fc16152d7d363",
    "files": [
        {
            "sha": "8308308a2dce721178774ab43299c35b6d6cdeea",
            "filename": "test/es-module/test-esm-cjs-main.js",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/67b724fa77556a0a43660774be5fc16152d7d363/test%2Fes-module%2Ftest-esm-cjs-main.js",
            "raw_url": "https://github.com/nodejs/node/raw/67b724fa77556a0a43660774be5fc16152d7d363/test%2Fes-module%2Ftest-esm-cjs-main.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fes-module%2Ftest-esm-cjs-main.js?ref=67b724fa77556a0a43660774be5fc16152d7d363",
            "patch": "@@ -8,21 +8,20 @@ const assert = require('assert');\n const entry = fixtures.path('/es-modules/cjs.js');\n \n const child = spawn(process.execPath, ['--experimental-modules', entry]);\n-let experimentalWarning = false;\n-let validatedExecution = false;\n+let stderr = '';\n+child.stderr.setEncoding('utf8');\n child.stderr.on('data', (data) => {\n-  if (!experimentalWarning) {\n-    experimentalWarning = true;\n-    return;\n-  }\n-  throw new Error(data.toString());\n+  stderr += data;\n });\n+let stdout = '';\n+child.stdout.setEncoding('utf8');\n child.stdout.on('data', (data) => {\n-  assert.strictEqual(data.toString(), 'executed\\n');\n-  validatedExecution = true;\n+  stdout += data;\n });\n child.on('close', common.mustCall((code, signal) => {\n-  assert.strictEqual(validatedExecution, true);\n   assert.strictEqual(code, 0);\n   assert.strictEqual(signal, null);\n+  assert.strictEqual(stdout, 'executed\\n');\n+  assert.strictEqual(stderr, `(node:${child.pid}) ` +\n+      'ExperimentalWarning: The ESM module loader is experimental.\\n');\n }));"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 9,
        "deletions": 10
    }
}