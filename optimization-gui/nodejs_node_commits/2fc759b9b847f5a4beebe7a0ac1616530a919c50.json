{
    "author": "chjj",
    "message": "worker: no throw on property access/postMessage after termination\n\nPR-URL: https://github.com/nodejs/node/pull/25871\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Yuta Hiroto <hello@hiroppy.me>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "2fc759b9b847f5a4beebe7a0ac1616530a919c50",
    "files": [
        {
            "sha": "6d833bcbd271fb6e3f2dff044d61cf4347d36114",
            "filename": "lib/internal/worker.js",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/2fc759b9b847f5a4beebe7a0ac1616530a919c50/lib%2Finternal%2Fworker.js",
            "raw_url": "https://github.com/nodejs/node/raw/2fc759b9b847f5a4beebe7a0ac1616530a919c50/lib%2Finternal%2Fworker.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fworker.js?ref=2fc759b9b847f5a4beebe7a0ac1616530a919c50",
            "patch": "@@ -184,6 +184,8 @@ class Worker extends EventEmitter {\n   }\n \n   postMessage(...args) {\n+    if (this[kPublicPort] === null) return;\n+\n     this[kPublicPort].postMessage(...args);\n   }\n \n@@ -219,14 +221,20 @@ class Worker extends EventEmitter {\n   }\n \n   get stdin() {\n+    if (this[kParentSideStdio] === null) return null;\n+\n     return this[kParentSideStdio].stdin;\n   }\n \n   get stdout() {\n+    if (this[kParentSideStdio] === null) return null;\n+\n     return this[kParentSideStdio].stdout;\n   }\n \n   get stderr() {\n+    if (this[kParentSideStdio] === null) return null;\n+\n     return this[kParentSideStdio].stderr;\n   }\n }"
        },
        {
            "sha": "23c8de7c7b0cfb199723f55b45328a898e585b29",
            "filename": "test/parallel/test-worker-safe-getters.js",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/2fc759b9b847f5a4beebe7a0ac1616530a919c50/test%2Fparallel%2Ftest-worker-safe-getters.js",
            "raw_url": "https://github.com/nodejs/node/raw/2fc759b9b847f5a4beebe7a0ac1616530a919c50/test%2Fparallel%2Ftest-worker-safe-getters.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-safe-getters.js?ref=2fc759b9b847f5a4beebe7a0ac1616530a919c50",
            "patch": "@@ -0,0 +1,38 @@\n+'use strict';\n+\n+const common = require('../common');\n+\n+const assert = require('assert');\n+const { Worker, isMainThread } = require('worker_threads');\n+\n+if (isMainThread) {\n+  const w = new Worker(__filename, {\n+    stdin: true,\n+    stdout: true,\n+    stderr: true\n+  });\n+\n+  w.on('exit', common.mustCall((code) => {\n+    assert.strictEqual(code, 0);\n+\n+    // `postMessage` should not throw after termination\n+    // (this mimics the browser behavior).\n+    w.postMessage('foobar');\n+    w.ref();\n+    w.unref();\n+\n+    // Although not browser specific, probably wise to\n+    // make sure the stream getters don't throw either.\n+    w.stdin;\n+    w.stdout;\n+    w.stderr;\n+\n+    // Sanity check.\n+    assert.strictEqual(w.threadId, -1);\n+    assert.strictEqual(w.stdin, null);\n+    assert.strictEqual(w.stdout, null);\n+    assert.strictEqual(w.stderr, null);\n+  }));\n+} else {\n+  process.exit(0);\n+}"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 46,
        "deletions": 0
    }
}