{
    "author": "BridgeAR",
    "message": "assert: fix EOL issue in messages on Windows\n\nPR-URL: https://github.com/nodejs/node/pull/20754\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "2c42999f7e0cfb4d79124add35e0b19b50100074",
    "files": [
        {
            "sha": "1471ba91c12a52b2874ba27822a454e0b1f8e1b9",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 10,
            "deletions": 7,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/2c42999f7e0cfb4d79124add35e0b19b50100074/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/2c42999f7e0cfb4d79124add35e0b19b50100074/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=2c42999f7e0cfb4d79124add35e0b19b50100074",
            "patch": "@@ -120,12 +120,12 @@ assert.fail = fail;\n assert.AssertionError = AssertionError;\n \n function getBuffer(fd, assertLine) {\n-  var lines = 0;\n+  let lines = 0;\n   // Prevent blocking the event loop by limiting the maximum amount of\n   // data that may be read.\n-  var maxReads = 64; // bytesPerRead * maxReads = 512 kb\n-  var bytesRead = 0;\n-  var startBuffer = 0; // Start reading from that char on\n+  let maxReads = 64; // bytesPerRead * maxReads = 512 kb\n+  let bytesRead = 0;\n+  let startBuffer = 0; // Start reading from that char on\n   const bytesPerRead = 8192;\n   const buffers = [];\n   do {\n@@ -168,7 +168,7 @@ function getErrMessage(call) {\n     return;\n   }\n \n-  var fd;\n+  let fd, message;\n   try {\n     fd = openSync(filename, 'r', 0o666);\n     const buffers = getBuffer(fd, line);\n@@ -187,11 +187,14 @@ function getErrMessage(call) {\n     // not user defined function names.\n       const ok = name === 'ok' ? '.ok' : '';\n       const args = node.arguments;\n-      var message = code\n+      message = code\n         .slice(args[0].start, args[args.length - 1].end)\n         .replace(escapeSequencesRegExp, escapeFn);\n+      if (EOL === '\\r\\n') {\n+        message = message.replace(/\\r\\n/g, '\\n');\n+      }\n       message = 'The expression evaluated to a falsy value:' +\n-        `${EOL}${EOL}  assert${ok}(${message})${EOL}`;\n+        `\\n\\n  assert${ok}(${message})\\n`;\n     }\n     // Make sure to always set the cache! No matter if the message is\n     // undefined or not"
        },
        {
            "sha": "b731b9a73ea207e9246b689634d8bc2d95dcdece",
            "filename": "test/parallel/test-assert.js",
            "status": "modified",
            "additions": 18,
            "deletions": 19,
            "changes": 37,
            "blob_url": "https://github.com/nodejs/node/blob/2c42999f7e0cfb4d79124add35e0b19b50100074/test%2Fparallel%2Ftest-assert.js",
            "raw_url": "https://github.com/nodejs/node/raw/2c42999f7e0cfb4d79124add35e0b19b50100074/test%2Fparallel%2Ftest-assert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert.js?ref=2c42999f7e0cfb4d79124add35e0b19b50100074",
            "patch": "@@ -27,7 +27,6 @@\n \n const common = require('../common');\n const assert = require('assert');\n-const { EOL } = require('os');\n const EventEmitter = require('events');\n const { errorCache } = require('internal/assert');\n const { writeFileSync, unlinkSync } = require('fs');\n@@ -462,8 +461,8 @@ assert.throws(\n     {\n       code: 'ERR_ASSERTION',\n       type: assert.AssertionError,\n-      message: `The expression evaluated to a falsy value:${EOL}${EOL}  ` +\n-               `assert.ok(typeof 123 === 'string')${EOL}`\n+      message: 'The expression evaluated to a falsy value:\\n\\n  ' +\n+               \"assert.ok(typeof 123 === 'string')\\n\"\n     }\n   );\n   Error.stackTraceLimit = tmpLimit;\n@@ -625,8 +624,8 @@ common.expectsError(\n     code: 'ERR_ASSERTION',\n     type: assert.AssertionError,\n     generatedMessage: true,\n-    message: `The expression evaluated to a falsy value:${EOL}${EOL}  ` +\n-             `assert.ok(null)${EOL}`\n+    message: 'The expression evaluated to a falsy value:\\n\\n  ' +\n+             'assert.ok(null)\\n'\n   }\n );\n common.expectsError(\n@@ -635,8 +634,8 @@ common.expectsError(\n     code: 'ERR_ASSERTION',\n     type: assert.AssertionError,\n     generatedMessage: true,\n-    message: `The expression evaluated to a falsy value:${EOL}${EOL}  ` +\n-             `assert(typeof 123 === 'string')${EOL}`\n+    message: 'The expression evaluated to a falsy value:\\n\\n  ' +\n+             \"assert(typeof 123 === 'string')\\n\"\n   }\n );\n \n@@ -666,17 +665,17 @@ common.expectsError(\n     {\n       code: 'ERR_ASSERTION',\n       type: assert.AssertionError,\n-      message: `The expression evaluated to a falsy value:${EOL}${EOL}  ` +\n-               `assert(Buffer.from('test') instanceof Error)${EOL}`\n+      message: 'The expression evaluated to a falsy value:\\n\\n  ' +\n+               \"assert(Buffer.from('test') instanceof Error)\\n\"\n     }\n   );\n   common.expectsError(\n     () => throwErr(),\n     {\n       code: 'ERR_ASSERTION',\n       type: assert.AssertionError,\n-      message: `The expression evaluated to a falsy value:${EOL}${EOL}  ` +\n-               `assert(Buffer.from('test') instanceof Error)${EOL}`\n+      message: 'The expression evaluated to a falsy value:\\n\\n  ' +\n+               \"assert(Buffer.from('test') instanceof Error)\\n\"\n     }\n   );\n   fs.close = tmp;\n@@ -695,12 +694,12 @@ common.expectsError(\n   {\n     code: 'ERR_ASSERTION',\n     type: assert.AssertionError,\n-    message: `The expression evaluated to a falsy value:${EOL}${EOL}  ` +\n-             `assert((() => 'string')()${EOL}` +\n-             `      // eslint-disable-next-line${EOL}` +\n-             `      ===${EOL}` +\n-             `      123 instanceof${EOL}` +\n-             `          Buffer)${EOL}`\n+    message: 'The expression evaluated to a falsy value:\\n\\n  ' +\n+             \"assert((() => 'string')()\\n\" +\n+             '      // eslint-disable-next-line\\n' +\n+             '      ===\\n' +\n+             '      123 instanceof\\n' +\n+             '          Buffer)\\n'\n   }\n );\n \n@@ -709,8 +708,8 @@ common.expectsError(\n   {\n     code: 'ERR_ASSERTION',\n     type: assert.AssertionError,\n-    message: `The expression evaluated to a falsy value:${EOL}${EOL}  ` +\n-             `assert(null, undefined)${EOL}`\n+    message: 'The expression evaluated to a falsy value:\\n\\n  ' +\n+             'assert(null, undefined)\\n'\n   }\n );\n "
        }
    ],
    "stats": {
        "total": 54,
        "additions": 28,
        "deletions": 26
    }
}