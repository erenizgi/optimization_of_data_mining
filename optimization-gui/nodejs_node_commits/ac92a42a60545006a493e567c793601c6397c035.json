{
    "author": "jasnell",
    "message": "http2: avoid race condition in OnHeaderCallback\n\nFixes: https://github.com/nodejs/node/issues/21416\n\nPR-URL: https://github.com/nodejs/node/pull/22256\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: George Adams <george.adams@uk.ibm.com>",
    "sha": "ac92a42a60545006a493e567c793601c6397c035",
    "files": [
        {
            "sha": "12b0156f4a2e70cbf85bcd03eeb78ab37853fc57",
            "filename": "src/node_http2.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/ac92a42a60545006a493e567c793601c6397c035/src%2Fnode_http2.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ac92a42a60545006a493e567c793601c6397c035/src%2Fnode_http2.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http2.cc?ref=ac92a42a60545006a493e567c793601c6397c035",
            "patch": "@@ -881,7 +881,12 @@ int Http2Session::OnHeaderCallback(nghttp2_session* handle,\n   Http2Session* session = static_cast<Http2Session*>(user_data);\n   int32_t id = GetFrameID(frame);\n   Http2Stream* stream = session->FindStream(id);\n-  CHECK_NOT_NULL(stream);\n+  // If stream is null at this point, either something odd has happened\n+  // or the stream was closed locally while header processing was occurring.\n+  // either way, do not proceed and close the stream.\n+  if (stream == nullptr)\n+    return NGHTTP2_ERR_TEMPORAL_CALLBACK_FAILURE;\n+\n   // If the stream has already been destroyed, ignore.\n   if (!stream->IsDestroyed() && !stream->AddHeader(name, value, flags)) {\n     // This will only happen if the connected peer sends us more"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
    }
}