{
    "author": "sam-github",
    "message": "tls: add code for ERR_TLS_INVALID_PROTOCOL_METHOD\n\nAdd an error code property to invalid `secureProtocol` method\nexceptions.\n\nPR-URL: https://github.com/nodejs/node/pull/24729\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "b05b330025b9d69baa82812774be92b1be4a318c",
    "files": [
        {
            "sha": "3b4ea6156f36dd4d79fffa5f6883d999e764503b",
            "filename": "doc/api/errors.md",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/b05b330025b9d69baa82812774be92b1be4a318c/doc%2Fapi%2Ferrors.md",
            "raw_url": "https://github.com/nodejs/node/raw/b05b330025b9d69baa82812774be92b1be4a318c/doc%2Fapi%2Ferrors.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ferrors.md?ref=b05b330025b9d69baa82812774be92b1be4a318c",
            "patch": "@@ -1655,6 +1655,12 @@ recommended to use 2048 bits or larger for stronger security.\n A TLS/SSL handshake timed out. In this case, the server must also abort the\n connection.\n \n+<a id=\"ERR_TLS_INVALID_PROTOCOL_METHOD\"></a>\n+### ERR_TLS_INVALID_PROTOCOL_METHOD\n+\n+The specified  `secureProtocol` method is invalid. It is  either unknown, or\n+disabled because it is insecure.\n+\n <a id=\"ERR_TLS_INVALID_PROTOCOL_VERSION\"></a>\n ### ERR_TLS_INVALID_PROTOCOL_VERSION\n "
        },
        {
            "sha": "4e1a3f9405f3196f87f1307cdd7cf8e591f1c493",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/b05b330025b9d69baa82812774be92b1be4a318c/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b05b330025b9d69baa82812774be92b1be4a318c/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=b05b330025b9d69baa82812774be92b1be4a318c",
            "patch": "@@ -63,6 +63,8 @@ v8::MaybeLocal<v8::Object> New(Environment* env, unsigned char* udata,\n \n namespace crypto {\n \n+using node::THROW_ERR_TLS_INVALID_PROTOCOL_METHOD;\n+\n using v8::Array;\n using v8::Boolean;\n using v8::ConstructorBehavior;\n@@ -421,17 +423,23 @@ void SecureContext::Init(const FunctionCallbackInfo<Value>& args) {\n     // protocols are supported unless explicitly disabled (which we do below\n     // for SSLv2 and SSLv3.)\n     if (strcmp(*sslmethod, \"SSLv2_method\") == 0) {\n-      return env->ThrowError(\"SSLv2 methods disabled\");\n+      THROW_ERR_TLS_INVALID_PROTOCOL_METHOD(env, \"SSLv2 methods disabled\");\n+      return;\n     } else if (strcmp(*sslmethod, \"SSLv2_server_method\") == 0) {\n-      return env->ThrowError(\"SSLv2 methods disabled\");\n+      THROW_ERR_TLS_INVALID_PROTOCOL_METHOD(env, \"SSLv2 methods disabled\");\n+      return;\n     } else if (strcmp(*sslmethod, \"SSLv2_client_method\") == 0) {\n-      return env->ThrowError(\"SSLv2 methods disabled\");\n+      THROW_ERR_TLS_INVALID_PROTOCOL_METHOD(env, \"SSLv2 methods disabled\");\n+      return;\n     } else if (strcmp(*sslmethod, \"SSLv3_method\") == 0) {\n-      return env->ThrowError(\"SSLv3 methods disabled\");\n+      THROW_ERR_TLS_INVALID_PROTOCOL_METHOD(env, \"SSLv3 methods disabled\");\n+      return;\n     } else if (strcmp(*sslmethod, \"SSLv3_server_method\") == 0) {\n-      return env->ThrowError(\"SSLv3 methods disabled\");\n+      THROW_ERR_TLS_INVALID_PROTOCOL_METHOD(env, \"SSLv3 methods disabled\");\n+      return;\n     } else if (strcmp(*sslmethod, \"SSLv3_client_method\") == 0) {\n-      return env->ThrowError(\"SSLv3 methods disabled\");\n+      THROW_ERR_TLS_INVALID_PROTOCOL_METHOD(env, \"SSLv3 methods disabled\");\n+      return;\n     } else if (strcmp(*sslmethod, \"SSLv23_method\") == 0) {\n       // noop\n     } else if (strcmp(*sslmethod, \"SSLv23_server_method\") == 0) {\n@@ -483,7 +491,8 @@ void SecureContext::Init(const FunctionCallbackInfo<Value>& args) {\n       max_version = TLS1_2_VERSION;\n       method = TLS_client_method();\n     } else {\n-      return env->ThrowError(\"Unknown method\");\n+      THROW_ERR_TLS_INVALID_PROTOCOL_METHOD(env, \"Unknown method\");\n+      return;\n     }\n   }\n "
        },
        {
            "sha": "44dc1d8094f25440ac2e391d3102f5d424c08f47",
            "filename": "src/node_errors.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/b05b330025b9d69baa82812774be92b1be4a318c/src%2Fnode_errors.h",
            "raw_url": "https://github.com/nodejs/node/raw/b05b330025b9d69baa82812774be92b1be4a318c/src%2Fnode_errors.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_errors.h?ref=b05b330025b9d69baa82812774be92b1be4a318c",
            "patch": "@@ -71,6 +71,7 @@ void FatalException(const v8::FunctionCallbackInfo<v8::Value>& args);\n   V(ERR_SCRIPT_EXECUTION_INTERRUPTED, Error)                                 \\\n   V(ERR_SCRIPT_EXECUTION_TIMEOUT, Error)                                     \\\n   V(ERR_STRING_TOO_LONG, Error)                                              \\\n+  V(ERR_TLS_INVALID_PROTOCOL_METHOD, TypeError)                              \\\n   V(ERR_TRANSFERRING_EXTERNALIZED_SHAREDARRAYBUFFER, TypeError)              \\\n \n #define V(code, type)                                                         \\"
        },
        {
            "sha": "a8367a3fe588156059fbac4c48001b6fe6c613d1",
            "filename": "test/parallel/test-tls-min-max-version.js",
            "status": "modified",
            "additions": 16,
            "deletions": 12,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/b05b330025b9d69baa82812774be92b1be4a318c/test%2Fparallel%2Ftest-tls-min-max-version.js",
            "raw_url": "https://github.com/nodejs/node/raw/b05b330025b9d69baa82812774be92b1be4a318c/test%2Fparallel%2Ftest-tls-min-max-version.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-min-max-version.js?ref=b05b330025b9d69baa82812774be92b1be4a318c",
            "patch": "@@ -26,8 +26,8 @@ function test(cmin, cmax, cprot, smin, smax, sprot, expect) {\n       secureProtocol: sprot,\n     },\n   }, common.mustCall((err, pair, cleanup) => {\n-    if (expect && !expect.match(/^TLS/)) {\n-      assert(err.message.match(expect));\n+    if (expect && expect.match(/^ERR/)) {\n+      assert.strictEqual(err.code, expect);\n       return cleanup();\n     }\n \n@@ -53,18 +53,22 @@ const U = undefined;\n test(U, U, U, U, U, U, 'TLSv1.2');\n \n // Insecure or invalid protocols cannot be enabled.\n-test(U, U, U, U, U, 'SSLv2_method', 'SSLv2 methods disabled');\n-test(U, U, U, U, U, 'SSLv3_method', 'SSLv3 methods disabled');\n-test(U, U, 'SSLv2_method', U, U, U, 'SSLv2 methods disabled');\n-test(U, U, 'SSLv3_method', U, U, U, 'SSLv3 methods disabled');\n-test(U, U, 'hokey-pokey', U, U, U, 'Unknown method');\n-test(U, U, U, U, U, 'hokey-pokey', 'Unknown method');\n+test(U, U, U, U, U, 'SSLv2_method', 'ERR_TLS_INVALID_PROTOCOL_METHOD');\n+test(U, U, U, U, U, 'SSLv3_method', 'ERR_TLS_INVALID_PROTOCOL_METHOD');\n+test(U, U, 'SSLv2_method', U, U, U, 'ERR_TLS_INVALID_PROTOCOL_METHOD');\n+test(U, U, 'SSLv3_method', U, U, U, 'ERR_TLS_INVALID_PROTOCOL_METHOD');\n+test(U, U, 'hokey-pokey', U, U, U, 'ERR_TLS_INVALID_PROTOCOL_METHOD');\n+test(U, U, U, U, U, 'hokey-pokey', 'ERR_TLS_INVALID_PROTOCOL_METHOD');\n \n // Cannot use secureProtocol and min/max versions simultaneously.\n-test(U, U, U, U, 'TLSv1.2', 'TLS1_2_method', 'conflicts with secureProtocol');\n-test(U, U, U, 'TLSv1.2', U, 'TLS1_2_method', 'conflicts with secureProtocol');\n-test(U, 'TLSv1.2', 'TLS1_2_method', U, U, U, 'conflicts with secureProtocol');\n-test('TLSv1.2', U, 'TLS1_2_method', U, U, U, 'conflicts with secureProtocol');\n+test(U, U, U, U, 'TLSv1.2', 'TLS1_2_method',\n+     'ERR_TLS_PROTOCOL_VERSION_CONFLICT');\n+test(U, U, U, 'TLSv1.2', U, 'TLS1_2_method',\n+     'ERR_TLS_PROTOCOL_VERSION_CONFLICT');\n+test(U, 'TLSv1.2', 'TLS1_2_method', U, U, U,\n+     'ERR_TLS_PROTOCOL_VERSION_CONFLICT');\n+test('TLSv1.2', U, 'TLS1_2_method', U, U, U,\n+     'ERR_TLS_PROTOCOL_VERSION_CONFLICT');\n \n // TLS_method means \"any supported protocol\".\n test(U, U, 'TLSv1_2_method', U, U, 'TLS_method', 'TLSv1.2');"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 39,
        "deletions": 19
    }
}