{
    "author": "bzoz",
    "message": "build, win: vcbuild improvements\n\nRemoves extra erroor messages when Python is not installed. Removes\n\"vswhere not found\" message when no VS2017 installation is found.\nAdds support for DEBUG_HELPER to vcbuild.bat.\n\nFixes: https://github.com/nodejs/node/issues/16864\n\nPR-URL: https://github.com/nodejs/node/pull/17015\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Gibson Fahnestock <gibfahn@gmail.com>",
    "sha": "887a2ba92eec98ddf1e0953e742419236eff75d7",
    "files": [
        {
            "sha": "212b5275c318ae8224c108dd7b7a329119222115",
            "filename": "tools/msvs/find_python.cmd",
            "status": "modified",
            "additions": 14,
            "deletions": 6,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/887a2ba92eec98ddf1e0953e742419236eff75d7/tools%2Fmsvs%2Ffind_python.cmd",
            "raw_url": "https://github.com/nodejs/node/raw/887a2ba92eec98ddf1e0953e742419236eff75d7/tools%2Fmsvs%2Ffind_python.cmd",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmsvs%2Ffind_python.cmd?ref=887a2ba92eec98ddf1e0953e742419236eff75d7",
            "patch": "@@ -1,4 +1,5 @@\n @IF NOT DEFINED DEBUG_HELPER @ECHO OFF\n+echo Looking for Python 2.x\n SETLOCAL\n :: If python.exe is in %Path%, just validate\n FOR /F \"delims=\" %%a IN ('where python 2^> NUL') DO (\n@@ -14,18 +15,18 @@ FOR %%K IN ( \"HKCU\\Software\", \"HKLM\\SOFTWARE\", \"HKLM\\Software\\Wow6432Node\") DO (\n   :: If validate returns 0 just jump to the end\n   IF NOT ERRORLEVEL 1 GOTO :validate\n )\n-EXIT /B 1\n+goto :no-python\n \n :: Helper subroutine to handle quotes in %1\n :find-main-branch\n SET main_key=\"%~1\\Python\\PythonCore\"\n-REG QUERY %main_key% /s | findstr \"2.\" | findstr InstallPath > NUL 2> NUL\n+REG QUERY %main_key% /s 2> NUL | findstr \"2.\" | findstr InstallPath > NUL 2> NUL\n IF NOT ERRORLEVEL 1 CALL :find-key %main_key%\n EXIT /B\n \n :: Query registry sub-tree for InstallPath\n :find-key\n-FOR /F \"delims=\" %%a IN ('REG QUERY %1 /s  ^| findstr \"2.\" ^| findstr InstallPath') DO IF NOT ERRORLEVEL 1 CALL :find-path %%a\n+FOR /F \"delims=\" %%a IN ('REG QUERY %1 /s 2> NUL ^| findstr \"2.\" ^| findstr InstallPath') DO IF NOT ERRORLEVEL 1 CALL :find-path %%a\n EXIT /B\n \n :: Parse the value of %1 as the path for python.exe\n@@ -39,13 +40,20 @@ EXIT /B 1\n \n :: Check if %p% holds a path to a real python2 executable\n :validate\n-IF NOT EXIST \"%p%python.exe\" EXIT /B 1\n+IF NOT EXIST \"%p%python.exe\" goto :no-python\n :: Check if %p% is python2\n \"%p%python.exe\" -V 2>&1 | findstr /R \"^Python.2.*\" > NUL\n-IF ERRORLEVEL 1 EXIT /B %ERRORLEVEL%\n+IF ERRORLEVEL 1 goto :no-python2\n :: We can wrap it up\n ENDLOCAL & SET pt=%p%& SET need_path_ext=%need_path%\n SET VCBUILD_PYTHON_LOCATION=%pt%python.exe\n IF %need_path_ext%==1 SET Path=%Path%;%pt%\n SET need_path_ext=\n-EXIT /B %ERRORLEVEL%\n\\ No newline at end of file\n+EXIT /B %ERRORLEVEL%\n+\n+:no-python2\n+echo Python found in %p%, but it is not v2.x.\n+exit /B 1\n+:no-python\n+echo Could not find Python.\n+exit /B 1"
        },
        {
            "sha": "4a159baabc0bfb588c513532da937583afe1e469",
            "filename": "tools/msvs/vswhere_usability_wrapper.cmd",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/887a2ba92eec98ddf1e0953e742419236eff75d7/tools%2Fmsvs%2Fvswhere_usability_wrapper.cmd",
            "raw_url": "https://github.com/nodejs/node/raw/887a2ba92eec98ddf1e0953e742419236eff75d7/tools%2Fmsvs%2Fvswhere_usability_wrapper.cmd",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmsvs%2Fvswhere_usability_wrapper.cmd?ref=887a2ba92eec98ddf1e0953e742419236eff75d7",
            "patch": "@@ -28,5 +28,4 @@ for /f \"usebackq tokens=*\" %%i in (`vswhere %VSWHERE_ARGS%`) do (\n \n :no-vswhere\n endlocal\n-echo could not find \"vswhere\"\n exit /B 1"
        },
        {
            "sha": "a66449283192c36c632824db6132a24b7d322a81",
            "filename": "vcbuild.bat",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/887a2ba92eec98ddf1e0953e742419236eff75d7/vcbuild.bat",
            "raw_url": "https://github.com/nodejs/node/raw/887a2ba92eec98ddf1e0953e742419236eff75d7/vcbuild.bat",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/vcbuild.bat?ref=887a2ba92eec98ddf1e0953e742419236eff75d7",
            "patch": "@@ -1,4 +1,4 @@\n-@echo off\n+@if not defined DEBUG_HELPER @ECHO OFF\n \n cd %~dp0\n \n@@ -166,7 +166,7 @@ if \"%target%\"==\"Clean\" rmdir /S /Q %~dp0deps\\icu\n :no-depsicu\n \n call tools\\msvs\\find_python.cmd\n-if errorlevel 1 echo Could not find python2 & goto :exit\n+if errorlevel 1 goto :exit\n \n call :getnodeversion || exit /b 1\n "
        }
    ],
    "stats": {
        "total": 25,
        "additions": 16,
        "deletions": 9
    }
}