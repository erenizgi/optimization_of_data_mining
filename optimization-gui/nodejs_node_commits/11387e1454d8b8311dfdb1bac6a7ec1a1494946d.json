{
    "author": "unknown",
    "message": "n-api: mark thread-safe function as stable\n\nFixes: https://github.com/nodejs/node/issues/24249\nPR-URL: https://github.com/nodejs/node/pull/25556\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>",
    "sha": "11387e1454d8b8311dfdb1bac6a7ec1a1494946d",
    "files": [
        {
            "sha": "2b061167f6cf4c4ec27dff9473e2dbd3f3633389",
            "filename": "doc/api/n-api.md",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/doc%2Fapi%2Fn-api.md",
            "raw_url": "https://github.com/nodejs/node/raw/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/doc%2Fapi%2Fn-api.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fn-api.md?ref=11387e1454d8b8311dfdb1bac6a7ec1a1494946d",
            "patch": "@@ -282,15 +282,15 @@ This is an opaque pointer that is used to represent a JavaScript value.\n \n ### napi_threadsafe_function\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n This is an opaque pointer that represents a JavaScript function which can be\n called asynchronously from multiple threads via\n `napi_call_threadsafe_function()`.\n \n ### napi_threadsafe_function_release_mode\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n A value to be given to `napi_release_threadsafe_function()` to indicate whether\n the thread-safe function is to be closed immediately (`napi_tsfn_abort`) or\n@@ -305,7 +305,7 @@ typedef enum {\n \n ### napi_threadsafe_function_call_mode\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n A value to be given to `napi_call_threadsafe_function()` to indicate whether\n the call should block whenever the queue associated with the thread-safe\n@@ -400,7 +400,7 @@ typedef void (*napi_async_complete_callback)(napi_env env,\n \n #### napi_threadsafe_function_call_js\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n Function pointer used with asynchronous thread-safe function calls. The callback\n will be called on the main thread. Its purpose is to use a data item arriving\n@@ -4526,7 +4526,7 @@ prevent the event loop from exiting. The APIs `napi_ref_threadsafe_function` and\n \n ### napi_create_threadsafe_function\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n <!-- YAML\n added: v10.6.0\n@@ -4569,7 +4569,7 @@ parameters and with `undefined` as its `this` value.\n \n ### napi_get_threadsafe_function_context\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n <!-- YAML\n added: v10.6.0\n@@ -4587,7 +4587,7 @@ This API may be called from any thread which makes use of `func`.\n \n ### napi_call_threadsafe_function\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n <!-- YAML\n added: v10.6.0\n@@ -4615,7 +4615,7 @@ This API may be called from any thread which makes use of `func`.\n \n ### napi_acquire_threadsafe_function\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n <!-- YAML\n added: v10.6.0\n@@ -4637,7 +4637,7 @@ This API may be called from any thread which will start making use of `func`.\n \n ### napi_release_threadsafe_function\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n <!-- YAML\n added: v10.6.0\n@@ -4665,7 +4665,7 @@ This API may be called from any thread which will stop making use of `func`.\n \n ### napi_ref_threadsafe_function\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n <!-- YAML\n added: v10.6.0\n@@ -4686,7 +4686,7 @@ This API may only be called from the main thread.\n \n ### napi_unref_threadsafe_function\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n <!-- YAML\n added: v10.6.0"
        },
        {
            "sha": "acb7316d2d2972c515a57e7c9db57936d4e724d3",
            "filename": "src/js_native_api.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/src%2Fjs_native_api.h",
            "raw_url": "https://github.com/nodejs/node/raw/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/src%2Fjs_native_api.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fjs_native_api.h?ref=11387e1454d8b8311dfdb1bac6a7ec1a1494946d",
            "patch": "@@ -12,7 +12,7 @@\n #define NAPI_VERSION NAPI_VERSION_EXPERIMENTAL\n #else\n // The baseline version for N-API\n-#define NAPI_VERSION 3\n+#define NAPI_VERSION 4\n #endif\n #endif\n "
        },
        {
            "sha": "a37ee06ce16a708ea0ed83ec621f62d256cf763f",
            "filename": "src/node_api.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/src%2Fnode_api.h",
            "raw_url": "https://github.com/nodejs/node/raw/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/src%2Fnode_api.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_api.h?ref=11387e1454d8b8311dfdb1bac6a7ec1a1494946d",
            "patch": "@@ -192,7 +192,7 @@ NAPI_EXTERN napi_status napi_close_callback_scope(napi_env env,\n \n #endif  // NAPI_VERSION >= 3\n \n-#ifdef NAPI_EXPERIMENTAL\n+#if NAPI_VERSION >= 4\n \n // Calling into JS from other threads\n NAPI_EXTERN napi_status\n@@ -230,7 +230,7 @@ napi_unref_threadsafe_function(napi_env env, napi_threadsafe_function func);\n NAPI_EXTERN napi_status\n napi_ref_threadsafe_function(napi_env env, napi_threadsafe_function func);\n \n-#endif  // NAPI_EXPERIMENTAL\n+#endif  // NAPI_VERSION >= 4\n \n EXTERN_C_END\n "
        },
        {
            "sha": "d740bb935839d950ea234be5ec700157029f2775",
            "filename": "src/node_api_types.h",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/src%2Fnode_api_types.h",
            "raw_url": "https://github.com/nodejs/node/raw/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/src%2Fnode_api_types.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_api_types.h?ref=11387e1454d8b8311dfdb1bac6a7ec1a1494946d",
            "patch": "@@ -6,11 +6,11 @@\n typedef struct napi_callback_scope__* napi_callback_scope;\n typedef struct napi_async_context__* napi_async_context;\n typedef struct napi_async_work__* napi_async_work;\n-#ifdef NAPI_EXPERIMENTAL\n+#if NAPI_VERSION >= 4\n typedef struct napi_threadsafe_function__* napi_threadsafe_function;\n-#endif  // NAPI_EXPERIMENTAL\n+#endif  // NAPI_VERSION >= 4\n \n-#ifdef NAPI_EXPERIMENTAL\n+#ifdef NAPI_VERSION >= 4\n typedef enum {\n   napi_tsfn_release,\n   napi_tsfn_abort\n@@ -20,19 +20,19 @@ typedef enum {\n   napi_tsfn_nonblocking,\n   napi_tsfn_blocking\n } napi_threadsafe_function_call_mode;\n-#endif  // NAPI_EXPERIMENTAL\n+#endif  // NAPI_VERSION >= 4\n \n typedef void (*napi_async_execute_callback)(napi_env env,\n                                             void* data);\n typedef void (*napi_async_complete_callback)(napi_env env,\n                                              napi_status status,\n                                              void* data);\n-#ifdef NAPI_EXPERIMENTAL\n+#ifdef NAPI_VERSION >= 4\n typedef void (*napi_threadsafe_function_call_js)(napi_env env,\n                                                  napi_value js_callback,\n                                                  void* context,\n                                                  void* data);\n-#endif  // NAPI_EXPERIMENTAL\n+#endif  // NAPI_VERSION >= 4\n \n typedef struct {\n   uint32_t major;"
        },
        {
            "sha": "f64aa2aad773344ed31407fd3c5f60ae8d77a708",
            "filename": "src/node_version.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/src%2Fnode_version.h",
            "raw_url": "https://github.com/nodejs/node/raw/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/src%2Fnode_version.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_version.h?ref=11387e1454d8b8311dfdb1bac6a7ec1a1494946d",
            "patch": "@@ -118,6 +118,6 @@\n #define NODE_MODULE_VERSION 68\n \n // the NAPI_VERSION provided by this version of the runtime\n-#define NAPI_VERSION  3\n+#define NAPI_VERSION  4\n \n #endif  // SRC_NODE_VERSION_H_"
        },
        {
            "sha": "720918f9645d992b59c71b875618c1a9423802a1",
            "filename": "test/js-native-api/test_general/test.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/test%2Fjs-native-api%2Ftest_general%2Ftest.js",
            "raw_url": "https://github.com/nodejs/node/raw/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/test%2Fjs-native-api%2Ftest_general%2Ftest.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fjs-native-api%2Ftest_general%2Ftest.js?ref=11387e1454d8b8311dfdb1bac6a7ec1a1494946d",
            "patch": "@@ -33,8 +33,8 @@ assert.notStrictEqual(test_general.testGetPrototype(baseObject),\n                       test_general.testGetPrototype(extendedObject));\n \n // test version management functions\n-// expected version is currently 3\n-assert.strictEqual(test_general.testGetVersion(), 3);\n+// expected version is currently 4\n+assert.strictEqual(test_general.testGetVersion(), 4);\n \n [\n   123,"
        },
        {
            "sha": "c556c9427cc1769e154b840dc70d22ec210ba013",
            "filename": "test/node-api/test_threadsafe_function/binding.c",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/test%2Fnode-api%2Ftest_threadsafe_function%2Fbinding.c",
            "raw_url": "https://github.com/nodejs/node/raw/11387e1454d8b8311dfdb1bac6a7ec1a1494946d/test%2Fnode-api%2Ftest_threadsafe_function%2Fbinding.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fnode-api%2Ftest_threadsafe_function%2Fbinding.c?ref=11387e1454d8b8311dfdb1bac6a7ec1a1494946d",
            "patch": "@@ -4,7 +4,6 @@\n // which, in turn, may affect the ABI stability of the project despite its use\n // of N-API.\n #include <uv.h>\n-#define NAPI_EXPERIMENTAL\n #include <node_api.h>\n #include \"../../js-native-api/common.h\"\n "
        }
    ],
    "stats": {
        "total": 47,
        "additions": 23,
        "deletions": 24
    }
}