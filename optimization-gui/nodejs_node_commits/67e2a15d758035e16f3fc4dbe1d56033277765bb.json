{
    "author": "santigimeno",
    "message": "net: honor default values in Socket constructor\n\nSpecifically `readable` and `writable` that default to `false`.\n\nPR-URL: https://github.com/nodejs/node/pull/19971\nFixes: https://github.com/libuv/libuv/issues/1794\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>",
    "sha": "67e2a15d758035e16f3fc4dbe1d56033277765bb",
    "files": [
        {
            "sha": "8cca1c2f6b044374495355524987b6cd186787c9",
            "filename": "lib/internal/child_process.js",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/67e2a15d758035e16f3fc4dbe1d56033277765bb/lib%2Finternal%2Fchild_process.js",
            "raw_url": "https://github.com/nodejs/node/raw/67e2a15d758035e16f3fc4dbe1d56033277765bb/lib%2Finternal%2Fchild_process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fchild_process.js?ref=67e2a15d758035e16f3fc4dbe1d56033277765bb",
            "patch": "@@ -131,8 +131,11 @@ const handleConversion = {\n     },\n \n     got: function(message, handle, emit) {\n-      var socket = new net.Socket({ handle: handle });\n-      socket.readable = socket.writable = true;\n+      var socket = new net.Socket({\n+        handle: handle,\n+        readable: true,\n+        writable: true\n+      });\n \n       // if the socket was created by net.Server we will track the socket\n       if (message.key) {"
        },
        {
            "sha": "ec966028a024f77d061d0c9d4afd2525cac9c45f",
            "filename": "lib/internal/wrap_js_stream.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/67e2a15d758035e16f3fc4dbe1d56033277765bb/lib%2Finternal%2Fwrap_js_stream.js",
            "raw_url": "https://github.com/nodejs/node/raw/67e2a15d758035e16f3fc4dbe1d56033277765bb/lib%2Finternal%2Fwrap_js_stream.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fwrap_js_stream.js?ref=67e2a15d758035e16f3fc4dbe1d56033277765bb",
            "patch": "@@ -72,6 +72,8 @@ class JSStreamWrap extends Socket {\n     this.stream = stream;\n     this[kCurrentWriteRequest] = null;\n     this[kCurrentShutdownRequest] = null;\n+    this.readable = stream.readable;\n+    this.writable = stream.writable;\n \n     // Start reading.\n     this.read(0);"
        },
        {
            "sha": "6c475619117dc5214b9bf8f9cb98aa5c7b417ef3",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/67e2a15d758035e16f3fc4dbe1d56033277765bb/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/67e2a15d758035e16f3fc4dbe1d56033277765bb/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=67e2a15d758035e16f3fc4dbe1d56033277765bb",
            "patch": "@@ -244,6 +244,8 @@ function Socket(options) {\n   else\n     options = util._extend({}, options);\n \n+  options.readable = options.readable || false;\n+  options.writable = options.writable || false;\n   const allowHalfOpen = options.allowHalfOpen;\n \n   // Prevent the \"no-half-open enforcer\" from being inherited from `Duplex`.\n@@ -283,9 +285,6 @@ function Socket(options) {\n         value: 0, writable: true\n       });\n     }\n-  } else {\n-    // these will be set once there is a connection\n-    this.readable = this.writable = false;\n   }\n \n   // shut down the socket when we're finished with it.\n@@ -1537,10 +1536,10 @@ function onconnection(err, clientHandle) {\n   var socket = new Socket({\n     handle: clientHandle,\n     allowHalfOpen: self.allowHalfOpen,\n-    pauseOnCreate: self.pauseOnConnect\n+    pauseOnCreate: self.pauseOnConnect,\n+    readable: true,\n+    writable: true\n   });\n-  socket.readable = socket.writable = true;\n-\n \n   self._connections++;\n   socket.server = self;"
        },
        {
            "sha": "6758e286fb1be3e2c5de30d1e8aa200cbdad3f96",
            "filename": "test/parallel/test-net-socket-constructor.js",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/67e2a15d758035e16f3fc4dbe1d56033277765bb/test%2Fparallel%2Ftest-net-socket-constructor.js",
            "raw_url": "https://github.com/nodejs/node/raw/67e2a15d758035e16f3fc4dbe1d56033277765bb/test%2Fparallel%2Ftest-net-socket-constructor.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-net-socket-constructor.js?ref=67e2a15d758035e16f3fc4dbe1d56033277765bb",
            "patch": "@@ -0,0 +1,43 @@\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+const net = require('net');\n+\n+function test(sock, readable, writable) {\n+  let socket;\n+  if (sock instanceof net.Socket) {\n+    socket = sock;\n+  } else {\n+    socket = new net.Socket(sock);\n+    socket.unref();\n+  }\n+\n+  assert.strictEqual(socket.readable, readable);\n+  assert.strictEqual(socket.writable, writable);\n+}\n+\n+test(undefined, false, false);\n+\n+const server = net.createServer(common.mustCall((socket) => {\n+  test(socket, true, true);\n+  test({ handle: socket._handle }, false, false);\n+  test({ handle: socket._handle, readable: true, writable: true }, true, true);\n+  if (socket._handle.fd >= 0) {\n+    test(socket._handle.fd, false, false);\n+    test({ fd: socket._handle.fd }, false, false);\n+    test({ fd: socket._handle.fd, readable: true, writable: true }, true, true);\n+  }\n+\n+  server.close();\n+}));\n+\n+server.listen(common.mustCall(() => {\n+  const { port } = server.address();\n+  const socket = net.connect(port, common.mustCall(() => {\n+    test(socket, true, true);\n+    socket.end();\n+  }));\n+\n+  test(socket, false, true);\n+}));"
        }
    ],
    "stats": {
        "total": 63,
        "additions": 55,
        "deletions": 8
    }
}