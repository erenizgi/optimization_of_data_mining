{
    "author": "Trott",
    "message": "test: improve performance of test-crypto-timing-safe-equal-benchmarks\n\nUsing `eval()` rather than `require()`'ing a fixture and deleting it\nfrom the cache results in a roughtly 10x improvement in running time.\n\nFixes: https://github.com/nodejs/node/issues/25984\nRefs: https://github.com/nodejs/node/issues/26229\n\nPR-URL: https://github.com/nodejs/node/pull/26237\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Yang Guo <yangguo@chromium.org>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Teddy Katz <teddy.katz@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "eb9e6c015705847190147201c587e1e668358a78",
    "files": [
        {
            "sha": "96470e3e4434a8cce9c8479e205b64e48de59b9f",
            "filename": "test/fixtures/crypto-timing-safe-equal-benchmark-func.js",
            "status": "removed",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/d1011f6bbfadfa254925014896aa710f02403770/test%2Ffixtures%2Fcrypto-timing-safe-equal-benchmark-func.js",
            "raw_url": "https://github.com/nodejs/node/raw/d1011f6bbfadfa254925014896aa710f02403770/test%2Ffixtures%2Fcrypto-timing-safe-equal-benchmark-func.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fcrypto-timing-safe-equal-benchmark-func.js?ref=d1011f6bbfadfa254925014896aa710f02403770",
            "patch": "@@ -1,17 +0,0 @@\n-'use strict';\n-\n-const assert = require('assert');\n-module.exports = (compareFunc, firstBufFill, secondBufFill, bufSize) => {\n-  const firstBuffer = Buffer.alloc(bufSize, firstBufFill);\n-  const secondBuffer = Buffer.alloc(bufSize, secondBufFill);\n-\n-  const startTime = process.hrtime();\n-  const result = compareFunc(firstBuffer, secondBuffer);\n-  const endTime = process.hrtime(startTime);\n-\n-  // Ensure that the result of the function call gets used, so it doesn't\n-  // get discarded due to engine optimizations.\n-  assert.strictEqual(result, firstBufFill === secondBufFill);\n-\n-  return endTime[0] * 1e9 + endTime[1];\n-};"
        },
        {
            "sha": "b649b071e1e49de27ce6cda521bcbe97a46a0128",
            "filename": "test/pummel/test-crypto-timing-safe-equal-benchmarks.js",
            "status": "modified",
            "additions": 15,
            "deletions": 12,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/eb9e6c015705847190147201c587e1e668358a78/test%2Fpummel%2Ftest-crypto-timing-safe-equal-benchmarks.js",
            "raw_url": "https://github.com/nodejs/node/raw/eb9e6c015705847190147201c587e1e668358a78/test%2Fpummel%2Ftest-crypto-timing-safe-equal-benchmarks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpummel%2Ftest-crypto-timing-safe-equal-benchmarks.js?ref=eb9e6c015705847190147201c587e1e668358a78",
            "patch": "@@ -6,21 +6,24 @@ if (!common.hasCrypto)\n if (!common.enoughTestMem)\n   common.skip('memory-intensive test');\n \n-const fixtures = require('../common/fixtures');\n const assert = require('assert');\n const crypto = require('crypto');\n \n-const BENCHMARK_FUNC_PATH =\n-  `${fixtures.fixturesDir}/crypto-timing-safe-equal-benchmark-func`;\n-function runOneBenchmark(...args) {\n-  const benchmarkFunc = require(BENCHMARK_FUNC_PATH);\n-  const result = benchmarkFunc(...args);\n-\n-  // Don't let the comparison function get cached. This avoid a timing\n-  // inconsistency due to V8 optimization where the function would take\n-  // less time when called with a specific set of parameters.\n-  delete require.cache[require.resolve(BENCHMARK_FUNC_PATH)];\n-  return result;\n+function runOneBenchmark(compareFunc, firstBufFill, secondBufFill, bufSize) {\n+  return eval(`\n+      const firstBuffer = Buffer.alloc(bufSize, firstBufFill);\n+      const secondBuffer = Buffer.alloc(bufSize, secondBufFill);\n+\n+      const startTime = process.hrtime();\n+      const result = compareFunc(firstBuffer, secondBuffer);\n+      const endTime = process.hrtime(startTime);\n+\n+      // Ensure that the result of the function call gets used, so it doesn't\n+      // get discarded due to engine optimizations.\n+      assert.strictEqual(result, firstBufFill === secondBufFill);\n+\n+      endTime[0] * 1e9 + endTime[1];\n+    `);\n }\n \n function getTValue(compareFunc) {"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 15,
        "deletions": 29
    }
}