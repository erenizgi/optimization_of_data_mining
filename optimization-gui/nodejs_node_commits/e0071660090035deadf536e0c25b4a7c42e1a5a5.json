{
    "author": "addaleax",
    "message": "deps: update to nghttp2 1.33.0\n\nRefs: https://github.com/nghttp2/nghttp2/releases/tag/v1.33.0\n\nPR-URL: https://github.com/nodejs/node/pull/22649\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "e0071660090035deadf536e0c25b4a7c42e1a5a5",
    "files": [
        {
            "sha": "8c54b9c8cc464df7345c26fa9eb12ad4a7588bda",
            "filename": "deps/nghttp2/lib/includes/nghttp2/nghttp2.h",
            "status": "modified",
            "additions": 112,
            "deletions": 30,
            "changes": 142,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -28,7 +28,7 @@\n /* Define WIN32 when build target is Win32 API (borrowed from\n    libcurl) */\n #if (defined(_WIN32) || defined(__WIN32__)) && !defined(WIN32)\n-#define WIN32\n+#  define WIN32\n #endif\n \n #ifdef __cplusplus\n@@ -40,30 +40,30 @@ extern \"C\" {\n /* MSVC < 2013 does not have inttypes.h because it is not C99\n    compliant.  See compiler macros and version number in\n    https://sourceforge.net/p/predef/wiki/Compilers/ */\n-#include <stdint.h>\n+#  include <stdint.h>\n #else /* !defined(_MSC_VER) || (_MSC_VER >= 1800) */\n-#include <inttypes.h>\n+#  include <inttypes.h>\n #endif /* !defined(_MSC_VER) || (_MSC_VER >= 1800) */\n #include <sys/types.h>\n #include <stdarg.h>\n \n #include <nghttp2/nghttp2ver.h>\n \n #ifdef NGHTTP2_STATICLIB\n-#define NGHTTP2_EXTERN\n+#  define NGHTTP2_EXTERN\n #elif defined(WIN32)\n-#ifdef BUILDING_NGHTTP2\n-#define NGHTTP2_EXTERN __declspec(dllexport)\n-#else /* !BUILDING_NGHTTP2 */\n-#define NGHTTP2_EXTERN __declspec(dllimport)\n-#endif /* !BUILDING_NGHTTP2 */\n-#else  /* !defined(WIN32) */\n-#ifdef BUILDING_NGHTTP2\n-#define NGHTTP2_EXTERN __attribute__((visibility(\"default\")))\n-#else /* !BUILDING_NGHTTP2 */\n-#define NGHTTP2_EXTERN\n-#endif /* !BUILDING_NGHTTP2 */\n-#endif /* !defined(WIN32) */\n+#  ifdef BUILDING_NGHTTP2\n+#    define NGHTTP2_EXTERN __declspec(dllexport)\n+#  else /* !BUILDING_NGHTTP2 */\n+#    define NGHTTP2_EXTERN __declspec(dllimport)\n+#  endif /* !BUILDING_NGHTTP2 */\n+#else    /* !defined(WIN32) */\n+#  ifdef BUILDING_NGHTTP2\n+#    define NGHTTP2_EXTERN __attribute__((visibility(\"default\")))\n+#  else /* !BUILDING_NGHTTP2 */\n+#    define NGHTTP2_EXTERN\n+#  endif /* !BUILDING_NGHTTP2 */\n+#endif   /* !defined(WIN32) */\n \n /**\n  * @macro\n@@ -611,7 +611,12 @@ typedef enum {\n    * The ALTSVC frame, which is defined in `RFC 7383\n    * <https://tools.ietf.org/html/rfc7838#section-4>`_.\n    */\n-  NGHTTP2_ALTSVC = 0x0a\n+  NGHTTP2_ALTSVC = 0x0a,\n+  /**\n+   * The ORIGIN frame, which is defined by `RFC 8336\n+   * <https://tools.ietf.org/html/rfc8336>`_.\n+   */\n+  NGHTTP2_ORIGIN = 0x0c\n } nghttp2_frame_type;\n \n /**\n@@ -2473,15 +2478,15 @@ nghttp2_option_set_no_auto_window_update(nghttp2_option *option, int val);\n  *\n  * This option sets the SETTINGS_MAX_CONCURRENT_STREAMS value of\n  * remote endpoint as if it is received in SETTINGS frame.  Without\n- * specifying this option, before the local endpoint receives\n- * SETTINGS_MAX_CONCURRENT_STREAMS in SETTINGS frame from remote\n- * endpoint, SETTINGS_MAX_CONCURRENT_STREAMS is unlimited.  This may\n- * cause problem if local endpoint submits lots of requests initially\n- * and sending them at once to the remote peer may lead to the\n- * rejection of some requests.  Specifying this option to the sensible\n- * value, say 100, may avoid this kind of issue. This value will be\n- * overwritten if the local endpoint receives\n- * SETTINGS_MAX_CONCURRENT_STREAMS from the remote endpoint.\n+ * specifying this option, the maximum number of outgoing concurrent\n+ * streams is initially limited to 100 to avoid issues when the local\n+ * endpoint submits lots of requests before receiving initial SETTINGS\n+ * frame from the remote endpoint, since sending them at once to the\n+ * remote endpoint could lead to rejection of some of the requests.\n+ * This value will be overwritten when the local endpoint receives\n+ * initial SETTINGS frame from the remote endpoint, either to the\n+ * value advertised in SETTINGS_MAX_CONCURRENT_STREAMS or to the\n+ * default value (unlimited) if none was advertised.\n  */\n NGHTTP2_EXTERN void\n nghttp2_option_set_peer_max_concurrent_streams(nghttp2_option *option,\n@@ -3797,10 +3802,13 @@ nghttp2_priority_spec_check_default(const nghttp2_priority_spec *pri_spec);\n  * .. warning::\n  *\n  *   This function returns assigned stream ID if it succeeds.  But\n- *   that stream is not opened yet.  The application must not submit\n+ *   that stream is not created yet.  The application must not submit\n  *   frame to that stream ID before\n  *   :type:`nghttp2_before_frame_send_callback` is called for this\n- *   frame.\n+ *   frame.  This means `nghttp2_session_get_stream_user_data()` does\n+ *   not work before the callback.  But\n+ *   `nghttp2_session_set_stream_user_data()` handles this situation\n+ *   specially, and it can set data to a stream during this period.\n  *\n  */\n NGHTTP2_EXTERN int32_t nghttp2_submit_request(\n@@ -4516,8 +4524,7 @@ typedef struct {\n  * Submits ALTSVC frame.\n  *\n  * ALTSVC frame is a non-critical extension to HTTP/2, and defined in\n- * is defined in `RFC 7383\n- * <https://tools.ietf.org/html/rfc7838#section-4>`_.\n+ * `RFC 7383 <https://tools.ietf.org/html/rfc7838#section-4>`_.\n  *\n  * The |flags| is currently ignored and should be\n  * :enum:`NGHTTP2_FLAG_NONE`.\n@@ -4551,6 +4558,81 @@ NGHTTP2_EXTERN int nghttp2_submit_altsvc(nghttp2_session *session,\n                                          const uint8_t *field_value,\n                                          size_t field_value_len);\n \n+/**\n+ * @struct\n+ *\n+ * The single entry of an origin.\n+ */\n+typedef struct {\n+  /**\n+   * The pointer to origin.  No validation is made against this field\n+   * by the library.  This is not necessarily NULL-terminated.\n+   */\n+  uint8_t *origin;\n+  /**\n+   * The length of the |origin|.\n+   */\n+  size_t origin_len;\n+} nghttp2_origin_entry;\n+\n+/**\n+ * @struct\n+ *\n+ * The payload of ORIGIN frame.  ORIGIN frame is a non-critical\n+ * extension to HTTP/2 and defined by `RFC 8336\n+ * <https://tools.ietf.org/html/rfc8336>`_.\n+ *\n+ * If this frame is received, and\n+ * `nghttp2_option_set_user_recv_extension_type()` is not set, and\n+ * `nghttp2_option_set_builtin_recv_extension_type()` is set for\n+ * :enum:`NGHTTP2_ORIGIN`, ``nghttp2_extension.payload`` will point to\n+ * this struct.\n+ *\n+ * It has the following members:\n+ */\n+typedef struct {\n+  /**\n+   * The number of origins contained in |ov|.\n+   */\n+  size_t nov;\n+  /**\n+   * The pointer to the array of origins contained in ORIGIN frame.\n+   */\n+  nghttp2_origin_entry *ov;\n+} nghttp2_ext_origin;\n+\n+/**\n+ * @function\n+ *\n+ * Submits ORIGIN frame.\n+ *\n+ * ORIGIN frame is a non-critical extension to HTTP/2 and defined by\n+ * `RFC 8336 <https://tools.ietf.org/html/rfc8336>`_.\n+ *\n+ * The |flags| is currently ignored and should be\n+ * :enum:`NGHTTP2_FLAG_NONE`.\n+ *\n+ * The |ov| points to the array of origins.  The |nov| specifies the\n+ * number of origins included in |ov|.  This function creates copies\n+ * of all elements in |ov|.\n+ *\n+ * The ORIGIN frame is only usable by a server.  If this function is\n+ * invoked with client side session, this function returns\n+ * :enum:`NGHTTP2_ERR_INVALID_STATE`.\n+ *\n+ * :enum:`NGHTTP2_ERR_NOMEM`\n+ *     Out of memory\n+ * :enum:`NGHTTP2_ERR_INVALID_STATE`\n+ *     The function is called from client side session.\n+ * :enum:`NGHTTP2_ERR_INVALID_ARGUMENT`\n+ *     There are too many origins, or an origin is too large to fit\n+ *     into a default frame payload.\n+ */\n+NGHTTP2_EXTERN int nghttp2_submit_origin(nghttp2_session *session,\n+                                         uint8_t flags,\n+                                         const nghttp2_origin_entry *ov,\n+                                         size_t nov);\n+\n /**\n  * @function\n  *"
        },
        {
            "sha": "1f1d4808ca27c0faae3625b0df239b5c13e42769",
            "filename": "deps/nghttp2/lib/includes/nghttp2/nghttp2ver.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2ver.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2ver.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fincludes%2Fnghttp2%2Fnghttp2ver.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -29,14 +29,14 @@\n  * @macro\n  * Version number of the nghttp2 library release\n  */\n-#define NGHTTP2_VERSION \"1.32.0\"\n+#define NGHTTP2_VERSION \"1.33.0\"\n \n /**\n  * @macro\n  * Numerical representation of the version number of the nghttp2 library\n  * release. This is a 24 bit number with 8 bits for major number, 8 bits\n  * for minor and 8 bits for patch. Version 1.2.3 becomes 0x010203.\n  */\n-#define NGHTTP2_VERSION_NUM 0x012000\n+#define NGHTTP2_VERSION_NUM 0x012100\n \n #endif /* NGHTTP2VER_H */"
        },
        {
            "sha": "06cce67a11bdeaff8cac052e5272e5a995bd3f7e",
            "filename": "deps/nghttp2/lib/nghttp2_buf.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_buf.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_buf.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_buf.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_BUF_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "61e51fa53638deb9e677f84023c30ab0e6ddfcd3",
            "filename": "deps/nghttp2/lib/nghttp2_callbacks.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_callbacks.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_callbacks.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_callbacks.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_CALLBACKS_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "cbb4dd575472342348e8d0edbca743d5c8b16721",
            "filename": "deps/nghttp2/lib/nghttp2_debug.h",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_debug.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_debug.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_debug.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,18 +26,18 @@\n #define NGHTTP2_DEBUG_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>\n \n #ifdef DEBUGBUILD\n-#define DEBUGF(...) nghttp2_debug_vprintf(__VA_ARGS__)\n+#  define DEBUGF(...) nghttp2_debug_vprintf(__VA_ARGS__)\n void nghttp2_debug_vprintf(const char *format, ...);\n #else\n-#define DEBUGF(...)                                                            \\\n-  do {                                                                         \\\n-  } while (0)\n+#  define DEBUGF(...)                                                          \\\n+    do {                                                                       \\\n+    } while (0)\n #endif\n \n #endif /* NGHTTP2_DEBUG_H */"
        },
        {
            "sha": "6e33f3c247f5cbb7aff147047ad4ae711ba82f91",
            "filename": "deps/nghttp2/lib/nghttp2_frame.c",
            "status": "modified",
            "additions": 130,
            "deletions": 0,
            "changes": 130,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_frame.c",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_frame.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_frame.c?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -223,6 +223,36 @@ void nghttp2_frame_altsvc_free(nghttp2_extension *frame, nghttp2_mem *mem) {\n   nghttp2_mem_free(mem, altsvc->origin);\n }\n \n+void nghttp2_frame_origin_init(nghttp2_extension *frame,\n+                               nghttp2_origin_entry *ov, size_t nov) {\n+  nghttp2_ext_origin *origin;\n+  size_t payloadlen = 0;\n+  size_t i;\n+\n+  for (i = 0; i < nov; ++i) {\n+    payloadlen += 2 + ov[i].origin_len;\n+  }\n+\n+  nghttp2_frame_hd_init(&frame->hd, payloadlen, NGHTTP2_ORIGIN,\n+                        NGHTTP2_FLAG_NONE, 0);\n+\n+  origin = frame->payload;\n+  origin->ov = ov;\n+  origin->nov = nov;\n+}\n+\n+void nghttp2_frame_origin_free(nghttp2_extension *frame, nghttp2_mem *mem) {\n+  nghttp2_ext_origin *origin;\n+\n+  origin = frame->payload;\n+  if (origin == NULL) {\n+    return;\n+  }\n+  /* We use the same buffer for all resources pointed by the field of\n+     origin directly or indirectly. */\n+  nghttp2_mem_free(mem, origin->ov);\n+}\n+\n size_t nghttp2_frame_priority_len(uint8_t flags) {\n   if (flags & NGHTTP2_FLAG_PRIORITY) {\n     return NGHTTP2_PRIORITY_SPECLEN;\n@@ -746,6 +776,106 @@ int nghttp2_frame_unpack_altsvc_payload2(nghttp2_extension *frame,\n   return 0;\n }\n \n+int nghttp2_frame_pack_origin(nghttp2_bufs *bufs, nghttp2_extension *frame) {\n+  nghttp2_buf *buf;\n+  nghttp2_ext_origin *origin;\n+  nghttp2_origin_entry *orig;\n+  size_t i;\n+\n+  origin = frame->payload;\n+\n+  buf = &bufs->head->buf;\n+\n+  if (nghttp2_buf_avail(buf) < frame->hd.length) {\n+    return NGHTTP2_ERR_FRAME_SIZE_ERROR;\n+  }\n+\n+  buf->pos -= NGHTTP2_FRAME_HDLEN;\n+\n+  nghttp2_frame_pack_frame_hd(buf->pos, &frame->hd);\n+\n+  for (i = 0; i < origin->nov; ++i) {\n+    orig = &origin->ov[i];\n+    nghttp2_put_uint16be(buf->last, (uint16_t)orig->origin_len);\n+    buf->last += 2;\n+    buf->last = nghttp2_cpymem(buf->last, orig->origin, orig->origin_len);\n+  }\n+\n+  assert(nghttp2_buf_len(buf) == NGHTTP2_FRAME_HDLEN + frame->hd.length);\n+\n+  return 0;\n+}\n+\n+int nghttp2_frame_unpack_origin_payload(nghttp2_extension *frame,\n+                                        const uint8_t *payload,\n+                                        size_t payloadlen, nghttp2_mem *mem) {\n+  nghttp2_ext_origin *origin;\n+  const uint8_t *p, *end;\n+  uint8_t *dst;\n+  size_t originlen;\n+  nghttp2_origin_entry *ov;\n+  size_t nov = 0;\n+  size_t len = 0;\n+\n+  origin = frame->payload;\n+  p = payload;\n+  end = p + payloadlen;\n+\n+  for (; p != end;) {\n+    if (end - p < 2) {\n+      return NGHTTP2_ERR_FRAME_SIZE_ERROR;\n+    }\n+    originlen = nghttp2_get_uint16(p);\n+    p += 2;\n+    if (originlen == 0) {\n+      continue;\n+    }\n+    if (originlen > (size_t)(end - p)) {\n+      return NGHTTP2_ERR_FRAME_SIZE_ERROR;\n+    }\n+    p += originlen;\n+    /* 1 for terminal NULL */\n+    len += originlen + 1;\n+    ++nov;\n+  }\n+\n+  if (nov == 0) {\n+    origin->ov = NULL;\n+    origin->nov = 0;\n+\n+    return 0;\n+  }\n+\n+  len += nov * sizeof(nghttp2_origin_entry);\n+\n+  ov = nghttp2_mem_malloc(mem, len);\n+  if (ov == NULL) {\n+    return NGHTTP2_ERR_NOMEM;\n+  }\n+\n+  origin->ov = ov;\n+  origin->nov = nov;\n+\n+  dst = (uint8_t *)ov + nov * sizeof(nghttp2_origin_entry);\n+  p = payload;\n+\n+  for (; p != end;) {\n+    originlen = nghttp2_get_uint16(p);\n+    p += 2;\n+    if (originlen == 0) {\n+      continue;\n+    }\n+    ov->origin = dst;\n+    ov->origin_len = originlen;\n+    dst = nghttp2_cpymem(dst, p, originlen);\n+    *dst++ = '\\0';\n+    p += originlen;\n+    ++ov;\n+  }\n+\n+  return 0;\n+}\n+\n nghttp2_settings_entry *nghttp2_frame_iv_copy(const nghttp2_settings_entry *iv,\n                                               size_t niv, nghttp2_mem *mem) {\n   nghttp2_settings_entry *iv_copy;"
        },
        {
            "sha": "615bbf31f5d60d798e91465421714df5e1873d5e",
            "filename": "deps/nghttp2/lib/nghttp2_frame.h",
            "status": "modified",
            "additions": 50,
            "deletions": 1,
            "changes": 51,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_frame.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_frame.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_frame.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_FRAME_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>\n@@ -72,6 +72,7 @@\n /* Union of extension frame payload */\n typedef union {\n   nghttp2_ext_altsvc altsvc;\n+  nghttp2_ext_origin origin;\n } nghttp2_ext_frame_payload;\n \n void nghttp2_frame_pack_frame_hd(uint8_t *buf, const nghttp2_frame_hd *hd);\n@@ -392,6 +393,36 @@ int nghttp2_frame_unpack_altsvc_payload2(nghttp2_extension *frame,\n                                          const uint8_t *payload,\n                                          size_t payloadlen, nghttp2_mem *mem);\n \n+/*\n+ * Packs ORIGIN frame |frame| in wire frame format and store it in\n+ * |bufs|.\n+ *\n+ * The caller must make sure that nghttp2_bufs_reset(bufs) is called\n+ * before calling this function.\n+ *\n+ * This function returns 0 if it succeeds, or one of the following\n+ * negative error codes:\n+ *\n+ * NGHTTP2_ERR_FRAME_SIZE_ERROR\n+ *     The length of the frame is too large.\n+ */\n+int nghttp2_frame_pack_origin(nghttp2_bufs *bufs, nghttp2_extension *ext);\n+\n+/*\n+ * Unpacks ORIGIN wire format into |frame|.  The |payload| of length\n+ * |payloadlen| contains the frame payload.\n+ *\n+ * This function returns 0 if it succeeds, or one of the following\n+ * negative error codes:\n+ *\n+ * NGHTTP2_ERR_NOMEM\n+ *     Out of memory.\n+ * NGHTTP2_ERR_FRAME_SIZE_ERROR\n+ *     The payload is too small.\n+ */\n+int nghttp2_frame_unpack_origin_payload(nghttp2_extension *frame,\n+                                        const uint8_t *payload,\n+                                        size_t payloadlen, nghttp2_mem *mem);\n /*\n  * Initializes HEADERS frame |frame| with given values.  |frame| takes\n  * ownership of |nva|, so caller must not free it. If |stream_id| is\n@@ -489,6 +520,24 @@ void nghttp2_frame_altsvc_init(nghttp2_extension *frame, int32_t stream_id,\n  */\n void nghttp2_frame_altsvc_free(nghttp2_extension *frame, nghttp2_mem *mem);\n \n+/*\n+ * Initializes ORIGIN frame |frame| with given values.  This function\n+ * assumes that frame->payload points to nghttp2_ext_origin object.\n+ * Also |ov| and the memory pointed by the field of its elements are\n+ * allocated in single buffer, starting with |ov|.  On success, this\n+ * function takes ownership of |ov|, so caller must not free it.\n+ */\n+void nghttp2_frame_origin_init(nghttp2_extension *frame,\n+                               nghttp2_origin_entry *ov, size_t nov);\n+\n+/*\n+ * Frees up resources under |frame|.  This function does not free\n+ * nghttp2_ext_origin object pointed by frame->payload.  This function\n+ * only frees nghttp2_ext_origin.ov.  Therefore, other fields must be\n+ * allocated in the same buffer with ov.\n+ */\n+void nghttp2_frame_origin_free(nghttp2_extension *frame, nghttp2_mem *mem);\n+\n /*\n  * Returns the number of padding bytes after payload.  The total\n  * padding length is given in the |padlen|.  The returned value does"
        },
        {
            "sha": "c64a1f2b9b406c91bbd7c114d8dab2506622660e",
            "filename": "deps/nghttp2/lib/nghttp2_hd.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_hd.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_hd.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_hd.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_HD_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "c6e3942e95f4fc6d8218b221843eae13da0227e7",
            "filename": "deps/nghttp2/lib/nghttp2_hd_huffman.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_hd_huffman.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_hd_huffman.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_hd_huffman.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_HD_HUFFMAN_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "b1f18ce541ac36c6a4c686d80d3074067b70d8bf",
            "filename": "deps/nghttp2/lib/nghttp2_helper.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_helper.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_helper.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_helper.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_HELPER_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <string.h>"
        },
        {
            "sha": "dd057cdb60757ff033a41749874f876ca91be267",
            "filename": "deps/nghttp2/lib/nghttp2_http.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_http.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_http.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_http.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_HTTP_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "b23585ccb27da21ca1afec729f0c8b1d94c79050",
            "filename": "deps/nghttp2/lib/nghttp2_int.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_int.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_int.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_int.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_INT_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "f6e29e35f2de3f52b0e166725ca394f9c038f854",
            "filename": "deps/nghttp2/lib/nghttp2_map.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_map.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_map.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_map.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_MAP_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "f83dbcb8f9a5882846e3cfbcbcb3fbaeea057013",
            "filename": "deps/nghttp2/lib/nghttp2_mem.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_mem.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_mem.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_mem.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_MEM_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "95ffee74a14fc9b94f959c5fc56a8e4cfd1e0dcb",
            "filename": "deps/nghttp2/lib/nghttp2_net.h",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_net.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_net.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_net.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,15 +26,15 @@\n #define NGHTTP2_NET_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #ifdef HAVE_ARPA_INET_H\n-#include <arpa/inet.h>\n+#  include <arpa/inet.h>\n #endif /* HAVE_ARPA_INET_H */\n \n #ifdef HAVE_NETINET_IN_H\n-#include <netinet/in.h>\n+#  include <netinet/in.h>\n #endif /* HAVE_NETINET_IN_H */\n \n #include <nghttp2/nghttp2.h>\n@@ -44,11 +44,11 @@\n    define inline functions for those function so that we don't have\n    dependeny on that lib. */\n \n-#ifdef _MSC_VER\n-#define STIN static __inline\n-#else\n-#define STIN static inline\n-#endif\n+#  ifdef _MSC_VER\n+#    define STIN static __inline\n+#  else\n+#    define STIN static inline\n+#  endif\n \n STIN uint32_t htonl(uint32_t hostlong) {\n   uint32_t res;"
        },
        {
            "sha": "c6f1c04b6835948b229b31d987bef989b5c9fc54",
            "filename": "deps/nghttp2/lib/nghttp2_npn.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_npn.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_npn.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_npn.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_NPN_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "8946d7dd38cfb83039df35c30f8894b40c7568ee",
            "filename": "deps/nghttp2/lib/nghttp2_option.c",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_option.c",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_option.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_option.c?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -86,6 +86,10 @@ void nghttp2_option_set_builtin_recv_extension_type(nghttp2_option *option,\n     option->opt_set_mask |= NGHTTP2_OPT_BUILTIN_RECV_EXT_TYPES;\n     option->builtin_recv_ext_types |= NGHTTP2_TYPEMASK_ALTSVC;\n     return;\n+  case NGHTTP2_ORIGIN:\n+    option->opt_set_mask |= NGHTTP2_OPT_BUILTIN_RECV_EXT_TYPES;\n+    option->builtin_recv_ext_types |= NGHTTP2_TYPEMASK_ORIGIN;\n+    return;\n   default:\n     return;\n   }"
        },
        {
            "sha": "29e72aa321007a88ecd2132cf7de1840e3c3bfd2",
            "filename": "deps/nghttp2/lib/nghttp2_option.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_option.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_option.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_option.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_OPTION_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "f651c8029ac0244f8e7b2de2559e5ffbbcc8563c",
            "filename": "deps/nghttp2/lib/nghttp2_outbound_item.c",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_outbound_item.c",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_outbound_item.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_outbound_item.c?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -86,6 +86,9 @@ void nghttp2_outbound_item_free(nghttp2_outbound_item *item, nghttp2_mem *mem) {\n     case NGHTTP2_ALTSVC:\n       nghttp2_frame_altsvc_free(&frame->ext, mem);\n       break;\n+    case NGHTTP2_ORIGIN:\n+      nghttp2_frame_origin_free(&frame->ext, mem);\n+      break;\n     default:\n       assert(0);\n       break;"
        },
        {
            "sha": "b5f503a312dd8cf6ab4a3fe4aaddc5b3f817c782",
            "filename": "deps/nghttp2/lib/nghttp2_outbound_item.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_outbound_item.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_outbound_item.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_outbound_item.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_OUTBOUND_ITEM_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "2d7b702ac18ad019525b66d31eec4a0bd1d81887",
            "filename": "deps/nghttp2/lib/nghttp2_pq.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_pq.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_pq.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_pq.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_PQ_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "92ece822a8f2571964e170bfbf6e59d90b15da2a",
            "filename": "deps/nghttp2/lib/nghttp2_priority_spec.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_priority_spec.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_priority_spec.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_priority_spec.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_PRIORITY_SPEC_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "a06fa6c7a46fc78782be7a1da02ba8590f4e4d4c",
            "filename": "deps/nghttp2/lib/nghttp2_queue.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_queue.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_queue.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_queue.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_QUEUE_H\n \n #ifdef HAVE_CONFIG_H\n-#include \"config.h\"\n+#  include \"config.h\"\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "6814e709fb41482ac083eaa087054623d361d784",
            "filename": "deps/nghttp2/lib/nghttp2_rcbuf.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_rcbuf.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_rcbuf.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_rcbuf.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_RCBUF_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "418ad6663585f5b49e8093b0342226e49015ad7e",
            "filename": "deps/nghttp2/lib/nghttp2_session.c",
            "status": "modified",
            "additions": 157,
            "deletions": 4,
            "changes": 161,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_session.c",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_session.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_session.c?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -348,6 +348,12 @@ static void session_inbound_frame_reset(nghttp2_session *session) {\n         }\n         nghttp2_frame_altsvc_free(&iframe->frame.ext, mem);\n         break;\n+      case NGHTTP2_ORIGIN:\n+        if ((session->builtin_recv_ext_types & NGHTTP2_TYPEMASK_ORIGIN) == 0) {\n+          break;\n+        }\n+        nghttp2_frame_origin_free(&iframe->frame.ext, mem);\n+        break;\n       }\n     }\n \n@@ -1749,6 +1755,13 @@ static int session_predicate_altsvc_send(nghttp2_session *session,\n   return 0;\n }\n \n+static int session_predicate_origin_send(nghttp2_session *session) {\n+  if (session_is_closing(session)) {\n+    return NGHTTP2_ERR_SESSION_CLOSING;\n+  }\n+  return 0;\n+}\n+\n /* Take into account settings max frame size and both connection-level\n    flow control here */\n static ssize_t\n@@ -2280,6 +2293,18 @@ static int session_prep_frame(nghttp2_session *session,\n \n       nghttp2_frame_pack_altsvc(&session->aob.framebufs, &frame->ext);\n \n+      return 0;\n+    case NGHTTP2_ORIGIN:\n+      rv = session_predicate_origin_send(session);\n+      if (rv != 0) {\n+        return rv;\n+      }\n+\n+      rv = nghttp2_frame_pack_origin(&session->aob.framebufs, &frame->ext);\n+      if (rv != 0) {\n+        return rv;\n+      }\n+\n       return 0;\n     default:\n       /* Unreachable here */\n@@ -4385,6 +4410,12 @@ int nghttp2_session_on_settings_received(nghttp2_session *session,\n     return session_call_on_frame_received(session, frame);\n   }\n \n+  if (!session->remote_settings_received) {\n+    session->remote_settings.max_concurrent_streams =\n+        NGHTTP2_DEFAULT_MAX_CONCURRENT_STREAMS;\n+    session->remote_settings_received = 1;\n+  }\n+\n   for (i = 0; i < frame->settings.niv; ++i) {\n     nghttp2_settings_entry *entry = &frame->settings.iv[i];\n \n@@ -4821,6 +4852,11 @@ int nghttp2_session_on_altsvc_received(nghttp2_session *session,\n   return session_call_on_frame_received(session, frame);\n }\n \n+int nghttp2_session_on_origin_received(nghttp2_session *session,\n+                                       nghttp2_frame *frame) {\n+  return session_call_on_frame_received(session, frame);\n+}\n+\n static int session_process_altsvc_frame(nghttp2_session *session) {\n   nghttp2_inbound_frame *iframe = &session->iframe;\n   nghttp2_frame *frame = &iframe->frame;\n@@ -4836,6 +4872,25 @@ static int session_process_altsvc_frame(nghttp2_session *session) {\n   return nghttp2_session_on_altsvc_received(session, frame);\n }\n \n+static int session_process_origin_frame(nghttp2_session *session) {\n+  nghttp2_inbound_frame *iframe = &session->iframe;\n+  nghttp2_frame *frame = &iframe->frame;\n+  nghttp2_mem *mem = &session->mem;\n+  int rv;\n+\n+  rv = nghttp2_frame_unpack_origin_payload(&frame->ext, iframe->lbuf.pos,\n+                                           nghttp2_buf_len(&iframe->lbuf), mem);\n+  if (rv != 0) {\n+    if (nghttp2_is_fatal(rv)) {\n+      return rv;\n+    }\n+    /* Ignore ORIGIN frame which cannot be parsed. */\n+    return 0;\n+  }\n+\n+  return nghttp2_session_on_origin_received(session, frame);\n+}\n+\n static int session_process_extension_frame(nghttp2_session *session) {\n   int rv;\n   nghttp2_inbound_frame *iframe = &session->iframe;\n@@ -5746,6 +5801,42 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n             iframe->state = NGHTTP2_IB_READ_NBYTE;\n             inbound_frame_set_mark(iframe, 2);\n \n+            break;\n+          case NGHTTP2_ORIGIN:\n+            if (!(session->builtin_recv_ext_types & NGHTTP2_TYPEMASK_ORIGIN)) {\n+              busy = 1;\n+              iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n+              break;\n+            }\n+\n+            DEBUGF(\"recv: ORIGIN\\n\");\n+\n+            iframe->frame.ext.payload = &iframe->ext_frame_payload.origin;\n+\n+            if (session->server || iframe->frame.hd.stream_id ||\n+                (iframe->frame.hd.flags & 0xf0)) {\n+              busy = 1;\n+              iframe->state = NGHTTP2_IB_IGN_PAYLOAD;\n+              break;\n+            }\n+\n+            iframe->frame.hd.flags = NGHTTP2_FLAG_NONE;\n+\n+            if (iframe->payloadleft) {\n+              iframe->raw_lbuf = nghttp2_mem_malloc(mem, iframe->payloadleft);\n+\n+              if (iframe->raw_lbuf == NULL) {\n+                return NGHTTP2_ERR_NOMEM;\n+              }\n+\n+              nghttp2_buf_wrap_init(&iframe->lbuf, iframe->raw_lbuf,\n+                                    iframe->payloadleft);\n+            } else {\n+              busy = 1;\n+            }\n+\n+            iframe->state = NGHTTP2_IB_READ_ORIGIN_PAYLOAD;\n+\n             break;\n           default:\n             busy = 1;\n@@ -6583,7 +6674,6 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n       DEBUGF(\"recv: [IB_READ_ALTSVC_PAYLOAD]\\n\");\n \n       readlen = inbound_frame_payload_readlen(iframe, in, last);\n-\n       if (readlen > 0) {\n         iframe->lbuf.last = nghttp2_cpymem(iframe->lbuf.last, in, readlen);\n \n@@ -6601,11 +6691,44 @@ ssize_t nghttp2_session_mem_recv(nghttp2_session *session, const uint8_t *in,\n       }\n \n       rv = session_process_altsvc_frame(session);\n+      if (nghttp2_is_fatal(rv)) {\n+        return rv;\n+      }\n+\n+      session_inbound_frame_reset(session);\n+\n+      break;\n+    case NGHTTP2_IB_READ_ORIGIN_PAYLOAD:\n+      DEBUGF(\"recv: [IB_READ_ORIGIN_PAYLOAD]\\n\");\n+\n+      readlen = inbound_frame_payload_readlen(iframe, in, last);\n+\n+      if (readlen > 0) {\n+        iframe->lbuf.last = nghttp2_cpymem(iframe->lbuf.last, in, readlen);\n+\n+        iframe->payloadleft -= readlen;\n+        in += readlen;\n+      }\n+\n+      DEBUGF(\"recv: readlen=%zu, payloadleft=%zu\\n\", readlen,\n+             iframe->payloadleft);\n+\n+      if (iframe->payloadleft) {\n+        assert(nghttp2_buf_avail(&iframe->lbuf) > 0);\n+\n+        break;\n+      }\n+\n+      rv = session_process_origin_frame(session);\n \n       if (nghttp2_is_fatal(rv)) {\n         return rv;\n       }\n \n+      if (iframe->state == NGHTTP2_IB_IGN_ALL) {\n+        return (ssize_t)inlen;\n+      }\n+\n       session_inbound_frame_reset(session);\n \n       break;\n@@ -7085,12 +7208,42 @@ int nghttp2_session_set_stream_user_data(nghttp2_session *session,\n                                          int32_t stream_id,\n                                          void *stream_user_data) {\n   nghttp2_stream *stream;\n+  nghttp2_frame *frame;\n+  nghttp2_outbound_item *item;\n+\n   stream = nghttp2_session_get_stream(session, stream_id);\n-  if (!stream) {\n+  if (stream) {\n+    stream->stream_user_data = stream_user_data;\n+    return 0;\n+  }\n+\n+  if (session->server || !nghttp2_session_is_my_stream_id(session, stream_id) ||\n+      !nghttp2_outbound_queue_top(&session->ob_syn)) {\n     return NGHTTP2_ERR_INVALID_ARGUMENT;\n   }\n-  stream->stream_user_data = stream_user_data;\n-  return 0;\n+\n+  frame = &nghttp2_outbound_queue_top(&session->ob_syn)->frame;\n+  assert(frame->hd.type == NGHTTP2_HEADERS);\n+\n+  if (frame->hd.stream_id > stream_id ||\n+      (uint32_t)stream_id >= session->next_stream_id) {\n+    return NGHTTP2_ERR_INVALID_ARGUMENT;\n+  }\n+\n+  for (item = session->ob_syn.head; item; item = item->qnext) {\n+    if (item->frame.hd.stream_id < stream_id) {\n+      continue;\n+    }\n+\n+    if (item->frame.hd.stream_id > stream_id) {\n+      break;\n+    }\n+\n+    item->aux_data.headers.stream_user_data = stream_user_data;\n+    return 0;\n+  }\n+\n+  return NGHTTP2_ERR_INVALID_ARGUMENT;\n }\n \n int nghttp2_session_resume_data(nghttp2_session *session, int32_t stream_id) {"
        },
        {
            "sha": "5add50bc8bce16688135b7880a74ce4cc735cbf1",
            "filename": "deps/nghttp2/lib/nghttp2_session.h",
            "status": "modified",
            "additions": 26,
            "deletions": 9,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_session.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_session.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_session.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_SESSION_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>\n@@ -61,7 +61,8 @@ typedef enum {\n  */\n typedef enum {\n   NGHTTP2_TYPEMASK_NONE = 0,\n-  NGHTTP2_TYPEMASK_ALTSVC = 1 << 0\n+  NGHTTP2_TYPEMASK_ALTSVC = 1 << 0,\n+  NGHTTP2_TYPEMASK_ORIGIN = 1 << 1\n } nghttp2_typemask;\n \n typedef enum {\n@@ -121,6 +122,7 @@ typedef enum {\n   NGHTTP2_IB_IGN_DATA,\n   NGHTTP2_IB_IGN_ALL,\n   NGHTTP2_IB_READ_ALTSVC_PAYLOAD,\n+  NGHTTP2_IB_READ_ORIGIN_PAYLOAD,\n   NGHTTP2_IB_READ_EXTENSION_PAYLOAD\n } nghttp2_inbound_state;\n \n@@ -301,8 +303,10 @@ struct nghttp2_session {\n      increased/decreased by submitting WINDOW_UPDATE. See\n      nghttp2_submit_window_update(). */\n   int32_t local_window_size;\n-  /* Settings value received from the remote endpoint. We just use ID\n-     as index. The index = 0 is unused. */\n+  /* This flag is used to indicate that the local endpoint received initial\n+     SETTINGS frame from the remote endpoint. */\n+  uint8_t remote_settings_received;\n+  /* Settings value received from the remote endpoint. */\n   nghttp2_settings_storage remote_settings;\n   /* Settings value of the local endpoint. */\n   nghttp2_settings_storage local_settings;\n@@ -698,7 +702,7 @@ int nghttp2_session_on_push_promise_received(nghttp2_session *session,\n  * NGHTTP2_ERR_NOMEM\n  *     Out of memory.\n  * NGHTTP2_ERR_CALLBACK_FAILURE\n- *   The callback function failed.\n+ *     The callback function failed.\n  * NGHTTP2_ERR_FLOODED\n  *     There are too many items in outbound queue, and this is most\n  *     likely caused by misbehaviour of peer.\n@@ -716,7 +720,7 @@ int nghttp2_session_on_ping_received(nghttp2_session *session,\n  * NGHTTP2_ERR_NOMEM\n  *     Out of memory.\n  * NGHTTP2_ERR_CALLBACK_FAILURE\n- *   The callback function failed.\n+ *     The callback function failed.\n  */\n int nghttp2_session_on_goaway_received(nghttp2_session *session,\n                                        nghttp2_frame *frame);\n@@ -731,7 +735,7 @@ int nghttp2_session_on_goaway_received(nghttp2_session *session,\n  * NGHTTP2_ERR_NOMEM\n  *     Out of memory.\n  * NGHTTP2_ERR_CALLBACK_FAILURE\n- *   The callback function failed.\n+ *     The callback function failed.\n  */\n int nghttp2_session_on_window_update_received(nghttp2_session *session,\n                                               nghttp2_frame *frame);\n@@ -744,11 +748,24 @@ int nghttp2_session_on_window_update_received(nghttp2_session *session,\n  * negative error codes:\n  *\n  * NGHTTP2_ERR_CALLBACK_FAILURE\n- *   The callback function failed.\n+ *     The callback function failed.\n  */\n int nghttp2_session_on_altsvc_received(nghttp2_session *session,\n                                        nghttp2_frame *frame);\n \n+/*\n+ * Called when ORIGIN is received, assuming |frame| is properly\n+ * initialized.\n+ *\n+ * This function returns 0 if it succeeds, or one of the following\n+ * negative error codes:\n+ *\n+ * NGHTTP2_ERR_CALLBACK_FAILURE\n+ *     The callback function failed.\n+ */\n+int nghttp2_session_on_origin_received(nghttp2_session *session,\n+                                       nghttp2_frame *frame);\n+\n /*\n  * Called when DATA is received, assuming |frame| is properly\n  * initialized.\n@@ -759,7 +776,7 @@ int nghttp2_session_on_altsvc_received(nghttp2_session *session,\n  * NGHTTP2_ERR_NOMEM\n  *     Out of memory.\n  * NGHTTP2_ERR_CALLBACK_FAILURE\n- *   The callback function failed.\n+ *     The callback function failed.\n  */\n int nghttp2_session_on_data_received(nghttp2_session *session,\n                                      nghttp2_frame *frame);"
        },
        {
            "sha": "d1d5856d800e7641f11c9ea8f0c2075953470a9a",
            "filename": "deps/nghttp2/lib/nghttp2_stream.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_stream.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_stream.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_stream.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_STREAM_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "f604eff5c9017fc272ac876d255d522303826d5e",
            "filename": "deps/nghttp2/lib/nghttp2_submit.c",
            "status": "modified",
            "additions": 83,
            "deletions": 0,
            "changes": 83,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_submit.c",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_submit.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_submit.c?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -571,6 +571,89 @@ int nghttp2_submit_altsvc(nghttp2_session *session, uint8_t flags,\n   return rv;\n }\n \n+int nghttp2_submit_origin(nghttp2_session *session, uint8_t flags,\n+                          const nghttp2_origin_entry *ov, size_t nov) {\n+  nghttp2_mem *mem;\n+  uint8_t *p;\n+  nghttp2_outbound_item *item;\n+  nghttp2_frame *frame;\n+  nghttp2_ext_origin *origin;\n+  nghttp2_origin_entry *ov_copy;\n+  size_t len = 0;\n+  size_t i;\n+  int rv;\n+  (void)flags;\n+\n+  mem = &session->mem;\n+\n+  if (!session->server) {\n+    return NGHTTP2_ERR_INVALID_STATE;\n+  }\n+\n+  if (nov) {\n+    for (i = 0; i < nov; ++i) {\n+      len += ov[i].origin_len;\n+    }\n+\n+    if (2 * nov + len > NGHTTP2_MAX_PAYLOADLEN) {\n+      return NGHTTP2_ERR_INVALID_ARGUMENT;\n+    }\n+\n+    /* The last nov is added for terminal NULL character. */\n+    ov_copy =\n+        nghttp2_mem_malloc(mem, nov * sizeof(nghttp2_origin_entry) + len + nov);\n+    if (ov_copy == NULL) {\n+      return NGHTTP2_ERR_NOMEM;\n+    }\n+\n+    p = (uint8_t *)ov_copy + nov * sizeof(nghttp2_origin_entry);\n+\n+    for (i = 0; i < nov; ++i) {\n+      ov_copy[i].origin = p;\n+      ov_copy[i].origin_len = ov[i].origin_len;\n+      p = nghttp2_cpymem(p, ov[i].origin, ov[i].origin_len);\n+      *p++ = '\\0';\n+    }\n+\n+    assert((size_t)(p - (uint8_t *)ov_copy) ==\n+           nov * sizeof(nghttp2_origin_entry) + len + nov);\n+  } else {\n+    ov_copy = NULL;\n+  }\n+\n+  item = nghttp2_mem_malloc(mem, sizeof(nghttp2_outbound_item));\n+  if (item == NULL) {\n+    rv = NGHTTP2_ERR_NOMEM;\n+    goto fail_item_malloc;\n+  }\n+\n+  nghttp2_outbound_item_init(item);\n+\n+  item->aux_data.ext.builtin = 1;\n+\n+  origin = &item->ext_frame_payload.origin;\n+\n+  frame = &item->frame;\n+  frame->ext.payload = origin;\n+\n+  nghttp2_frame_origin_init(&frame->ext, ov_copy, nov);\n+\n+  rv = nghttp2_session_add_item(session, item);\n+  if (rv != 0) {\n+    nghttp2_frame_origin_free(&frame->ext, mem);\n+    nghttp2_mem_free(mem, item);\n+\n+    return rv;\n+  }\n+\n+  return 0;\n+\n+fail_item_malloc:\n+  free(ov_copy);\n+\n+  return rv;\n+}\n+\n static uint8_t set_request_flags(const nghttp2_priority_spec *pri_spec,\n                                  const nghttp2_data_provider *data_prd) {\n   uint8_t flags = NGHTTP2_FLAG_NONE;"
        },
        {
            "sha": "74d702fbcf077e3b1278b506620f63ef9a4f1444",
            "filename": "deps/nghttp2/lib/nghttp2_submit.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_submit.h",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_submit.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_submit.h?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -26,7 +26,7 @@\n #define NGHTTP2_SUBMIT_H\n \n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        },
        {
            "sha": "4211f2cf8f624db997caeaab73700e26d0ed2aa9",
            "filename": "deps/nghttp2/lib/nghttp2_version.c",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_version.c",
            "raw_url": "https://github.com/nodejs/node/raw/e0071660090035deadf536e0c25b4a7c42e1a5a5/deps%2Fnghttp2%2Flib%2Fnghttp2_version.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fnghttp2_version.c?ref=e0071660090035deadf536e0c25b4a7c42e1a5a5",
            "patch": "@@ -23,7 +23,7 @@\n  * WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n  */\n #ifdef HAVE_CONFIG_H\n-#include <config.h>\n+#  include <config.h>\n #endif /* HAVE_CONFIG_H */\n \n #include <nghttp2/nghttp2.h>"
        }
    ],
    "stats": {
        "total": 677,
        "additions": 599,
        "deletions": 78
    }
}