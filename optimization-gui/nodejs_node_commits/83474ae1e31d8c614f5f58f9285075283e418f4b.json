{
    "author": "rubys",
    "message": "tools: flatten apidoc headers\n\nensure optional parameters are not treated as markedown links by\nreplacing the children of headers nodes with a single text node\ncontaining the raw markup;\n\nFixes issue identified in\nhttps://github.com/nodejs/node/pull/21490#issuecomment-406859983\n\nPR-URL: https://github.com/nodejs/node/pull/21936\nReviewed-By: Vse Mozhet Byt <vsemozhetbyt@gmail.com>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "83474ae1e31d8c614f5f58f9285075283e418f4b",
    "files": [
        {
            "sha": "ce137f5d115162840843a7fbbb767f7c0d5e27c4",
            "filename": "tools/doc/html.js",
            "status": "modified",
            "additions": 21,
            "deletions": 6,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/83474ae1e31d8c614f5f58f9285075283e418f4b/tools%2Fdoc%2Fhtml.js",
            "raw_url": "https://github.com/nodejs/node/raw/83474ae1e31d8c614f5f58f9285075283e418f4b/tools%2Fdoc%2Fhtml.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fhtml.js?ref=83474ae1e31d8c614f5f58f9285075283e418f4b",
            "patch": "@@ -175,9 +175,9 @@ function linkJsTypeDocs(text) {\n   return parts.join('`');\n }\n \n-// Preprocess stability blockquotes and YAML blocks\n+// Preprocess headers, stability blockquotes, and YAML blocks.\n function preprocessElements({ filename }) {\n-  return (tree) => {\n+  return (tree, file) => {\n     const STABILITY_RE = /(.*:)\\s*(\\d)([\\s\\S]*)/;\n     let headingIndex = -1;\n     let heading = null;\n@@ -187,6 +187,22 @@ function preprocessElements({ filename }) {\n         headingIndex = index;\n         heading = node;\n \n+        // Ensure optional API parameters are not treated as links by\n+        // collapsing all of heading into a single text node.\n+        if (heading.children.length > 1) {\n+          const position = {\n+            start: heading.children[0].position.start,\n+            end: heading.position.end\n+          };\n+\n+          heading.children = [{\n+            type: 'text',\n+            value: file.contents.slice(\n+              position.start.offset, position.end.offset),\n+            position\n+          }];\n+        }\n+\n       } else if (node.type === 'html' && common.isYAMLBlock(node.value)) {\n         node.value = parseYAML(node.value);\n \n@@ -331,10 +347,9 @@ function buildToc({ filename }) {\n \n       depth = node.depth;\n       const realFilename = path.basename(realFilenames[0], '.md');\n-      const headingText = node.children.map((child) =>\n-        file.contents.slice(child.position.start.offset,\n-                            child.position.end.offset)\n-      ).join('').trim();\n+      const headingText = file.contents.slice(\n+        node.children[0].position.start.offset,\n+        node.position.end.offset).trim();\n       const id = getId(`${realFilename}_${headingText}`, idCounters);\n \n       const hasStability = node.stability !== undefined;"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 21,
        "deletions": 6
    }
}