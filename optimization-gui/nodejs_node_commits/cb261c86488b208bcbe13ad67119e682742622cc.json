{
    "author": "cjihrig",
    "message": "process: avoid using the same fd for ipc and stdio\n\nThere is already a check in place to prevent stdin and the IPC\nchannel from sharing a file descriptor. This commit adds a\nsimilar check to stdout and stderr.\n\nRefs: https://github.com/libuv/libuv/pull/1851\nRefs: https://github.com/libuv/libuv/issues/1897\nPR-URL: https://github.com/nodejs/node/pull/21466\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Santiago Gimeno <santiago.gimeno@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "cb261c86488b208bcbe13ad67119e682742622cc",
    "files": [
        {
            "sha": "e4207a1aa768bd25c57756914357cbc64df478a2",
            "filename": "lib/internal/process/stdio.js",
            "status": "modified",
            "additions": 18,
            "deletions": 5,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/cb261c86488b208bcbe13ad67119e682742622cc/lib%2Finternal%2Fprocess%2Fstdio.js",
            "raw_url": "https://github.com/nodejs/node/raw/cb261c86488b208bcbe13ad67119e682742622cc/lib%2Finternal%2Fprocess%2Fstdio.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fstdio.js?ref=cb261c86488b208bcbe13ad67119e682742622cc",
            "patch": "@@ -183,11 +183,24 @@ function createWritableStdioStream(fd) {\n     case 'PIPE':\n     case 'TCP':\n       var net = require('net');\n-      stream = new net.Socket({\n-        fd: fd,\n-        readable: false,\n-        writable: true\n-      });\n+\n+      // If fd is already being used for the IPC channel, libuv will return\n+      // an error when trying to use it again. In that case, create the socket\n+      // using the existing handle instead of the fd.\n+      if (process.channel && process.channel.fd === fd) {\n+        stream = new net.Socket({\n+          handle: process.channel,\n+          readable: false,\n+          writable: true\n+        });\n+      } else {\n+        stream = new net.Socket({\n+          fd,\n+          readable: false,\n+          writable: true\n+        });\n+      }\n+\n       stream._type = 'pipe';\n       break;\n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 18,
        "deletions": 5
    }
}