{
    "author": "BridgeAR",
    "message": "util: remove custom inspection function\n\nThis removes the deprecated custom inspection function and fixes\nall tests accordingly.\n\nRefs: https://github.com/nodejs/node/issues/15549\n\nPR-URL: https://github.com/nodejs/node/pull/20722\nRefs: https://github.com/nodejs/node/issues/15549\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "27df81cd1874e5392bbfa479543e47dd226f322a",
    "files": [
        {
            "sha": "90f6c9f647b4962e4676e5cca4f08df294389248",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/27df81cd1874e5392bbfa479543e47dd226f322a/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/27df81cd1874e5392bbfa479543e47dd226f322a/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=27df81cd1874e5392bbfa479543e47dd226f322a",
            "patch": "@@ -718,7 +718,7 @@ Type: Runtime\n <a id=\"DEP0079\"></a>\n ### DEP0079: Custom inspection function on Objects via .inspect()\n \n-Type: Runtime\n+Type: End-of-Life\n \n Using a property named `inspect` on an object to specify a custom inspection\n function for [`util.inspect()`][] is deprecated. Use [`util.inspect.custom`][]"
        },
        {
            "sha": "5374fe0f4929cc68556aa54a9f81b96ff0108aa6",
            "filename": "doc/api/util.md",
            "status": "modified",
            "additions": 6,
            "deletions": 10,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/27df81cd1874e5392bbfa479543e47dd226f322a/doc%2Fapi%2Futil.md",
            "raw_url": "https://github.com/nodejs/node/raw/27df81cd1874e5392bbfa479543e47dd226f322a/doc%2Fapi%2Futil.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Futil.md?ref=27df81cd1874e5392bbfa479543e47dd226f322a",
            "patch": "@@ -393,8 +393,9 @@ changes:\n   * `colors` {boolean} If `true`, the output will be styled with ANSI color\n     codes. Colors are customizable, see [Customizing `util.inspect` colors][].\n     **Default:** `false`.\n-  * `customInspect` {boolean} If `false`, then custom `inspect(depth, opts)`\n-    functions will not be called. **Default:** `true`.\n+  * `customInspect` {boolean} If `false`, then\n+    `[util.inspect.custom](depth, opts)` functions will not be called.\n+    **Default:** `true`.\n   * `showProxy` {boolean} If `true`, then objects and functions that are\n     `Proxy` objects will be introspected to show their `target` and `handler`\n     objects. **Default:** `false`.\n@@ -416,7 +417,6 @@ changes:\n     objects the same as arrays. Note that no text will be reduced below 16\n     characters, no matter the `breakLength` size. For more information, see the\n     example below. **Default:** `true`.\n-\n * Returns: {string} The representation of passed object\n \n The `util.inspect()` method returns a string representation of `object` that is\n@@ -450,10 +450,6 @@ const util = require('util');\n console.log(util.inspect(util, { showHidden: true, depth: null }));\n ```\n \n-Values may supply their own custom `inspect(depth, opts)` functions, when\n-called these receive the current `depth` in the recursive inspection, as well as\n-the options object passed to `util.inspect()`.\n-\n The following example highlights the difference with the `compact` option:\n \n ```js\n@@ -568,9 +564,9 @@ terminals.\n \n <!-- type=misc -->\n \n-Objects may also define their own `[util.inspect.custom](depth, opts)`\n-(or the equivalent but deprecated `inspect(depth, opts)`) function that\n-`util.inspect()` will invoke and use the result of when inspecting the object:\n+Objects may also define their own `[util.inspect.custom](depth, opts)` function\n+that `util.inspect()` will invoke and use the result of when inspecting the\n+object:\n \n ```js\n const util = require('util');"
        },
        {
            "sha": "776fcdb0d39653bf1c6354f482437c88a2271c92",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 1,
            "deletions": 11,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/27df81cd1874e5392bbfa479543e47dd226f322a/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/27df81cd1874e5392bbfa479543e47dd226f322a/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=27df81cd1874e5392bbfa479543e47dd226f322a",
            "patch": "@@ -447,17 +447,7 @@ function formatValue(ctx, value, recurseTimes, ln) {\n   // Provide a hook for user-specified inspect functions.\n   // Check that value is an object with an inspect function on it\n   if (ctx.customInspect) {\n-    let maybeCustom = value[customInspectSymbol];\n-\n-    if (!maybeCustom && value.inspect !== exports.inspect &&\n-        typeof value.inspect === 'function') {\n-      maybeCustom = deprecate(\n-        value.inspect,\n-        'Custom inspection function on Objects via .inspect() is deprecated',\n-        'DEP0079'\n-      );\n-    }\n-\n+    const maybeCustom = value[customInspectSymbol];\n     if (typeof maybeCustom === 'function' &&\n         // Filter out the util module, its inspect function is special\n         maybeCustom !== exports.inspect &&"
        },
        {
            "sha": "9a0fa778c1ff6513b04f900608f171df666e1ba4",
            "filename": "test/parallel/test-console.js",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/27df81cd1874e5392bbfa479543e47dd226f322a/test%2Fparallel%2Ftest-console.js",
            "raw_url": "https://github.com/nodejs/node/raw/27df81cd1874e5392bbfa479543e47dd226f322a/test%2Fparallel%2Ftest-console.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-console.js?ref=27df81cd1874e5392bbfa479543e47dd226f322a",
            "patch": "@@ -22,6 +22,7 @@\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n+const util = require('util');\n \n assert.ok(process.stdout.writable);\n assert.ok(process.stderr.writable);\n@@ -46,8 +47,8 @@ assert.throws(() => console.timeEnd(Symbol('test')),\n               TypeError);\n \n \n-// an Object with a custom .inspect() function\n-const custom_inspect = { foo: 'bar', inspect: () => 'inspect' };\n+// An Object with a custom inspect function.\n+const custom_inspect = { foo: 'bar', [util.inspect.custom]: () => 'inspect' };\n \n const strings = [];\n const errStrings = [];\n@@ -192,9 +193,11 @@ for (const expected of expectedStrings) {\n }\n \n assert.strictEqual(strings.shift(),\n-                   \"{ foo: 'bar', inspect: [Function: inspect] }\\n\");\n+                   \"{ foo: 'bar',\\n  [Symbol(util.inspect.custom)]: \" +\n+                    '[Function: [util.inspect.custom]] }\\n');\n assert.strictEqual(strings.shift(),\n-                   \"{ foo: 'bar', inspect: [Function: inspect] }\\n\");\n+                   \"{ foo: 'bar',\\n  [Symbol(util.inspect.custom)]: \" +\n+                    '[Function: [util.inspect.custom]] }\\n');\n assert.ok(strings.shift().includes('foo: [Object]'));\n assert.strictEqual(strings.shift().includes('baz'), false);\n assert.strictEqual(strings.shift(), 'inspect inspect\\n');"
        },
        {
            "sha": "476bda4daa7af4fe386a36695a947d3dffde9d23",
            "filename": "test/parallel/test-util-inspect-deprecated.js",
            "status": "removed",
            "additions": 0,
            "deletions": 19,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/456a8193cb6d7ba3514c14c64130c3f5c5fcd198/test%2Fparallel%2Ftest-util-inspect-deprecated.js",
            "raw_url": "https://github.com/nodejs/node/raw/456a8193cb6d7ba3514c14c64130c3f5c5fcd198/test%2Fparallel%2Ftest-util-inspect-deprecated.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect-deprecated.js?ref=456a8193cb6d7ba3514c14c64130c3f5c5fcd198",
            "patch": "@@ -1,19 +0,0 @@\n-'use strict';\n-const common = require('../common');\n-\n-// Test that deprecation warning for custom inspection via the `.inspect()`\n-// property (on the target object) is emitted once and only once.\n-\n-const util = require('util');\n-\n-{\n-  const target = { inspect: () => 'Fhqwhgads' };\n-  // `common.expectWarning` will expect the warning exactly one time only\n-  common.expectWarning(\n-    'DeprecationWarning',\n-    'Custom inspection function on Objects via .inspect() is deprecated',\n-    'DEP0079'\n-  );\n-  util.inspect(target);  // should emit deprecation warning\n-  util.inspect(target);  // should not emit deprecation warning\n-}"
        },
        {
            "sha": "e3122d1b81e72b25226d4b985437dcaff20553a5",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 21,
            "deletions": 70,
            "changes": 91,
            "blob_url": "https://github.com/nodejs/node/blob/27df81cd1874e5392bbfa479543e47dd226f322a/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/27df81cd1874e5392bbfa479543e47dd226f322a/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=27df81cd1874e5392bbfa479543e47dd226f322a",
            "patch": "@@ -531,10 +531,10 @@ assert.strictEqual(util.inspect(-5e-324), '-5e-324');\n   );\n }\n \n-// GH-1941\n+// https://github.com/nodejs/node-v0.x-archive/issues/1941\n assert.strictEqual(util.inspect(Object.create(Date.prototype)), 'Date {}');\n \n-// GH-1944\n+// https://github.com/nodejs/node-v0.x-archive/issues/1944\n {\n   const d = new Date();\n   d.toUTCString = null;\n@@ -549,20 +549,20 @@ assert.strictEqual(util.inspect(Object.create(Date.prototype)), 'Date {}');\n }\n \n // Should not throw.\n-const r = /regexp/;\n-r.toString = null;\n-util.inspect(r);\n-\n-// Bug with user-supplied inspect function returns non-string.\n-util.inspect([{ inspect: () => 123 }]);\n+{\n+  const r = /regexp/;\n+  r.toString = null;\n+  util.inspect(r);\n+}\n \n-// GH-2225\n+// See https://github.com/nodejs/node-v0.x-archive/issues/2225\n {\n-  const x = { inspect: util.inspect };\n-  assert.strictEqual(util.inspect(x).includes('inspect'), true);\n+  const x = { [util.inspect.custom]: util.inspect };\n+  assert(util.inspect(x).includes(\n+    '[Symbol(util.inspect.custom)]: \\n   { [Function: inspect]'));\n }\n \n-// util.inspect should display the escaped value of a key.\n+// `util.inspect` should display the escaped value of a key.\n {\n   const w = {\n     '\\\\': 1,\n@@ -660,8 +660,8 @@ util.inspect({ hasOwnProperty: null });\n }\n \n {\n-  // \"customInspect\" option can enable/disable calling inspect() on objects.\n-  const subject = { inspect: () => 123 };\n+  // \"customInspect\" option can enable/disable calling [util.inspect.custom]().\n+  const subject = { [util.inspect.custom]: () => 123 };\n \n   assert.strictEqual(\n     util.inspect(subject, { customInspect: true }).includes('123'),\n@@ -680,31 +680,6 @@ util.inspect({ hasOwnProperty: null });\n     true\n   );\n \n-  // Custom inspect() functions should be able to return other Objects.\n-  subject.inspect = () => ({ foo: 'bar' });\n-\n-  assert.strictEqual(util.inspect(subject), '{ foo: \\'bar\\' }');\n-\n-  subject.inspect = (depth, opts) => {\n-    assert.strictEqual(opts.customInspectOptions, true);\n-  };\n-\n-  util.inspect(subject, { customInspectOptions: true });\n-}\n-\n-{\n-  // \"customInspect\" option can enable/disable calling [util.inspect.custom]().\n-  const subject = { [util.inspect.custom]: () => 123 };\n-\n-  assert.strictEqual(\n-    util.inspect(subject, { customInspect: true }).includes('123'),\n-    true\n-  );\n-  assert.strictEqual(\n-    util.inspect(subject, { customInspect: false }).includes('123'),\n-    false\n-  );\n-\n   // A custom [util.inspect.custom]() should be able to return other Objects.\n   subject[util.inspect.custom] = () => ({ foo: 'bar' });\n \n@@ -717,43 +692,16 @@ util.inspect({ hasOwnProperty: null });\n   util.inspect(subject, { customInspectOptions: true });\n }\n \n-{\n-  // [util.inspect.custom] takes precedence over inspect.\n-  const subject = {\n-    [util.inspect.custom]() { return 123; },\n-    inspect() { return 456; }\n-  };\n-\n-  assert.strictEqual(\n-    util.inspect(subject, { customInspect: true }).includes('123'),\n-    true\n-  );\n-  assert.strictEqual(\n-    util.inspect(subject, { customInspect: false }).includes('123'),\n-    false\n-  );\n-  assert.strictEqual(\n-    util.inspect(subject, { customInspect: true }).includes('456'),\n-    false\n-  );\n-  assert.strictEqual(\n-    util.inspect(subject, { customInspect: false }).includes('456'),\n-    false\n-  );\n-}\n-\n {\n   // Returning `this` from a custom inspection function works.\n-  assert.strictEqual(util.inspect({ a: 123, inspect() { return this; } }),\n-                     '{ a: 123, inspect: [Function: inspect] }');\n-\n   const subject = { a: 123, [util.inspect.custom]() { return this; } };\n   const UIC = 'util.inspect.custom';\n   assert.strictEqual(util.inspect(subject),\n                      `{ a: 123,\\n  [Symbol(${UIC})]: [Function: [${UIC}]] }`);\n }\n \n-// util.inspect with \"colors\" option should produce as many lines as without it.\n+// Using `util.inspect` with \"colors\" option should produce as many lines as\n+// without it.\n {\n   function testLines(input) {\n     const countLines = (str) => (str.match(/\\n/g) || []).length;\n@@ -1160,8 +1108,11 @@ util.inspect(process);\n \n // Setting custom inspect property to a non-function should do nothing.\n {\n-  const obj = { inspect: 'fhqwhgads' };\n-  assert.strictEqual(util.inspect(obj), \"{ inspect: 'fhqwhgads' }\");\n+  const obj = { [util.inspect.custom]: 'fhqwhgads' };\n+  assert.strictEqual(\n+    util.inspect(obj),\n+    \"{ [Symbol(util.inspect.custom)]: 'fhqwhgads' }\"\n+  );\n }\n \n {"
        }
    ],
    "stats": {
        "total": 151,
        "additions": 36,
        "deletions": 115
    }
}