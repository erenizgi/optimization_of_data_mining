{
    "author": "refack",
    "message": "doc: cleanup and references in C++ guide\n\nPR-URL: https://github.com/nodejs/node/pull/23650\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>",
    "sha": "cf3f8dd42ea153efce77d69f7be9ca0f99cc7b09",
    "files": [
        {
            "sha": "36c3538f418a55849f7b83bef172a5f3bae54189",
            "filename": "CPP_STYLE_GUIDE.md",
            "status": "modified",
            "additions": 34,
            "deletions": 23,
            "changes": 57,
            "blob_url": "https://github.com/nodejs/node/blob/cf3f8dd42ea153efce77d69f7be9ca0f99cc7b09/CPP_STYLE_GUIDE.md",
            "raw_url": "https://github.com/nodejs/node/raw/cf3f8dd42ea153efce77d69f7be9ca0f99cc7b09/CPP_STYLE_GUIDE.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/CPP_STYLE_GUIDE.md?ref=cf3f8dd42ea153efce77d69f7be9ca0f99cc7b09",
            "patch": "@@ -192,40 +192,39 @@ class FancyContainer {\n \n ### Use `nullptr` instead of `NULL` or `0`\n \n-What it says in the title.\n+Further reading in the [C++ Core Guidelines][ES.47].\n \n ### Ownership and Smart Pointers\n \n-\"Smart\" pointers are classes that act like pointers, e.g.\n-by overloading the `*` and `->` operators. Some smart pointer types can be\n-used to automate ownership bookkeeping, to ensure these responsibilities are\n-met. `std::unique_ptr` is a smart pointer type introduced in C++11, which\n-expresses exclusive ownership of a dynamically allocated object; the object\n-is deleted when the `std::unique_ptr` goes out of scope. It cannot be\n-copied, but can be moved to represent ownership transfer.\n-`std::shared_ptr` is a smart pointer type that expresses shared ownership of a\n-dynamically allocated object. `std::shared_ptr`s can be copied; ownership\n-of the object is shared among all copies, and the object\n-is deleted when the last `std::shared_ptr` is destroyed.\n-\n-Prefer to use `std::unique_ptr` to make ownership\n-transfer explicit. For example:\n+* [R.20]: Use `std::unique_ptr` or `std::shared_ptr` to represent ownership\n+* [R.21]: Prefer `unique_ptr` over `shared_ptr` unless you need to share\n+  ownership\n+\n+Use `std::unique_ptr` to make ownership transfer explicit. For example:\n \n ```cpp\n std::unique_ptr<Foo> FooFactory();\n void FooConsumer(std::unique_ptr<Foo> ptr);\n ```\n \n-Never use `std::auto_ptr`. Instead, use `std::unique_ptr`.\n+Since `std::unique_ptr` has only move semantics, passing one by value transfers\n+ownership to the callee and invalidates the caller's instance.\n+\n+Don't use `std::auto_ptr`, it is deprecated ([Reference][cppref_auto_ptr]).\n \n ## Others\n \n ### Type casting\n \n-- Always avoid C-style casts (`(type)value`)\n-- `dynamic_cast` does not work because RTTI is not enabled\n-- Use `static_cast` for casting whenever it works\n-- `reinterpret_cast` is okay if `static_cast` is not appropriate\n+- Use `static_cast<T>` if casting is required, and it is valid\n+- Use `reinterpret_cast` only when it is necessary\n+- Avoid C-style casts (`(type)value`)\n+- `dynamic_cast` does not work because Node.js is built without\n+  [Run Time Type Information][]\n+\n+Further reading:\n+* [ES.48]: Avoid casts\n+* [ES.49]: If you must use a cast, use a named cast\n \n ### Using `auto`\n \n@@ -316,13 +315,25 @@ exports.foo = function(str) {\n \n #### Avoid throwing JavaScript errors in nested C++ methods\n \n-When you have to throw the errors from C++, try to do it at the top level and\n-not inside of nested calls.\n+When you need to throw a JavaScript exception from C++ (i.e.\n+`isolate()->ThrowException()`) prefer to do it as close to the return to JS as\n+possible, and not inside of nested C++ calls. Since this changes the JS\n+execution state doing it closest to where it is consumed reduces the chances of\n+side effects.\n \n-Using C++ `throw` is not allowed.\n+Node.js is built [without C++ exception handling][], so code using `throw` or\n+even `try` and `catch` **will** break.\n \n \n [C++ Core Guidelines]: http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines\n [Google C++ Style Guide]: https://google.github.io/styleguide/cppguide.html\n [Googleâ€™s `cpplint`]: https://github.com/google/styleguide\n [errors]: https://github.com/nodejs/node/blob/master/doc/guides/using-internal-errors.md\n+[ES.47]: http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-nullptr\n+[ES.48]: http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-casts\n+[ES.49]: http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Res-casts-named\n+[R.20]: http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rr-owner\n+[R.21]: http://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#Rr-unique\n+[Run Time Type Information]: https://en.wikipedia.org/wiki/Run-time_type_information\n+[cppref_auto_ptr]: https://en.cppreference.com/w/cpp/memory/auto_ptr\n+[without C++ exception handling]: https://gcc.gnu.org/onlinedocs/libstdc++/manual/using_exceptions.html#intro.using.exception.no"
        }
    ],
    "stats": {
        "total": 57,
        "additions": 34,
        "deletions": 23
    }
}