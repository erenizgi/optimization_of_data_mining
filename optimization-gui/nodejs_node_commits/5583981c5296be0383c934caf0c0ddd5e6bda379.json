{
    "author": "joyeecheung",
    "message": "fs: throw errors from fs.renameSync in JS\n\nPR-URL: https://github.com/nodejs/node/pull/18348\nRefs: https://github.com/nodejs/node/issues/18106\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "5583981c5296be0383c934caf0c0ddd5e6bda379",
    "files": [
        {
            "sha": "7087644674d57b7317683530537a7bafd5fe7fda",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/5583981c5296be0383c934caf0c0ddd5e6bda379/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/5583981c5296be0383c934caf0c0ddd5e6bda379/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=5583981c5296be0383c934caf0c0ddd5e6bda379",
            "patch": "@@ -924,8 +924,12 @@ fs.renameSync = function(oldPath, newPath) {\n   nullCheck(newPath);\n   validatePath(oldPath, 'oldPath');\n   validatePath(newPath, 'newPath');\n-  return binding.rename(pathModule.toNamespacedPath(oldPath),\n-                        pathModule.toNamespacedPath(newPath));\n+  const ctx = { path: oldPath, dest: newPath };\n+  binding.rename(pathModule.toNamespacedPath(oldPath),\n+                 pathModule.toNamespacedPath(newPath), undefined, ctx);\n+  if (ctx.errno !== undefined) {\n+    throw new errors.uvException(ctx);\n+  }\n };\n \n fs.truncate = function(path, len, callback) {"
        },
        {
            "sha": "073902ce7de955051a777604f8f6707ff37e75fd",
            "filename": "src/node_file.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/5583981c5296be0383c934caf0c0ddd5e6bda379/src%2Fnode_file.cc",
            "raw_url": "https://github.com/nodejs/node/raw/5583981c5296be0383c934caf0c0ddd5e6bda379/src%2Fnode_file.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.cc?ref=5583981c5296be0383c934caf0c0ddd5e6bda379",
            "patch": "@@ -688,19 +688,23 @@ static void ReadLink(const FunctionCallbackInfo<Value>& args) {\n static void Rename(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  CHECK_GE(args.Length(), 2);\n+  int argc = args.Length();\n+  CHECK_GE(argc, 3);\n \n   BufferValue old_path(env->isolate(), args[0]);\n   CHECK_NE(*old_path, nullptr);\n   BufferValue new_path(env->isolate(), args[1]);\n   CHECK_NE(*new_path, nullptr);\n \n-  if (args[2]->IsObject()) {\n-    CHECK_EQ(args.Length(), 3);\n+  if (args[2]->IsObject()) {  // rename(old_path, new_path, req)\n+    CHECK_EQ(argc, 3);\n     AsyncDestCall(env, args, \"rename\", *new_path, new_path.length(),\n                   UTF8, AfterNoArgs, uv_fs_rename, *old_path, *new_path);\n-  } else {\n-    SYNC_DEST_CALL(rename, *old_path, *new_path, *old_path, *new_path)\n+  } else {  // rename(old_path, new_path, undefined, ctx)\n+    CHECK_EQ(argc, 4);\n+    fs_req_wrap req_wrap;\n+    SyncCall(env, args[3], &req_wrap, \"rename\",\n+             uv_fs_rename, *old_path, *new_path);\n   }\n }\n "
        }
    ],
    "stats": {
        "total": 22,
        "additions": 15,
        "deletions": 7
    }
}