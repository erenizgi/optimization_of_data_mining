{
    "author": "alexkozy",
    "message": "src: added URL::FromFilePath method\n\nMethod returns file URL from native file path.\n\nPR-URL: https://github.com/nodejs/node/pull/22251\nReviewed-By: Eugene Ostroukhov <eostroukhov@google.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3",
    "files": [
        {
            "sha": "e9b7eaf7bf9a37d8549b512de6f14c2cf9a13736",
            "filename": "src/node_url.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3/src%2Fnode_url.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3/src%2Fnode_url.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_url.cc?ref=cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3",
            "patch": "@@ -2348,6 +2348,19 @@ std::string URL::ToFilePath() const {\n #endif\n }\n \n+URL URL::FromFilePath(const std::string& file_path) {\n+  URL url(\"file://\");\n+  std::string escaped_file_path;\n+  for (size_t i = 0; i < file_path.length(); ++i) {\n+    escaped_file_path += file_path[i];\n+    if (file_path[i] == '%')\n+      escaped_file_path += \"25\";\n+  }\n+  URL::Parse(escaped_file_path.c_str(), escaped_file_path.length(), kPathStart,\n+             &url.context_, true, nullptr, false);\n+  return url;\n+}\n+\n // This function works by calling out to a JS function that creates and\n // returns the JS URL object. Be mindful of the JS<->Native boundary\n // crossing that is required."
        },
        {
            "sha": "5e61aee4efbd5a9afddc3b9a01492798a4838e5f",
            "filename": "src/node_url.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3/src%2Fnode_url.h",
            "raw_url": "https://github.com/nodejs/node/raw/cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3/src%2Fnode_url.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_url.h?ref=cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3",
            "patch": "@@ -169,6 +169,8 @@ class URL {\n   // Get the path of the file: URL in a format consumable by native file system\n   // APIs. Returns an empty string if something went wrong.\n   std::string ToFilePath() const;\n+  // Get the file URL from native file system path.\n+  static URL FromFilePath(const std::string& file_path);\n \n   const Local<Value> ToObject(Environment* env) const;\n "
        },
        {
            "sha": "2e9b06e3a4783a3f455692bc3bcbadfb4680af2c",
            "filename": "test/cctest/test_url.cc",
            "status": "modified",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3/test%2Fcctest%2Ftest_url.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3/test%2Fcctest%2Ftest_url.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcctest%2Ftest_url.cc?ref=cf340fe0f5201b77a6e9af7f3b3b82d0d4868fc3",
            "patch": "@@ -109,3 +109,36 @@ TEST_F(URLTest, ToFilePath) {\n \n #undef T\n }\n+\n+TEST_F(URLTest, FromFilePath) {\n+  URL file_url;\n+#ifdef _WIN32\n+  file_url = URL::FromFilePath(\"C:\\\\Program Files\\\\\");\n+  EXPECT_EQ(\"file:\", file_url.protocol());\n+  EXPECT_EQ(\"/C:/Program%20Files/\", file_url.path());\n+\n+  file_url = URL::FromFilePath(\"C:\\\\a\\\\b\\\\c\");\n+  EXPECT_EQ(\"file:\", file_url.protocol());\n+  EXPECT_EQ(\"/C:/a/b/c\", file_url.path());\n+\n+  file_url = URL::FromFilePath(\"b:\\\\a\\\\%%.js\");\n+  EXPECT_EQ(\"file:\", file_url.protocol());\n+  EXPECT_EQ(\"/b:/a/%25%25.js\", file_url.path());\n+\n+  file_url = URL::FromFilePath(\"\\\\\\\\host\\\\a\\\\b\\\\c\");\n+  EXPECT_EQ(\"file:\", file_url.protocol());\n+  EXPECT_EQ(\"host/a/b/c\", file_url.path());\n+#else\n+  file_url = URL::FromFilePath(\"/\");\n+  EXPECT_EQ(\"file:\", file_url.protocol());\n+  EXPECT_EQ(\"/\", file_url.path());\n+\n+  file_url = URL::FromFilePath(\"/a/b/c\");\n+  EXPECT_EQ(\"file:\", file_url.protocol());\n+  EXPECT_EQ(\"/a/b/c\", file_url.path());\n+\n+  file_url = URL::FromFilePath(\"/a/%%.js\");\n+  EXPECT_EQ(\"file:\", file_url.protocol());\n+  EXPECT_EQ(\"/a/%25%25.js\", file_url.path());\n+#endif\n+}"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 48,
        "deletions": 0
    }
}