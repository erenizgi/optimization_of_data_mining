{
    "author": "BridgeAR",
    "message": "util: inspect all prototypes\n\nIt is currently difficult to distinguish multiple objects from each\nother because the prototype is not properly inspected. From now on\nall prototypes will be inspected, even if we do not fully know how\nthey will look like / what their shape really is.\n\nPR-URL: https://github.com/nodejs/node/pull/24974\nFixes: https://github.com/nodejs/node/issues/24917\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Anto Aravinth <anto.aravinth.cse@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "02b66b5b866bd8398e7d815d3715ba3f94a5cf65",
    "files": [
        {
            "sha": "256a4a8b06904b1f8bd90429cf000e5a60cd1884",
            "filename": "lib/internal/util/inspect.js",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/02b66b5b866bd8398e7d815d3715ba3f94a5cf65/lib%2Finternal%2Futil%2Finspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/02b66b5b866bd8398e7d815d3715ba3f94a5cf65/lib%2Finternal%2Futil%2Finspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspect.js?ref=02b66b5b866bd8398e7d815d3715ba3f94a5cf65",
            "patch": "@@ -322,7 +322,7 @@ function getEmptyFormatArray() {\n   return [];\n }\n \n-function getConstructorName(obj) {\n+function getConstructorName(obj, ctx) {\n   let firstProto;\n   while (obj) {\n     const descriptor = Object.getOwnPropertyDescriptor(obj, 'constructor');\n@@ -341,10 +341,11 @@ function getConstructorName(obj) {\n   if (firstProto === null) {\n     return null;\n   }\n-  // TODO(BridgeAR): Improve prototype inspection.\n-  // We could use inspect on the prototype itself to improve the output.\n \n-  return '';\n+  return `<${inspect(firstProto, {\n+    ...ctx,\n+    customInspect: false\n+  })}>`;\n }\n \n function getPrefix(constructor, tag, fallback) {\n@@ -503,7 +504,7 @@ function formatValue(ctx, value, recurseTimes) {\n   }\n \n   if (ctx.stop !== undefined) {\n-    const name = getConstructorName(value) || value[Symbol.toStringTag];\n+    const name = getConstructorName(value, ctx) || value[Symbol.toStringTag];\n     return ctx.stylize(`[${name || 'Object'}]`, 'special');\n   }\n \n@@ -547,7 +548,7 @@ function formatValue(ctx, value, recurseTimes) {\n function formatRaw(ctx, value, recurseTimes) {\n   let keys;\n \n-  const constructor = getConstructorName(value);\n+  const constructor = getConstructorName(value, ctx);\n   let tag = value[Symbol.toStringTag];\n   if (typeof tag !== 'string')\n     tag = '';"
        },
        {
            "sha": "0d9cbdbe9d25fe3d653aec2b40025d29e32ada7e",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 18,
            "deletions": 3,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/02b66b5b866bd8398e7d815d3715ba3f94a5cf65/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/02b66b5b866bd8398e7d815d3715ba3f94a5cf65/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=02b66b5b866bd8398e7d815d3715ba3f94a5cf65",
            "patch": "@@ -1738,19 +1738,34 @@ assert.strictEqual(\n   );\n }\n \n-// Manipulate the prototype to one that we can not handle.\n+// Manipulate the prototype in weird ways.\n {\n   let obj = { a: true };\n   let value = (function() { return function() {}; })();\n   Object.setPrototypeOf(value, null);\n   Object.setPrototypeOf(obj, value);\n-  assert.strictEqual(util.inspect(obj), '{ a: true }');\n+  assert.strictEqual(util.inspect(obj), '<[Function]> { a: true }');\n+  assert.strictEqual(\n+    util.inspect(obj, { colors: true }),\n+    '<\\u001b[36m[Function]\\u001b[39m> { a: \\u001b[33mtrue\\u001b[39m }'\n+  );\n \n   obj = { a: true };\n   value = [];\n   Object.setPrototypeOf(value, null);\n   Object.setPrototypeOf(obj, value);\n-  assert.strictEqual(util.inspect(obj), '{ a: true }');\n+  assert.strictEqual(\n+    util.inspect(obj),\n+    '<[Array: null prototype] []> { a: true }'\n+  );\n+\n+  function StorageObject() {}\n+  StorageObject.prototype = Object.create(null);\n+  assert.strictEqual(\n+    util.inspect(new StorageObject()),\n+    '<[Object: null prototype] {}> {}'\n+  );\n+\n }\n \n // Check that the fallback always works."
        }
    ],
    "stats": {
        "total": 34,
        "additions": 25,
        "deletions": 9
    }
}