{
    "author": "apapirovski",
    "message": "src: move GetNow to Environment\n\nPR-URL: https://github.com/nodejs/node/pull/18562\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "1573e4563a0d3f6c08a1dd3ab3d161bece532db5",
    "files": [
        {
            "sha": "07e37498c898bbc1c399d4c7cddc9b51c817ce2f",
            "filename": "src/env.cc",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/1573e4563a0d3f6c08a1dd3ab3d161bece532db5/src%2Fenv.cc",
            "raw_url": "https://github.com/nodejs/node/raw/1573e4563a0d3f6c08a1dd3ab3d161bece532db5/src%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.cc?ref=1573e4563a0d3f6c08a1dd3ab3d161bece532db5",
            "patch": "@@ -11,13 +11,16 @@ namespace node {\n using v8::Context;\n using v8::FunctionTemplate;\n using v8::HandleScope;\n+using v8::Integer;\n using v8::Isolate;\n using v8::Local;\n using v8::Message;\n+using v8::Number;\n using v8::Private;\n using v8::StackFrame;\n using v8::StackTrace;\n using v8::String;\n+using v8::Value;\n \n IsolateData::IsolateData(Isolate* isolate,\n                          uv_loop_t* event_loop,\n@@ -362,6 +365,18 @@ void Environment::ToggleImmediateRef(bool ref) {\n }\n \n \n+Local<Value> Environment::GetNow() {\n+  uv_update_time(event_loop());\n+  uint64_t now = uv_now(event_loop());\n+  CHECK_GE(now, timer_base());\n+  now -= timer_base();\n+  if (now <= 0xffffffff)\n+    return Integer::New(isolate(), static_cast<uint32_t>(now));\n+  else\n+    return Number::New(isolate(), static_cast<double>(now));\n+}\n+\n+\n void CollectExceptionInfo(Environment* env,\n                           v8::Local<v8::Object> obj,\n                           int errorno,"
        },
        {
            "sha": "b621a54e3780cdc8ed4ab30d2bb5b4286b966b6c",
            "filename": "src/env.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/1573e4563a0d3f6c08a1dd3ab3d161bece532db5/src%2Fenv.h",
            "raw_url": "https://github.com/nodejs/node/raw/1573e4563a0d3f6c08a1dd3ab3d161bece532db5/src%2Fenv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.h?ref=1573e4563a0d3f6c08a1dd3ab3d161bece532db5",
            "patch": "@@ -735,6 +735,8 @@ class Environment {\n \n   static inline Environment* ForAsyncHooks(AsyncHooks* hooks);\n \n+  v8::Local<v8::Value> GetNow();\n+\n  private:\n   inline void CreateImmediate(native_immediate_callback cb,\n                               void* data,"
        },
        {
            "sha": "441974ae77b5db023078af3c8ffa66721491d496",
            "filename": "src/timer_wrap.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 14,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/1573e4563a0d3f6c08a1dd3ab3d161bece532db5/src%2Ftimer_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/1573e4563a0d3f6c08a1dd3ab3d161bece532db5/src%2Ftimer_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftimer_wrap.cc?ref=1573e4563a0d3f6c08a1dd3ab3d161bece532db5",
            "patch": "@@ -37,7 +37,6 @@ using v8::FunctionTemplate;\n using v8::HandleScope;\n using v8::Integer;\n using v8::Local;\n-using v8::Number;\n using v8::Object;\n using v8::String;\n using v8::Value;\n@@ -142,7 +141,7 @@ class TimerWrap : public HandleWrap {\n     Local<Value> ret;\n     Local<Value> args[1];\n     do {\n-      args[0] = GetNow(env);\n+      args[0] = env->GetNow();\n       ret = wrap->MakeCallback(kOnTimeout, 1, args).ToLocalChecked();\n     } while (ret->IsUndefined() &&\n              !env->tick_info()->has_thrown() &&\n@@ -153,18 +152,7 @@ class TimerWrap : public HandleWrap {\n \n   static void Now(const FunctionCallbackInfo<Value>& args) {\n     Environment* env = Environment::GetCurrent(args);\n-    args.GetReturnValue().Set(GetNow(env));\n-  }\n-\n-  static Local<Value> GetNow(Environment* env) {\n-    uv_update_time(env->event_loop());\n-    uint64_t now = uv_now(env->event_loop());\n-    CHECK(now >= env->timer_base());\n-    now -= env->timer_base();\n-    if (now <= 0xfffffff)\n-      return Integer::New(env->isolate(), static_cast<uint32_t>(now));\n-    else\n-      return Number::New(env->isolate(), static_cast<double>(now));\n+    args.GetReturnValue().Set(env->GetNow());\n   }\n \n   uv_timer_t handle_;"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 19,
        "deletions": 14
    }
}