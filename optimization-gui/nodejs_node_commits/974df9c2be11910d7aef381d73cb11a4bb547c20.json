{
    "author": "vsemozhetbyt",
    "message": "tools: remove redundant code in doc/html.js\n\nThis PR reduces code by 40 lines and docs size by ~7.5 KB. Only\n<div class=\"signature\">...</div> wrappers are removed from docs,\nno other changes are found in results.\n\nPR-URL: https://github.com/nodejs/node/pull/20514\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "974df9c2be11910d7aef381d73cb11a4bb547c20",
    "files": [
        {
            "sha": "91a18d536a6992fd700a1956b4bd615cc0c75e94",
            "filename": "test/doctool/test-doctool-html.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/974df9c2be11910d7aef381d73cb11a4bb547c20/test%2Fdoctool%2Ftest-doctool-html.js",
            "raw_url": "https://github.com/nodejs/node/raw/974df9c2be11910d7aef381d73cb11a4bb547c20/test%2Fdoctool%2Ftest-doctool-html.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fdoctool%2Ftest-doctool-html.js?ref=974df9c2be11910d7aef381d73cb11a4bb547c20",
            "patch": "@@ -29,11 +29,11 @@ const testData = [\n     file: fixtures.path('order_of_end_tags_5873.md'),\n     html: '<h3>ClassMethod: Buffer.from(array) <span> ' +\n       '<a class=\"mark\" href=\"#foo_class_method_buffer_from_array\" ' +\n-      'id=\"foo_class_method_buffer_from_array\">#</a> </span> </h3><div' +\n-      'class=\"signature\"><ul><li><code>array</code><a ' +\n+      'id=\"foo_class_method_buffer_from_array\">#</a> </span> </h3>' +\n+      '<ul><li><code>array</code><a ' +\n       'href=\"https://developer.mozilla.org/en-US/docs/Web/JavaScript/' +\n       'Reference/Global_Objects/Array\" class=\"type\">&lt;Array&gt;</a></li>' +\n-      '</ul></div>'\n+      '</ul>'\n   },\n   {\n     file: fixtures.path('doc_with_yaml.md'),"
        },
        {
            "sha": "1bb5fa630fa8c2877ca646c943936060357fc555",
            "filename": "tools/doc/html.js",
            "status": "modified",
            "additions": 12,
            "deletions": 52,
            "changes": 64,
            "blob_url": "https://github.com/nodejs/node/blob/974df9c2be11910d7aef381d73cb11a4bb547c20/tools%2Fdoc%2Fhtml.js",
            "raw_url": "https://github.com/nodejs/node/raw/974df9c2be11910d7aef381d73cb11a4bb547c20/tools%2Fdoc%2Fhtml.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fhtml.js?ref=974df9c2be11910d7aef381d73cb11a4bb547c20",
            "patch": "@@ -93,7 +93,7 @@ function render(opts, cb) {\n   filename = path.basename(filename, '.md');\n \n   parseText(lexed);\n-  lexed = parseLists(lexed);\n+  lexed = preprocessElements(lexed);\n \n   // Generate the table of contents.\n   // This mutates the lexed contents in-place.\n@@ -231,25 +231,28 @@ function parseText(lexed) {\n   });\n }\n \n-// Just update the list item text in-place.\n-// Lists that come right after a heading are what we're after.\n-function parseLists(input) {\n+// Preprocess stability blockquotes and YAML blocks.\n+function preprocessElements(input) {\n   var state = null;\n-  const savedState = [];\n-  var depth = 0;\n   const output = [];\n   let headingIndex = -1;\n   let heading = null;\n \n   output.links = input.links;\n   input.forEach(function(tok, index) {\n+    if (tok.type === 'heading') {\n+      headingIndex = index;\n+      heading = tok;\n+    }\n+    if (tok.type === 'html' && common.isYAMLBlock(tok.text)) {\n+      tok.text = parseYAML(tok.text);\n+    }\n     if (tok.type === 'blockquote_start') {\n-      savedState.push(state);\n       state = 'MAYBE_STABILITY_BQ';\n       return;\n     }\n     if (tok.type === 'blockquote_end' && state === 'MAYBE_STABILITY_BQ') {\n-      state = savedState.pop();\n+      state = null;\n       return;\n     }\n     if ((tok.type === 'paragraph' && state === 'MAYBE_STABILITY_BQ') ||\n@@ -271,50 +274,7 @@ function parseLists(input) {\n         return;\n       } else if (state === 'MAYBE_STABILITY_BQ') {\n         output.push({ type: 'blockquote_start' });\n-        state = savedState.pop();\n-      }\n-    }\n-    if (state === null ||\n-      (state === 'AFTERHEADING' && tok.type === 'heading')) {\n-      if (tok.type === 'heading') {\n-        headingIndex = index;\n-        heading = tok;\n-        state = 'AFTERHEADING';\n-      }\n-      output.push(tok);\n-      return;\n-    }\n-    if (state === 'AFTERHEADING') {\n-      if (tok.type === 'list_start') {\n-        state = 'LIST';\n-        if (depth === 0) {\n-          output.push({ type: 'html', text: '<div class=\"signature\">' });\n-        }\n-        depth++;\n-        output.push(tok);\n-        return;\n-      }\n-      if (tok.type === 'html' && common.isYAMLBlock(tok.text)) {\n-        tok.text = parseYAML(tok.text);\n-      }\n-      state = null;\n-      output.push(tok);\n-      return;\n-    }\n-    if (state === 'LIST') {\n-      if (tok.type === 'list_start') {\n-        depth++;\n-        output.push(tok);\n-        return;\n-      }\n-      if (tok.type === 'list_end') {\n-        depth--;\n-        output.push(tok);\n-        if (depth === 0) {\n-          state = null;\n-          output.push({ type: 'html', text: '</div>' });\n-        }\n-        return;\n+        state = null;\n       }\n     }\n     output.push(tok);"
        }
    ],
    "stats": {
        "total": 70,
        "additions": 15,
        "deletions": 55
    }
}