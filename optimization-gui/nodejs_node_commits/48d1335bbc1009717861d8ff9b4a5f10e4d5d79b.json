{
    "author": "addaleax",
    "message": "deps: provide more V8 backwards compatibility\n\nAdd back a number deprecated APIs, using shims that\nshould work well enough at least for the duration of Node 11\nand do not come with significant maintenance overhead.\n\nRefs: https://github.com/nodejs/node/issues/23122\n\nPR-URL: https://github.com/nodejs/node/pull/23158\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: Yang Guo <yangguo@chromium.org>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "48d1335bbc1009717861d8ff9b4a5f10e4d5d79b",
    "files": [
        {
            "sha": "4a104e57d873b908aac0cd8e4e141b02ca44e277",
            "filename": "deps/v8/include/v8.h",
            "status": "modified",
            "additions": 77,
            "deletions": 12,
            "changes": 89,
            "blob_url": "https://github.com/nodejs/node/blob/48d1335bbc1009717861d8ff9b4a5f10e4d5d79b/deps%2Fv8%2Finclude%2Fv8.h",
            "raw_url": "https://github.com/nodejs/node/raw/48d1335bbc1009717861d8ff9b4a5f10e4d5d79b/deps%2Fv8%2Finclude%2Fv8.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8.h?ref=48d1335bbc1009717861d8ff9b4a5f10e4d5d79b",
            "patch": "@@ -1123,6 +1123,10 @@ class V8_EXPORT PrimitiveArray {\n  public:\n   static Local<PrimitiveArray> New(Isolate* isolate, int length);\n   int Length() const;\n+  V8_DEPRECATED(\"Use Isolate* version\",\n+      void Set(int index, Local<Primitive> item));\n+  V8_DEPRECATED(\"Use Isolate* version\",\n+      Local<Primitive> Get(int index));\n   void Set(Isolate* isolate, int index, Local<Primitive> item);\n   Local<Primitive> Get(Isolate* isolate, int index);\n };\n@@ -1829,6 +1833,8 @@ class V8_EXPORT StackTrace {\n   /**\n    * Returns a StackFrame at a particular index.\n    */\n+  V8_DEPRECATED(\"Use Isolate version\",\n+                Local<StackFrame> GetFrame(uint32_t index) const);\n   Local<StackFrame> GetFrame(Isolate* isolate, uint32_t index) const;\n \n   /**\n@@ -2524,18 +2530,25 @@ class V8_EXPORT Value : public Data {\n       Local<Context> context) const;\n   V8_WARN_UNUSED_RESULT MaybeLocal<Int32> ToInt32(Local<Context> context) const;\n \n-  V8_DEPRECATE_SOON(\"Use maybe version\",\n-                    Local<Boolean> ToBoolean(Isolate* isolate) const);\n-  V8_DEPRECATE_SOON(\"Use maybe version\",\n-                    Local<Number> ToNumber(Isolate* isolate) const);\n-  V8_DEPRECATE_SOON(\"Use maybe version\",\n-                    Local<String> ToString(Isolate* isolate) const);\n-  V8_DEPRECATE_SOON(\"Use maybe version\",\n-                    Local<Object> ToObject(Isolate* isolate) const);\n-  V8_DEPRECATE_SOON(\"Use maybe version\",\n-                    Local<Integer> ToInteger(Isolate* isolate) const);\n-  V8_DEPRECATE_SOON(\"Use maybe version\",\n-                    Local<Int32> ToInt32(Isolate* isolate) const);\n+  V8_DEPRECATED(\"Use maybe version\",\n+                Local<Boolean> ToBoolean(Isolate* isolate) const);\n+  V8_DEPRECATED(\"Use maybe version\",\n+                Local<Number> ToNumber(Isolate* isolate) const);\n+  V8_DEPRECATED(\"Use maybe version\",\n+                Local<String> ToString(Isolate* isolate) const);\n+  V8_DEPRECATED(\"Use maybe version\",\n+                Local<Object> ToObject(Isolate* isolate) const);\n+  V8_DEPRECATED(\"Use maybe version\",\n+                Local<Integer> ToInteger(Isolate* isolate) const);\n+  V8_DEPRECATED(\"Use maybe version\",\n+                Local<Int32> ToInt32(Isolate* isolate) const);\n+\n+  inline V8_DEPRECATED(\"Use maybe version\",\n+                       Local<Boolean> ToBoolean() const);\n+  inline V8_DEPRECATED(\"Use maybe version\", Local<String> ToString() const);\n+  inline V8_DEPRECATED(\"Use maybe version\", Local<Object> ToObject() const);\n+  inline V8_DEPRECATED(\"Use maybe version\",\n+                       Local<Integer> ToInteger() const);\n \n   /**\n    * Attempts to convert a string to an array index.\n@@ -2552,7 +2565,14 @@ class V8_EXPORT Value : public Data {\n       Local<Context> context) const;\n   V8_WARN_UNUSED_RESULT Maybe<int32_t> Int32Value(Local<Context> context) const;\n \n+  V8_DEPRECATED(\"Use maybe version\", bool BooleanValue() const);\n+  V8_DEPRECATED(\"Use maybe version\", double NumberValue() const);\n+  V8_DEPRECATED(\"Use maybe version\", int64_t IntegerValue() const);\n+  V8_DEPRECATED(\"Use maybe version\", uint32_t Uint32Value() const);\n+  V8_DEPRECATED(\"Use maybe version\", int32_t Int32Value() const);\n+\n   /** JS == */\n+  V8_DEPRECATED(\"Use maybe version\", bool Equals(Local<Value> that) const);\n   V8_WARN_UNUSED_RESULT Maybe<bool> Equals(Local<Context> context,\n                                            Local<Value> that) const;\n   bool StrictEquals(Local<Value> that) const;\n@@ -2659,6 +2679,8 @@ class V8_EXPORT String : public Name {\n    * Returns the number of bytes in the UTF-8 encoded\n    * representation of this string.\n    */\n+  V8_DEPRECATED(\"Use Isolate version instead\", int Utf8Length() const);\n+\n   int Utf8Length(Isolate* isolate) const;\n \n   /**\n@@ -2715,12 +2737,23 @@ class V8_EXPORT String : public Name {\n   // 16-bit character codes.\n   int Write(Isolate* isolate, uint16_t* buffer, int start = 0, int length = -1,\n             int options = NO_OPTIONS) const;\n+  V8_DEPRECATED(\"Use Isolate* version\",\n+                int Write(uint16_t* buffer, int start = 0, int length = -1,\n+                          int options = NO_OPTIONS) const);\n   // One byte characters.\n   int WriteOneByte(Isolate* isolate, uint8_t* buffer, int start = 0,\n                    int length = -1, int options = NO_OPTIONS) const;\n+  V8_DEPRECATED(\"Use Isolate* version\",\n+                int WriteOneByte(uint8_t* buffer, int start = 0,\n+                                 int length = -1, int options = NO_OPTIONS)\n+                    const);\n   // UTF-8 encoded characters.\n   int WriteUtf8(Isolate* isolate, char* buffer, int length = -1,\n                 int* nchars_ref = NULL, int options = NO_OPTIONS) const;\n+  V8_DEPRECATED(\"Use Isolate* version\",\n+                int WriteUtf8(char* buffer, int length = -1,\n+                              int* nchars_ref = NULL,\n+                              int options = NO_OPTIONS) const);\n \n   /**\n    * A zero length string.\n@@ -2884,6 +2917,9 @@ class V8_EXPORT String : public Name {\n    */\n   static Local<String> Concat(Isolate* isolate, Local<String> left,\n                               Local<String> right);\n+  static V8_DEPRECATED(\"Use Isolate* version\",\n+                       Local<String> Concat(Local<String> left,\n+                                            Local<String> right));\n \n   /**\n    * Creates a new external string using the data defined in the given\n@@ -2952,6 +2988,8 @@ class V8_EXPORT String : public Name {\n    */\n   class V8_EXPORT Utf8Value {\n    public:\n+    V8_DEPRECATED(\"Use Isolate version\",\n+                  explicit Utf8Value(Local<v8::Value> obj));\n     Utf8Value(Isolate* isolate, Local<v8::Value> obj);\n     ~Utf8Value();\n     char* operator*() { return str_; }\n@@ -2975,6 +3013,7 @@ class V8_EXPORT String : public Name {\n    */\n   class V8_EXPORT Value {\n    public:\n+    V8_DEPRECATED(\"Use Isolate version\", explicit Value(Local<v8::Value> obj));\n     Value(Isolate* isolate, Local<v8::Value> obj);\n     ~Value();\n     uint16_t* operator*() { return str_; }\n@@ -5217,6 +5256,8 @@ class V8_EXPORT BooleanObject : public Object {\n class V8_EXPORT StringObject : public Object {\n  public:\n   static Local<Value> New(Isolate* isolate, Local<String> value);\n+  V8_DEPRECATED(\"Use Isolate* version\",\n+                static Local<Value> New(Local<String> value));\n \n   Local<String> ValueOf() const;\n \n@@ -10216,6 +10257,30 @@ template <class T> Value* Value::Cast(T* value) {\n }\n \n \n+Local<Boolean> Value::ToBoolean() const {\n+  return ToBoolean(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(Local<Boolean>());\n+}\n+\n+\n+Local<String> Value::ToString() const {\n+  return ToString(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(Local<String>());\n+}\n+\n+\n+Local<Object> Value::ToObject() const {\n+  return ToObject(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(Local<Object>());\n+}\n+\n+\n+Local<Integer> Value::ToInteger() const {\n+  return ToInteger(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(Local<Integer>());\n+}\n+\n+\n Boolean* Boolean::Cast(v8::Value* value) {\n #ifdef V8_ENABLE_CHECKS\n   CheckCast(value);"
        },
        {
            "sha": "5f1737b2a42b2dc949b7b29cc8981a754cef6838",
            "filename": "deps/v8/src/api.cc",
            "status": "modified",
            "additions": 88,
            "deletions": 0,
            "changes": 88,
            "blob_url": "https://github.com/nodejs/node/blob/48d1335bbc1009717861d8ff9b4a5f10e4d5d79b/deps%2Fv8%2Fsrc%2Fapi.cc",
            "raw_url": "https://github.com/nodejs/node/raw/48d1335bbc1009717861d8ff9b4a5f10e4d5d79b/deps%2Fv8%2Fsrc%2Fapi.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fapi.cc?ref=48d1335bbc1009717861d8ff9b4a5f10e4d5d79b",
            "patch": "@@ -2157,6 +2157,10 @@ int PrimitiveArray::Length() const {\n   return array->length();\n }\n \n+void PrimitiveArray::Set(int index, Local<Primitive> item) {\n+  return Set(Isolate::GetCurrent(), index, item);\n+}\n+\n void PrimitiveArray::Set(Isolate* v8_isolate, int index,\n                          Local<Primitive> item) {\n   i::Isolate* isolate = reinterpret_cast<i::Isolate*>(v8_isolate);\n@@ -2170,6 +2174,10 @@ void PrimitiveArray::Set(Isolate* v8_isolate, int index,\n   array->set(index, *i_item);\n }\n \n+Local<Primitive> PrimitiveArray::Get(int index) {\n+  return Get(Isolate::GetCurrent(), index);\n+}\n+\n Local<Primitive> PrimitiveArray::Get(Isolate* v8_isolate, int index) {\n   i::Isolate* isolate = reinterpret_cast<i::Isolate*>(v8_isolate);\n   i::Handle<i::FixedArray> array = Utils::OpenHandle(this);\n@@ -2900,6 +2908,10 @@ void Message::PrintCurrentStackTrace(Isolate* isolate, FILE* out) {\n \n // --- S t a c k T r a c e ---\n \n+Local<StackFrame> StackTrace::GetFrame(uint32_t index) const {\n+  return GetFrame(Isolate::GetCurrent(), index);\n+}\n+\n Local<StackFrame> StackTrace::GetFrame(Isolate* v8_isolate,\n                                        uint32_t index) const {\n   i::Isolate* isolate = reinterpret_cast<i::Isolate*>(v8_isolate);\n@@ -3876,6 +3888,36 @@ void v8::RegExp::CheckCast(v8::Value* that) {\n }\n \n \n+bool Value::BooleanValue() const {\n+  return BooleanValue(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromJust();\n+}\n+\n+\n+double Value::NumberValue() const {\n+  return NumberValue(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(std::numeric_limits<double>::quiet_NaN());\n+}\n+\n+\n+int64_t Value::IntegerValue() const {\n+  return NumberValue(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(0);\n+}\n+\n+\n+uint32_t Value::Uint32Value() const {\n+  return Uint32Value(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(0);\n+}\n+\n+\n+int32_t Value::Int32Value() const {\n+  return Int32Value(Isolate::GetCurrent()->GetCurrentContext())\n+      .FromMaybe(0);\n+}\n+\n+\n Maybe<bool> Value::BooleanValue(Local<Context> context) const {\n   i::Isolate* isolate = reinterpret_cast<i::Isolate*>(context->GetIsolate());\n   return Just(Utils::OpenHandle(this)->BooleanValue(isolate));\n@@ -3964,6 +4006,12 @@ MaybeLocal<Uint32> Value::ToArrayIndex(Local<Context> context) const {\n }\n \n \n+bool Value::Equals(Local<Value> that) const {\n+  return Equals(Isolate::GetCurrent()->GetCurrentContext(), that)\n+      .FromMaybe(false);\n+}\n+\n+\n Maybe<bool> Value::Equals(Local<Context> context, Local<Value> that) const {\n   i::Isolate* isolate = Utils::OpenHandle(*context)->GetIsolate();\n   auto self = Utils::OpenHandle(this);\n@@ -5295,6 +5343,10 @@ bool String::ContainsOnlyOneByte() const {\n   return helper.Check(*str);\n }\n \n+int String::Utf8Length() const {\n+  return Utf8Length(Isolate::GetCurrent());\n+}\n+\n int String::Utf8Length(Isolate* isolate) const {\n   i::Handle<i::String> str = Utils::OpenHandle(this);\n   str = i::String::Flatten(reinterpret_cast<i::Isolate*>(isolate), str);\n@@ -5518,6 +5570,14 @@ static bool RecursivelySerializeToUtf8(i::String* current,\n   return true;\n }\n \n+\n+int String::WriteUtf8(char* buffer, int capacity,\n+                      int* nchars_ref, int options) const {\n+  return WriteUtf8(Isolate::GetCurrent(),\n+                   buffer, capacity, nchars_ref, options);\n+}\n+\n+\n int String::WriteUtf8(Isolate* v8_isolate, char* buffer, int capacity,\n                       int* nchars_ref, int options) const {\n   i::Handle<i::String> str = Utils::OpenHandle(this);\n@@ -5585,6 +5645,18 @@ static inline int WriteHelper(i::Isolate* isolate, const String* string,\n }\n \n \n+int String::WriteOneByte(uint8_t* buffer, int start,\n+                         int length, int options) const {\n+  return WriteOneByte(Isolate::GetCurrent(), buffer, start, length, options);\n+}\n+\n+\n+int String::Write(uint16_t* buffer, int start, int length,\n+                  int options) const {\n+  return Write(Isolate::GetCurrent(), buffer, start, length, options);\n+}\n+\n+\n int String::WriteOneByte(Isolate* isolate, uint8_t* buffer, int start,\n                          int length, int options) const {\n   return WriteHelper(reinterpret_cast<i::Isolate*>(isolate), this, buffer,\n@@ -6532,6 +6604,11 @@ MaybeLocal<String> String::NewFromTwoByte(Isolate* isolate,\n   return result;\n }\n \n+Local<String> v8::String::Concat(Local<String> left,\n+                                 Local<String> right) {\n+  return Concat(Isolate::GetCurrent(), left, right);\n+}\n+\n Local<String> v8::String::Concat(Isolate* v8_isolate, Local<String> left,\n                                  Local<String> right) {\n   i::Isolate* isolate = reinterpret_cast<i::Isolate*>(v8_isolate);\n@@ -6758,6 +6835,11 @@ bool v8::BooleanObject::ValueOf() const {\n }\n \n \n+Local<v8::Value> v8::StringObject::New(Local<String> value) {\n+  return New(Isolate::GetCurrent(), value);\n+}\n+\n+\n Local<v8::Value> v8::StringObject::New(Isolate* v8_isolate,\n                                        Local<String> value) {\n   i::Handle<i::String> string = Utils::OpenHandle(*value);\n@@ -8893,6 +8975,9 @@ bool MicrotasksScope::IsRunningMicrotasks(Isolate* v8Isolate) {\n   return isolate->IsRunningMicrotasks();\n }\n \n+String::Utf8Value::Utf8Value(v8::Local<v8::Value> obj)\n+  : Utf8Value(Isolate::GetCurrent(), obj) {}\n+\n String::Utf8Value::Utf8Value(v8::Isolate* isolate, v8::Local<v8::Value> obj)\n     : str_(nullptr), length_(0) {\n   if (obj.IsEmpty()) return;\n@@ -8912,6 +8997,9 @@ String::Utf8Value::~Utf8Value() {\n   i::DeleteArray(str_);\n }\n \n+String::Value::Value(v8::Local<v8::Value> obj)\n+  : Value(Isolate::GetCurrent(), obj) {}\n+\n String::Value::Value(v8::Isolate* isolate, v8::Local<v8::Value> obj)\n     : str_(nullptr), length_(0) {\n   if (obj.IsEmpty()) return;"
        }
    ],
    "stats": {
        "total": 177,
        "additions": 165,
        "deletions": 12
    }
}