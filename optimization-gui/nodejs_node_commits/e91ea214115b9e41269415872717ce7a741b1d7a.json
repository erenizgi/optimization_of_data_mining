{
    "author": "danbev",
    "message": "src: add nullptr check for session in DEBUG macro\n\nCurrenlty when configuring --debug-http2\n/test/parallel/test-http2-getpackedsettings.js will segment fault:\n\n$ out/Debug/node test/parallel/test-http2-getpackedsettings.js\nSegmentation fault: 11\n\nThis is happening because the settings is created with the Environment in\nPackSettings:\nHttp2Session::Http2Settings settings(env);\nThis will cause the session to be set to nullptr. When the init\nfunction is later called the expanded DEBUG_HTTP2SESSION macro will\ncause the segment fault when the session is dereferenced.\n\nPR-URL: https://github.com/nodejs/node/pull/18815\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "e91ea214115b9e41269415872717ce7a741b1d7a",
    "files": [
        {
            "sha": "217c19c09287afab86379d59f0beaec84552fb0f",
            "filename": "src/node_http2.h",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/e91ea214115b9e41269415872717ce7a741b1d7a/src%2Fnode_http2.h",
            "raw_url": "https://github.com/nodejs/node/raw/e91ea214115b9e41269415872717ce7a741b1d7a/src%2Fnode_http2.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http2.h?ref=e91ea214115b9e41269415872717ce7a741b1d7a",
            "patch": "@@ -39,16 +39,20 @@ void inline debug_vfprintf(const char* format, ...) {\n #define DEBUG_HTTP2(...) debug_vfprintf(__VA_ARGS__);\n #define DEBUG_HTTP2SESSION(session, message)                                  \\\n   do {                                                                        \\\n-    DEBUG_HTTP2(\"Http2Session %s (%.0lf) \" message \"\\n\",                      \\\n-                   session->TypeName(),                                       \\\n-                   session->get_async_id());                                  \\\n+    if (session != nullptr) {                                                 \\\n+      DEBUG_HTTP2(\"Http2Session %s (%.0lf) \" message \"\\n\",                    \\\n+                  session->TypeName(),                                        \\\n+                  session->get_async_id());                                   \\\n+     }                                                                        \\\n   } while (0)\n #define DEBUG_HTTP2SESSION2(session, message, ...)                            \\\n   do {                                                                        \\\n-    DEBUG_HTTP2(\"Http2Session %s (%.0lf) \" message \"\\n\",                      \\\n-                   session->TypeName(),                                       \\\n-                   session->get_async_id(),                                   \\\n+    if (session != nullptr) {                                                 \\\n+      DEBUG_HTTP2(\"Http2Session %s (%.0lf) \" message \"\\n\",                    \\\n+                  session->TypeName(),                                        \\\n+                  session->get_async_id(),                                    \\\n                   __VA_ARGS__);                                               \\\n+    }                                                                         \\\n   } while (0)\n #define DEBUG_HTTP2STREAM(stream, message)                                    \\\n   do {                                                                        \\"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 10,
        "deletions": 6
    }
}