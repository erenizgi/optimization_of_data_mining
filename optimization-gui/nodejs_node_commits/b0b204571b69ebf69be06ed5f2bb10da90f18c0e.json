{
    "author": "timotew",
    "message": "lib: extract validation functions\n\nPR-URL: https://github.com/nodejs/node/pull/18421\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "b0b204571b69ebf69be06ed5f2bb10da90f18c0e",
    "files": [
        {
            "sha": "fa178f3a8c7caaefe2e7c92df376058eeafcf4cf",
            "filename": "lib/internal/encoding.js",
            "status": "modified",
            "additions": 29,
            "deletions": 30,
            "changes": 59,
            "blob_url": "https://github.com/nodejs/node/blob/b0b204571b69ebf69be06ed5f2bb10da90f18c0e/lib%2Finternal%2Fencoding.js",
            "raw_url": "https://github.com/nodejs/node/raw/b0b204571b69ebf69be06ed5f2bb10da90f18c0e/lib%2Finternal%2Fencoding.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fencoding.js?ref=b0b204571b69ebf69be06ed5f2bb10da90f18c0e",
            "patch": "@@ -32,6 +32,21 @@ function lazyBuffer() {\n   return Buffer;\n }\n \n+function validateEncoder(obj) {\n+  if (obj == null || obj[kEncoder] !== true)\n+    throw new errors.TypeError('ERR_INVALID_THIS', 'TextEncoder');\n+}\n+\n+function validateDecoder(obj) {\n+  if (obj == null || obj[kDecoder] !== true)\n+    throw new errors.TypeError('ERR_INVALID_THIS', 'TextDecoder');\n+}\n+\n+function validateArgument(prop, expected, propName, expectedName) {\n+  if (typeof prop !== expected)\n+    throw new errors.Error('ERR_INVALID_ARG_TYPE', propName, expectedName);\n+}\n+\n const CONVERTER_FLAGS_FLUSH = 0x1;\n const CONVERTER_FLAGS_FATAL = 0x2;\n const CONVERTER_FLAGS_IGNORE_BOM = 0x4;\n@@ -288,20 +303,17 @@ class TextEncoder {\n   }\n \n   get encoding() {\n-    if (this == null || this[kEncoder] !== true)\n-      throw new errors.TypeError('ERR_INVALID_THIS', 'TextEncoder');\n+    validateEncoder(this);\n     return 'utf-8';\n   }\n \n   encode(input = '') {\n-    if (this == null || this[kEncoder] !== true)\n-      throw new errors.TypeError('ERR_INVALID_THIS', 'TextEncoder');\n+    validateEncoder(this);\n     return encodeUtf8String(`${input}`);\n   }\n \n   [inspect](depth, opts) {\n-    if (this == null || this[kEncoder] !== true)\n-      throw new errors.TypeError('ERR_INVALID_THIS', 'TextEncoder');\n+    validateEncoder(this);\n     if (typeof depth === 'number' && depth < 0)\n       return opts.stylize('[Object]', 'special');\n     var ctor = getConstructorOf(this);\n@@ -329,8 +341,7 @@ const { hasConverter, TextDecoder } =\n     makeTextDecoderJS();\n \n function hasTextDecoder(encoding = 'utf-8') {\n-  if (typeof encoding !== 'string')\n-    throw new errors.Error('ERR_INVALID_ARG_TYPE', 'encoding', 'string');\n+  validateArgument(encoding, 'string', 'encoding', 'string');\n   return hasConverter(getEncodingFromLabel(encoding));\n }\n \n@@ -344,8 +355,7 @@ function makeTextDecoderICU() {\n   class TextDecoder {\n     constructor(encoding = 'utf-8', options = {}) {\n       encoding = `${encoding}`;\n-      if (typeof options !== 'object')\n-        throw new errors.Error('ERR_INVALID_ARG_TYPE', 'options', 'Object');\n+      validateArgument(options, 'object', 'options', 'Object');\n \n       const enc = getEncodingFromLabel(encoding);\n       if (enc === undefined)\n@@ -369,17 +379,14 @@ function makeTextDecoderICU() {\n \n \n     decode(input = empty, options = {}) {\n-      if (this == null || this[kDecoder] !== true)\n-        throw new errors.TypeError('ERR_INVALID_THIS', 'TextDecoder');\n+      validateDecoder(this);\n       if (isArrayBuffer(input)) {\n         input = lazyBuffer().from(input);\n       } else if (!isArrayBufferView(input)) {\n         throw new errors.TypeError('ERR_INVALID_ARG_TYPE', 'input',\n                                    ['ArrayBuffer', 'ArrayBufferView']);\n       }\n-      if (typeof options !== 'object') {\n-        throw new errors.TypeError('ERR_INVALID_ARG_TYPE', 'options', 'Object');\n-      }\n+      validateArgument(options, 'object', 'options', 'Object');\n \n       var flags = 0;\n       if (options !== null)\n@@ -416,8 +423,7 @@ function makeTextDecoderJS() {\n   class TextDecoder {\n     constructor(encoding = 'utf-8', options = {}) {\n       encoding = `${encoding}`;\n-      if (typeof options !== 'object')\n-        throw new errors.Error('ERR_INVALID_ARG_TYPE', 'options', 'Object');\n+      validateArgument(options, 'object', 'options', 'Object');\n \n       const enc = getEncodingFromLabel(encoding);\n       if (enc === undefined || !hasConverter(enc))\n@@ -440,8 +446,7 @@ function makeTextDecoderJS() {\n     }\n \n     decode(input = empty, options = {}) {\n-      if (this == null || this[kDecoder] !== true)\n-        throw new errors.TypeError('ERR_INVALID_THIS', 'TextDecoder');\n+      validateDecoder(this);\n       if (isArrayBuffer(input)) {\n         input = lazyBuffer().from(input);\n       } else if (isArrayBufferView(input)) {\n@@ -451,9 +456,7 @@ function makeTextDecoderJS() {\n         throw new errors.TypeError('ERR_INVALID_ARG_TYPE', 'input',\n                                    ['ArrayBuffer', 'ArrayBufferView']);\n       }\n-      if (typeof options !== 'object') {\n-        throw new errors.TypeError('ERR_INVALID_ARG_TYPE', 'options', 'Object');\n-      }\n+      validateArgument(options, 'object', 'options', 'Object');\n \n       if (this[kFlags] & CONVERTER_FLAGS_FLUSH) {\n         this[kBOMSeen] = false;\n@@ -496,27 +499,23 @@ function makeTextDecoderJS() {\n     TextDecoder.prototype,\n     Object.getOwnPropertyDescriptors({\n       get encoding() {\n-        if (this == null || this[kDecoder] !== true)\n-          throw new errors.TypeError('ERR_INVALID_THIS', 'TextDecoder');\n+        validateDecoder(this);\n         return this[kEncoding];\n       },\n \n       get fatal() {\n-        if (this == null || this[kDecoder] !== true)\n-          throw new errors.TypeError('ERR_INVALID_THIS', 'TextDecoder');\n+        validateDecoder(this);\n         return (this[kFlags] & CONVERTER_FLAGS_FATAL) === CONVERTER_FLAGS_FATAL;\n       },\n \n       get ignoreBOM() {\n-        if (this == null || this[kDecoder] !== true)\n-          throw new errors.TypeError('ERR_INVALID_THIS', 'TextDecoder');\n+        validateDecoder(this);\n         return (this[kFlags] & CONVERTER_FLAGS_IGNORE_BOM) ===\n                CONVERTER_FLAGS_IGNORE_BOM;\n       },\n \n       [inspect](depth, opts) {\n-        if (this == null || this[kDecoder] !== true)\n-          throw new errors.TypeError('ERR_INVALID_THIS', 'TextDecoder');\n+        validateDecoder(this);\n         if (typeof depth === 'number' && depth < 0)\n           return opts.stylize('[Object]', 'special');\n         var ctor = getConstructorOf(this);"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 29,
        "deletions": 30
    }
}