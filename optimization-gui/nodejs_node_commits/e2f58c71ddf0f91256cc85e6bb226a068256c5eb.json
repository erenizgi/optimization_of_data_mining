{
    "author": "tniessen",
    "message": "crypto: simplify internal state handling\n\nUninitialized instances are not exposed to users, so this condition should\nalways be true.\n\nPR-URL: https://github.com/nodejs/node/pull/23648\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>",
    "sha": "e2f58c71ddf0f91256cc85e6bb226a068256c5eb",
    "files": [
        {
            "sha": "51648b9e4ca9993a8138d3ba932981d60f93f556",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 14,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/e2f58c71ddf0f91256cc85e6bb226a068256c5eb/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/e2f58c71ddf0f91256cc85e6bb226a068256c5eb/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=e2f58c71ddf0f91256cc85e6bb226a068256c5eb",
            "patch": "@@ -4105,10 +4105,7 @@ void DiffieHellman::GenerateKeys(const FunctionCallbackInfo<Value>& args) {\n \n   DiffieHellman* diffieHellman;\n   ASSIGN_OR_RETURN_UNWRAP(&diffieHellman, args.Holder());\n-\n-  if (!diffieHellman->initialised_) {\n-    return ThrowCryptoError(env, ERR_get_error(), \"Not initialized\");\n-  }\n+  CHECK(diffieHellman->initialised_);\n \n   if (!DH_generate_key(diffieHellman->dh_.get())) {\n     return ThrowCryptoError(env, ERR_get_error(), \"Key generation failed\");\n@@ -4130,7 +4127,7 @@ void DiffieHellman::GetField(const FunctionCallbackInfo<Value>& args,\n \n   DiffieHellman* dh;\n   ASSIGN_OR_RETURN_UNWRAP(&dh, args.Holder());\n-  if (!dh->initialised_) return env->ThrowError(\"Not initialized\");\n+  CHECK(dh->initialised_);\n \n   const BIGNUM* num = get_field(dh->dh_.get());\n   if (num == nullptr) return env->ThrowError(err_if_null);\n@@ -4182,10 +4179,7 @@ void DiffieHellman::ComputeSecret(const FunctionCallbackInfo<Value>& args) {\n \n   DiffieHellman* diffieHellman;\n   ASSIGN_OR_RETURN_UNWRAP(&diffieHellman, args.Holder());\n-\n-  if (!diffieHellman->initialised_) {\n-    return ThrowCryptoError(env, ERR_get_error(), \"Not initialized\");\n-  }\n+  CHECK(diffieHellman->initialised_);\n \n   ClearErrorOnReturn clear_error_on_return;\n \n@@ -4253,7 +4247,7 @@ void DiffieHellman::SetKey(const v8::FunctionCallbackInfo<Value>& args,\n \n   DiffieHellman* dh;\n   ASSIGN_OR_RETURN_UNWRAP(&dh, args.Holder());\n-  if (!dh->initialised_) return env->ThrowError(\"Not initialized\");\n+  CHECK(dh->initialised_);\n \n   char errmsg[64];\n \n@@ -4299,10 +4293,7 @@ void DiffieHellman::VerifyErrorGetter(const FunctionCallbackInfo<Value>& args) {\n \n   DiffieHellman* diffieHellman;\n   ASSIGN_OR_RETURN_UNWRAP(&diffieHellman, args.Holder());\n-\n-  if (!diffieHellman->initialised_)\n-    return ThrowCryptoError(diffieHellman->env(), ERR_get_error(),\n-                            \"Not initialized\");\n+  CHECK(diffieHellman->initialised_);\n \n   args.GetReturnValue().Set(diffieHellman->verifyError_);\n }"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 5,
        "deletions": 14
    }
}