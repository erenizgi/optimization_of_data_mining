{
    "author": "cjihrig",
    "message": "test: refactor test/common/report.js\n\n- Don't unnecessarily require('../common').\n- Eliminate state maintained in tmppath.\n- validate() was being used synchronously, but was actually\n  asynchronous. Make it synchronous.\n- Other misc. drive by cleanup.\n\nPR-URL: https://github.com/nodejs/node/pull/25754\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Anto Aravinth <anto.aravinth.cse@gmail.com>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>",
    "sha": "c64b1aef07dd1f036f1e940a2b104db63406cafc",
    "files": [
        {
            "sha": "1a6d9598d35ca4103b4fd914af55c61253c95266",
            "filename": "test/common/report.js",
            "status": "modified",
            "additions": 24,
            "deletions": 28,
            "changes": 52,
            "blob_url": "https://github.com/nodejs/node/blob/c64b1aef07dd1f036f1e940a2b104db63406cafc/test%2Fcommon%2Freport.js",
            "raw_url": "https://github.com/nodejs/node/raw/c64b1aef07dd1f036f1e940a2b104db63406cafc/test%2Fcommon%2Freport.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Freport.js?ref=c64b1aef07dd1f036f1e940a2b104db63406cafc",
            "patch": "@@ -1,43 +1,39 @@\n+/* eslint-disable node-core/required-modules */\n 'use strict';\n-require('../common');\n const assert = require('assert');\n const fs = require('fs');\n const path = require('path');\n \n-const REPORT_SECTIONS = [ 'header',\n-                          'javascriptStack',\n-                          'nativeStack',\n-                          'javascriptHeap',\n-                          'libuv',\n-                          'environmentVariables',\n-                          'sharedObjects' ];\n-\n-let tmppath = '';\n-\n-exports.findReports = (pid, path) => {\n+function findReports(pid, dir) {\n   // Default filenames are of the form\n   // report.<date>.<time>.<pid>.<seq>.json\n-  tmppath = path;\n   const format = '^report\\\\.\\\\d+\\\\.\\\\d+\\\\.' + pid + '\\\\.\\\\d+\\\\.json$';\n   const filePattern = new RegExp(format);\n-  const files = fs.readdirSync(path);\n-  return files.filter((file) => filePattern.test(file));\n-};\n-\n-exports.validate = (report, options) => {\n-  const jtmp = path.join(tmppath, report);\n-  fs.readFile(jtmp, (err, data) => {\n-    this.validateContent(data, options);\n+  const files = fs.readdirSync(dir);\n+  const results = [];\n+\n+  files.forEach((file) => {\n+    if (filePattern.test(file))\n+      results.push(path.join(dir, file));\n   });\n-};\n \n+  return results;\n+}\n \n-exports.validateContent = function validateContent(data, options) {\n+function validate(report) {\n+  const data = fs.readFileSync(report, 'utf8');\n+\n+  validateContent(data);\n+}\n+\n+function validateContent(data) {\n   const report = JSON.parse(data);\n-  const comp = Object.keys(report);\n \n-  // Check all sections are present\n-  REPORT_SECTIONS.forEach((section) => {\n-    assert.ok(comp.includes(section));\n+  // Verify that all sections are present.\n+  ['header', 'javascriptStack', 'nativeStack', 'javascriptHeap',\n+   'libuv', 'environmentVariables', 'sharedObjects'].forEach((section) => {\n+    assert(report.hasOwnProperty(section));\n   });\n-};\n+}\n+\n+module.exports = { findReports, validate, validateContent };"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 24,
        "deletions": 28
    }
}