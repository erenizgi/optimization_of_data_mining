{
    "author": "jasnell",
    "message": "crypto: docs-only deprecate crypto.fips, replace\n\nDocs-only deprecate the getter/setter crypto.fips and replace\nwith crypto.setFips() and crypto.getFips()\n\nThis is specifically in preparation for ESM module support\n\nPR-URL: https://github.com/nodejs/node/pull/18335\nRefs: https://github.com/nodejs/node/pull/18131\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Guy Bedford <guybedford@gmail.com>\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "6e7992e8b89b55253e43181b4910e6cdbd01318f",
    "files": [
        {
            "sha": "a06a6d1b4ef84a5c742ec92c83bbbb9a9b720c5f",
            "filename": "doc/api/crypto.md",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/6e7992e8b89b55253e43181b4910e6cdbd01318f/doc%2Fapi%2Fcrypto.md",
            "raw_url": "https://github.com/nodejs/node/raw/6e7992e8b89b55253e43181b4910e6cdbd01318f/doc%2Fapi%2Fcrypto.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fcrypto.md?ref=6e7992e8b89b55253e43181b4910e6cdbd01318f",
            "patch": "@@ -1239,11 +1239,15 @@ This property is deprecated.\n ### crypto.fips\n <!-- YAML\n added: v6.0.0\n+deprecated: REPLACEME\n -->\n \n Property for checking and controlling whether a FIPS compliant crypto provider is\n currently in use. Setting to true requires a FIPS build of Node.js.\n \n+This property is deprecated. Please use `crypto.setFips()` and\n+`crypto.getFips()` instead.\n+\n ### crypto.createCipher(algorithm, password[, options])\n <!-- YAML\n added: v0.1.94\n@@ -1576,6 +1580,14 @@ const bobSecret = bob.computeSecret(alice.getPublicKey(), null, 'hex');\n console.log(aliceSecret === bobSecret);\n ```\n \n+### crypto.getFips()\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+Returns `true` if and only if a FIPS compliant crypto provider is\n+currently in use.\n+\n ### crypto.getHashes()\n <!-- YAML\n added: v0.9.3\n@@ -1999,6 +2011,15 @@ is a bit field taking one of or a mix of the following flags (defined in\n * `crypto.constants.ENGINE_METHOD_ALL`\n * `crypto.constants.ENGINE_METHOD_NONE`\n \n+### crypto.setFips(bool)\n+<!-- YAML\n+added: REPLACEME\n+-->\n+* `bool` {boolean} `true` to enable FIPS mode.\n+\n+Enables the FIPS compliant crypto provider in a FIPS-enabled Node.js build.\n+Throws an error if FIPS mode is not available.\n+\n ### crypto.timingSafeEqual(a, b)\n <!-- YAML\n added: v6.6.0"
        },
        {
            "sha": "797c3f0f9dc1076d9a3b9215d5daa9181c0a3e7d",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/6e7992e8b89b55253e43181b4910e6cdbd01318f/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/6e7992e8b89b55253e43181b4910e6cdbd01318f/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=6e7992e8b89b55253e43181b4910e6cdbd01318f",
            "patch": "@@ -840,6 +840,13 @@ Assigning properties to the top-level `this` as an alternative\n to `module.exports` is deprecated. Developers should use `exports`\n or `module.exports` instead.\n \n+### DEP00XX: crypto.fips is deprecated and replaced.\n+\n+Type: Documentation-only\n+\n+The [`crypto.fips`][] property is deprecated. Please use `crypto.setFips()`\n+and `crypto.getFips()` instead.\n+\n [`--pending-deprecation`]: cli.html#cli_pending_deprecation\n [`Buffer.allocUnsafeSlow(size)`]: buffer.html#buffer_class_method_buffer_allocunsafeslow_size\n [`Buffer.from(array)`]: buffer.html#buffer_class_method_buffer_from_array\n@@ -855,6 +862,7 @@ or `module.exports` instead.\n [`console.log()`]: console.html#console_console_log_data_args\n [`crypto.createCredentials()`]: crypto.html#crypto_crypto_createcredentials_details\n [`crypto.DEFAULT_ENCODING`]: crypto.html#crypto_crypto_default_encoding\n+[`crypto.fips`]: crypto.html#crypto_crypto_fips\n [`crypto.pbkdf2()`]: crypto.html#crypto_crypto_pbkdf2_password_salt_iterations_keylen_digest_callback\n [`decipher.setAuthTag()`]: crypto.html#crypto_decipher_setauthtag_buffer\n [`domain`]: domain.html"
        },
        {
            "sha": "0156fe6f09c51ed712a4dff79121615acd14cc80",
            "filename": "lib/crypto.js",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/6e7992e8b89b55253e43181b4910e6cdbd01318f/lib%2Fcrypto.js",
            "raw_url": "https://github.com/nodejs/node/raw/6e7992e8b89b55253e43181b4910e6cdbd01318f/lib%2Fcrypto.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fcrypto.js?ref=6e7992e8b89b55253e43181b4910e6cdbd01318f",
            "patch": "@@ -162,6 +162,10 @@ module.exports = exports = {\n   rng: randomBytes,\n   setEngine,\n   timingSafeEqual,\n+  getFips: !fipsMode ? getFipsDisabled :\n+    fipsForced ? getFipsForced : getFipsCrypto,\n+  setFips: !fipsMode ? setFipsDisabled :\n+    fipsForced ? setFipsForced : setFipsCrypto,\n \n   // Classes\n   Certificate,\n@@ -196,6 +200,7 @@ function getFipsForced() {\n }\n \n Object.defineProperties(exports, {\n+  // crypto.fips is deprecated. DEP00XX. Use crypto.getFips()/crypto.setFips()\n   fips: {\n     get: !fipsMode ? getFipsDisabled :\n       fipsForced ? getFipsForced : getFipsCrypto,"
        },
        {
            "sha": "7810d572ade56aabddb36cb36d8ee653a04f7193",
            "filename": "test/parallel/test-crypto-fips.js",
            "status": "modified",
            "additions": 27,
            "deletions": 27,
            "changes": 54,
            "blob_url": "https://github.com/nodejs/node/blob/6e7992e8b89b55253e43181b4910e6cdbd01318f/test%2Fparallel%2Ftest-crypto-fips.js",
            "raw_url": "https://github.com/nodejs/node/raw/6e7992e8b89b55253e43181b4910e6cdbd01318f/test%2Fparallel%2Ftest-crypto-fips.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-fips.js?ref=6e7992e8b89b55253e43181b4910e6cdbd01318f",
            "patch": "@@ -67,23 +67,23 @@ testHelper(\n   'stdout',\n   [],\n   FIPS_DISABLED,\n-  'require(\"crypto\").fips',\n+  'require(\"crypto\").getFips()',\n   Object.assign({}, process.env, { 'OPENSSL_CONF': '' }));\n \n // --enable-fips should turn FIPS mode on\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   ['--enable-fips'],\n   compiledWithFips() ? FIPS_ENABLED : OPTION_ERROR_STRING,\n-  'require(\"crypto\").fips',\n+  'require(\"crypto\").getFips()',\n   process.env);\n \n //--force-fips should turn FIPS mode on\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   ['--force-fips'],\n   compiledWithFips() ? FIPS_ENABLED : OPTION_ERROR_STRING,\n-  'require(\"crypto\").fips',\n+  'require(\"crypto\").getFips()',\n   process.env);\n \n // If Node was configured using --shared-openssl fips support might be\n@@ -104,140 +104,140 @@ if (!sharedOpenSSL()) {\n     'stdout',\n     [`--openssl-config=${CNF_FIPS_ON}`],\n     compiledWithFips() ? FIPS_ENABLED : FIPS_DISABLED,\n-    'require(\"crypto\").fips',\n+    'require(\"crypto\").getFips()',\n     process.env);\n \n   // OPENSSL_CONF should be able to turn on FIPS mode\n   testHelper(\n     'stdout',\n     [],\n     compiledWithFips() ? FIPS_ENABLED : FIPS_DISABLED,\n-    'require(\"crypto\").fips',\n+    'require(\"crypto\").getFips()',\n     Object.assign({}, process.env, { 'OPENSSL_CONF': CNF_FIPS_ON }));\n \n   // --openssl-config option should override OPENSSL_CONF\n   testHelper(\n     'stdout',\n     [`--openssl-config=${CNF_FIPS_ON}`],\n     compiledWithFips() ? FIPS_ENABLED : FIPS_DISABLED,\n-    'require(\"crypto\").fips',\n+    'require(\"crypto\").getFips()',\n     Object.assign({}, process.env, { 'OPENSSL_CONF': CNF_FIPS_OFF }));\n }\n \n testHelper(\n   'stdout',\n   [`--openssl-config=${CNF_FIPS_OFF}`],\n   FIPS_DISABLED,\n-  'require(\"crypto\").fips',\n+  'require(\"crypto\").getFips()',\n   Object.assign({}, process.env, { 'OPENSSL_CONF': CNF_FIPS_ON }));\n \n // --enable-fips should take precedence over OpenSSL config file\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   ['--enable-fips', `--openssl-config=${CNF_FIPS_OFF}`],\n   compiledWithFips() ? FIPS_ENABLED : OPTION_ERROR_STRING,\n-  'require(\"crypto\").fips',\n+  'require(\"crypto\").getFips()',\n   process.env);\n \n // OPENSSL_CONF should _not_ make a difference to --enable-fips\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   ['--enable-fips'],\n   compiledWithFips() ? FIPS_ENABLED : OPTION_ERROR_STRING,\n-  'require(\"crypto\").fips',\n+  'require(\"crypto\").getFips()',\n   Object.assign({}, process.env, { 'OPENSSL_CONF': CNF_FIPS_OFF }));\n \n // --force-fips should take precedence over OpenSSL config file\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   ['--force-fips', `--openssl-config=${CNF_FIPS_OFF}`],\n   compiledWithFips() ? FIPS_ENABLED : OPTION_ERROR_STRING,\n-  'require(\"crypto\").fips',\n+  'require(\"crypto\").getFips()',\n   process.env);\n \n // Using OPENSSL_CONF should not make a difference to --force-fips\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   ['--force-fips'],\n   compiledWithFips() ? FIPS_ENABLED : OPTION_ERROR_STRING,\n-  'require(\"crypto\").fips',\n+  'require(\"crypto\").getFips()',\n   Object.assign({}, process.env, { 'OPENSSL_CONF': CNF_FIPS_OFF }));\n \n // setFipsCrypto should be able to turn FIPS mode on\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   [],\n   compiledWithFips() ? FIPS_ENABLED : FIPS_ERROR_STRING,\n-  '(require(\"crypto\").fips = true,' +\n-  'require(\"crypto\").fips)',\n+  '(require(\"crypto\").setFips(true),' +\n+  'require(\"crypto\").getFips())',\n   process.env);\n \n // setFipsCrypto should be able to turn FIPS mode on and off\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   [],\n   compiledWithFips() ? FIPS_DISABLED : FIPS_ERROR_STRING,\n-  '(require(\"crypto\").fips = true,' +\n-  'require(\"crypto\").fips = false,' +\n-  'require(\"crypto\").fips)',\n+  '(require(\"crypto\").setFips(true),' +\n+  'require(\"crypto\").setFips(false),' +\n+  'require(\"crypto\").getFips())',\n   process.env);\n \n // setFipsCrypto takes precedence over OpenSSL config file, FIPS on\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   [`--openssl-config=${CNF_FIPS_OFF}`],\n   compiledWithFips() ? FIPS_ENABLED : FIPS_ERROR_STRING,\n-  '(require(\"crypto\").fips = true,' +\n-  'require(\"crypto\").fips)',\n+  '(require(\"crypto\").setFips(true),' +\n+  'require(\"crypto\").getFips())',\n   process.env);\n \n // setFipsCrypto takes precedence over OpenSSL config file, FIPS off\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   [`--openssl-config=${CNF_FIPS_ON}`],\n   compiledWithFips() ? FIPS_DISABLED : FIPS_ERROR_STRING,\n-  '(require(\"crypto\").fips = false,' +\n-  'require(\"crypto\").fips)',\n+  '(require(\"crypto\").setFips(false),' +\n+  'require(\"crypto\").getFips())',\n   process.env);\n \n // --enable-fips does not prevent use of setFipsCrypto API\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   ['--enable-fips'],\n   compiledWithFips() ? FIPS_DISABLED : OPTION_ERROR_STRING,\n-  '(require(\"crypto\").fips = false,' +\n-  'require(\"crypto\").fips)',\n+  '(require(\"crypto\").setFips(false),' +\n+  'require(\"crypto\").getFips())',\n   process.env);\n \n // --force-fips prevents use of setFipsCrypto API\n testHelper(\n   'stderr',\n   ['--force-fips'],\n   compiledWithFips() ? FIPS_ERROR_STRING2 : OPTION_ERROR_STRING,\n-  'require(\"crypto\").fips = false',\n+  'require(\"crypto\").setFips(false)',\n   process.env);\n \n // --force-fips makes setFipsCrypto enable a no-op (FIPS stays on)\n testHelper(\n   compiledWithFips() ? 'stdout' : 'stderr',\n   ['--force-fips'],\n   compiledWithFips() ? FIPS_ENABLED : OPTION_ERROR_STRING,\n-  '(require(\"crypto\").fips = true,' +\n-  'require(\"crypto\").fips)',\n+  '(require(\"crypto\").setFips(true),' +\n+  'require(\"crypto\").getFips())',\n   process.env);\n \n // --force-fips and --enable-fips order does not matter\n testHelper(\n   'stderr',\n   ['--force-fips', '--enable-fips'],\n   compiledWithFips() ? FIPS_ERROR_STRING2 : OPTION_ERROR_STRING,\n-  'require(\"crypto\").fips = false',\n+  'require(\"crypto\").setFips(false)',\n   process.env);\n \n //--enable-fips and --force-fips order does not matter\n testHelper(\n   'stderr',\n   ['--enable-fips', '--force-fips'],\n   compiledWithFips() ? FIPS_ERROR_STRING2 : OPTION_ERROR_STRING,\n-  'require(\"crypto\").fips = false',\n+  'require(\"crypto\").setFips(false)',\n   process.env);"
        }
    ],
    "stats": {
        "total": 88,
        "additions": 61,
        "deletions": 27
    }
}