{
    "author": "danbev",
    "message": "test: add check for root user\n\nCurrently this test fails if run as the root user:\nMismatched innerFn function calls. Expected exactly 62, actual 42.\n\nThe motivation for this is that when building node in a docker\ncontainer it is convenient to be able to build as root.\n\nPR-URL: https://github.com/nodejs/node/pull/19850\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "398968297ae387714431d3e1c6ff0f0cb24807d8",
    "files": [
        {
            "sha": "17545d4af7bf5071414b304b04061d5732631372",
            "filename": "test/parallel/test-child-process-spawnsync-validation-errors.js",
            "status": "modified",
            "additions": 5,
            "deletions": 18,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/398968297ae387714431d3e1c6ff0f0cb24807d8/test%2Fparallel%2Ftest-child-process-spawnsync-validation-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/398968297ae387714431d3e1c6ff0f0cb24807d8/test%2Fparallel%2Ftest-child-process-spawnsync-validation-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-child-process-spawnsync-validation-errors.js?ref=398968297ae387714431d3e1c6ff0f0cb24807d8",
            "patch": "@@ -3,18 +3,11 @@ const common = require('../common');\n const assert = require('assert');\n const spawnSync = require('child_process').spawnSync;\n const signals = process.binding('constants').os.signals;\n+const rootUser = common.isWindows ? false : process.getuid() === 0;\n \n-let invalidArgTypeError;\n-let invalidArgTypeErrorCount = 62;\n-\n-if (common.isWindows) {\n-  invalidArgTypeError =\n-    common.expectsError({ code: 'ERR_INVALID_ARG_TYPE', type: TypeError }, 42);\n-} else {\n-  invalidArgTypeError =\n-    common.expectsError({ code: 'ERR_INVALID_ARG_TYPE', type: TypeError },\n-                        invalidArgTypeErrorCount);\n-}\n+const invalidArgTypeError = common.expectsError(\n+  { code: 'ERR_INVALID_ARG_TYPE', type: TypeError },\n+  common.isWindows || rootUser ? 42 : 62);\n \n const invalidRangeError =\n   common.expectsError({ code: 'ERR_OUT_OF_RANGE', type: RangeError }, 20);\n@@ -64,7 +57,7 @@ function fail(option, value, message) {\n if (!common.isWindows) {\n   {\n     // Validate the uid option\n-    if (process.getuid() !== 0) {\n+    if (!rootUser) {\n       pass('uid', undefined);\n       pass('uid', null);\n       pass('uid', process.getuid());\n@@ -78,9 +71,6 @@ if (!common.isWindows) {\n       fail('uid', Infinity, invalidArgTypeError);\n       fail('uid', 3.1, invalidArgTypeError);\n       fail('uid', -3.1, invalidArgTypeError);\n-    } else {\n-      // Decrement invalidArgTypeErrorCount if validation isn't possible\n-      invalidArgTypeErrorCount -= 10;\n     }\n   }\n \n@@ -100,9 +90,6 @@ if (!common.isWindows) {\n       fail('gid', Infinity, invalidArgTypeError);\n       fail('gid', 3.1, invalidArgTypeError);\n       fail('gid', -3.1, invalidArgTypeError);\n-    } else {\n-      // Decrement invalidArgTypeErrorCount if validation isn't possible\n-      invalidArgTypeErrorCount -= 10;\n     }\n   }\n }"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 5,
        "deletions": 18
    }
}