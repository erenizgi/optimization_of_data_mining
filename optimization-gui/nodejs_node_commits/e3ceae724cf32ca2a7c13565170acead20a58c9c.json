{
    "author": "yhwang",
    "message": "crypto: add test case for AES key wrapping\n\nAdd test cases for AES key wrapping and only detect output length in\ncipher case. The reason being is the returned output length is\ninsufficient in AES key unwrapping case.\n\nPR-URL: https://github.com/nodejs/node/pull/20587\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>",
    "sha": "e3ceae724cf32ca2a7c13565170acead20a58c9c",
    "files": [
        {
            "sha": "79768e983b8155d2f051e1a8f4ab50939693c400",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e3ceae724cf32ca2a7c13565170acead20a58c9c/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/e3ceae724cf32ca2a7c13565170acead20a58c9c/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=e3ceae724cf32ca2a7c13565170acead20a58c9c",
            "patch": "@@ -3001,7 +3001,7 @@ CipherBase::UpdateResult CipherBase::Update(const char* data,\n   int buff_len = len + EVP_CIPHER_CTX_block_size(ctx_.get());\n   // For key wrapping algorithms, get output size by calling\n   // EVP_CipherUpdate() with null output.\n-  if (mode == EVP_CIPH_WRAP_MODE &&\n+  if (kind_ == kCipher && mode == EVP_CIPH_WRAP_MODE &&\n       EVP_CipherUpdate(ctx_.get(),\n                        nullptr,\n                        &buff_len,"
        },
        {
            "sha": "6fe35258f7d6b2ece0db64078638324b1c61208a",
            "filename": "test/parallel/test-crypto-aes-wrap.js",
            "status": "added",
            "additions": 62,
            "deletions": 0,
            "changes": 62,
            "blob_url": "https://github.com/nodejs/node/blob/e3ceae724cf32ca2a7c13565170acead20a58c9c/test%2Fparallel%2Ftest-crypto-aes-wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/e3ceae724cf32ca2a7c13565170acead20a58c9c/test%2Fparallel%2Ftest-crypto-aes-wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-aes-wrap.js?ref=e3ceae724cf32ca2a7c13565170acead20a58c9c",
            "patch": "@@ -0,0 +1,62 @@\n+'use strict';\n+const common = require('../common');\n+if (!common.hasCrypto)\n+  common.skip('missing crypto');\n+\n+const assert = require('assert');\n+const crypto = require('crypto');\n+\n+const test = [\n+  {\n+    algorithm: 'aes128-wrap',\n+    key: 'b26f309fbe57e9b3bb6ae5ef31d54450',\n+    iv: '3fd838af4093d749',\n+    text: '12345678123456781234567812345678'\n+  },\n+  {\n+    algorithm: 'id-aes128-wrap-pad',\n+    key: 'b26f309fbe57e9b3bb6ae5ef31d54450',\n+    iv: '3fd838af',\n+    text: '12345678123456781234567812345678123'\n+  },\n+  {\n+    algorithm: 'aes192-wrap',\n+    key: '40978085d68091f7dfca0d7dfc7a5ee76d2cc7f2f345a304',\n+    iv: '3fd838af4093d749',\n+    text: '12345678123456781234567812345678'\n+  },\n+  {\n+    algorithm: 'id-aes192-wrap-pad',\n+    key: '40978085d68091f7dfca0d7dfc7a5ee76d2cc7f2f345a304',\n+    iv: '3fd838af',\n+    text: '12345678123456781234567812345678123'\n+  },\n+  {\n+    algorithm: 'aes256-wrap',\n+    key: '29c9eab5ed5ad44134a1437fe2e673b4d88a5b7c72e68454fea08721392b7323',\n+    iv: '3fd838af4093d749',\n+    text: '12345678123456781234567812345678'\n+  },\n+  {\n+    algorithm: 'id-aes256-wrap-pad',\n+    key: '29c9eab5ed5ad44134a1437fe2e673b4d88a5b7c72e68454fea08721392b7323',\n+    iv: '3fd838af',\n+    text: '12345678123456781234567812345678123'\n+  },\n+];\n+\n+test.forEach((data) => {\n+  const cipher = crypto.createCipheriv(\n+    data.algorithm,\n+    Buffer.from(data.key, 'hex'),\n+    Buffer.from(data.iv, 'hex'));\n+  const ciphertext = cipher.update(data.text, 'utf8');\n+\n+  const decipher = crypto.createDecipheriv(\n+    data.algorithm,\n+    Buffer.from(data.key, 'hex'),\n+    Buffer.from(data.iv, 'hex'));\n+  const msg = decipher.update(ciphertext, 'buffer', 'utf8');\n+\n+  assert.strictEqual(msg, data.text, `${data.algorithm} test case failed`);\n+});"
        }
    ],
    "stats": {
        "total": 64,
        "additions": 63,
        "deletions": 1
    }
}