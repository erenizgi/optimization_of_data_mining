{
    "author": "devsnek",
    "message": "console: add table method\n\nPR-URL: https://github.com/nodejs/node/pull/18137\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "97ace0449292eab3f044158ba3787e6af5dd6f3a",
    "files": [
        {
            "sha": "72d80ab9e792ba96f58a69e5c92a78b64eac8cd0",
            "filename": "doc/api/console.md",
            "status": "modified",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/nodejs/node/blob/97ace0449292eab3f044158ba3787e6af5dd6f3a/doc%2Fapi%2Fconsole.md",
            "raw_url": "https://github.com/nodejs/node/raw/97ace0449292eab3f044158ba3787e6af5dd6f3a/doc%2Fapi%2Fconsole.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fconsole.md?ref=97ace0449292eab3f044158ba3787e6af5dd6f3a",
            "patch": "@@ -332,6 +332,47 @@ console.log('count:', count);\n \n See [`util.format()`][] for more information.\n \n+### console.table(tabularData[, properties])\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+* `tabularData` {any}\n+* `properties` {string[]} Alternate properties for constructing the table.\n+\n+Try to construct a table with the columns of the properties of `tabularData`\n+(or use `properties`) and rows of `tabularData` and logit. Falls back to just\n+logging the argument if it can’t be parsed as tabular.\n+\n+```js\n+// These can't be parsed as tabular data\n+console.table(Symbol());\n+// Symbol()\n+\n+console.table(undefined);\n+// undefined\n+```\n+\n+```js\n+console.table([{ a: 1, b: 'Y' }, { a: 'Z', b: 2 }]);\n+// ┌─────────┬─────┬─────┐\n+// │ (index) │  a  │  b  │\n+// ├─────────┼─────┼─────┤\n+// │    0    │  1  │ 'Y' │\n+// │    1    │ 'Z' │  2  │\n+// └─────────┴─────┴─────┘\n+```\n+\n+```js\n+console.table([{ a: 1, b: 'Y' }, { a: 'Z', b: 2 }], ['a']);\n+// ┌─────────┬─────┐\n+// │ (index) │  a  │\n+// ├─────────┼─────┤\n+// │    0    │  1  │\n+// │    1    │ 'Z' │\n+// └─────────┴─────┘\n+```\n+\n ### console.time(label)\n <!-- YAML\n added: v0.1.104"
        },
        {
            "sha": "456c0cc439f740ad54d58f7633b5fed29882c85e",
            "filename": "lib/console.js",
            "status": "modified",
            "additions": 128,
            "deletions": 1,
            "changes": 129,
            "blob_url": "https://github.com/nodejs/node/blob/97ace0449292eab3f044158ba3787e6af5dd6f3a/lib%2Fconsole.js",
            "raw_url": "https://github.com/nodejs/node/raw/97ace0449292eab3f044158ba3787e6af5dd6f3a/lib%2Fconsole.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fconsole.js?ref=97ace0449292eab3f044158ba3787e6af5dd6f3a",
            "patch": "@@ -23,11 +23,31 @@\n \n const {\n   isStackOverflowError,\n-  codes: { ERR_CONSOLE_WRITABLE_STREAM },\n+  codes: {\n+    ERR_CONSOLE_WRITABLE_STREAM,\n+    ERR_INVALID_ARG_TYPE,\n+  },\n } = require('internal/errors');\n+const { previewMapIterator, previewSetIterator } = require('internal/v8');\n+const { Buffer: { isBuffer } } = require('buffer');\n+const cliTable = require('internal/cli_table');\n const util = require('util');\n+const {\n+  isTypedArray, isSet, isMap, isSetIterator, isMapIterator,\n+} = util.types;\n const kCounts = Symbol('counts');\n \n+const {\n+  keys: ObjectKeys,\n+  values: ObjectValues,\n+} = Object;\n+const hasOwnProperty = Function.call.bind(Object.prototype.hasOwnProperty);\n+\n+const {\n+  isArray: ArrayIsArray,\n+  from: ArrayFrom,\n+} = Array;\n+\n // Track amount of indentation required via `console.group()`.\n const kGroupIndent = Symbol('groupIndent');\n \n@@ -242,6 +262,113 @@ Console.prototype.groupEnd = function groupEnd() {\n     this[kGroupIndent].slice(0, this[kGroupIndent].length - 2);\n };\n \n+const keyKey = 'Key';\n+const valuesKey = 'Values';\n+const indexKey = '(index)';\n+const iterKey = '(iteration index)';\n+\n+\n+const isArray = (v) => ArrayIsArray(v) || isTypedArray(v) || isBuffer(v);\n+const inspect = (v) => {\n+  const opt = { depth: 0, maxArrayLength: 3 };\n+  if (v !== null && typeof v === 'object' &&\n+      !isArray(v) && ObjectKeys(v).length > 2)\n+    opt.depth = -1;\n+  return util.inspect(v, opt);\n+};\n+\n+const getIndexArray = (length) => ArrayFrom({ length }, (_, i) => inspect(i));\n+\n+// https://console.spec.whatwg.org/#table\n+Console.prototype.table = function(tabularData, properties) {\n+  if (properties !== undefined && !ArrayIsArray(properties))\n+    throw new ERR_INVALID_ARG_TYPE('properties', 'Array', properties);\n+\n+  if (tabularData == null ||\n+      (typeof tabularData !== 'object' && typeof tabularData !== 'function'))\n+    return this.log(tabularData);\n+\n+  const final = (k, v) => this.log(cliTable(k, v));\n+\n+  const mapIter = isMapIterator(tabularData);\n+  if (mapIter)\n+    tabularData = previewMapIterator(tabularData);\n+\n+  if (mapIter || isMap(tabularData)) {\n+    const keys = [];\n+    const values = [];\n+    let length = 0;\n+    for (const [k, v] of tabularData) {\n+      keys.push(inspect(k));\n+      values.push(inspect(v));\n+      length++;\n+    }\n+    return final([\n+      iterKey, keyKey, valuesKey\n+    ], [\n+      getIndexArray(length),\n+      keys,\n+      values,\n+    ]);\n+  }\n+\n+  const setIter = isSetIterator(tabularData);\n+  if (setIter)\n+    tabularData = previewSetIterator(tabularData);\n+\n+  const setlike = setIter || isSet(tabularData);\n+  if (setlike ||\n+      (properties === undefined &&\n+       (isArray(tabularData) || isTypedArray(tabularData)))) {\n+    const values = [];\n+    let length = 0;\n+    for (const v of tabularData) {\n+      values.push(inspect(v));\n+      length++;\n+    }\n+    return final([setlike ? iterKey : indexKey, valuesKey], [\n+      getIndexArray(length),\n+      values,\n+    ]);\n+  }\n+\n+  const map = {};\n+  let hasPrimitives = false;\n+  const valuesKeyArray = [];\n+  const indexKeyArray = ObjectKeys(tabularData);\n+\n+  for (var i = 0; i < indexKeyArray.length; i++) {\n+    const item = tabularData[indexKeyArray[i]];\n+    const primitive = item === null ||\n+        (typeof item !== 'function' && typeof item !== 'object');\n+    if (properties === undefined && primitive) {\n+      hasPrimitives = true;\n+      valuesKeyArray[i] = inspect(item);\n+    } else {\n+      const keys = properties || ObjectKeys(item);\n+      for (const key of keys) {\n+        if (map[key] === undefined)\n+          map[key] = [];\n+        if ((primitive && properties) || !hasOwnProperty(item, key))\n+          map[key][i] = '';\n+        else\n+          map[key][i] = item == null ? item : inspect(item[key]);\n+      }\n+    }\n+  }\n+\n+  const keys = ObjectKeys(map);\n+  const values = ObjectValues(map);\n+  if (hasPrimitives) {\n+    keys.push(valuesKey);\n+    values.push(valuesKeyArray);\n+  }\n+  keys.unshift(indexKey);\n+  values.unshift(indexKeyArray);\n+\n+  return final(keys, values);\n+};\n+\n module.exports = new Console(process.stdout, process.stderr);\n module.exports.Console = Console;\n "
        },
        {
            "sha": "4c07d92eebdaa78496ad94605aed42340b38b142",
            "filename": "lib/internal/cli_table.js",
            "status": "added",
            "additions": 83,
            "deletions": 0,
            "changes": 83,
            "blob_url": "https://github.com/nodejs/node/blob/97ace0449292eab3f044158ba3787e6af5dd6f3a/lib%2Finternal%2Fcli_table.js",
            "raw_url": "https://github.com/nodejs/node/raw/97ace0449292eab3f044158ba3787e6af5dd6f3a/lib%2Finternal%2Fcli_table.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcli_table.js?ref=97ace0449292eab3f044158ba3787e6af5dd6f3a",
            "patch": "@@ -0,0 +1,83 @@\n+'use strict';\n+\n+const { Buffer } = require('buffer');\n+const { removeColors } = require('internal/util');\n+const HasOwnProperty = Function.call.bind(Object.prototype.hasOwnProperty);\n+\n+const tableChars = {\n+  /* eslint-disable node-core/non-ascii-character */\n+  middleMiddle: '─',\n+  rowMiddle: '┼',\n+  topRight: '┐',\n+  topLeft: '┌',\n+  leftMiddle: '├',\n+  topMiddle: '┬',\n+  bottomRight: '┘',\n+  bottomLeft: '└',\n+  bottomMiddle: '┴',\n+  rightMiddle: '┤',\n+  left: '│ ',\n+  right: ' │',\n+  middle: ' │ ',\n+  /* eslint-enable node-core/non-ascii-character */\n+};\n+\n+const countSymbols = (string) => {\n+  const normalized = removeColors(string).normalize('NFC');\n+  return Buffer.from(normalized, 'UCS-2').byteLength / 2;\n+};\n+\n+const renderRow = (row, columnWidths) => {\n+  let out = tableChars.left;\n+  for (var i = 0; i < row.length; i++) {\n+    const cell = row[i];\n+    const len = countSymbols(cell);\n+    const needed = (columnWidths[i] - len) / 2;\n+    // round(needed) + ceil(needed) will always add up to the amount\n+    // of spaces we need while also left justifying the output.\n+    out += `${' '.repeat(needed)}${cell}${' '.repeat(Math.ceil(needed))}`;\n+    if (i !== row.length - 1)\n+      out += tableChars.middle;\n+  }\n+  out += tableChars.right;\n+  return out;\n+};\n+\n+const table = (head, columns) => {\n+  const rows = [];\n+  const columnWidths = head.map((h) => countSymbols(h));\n+  const longestColumn = columns.reduce((n, a) => Math.max(n, a.length), 0);\n+\n+  for (var i = 0; i < head.length; i++) {\n+    const column = columns[i];\n+    for (var j = 0; j < longestColumn; j++) {\n+      if (!rows[j])\n+        rows[j] = [];\n+      const v = rows[j][i] = HasOwnProperty(column, j) ? column[j] : '';\n+      const width = columnWidths[i] || 0;\n+      const counted = countSymbols(v);\n+      columnWidths[i] = Math.max(width, counted);\n+    }\n+  }\n+\n+  const divider = columnWidths.map((i) =>\n+    tableChars.middleMiddle.repeat(i + 2));\n+\n+  const tl = tableChars.topLeft;\n+  const tr = tableChars.topRight;\n+  const lm = tableChars.leftMiddle;\n+  let result = `${tl}${divider.join(tableChars.topMiddle)}${tr}\n+${renderRow(head, columnWidths)}\n+${lm}${divider.join(tableChars.rowMiddle)}${tableChars.rightMiddle}\n+`;\n+\n+  for (const row of rows)\n+    result += `${renderRow(row, columnWidths)}\\n`;\n+\n+  result += `${tableChars.bottomLeft}${\n+    divider.join(tableChars.bottomMiddle)}${tableChars.bottomRight}`;\n+\n+  return result;\n+};\n+\n+module.exports = table;"
        },
        {
            "sha": "cb305b93e9ff4c01ab3395a296918a4504e3da68",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/97ace0449292eab3f044158ba3787e6af5dd6f3a/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/97ace0449292eab3f044158ba3787e6af5dd6f3a/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=97ace0449292eab3f044158ba3787e6af5dd6f3a",
            "patch": "@@ -81,6 +81,7 @@\n       'lib/zlib.js',\n       'lib/internal/async_hooks.js',\n       'lib/internal/buffer.js',\n+      'lib/internal/cli_table.js',\n       'lib/internal/child_process.js',\n       'lib/internal/cluster/child.js',\n       'lib/internal/cluster/master.js',"
        },
        {
            "sha": "39e9099dd717d4fde27c7bca424871797b6ac3a5",
            "filename": "test/parallel/test-console-table.js",
            "status": "added",
            "additions": 196,
            "deletions": 0,
            "changes": 196,
            "blob_url": "https://github.com/nodejs/node/blob/97ace0449292eab3f044158ba3787e6af5dd6f3a/test%2Fparallel%2Ftest-console-table.js",
            "raw_url": "https://github.com/nodejs/node/raw/97ace0449292eab3f044158ba3787e6af5dd6f3a/test%2Fparallel%2Ftest-console-table.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-console-table.js?ref=97ace0449292eab3f044158ba3787e6af5dd6f3a",
            "patch": "@@ -0,0 +1,196 @@\n+'use strict';\n+\n+const common = require('../common');\n+\n+const assert = require('assert');\n+const { Console } = require('console');\n+\n+const queue = [];\n+\n+const console = new Console({ write: (x) => {\n+  queue.push(x);\n+}, removeListener: () => {} }, process.stderr, false);\n+\n+function test(data, only, expected) {\n+  if (arguments.length === 2) {\n+    expected = only;\n+    only = undefined;\n+  }\n+  console.table(data, only);\n+  assert.strictEqual(queue.shift(), expected.trimLeft());\n+}\n+\n+common.expectsError(() => console.table([], false), {\n+  code: 'ERR_INVALID_ARG_TYPE',\n+});\n+\n+test(null, 'null\\n');\n+test(undefined, 'undefined\\n');\n+test(false, 'false\\n');\n+test('hi', 'hi\\n');\n+test(Symbol(), 'Symbol()\\n');\n+\n+test([1, 2, 3], `\n+┌─────────┬────────┐\n+│ (index) │ Values │\n+├─────────┼────────┤\n+│    0    │   1    │\n+│    1    │   2    │\n+│    2    │   3    │\n+└─────────┴────────┘\n+`);\n+\n+test([Symbol(), 5, [10]], `\n+┌─────────┬──────────┐\n+│ (index) │  Values  │\n+├─────────┼──────────┤\n+│    0    │ Symbol() │\n+│    1    │    5     │\n+│    2    │  [ 10 ]  │\n+└─────────┴──────────┘\n+`);\n+\n+test([undefined, 5], `\n+┌─────────┬───────────┐\n+│ (index) │  Values   │\n+├─────────┼───────────┤\n+│    0    │ undefined │\n+│    1    │     5     │\n+└─────────┴───────────┘\n+`);\n+\n+test({ a: 1, b: Symbol(), c: [10] }, `\n+┌─────────┬────┬──────────┐\n+│ (index) │ 0  │  Values  │\n+├─────────┼────┼──────────┤\n+│    a    │    │    1     │\n+│    b    │    │ Symbol() │\n+│    c    │ 10 │          │\n+└─────────┴────┴──────────┘\n+`);\n+\n+test(new Map([ ['a', 1], [Symbol(), [2]] ]), `\n+┌───────────────────┬──────────┬────────┐\n+│ (iteration index) │   Key    │ Values │\n+├───────────────────┼──────────┼────────┤\n+│         0         │   'a'    │   1    │\n+│         1         │ Symbol() │ [ 2 ]  │\n+└───────────────────┴──────────┴────────┘\n+`);\n+\n+test(new Set([1, 2, Symbol()]), `\n+┌───────────────────┬──────────┐\n+│ (iteration index) │  Values  │\n+├───────────────────┼──────────┤\n+│         0         │    1     │\n+│         1         │    2     │\n+│         2         │ Symbol() │\n+└───────────────────┴──────────┘\n+`);\n+\n+test({ a: 1, b: 2 }, ['a'], `\n+┌─────────┬───┐\n+│ (index) │ a │\n+├─────────┼───┤\n+│    a    │   │\n+│    b    │   │\n+└─────────┴───┘\n+`);\n+\n+test([{ a: 1, b: 2 }, { a: 3, c: 4 }], ['a'], `\n+┌─────────┬───┐\n+│ (index) │ a │\n+├─────────┼───┤\n+│    0    │ 1 │\n+│    1    │ 3 │\n+└─────────┴───┘\n+`);\n+\n+test(new Map([[1, 1], [2, 2], [3, 3]]).entries(), `\n+┌───────────────────┬─────┬────────┐\n+│ (iteration index) │ Key │ Values │\n+├───────────────────┼─────┼────────┤\n+│         0         │  1  │   1    │\n+│         1         │  2  │   2    │\n+│         2         │  3  │   3    │\n+└───────────────────┴─────┴────────┘\n+`);\n+\n+test(new Set([1, 2, 3]).values(), `\n+┌───────────────────┬────────┐\n+│ (iteration index) │ Values │\n+├───────────────────┼────────┤\n+│         0         │   1    │\n+│         1         │   2    │\n+│         2         │   3    │\n+└───────────────────┴────────┘\n+`);\n+\n+\n+test({ a: { a: 1, b: 2, c: 3 } }, `\n+┌─────────┬───┬───┬───┐\n+│ (index) │ a │ b │ c │\n+├─────────┼───┼───┼───┤\n+│    a    │ 1 │ 2 │ 3 │\n+└─────────┴───┴───┴───┘\n+`);\n+\n+test({ a: [1, 2] }, `\n+┌─────────┬───┬───┐\n+│ (index) │ 0 │ 1 │\n+├─────────┼───┼───┤\n+│    a    │ 1 │ 2 │\n+└─────────┴───┴───┘\n+`);\n+\n+test({ a: [1, 2, 3, 4, 5], b: 5, c: { e: 5 } }, `\n+┌─────────┬───┬───┬───┬───┬───┬───┬────────┐\n+│ (index) │ 0 │ 1 │ 2 │ 3 │ 4 │ e │ Values │\n+├─────────┼───┼───┼───┼───┼───┼───┼────────┤\n+│    a    │ 1 │ 2 │ 3 │ 4 │ 5 │   │        │\n+│    b    │   │   │   │   │   │   │   5    │\n+│    c    │   │   │   │   │   │ 5 │        │\n+└─────────┴───┴───┴───┴───┴───┴───┴────────┘\n+`);\n+\n+test(new Uint8Array([1, 2, 3]), `\n+┌─────────┬────────┐\n+│ (index) │ Values │\n+├─────────┼────────┤\n+│    0    │   1    │\n+│    1    │   2    │\n+│    2    │   3    │\n+└─────────┴────────┘\n+`);\n+\n+test(Buffer.from([1, 2, 3]), `\n+┌─────────┬────────┐\n+│ (index) │ Values │\n+├─────────┼────────┤\n+│    0    │   1    │\n+│    1    │   2    │\n+│    2    │   3    │\n+└─────────┴────────┘\n+`);\n+\n+test({ a: undefined }, ['x'], `\n+┌─────────┬───┐\n+│ (index) │ x │\n+├─────────┼───┤\n+│    a    │   │\n+└─────────┴───┘\n+`);\n+\n+test([], `\n+┌─────────┬────────┐\n+│ (index) │ Values │\n+├─────────┼────────┤\n+└─────────┴────────┘\n+`);\n+\n+test(new Map(), `\n+┌───────────────────┬─────┬────────┐\n+│ (iteration index) │ Key │ Values │\n+├───────────────────┼─────┼────────┤\n+└───────────────────┴─────┴────────┘\n+`);"
        }
    ],
    "stats": {
        "total": 450,
        "additions": 449,
        "deletions": 1
    }
}