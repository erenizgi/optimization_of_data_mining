{
    "author": "jasnell",
    "message": "perf_hooks: make PerformanceObserver an AsyncResource\n\nPR-URL: https://github.com/nodejs/node/pull/18789\nReviewed-By: Ali Ijaz Sheikh <ofrobots@google.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "009e41826f47c595ca994f673023f9380198be36",
    "files": [
        {
            "sha": "025fa9edd06de16224c6cb82ca63ee6e02831ea3",
            "filename": "lib/perf_hooks.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/009e41826f47c595ca994f673023f9380198be36/lib%2Fperf_hooks.js",
            "raw_url": "https://github.com/nodejs/node/raw/009e41826f47c595ca994f673023f9380198be36/lib%2Fperf_hooks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fperf_hooks.js?ref=009e41826f47c595ca994f673023f9380198be36",
            "patch": "@@ -36,6 +36,7 @@ const {\n   NODE_PERFORMANCE_MILESTONE_PRELOAD_MODULE_LOAD_END\n } = constants;\n \n+const { AsyncResource } = require('async_hooks');\n const L = require('internal/linkedlist');\n const kInspect = require('internal/util').customInspectSymbol;\n const { inherits } = require('util');\n@@ -317,12 +318,13 @@ class PerformanceObserverEntryList {\n   }\n }\n \n-class PerformanceObserver {\n+class PerformanceObserver extends AsyncResource {\n   constructor(callback) {\n     if (typeof callback !== 'function') {\n       const errors = lazyErrors();\n       throw new errors.TypeError('ERR_INVALID_CALLBACK');\n     }\n+    super('PerformanceObserver');\n     Object.defineProperties(this, {\n       [kTypes]: {\n         enumerable: false,\n@@ -568,7 +570,7 @@ function getObserversList(type) {\n \n function doNotify() {\n   this[kQueued] = false;\n-  this[kCallback](this[kBuffer], this);\n+  this.runInAsyncScope(this[kCallback], this, this[kBuffer], this);\n   this[kBuffer][kEntries] = [];\n   L.init(this[kBuffer][kEntries]);\n }"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 4,
        "deletions": 2
    }
}