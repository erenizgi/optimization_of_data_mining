{
    "author": "cjihrig",
    "message": "report: refactor triggerReport()\n\nThis commit fixes the triggerReport() argument validation. The\nexisting test is also updated, as it was not passing the Error\nobject to triggerReport().\n\nPR-URL: https://github.com/nodejs/node/pull/26268\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "d64aea059902efb32f01c46c9ac0467662d93628",
    "files": [
        {
            "sha": "50ddc8c4b379a5a5449a58dfdd9a45b77f673690",
            "filename": "lib/internal/process/report.js",
            "status": "modified",
            "additions": 11,
            "deletions": 13,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/d64aea059902efb32f01c46c9ac0467662d93628/lib%2Finternal%2Fprocess%2Freport.js",
            "raw_url": "https://github.com/nodejs/node/raw/d64aea059902efb32f01c46c9ac0467662d93628/lib%2Finternal%2Fprocess%2Freport.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Freport.js?ref=d64aea059902efb32f01c46c9ac0467662d93628",
            "patch": "@@ -75,20 +75,18 @@ const report = {\n   },\n   triggerReport(file, err) {\n     emitExperimentalWarning('report');\n-    if (err == null) {\n-      if (file == null) {\n-        return nr.triggerReport(new ERR_SYNTHETIC().stack);\n-      }\n-      if (typeof file !== 'string')\n-        throw new ERR_INVALID_ARG_TYPE('file', 'String', file);\n-      return nr.triggerReport(file, new ERR_SYNTHETIC().stack);\n-    }\n-    if (typeof err !== 'object')\n-      throw new ERR_INVALID_ARG_TYPE('err', 'Object', err);\n-    if (file == null)\n-      return nr.triggerReport(err.stack);\n-    if (typeof file !== 'string')\n+\n+    if (typeof file === 'object' && file !== null) {\n+      err = file;\n+      file = undefined;\n+    } else if (file !== undefined && typeof file !== 'string') {\n       throw new ERR_INVALID_ARG_TYPE('file', 'String', file);\n+    } else if (err === undefined) {\n+      err = new ERR_SYNTHETIC();\n+    } else if (err === null || typeof err !== 'object') {\n+      throw new ERR_INVALID_ARG_TYPE('err', 'Object', err);\n+    }\n+\n     return nr.triggerReport(file, err.stack);\n   },\n   getReport(err) {"
        },
        {
            "sha": "0e3f8981b71aace7e770665c65f1c04b8ef92ad5",
            "filename": "src/node_report_module.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/d64aea059902efb32f01c46c9ac0467662d93628/src%2Fnode_report_module.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d64aea059902efb32f01c46c9ac0467662d93628/src%2Fnode_report_module.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_report_module.cc?ref=d64aea059902efb32f01c46c9ac0467662d93628",
            "patch": "@@ -48,12 +48,11 @@ void TriggerReport(const FunctionCallbackInfo<Value>& info) {\n   std::string filename;\n   Local<String> stackstr;\n \n-  if (info.Length() == 1) {\n-    stackstr = info[0].As<String>();\n-  } else {\n+  CHECK_EQ(info.Length(), 2);\n+  stackstr = info[1].As<String>();\n+\n+  if (info[0]->IsString())\n     filename = *String::Utf8Value(isolate, info[0]);\n-    stackstr = info[1].As<String>();\n-  }\n \n   filename = TriggerNodeReport(\n       isolate, env, \"JavaScript API\", __func__, filename, stackstr);"
        },
        {
            "sha": "9bf59ec425c3a827caa5932172db9a75f2e9c2e1",
            "filename": "test/node-report/test-api-pass-error.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/d64aea059902efb32f01c46c9ac0467662d93628/test%2Fnode-report%2Ftest-api-pass-error.js",
            "raw_url": "https://github.com/nodejs/node/raw/d64aea059902efb32f01c46c9ac0467662d93628/test%2Fnode-report%2Ftest-api-pass-error.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fnode-report%2Ftest-api-pass-error.js?ref=d64aea059902efb32f01c46c9ac0467662d93628",
            "patch": "@@ -7,8 +7,8 @@ const assert = require('assert');\n if (process.argv[2] === 'child') {\n   try {\n     throw new Error('Testing error handling');\n-  } catch {\n-    process.report.triggerReport();\n+  } catch (err) {\n+    process.report.triggerReport(err);\n   }\n } else {\n   const helper = require('../common/report.js');"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 17,
        "deletions": 20
    }
}