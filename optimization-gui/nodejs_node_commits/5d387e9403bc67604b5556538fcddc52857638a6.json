{
    "author": "vsemozhetbyt",
    "message": "tools: fix nits in tools/doc/type-parser.js\n\nPR-URL: https://github.com/nodejs/node/pull/19612\nReviewed-By: Shingo Inoue <leko.noor@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Khaidi Chu <i@2333.moe>",
    "sha": "5d387e9403bc67604b5556538fcddc52857638a6",
    "files": [
        {
            "sha": "dbf1538c10f64bee2b852909b6df65666186b5e5",
            "filename": "tools/doc/type-parser.js",
            "status": "modified",
            "additions": 44,
            "deletions": 39,
            "changes": 83,
            "blob_url": "https://github.com/nodejs/node/blob/5d387e9403bc67604b5556538fcddc52857638a6/tools%2Fdoc%2Ftype-parser.js",
            "raw_url": "https://github.com/nodejs/node/raw/5d387e9403bc67604b5556538fcddc52857638a6/tools%2Fdoc%2Ftype-parser.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Ftype-parser.js?ref=5d387e9403bc67604b5556538fcddc52857638a6",
            "patch": "@@ -1,7 +1,7 @@\n 'use strict';\n-const nodeDocUrl = '';\n+\n const jsDocPrefix = 'https://developer.mozilla.org/en-US/docs/Web/JavaScript/';\n-const jsDocUrl = `${jsDocPrefix}Reference/Global_Objects/`;\n+\n const jsPrimitiveUrl = `${jsDocPrefix}Data_structures`;\n const jsPrimitives = {\n   'boolean': 'Boolean',\n@@ -12,6 +12,8 @@ const jsPrimitives = {\n   'symbol': 'Symbol',\n   'undefined': 'Undefined'\n };\n+\n+const jsGlobalObjectsUrl = `${jsDocPrefix}Reference/Global_Objects/`;\n const jsGlobalTypes = [\n   'Array', 'ArrayBuffer', 'AsyncFunction', 'DataView', 'Date', 'Error',\n   'EvalError', 'Float32Array', 'Float64Array', 'Function', 'Generator',\n@@ -21,7 +23,8 @@ const jsGlobalTypes = [\n   'Uint16Array', 'Uint32Array', 'Uint8Array', 'Uint8ClampedArray', 'WeakMap',\n   'WeakSet'\n ];\n-const typeMap = {\n+\n+const customTypesMap = {\n   'Iterable':\n     `${jsDocPrefix}Reference/Iteration_protocols#The_iterable_protocol`,\n   'Iterator':\n@@ -96,41 +99,43 @@ const typeMap = {\n \n const arrayPart = /(?:\\[])+$/;\n \n-module.exports = {\n-  toLink: function(typeInput) {\n-    const typeLinks = [];\n-    typeInput = typeInput.replace('{', '').replace('}', '');\n-    const typeTexts = typeInput.split('|');\n-\n-    typeTexts.forEach(function(typeText) {\n-      typeText = typeText.trim();\n-      if (typeText) {\n-        let typeUrl = null;\n-\n-        // To support type[], type[][] etc., we store the full string\n-        // and use the bracket-less version to lookup the type URL\n-        const typeTextFull = typeText;\n-        typeText = typeText.replace(arrayPart, '');\n-\n-        const primitive = jsPrimitives[typeText.toLowerCase()];\n-\n-        if (primitive !== undefined) {\n-          typeUrl = `${jsPrimitiveUrl}#${primitive}_type`;\n-        } else if (jsGlobalTypes.indexOf(typeText) !== -1) {\n-          typeUrl = jsDocUrl + typeText;\n-        } else if (typeMap[typeText]) {\n-          typeUrl = nodeDocUrl + typeMap[typeText];\n-        }\n-\n-        if (typeUrl) {\n-          typeLinks.push(`\n-            <a href=\"${typeUrl}\" class=\"type\">&lt;${typeTextFull}&gt;</a>`);\n-        } else {\n-          typeLinks.push(`<span class=\"type\">&lt;${typeTextFull}&gt;</span>`);\n-        }\n+function toLink(typeInput) {\n+  const typeLinks = [];\n+  typeInput = typeInput.replace('{', '').replace('}', '');\n+  const typeTexts = typeInput.split('|');\n+\n+  typeTexts.forEach((typeText) => {\n+    typeText = typeText.trim();\n+    if (typeText) {\n+      let typeUrl = null;\n+\n+      // To support type[], type[][] etc., we store the full string\n+      // and use the bracket-less version to lookup the type URL\n+      const typeTextFull = typeText;\n+      typeText = typeText.replace(arrayPart, '');\n+\n+      const primitive = jsPrimitives[typeText.toLowerCase()];\n+\n+      if (primitive !== undefined) {\n+        typeUrl = `${jsPrimitiveUrl}#${primitive}_type`;\n+      } else if (jsGlobalTypes.includes(typeText)) {\n+        typeUrl = `${jsGlobalObjectsUrl}${typeText}`;\n+      } else if (customTypesMap[typeText]) {\n+        typeUrl = customTypesMap[typeText];\n       }\n-    });\n \n-    return typeLinks.length ? typeLinks.join(' | ') : typeInput;\n-  }\n-};\n+      if (typeUrl) {\n+        typeLinks.push(\n+          `<a href=\"${typeUrl}\" class=\"type\">&lt;${typeTextFull}&gt;</a>`);\n+      } else {\n+        typeLinks.push(`<span class=\"type\">&lt;${typeTextFull}&gt;</span>`);\n+      }\n+    } else {\n+      throw new Error(`Empty type slot: ${typeInput}`);\n+    }\n+  });\n+\n+  return typeLinks.length ? typeLinks.join(' | ') : typeInput;\n+}\n+\n+module.exports = { toLink };"
        }
    ],
    "stats": {
        "total": 83,
        "additions": 44,
        "deletions": 39
    }
}