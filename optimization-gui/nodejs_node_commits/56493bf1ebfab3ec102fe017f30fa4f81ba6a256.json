{
    "author": "danbev",
    "message": "tools: add bash completion for node\n\nThis commit adds a --completion-bash option to node which can be\nsourced to provide bash code completion for node options.\n\nUsage:\n$ node --completion-bash  > node_bash_completion\n$ source node_bash_completion\n$ node --[tab]\n\nPR-URL: https://github.com/nodejs/node/pull/20713\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>",
    "sha": "56493bf1ebfab3ec102fe017f30fa4f81ba6a256",
    "files": [
        {
            "sha": "3f5441b82e7ce810872366781da794fb6211f982",
            "filename": "doc/api/cli.md",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/doc%2Fapi%2Fcli.md",
            "raw_url": "https://github.com/nodejs/node/raw/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/doc%2Fapi%2Fcli.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fcli.md?ref=56493bf1ebfab3ec102fe017f30fa4f81ba6a256",
            "patch": "@@ -52,6 +52,17 @@ If this flag is passed, the behavior can still be set to not abort through\n [`process.setUncaughtExceptionCaptureCallback()`][] (and through usage of the\n `domain` module that uses it).\n \n+### `--completion-bash`\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+Print source-able bash completion script for Node.js.\n+```console\n+$ node --completion-bash > node_bash_completion\n+$ source node_bash_completion\n+```\n+\n ### `--enable-fips`\n <!-- YAML\n added: v6.0.0"
        },
        {
            "sha": "ad46d58d1f39fda521e0680a3c706b8e8cd16ac0",
            "filename": "doc/node.1",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/doc%2Fnode.1",
            "raw_url": "https://github.com/nodejs/node/raw/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/doc%2Fnode.1",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fnode.1?ref=56493bf1ebfab3ec102fe017f30fa4f81ba6a256",
            "patch": "@@ -75,6 +75,9 @@ the next argument will be used as a script filename.\n .It Fl -abort-on-uncaught-exception\n Aborting instead of exiting causes a core file to be generated for analysis.\n .\n+.It Fl -completion-bash\n+Print source-able bash completion script for Node.js.\n+.\n .It Fl -enable-fips\n Enable FIPS-compliant crypto at startup.\n Requires Node.js to be built with"
        },
        {
            "sha": "7d2ffbe901d285b7f643254d4f2f3290b47b2425",
            "filename": "lib/internal/bash_completion.js",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/lib%2Finternal%2Fbash_completion.js",
            "raw_url": "https://github.com/nodejs/node/raw/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/lib%2Finternal%2Fbash_completion.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbash_completion.js?ref=56493bf1ebfab3ec102fe017f30fa4f81ba6a256",
            "patch": "@@ -0,0 +1,25 @@\n+'use strict';\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { getOptions } = internalBinding('options');\n+\n+function print(stream) {\n+  const { options, aliases } = getOptions();\n+  const all_opts = [...options.keys(), ...aliases.keys()];\n+\n+  stream.write(`_node_complete() {\n+  local cur_word options\n+  cur_word=\"\\${COMP_WORDS[COMP_CWORD]}\"\n+  if [[ \"\\${cur_word}\" == -* ]] ; then\n+    COMPREPLY=( $(compgen -W '${all_opts.join(' ')}' -- \"\\${cur_word}\") )\n+    return 0\n+  else\n+    COMPREPLY=( $(compgen -f \"\\${cur_word}\") )\n+    return 0\n+  fi\n+}\n+complete -F _node_complete node node_g`);\n+}\n+\n+module.exports = {\n+  print\n+};"
        },
        {
            "sha": "8537131e8be9a7258cfdd66f080df5b9b6e42a71",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=56493bf1ebfab3ec102fe017f30fa4f81ba6a256",
            "patch": "@@ -111,11 +111,17 @@\n       NativeModule.require('internal/inspector_async_hook').setup();\n     }\n \n-    if (internalBinding('options').getOptions('--help')) {\n+    const options = internalBinding('options');\n+    if (options.getOptions('--help')) {\n       NativeModule.require('internal/print_help').print(process.stdout);\n       return;\n     }\n \n+    if (options.getOptions('--completion-bash')) {\n+      NativeModule.require('internal/bash_completion').print(process.stdout);\n+      return;\n+    }\n+\n     if (isMainThread) {\n       mainThreadSetup.setupChildProcessIpcChannel();\n     }"
        },
        {
            "sha": "5f6dfa5364d294ac15e28f41e97de9bfa21463e4",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=56493bf1ebfab3ec102fe017f30fa4f81ba6a256",
            "patch": "@@ -84,6 +84,7 @@\n       'lib/zlib.js',\n       'lib/internal/assert.js',\n       'lib/internal/async_hooks.js',\n+      'lib/internal/bash_completion.js',\n       'lib/internal/buffer.js',\n       'lib/internal/cli_table.js',\n       'lib/internal/child_process.js',"
        },
        {
            "sha": "1a614d0e771a8acca7cb29850f56abb40f2cdc46",
            "filename": "src/node_options.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/src%2Fnode_options.cc",
            "raw_url": "https://github.com/nodejs/node/raw/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/src%2Fnode_options.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.cc?ref=56493bf1ebfab3ec102fe017f30fa4f81ba6a256",
            "patch": "@@ -221,6 +221,9 @@ PerProcessOptionsParser::PerProcessOptionsParser() {\n             kAllowedInEnvironment);\n \n   AddOption(\"--security-reverts\", \"\", &PerProcessOptions::security_reverts);\n+  AddOption(\"--completion-bash\",\n+            \"print source-able bash completion script\",\n+            &PerProcessOptions::print_bash_completion);\n   AddOption(\"--help\",\n             \"print node command line options\",\n             &PerProcessOptions::print_help);"
        },
        {
            "sha": "4b9ee000367405c8c2708ad56d0aff89493d4b2a",
            "filename": "src/node_options.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/src%2Fnode_options.h",
            "raw_url": "https://github.com/nodejs/node/raw/56493bf1ebfab3ec102fe017f30fa4f81ba6a256/src%2Fnode_options.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.h?ref=56493bf1ebfab3ec102fe017f30fa4f81ba6a256",
            "patch": "@@ -112,6 +112,7 @@ class PerProcessOptions {\n   bool zero_fill_all_buffers = false;\n \n   std::vector<std::string> security_reverts;\n+  bool print_bash_completion = false;\n   bool print_help = false;\n   bool print_v8_help = false;\n   bool print_version = false;"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 51,
        "deletions": 1
    }
}