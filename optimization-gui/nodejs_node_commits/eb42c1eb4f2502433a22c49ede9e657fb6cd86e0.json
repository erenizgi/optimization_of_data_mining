{
    "author": "antsmartian",
    "message": "repl: handle buffered string logic on finish\n\nLooks like `clearBufferedCommand` will be called on almost all flows.\nHence history was broken.\n\nPR-URL: https://github.com/nodejs/node/pull/24389\nFixes: https://github.com/nodejs/node/issues/24385\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>",
    "sha": "eb42c1eb4f2502433a22c49ede9e657fb6cd86e0",
    "files": [
        {
            "sha": "b293292d83770e3a1aa0299645322f5f99896b5c",
            "filename": "lib/readline.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/eb42c1eb4f2502433a22c49ede9e657fb6cd86e0/lib%2Freadline.js",
            "raw_url": "https://github.com/nodejs/node/raw/eb42c1eb4f2502433a22c49ede9e657fb6cd86e0/lib%2Freadline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Freadline.js?ref=eb42c1eb4f2502433a22c49ede9e657fb6cd86e0",
            "patch": "@@ -348,9 +348,9 @@ Interface.prototype.undoHistory = function() {\n \n // If it's a multiline code, then add history\n // accordingly.\n-Interface.prototype.multilineHistory = function() {\n-  // check if we got a multiline code\n-  if (this.multiline !== '' && this.terminal) {\n+Interface.prototype.multilineHistory = function(clearBuffer) {\n+  // if not clear buffer, add multiline history\n+  if (!clearBuffer && this.terminal) {\n     const dupIndex = this.history.indexOf(this.multiline);\n     if (dupIndex !== -1) this.history.splice(dupIndex, 1);\n     // Remove the last entered line as multiline"
        },
        {
            "sha": "5dbd02fd231cd18c4d515ab1c53abcd9b72e5da2",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/eb42c1eb4f2502433a22c49ede9e657fb6cd86e0/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/eb42c1eb4f2502433a22c49ede9e657fb6cd86e0/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=eb42c1eb4f2502433a22c49ede9e657fb6cd86e0",
            "patch": "@@ -667,6 +667,13 @@ function REPLServer(prompt,\n         }\n       }\n \n+      // handle multiline history\n+      if (self[kBufferedCommandSymbol].length)\n+        REPLServer.super_.prototype.multilineHistory.call(self, false);\n+      else {\n+        REPLServer.super_.prototype.multilineHistory.call(self, true);\n+      }\n+\n       // Clear buffer if no SyntaxErrors\n       self.clearBufferedCommand();\n       sawCtrlD = false;\n@@ -773,7 +780,6 @@ exports.start = function(prompt,\n \n REPLServer.prototype.clearBufferedCommand = function clearBufferedCommand() {\n   this[kBufferedCommandSymbol] = '';\n-  REPLServer.super_.prototype.multilineHistory.call(this);\n };\n \n REPLServer.prototype.close = function close() {"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 10,
        "deletions": 4
    }
}