{
    "author": "BridgeAR",
    "message": "util: wrap error in brackets without stack\n\nThis aligns the visualization of an error with no stack traces set\nto zero just as it is done in case the error has no stack trace.\n\nPR-URL: https://github.com/nodejs/node/pull/20802\nRefs: https://github.com/nodejs/node/issues/20253\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "afd290d22475f268010387bec61b8ceb5a51a46b",
    "files": [
        {
            "sha": "2c618562170f7276a8ebadaaf45a81cb94e9ddf2",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/afd290d22475f268010387bec61b8ceb5a51a46b/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/afd290d22475f268010387bec61b8ceb5a51a46b/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=afd290d22475f268010387bec61b8ceb5a51a46b",
            "patch": "@@ -585,9 +585,13 @@ function formatValue(ctx, value, recurseTimes, ln) {\n       base = `${dateToISOString.call(value)}`;\n     } else if (isError(value)) {\n       // Make error with message first say the error\n+      base = formatError(value);\n+      // Wrap the error in brackets in case it has no stack trace.\n+      if (base.indexOf('\\n    at') === -1) {\n+        base = `[${base}]`;\n+      }\n       if (keyLength === 0)\n-        return formatError(value);\n-      base = `${formatError(value)}`;\n+        return base;\n     } else if (isAnyArrayBuffer(value)) {\n       // Fast path for ArrayBuffer and SharedArrayBuffer.\n       // Can't do the same for DataView because it has a non-primitive\n@@ -739,7 +743,7 @@ function formatPrimitive(fn, value, ctx) {\n }\n \n function formatError(value) {\n-  return value.stack || `[${errorToString.call(value)}]`;\n+  return value.stack || errorToString.call(value);\n }\n \n function formatObject(ctx, value, recurseTimes, keys) {"
        },
        {
            "sha": "0b31c41b292db4869563984ee9f84df096003ee9",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 18,
            "deletions": 6,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/afd290d22475f268010387bec61b8ceb5a51a46b/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/afd290d22475f268010387bec61b8ceb5a51a46b/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=afd290d22475f268010387bec61b8ceb5a51a46b",
            "patch": "@@ -496,12 +496,12 @@ assert.strictEqual(util.inspect(-5e-324), '-5e-324');\n \n // Exceptions should print the error message, not '{}'.\n {\n-  const errors = [];\n-  errors.push(new Error());\n-  errors.push(new Error('FAIL'));\n-  errors.push(new TypeError('FAIL'));\n-  errors.push(new SyntaxError('FAIL'));\n-  errors.forEach((err) => {\n+  [\n+    new Error(),\n+    new Error('FAIL'),\n+    new TypeError('FAIL'),\n+    new SyntaxError('FAIL')\n+  ].forEach((err) => {\n     assert.strictEqual(util.inspect(err), err.stack);\n   });\n   try {\n@@ -515,6 +515,18 @@ assert.strictEqual(util.inspect(-5e-324), '-5e-324');\n   assert(ex.includes('[message]'));\n }\n \n+{\n+  const tmp = Error.stackTraceLimit;\n+  Error.stackTraceLimit = 0;\n+  const err = new Error('foo');\n+  assert.strictEqual(util.inspect(err), '[Error: foo]');\n+  assert(err.stack);\n+  delete err.stack;\n+  assert(!err.stack);\n+  assert.strictEqual(util.inspect(err), '[Error: foo]');\n+  Error.stackTraceLimit = tmp;\n+}\n+\n // Doesn't capture stack trace.\n {\n   function BadCustomError(msg) {"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 25,
        "deletions": 9
    }
}