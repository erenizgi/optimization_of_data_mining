{
    "author": "santigimeno",
    "message": "test: fix flaky http-client-timeout-agent\n\nClose the connection immediately after receiving the `end` event to\navoid that the `timeout` event is fired before the connection closes\ngracefully.\nMove the test back to parallel.\n\nPR-URL: https://github.com/nodejs/node/pull/19856\nFixes: https://github.com/nodejs/node/issues/19804\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Rich Trott <rtrott@gmail.com>",
    "sha": "5b8c62c60d63a0da00da20823ce6fed7039036a7",
    "files": [
        {
            "sha": "8ce14f865c269cf902d107738a324b5a729822b4",
            "filename": "test/parallel/test-http-client-timeout-agent.js",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/5b8c62c60d63a0da00da20823ce6fed7039036a7/test%2Fparallel%2Ftest-http-client-timeout-agent.js",
            "raw_url": "https://github.com/nodejs/node/raw/5b8c62c60d63a0da00da20823ce6fed7039036a7/test%2Fparallel%2Ftest-http-client-timeout-agent.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-client-timeout-agent.js?ref=5b8c62c60d63a0da00da20823ce6fed7039036a7",
            "patch": "@@ -46,11 +46,10 @@ const server = http.createServer(function(req, res) {\n \n server.listen(0, options.host, function() {\n   options.port = this.address().port;\n-  let req;\n \n   for (requests_sent = 0; requests_sent < 30; requests_sent += 1) {\n     options.path = `/${requests_sent}`;\n-    req = http.request(options);\n+    const req = http.request(options);\n     req.id = requests_sent;\n     req.on('response', function(res) {\n       res.on('data', function(data) {\n@@ -59,6 +58,7 @@ server.listen(0, options.host, function() {\n       res.on('end', function(data) {\n         console.log(`res#${this.req.id} end`);\n         requests_done += 1;\n+        req.destroy();\n       });\n     });\n     req.on('close', function() {",
            "previous_filename": "test/sequential/test-http-client-timeout-agent.js"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 2,
        "deletions": 2
    }
}