{
    "author": "danbev",
    "message": "src: fix FIPS section in Sign::SignFinal\n\nCurrently, while FIPS is not supported yet for this release there might\nbe an option to dynamically link against a FIPS compatible OpenSSL\nversion.\n\nThis commit fixes the compiler errors.\n\nPR-URL: https://github.com/nodejs/node/pull/25412\nReviewed-By: Sam Roberts <vieuxtech@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "228a3f840d9cab2d53ee12c546f002745935344a",
    "files": [
        {
            "sha": "bda172e2810a7a5532073e5a4d9cb80f9de37472",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/228a3f840d9cab2d53ee12c546f002745935344a/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/228a3f840d9cab2d53ee12c546f002745935344a/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=228a3f840d9cab2d53ee12c546f002745935344a",
            "patch": "@@ -4505,9 +4505,14 @@ Sign::SignResult Sign::SignFinal(\n \n #ifdef NODE_FIPS_MODE\n   /* Validate DSA2 parameters from FIPS 186-4 */\n-  if (FIPS_mode() && EVP_PKEY_DSA == pkey->type) {\n-    size_t L = BN_num_bits(pkey->pkey.dsa->p);\n-    size_t N = BN_num_bits(pkey->pkey.dsa->q);\n+  if (FIPS_mode() && EVP_PKEY_DSA == EVP_PKEY_base_id(pkey.get())) {\n+    DSA* dsa = EVP_PKEY_get0_DSA(pkey.get());\n+    const BIGNUM* p;\n+    DSA_get0_pqg(dsa, &p, nullptr, nullptr);\n+    size_t L = BN_num_bits(p);\n+    const BIGNUM* q;\n+    DSA_get0_pqg(dsa, nullptr, &q, nullptr);\n+    size_t N = BN_num_bits(q);\n     bool result = false;\n \n     if (L == 1024 && N == 160)\n@@ -4520,7 +4525,7 @@ Sign::SignResult Sign::SignFinal(\n       result = true;\n \n     if (!result) {\n-      return kSignPrivateKey;\n+      return SignResult(kSignPrivateKey);\n     }\n   }\n #endif  // NODE_FIPS_MODE"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 9,
        "deletions": 4
    }
}