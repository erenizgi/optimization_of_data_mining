{
    "author": "Trott",
    "message": "test: do not export common.leakedGlobals()\n\ncommon.leakedGlobals() was exposed only to test its logic. The logic can\ninstead be tested by running a fixture file that leaks a global and\nseeing if `common` causes an AssertionError on exit. This way, the\nentire functionality of leak detection is tested rather than just the\nleakedGlobals() function. It also reduces API surface area for the\ncommon monolith by one function.\n\nPR-URL: https://github.com/nodejs/node/pull/22965\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c",
    "files": [
        {
            "sha": "c3f2c5f6b8a7f1f883fa9c35529d517a5b40c63a",
            "filename": "test/common/README.md",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Fcommon%2FREADME.md",
            "raw_url": "https://github.com/nodejs/node/raw/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Fcommon%2FREADME.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2FREADME.md?ref=2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c",
            "patch": "@@ -219,11 +219,6 @@ Platform check for Windows.\n \n Platform check for Windows 32-bit on Windows 64-bit.\n \n-### leakedGlobals()\n-* return [&lt;Array>]\n-\n-Indicates whether any globals are not on the `knownGlobals` list.\n-\n ### localhostIPv4\n * [&lt;string>]\n "
        },
        {
            "sha": "75fe2e1548ea8a56124397c1a657c1406fdd389d",
            "filename": "test/common/index.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Fcommon%2Findex.js",
            "raw_url": "https://github.com/nodejs/node/raw/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Fcommon%2Findex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.js?ref=2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c",
            "patch": "@@ -726,7 +726,6 @@ module.exports = {\n   isSunOS,\n   isWindows,\n   isWOW64,\n-  leakedGlobals,\n   localIPv6Hosts,\n   mustCall,\n   mustCallAsync,"
        },
        {
            "sha": "832f68a9ee0d3e94b6f1c1f465435906d12c3e4a",
            "filename": "test/common/index.mjs",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Fcommon%2Findex.mjs",
            "raw_url": "https://github.com/nodejs/node/raw/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Fcommon%2Findex.mjs",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.mjs?ref=2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c",
            "patch": "@@ -25,7 +25,6 @@ const {\n   ddCommand,\n   platformTimeout,\n   allowGlobals,\n-  leakedGlobals,\n   mustCall,\n   mustCallAtLeast,\n   mustCallAsync,\n@@ -75,7 +74,6 @@ export {\n   ddCommand,\n   platformTimeout,\n   allowGlobals,\n-  leakedGlobals,\n   mustCall,\n   mustCallAtLeast,\n   mustCallAsync,"
        },
        {
            "sha": "6f4b1b992e250bf562602353f61aa6fd242188cf",
            "filename": "test/fixtures/leakedGlobal.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Ffixtures%2FleakedGlobal.js",
            "raw_url": "https://github.com/nodejs/node/raw/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Ffixtures%2FleakedGlobal.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2FleakedGlobal.js?ref=2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c",
            "patch": "@@ -0,0 +1,5 @@\n+'use strict';\n+\n+require('../common');\n+\n+global.gc = 42; // intentionally leak a global"
        },
        {
            "sha": "51e0302868cbe633bd4d514061673fdfb1e08b91",
            "filename": "test/parallel/test-common.js",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Fparallel%2Ftest-common.js",
            "raw_url": "https://github.com/nodejs/node/raw/2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c/test%2Fparallel%2Ftest-common.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-common.js?ref=2b29df71ebc07cea87e14ed7f2d93e78f8b04b3c",
            "patch": "@@ -27,10 +27,13 @@ const assert = require('assert');\n const { execFile } = require('child_process');\n \n // test for leaked global detection\n-global.gc = 42;  // Not a valid global unless --expose_gc is set.\n-assert.deepStrictEqual(common.leakedGlobals(), ['gc']);\n-delete global.gc;\n-\n+{\n+  const p = fixtures.path('leakedGlobal.js');\n+  execFile(process.argv[0], [p], common.mustCall((ex, stdout, stderr) => {\n+    assert.notStrictEqual(ex.code, 0);\n+    assert.ok(/\\bAssertionError\\b.*\\bUnexpected global\\b.*\\bgc\\b/.test(stderr));\n+  }));\n+}\n \n // common.mustCall() tests\n assert.throws(function() {"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 12,
        "deletions": 12
    }
}