{
    "author": "addaleax",
    "message": "tls: better error message for socket disconnect\n\nThe error emitted when a connection is closed before the\nTLS handshake completes seemed rather unspefic by just saying\n`socket hang up`.\n\nUse a more verbose message, that also indicates that this is\na purely client-side error, and remove a misleading comment.\n\nPR-URL: https://github.com/nodejs/node/pull/18989\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "eda702104b3447dd56dc635565b4c88b0e04685a",
    "files": [
        {
            "sha": "c472564270718080ce9d1c5eac00353261a66a70",
            "filename": "lib/_tls_wrap.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/eda702104b3447dd56dc635565b4c88b0e04685a/lib%2F_tls_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/eda702104b3447dd56dc635565b4c88b0e04685a/lib%2F_tls_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_wrap.js?ref=eda702104b3447dd56dc635565b4c88b0e04685a",
            "patch": "@@ -1074,7 +1074,6 @@ function onConnectSecure() {\n     this.emit('secureConnect');\n   }\n \n-  // Uncork incoming data\n   this.removeListener('end', onConnectEnd);\n }\n \n@@ -1083,7 +1082,8 @@ function onConnectEnd() {\n   if (!this._hadError) {\n     const options = this[kConnectOptions];\n     this._hadError = true;\n-    const error = new Error('socket hang up');\n+    const error = new Error('Client network socket disconnected before ' +\n+                            'secure TLS connection was established');\n     error.code = 'ECONNRESET';\n     error.path = options.path;\n     error.host = options.host;"
        },
        {
            "sha": "48f9a52463d3a40db34217ac3685bb829ab58b3e",
            "filename": "test/parallel/test-tls-empty-sni-context.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/eda702104b3447dd56dc635565b4c88b0e04685a/test%2Fparallel%2Ftest-tls-empty-sni-context.js",
            "raw_url": "https://github.com/nodejs/node/raw/eda702104b3447dd56dc635565b4c88b0e04685a/test%2Fparallel%2Ftest-tls-empty-sni-context.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-empty-sni-context.js?ref=eda702104b3447dd56dc635565b4c88b0e04685a",
            "patch": "@@ -29,6 +29,6 @@ const server = tls.createServer(options, (c) => {\n   }, common.mustNotCall());\n \n   c.on('error', common.mustCall((err) => {\n-    assert(/socket hang up/.test(err.message));\n+    assert(/Client network socket disconnected/.test(err.message));\n   }));\n }));"
        },
        {
            "sha": "b3a5adb47cd6d0f0b13aec999b2ddb877d60e3df",
            "filename": "test/parallel/test-tls-sni-option.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/eda702104b3447dd56dc635565b4c88b0e04685a/test%2Fparallel%2Ftest-tls-sni-option.js",
            "raw_url": "https://github.com/nodejs/node/raw/eda702104b3447dd56dc635565b4c88b0e04685a/test%2Fparallel%2Ftest-tls-sni-option.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-sni-option.js?ref=eda702104b3447dd56dc635565b4c88b0e04685a",
            "patch": "@@ -175,7 +175,9 @@ process.on('exit', function() {\n   ]);\n   assert.deepStrictEqual(clientResults, [true, true, true, false, false]);\n   assert.deepStrictEqual(clientErrors, [\n-    null, null, null, null, 'socket hang up'\n+    null, null, null, null,\n+    'Client network socket disconnected before secure TLS ' +\n+    'connection was established'\n   ]);\n   assert.deepStrictEqual(serverErrors, [\n     null, null, null, null, 'Invalid SNI context'"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 6,
        "deletions": 4
    }
}