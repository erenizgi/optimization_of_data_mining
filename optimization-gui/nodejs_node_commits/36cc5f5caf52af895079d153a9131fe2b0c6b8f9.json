{
    "author": "addaleax",
    "message": "test: fix timeouts when running worker tests with `--worker`\n\nThese tests have been added after the original workers PR and\ntime out when run inside a worker by themselves.\nThis is needed for enabling `--worker` tests in our regular CI.\n\nRefs: https://github.com/nodejs/build/issues/1318\n\nPR-URL: https://github.com/nodejs/node/pull/21791\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "36cc5f5caf52af895079d153a9131fe2b0c6b8f9",
    "files": [
        {
            "sha": "b621389b49ca6b13f9b07bedd7357f335a44d2a4",
            "filename": "test/parallel/test-worker-exit-code.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/36cc5f5caf52af895079d153a9131fe2b0c6b8f9/test%2Fparallel%2Ftest-worker-exit-code.js",
            "raw_url": "https://github.com/nodejs/node/raw/36cc5f5caf52af895079d153a9131fe2b0c6b8f9/test%2Fparallel%2Ftest-worker-exit-code.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-exit-code.js?ref=36cc5f5caf52af895079d153a9131fe2b0c6b8f9",
            "patch": "@@ -7,9 +7,11 @@ const common = require('../common');\n \n const assert = require('assert');\n const worker = require('worker_threads');\n-const { Worker, isMainThread, parentPort } = worker;\n+const { Worker, parentPort } = worker;\n \n-if (isMainThread) {\n+// Do not use isMainThread so that this test itself can be run inside a Worker.\n+if (!process.env.HAS_STARTED_WORKER) {\n+  process.env.HAS_STARTED_WORKER = 1;\n   parent();\n } else {\n   if (!parentPort) {"
        },
        {
            "sha": "2ae3d90f852ba9007c59a943795145b809731532",
            "filename": "test/parallel/test-worker-onmessage.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/36cc5f5caf52af895079d153a9131fe2b0c6b8f9/test%2Fparallel%2Ftest-worker-onmessage.js",
            "raw_url": "https://github.com/nodejs/node/raw/36cc5f5caf52af895079d153a9131fe2b0c6b8f9/test%2Fparallel%2Ftest-worker-onmessage.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-onmessage.js?ref=36cc5f5caf52af895079d153a9131fe2b0c6b8f9",
            "patch": "@@ -2,9 +2,11 @@\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n-const { Worker, isMainThread, parentPort } = require('worker_threads');\n+const { Worker, parentPort } = require('worker_threads');\n \n-if (isMainThread) {\n+// Do not use isMainThread so that this test itself can be run inside a Worker.\n+if (!process.env.HAS_STARTED_WORKER) {\n+  process.env.HAS_STARTED_WORKER = 1;\n   const w = new Worker(__filename);\n   w.on('message', common.mustCall((message) => {\n     assert.strictEqual(message, 4);"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 8,
        "deletions": 4
    }
}