{
    "author": "joyeecheung",
    "message": "trace_events: move SetupTraceCategoryState into node_trace_events.cc\n\nIt makes more sense to put it in `internalBinding('trace_events')`\ninstead of in the bootstrapper object.\n\nPR-URL: https://github.com/nodejs/node/pull/25128\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "70f23289aa020cd06d527744be75ce4f0f4c4427",
    "files": [
        {
            "sha": "dcb0be8f7eb6ba2b0eb5daae4e9694d6e86c54da",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/70f23289aa020cd06d527744be75ce4f0f4c4427/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/70f23289aa020cd06d527744be75ce4f0f4c4427/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=70f23289aa020cd06d527744be75ce4f0f4c4427",
            "patch": "@@ -18,7 +18,6 @@\n /* global isMainThread */\n \n const {\n-  _setupTraceCategoryState,\n   _setupNextTick,\n   _setupPromises\n } = bootstrappers;\n@@ -431,7 +430,10 @@ function readAndExecuteStdin() {\n }\n \n function setupTraceCategoryState() {\n-  const { traceCategoryState } = internalBinding('trace_events');\n+  const {\n+    traceCategoryState,\n+    setTraceCategoryStateUpdateHandler\n+  } = internalBinding('trace_events');\n   const kCategoryAsyncHooks = 0;\n   let traceEventsAsyncHook;\n \n@@ -453,7 +455,7 @@ function setupTraceCategoryState() {\n   }\n \n   toggleTraceCategoryState();\n-  _setupTraceCategoryState(toggleTraceCategoryState);\n+  setTraceCategoryStateUpdateHandler(toggleTraceCategoryState);\n }\n \n function setupProcessObject() {"
        },
        {
            "sha": "b46ba5badab2264fb60447b2fd0c43ccd69e95f4",
            "filename": "src/bootstrapper.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/70f23289aa020cd06d527744be75ce4f0f4c4427/src%2Fbootstrapper.cc",
            "raw_url": "https://github.com/nodejs/node/raw/70f23289aa020cd06d527744be75ce4f0f4c4427/src%2Fbootstrapper.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fbootstrapper.cc?ref=70f23289aa020cd06d527744be75ce4f0f4c4427",
            "patch": "@@ -30,12 +30,6 @@ void RunMicrotasks(const FunctionCallbackInfo<Value>& args) {\n   args.GetIsolate()->RunMicrotasks();\n }\n \n-void SetupTraceCategoryState(const FunctionCallbackInfo<Value>& args) {\n-  Environment* env = Environment::GetCurrent(args);\n-  CHECK(args[0]->IsFunction());\n-  env->set_trace_category_state_function(args[0].As<Function>());\n-}\n-\n void SetupNextTick(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n   Isolate* isolate = env->isolate();\n@@ -136,7 +130,6 @@ void SetupPromises(const FunctionCallbackInfo<Value>& args) {\n // completes so that it can be gc'd as soon as possible.\n void SetupBootstrapObject(Environment* env,\n                           Local<Object> bootstrapper) {\n-  BOOTSTRAP_METHOD(_setupTraceCategoryState, SetupTraceCategoryState);\n   BOOTSTRAP_METHOD(_setupNextTick, SetupNextTick);\n   BOOTSTRAP_METHOD(_setupPromises, SetupPromises);\n }"
        },
        {
            "sha": "3c0f1cf68f1db81fef51d3ff66b1f6b6728a24ef",
            "filename": "src/node_trace_events.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/70f23289aa020cd06d527744be75ce4f0f4c4427/src%2Fnode_trace_events.cc",
            "raw_url": "https://github.com/nodejs/node/raw/70f23289aa020cd06d527744be75ce4f0f4c4427/src%2Fnode_trace_events.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_trace_events.cc?ref=70f23289aa020cd06d527744be75ce4f0f4c4427",
            "patch": "@@ -11,6 +11,7 @@ namespace node {\n \n using v8::Array;\n using v8::Context;\n+using v8::Function;\n using v8::FunctionCallbackInfo;\n using v8::FunctionTemplate;\n using v8::Local;\n@@ -102,13 +103,23 @@ void GetEnabledCategories(const FunctionCallbackInfo<Value>& args) {\n   }\n }\n \n+static void SetTraceCategoryStateUpdateHandler(\n+    const FunctionCallbackInfo<Value>& args) {\n+  Environment* env = Environment::GetCurrent(args);\n+  CHECK(args[0]->IsFunction());\n+  env->set_trace_category_state_function(args[0].As<Function>());\n+}\n+\n void NodeCategorySet::Initialize(Local<Object> target,\n                 Local<Value> unused,\n                 Local<Context> context,\n                 void* priv) {\n   Environment* env = Environment::GetCurrent(context);\n \n   env->SetMethod(target, \"getEnabledCategories\", GetEnabledCategories);\n+  env->SetMethod(\n+      target, \"setTraceCategoryStateUpdateHandler\",\n+      SetTraceCategoryStateUpdateHandler);\n \n   Local<FunctionTemplate> category_set =\n       env->NewFunctionTemplate(NodeCategorySet::New);"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 16,
        "deletions": 10
    }
}