{
    "author": "srl295",
    "message": "doc: Update tools/icu/README.md\n\n- remove TODOs: the one about defaults has been\naddressed, and the one about testing is a work\nitem that doesn't belong in a doc.\n- add some background information\n\nFixes: https://github.com/nodejs/node/issues/7843\n\nPR-URL: https://github.com/nodejs/node/pull/16939\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>",
    "sha": "07712d1eb8f02d159edb4f55ed5976af7f3a82f1",
    "files": [
        {
            "sha": "de17f2b033cc49739abe73d2aacee512ca01dd15",
            "filename": "tools/icu/README.md",
            "status": "modified",
            "additions": 34,
            "deletions": 27,
            "changes": 61,
            "blob_url": "https://github.com/nodejs/node/blob/07712d1eb8f02d159edb4f55ed5976af7f3a82f1/tools%2Ficu%2FREADME.md",
            "raw_url": "https://github.com/nodejs/node/raw/07712d1eb8f02d159edb4f55ed5976af7f3a82f1/tools%2Ficu%2FREADME.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Ficu%2FREADME.md?ref=07712d1eb8f02d159edb4f55ed5976af7f3a82f1",
            "patch": "@@ -1,4 +1,15 @@\n-# Notes about the icu directory.\n+# Notes about the `tools/icu` subdirectory\n+\n+This directory contains tools, data, and information about the [http://icu-project.org](ICU) (International Components for Unicode) integration. ICU is used to provide internationalization functionality.\n+\n+- `patches/` are one-off patches, actually entire source file replacements, organized by ICU version number.\n+- `icu_small.json` controls the \"small\" (English only) ICU. It is input to `icutrim.py`\n+- `icu-generic.gyp` is the build file used for most ICU builds within ICU. <!-- have fun -->\n+- `icu-system.gyp` is an alternate build file used when `--with-intl=system-icu` is invoked. It builds against the `pkg-config` located ICU.\n+- `iculslocs.cc` is source for the `iculslocs` utility, invoked by `icutrim.py` as part of repackaging. Not used separately. See source for more details.\n+- `no-op.cc` — empty function to convince gyp to use a C++ compiler.\n+- `README.md` — you are here\n+- `shrink-icu-src.py` — this is used during upgrade (see guide below)\n \n ## How to upgrade ICU\n \n@@ -12,13 +23,13 @@\n make\n ```\n \n-(The equivalent `vcbuild.bat` commands should work also. Note that we use the `.tgz` and not the `.zip` here,\n-that is because of line endings.)\n+> _Note_ in theory, the equivalent `vcbuild.bat` commands should work also,\n+but the commands below are makefile-centric.\n \n-- (note- may need to make changes in `icu-generic.gyp` or `tools/icu/patches` for\n-version specific stuff)\n+- If there are ICU version-specific changes needed, you may need to make changes in `icu-generic.gyp` or add patch files to `tools/icu/patches`.\n+  - Specifically, look for the lists in `sources!` in the `icu-generic.gyp` for files to exclude.\n \n-- Verify the node build works\n+- Verify the node build works:\n \n ```shell\n make test-ci\n@@ -27,13 +38,12 @@ make test-ci\n Also running\n \n <!-- eslint-disable strict -->\n+\n ```js\n new Intl.DateTimeFormat('es', {month: 'long'}).format(new Date(9E8));\n ```\n \n …Should return `January` not `enero`.\n-(TODO here: improve [testing](https://github.com/nodejs/Intl/issues/16))\n-\n \n - Now, copy `deps/icu` over to `deps/icu-small`\n \n@@ -43,25 +53,25 @@ python tools/icu/shrink-icu-src.py\n \n - Now, do a clean rebuild of node to test:\n \n-(TODO: fix this when these options become default)\n-\n ```shell\n-./configure --with-intl=small-icu --with-icu-source=deps/icu-small\n+make -k distclean\n+./configure\n make\n ```\n \n - Test this newly default-generated Node.js\n \n <!-- eslint-disable strict -->\n+\n ```js\n process.versions.icu;\n new Intl.DateTimeFormat('es', {month: 'long'}).format(new Date(9E8));\n ```\n \n-(should return your updated ICU version number, and also `January` again.)\n+(This should print your updated ICU version number, and also `January` again.)\n \n-- You are ready to check in the updated `deps/small-icu`.\n-This is a big commit, so make this a separate commit from other changes.\n+You are ready to check in the updated `deps/small-icu`. This is a big commit,\n+so make this a separate commit from the smaller changes.\n \n - Now, rebuild the Node license.\n \n@@ -85,30 +95,27 @@ make test-ci\n \n - commit the change to `configure` along with the updated `LICENSE` file.\n \n+  - Note: To simplify review, I often will “pre-land” this patch, meaning that I run the patch through `curl -L https://github.com/nodejs/node/pull/xxx.patch | git am -3 --whitespace=fix` per the collaborator’s guide… and then push that patched branch into my PR's branch. This reduces the whitespace changes that show up in the PR, since the final land will eliminate those anyway.\n+\n -----\n \n-## Notes about these tools\n+## Postscript about the tools\n \n-The files in this directory were written for the node.js effort. It's\n-the intent of their author (Steven R. Loomis / srl295) to merge them\n-upstream into ICU, pending much discussion within the ICU-PMC.\n+The files in this directory were written for the node.js effort.\n+It was the intent of their author (Steven R. Loomis / srl295) to\n+merge them upstream into ICU, pending much discussion within the\n+ICU-TC.\n \n `icu_small.json` is somewhat node-specific as it specifies a \"small ICU\"\n configuration file for the `icutrim.py` script. `icutrim.py` and\n `iculslocs.cpp` may themselves be superseded by components built into\n-ICU in the future.\n-\n-The following tickets were opened during this work, and their\n-resolution may inform the reader as to the current state of icu-trim\n-upstream:\n+ICU in the future. As of this writing, however, the tools are separate\n+entities within Node, although theyare being scrutinized by interested\n+members of the ICU-TC. The “upstream” ICU bugs are given below.\n \n    * [#10919](http://bugs.icu-project.org/trac/ticket/10919)\n      (experimental branch - may copy any source patches here)\n    * [#10922](http://bugs.icu-project.org/trac/ticket/10922)\n      (data packaging improvements)\n    * [#10923](http://bugs.icu-project.org/trac/ticket/10923)\n      (rewrite data building in python)\n-\n-When/if components (not including the `.json` file) are merged into\n-ICU, this code and `configure` will be updated to detect and use those\n-variants rather than the ones in this directory."
        }
    ],
    "stats": {
        "total": 61,
        "additions": 34,
        "deletions": 27
    }
}