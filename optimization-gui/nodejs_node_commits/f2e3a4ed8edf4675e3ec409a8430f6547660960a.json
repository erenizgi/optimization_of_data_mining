{
    "author": "Trott",
    "message": "test: prepare test-hash-seed for CI\n\nReduce the time it takes to run test/pummel/test-hash-seed by switching\nfrom spawnSync() to spawn(). On my computer, this reduces the runtime\nfrom about 80 seconds to about 40 seconds. This test is not (yet) run\nregularly on CI, but when it was run recently, it timed out.\n\nPR-URL: https://github.com/nodejs/node/pull/25522\nReviewed-By: Ali Ijaz Sheikh <ofrobots@google.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>",
    "sha": "f2e3a4ed8edf4675e3ec409a8430f6547660960a",
    "files": [
        {
            "sha": "2b7f13593a9aa4f96ecefc64b0ceb6ec1c617901",
            "filename": "test/pummel/test-hash-seed.js",
            "status": "modified",
            "additions": 19,
            "deletions": 8,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/f2e3a4ed8edf4675e3ec409a8430f6547660960a/test%2Fpummel%2Ftest-hash-seed.js",
            "raw_url": "https://github.com/nodejs/node/raw/f2e3a4ed8edf4675e3ec409a8430f6547660960a/test%2Fpummel%2Ftest-hash-seed.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpummel%2Ftest-hash-seed.js?ref=f2e3a4ed8edf4675e3ec409a8430f6547660960a",
            "patch": "@@ -2,19 +2,30 @@\n \n // Check that spawn child doesn't create duplicated entries\n require('../common');\n+const Countdown = require('../common/countdown');\n const REPETITIONS = 2;\n const assert = require('assert');\n const fixtures = require('../common/fixtures');\n-const { spawnSync } = require('child_process');\n+const { spawn } = require('child_process');\n const targetScript = fixtures.path('guess-hash-seed.js');\n const seeds = [];\n \n+const requiredCallback = () => {\n+  console.log(`Seeds: ${seeds}`);\n+  assert.strictEqual(new Set(seeds).size, seeds.length);\n+  assert.strictEqual(seeds.length, REPETITIONS);\n+};\n+\n+const countdown = new Countdown(REPETITIONS, requiredCallback);\n+\n for (let i = 0; i < REPETITIONS; ++i) {\n-  const seed = spawnSync(process.execPath, [targetScript], {\n-    encoding: 'utf8'\n-  }).stdout.trim();\n-  seeds.push(seed);\n-}\n+  let result = '';\n+  const subprocess = spawn(process.execPath, [targetScript]);\n+  subprocess.stdout.setEncoding('utf8');\n+  subprocess.stdout.on('data', (data) => { result += data; });\n \n-console.log(`Seeds: ${seeds}`);\n-assert.strictEqual(new Set(seeds).size, seeds.length);\n+  subprocess.on('exit', () => {\n+    seeds.push(result.trim());\n+    countdown.dec();\n+  });\n+}"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 19,
        "deletions": 8
    }
}