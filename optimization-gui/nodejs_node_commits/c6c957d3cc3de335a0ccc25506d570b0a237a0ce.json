{
    "author": "unknown",
    "message": "src: fix upcoming V8 deprecation warnings\n\nPR-URL: https://github.com/nodejs/node/pull/19490\nFixes: https://github.com/nodejs/node/issues/18909\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "c6c957d3cc3de335a0ccc25506d570b0a237a0ce",
    "files": [
        {
            "sha": "3d806d71ef92044b9826aad78dc3ecb2ab922aca",
            "filename": "src/inspector_js_api.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Finspector_js_api.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Finspector_js_api.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector_js_api.cc?ref=c6c957d3cc3de335a0ccc25506d570b0a237a0ce",
            "patch": "@@ -230,7 +230,7 @@ static void AsyncTaskScheduledWrapper(const FunctionCallbackInfo<Value>& args) {\n \n   CHECK(args[0]->IsString());\n   Local<String> task_name = args[0].As<String>();\n-  String::Value task_name_value(task_name);\n+  String::Value task_name_value(args.GetIsolate(), task_name);\n   StringView task_name_view(*task_name_value, task_name_value.length());\n \n   CHECK(args[1]->IsNumber());"
        },
        {
            "sha": "c3172723910fbd5b04fb7ced2acdde770a3079f8",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=c6c957d3cc3de335a0ccc25506d570b0a237a0ce",
            "patch": "@@ -1269,9 +1269,11 @@ void AppendExceptionLine(Environment* env,\n   ScriptOrigin origin = message->GetScriptOrigin();\n   node::Utf8Value filename(env->isolate(), message->GetScriptResourceName());\n   const char* filename_string = *filename;\n-  int linenum = message->GetLineNumber();\n+  int linenum = message->GetLineNumber(env->context()).FromJust();\n   // Print line of source code.\n-  node::Utf8Value sourceline(env->isolate(), message->GetSourceLine());\n+  MaybeLocal<String> source_line_maybe = message->GetSourceLine(env->context());\n+  node::Utf8Value sourceline(env->isolate(),\n+                             source_line_maybe.ToLocalChecked());\n   const char* sourceline_string = *sourceline;\n   if (strstr(sourceline_string, \"node-do-not-add-exception-line\") != nullptr)\n     return;\n@@ -1419,7 +1421,7 @@ static void ReportException(Environment* env,\n         name.IsEmpty() ||\n         name->IsUndefined()) {\n       // Not an error object. Just print as-is.\n-      String::Utf8Value message(er);\n+      String::Utf8Value message(env->isolate(), er);\n \n       PrintErrorString(\"%s\\n\", *message ? *message :\n                                           \"<toString() threw exception>\");\n@@ -1471,13 +1473,13 @@ static Local<Value> ExecuteString(Environment* env,\n     exit(3);\n   }\n \n-  Local<Value> result = script.ToLocalChecked()->Run();\n+  MaybeLocal<Value> result = script.ToLocalChecked()->Run(env->context());\n   if (result.IsEmpty()) {\n     ReportException(env, try_catch);\n     exit(4);\n   }\n \n-  return scope.Escape(result);\n+  return scope.Escape(result.ToLocalChecked());\n }\n \n "
        },
        {
            "sha": "3769de6c98b21b774117601ec38fabd0ab6ef38b",
            "filename": "src/node_api.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_api.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_api.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_api.cc?ref=c6c957d3cc3de335a0ccc25506d570b0a237a0ce",
            "patch": "@@ -3315,7 +3315,7 @@ class Work : public node::AsyncResource {\n                 void* data = nullptr)\n     : AsyncResource(env->isolate,\n                     async_resource,\n-                    *v8::String::Utf8Value(async_resource_name)),\n+                    *v8::String::Utf8Value(env->isolate, async_resource_name)),\n     _env(env),\n     _data(data),\n     _execute(execute),"
        },
        {
            "sha": "15e6c7a0c492d33db1ce912f5375f402999ff1c1",
            "filename": "src/node_buffer.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_buffer.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_buffer.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_buffer.cc?ref=c6c957d3cc3de335a0ccc25506d570b0a237a0ce",
            "patch": "@@ -854,7 +854,7 @@ void IndexOfString(const FunctionCallbackInfo<Value>& args) {\n   size_t result = haystack_length;\n \n   if (enc == UCS2) {\n-    String::Value needle_value(needle);\n+    String::Value needle_value(args.GetIsolate(), needle);\n     if (*needle_value == nullptr)\n       return args.GetReturnValue().Set(-1);\n \n@@ -887,7 +887,7 @@ void IndexOfString(const FunctionCallbackInfo<Value>& args) {\n     }\n     result *= 2;\n   } else if (enc == UTF8) {\n-    String::Utf8Value needle_value(needle);\n+    String::Utf8Value needle_value(args.GetIsolate(), needle);\n     if (*needle_value == nullptr)\n       return args.GetReturnValue().Set(-1);\n "
        },
        {
            "sha": "07aa656b2c177816076866fc7bbb886a2974f9d9",
            "filename": "src/node_contextify.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_contextify.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_contextify.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_contextify.cc?ref=c6c957d3cc3de335a0ccc25506d570b0a237a0ce",
            "patch": "@@ -1086,21 +1086,21 @@ class ContextifyScript : public BaseObject {\n         PersistentToLocal(env->isolate(), wrapped_script->script_);\n     Local<Script> script = unbound_script->BindToCurrentContext();\n \n-    Local<Value> result;\n+    MaybeLocal<Value> result;\n     bool timed_out = false;\n     bool received_signal = false;\n     if (break_on_sigint && timeout != -1) {\n       Watchdog wd(env->isolate(), timeout, &timed_out);\n       SigintWatchdog swd(env->isolate(), &received_signal);\n-      result = script->Run();\n+      result = script->Run(env->context());\n     } else if (break_on_sigint) {\n       SigintWatchdog swd(env->isolate(), &received_signal);\n-      result = script->Run();\n+      result = script->Run(env->context());\n     } else if (timeout != -1) {\n       Watchdog wd(env->isolate(), timeout, &timed_out);\n-      result = script->Run();\n+      result = script->Run(env->context());\n     } else {\n-      result = script->Run();\n+      result = script->Run(env->context());\n     }\n \n     if (timed_out || received_signal) {\n@@ -1131,7 +1131,7 @@ class ContextifyScript : public BaseObject {\n       return false;\n     }\n \n-    args.GetReturnValue().Set(result);\n+    args.GetReturnValue().Set(result.ToLocalChecked());\n     return true;\n   }\n "
        },
        {
            "sha": "b56b74b00515c1640b105d4cb99fd7013f6bb038",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=c6c957d3cc3de335a0ccc25506d570b0a237a0ce",
            "patch": "@@ -4255,7 +4255,7 @@ void PublicKeyCipher::Cipher(const FunctionCallbackInfo<Value>& args) {\n \n   int padding = args[2]->Uint32Value();\n \n-  String::Utf8Value passphrase(args[3]);\n+  String::Utf8Value passphrase(args.GetIsolate(), args[3]);\n \n   unsigned char* out_value = nullptr;\n   size_t out_len = 0;"
        },
        {
            "sha": "d1514cb0973dbe696f16d3b4f79135836f785c1b",
            "filename": "src/node_v8.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_v8.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fnode_v8.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_v8.cc?ref=c6c957d3cc3de335a0ccc25506d570b0a237a0ce",
            "patch": "@@ -114,7 +114,7 @@ void UpdateHeapSpaceStatisticsBuffer(const FunctionCallbackInfo<Value>& args) {\n \n void SetFlagsFromString(const FunctionCallbackInfo<Value>& args) {\n   CHECK(args[0]->IsString());\n-  String::Utf8Value flags(args[0]);\n+  String::Utf8Value flags(args.GetIsolate(), args[0]);\n   V8::SetFlagsFromString(*flags, flags.length());\n }\n "
        },
        {
            "sha": "2b485746dff5df4725cd3bfa2cf167b06e498c36",
            "filename": "src/string_bytes.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fstring_bytes.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c6c957d3cc3de335a0ccc25506d570b0a237a0ce/src%2Fstring_bytes.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstring_bytes.cc?ref=c6c957d3cc3de335a0ccc25506d570b0a237a0ce",
            "patch": "@@ -369,7 +369,7 @@ size_t StringBytes::Write(Isolate* isolate,\n         auto ext = str->GetExternalOneByteStringResource();\n         nbytes = base64_decode(buf, buflen, ext->data(), ext->length());\n       } else {\n-        String::Value value(str);\n+        String::Value value(isolate, str);\n         nbytes = base64_decode(buf, buflen, *value, value.length());\n       }\n       *chars_written = nbytes;\n@@ -380,7 +380,7 @@ size_t StringBytes::Write(Isolate* isolate,\n         auto ext = str->GetExternalOneByteStringResource();\n         nbytes = hex_decode(buf, buflen, ext->data(), ext->length());\n       } else {\n-        String::Value value(str);\n+        String::Value value(isolate, str);\n         nbytes = hex_decode(buf, buflen, *value, value.length());\n       }\n       *chars_written = nbytes;\n@@ -479,7 +479,7 @@ size_t StringBytes::Size(Isolate* isolate,\n       return str->Length() * sizeof(uint16_t);\n \n     case BASE64: {\n-      String::Value value(str);\n+      String::Value value(isolate, str);\n       return base64_decoded_size(*value, value.length());\n     }\n "
        }
    ],
    "stats": {
        "total": 42,
        "additions": 22,
        "deletions": 20
    }
}