{
    "author": "addaleax",
    "message": "src: use generic helper for splitting strings\n\nPR-URL: https://github.com/nodejs/node/pull/25363\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "8ec3c350f54933d9237c63dd17a9a24472fce591",
    "files": [
        {
            "sha": "24b0167b8912724c43a4b36837782dbd1ab6bd8c",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 19,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/8ec3c350f54933d9237c63dd17a9a24472fce591/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/8ec3c350f54933d9237c63dd17a9a24472fce591/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=8ec3c350f54933d9237c63dd17a9a24472fce591",
            "patch": "@@ -282,9 +282,12 @@ static struct {\n     if (per_process::cli_options->trace_event_categories.empty()) {\n       tracing_file_writer_ = tracing_agent_->DefaultHandle();\n     } else {\n+      std::vector<std::string> categories =\n+          SplitString(per_process::cli_options->trace_event_categories, ',');\n+\n       tracing_file_writer_ = tracing_agent_->AddClient(\n-          ParseCommaSeparatedSet(\n-              per_process::cli_options->trace_event_categories),\n+          std::set<std::string>(std::make_move_iterator(categories.begin()),\n+                                std::make_move_iterator(categories.end())),\n           std::unique_ptr<tracing::AsyncTraceWriter>(\n               new tracing::NodeTraceWriter(\n                   per_process::cli_options->trace_event_file_pattern)),\n@@ -1420,23 +1423,10 @@ void Init(std::vector<std::string>* argv,\n #if !defined(NODE_WITHOUT_NODE_OPTIONS)\n   std::string node_options;\n   if (credentials::SafeGetenv(\"NODE_OPTIONS\", &node_options)) {\n-    std::vector<std::string> env_argv;\n-    // [0] is expected to be the program name, fill it in from the real argv.\n-    env_argv.push_back(argv->at(0));\n-\n-    // Split NODE_OPTIONS at each ' ' character.\n-    std::string::size_type index = std::string::npos;\n-    do {\n-      std::string::size_type prev_index = index;\n-      index = node_options.find(' ', index + 1);\n-      if (index - prev_index == 1) continue;\n-\n-      const std::string option = node_options.substr(\n-          prev_index + 1, index - prev_index - 1);\n-      if (!option.empty())\n-        env_argv.emplace_back(std::move(option));\n-    } while (index != std::string::npos);\n-\n+    // [0] is expected to be the program name, fill it in from the real argv\n+    // and use 'x' as a placeholder while parsing.\n+    std::vector<std::string> env_argv = SplitString(\"x \" + node_options, ' ');\n+    env_argv[0] = argv->at(0);\n \n     ProcessArgv(&env_argv, nullptr, true);\n   }"
        },
        {
            "sha": "9f32814a8599ecf6b1793dcfe27aa1bbfd996d82",
            "filename": "src/util.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/8ec3c350f54933d9237c63dd17a9a24472fce591/src%2Futil.cc",
            "raw_url": "https://github.com/nodejs/node/raw/8ec3c350f54933d9237c63dd17a9a24472fce591/src%2Futil.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Futil.cc?ref=8ec3c350f54933d9237c63dd17a9a24472fce591",
            "patch": "@@ -122,15 +122,15 @@ void GetHumanReadableProcessName(char (*name)[1024]) {\n   snprintf(*name, sizeof(*name), \"%s[%d]\", title, uv_os_getpid());\n }\n \n-std::set<std::string> ParseCommaSeparatedSet(const std::string& in) {\n-  std::set<std::string> out;\n+std::vector<std::string> SplitString(const std::string& in, char delim) {\n+  std::vector<std::string> out;\n   if (in.empty())\n     return out;\n   std::istringstream in_stream(in);\n   while (in_stream.good()) {\n     std::string item;\n-    getline(in_stream, item, ',');\n-    out.emplace(std::move(item));\n+    std::getline(in_stream, item, delim);\n+    out.emplace_back(std::move(item));\n   }\n   return out;\n }"
        },
        {
            "sha": "2fa16cadeac462ac9aca9a2e9c982897636e601e",
            "filename": "src/util.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/8ec3c350f54933d9237c63dd17a9a24472fce591/src%2Futil.h",
            "raw_url": "https://github.com/nodejs/node/raw/8ec3c350f54933d9237c63dd17a9a24472fce591/src%2Futil.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Futil.h?ref=8ec3c350f54933d9237c63dd17a9a24472fce591",
            "patch": "@@ -523,7 +523,7 @@ struct FunctionDeleter {\n template <typename T, void (*function)(T*)>\n using DeleteFnPtr = typename FunctionDeleter<T, function>::Pointer;\n \n-std::set<std::string> ParseCommaSeparatedSet(const std::string& in);\n+std::vector<std::string> SplitString(const std::string& in, char delim);\n \n inline v8::MaybeLocal<v8::Value> ToV8Value(v8::Local<v8::Context> context,\n                                            const std::string& str,"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 14,
        "deletions": 24
    }
}