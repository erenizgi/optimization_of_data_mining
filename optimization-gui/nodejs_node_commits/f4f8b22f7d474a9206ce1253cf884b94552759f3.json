{
    "author": "BridgeAR",
    "message": "string_decoder: lazy loaded\n\nPR-URL: https://github.com/nodejs/node/pull/20567\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>",
    "sha": "f4f8b22f7d474a9206ce1253cf884b94552759f3",
    "files": [
        {
            "sha": "ecdcccc0640ff9654208f40f927cfb0f49bb0a50",
            "filename": "lib/_stream_readable.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/f4f8b22f7d474a9206ce1253cf884b94552759f3/lib%2F_stream_readable.js",
            "raw_url": "https://github.com/nodejs/node/raw/f4f8b22f7d474a9206ce1253cf884b94552759f3/lib%2F_stream_readable.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_stream_readable.js?ref=f4f8b22f7d474a9206ce1253cf884b94552759f3",
            "patch": "@@ -40,7 +40,9 @@ const {\n } = require('internal/errors').codes;\n const ReadableAsyncIterator = require('internal/streams/async_iterator');\n const { emitExperimentalWarning } = require('internal/util');\n-var StringDecoder;\n+\n+// Lazy loaded to improve the startup performance.\n+let StringDecoder;\n \n util.inherits(Readable, Stream);\n "
        },
        {
            "sha": "1ec3f2086609106b8b455f09e2d141b7316924da",
            "filename": "lib/internal/child_process.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/f4f8b22f7d474a9206ce1253cf884b94552759f3/lib%2Finternal%2Fchild_process.js",
            "raw_url": "https://github.com/nodejs/node/raw/f4f8b22f7d474a9206ce1253cf884b94552759f3/lib%2Finternal%2Fchild_process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fchild_process.js?ref=f4f8b22f7d474a9206ce1253cf884b94552759f3",
            "patch": "@@ -14,7 +14,6 @@ const {\n     ERR_MISSING_ARGS\n   }\n } = require('internal/errors');\n-const { StringDecoder } = require('string_decoder');\n const EventEmitter = require('events');\n const net = require('net');\n const dgram = require('dgram');\n@@ -47,6 +46,9 @@ const {\n \n const { SocketListSend, SocketListReceive } = SocketList;\n \n+// Lazy loaded for startup performance.\n+let StringDecoder;\n+\n const MAX_HANDLE_RETRANSMISSIONS = 3;\n \n // this object contain function to convert TCP objects to native handle objects\n@@ -476,6 +478,8 @@ function setupChannel(target, channel) {\n \n   const control = new Control(channel);\n \n+  if (StringDecoder === undefined)\n+    StringDecoder = require('string_decoder').StringDecoder;\n   var decoder = new StringDecoder('utf8');\n   var jsonBuffer = '';\n   var pendingHandle = null;"
        },
        {
            "sha": "bd80c19697e70b00eaa8bdf3cd3c6087ea3e6ea6",
            "filename": "lib/internal/crypto/cipher.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/f4f8b22f7d474a9206ce1253cf884b94552759f3/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "raw_url": "https://github.com/nodejs/node/raw/f4f8b22f7d474a9206ce1253cf884b94552759f3/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fcipher.js?ref=f4f8b22f7d474a9206ce1253cf884b94552759f3",
            "patch": "@@ -28,11 +28,13 @@ const {\n \n const assert = require('assert');\n const LazyTransform = require('internal/streams/lazy_transform');\n-const { StringDecoder } = require('string_decoder');\n \n const { inherits } = require('util');\n const { normalizeEncoding } = require('internal/util');\n \n+// Lazy loaded for startup performance.\n+let StringDecoder;\n+\n function rsaFunctionFor(method, defaultPadding) {\n   return function(options, buffer) {\n     const key = options.key || options;\n@@ -49,6 +51,8 @@ const privateDecrypt = rsaFunctionFor(_privateDecrypt, RSA_PKCS1_OAEP_PADDING);\n \n function getDecoder(decoder, encoding) {\n   encoding = normalizeEncoding(encoding);\n+  if (StringDecoder === undefined)\n+    StringDecoder = require('string_decoder').StringDecoder;\n   decoder = decoder || new StringDecoder(encoding);\n   assert(decoder.encoding === encoding, 'Cannot change encoding');\n   return decoder;"
        },
        {
            "sha": "89dd1b84f2dde0935b3e54950a28f428793f02a5",
            "filename": "lib/readline.js",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/f4f8b22f7d474a9206ce1253cf884b94552759f3/lib%2Freadline.js",
            "raw_url": "https://github.com/nodejs/node/raw/f4f8b22f7d474a9206ce1253cf884b94552759f3/lib%2Freadline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Freadline.js?ref=f4f8b22f7d474a9206ce1253cf884b94552759f3",
            "patch": "@@ -35,7 +35,6 @@ const {\n const { debug, inherits } = require('util');\n const { Buffer } = require('buffer');\n const EventEmitter = require('events');\n-const { StringDecoder } = require('string_decoder');\n const {\n   CSI,\n   emitKeys,\n@@ -52,6 +51,9 @@ const {\n   kClearScreenDown\n } = CSI;\n \n+// Lazy load StringDecoder for startup performance.\n+let StringDecoder;\n+\n const kHistorySize = 30;\n const kMincrlfDelay = 100;\n // \\r\\n, \\n, or \\r followed by something other than \\n\n@@ -73,6 +75,9 @@ function Interface(input, output, completer, terminal) {\n     return new Interface(input, output, completer, terminal);\n   }\n \n+  if (StringDecoder === undefined)\n+    StringDecoder = require('string_decoder').StringDecoder;\n+\n   this._sawReturnAt = 0;\n   this.isCompletionEnabled = true;\n   this._sawKeyPress = false;\n@@ -987,6 +992,9 @@ Interface.prototype._ttyWrite = function(s, key) {\n \n function emitKeypressEvents(stream, iface) {\n   if (stream[KEYPRESS_DECODER]) return;\n+\n+  if (StringDecoder === undefined)\n+    StringDecoder = require('string_decoder').StringDecoder;\n   stream[KEYPRESS_DECODER] = new StringDecoder('utf8');\n \n   stream[ESCAPE_DECODER] = emitKeys(stream);"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 22,
        "deletions": 4
    }
}