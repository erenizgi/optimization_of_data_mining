{
    "author": "BridgeAR",
    "message": "assert: improve default error messages\n\nThis improves the error messages for:\n- assert.notDeepStrictEqual\n- assert.deepStrictEqual\n- assert.notStrictEqual\n- assert.strictEqual\n\nThose will now always use the same error message as used in the\nstrict mode.\n\nPR-URL: https://github.com/nodejs/node/pull/19467\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "bfe54df81240151a3aeaf99dcd91c362bab3a6b0",
    "files": [
        {
            "sha": "180744c9c0c11ef8ec22645f1a662d897dc0ed57",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=bfe54df81240151a3aeaf99dcd91c362bab3a6b0",
            "patch": "@@ -54,7 +54,6 @@ const meta = [\n \n const escapeFn = (str) => meta[str.charCodeAt(0)];\n \n-const ERR_DIFF_DEACTIVATED = 0;\n const ERR_DIFF_NOT_EQUAL = 1;\n const ERR_DIFF_EQUAL = 2;\n \n@@ -323,7 +322,7 @@ assert.deepStrictEqual = function deepStrictEqual(actual, expected, message) {\n       message,\n       operator: 'deepStrictEqual',\n       stackStartFn: deepStrictEqual,\n-      errorDiff: this === strict ? ERR_DIFF_EQUAL : ERR_DIFF_DEACTIVATED\n+      errorDiff: ERR_DIFF_EQUAL\n     });\n   }\n };\n@@ -337,7 +336,7 @@ function notDeepStrictEqual(actual, expected, message) {\n       message,\n       operator: 'notDeepStrictEqual',\n       stackStartFn: notDeepStrictEqual,\n-      errorDiff: this === strict ? ERR_DIFF_NOT_EQUAL : ERR_DIFF_DEACTIVATED\n+      errorDiff: ERR_DIFF_NOT_EQUAL\n     });\n   }\n }\n@@ -350,7 +349,7 @@ assert.strictEqual = function strictEqual(actual, expected, message) {\n       message,\n       operator: 'strictEqual',\n       stackStartFn: strictEqual,\n-      errorDiff: this === strict ? ERR_DIFF_EQUAL : ERR_DIFF_DEACTIVATED\n+      errorDiff: ERR_DIFF_EQUAL\n     });\n   }\n };\n@@ -363,7 +362,7 @@ assert.notStrictEqual = function notStrictEqual(actual, expected, message) {\n       message,\n       operator: 'notStrictEqual',\n       stackStartFn: notStrictEqual,\n-      errorDiff: this === strict ? ERR_DIFF_NOT_EQUAL : ERR_DIFF_DEACTIVATED\n+      errorDiff: ERR_DIFF_NOT_EQUAL\n     });\n   }\n };"
        },
        {
            "sha": "22d100682839d43ea9e7272362abd2bf469d90e6",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 82,
            "deletions": 14,
            "changes": 96,
            "blob_url": "https://github.com/nodejs/node/blob/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=bfe54df81240151a3aeaf99dcd91c362bab3a6b0",
            "patch": "@@ -19,6 +19,13 @@ let green = '';\n let red = '';\n let white = '';\n \n+const READABLE_OPERATOR = {\n+  deepStrictEqual: 'Input A expected to strictly deep-equal input B',\n+  notDeepStrictEqual: 'Input A expected to strictly not deep-equal input B',\n+  strictEqual: 'Input A expected to strictly equal input B',\n+  notStrictEqual: 'Input A expected to strictly not equal input B'\n+};\n+\n const {\n   errmap,\n   UV_EAI_MEMORY,\n@@ -40,10 +47,34 @@ function lazyInternalUtil() {\n   return internalUtil;\n }\n \n+function copyError(source) {\n+  const keys = Object.keys(source);\n+  const target = Object.create(Object.getPrototypeOf(source));\n+  for (const key of keys) {\n+    target[key] = source[key];\n+  }\n+  Object.defineProperty(target, 'message', { value: source.message });\n+  return target;\n+}\n+\n function inspectValue(val) {\n+  // The util.inspect default values could be changed. This makes sure the\n+  // error messages contain the necessary information nevertheless.\n   return util.inspect(\n     val,\n-    { compact: false, customInspect: false }\n+    {\n+      compact: false,\n+      customInspect: false,\n+      depth: 1000,\n+      maxArrayLength: Infinity,\n+      // Assert compares only enumerable properties (with a few exceptions).\n+      showHidden: false,\n+      // Having a long line as error is better than wrapping the line for\n+      // comparison.\n+      breakLength: Infinity,\n+      // Assert does not detect proxies currently.\n+      showProxy: false\n+    }\n   ).split('\\n');\n }\n \n@@ -226,8 +257,8 @@ function createErrDiff(actual, expected, operator) {\n   if (util === undefined) util = require('util');\n   const actualLines = inspectValue(actual);\n   const expectedLines = inspectValue(expected);\n-  const msg = `Input A expected to ${operator} input B:\\n` +\n-        `${green}+ expected${white} ${red}- actual${white}`;\n+  const msg = READABLE_OPERATOR[operator] +\n+        `:\\n${green}+ expected${white} ${red}- actual${white}`;\n   const skippedMsg = ' ... Lines skipped';\n \n   // Remove all ending lines that match (this optimizes the output for\n@@ -259,6 +290,7 @@ function createErrDiff(actual, expected, operator) {\n \n   const maxLines = Math.max(actualLines.length, expectedLines.length);\n   var printedLines = 0;\n+  var identical = 0;\n   for (i = 0; i < maxLines; i++) {\n     // Only extra expected lines exist\n     const cur = i - lastPos;\n@@ -318,12 +350,38 @@ function createErrDiff(actual, expected, operator) {\n         res += `\\n  ${actualLines[i]}`;\n         printedLines++;\n       }\n+      identical++;\n     }\n     // Inspected object to big (Show ~20 rows max)\n     if (printedLines > 20 && i < maxLines - 2) {\n       return `${msg}${skippedMsg}\\n${res}\\n...${other}\\n...`;\n     }\n   }\n+\n+  // Strict equal with identical objects that are not identical by reference.\n+  if (identical === maxLines) {\n+    let base = 'Input object identical but not reference equal:';\n+\n+    if (operator !== 'strictEqual') {\n+      // This code path should not be possible to reach.\n+      // The output is identical but it is not clear why.\n+      base = 'Input objects not identical:';\n+    }\n+\n+    // We have to get the result again. The lines were all removed before.\n+    const actualLines = inspectValue(actual);\n+\n+    // Only remove lines in case it makes sense to collapse those.\n+    // TODO: Accept env to always show the full error.\n+    if (actualLines.length > 30) {\n+      actualLines[26] = '...';\n+      while (actualLines.length > 27) {\n+        actualLines.pop();\n+      }\n+    }\n+\n+    return `${base}\\n\\n  ${actualLines.join('\\n  ')}\\n`;\n+  }\n   return `${msg}${skipped ? skippedMsg : ''}\\n${res}${other}${end}`;\n }\n \n@@ -358,13 +416,15 @@ class AssertionError extends Error {\n         }\n       }\n       if (util === undefined) util = require('util');\n+      // Prevent the error stack from being visible by duplicating the error\n+      // in a very close way to the original in case both sides are actually\n+      // instances of Error.\n       if (typeof actual === 'object' && actual !== null &&\n-        'stack' in actual && actual instanceof Error) {\n-        actual = `${actual.name}: ${actual.message}`;\n-      }\n-      if (typeof expected === 'object' && expected !== null &&\n-        'stack' in expected && expected instanceof Error) {\n-        expected = `${expected.name}: ${expected.message}`;\n+          typeof expected === 'object' && expected !== null &&\n+          'stack' in actual && actual instanceof Error &&\n+          'stack' in expected && expected instanceof Error) {\n+        actual = copyError(actual);\n+        expected = copyError(expected);\n       }\n \n       if (errorDiff === 0) {\n@@ -379,15 +439,23 @@ class AssertionError extends Error {\n         // In case the objects are equal but the operator requires unequal, show\n         // the first object and say A equals B\n         const res = inspectValue(actual);\n+        const base = `Identical input passed to ${operator}:`;\n \n-        if (res.length > 20) {\n-          res[19] = '...';\n-          while (res.length > 20) {\n+        // Only remove lines in case it makes sense to collapse those.\n+        // TODO: Accept env to always show the full error.\n+        if (res.length > 30) {\n+          res[26] = '...';\n+          while (res.length > 27) {\n             res.pop();\n           }\n         }\n-        // Only print a single object.\n-        super(`Identical input passed to ${operator}:\\n${res.join('\\n')}`);\n+\n+        // Only print a single input.\n+        if (res.length === 1) {\n+          super(`${base} ${res[0]}`);\n+        } else {\n+          super(`${base}\\n\\n  ${res.join('\\n  ')}\\n`);\n+        }\n       } else {\n         super(createErrDiff(actual, expected, operator));\n       }"
        },
        {
            "sha": "62a25a63673dcf337a30a8cf855e78435fd149ac",
            "filename": "test/message/assert_throws_stack.out",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fmessage%2Fassert_throws_stack.out",
            "raw_url": "https://github.com/nodejs/node/raw/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fmessage%2Fassert_throws_stack.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Fassert_throws_stack.out?ref=bfe54df81240151a3aeaf99dcd91c362bab3a6b0",
            "patch": "@@ -2,7 +2,7 @@ assert.js:*\n   throw new AssertionError(obj);\n   ^\n \n-AssertionError [ERR_ASSERTION]: Input A expected to deepStrictEqual input B:\n+AssertionError [ERR_ASSERTION]: Input A expected to strictly deep-equal input B:\n + expected - actual\n \n - Comparison {}"
        },
        {
            "sha": "1935c18979e45cf741feae7324250bca5ef7a1c5",
            "filename": "test/message/error_exit.out",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fmessage%2Ferror_exit.out",
            "raw_url": "https://github.com/nodejs/node/raw/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fmessage%2Ferror_exit.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Ferror_exit.out?ref=bfe54df81240151a3aeaf99dcd91c362bab3a6b0",
            "patch": "@@ -3,7 +3,11 @@ assert.js:*\n   throw new AssertionError(obj);\n   ^\n \n-AssertionError [ERR_ASSERTION]: 1 strictEqual 2\n+AssertionError [ERR_ASSERTION]: Input A expected to strictly equal input B:\n++ expected - actual\n+\n+- 1\n++ 2\n     at Object.<anonymous> (*test*message*error_exit.js:*:*)\n     at Module._compile (internal/modules/cjs/loader.js:*:*)\n     at Object.Module._extensions..js (internal/modules/cjs/loader.js:*:*)"
        },
        {
            "sha": "38ebaa1a1436e7a1660b4b80268b74761d7af3b5",
            "filename": "test/parallel/test-assert-checktag.js",
            "status": "modified",
            "additions": 15,
            "deletions": 23,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fparallel%2Ftest-assert-checktag.js",
            "raw_url": "https://github.com/nodejs/node/raw/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fparallel%2Ftest-assert-checktag.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert-checktag.js?ref=bfe54df81240151a3aeaf99dcd91c362bab3a6b0",
            "patch": "@@ -1,24 +1,6 @@\n 'use strict';\n-const common = require('../common');\n+require('../common');\n const assert = require('assert');\n-const util = require('util');\n-\n-// Template tag function turning an error message into a RegExp\n-// for assert.throws()\n-function re(literals, ...values) {\n-  let result = literals[0];\n-  const escapeRE = /[\\\\^$.*+?()[\\]{}|=!<>:-]/g;\n-  for (const [i, value] of values.entries()) {\n-    const str = util.inspect(value);\n-    // Need to escape special characters.\n-    result += str.replace(escapeRE, '\\\\$&');\n-    result += literals[i + 1];\n-  }\n-  return common.expectsError({\n-    code: 'ERR_ASSERTION',\n-    message: new RegExp(`^${result}$`)\n-  });\n-}\n \n // Turn off no-restricted-properties because we are testing deepEqual!\n /* eslint-disable no-restricted-properties */\n@@ -35,10 +17,20 @@ function re(literals, ...values) {\n \n   // For deepStrictEqual we check the runtime type,\n   // then reveal the fakeness of the fake date\n-  assert.throws(() => assert.deepStrictEqual(date, fake),\n-                re`${date} deepStrictEqual Date {}`);\n-  assert.throws(() => assert.deepStrictEqual(fake, date),\n-                re`Date {} deepStrictEqual ${date}`);\n+  assert.throws(\n+    () => assert.deepStrictEqual(date, fake),\n+    {\n+      message: 'Input A expected to strictly deep-equal input B:\\n' +\n+               '+ expected - actual\\n\\n- 2016-01-01T00:00:00.000Z\\n+ Date {}'\n+    }\n+  );\n+  assert.throws(\n+    () => assert.deepStrictEqual(fake, date),\n+    {\n+      message: 'Input A expected to strictly deep-equal input B:\\n' +\n+               '+ expected - actual\\n\\n- Date {}\\n+ 2016-01-01T00:00:00.000Z'\n+    }\n+  );\n }\n \n {  // At the moment global has its own type tag"
        },
        {
            "sha": "4fa091ef2af96cf207e34044aa20f867064d4c04",
            "filename": "test/parallel/test-assert-deep.js",
            "status": "modified",
            "additions": 150,
            "deletions": 55,
            "changes": 205,
            "blob_url": "https://github.com/nodejs/node/blob/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fparallel%2Ftest-assert-deep.js",
            "raw_url": "https://github.com/nodejs/node/raw/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fparallel%2Ftest-assert-deep.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert-deep.js?ref=bfe54df81240151a3aeaf99dcd91c362bab3a6b0",
            "patch": "@@ -4,6 +4,8 @@ const common = require('../common');\n const assert = require('assert');\n const util = require('util');\n const { AssertionError } = assert;\n+const defaultMsgStart = 'Input A expected to strictly deep-equal input B:\\n' +\n+                        '+ expected - actual';\n \n // Template tag function turning an error message into a RegExp\n // for assert.throws()\n@@ -32,24 +34,45 @@ function re(literals, ...values) {\n const arr = new Uint8Array([120, 121, 122, 10]);\n const buf = Buffer.from(arr);\n // They have different [[Prototype]]\n-assert.throws(() => assert.deepStrictEqual(arr, buf),\n-              re`${arr} deepStrictEqual ${buf}`);\n+assert.throws(\n+  () => assert.deepStrictEqual(arr, buf),\n+  {\n+    code: 'ERR_ASSERTION',\n+    message: `${defaultMsgStart} ... Lines skipped\\n\\n` +\n+             '- Uint8Array [\\n' +\n+             '+ Buffer [Uint8Array] [\\n    120,\\n...\\n    10\\n  ]'\n+  }\n+);\n assert.deepEqual(arr, buf);\n \n {\n   const buf2 = Buffer.from(arr);\n   buf2.prop = 1;\n \n-  assert.throws(() => assert.deepStrictEqual(buf2, buf),\n-                re`${buf2} deepStrictEqual ${buf}`);\n+  assert.throws(\n+    () => assert.deepStrictEqual(buf2, buf),\n+    {\n+      code: 'ERR_ASSERTION',\n+      message: `${defaultMsgStart}\\n\\n` +\n+               '  Buffer [Uint8Array] [\\n    120,\\n    121,\\n    122,\\n' +\n+               '-   10,\\n-   prop: 1\\n+   10\\n  ]'\n+    }\n+  );\n   assert.deepEqual(buf2, buf);\n }\n \n {\n   const arr2 = new Uint8Array([120, 121, 122, 10]);\n   arr2.prop = 5;\n-  assert.throws(() => assert.deepStrictEqual(arr, arr2),\n-                re`${arr} deepStrictEqual ${arr2}`);\n+  assert.throws(\n+    () => assert.deepStrictEqual(arr, arr2),\n+    {\n+      code: 'ERR_ASSERTION',\n+      message: `${defaultMsgStart}\\n\\n` +\n+               '  Uint8Array [\\n    120,\\n    121,\\n    122,\\n' +\n+               '-   10\\n+   10,\\n+   prop: 5\\n  ]'\n+    }\n+  );\n   assert.deepEqual(arr, arr2);\n }\n \n@@ -68,10 +91,24 @@ const date2 = new MyDate('2016');\n // but deepStrictEqual checks own properties\n assert.deepEqual(date, date2);\n assert.deepEqual(date2, date);\n-assert.throws(() => assert.deepStrictEqual(date, date2),\n-              re`${date} deepStrictEqual ${date2}`);\n-assert.throws(() => assert.deepStrictEqual(date2, date),\n-              re`${date2} deepStrictEqual ${date}`);\n+assert.throws(\n+  () => assert.deepStrictEqual(date, date2),\n+  {\n+    code: 'ERR_ASSERTION',\n+    message: `${defaultMsgStart}\\n\\n` +\n+             '- 2016-01-01T00:00:00.000Z\\n+ 2016-01-01T00:00:00.000Z {\\n' +\n+             \"+   '0': '1'\\n+ }\"\n+  }\n+);\n+assert.throws(\n+  () => assert.deepStrictEqual(date2, date),\n+  {\n+    code: 'ERR_ASSERTION',\n+    message: `${defaultMsgStart}\\n\\n` +\n+             '- 2016-01-01T00:00:00.000Z {\\n' +\n+             \"-   '0': '1'\\n- }\\n+ 2016-01-01T00:00:00.000Z\"\n+  }\n+);\n \n class MyRegExp extends RegExp {\n   constructor(...args) {\n@@ -86,8 +123,14 @@ const re2 = new MyRegExp('test');\n // deepEqual returns true as long as the regexp-specific properties\n // are the same, but deepStrictEqual checks all properties\n assert.deepEqual(re1, re2);\n-assert.throws(() => assert.deepStrictEqual(re1, re2),\n-              re`${re1} deepStrictEqual ${re2}`);\n+assert.throws(\n+  () => assert.deepStrictEqual(re1, re2),\n+  {\n+    code: 'ERR_ASSERTION',\n+    message: `${defaultMsgStart}\\n\\n` +\n+             \"- /test/\\n+ /test/ {\\n+   '0': '1'\\n+ }\"\n+  }\n+);\n \n // For these weird cases, deepEqual should pass (at least for now),\n // but deepStrictEqual should throw.\n@@ -115,8 +158,10 @@ assert.throws(() => assert.deepStrictEqual(re1, re2),\n     for (const b of similar) {\n       if (a !== b) {\n         assert.deepEqual(a, b);\n-        assert.throws(() => assert.deepStrictEqual(a, b),\n-                      re`${a} deepStrictEqual ${b}`);\n+        assert.throws(\n+          () => assert.deepStrictEqual(a, b),\n+          { code: 'ERR_ASSERTION' }\n+        );\n       }\n     }\n   }\n@@ -139,22 +184,30 @@ function assertDeepAndStrictEqual(a, b) {\n \n function assertNotDeepOrStrict(a, b, err) {\n   assert.throws(() => assert.deepEqual(a, b), err || re`${a} deepEqual ${b}`);\n-  assert.throws(() => assert.deepStrictEqual(a, b), err ||\n-                re`${a} deepStrictEqual ${b}`);\n+  assert.throws(\n+    () => assert.deepStrictEqual(a, b),\n+    err || { code: 'ERR_ASSERTION' }\n+  );\n \n   assert.throws(() => assert.deepEqual(b, a), err || re`${b} deepEqual ${a}`);\n-  assert.throws(() => assert.deepStrictEqual(b, a), err ||\n-                re`${b} deepStrictEqual ${a}`);\n+  assert.throws(\n+    () => assert.deepStrictEqual(b, a),\n+    err || { code: 'ERR_ASSERTION' }\n+  );\n }\n \n function assertOnlyDeepEqual(a, b, err) {\n   assert.deepEqual(a, b);\n-  assert.throws(() => assert.deepStrictEqual(a, b), err ||\n-                re`${a} deepStrictEqual ${b}`);\n+  assert.throws(\n+    () => assert.deepStrictEqual(a, b),\n+    err || { code: 'ERR_ASSERTION' }\n+  );\n \n   assert.deepEqual(b, a);\n-  assert.throws(() => assert.deepStrictEqual(b, a), err ||\n-                re`${b} deepStrictEqual ${a}`);\n+  assert.throws(\n+    () => assert.deepStrictEqual(b, a),\n+    err || { code: 'ERR_ASSERTION' }\n+  );\n }\n \n // es6 Maps and Sets\n@@ -352,7 +405,8 @@ assertOnlyDeepEqual(\n   assertDeepAndStrictEqual(b, c);\n }\n \n-// GH-7178. Ensure reflexivity of deepEqual with `arguments` objects.\n+// https://github.com/nodejs/node-v0.x-archive/pull/7178\n+// Ensure reflexivity of deepEqual with `arguments` objects.\n {\n   const args = (function() { return arguments; })();\n   assertNotDeepOrStrict([], args);\n@@ -434,8 +488,14 @@ assertOnlyDeepEqual(\n   const map1 = new Map([[1, 1]]);\n   const map2 = new Map([[1, '1']]);\n   assert.deepEqual(map1, map2);\n-  assert.throws(() => assert.deepStrictEqual(map1, map2),\n-                re`${map1} deepStrictEqual ${map2}`);\n+  assert.throws(\n+    () => assert.deepStrictEqual(map1, map2),\n+    {\n+      code: 'ERR_ASSERTION',\n+      message: `${defaultMsgStart}\\n\\n` +\n+               \"  Map {\\n-   1 => 1\\n+   1 => '1'\\n  }\"\n+    }\n+  );\n }\n \n {\n@@ -682,8 +742,11 @@ assert.throws(\n \n assert.throws(\n   () => assert.notDeepStrictEqual(new Date(2000, 3, 14), new Date(2000, 3, 14)),\n-  AssertionError,\n-  'notDeepStrictEqual(new Date(2000, 3, 14), new Date(2000, 3, 14))'\n+  {\n+    name: 'AssertionError [ERR_ASSERTION]',\n+    message: 'Identical input passed to notDeepStrictEqual: ' +\n+             util.inspect(new Date(2000, 3, 14))\n+  }\n );\n \n assert.notDeepStrictEqual(new Date(), new Date(2000, 3, 14));\n@@ -698,35 +761,35 @@ assert.throws(\n   {\n     code: 'ERR_ASSERTION',\n     name: 'AssertionError [ERR_ASSERTION]',\n-    message: '/ab/ deepStrictEqual /a/'\n+    message: `${defaultMsgStart}\\n\\n- /ab/\\n+ /a/`\n   });\n assert.throws(\n   () => assert.deepStrictEqual(/a/g, /a/),\n   {\n     code: 'ERR_ASSERTION',\n     name: 'AssertionError [ERR_ASSERTION]',\n-    message: '/a/g deepStrictEqual /a/'\n+    message: `${defaultMsgStart}\\n\\n- /a/g\\n+ /a/`\n   });\n assert.throws(\n   () => assert.deepStrictEqual(/a/i, /a/),\n   {\n     code: 'ERR_ASSERTION',\n     name: 'AssertionError [ERR_ASSERTION]',\n-    message: '/a/i deepStrictEqual /a/'\n+    message: `${defaultMsgStart}\\n\\n- /a/i\\n+ /a/`\n   });\n assert.throws(\n   () => assert.deepStrictEqual(/a/m, /a/),\n   {\n     code: 'ERR_ASSERTION',\n     name: 'AssertionError [ERR_ASSERTION]',\n-    message: '/a/m deepStrictEqual /a/'\n+    message: `${defaultMsgStart}\\n\\n- /a/m\\n+ /a/`\n   });\n assert.throws(\n   () => assert.deepStrictEqual(/a/igm, /a/im),\n   {\n     code: 'ERR_ASSERTION',\n     name: 'AssertionError [ERR_ASSERTION]',\n-    message: '/a/gim deepStrictEqual /a/im'\n+    message: `${defaultMsgStart}\\n\\n- /a/gim\\n+ /a/im`\n   });\n \n {\n@@ -735,17 +798,15 @@ assert.throws(\n   assert.deepStrictEqual(re1, /a/);\n }\n \n-assert.throws(() => assert.deepStrictEqual(4, '4'),\n-              AssertionError,\n-              'deepStrictEqual(4, \\'4\\')');\n-\n-assert.throws(() => assert.deepStrictEqual(true, 1),\n-              AssertionError,\n-              'deepStrictEqual(true, 1)');\n+assert.throws(\n+  () => assert.deepStrictEqual(4, '4'),\n+  { message: `${defaultMsgStart}\\n\\n- 4\\n+ '4'` }\n+);\n \n-assert.throws(() => assert.deepStrictEqual(4, '5'),\n-              AssertionError,\n-              'deepStrictEqual(4, \\'5\\')');\n+assert.throws(\n+  () => assert.deepStrictEqual(true, 1),\n+  { message: `${defaultMsgStart}\\n\\n- true\\n+ 1` }\n+);\n \n // Having the same number of owned properties && the same set of keys.\n assert.deepStrictEqual({ a: 4 }, { a: 4 });\n@@ -754,20 +815,22 @@ assert.throws(() => assert.deepStrictEqual([4], ['4']),\n               {\n                 code: 'ERR_ASSERTION',\n                 name: 'AssertionError [ERR_ASSERTION]',\n-                message: \"[ 4 ] deepStrictEqual [ '4' ]\"\n-              });\n-assert.throws(() => assert.deepStrictEqual({ a: 4 }, { a: 4, b: true }),\n-              {\n-                code: 'ERR_ASSERTION',\n-                name: 'AssertionError [ERR_ASSERTION]',\n-                message: '{ a: 4 } deepStrictEqual { a: 4, b: true }'\n-              });\n-assert.throws(() => assert.deepStrictEqual(['a'], { 0: 'a' }),\n-              {\n-                code: 'ERR_ASSERTION',\n-                name: 'AssertionError [ERR_ASSERTION]',\n-                message: \"[ 'a' ] deepStrictEqual { '0': 'a' }\"\n+                message: `${defaultMsgStart}\\n\\n  [\\n-   4\\n+   '4'\\n  ]`\n               });\n+assert.throws(\n+  () => assert.deepStrictEqual({ a: 4 }, { a: 4, b: true }),\n+  {\n+    code: 'ERR_ASSERTION',\n+    name: 'AssertionError [ERR_ASSERTION]',\n+    message: `${defaultMsgStart}\\n\\n  {\\n-   a: 4\\n+   a: 4,\\n+   b: true\\n  }`\n+  });\n+assert.throws(\n+  () => assert.deepStrictEqual(['a'], { 0: 'a' }),\n+  {\n+    code: 'ERR_ASSERTION',\n+    name: 'AssertionError [ERR_ASSERTION]',\n+    message: `${defaultMsgStart}\\n\\n- [\\n-   'a'\\n- ]\\n+ {\\n+   '0': 'a'\\n+ }`\n+  });\n \n /* eslint-enable */\n \n@@ -826,3 +889,35 @@ assert.throws(() => assert.deepStrictEqual(new String('a'), { 0: 'a' }),\n assert.throws(() => assert.deepStrictEqual(new Number(1), {}), AssertionError);\n assert.throws(() => assert.deepStrictEqual(new Boolean(true), {}),\n               AssertionError);\n+\n+// Check extra properties on errors.\n+{\n+  const a = new TypeError('foo');\n+  const b = new TypeError('foo');\n+  a.foo = 'bar';\n+  b.foo = 'baz';\n+\n+  assert.throws(\n+    () => assert.deepStrictEqual(a, b),\n+    {\n+      message: `${defaultMsgStart}\\n\\n` +\n+               '  [TypeError: foo] {\\n-   foo: \\'bar\\'\\n+   foo: \\'baz\\'\\n  }'\n+    }\n+  );\n+}\n+\n+// Check proxies.\n+{\n+  // TODO(BridgeAR): Check if it would not be better to detect proxies instead\n+  // of just using the proxy value.\n+  const arrProxy = new Proxy([1, 2], {});\n+  assert.deepStrictEqual(arrProxy, [1, 2]);\n+  const tmp = util.inspect.defaultOptions;\n+  util.inspect.defaultOptions = { showProxy: true };\n+  assert.throws(\n+    () => assert.deepStrictEqual(arrProxy, [1, 2, 3]),\n+    { message: `${defaultMsgStart}\\n\\n` +\n+               '  [\\n    1,\\n-   2\\n+   2,\\n+   3\\n  ]' }\n+  );\n+  util.inspect.defaultOptions = tmp;\n+}"
        },
        {
            "sha": "b871cd7265d288f3209e7bd6e2edbb9ac42eaaeb",
            "filename": "test/parallel/test-assert.js",
            "status": "modified",
            "additions": 62,
            "deletions": 20,
            "changes": 82,
            "blob_url": "https://github.com/nodejs/node/blob/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fparallel%2Ftest-assert.js",
            "raw_url": "https://github.com/nodejs/node/raw/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fparallel%2Ftest-assert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert.js?ref=bfe54df81240151a3aeaf99dcd91c362bab3a6b0",
            "patch": "@@ -34,7 +34,7 @@ const { writeFileSync, unlinkSync } = require('fs');\n const { inspect } = require('util');\n const a = assert;\n \n-const start = 'Input A expected to deepStrictEqual input B:';\n+const start = 'Input A expected to strictly deep-equal input B:';\n const actExp = '+ expected - actual';\n \n assert.ok(a.AssertionError.prototype instanceof Error,\n@@ -67,8 +67,21 @@ assert.throws(() => a.strictEqual(2, '2'),\n assert.throws(() => a.strictEqual(null, undefined),\n               a.AssertionError, 'strictEqual(null, undefined)');\n \n-assert.throws(() => a.notStrictEqual(2, 2),\n-              a.AssertionError, 'notStrictEqual(2, 2)');\n+assert.throws(\n+  () => a.notStrictEqual(2, 2),\n+  {\n+    message: 'Identical input passed to notStrictEqual: 2',\n+    name: 'AssertionError [ERR_ASSERTION]'\n+  }\n+);\n+\n+assert.throws(\n+  () => a.notStrictEqual('a '.repeat(30), 'a '.repeat(30)),\n+  {\n+    message: `Identical input passed to notStrictEqual: '${'a '.repeat(30)}'`,\n+    name: 'AssertionError [ERR_ASSERTION]'\n+  }\n+);\n \n a.notStrictEqual(2, '2');\n \n@@ -245,8 +258,11 @@ function testAssertionMessage(actual, expected) {\n   try {\n     assert.strictEqual(actual, '');\n   } catch (e) {\n-    assert.strictEqual(e.message,\n-                       [expected, 'strictEqual', '\\'\\''].join(' '));\n+    assert.strictEqual(\n+      e.message,\n+      'Input A expected to strictly equal input B:\\n+ expected - actual\\n\\n' +\n+        `- ${expected}\\n+ ''`\n+    );\n     assert.ok(e.generatedMessage, 'Message not marked as generated');\n   }\n }\n@@ -263,29 +279,34 @@ testAssertionMessage(-Infinity, '-Infinity');\n testAssertionMessage('', '\"\"');\n testAssertionMessage('foo', '\\'foo\\'');\n testAssertionMessage([], '[]');\n-testAssertionMessage([1, 2, 3], '[ 1, 2, 3 ]');\n+testAssertionMessage([1, 2, 3], '[\\n-   1,\\n-   2,\\n-   3\\n- ]');\n testAssertionMessage(/a/, '/a/');\n testAssertionMessage(/abc/gim, '/abc/gim');\n testAssertionMessage(function f() {}, '[Function: f]');\n testAssertionMessage(function() {}, '[Function]');\n testAssertionMessage({}, '{}');\n-testAssertionMessage(circular, '{ y: 1, x: [Circular] }');\n-testAssertionMessage({ a: undefined, b: null }, '{ a: undefined, b: null }');\n+testAssertionMessage(circular, '{\\n-   y: 1,\\n-   x: [Circular]\\n- }');\n+testAssertionMessage({ a: undefined, b: null },\n+                     '{\\n-   a: undefined,\\n-   b: null\\n- }');\n testAssertionMessage({ a: NaN, b: Infinity, c: -Infinity },\n-                     '{ a: NaN, b: Infinity, c: -Infinity }');\n+                     '{\\n-   a: NaN,\\n-   b: Infinity,\\n-   c: -Infinity\\n- }');\n \n // https://github.com/nodejs/node-v0.x-archive/issues/5292\n try {\n   assert.strictEqual(1, 2);\n } catch (e) {\n-  assert.strictEqual(e.message.split('\\n')[0], '1 strictEqual 2');\n+  assert.strictEqual(\n+    e.message,\n+    'Input A expected to strictly equal input B:\\n' +\n+      '+ expected - actual\\n\\n- 1\\n+ 2'\n+  );\n   assert.ok(e.generatedMessage, 'Message not marked as generated');\n }\n \n try {\n   assert.strictEqual(1, 2, 'oh no');\n } catch (e) {\n-  assert.strictEqual(e.message.split('\\n')[0], 'oh no');\n+  assert.strictEqual(e.message, 'oh no');\n   assert.strictEqual(e.generatedMessage, false,\n                      'Message incorrectly marked as generated');\n }\n@@ -361,10 +382,11 @@ assert.throws(() => { throw new Error(); }, (err) => err instanceof Error);\n // Long values should be truncated for display.\n assert.throws(() => {\n   assert.strictEqual('A'.repeat(1000), '');\n-}, common.expectsError({\n+}, {\n   code: 'ERR_ASSERTION',\n-  message: /^'A{124}\\.\\.\\. strictEqual ''$/\n-}));\n+  message: 'Input A expected to strictly equal input B:\\n' +\n+           `+ expected - actual\\n\\n- '${'A'.repeat(1000)}'\\n+ ''`\n+});\n \n {\n   // Bad args to AssertionError constructor should throw TypeError.\n@@ -381,12 +403,13 @@ assert.throws(() => {\n   });\n }\n \n-common.expectsError(\n+assert.throws(\n   () => assert.strictEqual(new Error('foo'), new Error('foobar')),\n   {\n     code: 'ERR_ASSERTION',\n-    type: assert.AssertionError,\n-    message: /^'Error: foo' strictEqual 'Error: foobar'$/\n+    name: 'AssertionError [ERR_ASSERTION]',\n+    message: 'Input A expected to strictly equal input B:\\n' +\n+             '+ expected - actual\\n\\n- [Error: foo]\\n+ [Error: foobar]'\n   }\n );\n \n@@ -576,14 +599,15 @@ common.expectsError(\n   });\n \n   // notDeepEqual tests\n-  message = 'Identical input passed to notDeepStrictEqual:\\n[\\n  1\\n]';\n+  message = 'Identical input passed to notDeepStrictEqual:\\n\\n' +\n+            '  [\\n    1\\n  ]\\n';\n   assert.throws(\n     () => assert.notDeepEqual([1], [1]),\n     { message });\n \n   message = 'Identical input passed to notDeepStrictEqual:' +\n-        `\\n[${'\\n  1,'.repeat(18)}\\n...`;\n-  const data = Array(21).fill(1);\n+        `\\n\\n  [${'\\n    1,'.repeat(25)}\\n  ...\\n`;\n+  const data = Array(31).fill(1);\n   assert.throws(\n     () => assert.notDeepEqual(data, data),\n     { message });\n@@ -873,3 +897,21 @@ assert.throws(\n // Should not throw.\n // eslint-disable-next-line no-restricted-syntax, no-throw-literal\n assert.throws(() => { throw null; }, 'foo');\n+\n+assert.throws(\n+  () => assert.strictEqual([], []),\n+  {\n+    message: 'Input object identical but not reference equal:\\n\\n  []\\n'\n+  }\n+);\n+\n+{\n+  const args = (function() { return arguments; })('a');\n+  assert.throws(\n+    () => assert.strictEqual(args, { 0: 'a' }),\n+    {\n+      message: 'Input A expected to strictly equal input B:\\n+ expected' +\n+               \" - actual\\n\\n- [Arguments] {\\n+ {\\n    '0': 'a'\\n  }\"\n+    }\n+  );\n+}"
        },
        {
            "sha": "39bee740d2ea15cec643ddbb4499c544fc116043",
            "filename": "test/pseudo-tty/test-assert-colors.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fpseudo-tty%2Ftest-assert-colors.js",
            "raw_url": "https://github.com/nodejs/node/raw/bfe54df81240151a3aeaf99dcd91c362bab3a6b0/test%2Fpseudo-tty%2Ftest-assert-colors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-assert-colors.js?ref=bfe54df81240151a3aeaf99dcd91c362bab3a6b0",
            "patch": "@@ -7,7 +7,7 @@ try {\n   process.env.COLORTERM = '1';\n   assert.deepStrictEqual([1, 2], [2, 2]);\n } catch (err) {\n-  const expected = 'Input A expected to deepStrictEqual input B:\\n' +\n+  const expected = 'Input A expected to strictly deep-equal input B:\\n' +\n     '\\u001b[32m+ expected\\u001b[39m \\u001b[31m- actual\\u001b[39m\\n\\n' +\n     '  [\\n' +\n     '\\u001b[31m-\\u001b[39m   1,\\n' +"
        }
    ],
    "stats": {
        "total": 440,
        "additions": 320,
        "deletions": 120
    }
}