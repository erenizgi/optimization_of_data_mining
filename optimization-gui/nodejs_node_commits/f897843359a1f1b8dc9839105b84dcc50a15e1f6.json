{
    "author": "Trott",
    "message": "test: refactor common.ddCommand()\n\n* Remove different paths for Windows and POSIX.\n* Remove fixtures file. Simply run the command immediately/directly.\n* Since it is never called with more than one value for kilobytes,\n  eliminate that argument.\n* Update/simplify tests that use this function. (They no longer need to\n  use child_process to run the command.)\n* Update documentation.\n\nPR-URL: https://github.com/nodejs/node/pull/23411\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: George Adams <george.adams@uk.ibm.com>",
    "sha": "f897843359a1f1b8dc9839105b84dcc50a15e1f6",
    "files": [
        {
            "sha": "4d914f4f89e5ad8a5c0d2f68965b96262b6172d1",
            "filename": "test/common/README.md",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fcommon%2FREADME.md",
            "raw_url": "https://github.com/nodejs/node/raw/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fcommon%2FREADME.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2FREADME.md?ref=f897843359a1f1b8dc9839105b84dcc50a15e1f6",
            "patch": "@@ -52,10 +52,9 @@ symlinks\n ([SeCreateSymbolicLinkPrivilege](https://msdn.microsoft.com/en-us/library/windows/desktop/bb530716(v=vs.85).aspx)).\n On non-Windows platforms, this always returns `true`.\n \n-### ddCommand(filename, kilobytes)\n-* return [&lt;Object>]\n+### ddCommand(filename)\n \n-Platform normalizes the `dd` command\n+Creates a 10 MB file of all null characters.\n \n ### disableCrashOnUnhandledRejection()\n "
        },
        {
            "sha": "492bb2f357b6277d7111d091b883bffe0bd6a45e",
            "filename": "test/common/index.js",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fcommon%2Findex.js",
            "raw_url": "https://github.com/nodejs/node/raw/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fcommon%2Findex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.js?ref=f897843359a1f1b8dc9839105b84dcc50a15e1f6",
            "patch": "@@ -28,7 +28,6 @@ const assert = require('assert');\n const os = require('os');\n const { exec, execSync, spawnSync } = require('child_process');\n const util = require('util');\n-const { fixturesDir } = require('./fixtures');\n const tmpdir = require('./tmpdir');\n const {\n   bits,\n@@ -174,13 +173,10 @@ function childShouldThrowAndAbort() {\n   });\n }\n \n-function ddCommand(filename, kilobytes) {\n-  if (isWindows) {\n-    const p = path.resolve(fixturesDir, 'create-file.js');\n-    return `\"${process.argv[0]}\" \"${p}\" \"${filename}\" ${kilobytes * 1024}`;\n-  } else {\n-    return `dd if=/dev/zero of=\"${filename}\" bs=1024 count=${kilobytes}`;\n-  }\n+function ddCommand(filename) {\n+  const fd = fs.openSync(filename, 'w');\n+  fs.ftruncateSync(fd, 10 * 1024 * 1024);\n+  fs.closeSync(fd);\n }\n \n "
        },
        {
            "sha": "ec0d8243d355e5d6f4940261581b6d30a0ecee40",
            "filename": "test/fixtures/create-file.js",
            "status": "removed",
            "additions": 0,
            "deletions": 29,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/bcbb9370ddaa223110fcd8584e41336b791e7e7f/test%2Ffixtures%2Fcreate-file.js",
            "raw_url": "https://github.com/nodejs/node/raw/bcbb9370ddaa223110fcd8584e41336b791e7e7f/test%2Ffixtures%2Fcreate-file.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fcreate-file.js?ref=bcbb9370ddaa223110fcd8584e41336b791e7e7f",
            "patch": "@@ -1,29 +0,0 @@\n-// Copyright Joyent, Inc. and other Node contributors.\n-//\n-// Permission is hereby granted, free of charge, to any person obtaining a\n-// copy of this software and associated documentation files (the\n-// \"Software\"), to deal in the Software without restriction, including\n-// without limitation the rights to use, copy, modify, merge, publish,\n-// distribute, sublicense, and/or sell copies of the Software, and to permit\n-// persons to whom the Software is furnished to do so, subject to the\n-// following conditions:\n-//\n-// The above copyright notice and this permission notice shall be included\n-// in all copies or substantial portions of the Software.\n-//\n-// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n-// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n-// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n-// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n-// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n-// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n-// USE OR OTHER DEALINGS IN THE SOFTWARE.\n-\n-const fs = require('fs');\n-\n-var file_name = process.argv[2];\n-var file_size = parseInt(process.argv[3]);\n-\n-var fd = fs.openSync(file_name, 'w');\n-fs.ftruncateSync(fd, file_size);\n-fs.closeSync(fd);"
        },
        {
            "sha": "b0480059edd37fc71fe4ea9b4d20ca1615f4f295",
            "filename": "test/parallel/test-fs-error-messages.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fparallel%2Ftest-fs-error-messages.js",
            "raw_url": "https://github.com/nodejs/node/raw/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fparallel%2Ftest-fs-error-messages.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-error-messages.js?ref=f897843359a1f1b8dc9839105b84dcc50a15e1f6",
            "patch": "@@ -32,7 +32,7 @@ tmpdir.refresh();\n const nonexistentFile = fixtures.path('non-existent');\n const nonexistentDir = fixtures.path('non-existent', 'foo', 'bar');\n const existingFile = fixtures.path('exit.js');\n-const existingFile2 = fixtures.path('create-file.js');\n+const existingFile2 = fixtures.path('a.js');\n const existingDir = tmpdir.path;\n const existingDir2 = fixtures.path('keys');\n const { COPYFILE_EXCL } = fs.constants;"
        },
        {
            "sha": "dcc3a9c3fc8eedaf50a457325cb10a0c782c251b",
            "filename": "test/parallel/test-http-chunk-problem.js",
            "status": "modified",
            "additions": 20,
            "deletions": 23,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fparallel%2Ftest-http-chunk-problem.js",
            "raw_url": "https://github.com/nodejs/node/raw/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fparallel%2Ftest-http-chunk-problem.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-chunk-problem.js?ref=f897843359a1f1b8dc9839105b84dcc50a15e1f6",
            "patch": "@@ -63,34 +63,31 @@ function executeRequest(cb) {\n \n tmpdir.refresh();\n \n-const ddcmd = common.ddCommand(filename, 10240);\n+common.ddCommand(filename);\n \n-cp.exec(ddcmd, function(err, stdout, stderr) {\n-  assert.ifError(err);\n-  server = http.createServer(function(req, res) {\n-    res.writeHead(200);\n+server = http.createServer(function(req, res) {\n+  res.writeHead(200);\n \n-    // Create the subprocess\n-    const cat = cp.spawn('cat', [filename]);\n+  // Create the subprocess\n+  const cat = cp.spawn('cat', [filename]);\n \n-    // Stream the data through to the response as binary chunks\n-    cat.stdout.on('data', (data) => {\n-      res.write(data);\n-    });\n-\n-    cat.stdout.on('end', () => res.end());\n+  // Stream the data through to the response as binary chunks\n+  cat.stdout.on('data', (data) => {\n+    res.write(data);\n+  });\n \n-    // End the response on exit (and log errors)\n-    cat.on('exit', (code) => {\n-      if (code !== 0) {\n-        console.error(`subprocess exited with code ${code}`);\n-        process.exit(1);\n-      }\n-    });\n+  cat.stdout.on('end', () => res.end());\n \n+  // End the response on exit (and log errors)\n+  cat.on('exit', (code) => {\n+    if (code !== 0) {\n+      console.error(`subprocess exited with code ${code}`);\n+      process.exit(1);\n+    }\n   });\n \n-  server.listen(0, () => {\n-    executeRequest(() => server.close());\n-  });\n+});\n+\n+server.listen(0, () => {\n+  executeRequest(() => server.close());\n });"
        },
        {
            "sha": "70805873f1988e90391130609ae36adfe5761e79",
            "filename": "test/parallel/test-pipe-file-to-http.js",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fparallel%2Ftest-pipe-file-to-http.js",
            "raw_url": "https://github.com/nodejs/node/raw/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fparallel%2Ftest-pipe-file-to-http.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-pipe-file-to-http.js?ref=f897843359a1f1b8dc9839105b84dcc50a15e1f6",
            "patch": "@@ -25,7 +25,6 @@ const assert = require('assert');\n const fs = require('fs');\n const http = require('http');\n const path = require('path');\n-const cp = require('child_process');\n \n const tmpdir = require('../common/tmpdir');\n tmpdir.refresh();\n@@ -57,12 +56,8 @@ const server = http.createServer(function(req, res) {\n server.listen(0);\n \n server.on('listening', function() {\n-  const cmd = common.ddCommand(filename, 10240);\n-\n-  cp.exec(cmd, function(err) {\n-    assert.ifError(err);\n-    makeRequest();\n-  });\n+  common.ddCommand(filename);\n+  makeRequest();\n });\n \n function makeRequest() {"
        },
        {
            "sha": "0e8aafe51b744f7e830fa187b4e5fc299a3e6c06",
            "filename": "test/sequential/test-module-loading.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fsequential%2Ftest-module-loading.js",
            "raw_url": "https://github.com/nodejs/node/raw/f897843359a1f1b8dc9839105b84dcc50a15e1f6/test%2Fsequential%2Ftest-module-loading.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-module-loading.js?ref=f897843359a1f1b8dc9839105b84dcc50a15e1f6",
            "patch": "@@ -251,7 +251,6 @@ try {\n \n   assert.deepStrictEqual(children, {\n     'common/index.js': {\n-      'common/fixtures.js': {},\n       'common/tmpdir.js': {}\n     },\n     'fixtures/not-main-module.js': {},"
        }
    ],
    "stats": {
        "total": 101,
        "additions": 29,
        "deletions": 72
    }
}