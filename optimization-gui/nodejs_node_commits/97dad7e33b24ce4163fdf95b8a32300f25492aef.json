{
    "author": "cjihrig",
    "message": "cluster: use Map to track callbacks\n\nUse a Map to avoid delete operations in callback tracking.\n\nPR-URL: https://github.com/nodejs/node/pull/23125\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>",
    "sha": "97dad7e33b24ce4163fdf95b8a32300f25492aef",
    "files": [
        {
            "sha": "94b82d039a098aa28fba0fab41f8f80b08f565e3",
            "filename": "lib/internal/cluster/utils.js",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/97dad7e33b24ce4163fdf95b8a32300f25492aef/lib%2Finternal%2Fcluster%2Futils.js",
            "raw_url": "https://github.com/nodejs/node/raw/97dad7e33b24ce4163fdf95b8a32300f25492aef/lib%2Finternal%2Fcluster%2Futils.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcluster%2Futils.js?ref=97dad7e33b24ce4163fdf95b8a32300f25492aef",
            "patch": "@@ -7,7 +7,7 @@ module.exports = {\n   handles: {} // Used in tests.\n };\n \n-const callbacks = {};\n+const callbacks = new Map();\n var seq = 0;\n \n function sendHelper(proc, message, handle, cb) {\n@@ -18,7 +18,7 @@ function sendHelper(proc, message, handle, cb) {\n   message = util._extend({ cmd: 'NODE_CLUSTER' }, message);\n \n   if (typeof cb === 'function')\n-    callbacks[seq] = cb;\n+    callbacks.set(seq, cb);\n \n   message.seq = seq;\n   seq += 1;\n@@ -34,9 +34,13 @@ function internal(worker, cb) {\n \n     var fn = cb;\n \n-    if (message.ack !== undefined && callbacks[message.ack] !== undefined) {\n-      fn = callbacks[message.ack];\n-      delete callbacks[message.ack];\n+    if (message.ack !== undefined) {\n+      const callback = callbacks.get(message.ack);\n+\n+      if (callback !== undefined) {\n+        fn = callback;\n+        callbacks.delete(message.ack);\n+      }\n     }\n \n     fn.apply(worker, arguments);"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 9,
        "deletions": 5
    }
}