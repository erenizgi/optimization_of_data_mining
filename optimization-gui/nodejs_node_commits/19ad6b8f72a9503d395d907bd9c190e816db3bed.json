{
    "author": "tniessen",
    "message": "crypto: deprecate digest == null in PBKDF2\n\nI assume that permitting digest === null was unintentional when\ndigest === undefined was deprecated since their behavior was\nequivalent. The sha1 default for digest === null has somehow made it\nthrough refactoring of the PBKDF2 module multiple times, even though\ndigest === undefined has been EOL for some time now.\n\nThis change deprecates setting digest to null so we can fix the\nbehavior in Node.js 12 or so.\n\nPR-URL: https://github.com/nodejs/node/pull/22861\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "19ad6b8f72a9503d395d907bd9c190e816db3bed",
    "files": [
        {
            "sha": "b7bf532d2f71e590e6b78fed8d623c689868b71d",
            "filename": "doc/api/crypto.md",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/19ad6b8f72a9503d395d907bd9c190e816db3bed/doc%2Fapi%2Fcrypto.md",
            "raw_url": "https://github.com/nodejs/node/raw/19ad6b8f72a9503d395d907bd9c190e816db3bed/doc%2Fapi%2Fcrypto.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fcrypto.md?ref=19ad6b8f72a9503d395d907bd9c190e816db3bed",
            "patch": "@@ -1786,8 +1786,8 @@ otherwise `err` will be `null`. By default, the successfully generated\n `derivedKey` will be passed to the callback as a [`Buffer`][]. An error will be\n thrown if any of the input arguments specify invalid values or types.\n \n-If `digest` is `null`, `'sha1'` will be used. This behavior will be deprecated\n-in a future version of Node.js.\n+If `digest` is `null`, `'sha1'` will be used. This behavior is deprecated,\n+please specify a `digest` explicitely.\n \n The `iterations` argument must be a number set as high as possible. The\n higher the number of iterations, the more secure the derived key will be,\n@@ -1852,8 +1852,8 @@ applied to derive a key of the requested byte length (`keylen`) from the\n If an error occurs an `Error` will be thrown, otherwise the derived key will be\n returned as a [`Buffer`][].\n \n-If `digest` is `null`, `'sha1'` will be used. This behavior will be deprecated\n-in a future version of Node.js.\n+If `digest` is `null`, `'sha1'` will be used. This behavior is deprecated,\n+please specify a `digest` explicitely.\n \n The `iterations` argument must be a number set as high as possible. The\n higher the number of iterations, the more secure the derived key will be,"
        },
        {
            "sha": "b14599f26b05e9f8dd75750b1ab3a21b6336fe73",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/19ad6b8f72a9503d395d907bd9c190e816db3bed/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/19ad6b8f72a9503d395d907bd9c190e816db3bed/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=19ad6b8f72a9503d395d907bd9c190e816db3bed",
            "patch": "@@ -227,24 +227,31 @@ to the `constants` property exposed by the relevant module. For instance,\n ### DEP0009: crypto.pbkdf2 without digest\n <!-- YAML\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/22861\n+    description: Runtime deprecation (for `digest === null`).\n   - version: v8.0.0\n     pr-url: https://github.com/nodejs/node/pull/11305\n-    description: End-of-Life.\n+    description: End-of-Life (for `digest === undefined`).\n   - version: v6.12.0\n     pr-url: https://github.com/nodejs/node/pull/10116\n     description: A deprecation code has been assigned.\n   - version: v6.0.0\n     pr-url: https://github.com/nodejs/node/pull/4047\n-    description: Runtime deprecation.\n+    description: Runtime deprecation (for `digest === undefined`).\n -->\n \n-Type: End-of-Life\n+Type: Runtime\n \n Use of the [`crypto.pbkdf2()`][] API without specifying a digest was deprecated\n in Node.js 6.0 because the method defaulted to using the non-recommended\n `'SHA1'` digest. Previously, a deprecation warning was printed. Starting in\n-Node.js 8.0.0, calling `crypto.pbkdf2()` or `crypto.pbkdf2Sync()` with an\n-undefined `digest` will throw a `TypeError`.\n+Node.js 8.0.0, calling `crypto.pbkdf2()` or `crypto.pbkdf2Sync()` with\n+`digest` set to `undefined` will throw a `TypeError`.\n+\n+Beginning in Node.js REPLACEME, calling these functions with `digest` set to\n+`null` will print a deprecation warning to align with the behavior when `digest`\n+is `undefined`.\n \n <a id=\"DEP0010\"></a>\n ### DEP0010: crypto.createCredentials"
        },
        {
            "sha": "616892d98f04f7f4d453569cee96a1be0173b833",
            "filename": "lib/internal/crypto/pbkdf2.js",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/19ad6b8f72a9503d395d907bd9c190e816db3bed/lib%2Finternal%2Fcrypto%2Fpbkdf2.js",
            "raw_url": "https://github.com/nodejs/node/raw/19ad6b8f72a9503d395d907bd9c190e816db3bed/lib%2Finternal%2Fcrypto%2Fpbkdf2.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fpbkdf2.js?ref=19ad6b8f72a9503d395d907bd9c190e816db3bed",
            "patch": "@@ -5,6 +5,7 @@ const { AsyncWrap, Providers } = internalBinding('async_wrap');\n const { Buffer } = require('buffer');\n const { pbkdf2: _pbkdf2 } = internalBinding('crypto');\n const { validateUint32 } = require('internal/validators');\n+const { deprecate } = require('internal/util');\n const {\n   ERR_CRYPTO_INVALID_DIGEST,\n   ERR_CRYPTO_PBKDF2_ERROR,\n@@ -51,11 +52,16 @@ function pbkdf2Sync(password, salt, iterations, keylen, digest) {\n   return keybuf.toString(encoding);\n }\n \n+const defaultDigest = deprecate(() => 'sha1',\n+                                'Calling pbkdf2 or pbkdf2Sync with \"digest\" ' +\n+                                'set to null is deprecated.',\n+                                'DEP0009');\n+\n function check(password, salt, iterations, keylen, digest) {\n   if (typeof digest !== 'string') {\n     if (digest !== null)\n       throw new ERR_INVALID_ARG_TYPE('digest', ['string', 'null'], digest);\n-    digest = 'sha1';\n+    digest = defaultDigest();\n   }\n \n   password = validateArrayBufferView(password, 'password');"
        },
        {
            "sha": "db12cf14fcc16835286d5243e46b7bfa6609f7af",
            "filename": "test/parallel/test-crypto-pbkdf2.js",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/19ad6b8f72a9503d395d907bd9c190e816db3bed/test%2Fparallel%2Ftest-crypto-pbkdf2.js",
            "raw_url": "https://github.com/nodejs/node/raw/19ad6b8f72a9503d395d907bd9c190e816db3bed/test%2Fparallel%2Ftest-crypto-pbkdf2.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-pbkdf2.js?ref=19ad6b8f72a9503d395d907bd9c190e816db3bed",
            "patch": "@@ -6,6 +6,11 @@ if (!common.hasCrypto)\n const assert = require('assert');\n const crypto = require('crypto');\n \n+common.expectWarning(\n+  'DeprecationWarning',\n+  'Calling pbkdf2 or pbkdf2Sync with \"digest\" set to null is deprecated.',\n+  'DEP0009');\n+\n //\n // Test PBKDF2 with RFC 6070 test vectors (except #4)\n //\n@@ -64,7 +69,7 @@ assert.throws(\n );\n \n assert.throws(\n-  () => crypto.pbkdf2Sync('password', 'salt', -1, 20, null),\n+  () => crypto.pbkdf2Sync('password', 'salt', -1, 20, 'sha1'),\n   {\n     code: 'ERR_OUT_OF_RANGE',\n     name: 'RangeError [ERR_OUT_OF_RANGE]',"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 29,
        "deletions": 11
    }
}