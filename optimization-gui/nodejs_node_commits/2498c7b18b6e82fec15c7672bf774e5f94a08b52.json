{
    "author": "cjihrig",
    "message": "icu: make process.binding('icu') internal\n\nPR-URL: https://github.com/nodejs/node/pull/23234\nRefs: https://github.com/nodejs/node/issues/22160\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>",
    "sha": "2498c7b18b6e82fec15c7672bf774e5f94a08b52",
    "files": [
        {
            "sha": "2ceb7ce1c945e4dc3ae25fda1a0450edb3852b62",
            "filename": "lib/buffer.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Fbuffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Fbuffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fbuffer.js?ref=2498c7b18b6e82fec15c7672bf774e5f94a08b52",
            "patch": "@@ -1078,7 +1078,7 @@ if (process.binding('config').hasIntl) {\n   const {\n     icuErrName,\n     transcode: _transcode\n-  } = process.binding('icu');\n+  } = internalBinding('icu');\n \n   // Transcodes the Buffer from one encoding to another, returning a new\n   // Buffer instance."
        },
        {
            "sha": "740314c8c76a0d33e89c401da39513530fd19ee8",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=2498c7b18b6e82fec15c7672bf774e5f94a08b52",
            "patch": "@@ -394,6 +394,7 @@\n       new SafeSet([\n         'cares_wrap',\n         'fs_event_wrap',\n+        'icu',\n         'udp_wrap',\n         'uv',\n         'pipe_wrap',\n@@ -654,7 +655,7 @@\n \n   function setupProcessICUVersions() {\n     const icu = process.binding('config').hasIntl ?\n-      process.binding('icu') : undefined;\n+      internalBinding('icu') : undefined;\n     if (!icu) return;  // no Intl/ICU: nothing to add here.\n     // With no argument, getVersion() returns a comma separated list\n     // of possible types."
        },
        {
            "sha": "b2448144b0854a6b3413d231b05ed6019fa19afe",
            "filename": "lib/internal/encoding.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Finternal%2Fencoding.js",
            "raw_url": "https://github.com/nodejs/node/raw/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Finternal%2Fencoding.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fencoding.js?ref=2498c7b18b6e82fec15c7672bf774e5f94a08b52",
            "patch": "@@ -356,7 +356,7 @@ function makeTextDecoderICU() {\n     decode: _decode,\n     getConverter,\n     hasConverter\n-  } = process.binding('icu');\n+  } = internalBinding('icu');\n \n   class TextDecoder {\n     constructor(encoding = 'utf-8', options = {}) {"
        },
        {
            "sha": "0f7d969d20c218ebf92d55257230ec53e7cb45ee",
            "filename": "lib/internal/readline.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Finternal%2Freadline.js",
            "raw_url": "https://github.com/nodejs/node/raw/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Finternal%2Freadline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Freadline.js?ref=2498c7b18b6e82fec15c7672bf774e5f94a08b52",
            "patch": "@@ -31,7 +31,7 @@ CSI.kClearLine = CSI`2K`;\n CSI.kClearScreenDown = CSI`0J`;\n \n if (process.binding('config').hasIntl) {\n-  const icu = process.binding('icu');\n+  const icu = internalBinding('icu');\n   getStringWidth = function getStringWidth(str, options) {\n     options = options || {};\n     if (!Number.isInteger(str))"
        },
        {
            "sha": "db7369fed0bb402237349c4956b108c350f7719a",
            "filename": "lib/url.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/2498c7b18b6e82fec15c7672bf774e5f94a08b52/lib%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Furl.js?ref=2498c7b18b6e82fec15c7672bf774e5f94a08b52",
            "patch": "@@ -22,7 +22,7 @@\n 'use strict';\n \n const { toASCII } = process.binding('config').hasIntl ?\n-  process.binding('icu') : require('punycode');\n+  internalBinding('icu') : require('punycode');\n \n const { hexTable } = require('internal/querystring');\n "
        },
        {
            "sha": "fda53cc6d4a5d6b1f40026252ca217c3a7052fb9",
            "filename": "src/node_i18n.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2498c7b18b6e82fec15c7672bf774e5f94a08b52/src%2Fnode_i18n.cc",
            "raw_url": "https://github.com/nodejs/node/raw/2498c7b18b6e82fec15c7672bf774e5f94a08b52/src%2Fnode_i18n.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_i18n.cc?ref=2498c7b18b6e82fec15c7672bf774e5f94a08b52",
            "patch": "@@ -882,6 +882,6 @@ void Initialize(Local<Object> target,\n }  // namespace i18n\n }  // namespace node\n \n-NODE_BUILTIN_MODULE_CONTEXT_AWARE(icu, node::i18n::Initialize)\n+NODE_MODULE_CONTEXT_AWARE_INTERNAL(icu, node::i18n::Initialize)\n \n #endif  // NODE_HAVE_I18N_SUPPORT"
        },
        {
            "sha": "3744891ee098de4ba10ba2e48f4a98bcf760d8e5",
            "filename": "test/parallel/test-icu-punycode.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/2498c7b18b6e82fec15c7672bf774e5f94a08b52/test%2Fparallel%2Ftest-icu-punycode.js",
            "raw_url": "https://github.com/nodejs/node/raw/2498c7b18b6e82fec15c7672bf774e5f94a08b52/test%2Fparallel%2Ftest-icu-punycode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-icu-punycode.js?ref=2498c7b18b6e82fec15c7672bf774e5f94a08b52",
            "patch": "@@ -1,10 +1,12 @@\n 'use strict';\n+// Flags: --expose-internals\n const common = require('../common');\n \n if (!common.hasIntl)\n   common.skip('missing Intl');\n \n-const icu = process.binding('icu');\n+const { internalBinding } = require('internal/test/binding');\n+const icu = internalBinding('icu');\n const assert = require('assert');\n \n const tests = require('../fixtures/url-idna.js');"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 10,
        "deletions": 7
    }
}