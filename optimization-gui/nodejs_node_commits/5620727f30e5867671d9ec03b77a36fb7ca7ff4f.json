{
    "author": "refack",
    "message": "deps: sync V8 gypfiles with 7.1\n\nEnable v8_enable_embedded_builtins.\nReorder conditions proccessing for `run_mksnapshot`.\n\ndeps,v8: link with `atomic` for platforms lacking CAS\nFixes: https://github.com/nodejs/node-v8/issues/81\n\nCo-authored-by: MichaÃ«l Zasso <targos@protonmail.com>\nPR-URL: https://github.com/nodejs/node/pull/23423\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Myles Borins <myles.borins@gmail.com>",
    "sha": "5620727f30e5867671d9ec03b77a36fb7ca7ff4f",
    "files": [
        {
            "sha": "cfedbe4be82e3bd935da6e0194d538fff3b9d382",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 34,
            "deletions": 7,
            "changes": 41,
            "blob_url": "https://github.com/nodejs/node/blob/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=5620727f30e5867671d9ec03b77a36fb7ca7ff4f",
            "patch": "@@ -29,26 +29,53 @@\n \n     'openssl_fips%': '',\n \n+    # Some STL containers (e.g. std::vector) do not preserve ABI compatibility\n+    # between debug and non-debug mode.\n+    'disable_glibcxx_debug': 1,\n+\n+    # Don't use ICU data file (icudtl.dat) from V8, we use our own.\n+    'icu_use_data_file_flag%': 0,\n+\n     # Reset this number to 0 on major V8 upgrades.\n     # Increment by one for each non-official patch applied to deps/v8.\n-    'v8_embedder_string': '-node.0',\n+    'v8_embedder_string': '-node.1',\n+\n+    ##### V8 defaults for Node.js #####\n+\n+    # Old time default, now explicitly stated.\n+    'v8_use_snapshot': 'true',\n+\n+    # Refs: https://github.com/nodejs/node/issues/23122\n+    # Refs: https://github.com/nodejs/node/issues/23167\n+    # Enable compiler warnings when using V8_DEPRECATED apis.\n+    'v8_deprecation_warnings': 1,\n+    # Enable compiler warnings when using V8_DEPRECATE_SOON apis.\n+    'v8_imminent_deprecation_warnings': 1,\n \n     # Enable disassembler for `--print-code` v8 options\n     'v8_enable_disassembler': 1,\n \n     # Don't bake anything extra into the snapshot.\n-    'v8_use_external_startup_data%': 0,\n+    'v8_use_external_startup_data': 0,\n+\n+    # https://github.com/nodejs/node/pull/22920/files#r222779926\n+    'v8_enable_handle_zapping': 0,\n \n     # Disable V8 untrusted code mitigations.\n     # See https://github.com/v8/v8/wiki/Untrusted-code-mitigations\n     'v8_untrusted_code_mitigations': 'false',\n \n-    # Some STL containers (e.g. std::vector) do not preserve ABI compatibility\n-    # between debug and non-debug mode.\n-    'disable_glibcxx_debug': 1,\n+    # Still WIP in V8 7.1\n+    'v8_enable_pointer_compression': 'false',\n \n-    # Don't use ICU data file (icudtl.dat) from V8, we use our own.\n-    'icu_use_data_file_flag%': 0,\n+    # New in V8 7.1\n+    'v8_enable_embedded_builtins': 'true',\n+\n+    # This is more of a V8 dev setting\n+    # https://github.com/nodejs/node/pull/22920/files#r222779926\n+    'v8_enable_fast_mksnapshot': 0,\n+\n+    ##### end V8 defaults #####\n \n     'conditions': [\n       ['target_arch==\"arm64\"', {"
        },
        {
            "sha": "855a7a5d2f44c579ee1ab0ea1698a766356d52ca",
            "filename": "deps/v8/gypfiles/features.gypi",
            "status": "modified",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/deps%2Fv8%2Fgypfiles%2Ffeatures.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/deps%2Fv8%2Fgypfiles%2Ffeatures.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Ffeatures.gypi?ref=5620727f30e5867671d9ec03b77a36fb7ca7ff4f",
            "patch": "@@ -31,6 +31,8 @@\n   'variables': {\n     'v8_target_arch%': '<(target_arch)',\n \n+    'v8_current_cpu%': '<(target_arch)',\n+\n     # Emulate GN variables\n     'conditions': [\n       ['OS==\"android\"', { # GYP reverts OS to linux so use `-D OS=android`\n@@ -106,7 +108,25 @@\n     # Currently set for node by common.gypi, avoiding default because of gyp file bug.\n     # Should be turned on only for debugging.\n     #'v8_enable_handle_zapping%': 0,\n+\n+    'v8_enable_pointer_compression%': 'false',\n+\n+    'v8_enable_embedded_builtins%': 'true',\n+\n+    'v8_perf_prof_unwinding_info%': 0,\n+\n+    'v8_enable_fast_mksnapshot%': 0,\n   },\n+\n+  'conditions': [\n+    # V8's predicate inverted since we default to 'true' and set 'false' for unsupported cases.\n+    #      v8_use_snapshot         &&  v8_current_cpu != \"x86\" &&    !is_aix &&  (  !is_win || is_clang)\n+    ['not (v8_use_snapshot==\"true\" and v8_target_arch !=\"ia32\" and OS!=\"aix\" and (OS!=\"win\" or clang==1))', {\n+      'variables': {\n+        'v8_enable_embedded_builtins': 'false',\n+      }\n+    }],\n+  ],\n   'target_defaults': {\n     'conditions': [\n       ['v8_embedder_string!=\"\"', {\n@@ -170,6 +190,15 @@\n       # ['v8_enable_handle_zapping==1', {\n       #  'defines': ['ENABLE_HANDLE_ZAPPING',],\n       # }],\n+      ['v8_enable_pointer_compression==\"true\"', {\n+        'defines': ['V8_COMPRESS_POINTERS',],\n+      }],\n+      ['v8_enable_embedded_builtins==\"true\"', {\n+        'defines': [\n+          'V8_EMBEDDED_BUILTINS',\n+          'V8_EMBEDDED_BYTECODE_HANDLERS',\n+        ],\n+      }],\n     ],  # conditions\n     'defines': [\n       'V8_GYP_BUILD',"
        },
        {
            "sha": "b46b4ce678a0588ee3f5c93c578ebc85092fcfec",
            "filename": "deps/v8/gypfiles/v8-monolithic.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/deps%2Fv8%2Fgypfiles%2Fv8-monolithic.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/deps%2Fv8%2Fgypfiles%2Fv8-monolithic.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Fv8-monolithic.gyp?ref=5620727f30e5867671d9ec03b77a36fb7ca7ff4f",
            "patch": "@@ -7,8 +7,7 @@\n     'v8_code': 1,\n     'v8_random_seed%': 314159265,\n     'v8_vector_stores%': 0,\n-    'embed_script%': \"\",\n-    'warmup_script%': \"\",\n+    'v8_embed_script%': \"\",\n     'v8_extra_library_files%': [],\n     'v8_experimental_extra_library_files%': [],\n     'mksnapshot_exec': '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)mksnapshot<(EXECUTABLE_SUFFIX)',"
        },
        {
            "sha": "cf952fee63d8d9edeff201655b4cd592864a339e",
            "filename": "deps/v8/gypfiles/v8.gyp",
            "status": "modified",
            "additions": 250,
            "deletions": 82,
            "changes": 332,
            "blob_url": "https://github.com/nodejs/node/blob/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/deps%2Fv8%2Fgypfiles%2Fv8.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/deps%2Fv8%2Fgypfiles%2Fv8.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Fv8.gyp?ref=5620727f30e5867671d9ec03b77a36fb7ca7ff4f",
            "patch": "@@ -12,6 +12,47 @@\n     'v8_experimental_extra_library_files%': [],\n     'mksnapshot_exec': '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)mksnapshot<(EXECUTABLE_SUFFIX)',\n     'v8_os_page_size%': 0,\n+    'generate_bytecode_builtins_list_output' : '<(SHARED_INTERMEDIATE_DIR)/builtins-generated/bytecodes-builtins-list.h',\n+    'torque_files': [\n+      \"../src/builtins/base.tq\",\n+      \"../src/builtins/array.tq\",\n+      \"../src/builtins/array-copywithin.tq\",\n+      \"../src/builtins/array-foreach.tq\",\n+      \"../src/builtins/array-lastindexof.tq\",\n+      \"../src/builtins/array-reverse.tq\",\n+      \"../src/builtins/array-splice.tq\",\n+      \"../src/builtins/array-unshift.tq\",\n+      \"../src/builtins/typed-array.tq\",\n+      \"../src/builtins/data-view.tq\",\n+      \"../test/torque/test-torque.tq\",\n+      \"../third_party/v8/builtins/array-sort.tq\",\n+    ],\n+    'torque_modules': [\n+      \"base\",\n+      \"array\",\n+      \"typed-array\",\n+      \"data-view\",\n+      \"test\",\n+    ],\n+    # Since there is no foreach in GYP we manualy unroll the following:\n+    # foreach(module, torque_modules) {\n+    #   outputs += [\n+    #     \"$target_gen_dir/torque-generated/builtins-$module-from-dsl-gen.cc\",\n+    #     \"$target_gen_dir/torque-generated/builtins-$module-from-dsl-gen.h\",\n+    #   ]\n+    # }\n+    'torque_outputs': [\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-base-from-dsl-gen.cc',\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-base-from-dsl-gen.h',\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-array-from-dsl-gen.cc',\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-array-from-dsl-gen.h',\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-typed-array-from-dsl-gen.cc',\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-typed-array-from-dsl-gen.h',\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-data-view-from-dsl-gen.cc',\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-data-view-from-dsl-gen.h',\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-test-from-dsl-gen.cc',\n+      '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-test-from-dsl-gen.h',\n+    ],\n     'torque_generated_pure_headers': [\n       '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtin-definitions-from-dsl.h',\n     ],\n@@ -77,6 +118,7 @@\n             'v8_dump_build_config_args': [\n               '<(PRODUCT_DIR)/v8_build_config.json',\n               'dcheck_always_on=<(dcheck_always_on)',\n+              'is_android=<(is_android)',\n               'is_asan=<(asan)',\n               'is_cfi=<(cfi_vptr)',\n               'is_component_build=<(component)',\n@@ -161,6 +203,7 @@\n       ],\n       'sources': [\n         '../src/setup-isolate-full.cc',\n+        '<(generate_bytecode_builtins_list_output)',\n         '<@(torque_generated_pure_headers)',\n       ],\n       'conditions': [\n@@ -259,16 +302,7 @@\n         '../src/interpreter/interpreter-generator.h',\n         '../src/interpreter/interpreter-intrinsics-generator.cc',\n         '../src/interpreter/interpreter-intrinsics-generator.h',\n-        '../src/interpreter/setup-interpreter-internal.cc',\n-        '../src/interpreter/setup-interpreter.h',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-array-from-dsl-gen.cc',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-array-from-dsl-gen.h',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-base-from-dsl-gen.cc',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-base-from-dsl-gen.h',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-typed-array-from-dsl-gen.cc',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-typed-array-from-dsl-gen.h',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-data-view-from-dsl-gen.cc',\n-        '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-data-view-from-dsl-gen.h',\n+        '<@(torque_outputs)',\n         '<@(torque_generated_pure_headers)',\n       ],\n       'conditions': [\n@@ -327,6 +361,18 @@\n             '../src/builtins/builtins-intl-gen.cc',\n           ],\n         }],\n+        # Platforms that don't have Compare-And-Swap support need to link atomic\n+        # library to implement atomic memory access\n+        [ 'v8_current_cpu == \"mips\" or v8_current_cpu == \"mipsel\" or '\n+          'v8_current_cpu == \"mips64\" or v8_current_cpu == \"mips64el\" or '\n+          'v8_current_cpu == \"ppc\" or v8_current_cpu == \"ppc64\" or '\n+          'v8_current_cpu == \"s390\" or v8_current_cpu == \"s390x\"',\n+          {\n+            'link_settings': {\n+              'libraries': [ '-latomic', ],\n+            },\n+          },\n+        ],\n       ],\n     }, # v8_initializers\n     {\n@@ -371,47 +417,63 @@\n         '..',\n         '<(DEPTH)',\n       ],\n-      'variables': {\n-        'mksnapshot_flags': [ '--turbo_instruction_scheduling', ],\n-        'conditional_snapshot_outputs': [ ],\n-        'conditional_inputs': [ ],\n-        'conditions': [\n-          ['v8_random_seed != 0', {\n-            'mksnapshot_flags': ['--random-seed', '<(v8_random_seed)'],\n-          }],\n-          ['v8_os_page_size != 0', {\n-            'mksnapshot_flags': ['--v8_os_page_size', '<(v8_os_page_size)'],\n-          }],\n-          ['v8_use_external_startup_data !=0 ', {\n-            'conditional_snapshot_outputs': [ '<(INTERMEDIATE_DIR)/snapshot_blob.bin', ],\n-            'mksnapshot_flags': [ '--startup_blob', '<(INTERMEDIATE_DIR)/snapshot_blob.bin', ]\n-          }, {\n-             'conditional_snapshot_outputs': [ \"<(INTERMEDIATE_DIR)/snapshot.cc\" ],\n-             'mksnapshot_flags': [ '--startup_src', '<(INTERMEDIATE_DIR)/snapshot.cc', ]\n-           }],\n-          ['v8_embed_script != \"\"', {\n-            'conditional_inputs': [ '<(v8_embed_script)' ],\n-            'mksnapshot_flags': [ '<(v8_embed_script)' ],\n-          }],\n-        ],\n-      },\n       'sources': [\n         '<(SHARED_INTERMEDIATE_DIR)/experimental-extras-libraries.cc',\n         '<(SHARED_INTERMEDIATE_DIR)/extras-libraries.cc',\n         '<(SHARED_INTERMEDIATE_DIR)/libraries.cc',\n         '../src/setup-isolate-deserialize.cc',\n-        '../src/snapshot/embedded-empty.cc',\n       ],\n       'actions': [\n         {\n           'action_name': 'run_mksnapshot',\n-          'message': 'generating: >@(conditional_snapshot_outputs)',\n+          'message': 'generating: >@(_outputs)',\n+          'variables': {\n+            'mksnapshot_flags': [ '--turbo_instruction_scheduling', ],\n+          },\n+          'conditions': [\n+            ['v8_enable_embedded_builtins == \"true\"', {\n+              # In this case we use `embedded_variant \"Default\"`\n+              # and `suffix = ''` for the template `embedded${suffix}.cc`.\n+              'outputs': [ '<(INTERMEDIATE_DIR)/embedded.cc' ],\n+              'variables': {\n+                'mksnapshot_flags':  [\n+                  '--embedded_src', '<(INTERMEDIATE_DIR)/embedded.cc',\n+                  '--embedded_variant', 'Default',\n+                ],\n+              },\n+            }, {\n+               'outputs': [ '../src/snapshot/embedded-empty.cc' ]\n+            }],\n+            ['v8_random_seed != 0', {\n+              'variables': {\n+                'mksnapshot_flags': [ '--random-seed', '<(v8_random_seed)' ],\n+              },\n+            }],\n+            ['v8_os_page_size != 0', {\n+              'variables': {\n+                'mksnapshot_flags': [ '--v8_os_page_size', '<(v8_os_page_size)' ],\n+              },\n+            }],\n+            ['v8_use_external_startup_data !=0 ', {\n+              'outputs': [ '<(INTERMEDIATE_DIR)/snapshot_blob.bin', ],\n+              'variables': {\n+                'mksnapshot_flags': [ '--startup_blob', '<(INTERMEDIATE_DIR)/snapshot_blob.bin', ],\n+              },\n+            }, {\n+               'outputs': [ \"<(INTERMEDIATE_DIR)/snapshot.cc\" ],\n+               'variables': {\n+                 'mksnapshot_flags': [ '--startup_src', '<(INTERMEDIATE_DIR)/snapshot.cc', ],\n+               },\n+            }],\n+            ['v8_embed_script != \"\"', {\n+              'inputs': [ '<(v8_embed_script)' ],\n+              'variables': {\n+                'mksnapshot_flags': [ '<(v8_embed_script)' ],\n+              },\n+            }],\n+          ],\n           'inputs': [\n             '<(mksnapshot_exec)',\n-            '>@(conditional_inputs)',\n-          ],\n-          'outputs': [\n-            '>@(conditional_snapshot_outputs)',\n           ],\n           'process_outputs_as_sources': 1,\n           'action': [\n@@ -469,7 +531,9 @@\n       'dependencies': [\n         'v8_libbase',\n         'v8_libsampler',\n-        'v8_torque#host',\n+        # Code generators\n+        'torque#host',\n+        'generate_bytecode_builtins_list#host',\n       ],\n       'direct_dependent_settings': {\n         'include_dirs': ['<(SHARED_INTERMEDIATE_DIR)'],\n@@ -487,6 +551,7 @@\n         '<@(inspector_all_sources)',\n         '../include//v8-inspector-protocol.h',\n         '../include//v8-inspector.h',\n+        '../include//v8-internal.h',\n         '../include//v8-platform.h',\n         '../include//v8-profiler.h',\n         '../include//v8-testing.h',\n@@ -500,6 +565,7 @@\n         '../src/accessors.h',\n         '../src/address-map.cc',\n         '../src/address-map.h',\n+        '../src/allocation-site-scopes-inl.h',\n         '../src/allocation-site-scopes.h',\n         '../src/allocation.cc',\n         '../src/allocation.h',\n@@ -546,6 +612,7 @@\n         '../src/ast/modules.h',\n         '../src/ast/prettyprinter.cc',\n         '../src/ast/prettyprinter.h',\n+        '../src/ast/scopes-inl.h',\n         '../src/ast/scopes.cc',\n         '../src/ast/scopes.h',\n         '../src/ast/variables.cc',\n@@ -583,7 +650,6 @@\n         '../src/builtins/builtins-internal.cc',\n         '../src/builtins/builtins-interpreter.cc',\n         '../src/builtins/builtins-intl.cc',\n-        '../src/builtins/builtins-intl.h',\n         '../src/builtins/builtins-json.cc',\n         '../src/builtins/builtins-math.cc',\n         '../src/builtins/builtins-number.cc',\n@@ -797,6 +863,7 @@\n         '../src/compiler/operator.h',\n         '../src/compiler/osr.cc',\n         '../src/compiler/osr.h',\n+        '../src/compiler/per-isolate-compiler-cache.h',\n         '../src/compiler/persistent-map.h',\n         '../src/compiler/pipeline-statistics.cc',\n         '../src/compiler/pipeline-statistics.h',\n@@ -808,6 +875,8 @@\n         '../src/compiler/raw-machine-assembler.h',\n         '../src/compiler/redundancy-elimination.cc',\n         '../src/compiler/redundancy-elimination.h',\n+        '../src/compiler/refs-map.cc',\n+        '../src/compiler/refs-map.h',\n         '../src/compiler/register-allocator-verifier.cc',\n         '../src/compiler/register-allocator-verifier.h',\n         '../src/compiler/register-allocator.cc',\n@@ -1124,6 +1193,8 @@\n         '../src/macro-assembler.h',\n         '../src/map-updater.cc',\n         '../src/map-updater.h',\n+        '../src/math-random.cc',\n+        '../src/math-random.h',\n         '../src/maybe-handles-inl.h',\n         '../src/maybe-handles.h',\n         '../src/messages.cc',\n@@ -1142,6 +1213,7 @@\n         '../src/objects/arguments.h',\n         '../src/objects/bigint.cc',\n         '../src/objects/bigint.h',\n+        '../src/objects/builtin-function-id.h',\n         '../src/objects/code-inl.h',\n         '../src/objects/code.h',\n         '../src/objects/compilation-cache-inl.h',\n@@ -1165,11 +1237,17 @@\n         '../src/objects/js-array-buffer.h',\n         '../src/objects/js-array-inl.h',\n         '../src/objects/js-array.h',\n+        '../src/objects/js-break-iterator-inl.h',\n+        '../src/objects/js-break-iterator.cc',\n+        '../src/objects/js-break-iterator.h',\n         '../src/objects/js-collator-inl.h',\n         '../src/objects/js-collator.cc',\n         '../src/objects/js-collator.h',\n         '../src/objects/js-collection-inl.h',\n         '../src/objects/js-collection.h',\n+        '../src/objects/js-date-time-format-inl.h',\n+        '../src/objects/js-date-time-format.cc',\n+        '../src/objects/js-date-time-format.h',\n         '../src/objects/js-generator-inl.h',\n         '../src/objects/js-generator.h',\n         '../src/objects/js-list-format-inl.h',\n@@ -1178,6 +1256,11 @@\n         '../src/objects/js-locale-inl.h',\n         '../src/objects/js-locale.cc',\n         '../src/objects/js-locale.h',\n+        '../src/objects/js-number-format-inl.h',\n+        '../src/objects/js-number-format.cc',\n+        '../src/objects/js-number-format.h',\n+        '../src/objects/js-objects-inl.h',\n+        '../src/objects/js-objects.h',\n         '../src/objects/js-plural-rules-inl.h',\n         '../src/objects/js-plural-rules.cc',\n         '../src/objects/js-plural-rules.h',\n@@ -1192,6 +1275,9 @@\n         '../src/objects/js-relative-time-format-inl.h',\n         '../src/objects/js-relative-time-format.cc',\n         '../src/objects/js-relative-time-format.h',\n+        '../src/objects/js-segmenter-inl.h',\n+        '../src/objects/js-segmenter.cc',\n+        '../src/objects/js-segmenter.h',\n         '../src/objects/literal-objects-inl.h',\n         '../src/objects/literal-objects.cc',\n         '../src/objects/literal-objects.h',\n@@ -1202,6 +1288,9 @@\n         '../src/objects/maybe-object-inl.h',\n         '../src/objects/maybe-object.h',\n         '../src/objects/microtask-inl.h',\n+        '../src/objects/microtask-queue-inl.h',\n+        '../src/objects/microtask-queue.cc',\n+        '../src/objects/microtask-queue.h',\n         '../src/objects/microtask.h',\n         '../src/objects/module-inl.h',\n         '../src/objects/module.cc',\n@@ -1215,6 +1304,8 @@\n         '../src/objects/ordered-hash-table.h',\n         '../src/objects/promise-inl.h',\n         '../src/objects/promise.h',\n+        '../src/objects/property-array-inl.h',\n+        '../src/objects/property-array.h',\n         '../src/objects/property-descriptor-object-inl.h',\n         '../src/objects/property-descriptor-object.h',\n         '../src/objects/prototype-info-inl.h',\n@@ -1226,6 +1317,8 @@\n         '../src/objects/script.h',\n         '../src/objects/shared-function-info-inl.h',\n         '../src/objects/shared-function-info.h',\n+        '../src/objects/stack-frame-info-inl.h',\n+        '../src/objects/stack-frame-info.h',\n         '../src/objects/string-inl.h',\n         '../src/objects/string-table.h',\n         '../src/objects/string.h',\n@@ -1251,6 +1344,7 @@\n         '../src/parsing/parsing.cc',\n         '../src/parsing/parsing.h',\n         '../src/parsing/pattern-rewriter.cc',\n+        '../src/parsing/preparsed-scope-data-impl.h',\n         '../src/parsing/preparsed-scope-data.cc',\n         '../src/parsing/preparsed-scope-data.h',\n         '../src/parsing/preparser-logger.h',\n@@ -1307,6 +1401,8 @@\n         '../src/regexp/jsregexp-inl.h',\n         '../src/regexp/jsregexp.cc',\n         '../src/regexp/jsregexp.h',\n+        '../src/regexp/property-sequences.cc',\n+        '../src/regexp/property-sequences.h',\n         '../src/regexp/regexp-ast.cc',\n         '../src/regexp/regexp-ast.h',\n         '../src/regexp/regexp-macro-assembler-irregexp-inl.h',\n@@ -1328,6 +1424,7 @@\n         '../src/reloc-info.cc',\n         '../src/reloc-info.h',\n         '../src/roots-inl.h',\n+        '../src/roots.cc',\n         '../src/roots.h',\n         '../src/runtime-profiler.cc',\n         '../src/runtime-profiler.h',\n@@ -1347,7 +1444,6 @@\n         '../src/runtime/runtime-interpreter.cc',\n         '../src/runtime/runtime-intl.cc',\n         '../src/runtime/runtime-literals.cc',\n-        '../src/runtime/runtime-maths.cc',\n         '../src/runtime/runtime-module.cc',\n         '../src/runtime/runtime-numbers.cc',\n         '../src/runtime/runtime-object.cc',\n@@ -1379,8 +1475,6 @@\n         '../src/snapshot/builtin-serializer-allocator.h',\n         '../src/snapshot/builtin-serializer.cc',\n         '../src/snapshot/builtin-serializer.h',\n-        '../src/snapshot/builtin-snapshot-utils.cc',\n-        '../src/snapshot/builtin-snapshot-utils.h',\n         '../src/snapshot/code-serializer.cc',\n         '../src/snapshot/code-serializer.h',\n         '../src/snapshot/default-deserializer-allocator.cc',\n@@ -1423,6 +1517,8 @@\n         '../src/string-builder.cc',\n         '../src/string-case.cc',\n         '../src/string-case.h',\n+        '../src/string-constants.cc',\n+        '../src/string-constants.h',\n         '../src/string-hasher-inl.h',\n         '../src/string-hasher.h',\n         '../src/string-search.h',\n@@ -1431,6 +1527,7 @@\n         '../src/strtod.cc',\n         '../src/strtod.h',\n         '../src/third_party/utf8-decoder/utf8-decoder.h',\n+        '../src/torque-assembler.h',\n         '../src/tracing/trace-event.cc',\n         '../src/tracing/trace-event.h',\n         '../src/tracing/traced-value.cc',\n@@ -1502,6 +1599,7 @@\n         '../src/wasm/module-compiler.h',\n         '../src/wasm/module-decoder.cc',\n         '../src/wasm/module-decoder.h',\n+        '../src/wasm/object-access.h',\n         '../src/wasm/signature-map.cc',\n         '../src/wasm/signature-map.h',\n         '../src/wasm/streaming-decoder.cc',\n@@ -1554,6 +1652,7 @@\n         '../src/zone/zone-segment.h',\n         '../src/zone/zone.cc',\n         '../src/zone/zone.h',\n+        '<(generate_bytecode_builtins_list_output)',\n         '<@(torque_generated_pure_headers)',\n       ],\n       'conditions': [\n@@ -1892,28 +1991,39 @@\n         }, {  # v8_enable_i18n_support==0\n           'sources!': [\n             '../src/builtins/builtins-intl.cc',\n-            '../src/builtins/builtins-intl.h',\n             '../src/char-predicates.cc',\n             '../src/intl.cc',\n             '../src/intl.h',\n             '../src/objects/intl-objects-inl.h',\n             '../src/objects/intl-objects.cc',\n             '../src/objects/intl-objects.h',\n+            '../src/objects/js-break-iterator-inl.h',\n+            '../src/objects/js-break-iterator.cc',\n+            '../src/objects/js-break-iterator.h',\n             '../src/objects/js-collator-inl.h',\n             '../src/objects/js-collator.cc',\n             '../src/objects/js-collator.h',\n+            '../src/objects/js-date-time-format-inl.h',\n+            '../src/objects/js-date-time-format.cc',\n+            '../src/objects/js-date-time-format.h',\n             '../src/objects/js-list-format-inl.h',\n             '../src/objects/js-list-format.cc',\n             '../src/objects/js-list-format.h',\n             '../src/objects/js-locale-inl.h',\n             '../src/objects/js-locale.cc',\n             '../src/objects/js-locale.h',\n+            '../src/objects/js-number-format-inl.h',\n+            '../src/objects/js-number-format.cc',\n+            '../src/objects/js-number-format.h',\n             '../src/objects/js-plural-rules-inl.h',\n             '../src/objects/js-plural-rules.cc',\n             '../src/objects/js-plural-rules.h',\n             '../src/objects/js-relative-time-format-inl.h',\n             '../src/objects/js-relative-time-format.cc',\n             '../src/objects/js-relative-time-format.h',\n+            '../src/objects/js-segmenter-inl.h',\n+            '../src/objects/js-segmenter.cc',\n+            '../src/objects/js-segmenter.h',\n             '../src/runtime/runtime-intl.cc',\n           ],\n         }],\n@@ -1923,6 +2033,23 @@\n           ],\n         }],\n       ],\n+      'actions': [\n+        {\n+          'action_name': 'run_torque_action',\n+          'inputs': [  # Order matters.\n+            '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)torque<(EXECUTABLE_SUFFIX)',\n+            '<@(torque_files)',\n+          ],\n+          'outputs': [\n+            '<@(torque_outputs)',\n+            '<@(torque_generated_pure_headers)',\n+          ],\n+          'action': [\n+            '<@(_inputs)',\n+            '-o', '<(SHARED_INTERMEDIATE_DIR)/torque-generated'\n+          ],\n+        },\n+      ],\n     }, # v8_base\n     {\n       'target_name': 'v8_libbase',\n@@ -1939,6 +2066,7 @@\n       },\n       'sources': [\n         '../src/base/adapters.h',\n+        '../src/base/address-region.h',\n         '../src/base/atomic-utils.h',\n         '../src/base/atomicops.h',\n         '../src/base/atomicops_internals_atomicword_compat.h',\n@@ -1947,6 +2075,8 @@\n         '../src/base/base-export.h',\n         '../src/base/bits.cc',\n         '../src/base/bits.h',\n+        '../src/base/bounded-page-allocator.cc',\n+        '../src/base/bounded-page-allocator.h',\n         '../src/base/build_config.h',\n         '../src/base/compiler-specific.h',\n         '../src/base/cpu.cc',\n@@ -1972,6 +2102,8 @@\n         '../src/base/list.h',\n         '../src/base/logging.cc',\n         '../src/base/logging.h',\n+        '../src/base/lsan-page-allocator.cc',\n+        '../src/base/lsan-page-allocator.h',\n         '../src/base/macros.h',\n         '../src/base/once.cc',\n         '../src/base/once.h',\n@@ -1988,6 +2120,8 @@\n         '../src/base/platform/semaphore.h',\n         '../src/base/platform/time.cc',\n         '../src/base/platform/time.h',\n+        '../src/base/region-allocator.cc',\n+        '../src/base/region-allocator.h',\n         '../src/base/ring-buffer.h',\n         '../src/base/safe_conversions.h',\n         '../src/base/safe_conversions_impl.h',\n@@ -2531,10 +2665,10 @@\n       ],\n     }, # js2c\n     {\n-      'target_name': 'torque',\n-      'type': 'executable',\n+      'target_name': 'torque_base',\n+      'type': '<(component)',\n       'toolsets': ['host'],\n-      'dependencies': ['v8_libbase'],\n+      'dependencies': ['v8_libbase#host'],\n       'defines!': [\n         '_HAS_EXCEPTIONS=0',\n         'BUILDING_V8_SHARED=1',\n@@ -2547,7 +2681,11 @@\n       },\n       'sources': [\n         '../src/torque/ast.h',\n+        '../src/torque/cfg.cc',\n+        '../src/torque/cfg.h',\n         '../src/torque/contextual.h',\n+        '../src/torque/csa-generator.cc',\n+        '../src/torque/csa-generator.h',\n         '../src/torque/declarable.cc',\n         '../src/torque/declarable.h',\n         '../src/torque/declaration-visitor.cc',\n@@ -2561,13 +2699,14 @@\n         '../src/torque/global-context.h',\n         '../src/torque/implementation-visitor.cc',\n         '../src/torque/implementation-visitor.h',\n+        '../src/torque/instructions.cc',\n+        '../src/torque/instructions.h',\n         '../src/torque/scope.cc',\n         '../src/torque/scope.h',\n         '../src/torque/source-positions.cc',\n         '../src/torque/source-positions.h',\n         '../src/torque/torque-parser.cc',\n         '../src/torque/torque-parser.h',\n-        '../src/torque/torque.cc',\n         '../src/torque/type-oracle.cc',\n         '../src/torque/type-oracle.h',\n         '../src/torque/types.cc',\n@@ -2577,40 +2716,24 @@\n       ],\n     }, # torque_base\n     {\n-      'target_name': 'v8_torque',\n-      'type': 'none',\n+      'target_name': 'torque',\n+      'type': 'executable',\n       'toolsets': ['host'],\n-      'dependencies': ['torque#host'],\n-      'direct_dependent_settings': {\n-        'include_dirs+': ['<(SHARED_INTERMEDIATE_DIR)'],\n-      },\n-      'actions': [\n-        {\n-          'action_name': 'run_torque',\n-          'inputs': [  # Order matters.\n-            '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)torque<(EXECUTABLE_SUFFIX)',\n-            '../src/builtins/base.tq',\n-            '../src/builtins/array.tq',\n-            '../src/builtins/array-copywithin.tq',\n-            '../src/builtins/array-foreach.tq',\n-            '../src/builtins/array-reverse.tq',\n-            '../src/builtins/typed-array.tq',\n-            '../src/builtins/data-view.tq',\n-            '../third_party/v8/builtins/array-sort.tq',\n-          ],\n-          'outputs': [\n-            '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtin-definitions-from-dsl.h',\n-            '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-array-from-dsl-gen.cc',\n-            '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-array-from-dsl-gen.h',\n-            '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-base-from-dsl-gen.cc',\n-            '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-base-from-dsl-gen.h',\n-            '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-typed-array-from-dsl-gen.cc',\n-            '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-typed-array-from-dsl-gen.h',\n-            '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-data-view-from-dsl-gen.cc',\n-            '<(SHARED_INTERMEDIATE_DIR)/torque-generated/builtins-data-view-from-dsl-gen.h',\n-          ],\n-          'action': ['<@(_inputs)', '-o', '<(SHARED_INTERMEDIATE_DIR)/torque-generated'],\n+      'dependencies': ['torque_base'],\n+      'defines!': [\n+        '_HAS_EXCEPTIONS=0',\n+        'BUILDING_V8_SHARED=1',\n+      ],\n+      # This is defined trough `configurations` for GYP+ninja compatibility\n+      'msvs_settings': {\n+        'VCCLCompilerTool': {\n+          'RuntimeTypeInfo': 'true',\n+          'ExceptionHandling': 1,\n         },\n+      },\n+      'include_dirs': ['..'],\n+      'sources': [\n+        \"../src/torque/torque.cc\",\n       ],\n     }, # torque\n     {\n@@ -2620,6 +2743,8 @@\n         'heapobject_files': [\n             '../src/objects.h',\n             '../src/objects-inl.h',\n+            '../src/objects/allocation-site-inl.h',\n+            '../src/objects/allocation-site.h',\n             '../src/objects/code-inl.h',\n             '../src/objects/code.h',\n             '../src/objects/data-handler.h',\n@@ -2630,6 +2755,8 @@\n             '../src/objects/js-array.h',\n             '../src/objects/js-array-buffer-inl.h',\n             '../src/objects/js-array-buffer.h',\n+            '../src/objects/js-objects-inl.h',\n+            '../src/objects/js-objects.h',\n             '../src/objects/js-regexp-inl.h',\n             '../src/objects/js-regexp.h',\n             '../src/objects/js-regexp-string-iterator-inl.h',\n@@ -2697,6 +2824,47 @@\n         }],\n       ],\n     }, # mksnapshot\n+    {\n+      'target_name': 'bytecode_builtins_list_generator',\n+      'type': 'executable',\n+      'toolsets': ['host'],\n+      'dependencies': [\n+        \"v8_libbase#host\"\n+      ],\n+      'include_dirs': [\"..\"],\n+      'sources': [\n+        \"../src/builtins/generate-bytecodes-builtins-list.cc\",\n+        \"../src/interpreter/bytecode-operands.cc\",\n+        \"../src/interpreter/bytecode-operands.h\",\n+        \"../src/interpreter/bytecodes.cc\",\n+        \"../src/interpreter/bytecodes.h\",\n+      ],\n+    }, # bytecode_builtins_list_generator\n+    {\n+      'target_name': 'generate_bytecode_builtins_list',\n+      'type': 'none',\n+      'toolsets': ['host'],\n+      'dependencies': [\n+        \"bytecode_builtins_list_generator\",\n+      ],\n+      'actions': [\n+        {\n+          'action_name': 'generate_bytecode_builtins_list_action',\n+          'inputs': [\n+            '<(PRODUCT_DIR)/<(EXECUTABLE_PREFIX)bytecode_builtins_list_generator<(EXECUTABLE_SUFFIX)',\n+          ],\n+          'outputs': [\n+            '<(generate_bytecode_builtins_list_output)',\n+          ],\n+          'action': [\n+            'python',\n+            '../tools/run.py',\n+            '<@(_inputs)',\n+            '<@(_outputs)',\n+          ],\n+        },\n+      ],\n+    }, # generate_bytecode_builtins_list\n     {\n       'includes': [ 'v8_external_snapshot.gypi' ],\n     }, # v8_external_snapshot"
        },
        {
            "sha": "9b2af0bb19bd3da60ed5013651379919e226340c",
            "filename": "deps/v8/gypfiles/v8_external_snapshot.gypi",
            "status": "modified",
            "additions": 26,
            "deletions": 17,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/deps%2Fv8%2Fgypfiles%2Fv8_external_snapshot.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/5620727f30e5867671d9ec03b77a36fb7ca7ff4f/deps%2Fv8%2Fgypfiles%2Fv8_external_snapshot.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Fv8_external_snapshot.gypi?ref=5620727f30e5867671d9ec03b77a36fb7ca7ff4f",
            "patch": "@@ -3,22 +3,22 @@\n   'target_name': 'v8_external_snapshot',\n   'type': 'static_library',\n   'conditions': [\n-    [ 'v8_use_external_startup_data==1', {\n+    ['v8_use_external_startup_data==1', {\n       'conditions': [\n         ['want_separate_host_toolset==1', {\n           'toolsets': ['host', 'target'],\n           'dependencies': [\n             'mksnapshot#host',\n             'js2c#host',\n             'natives_blob',\n-        ]}, {\n-          'toolsets': ['target'],\n-          'dependencies': [\n-            'mksnapshot',\n-            'js2c',\n-            'natives_blob',\n-          ],\n-        }],\n+          ]}, {\n+           'toolsets': ['target'],\n+           'dependencies': [\n+             'mksnapshot',\n+             'js2c',\n+             'natives_blob',\n+           ],\n+         }],\n         ['component==\"shared_library\"', {\n           'defines': [\n             'BUILDING_V8_SHARED',\n@@ -33,7 +33,7 @@\n       'dependencies': [\n         'v8_base',\n       ],\n-      'include_dirs+': [\n+      'include_dirs': [\n         '..',\n         '<(DEPTH)',\n       ],\n@@ -42,6 +42,7 @@\n         '../src/snapshot/embedded-empty.cc',\n         '../src/snapshot/natives-external.cc',\n         '../src/snapshot/snapshot-external.cc',\n+        '<(embedded_builtins_snapshot_src)',\n       ],\n       'actions': [\n         {\n@@ -61,24 +62,31 @@\n               ['v8_os_page_size!=0', {\n                 'mksnapshot_flags': ['--v8_os_page_size', '<(v8_os_page_size)'],\n               }],\n+              ['v8_enable_embedded_builtins=\"true\"', {\n+                # 'embedded_builtins_snapshot_src': [ \"$target_gen_dir/embedded${suffix}.cc\" ],\n+                # 'mksnapshot_flags':  [\"--embedded_src\", \"$target_gen_dir/embedded${suffix}.cc\",],\n+                # if (invoker.embedded_variant != \"\") {\n+                #   args += [\n+                #     \"--embedded_variant\",\n+                #     invoker.embedded_variant,\n+                #   ]\n+                # }\n+              },\n+               ],\n             ],\n           },\n           'conditions': [\n-            ['embed_script!=\"\"', {\n+            ['v8_embed_script!=\"\"', {\n               'inputs': [\n-                '<(embed_script)',\n-              ],\n-            }],\n-            ['warmup_script!=\"\"', {\n-              'inputs': [\n-                '<(warmup_script)',\n+                '<(v8_embed_script)',\n               ],\n             }],\n             ['want_separate_host_toolset==1', {\n               'target_conditions': [\n                 ['_toolset==\"host\"', {\n                   'outputs': [\n                     '<(PRODUCT_DIR)/snapshot_blob_host.bin',\n+                    '<(embedded_builtins_snapshot_src)'\n                   ],\n                   'action': [\n                     '<(mksnapshot_exec)',\n@@ -103,6 +111,7 @@\n             }, {\n               'outputs': [\n                 '<(PRODUCT_DIR)/snapshot_blob.bin',\n+                '<(embedded_builtins_snapshot_src)'\n               ],\n               'action': [\n                 '<(mksnapshot_exec)',"
        }
    ],
    "stats": {
        "total": 448,
        "additions": 340,
        "deletions": 108
    }
}