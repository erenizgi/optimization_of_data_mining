{
    "author": "vsemozhetbyt",
    "message": "tools: improve heading type detection in json.js\n\nPR-URL: https://github.com/nodejs/node/pull/20074\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "7fcb52c7b2236cbd7db1dc63274a2670fcd2fb9d",
    "files": [
        {
            "sha": "44b67e3e284b17edf64b181f4907591289b27438",
            "filename": "tools/doc/json.js",
            "status": "modified",
            "additions": 47,
            "deletions": 8,
            "changes": 55,
            "blob_url": "https://github.com/nodejs/node/blob/7fcb52c7b2236cbd7db1dc63274a2670fcd2fb9d/tools%2Fdoc%2Fjson.js",
            "raw_url": "https://github.com/nodejs/node/raw/7fcb52c7b2236cbd7db1dc63274a2670fcd2fb9d/tools%2Fdoc%2Fjson.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fjson.js?ref=7fcb52c7b2236cbd7db1dc63274a2670fcd2fb9d",
            "patch": "@@ -553,15 +553,54 @@ function cloneValue(src) {\n }\n \n \n-// These parse out the contents of an H# tag.\n+// This section parse out the contents of an H# tag.\n+\n+// To reduse escape slashes in RegExp string components.\n+const r = String.raw;\n+\n+const eventPrefix = '^Event: +';\n+const classPrefix = '^[Cc]lass: +';\n+const ctorPrefix = '^(?:[Cc]onstructor: +)?new +';\n+const classMethodPrefix = '^Class Method: +';\n+const maybeClassPropertyPrefix = '(?:Class Property: +)?';\n+\n+const maybeQuote = '[\\'\"]?';\n+const notQuotes = '[^\\'\"]+';\n+\n+// To include constructs like `readable\\[Symbol.asyncIterator\\]()`\n+// or `readable.\\_read(size)` (with Markdown escapes).\n+const simpleId = r`(?:(?:\\\\?_)+|\\b)\\w+\\b`;\n+const computedId = r`\\\\?\\[[\\w\\.]+\\\\?\\]`;\n+const id = `(?:${simpleId}|${computedId})`;\n+const classId = r`[A-Z]\\w+`;\n+\n+const ancestors = r`(?:${id}\\.?)+`;\n+const maybeAncestors = r`(?:${id}\\.?)*`;\n+\n+const callWithParams = r`\\([^)]*\\)`;\n+\n+const noCallOrProp = '(?![.[(])';\n+\n+const maybeExtends = `(?: +extends +${maybeAncestors}${classId})?`;\n+\n const headingExpressions = [\n-  { type: 'event', re: /^Event(?::|\\s)+['\"]?([^\"']+).*$/i },\n-  { type: 'class', re: /^Class:\\s*([^ ]+).*$/i },\n-  { type: 'property', re: /^[^.[]+(\\[[^\\]]+\\])\\s*$/ },\n-  { type: 'property', re: /^[^.]+\\.([^ .()]+)\\s*$/ },\n-  { type: 'classMethod', re: /^class\\s*method\\s*:?[^.]+\\.([^ .()]+)\\([^)]*\\)\\s*$/i },\n-  { type: 'method', re: /^(?:[^.]+\\.)?([^ .()]+)\\([^)]*\\)\\s*$/ },\n-  { type: 'ctor', re: /^new ([A-Z][a-zA-Z]+)\\([^)]*\\)\\s*$/ },\n+  { type: 'event', re: RegExp(\n+    `${eventPrefix}${maybeQuote}(${notQuotes})${maybeQuote}$`, 'i') },\n+\n+  { type: 'class', re: RegExp(\n+    `${classPrefix}(${maybeAncestors}${classId})${maybeExtends}$`, '') },\n+\n+  { type: 'ctor', re: RegExp(\n+    `${ctorPrefix}(${maybeAncestors}${classId})${callWithParams}$`, '') },\n+\n+  { type: 'classMethod', re: RegExp(\n+    `${classMethodPrefix}${maybeAncestors}(${id})${callWithParams}$`, 'i') },\n+\n+  { type: 'method', re: RegExp(\n+    `^${maybeAncestors}(${id})${callWithParams}$`, 'i') },\n+\n+  { type: 'property', re: RegExp(\n+    `^${maybeClassPropertyPrefix}${ancestors}(${id})${noCallOrProp}$`, 'i') },\n ];\n \n function newSection({ text }) {"
        }
    ],
    "stats": {
        "total": 55,
        "additions": 47,
        "deletions": 8
    }
}