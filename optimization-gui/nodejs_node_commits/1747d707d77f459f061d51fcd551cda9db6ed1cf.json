{
    "author": "danbev",
    "message": "src: move no_async_hooks_checks to env\n\nThis commit moves the setting of AsyncHooks no_force_checks to the\nEnvironment constructor instead of from the Start function in node.cc.\n\nPR-URL: https://github.com/nodejs/node/pull/22784\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "1747d707d77f459f061d51fcd551cda9db6ed1cf",
    "files": [
        {
            "sha": "0b0664b28616b8bca5b3c8dc3f393d46306e098d",
            "filename": "src/env.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/1747d707d77f459f061d51fcd551cda9db6ed1cf/src%2Fenv.cc",
            "raw_url": "https://github.com/nodejs/node/raw/1747d707d77f459f061d51fcd551cda9db6ed1cf/src%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.cc?ref=1747d707d77f459f061d51fcd551cda9db6ed1cf",
            "patch": "@@ -189,6 +189,9 @@ Environment::Environment(IsolateData* isolate_data,\n \n   isolate()->GetHeapProfiler()->AddBuildEmbedderGraphCallback(\n       BuildEmbedderGraph, this);\n+  if (options_->no_force_async_hooks_checks) {\n+    async_hooks_.no_force_checks();\n+  }\n }\n \n Environment::~Environment() {"
        },
        {
            "sha": "4a161eb3b28350e45b72ec3304265271cf9a2958",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/1747d707d77f459f061d51fcd551cda9db6ed1cf/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/1747d707d77f459f061d51fcd551cda9db6ed1cf/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=1747d707d77f459f061d51fcd551cda9db6ed1cf",
            "patch": "@@ -2894,12 +2894,6 @@ inline int Start(Isolate* isolate, IsolateData* isolate_data,\n     return 12;  // Signal internal error.\n   }\n \n-  // TODO(addaleax): Maybe access this option directly instead of setting\n-  // a boolean member of Environment. Ditto below for trace_sync_io.\n-  if (env.options()->no_force_async_hooks_checks) {\n-    env.async_hooks()->no_force_checks();\n-  }\n-\n   {\n     Environment::AsyncCallbackScope callback_scope(&env);\n     env.async_hooks()->push_async_ids(1, 0);"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 3,
        "deletions": 6
    }
}