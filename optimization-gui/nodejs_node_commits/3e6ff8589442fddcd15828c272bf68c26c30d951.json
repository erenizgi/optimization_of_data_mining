{
    "author": "targos",
    "message": "tools: fix make test-v8\n\nPR-URL: https://github.com/nodejs/node/pull/19201\nReviewed-By: Ali Ijaz Sheikh <ofrobots@google.com>\nReviewed-By: Myles Borins <myles.borins@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "3e6ff8589442fddcd15828c272bf68c26c30d951",
    "files": [
        {
            "sha": "00a3e46df884d7dbe356f167100b8985481bc8d4",
            "filename": "Makefile",
            "status": "modified",
            "additions": 10,
            "deletions": 25,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/3e6ff8589442fddcd15828c272bf68c26c30d951/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/3e6ff8589442fddcd15828c272bf68c26c30d951/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=3e6ff8589442fddcd15828c272bf68c26c30d951",
            "patch": "@@ -20,17 +20,12 @@ ifdef JOBS\n   PARALLEL_ARGS = -j $(JOBS)\n endif\n \n-ifdef QUICKCHECK\n-  QUICKCHECK_ARG := --quickcheck\n-endif\n-\n ifdef ENABLE_V8_TAP\n   TAP_V8 := --junitout $(PWD)/v8-tap.xml\n   TAP_V8_INTL := --junitout $(PWD)/v8-intl-tap.xml\n   TAP_V8_BENCHMARKS := --junitout $(PWD)/v8-benchmarks-tap.xml\n endif\n \n-V8_BUILD_OPTIONS += GYPFLAGS=\"-Dclang=0\"\n V8_TEST_OPTIONS = $(V8_EXTRA_TEST_OPTIONS)\n ifdef DISABLE_V8_I18N\n   V8_BUILD_OPTIONS += i18nsupport=off\n@@ -233,8 +228,7 @@ endif\n # Rebuilds deps/v8 as a git tree, pulls its third-party dependencies, and\n # builds it.\n v8:\n-\ttools/make-v8.sh\n-\t$(MAKE) -C deps/v8 $(V8_ARCH).$(BUILDTYPE_LOWER) $(V8_BUILD_OPTIONS)\n+\ttools/make-v8.sh $(V8_ARCH).$(BUILDTYPE_LOWER) $(V8_BUILD_OPTIONS)\n \n .PHONY: jstest\n jstest: build-addons build-addons-napi ## Runs addon tests and JS tests\n@@ -569,31 +563,22 @@ test-with-async-hooks:\n ifneq (\"\",\"$(wildcard deps/v8/tools/run-tests.py)\")\n # Related CI job: node-test-commit-v8-linux\n test-v8: v8  ## Runs the V8 test suite on deps/v8.\n-# Performs a full test unless QUICKCHECK is specified.\n-# Note that we cannot run the tests in deps/v8 directly without rebuilding a\n-# git tree and using gclient to pull the third-party dependencies, which is\n-# done by the `v8` target.\n-\tdeps/v8/tools/run-tests.py --arch=$(V8_ARCH) \\\n-        --mode=$(BUILDTYPE_LOWER) $(V8_TEST_OPTIONS) $(QUICKCHECK_ARG) \\\n-        --no-presubmit \\\n-        --shell-dir=$(PWD)/deps/v8/out/$(V8_ARCH).$(BUILDTYPE_LOWER) \\\n-\t $(TAP_V8)\n-\tgit clean -fdxq -- deps/v8\n+\tdeps/v8/tools/run-tests.py --gn --arch=$(V8_ARCH) \\\n+        --mode=$(BUILDTYPE_LOWER) $(V8_TEST_OPTIONS) \\\n+\t\t\t\tmjsunit cctest debugger inspector message preparser \\\n+\t      $(TAP_V8)\n \t@echo Testing hash seed\n \t$(MAKE) test-hash-seed\n \n test-v8-intl: v8\n-# Performs a full test unless QUICKCHECK is specified.\n-\tdeps/v8/tools/run-tests.py --arch=$(V8_ARCH) \\\n-        --mode=$(BUILDTYPE_LOWER) --no-presubmit $(QUICKCHECK_ARG) \\\n-        --shell-dir=deps/v8/out/$(V8_ARCH).$(BUILDTYPE_LOWER) intl \\\n+\tdeps/v8/tools/run-tests.py --gn --arch=$(V8_ARCH) \\\n+        --mode=$(BUILDTYPE_LOWER) intl \\\n         $(TAP_V8_INTL)\n \n test-v8-benchmarks: v8\n-\tdeps/v8/tools/run-tests.py --arch=$(V8_ARCH) --mode=$(BUILDTYPE_LOWER) \\\n-        --download-data $(QUICKCHECK_ARG) --no-presubmit \\\n-        --shell-dir=deps/v8/out/$(V8_ARCH).$(BUILDTYPE_LOWER) benchmarks \\\n-\t $(TAP_V8_BENCHMARKS)\n+\tdeps/v8/tools/run-tests.py --gn --arch=$(V8_ARCH) --mode=$(BUILDTYPE_LOWER) \\\n+        benchmarks \\\n+\t      $(TAP_V8_BENCHMARKS)\n \n test-v8-all: test-v8 test-v8-intl test-v8-benchmarks\n # runs all v8 tests"
        },
        {
            "sha": "4365412856d7412299955a9d2830aae2be4f2f1f",
            "filename": "tools/make-v8.sh",
            "status": "modified",
            "additions": 6,
            "deletions": 44,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/3e6ff8589442fddcd15828c272bf68c26c30d951/tools%2Fmake-v8.sh",
            "raw_url": "https://github.com/nodejs/node/raw/3e6ff8589442fddcd15828c272bf68c26c30d951/tools%2Fmake-v8.sh",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmake-v8.sh?ref=3e6ff8589442fddcd15828c272bf68c26c30d951",
            "patch": "@@ -1,47 +1,9 @@\n #!/bin/bash\n \n-# Get V8 branch from v8/include/v8-version.h\n-MAJOR=$(grep V8_MAJOR_VERSION deps/v8/include/v8-version.h | cut -d ' ' -f 3)\n-MINOR=$(grep V8_MINOR_VERSION deps/v8/include/v8-version.h | cut -d ' ' -f 3)\n-BRANCH=$MAJOR.$MINOR\n+BUILD_ARCH_TYPE=$1\n+V8_BUILD_OPTIONS=$2\n \n-# clean up if someone presses ctrl-c\n-trap cleanup INT\n-\n-function cleanup() {\n-  trap - INT\n-  rm .gclient || true\n-  rm .gclient_entries || true\n-  rm -rf _bad_scm/ || true\n-  find v8 -name \".git\" | xargs rm -rf || true\n-  echo \"git cleanup\"\n-  git reset --hard HEAD\n-  git clean -fdq\n-  # unstash local changes\n-  git stash pop\n-  exit 0\n-}\n-\n-cd deps\n-# stash local changes\n-git stash\n-rm -rf v8\n-\n-echo \"Fetching V8 from chromium.googlesource.com\"\n-fetch v8\n-if [ \"$?\" -ne 0 ]; then\n-  echo \"V8 fetch failed\"\n-  exit 1\n-fi\n-echo \"V8 fetched\"\n-\n-cd v8\n-\n-echo \"Checking out branch:$BRANCH\"\n-git checkout remotes/branch-heads/$BRANCH\n-\n-echo \"Sync dependencies\"\n-gclient sync\n-\n-cd ..\n-cleanup\n+cd deps/v8\n+tools/node/fetch_deps.py .\n+PATH=~/_depot_tools:$PATH tools/dev/v8gen.py $BUILD_ARCH_TYPE --no-goma $V8_BUILD_OPTIONS\n+PATH=~/_depot_tools:$PATH ninja -C out.gn/$BUILD_ARCH_TYPE/ d8 cctest inspector-test"
        }
    ],
    "stats": {
        "total": 85,
        "additions": 16,
        "deletions": 69
    }
}