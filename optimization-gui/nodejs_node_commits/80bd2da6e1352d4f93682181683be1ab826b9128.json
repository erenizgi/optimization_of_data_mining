{
    "author": "joyeecheung",
    "message": "fs: use SyncCall in WriteBuffers\n\nPR-URL: https://github.com/nodejs/node/pull/19041\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "80bd2da6e1352d4f93682181683be1ab826b9128",
    "files": [
        {
            "sha": "f25bc81d610b5a9012f8dfedc78d43b24fd77e3b",
            "filename": "src/node_file.cc",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/80bd2da6e1352d4f93682181683be1ab826b9128/src%2Fnode_file.cc",
            "raw_url": "https://github.com/nodejs/node/raw/80bd2da6e1352d4f93682181683be1ab826b9128/src%2Fnode_file.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.cc?ref=80bd2da6e1352d4f93682181683be1ab826b9128",
            "patch": "@@ -1320,11 +1320,15 @@ static void WriteBuffer(const FunctionCallbackInfo<Value>& args) {\n static void WriteBuffers(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n+  const int argc = args.Length();\n+  CHECK_GE(argc, 3);\n+\n   CHECK(args[0]->IsInt32());\n-  CHECK(args[1]->IsArray());\n+  const int fd = args[0].As<Int32>()->Value();\n \n-  int fd = args[0]->Int32Value();\n+  CHECK(args[1]->IsArray());\n   Local<Array> chunks = args[1].As<Array>();\n+\n   int64_t pos = GET_OFFSET(args[2]);\n \n   MaybeStackBuffer<uv_buf_t> iovs(chunks->Length());\n@@ -1336,14 +1340,16 @@ static void WriteBuffers(const FunctionCallbackInfo<Value>& args) {\n   }\n \n   FSReqBase* req_wrap = GetReqWrap(env, args[3]);\n-  if (req_wrap != nullptr) {\n+  if (req_wrap != nullptr) {  // writeBuffers(fd, chunks, pos, req)\n     AsyncCall(env, req_wrap, args, \"write\", UTF8, AfterInteger,\n               uv_fs_write, fd, *iovs, iovs.length(), pos);\n-    return;\n+  } else {  // writeBuffers(fd, chunks, pos, undefined, ctx)\n+    CHECK_EQ(argc, 5);\n+    fs_req_wrap req_wrap;\n+    int bytesWritten = SyncCall(env, args[4], &req_wrap, \"write\",\n+                                uv_fs_write, fd, *iovs, iovs.length(), pos);\n+    args.GetReturnValue().Set(bytesWritten);\n   }\n-\n-  SYNC_CALL(write, nullptr, fd, *iovs, iovs.length(), pos)\n-  args.GetReturnValue().Set(SYNC_RESULT);\n }\n \n "
        }
    ],
    "stats": {
        "total": 20,
        "additions": 13,
        "deletions": 7
    }
}