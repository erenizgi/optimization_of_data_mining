{
    "author": "Trott",
    "message": "test: fix flaky watchFile()\n\nThe regression that test-fs-watch-file-enoent-after-deletion was written\nto test for involves whether or not the callback runs or not. Checking\nwhat the file watcher reports unfortunately is subject to race\nconditions on Windows (and possibly elsewhere) because the file watcher\nreturns control to the event loop before it may be receiving data from\nthe OS. So remove those assertions. The test still checks what it is\nsupposed to check, but is no longer subject to race conditions.\n\nFixes: https://github.com/nodejs/node/issues/21692\n\nPR-URL: https://github.com/nodejs/node/pull/21694\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "8c305e1c2fc94e3d0b3e6a016f5635970e287df7",
    "files": [
        {
            "sha": "83c7516c9c6ca994394303e1875caf5ec57df095",
            "filename": "test/parallel/test-fs-watch-file-enoent-after-deletion.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/8c305e1c2fc94e3d0b3e6a016f5635970e287df7/test%2Fparallel%2Ftest-fs-watch-file-enoent-after-deletion.js",
            "raw_url": "https://github.com/nodejs/node/raw/8c305e1c2fc94e3d0b3e6a016f5635970e287df7/test%2Fparallel%2Ftest-fs-watch-file-enoent-after-deletion.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-watch-file-enoent-after-deletion.js?ref=8c305e1c2fc94e3d0b3e6a016f5635970e287df7",
            "patch": "@@ -32,7 +32,6 @@ const common = require('../common');\n // stopped it from getting emitted.\n // https://github.com/nodejs/node-v0.x-archive/issues/4027\n \n-const assert = require('assert');\n const path = require('path');\n const fs = require('fs');\n \n@@ -43,8 +42,6 @@ const filename = path.join(tmpdir.path, 'watched');\n fs.writeFileSync(filename, 'quis custodiet ipsos custodes');\n \n fs.watchFile(filename, { interval: 50 }, common.mustCall(function(curr, prev) {\n-  assert.strictEqual(prev.nlink, 1);\n-  assert.strictEqual(curr.nlink, 0);\n   fs.unwatchFile(filename);\n }));\n ",
            "previous_filename": "test/sequential/test-fs-watch-file-enoent-after-deletion.js"
        }
    ],
    "stats": {
        "total": 3,
        "additions": 0,
        "deletions": 3
    }
}