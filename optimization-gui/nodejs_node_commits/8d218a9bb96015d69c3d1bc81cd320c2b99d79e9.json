{
    "author": "danbev",
    "message": "crypto: replace goto SSL_CTX_use_certificate_chain\n\nThis commit removes the goto statements in SSL_CTX_use_certificate_chain\nby using a unique_ptr.\n\nPR-URL: https://github.com/nodejs/node/pull/23113\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "8d218a9bb96015d69c3d1bc81cd320c2b99d79e9",
    "files": [
        {
            "sha": "4cccc6eb7a47727baae40b11ff2342e8d80bc9ab",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 25,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/8d218a9bb96015d69c3d1bc81cd320c2b99d79e9/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/8d218a9bb96015d69c3d1bc81cd320c2b99d79e9/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=8d218a9bb96015d69c3d1bc81cd320c2b99d79e9",
            "patch": "@@ -647,50 +647,39 @@ int SSL_CTX_use_certificate_chain(SSL_CTX* ctx,\n   if (!x)\n     return 0;\n \n-  // TODO(addaleax): Turn this into smart pointer as well.\n-  X509* extra = nullptr;\n-  int ret = 0;\n   unsigned long err = 0;  // NOLINT(runtime/int)\n \n   StackOfX509 extra_certs(sk_X509_new_null());\n   if (!extra_certs)\n-    goto done;\n+    return 0;\n \n-  while ((extra = PEM_read_bio_X509(in.get(),\n+  while (X509Pointer extra {PEM_read_bio_X509(in.get(),\n                                     nullptr,\n                                     NoPasswordCallback,\n-                                    nullptr))) {\n-    if (sk_X509_push(extra_certs.get(), extra))\n+                                    nullptr)}) {\n+    if (sk_X509_push(extra_certs.get(), extra.get())) {\n+      extra.release();\n       continue;\n+    }\n \n-    // Failure, free all certs\n-    goto done;\n+    return 0;\n   }\n-  extra = nullptr;\n \n   // When the while loop ends, it's usually just EOF.\n   err = ERR_peek_last_error();\n   if (ERR_GET_LIB(err) == ERR_LIB_PEM &&\n       ERR_GET_REASON(err) == PEM_R_NO_START_LINE) {\n     ERR_clear_error();\n-  } else  {\n+  } else {\n     // some real error\n-    goto done;\n+    return 0;\n   }\n \n-  ret = SSL_CTX_use_certificate_chain(ctx,\n-                                      std::move(x),\n-                                      extra_certs.get(),\n-                                      cert,\n-                                      issuer);\n-  if (!ret)\n-    goto done;\n-\n- done:\n-  if (extra != nullptr)\n-    X509_free(extra);\n-\n-  return ret;\n+  return SSL_CTX_use_certificate_chain(ctx,\n+                                       std::move(x),\n+                                       extra_certs.get(),\n+                                       cert,\n+                                       issuer);\n }\n \n "
        }
    ],
    "stats": {
        "total": 39,
        "additions": 14,
        "deletions": 25
    }
}