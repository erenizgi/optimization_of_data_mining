{
    "author": "devsnek",
    "message": "atomis: add notify alias\n\nPR-URL: https://github.com/nodejs/node/pull/21413\nRefs: https://github.com/nodejs/node/issues/21219\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "84f3769ab1a0d3013b391f87b77f3106f991dbfc",
    "files": [
        {
            "sha": "a779517907390fe761d73fbe46cc79471cc8307e",
            "filename": ".eslintrc.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/84f3769ab1a0d3013b391f87b77f3106f991dbfc/.eslintrc.js",
            "raw_url": "https://github.com/nodejs/node/raw/84f3769ab1a0d3013b391f87b77f3106f991dbfc/.eslintrc.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/.eslintrc.js?ref=84f3769ab1a0d3013b391f87b77f3106f991dbfc",
            "patch": "@@ -243,6 +243,7 @@ module.exports = {\n     'node-core/no-unescaped-regexp-dot': 'error',\n   },\n   globals: {\n+    Atomics: false,\n     BigInt: false,\n     BigInt64Array: false,\n     BigUint64Array: false,"
        },
        {
            "sha": "6cf5f2ad84b1dbc0db4ac858570ea2eff1732937",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 23,
            "deletions": 2,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/84f3769ab1a0d3013b391f87b77f3106f991dbfc/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/84f3769ab1a0d3013b391f87b77f3106f991dbfc/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=84f3769ab1a0d3013b391f87b77f3106f991dbfc",
            "patch": "@@ -3478,16 +3478,37 @@ Local<Context> NewContext(Isolate* isolate,\n   auto context = Context::New(isolate, nullptr, object_template);\n   if (context.IsEmpty()) return context;\n   HandleScope handle_scope(isolate);\n-  auto intl_key = FIXED_ONE_BYTE_STRING(isolate, \"Intl\");\n-  auto break_iter_key = FIXED_ONE_BYTE_STRING(isolate, \"v8BreakIterator\");\n   context->SetEmbedderData(\n       ContextEmbedderIndex::kAllowWasmCodeGeneration, True(isolate));\n+\n+  auto intl_key = FIXED_ONE_BYTE_STRING(isolate, \"Intl\");\n+  auto break_iter_key = FIXED_ONE_BYTE_STRING(isolate, \"v8BreakIterator\");\n   Local<Value> intl_v;\n   if (context->Global()->Get(context, intl_key).ToLocal(&intl_v) &&\n       intl_v->IsObject()) {\n     Local<Object> intl = intl_v.As<Object>();\n     intl->Delete(context, break_iter_key).FromJust();\n   }\n+\n+  // https://github.com/nodejs/node/issues/21219\n+  // TODO(devsnek): remove when v8 supports Atomics.notify\n+  auto atomics_key = FIXED_ONE_BYTE_STRING(isolate, \"Atomics\");\n+  Local<Value> atomics_v;\n+  if (context->Global()->Get(context, atomics_key).ToLocal(&atomics_v) &&\n+      atomics_v->IsObject()) {\n+    Local<Object> atomics = atomics_v.As<Object>();\n+    auto wake_key = FIXED_ONE_BYTE_STRING(isolate, \"wake\");\n+\n+    Local<Value> wake = atomics->Get(context, wake_key).ToLocalChecked();\n+    auto notify_key = FIXED_ONE_BYTE_STRING(isolate, \"notify\");\n+\n+    v8::PropertyDescriptor desc(wake, true);\n+    desc.set_enumerable(false);\n+    desc.set_configurable(true);\n+\n+    atomics->DefineProperty(context, notify_key, desc).ToChecked();\n+  }\n+\n   return context;\n }\n "
        },
        {
            "sha": "dcca7a9fd16d2fe625643003d547ad49c643faee",
            "filename": "test/parallel/test-atomics-notify.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/84f3769ab1a0d3013b391f87b77f3106f991dbfc/test%2Fparallel%2Ftest-atomics-notify.js",
            "raw_url": "https://github.com/nodejs/node/raw/84f3769ab1a0d3013b391f87b77f3106f991dbfc/test%2Fparallel%2Ftest-atomics-notify.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-atomics-notify.js?ref=84f3769ab1a0d3013b391f87b77f3106f991dbfc",
            "patch": "@@ -0,0 +1,10 @@\n+'use strict';\n+\n+require('../common');\n+\n+const assert = require('assert');\n+const { runInNewContext } = require('vm');\n+\n+assert.strictEqual(Atomics.wake, Atomics.notify);\n+\n+assert(runInNewContext('Atomics.wake === Atomics.notify'));"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 34,
        "deletions": 2
    }
}