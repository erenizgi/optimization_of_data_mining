{
    "author": "ryzokuken",
    "message": "src: remove calls to deprecated v8 functions (ToString)\n\nRemove all calls to deprecated v8 functions (here: Value::ToString)\ninside the code (src directory only).\n\nPR-URL: https://github.com/nodejs/node/pull/21935\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "67403b3a849f86ccd03bcf3b829a89d74471f9ca",
    "files": [
        {
            "sha": "ba29aaeef036184858ff9f546d15fdf7edbabf7a",
            "filename": "src/spawn_sync.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/67403b3a849f86ccd03bcf3b829a89d74471f9ca/src%2Fspawn_sync.cc",
            "raw_url": "https://github.com/nodejs/node/raw/67403b3a849f86ccd03bcf3b829a89d74471f9ca/src%2Fspawn_sync.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fspawn_sync.cc?ref=67403b3a849f86ccd03bcf3b829a89d74471f9ca",
            "patch": "@@ -981,7 +981,8 @@ int SyncProcessRunner::CopyJsString(Local<Value> js_value,\n   if (js_value->IsString())\n     js_string = js_value.As<String>();\n   else\n-    js_string = js_value->ToString(env()->isolate());\n+    js_string = js_value->ToString(env()->isolate()->GetCurrentContext())\n+                    .ToLocalChecked();\n \n   // Include space for null terminator byte.\n   size = StringBytes::StorageSize(isolate, js_string, UTF8) + 1;\n@@ -1025,7 +1026,12 @@ int SyncProcessRunner::CopyJsStringArray(Local<Value> js_value,\n     auto value = js_array->Get(context, i).ToLocalChecked();\n \n     if (!value->IsString())\n-      js_array->Set(context, i, value->ToString(env()->isolate())).FromJust();\n+      js_array\n+          ->Set(context,\n+                i,\n+                value->ToString(env()->isolate()->GetCurrentContext())\n+                    .ToLocalChecked())\n+          .FromJust();\n \n     data_size += StringBytes::StorageSize(isolate, value, UTF8) + 1;\n     data_size = ROUND_UP(data_size, sizeof(void*));"
        },
        {
            "sha": "82d699db9a81e5580dde72042f40cbd31492d5ec",
            "filename": "src/string_bytes.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/67403b3a849f86ccd03bcf3b829a89d74471f9ca/src%2Fstring_bytes.cc",
            "raw_url": "https://github.com/nodejs/node/raw/67403b3a849f86ccd03bcf3b829a89d74471f9ca/src%2Fstring_bytes.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstring_bytes.cc?ref=67403b3a849f86ccd03bcf3b829a89d74471f9ca",
            "patch": "@@ -410,7 +410,8 @@ size_t StringBytes::StorageSize(Isolate* isolate,\n     return Buffer::Length(val);\n   }\n \n-  Local<String> str = val->ToString(isolate);\n+  Local<String> str =\n+      val->ToString(isolate->GetCurrentContext()).ToLocalChecked();\n \n   switch (encoding) {\n     case ASCII:\n@@ -456,7 +457,8 @@ size_t StringBytes::Size(Isolate* isolate,\n   if (Buffer::HasInstance(val) && (encoding == BUFFER || encoding == LATIN1))\n     return Buffer::Length(val);\n \n-  Local<String> str = val->ToString(isolate);\n+  Local<String> str =\n+      val->ToString(isolate->GetCurrentContext()).ToLocalChecked();\n \n   switch (encoding) {\n     case ASCII:"
        },
        {
            "sha": "b1b84d8f099d08b74203ef215a2bf4182b9897d0",
            "filename": "src/util.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/67403b3a849f86ccd03bcf3b829a89d74471f9ca/src%2Futil.cc",
            "raw_url": "https://github.com/nodejs/node/raw/67403b3a849f86ccd03bcf3b829a89d74471f9ca/src%2Futil.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Futil.cc?ref=67403b3a849f86ccd03bcf3b829a89d74471f9ca",
            "patch": "@@ -38,9 +38,8 @@ template <typename T>\n static void MakeUtf8String(Isolate* isolate,\n                            Local<Value> value,\n                            T* target) {\n-  Local<String> string = value->ToString(isolate);\n-  if (string.IsEmpty())\n-    return;\n+  Local<String> string;\n+  if (!value->ToString(isolate->GetCurrentContext()).ToLocal(&string)) return;\n \n   const size_t storage = StringBytes::StorageSize(isolate, string, UTF8) + 1;\n   target->AllocateSufficientStorage(storage);\n@@ -64,9 +63,8 @@ TwoByteValue::TwoByteValue(Isolate* isolate, Local<Value> value) {\n     return;\n   }\n \n-  Local<String> string = value->ToString(isolate);\n-  if (string.IsEmpty())\n-    return;\n+  Local<String> string;\n+  if (!value->ToString(isolate->GetCurrentContext()).ToLocal(&string)) return;\n \n   // Allocate enough space to include the null terminator\n   const size_t storage = string->Length() + 1;"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 16,
        "deletions": 10
    }
}