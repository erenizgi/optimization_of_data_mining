{
    "author": "tniessen",
    "message": "crypto: remove DiffieHellman.initialised_\n\nAs pointed out by Ben Noordhuis, this internal field can be removed\nsince all instances are initialized when exposed to users.\n\nPR-URL: https://github.com/nodejs/node/pull/23717\nRefs: https://github.com/nodejs/node/pull/23648\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "c0d86b9e6144e91fe48f29c0d7f0b61c11b49597",
    "files": [
        {
            "sha": "421db555d2197383c5264eb933710b1038d09af9",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 20,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/c0d86b9e6144e91fe48f29c0d7f0b61c11b49597/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c0d86b9e6144e91fe48f29c0d7f0b61c11b49597/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=c0d86b9e6144e91fe48f29c0d7f0b61c11b49597",
            "patch": "@@ -3974,11 +3974,7 @@ bool DiffieHellman::Init(int primeLength, int g) {\n   dh_.reset(DH_new());\n   if (!DH_generate_parameters_ex(dh_.get(), primeLength, g, 0))\n     return false;\n-  bool result = VerifyContext();\n-  if (!result)\n-    return false;\n-  initialised_ = true;\n-  return true;\n+  return VerifyContext();\n }\n \n \n@@ -3993,11 +3989,7 @@ bool DiffieHellman::Init(const char* p, int p_len, int g) {\n     BN_free(bn_g);\n     return false;\n   }\n-  bool result = VerifyContext();\n-  if (!result)\n-    return false;\n-  initialised_ = true;\n-  return true;\n+  return VerifyContext();\n }\n \n \n@@ -4010,11 +4002,7 @@ bool DiffieHellman::Init(const char* p, int p_len, const char* g, int g_len) {\n     BN_free(bn_g);\n     return false;\n   }\n-  bool result = VerifyContext();\n-  if (!result)\n-    return false;\n-  initialised_ = true;\n-  return true;\n+  return VerifyContext();\n }\n \n \n@@ -4088,7 +4076,6 @@ void DiffieHellman::GenerateKeys(const FunctionCallbackInfo<Value>& args) {\n \n   DiffieHellman* diffieHellman;\n   ASSIGN_OR_RETURN_UNWRAP(&diffieHellman, args.Holder());\n-  CHECK(diffieHellman->initialised_);\n \n   if (!DH_generate_key(diffieHellman->dh_.get())) {\n     return ThrowCryptoError(env, ERR_get_error(), \"Key generation failed\");\n@@ -4110,7 +4097,6 @@ void DiffieHellman::GetField(const FunctionCallbackInfo<Value>& args,\n \n   DiffieHellman* dh;\n   ASSIGN_OR_RETURN_UNWRAP(&dh, args.Holder());\n-  CHECK(dh->initialised_);\n \n   const BIGNUM* num = get_field(dh->dh_.get());\n   if (num == nullptr) return env->ThrowError(err_if_null);\n@@ -4162,7 +4148,6 @@ void DiffieHellman::ComputeSecret(const FunctionCallbackInfo<Value>& args) {\n \n   DiffieHellman* diffieHellman;\n   ASSIGN_OR_RETURN_UNWRAP(&diffieHellman, args.Holder());\n-  CHECK(diffieHellman->initialised_);\n \n   ClearErrorOnReturn clear_error_on_return;\n \n@@ -4230,7 +4215,6 @@ void DiffieHellman::SetKey(const v8::FunctionCallbackInfo<Value>& args,\n \n   DiffieHellman* dh;\n   ASSIGN_OR_RETURN_UNWRAP(&dh, args.Holder());\n-  CHECK(dh->initialised_);\n \n   char errmsg[64];\n \n@@ -4276,7 +4260,6 @@ void DiffieHellman::VerifyErrorGetter(const FunctionCallbackInfo<Value>& args) {\n \n   DiffieHellman* diffieHellman;\n   ASSIGN_OR_RETURN_UNWRAP(&diffieHellman, args.Holder());\n-  CHECK(diffieHellman->initialised_);\n \n   args.GetReturnValue().Set(diffieHellman->verifyError_);\n }"
        },
        {
            "sha": "6fcf737f6c43c352c0e24b66b60300d4ec9940fe",
            "filename": "src/node_crypto.h",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c0d86b9e6144e91fe48f29c0d7f0b61c11b49597/src%2Fnode_crypto.h",
            "raw_url": "https://github.com/nodejs/node/raw/c0d86b9e6144e91fe48f29c0d7f0b61c11b49597/src%2Fnode_crypto.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.h?ref=c0d86b9e6144e91fe48f29c0d7f0b61c11b49597",
            "patch": "@@ -614,7 +614,6 @@ class DiffieHellman : public BaseObject {\n \n   DiffieHellman(Environment* env, v8::Local<v8::Object> wrap)\n       : BaseObject(env, wrap),\n-        initialised_(false),\n         verifyError_(0) {\n     MakeWeak();\n   }\n@@ -632,7 +631,6 @@ class DiffieHellman : public BaseObject {\n                      int (*set_field)(DH*, BIGNUM*), const char* what);\n   bool VerifyContext();\n \n-  bool initialised_;\n   int verifyError_;\n   DHPointer dh_;\n };"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 3,
        "deletions": 22
    }
}