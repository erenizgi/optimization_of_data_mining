{
    "author": "unknown",
    "message": "n-api: re-write test_make_callback\n\nThis re-writes the test in C by dropping std::vector<napi_value> in\nfavour of a C99 variable length array, and by dropping the anonymous\nnamespace in favour of static function declarations.\n\nPR-URL: https://github.com/nodejs/node/pull/19448\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>",
    "sha": "be470943fb8b6d1a9589b7aa18ddea207cb56304",
    "files": [
        {
            "sha": "23750f56b838fcc98e7f99cc374b79fb450df173",
            "filename": "test/addons-napi/test_make_callback/binding.c",
            "status": "renamed",
            "additions": 10,
            "deletions": 11,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/be470943fb8b6d1a9589b7aa18ddea207cb56304/test%2Faddons-napi%2Ftest_make_callback%2Fbinding.c",
            "raw_url": "https://github.com/nodejs/node/raw/be470943fb8b6d1a9589b7aa18ddea207cb56304/test%2Faddons-napi%2Ftest_make_callback%2Fbinding.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons-napi%2Ftest_make_callback%2Fbinding.c?ref=be470943fb8b6d1a9589b7aa18ddea207cb56304",
            "patch": "@@ -1,13 +1,13 @@\n #include <node_api.h>\n #include \"../common.h\"\n-#include <vector>\n \n-namespace {\n+#define MAX_ARGUMENTS 10\n \n+static\n napi_value MakeCallback(napi_env env, napi_callback_info info) {\n-  const int kMaxArgs = 10;\n-  size_t argc = kMaxArgs;\n-  napi_value args[kMaxArgs];\n+  size_t argc = MAX_ARGUMENTS;\n+  size_t n;\n+  napi_value args[MAX_ARGUMENTS];\n   // NOLINTNEXTLINE (readability/null_usage)\n   NAPI_CALL(env, napi_get_cb_info(env, info, &argc, args, NULL, NULL));\n \n@@ -16,9 +16,9 @@ napi_value MakeCallback(napi_env env, napi_callback_info info) {\n   napi_value recv = args[0];\n   napi_value func = args[1];\n \n-  std::vector<napi_value> argv;\n-  for (size_t n = 2; n < argc; n += 1) {\n-    argv.push_back(args[n]);\n+  napi_value argv[MAX_ARGUMENTS - 2];\n+  for (n = 2; n < argc; n += 1) {\n+    argv[n - 2] = args[n];\n   }\n \n   napi_valuetype func_type;\n@@ -35,7 +35,7 @@ napi_value MakeCallback(napi_env env, napi_callback_info info) {\n   napi_value result;\n   if (func_type == napi_function) {\n     NAPI_CALL(env, napi_make_callback(\n-        env, context, recv, func, argv.size(), argv.data(), &result));\n+        env, context, recv, func, argc - 2, argv, &result));\n   } else {\n     NAPI_ASSERT(env, false, \"Unexpected argument type\");\n   }\n@@ -45,6 +45,7 @@ napi_value MakeCallback(napi_env env, napi_callback_info info) {\n   return result;\n }\n \n+static\n napi_value Init(napi_env env, napi_value exports) {\n   napi_value fn;\n   NAPI_CALL(env, napi_create_function(\n@@ -54,6 +55,4 @@ napi_value Init(napi_env env, napi_value exports) {\n   return exports;\n }\n \n-}  // anonymous namespace\n-\n NAPI_MODULE(NODE_GYP_MODULE_NAME, Init)",
            "previous_filename": "test/addons-napi/test_make_callback/binding.cc"
        },
        {
            "sha": "23daf507916ff6649e5abfe4c082daa2dcc8010b",
            "filename": "test/addons-napi/test_make_callback/binding.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/be470943fb8b6d1a9589b7aa18ddea207cb56304/test%2Faddons-napi%2Ftest_make_callback%2Fbinding.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/be470943fb8b6d1a9589b7aa18ddea207cb56304/test%2Faddons-napi%2Ftest_make_callback%2Fbinding.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons-napi%2Ftest_make_callback%2Fbinding.gyp?ref=be470943fb8b6d1a9589b7aa18ddea207cb56304",
            "patch": "@@ -3,7 +3,7 @@\n     {\n       'target_name': 'binding',\n       'defines': [ 'V8_DEPRECATION_WARNINGS=1' ],\n-      'sources': [ 'binding.cc' ]\n+      'sources': [ 'binding.c' ]\n     }\n   ]\n }"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 11,
        "deletions": 12
    }
}