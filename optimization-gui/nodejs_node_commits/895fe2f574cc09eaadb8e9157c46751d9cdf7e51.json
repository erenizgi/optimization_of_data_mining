{
    "author": "leeight",
    "message": "http2: fix session[kSession] undefined issue\n\n`finishSessionDestroy` session cleanup when already done.\n\nPR-URL: https://github.com/nodejs/node/pull/24547\nFixes: https://github.com/nodejs/node/issues/24546\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ouyang Yadong <oyydoibh@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "895fe2f574cc09eaadb8e9157c46751d9cdf7e51",
    "files": [
        {
            "sha": "a020838493fbabdd957b061b4d98231228ddc449",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/895fe2f574cc09eaadb8e9157c46751d9cdf7e51/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/895fe2f574cc09eaadb8e9157c46751d9cdf7e51/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=895fe2f574cc09eaadb8e9157c46751d9cdf7e51",
            "patch": "@@ -1989,6 +1989,7 @@ class Http2Stream extends Duplex {\n       // attempt to gracefully close the session.\n       const state = this[kState];\n       if (this.headersSent &&\n+          this[kSession] &&\n           this[kSession][kType] === NGHTTP2_SESSION_SERVER &&\n           !(state.flags & STREAM_FLAGS_HAS_TRAILERS) &&\n           !state.didRead &&"
        },
        {
            "sha": "9b7f126510757c07ae1132e6d9a336103e9dc757",
            "filename": "test/parallel/test-http2-server-session-destroy.js",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/895fe2f574cc09eaadb8e9157c46751d9cdf7e51/test%2Fparallel%2Ftest-http2-server-session-destroy.js",
            "raw_url": "https://github.com/nodejs/node/raw/895fe2f574cc09eaadb8e9157c46751d9cdf7e51/test%2Fparallel%2Ftest-http2-server-session-destroy.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-server-session-destroy.js?ref=895fe2f574cc09eaadb8e9157c46751d9cdf7e51",
            "patch": "@@ -0,0 +1,20 @@\n+'use strict';\n+\n+const common = require('../common');\n+if (!common.hasCrypto)\n+  common.skip('missing crypto');\n+const h2 = require('http2');\n+\n+const server = h2.createServer();\n+server.listen(0, common.localhostIPv4, common.mustCall(() => {\n+  const afterConnect = common.mustCall((session) => {\n+    session.request({ ':method': 'POST' }).end(common.mustCall(() => {\n+      session.destroy();\n+      server.close();\n+    }));\n+  });\n+\n+  const port = server.address().port;\n+  const host = common.localhostIPv4;\n+  h2.connect('http://' + host + ':' + port, afterConnect);\n+}));"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 21,
        "deletions": 0
    }
}