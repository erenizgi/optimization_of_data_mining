{
    "author": "BridgeAR",
    "message": "repl: simplify and improve completion\n\nThe completion lists used a hand crafted list of global entries that\nwas redundant due to also using the actual global properties for tab\ncompletion. Those entries ended up in an separated completion group\nwhich did not seem useful.\n\nPR-URL: https://github.com/nodejs/node/pull/25731\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>",
    "sha": "e3055dc5254502d2f02276f20c9a3f37b41e7f12",
    "files": [
        {
            "sha": "df861843d1d501a5c8cbe93f2eb0a2f0e760c310",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 17,
            "deletions": 41,
            "changes": 58,
            "blob_url": "https://github.com/nodejs/node/blob/e3055dc5254502d2f02276f20c9a3f37b41e7f12/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/e3055dc5254502d2f02276f20c9a3f37b41e7f12/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=e3055dc5254502d2f02276f20c9a3f37b41e7f12",
            "patch": "@@ -89,18 +89,6 @@ let processTopLevelAwait;\n const parentModule = module;\n const replMap = new WeakMap();\n \n-const GLOBAL_OBJECT_PROPERTIES = [\n-  'NaN', 'Infinity', 'undefined', 'eval', 'parseInt', 'parseFloat', 'isNaN',\n-  'isFinite', 'decodeURI', 'decodeURIComponent', 'encodeURI',\n-  'encodeURIComponent', 'Object', 'Function', 'Array', 'String', 'Boolean',\n-  'Number', 'Date', 'RegExp', 'Error', 'EvalError', 'RangeError',\n-  'ReferenceError', 'SyntaxError', 'TypeError', 'URIError', 'Math', 'JSON'\n-];\n-const GLOBAL_OBJECT_PROPERTY_MAP = {};\n-for (var n = 0; n < GLOBAL_OBJECT_PROPERTIES.length; n++) {\n-  GLOBAL_OBJECT_PROPERTY_MAP[GLOBAL_OBJECT_PROPERTIES[n]] =\n-    GLOBAL_OBJECT_PROPERTIES[n];\n-}\n const kBufferedCommandSymbol = Symbol('bufferedCommand');\n const kContextId = Symbol('contextId');\n \n@@ -807,24 +795,17 @@ REPLServer.prototype.createContext = function() {\n     }, () => {\n       context = vm.createContext();\n     });\n+    for (const name of Object.getOwnPropertyNames(global)) {\n+      Object.defineProperty(context, name,\n+                            Object.getOwnPropertyDescriptor(global, name));\n+    }\n     context.global = context;\n     const _console = new Console(this.outputStream);\n     Object.defineProperty(context, 'console', {\n       configurable: true,\n       writable: true,\n       value: _console\n     });\n-\n-    var names = Object.getOwnPropertyNames(global);\n-    for (var n = 0; n < names.length; n++) {\n-      var name = names[n];\n-      if (name === 'console' || name === 'global')\n-        continue;\n-      if (GLOBAL_OBJECT_PROPERTY_MAP[name] === undefined) {\n-        Object.defineProperty(context, name,\n-                              Object.getOwnPropertyDescriptor(global, name));\n-      }\n-    }\n   }\n \n   var module = new CJSModule('<repl>');\n@@ -1137,19 +1118,19 @@ function complete(line, callback) {\n           }\n           completionGroups.push(\n             filteredOwnPropertyNames.call(this, this.context));\n-          addStandardGlobals(completionGroups, filter);\n+          if (filter !== '') addCommonWords(completionGroups);\n           completionGroupsLoaded();\n         } else {\n           this.eval('.scope', this.context, 'repl', function ev(err, globals) {\n             if (err || !Array.isArray(globals)) {\n-              addStandardGlobals(completionGroups, filter);\n+              if (filter !== '') addCommonWords(completionGroups);\n             } else if (Array.isArray(globals[0])) {\n               // Add grouped globals\n               for (var n = 0; n < globals.length; n++)\n                 completionGroups.push(globals[n]);\n             } else {\n               completionGroups.push(globals);\n-              addStandardGlobals(completionGroups, filter);\n+              if (filter !== '') addCommonWords(completionGroups);\n             }\n             completionGroupsLoaded();\n           });\n@@ -1373,21 +1354,16 @@ function _memory(cmd) {\n   }\n }\n \n-function addStandardGlobals(completionGroups, filter) {\n-  // Global object properties\n-  // (http://www.ecma-international.org/publications/standards/Ecma-262.htm)\n-  completionGroups.push(GLOBAL_OBJECT_PROPERTIES);\n-  // Common keywords. Exclude for completion on the empty string, b/c\n-  // they just get in the way.\n-  if (filter) {\n-    completionGroups.push([\n-      'async', 'await', 'break', 'case', 'catch', 'const', 'continue',\n-      'debugger', 'default', 'delete', 'do', 'else', 'export', 'false',\n-      'finally', 'for', 'function', 'if', 'import', 'in', 'instanceof', 'let',\n-      'new', 'null', 'return', 'switch', 'this', 'throw', 'true', 'try',\n-      'typeof', 'undefined', 'var', 'void', 'while', 'with', 'yield'\n-    ]);\n-  }\n+function addCommonWords(completionGroups) {\n+  // Only words which do not yet exist as global property should be added to\n+  // this list.\n+  completionGroups.push([\n+    'async', 'await', 'break', 'case', 'catch', 'const', 'continue',\n+    'debugger', 'default', 'delete', 'do', 'else', 'export', 'false',\n+    'finally', 'for', 'function', 'if', 'import', 'in', 'instanceof', 'let',\n+    'new', 'null', 'return', 'switch', 'this', 'throw', 'true', 'try',\n+    'typeof', 'var', 'void', 'while', 'with', 'yield'\n+  ]);\n }\n \n function _turnOnEditorMode(repl) {"
        },
        {
            "sha": "5438c960b84cb176cd2e1fd997b7e12eeb953cee",
            "filename": "test/parallel/test-repl-tab-complete.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e3055dc5254502d2f02276f20c9a3f37b41e7f12/test%2Fparallel%2Ftest-repl-tab-complete.js",
            "raw_url": "https://github.com/nodejs/node/raw/e3055dc5254502d2f02276f20c9a3f37b41e7f12/test%2Fparallel%2Ftest-repl-tab-complete.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-tab-complete.js?ref=e3055dc5254502d2f02276f20c9a3f37b41e7f12",
            "patch": "@@ -457,7 +457,7 @@ const testNonGlobal = repl.start({\n   useGlobal: false\n });\n \n-const builtins = [['Infinity', '', 'Int16Array', 'Int32Array',\n+const builtins = [['Infinity', 'Int16Array', 'Int32Array',\n                    'Int8Array'], 'I'];\n \n if (common.hasIntl) {"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 18,
        "deletions": 42
    }
}