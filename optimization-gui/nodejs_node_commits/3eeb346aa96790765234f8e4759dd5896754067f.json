{
    "author": "joyeecheung",
    "message": "src: CancelTerminateExecution before throwing errors\n\nTerminating the execution of a script would create a pending\nexception, therefore we should cancel the termination\n*before* throwing a new exception, otherwise the attempt to\ncreate a custom error may fail.\n\nPR-URL: https://github.com/nodejs/node/pull/20146\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "3eeb346aa96790765234f8e4759dd5896754067f",
    "files": [
        {
            "sha": "9bcdb4dce75ff29e806b300796806c0eabe0408f",
            "filename": "src/module_wrap.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/3eeb346aa96790765234f8e4759dd5896754067f/src%2Fmodule_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/3eeb346aa96790765234f8e4759dd5896754067f/src%2Fmodule_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fmodule_wrap.cc?ref=3eeb346aa96790765234f8e4759dd5896754067f",
            "patch": "@@ -279,7 +279,9 @@ void ModuleWrap::Evaluate(const FunctionCallbackInfo<Value>& args) {\n     result = module->Evaluate(context);\n   }\n \n+  // Convert the termination exception into a regular exception.\n   if (timed_out || received_signal) {\n+    env->isolate()->CancelTerminateExecution();\n     // It is possible that execution was terminated by another timeout in\n     // which this timeout is nested, so check whether one of the watchdogs\n     // from this invocation is responsible for termination.\n@@ -288,7 +290,6 @@ void ModuleWrap::Evaluate(const FunctionCallbackInfo<Value>& args) {\n     } else if (received_signal) {\n       env->ThrowError(\"Script execution interrupted.\");\n     }\n-    env->isolate()->CancelTerminateExecution();\n   }\n \n   if (try_catch.HasCaught()) {"
        },
        {
            "sha": "e07d5ebcd29d0db2f5fa5d89293bc0c9439deb85",
            "filename": "src/node_contextify.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/3eeb346aa96790765234f8e4759dd5896754067f/src%2Fnode_contextify.cc",
            "raw_url": "https://github.com/nodejs/node/raw/3eeb346aa96790765234f8e4759dd5896754067f/src%2Fnode_contextify.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_contextify.cc?ref=3eeb346aa96790765234f8e4759dd5896754067f",
            "patch": "@@ -851,7 +851,9 @@ class ContextifyScript : public BaseObject {\n       result = script->Run(env->context());\n     }\n \n+    // Convert the termination exception into a regular exception.\n     if (timed_out || received_signal) {\n+      env->isolate()->CancelTerminateExecution();\n       // It is possible that execution was terminated by another timeout in\n       // which this timeout is nested, so check whether one of the watchdogs\n       // from this invocation is responsible for termination.\n@@ -860,7 +862,6 @@ class ContextifyScript : public BaseObject {\n       } else if (received_signal) {\n         env->ThrowError(\"Script execution interrupted.\");\n       }\n-      env->isolate()->CancelTerminateExecution();\n     }\n \n     if (try_catch.HasCaught()) {"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 4,
        "deletions": 2
    }
}