{
    "author": "joyeecheung",
    "message": "lib: remove internalBinding('config').pendingDeprecation\n\nInstead use\n`require('internal/options').getOptionValue('--pending-deprecation')`\n\nPR-URL: https://github.com/nodejs/node/pull/24962\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8",
    "files": [
        {
            "sha": "019969acd1ad97148a1521c44b87fe6f452f10aa",
            "filename": "lib/buffer.js",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8/lib%2Fbuffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8/lib%2Fbuffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fbuffer.js?ref=b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8",
            "patch": "@@ -48,9 +48,7 @@ const {\n   isArrayBufferView,\n   isUint8Array\n } = require('internal/util/types');\n-const {\n-  pendingDeprecation\n-} = internalBinding('config');\n+\n const {\n   ERR_BUFFER_OUT_OF_BOUNDS,\n   ERR_OUT_OF_RANGE,\n@@ -138,7 +136,7 @@ const bufferWarning = 'Buffer() is deprecated due to security and usability ' +\n function showFlaggedDeprecation() {\n   if (bufferWarningAlreadyEmitted ||\n       ++nodeModulesCheckCounter > 10000 ||\n-      (!pendingDeprecation &&\n+      (!require('internal/options').getOptionValue('--pending-deprecation') &&\n        isInsideNodeModules())) {\n     // We don't emit a warning, because we either:\n     // - Already did so, or"
        },
        {
            "sha": "fd503421ffa13e969772d245a760f506a6bd96df",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8",
            "patch": "@@ -176,7 +176,7 @@ function startup() {\n   {\n     // Install legacy getters on the `util` binding for typechecking.\n     // TODO(addaleax): Turn into a full runtime deprecation.\n-    const { pendingDeprecation } = internalBinding('config');\n+    const pendingDeprecation = getOptionValue('--pending-deprecation');\n     const utilBinding = internalBinding('util');\n     const types = internalBinding('types');\n     for (const name of ["
        },
        {
            "sha": "1ba1fe9d277af52a41b16d871df39e2ea04cb6af",
            "filename": "src/node_config.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8/src%2Fnode_config.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8/src%2Fnode_config.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_config.cc?ref=b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8",
            "patch": "@@ -77,9 +77,6 @@ static void Initialize(Local<Object> target,\n   if (env->options()->experimental_repl_await)\n     READONLY_TRUE_PROPERTY(target, \"experimentalREPLAwait\");\n \n-  if (env->options()->pending_deprecation)\n-    READONLY_TRUE_PROPERTY(target, \"pendingDeprecation\");\n-\n   if (env->options()->expose_internals)\n     READONLY_TRUE_PROPERTY(target, \"exposeInternals\");\n "
        },
        {
            "sha": "6cabf9ddc693f770ca829138995831aa2469c2fb",
            "filename": "test/parallel/test-pending-deprecation.js",
            "status": "modified",
            "additions": 21,
            "deletions": 11,
            "changes": 32,
            "blob_url": "https://github.com/nodejs/node/blob/b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8/test%2Fparallel%2Ftest-pending-deprecation.js",
            "raw_url": "https://github.com/nodejs/node/raw/b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8/test%2Fparallel%2Ftest-pending-deprecation.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-pending-deprecation.js?ref=b32e5e08b2c6dc1390d4bab1fe4e2d3670d251c8",
            "patch": "@@ -1,44 +1,53 @@\n 'use strict';\n \n-// Tests that --pending-deprecation and NODE_PENDING_DEPRECATION both\n-// set the process.binding('config').pendingDeprecation flag that is\n-// used to determine if pending deprecation messages should be shown.\n-// The test is performed by launching two child processes that run\n+// Flags: --expose-internals\n+// Tests that --pending-deprecation and NODE_PENDING_DEPRECATION both set the\n+// `require('internal/options').getOptionValue('--pending-deprecation')`\n+// flag that is used to determine if pending deprecation messages should be\n+// shown. The test is performed by launching two child processes that run\n // this same test script with different arguments. If those exit with\n // code 0, then the test passes. If they don't, it fails.\n \n+// TODO(joyeecheung): instead of testing internals, test the actual features\n+// pending deprecations.\n+\n const common = require('../common');\n \n const assert = require('assert');\n-const config = process.binding('config');\n const fork = require('child_process').fork;\n+const { getOptionValue } = require('internal/options');\n \n function message(name) {\n-  return `${name} did not set the process.binding('config').` +\n-         'pendingDeprecation flag.';\n+  return `${name} did not affect getOptionValue('--pending-deprecation')`;\n }\n \n switch (process.argv[2]) {\n   case 'env':\n   case 'switch':\n-    assert.strictEqual(config.pendingDeprecation, true);\n+    assert.strictEqual(\n+      getOptionValue('--pending-deprecation'),\n+      true\n+    );\n     break;\n   default:\n     // Verify that the flag is off by default.\n     const envvar = process.env.NODE_PENDING_DEPRECATION;\n-    assert.strictEqual(config.pendingDeprecation, envvar && envvar[0] === '1');\n+    assert.strictEqual(\n+      getOptionValue('--pending-deprecation'),\n+      !!(envvar && envvar[0] === '1')\n+    );\n \n     // Test the --pending-deprecation command line switch.\n     fork(__filename, ['switch'], {\n-      execArgv: ['--pending-deprecation'],\n+      execArgv: ['--pending-deprecation', '--expose-internals'],\n       silent: true\n     }).on('exit', common.mustCall((code) => {\n       assert.strictEqual(code, 0, message('--pending-deprecation'));\n     }));\n \n     // Test the --pending_deprecation command line switch.\n     fork(__filename, ['switch'], {\n-      execArgv: ['--pending_deprecation'],\n+      execArgv: ['--pending_deprecation', '--expose-internals'],\n       silent: true\n     }).on('exit', common.mustCall((code) => {\n       assert.strictEqual(code, 0, message('--pending_deprecation'));\n@@ -47,6 +56,7 @@ switch (process.argv[2]) {\n     // Test the NODE_PENDING_DEPRECATION environment var.\n     fork(__filename, ['env'], {\n       env: Object.assign({}, process.env, { NODE_PENDING_DEPRECATION: 1 }),\n+      execArgv: ['--expose-internals'],\n       silent: true\n     }).on('exit', common.mustCall((code) => {\n       assert.strictEqual(code, 0, message('NODE_PENDING_DEPRECATION'));"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 24,
        "deletions": 19
    }
}