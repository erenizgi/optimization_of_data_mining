{
    "author": "lpinca",
    "message": "net,stream: remove DuplexBase\n\n`DuplexBase` was added to prevent the \"no-half-open enforcer\" from\nbeing inherited by `net.Socket`. The main reason to use it instead\nof `Duplex` was that it allowed to not copy the options object but\nsince commit 5e3f516 the options object is copyed anyway so it is\nno longer useful.\n\nPR-URL: https://github.com/nodejs/node/pull/19779\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "496d6023e0c372c76746c35fdba800fa943cbffc",
    "files": [
        {
            "sha": "b123cdcb4d776f65bbb877c45b0c2a0218adc81c",
            "filename": "lib/_stream_duplex.js",
            "status": "modified",
            "additions": 22,
            "deletions": 4,
            "changes": 26,
            "blob_url": "https://github.com/nodejs/node/blob/496d6023e0c372c76746c35fdba800fa943cbffc/lib%2F_stream_duplex.js",
            "raw_url": "https://github.com/nodejs/node/raw/496d6023e0c372c76746c35fdba800fa943cbffc/lib%2F_stream_duplex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_stream_duplex.js?ref=496d6023e0c372c76746c35fdba800fa943cbffc",
            "patch": "@@ -29,15 +29,33 @@\n module.exports = Duplex;\n \n const util = require('util');\n-const DuplexBase = require('internal/streams/duplex_base');\n-\n-util.inherits(Duplex, DuplexBase);\n+const Readable = require('_stream_readable');\n+const Writable = require('_stream_writable');\n+\n+util.inherits(Duplex, Readable);\n+\n+{\n+  // Allow the keys array to be GC'ed.\n+  const keys = Object.keys(Writable.prototype);\n+  for (var v = 0; v < keys.length; v++) {\n+    const method = keys[v];\n+    if (!Duplex.prototype[method])\n+      Duplex.prototype[method] = Writable.prototype[method];\n+  }\n+}\n \n function Duplex(options) {\n   if (!(this instanceof Duplex))\n     return new Duplex(options);\n \n-  DuplexBase.call(this, options);\n+  Readable.call(this, options);\n+  Writable.call(this, options);\n+\n+  if (options && options.readable === false)\n+    this.readable = false;\n+\n+  if (options && options.writable === false)\n+    this.writable = false;\n \n   this.allowHalfOpen = true;\n   if (options && options.allowHalfOpen === false) {"
        },
        {
            "sha": "df3c5c37a80ea7590f638a20db2f5bb5dea078ff",
            "filename": "lib/internal/streams/duplex_base.js",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/dca09a77d5a554ae51bc0fd4b047274b8f62bf53/lib%2Finternal%2Fstreams%2Fduplex_base.js",
            "raw_url": "https://github.com/nodejs/node/raw/dca09a77d5a554ae51bc0fd4b047274b8f62bf53/lib%2Finternal%2Fstreams%2Fduplex_base.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fstreams%2Fduplex_base.js?ref=dca09a77d5a554ae51bc0fd4b047274b8f62bf53",
            "patch": "@@ -1,30 +0,0 @@\n-'use strict';\n-\n-const util = require('util');\n-const Readable = require('_stream_readable');\n-const Writable = require('_stream_writable');\n-\n-function DuplexBase(options) {\n-  Readable.call(this, options);\n-  Writable.call(this, options);\n-\n-  if (options && options.readable === false)\n-    this.readable = false;\n-\n-  if (options && options.writable === false)\n-    this.writable = false;\n-}\n-\n-util.inherits(DuplexBase, Readable);\n-\n-{\n-  // Avoid scope creep, the keys array can then be collected.\n-  const keys = Object.keys(Writable.prototype);\n-  for (var v = 0; v < keys.length; v++) {\n-    const method = keys[v];\n-    if (!DuplexBase.prototype[method])\n-      DuplexBase.prototype[method] = Writable.prototype[method];\n-  }\n-}\n-\n-module.exports = DuplexBase;"
        },
        {
            "sha": "68dde9cac3615e418674a06c73b3cacf5bcf4958",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 7,
            "deletions": 11,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/496d6023e0c372c76746c35fdba800fa943cbffc/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/496d6023e0c372c76746c35fdba800fa943cbffc/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=496d6023e0c372c76746c35fdba800fa943cbffc",
            "patch": "@@ -75,7 +75,6 @@ const {\n   ERR_SOCKET_BAD_PORT,\n   ERR_SOCKET_CLOSED\n } = errors.codes;\n-const DuplexBase = require('internal/streams/duplex_base');\n const dns = require('dns');\n \n const kLastWriteQueueSize = Symbol('lastWriteQueueSize');\n@@ -242,19 +241,19 @@ function Socket(options) {\n \n   if (typeof options === 'number')\n     options = { fd: options }; // Legacy interface.\n-  else if (options === undefined)\n-    options = {};\n   else\n     options = util._extend({}, options);\n \n+  const allowHalfOpen = options.allowHalfOpen;\n+\n+  // Prevent the \"no-half-open enforcer\" from being inherited from `Duplex`.\n+  options.allowHalfOpen = true;\n   // For backwards compat do not emit close on destroy.\n   options.emitClose = false;\n+  stream.Duplex.call(this, options);\n \n-  // `DuplexBase` is just a slimmed down constructor for `Duplex` which allow\n-  // us to not inherit the \"no-half-open enforcer\" as there is already one in\n-  // place. Instances of `Socket` are still instances of `Duplex`, that is,\n-  // `socket instanceof Duplex === true`.\n-  DuplexBase.call(this, options);\n+  // Default to *not* allowing half open sockets.\n+  this.allowHalfOpen = Boolean(allowHalfOpen);\n \n   if (options.handle) {\n     this._handle = options.handle; // private\n@@ -300,9 +299,6 @@ function Socket(options) {\n   // handle strings directly\n   this._writableState.decodeStrings = false;\n \n-  // default to *not* allowing half open sockets\n-  this.allowHalfOpen = options.allowHalfOpen || false;\n-\n   // if we have a handle, then start the flow of data into the\n   // buffer.  if not, then this will happen when we connect\n   if (this._handle && options.readable !== false) {"
        },
        {
            "sha": "4bc9a3650f7781c31bdecd3883bd68292465cf65",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/496d6023e0c372c76746c35fdba800fa943cbffc/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/496d6023e0c372c76746c35fdba800fa943cbffc/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=496d6023e0c372c76746c35fdba800fa943cbffc",
            "patch": "@@ -150,7 +150,6 @@\n       'lib/internal/streams/lazy_transform.js',\n       'lib/internal/streams/async_iterator.js',\n       'lib/internal/streams/buffer_list.js',\n-      'lib/internal/streams/duplex_base.js',\n       'lib/internal/streams/duplexpair.js',\n       'lib/internal/streams/legacy.js',\n       'lib/internal/streams/destroy.js',"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 29,
        "deletions": 46
    }
}