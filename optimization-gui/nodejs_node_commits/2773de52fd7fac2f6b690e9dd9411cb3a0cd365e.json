{
    "author": "vsemozhetbyt",
    "message": "tools, doc: fix stability index isssues\n\n1. Do not autolink in doc stability section.\n2. Do not add void wrapping elements to docs.\n\nPR-URL: https://github.com/nodejs/node/pull/20731\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "2773de52fd7fac2f6b690e9dd9411cb3a0cd365e",
    "files": [
        {
            "sha": "dfd0f22c7c8330b0f3d62a0521d551a0f4e19759",
            "filename": "tools/doc/html.js",
            "status": "modified",
            "additions": 15,
            "deletions": 6,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/2773de52fd7fac2f6b690e9dd9411cb3a0cd365e/tools%2Fdoc%2Fhtml.js",
            "raw_url": "https://github.com/nodejs/node/raw/2773de52fd7fac2f6b690e9dd9411cb3a0cd365e/tools%2Fdoc%2Fhtml.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fhtml.js?ref=2773de52fd7fac2f6b690e9dd9411cb3a0cd365e",
            "patch": "@@ -56,7 +56,7 @@ function toHTML({ input, filename, nodeVersion, analytics }, cb) {\n   const section = firstHeading ? firstHeading.text : 'Index';\n \n   preprocessText(lexed);\n-  preprocessElements(lexed);\n+  preprocessElements(lexed, filename);\n \n   // Generate the table of contents. This mutates the lexed contents in-place.\n   const toc = buildToc(lexed, filename);\n@@ -171,7 +171,7 @@ function linkJsTypeDocs(text) {\n }\n \n // Preprocess stability blockquotes and YAML blocks.\n-function preprocessElements(lexed) {\n+function preprocessElements(lexed, filename) {\n   const STABILITY_RE = /(.*:)\\s*(\\d)([\\s\\S]*)/;\n   let state = null;\n   let headingIndex = -1;\n@@ -205,10 +205,16 @@ function preprocessElements(lexed) {\n           headingIndex = -1;\n           heading = null;\n         }\n+\n+        // Do not link to the section we are already in.\n+        const noLinking = filename === 'documentation' &&\n+          heading !== null && heading.text === 'Stability Index';\n         token.text = `<div class=\"api_stability api_stability_${number}\">` +\n-          '<a href=\"documentation.html#documentation_stability_index\">' +\n-          `${prefix} ${number}</a>${explication}</div>`\n+          (noLinking ? '' :\n+            '<a href=\"documentation.html#documentation_stability_index\">') +\n+          `${prefix} ${number}${noLinking ? '' : '</a>'}${explication}</div>`\n           .replace(/\\n/g, ' ');\n+\n         lexed[index] = { type: 'html', text: token.text };\n       } else if (state === 'MAYBE_STABILITY_BQ') {\n         state = null;\n@@ -298,9 +304,12 @@ function buildToc(lexed, filename) {\n     const realFilename = path.basename(realFilenames[0], '.md');\n     const headingText = token.text.trim();\n     const id = getId(`${realFilename}_${headingText}`, idCounters);\n+\n+    const hasStability = token.stability !== undefined;\n     toc += ' '.repeat((depth - 1) * 2) +\n-           `* <span class=\"stability_${token.stability}\">` +\n-           `<a href=\"#${id}\">${token.text}</a></span>\\n`;\n+      (hasStability ? `* <span class=\"stability_${token.stability}\">` : '* ') +\n+      `<a href=\"#${id}\">${token.text}</a>${hasStability ? '</span>' : ''}\\n`;\n+\n     token.text += `<span><a class=\"mark\" href=\"#${id}\" id=\"${id}\">#</a></span>`;\n     if (realFilename === 'errors' && headingText.startsWith('ERR_')) {\n       token.text += `<span><a class=\"mark\" href=\"#${headingText}\" ` +"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 15,
        "deletions": 6
    }
}