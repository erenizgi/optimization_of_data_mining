{
    "author": "oyyd",
    "message": "dns: deprecate passing falsy hostname to dns.lookup\n\nWe can `dns.lookup` a falsy `hostname` like `dns.lookup(false)`\nfor the reason of backwards compatibility long before(see #13119\nfor detail). This behavior is undocumented and seems useless in\nreal world apps.\n\nWe could also make invalid `hostname` throw in the future and the\nchange might be semver-major.\n\nFixes: https://github.com/nodejs/node/issues/13119\n\nPR-URL: https://github.com/nodejs/node/pull/23173\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "26af72899417525dd32372d63c07ee5aa1ab6c5c",
    "files": [
        {
            "sha": "ca23a4fa322f949efe1d1e6cf420c848c966d4d3",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/26af72899417525dd32372d63c07ee5aa1ab6c5c/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/26af72899417525dd32372d63c07ee5aa1ab6c5c/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=26af72899417525dd32372d63c07ee5aa1ab6c5c",
            "patch": "@@ -2214,6 +2214,22 @@ the `_handle` property of the `Cipher`, `Decipher`, `DiffieHellman`,\n Using the `_handle` property to access the native object is deprecated because\n improper use of the native object can lead to crashing the application.\n \n+<a id=\"DEP0118\"></a>\n+### DEP0118: dns.lookup() support for a falsy hostname\n+<!-- YAML\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/23173\n+    description: Runtime deprecation.\n+-->\n+\n+Type: Runtime\n+\n+Previous versions of Node.js supported `dns.lookup()` with a falsy hostname\n+like `dns.lookup(false)` due to backward compatibility.\n+This behavior is undocumented and is thought to be unused in real world apps.\n+It will become an error in future versions of Node.js.\n+\n [`--pending-deprecation`]: cli.html#cli_pending_deprecation\n [`Buffer.allocUnsafeSlow(size)`]: buffer.html#buffer_class_method_buffer_allocunsafeslow_size\n [`Buffer.from(array)`]: buffer.html#buffer_class_method_buffer_from_array"
        },
        {
            "sha": "f3b86a471d74a3a1ee8610b9b7a40100dfd019dc",
            "filename": "lib/dns.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/26af72899417525dd32372d63c07ee5aa1ab6c5c/lib%2Fdns.js",
            "raw_url": "https://github.com/nodejs/node/raw/26af72899417525dd32372d63c07ee5aa1ab6c5c/lib%2Fdns.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fdns.js?ref=26af72899417525dd32372d63c07ee5aa1ab6c5c",
            "patch": "@@ -30,7 +30,8 @@ const {\n   getDefaultResolver,\n   setDefaultResolver,\n   Resolver,\n-  validateHints\n+  validateHints,\n+  emitInvalidHostnameWarning,\n } = require('internal/dns/utils');\n const {\n   ERR_INVALID_ARG_TYPE,\n@@ -92,7 +93,7 @@ function lookup(hostname, options, callback) {\n \n   // Parse arguments\n   if (hostname && typeof hostname !== 'string') {\n-    throw new ERR_INVALID_ARG_TYPE('hostname', ['string', 'falsy'], hostname);\n+    throw new ERR_INVALID_ARG_TYPE('hostname', 'string', hostname);\n   } else if (typeof options === 'function') {\n     callback = options;\n     family = 0;\n@@ -113,6 +114,7 @@ function lookup(hostname, options, callback) {\n     throw new ERR_INVALID_OPT_VALUE('family', family);\n \n   if (!hostname) {\n+    emitInvalidHostnameWarning(hostname);\n     if (all) {\n       process.nextTick(callback, null, []);\n     } else {"
        },
        {
            "sha": "8baa0fa0de8241b8168ebaf001816868f8219e1b",
            "filename": "lib/internal/dns/promises.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/26af72899417525dd32372d63c07ee5aa1ab6c5c/lib%2Finternal%2Fdns%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/26af72899417525dd32372d63c07ee5aa1ab6c5c/lib%2Finternal%2Fdns%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fdns%2Fpromises.js?ref=26af72899417525dd32372d63c07ee5aa1ab6c5c",
            "patch": "@@ -2,7 +2,8 @@\n const {\n   bindDefaultResolver,\n   Resolver: CallbackResolver,\n-  validateHints\n+  validateHints,\n+  emitInvalidHostnameWarning,\n } = require('internal/dns/utils');\n const { codes, dnsException } = require('internal/errors');\n const { isIP, isIPv4, isLegalPort } = require('internal/net');\n@@ -55,6 +56,7 @@ function onlookupall(err, addresses) {\n function createLookupPromise(family, hostname, all, hints, verbatim) {\n   return new Promise((resolve, reject) => {\n     if (!hostname) {\n+      emitInvalidHostnameWarning(hostname);\n       if (all)\n         resolve([]);\n       else\n@@ -99,7 +101,7 @@ function lookup(hostname, options) {\n \n   // Parse arguments\n   if (hostname && typeof hostname !== 'string') {\n-    throw new ERR_INVALID_ARG_TYPE('hostname', ['string', 'falsy'], hostname);\n+    throw new ERR_INVALID_ARG_TYPE('hostname', 'string', hostname);\n   } else if (options !== null && typeof options === 'object') {\n     hints = options.hints >>> 0;\n     family = options.family >>> 0;"
        },
        {
            "sha": "d279a58840154e6ab3edc0d025b2b058ace07439",
            "filename": "lib/internal/dns/utils.js",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/26af72899417525dd32372d63c07ee5aa1ab6c5c/lib%2Finternal%2Fdns%2Futils.js",
            "raw_url": "https://github.com/nodejs/node/raw/26af72899417525dd32372d63c07ee5aa1ab6c5c/lib%2Finternal%2Fdns%2Futils.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fdns%2Futils.js?ref=26af72899417525dd32372d63c07ee5aa1ab6c5c",
            "patch": "@@ -140,10 +140,26 @@ function validateHints(hints) {\n   }\n }\n \n+let invalidHostnameWarningEmitted = false;\n+\n+function emitInvalidHostnameWarning(hostname) {\n+  if (invalidHostnameWarningEmitted) {\n+    return;\n+  }\n+  invalidHostnameWarningEmitted = true;\n+  process.emitWarning(\n+    `The provided hostname \"${hostname}\" is not a valid ` +\n+    'hostname, and is supported in the dns module solely for compatibility.',\n+    'DeprecationWarning',\n+    'DEP0118'\n+  );\n+}\n+\n module.exports = {\n   bindDefaultResolver,\n   getDefaultResolver,\n   setDefaultResolver,\n   validateHints,\n-  Resolver\n+  Resolver,\n+  emitInvalidHostnameWarning,\n };"
        },
        {
            "sha": "b30c5795feb31ae808373fcf7cb2c2c1088600a4",
            "filename": "test/parallel/test-dns-lookup.js",
            "status": "modified",
            "additions": 19,
            "deletions": 1,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/26af72899417525dd32372d63c07ee5aa1ab6c5c/test%2Fparallel%2Ftest-dns-lookup.js",
            "raw_url": "https://github.com/nodejs/node/raw/26af72899417525dd32372d63c07ee5aa1ab6c5c/test%2Fparallel%2Ftest-dns-lookup.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-dns-lookup.js?ref=26af72899417525dd32372d63c07ee5aa1ab6c5c",
            "patch": "@@ -14,13 +14,31 @@ cares.getaddrinfo = () => internalBinding('uv').UV_ENOENT;\n   const err = {\n     code: 'ERR_INVALID_ARG_TYPE',\n     type: TypeError,\n-    message: /^The \"hostname\" argument must be one of type string or falsy/\n+    message: /^The \"hostname\" argument must be of type string\\. Received type number/\n   };\n \n   common.expectsError(() => dns.lookup(1, {}), err);\n   common.expectsError(() => dnsPromises.lookup(1, {}), err);\n }\n \n+common.expectWarning({\n+  // For 'internal/test/binding' module.\n+  'internal/test/binding': [\n+    'These APIs are exposed only for testing and are not ' +\n+    'tracked by any versioning system or deprecation process.'\n+  ],\n+  // For dns.promises.\n+  'ExperimentalWarning': [\n+    'The dns.promises API is experimental'\n+  ],\n+  // For calling `dns.lookup` with falsy `hostname`.\n+  'DeprecationWarning': [\n+    'The provided hostname \"false\" is not a valid ' +\n+    'hostname, and is supported in the dns module solely for compatibility.',\n+    'DEP0118',\n+  ],\n+});\n+\n common.expectsError(() => {\n   dns.lookup(false, 'cb');\n }, {"
        },
        {
            "sha": "0636d8c28e1fb867b80e384bfe1d05dacaf4671b",
            "filename": "test/parallel/test-dns.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/26af72899417525dd32372d63c07ee5aa1ab6c5c/test%2Fparallel%2Ftest-dns.js",
            "raw_url": "https://github.com/nodejs/node/raw/26af72899417525dd32372d63c07ee5aa1ab6c5c/test%2Fparallel%2Ftest-dns.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-dns.js?ref=26af72899417525dd32372d63c07ee5aa1ab6c5c",
            "patch": "@@ -166,7 +166,7 @@ assert.deepStrictEqual(dns.getServers(), []);\n   const errorReg = common.expectsError({\n     code: 'ERR_INVALID_ARG_TYPE',\n     type: TypeError,\n-    message: /^The \"hostname\" argument must be one of type string or falsy/\n+    message: /^The \"hostname\" argument must be of type string\\. Received type .*/\n   }, 10);\n \n   assert.throws(() => dns.lookup({}, common.mustNotCall()), errorReg);"
        }
    ],
    "stats": {
        "total": 68,
        "additions": 61,
        "deletions": 7
    }
}