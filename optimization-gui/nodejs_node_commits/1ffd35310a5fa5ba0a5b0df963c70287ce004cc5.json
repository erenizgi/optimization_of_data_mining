{
    "author": "targos",
    "message": "doc: update and improve the release guide\n\nPR-URL: https://github.com/nodejs/node/pull/21868\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "1ffd35310a5fa5ba0a5b0df963c70287ce004cc5",
    "files": [
        {
            "sha": "051df2b03a7ec3e7fc313e03fb16999d0edbb4a2",
            "filename": "doc/releases.md",
            "status": "modified",
            "additions": 111,
            "deletions": 62,
            "changes": 173,
            "blob_url": "https://github.com/nodejs/node/blob/1ffd35310a5fa5ba0a5b0df963c70287ce004cc5/doc%2Freleases.md",
            "raw_url": "https://github.com/nodejs/node/raw/1ffd35310a5fa5ba0a5b0df963c70287ce004cc5/doc%2Freleases.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Freleases.md?ref=1ffd35310a5fa5ba0a5b0df963c70287ce004cc5",
            "patch": "@@ -78,8 +78,9 @@ Notes:\n \n - Dates listed below as _\"YYYY-MM-DD\"_ should be the date of the release **as\n   UTC**. Use `date -u +'%Y-%m-%d'` to find out what this is.\n-- Version strings are listed below as _\"vx.y.z\"_. Substitute for the release\n-  version.\n+- Version strings are listed below as _\"vx.y.z\"_ or _\"x.y.z\"_. Substitute for\n+  the release version.\n+- Examples will use the fictional release version `1.2.3`.\n \n ### 0. Pre-release steps\n \n@@ -98,29 +99,54 @@ of the `nodejs-private/node-private` repository a day or so before the\n [CI lockdown procedure][] begins. This is to confirm that Jenkins can properly\n access the private repository.\n \n-### 1. Cherry-picking from `master` and other branches\n+### 1. Update the staging branch\n \n-Create a new branch named _\"vx.y.z-proposal\"_, or something similar. Using `git\n-cherry-pick`, bring the appropriate commits into your new branch. To determine\n-the relevant commits, use [`branch-diff`](https://github.com/rvagg/branch-diff)\n-and [`changelog-maker`](https://github.com/rvagg/changelog-maker/) (both are\n-available on npm and should be installed globally). These tools depend on our\n-commit metadata, as well as the `semver-minor` and `semver-major` GitHub labels.\n-One drawback is that when the `PR-URL` metadata is accidentally omitted from a\n-commit, the commit will show up because it's unsure if it's a duplicate or not.\n+Checkout the staging branch locally.\n \n-For a list of commits that could be landed in a patch release on v5.x:\n+```console\n+$ git remote update\n+$ git checkout v1.x-staging\n+$ git reset --hard upstream/v1.x-staging\n+```\n+\n+If the staging branch is not up to date relative to `master`, bring the\n+appropriate commits into it. To determine the relevant commits, use\n+[`branch-diff`](https://github.com/nodejs/branch-diff). The tool is available on\n+npm and should be installed globally or run with `npx`. It depends on our commit\n+metadata, as well as the GitHub labels such as `semver-minor` and\n+`semver-major`. One drawback is that when the `PR-URL` metadata is accidentally\n+omitted from a commit, the commit will show up because it's unsure if it's a\n+duplicate or not.\n+\n+For a list of commits that could be landed in a patch release on v1.x:\n \n ```console\n-$ branch-diff v5.x master --exclude-label=semver-major,semver-minor,dont-land-on-v5.x --filter-release --format=simple\n+$ branch-diff v1.x-staging master --exclude-label=semver-major,semver-minor,dont-land-on-v1.x,backport-requested-v1.x --filter-release --format=simple\n ```\n \n Carefully review the list of commits looking for errors (incorrect `PR-URL`,\n-incorrect semver, etc.). Commits labeled as semver minor or semver major should\n-only be cherry-picked when appropriate for the type of release being made.\n-Previous release commits and version bumps do not need to be cherry-picked.\n+incorrect semver, etc.). Commits labeled as `semver-minor` or `semver-major`\n+should only be cherry-picked when appropriate for the type of release being\n+made. Previous release commits and version bumps do not need to be\n+cherry-picked.\n+\n+If commits were cherry-picked in this step, push to the staging branch to keep\n+it up-to-date.\n+\n+```console\n+$ git push upstream v1.x-staging\n+```\n+\n+### 2. Create a new branch for the release\n+\n+Create a new branch named `vx.y.z-proposal`, off the corresponding staging\n+branch.\n+\n+```console\n+$ git checkout -b v1.2.3-proposal upstream/v1.x-staging\n+```\n \n-### 2. Update `src/node_version.h`\n+### 3. Update `src/node_version.h`\n \n Set the version for the proposed release using the following macros, which are\n already defined in `src/node_version.h`:\n@@ -160,12 +186,12 @@ informed perspective, such as a member of the NAN team.\n see a need to bump `NODE_MODULE_VERSION` then you should consult the TSC.\n Commits may need to be reverted or a major version bump may need to happen.\n \n-### 3. Update the Changelog\n+### 4. Update the Changelog\n \n-#### Step 1: Collecting the formatted list of changes:\n+#### Step 1: Collect the formatted list of changes\n \n Collect a formatted list of commits since the last release. Use\n-[`changelog-maker`](https://github.com/rvagg/changelog-maker) to do this:\n+[`changelog-maker`](https://github.com/nodejs/changelog-maker) to do this:\n \n ```console\n $ changelog-maker --group\n@@ -176,12 +202,12 @@ in the repository was not on the current branch you may have to supply a\n `--start-ref` argument:\n \n ```console\n-$ changelog-maker --group --start-ref v2.3.1\n+$ changelog-maker --group --start-ref v1.2.2\n ```\n \n #### Step 2: Update the appropriate doc/changelogs/CHANGELOG_*.md file\n \n-There is a separate `CHANGELOG_*.md` file for each major Node.js release line.\n+There is a separate `CHANGELOG_Vx.md` file for each major Node.js release line.\n These are located in the `doc/changelogs/` directory. Once the formatted list of\n changes is collected, it must be added to the top of the relevant changelog file\n in the release branch (e.g. a release for Node.js v4 would be added to the\n@@ -210,18 +236,22 @@ The new entry should take the following form:\n The release type should be either Current, LTS, or Maintenance, depending on the\n type of release being produced.\n \n+You can use `branch-diff` to get a list of commits with the `notable-change`\n+label:\n+\n+```console\n+$ branch-diff upstream/v1.x v1.2.3-proposal --require-label=notable-change -format=simple\n+```\n+\n Be sure that the `<a>` tag, as well as the two headings, are not indented at\n all.\n \n-At the top of each `CHANGELOG_*.md` file, and in the root `CHANGELOG.md` file,\n-there is a table indexing all releases in each major release line. A link to the\n-new release needs to be added to each. Follow the existing examples and be sure\n-to add the release to the *top* of the list.\n-\n-In the root `CHANGELOG.md` file, the most recent release for each release line\n-is shown in **bold** in the index. When updating the index, please make sure to\n-update the display accordingly by removing the bold styling from the previous\n-release.\n+At the top of the root `CHANGELOG.md` file, there is a table indexing all\n+releases in each major release line. A link to the new release needs to be added\n+to it. Follow the existing examples and be sure to add the release to the *top*\n+of the list. The most recent release for each release line is shown in **bold**\n+in the index. When updating the index, please make sure to update the display\n+accordingly by removing the bold styling from the previous release.\n \n #### Step 3: Update any REPLACEME and DEP00XX tags in the docs\n \n@@ -239,12 +269,12 @@ If this release includes any new deprecations it is necessary to ensure that\n those are assigned a proper static deprecation code. These are listed in the\n docs (see `doc/api/deprecations.md`) and in the source as `DEP00XX`. The code\n must be assigned a number (e.g. `DEP0012`). Note that this assignment should\n-occur when the PR is landed, but a check will be made when the release built is\n+occur when the PR is landed, but a check will be made when the release build is\n run.\n \n-### 4. Create Release Commit\n+### 5. Create Release Commit\n \n-The `CHANGELOG.md`, `doc/changelogs/CHANGELOG_*.md`, `src/node_version.h`, and\n+The `CHANGELOG.md`, `doc/changelogs/CHANGELOG_Vx.md`, `src/node_version.h`, and\n `REPLACEME` changes should be the final commit that will be tagged for the\n release. When committing these to git, use the following message format:\n \n@@ -256,38 +286,40 @@ Notable changes:\n * Copy the notable changes list here, reformatted for plain-text\n ```\n \n-### 5. Propose Release on GitHub\n+### 6. Propose Release on GitHub\n \n Push the release branch to `nodejs/node`, not to your own fork. This allows\n release branches to more easily be passed between members of the release team if\n necessary.\n \n Create a pull request targeting the correct release line. For example, a\n-v5.3.0-proposal PR should target v5.x, not master. Paste the CHANGELOG\n+`v5.3.0-proposal` PR should target `v5.x`, not master. Paste the CHANGELOG\n modifications into the body of the PR so that collaborators can see what is\n changing. These PRs should be left open for at least 24 hours, and can be\n updated as new commits land.\n \n If you need any additional information about any of the commits, this PR is a\n good place to @-mention the relevant contributors.\n \n-This is also a good time to update the release commit to include `PR-URL`\n-metadata.\n+After opening the PR, update the release commit to include `PR-URL` metadata and\n+force-push the proposal.\n \n-### 6. Ensure that the Release Branch is Stable\n+### 7. Ensure that the Release Branch is Stable\n \n-Run a\n-**[node-test-pull-request](https://ci.nodejs.org/job/node-test-pull-request/)**\n+Run a **[`node-test-pull-request`](https://ci.nodejs.org/job/node-test-pull-request/)**\n test run to ensure that the build is stable and the HEAD commit is ready for\n release.\n \n-Perform some smoke-testing. We have [citgm](https://github.com/nodejs/citgm) for\n-this. You can also manually test important modules from the ecosystem. Remember\n-that node-gyp and npm both take a `--nodedir` flag to point to your local\n-repository so that you can test unreleased versions without needing node-gyp to\n-download headers for you.\n+Also run a **[`node-test-commit-v8-linux`](https://ci.nodejs.org/job/node-test-commit-v8-linux/)**\n+test run if the release contains changes to `deps/v8`.\n \n-### 7. Produce a Nightly Build _(optional)_\n+Perform some smoke-testing. There is the\n+**[`citgm-smoker`](https://ci.nodejs.org/job/citgm-smoker/)** CI job for this\n+purpose. Run it once with the base `vx.x` branch as a reference and with the\n+proposal branch to check if new regressions could be introduced in the\n+ecosystem.\n+\n+### 8. Produce a Nightly Build _(optional)_\n \n If there is a reason to produce a test release for the purpose of having others\n try out installers or specifics of builds, produce a nightly build using\n@@ -299,7 +331,7 @@ enter a proper length commit SHA, enter a date string, and select \"nightly\" for\n This is particularly recommended if there has been recent work relating to the\n macOS or Windows installers as they are not tested in any way by CI.\n \n-### 8. Produce Release Builds\n+### 9. Produce Release Builds\n \n Use **[iojs+release](https://ci-release.nodejs.org/job/iojs+release/)** to\n produce release artifacts. Enter the commit that you want to build from and\n@@ -345,19 +377,19 @@ can use the\n build in the release CI to re-run the build only for ARMv6. When launching the\n build make sure to use the same commit hash as for the original release.\n \n-### 9. Test the Build\n+### 10. Test the Build\n \n Jenkins collects the artifacts from the builds, allowing you to download and\n install the new build. Make sure that the build appears correct. Check the\n version numbers, and perform some basic checks to confirm that all is well with\n the build before moving forward.\n \n-### 10. Tag and Sign the Release Commit\n+### 11. Tag and Sign the Release Commit\n \n Once you have produced builds that you're happy with, create a new tag. By\n waiting until this stage to create tags, you can discard a proposed release if\n something goes wrong or additional commits are required. Once you have created a\n-tag and pushed it to GitHub, you ***should not*** delete and re-tag. If you make\n+tag and pushed it to GitHub, you ***must not*** delete and re-tag. If you make\n a mistake after tagging then you'll have to version-bump and start again and\n count that tag/version as lost.\n \n@@ -388,7 +420,7 @@ following command:\n $ git push <remote> <vx.y.z>\n ```\n \n-### 11. Set Up For the Next Release\n+### 12. Set Up For the Next Release\n \n On release proposal branch, edit `src/node_version.h` again and:\n \n@@ -407,17 +439,26 @@ This sets up the branch so that nightly builds are produced with the next\n version number _and_ a pre-release tag.\n \n Merge your release proposal branch into the stable branch that you are releasing\n-from (e.g. `v8.x`), and rebase the corresponding staging branch (`v8.x-staging`)\n-on top of that.\n+from and rebase the corresponding staging branch on top of that.\n+\n+```console\n+$ git checkout v1.x\n+$ git merge --ff-only v1.2.3-proposal\n+$ git push upstream v1.x\n+$ git checkout v1.x-staging\n+$ git rebase v1.x\n+$ git push upstream v1.x-staging\n+```\n \n Cherry-pick the release commit to `master`. After cherry-picking, edit\n `src/node_version.h` to ensure the version macros contain whatever values were\n-previously on `master`. `NODE_VERSION_IS_RELEASE` should be `0`.\n+previously on `master`. `NODE_VERSION_IS_RELEASE` should be `0`. **Do not**\n+cherry-pick the \"Working on vx.y.z\" commit to `master`.\n \n Run `make lint-md-build; make lint` before pushing to `master`, to make sure the\n Changelog formatting passes the lint rules on `master`.\n \n-### 12. Promote and Sign the Release Builds\n+### 13. Promote and Sign the Release Builds\n \n **It is important that the same individual who signed the release tag be the one\n to promote the builds as the SHASUMS256.txt file needs to be signed with the\n@@ -469,7 +510,7 @@ be prompted to re-sign SHASUMS256.txt.\n *Note*: It is possible to only sign a release by running `./tools/release.sh -s\n vX.Y.Z`.\n \n-### 13. Check the Release\n+### 14. Check the Release\n \n Your release should be available at `https://nodejs.org/dist/vx.y.z/` and\n <https://nodejs.org/dist/latest/>. Check that the appropriate files are in\n@@ -478,7 +519,7 @@ have the right internal version strings. Check that the API docs are available\n at <https://nodejs.org/api/>. Check that the release catalog files are correct\n at <https://nodejs.org/dist/index.tab> and <https://nodejs.org/dist/index.json>.\n \n-### 14. Create a Blog Post\n+### 15. Create a Blog Post\n \n There is an automatic build that is kicked off when you promote new builds, so\n within a few minutes nodejs.org will be listing your new version as the latest\n@@ -512,7 +553,7 @@ This script will use the promoted builds and changelog to generate the post. Run\n - Changes to `master` on the nodejs.org repo will trigger a new build of\n   nodejs.org so your changes should appear in a few minutes after pushing.\n \n-### 15. Announce\n+### 16. Announce\n \n The nodejs.org website will automatically rebuild and include the new version.\n To announce the build on Twitter through the official @nodejs account, email\n@@ -527,11 +568,19 @@ To ensure communication goes out with the timing of the blog post, please allow\n will be shared with the community in the email to coordinate these\n announcements.\n \n-### 16. Cleanup\n+### 17. Create the release on GitHub\n+\n+- Got to the [New release page](https://github.com/nodejs/node/releases/new).\n+- Select the tag version you pushed earlier.\n+- For release title, copy the title from the changelog.\n+- For the description, copy the rest of the changelog entry.\n+- Click on the \"Publish release\" button.\n+\n+### 18. Cleanup\n \n-Close your release proposal PR and remove the proposal branch.\n+Close your release proposal PR and delete the proposal branch.\n \n-### 17. Celebrate\n+### 19. Celebrate\n \n _In whatever form you do this..._\n "
        }
    ],
    "stats": {
        "total": 173,
        "additions": 111,
        "deletions": 62
    }
}