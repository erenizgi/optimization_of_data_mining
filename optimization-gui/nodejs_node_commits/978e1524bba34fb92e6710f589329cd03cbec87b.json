{
    "author": "remusao",
    "message": "timers: fix clearInterval to work with timers from setTimeout\n\nAccording to HTML Living Standard, \"either method [clearInterval or\nclearTimeout] can be used to clear timers created by setTimeout() or\nsetInterval().\".\n\nThe current implementation of clearTimeout is already able to destroy a\ntimer created by setInterval, but not the other way around.\n\nPR-URL: https://github.com/nodejs/node/pull/19952\nRefs: https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-setinterval\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "978e1524bba34fb92e6710f589329cd03cbec87b",
    "files": [
        {
            "sha": "0cc535352a0697ec606599d22166ff1c0eb42622",
            "filename": "doc/api/timers.md",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/978e1524bba34fb92e6710f589329cd03cbec87b/doc%2Fapi%2Ftimers.md",
            "raw_url": "https://github.com/nodejs/node/raw/978e1524bba34fb92e6710f589329cd03cbec87b/doc%2Fapi%2Ftimers.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ftimers.md?ref=978e1524bba34fb92e6710f589329cd03cbec87b",
            "patch": "@@ -56,8 +56,8 @@ Returns a reference to the `Immediate`.\n ## Class: Timeout\n \n This object is created internally and is returned from [`setTimeout()`][] and\n-[`setInterval()`][]. It can be passed to [`clearTimeout()`][] or\n-[`clearInterval()`][] (respectively) in order to cancel the scheduled actions.\n+[`setInterval()`][]. It can be passed to either [`clearTimeout()`][] or\n+[`clearInterval()`][] in order to cancel the scheduled actions.\n \n By default, when a timer is scheduled using either [`setTimeout()`][] or\n [`setInterval()`][], the Node.js event loop will continue running as long as the"
        },
        {
            "sha": "ad00ede974895f34a354f65805b02b748a9dc1b2",
            "filename": "lib/timers.js",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/978e1524bba34fb92e6710f589329cd03cbec87b/lib%2Ftimers.js",
            "raw_url": "https://github.com/nodejs/node/raw/978e1524bba34fb92e6710f589329cd03cbec87b/lib%2Ftimers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftimers.js?ref=978e1524bba34fb92e6710f589329cd03cbec87b",
            "patch": "@@ -496,14 +496,13 @@ exports.setInterval = function(callback, repeat, arg1, arg2, arg3) {\n   return timeout;\n };\n \n-exports.clearInterval = function(timer) {\n-  if (timer && timer._repeat) {\n-    timer._repeat = null;\n-    clearTimeout(timer);\n-  }\n+exports.clearInterval = function clearInterval(timer) {\n+  // clearTimeout and clearInterval can be used to clear timers created from\n+  // both setTimeout and setInterval, as specified by HTML Living Standard:\n+  // https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-setinterval\n+  clearTimeout(timer);\n };\n \n-\n function unrefdHandle(timer, now) {\n   try {\n     // Don't attempt to call the callback if it is not a function."
        },
        {
            "sha": "94611b7070960e283ea03b6a5b5fd5c3cbca4ed0",
            "filename": "test/parallel/test-timers-clear-timeout-interval-equivalent.js",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/978e1524bba34fb92e6710f589329cd03cbec87b/test%2Fparallel%2Ftest-timers-clear-timeout-interval-equivalent.js",
            "raw_url": "https://github.com/nodejs/node/raw/978e1524bba34fb92e6710f589329cd03cbec87b/test%2Fparallel%2Ftest-timers-clear-timeout-interval-equivalent.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-timers-clear-timeout-interval-equivalent.js?ref=978e1524bba34fb92e6710f589329cd03cbec87b",
            "patch": "@@ -0,0 +1,18 @@\n+'use strict';\n+const common = require('../common');\n+\n+// This test makes sure that timers created with setTimeout can be disarmed by\n+// clearInterval and that timers created with setInterval can be disarmed by\n+// clearTimeout.\n+//\n+// This behavior is documented in the HTML Living Standard:\n+//\n+// * Refs: https://html.spec.whatwg.org/multipage/timers-and-user-prompts.html#dom-setinterval\n+\n+// Disarm interval with clearTimeout.\n+const interval = setInterval(common.mustNotCall(), 1);\n+clearTimeout(interval);\n+\n+// Disarm timeout with clearInterval.\n+const timeout = setTimeout(common.mustNotCall(), 1);\n+clearInterval(timeout);"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 25,
        "deletions": 8
    }
}