{
    "author": "MylesBorins",
    "message": "deps: patch V8 to 6.6.346.32\n\nPR-URL: https://github.com/nodejs/node/pull/20748\nRefs: https://github.com/v8/v8/compare/6.6.346.31...6.6.346.32\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>",
    "sha": "3424f71cc900ce2bb22615630c37ba236a2060a4",
    "files": [
        {
            "sha": "cdb2c5381e3c85c22c472b554068e036389975cb",
            "filename": "deps/v8/include/v8-version.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/3424f71cc900ce2bb22615630c37ba236a2060a4/deps%2Fv8%2Finclude%2Fv8-version.h",
            "raw_url": "https://github.com/nodejs/node/raw/3424f71cc900ce2bb22615630c37ba236a2060a4/deps%2Fv8%2Finclude%2Fv8-version.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8-version.h?ref=3424f71cc900ce2bb22615630c37ba236a2060a4",
            "patch": "@@ -11,7 +11,7 @@\n #define V8_MAJOR_VERSION 6\n #define V8_MINOR_VERSION 6\n #define V8_BUILD_NUMBER 346\n-#define V8_PATCH_LEVEL 31\n+#define V8_PATCH_LEVEL 32\n \n // Use 1 for candidates and 0 otherwise.\n // (Boolean macro values are not supported by all preprocessors.)"
        },
        {
            "sha": "d0ccb4e739db4f37f6eae469c805026e6589969b",
            "filename": "deps/v8/src/managed.h",
            "status": "modified",
            "additions": 14,
            "deletions": 6,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/3424f71cc900ce2bb22615630c37ba236a2060a4/deps%2Fv8%2Fsrc%2Fmanaged.h",
            "raw_url": "https://github.com/nodejs/node/raw/3424f71cc900ce2bb22615630c37ba236a2060a4/deps%2Fv8%2Fsrc%2Fmanaged.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fmanaged.h?ref=3424f71cc900ce2bb22615630c37ba236a2060a4",
            "patch": "@@ -59,22 +59,30 @@ class Managed : public Foreign {\n         isolate->factory()->NewForeign(reinterpret_cast<Address>(finalizer)));\n     Handle<Object> global_handle = isolate->global_handles()->Create(*handle);\n     finalizer->global_handle_location = global_handle.location();\n-    GlobalHandles::MakeWeak(finalizer->global_handle_location,\n-                            handle->GetFinalizer(), &Managed<CppType>::GCDelete,\n-                            v8::WeakCallbackType::kParameter);\n+    GlobalHandles::MakeWeak(\n+        finalizer->global_handle_location, handle->GetFinalizer(),\n+        &ResetWeakAndScheduleGCDelete, v8::WeakCallbackType::kParameter);\n \n     return handle;\n   }\n \n  private:\n-  static void GCDelete(const v8::WeakCallbackInfo<void>& data) {\n+  static void ResetWeakAndScheduleGCDelete(\n+      const v8::WeakCallbackInfo<void>& data) {\n     FinalizerWithHandle* finalizer =\n         reinterpret_cast<FinalizerWithHandle*>(data.GetParameter());\n-\n+    GlobalHandles::Destroy(finalizer->global_handle_location);\n     Isolate* isolate = reinterpret_cast<Isolate*>(data.GetIsolate());\n     isolate->UnregisterFromReleaseAtTeardown(finalizer);\n+    // We need to call GCDelete as a second pass callback because\n+    // it can trigger garbage collection. The first pass callbacks\n+    // are not allowed to invoke V8 API.\n+    data.SetSecondPassCallback(&GCDelete);\n+  }\n \n-    GlobalHandles::Destroy(finalizer->global_handle_location);\n+  static void GCDelete(const v8::WeakCallbackInfo<void>& data) {\n+    FinalizerWithHandle* finalizer =\n+        reinterpret_cast<FinalizerWithHandle*>(data.GetParameter());\n     NativeDelete(finalizer);\n   }\n "
        }
    ],
    "stats": {
        "total": 22,
        "additions": 15,
        "deletions": 7
    }
}