{
    "author": "TimothyGu",
    "message": "worker: restrict supported extensions\n\nOnly allow `.js` and `.mjs` extensions to provide future-proofing\nfor file type detection.\n\nRefs: https://github.com/ayojs/ayo/pull/117\nReviewed-By: Stephen Belanger <admin@stephenbelanger.com>\nReviewed-By: Olivia Hugger <olivia@fastmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\n\nPR-URL: https://github.com/nodejs/node/pull/20876\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Shingo Inoue <leko.noor@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: John-David Dalton <john.david.dalton@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>",
    "sha": "147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da",
    "files": [
        {
            "sha": "54201d0d1e7f4cbef14c92db1629888526f0cba8",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da",
            "patch": "@@ -849,4 +849,7 @@ E('ERR_WORKER_NEED_ABSOLUTE_PATH',\n   TypeError);\n E('ERR_WORKER_UNSERIALIZABLE_ERROR',\n   'Serializing an uncaught exception failed', Error);\n+E('ERR_WORKER_UNSUPPORTED_EXTENSION',\n+  'The worker script extension must be \".js\" or \".mjs\". Received \"%s\"',\n+  TypeError);\n E('ERR_ZLIB_INITIALIZATION_FAILED', 'Initialization failed', Error);"
        },
        {
            "sha": "edd954d8a3a2be6270b909b7de0ec07ee77bcab1",
            "filename": "lib/internal/worker.js",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da/lib%2Finternal%2Fworker.js",
            "raw_url": "https://github.com/nodejs/node/raw/147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da/lib%2Finternal%2Fworker.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fworker.js?ref=147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da",
            "patch": "@@ -8,7 +8,8 @@ const util = require('util');\n const {\n   ERR_INVALID_ARG_TYPE,\n   ERR_WORKER_NEED_ABSOLUTE_PATH,\n-  ERR_WORKER_UNSERIALIZABLE_ERROR\n+  ERR_WORKER_UNSERIALIZABLE_ERROR,\n+  ERR_WORKER_UNSUPPORTED_EXTENSION,\n } = require('internal/errors').codes;\n \n const { internalBinding } = require('internal/bootstrap/loaders');\n@@ -136,8 +137,14 @@ class Worker extends EventEmitter {\n       throw new ERR_INVALID_ARG_TYPE('filename', 'string', filename);\n     }\n \n-    if (!options.eval && !path.isAbsolute(filename)) {\n-      throw new ERR_WORKER_NEED_ABSOLUTE_PATH(filename);\n+    if (!options.eval) {\n+      if (!path.isAbsolute(filename)) {\n+        throw new ERR_WORKER_NEED_ABSOLUTE_PATH(filename);\n+      }\n+      const ext = path.extname(filename);\n+      if (ext !== '.js' && ext !== '.mjs') {\n+        throw new ERR_WORKER_UNSUPPORTED_EXTENSION(ext);\n+      }\n     }\n \n     // Set up the C++ handle for the worker, as well as some internal wiring."
        },
        {
            "sha": "3716377ec2fb1f04fa963eb9060e865e4ec7990e",
            "filename": "test/parallel/test-worker-unsupported-path.js",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da/test%2Fparallel%2Ftest-worker-unsupported-path.js",
            "raw_url": "https://github.com/nodejs/node/raw/147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da/test%2Fparallel%2Ftest-worker-unsupported-path.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-unsupported-path.js?ref=147ea5e3d78effd6da8ea2bfbf6bb77b6aaf52da",
            "patch": "@@ -0,0 +1,27 @@\n+// Flags: --experimental-worker\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+const { Worker } = require('worker');\n+\n+{\n+  const expectedErr = common.expectsError({\n+    code: 'ERR_WORKER_NEED_ABSOLUTE_PATH',\n+    type: TypeError\n+  }, 4);\n+  assert.throws(() => { new Worker('a.js'); }, expectedErr);\n+  assert.throws(() => { new Worker('b'); }, expectedErr);\n+  assert.throws(() => { new Worker('c/d.js'); }, expectedErr);\n+  assert.throws(() => { new Worker('a.mjs'); }, expectedErr);\n+}\n+\n+{\n+  const expectedErr = common.expectsError({\n+    code: 'ERR_WORKER_UNSUPPORTED_EXTENSION',\n+    type: TypeError\n+  }, 3);\n+  assert.throws(() => { new Worker('/b'); }, expectedErr);\n+  assert.throws(() => { new Worker('/c.wasm'); }, expectedErr);\n+  assert.throws(() => { new Worker('/d.txt'); }, expectedErr);\n+}"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 40,
        "deletions": 3
    }
}