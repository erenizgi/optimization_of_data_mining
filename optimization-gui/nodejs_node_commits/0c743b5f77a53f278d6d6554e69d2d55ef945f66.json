{
    "author": "rubys",
    "message": "tools: build all.json by combining generated JSON\n\nNotes:\n\n1) Removed a number of root properties that did not seem relevant:\n   source, desc, and introduced_in.  There no longer is a source, and\n   the other two are from the first include and do not reflect the\n   entire API.\n\n2) As with https://github.com/nodejs/node/issues/20100, the current\n   \"desc\" properties sometimes contained in-page links, other times\n   referenced another page, and often did not match the links in the\n   original HTML or JSON file. I chose to standardize on external links\n   as \"desc\" values are isolated snippets as opposed to all.html which\n   can be viewed as a standalone and self contained document.\n\n3) Eliminated preprocessing for @include entirely, including the test\n   case for this function.\n\n4) _toc.md was renamed to index.md.\n\n5) index comments no longer appear in embedded TOCs (left hand side\n   column in the generated documentation.\n\nPR-URL: https://github.com/nodejs/node/pull/21637\nReviewed-By: Vse Mozhet Byt <vsemozhetbyt@gmail.com>\nReviewed-By: Rich Trott <rtrott@gmail.com>",
    "sha": "0c743b5f77a53f278d6d6554e69d2d55ef945f66",
    "files": [
        {
            "sha": "600d87fd2316b2ae53b219341c5a7c862f40f4d5",
            "filename": "Makefile",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/0c743b5f77a53f278d6d6554e69d2d55ef945f66/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/0c743b5f77a53f278d6d6554e69d2d55ef945f66/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=0c743b5f77a53f278d6d6554e69d2d55ef945f66",
            "patch": "@@ -615,7 +615,7 @@ doc-only: $(apidoc_dirs) $(apiassets)  ## Builds the docs with the local or the\n \tif [ ! -d doc/api/assets ]; then \\\n \t\t$(MAKE) tools/doc/node_modules/js-yaml/package.json; \\\n \tfi;\n-\t@$(MAKE) $(apidocs_html) $(apidocs_json)\n+\t@$(MAKE) out/doc/api/all.html out/doc/api/all.json\n \n .PHONY: doc\n doc: $(NODE_EXE) doc-only\n@@ -665,10 +665,12 @@ out/doc/api/%.json: doc/api/%.md tools/doc/generate.js tools/doc/json.js\n out/doc/api/%.html: doc/api/%.md tools/doc/generate.js tools/doc/html.js\n \t$(call available-node, $(gen-html))\n \n-out/doc/api/all.html: $(filter-out out/doc/api/all.html, $(apidocs_html)) \\\n-\ttools/doc/allhtml.js\n+out/doc/api/all.html: $(apidocs_html) tools/doc/allhtml.js\n \t$(call available-node, tools/doc/allhtml.js)\n \n+out/doc/api/all.json: $(apidocs_json) tools/doc/alljson.js\n+\t$(call available-node, tools/doc/alljson.js)\n+\n .PHONY: docopen\n docopen: $(apidocs_html)\n \t@$(PYTHON) -mwebbrowser file://$(PWD)/out/doc/api/all.html"
        },
        {
            "sha": "e307d52ae8544e415b59cd4e4600166b5779f6ad",
            "filename": "doc/api/_toc.md",
            "status": "removed",
            "additions": 0,
            "deletions": 62,
            "changes": 62,
            "blob_url": "https://github.com/nodejs/node/blob/1529ef4dc5e4cf99ea964bc1cc47cd62cca17540/doc%2Fapi%2F_toc.md",
            "raw_url": "https://github.com/nodejs/node/raw/1529ef4dc5e4cf99ea964bc1cc47cd62cca17540/doc%2Fapi%2F_toc.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2F_toc.md?ref=1529ef4dc5e4cf99ea964bc1cc47cd62cca17540",
            "patch": "@@ -1,62 +0,0 @@\n-@// NB(chrisdickinson): if you move this file, be sure to update\n-@// tools/doc/html.js to point at the new location.\n-\n-<!--introduced_in=v0.10.0-->\n-\n-* [About these Docs](documentation.html)\n-* [Usage & Example](synopsis.html)\n-\n-<div class=\"line\"></div>\n-\n-* [Assertion Testing](assert.html)\n-* [Async Hooks](async_hooks.html)\n-* [Buffer](buffer.html)\n-* [C++ Addons](addons.html)\n-* [C/C++ Addons - N-API](n-api.html)\n-* [Child Processes](child_process.html)\n-* [Cluster](cluster.html)\n-* [Command Line Options](cli.html)\n-* [Console](console.html)\n-* [Crypto](crypto.html)\n-* [Debugger](debugger.html)\n-* [Deprecated APIs](deprecations.html)\n-* [DNS](dns.html)\n-* [Domain](domain.html)\n-* [ECMAScript Modules](esm.html)\n-* [Errors](errors.html)\n-* [Events](events.html)\n-* [File System](fs.html)\n-* [Globals](globals.html)\n-* [HTTP](http.html)\n-* [HTTP/2](http2.html)\n-* [HTTPS](https.html)\n-* [Inspector](inspector.html)\n-* [Internationalization](intl.html)\n-* [Modules](modules.html)\n-* [Net](net.html)\n-* [OS](os.html)\n-* [Path](path.html)\n-* [Performance Hooks](perf_hooks.html)\n-* [Process](process.html)\n-* [Punycode](punycode.html)\n-* [Query Strings](querystring.html)\n-* [Readline](readline.html)\n-* [REPL](repl.html)\n-* [Stream](stream.html)\n-* [String Decoder](string_decoder.html)\n-* [Timers](timers.html)\n-* [TLS/SSL](tls.html)\n-* [Trace Events](tracing.html)\n-* [TTY](tty.html)\n-* [UDP/Datagram](dgram.html)\n-* [URL](url.html)\n-* [Utilities](util.html)\n-* [V8](v8.html)\n-* [VM](vm.html)\n-* [Worker Threads](worker_threads.html)\n-* [ZLIB](zlib.html)\n-\n-<div class=\"line\"></div>\n-\n-* [GitHub Repo & Issue Tracker](https://github.com/nodejs/node)\n-* [Mailing List](https://groups.google.com/group/nodejs)"
        },
        {
            "sha": "47216b695d33511faadf7208628ff2947e20161d",
            "filename": "doc/api/all.md",
            "status": "removed",
            "additions": 0,
            "deletions": 50,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/1529ef4dc5e4cf99ea964bc1cc47cd62cca17540/doc%2Fapi%2Fall.md",
            "raw_url": "https://github.com/nodejs/node/raw/1529ef4dc5e4cf99ea964bc1cc47cd62cca17540/doc%2Fapi%2Fall.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fall.md?ref=1529ef4dc5e4cf99ea964bc1cc47cd62cca17540",
            "patch": "@@ -1,50 +0,0 @@\n-<!--lint disable prohibited-strings-->\n-@include documentation\n-@include synopsis\n-@include assert\n-@include async_hooks\n-@include buffer\n-@include addons\n-@include n-api\n-@include child_process\n-@include cluster\n-@include cli\n-@include console\n-@include crypto\n-@include debugger\n-@include deprecations\n-@include dns\n-@include domain\n-@include esm\n-@include errors\n-@include events\n-@include fs\n-@include globals\n-@include http\n-@include http2\n-@include https\n-@include inspector\n-@include intl\n-@include modules\n-@include net\n-@include os\n-@include path\n-@include perf_hooks\n-@include process\n-@include punycode\n-@include querystring\n-@include readline\n-@include repl\n-@include stream\n-@include string_decoder\n-@include timers\n-@include tls\n-@include tracing\n-@include tty\n-@include dgram\n-@include url\n-@include util\n-@include v8\n-@include vm\n-@include worker_threads\n-@include zlib"
        },
        {
            "sha": "0b43097bf294de4ee5189401b0ba20657c89acfe",
            "filename": "doc/api/index.md",
            "status": "modified",
            "additions": 64,
            "deletions": 1,
            "changes": 65,
            "blob_url": "https://github.com/nodejs/node/blob/0c743b5f77a53f278d6d6554e69d2d55ef945f66/doc%2Fapi%2Findex.md",
            "raw_url": "https://github.com/nodejs/node/raw/0c743b5f77a53f278d6d6554e69d2d55ef945f66/doc%2Fapi%2Findex.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Findex.md?ref=0c743b5f77a53f278d6d6554e69d2d55ef945f66",
            "patch": "@@ -1 +1,64 @@\n-@include _toc.md\n+<!--\n+  NB(chrisdickinson): if you move this file, be sure to update\n+  tools/doc/html.js to point at the new location.\n+-->\n+\n+<!--introduced_in=v0.10.0-->\n+\n+* [About these Docs](documentation.html)\n+* [Usage & Example](synopsis.html)\n+\n+<div class=\"line\"></div>\n+\n+* [Assertion Testing](assert.html)\n+* [Async Hooks](async_hooks.html)\n+* [Buffer](buffer.html)\n+* [C++ Addons](addons.html)\n+* [C/C++ Addons - N-API](n-api.html)\n+* [Child Processes](child_process.html)\n+* [Cluster](cluster.html)\n+* [Command Line Options](cli.html)\n+* [Console](console.html)\n+* [Crypto](crypto.html)\n+* [Debugger](debugger.html)\n+* [Deprecated APIs](deprecations.html)\n+* [DNS](dns.html)\n+* [Domain](domain.html)\n+* [ECMAScript Modules](esm.html)\n+* [Errors](errors.html)\n+* [Events](events.html)\n+* [File System](fs.html)\n+* [Globals](globals.html)\n+* [HTTP](http.html)\n+* [HTTP/2](http2.html)\n+* [HTTPS](https.html)\n+* [Inspector](inspector.html)\n+* [Internationalization](intl.html)\n+* [Modules](modules.html)\n+* [Net](net.html)\n+* [OS](os.html)\n+* [Path](path.html)\n+* [Performance Hooks](perf_hooks.html)\n+* [Process](process.html)\n+* [Punycode](punycode.html)\n+* [Query Strings](querystring.html)\n+* [Readline](readline.html)\n+* [REPL](repl.html)\n+* [Stream](stream.html)\n+* [String Decoder](string_decoder.html)\n+* [Timers](timers.html)\n+* [TLS/SSL](tls.html)\n+* [Trace Events](tracing.html)\n+* [TTY](tty.html)\n+* [UDP/Datagram](dgram.html)\n+* [URL](url.html)\n+* [Utilities](util.html)\n+* [V8](v8.html)\n+* [VM](vm.html)\n+* [Worker Threads](worker_threads.html)\n+* [ZLIB](zlib.html)\n+\n+<div class=\"line\"></div>\n+\n+* [GitHub Repo & Issue Tracker](https://github.com/nodejs/node)\n+* [Mailing List](https://groups.google.com/group/nodejs)"
        },
        {
            "sha": "a6119c16903a7437500b83751a77318930e112d2",
            "filename": "test/doctool/test-doctool-html.js",
            "status": "modified",
            "additions": 26,
            "deletions": 38,
            "changes": 64,
            "blob_url": "https://github.com/nodejs/node/blob/0c743b5f77a53f278d6d6554e69d2d55ef945f66/test%2Fdoctool%2Ftest-doctool-html.js",
            "raw_url": "https://github.com/nodejs/node/raw/0c743b5f77a53f278d6d6554e69d2d55ef945f66/test%2Fdoctool%2Ftest-doctool-html.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fdoctool%2Ftest-doctool-html.js?ref=0c743b5f77a53f278d6d6554e69d2d55ef945f66",
            "patch": "@@ -11,7 +11,6 @@ try {\n const assert = require('assert');\n const { readFile } = require('fs');\n const fixtures = require('../common/fixtures');\n-const processIncludes = require('../../tools/doc/preprocess.js');\n const toHTML = require('../../tools/doc/html.js');\n \n // Test data is a list of objects with two properties.\n@@ -64,15 +63,6 @@ const testData = [\n       '<!-- This is not a metadata comment --> ' +\n       '<p>Describe <code>Something</code> in more detail here. </p>'\n   },\n-  {\n-    file: fixtures.path('doc_with_includes.md'),\n-    html: '<!-- [start-include:doc_inc_1.md] -->' +\n-    '<p>Look <a href=\"doc_inc_2.html#doc_inc_2_foobar\">here</a>!</p>' +\n-    '<!-- [end-include:doc_inc_1.md] --><!-- [start-include:doc_inc_2.md] -->' +\n-    '<h1>foobar<span><a class=\"mark\" href=\"#doc_inc_2_foobar\" ' +\n-    'id=\"doc_inc_2_foobar\">#</a></span></h1>' +\n-    '<p>I exist and am being linked to.</p><!-- [end-include:doc_inc_2.md] -->'\n-  },\n   {\n     file: fixtures.path('sample_document.md'),\n     html: '<ol><li>fish</li><li><p>fish</p></li><li><p>Redfish</p></li>' +\n@@ -90,36 +80,34 @@ testData.forEach(({ file, html, analyticsId }) => {\n \n   readFile(file, 'utf8', common.mustCall((err, input) => {\n     assert.ifError(err);\n-    processIncludes(file, input, common.mustCall((err, preprocessed) => {\n-      assert.ifError(err);\n \n-      toHTML(\n-        {\n-          input: preprocessed,\n-          filename: 'foo',\n-          nodeVersion: process.version,\n-          analytics: analyticsId,\n-        },\n-        common.mustCall((err, output) => {\n-          assert.ifError(err);\n+    toHTML(\n+      {\n+        input: input,\n+        filename: 'foo',\n+        nodeVersion: process.version,\n+        analytics: analyticsId,\n+      },\n+      common.mustCall((err, output) => {\n+        assert.ifError(err);\n \n-          const actual = output.replace(spaces, '');\n-          // Assert that the input stripped of all whitespace contains the\n-          // expected markup.\n-          assert(actual.includes(expected));\n+        const actual = output.replace(spaces, '');\n+        // Assert that the input stripped of all whitespace contains the\n+        // expected markup.\n+        assert(actual.includes(expected));\n \n-          // Testing the insertion of Google Analytics script when\n-          // an analytics id is provided. Should not be present by default.\n-          const scriptDomain = 'google-analytics.com';\n-          if (includeAnalytics) {\n-            assert(actual.includes(scriptDomain),\n-                   `Google Analytics script was not present in \"${actual}\"`);\n-          } else {\n-            assert.strictEqual(actual.includes(scriptDomain), false,\n-                               'Google Analytics script was present in ' +\n-                               `\"${actual}\"`);\n-          }\n-        }));\n-    }));\n+        // Testing the insertion of Google Analytics script when\n+        // an analytics id is provided. Should not be present by default.\n+        const scriptDomain = 'google-analytics.com';\n+        if (includeAnalytics) {\n+          assert(actual.includes(scriptDomain),\n+                 `Google Analytics script was not present in \"${actual}\"`);\n+        } else {\n+          assert.strictEqual(actual.includes(scriptDomain), false,\n+                             'Google Analytics script was present in ' +\n+                             `\"${actual}\"`);\n+        }\n+      })\n+    );\n   }));\n });"
        },
        {
            "sha": "a11da0e97d8355fd53712d3890a3460bf61a5615",
            "filename": "test/doctool/test-make-doc.js",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/0c743b5f77a53f278d6d6554e69d2d55ef945f66/test%2Fdoctool%2Ftest-make-doc.js",
            "raw_url": "https://github.com/nodejs/node/raw/0c743b5f77a53f278d6d6554e69d2d55ef945f66/test%2Fdoctool%2Ftest-make-doc.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fdoctool%2Ftest-make-doc.js?ref=0c743b5f77a53f278d6d6554e69d2d55ef945f66",
            "patch": "@@ -13,17 +13,16 @@ const path = require('path');\n \n const apiPath = path.resolve(__dirname, '..', '..', 'out', 'doc', 'api');\n const allDocs = fs.readdirSync(apiPath);\n-assert.ok(allDocs.includes('_toc.html'));\n+assert.ok(allDocs.includes('index.html'));\n \n const actualDocs = allDocs.filter(\n   (name) => {\n     const extension = path.extname(name);\n-    return (extension === '.html' || extension === '.json') &&\n-           name !== '_toc.html';\n+    return extension === '.html' || extension === '.json';\n   }\n );\n \n-const toc = fs.readFileSync(path.resolve(apiPath, '_toc.html'), 'utf8');\n+const toc = fs.readFileSync(path.resolve(apiPath, 'index.html'), 'utf8');\n const re = /href=\"([^/]+\\.html)\"/;\n const globalRe = new RegExp(re, 'g');\n const links = toc.match(globalRe);\n@@ -32,8 +31,7 @@ assert.notStrictEqual(links, null);\n // Filter out duplicate links, leave just filenames, add expected JSON files.\n const linkedHtmls = [...new Set(links)].map((link) => link.match(re)[1]);\n const expectedJsons = linkedHtmls\n-                       .map((name) => name.replace('.html', '.json'))\n-                       .concat('_toc.json');\n+                       .map((name) => name.replace('.html', '.json'));\n const expectedDocs = linkedHtmls.concat(expectedJsons);\n \n // Test that all the relative links in the TOC match to the actual documents."
        },
        {
            "sha": "901bf0f1b0bf3b037203e45fcdb5042b1267e1d3",
            "filename": "test/fixtures/doc_with_includes.md",
            "status": "removed",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/1529ef4dc5e4cf99ea964bc1cc47cd62cca17540/test%2Ffixtures%2Fdoc_with_includes.md",
            "raw_url": "https://github.com/nodejs/node/raw/1529ef4dc5e4cf99ea964bc1cc47cd62cca17540/test%2Ffixtures%2Fdoc_with_includes.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fdoc_with_includes.md?ref=1529ef4dc5e4cf99ea964bc1cc47cd62cca17540",
            "patch": "@@ -1,2 +0,0 @@\n-@include doc_inc_1\n-@include doc_inc_2.md"
        },
        {
            "sha": "1c84e13d0ab79cef74ef6fafc5b445448de72352",
            "filename": "tools/doc/allhtml.js",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/0c743b5f77a53f278d6d6554e69d2d55ef945f66/tools%2Fdoc%2Fallhtml.js",
            "raw_url": "https://github.com/nodejs/node/raw/0c743b5f77a53f278d6d6554e69d2d55ef945f66/tools%2Fdoc%2Fallhtml.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fallhtml.js?ref=0c743b5f77a53f278d6d6554e69d2d55ef945f66",
            "patch": "@@ -12,7 +12,7 @@ const htmlFiles = fs.readdirSync(source, 'utf8')\n   .filter((name) => name.includes('.html') && name !== 'all.html');\n \n // Read the table of contents.\n-const toc = fs.readFileSync(source + '/_toc.html', 'utf8');\n+const toc = fs.readFileSync(source + '/index.html', 'utf8');\n \n // Extract (and concatenate) the toc and apicontent from each document.\n let contents = '';\n@@ -47,11 +47,12 @@ for (const link of toc.match(/<a.*?>/g)) {\n   seen[href] = true;\n }\n \n-// Replace various mentions of _toc with all.\n-let all = toc.replace(/_toc\\.html/g, 'all.html')\n-  .replace('_toc.json', 'all.json')\n-  .replace('api-section-_toc', 'api-section-all')\n-  .replace('data-id=\"_toc\"', 'data-id=\"all\"');\n+// Replace various mentions of index with all.\n+let all = toc.replace(/index\\.html/g, 'all.html')\n+  .replace('<a href=\"all.html\" name=\"toc\">', '<a href=\"index.html\" name=\"toc\">')\n+  .replace('index.json', 'all.json')\n+  .replace('api-section-index', 'api-section-all')\n+  .replace('data-id=\"index\"', 'data-id=\"all\"');\n \n // Clean up the title.\n all = all.replace(/<title>.*?\\| /, '<title>');"
        },
        {
            "sha": "7e027f764e7efd486a1519cfff85c91b90e71da1",
            "filename": "tools/doc/alljson.js",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/nodejs/node/blob/0c743b5f77a53f278d6d6554e69d2d55ef945f66/tools%2Fdoc%2Falljson.js",
            "raw_url": "https://github.com/nodejs/node/raw/0c743b5f77a53f278d6d6554e69d2d55ef945f66/tools%2Fdoc%2Falljson.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Falljson.js?ref=0c743b5f77a53f278d6d6554e69d2d55ef945f66",
            "patch": "@@ -0,0 +1,56 @@\n+'use strict';\n+\n+// Build all.json by combining the miscs, modules, classes, globals, and methods\n+// from the generated json files.\n+\n+const fs = require('fs');\n+\n+const source = `${__dirname}/../../out/doc/api`;\n+\n+// Get a list of generated API documents.\n+const jsonFiles = fs.readdirSync(source, 'utf8')\n+  .filter((name) => name.includes('.json') && name !== 'all.json');\n+\n+// Read the table of contents.\n+const toc = fs.readFileSync(source + '/index.html', 'utf8');\n+\n+// Initialize results. Only these four data values will be collected.\n+const results = {\n+  miscs: [],\n+  modules: [],\n+  classes: [],\n+  globals: [],\n+  methods: []\n+};\n+\n+// Identify files that should be skipped. As files are processed, they\n+// are added to this list to prevent dupes.\n+const seen = {\n+  'all.json': true,\n+  'index.json': true\n+};\n+\n+// Extract (and concatenate) the selected data from each document.\n+// Expand hrefs found in json to include source HTML file.\n+for (const link of toc.match(/<a.*?>/g)) {\n+  const href = /href=\"(.*?)\"/.exec(link)[1];\n+  const json = href.replace('.html', '.json');\n+  if (!jsonFiles.includes(json) || seen[json]) continue;\n+  const data = JSON.parse(\n+    fs.readFileSync(source + '/' + json, 'utf8')\n+      .replace(/<a href=\\\\\"#/g, `<a href=\\\\\"${href}#`)\n+  );\n+\n+  for (const property in data) {\n+    if (results.hasOwnProperty(property)) {\n+      results[property].push(...data[property]);\n+    }\n+  }\n+\n+  // Mark source as seen.\n+  seen[json] = true;\n+}\n+\n+// Write results.\n+fs.writeFileSync(source + '/all.json',\n+                 `${JSON.stringify(results, null, 2)}\\n`, 'utf8');"
        },
        {
            "sha": "8ed97610cf3bc28e280f6d93d97c47c21035412e",
            "filename": "tools/doc/generate.js",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/0c743b5f77a53f278d6d6554e69d2d55ef945f66/tools%2Fdoc%2Fgenerate.js",
            "raw_url": "https://github.com/nodejs/node/raw/0c743b5f77a53f278d6d6554e69d2d55ef945f66/tools%2Fdoc%2Fgenerate.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fgenerate.js?ref=0c743b5f77a53f278d6d6554e69d2d55ef945f66",
            "patch": "@@ -21,7 +21,6 @@\n \n 'use strict';\n \n-const processIncludes = require('./preprocess.js');\n const fs = require('fs');\n \n // Parse the args.\n@@ -52,12 +51,6 @@ if (!filename) {\n }\n \n fs.readFile(filename, 'utf8', (er, input) => {\n-  if (er) throw er;\n-  // Process the input for @include lines.\n-  processIncludes(filename, input, next);\n-});\n-\n-function next(er, input) {\n   if (er) throw er;\n   switch (format) {\n     case 'json':\n@@ -78,4 +71,4 @@ function next(er, input) {\n     default:\n       throw new Error(`Invalid format: ${format}`);\n   }\n-}\n+});"
        },
        {
            "sha": "0e254f1203f7a6a06658136ec0e86f1c2a25e2b7",
            "filename": "tools/doc/html.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/0c743b5f77a53f278d6d6554e69d2d55ef945f66/tools%2Fdoc%2Fhtml.js",
            "raw_url": "https://github.com/nodejs/node/raw/0c743b5f77a53f278d6d6554e69d2d55ef945f66/tools%2Fdoc%2Fhtml.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fhtml.js?ref=0c743b5f77a53f278d6d6554e69d2d55ef945f66",
            "patch": "@@ -36,8 +36,8 @@ marked.setOptions({ renderer });\n \n const docPath = path.resolve(__dirname, '..', '..', 'doc');\n \n-const gtocPath = path.join(docPath, 'api', '_toc.md');\n-const gtocMD = fs.readFileSync(gtocPath, 'utf8').replace(/^@\\/\\/.*$/gm, '');\n+const gtocPath = path.join(docPath, 'api', 'index.md');\n+const gtocMD = fs.readFileSync(gtocPath, 'utf8').replace(/^<!--.*?-->/gms, '');\n const gtocHTML = marked(gtocMD).replace(\n   /<a href=\"(.*?)\"/g,\n   (all, href) => `<a class=\"nav-${href.replace('.html', '')"
        },
        {
            "sha": "554af2ccb77ae05d4f0b36ba6c70cd4ec8dc74e2",
            "filename": "tools/doc/preprocess.js",
            "status": "removed",
            "additions": 0,
            "deletions": 38,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/1529ef4dc5e4cf99ea964bc1cc47cd62cca17540/tools%2Fdoc%2Fpreprocess.js",
            "raw_url": "https://github.com/nodejs/node/raw/1529ef4dc5e4cf99ea964bc1cc47cd62cca17540/tools%2Fdoc%2Fpreprocess.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fpreprocess.js?ref=1529ef4dc5e4cf99ea964bc1cc47cd62cca17540",
            "patch": "@@ -1,38 +0,0 @@\n-'use strict';\n-\n-module.exports = processIncludes;\n-\n-const path = require('path');\n-const fs = require('fs');\n-\n-const includeExpr = /^@include\\s+([\\w-]+)(?:\\.md)?$/gmi;\n-const commentExpr = /^@\\/\\/.*$/gm;\n-\n-function processIncludes(inputFile, input, cb) {\n-  const includes = input.match(includeExpr);\n-  if (includes === null)\n-    return cb(null, input.replace(commentExpr, ''));\n-\n-  let errState = null;\n-  let incCount = includes.length;\n-\n-  includes.forEach((include) => {\n-    const fname = include.replace(includeExpr, '$1.md');\n-    const fullFname = path.resolve(path.dirname(inputFile), fname);\n-\n-    fs.readFile(fullFname, 'utf8', function(er, inc) {\n-      if (errState) return;\n-      if (er) return cb(errState = er);\n-      incCount--;\n-\n-      // Add comments to let the HTML generator know\n-      // how the anchors for headings should look like.\n-      inc = `<!-- [start-include:${fname}] -->\\n` +\n-            `${inc}\\n<!-- [end-include:${fname}] -->\\n`;\n-      input = input.split(`${include}\\n`).join(`${inc}\\n`);\n-\n-      if (incCount === 0)\n-        return cb(null, input.replace(commentExpr, ''));\n-    });\n-  });\n-}"
        }
    ],
    "stats": {
        "total": 381,
        "additions": 165,
        "deletions": 216
    }
}