{
    "author": "joyeecheung",
    "message": "console: split console into global.js and constructor.js\n\nSince we do not actually use the Console constructor to\ninstantiate the global console, move the two piece of\ncode into two different JS files for clarity, and make\nconsole.js a mere re-export of the global console.\nThe hope is to make the global console, a namespace, more\nweb-compatible while keeping the Console constructor\navailable for backwards compatibility.\n\nPR-URL: https://github.com/nodejs/node/pull/24709\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "cfc2559ee0807e4c01ad882211792e917c6dba17",
    "files": [
        {
            "sha": "85a89ecc990b8b8491df3922a1eda57a1e12e597",
            "filename": "lib/console.js",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/cfc2559ee0807e4c01ad882211792e917c6dba17/lib%2Fconsole.js",
            "raw_url": "https://github.com/nodejs/node/raw/cfc2559ee0807e4c01ad882211792e917c6dba17/lib%2Fconsole.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fconsole.js?ref=cfc2559ee0807e4c01ad882211792e917c6dba17",
            "patch": "@@ -0,0 +1,24 @@\n+// Copyright Joyent, Inc. and other Node contributors.\n+//\n+// Permission is hereby granted, free of charge, to any person obtaining a\n+// copy of this software and associated documentation files (the\n+// \"Software\"), to deal in the Software without restriction, including\n+// without limitation the rights to use, copy, modify, merge, publish,\n+// distribute, sublicense, and/or sell copies of the Software, and to permit\n+// persons to whom the Software is furnished to do so, subject to the\n+// following conditions:\n+//\n+// The above copyright notice and this permission notice shall be included\n+// in all copies or substantial portions of the Software.\n+//\n+// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n+// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n+// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n+// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n+// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n+// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n+// USE OR OTHER DEALINGS IN THE SOFTWARE.\n+\n+'use strict';\n+\n+module.exports = require('internal/console/global');"
        },
        {
            "sha": "f607bf4648bbff26913997e0525a060adc73259d",
            "filename": "lib/internal/console/constructor.js",
            "status": "modified",
            "additions": 8,
            "deletions": 61,
            "changes": 69,
            "blob_url": "https://github.com/nodejs/node/blob/cfc2559ee0807e4c01ad882211792e917c6dba17/lib%2Finternal%2Fconsole%2Fconstructor.js",
            "raw_url": "https://github.com/nodejs/node/raw/cfc2559ee0807e4c01ad882211792e917c6dba17/lib%2Finternal%2Fconsole%2Fconstructor.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fconsole%2Fconstructor.js?ref=cfc2559ee0807e4c01ad882211792e917c6dba17",
            "patch": "@@ -1,26 +1,8 @@\n-// Copyright Joyent, Inc. and other Node contributors.\n-//\n-// Permission is hereby granted, free of charge, to any person obtaining a\n-// copy of this software and associated documentation files (the\n-// \"Software\"), to deal in the Software without restriction, including\n-// without limitation the rights to use, copy, modify, merge, publish,\n-// distribute, sublicense, and/or sell copies of the Software, and to permit\n-// persons to whom the Software is furnished to do so, subject to the\n-// following conditions:\n-//\n-// The above copyright notice and this permission notice shall be included\n-// in all copies or substantial portions of the Software.\n-//\n-// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n-// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n-// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n-// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n-// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n-// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n-// USE OR OTHER DEALINGS IN THE SOFTWARE.\n-\n 'use strict';\n \n+// The Console constructor is not actually used to construct the global\n+// console. It's exported for backwards compatibility.\n+\n const { trace } = internalBinding('trace_events');\n const {\n   isStackOverflowError,\n@@ -72,8 +54,6 @@ const kBindStreamsLazy = Symbol('kBindStreamsLazy');\n const kUseStdout = Symbol('kUseStdout');\n const kUseStderr = Symbol('kUseStderr');\n \n-// This constructor is not used to construct the global console.\n-// It's exported for backwards compatibility.\n function Console(options /* or: stdout, stderr, ignoreErrors = true */) {\n   // We have to test new.target here to see if this function is called\n   // with new, because we need to define a custom instanceof to accommodate\n@@ -531,41 +511,8 @@ Console.prototype.table = function(tabularData, properties) {\n \n function noop() {}\n \n-// See https://console.spec.whatwg.org/#console-namespace\n-// > For historical web-compatibility reasons, the namespace object\n-// > for console must have as its [[Prototype]] an empty object,\n-// > created as if by ObjectCreate(%ObjectPrototype%),\n-// > instead of %ObjectPrototype%.\n-\n-// Since in Node.js, the Console constructor has been exposed through\n-// require('console'), we need to keep the Console constructor but\n-// we cannot actually use `new Console` to construct the global console.\n-// Therefore, the console.Console.prototype is not\n-// in the global console prototype chain anymore.\n-\n-// TODO(joyeecheung):\n-// - Move the Console constructor into internal/console.js\n-// - Move the global console creation code along with the inspector console\n-//   wrapping code in internal/bootstrap/node.js into a separate file.\n-// - Make this file a simple re-export of those two files.\n-const globalConsole = Object.create({});\n-\n-// Since Console is not on the prototype chain of the global console,\n-// the symbol properties on Console.prototype have to be looked up from\n-// the global console itself. In addition, we need to make the global\n-// console a namespace by binding the console methods directly onto\n-// the global console with the receiver fixed.\n-for (const prop of Reflect.ownKeys(Console.prototype)) {\n-  if (prop === 'constructor') { continue; }\n-  const desc = Reflect.getOwnPropertyDescriptor(Console.prototype, prop);\n-  if (typeof desc.value === 'function') { // fix the receiver\n-    desc.value = desc.value.bind(globalConsole);\n-  }\n-  Reflect.defineProperty(globalConsole, prop, desc);\n-}\n-\n-globalConsole[kBindStreamsLazy](process);\n-globalConsole[kBindProperties](true, 'auto');\n-\n-module.exports = globalConsole;\n-module.exports.Console = Console;\n+module.exports = {\n+  Console,\n+  kBindStreamsLazy,\n+  kBindProperties\n+};"
        },
        {
            "sha": "614941eba6da2de0051644a0c0520a7ee0feeeb2",
            "filename": "lib/internal/console/global.js",
            "status": "added",
            "additions": 44,
            "deletions": 0,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/cfc2559ee0807e4c01ad882211792e917c6dba17/lib%2Finternal%2Fconsole%2Fglobal.js",
            "raw_url": "https://github.com/nodejs/node/raw/cfc2559ee0807e4c01ad882211792e917c6dba17/lib%2Finternal%2Fconsole%2Fglobal.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fconsole%2Fglobal.js?ref=cfc2559ee0807e4c01ad882211792e917c6dba17",
            "patch": "@@ -0,0 +1,44 @@\n+'use strict';\n+\n+// See https://console.spec.whatwg.org/#console-namespace\n+// > For historical web-compatibility reasons, the namespace object\n+// > for console must have as its [[Prototype]] an empty object,\n+// > created as if by ObjectCreate(%ObjectPrototype%),\n+// > instead of %ObjectPrototype%.\n+\n+// Since in Node.js, the Console constructor has been exposed through\n+// require('console'), we need to keep the Console constructor but\n+// we cannot actually use `new Console` to construct the global console.\n+// Therefore, the console.Console.prototype is not\n+// in the global console prototype chain anymore.\n+\n+const {\n+  Console,\n+  kBindStreamsLazy,\n+  kBindProperties\n+} = require('internal/console/constructor');\n+\n+const globalConsole = Object.create({});\n+\n+// Since Console is not on the prototype chain of the global console,\n+// the symbol properties on Console.prototype have to be looked up from\n+// the global console itself. In addition, we need to make the global\n+// console a namespace by binding the console methods directly onto\n+// the global console with the receiver fixed.\n+for (const prop of Reflect.ownKeys(Console.prototype)) {\n+  if (prop === 'constructor') { continue; }\n+  const desc = Reflect.getOwnPropertyDescriptor(Console.prototype, prop);\n+  if (typeof desc.value === 'function') { // fix the receiver\n+    desc.value = desc.value.bind(globalConsole);\n+  }\n+  Reflect.defineProperty(globalConsole, prop, desc);\n+}\n+\n+globalConsole[kBindStreamsLazy](process);\n+globalConsole[kBindProperties](true, 'auto');\n+\n+// This is a legacy feature - the Console constructor is exposed on\n+// the global console instance.\n+globalConsole.Console = Console;\n+\n+module.exports = globalConsole;"
        },
        {
            "sha": "c70a35e02c4debb9a9db94fc2560a1e7f9b6fa30",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/cfc2559ee0807e4c01ad882211792e917c6dba17/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/cfc2559ee0807e4c01ad882211792e917c6dba17/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=cfc2559ee0807e4c01ad882211792e917c6dba17",
            "patch": "@@ -95,6 +95,8 @@\n       'lib/internal/cluster/shared_handle.js',\n       'lib/internal/cluster/utils.js',\n       'lib/internal/cluster/worker.js',\n+      'lib/internal/console/constructor.js',\n+      'lib/internal/console/global.js',\n       'lib/internal/crypto/certificate.js',\n       'lib/internal/crypto/cipher.js',\n       'lib/internal/crypto/diffiehellman.js',"
        },
        {
            "sha": "8f83194cbb1a5260ca809719417b55043b15a7fc",
            "filename": "test/parallel/test-bootstrap-modules.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/cfc2559ee0807e4c01ad882211792e917c6dba17/test%2Fparallel%2Ftest-bootstrap-modules.js",
            "raw_url": "https://github.com/nodejs/node/raw/cfc2559ee0807e4c01ad882211792e917c6dba17/test%2Fparallel%2Ftest-bootstrap-modules.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-bootstrap-modules.js?ref=cfc2559ee0807e4c01ad882211792e917c6dba17",
            "patch": "@@ -9,7 +9,7 @@ const common = require('../common');\n const assert = require('assert');\n \n const isMainThread = common.isMainThread;\n-const kMaxModuleCount = isMainThread ? 56 : 78;\n+const kMaxModuleCount = isMainThread ? 58 : 80;\n \n assert(list.length <= kMaxModuleCount,\n        `Total length: ${list.length}\\n` + list.join('\\n')"
        }
    ],
    "stats": {
        "total": 141,
        "additions": 79,
        "deletions": 62
    }
}