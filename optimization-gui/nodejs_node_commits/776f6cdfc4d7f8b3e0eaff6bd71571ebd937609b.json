{
    "author": "joyeecheung",
    "message": "fs: throw errors from fs.unlinkSync in JS\n\nPR-URL: https://github.com/nodejs/node/pull/18348\nRefs: https://github.com/nodejs/node/issues/18106\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "776f6cdfc4d7f8b3e0eaff6bd71571ebd937609b",
    "files": [
        {
            "sha": "d4f5ee0909bcef90537da3eee74679d7c722efa0",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/776f6cdfc4d7f8b3e0eaff6bd71571ebd937609b/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/776f6cdfc4d7f8b3e0eaff6bd71571ebd937609b/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=776f6cdfc4d7f8b3e0eaff6bd71571ebd937609b",
            "patch": "@@ -1328,7 +1328,11 @@ fs.unlinkSync = function(path) {\n   handleError((path = getPathFromURL(path)));\n   nullCheck(path);\n   validatePath(path);\n-  return binding.unlink(pathModule.toNamespacedPath(path));\n+  const ctx = { path };\n+  binding.unlink(pathModule.toNamespacedPath(path), undefined, ctx);\n+  if (ctx.errno !== undefined) {\n+    throw new errors.uvException(ctx);\n+  }\n };\n \n fs.fchmod = function(fd, mode, callback) {"
        },
        {
            "sha": "93f54aed23f7284c660cc2b234f889bd1b67e968",
            "filename": "src/node_file.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 5,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/776f6cdfc4d7f8b3e0eaff6bd71571ebd937609b/src%2Fnode_file.cc",
            "raw_url": "https://github.com/nodejs/node/raw/776f6cdfc4d7f8b3e0eaff6bd71571ebd937609b/src%2Fnode_file.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.cc?ref=776f6cdfc4d7f8b3e0eaff6bd71571ebd937609b",
            "patch": "@@ -777,17 +777,21 @@ static void Fsync(const FunctionCallbackInfo<Value>& args) {\n static void Unlink(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  CHECK_GE(args.Length(), 1);\n+  const int argc = args.Length();\n+  CHECK_GE(argc, 2);\n \n   BufferValue path(env->isolate(), args[0]);\n   CHECK_NE(*path, nullptr);\n \n-  if (args[1]->IsObject()) {\n-    CHECK_EQ(args.Length(), 2);\n+  if (args[1]->IsObject()) {  // unlink(fd, req)\n+    CHECK_EQ(argc, 2);\n     AsyncCall(env, args, \"unlink\", UTF8, AfterNoArgs,\n               uv_fs_unlink, *path);\n-  } else {\n-    SYNC_CALL(unlink, *path, *path)\n+  } else {  // unlink(fd, undefined, ctx)\n+    CHECK_EQ(argc, 3);\n+    fs_req_wrap req_wrap;\n+    SyncCall(env, args[2], &req_wrap, \"unlink\",\n+             uv_fs_unlink, *path);\n   }\n }\n "
        }
    ],
    "stats": {
        "total": 20,
        "additions": 14,
        "deletions": 6
    }
}