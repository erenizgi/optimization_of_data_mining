{
    "author": "addaleax",
    "message": "src: remove `kFlagNoShutdown` flag\n\nThis was originally introduced in 3446ff417ba1e, in order to fix\na hard crash. However, since the libuv 1.18.0 update, that hard\ncrash is gone, and since f2b9805f85d3f we do not throw an\nerror in JS land anymore either, rendering the flag unnecessary.\n\nAlso, the original test that checked this condition was added\nto `test/parallel/`. Since that typically runs without a TTY stdin,\na duplicate test is being added to the pseudo-tty test suite\nin this commit.\n\nRefs: https://github.com/nodejs/node/commit/3446ff417ba1e11d35d1661b8788eac5af029360\nRefs: https://github.com/nodejs/node/commit/f2b9805f85d3ff770892b37944a0890e0e60ca78\nRefs: https://github.com/libuv/libuv/commit/0e2814179c9903423d058b095e84f48fcfb8f3d1\nPR-URL: https://github.com/nodejs/node/pull/20388\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>",
    "sha": "5512fff623658bffffb5ef692c57224802545664",
    "files": [
        {
            "sha": "4f4252073d26b531012df3caad6759040b2b8306",
            "filename": "src/stream_base-inl.h",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/5512fff623658bffffb5ef692c57224802545664/src%2Fstream_base-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/5512fff623658bffffb5ef692c57224802545664/src%2Fstream_base-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_base-inl.h?ref=5512fff623658bffffb5ef692c57224802545664",
            "patch": "@@ -335,8 +335,7 @@ void StreamBase::AddMethods(Environment* env,\n \n   env->SetProtoMethod(t, \"readStart\", JSMethod<Base, &StreamBase::ReadStartJS>);\n   env->SetProtoMethod(t, \"readStop\", JSMethod<Base, &StreamBase::ReadStopJS>);\n-  if ((flags & kFlagNoShutdown) == 0)\n-    env->SetProtoMethod(t, \"shutdown\", JSMethod<Base, &StreamBase::Shutdown>);\n+  env->SetProtoMethod(t, \"shutdown\", JSMethod<Base, &StreamBase::Shutdown>);\n   if ((flags & kFlagHasWritev) != 0)\n     env->SetProtoMethod(t, \"writev\", JSMethod<Base, &StreamBase::Writev>);\n   env->SetProtoMethod(t,"
        },
        {
            "sha": "94a091988cfcf9cbf268e9bde8082d09e2f84bb6",
            "filename": "src/stream_base.h",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/5512fff623658bffffb5ef692c57224802545664/src%2Fstream_base.h",
            "raw_url": "https://github.com/nodejs/node/raw/5512fff623658bffffb5ef692c57224802545664/src%2Fstream_base.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_base.h?ref=5512fff623658bffffb5ef692c57224802545664",
            "patch": "@@ -257,8 +257,7 @@ class StreamBase : public StreamResource {\n  public:\n   enum Flags {\n     kFlagNone = 0x0,\n-    kFlagHasWritev = 0x1,\n-    kFlagNoShutdown = 0x2\n+    kFlagHasWritev = 0x1\n   };\n \n   template <class Base>"
        },
        {
            "sha": "c5abc6bf9b9b912a540b2b77cecc079fb44d23fa",
            "filename": "src/tty_wrap.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/5512fff623658bffffb5ef692c57224802545664/src%2Ftty_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/5512fff623658bffffb5ef692c57224802545664/src%2Ftty_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftty_wrap.cc?ref=5512fff623658bffffb5ef692c57224802545664",
            "patch": "@@ -61,7 +61,7 @@ void TTYWrap::Initialize(Local<Object> target,\n   env->SetProtoMethod(t, \"ref\", HandleWrap::Ref);\n   env->SetProtoMethod(t, \"hasRef\", HandleWrap::HasRef);\n \n-  LibuvStreamWrap::AddMethods(env, t, StreamBase::kFlagNoShutdown);\n+  LibuvStreamWrap::AddMethods(env, t);\n \n   env->SetProtoMethod(t, \"getWindowSize\", TTYWrap::GetWindowSize);\n   env->SetProtoMethod(t, \"setRawMode\", SetRawMode);"
        },
        {
            "sha": "c78f58446d03e900d071f876d6147452cb93bce7",
            "filename": "test/pseudo-tty/test-tty-stdin-end.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/5512fff623658bffffb5ef692c57224802545664/test%2Fpseudo-tty%2Ftest-tty-stdin-end.js",
            "raw_url": "https://github.com/nodejs/node/raw/5512fff623658bffffb5ef692c57224802545664/test%2Fpseudo-tty%2Ftest-tty-stdin-end.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-tty-stdin-end.js?ref=5512fff623658bffffb5ef692c57224802545664",
            "patch": "@@ -0,0 +1,7 @@\n+'use strict';\n+require('../common');\n+\n+// This test ensures that Node.js doesn't crash on `process.stdin.emit(\"end\")`.\n+// https://github.com/nodejs/node/issues/1068\n+\n+process.stdin.emit('end');"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "test/pseudo-tty/test-tty-stdin-end.out",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/nodejs/node/blob/5512fff623658bffffb5ef692c57224802545664/test%2Fpseudo-tty%2Ftest-tty-stdin-end.out",
            "raw_url": "https://github.com/nodejs/node/raw/5512fff623658bffffb5ef692c57224802545664/test%2Fpseudo-tty%2Ftest-tty-stdin-end.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-tty-stdin-end.out?ref=5512fff623658bffffb5ef692c57224802545664"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 10,
        "deletions": 5
    }
}