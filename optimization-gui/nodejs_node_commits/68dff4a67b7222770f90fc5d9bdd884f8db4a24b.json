{
    "author": "unknown",
    "message": "child_process: allow typed arrays for input\n\ndoc:    Update child_process docs, stating typed arrays are allowed.\nerror:  Update error message for `ERR_INVALID_SYNC_FORK_INPUT`\nlib:    Use isArrayBufferView instead of isUint8Array\ntest:   Update test-child-process-spawnsync-input to test for all\n        typed arrays and data view.\n\nPR-URL: https://github.com/nodejs/node/pull/22409\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "68dff4a67b7222770f90fc5d9bdd884f8db4a24b",
    "files": [
        {
            "sha": "e15829ce3ffccf9d00da1efe87a946349f62db9a",
            "filename": "doc/api/child_process.md",
            "status": "modified",
            "additions": 21,
            "deletions": 6,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/doc%2Fapi%2Fchild_process.md",
            "raw_url": "https://github.com/nodejs/node/raw/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/doc%2Fapi%2Fchild_process.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fchild_process.md?ref=68dff4a67b7222770f90fc5d9bdd884f8db4a24b",
            "patch": "@@ -688,6 +688,10 @@ configuration at startup.\n <!-- YAML\n added: v0.11.12\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/22409\n+    description: The `input` option can now be any `TypedArray` or a\n+                 `DataView`.\n   - version: REPLACEME\n     pr-url: https://github.com/nodejs/node/pull/21316\n     description: The `windowsHide` option now defaults to `true`.\n@@ -706,8 +710,9 @@ changes:\n * `args` {string[]} List of string arguments.\n * `options` {Object}\n   * `cwd` {string} Current working directory of the child process.\n-  * `input` {string|Buffer|Uint8Array} The value which will be passed as stdin\n-    to the spawned process. Supplying this value will override `stdio[0]`.\n+  * `input` {string|Buffer|TypedArray|DataView} The value which will be passed\n+    as stdin to the spawned process. Supplying this value will override\n+    `stdio[0]`.\n   * `stdio` {string|Array} Child's stdio configuration. `stderr` by default will\n     be output to the parent process' stderr unless `stdio` is specified.\n     **Default:** `'pipe'`.\n@@ -753,6 +758,10 @@ arbitrary command execution.**\n <!-- YAML\n added: v0.11.12\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/22409\n+    description: The `input` option can now be any `TypedArray` or a\n+                 `DataView`.\n   - version: REPLACEME\n     pr-url: https://github.com/nodejs/node/pull/21316\n     description: The `windowsHide` option now defaults to `true`.\n@@ -767,8 +776,9 @@ changes:\n * `command` {string} The command to run.\n * `options` {Object}\n   * `cwd` {string} Current working directory of the child process.\n-  * `input` {string|Buffer|Uint8Array} The value which will be passed as stdin\n-    to the spawned process. Supplying this value will override `stdio[0]`.\n+  * `input` {string|Buffer|TypedArray|DataView} The value which will be passed\n+    as stdin to the spawned process. Supplying this value will override\n+    `stdio[0]`.\n   * `stdio` {string|Array} Child's stdio configuration. `stderr` by default will\n     be output to the parent process' stderr unless `stdio` is specified.\n     **Default:** `'pipe'`.\n@@ -810,6 +820,10 @@ metacharacters may be used to trigger arbitrary command execution.**\n <!-- YAML\n added: v0.11.12\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/22409\n+    description: The `input` option can now be any `TypedArray` or a\n+                 `DataView`.\n   - version: REPLACEME\n     pr-url: https://github.com/nodejs/node/pull/21316\n     description: The `windowsHide` option now defaults to `true`.\n@@ -831,8 +845,9 @@ changes:\n * `args` {string[]} List of string arguments.\n * `options` {Object}\n   * `cwd` {string} Current working directory of the child process.\n-  * `input` {string|Buffer|Uint8Array} The value which will be passed as stdin\n-    to the spawned process. Supplying this value will override `stdio[0]`.\n+  * `input` {string|Buffer|TypedArray|DataView} The value which will be passed\n+    as stdin to the spawned process. Supplying this value will override\n+    `stdio[0]`.\n   * `argv0` {string} Explicitly set the value of `argv[0]` sent to the child\n     process. This will be set to `command` if not specified.\n   * `stdio` {string|Array} Child's stdio configuration."
        },
        {
            "sha": "62aa1ab4d1688bdb0ac940c04ee4c83b4d36ed73",
            "filename": "doc/api/errors.md",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/doc%2Fapi%2Ferrors.md",
            "raw_url": "https://github.com/nodejs/node/raw/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/doc%2Fapi%2Ferrors.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ferrors.md?ref=68dff4a67b7222770f90fc5d9bdd884f8db4a24b",
            "patch": "@@ -1249,8 +1249,8 @@ For example when a function is expected to return a promise.\n <a id=\"ERR_INVALID_SYNC_FORK_INPUT\"></a>\n ### ERR_INVALID_SYNC_FORK_INPUT\n \n-A `Buffer`, `Uint8Array` or `string` was provided as stdio input to a\n-synchronous fork. See the documentation for the [`child_process`][] module\n+A `Buffer`, `TypedArray`, `DataView` or `string` was provided as stdio input to\n+an asynchronous fork. See the documentation for the [`child_process`][] module\n for more information.\n \n <a id=\"ERR_INVALID_THIS\"></a>"
        },
        {
            "sha": "1ab4150b01e659c70ed5b8395cd07b9bc4ee3ca5",
            "filename": "lib/child_process.js",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/lib%2Fchild_process.js",
            "raw_url": "https://github.com/nodejs/node/raw/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/lib%2Fchild_process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fchild_process.js?ref=68dff4a67b7222770f90fc5d9bdd884f8db4a24b",
            "patch": "@@ -25,7 +25,7 @@ const util = require('util');\n const {\n   deprecate, convertToValidSignal, getSystemErrorName\n } = require('internal/util');\n-const { isUint8Array } = require('internal/util/types');\n+const { isArrayBufferView } = require('internal/util/types');\n const debug = util.debuglog('child_process');\n const { Buffer } = require('buffer');\n const { Pipe, constants: PipeConstants } = process.binding('pipe_wrap');\n@@ -572,13 +572,16 @@ function spawnSync(/* file, args, options */) {\n     var input = options.stdio[i] && options.stdio[i].input;\n     if (input != null) {\n       var pipe = options.stdio[i] = util._extend({}, options.stdio[i]);\n-      if (isUint8Array(input)) {\n+      if (isArrayBufferView(input)) {\n         pipe.input = input;\n       } else if (typeof input === 'string') {\n         pipe.input = Buffer.from(input, options.encoding);\n       } else {\n         throw new ERR_INVALID_ARG_TYPE(`options.stdio[${i}]`,\n-                                       ['Buffer', 'Uint8Array', 'string'],\n+                                       ['Buffer',\n+                                        'TypedArray',\n+                                        'DataView',\n+                                        'string'],\n                                        input);\n       }\n     }"
        },
        {
            "sha": "4b321011ca454c6a874bb3f742657c8f35eb7e2f",
            "filename": "lib/internal/child_process.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/lib%2Finternal%2Fchild_process.js",
            "raw_url": "https://github.com/nodejs/node/raw/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/lib%2Finternal%2Fchild_process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fchild_process.js?ref=68dff4a67b7222770f90fc5d9bdd884f8db4a24b",
            "patch": "@@ -32,7 +32,7 @@ const { UDP } = process.binding('udp_wrap');\n const SocketList = require('internal/socket_list');\n const { owner_symbol } = require('internal/async_hooks').symbols;\n const { convertToValidSignal } = require('internal/util');\n-const { isUint8Array } = require('internal/util/types');\n+const { isArrayBufferView } = require('internal/util/types');\n const spawn_sync = process.binding('spawn_sync');\n const { HTTPParser } = internalBinding('http_parser');\n const { freeParser } = require('_http_common');\n@@ -928,7 +928,7 @@ function _validateStdio(stdio, sync) {\n         wrapType: getHandleWrapType(handle),\n         handle: handle\n       });\n-    } else if (isUint8Array(stdio) || typeof stdio === 'string') {\n+    } else if (isArrayBufferView(stdio) || typeof stdio === 'string') {\n       if (!sync) {\n         cleanup();\n         throw new ERR_INVALID_SYNC_FORK_INPUT(util.inspect(stdio));"
        },
        {
            "sha": "cc1e84639eb0ebd9c87c6be4aa1e43b2ead253e3",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=68dff4a67b7222770f90fc5d9bdd884f8db4a24b",
            "patch": "@@ -712,7 +712,8 @@ E('ERR_INVALID_RETURN_VALUE', (input, name, value) => {\n          ` function but got ${type}.`;\n }, TypeError);\n E('ERR_INVALID_SYNC_FORK_INPUT',\n-  'Asynchronous forks do not support Buffer, Uint8Array or string input: %s',\n+  'Asynchronous forks do not support ' +\n+    'Buffer, TypedArray, DataView or string input: %s',\n   TypeError);\n E('ERR_INVALID_THIS', 'Value of \"this\" must be of type %s', TypeError);\n E('ERR_INVALID_TUPLE', '%s must be an iterable %s tuple', TypeError);"
        },
        {
            "sha": "6e4a22c0e32d977451c4fe8eeab105a0948db55e",
            "filename": "test/parallel/test-child-process-spawnsync-input.js",
            "status": "modified",
            "additions": 13,
            "deletions": 8,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/test%2Fparallel%2Ftest-child-process-spawnsync-input.js",
            "raw_url": "https://github.com/nodejs/node/raw/68dff4a67b7222770f90fc5d9bdd884f8db4a24b/test%2Fparallel%2Ftest-child-process-spawnsync-input.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-child-process-spawnsync-input.js?ref=68dff4a67b7222770f90fc5d9bdd884f8db4a24b",
            "patch": "@@ -100,16 +100,21 @@ checkSpawnSyncRet(ret);\n assert.deepStrictEqual(ret.stdout, options.input);\n assert.deepStrictEqual(ret.stderr, Buffer.from(''));\n \n-options = {\n-  input: Uint8Array.from(Buffer.from('hello world'))\n-};\n+// common.getArrayBufferViews expects a buffer\n+// with length an multiple of 8\n+const msgBuf = Buffer.from('hello world'.repeat(8));\n+for (const arrayBufferView of common.getArrayBufferViews(msgBuf)) {\n+  options = {\n+    input: arrayBufferView\n+  };\n \n-ret = spawnSync('cat', [], options);\n+  ret = spawnSync('cat', [], options);\n \n-checkSpawnSyncRet(ret);\n-// Wrap options.input because Uint8Array and Buffer have different prototypes.\n-assert.deepStrictEqual(ret.stdout, Buffer.from(options.input));\n-assert.deepStrictEqual(ret.stderr, Buffer.from(''));\n+  checkSpawnSyncRet(ret);\n+\n+  assert.deepStrictEqual(ret.stdout, msgBuf);\n+  assert.deepStrictEqual(ret.stderr, Buffer.from(''));\n+}\n \n verifyBufOutput(spawnSync(process.execPath, args));\n "
        }
    ],
    "stats": {
        "total": 68,
        "additions": 46,
        "deletions": 22
    }
}