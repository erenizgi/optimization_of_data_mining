{
    "author": "addaleax",
    "message": "zlib: move, rename, document internal params() cb\n\nGive the callback a more specific name, explain what it does\nand why it is necessary, and move it to a location much closer\nto its use site.\n\nPR-URL: https://github.com/nodejs/node/pull/23187\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "c0c58d5660aeea93c492877894f66dd55771be2e",
    "files": [
        {
            "sha": "6fb7696849529db2d98ee674da15860b46819b0d",
            "filename": "lib/zlib.js",
            "status": "modified",
            "additions": 16,
            "deletions": 12,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/c0c58d5660aeea93c492877894f66dd55771be2e/lib%2Fzlib.js",
            "raw_url": "https://github.com/nodejs/node/raw/c0c58d5660aeea93c492877894f66dd55771be2e/lib%2Fzlib.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fzlib.js?ref=c0c58d5660aeea93c492877894f66dd55771be2e",
            "patch": "@@ -156,17 +156,6 @@ function zlibOnError(message, errno) {\n   self.emit('error', error);\n }\n \n-function flushCallback(level, strategy, callback) {\n-  if (!this._handle)\n-    assert(false, 'zlib binding closed');\n-  this._handle.params(level, strategy);\n-  if (!this._hadError) {\n-    this._level = level;\n-    this._strategy = strategy;\n-    if (callback) callback();\n-  }\n-}\n-\n // 1. Returns false for undefined and NaN\n // 2. Returns true for finite numbers\n // 3. Throws ERR_INVALID_ARG_TYPE for non-numbers\n@@ -352,13 +341,28 @@ Object.defineProperty(Zlib.prototype, 'bytesRead', {\n   }\n });\n \n+// This callback is used by `.params()` to wait until a full flush happened\n+// before adjusting the parameters. In particular, the call to the native\n+// `params()` function should not happen while a write is currently in progress\n+// on the threadpool.\n+function paramsAfterFlushCallback(level, strategy, callback) {\n+  if (!this._handle)\n+    assert(false, 'zlib binding closed');\n+  this._handle.params(level, strategy);\n+  if (!this._hadError) {\n+    this._level = level;\n+    this._strategy = strategy;\n+    if (callback) callback();\n+  }\n+}\n+\n Zlib.prototype.params = function params(level, strategy, callback) {\n   checkRangesOrGetDefault(level, 'level', Z_MIN_LEVEL, Z_MAX_LEVEL);\n   checkRangesOrGetDefault(strategy, 'strategy', Z_DEFAULT_STRATEGY, Z_FIXED);\n \n   if (this._level !== level || this._strategy !== strategy) {\n     this.flush(Z_SYNC_FLUSH,\n-               flushCallback.bind(this, level, strategy, callback));\n+               paramsAfterFlushCallback.bind(this, level, strategy, callback));\n   } else {\n     process.nextTick(callback);\n   }"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 16,
        "deletions": 12
    }
}