{
    "author": "raoofha",
    "message": "lib: add escapeCodeTimeout as an option to createInterface\n\nPR-URL: https://github.com/nodejs/node/pull/19780\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "c82920214bc03857061b47fe6bee3b21933eabe8",
    "files": [
        {
            "sha": "3d00e4ec64351dec0bb6e46481edafbf85f74d78",
            "filename": "doc/api/readline.md",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/c82920214bc03857061b47fe6bee3b21933eabe8/doc%2Fapi%2Freadline.md",
            "raw_url": "https://github.com/nodejs/node/raw/c82920214bc03857061b47fe6bee3b21933eabe8/doc%2Fapi%2Freadline.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Freadline.md?ref=c82920214bc03857061b47fe6bee3b21933eabe8",
            "patch": "@@ -375,6 +375,11 @@ changes:\n   * `removeHistoryDuplicates` {boolean} If `true`, when a new input line added\n     to the history list duplicates an older one, this removes the older line\n     from the list. **Default:** `false`.\n+  * `escapeCodeTimeout` {number} The duration `readline` will wait for a\n+    character (when reading an ambiguous key sequence in milliseconds one that\n+    can both form a complete key sequence using the input read so far and can\n+    take additional input to complete a longer key sequence).\n+    **Default:** `500`.\n \n The `readline.createInterface()` method creates a new `readline.Interface`\n instance."
        },
        {
            "sha": "4eeefb227ca74643616955429a61553a65a4a991",
            "filename": "lib/readline.js",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/c82920214bc03857061b47fe6bee3b21933eabe8/lib%2Freadline.js",
            "raw_url": "https://github.com/nodejs/node/raw/c82920214bc03857061b47fe6bee3b21933eabe8/lib%2Freadline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Freadline.js?ref=c82920214bc03857061b47fe6bee3b21933eabe8",
            "patch": "@@ -82,6 +82,7 @@ function Interface(input, output, completer, terminal) {\n   this.isCompletionEnabled = true;\n   this._sawKeyPress = false;\n   this._previousKey = null;\n+  this.escapeCodeTimeout = ESCAPE_CODE_TIMEOUT;\n \n   EventEmitter.call(this);\n   var historySize;\n@@ -99,6 +100,16 @@ function Interface(input, output, completer, terminal) {\n     if (input.prompt !== undefined) {\n       prompt = input.prompt;\n     }\n+    if (input.escapeCodeTimeout !== undefined) {\n+      if (Number.isFinite(input.escapeCodeTimeout)) {\n+        this.escapeCodeTimeout = input.escapeCodeTimeout;\n+      } else {\n+        throw new ERR_INVALID_OPT_VALUE(\n+          'escapeCodeTimeout',\n+          this.escapeCodeTimeout\n+        );\n+      }\n+    }\n     crlfDelay = input.crlfDelay;\n     input = input.input;\n   }\n@@ -131,7 +142,6 @@ function Interface(input, output, completer, terminal) {\n   this.removeHistoryDuplicates = !!removeHistoryDuplicates;\n   this.crlfDelay = crlfDelay ?\n     Math.max(kMincrlfDelay, crlfDelay) : kMincrlfDelay;\n-\n   // Check arity, 2 - for async, 1 for sync\n   if (typeof completer === 'function') {\n     this.completer = completer.length === 2 ?\n@@ -1020,7 +1030,10 @@ function emitKeypressEvents(stream, iface) {\n             stream[ESCAPE_DECODER].next(r[i]);\n             // Escape letter at the tail position\n             if (r[i] === kEscape && i + 1 === r.length) {\n-              timeoutId = setTimeout(escapeCodeTimeout, ESCAPE_CODE_TIMEOUT);\n+              timeoutId = setTimeout(\n+                escapeCodeTimeout,\n+                iface ? iface.escapeCodeTimeout : ESCAPE_CODE_TIMEOUT\n+              );\n             }\n           } catch (err) {\n             // if the generator throws (it could happen in the `keypress`"
        },
        {
            "sha": "0e25423e8550c032279f49bed6a0cf955115f418",
            "filename": "test/parallel/test-readline-interface-escapecodetimeout.js",
            "status": "added",
            "additions": 46,
            "deletions": 0,
            "changes": 46,
            "blob_url": "https://github.com/nodejs/node/blob/c82920214bc03857061b47fe6bee3b21933eabe8/test%2Fparallel%2Ftest-readline-interface-escapecodetimeout.js",
            "raw_url": "https://github.com/nodejs/node/raw/c82920214bc03857061b47fe6bee3b21933eabe8/test%2Fparallel%2Ftest-readline-interface-escapecodetimeout.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-readline-interface-escapecodetimeout.js?ref=c82920214bc03857061b47fe6bee3b21933eabe8",
            "patch": "@@ -0,0 +1,46 @@\n+'use strict';\n+const common = require('../common');\n+\n+// This test ensures that the escapeCodeTimeout option set correctly\n+\n+const assert = require('assert');\n+const readline = require('readline');\n+const EventEmitter = require('events').EventEmitter;\n+\n+class FakeInput extends EventEmitter {\n+  resume() {}\n+  pause() {}\n+  write() {}\n+  end() {}\n+}\n+\n+{\n+  const fi = new FakeInput();\n+  const rli = new readline.Interface({\n+    input: fi,\n+    output: fi,\n+    escapeCodeTimeout: 50\n+  });\n+  assert.strictEqual(rli.escapeCodeTimeout, 50);\n+  rli.close();\n+}\n+\n+[\n+  null,\n+  {},\n+  NaN,\n+  '50'\n+].forEach((invalidInput) => {\n+  common.expectsError(() => {\n+    const fi = new FakeInput();\n+    const rli = new readline.Interface({\n+      input: fi,\n+      output: fi,\n+      escapeCodeTimeout: invalidInput\n+    });\n+    rli.close();\n+  }, {\n+    type: TypeError,\n+    code: 'ERR_INVALID_OPT_VALUE'\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 68,
        "additions": 66,
        "deletions": 2
    }
}