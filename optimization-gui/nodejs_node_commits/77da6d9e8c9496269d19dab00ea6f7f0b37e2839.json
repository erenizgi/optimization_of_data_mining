{
    "author": "danbev",
    "message": "build: add crypto check to build targets\n\nCurrently when configured without-ssl the build will fail when trying\nto run the tools/doc/node_modules, and .docbuildstamp make targets:\n\ninternal/util.js:97\n    throw new ERR_NO_CRYPTO();\n    ^\nError [ERR_NO_CRYPTO]: Node.js is not compiled with OpenSSL crypto\n                       support\n    at assertCrypto (internal/util.js:97:11)\n    at crypto.js:31:1\n    ...\n    at Object.<anonymous>\n       (/node/deps/npm/node_modules/uuid/lib/rng.js:4:14)\n    at Module._compile (internal/modules/cjs/loader.js:689:30)\n    ...\nmake[1]: *** [tools/doc/node_modules] Error 1\n\nThis commit adds crypto check to these targets to allow the build to\npass.\n\nPR-URL: https://github.com/nodejs/node/pull/22148\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "77da6d9e8c9496269d19dab00ea6f7f0b37e2839",
    "files": [
        {
            "sha": "0869a8067b503ffe173e87df9c2f88cb1b6396de",
            "filename": "Makefile",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/77da6d9e8c9496269d19dab00ea6f7f0b37e2839/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/77da6d9e8c9496269d19dab00ea6f7f0b37e2839/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=77da6d9e8c9496269d19dab00ea6f7f0b37e2839",
            "patch": "@@ -320,10 +320,16 @@ ifeq ($(OSTYPE),aix)\n DOCBUILDSTAMP_PREREQS := $(DOCBUILDSTAMP_PREREQS) out/$(BUILDTYPE)/node.exp\n endif\n \n+node_use_openssl = $(shell $(call available-node,\"-p\" \\\n+\t\t   \"process.versions.openssl != undefined\"))\n test/addons/.docbuildstamp: $(DOCBUILDSTAMP_PREREQS) tools/doc/node_modules\n+ifeq ($(node_use_openssl),true)\n \t$(RM) -r test/addons/??_*/\n \t[ -x $(NODE) ] && $(NODE) $< || node $<\n \ttouch $@\n+else\n+\t@echo \"Skipping .docbuildstamp (no crypto)\"\n+endif\n \n ADDONS_BINDING_GYPS := \\\n \t$(filter-out test/addons/??_*/binding.gyp, \\\n@@ -1062,15 +1068,17 @@ lint-md-build: tools/remark-cli/node_modules \\\n \n .PHONY: tools/doc/node_modules\n tools/doc/node_modules:\n-\t@cd tools/doc && $(call available-node,$(run-npm-install))\n+ifeq ($(node_use_openssl),true)\n+\tcd tools/doc && $(call available-node,$(run-npm-install))\n+else\n+\t@echo \"Skipping tools/doc/node_modules (no crypto)\"\n+endif\n \n .PHONY: lint-md\n ifneq (\"\",\"$(wildcard tools/remark-cli/node_modules/)\")\n \n LINT_MD_DOC_FILES = $(shell ls doc/*.md doc/**/*.md)\n run-lint-doc-md = tools/remark-cli/cli.js -q -f $(LINT_MD_DOC_FILES)\n-node_use_openssl = $(shell $(call available-node,\"-p\" \\\n-\t\t   \"process.versions.openssl != undefined\"))\n # Lint all changed markdown files under doc/\n tools/.docmdlintstamp: $(LINT_MD_DOC_FILES)\n ifeq ($(node_use_openssl),true)"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 11,
        "deletions": 3
    }
}