{
    "author": "addaleax",
    "message": "fs,net: standardize `pending` stream property\n\nUse the same property name as http2 does to indicate that\nthe stream is in the state before the `ready` event is emitted.\n\nPR-URL: https://github.com/nodejs/node/pull/24067\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "0e06b350b6d7c80875321531593efc6f273620e5",
    "files": [
        {
            "sha": "38e5e4e6260d6d030440bd7c9dcd12f65bf228bb",
            "filename": "doc/api/fs.md",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/0e06b350b6d7c80875321531593efc6f273620e5/doc%2Fapi%2Ffs.md",
            "raw_url": "https://github.com/nodejs/node/raw/0e06b350b6d7c80875321531593efc6f273620e5/doc%2Fapi%2Ffs.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ffs.md?ref=0e06b350b6d7c80875321531593efc6f273620e5",
            "patch": "@@ -488,6 +488,16 @@ argument to `fs.createReadStream()`. If `path` is passed as a string, then\n `readStream.path` will be a string. If `path` is passed as a `Buffer`, then\n `readStream.path` will be a `Buffer`.\n \n+### readStream.pending\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+* {boolean}\n+\n+This property is `true` if the underlying file has not been opened yet,\n+i.e. before the `'ready'` event is emitted.\n+\n ## Class: fs.Stats\n <!-- YAML\n added: v0.1.21\n@@ -833,6 +843,16 @@ argument to [`fs.createWriteStream()`][]. If `path` is passed as a string, then\n `writeStream.path` will be a string. If `path` is passed as a `Buffer`, then\n `writeStream.path` will be a `Buffer`.\n \n+### writeStream.pending\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+* {boolean}\n+\n+This property is `true` if the underlying file has not been opened yet,\n+i.e. before the `'ready'` event is emitted.\n+\n ## fs.access(path[, mode], callback)\n <!-- YAML\n added: v0.11.15"
        },
        {
            "sha": "2ce807ec774f6e5fb71eea2fd007c80f79ff1973",
            "filename": "doc/api/net.md",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/0e06b350b6d7c80875321531593efc6f273620e5/doc%2Fapi%2Fnet.md",
            "raw_url": "https://github.com/nodejs/node/raw/0e06b350b6d7c80875321531593efc6f273620e5/doc%2Fapi%2Fnet.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fnet.md?ref=0e06b350b6d7c80875321531593efc6f273620e5",
            "patch": "@@ -724,6 +724,17 @@ The numeric representation of the local port. For example, `80` or `21`.\n Pauses the reading of data. That is, [`'data'`][] events will not be emitted.\n Useful to throttle back an upload.\n \n+### socket.pending\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+* {boolean}\n+\n+This is `true` if the socket is not connected yet, either because `.connect()`\n+has not yet been called or because it is still in the process of connecting\n+(see [`socket.connecting`][]).\n+\n ### socket.ref()\n <!-- YAML\n added: v0.9.1\n@@ -1167,6 +1178,7 @@ Returns `true` if input is a version 6 IP address, otherwise returns `false`.\n [`socket.connect(options)`]: #net_socket_connect_options_connectlistener\n [`socket.connect(path)`]: #net_socket_connect_path_connectlistener\n [`socket.connect(port, host)`]: #net_socket_connect_port_host_connectlistener\n+[`socket.connecting`]: #net_socket_connecting\n [`socket.destroy()`]: #net_socket_destroy_exception\n [`socket.end()`]: #net_socket_end_data_encoding_callback\n [`socket.pause()`]: #net_socket_pause"
        },
        {
            "sha": "8c9ed35f81c2f4dd547872784b74da243844a3d9",
            "filename": "lib/internal/fs/streams.js",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/0e06b350b6d7c80875321531593efc6f273620e5/lib%2Finternal%2Ffs%2Fstreams.js",
            "raw_url": "https://github.com/nodejs/node/raw/0e06b350b6d7c80875321531593efc6f273620e5/lib%2Finternal%2Ffs%2Fstreams.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Fstreams.js?ref=0e06b350b6d7c80875321531593efc6f273620e5",
            "patch": "@@ -228,6 +228,11 @@ ReadStream.prototype.close = function(cb) {\n   this.destroy(null, cb);\n };\n \n+Object.defineProperty(ReadStream.prototype, 'pending', {\n+  get() { return this.fd === null; },\n+  configurable: true\n+});\n+\n function WriteStream(path, options) {\n   if (!(this instanceof WriteStream))\n     return new WriteStream(path, options);\n@@ -394,6 +399,11 @@ WriteStream.prototype.close = function(cb) {\n // There is no shutdown() for files.\n WriteStream.prototype.destroySoon = WriteStream.prototype.end;\n \n+Object.defineProperty(WriteStream.prototype, 'pending', {\n+  get() { return this.fd === null; },\n+  configurable: true\n+});\n+\n module.exports = {\n   ReadStream,\n   WriteStream"
        },
        {
            "sha": "5253be1b39346000b3c67ae9d8a7229339cdd419",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/0e06b350b6d7c80875321531593efc6f273620e5/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/0e06b350b6d7c80875321531593efc6f273620e5/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=0e06b350b6d7c80875321531593efc6f273620e5",
            "patch": "@@ -1829,7 +1829,7 @@ class Http2Stream extends Duplex {\n \n   _final(cb) {\n     const handle = this[kHandle];\n-    if (this[kID] === undefined) {\n+    if (this.pending) {\n       this.once('ready', () => this._final(cb));\n     } else if (handle !== undefined) {\n       debug(`Http2Stream ${this[kID]} [Http2Session ` +"
        },
        {
            "sha": "8ef0b6a6d7dad4515c2908b54459e368d956f91f",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/0e06b350b6d7c80875321531593efc6f273620e5/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/0e06b350b6d7c80875321531593efc6f273620e5/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=0e06b350b6d7c80875321531593efc6f273620e5",
            "patch": "@@ -347,7 +347,7 @@ Socket.prototype._unrefTimer = function _unrefTimer() {\n // sent out to the other side.\n Socket.prototype._final = function(cb) {\n   // If still connecting - defer handling `_final` until 'connect' will happen\n-  if (this.connecting) {\n+  if (this.pending) {\n     debug('_final: not yet connected');\n     return this.once('connect', () => this._final(cb));\n   }\n@@ -492,6 +492,13 @@ Object.defineProperty(Socket.prototype, '_connecting', {\n   }\n });\n \n+Object.defineProperty(Socket.prototype, 'pending', {\n+  get() {\n+    return !this._handle || this.connecting;\n+  },\n+  configurable: true\n+});\n+\n \n Object.defineProperty(Socket.prototype, 'readyState', {\n   get: function() {"
        },
        {
            "sha": "f6b380cf26d42c0f4ce386c5b24782ee81ee096e",
            "filename": "test/parallel/test-fs-ready-event-stream.js",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/0e06b350b6d7c80875321531593efc6f273620e5/test%2Fparallel%2Ftest-fs-ready-event-stream.js",
            "raw_url": "https://github.com/nodejs/node/raw/0e06b350b6d7c80875321531593efc6f273620e5/test%2Fparallel%2Ftest-fs-ready-event-stream.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-ready-event-stream.js?ref=0e06b350b6d7c80875321531593efc6f273620e5",
            "patch": "@@ -1,13 +1,20 @@\n 'use strict';\n const common = require('../common');\n+const assert = require('assert');\n const fs = require('fs');\n const path = require('path');\n const tmpdir = require('../common/tmpdir');\n \n const readStream = fs.createReadStream(__filename);\n-readStream.on('ready', common.mustCall(() => {}, 1));\n+assert.strictEqual(readStream.pending, true);\n+readStream.on('ready', common.mustCall(() => {\n+  assert.strictEqual(readStream.pending, false);\n+}));\n \n const writeFile = path.join(tmpdir.path, 'write-fsreadyevent.txt');\n tmpdir.refresh();\n const writeStream = fs.createWriteStream(writeFile, { autoClose: true });\n-writeStream.on('ready', common.mustCall(() => {}, 1));\n+assert.strictEqual(writeStream.pending, true);\n+writeStream.on('ready', common.mustCall(() => {\n+  assert.strictEqual(writeStream.pending, false);\n+}));"
        },
        {
            "sha": "81dd8f0c569c710893cf057a79c17d8cf304803c",
            "filename": "test/parallel/test-net-connect-buffer.js",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/0e06b350b6d7c80875321531593efc6f273620e5/test%2Fparallel%2Ftest-net-connect-buffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/0e06b350b6d7c80875321531593efc6f273620e5/test%2Fparallel%2Ftest-net-connect-buffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-net-connect-buffer.js?ref=0e06b350b6d7c80875321531593efc6f273620e5",
            "patch": "@@ -44,8 +44,10 @@ tcp.listen(0, common.mustCall(function() {\n   const socket = net.Stream({ highWaterMark: 0 });\n \n   let connected = false;\n+  assert.strictEqual(socket.pending, true);\n   socket.connect(this.address().port, common.mustCall(() => connected = true));\n \n+  assert.strictEqual(socket.pending, true);\n   assert.strictEqual(socket.connecting, true);\n   assert.strictEqual(socket.readyState, 'opening');\n \n@@ -87,6 +89,10 @@ tcp.listen(0, common.mustCall(function() {\n     console.error('write cb');\n     assert.ok(connected);\n     assert.strictEqual(socket.bytesWritten, Buffer.from(a + b).length);\n+    assert.strictEqual(socket.pending, false);\n+  }));\n+  socket.on('close', common.mustCall(() => {\n+    assert.strictEqual(socket.pending, true);\n   }));\n \n   assert.strictEqual(socket.bytesWritten, Buffer.from(a).length);"
        }
    ],
    "stats": {
        "total": 70,
        "additions": 66,
        "deletions": 4
    }
}