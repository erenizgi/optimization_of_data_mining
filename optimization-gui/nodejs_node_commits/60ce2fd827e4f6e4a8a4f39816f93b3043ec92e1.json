{
    "author": "cjihrig",
    "message": "module: don't search in require.resolve.paths\n\nThe paths used by require.resolve() should be treated as\nstarting points for module resolution, and not actually\nsearched.\n\nPR-URL: https://github.com/nodejs/node/pull/23683\nFixes: https://github.com/nodejs/node/issues/18408\nRefs: https://github.com/nodejs/node/issues/23643\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "60ce2fd827e4f6e4a8a4f39816f93b3043ec92e1",
    "files": [
        {
            "sha": "91d32ea2d06fb1e02d96604eee8985a244657a8f",
            "filename": "lib/internal/modules/cjs/loader.js",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/60ce2fd827e4f6e4a8a4f39816f93b3043ec92e1/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "raw_url": "https://github.com/nodejs/node/raw/60ce2fd827e4f6e4a8a4f39816f93b3043ec92e1/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js?ref=60ce2fd827e4f6e4a8a4f39816f93b3043ec92e1",
            "patch": "@@ -584,9 +584,6 @@ Module._resolveFilename = function(request, parent, isMain, options) {\n       fakeParent.paths = Module._nodeModulePaths(path);\n       const lookupPaths = Module._resolveLookupPaths(request, fakeParent, true);\n \n-      if (!paths.includes(path))\n-        paths.push(path);\n-\n       for (var j = 0; j < lookupPaths.length; j++) {\n         if (!paths.includes(lookupPaths[j]))\n           paths.push(lookupPaths[j]);"
        },
        {
            "sha": "2a0dc8846ce3cb9a943b8bb371ad8f7b905828e3",
            "filename": "test/fixtures/require-resolve.js",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/60ce2fd827e4f6e4a8a4f39816f93b3043ec92e1/test%2Ffixtures%2Frequire-resolve.js",
            "raw_url": "https://github.com/nodejs/node/raw/60ce2fd827e4f6e4a8a4f39816f93b3043ec92e1/test%2Ffixtures%2Frequire-resolve.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Frequire-resolve.js?ref=60ce2fd827e4f6e4a8a4f39816f93b3043ec92e1",
            "patch": "@@ -24,11 +24,12 @@ assert.throws(() => {\n     require.resolve('three')\n   }, /^Error: Cannot find module 'three'$/);\n \n-  // However, it can be found if resolution contains the nested index directory.\n-  assert.strictEqual(\n-    require.resolve('three', { paths: [nestedIndex] }),\n-    path.join(nestedIndex, 'three.js')\n-  );\n+  // If the nested-index directory is provided as a resolve path, 'three'\n+  // cannot be found because nested-index is used as a starting point and not\n+  // a searched directory.\n+  assert.throws(() => {\n+    require.resolve('three', { paths: [nestedIndex] })\n+  }, /^Error: Cannot find module 'three'$/);\n \n   // Resolution from nested index directory also checks node_modules.\n   assert.strictEqual(\n@@ -50,6 +51,6 @@ assert.throws(() => {\n   paths.unshift(nestedNodeModules);\n   assert.strictEqual(\n     require.resolve('bar', { paths }),\n-    path.join(nestedNodeModules, 'bar.js')\n+    path.join(nodeModules, 'bar.js')\n   );\n }"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 7,
        "deletions": 9
    }
}