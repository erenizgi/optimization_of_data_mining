{
    "author": "BridgeAR",
    "message": "assert,util: lazy load comparison functions\n\nPR-URL: https://github.com/nodejs/node/pull/20567\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>",
    "sha": "17d95ea1f0be2204cc040b8b0a9d1144f28baaab",
    "files": [
        {
            "sha": "4dafdd2bf04a54d2503734e8bd2599382fb8d4fb",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/17d95ea1f0be2204cc040b8b0a9d1144f28baaab/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/17d95ea1f0be2204cc040b8b0a9d1144f28baaab/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=17d95ea1f0be2204cc040b8b0a9d1144f28baaab",
            "patch": "@@ -21,10 +21,6 @@\n 'use strict';\n \n const { Buffer } = require('buffer');\n-const {\n-  isDeepEqual,\n-  isDeepStrictEqual\n-} = require('internal/util/comparisons');\n const { codes: {\n   ERR_AMBIGUOUS_ARGUMENT,\n   ERR_INVALID_ARG_TYPE,\n@@ -37,6 +33,15 @@ const { inspect, types: { isPromise, isRegExp } } = require('util');\n const { EOL } = require('internal/constants');\n const { NativeModule } = require('internal/bootstrap/loaders');\n \n+let isDeepEqual;\n+let isDeepStrictEqual;\n+\n+function lazyLoadComparison() {\n+  const comparison = require('internal/util/comparisons');\n+  isDeepEqual = comparison.isDeepEqual;\n+  isDeepStrictEqual = comparison.isDeepStrictEqual;\n+}\n+\n // Escape control characters but not \\n and \\t to keep the line breaks and\n // indentation intact.\n // eslint-disable-next-line no-control-regex\n@@ -285,6 +290,7 @@ assert.notEqual = function notEqual(actual, expected, message) {\n \n // The equivalence assertion tests a deep equality relation.\n assert.deepEqual = function deepEqual(actual, expected, message) {\n+  if (isDeepEqual === undefined) lazyLoadComparison();\n   if (!isDeepEqual(actual, expected)) {\n     innerFail({\n       actual,\n@@ -298,6 +304,7 @@ assert.deepEqual = function deepEqual(actual, expected, message) {\n \n // The non-equivalence assertion tests for any deep inequality.\n assert.notDeepEqual = function notDeepEqual(actual, expected, message) {\n+  if (isDeepEqual === undefined) lazyLoadComparison();\n   if (isDeepEqual(actual, expected)) {\n     innerFail({\n       actual,\n@@ -311,6 +318,7 @@ assert.notDeepEqual = function notDeepEqual(actual, expected, message) {\n /* eslint-enable */\n \n assert.deepStrictEqual = function deepStrictEqual(actual, expected, message) {\n+  if (isDeepEqual === undefined) lazyLoadComparison();\n   if (!isDeepStrictEqual(actual, expected)) {\n     innerFail({\n       actual,\n@@ -324,6 +332,7 @@ assert.deepStrictEqual = function deepStrictEqual(actual, expected, message) {\n \n assert.notDeepStrictEqual = notDeepStrictEqual;\n function notDeepStrictEqual(actual, expected, message) {\n+  if (isDeepEqual === undefined) lazyLoadComparison();\n   if (isDeepStrictEqual(actual, expected)) {\n     innerFail({\n       actual,\n@@ -437,6 +446,7 @@ function expectedException(actual, expected, msg) {\n       throw new ERR_INVALID_ARG_VALUE('error',\n                                       expected, 'may not be an empty object');\n     }\n+    if (isDeepEqual === undefined) lazyLoadComparison();\n     for (const key of keys) {\n       if (typeof actual[key] === 'string' &&\n           isRegExp(expected[key]) &&"
        },
        {
            "sha": "bd7a98694b91a9125eb42e03fc9b7c906b2906c6",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/17d95ea1f0be2204cc040b8b0a9d1144f28baaab/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/17d95ea1f0be2204cc040b8b0a9d1144f28baaab/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=17d95ea1f0be2204cc040b8b0a9d1144f28baaab",
            "patch": "@@ -64,10 +64,6 @@ const {\n   isTypedArray\n } = types;\n \n-const {\n-  isDeepStrictEqual\n-} = require('internal/util/comparisons');\n-\n const {\n   customInspectSymbol,\n   deprecate,\n@@ -95,6 +91,7 @@ const dateToISOString = Date.prototype.toISOString;\n const errorToString = Error.prototype.toString;\n \n let CIRCULAR_ERROR_MESSAGE;\n+let internalDeepEqual;\n \n /* eslint-disable */\n const strEscapeSequencesRegExp = /[\\x00-\\x1f\\x27\\x5c]/;\n@@ -1261,7 +1258,13 @@ module.exports = exports = {\n   isArray: Array.isArray,\n   isBoolean,\n   isBuffer,\n-  isDeepStrictEqual,\n+  isDeepStrictEqual(a, b) {\n+    if (internalDeepEqual === undefined) {\n+      internalDeepEqual = require('internal/util/comparisons')\n+        .isDeepStrictEqual;\n+    }\n+    return internalDeepEqual(a, b);\n+  },\n   isNull,\n   isNullOrUndefined,\n   isNumber,"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 22,
        "deletions": 9
    }
}