{
    "author": "Trott",
    "message": "test: split test-cli-syntax into multiple tests\n\nSplit test-cli-syntax into multiple files to improve reliability and/or\nisolate unreliable test cases.\n\nMove test cases back to parallel as appropriate.\n\nPR-URL: https://github.com/nodejs/node/pull/24922\nReviewed-By: Bryan English <bryan@bryanenglish.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>",
    "sha": "a3801e96835821b71dd97b3f8513c56814bcf8fa",
    "files": [
        {
            "sha": "cb4c4fd5688642f24cce7d492bd3732265bc23c9",
            "filename": "test/parallel/test-cli-syntax-eval.js",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fparallel%2Ftest-cli-syntax-eval.js",
            "raw_url": "https://github.com/nodejs/node/raw/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fparallel%2Ftest-cli-syntax-eval.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-cli-syntax-eval.js?ref=a3801e96835821b71dd97b3f8513c56814bcf8fa",
            "patch": "@@ -0,0 +1,24 @@\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+const { exec } = require('child_process');\n+\n+const node = process.execPath;\n+\n+// should throw if -c and -e flags are both passed\n+['-c', '--check'].forEach(function(checkFlag) {\n+  ['-e', '--eval'].forEach(function(evalFlag) {\n+    const args = [checkFlag, evalFlag, 'foo'];\n+    const cmd = [node, ...args].join(' ');\n+    exec(cmd, common.mustCall((err, stdout, stderr) => {\n+      assert.strictEqual(err instanceof Error, true);\n+      assert.strictEqual(err.code, 9);\n+      assert(\n+        stderr.startsWith(\n+          `${node}: either --check or --eval can be used, not both`\n+        )\n+      );\n+    }));\n+  });\n+});"
        },
        {
            "sha": "64e2d47931eea14f68e5c592dc6fbf7afb9bd873",
            "filename": "test/parallel/test-cli-syntax-piped-bad.js",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fparallel%2Ftest-cli-syntax-piped-bad.js",
            "raw_url": "https://github.com/nodejs/node/raw/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fparallel%2Ftest-cli-syntax-piped-bad.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-cli-syntax-piped-bad.js?ref=a3801e96835821b71dd97b3f8513c56814bcf8fa",
            "patch": "@@ -0,0 +1,35 @@\n+'use strict';\n+\n+require('../common');\n+const assert = require('assert');\n+const { spawnSync } = require('child_process');\n+\n+const node = process.execPath;\n+\n+// test both sets of arguments that check syntax\n+const syntaxArgs = [\n+  ['-c'],\n+  ['--check']\n+];\n+\n+// Match on the name of the `Error` but not the message as it is different\n+// depending on the JavaScript engine.\n+const syntaxErrorRE = /^SyntaxError: \\b/m;\n+\n+// Should throw if code piped from stdin with --check has bad syntax\n+// loop each possible option, `-c` or `--check`\n+syntaxArgs.forEach(function(args) {\n+  const stdin = 'var foo bar;';\n+  const c = spawnSync(node, args, { encoding: 'utf8', input: stdin });\n+\n+  // stderr should include '[stdin]' as the filename\n+  assert(c.stderr.startsWith('[stdin]'), `${c.stderr} starts with ${stdin}`);\n+\n+  // no stdout or stderr should be produced\n+  assert.strictEqual(c.stdout, '');\n+\n+  // stderr should have a syntax error message\n+  assert(syntaxErrorRE.test(c.stderr), `${syntaxErrorRE} === ${c.stderr}`);\n+\n+  assert.strictEqual(c.status, 1);\n+});"
        },
        {
            "sha": "7e0cfbc89a491ac36cfbad603df24d213257ca1d",
            "filename": "test/parallel/test-cli-syntax-piped-good.js",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/nodejs/node/blob/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fparallel%2Ftest-cli-syntax-piped-good.js",
            "raw_url": "https://github.com/nodejs/node/raw/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fparallel%2Ftest-cli-syntax-piped-good.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-cli-syntax-piped-good.js?ref=a3801e96835821b71dd97b3f8513c56814bcf8fa",
            "patch": "@@ -0,0 +1,26 @@\n+'use strict';\n+\n+require('../common');\n+const assert = require('assert');\n+const { spawnSync } = require('child_process');\n+\n+const node = process.execPath;\n+\n+// test both sets of arguments that check syntax\n+const syntaxArgs = [\n+  ['-c'],\n+  ['--check']\n+];\n+\n+// should not execute code piped from stdin with --check\n+// loop each possible option, `-c` or `--check`\n+syntaxArgs.forEach(function(args) {\n+  const stdin = 'throw new Error(\"should not get run\");';\n+  const c = spawnSync(node, args, { encoding: 'utf8', input: stdin });\n+\n+  // no stdout or stderr should be produced\n+  assert.strictEqual(c.stdout, '');\n+  assert.strictEqual(c.stderr, '');\n+\n+  assert.strictEqual(c.status, 0);\n+});"
        },
        {
            "sha": "3b6cc916fb261112b6c39a073d6b6d5f15846733",
            "filename": "test/sequential/sequential.status",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Fsequential.status",
            "raw_url": "https://github.com/nodejs/node/raw/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Fsequential.status",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Fsequential.status?ref=a3801e96835821b71dd97b3f8513c56814bcf8fa",
            "patch": "@@ -8,7 +8,10 @@ prefix sequential\n # https://github.com/nodejs/node/issues/22336\n test-gc-http-client: PASS,FLAKY\n # https://github.com/nodejs/node/issues/24403\n-test-cli-syntax: PASS,FLAKY\n+test-cli-syntax-bad: PASS,FLAKY\n+test-cli-syntax-file-not-found: PASS,FLAKY\n+test-cli-syntax-good: PASS,FLAKY\n+test-cli-syntax-require: PASS,FLAKY\n \n [$system==win32]\n # https://github.com/nodejs/node/issues/22327"
        },
        {
            "sha": "e1c7f3bec5870fd07c5d739f71df59faa9f1e722",
            "filename": "test/sequential/test-cli-syntax-bad.js",
            "status": "added",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/nodejs/node/blob/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Ftest-cli-syntax-bad.js",
            "raw_url": "https://github.com/nodejs/node/raw/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Ftest-cli-syntax-bad.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-cli-syntax-bad.js?ref=a3801e96835821b71dd97b3f8513c56814bcf8fa",
            "patch": "@@ -0,0 +1,47 @@\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+const { exec } = require('child_process');\n+const fixtures = require('../common/fixtures');\n+\n+const node = process.execPath;\n+\n+// test both sets of arguments that check syntax\n+const syntaxArgs = [\n+  ['-c'],\n+  ['--check']\n+];\n+\n+// Match on the name of the `Error` but not the message as it is different\n+// depending on the JavaScript engine.\n+const syntaxErrorRE = /^SyntaxError: \\b/m;\n+\n+// test bad syntax with and without shebang\n+[\n+  'syntax/bad_syntax.js',\n+  'syntax/bad_syntax',\n+  'syntax/bad_syntax_shebang.js',\n+  'syntax/bad_syntax_shebang'\n+].forEach(function(file) {\n+  file = fixtures.path(file);\n+\n+  // loop each possible option, `-c` or `--check`\n+  syntaxArgs.forEach(function(args) {\n+    const _args = args.concat(file);\n+    const cmd = [node, ..._args].join(' ');\n+    exec(cmd, common.mustCall((err, stdout, stderr) => {\n+      assert.strictEqual(err instanceof Error, true);\n+      assert.strictEqual(err.code, 1);\n+\n+      // no stdout should be produced\n+      assert.strictEqual(stdout, '');\n+\n+      // stderr should have a syntax error message\n+      assert(syntaxErrorRE.test(stderr), `${syntaxErrorRE} === ${stderr}`);\n+\n+      // stderr should include the filename\n+      assert(stderr.startsWith(file), `${stderr} starts with ${file}`);\n+    }));\n+  });\n+});"
        },
        {
            "sha": "848e2fe231ab31ffd604615ed26856cbc6c1d9ff",
            "filename": "test/sequential/test-cli-syntax-file-not-found.js",
            "status": "added",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Ftest-cli-syntax-file-not-found.js",
            "raw_url": "https://github.com/nodejs/node/raw/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Ftest-cli-syntax-file-not-found.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-cli-syntax-file-not-found.js?ref=a3801e96835821b71dd97b3f8513c56814bcf8fa",
            "patch": "@@ -0,0 +1,39 @@\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+const { exec } = require('child_process');\n+const fixtures = require('../common/fixtures');\n+\n+const node = process.execPath;\n+\n+// test both sets of arguments that check syntax\n+const syntaxArgs = [\n+  ['-c'],\n+  ['--check']\n+];\n+\n+const notFoundRE = /^Error: Cannot find module/m;\n+\n+// test file not found\n+[\n+  'syntax/file_not_found.js',\n+  'syntax/file_not_found'\n+].forEach(function(file) {\n+  file = fixtures.path(file);\n+\n+  // loop each possible option, `-c` or `--check`\n+  syntaxArgs.forEach(function(args) {\n+    const _args = args.concat(file);\n+    const cmd = [node, ..._args].join(' ');\n+    exec(cmd, common.mustCall((err, stdout, stderr) => {\n+      // no stdout should be produced\n+      assert.strictEqual(stdout, '');\n+\n+      // stderr should have a module not found error message\n+      assert(notFoundRE.test(stderr), `${notFoundRE} === ${stderr}`);\n+\n+      assert.strictEqual(err.code, 1);\n+    }));\n+  });\n+});"
        },
        {
            "sha": "1c2b3cbe55db80b1228cf9066e7bff27edcf7c03",
            "filename": "test/sequential/test-cli-syntax-good.js",
            "status": "added",
            "additions": 43,
            "deletions": 0,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Ftest-cli-syntax-good.js",
            "raw_url": "https://github.com/nodejs/node/raw/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Ftest-cli-syntax-good.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-cli-syntax-good.js?ref=a3801e96835821b71dd97b3f8513c56814bcf8fa",
            "patch": "@@ -0,0 +1,43 @@\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+const { exec } = require('child_process');\n+const fixtures = require('../common/fixtures');\n+\n+const node = process.execPath;\n+\n+// test both sets of arguments that check syntax\n+const syntaxArgs = [\n+  ['-c'],\n+  ['--check']\n+];\n+\n+// test good syntax with and without shebang\n+[\n+  'syntax/good_syntax.js',\n+  'syntax/good_syntax',\n+  'syntax/good_syntax_shebang.js',\n+  'syntax/good_syntax_shebang',\n+  'syntax/illegal_if_not_wrapped.js'\n+].forEach(function(file) {\n+  file = fixtures.path(file);\n+\n+  // loop each possible option, `-c` or `--check`\n+  syntaxArgs.forEach(function(args) {\n+    const _args = args.concat(file);\n+\n+    const cmd = [node, ..._args].join(' ');\n+    exec(cmd, common.mustCall((err, stdout, stderr) => {\n+      if (err) {\n+        console.log('-- stdout --');\n+        console.log(stdout);\n+        console.log('-- stderr --');\n+        console.log(stderr);\n+      }\n+      assert.ifError(err);\n+      assert.strictEqual(stdout, '');\n+      assert.strictEqual(stderr, '');\n+    }));\n+  });\n+});"
        },
        {
            "sha": "ed13805eb9e6532b02ae45825fda0da7acc734c9",
            "filename": "test/sequential/test-cli-syntax-require.js",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Ftest-cli-syntax-require.js",
            "raw_url": "https://github.com/nodejs/node/raw/a3801e96835821b71dd97b3f8513c56814bcf8fa/test%2Fsequential%2Ftest-cli-syntax-require.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-cli-syntax-require.js?ref=a3801e96835821b71dd97b3f8513c56814bcf8fa",
            "patch": "@@ -0,0 +1,35 @@\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+const { exec } = require('child_process');\n+const fixtures = require('../common/fixtures');\n+\n+const node = process.execPath;\n+\n+// Match on the name of the `Error` but not the message as it is different\n+// depending on the JavaScript engine.\n+const syntaxErrorRE = /^SyntaxError: \\b/m;\n+\n+// should work with -r flags\n+['-c', '--check'].forEach(function(checkFlag) {\n+  ['-r', '--require'].forEach(function(requireFlag) {\n+    const preloadFile = fixtures.path('no-wrapper.js');\n+    const file = fixtures.path('syntax', 'illegal_if_not_wrapped.js');\n+    const args = [requireFlag, preloadFile, checkFlag, file];\n+    const cmd = [node, ...args].join(' ');\n+    exec(cmd, common.mustCall((err, stdout, stderr) => {\n+      assert.strictEqual(err instanceof Error, true);\n+      assert.strictEqual(err.code, 1);\n+\n+      // no stdout should be produced\n+      assert.strictEqual(stdout, '');\n+\n+      // stderr should have a syntax error message\n+      assert(syntaxErrorRE.test(stderr), `${syntaxErrorRE} === ${stderr}`);\n+\n+      // stderr should include the filename\n+      assert(stderr.startsWith(file), `${stderr} starts with ${file}`);\n+    }));\n+  });\n+});"
        },
        {
            "sha": "74e8c9fa91755fd28d5f3d581e027a994d6d62d1",
            "filename": "test/sequential/test-cli-syntax.js",
            "status": "removed",
            "additions": 0,
            "deletions": 171,
            "changes": 171,
            "blob_url": "https://github.com/nodejs/node/blob/c61327d37673ab2ea454d14c36329b113aaca32a/test%2Fsequential%2Ftest-cli-syntax.js",
            "raw_url": "https://github.com/nodejs/node/raw/c61327d37673ab2ea454d14c36329b113aaca32a/test%2Fsequential%2Ftest-cli-syntax.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-cli-syntax.js?ref=c61327d37673ab2ea454d14c36329b113aaca32a",
            "patch": "@@ -1,171 +0,0 @@\n-'use strict';\n-\n-const common = require('../common');\n-const assert = require('assert');\n-const { exec, spawnSync } = require('child_process');\n-const fixtures = require('../common/fixtures');\n-\n-const node = process.execPath;\n-\n-// test both sets of arguments that check syntax\n-const syntaxArgs = [\n-  ['-c'],\n-  ['--check']\n-];\n-\n-// Match on the name of the `Error` but not the message as it is different\n-// depending on the JavaScript engine.\n-const syntaxErrorRE = /^SyntaxError: \\b/m;\n-const notFoundRE = /^Error: Cannot find module/m;\n-\n-// test good syntax with and without shebang\n-[\n-  'syntax/good_syntax.js',\n-  'syntax/good_syntax',\n-  'syntax/good_syntax_shebang.js',\n-  'syntax/good_syntax_shebang',\n-  'syntax/illegal_if_not_wrapped.js'\n-].forEach(function(file) {\n-  file = fixtures.path(file);\n-\n-  // loop each possible option, `-c` or `--check`\n-  syntaxArgs.forEach(function(args) {\n-    const _args = args.concat(file);\n-\n-    const cmd = [node, ..._args].join(' ');\n-    exec(cmd, common.mustCall((err, stdout, stderr) => {\n-      if (err) {\n-        console.log('-- stdout --');\n-        console.log(stdout);\n-        console.log('-- stderr --');\n-        console.log(stderr);\n-      }\n-      assert.ifError(err);\n-      assert.strictEqual(stdout, '');\n-      assert.strictEqual(stderr, '');\n-    }));\n-  });\n-});\n-\n-// test bad syntax with and without shebang\n-[\n-  'syntax/bad_syntax.js',\n-  'syntax/bad_syntax',\n-  'syntax/bad_syntax_shebang.js',\n-  'syntax/bad_syntax_shebang'\n-].forEach(function(file) {\n-  file = fixtures.path(file);\n-\n-  // loop each possible option, `-c` or `--check`\n-  syntaxArgs.forEach(function(args) {\n-    const _args = args.concat(file);\n-    const cmd = [node, ..._args].join(' ');\n-    exec(cmd, common.mustCall((err, stdout, stderr) => {\n-      assert.strictEqual(err instanceof Error, true);\n-      assert.strictEqual(err.code, 1);\n-\n-      // no stdout should be produced\n-      assert.strictEqual(stdout, '');\n-\n-      // stderr should have a syntax error message\n-      assert(syntaxErrorRE.test(stderr), `${syntaxErrorRE} === ${stderr}`);\n-\n-      // stderr should include the filename\n-      assert(stderr.startsWith(file), `${stderr} starts with ${file}`);\n-    }));\n-  });\n-});\n-\n-// test file not found\n-[\n-  'syntax/file_not_found.js',\n-  'syntax/file_not_found'\n-].forEach(function(file) {\n-  file = fixtures.path(file);\n-\n-  // loop each possible option, `-c` or `--check`\n-  syntaxArgs.forEach(function(args) {\n-    const _args = args.concat(file);\n-    const cmd = [node, ..._args].join(' ');\n-    exec(cmd, common.mustCall((err, stdout, stderr) => {\n-      // no stdout should be produced\n-      assert.strictEqual(stdout, '');\n-\n-      // stderr should have a module not found error message\n-      assert(notFoundRE.test(stderr), `${notFoundRE} === ${stderr}`);\n-\n-      assert.strictEqual(err.code, 1);\n-    }));\n-  });\n-});\n-\n-// should not execute code piped from stdin with --check\n-// loop each possible option, `-c` or `--check`\n-syntaxArgs.forEach(function(args) {\n-  const stdin = 'throw new Error(\"should not get run\");';\n-  const c = spawnSync(node, args, { encoding: 'utf8', input: stdin });\n-\n-  // no stdout or stderr should be produced\n-  assert.strictEqual(c.stdout, '');\n-  assert.strictEqual(c.stderr, '');\n-\n-  assert.strictEqual(c.status, 0);\n-});\n-\n-// Should throw if code piped from stdin with --check has bad syntax\n-// loop each possible option, `-c` or `--check`\n-syntaxArgs.forEach(function(args) {\n-  const stdin = 'var foo bar;';\n-  const c = spawnSync(node, args, { encoding: 'utf8', input: stdin });\n-\n-  // stderr should include '[stdin]' as the filename\n-  assert(c.stderr.startsWith('[stdin]'), `${c.stderr} starts with ${stdin}`);\n-\n-  // no stdout or stderr should be produced\n-  assert.strictEqual(c.stdout, '');\n-\n-  // stderr should have a syntax error message\n-  assert(syntaxErrorRE.test(c.stderr), `${syntaxErrorRE} === ${c.stderr}`);\n-\n-  assert.strictEqual(c.status, 1);\n-});\n-\n-// should throw if -c and -e flags are both passed\n-['-c', '--check'].forEach(function(checkFlag) {\n-  ['-e', '--eval'].forEach(function(evalFlag) {\n-    const args = [checkFlag, evalFlag, 'foo'];\n-    const cmd = [node, ...args].join(' ');\n-    exec(cmd, common.mustCall((err, stdout, stderr) => {\n-      assert.strictEqual(err instanceof Error, true);\n-      assert.strictEqual(err.code, 9);\n-      assert(\n-        stderr.startsWith(\n-          `${node}: either --check or --eval can be used, not both`\n-        )\n-      );\n-    }));\n-  });\n-});\n-\n-// should work with -r flags\n-['-c', '--check'].forEach(function(checkFlag) {\n-  ['-r', '--require'].forEach(function(requireFlag) {\n-    const preloadFile = fixtures.path('no-wrapper.js');\n-    const file = fixtures.path('syntax', 'illegal_if_not_wrapped.js');\n-    const args = [requireFlag, preloadFile, checkFlag, file];\n-    const cmd = [node, ...args].join(' ');\n-    exec(cmd, common.mustCall((err, stdout, stderr) => {\n-      assert.strictEqual(err instanceof Error, true);\n-      assert.strictEqual(err.code, 1);\n-\n-      // no stdout should be produced\n-      assert.strictEqual(stdout, '');\n-\n-      // stderr should have a syntax error message\n-      assert(syntaxErrorRE.test(stderr), `${syntaxErrorRE} === ${stderr}`);\n-\n-      // stderr should include the filename\n-      assert(stderr.startsWith(file), `${stderr} starts with ${file}`);\n-    }));\n-  });\n-});"
        }
    ],
    "stats": {
        "total": 425,
        "additions": 253,
        "deletions": 172
    }
}