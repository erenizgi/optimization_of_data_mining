{
    "author": "addaleax",
    "message": "lib: defer pausing stdin to the next tick\n\nThis is done to match the stream implementation, which also\nonly actually stops reading in the next tick after the `'pause'`\nevent is emitted.\n\nPR-URL: https://github.com/nodejs/node/pull/19377\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "5d7045960628084f79f5da74272000b7d0b8256f",
    "files": [
        {
            "sha": "ce84142938f06649e77fe0373cb107f4ceb079a1",
            "filename": "lib/internal/process/stdio.js",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/5d7045960628084f79f5da74272000b7d0b8256f/lib%2Finternal%2Fprocess%2Fstdio.js",
            "raw_url": "https://github.com/nodejs/node/raw/5d7045960628084f79f5da74272000b7d0b8256f/lib%2Finternal%2Fprocess%2Fstdio.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fstdio.js?ref=5d7045960628084f79f5da74272000b7d0b8256f",
            "patch": "@@ -109,15 +109,22 @@ function setupStdio() {\n       stdin._handle.readStop();\n     }\n \n-    // if the user calls stdin.pause(), then we need to stop reading\n-    // immediately, so that the process can close down.\n+    // If the user calls stdin.pause(), then we need to stop reading\n+    // once the stream implementation does so (one nextTick later),\n+    // so that the process can close down.\n     stdin.on('pause', () => {\n+      process.nextTick(onpause);\n+    });\n+\n+    function onpause() {\n       if (!stdin._handle)\n         return;\n-      stdin._readableState.reading = false;\n-      stdin._handle.reading = false;\n-      stdin._handle.readStop();\n-    });\n+      if (stdin._handle.reading && !stdin._readableState.flowing) {\n+        stdin._readableState.reading = false;\n+        stdin._handle.reading = false;\n+        stdin._handle.readStop();\n+      }\n+    }\n \n     return stdin;\n   }"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 13,
        "deletions": 6
    }
}