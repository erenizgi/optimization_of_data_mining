{
    "author": "jasnell",
    "message": "trace_events: add version metadata\n\nUse `TRACE_EVENT_METADATA1` to include just the node.js version for\nnow. Later this can be expanded to include more version and platform\ndetails.\n\nPR-URL: https://github.com/nodejs/node/pull/20852\nReviewed-By: Ali Ijaz Sheikh <ofrobots@google.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "e60eed19bee59f7dd171929f3bd3623ccaa91839",
    "files": [
        {
            "sha": "4d8464b9f53751ad1cca10a8615ca6e54aace58e",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/e60eed19bee59f7dd171929f3bd3623ccaa91839/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/e60eed19bee59f7dd171929f3bd3623ccaa91839/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=e60eed19bee59f7dd171929f3bd3623ccaa91839",
            "patch": "@@ -4322,6 +4322,7 @@ inline int Start(Isolate* isolate, IsolateData* isolate_data,\n   Environment env(isolate_data, context, v8_platform.GetTracingAgent());\n   env.Start(argc, argv, exec_argc, exec_argv, v8_is_profiling);\n \n+  TRACE_EVENT_METADATA1(\"__metadata\", \"version\", \"node\", NODE_VERSION_STRING);\n   TRACE_EVENT_METADATA1(\"__metadata\", \"thread_name\", \"name\",\n                         \"JavaScriptMainThread\");\n "
        },
        {
            "sha": "8b6e97ce35ff3c023d51d597ba6b063dcd265bd4",
            "filename": "test/parallel/test-trace-events-metadata.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/e60eed19bee59f7dd171929f3bd3623ccaa91839/test%2Fparallel%2Ftest-trace-events-metadata.js",
            "raw_url": "https://github.com/nodejs/node/raw/e60eed19bee59f7dd171929f3bd3623ccaa91839/test%2Fparallel%2Ftest-trace-events-metadata.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-trace-events-metadata.js?ref=e60eed19bee59f7dd171929f3bd3623ccaa91839",
            "patch": "@@ -13,7 +13,8 @@ tmpdir.refresh();\n process.chdir(tmpdir.path);\n \n const proc = cp.spawn(process.execPath,\n-                      [ '--trace-events-enabled', '-e', CODE ]);\n+                      [ '--trace-event-categories', 'node.perf.usertiming',\n+                        '-e', CODE ]);\n proc.once('exit', common.mustCall(() => {\n   assert(common.fileExists(FILE_NAME));\n   fs.readFile(FILE_NAME, common.mustCall((err, data) => {\n@@ -25,5 +26,8 @@ proc.once('exit', common.mustCall(() => {\n     assert(traces.some((trace) =>\n       trace.cat === '__metadata' && trace.name === 'thread_name' &&\n         trace.args.name === 'BackgroundTaskRunner'));\n+    assert(traces.some((trace) =>\n+      trace.cat === '__metadata' && trace.name === 'version' &&\n+        trace.args.node === process.versions.node));\n   }));\n }));"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
    }
}