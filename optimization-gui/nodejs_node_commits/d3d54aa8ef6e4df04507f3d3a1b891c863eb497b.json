{
    "author": "danbev",
    "message": "build: extract common parts from addon .buildstamp\n\nThis commit extracts common parts from the targets\ntest/addons/.buildstamp, and test/addons-napi/.buildstamp to reduce some\nduplication.\n\nPR-URL: https://github.com/nodejs/node/pull/22171\nReviewed-By: Jon Moss <me@jonathanmoss.me>",
    "sha": "d3d54aa8ef6e4df04507f3d3a1b891c863eb497b",
    "files": [
        {
            "sha": "f1242bbb30fc7344ba693fb9d16c1834d282c61a",
            "filename": "Makefile",
            "status": "modified",
            "additions": 17,
            "deletions": 17,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/d3d54aa8ef6e4df04507f3d3a1b891c863eb497b/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/d3d54aa8ef6e4df04507f3d3a1b891c863eb497b/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=d3d54aa8ef6e4df04507f3d3a1b891c863eb497b",
            "patch": "@@ -333,19 +333,26 @@ ADDONS_BINDING_SOURCES := \\\n \t$(filter-out test/addons/??_*/*.cc, $(wildcard test/addons/*/*.cc)) \\\n \t$(filter-out test/addons/??_*/*.h, $(wildcard test/addons/*/*.h))\n \n+ADDONS_PREREQS := config.gypi \\\n+\tdeps/npm/node_modules/node-gyp/package.json tools/build-addons.js \\\n+\tdeps/uv/include/*.h deps/v8/include/*.h \\\n+\tsrc/node.h src/node_buffer.h src/node_object_wrap.h src/node_version.h\n+\n+define run_build_addons\n+env npm_config_loglevel=$(LOGLEVEL) npm_config_nodedir=\"$$PWD\" \\\n+  npm_config_python=\"$(PYTHON)\" $(NODE) \"$$PWD/tools/build-addons\" \\\n+  \"$$PWD/deps/npm/node_modules/node-gyp/bin/node-gyp.js\" \\\n+  $1\n+touch $2\n+endef\n+\n # Implicitly depends on $(NODE_EXE), see the build-addons rule for rationale.\n # Depends on node-gyp package.json so that build-addons is (re)executed when\n # node-gyp is updated as part of an npm update.\n-test/addons/.buildstamp: config.gypi \\\n-\tdeps/npm/node_modules/node-gyp/package.json tools/build-addons.js \\\n+test/addons/.buildstamp: $(ADDONS_PREREQS) \\\n \t$(ADDONS_BINDING_GYPS) $(ADDONS_BINDING_SOURCES) \\\n-\tdeps/uv/include/*.h deps/v8/include/*.h \\\n-\tsrc/node.h src/node_buffer.h src/node_object_wrap.h src/node_version.h \\\n \ttest/addons/.docbuildstamp\n-\tenv npm_config_loglevel=$(LOGLEVEL) npm_config_nodedir=\"$$PWD\" \\\n-\t\tnpm_config_python=\"$(PYTHON)\" $(NODE) \"$$PWD/tools/build-addons\" \\\n-\t\t\"$$PWD/deps/npm/node_modules/node-gyp/bin/node-gyp.js\" \"$$PWD/test/addons\"\n-\ttouch $@\n+\t@$(call run_build_addons,\"$$PWD/test/addons\",$@)\n \n .PHONY: build-addons\n # .buildstamp needs $(NODE_EXE) but cannot depend on it\n@@ -366,17 +373,10 @@ ADDONS_NAPI_BINDING_SOURCES := \\\n \t$(filter-out test/addons-napi/??_*/*.h, $(wildcard test/addons-napi/*/*.h))\n \n # Implicitly depends on $(NODE_EXE), see the build-addons-napi rule for rationale.\n-test/addons-napi/.buildstamp: config.gypi \\\n-\tdeps/npm/node_modules/node-gyp/package.json tools/build-addons.js \\\n+test/addons-napi/.buildstamp: $(ADDONS_PREREQS) \\\n \t$(ADDONS_NAPI_BINDING_GYPS) $(ADDONS_NAPI_BINDING_SOURCES) \\\n-\tdeps/uv/include/*.h deps/v8/include/*.h \\\n-\tsrc/node.h src/node_buffer.h src/node_object_wrap.h src/node_version.h \\\n \tsrc/node_api.h src/node_api_types.h\n-\tenv npm_config_loglevel=$(LOGLEVEL) npm_config_nodedir=\"$$PWD\" \\\n-\t\tnpm_config_python=\"$(PYTHON)\" $(NODE) \"$$PWD/tools/build-addons\" \\\n-\t\t\"$$PWD/deps/npm/node_modules/node-gyp/bin/node-gyp.js\" \\\n-\t\t\"$$PWD/test/addons-napi\"\n-\ttouch $@\n+\t@$(call run_build_addons,\"$$PWD/test/addons-napi\",$@)\n \n .PHONY: build-addons-napi\n # .buildstamp needs $(NODE_EXE) but cannot depend on it"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 17,
        "deletions": 17
    }
}