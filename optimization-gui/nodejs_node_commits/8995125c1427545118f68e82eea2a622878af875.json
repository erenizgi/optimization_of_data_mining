{
    "author": "not-an-aardvark",
    "message": "test: ensure failed assertions cause build to fail\n\nThis updates the test in `test/parallel/test-assert-async.js` to add an\nassertion that the Promises used in the test end up fulfilled.\nPreviously, if an assertion failure occurred, the Promises would have\nrejected and a warning would have been logged, but the test would still\nhave exit code 0.\n\nPR-URL: https://github.com/nodejs/node/pull/19650\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "8995125c1427545118f68e82eea2a622878af875",
    "files": [
        {
            "sha": "ab03a53cd302c7e7c577f70419937bf52907a61f",
            "filename": "test/parallel/test-assert-async.js",
            "status": "modified",
            "additions": 45,
            "deletions": 51,
            "changes": 96,
            "blob_url": "https://github.com/nodejs/node/blob/8995125c1427545118f68e82eea2a622878af875/test%2Fparallel%2Ftest-assert-async.js",
            "raw_url": "https://github.com/nodejs/node/raw/8995125c1427545118f68e82eea2a622878af875/test%2Fparallel%2Ftest-assert-async.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert-async.js?ref=8995125c1427545118f68e82eea2a622878af875",
            "patch": "@@ -9,58 +9,52 @@ const wait = promisify(setTimeout);\n // Test assert.rejects() and assert.doesNotReject() by checking their\n // expected output and by verifying that they do not work sync\n \n-assert.rejects(\n-  () => assert.fail(),\n-  common.expectsError({\n-    code: 'ERR_ASSERTION',\n-    type: assert.AssertionError,\n-    message: 'Failed'\n-  })\n-);\n+common.crashOnUnhandledRejection();\n \n-assert.doesNotReject(() => {});\n+(async () => {\n+  await assert.rejects(\n+    () => assert.fail(),\n+    common.expectsError({\n+      code: 'ERR_ASSERTION',\n+      type: assert.AssertionError,\n+      message: 'Failed'\n+    })\n+  );\n \n-{\n-  const promise = assert.rejects(async () => {\n-    await wait(1);\n-    assert.fail();\n-  }, common.expectsError({\n-    code: 'ERR_ASSERTION',\n-    type: assert.AssertionError,\n-    message: 'Failed'\n-  }));\n-  assert.doesNotReject(() => promise);\n-}\n+  await assert.doesNotReject(() => {});\n \n-{\n-  const promise = assert.doesNotReject(async () => {\n-    await wait(1);\n-    throw new Error();\n-  });\n-  assert.rejects(() => promise,\n-                 (err) => {\n-                   assert(err instanceof assert.AssertionError,\n-                          `${err.name} is not instance of AssertionError`);\n-                   assert.strictEqual(err.code, 'ERR_ASSERTION');\n-                   assert(/^Got unwanted rejection\\.\\n$/.test(err.message));\n-                   assert.strictEqual(err.operator, 'doesNotReject');\n-                   assert.ok(!err.stack.includes('at Function.doesNotReject'));\n-                   return true;\n-                 }\n-  );\n-}\n+  {\n+    const promise = assert.doesNotReject(async () => {\n+      await wait(1);\n+      throw new Error();\n+    });\n+    await assert.rejects(\n+      () => promise,\n+      (err) => {\n+        assert(err instanceof assert.AssertionError,\n+               `${err.name} is not instance of AssertionError`);\n+        assert.strictEqual(err.code, 'ERR_ASSERTION');\n+        assert(/^Got unwanted rejection\\.\\n$/.test(err.message));\n+        assert.strictEqual(err.operator, 'doesNotReject');\n+        assert.ok(!err.stack.includes('at Function.doesNotReject'));\n+        return true;\n+      }\n+    );\n+  }\n \n-{\n-  const promise = assert.rejects(() => {});\n-  assert.rejects(() => promise,\n-                 (err) => {\n-                   assert(err instanceof assert.AssertionError,\n-                          `${err.name} is not instance of AssertionError`);\n-                   assert.strictEqual(err.code, 'ERR_ASSERTION');\n-                   assert(/^Missing expected rejection\\.$/.test(err.message));\n-                   assert.strictEqual(err.operator, 'rejects');\n-                   assert.ok(!err.stack.includes('at Function.rejects'));\n-                   return true;\n-                 }\n-  );\n-}\n+  {\n+    const promise = assert.rejects(() => {});\n+    await assert.rejects(\n+      () => promise,\n+      (err) => {\n+        assert(err instanceof assert.AssertionError,\n+               `${err.name} is not instance of AssertionError`);\n+        assert.strictEqual(err.code, 'ERR_ASSERTION');\n+        assert(/^Missing expected rejection\\.$/.test(err.message));\n+        assert.strictEqual(err.operator, 'rejects');\n+        assert.ok(!err.stack.includes('at Function.rejects'));\n+        return true;\n+      }\n+    );\n+  }\n+})().then(common.mustCall());"
        }
    ],
    "stats": {
        "total": 96,
        "additions": 45,
        "deletions": 51
    }
}