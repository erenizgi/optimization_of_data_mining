{
    "author": "BridgeAR",
    "message": "util: mark iterator entries as such\n\nIt is possible to distinguish the entries iterator from others.\nExpose that information to the users as well and improve the\nSymbol.toStringTag handling by adding a special tag instead of\nreplacing the existent information.\n\nPR-URL: https://github.com/nodejs/node/pull/26222\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>",
    "sha": "6c52ef982598fac1cce6ec9cb3831b806295f45c",
    "files": [
        {
            "sha": "9099c33e9efcc995b59868b169b3516098940baf",
            "filename": "lib/internal/util/inspect.js",
            "status": "modified",
            "additions": 17,
            "deletions": 6,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/6c52ef982598fac1cce6ec9cb3831b806295f45c/lib%2Finternal%2Futil%2Finspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/6c52ef982598fac1cce6ec9cb3831b806295f45c/lib%2Finternal%2Futil%2Finspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspect.js?ref=6c52ef982598fac1cce6ec9cb3831b806295f45c",
            "patch": "@@ -540,6 +540,15 @@ function formatValue(ctx, value, recurseTimes, typedArray) {\n   return formatRaw(ctx, value, recurseTimes, typedArray);\n }\n \n+function setIteratorBraces(type, tag) {\n+  if (tag !== `${type} Iterator`) {\n+    if (tag !== '')\n+      tag += '] [';\n+    tag += `${type} Iterator`;\n+  }\n+  return [`[${tag}] {`, '}'];\n+}\n+\n function formatRaw(ctx, value, recurseTimes, typedArray) {\n   let keys;\n \n@@ -594,11 +603,11 @@ function formatRaw(ctx, value, recurseTimes, typedArray) {\n       extrasType = kArrayExtrasType;\n     } else if (isMapIterator(value)) {\n       keys = getKeys(value, ctx.showHidden);\n-      braces = [`[${tag}] {`, '}'];\n+      braces = setIteratorBraces('Map', tag);\n       formatter = formatIterator;\n     } else if (isSetIterator(value)) {\n       keys = getKeys(value, ctx.showHidden);\n-      braces = [`[${tag}] {`, '}'];\n+      braces = setIteratorBraces('Set', tag);\n       formatter = formatIterator;\n     } else {\n       noIterator = true;\n@@ -730,10 +739,10 @@ function formatRaw(ctx, value, recurseTimes, typedArray) {\n         }\n       }\n       if (isMapIterator(value)) {\n-        braces = [`[${tag || 'Map Iterator'}] {`, '}'];\n+        braces = setIteratorBraces('Map', tag);\n         formatter = formatIterator;\n       } else if (isSetIterator(value)) {\n-        braces = [`[${tag || 'Set Iterator'}] {`, '}'];\n+        braces = setIteratorBraces('Set', tag);\n         formatter = formatIterator;\n       // Handle other regular objects again.\n       } else if (keys.length === 0) {\n@@ -755,7 +764,7 @@ function formatRaw(ctx, value, recurseTimes, typedArray) {\n   let output;\n   const indentationLvl = ctx.indentationLvl;\n   try {\n-    output = formatter(ctx, value, recurseTimes, keys);\n+    output = formatter(ctx, value, recurseTimes, keys, braces);\n     for (i = 0; i < keys.length; i++) {\n       output.push(\n         formatProperty(ctx, value, recurseTimes, keys[i], extrasType));\n@@ -1091,9 +1100,11 @@ function formatWeakMap(ctx, value, recurseTimes) {\n   return formatMapIterInner(ctx, recurseTimes, entries, kWeak);\n }\n \n-function formatIterator(ctx, value, recurseTimes) {\n+function formatIterator(ctx, value, recurseTimes, keys, braces) {\n   const [entries, isKeyValue] = previewEntries(value, true);\n   if (isKeyValue) {\n+    // Mark entry iterators as such.\n+    braces[0] = braces[0].replace(/ Iterator] {$/, ' Entries] {');\n     return formatMapIterInner(ctx, recurseTimes, entries, kMapEntries);\n   }\n "
        },
        {
            "sha": "21a06343235060de6b99a91bbc2d8fdee2f43da0",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 13,
            "deletions": 5,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/6c52ef982598fac1cce6ec9cb3831b806295f45c/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/6c52ef982598fac1cce6ec9cb3831b806295f45c/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=6c52ef982598fac1cce6ec9cb3831b806295f45c",
            "patch": "@@ -976,10 +976,15 @@ if (typeof Symbol !== 'undefined') {\n {\n   const map = new Map([['foo', 'bar']]);\n   assert.strictEqual(util.inspect(map.keys()), '[Map Iterator] { \\'foo\\' }');\n-  assert.strictEqual(util.inspect(map.values()), '[Map Iterator] { \\'bar\\' }');\n+  const mapValues = map.values();\n+  Object.defineProperty(mapValues, Symbol.toStringTag, { value: 'Foo' });\n+  assert.strictEqual(\n+    util.inspect(mapValues),\n+    '[Foo] [Map Iterator] { \\'bar\\' }'\n+  );\n   map.set('A', 'B!');\n   assert.strictEqual(util.inspect(map.entries(), { maxArrayLength: 1 }),\n-                     \"[Map Iterator] { [ 'foo', 'bar' ], ... 1 more item }\");\n+                     \"[Map Entries] { [ 'foo', 'bar' ], ... 1 more item }\");\n   // Make sure the iterator doesn't get consumed.\n   const keys = map.keys();\n   assert.strictEqual(util.inspect(keys), \"[Map Iterator] { 'foo', 'A' }\");\n@@ -995,10 +1000,13 @@ if (typeof Symbol !== 'undefined') {\n   const aSet = new Set([1, 3]);\n   assert.strictEqual(util.inspect(aSet.keys()), '[Set Iterator] { 1, 3 }');\n   assert.strictEqual(util.inspect(aSet.values()), '[Set Iterator] { 1, 3 }');\n-  assert.strictEqual(util.inspect(aSet.entries()),\n-                     '[Set Iterator] { [ 1, 1 ], [ 3, 3 ] }');\n+  const setEntries = aSet.entries();\n+  Object.defineProperty(setEntries, Symbol.toStringTag, { value: 'Foo' });\n+  assert.strictEqual(util.inspect(setEntries),\n+                     '[Foo] [Set Entries] { [ 1, 1 ], [ 3, 3 ] }');\n   // Make sure the iterator doesn't get consumed.\n   const keys = aSet.keys();\n+  Object.defineProperty(keys, Symbol.toStringTag, { value: null });\n   assert.strictEqual(util.inspect(keys), '[Set Iterator] { 1, 3 }');\n   assert.strictEqual(util.inspect(keys), '[Set Iterator] { 1, 3 }');\n   keys.extra = true;\n@@ -1610,7 +1618,7 @@ assert.strictEqual(util.inspect('\"\\'${a}'), \"'\\\"\\\\'${a}'\");\n   [{ a: 5 }, '{ a: 5 }'],\n   [new Set([1, 2]), 'Set { 1, 2 }'],\n   [new Map([[1, 2]]), 'Map { 1 => 2 }'],\n-  [new Set([1, 2]).entries(), '[Set Iterator] { [ 1, 1 ], [ 2, 2 ] }'],\n+  [new Set([1, 2]).entries(), '[Set Entries] { [ 1, 1 ], [ 2, 2 ] }'],\n   [new Map([[1, 2]]).keys(), '[Map Iterator] { 1 }'],\n   [new Date(2000), '1970-01-01T00:00:02.000Z'],\n   [new Uint8Array(2), 'Uint8Array [ 0, 0 ]'],"
        }
    ],
    "stats": {
        "total": 41,
        "additions": 30,
        "deletions": 11
    }
}