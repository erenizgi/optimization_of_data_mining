{
    "author": "unknown",
    "message": "dns: type check for dns.setServers argument.\n\nAdded type check for argument for dns.setServers and dnsPromises.setServers.\n\nPR-URL: https://github.com/nodejs/node/pull/21944\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: Yuta Hiroto <hello@hiroppy.me>\nReviewed-By: Tobias Nießen <tniessen@tnie.de>\nReviewed-By: Сковорода Никита Андреевич <chalkerx@gmail.com>",
    "sha": "4e1c4e81934e28dd4731a910fbed7d8fd2519bf4",
    "files": [
        {
            "sha": "f6bace7528fc3acb5f9b89d0cb15af629022d01e",
            "filename": "lib/internal/dns/utils.js",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/4e1c4e81934e28dd4731a910fbed7d8fd2519bf4/lib%2Finternal%2Fdns%2Futils.js",
            "raw_url": "https://github.com/nodejs/node/raw/4e1c4e81934e28dd4731a910fbed7d8fd2519bf4/lib%2Finternal%2Fdns%2Futils.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fdns%2Futils.js?ref=4e1c4e81934e28dd4731a910fbed7d8fd2519bf4",
            "patch": "@@ -12,6 +12,7 @@ const IPv6RE = /^\\[([^[\\]]*)\\]/;\n const addrSplitRE = /(^.+?)(?::(\\d+))?$/;\n const {\n   ERR_DNS_SET_SERVERS_FAILED,\n+  ERR_INVALID_ARG_TYPE,\n   ERR_INVALID_IP_ADDRESS,\n   ERR_INVALID_OPT_VALUE\n } = errors.codes;\n@@ -37,13 +38,20 @@ class Resolver {\n   }\n \n   setServers(servers) {\n+    if (!Array.isArray(servers)) {\n+      throw new ERR_INVALID_ARG_TYPE('servers', 'Array', servers);\n+    }\n+\n     // Cache the original servers because in the event of an error while\n     // setting the servers, c-ares won't have any servers available for\n     // resolution.\n     const orig = this._handle.getServers();\n     const newSet = [];\n \n-    servers.forEach((serv) => {\n+    servers.forEach((serv, index) => {\n+      if (typeof serv !== 'string') {\n+        throw new ERR_INVALID_ARG_TYPE(`servers[${index}]`, 'string', serv);\n+      }\n       var ipVersion = isIP(serv);\n \n       if (ipVersion !== 0)"
        },
        {
            "sha": "256c029427b86a5428c66daaa4e314262dd7dec9",
            "filename": "test/parallel/test-dns-setservers-type-check.js",
            "status": "added",
            "additions": 87,
            "deletions": 0,
            "changes": 87,
            "blob_url": "https://github.com/nodejs/node/blob/4e1c4e81934e28dd4731a910fbed7d8fd2519bf4/test%2Fparallel%2Ftest-dns-setservers-type-check.js",
            "raw_url": "https://github.com/nodejs/node/raw/4e1c4e81934e28dd4731a910fbed7d8fd2519bf4/test%2Fparallel%2Ftest-dns-setservers-type-check.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-dns-setservers-type-check.js?ref=4e1c4e81934e28dd4731a910fbed7d8fd2519bf4",
            "patch": "@@ -0,0 +1,87 @@\n+'use strict';\n+require('../common');\n+const { addresses } = require('../common/internet');\n+const assert = require('assert');\n+const dns = require('dns');\n+const resolver = new dns.promises.Resolver();\n+const dnsPromises = dns.promises;\n+const promiseResolver = new dns.promises.Resolver();\n+\n+{\n+  [\n+    null,\n+    undefined,\n+    Number(addresses.DNS4_SERVER),\n+    addresses.DNS4_SERVER,\n+    {\n+      address: addresses.DNS4_SERVER\n+    }\n+  ].forEach((val) => {\n+    const errObj = {\n+      code: 'ERR_INVALID_ARG_TYPE',\n+      name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n+      message: 'The \"servers\" argument must be of type Array. Received type ' +\n+      typeof val\n+    };\n+    assert.throws(\n+      () => {\n+        dns.setServers(val);\n+      }, errObj\n+    );\n+    assert.throws(\n+      () => {\n+        resolver.setServers(val);\n+      }, errObj\n+    );\n+    assert.throws(\n+      () => {\n+        dnsPromises.setServers(val);\n+      }, errObj\n+    );\n+    assert.throws(\n+      () => {\n+        promiseResolver.setServers(val);\n+      }, errObj\n+    );\n+  });\n+}\n+\n+{\n+  [\n+    [null],\n+    [undefined],\n+    [Number(addresses.DNS4_SERVER)],\n+    [\n+      {\n+        address: addresses.DNS4_SERVER\n+      }\n+    ]\n+  ].forEach((val) => {\n+    const errObj = {\n+      code: 'ERR_INVALID_ARG_TYPE',\n+      name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n+      message: 'The \"servers[0]\" argument must be of type string. ' +\n+               `Received type ${typeof val[0]}`\n+    };\n+    assert.throws(\n+      () => {\n+        dns.setServers(val);\n+      }, errObj\n+    );\n+    assert.throws(\n+      () => {\n+        resolver.setServers(val);\n+      }, errObj\n+    );\n+    assert.throws(\n+      () => {\n+        dnsPromises.setServers(val);\n+      }, errObj\n+    );\n+    assert.throws(\n+      () => {\n+        promiseResolver.setServers(val);\n+      }, errObj\n+    );\n+  });\n+}"
        }
    ],
    "stats": {
        "total": 97,
        "additions": 96,
        "deletions": 1
    }
}