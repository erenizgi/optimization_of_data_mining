{
    "author": "targos",
    "message": "process: migrate methods to throw errors with code\n\nMigrate some methods from node.cc to JS in order to properly throw\nerrors with codes.\n\nPR-URL: https://github.com/nodejs/node/pull/19973\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "2fd248f639981c72794efef397dfae5263ebdff5",
    "files": [
        {
            "sha": "84db161af8d4e08bbce551277d20fc137641c89d",
            "filename": "doc/api/errors.md",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/doc%2Fapi%2Ferrors.md",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/doc%2Fapi%2Ferrors.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ferrors.md?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -1607,6 +1607,11 @@ A string that contained unescaped characters was received.\n An unhandled error occurred (for instance, when an `'error'` event is emitted\n by an [`EventEmitter`][] but an `'error'` handler is not registered).\n \n+<a id=\"ERR_UNKNOWN_CREDENTIAL\"></a>\n+### ERR_UNKNOWN_CREDENTIAL\n+\n+A Unix group or user identifier that does not exist was passed.\n+\n <a id=\"ERR_UNKNOWN_ENCODING\"></a>\n ### ERR_UNKNOWN_ENCODING\n "
        },
        {
            "sha": "5993cc71f7d404678745fb9db22c01f36ec4aaae",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -41,6 +41,7 @@\n     NativeModule.require('internal/process/warning').setup();\n     NativeModule.require('internal/process/next_tick').setup();\n     NativeModule.require('internal/process/stdio').setup();\n+    NativeModule.require('internal/process/methods').setup();\n \n     const perf = process.binding('performance');\n     const {"
        },
        {
            "sha": "882e40af88ae75c9097da82a9a59704a1aab2cb3",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -1017,6 +1017,7 @@ E('ERR_UNHANDLED_ERROR',\n     if (err === undefined) return msg;\n     return `${msg} (${err})`;\n   }, Error);\n+E('ERR_UNKNOWN_CREDENTIAL', '%s identifier does not exist: %s', Error);\n E('ERR_UNKNOWN_ENCODING', 'Unknown encoding: %s', TypeError);\n \n // This should probably be a `TypeError`."
        },
        {
            "sha": "503fd317f60395e4ea283b697059818318800c3f",
            "filename": "lib/internal/process/methods.js",
            "status": "added",
            "additions": 137,
            "deletions": 0,
            "changes": 137,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/lib%2Finternal%2Fprocess%2Fmethods.js",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/lib%2Finternal%2Fprocess%2Fmethods.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fmethods.js?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -0,0 +1,137 @@\n+'use strict';\n+\n+const {\n+  ERR_INVALID_ARG_TYPE,\n+  ERR_INVALID_ARG_VALUE,\n+  ERR_UNKNOWN_CREDENTIAL\n+} = require('internal/errors').codes;\n+const {\n+  validateUint32\n+} = require('internal/validators');\n+\n+function setupProcessMethods() {\n+  // Non-POSIX platforms like Windows don't have certain methods.\n+  if (process.setgid !== undefined) {\n+    setupPosixMethods();\n+  }\n+\n+  const {\n+    chdir: _chdir,\n+    umask: _umask,\n+  } = process;\n+\n+  process.chdir = chdir;\n+  process.umask = umask;\n+\n+  function chdir(directory) {\n+    if (typeof directory !== 'string') {\n+      throw new ERR_INVALID_ARG_TYPE('directory', 'string', directory);\n+    }\n+    return _chdir(directory);\n+  }\n+\n+  const octalReg = /^[0-7]+$/;\n+  function umask(mask) {\n+    if (typeof mask === 'undefined') {\n+      return _umask(mask);\n+    }\n+\n+    if (typeof mask === 'number') {\n+      validateUint32(mask, 'mask');\n+      return _umask(mask);\n+    }\n+\n+    if (typeof mask === 'string') {\n+      if (!octalReg.test(mask)) {\n+        throw new ERR_INVALID_ARG_VALUE('mask', mask,\n+                                        'must be an octal string');\n+      }\n+      const octal = Number.parseInt(mask, 8);\n+      validateUint32(octal, 'mask');\n+      return _umask(octal);\n+    }\n+\n+    throw new ERR_INVALID_ARG_TYPE('mask', ['number', 'string', 'undefined'],\n+                                   mask);\n+  }\n+}\n+\n+function setupPosixMethods() {\n+  const {\n+    initgroups: _initgroups,\n+    setegid: _setegid,\n+    seteuid: _seteuid,\n+    setgid: _setgid,\n+    setuid: _setuid,\n+    setgroups: _setgroups\n+  } = process;\n+\n+  process.initgroups = initgroups;\n+  process.setegid = setegid;\n+  process.seteuid = seteuid;\n+  process.setgid = setgid;\n+  process.setuid = setuid;\n+  process.setgroups = setgroups;\n+\n+  function initgroups(user, extraGroup) {\n+    validateId(user, 'user');\n+    validateId(extraGroup, 'extraGroup');\n+    // Result is 0 on success, 1 if user is unknown, 2 if group is unknown.\n+    const result = _initgroups(user, extraGroup);\n+    if (result === 1) {\n+      throw new ERR_UNKNOWN_CREDENTIAL('User', user);\n+    } else if (result === 2) {\n+      throw new ERR_UNKNOWN_CREDENTIAL('Group', extraGroup);\n+    }\n+  }\n+\n+  function setegid(id) {\n+    return execId(id, 'Group', _setegid);\n+  }\n+\n+  function seteuid(id) {\n+    return execId(id, 'User', _seteuid);\n+  }\n+\n+  function setgid(id) {\n+    return execId(id, 'Group', _setgid);\n+  }\n+\n+  function setuid(id) {\n+    return execId(id, 'User', _setuid);\n+  }\n+\n+  function setgroups(groups) {\n+    if (!Array.isArray(groups)) {\n+      throw new ERR_INVALID_ARG_TYPE('groups', 'Array', groups);\n+    }\n+    for (var i = 0; i < groups.length; i++) {\n+      validateId(groups[i], `groups[${i}]`);\n+    }\n+    // Result is 0 on success. A positive integer indicates that the\n+    // corresponding group was not found.\n+    const result = _setgroups(groups);\n+    if (result > 0) {\n+      throw new ERR_UNKNOWN_CREDENTIAL('Group', groups[result - 1]);\n+    }\n+  }\n+\n+  function execId(id, type, method) {\n+    validateId(id, 'id');\n+    // Result is 0 on success, 1 if credential is unknown.\n+    const result = method(id);\n+    if (result === 1) {\n+      throw new ERR_UNKNOWN_CREDENTIAL(type, id);\n+    }\n+  }\n+\n+  function validateId(id, name) {\n+    if (typeof id === 'number') {\n+      validateUint32(id, name);\n+    } else if (typeof id !== 'string') {\n+      throw new ERR_INVALID_ARG_TYPE(name, ['number', 'string'], id);\n+    }\n+  }\n+}\n+\n+exports.setup = setupProcessMethods;"
        },
        {
            "sha": "ba65eafee9a49d7642a0141e1dd8eb6a440732ed",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -118,6 +118,7 @@\n       'lib/internal/net.js',\n       'lib/internal/os.js',\n       'lib/internal/process/esm_loader.js',\n+      'lib/internal/process/methods.js',\n       'lib/internal/process/next_tick.js',\n       'lib/internal/process/promises.js',\n       'lib/internal/process/stdio.js',"
        },
        {
            "sha": "07dc4f13fdc07cbf916c6b8732dff625120c7d01",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 56,
            "deletions": 70,
            "changes": 126,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -164,6 +164,7 @@ using v8::ScriptOrigin;\n using v8::SealHandleScope;\n using v8::String;\n using v8::TryCatch;\n+using v8::Uint32;\n using v8::Uint32Array;\n using v8::Undefined;\n using v8::V8;\n@@ -1580,10 +1581,8 @@ static void Abort(const FunctionCallbackInfo<Value>& args) {\n static void Chdir(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  if (args.Length() != 1 || !args[0]->IsString()) {\n-    return env->ThrowTypeError(\"Bad argument.\");\n-  }\n-\n+  CHECK_EQ(args.Length(), 1);\n+  CHECK(args[0]->IsString());\n   node::Utf8Value path(args.GetIsolate(), args[0]);\n   int err = uv_chdir(*path);\n   if (err) {\n@@ -1616,32 +1615,16 @@ static void Cwd(const FunctionCallbackInfo<Value>& args) {\n \n \n static void Umask(const FunctionCallbackInfo<Value>& args) {\n-  Environment* env = Environment::GetCurrent(args);\n   uint32_t old;\n \n-  if (args.Length() < 1 || args[0]->IsUndefined()) {\n+  CHECK_EQ(args.Length(), 1);\n+  CHECK(args[0]->IsUndefined() || args[0]->IsUint32());\n+\n+  if (args[0]->IsUndefined()) {\n     old = umask(0);\n     umask(static_cast<mode_t>(old));\n-  } else if (!args[0]->IsInt32() && !args[0]->IsString()) {\n-    return env->ThrowTypeError(\"argument must be an integer or octal string.\");\n   } else {\n-    int oct;\n-    if (args[0]->IsInt32()) {\n-      oct = args[0]->Uint32Value();\n-    } else {\n-      oct = 0;\n-      node::Utf8Value str(env->isolate(), args[0]);\n-\n-      // Parse the octal string.\n-      for (size_t i = 0; i < str.length(); i++) {\n-        char c = (*str)[i];\n-        if (c > '7' || c < '0') {\n-          return env->ThrowTypeError(\"invalid octal string\");\n-        }\n-        oct *= 8;\n-        oct += c - '0';\n-      }\n-    }\n+    int oct = args[0].As<Uint32>()->Value();\n     old = umask(static_cast<mode_t>(oct));\n   }\n \n@@ -1779,75 +1762,75 @@ static void GetEGid(const FunctionCallbackInfo<Value>& args) {\n static void SetGid(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  if (!args[0]->IsUint32() && !args[0]->IsString()) {\n-    return env->ThrowTypeError(\"setgid argument must be a number or a string\");\n-  }\n+  CHECK_EQ(args.Length(), 1);\n+  CHECK(args[0]->IsUint32() || args[0]->IsString());\n \n   gid_t gid = gid_by_name(env->isolate(), args[0]);\n \n   if (gid == gid_not_found) {\n-    return env->ThrowError(\"setgid group id does not exist\");\n-  }\n-\n-  if (setgid(gid)) {\n-    return env->ThrowErrnoException(errno, \"setgid\");\n+    // Tells JS to throw ERR_INVALID_CREDENTIAL\n+    args.GetReturnValue().Set(1);\n+  } else if (setgid(gid)) {\n+    env->ThrowErrnoException(errno, \"setgid\");\n+  } else {\n+    args.GetReturnValue().Set(0);\n   }\n }\n \n \n static void SetEGid(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  if (!args[0]->IsUint32() && !args[0]->IsString()) {\n-    return env->ThrowTypeError(\"setegid argument must be a number or string\");\n-  }\n+  CHECK_EQ(args.Length(), 1);\n+  CHECK(args[0]->IsUint32() || args[0]->IsString());\n \n   gid_t gid = gid_by_name(env->isolate(), args[0]);\n \n   if (gid == gid_not_found) {\n-    return env->ThrowError(\"setegid group id does not exist\");\n-  }\n-\n-  if (setegid(gid)) {\n-    return env->ThrowErrnoException(errno, \"setegid\");\n+    // Tells JS to throw ERR_INVALID_CREDENTIAL\n+    args.GetReturnValue().Set(1);\n+  } else if (setegid(gid)) {\n+    env->ThrowErrnoException(errno, \"setegid\");\n+  } else {\n+    args.GetReturnValue().Set(0);\n   }\n }\n \n \n static void SetUid(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  if (!args[0]->IsUint32() && !args[0]->IsString()) {\n-    return env->ThrowTypeError(\"setuid argument must be a number or a string\");\n-  }\n+  CHECK_EQ(args.Length(), 1);\n+  CHECK(args[0]->IsUint32() || args[0]->IsString());\n \n   uid_t uid = uid_by_name(env->isolate(), args[0]);\n \n   if (uid == uid_not_found) {\n-    return env->ThrowError(\"setuid user id does not exist\");\n-  }\n-\n-  if (setuid(uid)) {\n-    return env->ThrowErrnoException(errno, \"setuid\");\n+    // Tells JS to throw ERR_INVALID_CREDENTIAL\n+    args.GetReturnValue().Set(1);\n+  } else if (setuid(uid)) {\n+    env->ThrowErrnoException(errno, \"setuid\");\n+  } else {\n+    args.GetReturnValue().Set(0);\n   }\n }\n \n \n static void SetEUid(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  if (!args[0]->IsUint32() && !args[0]->IsString()) {\n-    return env->ThrowTypeError(\"seteuid argument must be a number or string\");\n-  }\n+  CHECK_EQ(args.Length(), 1);\n+  CHECK(args[0]->IsUint32() || args[0]->IsString());\n \n   uid_t uid = uid_by_name(env->isolate(), args[0]);\n \n   if (uid == uid_not_found) {\n-    return env->ThrowError(\"seteuid user id does not exist\");\n-  }\n-\n-  if (seteuid(uid)) {\n-    return env->ThrowErrnoException(errno, \"seteuid\");\n+    // Tells JS to throw ERR_INVALID_CREDENTIAL\n+    args.GetReturnValue().Set(1);\n+  } else if (seteuid(uid)) {\n+    env->ThrowErrnoException(errno, \"seteuid\");\n+  } else {\n+    args.GetReturnValue().Set(0);\n   }\n }\n \n@@ -1893,9 +1876,8 @@ static void GetGroups(const FunctionCallbackInfo<Value>& args) {\n static void SetGroups(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  if (!args[0]->IsArray()) {\n-    return env->ThrowTypeError(\"argument 1 must be an array\");\n-  }\n+  CHECK_EQ(args.Length(), 1);\n+  CHECK(args[0]->IsArray());\n \n   Local<Array> groups_list = args[0].As<Array>();\n   size_t size = groups_list->Length();\n@@ -1906,7 +1888,9 @@ static void SetGroups(const FunctionCallbackInfo<Value>& args) {\n \n     if (gid == gid_not_found) {\n       delete[] groups;\n-      return env->ThrowError(\"group name not found\");\n+      // Tells JS to throw ERR_INVALID_CREDENTIAL\n+      args.GetReturnValue().Set(static_cast<uint32_t>(i + 1));\n+      return;\n     }\n \n     groups[i] = gid;\n@@ -1918,19 +1902,17 @@ static void SetGroups(const FunctionCallbackInfo<Value>& args) {\n   if (rc == -1) {\n     return env->ThrowErrnoException(errno, \"setgroups\");\n   }\n+\n+  args.GetReturnValue().Set(0);\n }\n \n \n static void InitGroups(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  if (!args[0]->IsUint32() && !args[0]->IsString()) {\n-    return env->ThrowTypeError(\"argument 1 must be a number or a string\");\n-  }\n-\n-  if (!args[1]->IsUint32() && !args[1]->IsString()) {\n-    return env->ThrowTypeError(\"argument 2 must be a number or a string\");\n-  }\n+  CHECK_EQ(args.Length(), 2);\n+  CHECK(args[0]->IsUint32() || args[0]->IsString());\n+  CHECK(args[1]->IsUint32() || args[1]->IsString());\n \n   node::Utf8Value arg0(env->isolate(), args[0]);\n   gid_t extra_group;\n@@ -1946,15 +1928,17 @@ static void InitGroups(const FunctionCallbackInfo<Value>& args) {\n   }\n \n   if (user == nullptr) {\n-    return env->ThrowError(\"initgroups user not found\");\n+    // Tells JS to throw ERR_INVALID_CREDENTIAL\n+    return args.GetReturnValue().Set(1);\n   }\n \n   extra_group = gid_by_name(env->isolate(), args[1]);\n \n   if (extra_group == gid_not_found) {\n     if (must_free)\n       free(user);\n-    return env->ThrowError(\"initgroups extra group not found\");\n+    // Tells JS to throw ERR_INVALID_CREDENTIAL\n+    return args.GetReturnValue().Set(2);\n   }\n \n   int rc = initgroups(user, extra_group);\n@@ -1966,6 +1950,8 @@ static void InitGroups(const FunctionCallbackInfo<Value>& args) {\n   if (rc) {\n     return env->ThrowErrnoException(errno, \"initgroups\");\n   }\n+\n+  args.GetReturnValue().Set(0);\n }\n \n #endif  // __POSIX__ && !defined(__ANDROID__) && !defined(__CloudABI__)"
        },
        {
            "sha": "998147dd43dfc8b485a8a64845e31ef97d41f1b8",
            "filename": "test/parallel/test-process-chdir.js",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/test%2Fparallel%2Ftest-process-chdir.js",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/test%2Fparallel%2Ftest-process-chdir.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-chdir.js?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-require('../common');\n+const common = require('../common');\n const assert = require('assert');\n const fs = require('fs');\n const path = require('path');\n@@ -33,10 +33,9 @@ process.chdir('..');\n assert.strictEqual(process.cwd().normalize(),\n                    path.resolve(tmpdir.path).normalize());\n \n-const errMessage = /^TypeError: Bad argument\\.$/;\n-assert.throws(function() { process.chdir({}); },\n-              errMessage, 'Bad argument.');\n-assert.throws(function() { process.chdir(); },\n-              errMessage, 'Bad argument.');\n-assert.throws(function() { process.chdir('x', 'y'); },\n-              errMessage, 'Bad argument.');\n+const err = {\n+  code: 'ERR_INVALID_ARG_TYPE',\n+  message: /The \"directory\" argument must be of type string/\n+};\n+common.expectsError(function() { process.chdir({}); }, err);\n+common.expectsError(function() { process.chdir(); }, err);"
        },
        {
            "sha": "84fbd03e327b05e80dbc805903927d0a60721c6b",
            "filename": "test/parallel/test-process-euid-egid.js",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/test%2Fparallel%2Ftest-process-euid-egid.js",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/test%2Fparallel%2Ftest-process-euid-egid.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-euid-egid.js?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -13,11 +13,18 @@ if (common.isWindows) {\n \n assert.throws(() => {\n   process.seteuid({});\n-}, /^TypeError: seteuid argument must be a number or string$/);\n+}, {\n+  code: 'ERR_INVALID_ARG_TYPE',\n+  message: 'The \"id\" argument must be one of type number or string. ' +\n+    'Received type object'\n+});\n \n assert.throws(() => {\n-  process.seteuid('fhqwhgadshgnsdhjsdbkhsdabkfabkveybvf');\n-}, /^Error: seteuid user id does not exist$/);\n+  process.seteuid('fhqwhgadshgnsdhjsdbkhsdabkfabkveyb');\n+}, {\n+  code: 'ERR_UNKNOWN_CREDENTIAL',\n+  message: 'User identifier does not exist: fhqwhgadshgnsdhjsdbkhsdabkfabkveyb'\n+});\n \n // If we're not running as super user...\n if (process.getuid() !== 0) {\n@@ -27,11 +34,11 @@ if (process.getuid() !== 0) {\n \n   assert.throws(() => {\n     process.setegid('nobody');\n-  }, /^Error: (?:EPERM, .+|setegid group id does not exist)$/);\n+  }, /(?:EPERM, .+|Group identifier does not exist: nobody)$/);\n \n   assert.throws(() => {\n     process.seteuid('nobody');\n-  }, /^Error: (?:EPERM, .+|seteuid user id does not exist)$/);\n+  }, /^Error: (?:EPERM, .+|User identifier does not exist: nobody)$/);\n \n   return;\n }\n@@ -41,7 +48,7 @@ const oldgid = process.getegid();\n try {\n   process.setegid('nobody');\n } catch (err) {\n-  if (err.message !== 'setegid group id does not exist') {\n+  if (err.message !== 'Group identifier does not exist: nobody') {\n     throw err;\n   } else {\n     process.setegid('nogroup');"
        },
        {
            "sha": "24751943092761072f7e346d1ace60fc332e3767",
            "filename": "test/parallel/test-process-uid-gid.js",
            "status": "modified",
            "additions": 12,
            "deletions": 5,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/test%2Fparallel%2Ftest-process-uid-gid.js",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/test%2Fparallel%2Ftest-process-uid-gid.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-uid-gid.js?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -35,11 +35,18 @@ if (common.isWindows) {\n \n assert.throws(() => {\n   process.setuid({});\n-}, /^TypeError: setuid argument must be a number or a string$/);\n+}, {\n+  code: 'ERR_INVALID_ARG_TYPE',\n+  message: 'The \"id\" argument must be one of type ' +\n+    'number or string. Received type object'\n+});\n \n assert.throws(() => {\n-  process.setuid('fhqwhgadshgnsdhjsdbkhsdabkfabkveybvf');\n-}, /^Error: setuid user id does not exist$/);\n+  process.setuid('fhqwhgadshgnsdhjsdbkhsdabkfabkveyb');\n+}, {\n+  code: 'ERR_UNKNOWN_CREDENTIAL',\n+  message: 'User identifier does not exist: fhqwhgadshgnsdhjsdbkhsdabkfabkveyb'\n+});\n \n // If we're not running as super user...\n if (process.getuid() !== 0) {\n@@ -49,12 +56,12 @@ if (process.getuid() !== 0) {\n \n   assert.throws(\n     () => { process.setgid('nobody'); },\n-    /^Error: (?:EPERM, .+|setgid group id does not exist)$/\n+    /(?:EPERM, .+|Group identifier does not exist: nobody)$/\n   );\n \n   assert.throws(\n     () => { process.setuid('nobody'); },\n-    /^Error: (?:EPERM, .+|setuid user id does not exist)$/\n+    /(?:EPERM, .+|User identifier does not exist: nobody)$/\n   );\n   return;\n }"
        },
        {
            "sha": "869619f191a78bf7bede07c3d2ca03566c6985d2",
            "filename": "test/parallel/test-process-umask.js",
            "status": "renamed",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/2fd248f639981c72794efef397dfae5263ebdff5/test%2Fparallel%2Ftest-process-umask.js",
            "raw_url": "https://github.com/nodejs/node/raw/2fd248f639981c72794efef397dfae5263ebdff5/test%2Fparallel%2Ftest-process-umask.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-umask.js?ref=2fd248f639981c72794efef397dfae5263ebdff5",
            "patch": "@@ -43,8 +43,17 @@ assert.strictEqual(old, process.umask());\n \n assert.throws(() => {\n   process.umask({});\n-}, /argument must be an integer or octal string/);\n+}, {\n+  code: 'ERR_INVALID_ARG_TYPE',\n+  message: 'The \"mask\" argument must be one of type number, string, or ' +\n+    'undefined. Received type object'\n+});\n \n-assert.throws(() => {\n-  process.umask('123x');\n-}, /invalid octal string/);\n+['123x', 'abc', '999'].forEach((value) => {\n+  assert.throws(() => {\n+    process.umask(value);\n+  }, {\n+    code: 'ERR_INVALID_ARG_VALUE',\n+    message: `The argument 'mask' must be an octal string. Received '${value}'`\n+  });\n+});",
            "previous_filename": "test/parallel/test-umask.js"
        }
    ],
    "stats": {
        "total": 339,
        "additions": 246,
        "deletions": 93
    }
}