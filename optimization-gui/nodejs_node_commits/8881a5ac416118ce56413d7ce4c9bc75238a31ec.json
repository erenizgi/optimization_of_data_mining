{
    "author": "cjihrig",
    "message": "test: make test-v8-coverage.js more strict\n\nUpdate the coverage test to verify that nothing is printed to\nstderr (which happens when coverage errors happen). Also add a\ntest case to verify that non-absolute coverage paths work.\n\nPR-URL: https://github.com/nodejs/node/pull/25289\nFixes: https://github.com/nodejs/node/issues/25287\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Yuta Hiroto <hello@hiroppy.me>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "8881a5ac416118ce56413d7ce4c9bc75238a31ec",
    "files": [
        {
            "sha": "e1520a04115e42445377d3c55ebec47243cee6d5",
            "filename": "test/parallel/test-v8-coverage.js",
            "status": "modified",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/8881a5ac416118ce56413d7ce4c9bc75238a31ec/test%2Fparallel%2Ftest-v8-coverage.js",
            "raw_url": "https://github.com/nodejs/node/raw/8881a5ac416118ce56413d7ce4c9bc75238a31ec/test%2Fparallel%2Ftest-v8-coverage.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-v8-coverage.js?ref=8881a5ac416118ce56413d7ce4c9bc75238a31ec",
            "patch": "@@ -23,6 +23,7 @@ function nextdir() {\n     require.resolve('../fixtures/v8-coverage/basic')\n   ], { env: { ...process.env, NODE_V8_COVERAGE: coverageDirectory } });\n   assert.strictEqual(output.status, 0);\n+  assert.strictEqual(output.stderr.toString(), '');\n   const fixtureCoverage = getFixtureCoverage('basic.js', coverageDirectory);\n   assert.ok(fixtureCoverage);\n   // first branch executed.\n@@ -38,6 +39,7 @@ function nextdir() {\n     require.resolve('../fixtures/v8-coverage/exit-1')\n   ], { env: { ...process.env, NODE_V8_COVERAGE: coverageDirectory } });\n   assert.strictEqual(output.status, 1);\n+  assert.strictEqual(output.stderr.toString(), '');\n   const fixtureCoverage = getFixtureCoverage('exit-1.js', coverageDirectory);\n   assert.ok(fixtureCoverage, 'coverage not found for file');\n   // first branch executed.\n@@ -55,6 +57,7 @@ function nextdir() {\n   if (!common.isWindows) {\n     assert.strictEqual(output.signal, 'SIGINT');\n   }\n+  assert.strictEqual(output.stderr.toString(), '');\n   const fixtureCoverage = getFixtureCoverage('sigint.js', coverageDirectory);\n   assert.ok(fixtureCoverage);\n   // first branch executed.\n@@ -70,6 +73,7 @@ function nextdir() {\n     require.resolve('../fixtures/v8-coverage/spawn-subprocess')\n   ], { env: { ...process.env, NODE_V8_COVERAGE: coverageDirectory } });\n   assert.strictEqual(output.status, 0);\n+  assert.strictEqual(output.stderr.toString(), '');\n   const fixtureCoverage = getFixtureCoverage('subprocess.js',\n                                              coverageDirectory);\n   assert.ok(fixtureCoverage);\n@@ -87,6 +91,7 @@ function nextdir() {\n     require.resolve('../fixtures/v8-coverage/worker')\n   ], { env: { ...process.env, NODE_V8_COVERAGE: coverageDirectory } });\n   assert.strictEqual(output.status, 0);\n+  assert.strictEqual(output.stderr.toString(), '');\n   const fixtureCoverage = getFixtureCoverage('subprocess.js',\n                                              coverageDirectory);\n   assert.ok(fixtureCoverage);\n@@ -103,6 +108,7 @@ function nextdir() {\n     require.resolve('../fixtures/v8-coverage/spawn-subprocess-no-cov')\n   ], { env: { ...process.env, NODE_V8_COVERAGE: coverageDirectory } });\n   assert.strictEqual(output.status, 0);\n+  assert.strictEqual(output.stderr.toString(), '');\n   const fixtureCoverage = getFixtureCoverage('subprocess.js',\n                                              coverageDirectory);\n   assert.strictEqual(fixtureCoverage, undefined);\n@@ -115,13 +121,35 @@ function nextdir() {\n     require.resolve('../fixtures/v8-coverage/async-hooks')\n   ], { env: { ...process.env, NODE_V8_COVERAGE: coverageDirectory } });\n   assert.strictEqual(output.status, 0);\n+  assert.strictEqual(output.stderr.toString(), '');\n   const fixtureCoverage = getFixtureCoverage('async-hooks.js',\n                                              coverageDirectory);\n   assert.ok(fixtureCoverage);\n   // first branch executed.\n   assert.strictEqual(fixtureCoverage.functions[1].ranges[0].count, 1);\n }\n \n+// Outputs coverage when the coverage directory is not absolute.\n+{\n+  const coverageDirectory = nextdir();\n+  const absoluteCoverageDirectory = path.join(tmpdir.path, coverageDirectory);\n+  const output = spawnSync(process.execPath, [\n+    require.resolve('../fixtures/v8-coverage/basic')\n+  ], {\n+    cwd: tmpdir.path,\n+    env: { ...process.env, NODE_V8_COVERAGE: coverageDirectory }\n+  });\n+  assert.strictEqual(output.status, 0);\n+  assert.strictEqual(output.stderr.toString(), '');\n+  const fixtureCoverage = getFixtureCoverage('basic.js',\n+                                             absoluteCoverageDirectory);\n+  assert.ok(fixtureCoverage);\n+  // first branch executed.\n+  assert.strictEqual(fixtureCoverage.functions[1].ranges[0].count, 1);\n+  // second branch did not execute.\n+  assert.strictEqual(fixtureCoverage.functions[1].ranges[1].count, 0);\n+}\n+\n // Extracts the coverage object for a given fixture name.\n function getFixtureCoverage(fixtureFile, coverageDirectory) {\n   const coverageFiles = fs.readdirSync(coverageDirectory);"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 28,
        "deletions": 0
    }
}