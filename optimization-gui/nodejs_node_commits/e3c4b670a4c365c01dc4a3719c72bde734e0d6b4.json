{
    "author": "refack",
    "message": "src: workaround MSVC compiler bug\n\nPR-URL: https://github.com/nodejs/node/pull/25596\nFixes: https://github.com/nodejs/node/issues/25593\nRefs: https://developercommunity.visualstudio.com/content/problem/432157/dynamic-initializers-out-of-order.html\nReviewed-By: Bartosz Sosnowski <bartosz@janeasystems.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "e3c4b670a4c365c01dc4a3719c72bde734e0d6b4",
    "files": [
        {
            "sha": "b7b924501a24ff507342bd760c2f555696037ce1",
            "filename": "src/node_options.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 10,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/e3c4b670a4c365c01dc4a3719c72bde734e0d6b4/src%2Fnode_options.cc",
            "raw_url": "https://github.com/nodejs/node/raw/e3c4b670a4c365c01dc4a3719c72bde734e0d6b4/src%2Fnode_options.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.cc?ref=e3c4b670a4c365c01dc4a3719c72bde734e0d6b4",
            "patch": "@@ -107,6 +107,20 @@ void EnvironmentOptions::CheckOptions(std::vector<std::string>* errors) {\n \n namespace options_parser {\n \n+// Explicitly access the singelton instances in their dependancy order.\n+// This was moved here to workaround a compiler bug.\n+// Refs: https://github.com/nodejs/node/issues/25593\n+\n+#if HAVE_INSPECTOR\n+const DebugOptionsParser DebugOptionsParser::instance;\n+#endif  // HAVE_INSPECTOR\n+\n+const EnvironmentOptionsParser EnvironmentOptionsParser::instance;\n+\n+const PerIsolateOptionsParser PerIsolateOptionsParser::instance;\n+\n+const PerProcessOptionsParser PerProcessOptionsParser::instance;\n+\n // XXX: If you add an option here, please also add it to doc/node.1 and\n // doc/api/cli.md\n // TODO(addaleax): Make that unnecessary.\n@@ -143,10 +157,6 @@ DebugOptionsParser::DebugOptionsParser() {\n   AddAlias(\"--debug-brk=\", { \"--inspect-port\", \"--debug-brk\" });\n }\n \n-#if HAVE_INSPECTOR\n-const DebugOptionsParser DebugOptionsParser::instance;\n-#endif  // HAVE_INSPECTOR\n-\n EnvironmentOptionsParser::EnvironmentOptionsParser() {\n   AddOption(\"--experimental-modules\",\n             \"experimental ES Module support and caching modules\",\n@@ -282,8 +292,6 @@ EnvironmentOptionsParser::EnvironmentOptionsParser() {\n #endif  // HAVE_INSPECTOR\n }\n \n-const EnvironmentOptionsParser EnvironmentOptionsParser::instance;\n-\n PerIsolateOptionsParser::PerIsolateOptionsParser() {\n   AddOption(\"--track-heap-objects\",\n             \"track heap object allocations for heap snapshots\",\n@@ -341,8 +349,6 @@ PerIsolateOptionsParser::PerIsolateOptionsParser() {\n          &PerIsolateOptions::get_per_env_options);\n }\n \n-const PerIsolateOptionsParser PerIsolateOptionsParser::instance;\n-\n PerProcessOptionsParser::PerProcessOptionsParser() {\n   AddOption(\"--title\",\n             \"the process title to use on startup\",\n@@ -449,8 +455,6 @@ PerProcessOptionsParser::PerProcessOptionsParser() {\n          &PerProcessOptions::get_per_isolate_options);\n }\n \n-const PerProcessOptionsParser PerProcessOptionsParser::instance;\n-\n inline std::string RemoveBrackets(const std::string& host) {\n   if (!host.empty() && host.front() == '[' && host.back() == ']')\n     return host.substr(1, host.size() - 2);"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 14,
        "deletions": 10
    }
}