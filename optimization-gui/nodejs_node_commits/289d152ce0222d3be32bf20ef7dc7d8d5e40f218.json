{
    "author": "joyeecheung",
    "message": "src: add error code helpers to src/node_errors.h\n\nThis commit adds node::ERR_*(isolate, message) helpers in\nthe C++ land to assign error codes to existing C++ errors.\n\nThe following errors are added:\n\n- ERR_MEMORY_ALLOCATION_FAILED\n- ERR_STRING_TOO_LARGE\n\nPR-URL: https://github.com/nodejs/node/pull/19739\nFixes: https://github.com/nodejs/node/issues/3175\nFixes: https://github.com/nodejs/node/issues/9489\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "289d152ce0222d3be32bf20ef7dc7d8d5e40f218",
    "files": [
        {
            "sha": "e96848b2960d40903a3b077cbee07c49ce77f10d",
            "filename": "doc/api/errors.md",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/289d152ce0222d3be32bf20ef7dc7d8d5e40f218/doc%2Fapi%2Ferrors.md",
            "raw_url": "https://github.com/nodejs/node/raw/289d152ce0222d3be32bf20ef7dc7d8d5e40f218/doc%2Fapi%2Ferrors.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ferrors.md?ref=289d152ce0222d3be32bf20ef7dc7d8d5e40f218",
            "patch": "@@ -1242,6 +1242,12 @@ An attempt was made to open an IPC communication channel with a synchronously\n forked Node.js process. See the documentation for the [`child_process`][] module\n for more information.\n \n+<a id=\"ERR_MEMORY_ALLOCATION_FAILED\"></a>\n+### ERR_MEMORY_ALLOCATION_FAILED\n+\n+An attempt was made to allocate memory (usually in the C++ layer) but it\n+failed.\n+\n <a id=\"ERR_METHOD_NOT_IMPLEMENTED\"></a>\n ### ERR_METHOD_NOT_IMPLEMENTED\n \n@@ -1468,6 +1474,12 @@ additional details.\n A stream method was called that cannot complete because the stream was\n destroyed using `stream.destroy()`.\n \n+<a id=\"ERR_STRING_TOO_LARGE\"></a>\n+### ERR_STRING_TOO_LARGE\n+\n+An attempt has been made to create a string larger than the maximum allowed\n+size.\n+\n <a id=\"ERR_TLS_CERT_ALTNAME_INVALID\"></a>\n ### ERR_TLS_CERT_ALTNAME_INVALID\n "
        },
        {
            "sha": "4709e5ec1e2cb6c886b64a7b1d7448c7ac024bab",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/289d152ce0222d3be32bf20ef7dc7d8d5e40f218/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/289d152ce0222d3be32bf20ef7dc7d8d5e40f218/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=289d152ce0222d3be32bf20ef7dc7d8d5e40f218",
            "patch": "@@ -316,6 +316,7 @@\n         'src/node_contextify.cc',\n         'src/node_debug_options.cc',\n         'src/node_domain.cc',\n+        'src/node_errors.h',\n         'src/node_file.cc',\n         'src/node_http2.cc',\n         'src/node_http_parser.cc',"
        },
        {
            "sha": "8e328ac2f3064479a08a676b7c31846a225282a2",
            "filename": "src/node_errors.h",
            "status": "added",
            "additions": 73,
            "deletions": 0,
            "changes": 73,
            "blob_url": "https://github.com/nodejs/node/blob/289d152ce0222d3be32bf20ef7dc7d8d5e40f218/src%2Fnode_errors.h",
            "raw_url": "https://github.com/nodejs/node/raw/289d152ce0222d3be32bf20ef7dc7d8d5e40f218/src%2Fnode_errors.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_errors.h?ref=289d152ce0222d3be32bf20ef7dc7d8d5e40f218",
            "patch": "@@ -0,0 +1,73 @@\n+#ifndef SRC_NODE_ERRORS_H_\n+#define SRC_NODE_ERRORS_H_\n+\n+#if defined(NODE_WANT_INTERNALS) && NODE_WANT_INTERNALS\n+\n+#include \"node.h\"\n+#include \"util-inl.h\"\n+#include \"env-inl.h\"\n+#include \"v8.h\"\n+\n+namespace node {\n+\n+// Helpers to construct errors similar to the ones provided by\n+// lib/internal/errors.js.\n+// Example: with `V(ERR_INVALID_ARG_TYPE, TypeError)`, there will be\n+// `node::ERR_INVALID_ARG_TYPE(isolate, \"message\")` returning\n+// a `Local<Value>` containing the TypeError with proper code and message\n+\n+#define ERRORS_WITH_CODE(V)                                                  \\\n+  V(ERR_MEMORY_ALLOCATION_FAILED, Error)                                     \\\n+  V(ERR_STRING_TOO_LARGE, Error)                                             \\\n+  V(ERR_BUFFER_TOO_LARGE, Error)\n+\n+#define V(code, type)                                                         \\\n+  inline v8::Local<v8::Value> code(v8::Isolate* isolate,                      \\\n+                                   const char* message)       {               \\\n+    v8::Local<v8::String> js_code = OneByteString(isolate, #code);            \\\n+    v8::Local<v8::String> js_msg = OneByteString(isolate, message);           \\\n+    v8::Local<v8::Object> e =                                                 \\\n+        v8::Exception::type(js_msg)->ToObject(                                \\\n+            isolate->GetCurrentContext()).ToLocalChecked();                   \\\n+    e->Set(isolate->GetCurrentContext(), OneByteString(isolate, \"code\"),      \\\n+           js_code).FromJust();                                               \\\n+    return e;                                                                 \\\n+  }\n+  ERRORS_WITH_CODE(V)\n+#undef V\n+\n+// Errors with predefined static messages\n+\n+#define PREDEFINED_ERROR_MESSAGES(V)                                         \\\n+  V(ERR_MEMORY_ALLOCATION_FAILED, \"Failed to allocate memory\")\n+\n+#define V(code, message)                                                     \\\n+  inline v8::Local<v8::Value> code(v8::Isolate* isolate) {                   \\\n+    return code(isolate, message);                                           \\\n+  }\n+  PREDEFINED_ERROR_MESSAGES(V)\n+#undef V\n+\n+// Errors with predefined non-static messages\n+\n+inline v8::Local<v8::Value> ERR_BUFFER_TOO_LARGE(v8::Isolate *isolate) {\n+  char message[128];\n+  snprintf(message, sizeof(message),\n+      \"Cannot create a Buffer larger than 0x%lx bytes\",\n+      v8::TypedArray::kMaxLength);\n+  return ERR_BUFFER_TOO_LARGE(isolate, message);\n+}\n+\n+inline v8::Local<v8::Value> ERR_STRING_TOO_LARGE(v8::Isolate *isolate) {\n+  char message[128];\n+  snprintf(message, sizeof(message),\n+      \"Cannot create a string larger than 0x%x bytes\",\n+      v8::String::kMaxLength);\n+  return ERR_STRING_TOO_LARGE(isolate, message);\n+}\n+\n+}  // namespace node\n+\n+#endif  // defined(NODE_WANT_INTERNALS) && NODE_WANT_INTERNALS\n+\n+#endif  // SRC_NODE_ERRORS_H_"
        }
    ],
    "stats": {
        "total": 86,
        "additions": 86,
        "deletions": 0
    }
}