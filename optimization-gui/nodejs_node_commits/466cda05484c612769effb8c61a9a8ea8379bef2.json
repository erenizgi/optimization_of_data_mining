{
    "author": "cjihrig",
    "message": "fs: ensure readdir() callback is only called once\n\nThis commit ensures that the readdir() callback can only be\ncalled once when the withFileTypes parameter is supplied.\n\nPR-URL: https://github.com/nodejs/node/pull/22793\nFixes: https://github.com/nodejs/node/issues/22778\nReviewed-By: Bryan English <bryan@bryanenglish.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>",
    "sha": "466cda05484c612769effb8c61a9a8ea8379bef2",
    "files": [
        {
            "sha": "362383be48f05c35c171a2060c8a53a2fd178999",
            "filename": "lib/internal/fs/utils.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/466cda05484c612769effb8c61a9a8ea8379bef2/lib%2Finternal%2Ffs%2Futils.js",
            "raw_url": "https://github.com/nodejs/node/raw/466cda05484c612769effb8c61a9a8ea8379bef2/lib%2Finternal%2Ffs%2Futils.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Futils.js?ref=466cda05484c612769effb8c61a9a8ea8379bef2",
            "patch": "@@ -10,6 +10,7 @@ const {\n   ERR_OUT_OF_RANGE\n } = require('internal/errors').codes;\n const { isUint8Array, isArrayBufferView } = require('internal/util/types');\n+const { once } = require('internal/util');\n const pathModule = require('path');\n const util = require('util');\n const kType = Symbol('type');\n@@ -123,6 +124,7 @@ function getDirents(path, [names, types], callback) {\n   if (typeof callback == 'function') {\n     const len = names.length;\n     let toFinish = 0;\n+    callback = once(callback);\n     for (i = 0; i < len; i++) {\n       const type = types[i];\n       if (type === UV_DIRENT_UNKNOWN) {"
        },
        {
            "sha": "bce466db749f6c9f4776dd7db980321d0cfc77ca",
            "filename": "lib/internal/streams/pipeline.js",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/466cda05484c612769effb8c61a9a8ea8379bef2/lib%2Finternal%2Fstreams%2Fpipeline.js",
            "raw_url": "https://github.com/nodejs/node/raw/466cda05484c612769effb8c61a9a8ea8379bef2/lib%2Finternal%2Fstreams%2Fpipeline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fstreams%2Fpipeline.js?ref=466cda05484c612769effb8c61a9a8ea8379bef2",
            "patch": "@@ -5,21 +5,13 @@\n \n let eos;\n \n+const { once } = require('internal/util');\n const {\n   ERR_INVALID_CALLBACK,\n   ERR_MISSING_ARGS,\n   ERR_STREAM_DESTROYED\n } = require('internal/errors').codes;\n \n-function once(callback) {\n-  let called = false;\n-  return function(err) {\n-    if (called) return;\n-    called = true;\n-    callback(err);\n-  };\n-}\n-\n function isRequest(stream) {\n   return stream.setHeader && typeof stream.abort === 'function';\n }"
        },
        {
            "sha": "5cb1b281ba406d73e10efb9ca22a580998a71114",
            "filename": "lib/internal/util.js",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/466cda05484c612769effb8c61a9a8ea8379bef2/lib%2Finternal%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/466cda05484c612769effb8c61a9a8ea8379bef2/lib%2Finternal%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil.js?ref=466cda05484c612769effb8c61a9a8ea8379bef2",
            "patch": "@@ -365,6 +365,15 @@ function isInsideNodeModules() {\n   return false;\n }\n \n+function once(callback) {\n+  let called = false;\n+  return function(...args) {\n+    if (called) return;\n+    called = true;\n+    callback(...args);\n+  };\n+}\n+\n module.exports = {\n   assertCrypto,\n   cachedResult,\n@@ -381,6 +390,7 @@ module.exports = {\n   join,\n   normalizeEncoding,\n   objectToString,\n+  once,\n   promisify,\n   spliceOne,\n   removeColors,"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 13,
        "deletions": 9
    }
}