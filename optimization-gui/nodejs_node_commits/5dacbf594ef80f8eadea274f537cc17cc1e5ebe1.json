{
    "author": "sebdeckers",
    "message": "http2: add compat support for nested array headers\n\nwriteHead supports an array of arrays containing header name and values.\nCompatibility between http2 & http1 even though this is not documented.\n\nFixes: https://github.com/nodejs/node/issues/24466\n\nPR-URL: https://github.com/nodejs/node/pull/24665\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Franziska Hinkelmann <franziska.hinkelmann@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "5dacbf594ef80f8eadea274f537cc17cc1e5ebe1",
    "files": [
        {
            "sha": "464f1141066c3acbe351d735d70fe8d49989811f",
            "filename": "lib/internal/http2/compat.js",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/5dacbf594ef80f8eadea274f537cc17cc1e5ebe1/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "raw_url": "https://github.com/nodejs/node/raw/5dacbf594ef80f8eadea274f537cc17cc1e5ebe1/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcompat.js?ref=5dacbf594ef80f8eadea274f537cc17cc1e5ebe1",
            "patch": "@@ -574,10 +574,16 @@ class Http2ServerResponse extends Stream {\n     if (headers === undefined && typeof statusMessage === 'object')\n       headers = statusMessage;\n \n-    if (typeof headers === 'object') {\n+    var i;\n+    if (Array.isArray(headers)) {\n+      for (i = 0; i < headers.length; i++) {\n+        const header = headers[i];\n+        this[kSetHeader](header[0], header[1]);\n+      }\n+    } else if (typeof headers === 'object') {\n       const keys = Object.keys(headers);\n       let key = '';\n-      for (var i = 0; i < keys.length; i++) {\n+      for (i = 0; i < keys.length; i++) {\n         key = keys[i];\n         this[kSetHeader](key, headers[key]);\n       }"
        },
        {
            "sha": "e024f8ab3952f048b9c8d3743b9d5f911b35a84c",
            "filename": "test/parallel/test-http2-compat-serverresponse-writehead-array.js",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/nodejs/node/blob/5dacbf594ef80f8eadea274f537cc17cc1e5ebe1/test%2Fparallel%2Ftest-http2-compat-serverresponse-writehead-array.js",
            "raw_url": "https://github.com/nodejs/node/raw/5dacbf594ef80f8eadea274f537cc17cc1e5ebe1/test%2Fparallel%2Ftest-http2-compat-serverresponse-writehead-array.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-compat-serverresponse-writehead-array.js?ref=5dacbf594ef80f8eadea274f537cc17cc1e5ebe1",
            "patch": "@@ -0,0 +1,42 @@\n+'use strict';\n+\n+const common = require('../common');\n+if (!common.hasCrypto)\n+  common.skip('missing crypto');\n+const assert = require('assert');\n+const h2 = require('http2');\n+\n+// Http2ServerResponse.writeHead should support nested arrays\n+\n+const server = h2.createServer();\n+server.listen(0, common.mustCall(() => {\n+  const port = server.address().port;\n+  server.once('request', common.mustCall((request, response) => {\n+    response.writeHead(200, [\n+      ['foo', 'bar'],\n+      ['ABC', 123]\n+    ]);\n+    response.end(common.mustCall(() => { server.close(); }));\n+  }));\n+\n+  const url = `http://localhost:${port}`;\n+  const client = h2.connect(url, common.mustCall(() => {\n+    const headers = {\n+      ':path': '/',\n+      ':method': 'GET',\n+      ':scheme': 'http',\n+      ':authority': `localhost:${port}`\n+    };\n+    const request = client.request(headers);\n+    request.on('response', common.mustCall((headers) => {\n+      assert.strictEqual(headers.foo, 'bar');\n+      assert.strictEqual(headers.abc, '123');\n+      assert.strictEqual(headers[':status'], 200);\n+    }, 1));\n+    request.on('end', common.mustCall(() => {\n+      client.close();\n+    }));\n+    request.end();\n+    request.resume();\n+  }));\n+}));"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 50,
        "deletions": 2
    }
}