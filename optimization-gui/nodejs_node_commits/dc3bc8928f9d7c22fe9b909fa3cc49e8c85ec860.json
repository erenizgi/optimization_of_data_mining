{
    "author": "joyeecheung",
    "message": "build: only try to find node when it's needed by the target\n\nRight now `node -p process.versions.openssl` always gets run\nin the Makefile even when it's not needed by the target\n(e.g. `make clean`, `make test-only`). This patch makes it\na run time call instead of part of the global expansion.\n\nPR-URL: https://github.com/nodejs/node/pull/24115\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>",
    "sha": "dc3bc8928f9d7c22fe9b909fa3cc49e8c85ec860",
    "files": [
        {
            "sha": "cc6fcd888f4cde44922e0e87cb0772a18f4877c5",
            "filename": "Makefile",
            "status": "modified",
            "additions": 14,
            "deletions": 14,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/dc3bc8928f9d7c22fe9b909fa3cc49e8c85ec860/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/dc3bc8928f9d7c22fe9b909fa3cc49e8c85ec860/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=dc3bc8928f9d7c22fe9b909fa3cc49e8c85ec860",
            "patch": "@@ -332,16 +332,16 @@ ifeq ($(OSTYPE),aix)\n DOCBUILDSTAMP_PREREQS := $(DOCBUILDSTAMP_PREREQS) out/$(BUILDTYPE)/node.exp\n endif\n \n-node_use_openssl = $(shell $(call available-node,\"-p\" \\\n-\t\t   \"process.versions.openssl != undefined\"))\n+node_use_openssl = $(call available-node,\"-p\" \\\n+\t\t   \"process.versions.openssl != undefined\")\n test/addons/.docbuildstamp: $(DOCBUILDSTAMP_PREREQS) tools/doc/node_modules\n-ifeq ($(node_use_openssl),true)\n-\t$(RM) -r test/addons/??_*/\n-\t[ -x $(NODE) ] && $(NODE) $< || node $<\n-\ttouch $@\n-else\n-\t@echo \"Skipping .docbuildstamp (no crypto)\"\n-endif\n+\t@if [ \"$(shell $(node_use_openssl))\" != \"true\" ]; then \\\n+\t\techo \"Skipping .docbuildstamp (no crypto)\"; \\\n+\telse \\\n+\t\t$(RM) -r test/addons/??_*/; \\\n+\t\t[ -x $(NODE) ] && $(NODE) $< || node $< ; \\\n+\t\ttouch $@; \\\n+  fi\n \n ADDONS_BINDING_GYPS := \\\n \t$(filter-out test/addons/??_*/binding.gyp, \\\n@@ -609,11 +609,11 @@ apidocs_json = $(addprefix out/,$(apidoc_sources:.md=.json))\n apiassets = $(subst api_assets,api/assets,$(addprefix out/,$(wildcard doc/api_assets/*)))\n \n tools/doc/node_modules: tools/doc/package.json\n-ifeq ($(node_use_openssl),true)\n-\tcd tools/doc && $(call available-node,$(run-npm-ci))\n-else\n-\t@echo \"Skipping tools/doc/node_modules (no crypto)\"\n-endif\n+\t@if [ \"$(shell $(node_use_openssl))\" != \"true\" ]; then \\\n+\t\techo \"Skipping tools/doc/node_modules (no crypto)\"; \\\n+\telse \\\n+\t\tcd tools/doc && $(call available-node,$(run-npm-ci)) \\\n+  fi\n \n .PHONY: doc-only\n doc-only: tools/doc/node_modules \\"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 14,
        "deletions": 14
    }
}