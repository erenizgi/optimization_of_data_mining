{
    "author": "BridgeAR",
    "message": "errors: minor (SystemError) refactoring\n\nThis removes the former default values and the spread arguments\nusage. That was unnecessary and now it does only what is necessary.\nThe `message` function got renamed to `getMessage` to outline that\nit is actually a function and a helper function was inlined into\nthe SystemError constructor as it was only used there.\n\nPR-URL: https://github.com/nodejs/node/pull/20337\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "109cfa1511cb504866c44314d92552285a236b1c",
    "files": [
        {
            "sha": "adbc666276ff0b3ac46f37a7caddc28740729c87",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 16,
            "deletions": 18,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/109cfa1511cb504866c44314d92552285a236b1c/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/109cfa1511cb504866c44314d92552285a236b1c/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=109cfa1511cb504866c44314d92552285a236b1c",
            "patch": "@@ -78,16 +78,6 @@ function inspectValue(val) {\n   ).split('\\n');\n }\n \n-function sysErrorMessage(prefix, ctx) {\n-  let message = `${prefix}: ${ctx.syscall} returned ` +\n-                `${ctx.code} (${ctx.message})`;\n-  if (ctx.path !== undefined)\n-    message += ` ${ctx.path}`;\n-  if (ctx.dest !== undefined)\n-    message += ` => ${ctx.dest}`;\n-  return message;\n-}\n-\n // A specialized Error that includes an additional info property with\n // additional information about the error condition.\n // It has the properties present in a UVException but with a custom error\n@@ -97,9 +87,17 @@ function sysErrorMessage(prefix, ctx) {\n // The context passed into this error must have .code, .syscall and .message,\n // and may have .path and .dest.\n class SystemError extends Error {\n-  constructor(key, context = {}) {\n-    context = context || {};\n-    super(sysErrorMessage(message(key), context));\n+  constructor(key, context) {\n+    const prefix = getMessage(key, []);\n+    let message = `${prefix}: ${context.syscall} returned ` +\n+                  `${context.code} (${context.message})`;\n+\n+    if (context.path !== undefined)\n+      message += ` ${context.path}`;\n+    if (context.dest !== undefined)\n+      message += ` => ${context.dest}`;\n+\n+    super(message);\n     Object.defineProperty(this, kInfo, {\n       configurable: false,\n       enumerable: false,\n@@ -182,16 +180,16 @@ class SystemError extends Error {\n \n function makeSystemErrorWithCode(key) {\n   return class NodeError extends SystemError {\n-    constructor(...args) {\n-      super(key, ...args);\n+    constructor(ctx) {\n+      super(key, ctx);\n     }\n   };\n }\n \n function makeNodeErrorWithCode(Base, key) {\n   return class NodeError extends Base {\n     constructor(...args) {\n-      super(message(key, args));\n+      super(getMessage(key, args));\n     }\n \n     get name() {\n@@ -484,7 +482,7 @@ function internalAssert(condition, message) {\n   }\n }\n \n-function message(key, args = []) {\n+function getMessage(key, args) {\n   const msg = messages.get(key);\n   if (util === undefined) util = require('util');\n \n@@ -691,7 +689,7 @@ module.exports = {\n   exceptionWithHostPort,\n   uvException,\n   isStackOverflowError,\n-  message,\n+  getMessage,\n   AssertionError,\n   SystemError,\n   codes,"
        },
        {
            "sha": "4eef0edefcbb22144e4326396ba9fe1ba9bb0e32",
            "filename": "test/parallel/test-buffer-fill.js",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/109cfa1511cb504866c44314d92552285a236b1c/test%2Fparallel%2Ftest-buffer-fill.js",
            "raw_url": "https://github.com/nodejs/node/raw/109cfa1511cb504866c44314d92552285a236b1c/test%2Fparallel%2Ftest-buffer-fill.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-buffer-fill.js?ref=109cfa1511cb504866c44314d92552285a236b1c",
            "patch": "@@ -2,7 +2,7 @@\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n-const errors = require('internal/errors');\n+const { codes: { ERR_INDEX_OUT_OF_RANGE } } = require('internal/errors');\n const SIZE = 28;\n \n const buf1 = Buffer.allocUnsafe(SIZE);\n@@ -214,13 +214,11 @@ function genBuffer(size, args) {\n   return b.fill(0).fill.apply(b, args);\n }\n \n-\n function bufReset() {\n   buf1.fill(0);\n   buf2.fill(0);\n }\n \n-\n // This is mostly accurate. Except write() won't write partial bytes to the\n // string while fill() blindly copies bytes into memory. To account for that an\n // error will be thrown if not all the data can be written, and the SIZE has\n@@ -237,8 +235,9 @@ function writeToFill(string, offset, end, encoding) {\n     end = buf2.length;\n   }\n \n+  // Should never be reached.\n   if (offset < 0 || end > buf2.length)\n-    throw new errors.RangeError('ERR_INDEX_OUT_OF_RANGE');\n+    throw new ERR_INDEX_OUT_OF_RANGE();\n \n   if (end <= offset)\n     return buf2;\n@@ -266,7 +265,6 @@ function writeToFill(string, offset, end, encoding) {\n   return buf2;\n }\n \n-\n function testBufs(string, offset, length, encoding) {\n   bufReset();\n   buf1.fill.apply(buf1, arguments);"
        },
        {
            "sha": "957a0dd7b22196640eea50ab5444496831b6761b",
            "filename": "test/parallel/test-errors-systemerror.js",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/109cfa1511cb504866c44314d92552285a236b1c/test%2Fparallel%2Ftest-errors-systemerror.js",
            "raw_url": "https://github.com/nodejs/node/raw/109cfa1511cb504866c44314d92552285a236b1c/test%2Fparallel%2Ftest-errors-systemerror.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-errors-systemerror.js?ref=109cfa1511cb504866c44314d92552285a236b1c",
            "patch": "@@ -3,20 +3,18 @@\n \n require('../common');\n const assert = require('assert');\n-const errors = require('internal/errors');\n-\n-const { E, SystemError } = errors;\n+const { E, SystemError, codes } = require('internal/errors');\n \n assert.throws(\n-  () => { throw new errors.SystemError(); },\n+  () => { throw new SystemError(); },\n   {\n     name: 'TypeError',\n     message: 'Cannot read property \\'match\\' of undefined'\n   }\n );\n \n E('ERR_TEST', 'custom message', SystemError);\n-const { ERR_TEST } = errors.codes;\n+const { ERR_TEST } = codes;\n \n {\n   const ctx = {"
        },
        {
            "sha": "b5e08911b8219e03fc96f90aa8fdc7a5b6c169f7",
            "filename": "test/parallel/test-internal-errors.js",
            "status": "modified",
            "additions": 23,
            "deletions": 28,
            "changes": 51,
            "blob_url": "https://github.com/nodejs/node/blob/109cfa1511cb504866c44314d92552285a236b1c/test%2Fparallel%2Ftest-internal-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/109cfa1511cb504866c44314d92552285a236b1c/test%2Fparallel%2Ftest-internal-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-internal-errors.js?ref=109cfa1511cb504866c44314d92552285a236b1c",
            "patch": "@@ -93,95 +93,90 @@ common.expectsError(() => {\n });\n \n // Test ERR_INVALID_FD_TYPE\n-assert.strictEqual(errors.message('ERR_INVALID_FD_TYPE', ['a']),\n+assert.strictEqual(errors.getMessage('ERR_INVALID_FD_TYPE', ['a']),\n                    'Unsupported fd type: a');\n \n // Test ERR_INVALID_URL_SCHEME\n-assert.strictEqual(errors.message('ERR_INVALID_URL_SCHEME', ['file']),\n+assert.strictEqual(errors.getMessage('ERR_INVALID_URL_SCHEME', ['file']),\n                    'The URL must be of scheme file');\n-assert.strictEqual(errors.message('ERR_INVALID_URL_SCHEME', [['file']]),\n+assert.strictEqual(errors.getMessage('ERR_INVALID_URL_SCHEME', [['file']]),\n                    'The URL must be of scheme file');\n-assert.strictEqual(errors.message('ERR_INVALID_URL_SCHEME', [['http', 'ftp']]),\n+assert.strictEqual(errors.getMessage('ERR_INVALID_URL_SCHEME',\n+                                     [['http', 'ftp']]),\n                    'The URL must be one of scheme http or ftp');\n-assert.strictEqual(errors.message('ERR_INVALID_URL_SCHEME', [['a', 'b', 'c']]),\n+assert.strictEqual(errors.getMessage('ERR_INVALID_URL_SCHEME',\n+                                     [['a', 'b', 'c']]),\n                    'The URL must be one of scheme a, b, or c');\n common.expectsError(\n-  () => errors.message('ERR_INVALID_URL_SCHEME', [[]]),\n+  () => errors.getMessage('ERR_INVALID_URL_SCHEME', [[]]),\n   {\n     code: 'ERR_ASSERTION',\n     type: assert.AssertionError,\n     message: /^At least one expected value needs to be specified$/\n   });\n \n // Test ERR_MISSING_ARGS\n-assert.strictEqual(errors.message('ERR_MISSING_ARGS', ['name']),\n+assert.strictEqual(errors.getMessage('ERR_MISSING_ARGS', ['name']),\n                    'The \"name\" argument must be specified');\n-assert.strictEqual(errors.message('ERR_MISSING_ARGS', ['name', 'value']),\n+assert.strictEqual(errors.getMessage('ERR_MISSING_ARGS', ['name', 'value']),\n                    'The \"name\" and \"value\" arguments must be specified');\n-assert.strictEqual(errors.message('ERR_MISSING_ARGS', ['a', 'b', 'c']),\n+assert.strictEqual(errors.getMessage('ERR_MISSING_ARGS', ['a', 'b', 'c']),\n                    'The \"a\", \"b\", and \"c\" arguments must be specified');\n-common.expectsError(\n-  () => errors.message('ERR_MISSING_ARGS'),\n-  {\n-    code: 'ERR_ASSERTION',\n-    type: assert.AssertionError,\n-    message: /^At least one arg needs to be specified$/\n-  });\n \n // Test ERR_SOCKET_BAD_PORT\n assert.strictEqual(\n-  errors.message('ERR_SOCKET_BAD_PORT', [0]),\n+  errors.getMessage('ERR_SOCKET_BAD_PORT', [0]),\n   'Port should be > 0 and < 65536. Received 0.');\n \n // Test ERR_TLS_CERT_ALTNAME_INVALID\n assert.strictEqual(\n-  errors.message('ERR_TLS_CERT_ALTNAME_INVALID', ['altname']),\n+  errors.getMessage('ERR_TLS_CERT_ALTNAME_INVALID', ['altname']),\n   'Hostname/IP does not match certificate\\'s altnames: altname');\n \n assert.strictEqual(\n-  errors.message('ERR_INVALID_PROTOCOL', ['bad protocol', 'http']),\n+  errors.getMessage('ERR_INVALID_PROTOCOL', ['bad protocol', 'http']),\n   'Protocol \"bad protocol\" not supported. Expected \"http\"'\n );\n \n assert.strictEqual(\n-  errors.message('ERR_HTTP_HEADERS_SENT', ['render']),\n+  errors.getMessage('ERR_HTTP_HEADERS_SENT', ['render']),\n   'Cannot render headers after they are sent to the client'\n );\n \n assert.strictEqual(\n-  errors.message('ERR_INVALID_HTTP_TOKEN', ['Method', 'foo']),\n+  errors.getMessage('ERR_INVALID_HTTP_TOKEN', ['Method', 'foo']),\n   'Method must be a valid HTTP token [\"foo\"]'\n );\n \n assert.strictEqual(\n-  errors.message('ERR_OUT_OF_RANGE', ['A', 'some values', 'B']),\n+  errors.getMessage('ERR_OUT_OF_RANGE', ['A', 'some values', 'B']),\n   'The value of \"A\" is out of range. It must be some values. Received B'\n );\n \n assert.strictEqual(\n-  errors.message('ERR_UNESCAPED_CHARACTERS', ['Request path']),\n+  errors.getMessage('ERR_UNESCAPED_CHARACTERS', ['Request path']),\n   'Request path contains unescaped characters'\n );\n \n // Test ERR_DNS_SET_SERVERS_FAILED\n assert.strictEqual(\n-  errors.message('ERR_DNS_SET_SERVERS_FAILED', ['err', 'servers']),\n+  errors.getMessage('ERR_DNS_SET_SERVERS_FAILED', ['err', 'servers']),\n   'c-ares failed to set servers: \"err\" [servers]');\n \n // Test ERR_ENCODING_NOT_SUPPORTED\n assert.strictEqual(\n-  errors.message('ERR_ENCODING_NOT_SUPPORTED', ['enc']),\n+  errors.getMessage('ERR_ENCODING_NOT_SUPPORTED', ['enc']),\n   'The \"enc\" encoding is not supported');\n \n // Test error messages for async_hooks\n assert.strictEqual(\n-  errors.message('ERR_ASYNC_CALLBACK', ['init']),\n+  errors.getMessage('ERR_ASYNC_CALLBACK', ['init']),\n   'init must be a function');\n assert.strictEqual(\n-  errors.message('ERR_ASYNC_TYPE', [{}]),\n+  errors.getMessage('ERR_ASYNC_TYPE', [{}]),\n   'Invalid name for async \"type\": [object Object]');\n assert.strictEqual(\n-  errors.message('ERR_INVALID_ASYNC_ID', ['asyncId', undefined]),\n+  errors.getMessage('ERR_INVALID_ASYNC_ID', ['asyncId', undefined]),\n   'Invalid asyncId value: undefined');\n \n {"
        }
    ],
    "stats": {
        "total": 101,
        "additions": 45,
        "deletions": 56
    }
}