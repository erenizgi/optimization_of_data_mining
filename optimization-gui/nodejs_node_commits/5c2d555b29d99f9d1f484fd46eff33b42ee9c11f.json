{
    "author": "targos",
    "message": "deps: patch V8 to 7.0.276.35\n\nRefs: https://github.com/v8/v8/compare/7.0.276.32...7.0.276.35\n\nPR-URL: https://github.com/nodejs/node/pull/24056\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "5c2d555b29d99f9d1f484fd46eff33b42ee9c11f",
    "files": [
        {
            "sha": "e476dff7bceb67e4e034cc9e626ff2c13730c7cf",
            "filename": "deps/v8/include/v8-version.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Finclude%2Fv8-version.h",
            "raw_url": "https://github.com/nodejs/node/raw/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Finclude%2Fv8-version.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8-version.h?ref=5c2d555b29d99f9d1f484fd46eff33b42ee9c11f",
            "patch": "@@ -11,7 +11,7 @@\n #define V8_MAJOR_VERSION 7\n #define V8_MINOR_VERSION 0\n #define V8_BUILD_NUMBER 276\n-#define V8_PATCH_LEVEL 32\n+#define V8_PATCH_LEVEL 35\n \n // Use 1 for candidates and 0 otherwise.\n // (Boolean macro values are not supported by all preprocessors.)"
        },
        {
            "sha": "31aef9c3214d902a5fd20d12d98a2540ec566068",
            "filename": "deps/v8/infra/testing/builders.pyl",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Finfra%2Ftesting%2Fbuilders.pyl",
            "raw_url": "https://github.com/nodejs/node/raw/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Finfra%2Ftesting%2Fbuilders.pyl",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finfra%2Ftesting%2Fbuilders.pyl?ref=5c2d555b29d99f9d1f484fd46eff33b42ee9c11f",
            "patch": "@@ -685,11 +685,6 @@\n       {'name': 'mozilla'},\n     ],\n   },\n-  'V8 Linux - presubmit': {\n-    'tests': [\n-      {'name': 'presubmit'},\n-    ],\n-  },\n   'V8 Linux - shared': {\n     'tests': [\n       {'name': 'mozilla'},\n@@ -1514,7 +1509,6 @@\n     },\n     'tests': [\n       {'name': 'mozilla'},\n-      {'name': 'presubmit'},\n       {'name': 'test262'},\n       {'name': 'v8testing'},\n     ],\n@@ -1527,7 +1521,6 @@\n     },\n     'tests': [\n       {'name': 'mozilla'},\n-      {'name': 'presubmit'},\n       {'name': 'test262'},\n       {'name': 'v8testing', 'shards': 3},\n     ],\n@@ -1540,7 +1533,6 @@\n     },\n     'tests': [\n       {'name': 'mozilla'},\n-      {'name': 'presubmit'},\n       {'name': 'test262'},\n       {'name': 'v8testing'},\n     ],\n@@ -1553,7 +1545,6 @@\n     },\n     'tests': [\n       {'name': 'mozilla'},\n-      {'name': 'presubmit'},\n       {'name': 'test262'},\n       {'name': 'v8testing', 'shards': 3},\n     ],"
        },
        {
            "sha": "d72159b0acf926fde4be3c109ece06a6f66e3f71",
            "filename": "deps/v8/src/runtime/runtime-array.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime-array.cc",
            "raw_url": "https://github.com/nodejs/node/raw/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime-array.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime-array.cc?ref=5c2d555b29d99f9d1f484fd46eff33b42ee9c11f",
            "patch": "@@ -145,7 +145,15 @@ Object* RemoveArrayHolesGeneric(Isolate* isolate, Handle<JSReceiver> receiver,\n     MAYBE_RETURN(delete_result, ReadOnlyRoots(isolate).exception());\n   }\n \n-  return *isolate->factory()->NewNumberFromUint(result);\n+  // TODO(jgruber, szuend, chromium:897512): This is a workaround to prevent\n+  // returning a number greater than array.length to Array.p.sort, which could\n+  // trigger OOB accesses. There is still a correctness bug here though in\n+  // how we shift around undefineds and delete elements in the two blocks above.\n+  // This needs to be fixed soon.\n+  const uint32_t number_of_non_undefined_elements = std::min(limit, result);\n+\n+  return *isolate->factory()->NewNumberFromUint(\n+      number_of_non_undefined_elements);\n }\n \n // Collects all defined (non-hole) and non-undefined (array) elements at the\n@@ -162,6 +170,7 @@ Object* RemoveArrayHoles(Isolate* isolate, Handle<JSReceiver> receiver,\n   Handle<JSObject> object = Handle<JSObject>::cast(receiver);\n   if (object->HasStringWrapperElements()) {\n     int len = String::cast(Handle<JSValue>::cast(object)->value())->length();\n+    DCHECK_LE(len, limit);\n     return Smi::FromInt(len);\n   }\n \n@@ -284,6 +293,7 @@ Object* RemoveArrayHoles(Isolate* isolate, Handle<JSReceiver> receiver,\n     }\n   }\n \n+  DCHECK_LE(result, limit);\n   return *isolate->factory()->NewNumberFromUint(result);\n }\n "
        },
        {
            "sha": "0e676a06c2a6d6f02fd42b8bb0f4852bc29a3426",
            "filename": "deps/v8/test/mjsunit/regress/regress-897512.js",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Ftest%2Fmjsunit%2Fregress%2Fregress-897512.js",
            "raw_url": "https://github.com/nodejs/node/raw/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Ftest%2Fmjsunit%2Fregress%2Fregress-897512.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fmjsunit%2Fregress%2Fregress-897512.js?ref=5c2d555b29d99f9d1f484fd46eff33b42ee9c11f",
            "patch": "@@ -0,0 +1,24 @@\n+// Copyright 2018 the V8 project authors. All rights reserved.\n+// Use of this source code is governed by a BSD-style license that can be\n+// found in the LICENSE file.\n+\n+// Fill up the Array prototype's elements.\n+for (let i = 0; i < 100; i++) Array.prototype.unshift(3.14);\n+\n+// Create a holey double elements array.\n+const o31 = [1.1];\n+o31[37] = 2.2;\n+\n+// Concat converts to dictionary elements.\n+const o51 = o31.concat(false);\n+\n+// Set one element to undefined to trigger the movement bug.\n+o51[0] = undefined;\n+\n+assertEquals(o51.length, 39);\n+\n+// Sort triggers the bug.\n+o51.sort();\n+\n+// TODO(chromium:897512): The length should be 39.\n+assertEquals(o51.length, 101);"
        },
        {
            "sha": "3f5a3b19b7af8cdc25ee49b6d21a972af6c3b40e",
            "filename": "deps/v8/third_party/v8/builtins/array-sort.tq",
            "status": "modified",
            "additions": 14,
            "deletions": 26,
            "changes": 40,
            "blob_url": "https://github.com/nodejs/node/blob/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Fthird_party%2Fv8%2Fbuiltins%2Farray-sort.tq",
            "raw_url": "https://github.com/nodejs/node/raw/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Fthird_party%2Fv8%2Fbuiltins%2Farray-sort.tq",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fthird_party%2Fv8%2Fbuiltins%2Farray-sort.tq?ref=5c2d555b29d99f9d1f484fd46eff33b42ee9c11f",
            "patch": "@@ -1742,7 +1742,6 @@ module array {\n \n     // 2. Let obj be ? ToObject(this value).\n     const obj: JSReceiver = ToObject(context, receiver);\n-    let map: Map = obj.map;\n \n     const sort_state: FixedArray =\n         AllocateZeroedFixedArray(kSortStateSize);\n@@ -1752,25 +1751,27 @@ module array {\n     sort_state[kUserCmpFnIdx] = comparefnObj;\n     sort_state[kSortComparePtrIdx] =\n         comparefnObj != Undefined ? SortCompareUserFn : SortCompareDefault;\n-    sort_state[kInitialReceiverMapIdx] = map;\n     sort_state[kBailoutStatusIdx] = kSuccess;\n \n+    // 3. Let len be ? ToLength(? Get(obj, \"length\")).\n+    const len: Number =\n+        ToLength_Inline(context, GetProperty(context, obj, 'length'));\n+    if (len < 2) return receiver;\n+\n+    // TODO(szuend): Investigate performance tradeoff of skipping this step\n+    //               for PACKED_* and handling Undefineds during sorting.\n+    const nofNonUndefined: Smi = PrepareElementsForSort(context, obj, len);\n+    assert(nofNonUndefined <= len);\n+\n+    let map: Map = obj.map;\n+    sort_state[kInitialReceiverMapIdx] = map;\n+    sort_state[kInitialReceiverLengthIdx] = len;\n+\n     try {\n       const a: JSArray = cast<JSArray>(obj) otherwise slow;\n       const elementsKind: ElementsKind = map.elements_kind;\n       if (!IsFastElementsKind(elementsKind)) goto slow;\n \n-      // 3. Let len be ? ToLength(? Get(obj, \"length\")).\n-      const len: Smi = a.length_fast;\n-      if (len < 2) return receiver;\n-\n-      // TODO(szuend): Investigate performance tradeoff of skipping this step\n-      //               for PACKED_* and handling Undefineds during sorting.\n-      const nofNonUndefined: Smi = PrepareElementsForSort(context, obj, len);\n-      assert(a.map == map);\n-\n-      sort_state[kInitialReceiverLengthIdx] = len;\n-\n       if (IsDoubleElementsKind(elementsKind)) {\n         InitializeSortStateAccessor<FastDoubleElements>(sort_state);\n       } else if (elementsKind == PACKED_SMI_ELEMENTS) {\n@@ -1781,19 +1782,6 @@ module array {\n       ArrayTimSort(context, sort_state, nofNonUndefined);\n     }\n     label slow {\n-      // 3. Let len be ? ToLength(? Get(obj, \"length\")).\n-      const len: Number =\n-          ToLength_Inline(context, GetProperty(context, obj, 'length'));\n-\n-      if (len < 2) return receiver;\n-      const nofNonUndefined: Smi = PrepareElementsForSort(context, obj, len);\n-\n-      sort_state[kInitialReceiverLengthIdx] = len;\n-\n-      // Reload the map, PrepareElementsForSort might have changed the\n-      // elements kind.\n-      map = obj.map;\n-\n       if (map.elements_kind == DICTIONARY_ELEMENTS && IsExtensibleMap(map) &&\n           !IsCustomElementsReceiverInstanceType(map.instance_type)) {\n         InitializeSortStateAccessor<DictionaryElements>(sort_state);"
        },
        {
            "sha": "13b4abd86cf45b9ac0de2d78b2b3b6bf2a029aa7",
            "filename": "deps/v8/tools/v8_presubmit.py",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/nodejs/node/blob/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Ftools%2Fv8_presubmit.py",
            "raw_url": "https://github.com/nodejs/node/raw/5c2d555b29d99f9d1f484fd46eff33b42ee9c11f/deps%2Fv8%2Ftools%2Fv8_presubmit.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftools%2Fv8_presubmit.py?ref=5c2d555b29d99f9d1f484fd46eff33b42ee9c11f",
            "previous_filename": "deps/v8/tools/presubmit.py"
        }
    ],
    "stats": {
        "total": 87,
        "additions": 50,
        "deletions": 37
    }
}