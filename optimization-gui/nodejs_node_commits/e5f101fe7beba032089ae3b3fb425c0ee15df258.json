{
    "author": "unknown",
    "message": "http2: add req and res options to server creation\n\nAdd optional Http2ServerRequest and Http2ServerResponse options\nto createServer and createSecureServer. Allows custom req & res\nclasses that extend the default ones to be used without\noverriding the prototype.\n\nPR-URL: https://github.com/nodejs/node/pull/15560\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "e5f101fe7beba032089ae3b3fb425c0ee15df258",
    "files": [
        {
            "sha": "8b428484c00d96185ce100226299cebad66549eb",
            "filename": "doc/api/http2.md",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/e5f101fe7beba032089ae3b3fb425c0ee15df258/doc%2Fapi%2Fhttp2.md",
            "raw_url": "https://github.com/nodejs/node/raw/e5f101fe7beba032089ae3b3fb425c0ee15df258/doc%2Fapi%2Fhttp2.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttp2.md?ref=e5f101fe7beba032089ae3b3fb425c0ee15df258",
            "patch": "@@ -1707,6 +1707,14 @@ changes:\n   * `Http1ServerResponse` {http.ServerResponse} Specifies the ServerResponse\n     class to used for HTTP/1 fallback. Useful for extending the original\n     `http.ServerResponse`. **Default:** `http.ServerResponse`\n+  * `Http2ServerRequest` {http2.Http2ServerRequest} Specifies the\n+    Http2ServerRequest class to use.\n+    Useful for extending the original `Http2ServerRequest`.\n+    **Default:** `Http2ServerRequest`\n+  * `Http2ServerResponse` {htt2.Http2ServerResponse} Specifies the\n+    Http2ServerResponse class to use.\n+    Useful for extending the original `Http2ServerResponse`.\n+    **Default:** `Http2ServerResponse`\n * `onRequestHandler` {Function} See [Compatibility API][]\n * Returns: {Http2Server}\n "
        },
        {
            "sha": "5e6c51377e94bafbcdeee45d9de386cd971c575d",
            "filename": "lib/internal/http2/compat.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/e5f101fe7beba032089ae3b3fb425c0ee15df258/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "raw_url": "https://github.com/nodejs/node/raw/e5f101fe7beba032089ae3b3fb425c0ee15df258/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcompat.js?ref=e5f101fe7beba032089ae3b3fb425c0ee15df258",
            "patch": "@@ -661,11 +661,11 @@ class Http2ServerResponse extends Stream {\n   }\n }\n \n-function onServerStream(stream, headers, flags, rawHeaders) {\n+function onServerStream(ServerRequest, ServerResponse,\n+                        stream, headers, flags, rawHeaders) {\n   const server = this;\n-  const request = new Http2ServerRequest(stream, headers, undefined,\n-                                         rawHeaders);\n-  const response = new Http2ServerResponse(stream);\n+  const request = new ServerRequest(stream, headers, undefined, rawHeaders);\n+  const response = new ServerResponse(stream);\n \n   // Check for the CONNECT method\n   const method = headers[HTTP2_HEADER_METHOD];"
        },
        {
            "sha": "307ca98db8da22c9b3237a1f4408584a5d3ee9f6",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/e5f101fe7beba032089ae3b3fb425c0ee15df258/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/e5f101fe7beba032089ae3b3fb425c0ee15df258/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=e5f101fe7beba032089ae3b3fb425c0ee15df258",
            "patch": "@@ -2498,6 +2498,10 @@ function initializeOptions(options) {\n   options.Http1ServerResponse = options.Http1ServerResponse ||\n     http.ServerResponse;\n \n+  options.Http2ServerRequest = options.Http2ServerRequest ||\n+                                       Http2ServerRequest;\n+  options.Http2ServerResponse = options.Http2ServerResponse ||\n+                                        Http2ServerResponse;\n   return options;\n }\n \n@@ -2563,7 +2567,11 @@ class Http2Server extends NETServer {\n function setupCompat(ev) {\n   if (ev === 'request') {\n     this.removeListener('newListener', setupCompat);\n-    this.on('stream', onServerStream);\n+    this.on('stream', onServerStream.bind(\n+      this,\n+      this[kOptions].Http2ServerRequest,\n+      this[kOptions].Http2ServerResponse)\n+    );\n   }\n }\n "
        },
        {
            "sha": "2143d379823d513bd055214606f9ad3541c5eaab",
            "filename": "test/parallel/test-http2-options-server-request.js",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/nodejs/node/blob/e5f101fe7beba032089ae3b3fb425c0ee15df258/test%2Fparallel%2Ftest-http2-options-server-request.js",
            "raw_url": "https://github.com/nodejs/node/raw/e5f101fe7beba032089ae3b3fb425c0ee15df258/test%2Fparallel%2Ftest-http2-options-server-request.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-options-server-request.js?ref=e5f101fe7beba032089ae3b3fb425c0ee15df258",
            "patch": "@@ -0,0 +1,40 @@\n+'use strict';\n+\n+const common = require('../common');\n+if (!common.hasCrypto)\n+  common.skip('missing crypto');\n+const assert = require('assert');\n+const h2 = require('http2');\n+\n+class MyServerRequest extends h2.Http2ServerRequest {\n+  getUserAgent() {\n+    return this.headers['user-agent'] || 'unknown';\n+  }\n+}\n+\n+const server = h2.createServer({\n+  Http2ServerRequest: MyServerRequest\n+}, (req, res) => {\n+  assert.strictEqual(req.getUserAgent(), 'node-test');\n+\n+  res.writeHead(200, { 'Content-Type': 'text/plain' });\n+  res.end();\n+});\n+server.listen(0);\n+\n+server.on('listening', common.mustCall(() => {\n+\n+  const client = h2.connect(`http://localhost:${server.address().port}`);\n+  const req = client.request({\n+    ':path': '/',\n+    'User-Agent': 'node-test'\n+  });\n+\n+  req.on('response', common.mustCall());\n+\n+  req.resume();\n+  req.on('end', common.mustCall(() => {\n+    server.close();\n+    client.destroy();\n+  }));\n+}));"
        },
        {
            "sha": "6f1ae1881d22d8bf76abe2349a91261e7fd41e61",
            "filename": "test/parallel/test-http2-options-server-response.js",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/e5f101fe7beba032089ae3b3fb425c0ee15df258/test%2Fparallel%2Ftest-http2-options-server-response.js",
            "raw_url": "https://github.com/nodejs/node/raw/e5f101fe7beba032089ae3b3fb425c0ee15df258/test%2Fparallel%2Ftest-http2-options-server-response.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-options-server-response.js?ref=e5f101fe7beba032089ae3b3fb425c0ee15df258",
            "patch": "@@ -0,0 +1,34 @@\n+'use strict';\n+\n+const common = require('../common');\n+if (!common.hasCrypto)\n+  common.skip('missing crypto');\n+const h2 = require('http2');\n+\n+class MyServerResponse extends h2.Http2ServerResponse {\n+  status(code) {\n+    return this.writeHead(code, { 'Content-Type': 'text/plain' });\n+  }\n+}\n+\n+const server = h2.createServer({\n+  Http2ServerResponse: MyServerResponse\n+}, (req, res) => {\n+  res.status(200);\n+  res.end();\n+});\n+server.listen(0);\n+\n+server.on('listening', common.mustCall(() => {\n+\n+  const client = h2.connect(`http://localhost:${server.address().port}`);\n+  const req = client.request({ ':path': '/' });\n+\n+  req.on('response', common.mustCall());\n+\n+  req.resume();\n+  req.on('end', common.mustCall(() => {\n+    server.close();\n+    client.destroy();\n+  }));\n+}));"
        }
    ],
    "stats": {
        "total": 100,
        "additions": 95,
        "deletions": 5
    }
}