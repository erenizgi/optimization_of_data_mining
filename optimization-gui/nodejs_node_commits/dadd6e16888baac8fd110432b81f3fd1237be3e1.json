{
    "author": "chocolateboy",
    "message": "util: use a shared symbol for util.inspect.custom\n\nDefine `util.inspect.custom` as\n`Symbol.for(\"nodejs.util.inspect.custom\")` rather than\n`Symbol(\"util.inspect.custom\")`. This allows `inspect` hooks to\neasily/safely be defined in non-Node.js environments.\n\nFixes: https://github.com/nodejs/node/issues/20821\nRefs: https://github.com/nodejs/node/pull/22684\n\nPR-URL: https://github.com/nodejs/node/pull/20857\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: John-David Dalton <john.david.dalton@gmail.com>",
    "sha": "dadd6e16888baac8fd110432b81f3fd1237be3e1",
    "files": [
        {
            "sha": "d29fbfc5b7f050895bca48b99c232892f613ea84",
            "filename": "doc/api/util.md",
            "status": "modified",
            "additions": 40,
            "deletions": 6,
            "changes": 46,
            "blob_url": "https://github.com/nodejs/node/blob/dadd6e16888baac8fd110432b81f3fd1237be3e1/doc%2Fapi%2Futil.md",
            "raw_url": "https://github.com/nodejs/node/raw/dadd6e16888baac8fd110432b81f3fd1237be3e1/doc%2Fapi%2Futil.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Futil.md?ref=dadd6e16888baac8fd110432b81f3fd1237be3e1",
            "patch": "@@ -574,9 +574,10 @@ terminals.\n \n <!-- type=misc -->\n \n-Objects may also define their own `[util.inspect.custom](depth, opts)` function\n-that `util.inspect()` will invoke and use the result of when inspecting the\n-object:\n+Objects may also define their own\n+[`[util.inspect.custom](depth, opts)`][util.inspect.custom] function,\n+which `util.inspect()` will invoke and use the result of when inspecting\n+the object:\n \n ```js\n const util = require('util');\n@@ -628,10 +629,41 @@ util.inspect(obj);\n ### util.inspect.custom\n <!-- YAML\n added: v6.6.0\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/20857\n+    description: This is now defined as a shared symbol.\n -->\n \n-* {symbol} that can be used to declare custom inspect functions, see\n-[Custom inspection functions on Objects][].\n+* {symbol} that can be used to declare custom inspect functions.\n+\n+In addition to being accessible through `util.inspect.custom`, this\n+symbol is [registered globally][global symbol registry] and can be\n+accessed in any environment as `Symbol.for('nodejs.util.inspect.custom')`.\n+\n+```js\n+const inspect = Symbol.for('nodejs.util.inspect.custom');\n+\n+class Password {\n+  constructor(value) {\n+    this.value = value;\n+  }\n+\n+  toString() {\n+    return 'xxxxxxxx';\n+  }\n+\n+  [inspect]() {\n+    return `Password <${this.toString()}>`;\n+  }\n+}\n+\n+const password = new Password('r0sebud');\n+console.log(password);\n+// Prints Password <xxxxxxxx>\n+```\n+\n+See [Custom inspection functions on Objects][] for more details.\n \n ### util.inspect.defaultOptions\n <!-- YAML\n@@ -2076,7 +2108,6 @@ Deprecated predecessor of `console.log`.\n [`Array.isArray()`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/isArray\n [`ArrayBuffer`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer\n [`ArrayBuffer.isView()`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/ArrayBuffer/isView\n-[async function]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\n [`assert.deepStrictEqual()`]: assert.html#assert_assert_deepstrictequal_actual_expected_message\n [`Buffer.isBuffer()`]: buffer.html#buffer_class_method_buffer_isbuffer_obj\n [`console.error()`]: console.html#console_console_error_data_args\n@@ -2118,6 +2149,9 @@ Deprecated predecessor of `console.log`.\n [Module Namespace Object]: https://tc39.github.io/ecma262/#sec-module-namespace-exotic-objects\n [WHATWG Encoding Standard]: https://encoding.spec.whatwg.org/\n [Common System Errors]: errors.html#errors_common_system_errors\n+[async function]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\n [constructor]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor\n+[global symbol registry]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/for\n [list of deprecated APIS]: deprecations.html#deprecations_list_of_deprecated_apis\n [semantically incompatible]: https://github.com/nodejs/node/issues/4179\n+[util.inspect.custom]: #util_util_inspect_custom"
        },
        {
            "sha": "9a102907ee3aa1bf532b943acb3a3a2e6a7cff0c",
            "filename": "lib/internal/util.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/dadd6e16888baac8fd110432b81f3fd1237be3e1/lib%2Finternal%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/dadd6e16888baac8fd110432b81f3fd1237be3e1/lib%2Finternal%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil.js?ref=dadd6e16888baac8fd110432b81f3fd1237be3e1",
            "patch": "@@ -400,7 +400,7 @@ module.exports = {\n \n   // Symbol used to provide a custom inspect function for an object as an\n   // alternative to using 'inspect'\n-  customInspectSymbol: Symbol('util.inspect.custom'),\n+  customInspectSymbol: Symbol.for('nodejs.util.inspect.custom'),\n \n   // Used by the buffer module to capture an internal reference to the\n   // default isEncoding implementation, just in case userland overrides it."
        },
        {
            "sha": "344547a4042726eeaa4321b94314f0f58f8433e7",
            "filename": "test/parallel/test-assert.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/dadd6e16888baac8fd110432b81f3fd1237be3e1/test%2Fparallel%2Ftest-assert.js",
            "raw_url": "https://github.com/nodejs/node/raw/dadd6e16888baac8fd110432b81f3fd1237be3e1/test%2Fparallel%2Ftest-assert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert.js?ref=dadd6e16888baac8fd110432b81f3fd1237be3e1",
            "patch": "@@ -603,7 +603,7 @@ assert.throws(\n     '+ {}\\n' +\n     '- {\\n' +\n     \"-   loop: 'forever',\\n\" +\n-    '-   [Symbol(util.inspect.custom)]: [Function]\\n' +\n+    '-   [Symbol(nodejs.util.inspect.custom)]: [Function]\\n' +\n     '- }'\n   });\n "
        },
        {
            "sha": "5ecc0bd834bde4df71259f405c4232d0769d6f82",
            "filename": "test/parallel/test-console.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/dadd6e16888baac8fd110432b81f3fd1237be3e1/test%2Fparallel%2Ftest-console.js",
            "raw_url": "https://github.com/nodejs/node/raw/dadd6e16888baac8fd110432b81f3fd1237be3e1/test%2Fparallel%2Ftest-console.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-console.js?ref=dadd6e16888baac8fd110432b81f3fd1237be3e1",
            "patch": "@@ -214,11 +214,11 @@ for (const expected of expectedStrings) {\n }\n \n assert.strictEqual(strings.shift(),\n-                   \"{ foo: 'bar',\\n  [Symbol(util.inspect.custom)]: \" +\n-                    '[Function: [util.inspect.custom]] }\\n');\n+                   \"{ foo: 'bar',\\n  [Symbol(nodejs.util.inspect.custom)]: \" +\n+                    '[Function: [nodejs.util.inspect.custom]] }\\n');\n assert.strictEqual(strings.shift(),\n-                   \"{ foo: 'bar',\\n  [Symbol(util.inspect.custom)]: \" +\n-                    '[Function: [util.inspect.custom]] }\\n');\n+                   \"{ foo: 'bar',\\n  [Symbol(nodejs.util.inspect.custom)]: \" +\n+                    '[Function: [nodejs.util.inspect.custom]] }\\n');\n assert.ok(strings.shift().includes('foo: [Object]'));\n assert.strictEqual(strings.shift().includes('baz'), false);\n assert.strictEqual(strings.shift(), 'inspect inspect\\n');"
        },
        {
            "sha": "4cd7286f1f4eb928872de38ca414dc91c5c52ba8",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 17,
            "deletions": 3,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/dadd6e16888baac8fd110432b81f3fd1237be3e1/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/dadd6e16888baac8fd110432b81f3fd1237be3e1/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=dadd6e16888baac8fd110432b81f3fd1237be3e1",
            "patch": "@@ -627,7 +627,7 @@ assert.strictEqual(util.inspect(Object.create(Date.prototype)), 'Date {}');\n {\n   const x = { [util.inspect.custom]: util.inspect };\n   assert(util.inspect(x).includes(\n-    '[Symbol(util.inspect.custom)]:\\n   { [Function: inspect]'));\n+    '[Symbol(nodejs.util.inspect.custom)]:\\n   { [Function: inspect]'));\n }\n \n // `util.inspect` should display the escaped value of a key.\n@@ -758,12 +758,26 @@ util.inspect({ hasOwnProperty: null });\n   };\n \n   util.inspect(subject, { customInspectOptions: true });\n+\n+  // util.inspect.custom is a shared symbol which can be accessed as\n+  // Symbol.for(\"nodejs.util.inspect.custom\").\n+  const inspect = Symbol.for('nodejs.util.inspect.custom');\n+\n+  subject[inspect] = () => ({ baz: 'quux' });\n+\n+  assert.strictEqual(util.inspect(subject), '{ baz: \\'quux\\' }');\n+\n+  subject[inspect] = (depth, opts) => {\n+    assert.strictEqual(opts.customInspectOptions, true);\n+  };\n+\n+  util.inspect(subject, { customInspectOptions: true });\n }\n \n {\n   // Returning `this` from a custom inspection function works.\n   const subject = { a: 123, [util.inspect.custom]() { return this; } };\n-  const UIC = 'util.inspect.custom';\n+  const UIC = 'nodejs.util.inspect.custom';\n   assert.strictEqual(util.inspect(subject),\n                      `{ a: 123,\\n  [Symbol(${UIC})]: [Function: [${UIC}]] }`);\n }\n@@ -1188,7 +1202,7 @@ util.inspect(process);\n   const obj = { [util.inspect.custom]: 'fhqwhgads' };\n   assert.strictEqual(\n     util.inspect(obj),\n-    \"{ [Symbol(util.inspect.custom)]: 'fhqwhgads' }\"\n+    \"{ [Symbol(nodejs.util.inspect.custom)]: 'fhqwhgads' }\"\n   );\n }\n "
        }
    ],
    "stats": {
        "total": 78,
        "additions": 63,
        "deletions": 15
    }
}