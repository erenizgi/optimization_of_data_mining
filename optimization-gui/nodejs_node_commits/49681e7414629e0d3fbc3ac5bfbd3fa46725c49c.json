{
    "author": "BridgeAR",
    "message": "process: refactor emitWarning\n\nRemove a couple of obsolete checks by refactoring the code with else.\nAlso remove the possibility of an undefined warning. That is neither\ndocumented nor does it result in a usable warning.\n\nPR-URL: https://github.com/nodejs/node/pull/20726\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "49681e7414629e0d3fbc3ac5bfbd3fa46725c49c",
    "files": [
        {
            "sha": "131d479474f248ea99e80c4646733a94c5831d0e",
            "filename": "lib/internal/process/warning.js",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/49681e7414629e0d3fbc3ac5bfbd3fa46725c49c/lib%2Finternal%2Fprocess%2Fwarning.js",
            "raw_url": "https://github.com/nodejs/node/raw/49681e7414629e0d3fbc3ac5bfbd3fa46725c49c/lib%2Finternal%2Fprocess%2Fwarning.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fwarning.js?ref=49681e7414629e0d3fbc3ac5bfbd3fa46725c49c",
            "patch": "@@ -105,7 +105,7 @@ function setupProcessWarnings() {\n   // process.emitWarning(str[, type[, code]][, ctor])\n   // process.emitWarning(str[, options])\n   process.emitWarning = function(warning, type, code, ctor, now) {\n-    var detail;\n+    let detail;\n     if (type !== null && typeof type === 'object' && !Array.isArray(type)) {\n       ctor = type.ctor;\n       code = type.code;\n@@ -117,23 +117,23 @@ function setupProcessWarnings() {\n       code = undefined;\n       type = 'Warning';\n     }\n+    if (type !== undefined && typeof type !== 'string') {\n+      throw new ERR_INVALID_ARG_TYPE('type', 'string', type);\n+    }\n     if (typeof code === 'function') {\n       ctor = code;\n       code = undefined;\n-    }\n-    if (code !== undefined && typeof code !== 'string')\n+    } else if (code !== undefined && typeof code !== 'string') {\n       throw new ERR_INVALID_ARG_TYPE('code', 'string', code);\n-    if (type !== undefined && typeof type !== 'string')\n-      throw new ERR_INVALID_ARG_TYPE('type', 'string', type);\n-    if (warning === undefined || typeof warning === 'string') {\n+    }\n+    if (typeof warning === 'string') {\n       // eslint-disable-next-line no-restricted-syntax\n       warning = new Error(warning);\n       warning.name = String(type || 'Warning');\n       if (code !== undefined) warning.code = code;\n       if (detail !== undefined) warning.detail = detail;\n       Error.captureStackTrace(warning, ctor || process.emitWarning);\n-    }\n-    if (!(warning instanceof Error)) {\n+    } else if (!(warning instanceof Error)) {\n       throw new ERR_INVALID_ARG_TYPE('warning', ['Error', 'string'], warning);\n     }\n     if (warning.name === 'DeprecationWarning') {"
        },
        {
            "sha": "e51d391a7bd1ea065c59b7441dc77f39cdbadf8e",
            "filename": "test/parallel/test-process-emitwarning.js",
            "status": "modified",
            "additions": 23,
            "deletions": 16,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/49681e7414629e0d3fbc3ac5bfbd3fa46725c49c/test%2Fparallel%2Ftest-process-emitwarning.js",
            "raw_url": "https://github.com/nodejs/node/raw/49681e7414629e0d3fbc3ac5bfbd3fa46725c49c/test%2Fparallel%2Ftest-process-emitwarning.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-emitwarning.js?ref=49681e7414629e0d3fbc3ac5bfbd3fa46725c49c",
            "patch": "@@ -43,8 +43,8 @@ class CustomWarning extends Error {\n   [testMsg, { type: testType, code: testCode, detail: [] }],\n   [testMsg, { type: testType, code: testCode, detail: null }],\n   [testMsg, { type: testType, code: testCode, detail: 1 }]\n-].forEach((i) => {\n-  process.emitWarning.apply(null, i);\n+].forEach((args) => {\n+  process.emitWarning(...args);\n });\n \n const warningNoToString = new CustomWarning();\n@@ -57,18 +57,25 @@ warningThrowToString.toString = function() {\n };\n process.emitWarning(warningThrowToString);\n \n-const expectedError =\n-  common.expectsError({ code: 'ERR_INVALID_ARG_TYPE', type: TypeError }, 11);\n-\n // TypeError is thrown on invalid input\n-assert.throws(() => process.emitWarning(1), expectedError);\n-assert.throws(() => process.emitWarning({}), expectedError);\n-assert.throws(() => process.emitWarning(true), expectedError);\n-assert.throws(() => process.emitWarning([]), expectedError);\n-assert.throws(() => process.emitWarning('', '', {}), expectedError);\n-assert.throws(() => process.emitWarning('', 1), expectedError);\n-assert.throws(() => process.emitWarning('', '', 1), expectedError);\n-assert.throws(() => process.emitWarning('', true), expectedError);\n-assert.throws(() => process.emitWarning('', '', true), expectedError);\n-assert.throws(() => process.emitWarning('', []), expectedError);\n-assert.throws(() => process.emitWarning('', '', []), expectedError);\n+[\n+  [1],\n+  [{}],\n+  [true],\n+  [[]],\n+  ['', '', {}],\n+  ['', 1],\n+  ['', '', 1],\n+  ['', true],\n+  ['', '', true],\n+  ['', []],\n+  ['', '', []],\n+  [],\n+  [undefined, 'foo', 'bar'],\n+  [undefined]\n+].forEach((args) => {\n+  common.expectsError(\n+    () => process.emitWarning(...args),\n+    { code: 'ERR_INVALID_ARG_TYPE', type: TypeError }\n+  );\n+});"
        }
    ],
    "stats": {
        "total": 55,
        "additions": 31,
        "deletions": 24
    }
}