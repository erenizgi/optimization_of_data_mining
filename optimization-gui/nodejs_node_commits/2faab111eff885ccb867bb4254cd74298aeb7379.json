{
    "author": "maclover7",
    "message": "src: remove defunct timer_wrap file\n\nUnused since the excellent refactoring in 2930bd,\nwhich also removed `src/timer_wrap.cc` from `node.gyp`. If you try and\nget at the binding on a v11.0-pre build, you'll get an error, since the\nfile is no longer in the GYP build.\n\n```\nJonathans-MBP:node jon$ ./node -v\nv11.0.0-pre\nJonathans-MBP:node jon$ ./node -e \"process.binding('timer_wrap')\"\ninternal/bootstrap/loaders.js:81\n        mod = bindingObj[module] = getBinding(module);\n                                   ^\n\nError: No such module: timer_wrap\n    at process.binding (internal/bootstrap/loaders.js:81:36)\n    at [eval]:1:9\n    at Script.runInThisContext (vm.js:89:20)\n    at Object.runInThisContext (vm.js:286:38)\n    at Object.<anonymous> ([eval]-wrapper:6:22)\n    at Module._compile (internal/modules/cjs/loader.js:689:30)\n    at evalScript (internal/bootstrap/node.js:562:27)\n    at startup (internal/bootstrap/node.js:248:9)\n    at bootstrapNodeJSCore (internal/bootstrap/node.js:595:3)\n```\n\nPR-URL: https://github.com/nodejs/node/pull/21777\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nRefs: https://github.com/nodejs/node/pull/20894",
    "sha": "2faab111eff885ccb867bb4254cd74298aeb7379",
    "files": [
        {
            "sha": "c3962e83eef1eba47f883e0b246565b61f246f74",
            "filename": "src/timer_wrap.cc",
            "status": "removed",
            "additions": 0,
            "deletions": 152,
            "changes": 152,
            "blob_url": "https://github.com/nodejs/node/blob/42bded83e8b71dda885c173d33b0190cdee3d0da/src%2Ftimer_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/42bded83e8b71dda885c173d33b0190cdee3d0da/src%2Ftimer_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftimer_wrap.cc?ref=42bded83e8b71dda885c173d33b0190cdee3d0da",
            "patch": "@@ -1,152 +0,0 @@\n-// Copyright Joyent, Inc. and other Node contributors.\n-//\n-// Permission is hereby granted, free of charge, to any person obtaining a\n-// copy of this software and associated documentation files (the\n-// \"Software\"), to deal in the Software without restriction, including\n-// without limitation the rights to use, copy, modify, merge, publish,\n-// distribute, sublicense, and/or sell copies of the Software, and to permit\n-// persons to whom the Software is furnished to do so, subject to the\n-// following conditions:\n-//\n-// The above copyright notice and this permission notice shall be included\n-// in all copies or substantial portions of the Software.\n-//\n-// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n-// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n-// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n-// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n-// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n-// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n-// USE OR OTHER DEALINGS IN THE SOFTWARE.\n-\n-#include \"async_wrap-inl.h\"\n-#include \"env-inl.h\"\n-#include \"handle_wrap.h\"\n-#include \"util-inl.h\"\n-\n-#include <stdint.h>\n-\n-namespace node {\n-namespace {\n-\n-using v8::Array;\n-using v8::Context;\n-using v8::Function;\n-using v8::FunctionCallbackInfo;\n-using v8::FunctionTemplate;\n-using v8::HandleScope;\n-using v8::Integer;\n-using v8::Local;\n-using v8::Object;\n-using v8::String;\n-using v8::Value;\n-\n-class TimerWrap : public HandleWrap {\n- public:\n-  static void Initialize(Local<Object> target,\n-                         Local<Value> unused,\n-                         Local<Context> context) {\n-    Environment* env = Environment::GetCurrent(context);\n-    Local<FunctionTemplate> constructor = env->NewFunctionTemplate(New);\n-    Local<String> timerString = FIXED_ONE_BYTE_STRING(env->isolate(), \"Timer\");\n-    constructor->InstanceTemplate()->SetInternalFieldCount(1);\n-    constructor->SetClassName(timerString);\n-\n-    env->SetTemplateMethod(constructor, \"now\", Now);\n-\n-    AsyncWrap::AddWrapMethods(env, constructor);\n-    HandleWrap::AddWrapMethods(env, constructor);\n-\n-    env->SetProtoMethod(constructor, \"start\", Start);\n-\n-    target->Set(timerString, constructor->GetFunction());\n-\n-    target->Set(env->context(),\n-                FIXED_ONE_BYTE_STRING(env->isolate(), \"setupTimers\"),\n-                env->NewFunctionTemplate(SetupTimers)\n-                   ->GetFunction(env->context()).ToLocalChecked()).FromJust();\n-  }\n-\n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n- private:\n-  static void SetupTimers(const FunctionCallbackInfo<Value>& args) {\n-    CHECK(args[0]->IsFunction());\n-    CHECK(args[1]->IsFunction());\n-    auto env = Environment::GetCurrent(args);\n-\n-    env->set_immediate_callback_function(args[0].As<Function>());\n-    env->set_timers_callback_function(args[1].As<Function>());\n-\n-    auto toggle_ref_cb = [] (const FunctionCallbackInfo<Value>& args) {\n-      Environment::GetCurrent(args)->ToggleImmediateRef(args[0]->IsTrue());\n-    };\n-    auto toggle_ref_function =\n-        env->NewFunctionTemplate(toggle_ref_cb)->GetFunction(env->context())\n-        .ToLocalChecked();\n-    auto result = Array::New(env->isolate(), 2);\n-    result->Set(env->context(), 0,\n-                env->immediate_info()->fields().GetJSArray()).FromJust();\n-    result->Set(env->context(), 1, toggle_ref_function).FromJust();\n-    args.GetReturnValue().Set(result);\n-  }\n-\n-  static void New(const FunctionCallbackInfo<Value>& args) {\n-    // This constructor should not be exposed to public javascript.\n-    // Therefore we assert that we are not trying to call this as a\n-    // normal function.\n-    CHECK(args.IsConstructCall());\n-    Environment* env = Environment::GetCurrent(args);\n-    new TimerWrap(env, args.This());\n-  }\n-\n-  TimerWrap(Environment* env, Local<Object> object)\n-      : HandleWrap(env,\n-                   object,\n-                   reinterpret_cast<uv_handle_t*>(&handle_),\n-                   AsyncWrap::PROVIDER_TIMERWRAP) {\n-    int r = uv_timer_init(env->event_loop(), &handle_);\n-    CHECK_EQ(r, 0);\n-  }\n-\n-  static void Start(const FunctionCallbackInfo<Value>& args) {\n-    TimerWrap* wrap;\n-    ASSIGN_OR_RETURN_UNWRAP(&wrap, args.Holder());\n-\n-    CHECK(HandleWrap::IsAlive(wrap));\n-\n-    int64_t timeout = args[0]->IntegerValue();\n-    int err = uv_timer_start(&wrap->handle_, OnTimeout, timeout, 0);\n-    args.GetReturnValue().Set(err);\n-  }\n-\n-  static void OnTimeout(uv_timer_t* handle) {\n-    TimerWrap* wrap = static_cast<TimerWrap*>(handle->data);\n-    Environment* env = wrap->env();\n-    HandleScope handle_scope(env->isolate());\n-    Context::Scope context_scope(env->context());\n-    Local<Value> ret;\n-    Local<Value> args[] = { env->GetNow() };\n-    do {\n-      ret = wrap->MakeCallback(env->timers_callback_function(), 1, args)\n-                .ToLocalChecked();\n-    } while (ret->IsUndefined() &&\n-             !env->tick_info()->has_thrown() &&\n-             env->can_call_into_js());\n-  }\n-\n-  static void Now(const FunctionCallbackInfo<Value>& args) {\n-    Environment* env = Environment::GetCurrent(args);\n-    args.GetReturnValue().Set(env->GetNow());\n-  }\n-\n-  uv_timer_t handle_;\n-};\n-\n-\n-}  // anonymous namespace\n-}  // namespace node\n-\n-NODE_BUILTIN_MODULE_CONTEXT_AWARE(timer_wrap, node::TimerWrap::Initialize)"
        }
    ],
    "stats": {
        "total": 152,
        "additions": 0,
        "deletions": 152
    }
}