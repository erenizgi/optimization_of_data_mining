{
    "author": "addaleax",
    "message": "src: add consistency check to node_platform.cc\n\nWe use the `Isolate*` pointer as the sole identifier\nfor a V8 Isolate. In some environments (e.g. multi-threaded),\nIsolates may be destroyed and new ones created; then, it\nmay happen that the memory that was previously used for\none `Isolate` can be re-used for another `Isolate`\nafter the first one has been disposed of.\n\nThis check is a little guard against accidentally\nre-using the same per-Isolate platform data structure\nin such cases, i.e. making sure (to the degree to which\nthat is possible) that the old `Isolate*` has been properly\nunregistered before one at the same memory address is added.\n\n(It’s not 100 % foolproof because the `uv_loop_t*`\npointer value could theoretically be the same as well.)\n\nPR-URL: https://github.com/nodejs/node/pull/21156\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "505bfdc7e4fc4f914ceca019706dbf06901dd361",
    "files": [
        {
            "sha": "fdca115e5f8f0375f9c87c3ba584cbde59101c5c",
            "filename": "src/node_platform.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/505bfdc7e4fc4f914ceca019706dbf06901dd361/src%2Fnode_platform.cc",
            "raw_url": "https://github.com/nodejs/node/raw/505bfdc7e4fc4f914ceca019706dbf06901dd361/src%2Fnode_platform.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_platform.cc?ref=505bfdc7e4fc4f914ceca019706dbf06901dd361",
            "patch": "@@ -141,6 +141,7 @@ void NodePlatform::RegisterIsolate(IsolateData* isolate_data, uv_loop_t* loop) {\n   Mutex::ScopedLock lock(per_isolate_mutex_);\n   std::shared_ptr<PerIsolatePlatformData> existing = per_isolate_[isolate];\n   if (existing) {\n+    CHECK_EQ(loop, existing->event_loop());\n     existing->ref();\n   } else {\n     per_isolate_[isolate] ="
        },
        {
            "sha": "f6a177c9242324743de00903cadc458bc5f3c99d",
            "filename": "src/node_platform.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/505bfdc7e4fc4f914ceca019706dbf06901dd361/src%2Fnode_platform.h",
            "raw_url": "https://github.com/nodejs/node/raw/505bfdc7e4fc4f914ceca019706dbf06901dd361/src%2Fnode_platform.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_platform.h?ref=505bfdc7e4fc4f914ceca019706dbf06901dd361",
            "patch": "@@ -72,6 +72,8 @@ class PerIsolatePlatformData :\n   bool FlushForegroundTasksInternal();\n   void CancelPendingDelayedTasks();\n \n+  const uv_loop_t* event_loop() const { return loop_; }\n+\n  private:\n   void DeleteFromScheduledTasks(DelayedTask* task);\n "
        }
    ],
    "stats": {
        "total": 3,
        "additions": 3,
        "deletions": 0
    }
}