{
    "author": "BridgeAR",
    "message": "assert: validate input stricter\n\nThis makes sure invalid `error` objects are not ignored when using\n`assert.throws` and `assert.rejects`.\n\nPR-URL: https://github.com/nodejs/node/pull/20481\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "21c3a402d486234fb00fcb130802b8fcabd97de8",
    "files": [
        {
            "sha": "45ddbe5f817d368b10e723d815a41dd0bf6ef273",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/21c3a402d486234fb00fcb130802b8fcabd97de8/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/21c3a402d486234fb00fcb130802b8fcabd97de8/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=21c3a402d486234fb00fcb130802b8fcabd97de8",
            "patch": "@@ -28,6 +28,7 @@ const {\n const { codes: {\n   ERR_AMBIGUOUS_ARGUMENT,\n   ERR_INVALID_ARG_TYPE,\n+  ERR_INVALID_ARG_VALUE,\n   ERR_INVALID_RETURN_VALUE\n } } = require('internal/errors');\n const { AssertionError, errorCache } = require('internal/assert');\n@@ -414,12 +415,6 @@ function expectedException(actual, expected, msg) {\n       );\n     }\n \n-    // TODO: Disallow primitives as error argument.\n-    // This is here to prevent a breaking change.\n-    if (typeof expected !== 'object') {\n-      return true;\n-    }\n-\n     // Handle primitives properly.\n     if (typeof actual !== 'object' || actual === null) {\n       const err = new AssertionError({\n@@ -438,6 +433,9 @@ function expectedException(actual, expected, msg) {\n     // as well.\n     if (expected instanceof Error) {\n       keys.push('name', 'message');\n+    } else if (keys.length === 0) {\n+      throw new ERR_INVALID_ARG_VALUE('error',\n+                                      expected, 'may not be an empty object');\n     }\n     for (const key of keys) {\n       if (typeof actual[key] === 'string' &&\n@@ -527,6 +525,12 @@ function expectsError(stackStartFn, actual, error, message) {\n     }\n     message = error;\n     error = undefined;\n+  } else if (error != null &&\n+             typeof error !== 'object' &&\n+             typeof error !== 'function') {\n+    throw new ERR_INVALID_ARG_TYPE('error',\n+                                   ['Object', 'Error', 'Function', 'RegExp'],\n+                                   error);\n   }\n \n   if (actual === NO_EXCEPTION_SENTINEL) {"
        },
        {
            "sha": "d3e37afa5101cb8c255fadac451714b43124874b",
            "filename": "test/parallel/test-assert.js",
            "status": "modified",
            "additions": 23,
            "deletions": 4,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/21c3a402d486234fb00fcb130802b8fcabd97de8/test%2Fparallel%2Ftest-assert.js",
            "raw_url": "https://github.com/nodejs/node/raw/21c3a402d486234fb00fcb130802b8fcabd97de8/test%2Fparallel%2Ftest-assert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert.js?ref=21c3a402d486234fb00fcb130802b8fcabd97de8",
            "patch": "@@ -772,6 +772,21 @@ common.expectsError(\n   }\n );\n \n+[\n+  1,\n+  false,\n+  Symbol()\n+].forEach((input) => {\n+  assert.throws(\n+    () => assert.throws(() => {}, input),\n+    {\n+      code: 'ERR_INVALID_ARG_TYPE',\n+      message: 'The \"error\" argument must be one of type Object, Error, ' +\n+               `Function, or RegExp. Received type ${typeof input}`\n+    }\n+  );\n+});\n+\n {\n   const errFn = () => {\n     const err = new TypeError('Wrong value');\n@@ -871,6 +886,14 @@ common.expectsError(\n   );\n }\n \n+assert.throws(\n+  () => assert.throws(() => { throw new Error(); }, {}),\n+  {\n+    message: \"The argument 'error' may not be an empty object. Received {}\",\n+    code: 'ERR_INVALID_ARG_VALUE'\n+  }\n+);\n+\n assert.throws(\n   () => a.throws(\n     // eslint-disable-next-line no-throw-literal\n@@ -981,7 +1004,3 @@ assert.throws(\n     }\n   );\n }\n-\n-// TODO: This case is only there to make sure there is no breaking change.\n-// eslint-disable-next-line no-restricted-syntax, no-throw-literal\n-assert.throws(() => { throw 4; }, 4);"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 33,
        "deletions": 10
    }
}