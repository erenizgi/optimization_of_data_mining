{
    "author": "jasnell",
    "message": "http2: fixup http2stream cleanup and other nits\n\nThis fixes CVE-2018-7161.\n\nPR-URL: https://github.com/nodejs-private/node-private/pull/115\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Evan Lucas <evanlucas@me.com>",
    "sha": "8bf213dbdc7ee9c852252527f020d48e3bc97e15",
    "files": [
        {
            "sha": "28d3de6ef0ce9763518993244fd798f975f41a84",
            "filename": "src/node_http2.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/8bf213dbdc7ee9c852252527f020d48e3bc97e15/src%2Fnode_http2.cc",
            "raw_url": "https://github.com/nodejs/node/raw/8bf213dbdc7ee9c852252527f020d48e3bc97e15/src%2Fnode_http2.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http2.cc?ref=8bf213dbdc7ee9c852252527f020d48e3bc97e15",
            "patch": "@@ -499,8 +499,8 @@ Http2Session::Http2Session(Environment* env,\n Http2Session::~Http2Session() {\n   CHECK_EQ(flags_ & SESSION_STATE_HAS_SCOPE, 0);\n   Debug(this, \"freeing nghttp2 session\");\n-  for (const auto& stream : streams_)\n-    stream.second->session_ = nullptr;\n+  for (const auto& iter : streams_)\n+    iter.second->session_ = nullptr;\n   nghttp2_session_del(session_);\n }\n \n@@ -653,6 +653,8 @@ inline void Http2Session::AddStream(Http2Stream* stream) {\n \n \n inline void Http2Session::RemoveStream(Http2Stream* stream) {\n+  if (streams_.empty() || stream == nullptr)\n+    return;  // Nothing to remove, item was never added?\n   streams_.erase(stream->id());\n   DecrementCurrentSessionMemory(stream->self_size());\n }"
        },
        {
            "sha": "70c284c357f0ea6995fcf34f63712f911adf7d61",
            "filename": "src/node_http2.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/8bf213dbdc7ee9c852252527f020d48e3bc97e15/src%2Fnode_http2.h",
            "raw_url": "https://github.com/nodejs/node/raw/8bf213dbdc7ee9c852252527f020d48e3bc97e15/src%2Fnode_http2.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http2.h?ref=8bf213dbdc7ee9c852252527f020d48e3bc97e15",
            "patch": "@@ -651,8 +651,8 @@ class Http2Stream : public AsyncWrap,\n   Statistics statistics_ = {};\n \n  private:\n-  Http2Session* session_;                       // The Parent HTTP/2 Session\n-  int32_t id_;                                  // The Stream Identifier\n+  Http2Session* session_ = nullptr;             // The Parent HTTP/2 Session\n+  int32_t id_ = 0;                              // The Stream Identifier\n   int32_t code_ = NGHTTP2_NO_ERROR;             // The RST_STREAM code (if any)\n   int flags_ = NGHTTP2_STREAM_FLAG_NONE;        // Internal state flags\n "
        }
    ],
    "stats": {
        "total": 10,
        "additions": 6,
        "deletions": 4
    }
}