{
    "author": "codebytere",
    "message": "src,test: add public wrapper for Environment::GetCurrent\n\nPR-URL: https://github.com/nodejs/node/pull/23676\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>",
    "sha": "0feb21fb028deaad69ec028c14aafe4ccd823cf2",
    "files": [
        {
            "sha": "bab251ada3a42919a3a8af89c6f787e5c4b2bb94",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/0feb21fb028deaad69ec028c14aafe4ccd823cf2/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/0feb21fb028deaad69ec028c14aafe4ccd823cf2/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=0feb21fb028deaad69ec028c14aafe4ccd823cf2",
            "patch": "@@ -2760,6 +2760,11 @@ void FreeEnvironment(Environment* env) {\n }\n \n \n+Environment* GetCurrentEnvironment(Local<Context> context) {\n+  return Environment::GetCurrent(context);\n+}\n+\n+\n MultiIsolatePlatform* GetMainThreadMultiIsolatePlatform() {\n   return v8_platform.Platform();\n }"
        },
        {
            "sha": "98db32895295c34168ce138fd5b0b5a0b5d40997",
            "filename": "src/node.h",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/0feb21fb028deaad69ec028c14aafe4ccd823cf2/src%2Fnode.h",
            "raw_url": "https://github.com/nodejs/node/raw/0feb21fb028deaad69ec028c14aafe4ccd823cf2/src%2Fnode.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.h?ref=0feb21fb028deaad69ec028c14aafe4ccd823cf2",
            "patch": "@@ -265,6 +265,9 @@ NODE_EXTERN Environment* CreateEnvironment(IsolateData* isolate_data,\n NODE_EXTERN void LoadEnvironment(Environment* env);\n NODE_EXTERN void FreeEnvironment(Environment* env);\n \n+// This may return nullptr if context is not associated with a Node instance.\n+NODE_EXTERN Environment* GetCurrentEnvironment(v8::Local<v8::Context> context);\n+\n // This returns the MultiIsolatePlatform used in the main thread of Node.js.\n // If NODE_USE_V8_PLATFORM haven't been defined when Node.js was built,\n // it returns nullptr."
        },
        {
            "sha": "49dc700bb5771647c1a31cc46325f90febdeffe4",
            "filename": "test/cctest/test_environment.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/0feb21fb028deaad69ec028c14aafe4ccd823cf2/test%2Fcctest%2Ftest_environment.cc",
            "raw_url": "https://github.com/nodejs/node/raw/0feb21fb028deaad69ec028c14aafe4ccd823cf2/test%2Fcctest%2Ftest_environment.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcctest%2Ftest_environment.cc?ref=0feb21fb028deaad69ec028c14aafe4ccd823cf2",
            "patch": "@@ -80,13 +80,16 @@ TEST_F(EnvironmentTest, NonNodeJSContext) {\n   node::Environment* env = *test_env;\n   EXPECT_EQ(node::Environment::GetCurrent(isolate_), env);\n   EXPECT_EQ(node::Environment::GetCurrent(env->context()), env);\n+  EXPECT_EQ(node::GetCurrentEnvironment(env->context()), env);\n \n   v8::Local<v8::Context> context = v8::Context::New(isolate_);\n   EXPECT_EQ(node::Environment::GetCurrent(context), nullptr);\n+  EXPECT_EQ(node::GetCurrentEnvironment(context), nullptr);\n   EXPECT_EQ(node::Environment::GetCurrent(isolate_), env);\n \n   v8::Context::Scope context_scope(context);\n   EXPECT_EQ(node::Environment::GetCurrent(context), nullptr);\n+  EXPECT_EQ(node::GetCurrentEnvironment(context), nullptr);\n   EXPECT_EQ(node::Environment::GetCurrent(isolate_), nullptr);\n }\n "
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}