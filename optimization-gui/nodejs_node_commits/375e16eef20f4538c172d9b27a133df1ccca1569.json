{
    "author": "refack",
    "message": "build: encapsulate node/inspector gyp scafolding\n\nPR-URL: https://github.com/nodejs/node/pull/23156\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>",
    "sha": "375e16eef20f4538c172d9b27a133df1ccca1569",
    "files": [
        {
            "sha": "baae954d1587cae0c375d32e5fd53b7a7279751a",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 194,
            "changes": 195,
            "blob_url": "https://github.com/nodejs/node/blob/375e16eef20f4538c172d9b27a133df1ccca1569/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/375e16eef20f4538c172d9b27a133df1ccca1569/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=375e16eef20f4538c172d9b27a133df1ccca1569",
            "patch": "@@ -491,40 +491,7 @@\n           'product_name': 'node_base',\n         }],\n         [ 'v8_enable_inspector==1', {\n-          'defines': [\n-            'HAVE_INSPECTOR=1',\n-          ],\n-          'sources': [\n-            'src/inspector_agent.cc',\n-            'src/inspector_io.cc',\n-            'src/inspector_js_api.cc',\n-            'src/inspector_socket.cc',\n-            'src/inspector_socket_server.cc',\n-            'src/inspector/main_thread_interface.cc',\n-            'src/inspector/worker_inspector.cc',\n-            'src/inspector/node_string.cc',\n-            'src/inspector/worker_agent.cc',\n-            'src/inspector/tracing_agent.cc',\n-            'src/inspector_agent.h',\n-            'src/inspector_io.h',\n-            'src/inspector_socket.h',\n-            'src/inspector_socket_server.h',\n-            'src/inspector/main_thread_interface.h',\n-            'src/inspector/worker_inspector.h',\n-            'src/inspector/node_string.h',\n-            'src/inspector/worker_agent.h',\n-            'src/inspector/tracing_agent.h',\n-            '<@(node_inspector_generated_sources)'\n-          ],\n-          'dependencies': [\n-            'node_protocol_generated_sources#host',\n-            'v8_inspector_compress_protocol_json#host',\n-          ],\n-          'include_dirs': [\n-            '<(SHARED_INTERMEDIATE_DIR)/include', # for inspector\n-            '<(SHARED_INTERMEDIATE_DIR)',\n-            '<(SHARED_INTERMEDIATE_DIR)/src', # for inspector\n-          ],\n+          'includes' : [ 'src/inspector/node_inspector.gypi' ],\n         }, {\n           'defines': [ 'HAVE_INSPECTOR=0' ]\n         }],\n@@ -989,165 +956,5 @@\n         },\n       ]\n     }], # end aix section\n-    [ 'v8_enable_inspector==1', {\n-      'variables': {\n-        'protocol_path': 'tools/inspector_protocol',\n-        'node_inspector_path': 'src/inspector',\n-        'node_inspector_generated_sources': [\n-          '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/Forward.h',\n-          '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/Protocol.cpp',\n-          '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/Protocol.h',\n-          '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/NodeWorker.cpp',\n-          '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/NodeWorker.h',\n-          '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/NodeTracing.cpp',\n-          '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/NodeTracing.h',\n-        ],\n-        'node_protocol_files': [\n-          '<(protocol_path)/lib/Allocator_h.template',\n-          '<(protocol_path)/lib/Array_h.template',\n-          '<(protocol_path)/lib/Collections_h.template',\n-          '<(protocol_path)/lib/DispatcherBase_cpp.template',\n-          '<(protocol_path)/lib/DispatcherBase_h.template',\n-          '<(protocol_path)/lib/ErrorSupport_cpp.template',\n-          '<(protocol_path)/lib/ErrorSupport_h.template',\n-          '<(protocol_path)/lib/Forward_h.template',\n-          '<(protocol_path)/lib/FrontendChannel_h.template',\n-          '<(protocol_path)/lib/Maybe_h.template',\n-          '<(protocol_path)/lib/Object_cpp.template',\n-          '<(protocol_path)/lib/Object_h.template',\n-          '<(protocol_path)/lib/Parser_cpp.template',\n-          '<(protocol_path)/lib/Parser_h.template',\n-          '<(protocol_path)/lib/Protocol_cpp.template',\n-          '<(protocol_path)/lib/ValueConversions_h.template',\n-          '<(protocol_path)/lib/Values_cpp.template',\n-          '<(protocol_path)/lib/Values_h.template',\n-          '<(protocol_path)/templates/Exported_h.template',\n-          '<(protocol_path)/templates/Imported_h.template',\n-          '<(protocol_path)/templates/TypeBuilder_cpp.template',\n-          '<(protocol_path)/templates/TypeBuilder_h.template',\n-          '<(protocol_path)/CodeGenerator.py',\n-        ]\n-      },\n-      'targets': [\n-        {\n-          'target_name': 'prepare_protocol_json',\n-          'type': 'none',\n-          'toolsets': ['host'],\n-          'copies': [\n-            {\n-              'files': [\n-                '<(node_inspector_path)/node_protocol_config.json',\n-                '<(node_inspector_path)/node_protocol.pdl'\n-              ],\n-              'destination': '<(SHARED_INTERMEDIATE_DIR)',\n-            }\n-          ],\n-          'actions': [\n-            {\n-              'action_name': 'convert_node_protocol_to_json',\n-              'inputs': [\n-                '<(SHARED_INTERMEDIATE_DIR)/node_protocol.pdl',\n-              ],\n-              'outputs': [\n-                '<(SHARED_INTERMEDIATE_DIR)/node_protocol.json',\n-              ],\n-              'action': [\n-                'python',\n-                'tools/inspector_protocol/ConvertProtocolToJSON.py',\n-                '<@(_inputs)',\n-                '<@(_outputs)',\n-              ],\n-            },\n-          ]\n-        },\n-        {\n-          'target_name': 'node_protocol_generated_sources',\n-          'type': 'none',\n-          'toolsets': ['host'],\n-          'dependencies': ['prepare_protocol_json'],\n-          'actions': [\n-            {\n-              'action_name': 'node_protocol_generated_sources',\n-              'inputs': [\n-                '<(SHARED_INTERMEDIATE_DIR)/node_protocol_config.json',\n-                '<(SHARED_INTERMEDIATE_DIR)/node_protocol.json',\n-                '<@(node_protocol_files)',\n-              ],\n-              'outputs': [\n-                '<@(node_inspector_generated_sources)',\n-              ],\n-              'action': [\n-                'python',\n-                '<(protocol_path)/CodeGenerator.py',\n-                '--jinja_dir', '<@(protocol_path)/..',\n-                '--output_base', '<(SHARED_INTERMEDIATE_DIR)/src/',\n-                '--config', '<(SHARED_INTERMEDIATE_DIR)/node_protocol_config.json',\n-              ],\n-              'message': 'Generating node protocol sources from protocol json',\n-            },\n-          ]\n-        },\n-        {\n-          'target_name': 'v8_inspector_compress_protocol_json',\n-          'type': 'none',\n-          'toolsets': ['host'],\n-          'copies': [\n-            {\n-              'destination': '<(SHARED_INTERMEDIATE_DIR)',\n-              'files': ['deps/v8/src/inspector/js_protocol.pdl']\n-            }\n-          ],\n-          'actions': [\n-            {\n-              'action_name': 'v8_inspector_convert_protocol_to_json',\n-              'inputs': [\n-                '<(SHARED_INTERMEDIATE_DIR)/js_protocol.pdl',\n-              ],\n-              'outputs': [\n-                '<(SHARED_INTERMEDIATE_DIR)/js_protocol.json',\n-              ],\n-              'action': [\n-                'python',\n-                'tools/inspector_protocol/ConvertProtocolToJSON.py',\n-                '<@(_inputs)',\n-                '<@(_outputs)',\n-              ],\n-            },\n-            {\n-              'action_name': 'concatenate_protocols',\n-              'inputs': [\n-                '<(SHARED_INTERMEDIATE_DIR)/js_protocol.json',\n-                '<(SHARED_INTERMEDIATE_DIR)/node_protocol.json',\n-              ],\n-              'outputs': [\n-                '<(SHARED_INTERMEDIATE_DIR)/concatenated_protocol.json',\n-              ],\n-              'action': [\n-                'python',\n-                'tools/inspector_protocol/ConcatenateProtocols.py',\n-                '<@(_inputs)',\n-                '<@(_outputs)',\n-              ],\n-            },\n-            {\n-              'action_name': 'v8_inspector_compress_protocol_json',\n-              'process_outputs_as_sources': 1,\n-              'inputs': [\n-                '<(SHARED_INTERMEDIATE_DIR)/concatenated_protocol.json',\n-              ],\n-              'outputs': [\n-                '<(SHARED_INTERMEDIATE_DIR)/v8_inspector_protocol_json.h',\n-              ],\n-              'action': [\n-                'python',\n-                'tools/compress_json.py',\n-                '<@(_inputs)',\n-                '<@(_outputs)',\n-              ],\n-            },\n-          ],\n-        },\n-      ]\n-    }]\n   ], # end conditions block\n }"
        },
        {
            "sha": "aea4de894fbe99739e904416247e8d375ef6a8e0",
            "filename": "src/inspector/node_inspector.gypi",
            "status": "added",
            "additions": 149,
            "deletions": 0,
            "changes": 149,
            "blob_url": "https://github.com/nodejs/node/blob/375e16eef20f4538c172d9b27a133df1ccca1569/src%2Finspector%2Fnode_inspector.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/375e16eef20f4538c172d9b27a133df1ccca1569/src%2Finspector%2Fnode_inspector.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector%2Fnode_inspector.gypi?ref=375e16eef20f4538c172d9b27a133df1ccca1569",
            "patch": "@@ -0,0 +1,149 @@\n+{\n+  'variables': {\n+    'protocol_tool_path': '../../tools/inspector_protocol',\n+    'node_inspector_path': '../../src/inspector',\n+    'node_inspector_generated_sources': [\n+      '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/Forward.h',\n+      '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/Protocol.cpp',\n+      '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/Protocol.h',\n+      '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/NodeWorker.cpp',\n+      '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/NodeWorker.h',\n+      '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/NodeTracing.cpp',\n+      '<(SHARED_INTERMEDIATE_DIR)/src/node/inspector/protocol/NodeTracing.h',\n+    ],\n+    'node_protocol_files': [\n+      '<(protocol_tool_path)/lib/Allocator_h.template',\n+      '<(protocol_tool_path)/lib/Array_h.template',\n+      '<(protocol_tool_path)/lib/Collections_h.template',\n+      '<(protocol_tool_path)/lib/DispatcherBase_cpp.template',\n+      '<(protocol_tool_path)/lib/DispatcherBase_h.template',\n+      '<(protocol_tool_path)/lib/ErrorSupport_cpp.template',\n+      '<(protocol_tool_path)/lib/ErrorSupport_h.template',\n+      '<(protocol_tool_path)/lib/Forward_h.template',\n+      '<(protocol_tool_path)/lib/FrontendChannel_h.template',\n+      '<(protocol_tool_path)/lib/Maybe_h.template',\n+      '<(protocol_tool_path)/lib/Object_cpp.template',\n+      '<(protocol_tool_path)/lib/Object_h.template',\n+      '<(protocol_tool_path)/lib/Parser_cpp.template',\n+      '<(protocol_tool_path)/lib/Parser_h.template',\n+      '<(protocol_tool_path)/lib/Protocol_cpp.template',\n+      '<(protocol_tool_path)/lib/ValueConversions_h.template',\n+      '<(protocol_tool_path)/lib/Values_cpp.template',\n+      '<(protocol_tool_path)/lib/Values_h.template',\n+      '<(protocol_tool_path)/templates/Exported_h.template',\n+      '<(protocol_tool_path)/templates/Imported_h.template',\n+      '<(protocol_tool_path)/templates/TypeBuilder_cpp.template',\n+      '<(protocol_tool_path)/templates/TypeBuilder_h.template',\n+      '<(protocol_tool_path)/CodeGenerator.py',\n+    ]\n+  },\n+  'defines': [\n+    'HAVE_INSPECTOR=1',\n+  ],\n+  'sources': [\n+    '../../src/inspector_agent.cc',\n+    '../../src/inspector_io.cc',\n+    '../../src/inspector_agent.h',\n+    '../../src/inspector_io.h',\n+    '../../src/inspector_js_api.cc',\n+    '../../src/inspector_socket.cc',\n+    '../../src/inspector_socket.h',\n+    '../../src/inspector_socket_server.cc',\n+    '../../src/inspector_socket_server.h',\n+    '../../src/inspector/main_thread_interface.cc',\n+    '../../src/inspector/main_thread_interface.h',\n+    '../../src/inspector/node_string.cc',\n+    '../../src/inspector/node_string.h',\n+    '../../src/inspector/tracing_agent.cc',\n+    '../../src/inspector/tracing_agent.h',\n+    '../../src/inspector/worker_agent.cc',\n+    '../../src/inspector/worker_agent.h',\n+    '../../src/inspector/worker_inspector.cc',\n+    '../../src/inspector/worker_inspector.h',\n+  ],\n+  'include_dirs': [\n+    '<(SHARED_INTERMEDIATE_DIR)/include', # for inspector\n+    '<(SHARED_INTERMEDIATE_DIR)',\n+    '<(SHARED_INTERMEDIATE_DIR)/src', # for inspector\n+  ],\n+  'copies': [\n+    {\n+      'files': [\n+        '<(node_inspector_path)/node_protocol_config.json',\n+        '<(node_inspector_path)/node_protocol.pdl'\n+      ],\n+      'destination': '<(SHARED_INTERMEDIATE_DIR)',\n+    }\n+  ],\n+  'actions': [\n+    {\n+      'action_name': 'convert_node_protocol_to_json',\n+      'inputs': [\n+        '<(SHARED_INTERMEDIATE_DIR)/node_protocol.pdl',\n+      ],\n+      'outputs': [\n+        '<(SHARED_INTERMEDIATE_DIR)/node_protocol.json',\n+      ],\n+      'action': [\n+        'python',\n+        'tools/inspector_protocol/ConvertProtocolToJSON.py',\n+        '<@(_inputs)',\n+        '<@(_outputs)',\n+      ],\n+    },\n+    {\n+      'action_name': 'node_protocol_generated_sources',\n+      'process_outputs_as_sources': 0,\n+      'inputs': [\n+        '<(SHARED_INTERMEDIATE_DIR)/node_protocol_config.json',\n+        '<(SHARED_INTERMEDIATE_DIR)/node_protocol.json',\n+        '<@(node_protocol_files)',\n+      ],\n+      'outputs': [\n+        '<@(node_inspector_generated_sources)',\n+      ],\n+      'process_outputs_as_sources': 1,\n+      'action': [\n+        'python',\n+        'tools/inspector_protocol/CodeGenerator.py',\n+        '--jinja_dir', '<@(protocol_tool_path)/..',\n+        '--output_base', '<(SHARED_INTERMEDIATE_DIR)/src/',\n+        '--config', '<(SHARED_INTERMEDIATE_DIR)/node_protocol_config.json',\n+      ],\n+      'message': 'Generating node protocol sources from protocol json',\n+    },\n+    {\n+      'action_name': 'concatenate_protocols',\n+      'inputs': [\n+        '../../deps/v8/src/inspector/js_protocol.json',\n+        '<(SHARED_INTERMEDIATE_DIR)/node_protocol.json',\n+      ],\n+      'outputs': [\n+        '<(SHARED_INTERMEDIATE_DIR)/concatenated_protocol.json',\n+      ],\n+      'action': [\n+        'python',\n+        'tools/inspector_protocol/ConcatenateProtocols.py',\n+        '<@(_inputs)',\n+        '<@(_outputs)',\n+      ],\n+    },\n+    {\n+      'action_name': 'v8_inspector_compress_protocol_json',\n+      'process_outputs_as_sources': 0,\n+      'inputs': [\n+        '<(SHARED_INTERMEDIATE_DIR)/concatenated_protocol.json',\n+      ],\n+      'outputs': [\n+        '<(SHARED_INTERMEDIATE_DIR)/v8_inspector_protocol_json.h',\n+      ],\n+      'process_outputs_as_sources': 1,\n+      'action': [\n+        'python',\n+        'tools/compress_json.py',\n+        '<@(_inputs)',\n+        '<@(_outputs)',\n+      ],\n+    },\n+  ],\n+}"
        }
    ],
    "stats": {
        "total": 344,
        "additions": 150,
        "deletions": 194
    }
}