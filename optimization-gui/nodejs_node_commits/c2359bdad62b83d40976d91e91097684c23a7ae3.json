{
    "author": "joyeecheung",
    "message": "process: expose process.features.inspector\n\nInstead of using process.config.variables.v8_enable_inspector\nto detect whether inspector is enabled in the build.\n\nPR-URL: https://github.com/nodejs/node/pull/25819\nRefs: https://github.com/nodejs/node/issues/25343\nReviewed-By: Eugene Ostroukhov <eostroukhov@google.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "c2359bdad62b83d40976d91e91097684c23a7ae3",
    "files": [
        {
            "sha": "6fa3f2b79ddb76e6ce6fd7b6cea6f6a9332500de",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -268,12 +268,13 @@ process.assert = deprecate(\n \n // TODO(joyeecheung): this property has not been well-maintained, should we\n // deprecate it in favor of a better API?\n-const { isDebugBuild, hasOpenSSL } = config;\n+const { isDebugBuild, hasOpenSSL, hasInspector } = config;\n Object.defineProperty(process, 'features', {\n   enumerable: true,\n   writable: false,\n   configurable: false,\n   value: {\n+    inspector: hasInspector,\n     debug: isDebugBuild,\n     uv: true,\n     ipv6: true,  // TODO(bnoordhuis) ping libuv"
        },
        {
            "sha": "e237db16a648004a81aade3c68ed00e6a358146e",
            "filename": "lib/internal/util/inspector.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/lib%2Finternal%2Futil%2Finspector.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/lib%2Finternal%2Futil%2Finspector.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspector.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -3,8 +3,8 @@\n let session;\n function sendInspectorCommand(cb, onError) {\n   const { hasInspector } = internalBinding('config');\n-  const inspector = hasInspector ? require('inspector') : undefined;\n   if (!hasInspector) return onError();\n+  const inspector = require('inspector');\n   if (session === undefined) session = new inspector.Session();\n   try {\n     session.connect();"
        },
        {
            "sha": "56672308d1bc1e921e40515524289c012f7f4991",
            "filename": "src/node_config.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/src%2Fnode_config.cc",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/src%2Fnode_config.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_config.cc?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -57,18 +57,18 @@ static void Initialize(Local<Object> target,\n   READONLY_TRUE_PROPERTY(target, \"hasTracing\");\n #endif\n \n-#if HAVE_INSPECTOR\n-  READONLY_TRUE_PROPERTY(target, \"hasInspector\");\n-#else\n-  READONLY_FALSE_PROPERTY(target, \"hasInspector\");\n-#endif\n-\n #if !defined(NODE_WITHOUT_NODE_OPTIONS)\n   READONLY_TRUE_PROPERTY(target, \"hasNodeOptions\");\n #endif\n \n #endif  // NODE_HAVE_I18N_SUPPORT\n \n+#if HAVE_INSPECTOR\n+  READONLY_TRUE_PROPERTY(target, \"hasInspector\");\n+#else\n+  READONLY_FALSE_PROPERTY(target, \"hasInspector\");\n+#endif\n+\n   if (env->abort_on_uncaught_exception())\n     READONLY_TRUE_PROPERTY(target, \"shouldAbortOnUncaughtException\");\n "
        },
        {
            "sha": "8554b85fe86265231fa69622e73289443a9b3da6",
            "filename": "test/common/index.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fcommon%2Findex.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fcommon%2Findex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -80,8 +80,7 @@ if (process.argv.length === 2 &&\n           hasCrypto &&\n           // If the binary is build without `intl` the inspect option is\n           // invalid. The test itself should handle this case.\n-          (process.config.variables.v8_enable_inspector !== 0 ||\n-            !flag.startsWith('--inspect'))) {\n+          (process.features.inspector || !flag.startsWith('--inspect'))) {\n         throw new Error(`Test has to be started with the flag: '${flag}'`);\n       }\n     }\n@@ -618,7 +617,7 @@ function expectsError(fn, settings, exact) {\n }\n \n function skipIfInspectorDisabled() {\n-  if (process.config.variables.v8_enable_inspector === 0) {\n+  if (!process.features.inspector) {\n     skip('V8 inspector is disabled');\n   }\n }"
        },
        {
            "sha": "bc04e9907b168bad35919ad9b6d5db3b9543ee95",
            "filename": "test/known_issues/test-inspector-cluster-port-clash.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fknown_issues%2Ftest-inspector-cluster-port-clash.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fknown_issues%2Ftest-inspector-cluster-port-clash.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fknown_issues%2Ftest-inspector-cluster-port-clash.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -13,7 +13,7 @@ const assert = require('assert');\n \n // This following check should be replaced by common.skipIfInspectorDisabled()\n // if moved out of the known_issues directory.\n-if (process.config.variables.v8_enable_inspector === 0) {\n+if (!process.features.inspector) {\n   // When the V8 inspector is disabled, using either --without-inspector or\n   // --without-ssl, this test will not fail which it is expected to do.\n   // The following fail will allow this test to be skipped by failing it."
        },
        {
            "sha": "3fc8980c142509e23866836cbade7edf5002e444",
            "filename": "test/parallel/test-cli-bad-options.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-cli-bad-options.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-cli-bad-options.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-cli-bad-options.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -6,7 +6,7 @@ require('../common');\n const assert = require('assert');\n const spawn = require('child_process').spawnSync;\n \n-if (process.config.variables.v8_enable_inspector === 1) {\n+if (process.features.inspector) {\n   requiresArgument('--inspect-port');\n   requiresArgument('--inspect-port=');\n   requiresArgument('--debug-port');"
        },
        {
            "sha": "e115124b0487fe6a22d6f3b35541d995de23cb59",
            "filename": "test/parallel/test-cli-node-print-help.js",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-cli-node-print-help.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-cli-node-print-help.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-cli-node-print-help.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -22,10 +22,9 @@ function startPrintHelpTest() {\n }\n \n function validateNodePrintHelp() {\n-  const config = process.config;\n   const HAVE_OPENSSL = common.hasCrypto;\n   const NODE_HAVE_I18N_SUPPORT = common.hasIntl;\n-  const HAVE_INSPECTOR = config.variables.v8_enable_inspector === 1;\n+  const HAVE_INSPECTOR = process.features.inspector;\n \n   const cliHelpOptions = [\n     { compileConstant: HAVE_OPENSSL,"
        },
        {
            "sha": "12de65598e54e1d33662a20787c9424bb7318aa4",
            "filename": "test/parallel/test-module-cjs-helpers.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-module-cjs-helpers.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-module-cjs-helpers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-module-cjs-helpers.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -5,7 +5,5 @@ require('../common');\n const assert = require('assert');\n const { builtinLibs } = require('internal/modules/cjs/helpers');\n \n-const hasInspector = process.config.variables.v8_enable_inspector === 1;\n-\n-const expectedLibs = hasInspector ? 34 : 33;\n+const expectedLibs = process.features.inspector ? 34 : 33;\n assert.strictEqual(builtinLibs.length, expectedLibs);"
        },
        {
            "sha": "ad0e05f69bb9099a4633bfe4ed656b47760be0a1",
            "filename": "test/parallel/test-process-env-allowed-flags.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-process-env-allowed-flags.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-process-env-allowed-flags.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-env-allowed-flags.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -16,7 +16,7 @@ require('../common');\n     'r',\n     '--stack-trace-limit=100',\n     '--stack-trace-limit=-=xX_nodejs_Xx=-',\n-  ].concat(process.config.variables.v8_enable_inspector ? [\n+  ].concat(process.features.inspector ? [\n     '--inspect-brk',\n     'inspect-brk',\n     '--inspect_brk',"
        },
        {
            "sha": "a24d366ba8e30a9f55bd4a72ef58a2fafc672581",
            "filename": "test/parallel/test-process-features.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-process-features.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-process-features.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-features.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -6,6 +6,7 @@ const assert = require('assert');\n const keys = new Set(Object.keys(process.features));\n \n assert.deepStrictEqual(keys, new Set([\n+  'inspector',\n   'debug',\n   'uv',\n   'ipv6',"
        },
        {
            "sha": "4c68ec2c8f383be9d006125dbfe5f8c51c2dcf07",
            "filename": "test/parallel/test-repl-tab-complete.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-repl-tab-complete.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-repl-tab-complete.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-tab-complete.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -29,7 +29,7 @@ const {\n } = require('../common/hijackstdio');\n const assert = require('assert');\n const fixtures = require('../common/fixtures');\n-const hasInspector = process.config.variables.v8_enable_inspector === 1;\n+const hasInspector = process.features.inspector;\n \n if (!common.isMainThread)\n   common.skip('process.chdir is not available in Workers');"
        },
        {
            "sha": "3db8b81d5504b4efcb497c18cdca798f4843451d",
            "filename": "test/parallel/test-v8-coverage.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-v8-coverage.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fparallel%2Ftest-v8-coverage.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-v8-coverage.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-if (!process.config.variables.v8_enable_inspector) return;\n+if (!process.features.inspector) return;\n \n const common = require('../common');\n const assert = require('assert');"
        },
        {
            "sha": "a5e2bf64d82fc2f8e27613013dec2ec03021025a",
            "filename": "test/sequential/test-async-wrap-getasyncid.js",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-async-wrap-getasyncid.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -289,8 +289,7 @@ if (common.hasCrypto) { // eslint-disable-line node-core/crypto-check\n   testInitialized(req, 'SendWrap');\n }\n \n-if (process.config.variables.v8_enable_inspector !== 0 &&\n-    common.isMainThread) {\n+if (process.features.inspector && common.isMainThread) {\n   const binding = internalBinding('inspector');\n   const handle = new binding.Connection(() => {});\n   testInitialized(handle, 'Connection');"
        },
        {
            "sha": "56a50408bb8ea11d18926029b060903c0395cb4c",
            "filename": "test/sequential/test-inspector-has-inspector-false.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fsequential%2Ftest-inspector-has-inspector-false.js",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/test%2Fsequential%2Ftest-inspector-has-inspector-false.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-inspector-has-inspector-false.js?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -3,10 +3,10 @@\n \n const common = require('../common');\n \n-// This is to ensure that the sendInspectorCommand function calls the error\n-// function if its called with the v8_enable_inspector is disabled\n+if (process.features.inspector) {\n+  common.skip('V8 inspector is enabled');\n+}\n \n-process.config.variables.v8_enable_inspector = 0;\n const inspector = require('internal/util/inspector');\n \n inspector.sendInspectorCommand("
        },
        {
            "sha": "b9750b2035a786e88423c492a7dbcb34be1e4c94",
            "filename": "tools/test.py",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/c2359bdad62b83d40976d91e91097684c23a7ae3/tools%2Ftest.py",
            "raw_url": "https://github.com/nodejs/node/raw/c2359bdad62b83d40976d91e91097684c23a7ae3/tools%2Ftest.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Ftest.py?ref=c2359bdad62b83d40976d91e91097684c23a7ae3",
            "patch": "@@ -1653,8 +1653,8 @@ def Main():\n \n   # We want to skip the inspector tests if node was built without the inspector.\n   has_inspector = Execute([vm,\n-      '-p', 'process.config.variables.v8_enable_inspector'], context)\n-  if has_inspector.stdout.rstrip() == '0':\n+      '-p', 'process.features.inspector'], context)\n+  if has_inspector.stdout.rstrip() == 'false':\n     context.v8_enable_inspector = False\n \n   has_crypto = Execute([vm,"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 25,
        "deletions": 28
    }
}