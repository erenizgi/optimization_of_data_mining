{
    "author": "kfarnung",
    "message": "n-api: restrict exports by version\n\n* Move `napi_get_uv_event_loop` into the `NAPI_VERSION >= 2` section\n* Move `napi_open_callback_scope`, `napi_close_callback_scope`,\n  `napi_fatal_exception`, `napi_add_env_cleanup_hook`, and\n  `napi_remove_env_cleanup_hook` into the `NAPI_VERSION >= 3` section\n* Added a missing `added` property to `napi_get_uv_event_loop` in the\n  docs\n* Added a `napiVersion` property to the docs and updated the parser and\n  generator to use it.\n* Added usage documentation\n\nPR-URL: https://github.com/nodejs/node/pull/19962\nReviewed-By: Gabriel Schulhof <gabriel.schulhof@intel.com>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>",
    "sha": "8476053c132fd9613aab547aba165190f8064254",
    "files": [
        {
            "sha": "982b15f496893b30eba86cfcf38ce8b3c4eea701",
            "filename": "doc/api/n-api.md",
            "status": "modified",
            "additions": 161,
            "deletions": 1,
            "changes": 162,
            "blob_url": "https://github.com/nodejs/node/blob/8476053c132fd9613aab547aba165190f8064254/doc%2Fapi%2Fn-api.md",
            "raw_url": "https://github.com/nodejs/node/raw/8476053c132fd9613aab547aba165190f8064254/doc%2Fapi%2Fn-api.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fn-api.md?ref=8476053c132fd9613aab547aba165190f8064254",
            "patch": "@@ -42,6 +42,8 @@ for the N-API C based functions exported by Node.js. These wrappers are not\n part of N-API, nor will they be maintained as part of Node.js. One such\n example is: [node-addon-api](https://github.com/nodejs/node-addon-api).\n \n+## Usage\n+\n In order to use the N-API functions, include the file\n [`node_api.h`](https://github.com/nodejs/node/blob/master/src/node_api.h)\n which is located in the src directory in the node development tree:\n@@ -50,6 +52,41 @@ which is located in the src directory in the node development tree:\n #include <node_api.h>\n ```\n \n+This will opt into the default `NAPI_VERSION` for the given release of Node.js.\n+In order to ensure compatibility with specific versions of N-API, the version\n+can be specified explicitly when including the header:\n+\n+```C\n+#define NAPI_VERSION 3\n+#include <node_api.h>\n+```\n+\n+This restricts the N-API surface to just the functionality that was available in\n+the specified (and earlier) versions.\n+\n+Some of the N-API surface is considered experimental and requires explicit\n+opt-in to access those APIs:\n+\n+```C\n+#define NAPI_EXPERIMENTAL\n+#include <node_api.h>\n+```\n+\n+In this case the entire API surface, including any experimental APIs, will be\n+available to the module code.\n+\n+## N-API Version Matrix\n+\n+|       | 1       | 2        | 3        |\n+|:-----:|:-------:|:--------:|:--------:|\n+| v4.x  |         |          |          |\n+| v6.x  |         |          | v6.14.2* |\n+| v8.x  | v8.0.0* | v8.10.0* |          |\n+| v9.x  | v9.0.0* | v9.3.0*  | v9.11.0* |\n+| v10.x |         |          | v10.0.0  |\n+\n+\\* Indicates that the N-API version was released as experimental\n+\n ## Basic N-API Data Types\n \n N-API exposes the following fundamental datatypes as abstractions that are\n@@ -326,6 +363,7 @@ logging purposes.\n #### napi_get_last_error_info\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status\n@@ -424,6 +462,7 @@ TypeError [ERR_ERROR_1]\n #### napi_throw\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_throw(napi_env env, napi_value error);\n@@ -438,6 +477,7 @@ This API throws the JavaScript value provided.\n #### napi_throw_error\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_throw_error(napi_env env,\n@@ -456,6 +496,7 @@ This API throws a JavaScript `Error` with the text provided.\n #### napi_throw_type_error\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_throw_type_error(napi_env env,\n@@ -474,6 +515,7 @@ This API throws a JavaScript `TypeError` with the text provided.\n #### napi_throw_range_error\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_throw_range_error(napi_env env,\n@@ -492,6 +534,7 @@ This API throws a JavaScript `RangeError` with the text provided.\n #### napi_is_error\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_is_error(napi_env env,\n@@ -510,6 +553,7 @@ This API queries a `napi_value` to check if it represents an error object.\n #### napi_create_error\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_create_error(napi_env env,\n@@ -531,6 +575,7 @@ This API returns a JavaScript `Error` with the text provided.\n #### napi_create_type_error\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_create_type_error(napi_env env,\n@@ -552,6 +597,7 @@ This API returns a JavaScript `TypeError` with the text provided.\n #### napi_create_range_error\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_create_range_error(napi_env env,\n@@ -573,6 +619,7 @@ This API returns a JavaScript `RangeError` with the text provided.\n #### napi_get_and_clear_last_exception\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_and_clear_last_exception(napi_env env,\n@@ -591,6 +638,7 @@ This API can be called even if there is a pending JavaScript exception.\n #### napi_is_exception_pending\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_is_exception_pending(napi_env env, bool* result);\n@@ -608,7 +656,9 @@ This API can be called even if there is a pending JavaScript exception.\n #### napi_fatal_exception\n <!-- YAML\n added: v9.10.0\n+napiVersion: 3\n -->\n+\n ```C\n napi_status napi_fatal_exception(napi_env env, napi_value err);\n ```\n@@ -627,6 +677,7 @@ thrown to immediately terminate the process.\n #### napi_fatal_error\n <!-- YAML\n added: v8.2.0\n+napiVersion: 1\n -->\n ```C\n NAPI_NO_RETURN void napi_fatal_error(const char* location,\n@@ -740,6 +791,7 @@ can only be called once.\n #### napi_open_handle_scope\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_open_handle_scope(napi_env env,\n@@ -755,6 +807,7 @@ This API open a new scope.\n #### napi_close_handle_scope\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_close_handle_scope(napi_env env,\n@@ -773,6 +826,7 @@ This API can be called even if there is a pending JavaScript exception.\n #### napi_open_escapable_handle_scope\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status\n@@ -790,6 +844,7 @@ to the outer scope.\n #### napi_close_escapable_handle_scope\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status\n@@ -809,6 +864,7 @@ This API can be called even if there is a pending JavaScript exception.\n #### napi_escape_handle\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_escape_handle(napi_env env,\n@@ -874,6 +930,7 @@ individual count.\n #### napi_create_reference\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_create_reference(napi_env env,\n@@ -896,6 +953,7 @@ to the `Object` passed in.\n #### napi_delete_reference\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_delete_reference(napi_env env, napi_ref ref);\n@@ -913,6 +971,7 @@ This API can be called even if there is a pending JavaScript exception.\n #### napi_reference_ref\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_reference_ref(napi_env env,\n@@ -931,6 +990,7 @@ passed in and returns the resulting reference count.\n #### napi_reference_unref\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_reference_unref(napi_env env,\n@@ -949,6 +1009,7 @@ passed in and returns the resulting reference count.\n #### napi_get_reference_value\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_get_reference_value(napi_env env,\n@@ -982,7 +1043,9 @@ should be freed up.\n #### napi_add_env_cleanup_hook\n <!-- YAML\n added: v10.2.0\n+napiVersion: 3\n -->\n+\n ```C\n NODE_EXTERN napi_status napi_add_env_cleanup_hook(napi_env env,\n                                                   void (*fun)(void* arg),\n@@ -1007,7 +1070,9 @@ is being torn down anyway.\n #### napi_remove_env_cleanup_hook\n <!-- YAML\n added: v10.2.0\n+napiVersion: 3\n -->\n+\n ```C\n NAPI_EXTERN napi_status napi_remove_env_cleanup_hook(napi_env env,\n                                                      void (*fun)(void* arg),\n@@ -1196,6 +1261,7 @@ Elements of this enum correspond to\n #### napi_create_array\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_array(napi_env env, napi_value* result)\n@@ -1213,6 +1279,7 @@ JavaScript arrays are described in\n #### napi_create_array_with_length\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_array_with_length(napi_env env,\n@@ -1241,6 +1308,7 @@ JavaScript arrays are described in\n #### napi_create_arraybuffer\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_arraybuffer(napi_env env,\n@@ -1272,6 +1340,7 @@ JavaScript `ArrayBuffer` objects are described in\n #### napi_create_buffer\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_buffer(napi_env env,\n@@ -1293,6 +1362,7 @@ fully-supported data structure, in most cases using a `TypedArray` will suffice.\n #### napi_create_buffer_copy\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_buffer_copy(napi_env env,\n@@ -1318,6 +1388,7 @@ structure, in most cases using a `TypedArray` will suffice.\n #### napi_create_external\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_external(napi_env env,\n@@ -1350,6 +1421,7 @@ an external value yields `napi_external`.\n #### napi_create_external_arraybuffer\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status\n@@ -1384,6 +1456,7 @@ JavaScript `ArrayBuffer`s are described in\n #### napi_create_external_buffer\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_external_buffer(napi_env env,\n@@ -1415,6 +1488,7 @@ For Node.js >=4 `Buffers` are `Uint8Array`s.\n #### napi_create_function\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_function(napi_env env,\n@@ -1448,6 +1522,7 @@ of the ECMAScript Language Specification.\n #### napi_create_object\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_object(napi_env env, napi_value* result)\n@@ -1468,6 +1543,7 @@ ECMAScript Language Specification.\n #### napi_create_symbol\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_symbol(napi_env env,\n@@ -1491,6 +1567,7 @@ of the ECMAScript Language Specification.\n #### napi_create_typedarray\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_typedarray(napi_env env,\n@@ -1526,6 +1603,7 @@ JavaScript `TypedArray` objects are described in\n #### napi_create_dataview\n <!-- YAML\n added: v8.3.0\n+napiVersion: 1\n -->\n \n ```C\n@@ -1560,6 +1638,7 @@ JavaScript `DataView` objects are described in\n #### napi_create_int32\n <!-- YAML\n added: v8.4.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_int32(napi_env env, int32_t value, napi_value* result)\n@@ -1580,6 +1659,7 @@ The JavaScript `Number` type is described in\n #### napi_create_uint32\n <!-- YAML\n added: v8.4.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_uint32(napi_env env, uint32_t value, napi_value* result)\n@@ -1600,6 +1680,7 @@ The JavaScript `Number` type is described in\n #### napi_create_int64\n <!-- YAML\n added: v8.4.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_int64(napi_env env, int64_t value, napi_value* result)\n@@ -1626,6 +1707,7 @@ outside the range of\n #### napi_create_double\n <!-- YAML\n added: v8.4.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_double(napi_env env, double value, napi_value* result)\n@@ -1646,6 +1728,7 @@ The JavaScript `Number` type is described in\n #### napi_create_string_latin1\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_string_latin1(napi_env env,\n@@ -1671,6 +1754,7 @@ The JavaScript `String` type is described in\n #### napi_create_string_utf16\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_string_utf16(napi_env env,\n@@ -1696,6 +1780,7 @@ The JavaScript `String` type is described in\n #### napi_create_string_utf8\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_string_utf8(napi_env env,\n@@ -1722,6 +1807,7 @@ The JavaScript `String` type is described in\n #### napi_get_array_length\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_array_length(napi_env env,\n@@ -1745,6 +1831,7 @@ of the ECMAScript Language Specification.\n #### napi_get_arraybuffer_info\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_arraybuffer_info(napi_env env,\n@@ -1774,6 +1861,7 @@ trigger a GC.\n #### napi_get_buffer_info\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_buffer_info(napi_env env,\n@@ -1798,6 +1886,7 @@ lifetime is not guaranteed if it's managed by the VM.\n #### napi_get_prototype\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_prototype(napi_env env,\n@@ -1816,6 +1905,7 @@ Returns `napi_ok` if the API succeeded.\n #### napi_get_typedarray_info\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_typedarray_info(napi_env env,\n@@ -1852,6 +1942,7 @@ is managed by the VM.\n #### napi_get_dataview_info\n <!-- YAML\n added: v8.3.0\n+napiVersion: 1\n -->\n \n ```C\n@@ -1879,6 +1970,7 @@ This API returns various properties of a `DataView`.\n #### napi_get_value_bool\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_value_bool(napi_env env, napi_value value, bool* result)\n@@ -1898,6 +1990,7 @@ This API returns the C boolean primitive equivalent of the given JavaScript\n #### napi_get_value_double\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_value_double(napi_env env,\n@@ -1919,6 +2012,7 @@ This API returns the C double primitive equivalent of the given JavaScript\n #### napi_get_value_external\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_value_external(napi_env env,\n@@ -1939,6 +2033,7 @@ This API retrieves the external data pointer that was previously passed to\n #### napi_get_value_int32\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_value_int32(napi_env env,\n@@ -1967,6 +2062,7 @@ result to zero.\n #### napi_get_value_int64\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_value_int64(napi_env env,\n@@ -1997,6 +2093,7 @@ result to zero.\n #### napi_get_value_string_latin1\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_value_string_latin1(napi_env env,\n@@ -2024,6 +2121,7 @@ in.\n #### napi_get_value_string_utf8\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_value_string_utf8(napi_env env,\n@@ -2050,6 +2148,7 @@ This API returns the UTF8-encoded string corresponding the value passed in.\n #### napi_get_value_string_utf16\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_value_string_utf16(napi_env env,\n@@ -2076,6 +2175,7 @@ This API returns the UTF16-encoded string corresponding the value passed in.\n #### napi_get_value_uint32\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_value_uint32(napi_env env,\n@@ -2098,6 +2198,7 @@ This API returns the C primitive equivalent of the given `napi_value` as a\n #### napi_get_boolean\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_boolean(napi_env env, bool value, napi_value* result)\n@@ -2116,6 +2217,7 @@ represent the given boolean value.\n #### napi_get_global\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_global(napi_env env, napi_value* result)\n@@ -2131,6 +2233,7 @@ This API returns the `global` object.\n #### napi_get_null\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_null(napi_env env, napi_value* result)\n@@ -2146,6 +2249,7 @@ This API returns the `null` object.\n #### napi_get_undefined\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_undefined(napi_env env, napi_value* result)\n@@ -2174,6 +2278,7 @@ These APIs support doing one of the following:\n ### napi_coerce_to_bool\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_coerce_to_bool(napi_env env,\n@@ -2195,6 +2300,7 @@ This API can be re-entrant if getters are defined on the passed-in `Object`.\n ### napi_coerce_to_number\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_coerce_to_number(napi_env env,\n@@ -2216,6 +2322,7 @@ This API can be re-entrant if getters are defined on the passed-in `Object`.\n ### napi_coerce_to_object\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_coerce_to_object(napi_env env,\n@@ -2237,6 +2344,7 @@ This API can be re-entrant if getters are defined on the passed-in `Object`.\n ### napi_coerce_to_string\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_coerce_to_string(napi_env env,\n@@ -2258,6 +2366,7 @@ This API can be re-entrant if getters are defined on the passed-in `Object`.\n ### napi_typeof\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_typeof(napi_env env, napi_value value, napi_valuetype* result)\n@@ -2279,6 +2388,7 @@ If `value` has a type that is invalid, an error is returned.\n ### napi_instanceof\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_instanceof(napi_env env,\n@@ -2304,6 +2414,7 @@ of the ECMAScript Language Specification.\n ### napi_is_array\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_is_array(napi_env env, napi_value value, bool* result)\n@@ -2322,6 +2433,7 @@ of the ECMAScript Language Specification.\n ### napi_is_arraybuffer\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_is_arraybuffer(napi_env env, napi_value value, bool* result)\n@@ -2338,6 +2450,7 @@ This API checks if the `Object` passed in is an array buffer.\n ### napi_is_buffer\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_is_buffer(napi_env env, napi_value value, bool* result)\n@@ -2355,6 +2468,7 @@ This API checks if the `Object` passed in is a buffer.\n ### napi_is_error\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_is_error(napi_env env, napi_value value, bool* result)\n@@ -2371,6 +2485,7 @@ This API checks if the `Object` passed in is an `Error`.\n ### napi_is_typedarray\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_is_typedarray(napi_env env, napi_value value, bool* result)\n@@ -2387,6 +2502,7 @@ This API checks if the `Object` passed in is a typed array.\n ### napi_is_dataview\n <!-- YAML\n added: v8.3.0\n+napiVersion: 1\n -->\n \n ```C\n@@ -2404,6 +2520,7 @@ This API checks if the `Object` passed in is a `DataView`.\n ### napi_strict_equals\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_strict_equals(napi_env env,\n@@ -2636,6 +2753,7 @@ this function is invoked.\n #### napi_get_property_names\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_property_names(napi_env env,\n@@ -2659,6 +2777,7 @@ included.\n #### napi_set_property\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_set_property(napi_env env,\n@@ -2679,6 +2798,7 @@ This API set a property on the `Object` passed in.\n #### napi_get_property\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_property(napi_env env,\n@@ -2699,6 +2819,7 @@ This API gets the requested property from the `Object` passed in.\n #### napi_has_property\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_has_property(napi_env env,\n@@ -2719,6 +2840,7 @@ This API checks if the `Object` passed in has the named property.\n #### napi_delete_property\n <!-- YAML\n added: v8.2.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_delete_property(napi_env env,\n@@ -2740,6 +2862,7 @@ This API attempts to delete the `key` own property from `object`.\n #### napi_has_own_property\n <!-- YAML\n added: v8.2.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_has_own_property(napi_env env,\n@@ -2762,6 +2885,7 @@ any conversion between data types.\n #### napi_set_named_property\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_set_named_property(napi_env env,\n@@ -2783,6 +2907,7 @@ created from the string passed in as `utf8Name`.\n #### napi_get_named_property\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_named_property(napi_env env,\n@@ -2804,6 +2929,7 @@ created from the string passed in as `utf8Name`.\n #### napi_has_named_property\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_has_named_property(napi_env env,\n@@ -2825,6 +2951,7 @@ created from the string passed in as `utf8Name`.\n #### napi_set_element\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_set_element(napi_env env,\n@@ -2845,6 +2972,7 @@ This API sets and element on the `Object` passed in.\n #### napi_get_element\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_element(napi_env env,\n@@ -2865,6 +2993,7 @@ This API gets the element at the requested index.\n #### napi_has_element\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_has_element(napi_env env,\n@@ -2886,6 +3015,7 @@ requested index.\n #### napi_delete_element\n <!-- YAML\n added: v8.2.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_delete_element(napi_env env,\n@@ -2907,6 +3037,7 @@ This API attempts to delete the specified `index` from `object`.\n #### napi_define_properties\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_define_properties(napi_env env,\n@@ -2950,6 +3081,7 @@ function.\n ### napi_call_function\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_call_function(napi_env env,\n@@ -3016,6 +3148,7 @@ if (status != napi_ok) return;\n ### napi_create_function\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_function(napi_env env,\n@@ -3083,6 +3216,7 @@ responsible for creating the `.node` file.\n ### napi_get_cb_info\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_cb_info(napi_env env,\n@@ -3113,6 +3247,7 @@ call like the arguments and the `this` pointer from a given callback info.\n ### napi_get_new_target\n <!-- YAML\n added: v8.6.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_new_target(napi_env env,\n@@ -3132,6 +3267,7 @@ callback is not a constructor call, the result is `NULL`.\n ### napi_new_instance\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_new_instance(napi_env env,\n@@ -3227,6 +3363,7 @@ The reference must be freed once it is no longer needed.\n ### napi_define_class\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_define_class(napi_env env,\n@@ -3283,6 +3420,7 @@ reference count is kept >= 1.\n ### napi_wrap\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_wrap(napi_env env,\n@@ -3343,6 +3481,7 @@ first.\n ### napi_unwrap\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_unwrap(napi_env env,\n@@ -3368,6 +3507,7 @@ then by calling `napi_unwrap()` on the wrapper object.\n ### napi_remove_wrap\n <!-- YAML\n added: v8.5.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_remove_wrap(napi_env env,\n@@ -3444,6 +3584,7 @@ callback invocation, even when it was cancelled.\n ### napi_create_async_work\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n changes:\n   - version: v8.6.0\n     pr-url: https://github.com/nodejs/node/pull/14697\n@@ -3491,6 +3632,7 @@ the [`async_hooks` documentation][async_hooks `type`] for more information.\n ### napi_delete_async_work\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_delete_async_work(napi_env env,\n@@ -3509,6 +3651,7 @@ This API can be called even if there is a pending JavaScript exception.\n ### napi_queue_async_work\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_queue_async_work(napi_env env,\n@@ -3526,6 +3669,7 @@ for execution.\n ### napi_cancel_async_work\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_cancel_async_work(napi_env env,\n@@ -3555,6 +3699,7 @@ the runtime.\n ### napi_async_init\n <!-- YAML\n added: v8.6.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_async_init(napi_env env,\n@@ -3576,6 +3721,7 @@ Returns `napi_ok` if the API succeeded.\n ### napi_async_destroy\n <!-- YAML\n added: v8.6.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_async_destroy(napi_env env,\n@@ -3592,6 +3738,7 @@ This API can be called even if there is a pending JavaScript exception.\n ### napi_make_callback\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n changes:\n   - version: v8.6.0\n     description: Added `async_context` parameter.\n@@ -3638,6 +3785,7 @@ may be required when implementing custom async behavior that does not use\n ### napi_open_callback_scope\n <!-- YAML\n added: v9.6.0\n+napiVersion: 3\n -->\n ```C\n NAPI_EXTERN napi_status napi_open_callback_scope(napi_env env,\n@@ -3663,6 +3811,7 @@ the required scope.\n ### napi_close_callback_scope\n <!-- YAML\n added: v9.6.0\n+napiVersion: 3\n -->\n ```C\n NAPI_EXTERN napi_status napi_close_callback_scope(napi_env env,\n@@ -3678,6 +3827,7 @@ This API can be called even if there is a pending JavaScript exception.\n ### napi_get_node_version\n <!-- YAML\n added: v8.4.0\n+napiVersion: 1\n -->\n \n ```C\n@@ -3706,6 +3856,7 @@ The returned buffer is statically allocated and does not need to be freed.\n ### napi_get_version\n <!-- YAML\n added: v8.0.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_get_version(napi_env env,\n@@ -3736,6 +3887,7 @@ support it:\n ### napi_adjust_external_memory\n <!-- YAML\n added: v8.5.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_adjust_external_memory(napi_env env,\n@@ -3815,6 +3967,7 @@ deferred = NULL;\n ### napi_create_promise\n <!-- YAML\n added: v8.5.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_create_promise(napi_env env,\n@@ -3835,6 +3988,7 @@ This API creates a deferred object and a JavaScript promise.\n ### napi_resolve_deferred\n <!-- YAML\n added: v8.5.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_resolve_deferred(napi_env env,\n@@ -3858,6 +4012,7 @@ The deferred object is freed upon successful completion.\n ### napi_reject_deferred\n <!-- YAML\n added: v8.5.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_reject_deferred(napi_env env,\n@@ -3881,6 +4036,7 @@ The deferred object is freed upon successful completion.\n ### napi_is_promise\n <!-- YAML\n added: v8.5.0\n+napiVersion: 1\n -->\n ```C\n napi_status napi_is_promise(napi_env env,\n@@ -3901,6 +4057,7 @@ underlying JavaScript engine.\n ### napi_run_script\n <!-- YAML\n added: v8.5.0\n+napiVersion: 1\n -->\n ```C\n NAPI_EXTERN napi_status napi_run_script(napi_env env,\n@@ -3919,7 +4076,10 @@ a specific `napi_env`.\n \n ### napi_get_uv_event_loop\n <!-- YAML\n-added: v9.3.0\n+added:\n+  - v8.10.0\n+  - v9.3.0\n+napiVersion: 2\n -->\n ```C\n NAPI_EXTERN napi_status napi_get_uv_event_loop(napi_env env,"
        },
        {
            "sha": "b22592db15f110e0c0107b205741214a53f9fbdd",
            "filename": "src/node_api.h",
            "status": "modified",
            "additions": 38,
            "deletions": 17,
            "changes": 55,
            "blob_url": "https://github.com/nodejs/node/blob/8476053c132fd9613aab547aba165190f8064254/src%2Fnode_api.h",
            "raw_url": "https://github.com/nodejs/node/raw/8476053c132fd9613aab547aba165190f8064254/src%2Fnode_api.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_api.h?ref=8476053c132fd9613aab547aba165190f8064254",
            "patch": "@@ -7,6 +7,16 @@\n \n struct uv_loop_s;  // Forward declaration.\n \n+#ifndef NAPI_VERSION\n+#ifdef NAPI_EXPERIMENTAL\n+// Use INT_MAX, this should only be consumed by the pre-processor anyway.\n+#define NAPI_VERSION 2147483647\n+#else\n+// The baseline version for N-API\n+#define NAPI_VERSION 3\n+#endif\n+#endif\n+\n #ifdef _WIN32\n   #ifdef BUILDING_NODE_EXTENSION\n     #ifdef EXTERNAL_NAPI\n@@ -118,19 +128,10 @@ EXTERN_C_START\n \n NAPI_EXTERN void napi_module_register(napi_module* mod);\n \n-NAPI_EXTERN napi_status napi_add_env_cleanup_hook(napi_env env,\n-                                                  void (*fun)(void* arg),\n-                                                  void* arg);\n-NAPI_EXTERN napi_status napi_remove_env_cleanup_hook(napi_env env,\n-                                                     void (*fun)(void* arg),\n-                                                     void* arg);\n-\n NAPI_EXTERN napi_status\n napi_get_last_error_info(napi_env env,\n                          const napi_extended_error_info** result);\n \n-NAPI_EXTERN napi_status napi_fatal_exception(napi_env env, napi_value err);\n-\n NAPI_EXTERN NAPI_NO_RETURN void napi_fatal_error(const char* location,\n                                                  size_t location_len,\n                                                  const char* message,\n@@ -443,14 +444,6 @@ NAPI_EXTERN napi_status napi_escape_handle(napi_env env,\n                                            napi_value escapee,\n                                            napi_value* result);\n \n-NAPI_EXTERN napi_status napi_open_callback_scope(napi_env env,\n-                                                 napi_value resource_object,\n-                                                 napi_async_context context,\n-                                                 napi_callback_scope* result);\n-\n-NAPI_EXTERN napi_status napi_close_callback_scope(napi_env env,\n-                                                  napi_callback_scope scope);\n-\n // Methods to support error handling\n NAPI_EXTERN napi_status napi_throw(napi_env env, napi_value error);\n NAPI_EXTERN napi_status napi_throw_error(napi_env env,\n@@ -610,11 +603,38 @@ NAPI_EXTERN napi_status napi_run_script(napi_env env,\n                                         napi_value script,\n                                         napi_value* result);\n \n+#if NAPI_VERSION >= 2\n+\n // Return the current libuv event loop for a given environment\n NAPI_EXTERN napi_status napi_get_uv_event_loop(napi_env env,\n                                                struct uv_loop_s** loop);\n \n+#endif  // NAPI_VERSION >= 2\n+\n+#if NAPI_VERSION >= 3\n+\n+NAPI_EXTERN napi_status napi_open_callback_scope(napi_env env,\n+                                                 napi_value resource_object,\n+                                                 napi_async_context context,\n+                                                 napi_callback_scope* result);\n+\n+NAPI_EXTERN napi_status napi_close_callback_scope(napi_env env,\n+                                                  napi_callback_scope scope);\n+\n+NAPI_EXTERN napi_status napi_fatal_exception(napi_env env, napi_value err);\n+\n+NAPI_EXTERN napi_status napi_add_env_cleanup_hook(napi_env env,\n+                                                  void (*fun)(void* arg),\n+                                                  void* arg);\n+\n+NAPI_EXTERN napi_status napi_remove_env_cleanup_hook(napi_env env,\n+                                                     void (*fun)(void* arg),\n+                                                     void* arg);\n+\n+#endif  // NAPI_VERSION >= 3\n+\n #ifdef NAPI_EXPERIMENTAL\n+\n // Calling into JS from other threads\n NAPI_EXTERN napi_status\n napi_create_threadsafe_function(napi_env env,\n@@ -652,6 +672,7 @@ NAPI_EXTERN napi_status\n napi_ref_threadsafe_function(napi_env env, napi_threadsafe_function func);\n \n #endif  // NAPI_EXPERIMENTAL\n+\n EXTERN_C_END\n \n #endif  // SRC_NODE_API_H_"
        },
        {
            "sha": "4dfadd353d9ec8a941a6091f589564d03c58c8a0",
            "filename": "tools/doc/common.js",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/8476053c132fd9613aab547aba165190f8064254/tools%2Fdoc%2Fcommon.js",
            "raw_url": "https://github.com/nodejs/node/raw/8476053c132fd9613aab547aba165190f8064254/tools%2Fdoc%2Fcommon.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fcommon.js?ref=8476053c132fd9613aab547aba165190f8064254",
            "patch": "@@ -25,6 +25,10 @@ function extractAndParseYAML(text) {\n     meta.added = arrify(meta.added);\n   }\n \n+  if (meta.napiVersion) {\n+    meta.napiVersion = arrify(meta.napiVersion);\n+  }\n+\n   if (meta.deprecated) {\n     // Treat deprecated like added for consistency.\n     meta.deprecated = arrify(meta.deprecated);"
        },
        {
            "sha": "871a55baf4676c311d3bfa89227917c8a079b4ff",
            "filename": "tools/doc/html.js",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/8476053c132fd9613aab547aba165190f8064254/tools%2Fdoc%2Fhtml.js",
            "raw_url": "https://github.com/nodejs/node/raw/8476053c132fd9613aab547aba165190f8064254/tools%2Fdoc%2Fhtml.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fhtml.js?ref=8476053c132fd9613aab547aba165190f8064254",
            "patch": "@@ -261,6 +261,10 @@ function parseYAML(text) {\n     html += `${added.description}${deprecated.description}\\n`;\n   }\n \n+  if (meta.napiVersion) {\n+    html += `<span>N-API version: ${meta.napiVersion.join(', ')}</span>\\n`;\n+  }\n+\n   html += '</div>';\n   return html;\n }"
        }
    ],
    "stats": {
        "total": 225,
        "additions": 207,
        "deletions": 18
    }
}