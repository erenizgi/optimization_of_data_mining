{
    "author": "leeight",
    "message": "src: elevate v8 namespaces of repeated references\n\nPR-URL: https://github.com/nodejs/node/pull/24460\n\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "69ccbd28dfa39b8d98d028f2f4b1da505460cadb",
    "files": [
        {
            "sha": "a39c51c26d17d71e520daf0772b6abf7464864c5",
            "filename": "src/env.cc",
            "status": "modified",
            "additions": 34,
            "deletions": 26,
            "changes": 60,
            "blob_url": "https://github.com/nodejs/node/blob/69ccbd28dfa39b8d98d028f2f4b1da505460cadb/src%2Fenv.cc",
            "raw_url": "https://github.com/nodejs/node/raw/69ccbd28dfa39b8d98d028f2f4b1da505460cadb/src%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.cc?ref=69ccbd28dfa39b8d98d028f2f4b1da505460cadb",
            "patch": "@@ -15,20 +15,28 @@\n namespace node {\n \n using v8::Context;\n+using v8::EmbedderGraph;\n+using v8::External;\n using v8::Function;\n using v8::FunctionTemplate;\n using v8::HandleScope;\n using v8::Integer;\n using v8::Isolate;\n using v8::Local;\n using v8::Message;\n+using v8::NewStringType;\n using v8::Number;\n+using v8::Object;\n using v8::Private;\n+using v8::Promise;\n+using v8::PromiseHookType;\n using v8::StackFrame;\n using v8::StackTrace;\n using v8::String;\n using v8::Symbol;\n+using v8::TracingController;\n using v8::TryCatch;\n+using v8::Undefined;\n using v8::Value;\n using worker::Worker;\n \n@@ -89,7 +97,7 @@ IsolateData::IsolateData(Isolate* isolate,\n             String::NewFromOneByte(                                         \\\n                 isolate,                                                    \\\n                 reinterpret_cast<const uint8_t*>(StringValue),              \\\n-                v8::NewStringType::kInternalized,                           \\\n+                NewStringType::kInternalized,                               \\\n                 sizeof(StringValue) - 1).ToLocalChecked()));\n   PER_ISOLATE_PRIVATE_SYMBOL_PROPERTIES(V)\n #undef V\n@@ -101,7 +109,7 @@ IsolateData::IsolateData(Isolate* isolate,\n             String::NewFromOneByte(                                         \\\n                 isolate,                                                    \\\n                 reinterpret_cast<const uint8_t*>(StringValue),              \\\n-                v8::NewStringType::kInternalized,                           \\\n+                NewStringType::kInternalized,                               \\\n                 sizeof(StringValue) - 1).ToLocalChecked()));\n   PER_ISOLATE_SYMBOL_PROPERTIES(V)\n #undef V\n@@ -111,7 +119,7 @@ IsolateData::IsolateData(Isolate* isolate,\n         String::NewFromOneByte(                                             \\\n             isolate,                                                        \\\n             reinterpret_cast<const uint8_t*>(StringValue),                  \\\n-            v8::NewStringType::kInternalized,                               \\\n+            NewStringType::kInternalized,                                   \\\n             sizeof(StringValue) - 1).ToLocalChecked());\n   PER_ISOLATE_STRING_PROPERTIES(V)\n #undef V\n@@ -149,7 +157,7 @@ void Environment::TrackingTraceStateObserver::UpdateTraceCategoryState() {\n     return;\n   TryCatch try_catch(isolate);\n   try_catch.SetVerbose(true);\n-  cb->Call(env_->context(), v8::Undefined(isolate),\n+  cb->Call(env_->context(), Undefined(isolate),\n            0, nullptr).ToLocalChecked();\n }\n \n@@ -173,9 +181,9 @@ Environment::Environment(IsolateData* isolate_data,\n       fs_stats_field_bigint_array_(isolate_, kFsStatsBufferLength),\n       context_(context->GetIsolate(), context) {\n   // We'll be creating new objects so make sure we've entered the context.\n-  v8::HandleScope handle_scope(isolate());\n-  v8::Context::Scope context_scope(context);\n-  set_as_external(v8::External::New(isolate(), this));\n+  HandleScope handle_scope(isolate());\n+  Context::Scope context_scope(context);\n+  set_as_external(External::New(isolate(), this));\n \n   // We create new copies of the per-Environment option sets, so that it is\n   // easier to modify them after Environment creation. The defaults are\n@@ -194,7 +202,7 @@ Environment::Environment(IsolateData* isolate_data,\n \n   if (tracing::AgentWriterHandle* writer = GetTracingAgentWriter()) {\n     trace_state_observer_ = std::make_unique<TrackingTraceStateObserver>(this);\n-    v8::TracingController* tracing_controller = writer->GetTracingController();\n+    TracingController* tracing_controller = writer->GetTracingController();\n     if (tracing_controller != nullptr)\n       tracing_controller->AddTraceStateObserver(trace_state_observer_.get());\n   }\n@@ -232,7 +240,7 @@ Environment::~Environment() {\n   // CleanupHandles() should have removed all of them.\n   CHECK(file_handle_read_wrap_freelist_.empty());\n \n-  v8::HandleScope handle_scope(isolate());\n+  HandleScope handle_scope(isolate());\n \n #if HAVE_INSPECTOR\n   // Destroy inspector agent before erasing the context. The inspector\n@@ -246,7 +254,7 @@ Environment::~Environment() {\n   if (trace_state_observer_) {\n     tracing::AgentWriterHandle* writer = GetTracingAgentWriter();\n     CHECK_NOT_NULL(writer);\n-    v8::TracingController* tracing_controller = writer->GetTracingController();\n+    TracingController* tracing_controller = writer->GetTracingController();\n     if (tracing_controller != nullptr)\n       tracing_controller->RemoveTraceStateObserver(trace_state_observer_.get());\n   }\n@@ -410,7 +418,7 @@ void Environment::PrintSyncTrace() const {\n     return;\n \n   HandleScope handle_scope(isolate());\n-  Local<v8::StackTrace> stack =\n+  Local<StackTrace> stack =\n       StackTrace::CurrentStackTrace(isolate(), 10, StackTrace::kDetailed);\n \n   fprintf(stderr, \"(node:%d) WARNING: Detected use of sync API\\n\",\n@@ -545,10 +553,10 @@ bool Environment::RemovePromiseHook(promise_hook_func fn, void* arg) {\n   return true;\n }\n \n-void Environment::EnvPromiseHook(v8::PromiseHookType type,\n-                                 v8::Local<v8::Promise> promise,\n-                                 v8::Local<v8::Value> parent) {\n-  Local<v8::Context> context = promise->CreationContext();\n+void Environment::EnvPromiseHook(PromiseHookType type,\n+                                 Local<Promise> promise,\n+                                 Local<Value> parent) {\n+  Local<Context> context = promise->CreationContext();\n \n   Environment* env = Environment::GetCurrent(context);\n   if (env == nullptr) return;\n@@ -568,7 +576,7 @@ void Environment::RunAndClearNativeImmediates() {\n     std::vector<NativeImmediateCallback> list;\n     native_immediate_callbacks_.swap(list);\n     auto drain_list = [&]() {\n-      v8::TryCatch try_catch(isolate());\n+      TryCatch try_catch(isolate());\n       for (auto it = list.begin(); it != list.end(); ++it) {\n #ifdef DEBUG\n         v8::SealHandleScope seal_handle_scope(isolate());\n@@ -748,7 +756,7 @@ void Environment::set_debug_categories(const std::string& cats, bool enabled) {\n }\n \n void CollectExceptionInfo(Environment* env,\n-                          v8::Local<v8::Object> obj,\n+                          Local<Object> obj,\n                           int errorno,\n                           const char* err_string,\n                           const char* syscall,\n@@ -757,7 +765,7 @@ void CollectExceptionInfo(Environment* env,\n                           const char* dest) {\n   obj->Set(env->context(),\n            env->errno_string(),\n-           v8::Integer::New(env->isolate(), errorno)).FromJust();\n+           Integer::New(env->isolate(), errorno)).FromJust();\n \n   obj->Set(env->context(), env->code_string(),\n            OneByteString(env->isolate(), err_string)).FromJust();\n@@ -767,14 +775,14 @@ void CollectExceptionInfo(Environment* env,\n              OneByteString(env->isolate(), message)).FromJust();\n   }\n \n-  v8::Local<v8::Value> path_buffer;\n+  Local<Value> path_buffer;\n   if (path != nullptr) {\n     path_buffer =\n       Buffer::Copy(env->isolate(), path, strlen(path)).ToLocalChecked();\n     obj->Set(env->context(), env->path_string(), path_buffer).FromJust();\n   }\n \n-  v8::Local<v8::Value> dest_buffer;\n+  Local<Value> dest_buffer;\n   if (dest != nullptr) {\n     dest_buffer =\n       Buffer::Copy(env->isolate(), dest, strlen(dest)).ToLocalChecked();\n@@ -787,15 +795,15 @@ void CollectExceptionInfo(Environment* env,\n   }\n }\n \n-void Environment::CollectExceptionInfo(v8::Local<v8::Value> object,\n+void Environment::CollectExceptionInfo(Local<Value> object,\n                                        int errorno,\n                                        const char* syscall,\n                                        const char* message,\n                                        const char* path) {\n   if (!object->IsObject() || errorno == 0)\n     return;\n \n-  v8::Local<v8::Object> obj = object.As<v8::Object>();\n+  Local<Object> obj = object.As<Object>();\n   const char* err_string = node::errno_string(errorno);\n \n   if (message == nullptr || message[0] == '\\0') {\n@@ -806,7 +814,7 @@ void Environment::CollectExceptionInfo(v8::Local<v8::Value> object,\n                              syscall, message, path, nullptr);\n }\n \n-void Environment::CollectUVExceptionInfo(v8::Local<v8::Value> object,\n+void Environment::CollectUVExceptionInfo(Local<Value> object,\n                                          int errorno,\n                                          const char* syscall,\n                                          const char* message,\n@@ -815,7 +823,7 @@ void Environment::CollectUVExceptionInfo(v8::Local<v8::Value> object,\n   if (!object->IsObject() || errorno == 0)\n     return;\n \n-  v8::Local<v8::Object> obj = object.As<v8::Object>();\n+  Local<Object> obj = object.As<Object>();\n   const char* err_string = uv_err_name(errorno);\n \n   if (message == nullptr || message[0] == '\\0') {\n@@ -854,8 +862,8 @@ void Environment::stop_sub_worker_contexts() {\n   }\n }\n \n-void Environment::BuildEmbedderGraph(v8::Isolate* isolate,\n-                                     v8::EmbedderGraph* graph,\n+void Environment::BuildEmbedderGraph(Isolate* isolate,\n+                                     EmbedderGraph* graph,\n                                      void* data) {\n   MemoryTracker tracker(isolate, graph);\n   static_cast<Environment*>(data)->ForEachBaseObject([&](BaseObject* obj) {"
        },
        {
            "sha": "c0804798e1aad63eea26f5ae463a59c418373ccb",
            "filename": "src/exceptions.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/69ccbd28dfa39b8d98d028f2f4b1da505460cadb/src%2Fexceptions.cc",
            "raw_url": "https://github.com/nodejs/node/raw/69ccbd28dfa39b8d98d028f2f4b1da505460cadb/src%2Fexceptions.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fexceptions.cc?ref=69ccbd28dfa39b8d98d028f2f4b1da505460cadb",
            "patch": "@@ -14,6 +14,7 @@ using v8::Integer;\n using v8::Isolate;\n using v8::Local;\n using v8::Message;\n+using v8::NewStringType;\n using v8::Object;\n using v8::String;\n using v8::Value;\n@@ -39,7 +40,7 @@ Local<Value> ErrnoException(Isolate* isolate,\n   Local<String> path_string;\n   if (path != nullptr) {\n     // FIXME(bnoordhuis) It's questionable to interpret the file path as UTF-8.\n-    path_string = String::NewFromUtf8(isolate, path, v8::NewStringType::kNormal)\n+    path_string = String::NewFromUtf8(isolate, path, NewStringType::kNormal)\n                       .ToLocalChecked();\n   }\n \n@@ -75,15 +76,15 @@ static Local<String> StringFromPath(Isolate* isolate, const char* path) {\n     return String::Concat(\n         isolate,\n         FIXED_ONE_BYTE_STRING(isolate, \"\\\\\\\\\"),\n-        String::NewFromUtf8(isolate, path + 8, v8::NewStringType::kNormal)\n+        String::NewFromUtf8(isolate, path + 8, NewStringType::kNormal)\n             .ToLocalChecked());\n   } else if (strncmp(path, \"\\\\\\\\?\\\\\", 4) == 0) {\n-    return String::NewFromUtf8(isolate, path + 4, v8::NewStringType::kNormal)\n+    return String::NewFromUtf8(isolate, path + 4, NewStringType::kNormal)\n         .ToLocalChecked();\n   }\n #endif\n \n-  return String::NewFromUtf8(isolate, path, v8::NewStringType::kNormal)\n+  return String::NewFromUtf8(isolate, path, NewStringType::kNormal)\n       .ToLocalChecked();\n }\n \n@@ -196,7 +197,7 @@ Local<Value> WinapiErrnoException(Isolate* isolate,\n     Local<String> cons2 = String::Concat(\n         isolate,\n         cons1,\n-        String::NewFromUtf8(isolate, path, v8::NewStringType::kNormal)\n+        String::NewFromUtf8(isolate, path, NewStringType::kNormal)\n             .ToLocalChecked());\n     Local<String> cons3 =\n         String::Concat(isolate, cons2, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n@@ -210,7 +211,7 @@ Local<Value> WinapiErrnoException(Isolate* isolate,\n \n   if (path != nullptr) {\n     obj->Set(env->path_string(),\n-             String::NewFromUtf8(isolate, path, v8::NewStringType::kNormal)\n+             String::NewFromUtf8(isolate, path, NewStringType::kNormal)\n                  .ToLocalChecked());\n   }\n "
        }
    ],
    "stats": {
        "total": 73,
        "additions": 41,
        "deletions": 32
    }
}