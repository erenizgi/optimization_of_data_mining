{
    "author": "demurgos",
    "message": "url: support LF, CR and TAB in pathToFileURL\n\nFixes: https://github.com/nodejs/node/issues/23696\n\nPR-URL: https://github.com/nodejs/node/pull/23720\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Guy Bedford <guybedford@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "ef0c178c35e131c33e6e8c1cf1c69eba52210d91",
    "files": [
        {
            "sha": "ae1adad8c1a2144645859d200d7f113545f7ac4e",
            "filename": "lib/internal/url.js",
            "status": "modified",
            "additions": 20,
            "deletions": 3,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/ef0c178c35e131c33e6e8c1cf1c69eba52210d91/lib%2Finternal%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0c178c35e131c33e6e8c1cf1c69eba52210d91/lib%2Finternal%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Furl.js?ref=ef0c178c35e131c33e6e8c1cf1c69eba52210d91",
            "patch": "@@ -1339,11 +1339,22 @@ function fileURLToPath(path) {\n   return isWindows ? getPathFromURLWin32(path) : getPathFromURLPosix(path);\n }\n \n-// We percent-encode % character when converting from file path to URL,\n-// as this is the only character that won't be percent encoded by\n-// default URL percent encoding when pathname is set.\n+// The following characters are percent-encoded when converting from file path\n+// to URL:\n+// - %: The percent character is the only character not encoded by the\n+//        `pathname` setter.\n+// - \\: Backslash is encoded on non-windows platforms since it's a valid\n+//      character but the `pathname` setters replaces it by a forward slash.\n+// - LF: The newline character is stripped out by the `pathname` setter.\n+//       (See whatwg/url#419)\n+// - CR: The carriage return character is also stripped out by the `pathname`\n+//       setter.\n+// - TAB: The tab character is also stripped out by the `pathname` setter.\n const percentRegEx = /%/g;\n const backslashRegEx = /\\\\/g;\n+const newlineRegEx = /\\n/g;\n+const carriageReturnRegEx = /\\r/g;\n+const tabRegEx = /\\t/g;\n function pathToFileURL(filepath) {\n   let resolved = path.resolve(filepath);\n   // path.resolve strips trailing slashes so we must add them back\n@@ -1358,6 +1369,12 @@ function pathToFileURL(filepath) {\n   // in posix, \"/\" is a valid character in paths\n   if (!isWindows && resolved.includes('\\\\'))\n     resolved = resolved.replace(backslashRegEx, '%5C');\n+  if (resolved.includes('\\n'))\n+    resolved = resolved.replace(newlineRegEx, '%0A');\n+  if (resolved.includes('\\r'))\n+    resolved = resolved.replace(carriageReturnRegEx, '%0D');\n+  if (resolved.includes('\\t'))\n+    resolved = resolved.replace(tabRegEx, '%09');\n   outURL.pathname = resolved;\n   return outURL;\n }"
        },
        {
            "sha": "6cdfa5dcd336ecd8d6d93256a747be4fcb7e0d5e",
            "filename": "test/parallel/test-url-pathtofileurl.js",
            "status": "modified",
            "additions": 100,
            "deletions": 0,
            "changes": 100,
            "blob_url": "https://github.com/nodejs/node/blob/ef0c178c35e131c33e6e8c1cf1c69eba52210d91/test%2Fparallel%2Ftest-url-pathtofileurl.js",
            "raw_url": "https://github.com/nodejs/node/raw/ef0c178c35e131c33e6e8c1cf1c69eba52210d91/test%2Fparallel%2Ftest-url-pathtofileurl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-url-pathtofileurl.js?ref=ef0c178c35e131c33e6e8c1cf1c69eba52210d91",
            "patch": "@@ -22,3 +22,103 @@ const url = require('url');\n   const fileURL = url.pathToFileURL('test/%').href;\n   assert.ok(fileURL.includes('%25'));\n }\n+\n+{\n+  let testCases;\n+  if (isWindows) {\n+    testCases = [\n+      // lowercase ascii alpha\n+      { path: 'C:\\\\foo', expected: 'file:///C:/foo' },\n+      // uppercase ascii alpha\n+      { path: 'C:\\\\FOO', expected: 'file:///C:/FOO' },\n+      // dir\n+      { path: 'C:\\\\dir\\\\foo', expected: 'file:///C:/dir/foo' },\n+      // trailing separator\n+      { path: 'C:\\\\dir\\\\', expected: 'file:///C:/dir/' },\n+      // dot\n+      { path: 'C:\\\\foo.mjs', expected: 'file:///C:/foo.mjs' },\n+      // space\n+      { path: 'C:\\\\foo bar', expected: 'file:///C:/foo%20bar' },\n+      // question mark\n+      { path: 'C:\\\\foo?bar', expected: 'file:///C:/foo%3Fbar' },\n+      // number sign\n+      { path: 'C:\\\\foo#bar', expected: 'file:///C:/foo%23bar' },\n+      // ampersand\n+      { path: 'C:\\\\foo&bar', expected: 'file:///C:/foo&bar' },\n+      // equals\n+      { path: 'C:\\\\foo=bar', expected: 'file:///C:/foo=bar' },\n+      // colon\n+      { path: 'C:\\\\foo:bar', expected: 'file:///C:/foo:bar' },\n+      // semicolon\n+      { path: 'C:\\\\foo;bar', expected: 'file:///C:/foo;bar' },\n+      // percent\n+      { path: 'C:\\\\foo%bar', expected: 'file:///C:/foo%25bar' },\n+      // backslash\n+      { path: 'C:\\\\foo\\\\bar', expected: 'file:///C:/foo/bar' },\n+      // backspace\n+      { path: 'C:\\\\foo\\bbar', expected: 'file:///C:/foo%08bar' },\n+      // tab\n+      { path: 'C:\\\\foo\\tbar', expected: 'file:///C:/foo%09bar' },\n+      // newline\n+      { path: 'C:\\\\foo\\nbar', expected: 'file:///C:/foo%0Abar' },\n+      // carriage return\n+      { path: 'C:\\\\foo\\rbar', expected: 'file:///C:/foo%0Dbar' },\n+      // latin1\n+      { path: 'C:\\\\fÃ³Ã³bÃ r', expected: 'file:///C:/f%C3%B3%C3%B3b%C3%A0r' },\n+      // euro sign (BMP code point)\n+      { path: 'C:\\\\â‚¬', expected: 'file:///C:/%E2%82%AC' },\n+      // rocket emoji (non-BMP code point)\n+      { path: 'C:\\\\ðŸš€', expected: 'file:///C:/%F0%9F%9A%80' }\n+    ];\n+  } else {\n+    testCases = [\n+      // lowercase ascii alpha\n+      { path: '/foo', expected: 'file:///foo' },\n+      // uppercase ascii alpha\n+      { path: '/FOO', expected: 'file:///FOO' },\n+      // dir\n+      { path: '/dir/foo', expected: 'file:///dir/foo' },\n+      // trailing separator\n+      { path: '/dir/', expected: 'file:///dir/' },\n+      // dot\n+      { path: '/foo.mjs', expected: 'file:///foo.mjs' },\n+      // space\n+      { path: '/foo bar', expected: 'file:///foo%20bar' },\n+      // question mark\n+      { path: '/foo?bar', expected: 'file:///foo%3Fbar' },\n+      // number sign\n+      { path: '/foo#bar', expected: 'file:///foo%23bar' },\n+      // ampersand\n+      { path: '/foo&bar', expected: 'file:///foo&bar' },\n+      // equals\n+      { path: '/foo=bar', expected: 'file:///foo=bar' },\n+      // colon\n+      { path: '/foo:bar', expected: 'file:///foo:bar' },\n+      // semicolon\n+      { path: '/foo;bar', expected: 'file:///foo;bar' },\n+      // percent\n+      { path: '/foo%bar', expected: 'file:///foo%25bar' },\n+      // backslash\n+      { path: '/foo\\\\bar', expected: 'file:///foo%5Cbar' },\n+      // backspace\n+      { path: '/foo\\bbar', expected: 'file:///foo%08bar' },\n+      // tab\n+      { path: '/foo\\tbar', expected: 'file:///foo%09bar' },\n+      // newline\n+      { path: '/foo\\nbar', expected: 'file:///foo%0Abar' },\n+      // carriage return\n+      { path: '/foo\\rbar', expected: 'file:///foo%0Dbar' },\n+      // latin1\n+      { path: '/fÃ³Ã³bÃ r', expected: 'file:///f%C3%B3%C3%B3b%C3%A0r' },\n+      // euro sign (BMP code point)\n+      { path: '/â‚¬', expected: 'file:///%E2%82%AC' },\n+      // rocket emoji (non-BMP code point)\n+      { path: '/ðŸš€', expected: 'file:///%F0%9F%9A%80' },\n+    ];\n+  }\n+\n+  for (const { path, expected } of testCases) {\n+    const actual = url.pathToFileURL(path).href;\n+    assert.strictEqual(actual, expected);\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 123,
        "additions": 120,
        "deletions": 3
    }
}