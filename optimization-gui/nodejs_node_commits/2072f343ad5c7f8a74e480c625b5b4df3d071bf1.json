{
    "author": "BridgeAR",
    "message": "benchmark: (es) refactor\n\nPR-URL: https://github.com/nodejs/node/pull/18320\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
    "files": [
        {
            "sha": "a00b50137c1af35e088db40000f7895a02771485",
            "filename": "benchmark/es/defaultparams-bench.js",
            "status": "modified",
            "additions": 9,
            "deletions": 15,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fdefaultparams-bench.js",
            "raw_url": "https://github.com/nodejs/node/raw/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fdefaultparams-bench.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fes%2Fdefaultparams-bench.js?ref=2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
            "patch": "@@ -20,37 +20,31 @@ function defaultParams(x = 1, y = 2) {\n   assert.strictEqual(y, 2);\n }\n \n-function runOldStyleDefaults(n) {\n-\n-  var i = 0;\n+function runOldStyleDefaults(millions) {\n   bench.start();\n-  for (; i < n; i++)\n+  for (var i = 0; i < millions * 1e6; i++)\n     oldStyleDefaults();\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n-function runDefaultParams(n) {\n-\n-  var i = 0;\n+function runDefaultParams(millions) {\n   bench.start();\n-  for (; i < n; i++)\n+  for (var i = 0; i < millions * 1e6; i++)\n     defaultParams();\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n function main({ millions, method }) {\n-  const n = millions * 1e6;\n-\n   switch (method) {\n     case '':\n       // Empty string falls through to next line as default, mostly for tests.\n     case 'withoutdefaults':\n-      runOldStyleDefaults(n);\n+      runOldStyleDefaults(millions);\n       break;\n     case 'withdefaults':\n-      runDefaultParams(n);\n+      runDefaultParams(millions);\n       break;\n     default:\n-      throw new Error('Unexpected method');\n+      throw new Error(`Unexpected method \"${method}\"`);\n   }\n }"
        },
        {
            "sha": "2168940bdc44f0b8e8ebe21ee60c19dfd3902353",
            "filename": "benchmark/es/destructuring-bench.js",
            "status": "modified",
            "additions": 9,
            "deletions": 11,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fdestructuring-bench.js",
            "raw_url": "https://github.com/nodejs/node/raw/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fdestructuring-bench.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fes%2Fdestructuring-bench.js?ref=2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
            "patch": "@@ -8,45 +8,43 @@ const bench = common.createBenchmark(main, {\n   millions: [100]\n });\n \n-function runSwapManual(n) {\n+function runSwapManual(millions) {\n   var x, y, r;\n   bench.start();\n-  for (var i = 0; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     x = 1, y = 2;\n     r = x;\n     x = y;\n     y = r;\n     assert.strictEqual(x, 2);\n     assert.strictEqual(y, 1);\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n-function runSwapDestructured(n) {\n+function runSwapDestructured(millions) {\n   var x, y;\n   bench.start();\n-  for (var i = 0; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     x = 1, y = 2;\n     [x, y] = [y, x];\n     assert.strictEqual(x, 2);\n     assert.strictEqual(y, 1);\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n function main({ millions, method }) {\n-  const n = millions * 1e6;\n-\n   switch (method) {\n     case '':\n       // Empty string falls through to next line as default, mostly for tests.\n     case 'swap':\n-      runSwapManual(n);\n+      runSwapManual(millions);\n       break;\n     case 'destructure':\n-      runSwapDestructured(n);\n+      runSwapDestructured(millions);\n       break;\n     default:\n-      throw new Error('Unexpected method');\n+      throw new Error(`Unexpected method \"${method}\"`);\n   }\n }"
        },
        {
            "sha": "a84977c59bc2cda384284cd28731918bb242b3ee",
            "filename": "benchmark/es/destructuring-object-bench.js",
            "status": "modified",
            "additions": 9,
            "deletions": 11,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fdestructuring-object-bench.js",
            "raw_url": "https://github.com/nodejs/node/raw/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fdestructuring-object-bench.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fes%2Fdestructuring-object-bench.js?ref=2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
            "patch": "@@ -7,45 +7,43 @@ const bench = common.createBenchmark(main, {\n   millions: [100]\n });\n \n-function runNormal(n) {\n+function runNormal(millions) {\n   var i = 0;\n   const o = { x: 0, y: 1 };\n   bench.start();\n-  for (; i < n; i++) {\n+  for (; i < millions * 1e6; i++) {\n     /* eslint-disable no-unused-vars */\n     const x = o.x;\n     const y = o.y;\n     const r = o.r || 2;\n     /* eslint-enable no-unused-vars */\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n-function runDestructured(n) {\n+function runDestructured(millions) {\n   var i = 0;\n   const o = { x: 0, y: 1 };\n   bench.start();\n-  for (; i < n; i++) {\n+  for (; i < millions * 1e6; i++) {\n     /* eslint-disable no-unused-vars */\n     const { x, y, r = 2 } = o;\n     /* eslint-enable no-unused-vars */\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n function main({ millions, method }) {\n-  const n = millions * 1e6;\n-\n   switch (method) {\n     case '':\n       // Empty string falls through to next line as default, mostly for tests.\n     case 'normal':\n-      runNormal(n);\n+      runNormal(millions);\n       break;\n     case 'destructureObject':\n-      runDestructured(n);\n+      runDestructured(millions);\n       break;\n     default:\n-      throw new Error('Unexpected method');\n+      throw new Error(`Unexpected method \"${method}\"`);\n   }\n }"
        },
        {
            "sha": "e9179ed8dedb6d102c01cd9b7b77cf601ece565d",
            "filename": "benchmark/es/foreach-bench.js",
            "status": "modified",
            "additions": 19,
            "deletions": 24,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fforeach-bench.js",
            "raw_url": "https://github.com/nodejs/node/raw/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fforeach-bench.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fes%2Fforeach-bench.js?ref=2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
            "patch": "@@ -8,56 +8,51 @@ const bench = common.createBenchmark(main, {\n   millions: [5]\n });\n \n-function useFor(n, items, count) {\n-  var i, j;\n+function useFor(millions, items, count) {\n   bench.start();\n-  for (i = 0; i < n; i++) {\n-    for (j = 0; j < count; j++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n+    for (var j = 0; j < count; j++) {\n       /* eslint-disable no-unused-vars */\n       const item = items[j];\n       /* esline-enable no-unused-vars */\n     }\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n-function useForOf(n, items) {\n-  var i, item;\n+function useForOf(millions, items) {\n+  var item;\n   bench.start();\n-  for (i = 0; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     for (item of items) {}\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n-function useForIn(n, items) {\n-  var i, j, item;\n+function useForIn(millions, items) {\n   bench.start();\n-  for (i = 0; i < n; i++) {\n-    for (j in items) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n+    for (var j in items) {\n       /* eslint-disable no-unused-vars */\n-      item = items[j];\n+      const item = items[j];\n       /* esline-enable no-unused-vars */\n     }\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n-function useForEach(n, items) {\n-  var i;\n+function useForEach(millions, items) {\n   bench.start();\n-  for (i = 0; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     items.forEach((item) => {});\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n function main({ millions, count, method }) {\n-  const n = millions * 1e6;\n   const items = new Array(count);\n-  var i;\n   var fn;\n-  for (i = 0; i < count; i++)\n+  for (var i = 0; i < count; i++)\n     items[i] = i;\n \n   switch (method) {\n@@ -76,7 +71,7 @@ function main({ millions, count, method }) {\n       fn = useForEach;\n       break;\n     default:\n-      throw new Error('Unexpected method');\n+      throw new Error(`Unexpected method \"${method}\"`);\n   }\n-  fn(n, items, count);\n+  fn(millions, items, count);\n }"
        },
        {
            "sha": "445031aa9831ded77edeebd74b20a05c51d78144",
            "filename": "benchmark/es/map-bench.js",
            "status": "modified",
            "additions": 25,
            "deletions": 33,
            "changes": 58,
            "blob_url": "https://github.com/nodejs/node/blob/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fmap-bench.js",
            "raw_url": "https://github.com/nodejs/node/raw/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fmap-bench.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fes%2Fmap-bench.js?ref=2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
            "patch": "@@ -11,63 +11,59 @@ const bench = common.createBenchmark(main, {\n   millions: [1]\n });\n \n-function runObject(n) {\n+function runObject(millions) {\n   const m = {};\n-  var i = 0;\n   bench.start();\n-  for (; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     m[`i${i}`] = i;\n     m[`s${i}`] = String(i);\n     assert.strictEqual(String(m[`i${i}`]), m[`s${i}`]);\n     m[`i${i}`] = undefined;\n     m[`s${i}`] = undefined;\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n-function runNullProtoObject(n) {\n+function runNullProtoObject(millions) {\n   const m = Object.create(null);\n-  var i = 0;\n   bench.start();\n-  for (; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     m[`i${i}`] = i;\n     m[`s${i}`] = String(i);\n     assert.strictEqual(String(m[`i${i}`]), m[`s${i}`]);\n     m[`i${i}`] = undefined;\n     m[`s${i}`] = undefined;\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n-function runNullProtoLiteralObject(n) {\n+function runNullProtoLiteralObject(millions) {\n   const m = { __proto__: null };\n-  var i = 0;\n   bench.start();\n-  for (; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     m[`i${i}`] = i;\n     m[`s${i}`] = String(i);\n     assert.strictEqual(String(m[`i${i}`]), m[`s${i}`]);\n     m[`i${i}`] = undefined;\n     m[`s${i}`] = undefined;\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n function StorageObject() {}\n StorageObject.prototype = Object.create(null);\n \n-function runStorageObject(n) {\n+function runStorageObject(millions) {\n   const m = new StorageObject();\n-  var i = 0;\n   bench.start();\n-  for (; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     m[`i${i}`] = i;\n     m[`s${i}`] = String(i);\n     assert.strictEqual(String(m[`i${i}`]), m[`s${i}`]);\n     m[`i${i}`] = undefined;\n     m[`s${i}`] = undefined;\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n function fakeMap() {\n@@ -80,59 +76,55 @@ function fakeMap() {\n   };\n }\n \n-function runFakeMap(n) {\n+function runFakeMap(millions) {\n   const m = fakeMap();\n-  var i = 0;\n   bench.start();\n-  for (; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     m.set(`i${i}`, i);\n     m.set(`s${i}`, String(i));\n     assert.strictEqual(String(m.get(`i${i}`)), m.get(`s${i}`));\n     m.set(`i${i}`, undefined);\n     m.set(`s${i}`, undefined);\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n-function runMap(n) {\n+function runMap(millions) {\n   const m = new Map();\n-  var i = 0;\n   bench.start();\n-  for (; i < n; i++) {\n+  for (var i = 0; i < millions * 1e6; i++) {\n     m.set(`i${i}`, i);\n     m.set(`s${i}`, String(i));\n     assert.strictEqual(String(m.get(`i${i}`)), m.get(`s${i}`));\n     m.set(`i${i}`, undefined);\n     m.set(`s${i}`, undefined);\n   }\n-  bench.end(n / 1e6);\n+  bench.end(millions);\n }\n \n function main({ millions, method }) {\n-  const n = millions * 1e6;\n-\n   switch (method) {\n     case '':\n       // Empty string falls through to next line as default, mostly for tests.\n     case 'object':\n-      runObject(n);\n+      runObject(millions);\n       break;\n     case 'nullProtoObject':\n-      runNullProtoObject(n);\n+      runNullProtoObject(millions);\n       break;\n     case 'nullProtoLiteralObject':\n-      runNullProtoLiteralObject(n);\n+      runNullProtoLiteralObject(millions);\n       break;\n     case 'storageObject':\n-      runStorageObject(n);\n+      runStorageObject(millions);\n       break;\n     case 'fakeMap':\n-      runFakeMap(n);\n+      runFakeMap(millions);\n       break;\n     case 'map':\n-      runMap(n);\n+      runMap(millions);\n       break;\n     default:\n-      throw new Error('Unexpected method');\n+      throw new Error(`Unexpected method \"${method}\"`);\n   }\n }"
        },
        {
            "sha": "6ad766f10f16f6e0482f840fe43aa5fdc478430f",
            "filename": "benchmark/es/restparams-bench.js",
            "status": "modified",
            "additions": 14,
            "deletions": 24,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Frestparams-bench.js",
            "raw_url": "https://github.com/nodejs/node/raw/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Frestparams-bench.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fes%2Frestparams-bench.js?ref=2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
            "patch": "@@ -33,49 +33,39 @@ function useArguments() {\n   assert.strictEqual(arguments[3], 'b');\n }\n \n-function runCopyArguments(n) {\n-\n-  var i = 0;\n-  bench.start();\n-  for (; i < n; i++)\n+function runCopyArguments(millions) {\n+  for (var i = 0; i < millions * 1e6; i++)\n     copyArguments(1, 2, 'a', 'b');\n-  bench.end(n / 1e6);\n }\n \n-function runRestArguments(n) {\n-\n-  var i = 0;\n-  bench.start();\n-  for (; i < n; i++)\n+function runRestArguments(millions) {\n+  for (var i = 0; i < millions * 1e6; i++)\n     restArguments(1, 2, 'a', 'b');\n-  bench.end(n / 1e6);\n }\n \n-function runUseArguments(n) {\n-\n-  var i = 0;\n-  bench.start();\n-  for (; i < n; i++)\n+function runUseArguments(millions) {\n+  for (var i = 0; i < millions * 1e6; i++)\n     useArguments(1, 2, 'a', 'b');\n-  bench.end(n / 1e6);\n }\n \n function main({ millions, method }) {\n-  const n = millions * 1e6;\n-\n+  var fn;\n   switch (method) {\n     case '':\n       // Empty string falls through to next line as default, mostly for tests.\n     case 'copy':\n-      runCopyArguments(n);\n+      fn = runCopyArguments;\n       break;\n     case 'rest':\n-      runRestArguments(n);\n+      fn = runRestArguments;\n       break;\n     case 'arguments':\n-      runUseArguments(n);\n+      fn = runUseArguments;\n       break;\n     default:\n-      throw new Error('Unexpected method');\n+      throw new Error(`Unexpected method \"${method}\"`);\n   }\n+  bench.start();\n+  fn(millions);\n+  bench.end(millions);\n }"
        },
        {
            "sha": "067299cd650919a0f96079d93a4ced5f188a3362",
            "filename": "benchmark/es/spread-bench.js",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fspread-bench.js",
            "raw_url": "https://github.com/nodejs/node/raw/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fspread-bench.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fes%2Fspread-bench.js?ref=2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
            "patch": "@@ -24,7 +24,6 @@ function makeTest(count, rest) {\n }\n \n function main({ millions, context, count, rest, method }) {\n-  const n = millions * 1e6;\n   const ctx = context === 'context' ? {} : null;\n   var fn = makeTest(count, rest);\n   const args = new Array(count);\n@@ -37,25 +36,25 @@ function main({ millions, context, count, rest, method }) {\n       // Empty string falls through to next line as default, mostly for tests.\n     case 'apply':\n       bench.start();\n-      for (i = 0; i < n; i++)\n+      for (i = 0; i < millions * 1e6; i++)\n         fn.apply(ctx, args);\n-      bench.end(n / 1e6);\n+      bench.end(millions);\n       break;\n     case 'spread':\n       if (ctx !== null)\n         fn = fn.bind(ctx);\n       bench.start();\n-      for (i = 0; i < n; i++)\n+      for (i = 0; i < millions * 1e6; i++)\n         fn(...args);\n-      bench.end(n / 1e6);\n+      bench.end(millions);\n       break;\n     case 'call-spread':\n       bench.start();\n-      for (i = 0; i < n; i++)\n+      for (i = 0; i < millions * 1e6; i++)\n         fn.call(ctx, ...args);\n-      bench.end(n / 1e6);\n+      bench.end(millions);\n       break;\n     default:\n-      throw new Error('Unexpected method');\n+      throw new Error(`Unexpected method \"${method}\"`);\n   }\n }"
        },
        {
            "sha": "72fb7f9969b604891bfda6ca9363ead85b3143ba",
            "filename": "benchmark/es/string-concatenations.js",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fstring-concatenations.js",
            "raw_url": "https://github.com/nodejs/node/raw/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fstring-concatenations.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fes%2Fstring-concatenations.js?ref=2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
            "patch": "@@ -16,7 +16,6 @@ const configs = {\n \n const bench = common.createBenchmark(main, configs);\n \n-\n function main({ n, mode }) {\n   const str = 'abc';\n   const num = 123;\n@@ -63,7 +62,7 @@ function main({ n, mode }) {\n       bench.end(n);\n       break;\n     default:\n-      throw new Error('Unexpected method');\n+      throw new Error(`Unexpected method \"${mode}\"`);\n   }\n \n   return string;"
        },
        {
            "sha": "9e33e4acf4711873026b59a906536fa14773e12c",
            "filename": "benchmark/es/string-repeat.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fstring-repeat.js",
            "raw_url": "https://github.com/nodejs/node/raw/2072f343ad5c7f8a74e480c625b5b4df3d071bf1/benchmark%2Fes%2Fstring-repeat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fes%2Fstring-repeat.js?ref=2072f343ad5c7f8a74e480c625b5b4df3d071bf1",
            "patch": "@@ -33,7 +33,7 @@ function main({ n, size, encoding, mode }) {\n       bench.end(n);\n       break;\n     default:\n-      throw new Error('Unexpected method');\n+      throw new Error(`Unexpected method \"${mode}\"`);\n   }\n \n   assert.strictEqual([...str].length, size);"
        }
    ],
    "stats": {
        "total": 223,
        "additions": 94,
        "deletions": 129
    }
}