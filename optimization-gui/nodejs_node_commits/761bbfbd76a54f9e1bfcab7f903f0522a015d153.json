{
    "author": "tniessen",
    "message": "crypto: fix incorrect use of INT_MAX in validation\n\nThe native crypto module doesn't export INT_MAX, so all occurrences\nin the JavaScript layer evaluated to undefined. This change removes\nall such occurrences and replaces validateInt32 with validateUint32\nsince the native layer assumes uint32_t anyway.\n\nThe alternative would be to use the constant from the constants\nmodule, but that would be pointless as far as I can tell.\n\nPR-URL: https://github.com/nodejs/node/pull/22581\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "761bbfbd76a54f9e1bfcab7f903f0522a015d153",
    "files": [
        {
            "sha": "140aa2a05aba3b4ceee1335a941f864b3b431ca8",
            "filename": "lib/internal/crypto/pbkdf2.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/761bbfbd76a54f9e1bfcab7f903f0522a015d153/lib%2Finternal%2Fcrypto%2Fpbkdf2.js",
            "raw_url": "https://github.com/nodejs/node/raw/761bbfbd76a54f9e1bfcab7f903f0522a015d153/lib%2Finternal%2Fcrypto%2Fpbkdf2.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fpbkdf2.js?ref=761bbfbd76a54f9e1bfcab7f903f0522a015d153",
            "patch": "@@ -3,8 +3,8 @@\n const { internalBinding } = require('internal/bootstrap/loaders');\n const { AsyncWrap, Providers } = internalBinding('async_wrap');\n const { Buffer } = require('buffer');\n-const { INT_MAX, pbkdf2: _pbkdf2 } = internalBinding('crypto');\n-const { validateInt32 } = require('internal/validators');\n+const { pbkdf2: _pbkdf2 } = internalBinding('crypto');\n+const { validateUint32 } = require('internal/validators');\n const {\n   ERR_CRYPTO_INVALID_DIGEST,\n   ERR_CRYPTO_PBKDF2_ERROR,\n@@ -60,8 +60,8 @@ function check(password, salt, iterations, keylen, digest, callback) {\n \n   password = validateArrayBufferView(password, 'password');\n   salt = validateArrayBufferView(salt, 'salt');\n-  iterations = validateInt32(iterations, 'iterations', 0, INT_MAX);\n-  keylen = validateInt32(keylen, 'keylen', 0, INT_MAX);\n+  iterations = validateUint32(iterations, 'iterations', 0);\n+  keylen = validateUint32(keylen, 'keylen', 0);\n \n   return { password, salt, iterations, keylen, digest };\n }"
        },
        {
            "sha": "e369bb11faffb98b975d736f15aa65031560c2e9",
            "filename": "lib/internal/crypto/scrypt.js",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/761bbfbd76a54f9e1bfcab7f903f0522a015d153/lib%2Finternal%2Fcrypto%2Fscrypt.js",
            "raw_url": "https://github.com/nodejs/node/raw/761bbfbd76a54f9e1bfcab7f903f0522a015d153/lib%2Finternal%2Fcrypto%2Fscrypt.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fscrypt.js?ref=761bbfbd76a54f9e1bfcab7f903f0522a015d153",
            "patch": "@@ -3,8 +3,8 @@\n const { internalBinding } = require('internal/bootstrap/loaders');\n const { AsyncWrap, Providers } = internalBinding('async_wrap');\n const { Buffer } = require('buffer');\n-const { INT_MAX, scrypt: _scrypt } = internalBinding('crypto');\n-const { validateInt32 } = require('internal/validators');\n+const { scrypt: _scrypt } = internalBinding('crypto');\n+const { validateUint32 } = require('internal/validators');\n const {\n   ERR_CRYPTO_SCRYPT_INVALID_PARAMETER,\n   ERR_CRYPTO_SCRYPT_NOT_SUPPORTED,\n@@ -77,31 +77,31 @@ function check(password, salt, keylen, options, callback) {\n \n   password = validateArrayBufferView(password, 'password');\n   salt = validateArrayBufferView(salt, 'salt');\n-  keylen = validateInt32(keylen, 'keylen', 0, INT_MAX);\n+  keylen = validateUint32(keylen, 'keylen');\n \n   let { N, r, p, maxmem } = defaults;\n   if (options && options !== defaults) {\n     let has_N, has_r, has_p;\n     if (has_N = (options.N !== undefined))\n-      N = validateInt32(options.N, 'N', 0, INT_MAX);\n+      N = validateUint32(options.N, 'N');\n     if (options.cost !== undefined) {\n       if (has_N) throw new ERR_CRYPTO_SCRYPT_INVALID_PARAMETER();\n-      N = validateInt32(options.cost, 'cost', 0, INT_MAX);\n+      N = validateUint32(options.cost, 'cost');\n     }\n     if (has_r = (options.r !== undefined))\n-      r = validateInt32(options.r, 'r', 0, INT_MAX);\n+      r = validateUint32(options.r, 'r');\n     if (options.blockSize !== undefined) {\n       if (has_r) throw new ERR_CRYPTO_SCRYPT_INVALID_PARAMETER();\n-      r = validateInt32(options.blockSize, 'blockSize', 0, INT_MAX);\n+      r = validateUint32(options.blockSize, 'blockSize');\n     }\n     if (has_p = (options.p !== undefined))\n-      p = validateInt32(options.p, 'p', 0, INT_MAX);\n+      p = validateUint32(options.p, 'p');\n     if (options.parallelization !== undefined) {\n       if (has_p) throw new ERR_CRYPTO_SCRYPT_INVALID_PARAMETER();\n-      p = validateInt32(options.parallelization, 'parallelization', 0, INT_MAX);\n+      p = validateUint32(options.parallelization, 'parallelization');\n     }\n     if (options.maxmem !== undefined)\n-      maxmem = validateInt32(options.maxmem, 'maxmem', 0, INT_MAX);\n+      maxmem = validateUint32(options.maxmem, 'maxmem');\n     if (N === 0) N = defaults.N;\n     if (r === 0) r = defaults.r;\n     if (p === 0) p = defaults.p;"
        },
        {
            "sha": "0f5d4618ea156c26213970ad77f4c18ec27623d6",
            "filename": "test/parallel/test-crypto-pbkdf2.js",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/761bbfbd76a54f9e1bfcab7f903f0522a015d153/test%2Fparallel%2Ftest-crypto-pbkdf2.js",
            "raw_url": "https://github.com/nodejs/node/raw/761bbfbd76a54f9e1bfcab7f903f0522a015d153/test%2Fparallel%2Ftest-crypto-pbkdf2.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-pbkdf2.js?ref=761bbfbd76a54f9e1bfcab7f903f0522a015d153",
            "patch": "@@ -6,8 +6,6 @@ if (!common.hasCrypto)\n const assert = require('assert');\n const crypto = require('crypto');\n \n-const { INT_MAX } = process.binding('constants').crypto;\n-\n //\n // Test PBKDF2 with RFC 6070 test vectors (except #4)\n //\n@@ -71,7 +69,7 @@ assert.throws(\n     code: 'ERR_OUT_OF_RANGE',\n     name: 'RangeError [ERR_OUT_OF_RANGE]',\n     message: 'The value of \"iterations\" is out of range. ' +\n-             'It must be >= 0 && <= 2147483647. Received -1'\n+             'It must be >= 0 && < 4294967296. Received -1'\n   }\n );\n \n@@ -100,7 +98,7 @@ assert.throws(\n     });\n });\n \n-[-1, 4073741824, INT_MAX + 1].forEach((input) => {\n+[-1, 4294967297].forEach((input) => {\n   assert.throws(\n     () => {\n       crypto.pbkdf2('password', 'salt', 1, input, 'sha256',\n@@ -109,7 +107,7 @@ assert.throws(\n       code: 'ERR_OUT_OF_RANGE',\n       name: 'RangeError [ERR_OUT_OF_RANGE]',\n       message: 'The value of \"keylen\" is out of range. It ' +\n-               `must be >= 0 && <= 2147483647. Received ${input}`\n+               `must be >= 0 && < 4294967296. Received ${input}`\n     });\n });\n "
        }
    ],
    "stats": {
        "total": 36,
        "additions": 17,
        "deletions": 19
    }
}