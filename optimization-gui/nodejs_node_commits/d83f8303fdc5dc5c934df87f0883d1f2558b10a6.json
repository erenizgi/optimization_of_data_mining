{
    "author": "unknown",
    "message": "n-api: update reference test\n\nRemove the necessity for allocating on the heap, and assert that the\ncorrect pointer gets passed to the finalizer.\n\nPR-URL: https://github.com/nodejs/node/pull/19086\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>",
    "sha": "d83f8303fdc5dc5c934df87f0883d1f2558b10a6",
    "files": [
        {
            "sha": "f34adc6693b6fec1cc7507db1392d2d7e589ee9f",
            "filename": "test/addons-napi/test_reference/test_reference.c",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/d83f8303fdc5dc5c934df87f0883d1f2558b10a6/test%2Faddons-napi%2Ftest_reference%2Ftest_reference.c",
            "raw_url": "https://github.com/nodejs/node/raw/d83f8303fdc5dc5c934df87f0883d1f2558b10a6/test%2Faddons-napi%2Ftest_reference%2Ftest_reference.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons-napi%2Ftest_reference%2Ftest_reference.c?ref=d83f8303fdc5dc5c934df87f0883d1f2558b10a6",
            "patch": "@@ -1,6 +1,5 @@\n #include <node_api.h>\n #include \"../common.h\"\n-#include <stdlib.h>\n \n static int test_value = 1;\n static int finalize_count = 0;\n@@ -13,7 +12,9 @@ napi_value GetFinalizeCount(napi_env env, napi_callback_info info) {\n }\n \n void FinalizeExternal(napi_env env, void* data, void* hint) {\n-  free(data);\n+  int *actual_value = data;\n+  NAPI_ASSERT_RETURN_VOID(env, actual_value == &test_value,\n+      \"The correct pointer was passed to the finalizer\");\n   finalize_count++;\n }\n \n@@ -33,13 +34,10 @@ napi_value CreateExternal(napi_env env, napi_callback_info info) {\n }\n \n napi_value CreateExternalWithFinalize(napi_env env, napi_callback_info info) {\n-  int* data = malloc(sizeof(int));\n-  *data = test_value;\n-\n   napi_value result;\n   NAPI_CALL(env,\n       napi_create_external(env,\n-                           data,\n+                           &test_value,\n                            FinalizeExternal,\n                            NULL, /* finalize_hint */\n                            &result));"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 4,
        "deletions": 6
    }
}