{
    "author": "Trott",
    "message": "test: apply test-fs-access to promises API\n\nAdd tests for `fs.promises.access()` in all test cases in\n`test-fs-access` that are relevant to the Promises-based API.\n\nPR-URL: https://github.com/nodejs/node/pull/20667\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>",
    "sha": "617f0d27637b428c3eed1920d0c0da59f5b7d714",
    "files": [
        {
            "sha": "01dbe90eda84352e7023ecead1d1678512632e55",
            "filename": "test/parallel/test-fs-access.js",
            "status": "modified",
            "additions": 52,
            "deletions": 25,
            "changes": 77,
            "blob_url": "https://github.com/nodejs/node/blob/617f0d27637b428c3eed1920d0c0da59f5b7d714/test%2Fparallel%2Ftest-fs-access.js",
            "raw_url": "https://github.com/nodejs/node/raw/617f0d27637b428c3eed1920d0c0da59f5b7d714/test%2Fparallel%2Ftest-fs-access.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-access.js?ref=617f0d27637b428c3eed1920d0c0da59f5b7d714",
            "patch": "@@ -62,37 +62,64 @@ assert.strictEqual(typeof fs.R_OK, 'number');\n assert.strictEqual(typeof fs.W_OK, 'number');\n assert.strictEqual(typeof fs.X_OK, 'number');\n \n+const throwNextTick = (e) => { process.nextTick(() => { throw e; }); };\n+\n fs.access(__filename, common.mustCall(assert.ifError));\n+fs.promises.access(__filename)\n+  .then(common.mustCall())\n+  .catch(throwNextTick);\n fs.access(__filename, fs.R_OK, common.mustCall(assert.ifError));\n+fs.promises.access(__filename, fs.R_OK)\n+  .then(common.mustCall())\n+  .catch(throwNextTick);\n fs.access(readOnlyFile, fs.F_OK | fs.R_OK, common.mustCall(assert.ifError));\n+fs.promises.access(readOnlyFile, fs.F_OK | fs.R_OK)\n+  .then(common.mustCall())\n+  .catch(throwNextTick);\n \n-fs.access(doesNotExist, common.mustCall((err) => {\n-  assert.notStrictEqual(err, null, 'error should exist');\n-  assert.strictEqual(err.code, 'ENOENT');\n-  assert.strictEqual(err.path, doesNotExist);\n-}));\n-\n-fs.access(readOnlyFile, fs.W_OK, common.mustCall(function(err) {\n-  assert.strictEqual(this, undefined);\n-  if (hasWriteAccessForReadonlyFile) {\n-    assert.ifError(err);\n-  } else {\n-    assert.notStrictEqual(err, null, 'error should exist');\n-    assert.strictEqual(err.path, readOnlyFile);\n-  }\n-}));\n+{\n+  const expectedError = (err) => {\n+    assert.notStrictEqual(err, null);\n+    assert.strictEqual(err.code, 'ENOENT');\n+    assert.strictEqual(err.path, doesNotExist);\n+  };\n+  fs.access(doesNotExist, common.mustCall(expectedError));\n+  fs.promises.access(doesNotExist)\n+    .then(common.mustNotCall(), common.mustCall(expectedError))\n+    .catch(throwNextTick);\n+}\n \n-common.expectsError(\n-  () => {\n-    fs.access(100, fs.F_OK, common.mustNotCall());\n-  },\n-  {\n-    code: 'ERR_INVALID_ARG_TYPE',\n-    type: TypeError,\n-    message: 'The \"path\" argument must be one of type string, Buffer, or URL.' +\n-             ' Received type number'\n+{\n+  function expectedError(err) {\n+    assert.strictEqual(this, undefined);\n+    if (hasWriteAccessForReadonlyFile) {\n+      assert.ifError(err);\n+    } else {\n+      assert.notStrictEqual(err, null);\n+      assert.strictEqual(err.path, readOnlyFile);\n+    }\n   }\n-);\n+  fs.access(readOnlyFile, fs.W_OK, common.mustCall(expectedError));\n+  fs.promises.access(readOnlyFile, fs.W_OK)\n+    .then(common.mustNotCall(), common.mustCall(expectedError))\n+    .catch(throwNextTick);\n+}\n+\n+{\n+  const expectedError = (err) => {\n+    assert.strictEqual(err.code, 'ERR_INVALID_ARG_TYPE');\n+    assert.ok(err instanceof TypeError);\n+    return true;\n+  };\n+  assert.throws(\n+    () => { fs.access(100, fs.F_OK, common.mustNotCall()); },\n+    expectedError\n+  );\n+\n+  fs.promises.access(100, fs.F_OK)\n+    .then(common.mustNotCall(), common.mustCall(expectedError))\n+    .catch(throwNextTick);\n+}\n \n common.expectsError(\n   () => {"
        }
    ],
    "stats": {
        "total": 77,
        "additions": 52,
        "deletions": 25
    }
}