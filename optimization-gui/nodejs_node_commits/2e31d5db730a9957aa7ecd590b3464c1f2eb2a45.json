{
    "author": "apapirovski",
    "message": "http: cleanup _http_common.js\n\nRemove constant deep property access by storing a reference,\nuse more const, make some conditionals stricter.\n\nPR-URL: https://github.com/nodejs/node/pull/20126\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "2e31d5db730a9957aa7ecd590b3464c1f2eb2a45",
    "files": [
        {
            "sha": "f34396ba8a8a629ba6d0da6e8a19d6b41fa2cb5f",
            "filename": "lib/_http_common.js",
            "status": "modified",
            "additions": 24,
            "deletions": 27,
            "changes": 51,
            "blob_url": "https://github.com/nodejs/node/blob/2e31d5db730a9957aa7ecd590b3464c1f2eb2a45/lib%2F_http_common.js",
            "raw_url": "https://github.com/nodejs/node/raw/2e31d5db730a9957aa7ecd590b3464c1f2eb2a45/lib%2F_http_common.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_common.js?ref=2e31d5db730a9957aa7ecd590b3464c1f2eb2a45",
            "patch": "@@ -65,12 +65,12 @@ function parserOnHeadersComplete(versionMajor, versionMinor, headers, method,\n   const parser = this;\n   const { socket } = parser;\n \n-  if (!headers) {\n+  if (headers === undefined) {\n     headers = parser._headers;\n     parser._headers = [];\n   }\n \n-  if (!url) {\n+  if (url === undefined) {\n     url = parser._url;\n     parser._url = '';\n   }\n@@ -80,64 +80,61 @@ function parserOnHeadersComplete(versionMajor, versionMinor, headers, method,\n                                  socket.server[kIncomingMessage]) ||\n                                  IncomingMessage;\n \n-  parser.incoming = new ParserIncomingMessage(socket);\n-  parser.incoming.httpVersionMajor = versionMajor;\n-  parser.incoming.httpVersionMinor = versionMinor;\n-  parser.incoming.httpVersion = `${versionMajor}.${versionMinor}`;\n-  parser.incoming.url = url;\n-  parser.incoming.upgrade = upgrade;\n+  const incoming = parser.incoming = new ParserIncomingMessage(socket);\n+  incoming.httpVersionMajor = versionMajor;\n+  incoming.httpVersionMinor = versionMinor;\n+  incoming.httpVersion = `${versionMajor}.${versionMinor}`;\n+  incoming.url = url;\n+  incoming.upgrade = upgrade;\n \n   var n = headers.length;\n \n   // If parser.maxHeaderPairs <= 0 assume that there's no limit.\n   if (parser.maxHeaderPairs > 0)\n     n = Math.min(n, parser.maxHeaderPairs);\n \n-  parser.incoming._addHeaderLines(headers, n);\n+  incoming._addHeaderLines(headers, n);\n \n   if (typeof method === 'number') {\n     // server only\n-    parser.incoming.method = methods[method];\n+    incoming.method = methods[method];\n   } else {\n     // client only\n-    parser.incoming.statusCode = statusCode;\n-    parser.incoming.statusMessage = statusMessage;\n+    incoming.statusCode = statusCode;\n+    incoming.statusMessage = statusMessage;\n   }\n \n-  return parser.onIncoming(parser.incoming, shouldKeepAlive);\n+  return parser.onIncoming(incoming, shouldKeepAlive);\n }\n \n // XXX This is a mess.\n // TODO: http.Parser should be a Writable emits request/response events.\n function parserOnBody(b, start, len) {\n-  var parser = this;\n-  var stream = parser.incoming;\n+  const stream = this.incoming;\n \n   // if the stream has already been removed, then drop it.\n-  if (!stream)\n+  if (stream === null)\n     return;\n \n-  var socket = stream.socket;\n-\n   // pretend this was the result of a stream._read call.\n   if (len > 0 && !stream._dumped) {\n     var slice = b.slice(start, start + len);\n     var ret = stream.push(slice);\n     if (!ret)\n-      readStop(socket);\n+      readStop(this.socket);\n   }\n }\n \n function parserOnMessageComplete() {\n-  var parser = this;\n-  var stream = parser.incoming;\n+  const parser = this;\n+  const stream = parser.incoming;\n \n-  if (stream) {\n+  if (stream !== null) {\n     stream.complete = true;\n     // Emit any trailing headers.\n-    var headers = parser._headers;\n-    if (headers) {\n-      parser.incoming._addHeaderLines(headers, headers.length);\n+    const headers = parser._headers;\n+    if (headers.length) {\n+      stream._addHeaderLines(headers, headers.length);\n       parser._headers = [];\n       parser._url = '';\n     }\n@@ -151,8 +148,8 @@ function parserOnMessageComplete() {\n }\n \n \n-var parsers = new FreeList('parsers', 1000, function() {\n-  var parser = new HTTPParser(HTTPParser.REQUEST);\n+const parsers = new FreeList('parsers', 1000, function() {\n+  const parser = new HTTPParser(HTTPParser.REQUEST);\n \n   parser._headers = [];\n   parser._url = '';"
        }
    ],
    "stats": {
        "total": 51,
        "additions": 24,
        "deletions": 27
    }
}