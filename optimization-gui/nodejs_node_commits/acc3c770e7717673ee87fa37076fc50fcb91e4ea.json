{
    "author": "BridgeAR",
    "message": "fs: fix error handling\n\nRight now there are multiple cases where the validated entry would\nnot be returned or a wrong error is thrown. This fixes both cases.\n\nPR-URL: https://github.com/nodejs/node/pull/19445\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "acc3c770e7717673ee87fa37076fc50fcb91e4ea",
    "files": [
        {
            "sha": "4834d92fa0acd7bad705d0f8b08f708a592f11ef",
            "filename": "lib/internal/fs.js",
            "status": "modified",
            "additions": 28,
            "deletions": 13,
            "changes": 41,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/lib%2Finternal%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/lib%2Finternal%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -77,11 +77,16 @@ function isUint32(n) { return n === (n >>> 0); }\n function modeNum(m, def) {\n   if (typeof m === 'number')\n     return m;\n-  if (typeof m === 'string')\n-    return parseInt(m, 8);\n-  if (def)\n-    return modeNum(def);\n-  return undefined;\n+  if (typeof m === 'string') {\n+    const parsed = parseInt(m, 8);\n+    if (Number.isNaN(parsed))\n+      return m;\n+    return parsed;\n+  }\n+  // TODO(BridgeAR): Only return `def` in case `m == null`\n+  if (def !== undefined)\n+    return def;\n+  return m;\n }\n \n // Check if the path contains null types if it is a string nor Uint8Array,\n@@ -333,8 +338,14 @@ function validateBuffer(buffer) {\n function validateLen(len) {\n   let err;\n \n-  if (!isInt32(len))\n-    err = new ERR_INVALID_ARG_TYPE('len', 'integer');\n+  if (!isInt32(len)) {\n+    if (typeof value !== 'number') {\n+      err = new ERR_INVALID_ARG_TYPE('len', 'number', len);\n+    } else {\n+      // TODO(BridgeAR): Improve this error message.\n+      err = new ERR_OUT_OF_RANGE('len', 'an integer', len);\n+    }\n+  }\n \n   if (err !== undefined) {\n     Error.captureStackTrace(err, validateLen);\n@@ -388,12 +399,16 @@ function validatePath(path, propName = 'path') {\n }\n \n function validateUint32(value, propName) {\n-  let err;\n-\n-  if (!isUint32(value))\n-    err = new ERR_INVALID_ARG_TYPE(propName, 'integer');\n-\n-  if (err !== undefined) {\n+  if (!isUint32(value)) {\n+    let err;\n+    if (typeof value !== 'number') {\n+      err = new ERR_INVALID_ARG_TYPE(propName, 'number', value);\n+    } else if (!Number.isInteger(value)) {\n+      err = new ERR_OUT_OF_RANGE(propName, 'an integer', value);\n+    } else {\n+      // 2 ** 32 === 4294967296\n+      err = new ERR_OUT_OF_RANGE(propName, '>= 0 && < 4294967296', value);\n+    }\n     Error.captureStackTrace(err, validateUint32);\n     throw err;\n   }"
        },
        {
            "sha": "6727ec2144f2cea0bb7a6ae7daa29094feaf8e50",
            "filename": "test/parallel/test-fs-chmod.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-chmod.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-chmod.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-chmod.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -114,7 +114,8 @@ fs.open(file2, 'w', common.mustCall((err, fd) => {\n       {\n         code: 'ERR_INVALID_ARG_TYPE',\n         type: TypeError,\n-        message: 'The \"mode\" argument must be of type integer'\n+        message: 'The \"mode\" argument must be of type number. ' +\n+                 'Received type object'\n       }\n     );\n \n@@ -150,7 +151,8 @@ if (fs.lchmod) {\n   const errObj = {\n     code: 'ERR_INVALID_ARG_TYPE',\n     name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n-    message: 'The \"fd\" argument must be of type integer'\n+    message: 'The \"fd\" argument must be of type number. ' +\n+             `Received type ${typeof input}`\n   };\n   assert.throws(() => fs.fchmod(input, 0o000), errObj);\n   assert.throws(() => fs.fchmodSync(input, 0o000), errObj);"
        },
        {
            "sha": "48af5eb4856d5f61845566f2ff4d5641ad42f612",
            "filename": "test/parallel/test-fs-close-errors.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-close-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-close-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-close-errors.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -11,7 +11,8 @@ const fs = require('fs');\n   const errObj = {\n     code: 'ERR_INVALID_ARG_TYPE',\n     name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n-    message: 'The \"fd\" argument must be of type integer'\n+    message: 'The \"fd\" argument must be of type number. ' +\n+             `Received type ${typeof input}`\n   };\n   assert.throws(() => fs.close(input), errObj);\n   assert.throws(() => fs.closeSync(input), errObj);"
        },
        {
            "sha": "edf5cc32ea8dcadb6231d1643c69386d4127d5a2",
            "filename": "test/parallel/test-fs-fchmod.js",
            "status": "modified",
            "additions": 54,
            "deletions": 33,
            "changes": 87,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-fchmod.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-fchmod.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-fchmod.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -1,45 +1,66 @@\n 'use strict';\n const common = require('../common');\n+const assert = require('assert');\n const fs = require('fs');\n \n // This test ensures that input for fchmod is valid, testing for valid\n // inputs for fd and mode\n \n // Check input type\n-['', false, null, undefined, {}, [], Infinity, -1].forEach((i) => {\n-  common.expectsError(\n-    () => fs.fchmod(i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"fd\" argument must be of type integer'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.fchmodSync(i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"fd\" argument must be of type integer'\n-    }\n-  );\n+[false, null, undefined, {}, [], ''].forEach((input) => {\n+  const errObj = {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n+    message: 'The \"fd\" argument must be of type number. Received type ' +\n+             typeof input\n+  };\n+  assert.throws(() => fs.fchmod(input), errObj);\n+  assert.throws(() => fs.fchmodSync(input), errObj);\n+  errObj.message = errObj.message.replace('fd', 'mode');\n+  assert.throws(() => fs.fchmod(1, input), errObj);\n+  assert.throws(() => fs.fchmodSync(1, input), errObj);\n+});\n+\n+[-1, 2 ** 32].forEach((input) => {\n+  const errObj = {\n+    code: 'ERR_OUT_OF_RANGE',\n+    name: 'RangeError [ERR_OUT_OF_RANGE]',\n+    message: 'The value of \"fd\" is out of range. It must be >= 0 && < ' +\n+             `${2 ** 32}. Received ${input}`\n+  };\n+  assert.throws(() => fs.fchmod(input), errObj);\n+  assert.throws(() => fs.fchmodSync(input), errObj);\n+  errObj.message = errObj.message.replace('fd', 'mode');\n+  assert.throws(() => fs.fchmod(1, input), errObj);\n+  assert.throws(() => fs.fchmodSync(1, input), errObj);\n+});\n \n-  common.expectsError(\n-    () => fs.fchmod(1, i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"mode\" argument must be of type integer'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.fchmodSync(1, i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"mode\" argument must be of type integer'\n-    }\n-  );\n+[NaN, Infinity].forEach((input) => {\n+  const errObj = {\n+    code: 'ERR_OUT_OF_RANGE',\n+    name: 'RangeError [ERR_OUT_OF_RANGE]',\n+    message: 'The value of \"fd\" is out of range. It must be an integer. ' +\n+             `Received ${input}`\n+  };\n+  assert.throws(() => fs.fchmod(input), errObj);\n+  assert.throws(() => fs.fchmodSync(input), errObj);\n+  errObj.message = errObj.message.replace('fd', 'mode');\n+  assert.throws(() => fs.fchmod(1, input), errObj);\n+  assert.throws(() => fs.fchmodSync(1, input), errObj);\n+});\n+\n+[1.5].forEach((input) => {\n+  const errObj = {\n+    code: 'ERR_OUT_OF_RANGE',\n+    name: 'RangeError [ERR_OUT_OF_RANGE]',\n+    message: 'The value of \"fd\" is out of range. It must be an integer. ' +\n+             `Received ${input}`\n+  };\n+  assert.throws(() => fs.fchmod(input), errObj);\n+  assert.throws(() => fs.fchmodSync(input), errObj);\n+  errObj.message = errObj.message.replace('fd', 'mode');\n+  assert.throws(() => fs.fchmod(1, input), errObj);\n+  assert.throws(() => fs.fchmodSync(1, input), errObj);\n });\n \n // Check for mode values range"
        },
        {
            "sha": "500c06a47ca09cac65ccbd660470ced4d49433e3",
            "filename": "test/parallel/test-fs-fchown.js",
            "status": "modified",
            "additions": 39,
            "deletions": 50,
            "changes": 89,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-fchown.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-fchown.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-fchown.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -1,57 +1,46 @@\n 'use strict';\n \n-const common = require('../common');\n+require('../common');\n+const assert = require('assert');\n const fs = require('fs');\n \n-['', false, null, undefined, {}, [], Infinity, -1].forEach((i) => {\n-  common.expectsError(\n-    () => fs.fchown(i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"fd\" argument must be of type integer'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.fchownSync(i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"fd\" argument must be of type integer'\n-    }\n-  );\n+function test(input, errObj) {\n+  assert.throws(() => fs.fchown(input), errObj);\n+  assert.throws(() => fs.fchownSync(input), errObj);\n+  errObj.message = errObj.message.replace('fd', 'uid');\n+  assert.throws(() => fs.fchown(1, input), errObj);\n+  assert.throws(() => fs.fchownSync(1, input), errObj);\n+  errObj.message = errObj.message.replace('uid', 'gid');\n+  assert.throws(() => fs.fchown(1, 1, input), errObj);\n+  assert.throws(() => fs.fchownSync(1, 1, input), errObj);\n+}\n \n-  common.expectsError(\n-    () => fs.fchown(1, i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"uid\" argument must be of type integer'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.fchownSync(1, i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"uid\" argument must be of type integer'\n-    }\n-  );\n+['', false, null, undefined, {}, []].forEach((input) => {\n+  const errObj = {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n+    message: 'The \"fd\" argument must be of type number. Received type ' +\n+             typeof input\n+  };\n+  test(input, errObj);\n+});\n+\n+[Infinity, NaN].forEach((input) => {\n+  const errObj = {\n+    code: 'ERR_OUT_OF_RANGE',\n+    name: 'RangeError [ERR_OUT_OF_RANGE]',\n+    message: 'The value of \"fd\" is out of range. It must be an integer. ' +\n+             `Received ${input}`\n+  };\n+  test(input, errObj);\n+});\n \n-  common.expectsError(\n-    () => fs.fchown(1, 1, i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"gid\" argument must be of type integer'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.fchownSync(1, 1, i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"gid\" argument must be of type integer'\n-    }\n-  );\n+[-1, 2 ** 32].forEach((input) => {\n+  const errObj = {\n+    code: 'ERR_OUT_OF_RANGE',\n+    name: 'RangeError [ERR_OUT_OF_RANGE]',\n+    message: 'The value of \"fd\" is out of range. It must be ' +\n+             `>= 0 && < 4294967296. Received ${input}`\n+  };\n+  test(input, errObj);\n });"
        },
        {
            "sha": "4d96091f34650133ac3d6dab0570a06da9d9bf32",
            "filename": "test/parallel/test-fs-fsync.js",
            "status": "modified",
            "additions": 11,
            "deletions": 33,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-fsync.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-fsync.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-fsync.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -50,37 +50,15 @@ fs.open(fileTemp, 'a', 0o777, common.mustCall(function(err, fd) {\n   }));\n }));\n \n-['', false, null, undefined, {}, []].forEach((i) => {\n-  common.expectsError(\n-    () => fs.fdatasync(i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"fd\" argument must be of type integer'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.fdatasyncSync(i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"fd\" argument must be of type integer'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.fsync(i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"fd\" argument must be of type integer'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.fsyncSync(i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message: 'The \"fd\" argument must be of type integer'\n-    }\n-  );\n+['', false, null, undefined, {}, []].forEach((input) => {\n+  const errObj = {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n+    message: 'The \"fd\" argument must be of type number. Received type ' +\n+             typeof input\n+  };\n+  assert.throws(() => fs.fdatasync(input), errObj);\n+  assert.throws(() => fs.fdatasyncSync(input), errObj);\n+  assert.throws(() => fs.fsync(input), errObj);\n+  assert.throws(() => fs.fsyncSync(input), errObj);\n });"
        },
        {
            "sha": "55049ed79f84eb087d39e41dcc5af74df394dd41",
            "filename": "test/parallel/test-fs-read-type.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-read-type.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-read-type.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-read-type.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -30,7 +30,8 @@ common.expectsError(\n   }, {\n     code: 'ERR_INVALID_ARG_TYPE',\n     type: TypeError,\n-    message: 'The \"fd\" argument must be of type integer'\n+    message: 'The \"fd\" argument must be of type number. ' +\n+             `Received type ${typeof value}`\n   });\n });\n \n@@ -75,7 +76,8 @@ common.expectsError(\n   }, {\n     code: 'ERR_INVALID_ARG_TYPE',\n     type: TypeError,\n-    message: 'The \"fd\" argument must be of type integer'\n+    message: 'The \"fd\" argument must be of type number. ' +\n+             `Received type ${typeof value}`\n   });\n });\n "
        },
        {
            "sha": "1003890bb8f459f57735b19f8a67ab541bf14270",
            "filename": "test/parallel/test-fs-stat.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-stat.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-stat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-stat.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -138,7 +138,8 @@ fs.stat(__filename, common.mustCall(function(err, s) {\n       {\n         code: 'ERR_INVALID_ARG_TYPE',\n         name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n-        message: 'The \"fd\" argument must be of type integer'\n+        message: 'The \"fd\" argument must be of type number. ' +\n+                 `Received type ${typeof input}`\n       }\n     );\n   });"
        },
        {
            "sha": "ddcf7a63ffbe188e7ca5afd7a55609a7760b0c76",
            "filename": "test/parallel/test-fs-symlink.js",
            "status": "modified",
            "additions": 22,
            "deletions": 56,
            "changes": 78,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-symlink.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-symlink.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-symlink.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -35,7 +35,7 @@ let fileTime;\n const tmpdir = require('../common/tmpdir');\n tmpdir.refresh();\n \n-// test creating and reading symbolic link\n+// Test creating and reading symbolic link\n const linkData = fixtures.path('/cycles/root.js');\n const linkPath = path.join(tmpdir.path, 'symlink1.js');\n \n@@ -58,63 +58,29 @@ fs.symlink(linkData, linkPath, common.mustCall(function(err) {\n   }));\n }));\n \n-[false, 1, {}, [], null, undefined].forEach((i) => {\n-  common.expectsError(\n-    () => fs.symlink(i, '', common.mustNotCall()),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message:\n-        'The \"target\" argument must be one of type string, Buffer, or URL'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.symlink('', i, common.mustNotCall()),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message:\n-        'The \"path\" argument must be one of type string, Buffer, or URL'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.symlinkSync(i, ''),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message:\n-        'The \"target\" argument must be one of type string, Buffer, or URL'\n-    }\n-  );\n-  common.expectsError(\n-    () => fs.symlinkSync('', i),\n-    {\n-      code: 'ERR_INVALID_ARG_TYPE',\n-      type: TypeError,\n-      message:\n-        'The \"path\" argument must be one of type string, Buffer, or URL'\n-    }\n-  );\n+[false, 1, {}, [], null, undefined].forEach((input) => {\n+  const errObj = {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+    name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n+    message: 'The \"target\" argument must be one of type string, Buffer, or ' +\n+             `URL. Received type ${typeof input}`\n+  };\n+  assert.throws(() => fs.symlink(input, '', common.mustNotCall()), errObj);\n+  assert.throws(() => fs.symlinkSync(input, ''), errObj);\n+\n+  errObj.message = errObj.message.replace('target', 'path');\n+  assert.throws(() => fs.symlink('', input, common.mustNotCall()), errObj);\n+  assert.throws(() => fs.symlinkSync('', input), errObj);\n });\n \n-common.expectsError(\n-  () => fs.symlink('', '', 'ðŸ', common.mustNotCall()),\n-  {\n-    code: 'ERR_FS_INVALID_SYMLINK_TYPE',\n-    type: Error,\n-    message:\n-      'Symlink type must be one of \"dir\", \"file\", or \"junction\". Received \"ðŸ\"'\n-  }\n-);\n-common.expectsError(\n-  () => fs.symlinkSync('', '', 'ðŸ'),\n-  {\n-    code: 'ERR_FS_INVALID_SYMLINK_TYPE',\n-    type: Error,\n-    message:\n-      'Symlink type must be one of \"dir\", \"file\", or \"junction\". Received \"ðŸ\"'\n-  }\n-);\n+const errObj = {\n+  code: 'ERR_FS_INVALID_SYMLINK_TYPE',\n+  name: 'Error [ERR_FS_INVALID_SYMLINK_TYPE]',\n+  message:\n+    'Symlink type must be one of \"dir\", \"file\", or \"junction\". Received \"ðŸ\"'\n+};\n+assert.throws(() => fs.symlink('', '', 'ðŸ', common.mustNotCall()), errObj);\n+assert.throws(() => fs.symlinkSync('', '', 'ðŸ'), errObj);\n \n process.on('exit', function() {\n   assert.notStrictEqual(linkTime, fileTime);"
        },
        {
            "sha": "bb6b4bc8b5dec1b03a8ea3eb2a51837818025294",
            "filename": "test/parallel/test-fs-truncate.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-truncate.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-truncate.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-truncate.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -184,7 +184,8 @@ function testFtruncate(cb) {\n       {\n         code: 'ERR_INVALID_ARG_TYPE',\n         name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n-        message: 'The \"len\" argument must be of type integer'\n+        message: 'The \"len\" argument must be of type number. ' +\n+                 `Received type ${typeof input}`\n       }\n     );\n   });\n@@ -213,7 +214,8 @@ function testFtruncate(cb) {\n       {\n         code: 'ERR_INVALID_ARG_TYPE',\n         name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n-        message: 'The \"fd\" argument must be of type integer'\n+        message: 'The \"fd\" argument must be of type number. ' +\n+                 `Received type ${typeof input}`\n       }\n     );\n   });"
        },
        {
            "sha": "bad9067864955c3b1e304511665db48892108a53",
            "filename": "test/parallel/test-fs-utimes.js",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-utimes.js",
            "raw_url": "https://github.com/nodejs/node/raw/acc3c770e7717673ee87fa37076fc50fcb91e4ea/test%2Fparallel%2Ftest-fs-utimes.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-utimes.js?ref=acc3c770e7717673ee87fa37076fc50fcb91e4ea",
            "patch": "@@ -101,8 +101,10 @@ function testIt(atime, mtime, callback) {\n     common.expectsError(\n       () => fs.futimesSync(-1, atime, mtime),\n       {\n-        code: 'ERR_INVALID_ARG_TYPE',\n-        type: TypeError\n+        code: 'ERR_OUT_OF_RANGE',\n+        type: RangeError,\n+        message: 'The value of \"fd\" is out of range. ' +\n+                'It must be >= 0 && < 4294967296. Received -1'\n       }\n     );\n     tests_run++;\n@@ -130,8 +132,10 @@ function testIt(atime, mtime, callback) {\n         common.expectsError(\n           () => fs.futimes(-1, atime, mtime, common.mustNotCall()),\n           {\n-            code: 'ERR_INVALID_ARG_TYPE',\n-            type: TypeError,\n+            code: 'ERR_OUT_OF_RANGE',\n+            type: RangeError,\n+            message: 'The value of \"fd\" is out of range. ' +\n+                    'It must be >= 0 && < 4294967296. Received -1'\n           }\n         );\n "
        }
    ],
    "stats": {
        "total": 375,
        "additions": 178,
        "deletions": 197
    }
}