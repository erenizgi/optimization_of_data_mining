{
    "author": "unknown",
    "message": "deps: add -no_rand_screen to openssl s_client\n\nIn openssl s_client on Windows, RAND_screen() is invoked to initialize\nrandom state but it takes several seconds in each connection.\nThis added -no_rand_screen to openssl s_client on Windows to skip\nRAND_screen() and gets a better performance in the unit test of\ntest-tls-server-verify.\nDo not enable this except to use in the unit test.\n\nBackport-PR-URL: https://github.com/nodejs/node/pull/19638\nFixes: https://github.com/nodejs/io.js/issues/1461\nPR-URL: https://github.com/nodejs/io.js/pull/1836\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>",
    "sha": "1a85328264646fae04068e0595c3a6bf02e2c8fc",
    "files": [
        {
            "sha": "00e0538dd3381892eb650c31f3d64eabe7816708",
            "filename": "deps/openssl/openssl/apps/app_rand.c",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/1a85328264646fae04068e0595c3a6bf02e2c8fc/deps%2Fopenssl%2Fopenssl%2Fapps%2Fapp_rand.c",
            "raw_url": "https://github.com/nodejs/node/raw/1a85328264646fae04068e0595c3a6bf02e2c8fc/deps%2Fopenssl%2Fopenssl%2Fapps%2Fapp_rand.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fopenssl%2Fapps%2Fapp_rand.c?ref=1a85328264646fae04068e0595c3a6bf02e2c8fc",
            "patch": "@@ -124,7 +124,16 @@ int app_RAND_load_file(const char *file, BIO *bio_e, int dont_warn)\n     char buffer[200];\n \n #ifdef OPENSSL_SYS_WINDOWS\n-    RAND_screen();\n+    /*\n+     * allocate 2 to dont_warn not to use RAND_screen() via\n+     * -no_rand_screen option in s_client\n+     */\n+    if (dont_warn != 2) {\n+      BIO_printf(bio_e, \"Loading 'screen' into random state -\");\n+      BIO_flush(bio_e);\n+      RAND_screen();\n+      BIO_printf(bio_e, \" done\\n\");\n+    }\n #endif\n \n     if (file == NULL)"
        },
        {
            "sha": "1ef59dc3464a43bca42813bafedf527cb95761ff",
            "filename": "deps/openssl/openssl/apps/s_client.c",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/1a85328264646fae04068e0595c3a6bf02e2c8fc/deps%2Fopenssl%2Fopenssl%2Fapps%2Fs_client.c",
            "raw_url": "https://github.com/nodejs/node/raw/1a85328264646fae04068e0595c3a6bf02e2c8fc/deps%2Fopenssl%2Fopenssl%2Fapps%2Fs_client.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fopenssl%2Fopenssl%2Fapps%2Fs_client.c?ref=1a85328264646fae04068e0595c3a6bf02e2c8fc",
            "patch": "@@ -236,6 +236,7 @@ static BIO *bio_c_msg = NULL;\n static int c_quiet = 0;\n static int c_ign_eof = 0;\n static int c_brief = 0;\n+static int c_no_rand_screen = 0;\n \n #ifndef OPENSSL_NO_PSK\n /* Default PSK identity and key */\n@@ -451,6 +452,10 @@ static void sc_usage(void)\n                \" -keymatexport label   - Export keying material using label\\n\");\n     BIO_printf(bio_err,\n                \" -keymatexportlen len  - Export len bytes of keying material (default 20)\\n\");\n+#ifdef OPENSSL_SYS_WINDOWS\n+    BIO_printf(bio_err,\n+               \" -no_rand_screen  - Do not use RAND_screen() to initialize random state\\n\");\n+#endif\n }\n \n #ifndef OPENSSL_NO_TLSEXT\n@@ -1144,6 +1149,10 @@ int MAIN(int argc, char **argv)\n             keymatexportlen = atoi(*(++argv));\n             if (keymatexportlen == 0)\n                 goto bad;\n+#ifdef OPENSSL_SYS_WINDOWS\n+        } else if (strcmp(*argv, \"-no_rand_screen\") == 0) {\n+          c_no_rand_screen = 1;\n+#endif\n         } else {\n             BIO_printf(bio_err, \"unknown option %s\\n\", *argv);\n             badop = 1;\n@@ -1260,7 +1269,7 @@ int MAIN(int argc, char **argv)\n     if (!load_excert(&exc, bio_err))\n         goto end;\n \n-    if (!app_RAND_load_file(NULL, bio_err, 1) && inrand == NULL\n+    if (!app_RAND_load_file(NULL, bio_err, ++c_no_rand_screen) && inrand == NULL\n         && !RAND_status()) {\n         BIO_printf(bio_err,\n                    \"warning, not much extra random data, consider using the -rand option\\n\");"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 20,
        "deletions": 2
    }
}