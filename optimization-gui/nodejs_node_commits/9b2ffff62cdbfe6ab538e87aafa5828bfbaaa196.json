{
    "author": "unknown",
    "message": "tls: emit a warning when servername is an IP address\n\nSetting the TLS ServerName to an IP address is not permitted by\nRFC6066. This will be ignored in a future version.\n\nRefs: https://github.com/nodejs/node/pull/18127\n\nPR-URL: https://github.com/nodejs/node/pull/23329\nFixes: https://github.com/nodejs/node/issues/18071\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>",
    "sha": "9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196",
    "files": [
        {
            "sha": "a7294145ed407f0629839920cea61c2468f1148a",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196",
            "patch": "@@ -2293,6 +2293,20 @@ Type: Runtime\n Please use `Server.prototype.setSecureContext()` instead.\n \n \n+<a id=\"DEP0123\"></a>\n+### DEP0123: setting the TLS ServerName to an IP address\n+<!-- YAML\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/REPLACEME\n+    description: Runtime deprecation.\n+-->\n+\n+Type: Runtime\n+\n+Setting the TLS ServerName to an IP address is not permitted by\n+[RFC 6066][]. This will be ignored in a future version.\n+\n [`--pending-deprecation`]: cli.html#cli_pending_deprecation\n [`Buffer.allocUnsafeSlow(size)`]: buffer.html#buffer_class_method_buffer_allocunsafeslow_size\n [`Buffer.from(array)`]: buffer.html#buffer_class_method_buffer_from_array\n@@ -2393,3 +2407,4 @@ Please use `Server.prototype.setSecureContext()` instead.\n [legacy `urlObject`]: url.html#url_legacy_urlobject\n [NIST SP 800-38D]: https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-38d.pdf\n [WHATWG URL API]: url.html#url_the_whatwg_url_api\n+[RFC 6066]: https://tools.ietf.org/html/rfc6066#section-3"
        },
        {
            "sha": "0cd500617fade758e4c6735ec001605439b7cf46",
            "filename": "lib/_tls_wrap.js",
            "status": "modified",
            "additions": 13,
            "deletions": 1,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196/lib%2F_tls_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196/lib%2F_tls_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_wrap.js?ref=9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196",
            "patch": "@@ -59,6 +59,8 @@ const kSNICallback = Symbol('snicallback');\n \n const noop = () => {};\n \n+let ipServernameWarned = false;\n+\n function onhandshakestart(now) {\n   debug('onhandshakestart');\n \n@@ -1240,8 +1242,18 @@ exports.connect = function connect(...args) {\n   if (options.session)\n     socket.setSession(options.session);\n \n-  if (options.servername)\n+  if (options.servername) {\n+    if (!ipServernameWarned && net.isIP(options.servername)) {\n+      process.emitWarning(\n+        'Setting the TLS ServerName to an IP address is not permitted by ' +\n+        'RFC 6066. This will be ignored in a future version.',\n+        'DeprecationWarning',\n+        'DEP0123'\n+      );\n+      ipServernameWarned = true;\n+    }\n     socket.setServername(options.servername);\n+  }\n \n   if (options.socket)\n     socket._start();"
        },
        {
            "sha": "b747caa03d57c4a2c8df3990ab1a0b294caafd97",
            "filename": "test/parallel/test-tls-ip-servername-deprecation.js",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/nodejs/node/blob/9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196/test%2Fparallel%2Ftest-tls-ip-servername-deprecation.js",
            "raw_url": "https://github.com/nodejs/node/raw/9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196/test%2Fparallel%2Ftest-tls-ip-servername-deprecation.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-ip-servername-deprecation.js?ref=9b2ffff62cdbfe6ab538e87aafa5828bfbaaa196",
            "patch": "@@ -0,0 +1,41 @@\n+'use strict';\n+\n+const common = require('../common');\n+const fixtures = require('../common/fixtures');\n+\n+if (!common.hasCrypto)\n+  common.skip('missing crypto');\n+\n+const tls = require('tls');\n+\n+// This test expects `tls.connect()` to emit a warning when\n+// `servername` of options is an IP address.\n+common.expectWarning(\n+  'DeprecationWarning',\n+  'Setting the TLS ServerName to an IP address is not permitted by ' +\n+  'RFC 6066. This will be ignored in a future version.',\n+  'DEP0123'\n+);\n+\n+{\n+  const options = {\n+    key: fixtures.readKey('agent1-key.pem'),\n+    cert: fixtures.readKey('agent1-cert.pem')\n+  };\n+\n+  const server = tls.createServer(options, function(s) {\n+    s.end('hello');\n+  }).listen(0, function() {\n+    const client = tls.connect({\n+      port: this.address().port,\n+      rejectUnauthorized: false,\n+      servername: '127.0.0.1',\n+    }, function() {\n+      client.end();\n+    });\n+  });\n+\n+  server.on('connection', common.mustCall(function(socket) {\n+    server.close();\n+  }));\n+}"
        }
    ],
    "stats": {
        "total": 70,
        "additions": 69,
        "deletions": 1
    }
}