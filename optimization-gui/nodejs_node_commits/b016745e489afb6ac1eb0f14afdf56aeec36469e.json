{
    "author": "targos",
    "message": "console: implement timeLog method\n\nRefs: https://github.com/whatwg/console/pull/138\n\nPR-URL: https://github.com/nodejs/node/pull/21312\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Weijia Wang <starkwang@126.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "b016745e489afb6ac1eb0f14afdf56aeec36469e",
    "files": [
        {
            "sha": "95801c31fed63c2d3aeaa97b97ce8430d7f9dc66",
            "filename": "doc/api/console.md",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/b016745e489afb6ac1eb0f14afdf56aeec36469e/doc%2Fapi%2Fconsole.md",
            "raw_url": "https://github.com/nodejs/node/raw/b016745e489afb6ac1eb0f14afdf56aeec36469e/doc%2Fapi%2Fconsole.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fconsole.md?ref=b016745e489afb6ac1eb0f14afdf56aeec36469e",
            "patch": "@@ -413,6 +413,25 @@ console.timeEnd('100-elements');\n // prints 100-elements: 225.438ms\n ```\n \n+### console.timeLog([label][, ...data])\n+<!-- YAML\n+added: REPLACEME\n+-->\n+* `label` {string} **Default:** `'default'`\n+* `...data` {any}\n+\n+For a timer that was previously started by calling [`console.time()`][], prints\n+the elapsed time and other `data` arguments to `stdout`:\n+\n+```js\n+console.time('process');\n+const value = expensiveProcess1(); // Returns 42\n+console.timeLog('process', value);\n+// Prints \"process: 365.227ms 42\".\n+doExpensiveProcess2(value);\n+console.timeEnd('process');\n+```\n+\n ### console.trace([message][, ...args])\n <!-- YAML\n added: v0.1.104"
        },
        {
            "sha": "d42ca496eb15de5f8012986bbe2b9a714e7c4ab8",
            "filename": "lib/console.js",
            "status": "modified",
            "additions": 22,
            "deletions": 6,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/b016745e489afb6ac1eb0f14afdf56aeec36469e/lib%2Fconsole.js",
            "raw_url": "https://github.com/nodejs/node/raw/b016745e489afb6ac1eb0f14afdf56aeec36469e/lib%2Fconsole.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fconsole.js?ref=b016745e489afb6ac1eb0f14afdf56aeec36469e",
            "patch": "@@ -235,18 +235,34 @@ Console.prototype.time = function time(label = 'default') {\n };\n \n Console.prototype.timeEnd = function timeEnd(label = 'default') {\n+  const hasWarned = timeLogImpl(this, 'timeEnd', label);\n+  if (!hasWarned) {\n+    this._times.delete(label);\n+  }\n+};\n+\n+Console.prototype.timeLog = function timeLog(label, ...data) {\n+  timeLogImpl(this, 'timeLog', label, data);\n+};\n+\n+// Returns true if label was not found\n+function timeLogImpl(self, name, label = 'default', data) {\n   // Coerces everything other than Symbol to a string\n   label = `${label}`;\n-  const time = this._times.get(label);\n+  const time = self._times.get(label);\n   if (!time) {\n-    process.emitWarning(`No such label '${label}' for console.timeEnd()`);\n-    return;\n+    process.emitWarning(`No such label '${label}' for console.${name}()`);\n+    return true;\n   }\n   const duration = process.hrtime(time);\n   const ms = duration[0] * 1000 + duration[1] / 1e6;\n-  this.log('%s: %sms', label, ms.toFixed(3));\n-  this._times.delete(label);\n-};\n+  if (data === undefined) {\n+    self.log('%s: %sms', label, ms.toFixed(3));\n+  } else {\n+    self.log('%s: %sms', label, ms.toFixed(3), ...data);\n+  }\n+  return false;\n+}\n \n Console.prototype.trace = function trace(...args) {\n   const err = {"
        },
        {
            "sha": "e6446bbbe47d1738df7c93bdb80f9d4cb91f67d9",
            "filename": "test/parallel/test-console.js",
            "status": "modified",
            "additions": 25,
            "deletions": 9,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/b016745e489afb6ac1eb0f14afdf56aeec36469e/test%2Fparallel%2Ftest-console.js",
            "raw_url": "https://github.com/nodejs/node/raw/b016745e489afb6ac1eb0f14afdf56aeec36469e/test%2Fparallel%2Ftest-console.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-console.js?ref=b016745e489afb6ac1eb0f14afdf56aeec36469e",
            "patch": "@@ -31,11 +31,18 @@ if (common.isMainThread) {\n   assert.strictEqual(typeof process.stdout.fd, 'number');\n   assert.strictEqual(typeof process.stderr.fd, 'number');\n }\n-process.once('warning', common.mustCall((warning) => {\n-  assert(/no such label/.test(warning.message));\n-}));\n \n-console.timeEnd('no such label');\n+common.expectWarning(\n+  'Warning',\n+  [\n+    ['No such label \\'nolabel\\' for console.timeEnd()', common.noWarnCode],\n+    ['No such label \\'nolabel\\' for console.timeLog()', common.noWarnCode],\n+    ['Label \\'test\\' already exists for console.time()', common.noWarnCode]\n+  ]\n+);\n+\n+console.timeEnd('nolabel');\n+console.timeLog('nolabel');\n \n console.time('label');\n console.timeEnd('label');\n@@ -144,15 +151,16 @@ console.timeEnd(NaN);\n console.time('test');\n const time = console._times.get('test');\n setTimeout(() => {\n-  common.expectWarning(\n-    'Warning',\n-    'Label \\'test\\' already exists for console.time()',\n-    common.noWarnCode);\n   console.time('test');\n   assert.deepStrictEqual(console._times.get('test'), time);\n   console.timeEnd('test');\n }, 1);\n \n+console.time('log1');\n+console.timeLog('log1');\n+console.timeLog('log1', 'test');\n+console.timeLog('log1', {}, [1, 2, 3]);\n+console.timeEnd('log1');\n \n console.assert(false, '%s should', 'console.assert', 'not throw');\n assert.strictEqual(errStrings[errStrings.length - 1],\n@@ -219,6 +227,14 @@ assert.ok(/^default: \\d+\\.\\d{3}ms$/.test(strings.shift().trim()));\n assert.ok(/^default: \\d+\\.\\d{3}ms$/.test(strings.shift().trim()));\n assert.ok(/^NaN: \\d+\\.\\d{3}ms$/.test(strings.shift().trim()));\n \n+assert.ok(/^log1: \\d+\\.\\d{3}ms$/.test(strings.shift().trim()));\n+assert.ok(/^log1: \\d+\\.\\d{3}ms test$/.test(strings.shift().trim()));\n+assert.ok(/^log1: \\d+\\.\\d{3}ms {} \\[ 1, 2, 3 ]$/.test(strings.shift().trim()));\n+assert.ok(/^log1: \\d+\\.\\d{3}ms$/.test(strings.shift().trim()));\n+\n+// Make sure that we checked all strings\n+assert.strictEqual(strings.length, 0);\n+\n assert.strictEqual(errStrings.shift().split('\\n').shift(),\n                    'Trace: This is a {\"formatted\":\"trace\"} 10 foo');\n \n@@ -229,6 +245,6 @@ common.hijackStderr(common.mustCall(function(data) {\n \n   // stderr.write will catch sync error, so use `process.nextTick` here\n   process.nextTick(function() {\n-    assert.strictEqual(data.includes('no such label'), true);\n+    assert.strictEqual(data.includes('nolabel'), true);\n   });\n }));"
        }
    ],
    "stats": {
        "total": 81,
        "additions": 66,
        "deletions": 15
    }
}