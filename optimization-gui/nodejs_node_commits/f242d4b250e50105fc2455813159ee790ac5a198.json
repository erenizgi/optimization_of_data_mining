{
    "author": "shobhitchittora",
    "message": "tools: auto fix custom crypto-check eslint rule\n\n1. Fixer for crypto-check.js\n2. Extends tests\n\nPR-URL: https://github.com/nodejs/node/pull/16647\nRefs: https://github.com/nodejs/node/issues/16636\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Khaidi Chu <i@2333.moe>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "f242d4b250e50105fc2455813159ee790ac5a198",
    "files": [
        {
            "sha": "86c28d21218154150e9ce646470070f47b2d7137",
            "filename": "test/parallel/test-eslint-crypto-check.js",
            "status": "modified",
            "additions": 22,
            "deletions": 8,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/f242d4b250e50105fc2455813159ee790ac5a198/test%2Fparallel%2Ftest-eslint-crypto-check.js",
            "raw_url": "https://github.com/nodejs/node/raw/f242d4b250e50105fc2455813159ee790ac5a198/test%2Fparallel%2Ftest-eslint-crypto-check.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-eslint-crypto-check.js?ref=f242d4b250e50105fc2455813159ee790ac5a198",
            "patch": "@@ -15,20 +15,34 @@ new RuleTester().run('crypto-check', rule, {\n     'foo',\n     'crypto',\n     `\n-      if (!common.hasCrypto) {\n-        common.skip();\n-      }\n-      require('crypto');\n+    if (!common.hasCrypto) {\n+      common.skip(\"missing crypto\");\n+    }\n+    require(\"crypto\");\n     `\n   ],\n   invalid: [\n     {\n-      code: 'require(\"crypto\")',\n-      errors: [{ message }]\n+      code: 'require(\"common\")\\n' +\n+            'require(\"crypto\")',\n+      errors: [{ message }],\n+      output: 'require(\"common\")\\n' +\n+              'if (!common.hasCrypto) {' +\n+              ' common.skip(\"missing crypto\");' +\n+              '}\\n' +\n+              'require(\"crypto\")'\n     },\n     {\n-      code: 'if (common.foo) {} require(\"crypto\")',\n-      errors: [{ message }]\n+      code: 'require(\"common\")\\n' +\n+            'if (common.foo) {}\\n' +\n+            'require(\"crypto\")',\n+      errors: [{ message }],\n+      output: 'require(\"common\")\\n' +\n+              'if (!common.hasCrypto) {' +\n+              ' common.skip(\"missing crypto\");' +\n+              '}\\n' +\n+              'if (common.foo) {}\\n' +\n+              'require(\"crypto\")'\n     }\n   ]\n });"
        },
        {
            "sha": "42b17b0c80a225503ec4b27134d7153e70c6be81",
            "filename": "tools/eslint-rules/crypto-check.js",
            "status": "modified",
            "additions": 19,
            "deletions": 1,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/f242d4b250e50105fc2455813159ee790ac5a198/tools%2Feslint-rules%2Fcrypto-check.js",
            "raw_url": "https://github.com/nodejs/node/raw/f242d4b250e50105fc2455813159ee790ac5a198/tools%2Feslint-rules%2Fcrypto-check.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Feslint-rules%2Fcrypto-check.js?ref=f242d4b250e50105fc2455813159ee790ac5a198",
            "patch": "@@ -23,13 +23,18 @@ const bindingModules = cryptoModules.concat(['tls_wrap']);\n module.exports = function(context) {\n   const missingCheckNodes = [];\n   const requireNodes = [];\n+  var commonModuleNode = null;\n   var hasSkipCall = false;\n \n   function testCryptoUsage(node) {\n     if (utils.isRequired(node, requireModules) ||\n         utils.isBinding(node, bindingModules)) {\n       requireNodes.push(node);\n     }\n+\n+    if (utils.isCommonModule(node)) {\n+      commonModuleNode = node;\n+    }\n   }\n \n   function testIfStatement(node) {\n@@ -75,7 +80,20 @@ module.exports = function(context) {\n \n   function report(nodes) {\n     nodes.forEach((node) => {\n-      context.report(node, msg);\n+      context.report({\n+        node,\n+        message: msg,\n+        fix: (fixer) => {\n+          if (commonModuleNode) {\n+            return fixer.insertTextAfter(\n+              commonModuleNode,\n+              '\\nif (!common.hasCrypto) {' +\n+              ' common.skip(\"missing crypto\");' +\n+              '}'\n+            );\n+          }\n+        }\n+      });\n     });\n   }\n "
        },
        {
            "sha": "88ecf658ce37f0ff51d81ba1522982efac500a57",
            "filename": "tools/eslint-rules/rules-utils.js",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/f242d4b250e50105fc2455813159ee790ac5a198/tools%2Feslint-rules%2Frules-utils.js",
            "raw_url": "https://github.com/nodejs/node/raw/f242d4b250e50105fc2455813159ee790ac5a198/tools%2Feslint-rules%2Frules-utils.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Feslint-rules%2Frules-utils.js?ref=f242d4b250e50105fc2455813159ee790ac5a198",
            "patch": "@@ -12,6 +12,17 @@ module.exports.isRequired = function(node, modules) {\n     modules.includes(node.arguments[0].value);\n };\n \n+/**\n+* Return true if common module is required\n+* in AST Node under inspection\n+*/\n+var commonModuleRegExp = new RegExp(/^(\\.\\.\\/)*common(\\.js)?$/);\n+module.exports.isCommonModule = function(node) {\n+  return node.callee.name === 'require' &&\n+         node.arguments.length !== 0 &&\n+         commonModuleRegExp.test(node.arguments[0].value);\n+};\n+\n /**\n  * Returns true if any of the passed in modules are used in\n  * binding calls."
        }
    ],
    "stats": {
        "total": 61,
        "additions": 52,
        "deletions": 9
    }
}