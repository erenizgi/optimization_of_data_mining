{
    "author": "joyeecheung",
    "message": "http2: remove pushValueToArray in Http2Session::HandleOriginFrame\n\nInstead of calling into JS from C++ to push values into an array,\nuse the new Array::New API that takes a pointer and a length\ndirectly.\n\nPR-URL: https://github.com/nodejs/node/pull/24264\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "1a787b514cde6702bb7513f74392ae6a3b91e6f8",
    "files": [
        {
            "sha": "20b634f90fc00d5214db324c43e67aaeec9ddfce",
            "filename": "src/node_http2.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 17,
            "changes": 26,
            "blob_url": "https://github.com/nodejs/node/blob/1a787b514cde6702bb7513f74392ae6a3b91e6f8/src%2Fnode_http2.cc",
            "raw_url": "https://github.com/nodejs/node/raw/1a787b514cde6702bb7513f74392ae6a3b91e6f8/src%2Fnode_http2.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http2.cc?ref=1a787b514cde6702bb7513f74392ae6a3b91e6f8",
            "patch": "@@ -1424,25 +1424,17 @@ void Http2Session::HandleOriginFrame(const nghttp2_frame* frame) {\n   nghttp2_extension ext = frame->ext;\n   nghttp2_ext_origin* origin = static_cast<nghttp2_ext_origin*>(ext.payload);\n \n-  Local<Value> holder = Array::New(isolate);\n-  Local<Function> fn = env()->push_values_to_array_function();\n-  Local<Value> argv[NODE_PUSH_VAL_TO_ARRAY_MAX];\n+  size_t nov = origin->nov;\n+  std::vector<Local<Value>> origin_v(nov);\n \n-  size_t n = 0;\n-  while (n < origin->nov) {\n-    size_t j = 0;\n-    while (n < origin->nov && j < arraysize(argv)) {\n-      auto entry = origin->ov[n++];\n-      argv[j++] =\n-        String::NewFromOneByte(isolate,\n-                               entry.origin,\n-                               v8::NewStringType::kNormal,\n-                               entry.origin_len).ToLocalChecked();\n-    }\n-    if (j > 0)\n-      fn->Call(context, holder, j, argv).ToLocalChecked();\n+  for (size_t i = 0; i < nov; ++i) {\n+    const nghttp2_origin_entry& entry = origin->ov[i];\n+    origin_v[i] =\n+        String::NewFromOneByte(\n+            isolate, entry.origin, v8::NewStringType::kNormal, entry.origin_len)\n+            .ToLocalChecked();\n   }\n-\n+  Local<Value> holder = Array::New(isolate, origin_v.data(), origin_v.size());\n   MakeCallback(env()->onorigin_string(), 1, &holder);\n }\n "
        }
    ],
    "stats": {
        "total": 26,
        "additions": 9,
        "deletions": 17
    }
}