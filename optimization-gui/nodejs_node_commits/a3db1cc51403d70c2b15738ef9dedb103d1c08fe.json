{
    "author": "refack",
    "message": "tools: include exit code in TAP log\n\nPR-URL: https://github.com/nodejs/node/pull/19855\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Gibson Fahnestock <gibfahn@gmail.com>\nReviewed-By: Rod Vagg <rod@vagg.org>",
    "sha": "a3db1cc51403d70c2b15738ef9dedb103d1c08fe",
    "files": [
        {
            "sha": "0a142f602be4e7ab7744371f2d6bcd217bb4b4a0",
            "filename": "tools/test.py",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/a3db1cc51403d70c2b15738ef9dedb103d1c08fe/tools%2Ftest.py",
            "raw_url": "https://github.com/nodejs/node/raw/a3db1cc51403d70c2b15738ef9dedb103d1c08fe/tools%2Ftest.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Ftest.py?ref=a3db1cc51403d70c2b15738ef9dedb103d1c08fe",
            "patch": "@@ -254,11 +254,12 @@ def HasRun(self, output):\n \n class TapProgressIndicator(SimpleProgressIndicator):\n \n-  def _printDiagnostic(self, traceback, severity):\n-    logger.info('  severity: %s', severity)\n+  def _printDiagnostic(self):\n+    logger.info('  severity: %s', self.severity)\n+    self.exitcode and logger.info('  exitcode: %s', self.exitcode)\n     logger.info('  stack: |-')\n \n-    for l in traceback.splitlines():\n+    for l in self.traceback.splitlines():\n       logger.info('    ' + l)\n \n   def Starting(self):\n@@ -273,6 +274,7 @@ def HasRun(self, output):\n     self._done += 1\n     self.traceback = ''\n     self.severity = 'ok'\n+    self.exitcode = ''\n \n     # Print test name as (for example) \"parallel/test-assert\".  Tests that are\n     # scraped from the addons documentation are all named test.js, making it\n@@ -284,7 +286,8 @@ def HasRun(self, output):\n     if output.UnexpectedOutput():\n       status_line = 'not ok %i %s' % (self._done, command)\n       self.severity = 'fail'\n-      self.traceback = \"exit code: \" + output.output.exit_code + \"\\n\" + output.output.stdout + output.output.stderr\n+      self.exitcode = output.output.exit_code\n+      self.traceback = output.output.stdout + output.output.stderr\n \n       if FLAKY in output.test.outcomes and self.flaky_tests_mode == DONTCARE:\n         status_line = status_line + ' # TODO : Fix flaky test'\n@@ -330,7 +333,7 @@ def HasRun(self, output):\n     if self.severity is not 'ok' or self.traceback is not '':\n       if output.HasTimedOut():\n         self.traceback = 'timeout'\n-      self._printDiagnostic(self.traceback, self.severity)\n+      self._printDiagnostic()\n     logger.info('  ...')\n \n   def Done(self):"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 8,
        "deletions": 5
    }
}