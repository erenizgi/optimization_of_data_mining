{
    "author": "bjori",
    "message": "crypto: add cert.fingerprint256 as SHA256 fingerprint\n\nPR-URL: https://github.com/nodejs/node/pull/17690\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "7876aeb0fe01acf007401cfedf12709f834c927b",
    "files": [
        {
            "sha": "a4454d55c1c95b14c73131eb0b9661f1ba88c214",
            "filename": "src/env.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/7876aeb0fe01acf007401cfedf12709f834c927b/src%2Fenv.h",
            "raw_url": "https://github.com/nodejs/node/raw/7876aeb0fe01acf007401cfedf12709f834c927b/src%2Fenv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.h?ref=7876aeb0fe01acf007401cfedf12709f834c927b",
            "patch": "@@ -170,6 +170,7 @@ struct PackageConfig {\n   V(fd_string, \"fd\")                                                          \\\n   V(file_string, \"file\")                                                      \\\n   V(fingerprint_string, \"fingerprint\")                                        \\\n+  V(fingerprint256_string, \"fingerprint256\")                                  \\\n   V(flags_string, \"flags\")                                                    \\\n   V(get_data_clone_error_string, \"_getDataCloneError\")                        \\\n   V(get_shared_array_buffer_id_string, \"_getSharedArrayBufferId\")             \\"
        },
        {
            "sha": "202de9cf675be112ee0e3495651367314d3a23d8",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 29,
            "deletions": 18,
            "changes": 47,
            "blob_url": "https://github.com/nodejs/node/blob/7876aeb0fe01acf007401cfedf12709f834c927b/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/7876aeb0fe01acf007401cfedf12709f834c927b/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=7876aeb0fe01acf007401cfedf12709f834c927b",
            "patch": "@@ -1790,6 +1790,25 @@ static bool SafeX509ExtPrint(BIO* out, X509_EXTENSION* ext) {\n }\n \n \n+static void AddFingerprintDigest(const unsigned char* md,\n+                                 unsigned int md_size,\n+                                 char (*fingerprint)[3 * EVP_MAX_MD_SIZE + 1]) {\n+  unsigned int i;\n+  const char hex[] = \"0123456789ABCDEF\";\n+\n+  for (i = 0; i < md_size; i++) {\n+    (*fingerprint)[3*i] = hex[(md[i] & 0xf0) >> 4];\n+    (*fingerprint)[(3*i)+1] = hex[(md[i] & 0x0f)];\n+    (*fingerprint)[(3*i)+2] = ':';\n+  }\n+\n+  if (md_size > 0) {\n+    (*fingerprint)[(3*(md_size-1))+2] = '\\0';\n+  } else {\n+    (*fingerprint)[0] = '\\0';\n+  }\n+}\n+\n static Local<Object> X509ToObject(Environment* env, X509* cert) {\n   EscapableHandleScope scope(env->isolate());\n   Local<Context> context = env->context();\n@@ -1906,26 +1925,18 @@ static Local<Object> X509ToObject(Environment* env, X509* cert) {\n                                 mem->length)).FromJust();\n   BIO_free_all(bio);\n \n-  unsigned int md_size, i;\n   unsigned char md[EVP_MAX_MD_SIZE];\n+  unsigned int md_size;\n+  char fingerprint[EVP_MAX_MD_SIZE * 3 + 1];\n   if (X509_digest(cert, EVP_sha1(), md, &md_size)) {\n-    const char hex[] = \"0123456789ABCDEF\";\n-    char fingerprint[EVP_MAX_MD_SIZE * 3];\n-\n-    for (i = 0; i < md_size; i++) {\n-      fingerprint[3*i] = hex[(md[i] & 0xf0) >> 4];\n-      fingerprint[(3*i)+1] = hex[(md[i] & 0x0f)];\n-      fingerprint[(3*i)+2] = ':';\n-    }\n-\n-    if (md_size > 0) {\n-      fingerprint[(3*(md_size-1))+2] = '\\0';\n-    } else {\n-      fingerprint[0] = '\\0';\n-    }\n-\n-    info->Set(context, env->fingerprint_string(),\n-              OneByteString(env->isolate(), fingerprint)).FromJust();\n+      AddFingerprintDigest(md, md_size, &fingerprint);\n+      info->Set(context, env->fingerprint_string(),\n+                OneByteString(env->isolate(), fingerprint)).FromJust();\n+  }\n+  if (X509_digest(cert, EVP_sha256(), md, &md_size)) {\n+      AddFingerprintDigest(md, md_size, &fingerprint);\n+      info->Set(context, env->fingerprint256_string(),\n+                OneByteString(env->isolate(), fingerprint)).FromJust();\n   }\n \n   STACK_OF(ASN1_OBJECT)* eku = static_cast<STACK_OF(ASN1_OBJECT)*>("
        }
    ],
    "stats": {
        "total": 48,
        "additions": 30,
        "deletions": 18
    }
}