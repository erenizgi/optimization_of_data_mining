{
    "author": "cjihrig",
    "message": "dgram: make _createSocketHandle() internal only\n\n_createSocketHandle() is used internally by the cluster module.\nThis commit makes it internal only API.\n\nPR-URL: https://github.com/nodejs/node/pull/21923\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Wyatt Preul <wpreul@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "3f6ee7578103fc6f25a0711d2df98ebf39c6620d",
    "files": [
        {
            "sha": "a8de95111f8412336d1dcafb9c116da1f66d8896",
            "filename": "lib/dgram.js",
            "status": "modified",
            "additions": 5,
            "deletions": 60,
            "changes": 65,
            "blob_url": "https://github.com/nodejs/node/blob/3f6ee7578103fc6f25a0711d2df98ebf39c6620d/lib%2Fdgram.js",
            "raw_url": "https://github.com/nodejs/node/raw/3f6ee7578103fc6f25a0711d2df98ebf39c6620d/lib%2Fdgram.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fdgram.js?ref=3f6ee7578103fc6f25a0711d2df98ebf39c6620d",
            "patch": "@@ -21,16 +21,18 @@\n \n 'use strict';\n \n-const assert = require('assert');\n const errors = require('internal/errors');\n-const { kStateSymbol } = require('internal/dgram');\n+const {\n+  kStateSymbol,\n+  _createSocketHandle,\n+  newHandle\n+} = require('internal/dgram');\n const {\n   ERR_INVALID_ARG_TYPE,\n   ERR_MISSING_ARGS,\n   ERR_SOCKET_ALREADY_BOUND,\n   ERR_SOCKET_BAD_BUFFER_SIZE,\n   ERR_SOCKET_BAD_PORT,\n-  ERR_SOCKET_BAD_TYPE,\n   ERR_SOCKET_BUFFER_SIZE,\n   ERR_SOCKET_CANNOT_SEND,\n   ERR_SOCKET_DGRAM_NOT_RUNNING\n@@ -47,9 +49,6 @@ const { UV_UDP_REUSEADDR } = process.binding('constants').os;\n \n const { UDP, SendWrap } = process.binding('udp_wrap');\n \n-// Lazy load for startup performance.\n-let dns;\n-\n const BIND_STATE_UNBOUND = 0;\n const BIND_STATE_BINDING = 1;\n const BIND_STATE_BOUND = 2;\n@@ -64,59 +63,6 @@ const errnoException = errors.errnoException;\n const exceptionWithHostPort = errors.exceptionWithHostPort;\n \n \n-function lookup4(lookup, address, callback) {\n-  return lookup(address || '127.0.0.1', 4, callback);\n-}\n-\n-\n-function lookup6(lookup, address, callback) {\n-  return lookup(address || '::1', 6, callback);\n-}\n-\n-\n-function newHandle(type, lookup) {\n-  if (lookup === undefined) {\n-    if (dns === undefined) dns = require('dns');\n-    lookup = dns.lookup;\n-  } else if (typeof lookup !== 'function')\n-    throw new ERR_INVALID_ARG_TYPE('lookup', 'Function', lookup);\n-\n-  if (type === 'udp4') {\n-    const handle = new UDP();\n-    handle.lookup = lookup4.bind(handle, lookup);\n-    return handle;\n-  }\n-\n-  if (type === 'udp6') {\n-    const handle = new UDP();\n-    handle.lookup = lookup6.bind(handle, lookup);\n-    handle.bind = handle.bind6;\n-    handle.send = handle.send6;\n-    return handle;\n-  }\n-\n-  throw new ERR_SOCKET_BAD_TYPE();\n-}\n-\n-\n-function _createSocketHandle(address, port, addressType, fd, flags) {\n-  // Opening an existing fd is not supported for UDP handles.\n-  assert(typeof fd !== 'number' || fd < 0);\n-\n-  var handle = newHandle(addressType);\n-\n-  if (port || address) {\n-    var err = handle.bind(address, port || 0, flags);\n-    if (err) {\n-      handle.close();\n-      return err;\n-    }\n-  }\n-\n-  return handle;\n-}\n-\n-\n function Socket(type, listener) {\n   EventEmitter.call(this);\n   var lookup;\n@@ -739,7 +685,6 @@ Socket.prototype.getSendBufferSize = function() {\n \n \n module.exports = {\n-  _createSocketHandle,\n   createSocket,\n   Socket\n };"
        },
        {
            "sha": "0bb8c44f5d630bfad39d50b11688b9c73ffb56d0",
            "filename": "lib/internal/cluster/shared_handle.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/3f6ee7578103fc6f25a0711d2df98ebf39c6620d/lib%2Finternal%2Fcluster%2Fshared_handle.js",
            "raw_url": "https://github.com/nodejs/node/raw/3f6ee7578103fc6f25a0711d2df98ebf39c6620d/lib%2Finternal%2Fcluster%2Fshared_handle.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcluster%2Fshared_handle.js?ref=3f6ee7578103fc6f25a0711d2df98ebf39c6620d",
            "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n const assert = require('assert');\n-const dgram = require('dgram');\n+const dgram = require('internal/dgram');\n const net = require('net');\n \n module.exports = SharedHandle;"
        },
        {
            "sha": "82b65294c21da5f816a9000661ce42ec6953a95e",
            "filename": "lib/internal/dgram.js",
            "status": "modified",
            "additions": 67,
            "deletions": 1,
            "changes": 68,
            "blob_url": "https://github.com/nodejs/node/blob/3f6ee7578103fc6f25a0711d2df98ebf39c6620d/lib%2Finternal%2Fdgram.js",
            "raw_url": "https://github.com/nodejs/node/raw/3f6ee7578103fc6f25a0711d2df98ebf39c6620d/lib%2Finternal%2Fdgram.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fdgram.js?ref=3f6ee7578103fc6f25a0711d2df98ebf39c6620d",
            "patch": "@@ -1,4 +1,70 @@\n 'use strict';\n+const assert = require('assert');\n+const { codes } = require('internal/errors');\n+const { UDP } = process.binding('udp_wrap');\n+const { ERR_INVALID_ARG_TYPE, ERR_SOCKET_BAD_TYPE } = codes;\n const kStateSymbol = Symbol('state symbol');\n+let dns;  // Lazy load for startup performance.\n \n-module.exports = { kStateSymbol };\n+\n+function lookup4(lookup, address, callback) {\n+  return lookup(address || '127.0.0.1', 4, callback);\n+}\n+\n+\n+function lookup6(lookup, address, callback) {\n+  return lookup(address || '::1', 6, callback);\n+}\n+\n+\n+function newHandle(type, lookup) {\n+  if (lookup === undefined) {\n+    if (dns === undefined) {\n+      dns = require('dns');\n+    }\n+\n+    lookup = dns.lookup;\n+  } else if (typeof lookup !== 'function') {\n+    throw new ERR_INVALID_ARG_TYPE('lookup', 'Function', lookup);\n+  }\n+\n+  if (type === 'udp4') {\n+    const handle = new UDP();\n+\n+    handle.lookup = lookup4.bind(handle, lookup);\n+    return handle;\n+  }\n+\n+  if (type === 'udp6') {\n+    const handle = new UDP();\n+\n+    handle.lookup = lookup6.bind(handle, lookup);\n+    handle.bind = handle.bind6;\n+    handle.send = handle.send6;\n+    return handle;\n+  }\n+\n+  throw new ERR_SOCKET_BAD_TYPE();\n+}\n+\n+\n+function _createSocketHandle(address, port, addressType, fd, flags) {\n+  // Opening an existing fd is not supported for UDP handles.\n+  assert(typeof fd !== 'number' || fd < 0);\n+\n+  const handle = newHandle(addressType);\n+\n+  if (port || address) {\n+    const err = handle.bind(address, port || 0, flags);\n+\n+    if (err) {\n+      handle.close();\n+      return err;\n+    }\n+  }\n+\n+  return handle;\n+}\n+\n+\n+module.exports = { kStateSymbol, _createSocketHandle, newHandle };"
        },
        {
            "sha": "e49e3e8dd6c4b45ccf4a09722a8dafb2180cd488",
            "filename": "test/parallel/test-dgram-create-socket-handle.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/3f6ee7578103fc6f25a0711d2df98ebf39c6620d/test%2Fparallel%2Ftest-dgram-create-socket-handle.js",
            "raw_url": "https://github.com/nodejs/node/raw/3f6ee7578103fc6f25a0711d2df98ebf39c6620d/test%2Fparallel%2Ftest-dgram-create-socket-handle.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-dgram-create-socket-handle.js?ref=3f6ee7578103fc6f25a0711d2df98ebf39c6620d",
            "patch": "@@ -1,9 +1,9 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n-const dgram = require('dgram');\n+const { _createSocketHandle } = require('internal/dgram');\n const UDP = process.binding('udp_wrap').UDP;\n-const _createSocketHandle = dgram._createSocketHandle;\n \n // Throws if an \"existing fd\" is passed in.\n common.expectsError(() => {"
        }
    ],
    "stats": {
        "total": 139,
        "additions": 75,
        "deletions": 64
    }
}