{
    "author": "jasnell",
    "message": "src: move *Exceptions out to separate cc/h\n\nPR-URL: https://github.com/nodejs/node/pull/20789\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "9349e15daa803fc626581802fa827afe8d00340e",
    "files": [
        {
            "sha": "927ad56a3e0aa45deb2f63fc92d08fa3b71c39ba",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/9349e15daa803fc626581802fa827afe8d00340e/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/9349e15daa803fc626581802fa827afe8d00340e/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=9349e15daa803fc626581802fa827afe8d00340e",
            "patch": "@@ -309,6 +309,7 @@\n         'src/connection_wrap.cc',\n         'src/connect_wrap.cc',\n         'src/env.cc',\n+        'src/exceptions.cc',\n         'src/fs_event_wrap.cc',\n         'src/handle_wrap.cc',\n         'src/js_stream.cc',\n@@ -371,6 +372,7 @@\n         'src/connect_wrap.h',\n         'src/env.h',\n         'src/env-inl.h',\n+        'src/exceptions.h',\n         'src/handle_wrap.h',\n         'src/js_stream.h',\n         'src/module_wrap.h',"
        },
        {
            "sha": "7f199aaea228d4efad2e3f1bf1a2d9382c5170e9",
            "filename": "src/callback_scope.h",
            "status": "modified",
            "additions": 1,
            "deletions": 10,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/9349e15daa803fc626581802fa827afe8d00340e/src%2Fcallback_scope.h",
            "raw_url": "https://github.com/nodejs/node/raw/9349e15daa803fc626581802fa827afe8d00340e/src%2Fcallback_scope.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fcallback_scope.h?ref=9349e15daa803fc626581802fa827afe8d00340e",
            "patch": "@@ -1,16 +1,7 @@\n #ifndef SRC_CALLBACK_SCOPE_H_\n #define SRC_CALLBACK_SCOPE_H_\n \n-#ifdef _WIN32\n-# ifndef BUILDING_NODE_EXTENSION\n-#   define NODE_EXTERN __declspec(dllexport)\n-# else\n-#   define NODE_EXTERN __declspec(dllimport)\n-# endif\n-#else\n-# define NODE_EXTERN /* nothing */\n-#endif\n-\n+#include \"core.h\"\n #include \"v8.h\"\n \n namespace node {"
        },
        {
            "sha": "0dbce4f3f8f6f9d264f711dee1883313641bae10",
            "filename": "src/core.h",
            "status": "added",
            "additions": 44,
            "deletions": 0,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/9349e15daa803fc626581802fa827afe8d00340e/src%2Fcore.h",
            "raw_url": "https://github.com/nodejs/node/raw/9349e15daa803fc626581802fa827afe8d00340e/src%2Fcore.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fcore.h?ref=9349e15daa803fc626581802fa827afe8d00340e",
            "patch": "@@ -0,0 +1,44 @@\n+#ifndef SRC_CORE_H_\n+#define SRC_CORE_H_\n+\n+#ifdef _WIN32\n+# ifndef BUILDING_NODE_EXTENSION\n+#   define NODE_EXTERN __declspec(dllexport)\n+# else\n+#   define NODE_EXTERN __declspec(dllimport)\n+# endif\n+#else\n+# define NODE_EXTERN /* nothing */\n+#endif\n+\n+#define NODE_MAKE_VERSION(major, minor, patch)                                \\\n+  ((major) * 0x1000 + (minor) * 0x100 + (patch))\n+\n+#ifdef __clang__\n+# define NODE_CLANG_AT_LEAST(major, minor, patch)                             \\\n+  (NODE_MAKE_VERSION(major, minor, patch) <=                                  \\\n+      NODE_MAKE_VERSION(__clang_major__, __clang_minor__, __clang_patchlevel__))\n+#else\n+# define NODE_CLANG_AT_LEAST(major, minor, patch) (0)\n+#endif\n+\n+#ifdef __GNUC__\n+# define NODE_GNUC_AT_LEAST(major, minor, patch)                              \\\n+  (NODE_MAKE_VERSION(major, minor, patch) <=                                  \\\n+      NODE_MAKE_VERSION(__GNUC__, __GNUC_MINOR__, __GNUC_PATCHLEVEL__))\n+#else\n+# define NODE_GNUC_AT_LEAST(major, minor, patch) (0)\n+#endif\n+\n+#if NODE_CLANG_AT_LEAST(2, 9, 0) || NODE_GNUC_AT_LEAST(4, 5, 0)\n+# define NODE_DEPRECATED(message, declarator)                                 \\\n+    __attribute__((deprecated(message))) declarator\n+#elif defined(_MSC_VER)\n+# define NODE_DEPRECATED(message, declarator)                                 \\\n+    __declspec(deprecated) declarator\n+#else\n+# define NODE_DEPRECATED(message, declarator)                                 \\\n+    declarator\n+#endif\n+\n+#endif  // SRC_CORE_H_"
        },
        {
            "sha": "3068483bdf58ffe7f9065dfae6825b114eaa7e02",
            "filename": "src/exceptions.cc",
            "status": "added",
            "additions": 215,
            "deletions": 0,
            "changes": 215,
            "blob_url": "https://github.com/nodejs/node/blob/9349e15daa803fc626581802fa827afe8d00340e/src%2Fexceptions.cc",
            "raw_url": "https://github.com/nodejs/node/raw/9349e15daa803fc626581802fa827afe8d00340e/src%2Fexceptions.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fexceptions.cc?ref=9349e15daa803fc626581802fa827afe8d00340e",
            "patch": "@@ -0,0 +1,215 @@\n+#include \"node.h\"\n+#include \"node_internals.h\"\n+#include \"env.h\"\n+#include \"env-inl.h\"\n+#include \"exceptions.h\"\n+#include \"util.h\"\n+#include \"util-inl.h\"\n+#include \"v8.h\"\n+#include \"uv.h\"\n+\n+#include <string.h>\n+\n+namespace node {\n+\n+using v8::Exception;\n+using v8::Integer;\n+using v8::Isolate;\n+using v8::Local;\n+using v8::Message;\n+using v8::Object;\n+using v8::String;\n+using v8::Value;\n+\n+Local<Value> ErrnoException(Isolate* isolate,\n+                            int errorno,\n+                            const char *syscall,\n+                            const char *msg,\n+                            const char *path) {\n+  Environment* env = Environment::GetCurrent(isolate);\n+\n+  Local<Value> e;\n+  Local<String> estring = OneByteString(env->isolate(), errno_string(errorno));\n+  if (msg == nullptr || msg[0] == '\\0') {\n+    msg = strerror(errorno);\n+  }\n+  Local<String> message = OneByteString(env->isolate(), msg);\n+\n+  Local<String> cons =\n+      String::Concat(estring, FIXED_ONE_BYTE_STRING(env->isolate(), \", \"));\n+  cons = String::Concat(cons, message);\n+\n+  Local<String> path_string;\n+  if (path != nullptr) {\n+    // FIXME(bnoordhuis) It's questionable to interpret the file path as UTF-8.\n+    path_string = String::NewFromUtf8(env->isolate(), path);\n+  }\n+\n+  if (path_string.IsEmpty() == false) {\n+    cons = String::Concat(cons, FIXED_ONE_BYTE_STRING(env->isolate(), \" '\"));\n+    cons = String::Concat(cons, path_string);\n+    cons = String::Concat(cons, FIXED_ONE_BYTE_STRING(env->isolate(), \"'\"));\n+  }\n+  e = Exception::Error(cons);\n+\n+  Local<Object> obj = e.As<Object>();\n+  obj->Set(env->errno_string(), Integer::New(env->isolate(), errorno));\n+  obj->Set(env->code_string(), estring);\n+\n+  if (path_string.IsEmpty() == false) {\n+    obj->Set(env->path_string(), path_string);\n+  }\n+\n+  if (syscall != nullptr) {\n+    obj->Set(env->syscall_string(), OneByteString(env->isolate(), syscall));\n+  }\n+\n+  return e;\n+}\n+\n+static Local<String> StringFromPath(Isolate* isolate, const char* path) {\n+#ifdef _WIN32\n+  if (strncmp(path, \"\\\\\\\\?\\\\UNC\\\\\", 8) == 0) {\n+    return String::Concat(FIXED_ONE_BYTE_STRING(isolate, \"\\\\\\\\\"),\n+                          String::NewFromUtf8(isolate, path + 8));\n+  } else if (strncmp(path, \"\\\\\\\\?\\\\\", 4) == 0) {\n+    return String::NewFromUtf8(isolate, path + 4);\n+  }\n+#endif\n+\n+  return String::NewFromUtf8(isolate, path);\n+}\n+\n+\n+Local<Value> UVException(Isolate* isolate,\n+                         int errorno,\n+                         const char* syscall,\n+                         const char* msg,\n+                         const char* path) {\n+  return UVException(isolate, errorno, syscall, msg, path, nullptr);\n+}\n+\n+\n+Local<Value> UVException(Isolate* isolate,\n+                         int errorno,\n+                         const char* syscall,\n+                         const char* msg,\n+                         const char* path,\n+                         const char* dest) {\n+  Environment* env = Environment::GetCurrent(isolate);\n+\n+  if (!msg || !msg[0])\n+    msg = uv_strerror(errorno);\n+\n+  Local<String> js_code = OneByteString(isolate, uv_err_name(errorno));\n+  Local<String> js_syscall = OneByteString(isolate, syscall);\n+  Local<String> js_path;\n+  Local<String> js_dest;\n+\n+  Local<String> js_msg = js_code;\n+  js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \": \"));\n+  js_msg = String::Concat(js_msg, OneByteString(isolate, msg));\n+  js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \", \"));\n+  js_msg = String::Concat(js_msg, js_syscall);\n+\n+  if (path != nullptr) {\n+    js_path = StringFromPath(isolate, path);\n+\n+    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \" '\"));\n+    js_msg = String::Concat(js_msg, js_path);\n+    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n+  }\n+\n+  if (dest != nullptr) {\n+    js_dest = StringFromPath(isolate, dest);\n+\n+    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \" -> '\"));\n+    js_msg = String::Concat(js_msg, js_dest);\n+    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n+  }\n+\n+  Local<Object> e = Exception::Error(js_msg)->ToObject(isolate);\n+\n+  e->Set(env->errno_string(), Integer::New(isolate, errorno));\n+  e->Set(env->code_string(), js_code);\n+  e->Set(env->syscall_string(), js_syscall);\n+  if (!js_path.IsEmpty())\n+    e->Set(env->path_string(), js_path);\n+  if (!js_dest.IsEmpty())\n+    e->Set(env->dest_string(), js_dest);\n+\n+  return e;\n+}\n+\n+#ifdef _WIN32\n+// Does about the same as strerror(),\n+// but supports all windows error messages\n+static const char *winapi_strerror(const int errorno, bool* must_free) {\n+  char *errmsg = nullptr;\n+\n+  FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM |\n+      FORMAT_MESSAGE_IGNORE_INSERTS, nullptr, errorno,\n+      MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)&errmsg, 0, nullptr);\n+\n+  if (errmsg) {\n+    *must_free = true;\n+\n+    // Remove trailing newlines\n+    for (int i = strlen(errmsg) - 1;\n+        i >= 0 && (errmsg[i] == '\\n' || errmsg[i] == '\\r'); i--) {\n+      errmsg[i] = '\\0';\n+    }\n+\n+    return errmsg;\n+  } else {\n+    // FormatMessage failed\n+    *must_free = false;\n+    return \"Unknown error\";\n+  }\n+}\n+\n+\n+Local<Value> WinapiErrnoException(Isolate* isolate,\n+                                  int errorno,\n+                                  const char* syscall,\n+                                  const char* msg,\n+                                  const char* path) {\n+  Environment* env = Environment::GetCurrent(isolate);\n+  Local<Value> e;\n+  bool must_free = false;\n+  if (!msg || !msg[0]) {\n+    msg = winapi_strerror(errorno, &must_free);\n+  }\n+  Local<String> message = OneByteString(env->isolate(), msg);\n+\n+  if (path) {\n+    Local<String> cons1 =\n+        String::Concat(message, FIXED_ONE_BYTE_STRING(isolate, \" '\"));\n+    Local<String> cons2 =\n+        String::Concat(cons1, String::NewFromUtf8(isolate, path));\n+    Local<String> cons3 =\n+        String::Concat(cons2, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n+    e = Exception::Error(cons3);\n+  } else {\n+    e = Exception::Error(message);\n+  }\n+\n+  Local<Object> obj = e.As<Object>();\n+  obj->Set(env->errno_string(), Integer::New(isolate, errorno));\n+\n+  if (path != nullptr) {\n+    obj->Set(env->path_string(), String::NewFromUtf8(isolate, path));\n+  }\n+\n+  if (syscall != nullptr) {\n+    obj->Set(env->syscall_string(), OneByteString(isolate, syscall));\n+  }\n+\n+  if (must_free)\n+    LocalFree((HLOCAL)msg);\n+\n+  return e;\n+}\n+#endif\n+\n+}  // namespace node"
        },
        {
            "sha": "8a4a8ce99e876d56f2cc05bbe20dfda26e1dbd29",
            "filename": "src/exceptions.h",
            "status": "added",
            "additions": 76,
            "deletions": 0,
            "changes": 76,
            "blob_url": "https://github.com/nodejs/node/blob/9349e15daa803fc626581802fa827afe8d00340e/src%2Fexceptions.h",
            "raw_url": "https://github.com/nodejs/node/raw/9349e15daa803fc626581802fa827afe8d00340e/src%2Fexceptions.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fexceptions.h?ref=9349e15daa803fc626581802fa827afe8d00340e",
            "patch": "@@ -0,0 +1,76 @@\n+#ifndef SRC_EXCEPTIONS_H_\n+#define SRC_EXCEPTIONS_H_\n+\n+#include \"core.h\"\n+#include \"v8.h\"\n+\n+namespace node {\n+\n+NODE_EXTERN v8::Local<v8::Value> ErrnoException(v8::Isolate* isolate,\n+                                                int errorno,\n+                                                const char* syscall = nullptr,\n+                                                const char* message = nullptr,\n+                                                const char* path = nullptr);\n+NODE_EXTERN v8::Local<v8::Value> UVException(v8::Isolate* isolate,\n+                                             int errorno,\n+                                             const char* syscall = nullptr,\n+                                             const char* message = nullptr,\n+                                             const char* path = nullptr);\n+NODE_EXTERN v8::Local<v8::Value> UVException(v8::Isolate* isolate,\n+                                             int errorno,\n+                                             const char* syscall,\n+                                             const char* message,\n+                                             const char* path,\n+                                             const char* dest);\n+\n+NODE_DEPRECATED(\n+    \"Use ErrnoException(isolate, ...)\",\n+    inline v8::Local<v8::Value> ErrnoException(\n+        int errorno,\n+        const char* syscall = nullptr,\n+        const char* message = nullptr,\n+        const char* path = nullptr) {\n+  return ErrnoException(v8::Isolate::GetCurrent(),\n+                        errorno,\n+                        syscall,\n+                        message,\n+                        path);\n+})\n+\n+inline v8::Local<v8::Value> UVException(int errorno,\n+                                        const char* syscall = nullptr,\n+                                        const char* message = nullptr,\n+                                        const char* path = nullptr) {\n+  return UVException(v8::Isolate::GetCurrent(),\n+                     errorno,\n+                     syscall,\n+                     message,\n+                     path);\n+}\n+\n+#ifdef _WIN32\n+NODE_EXTERN v8::Local<v8::Value> WinapiErrnoException(\n+    v8::Isolate* isolate,\n+    int errorno,\n+    const char *syscall = nullptr,\n+    const char *msg = \"\",\n+    const char *path = nullptr);\n+\n+NODE_DEPRECATED(\n+    \"Use WinapiErrnoException(isolate, ...)\",\n+    inline v8::Local<v8::Value> WinapiErrnoException(\n+        int errorno,\n+        const char *syscall = nullptr,\n+        const char *msg = \"\",\n+        const char *path = nullptr) {\n+  return WinapiErrnoException(v8::Isolate::GetCurrent(),\n+                              errorno,\n+                              syscall,\n+                              msg,\n+                              path);\n+})\n+#endif\n+\n+}  // namespace node\n+\n+#endif  // SRC_EXCEPTIONS_H_"
        },
        {
            "sha": "531306357817046070088d873125e01eec558ee3",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 195,
            "changes": 195,
            "blob_url": "https://github.com/nodejs/node/blob/9349e15daa803fc626581802fa827afe8d00340e/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/9349e15daa803fc626581802fa827afe8d00340e/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=9349e15daa803fc626581802fa827afe8d00340e",
            "patch": "@@ -576,129 +576,6 @@ const char *signo_string(int signo) {\n   }\n }\n \n-\n-Local<Value> ErrnoException(Isolate* isolate,\n-                            int errorno,\n-                            const char *syscall,\n-                            const char *msg,\n-                            const char *path) {\n-  Environment* env = Environment::GetCurrent(isolate);\n-\n-  Local<Value> e;\n-  Local<String> estring = OneByteString(env->isolate(), errno_string(errorno));\n-  if (msg == nullptr || msg[0] == '\\0') {\n-    msg = strerror(errorno);\n-  }\n-  Local<String> message = OneByteString(env->isolate(), msg);\n-\n-  Local<String> cons =\n-      String::Concat(estring, FIXED_ONE_BYTE_STRING(env->isolate(), \", \"));\n-  cons = String::Concat(cons, message);\n-\n-  Local<String> path_string;\n-  if (path != nullptr) {\n-    // FIXME(bnoordhuis) It's questionable to interpret the file path as UTF-8.\n-    path_string = String::NewFromUtf8(env->isolate(), path);\n-  }\n-\n-  if (path_string.IsEmpty() == false) {\n-    cons = String::Concat(cons, FIXED_ONE_BYTE_STRING(env->isolate(), \" '\"));\n-    cons = String::Concat(cons, path_string);\n-    cons = String::Concat(cons, FIXED_ONE_BYTE_STRING(env->isolate(), \"'\"));\n-  }\n-  e = Exception::Error(cons);\n-\n-  Local<Object> obj = e.As<Object>();\n-  obj->Set(env->errno_string(), Integer::New(env->isolate(), errorno));\n-  obj->Set(env->code_string(), estring);\n-\n-  if (path_string.IsEmpty() == false) {\n-    obj->Set(env->path_string(), path_string);\n-  }\n-\n-  if (syscall != nullptr) {\n-    obj->Set(env->syscall_string(), OneByteString(env->isolate(), syscall));\n-  }\n-\n-  return e;\n-}\n-\n-\n-static Local<String> StringFromPath(Isolate* isolate, const char* path) {\n-#ifdef _WIN32\n-  if (strncmp(path, \"\\\\\\\\?\\\\UNC\\\\\", 8) == 0) {\n-    return String::Concat(FIXED_ONE_BYTE_STRING(isolate, \"\\\\\\\\\"),\n-                          String::NewFromUtf8(isolate, path + 8));\n-  } else if (strncmp(path, \"\\\\\\\\?\\\\\", 4) == 0) {\n-    return String::NewFromUtf8(isolate, path + 4);\n-  }\n-#endif\n-\n-  return String::NewFromUtf8(isolate, path);\n-}\n-\n-\n-Local<Value> UVException(Isolate* isolate,\n-                         int errorno,\n-                         const char* syscall,\n-                         const char* msg,\n-                         const char* path) {\n-  return UVException(isolate, errorno, syscall, msg, path, nullptr);\n-}\n-\n-\n-Local<Value> UVException(Isolate* isolate,\n-                         int errorno,\n-                         const char* syscall,\n-                         const char* msg,\n-                         const char* path,\n-                         const char* dest) {\n-  Environment* env = Environment::GetCurrent(isolate);\n-\n-  if (!msg || !msg[0])\n-    msg = uv_strerror(errorno);\n-\n-  Local<String> js_code = OneByteString(isolate, uv_err_name(errorno));\n-  Local<String> js_syscall = OneByteString(isolate, syscall);\n-  Local<String> js_path;\n-  Local<String> js_dest;\n-\n-  Local<String> js_msg = js_code;\n-  js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \": \"));\n-  js_msg = String::Concat(js_msg, OneByteString(isolate, msg));\n-  js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \", \"));\n-  js_msg = String::Concat(js_msg, js_syscall);\n-\n-  if (path != nullptr) {\n-    js_path = StringFromPath(isolate, path);\n-\n-    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \" '\"));\n-    js_msg = String::Concat(js_msg, js_path);\n-    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n-  }\n-\n-  if (dest != nullptr) {\n-    js_dest = StringFromPath(isolate, dest);\n-\n-    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \" -> '\"));\n-    js_msg = String::Concat(js_msg, js_dest);\n-    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n-  }\n-\n-  Local<Object> e = Exception::Error(js_msg)->ToObject(isolate);\n-\n-  e->Set(env->errno_string(), Integer::New(isolate, errorno));\n-  e->Set(env->code_string(), js_code);\n-  e->Set(env->syscall_string(), js_syscall);\n-  if (!js_path.IsEmpty())\n-    e->Set(env->path_string(), js_path);\n-  if (!js_dest.IsEmpty())\n-    e->Set(env->dest_string(), js_dest);\n-\n-  return e;\n-}\n-\n-\n // Look up environment variable unless running as setuid root.\n bool SafeGetenv(const char* key, std::string* text) {\n #if !defined(__CloudABI__) && !defined(_WIN32)\n@@ -720,78 +597,6 @@ bool SafeGetenv(const char* key, std::string* text) {\n }\n \n \n-#ifdef _WIN32\n-// Does about the same as strerror(),\n-// but supports all windows error messages\n-static const char *winapi_strerror(const int errorno, bool* must_free) {\n-  char *errmsg = nullptr;\n-\n-  FormatMessage(FORMAT_MESSAGE_ALLOCATE_BUFFER | FORMAT_MESSAGE_FROM_SYSTEM |\n-      FORMAT_MESSAGE_IGNORE_INSERTS, nullptr, errorno,\n-      MAKELANGID(LANG_NEUTRAL, SUBLANG_DEFAULT), (LPTSTR)&errmsg, 0, nullptr);\n-\n-  if (errmsg) {\n-    *must_free = true;\n-\n-    // Remove trailing newlines\n-    for (int i = strlen(errmsg) - 1;\n-        i >= 0 && (errmsg[i] == '\\n' || errmsg[i] == '\\r'); i--) {\n-      errmsg[i] = '\\0';\n-    }\n-\n-    return errmsg;\n-  } else {\n-    // FormatMessage failed\n-    *must_free = false;\n-    return \"Unknown error\";\n-  }\n-}\n-\n-\n-Local<Value> WinapiErrnoException(Isolate* isolate,\n-                                  int errorno,\n-                                  const char* syscall,\n-                                  const char* msg,\n-                                  const char* path) {\n-  Environment* env = Environment::GetCurrent(isolate);\n-  Local<Value> e;\n-  bool must_free = false;\n-  if (!msg || !msg[0]) {\n-    msg = winapi_strerror(errorno, &must_free);\n-  }\n-  Local<String> message = OneByteString(env->isolate(), msg);\n-\n-  if (path) {\n-    Local<String> cons1 =\n-        String::Concat(message, FIXED_ONE_BYTE_STRING(isolate, \" '\"));\n-    Local<String> cons2 =\n-        String::Concat(cons1, String::NewFromUtf8(isolate, path));\n-    Local<String> cons3 =\n-        String::Concat(cons2, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n-    e = Exception::Error(cons3);\n-  } else {\n-    e = Exception::Error(message);\n-  }\n-\n-  Local<Object> obj = e.As<Object>();\n-  obj->Set(env->errno_string(), Integer::New(isolate, errorno));\n-\n-  if (path != nullptr) {\n-    obj->Set(env->path_string(), String::NewFromUtf8(isolate, path));\n-  }\n-\n-  if (syscall != nullptr) {\n-    obj->Set(env->syscall_string(), OneByteString(isolate, syscall));\n-  }\n-\n-  if (must_free)\n-    LocalFree((HLOCAL)msg);\n-\n-  return e;\n-}\n-#endif\n-\n-\n void* ArrayBufferAllocator::Allocate(size_t size) {\n   if (zero_fill_field_ || zero_fill_all_buffers)\n     return UncheckedCalloc(size);"
        },
        {
            "sha": "d4b934645163f1b1f971a20af3d3f46015972eba",
            "filename": "src/node.h",
            "status": "modified",
            "additions": 2,
            "deletions": 101,
            "changes": 103,
            "blob_url": "https://github.com/nodejs/node/blob/9349e15daa803fc626581802fa827afe8d00340e/src%2Fnode.h",
            "raw_url": "https://github.com/nodejs/node/raw/9349e15daa803fc626581802fa827afe8d00340e/src%2Fnode.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.h?ref=9349e15daa803fc626581802fa827afe8d00340e",
            "patch": "@@ -22,16 +22,6 @@\n #ifndef SRC_NODE_H_\n #define SRC_NODE_H_\n \n-#ifdef _WIN32\n-# ifndef BUILDING_NODE_EXTENSION\n-#   define NODE_EXTERN __declspec(dllexport)\n-# else\n-#   define NODE_EXTERN __declspec(dllimport)\n-# endif\n-#else\n-# define NODE_EXTERN /* nothing */\n-#endif\n-\n #ifdef BUILDING_NODE_EXTENSION\n # undef BUILDING_V8_SHARED\n # undef BUILDING_UV_SHARED\n@@ -60,40 +50,12 @@\n # define SIGKILL         9\n #endif\n \n+#include \"core.h\"  // NOLINT(build/include_order)\n #include \"v8.h\"  // NOLINT(build/include_order)\n #include \"v8-platform.h\"  // NOLINT(build/include_order)\n #include \"node_version.h\"  // NODE_MODULE_VERSION\n #include \"callback_scope.h\"\n-\n-#define NODE_MAKE_VERSION(major, minor, patch)                                \\\n-  ((major) * 0x1000 + (minor) * 0x100 + (patch))\n-\n-#ifdef __clang__\n-# define NODE_CLANG_AT_LEAST(major, minor, patch)                             \\\n-  (NODE_MAKE_VERSION(major, minor, patch) <=                                  \\\n-      NODE_MAKE_VERSION(__clang_major__, __clang_minor__, __clang_patchlevel__))\n-#else\n-# define NODE_CLANG_AT_LEAST(major, minor, patch) (0)\n-#endif\n-\n-#ifdef __GNUC__\n-# define NODE_GNUC_AT_LEAST(major, minor, patch)                              \\\n-  (NODE_MAKE_VERSION(major, minor, patch) <=                                  \\\n-      NODE_MAKE_VERSION(__GNUC__, __GNUC_MINOR__, __GNUC_PATCHLEVEL__))\n-#else\n-# define NODE_GNUC_AT_LEAST(major, minor, patch) (0)\n-#endif\n-\n-#if NODE_CLANG_AT_LEAST(2, 9, 0) || NODE_GNUC_AT_LEAST(4, 5, 0)\n-# define NODE_DEPRECATED(message, declarator)                                 \\\n-    __attribute__((deprecated(message))) declarator\n-#elif defined(_MSC_VER)\n-# define NODE_DEPRECATED(message, declarator)                                 \\\n-    __declspec(deprecated) declarator\n-#else\n-# define NODE_DEPRECATED(message, declarator)                                 \\\n-    declarator\n-#endif\n+#include \"exceptions.h\"\n \n // Forward-declare libuv loop\n struct uv_loop_s;\n@@ -107,47 +69,6 @@ class TracingController;\n // terminally confused when it's done in node_internals.h\n namespace node {\n \n-NODE_EXTERN v8::Local<v8::Value> ErrnoException(v8::Isolate* isolate,\n-                                                int errorno,\n-                                                const char* syscall = nullptr,\n-                                                const char* message = nullptr,\n-                                                const char* path = nullptr);\n-NODE_EXTERN v8::Local<v8::Value> UVException(v8::Isolate* isolate,\n-                                             int errorno,\n-                                             const char* syscall = nullptr,\n-                                             const char* message = nullptr,\n-                                             const char* path = nullptr);\n-NODE_EXTERN v8::Local<v8::Value> UVException(v8::Isolate* isolate,\n-                                             int errorno,\n-                                             const char* syscall,\n-                                             const char* message,\n-                                             const char* path,\n-                                             const char* dest);\n-\n-NODE_DEPRECATED(\"Use ErrnoException(isolate, ...)\",\n-                inline v8::Local<v8::Value> ErrnoException(\n-      int errorno,\n-      const char* syscall = nullptr,\n-      const char* message = nullptr,\n-      const char* path = nullptr) {\n-  return ErrnoException(v8::Isolate::GetCurrent(),\n-                        errorno,\n-                        syscall,\n-                        message,\n-                        path);\n-})\n-\n-inline v8::Local<v8::Value> UVException(int errorno,\n-                                        const char* syscall = nullptr,\n-                                        const char* message = nullptr,\n-                                        const char* path = nullptr) {\n-  return UVException(v8::Isolate::GetCurrent(),\n-                     errorno,\n-                     syscall,\n-                     message,\n-                     path);\n-}\n-\n /*\n  * These methods need to be called in a HandleScope.\n  *\n@@ -452,26 +373,6 @@ NODE_DEPRECATED(\"Use DecodeWrite(isolate, ...)\",\n   return DecodeWrite(v8::Isolate::GetCurrent(), buf, buflen, val, encoding);\n })\n \n-#ifdef _WIN32\n-NODE_EXTERN v8::Local<v8::Value> WinapiErrnoException(\n-    v8::Isolate* isolate,\n-    int errorno,\n-    const char *syscall = nullptr,\n-    const char *msg = \"\",\n-    const char *path = nullptr);\n-\n-NODE_DEPRECATED(\"Use WinapiErrnoException(isolate, ...)\",\n-                inline v8::Local<v8::Value> WinapiErrnoException(int errorno,\n-    const char *syscall = nullptr,  const char *msg = \"\",\n-    const char *path = nullptr) {\n-  return WinapiErrnoException(v8::Isolate::GetCurrent(),\n-                              errorno,\n-                              syscall,\n-                              msg,\n-                              path);\n-})\n-#endif\n-\n const char *signo_string(int errorno);\n \n "
        }
    ],
    "stats": {
        "total": 646,
        "additions": 340,
        "deletions": 306
    }
}