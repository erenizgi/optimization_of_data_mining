{
    "author": "gireeshpunathil",
    "message": "test: exit sequence sanity tests\n\nExecute many module loads in worker in a loop\nwhile exiting from the main thread at arbitrary\nexecution points, and make sure that the workers\nquiesce without crashing.\n\n`worker_threads` are not necessarily the subject of\ntesting, those are used for easy simulation of\nmulti-thread scenarios.\n\nRefs: https://github.com/nodejs/node/issues/25007\nPR-URL: https://github.com/nodejs/node/pull/25083\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "c3fd50463f2d3b6be54ebf8b4dbb85157bc08c3f",
    "files": [
        {
            "sha": "172544f50aba79074d22f8a3ebfef8509f21f82e",
            "filename": "test/parallel/test-worker-cleanexit-with-moduleload.js",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/c3fd50463f2d3b6be54ebf8b4dbb85157bc08c3f/test%2Fparallel%2Ftest-worker-cleanexit-with-moduleload.js",
            "raw_url": "https://github.com/nodejs/node/raw/c3fd50463f2d3b6be54ebf8b4dbb85157bc08c3f/test%2Fparallel%2Ftest-worker-cleanexit-with-moduleload.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-cleanexit-with-moduleload.js?ref=c3fd50463f2d3b6be54ebf8b4dbb85157bc08c3f",
            "patch": "@@ -0,0 +1,24 @@\n+'use strict';\n+require('../common');\n+\n+// Harden the thread interactions on the exit path.\n+// Ensure workers are able to bail out safe at\n+// arbitrary execution points. By using a number of\n+// internal modules as load candidates, the expectation\n+// is that those will be at various control flow points\n+// preferrably in the C++ land.\n+\n+const { Worker } = require('worker_threads');\n+for (let i = 0; i < 10; i++) {\n+  new Worker(\"const modules = ['fs', 'assert', 'async_hooks',\" +\n+    \"'buffer', 'child_process', 'net', 'http', 'https', 'os',\" +\n+    \"'path', 'v8', 'vm'];\" +\n+    'modules.forEach((module) => {' +\n+    'const m = require(module);' +\n+    '});', { eval: true });\n+}\n+\n+// Allow workers to go live.\n+setTimeout(() => {\n+  process.exit(0);\n+}, 200);"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 24,
        "deletions": 0
    }
}