{
    "author": "bcoe",
    "message": "process: check env->EmitProcessEnvWarning() last\n\nCalling env->EmitProcessEnvWarning() prevents additional warnings\nfrom being set it should therefore be called only if a warning will\nemit.\n\nPR-URL: https://github.com/nodejs/node/pull/25575\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>",
    "sha": "0b50972e6cf4a135a1eadd14f3e731d8a14839f1",
    "files": [
        {
            "sha": "60582d7a31c804a6b242f2f61209cf5900bf9e11",
            "filename": "src/node_env_var.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/0b50972e6cf4a135a1eadd14f3e731d8a14839f1/src%2Fnode_env_var.cc",
            "raw_url": "https://github.com/nodejs/node/raw/0b50972e6cf4a135a1eadd14f3e731d8a14839f1/src%2Fnode_env_var.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_env_var.cc?ref=0b50972e6cf4a135a1eadd14f3e731d8a14839f1",
            "patch": "@@ -72,8 +72,12 @@ static void EnvSetter(Local<Name> property,\n                       Local<Value> value,\n                       const PropertyCallbackInfo<Value>& info) {\n   Environment* env = Environment::GetCurrent(info);\n-  if (env->options()->pending_deprecation && env->EmitProcessEnvWarning() &&\n-      !value->IsString() && !value->IsNumber() && !value->IsBoolean()) {\n+  // calling env->EmitProcessEnvWarning() sets a variable indicating that\n+  // warnings have been emitted. It should be called last after other\n+  // conditions leading to a warning have been met.\n+  if (env->options()->pending_deprecation && !value->IsString() &&\n+      !value->IsNumber() && !value->IsBoolean() &&\n+      env->EmitProcessEnvWarning()) {\n     if (ProcessEmitDeprecationWarning(\n             env,\n             \"Assigning any value other than a string, number, or boolean to a \""
        },
        {
            "sha": "0396d8ff68a47f5089d4baa777c5395164286f89",
            "filename": "test/parallel/test-process-env-deprecation.js",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/0b50972e6cf4a135a1eadd14f3e731d8a14839f1/test%2Fparallel%2Ftest-process-env-deprecation.js",
            "raw_url": "https://github.com/nodejs/node/raw/0b50972e6cf4a135a1eadd14f3e731d8a14839f1/test%2Fparallel%2Ftest-process-env-deprecation.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-env-deprecation.js?ref=0b50972e6cf4a135a1eadd14f3e731d8a14839f1",
            "patch": "@@ -12,5 +12,9 @@ common.expectWarning(\n   'DEP0104'\n );\n \n+// Make sure setting a valid environment variable doesn't\n+// result in warning being suppressed, see:\n+// https://github.com/nodejs/node/pull/25157\n+process.env.FOO = 'apple';\n process.env.ABC = undefined;\n assert.strictEqual(process.env.ABC, 'undefined');"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 10,
        "deletions": 2
    }
}