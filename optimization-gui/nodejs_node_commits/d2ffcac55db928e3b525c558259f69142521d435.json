{
    "author": "Trott",
    "message": "test: improve reliability in http2-session-timeout\n\nUse `setImmediate()` instead of `setTimeout()` to improve robustness of\ntest-http2-session-timeout.\n\nFixes: https://github.com/nodejs/node/issues/20628\n\nPR-URL: https://github.com/nodejs/node/pull/22026\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "d2ffcac55db928e3b525c558259f69142521d435",
    "files": [
        {
            "sha": "5c4f047b338e9c68dafc176f71e1d251161f4106",
            "filename": "test/sequential/test-http2-session-timeout.js",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/d2ffcac55db928e3b525c558259f69142521d435/test%2Fsequential%2Ftest-http2-session-timeout.js",
            "raw_url": "https://github.com/nodejs/node/raw/d2ffcac55db928e3b525c558259f69142521d435/test%2Fsequential%2Ftest-http2-session-timeout.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-http2-session-timeout.js?ref=d2ffcac55db928e3b525c558259f69142521d435",
            "patch": "@@ -3,13 +3,12 @@\n const common = require('../common');\n if (!common.hasCrypto)\n   common.skip('missing crypto');\n-const h2 = require('http2');\n+const http2 = require('http2');\n \n const serverTimeout = common.platformTimeout(200);\n-const callTimeout = common.platformTimeout(20);\n const mustNotCall = common.mustNotCall();\n \n-const server = h2.createServer();\n+const server = http2.createServer();\n server.timeout = serverTimeout;\n \n server.on('request', (req, res) => res.end());\n@@ -19,7 +18,7 @@ server.listen(0, common.mustCall(() => {\n   const port = server.address().port;\n \n   const url = `http://localhost:${port}`;\n-  const client = h2.connect(url);\n+  const client = http2.connect(url);\n   const startTime = process.hrtime();\n   makeReq();\n \n@@ -37,7 +36,7 @@ server.listen(0, common.mustCall(() => {\n       const diff = process.hrtime(startTime);\n       const milliseconds = (diff[0] * 1e3 + diff[1] / 1e6);\n       if (milliseconds < serverTimeout * 2) {\n-        setTimeout(makeReq, callTimeout);\n+        setImmediate(makeReq);\n       } else {\n         server.removeListener('timeout', mustNotCall);\n         server.close();"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 4,
        "deletions": 5
    }
}