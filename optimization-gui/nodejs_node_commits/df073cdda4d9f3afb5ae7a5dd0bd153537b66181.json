{
    "author": "cjihrig",
    "message": "tty: make process.binding('tty_wrap') internal\n\nPR-URL: https://github.com/nodejs/node/pull/22477\nRefs: https://github.com/nodejs/node/issues/22160\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
    "files": [
        {
            "sha": "d65e12cc78d60050332d6bd17f54ec5a8b6330b9",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -353,6 +353,7 @@\n         'http_parser',\n         'process_wrap',\n         'v8',\n+        'tty_wrap',\n         'stream_wrap',\n         'signal_wrap',\n         'crypto',"
        },
        {
            "sha": "6c46aaf34dc5aac0535ef71222415ddfe5746c37",
            "filename": "lib/internal/child_process.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Finternal%2Fchild_process.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Finternal%2Fchild_process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fchild_process.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -26,8 +26,8 @@ const { internalBinding } = require('internal/bootstrap/loaders');\n const { Process } = internalBinding('process_wrap');\n const { WriteWrap } = internalBinding('stream_wrap');\n const { Pipe, constants: PipeConstants } = process.binding('pipe_wrap');\n-const { TTY } = process.binding('tty_wrap');\n const { TCP } = internalBinding('tcp_wrap');\n+const { TTY } = internalBinding('tty_wrap');\n const { UDP } = process.binding('udp_wrap');\n const SocketList = require('internal/socket_list');\n const { owner_symbol } = require('internal/async_hooks').symbols;"
        },
        {
            "sha": "f4a1c4e7b89936216b768a3959e66182f4dffc3f",
            "filename": "lib/internal/dgram.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Finternal%2Fdgram.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Finternal%2Fdgram.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fdgram.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -1,9 +1,9 @@\n 'use strict';\n const { codes } = require('internal/errors');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n const { UDP } = process.binding('udp_wrap');\n const { isInt32 } = require('internal/validators');\n-const TTYWrap = process.binding('tty_wrap');\n-const { internalBinding } = require('internal/bootstrap/loaders');\n+const TTYWrap = internalBinding('tty_wrap');\n const { UV_EINVAL } = internalBinding('uv');\n const { ERR_INVALID_ARG_TYPE, ERR_SOCKET_BAD_TYPE } = codes;\n const kStateSymbol = Symbol('state symbol');"
        },
        {
            "sha": "57969324a99efdb7c74de0603b14d996937b6a57",
            "filename": "lib/internal/process/stdio.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Finternal%2Fprocess%2Fstdio.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Finternal%2Fprocess%2Fstdio.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fstdio.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -47,7 +47,8 @@ function getMainThreadStdio() {\n \n   function getStdin() {\n     if (stdin) return stdin;\n-    const tty_wrap = process.binding('tty_wrap');\n+    const { internalBinding } = require('internal/bootstrap/loaders');\n+    const tty_wrap = internalBinding('tty_wrap');\n     const fd = 0;\n \n     switch (tty_wrap.guessHandleType(fd)) {\n@@ -163,7 +164,8 @@ function setupProcessStdio({ getStdout, getStdin, getStderr }) {\n \n function createWritableStdioStream(fd) {\n   var stream;\n-  const tty_wrap = process.binding('tty_wrap');\n+  const { internalBinding } = require('internal/bootstrap/loaders');\n+  const tty_wrap = internalBinding('tty_wrap');\n \n   // Note stream._type is used for test-module-load-list.js\n "
        },
        {
            "sha": "c489353b660a3b28d09cd544ec586bd3d03cf89a",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -42,7 +42,7 @@ const {\n } = internalBinding('uv');\n \n const { Buffer } = require('buffer');\n-const TTYWrap = process.binding('tty_wrap');\n+const TTYWrap = internalBinding('tty_wrap');\n const { ShutdownWrap } = internalBinding('stream_wrap');\n const {\n   TCP,"
        },
        {
            "sha": "62eb8719b114b9a2fc5bf059ebb32f1a45b0b99a",
            "filename": "lib/tty.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Ftty.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/lib%2Ftty.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftty.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -23,7 +23,8 @@\n \n const { inherits, _extend } = require('util');\n const net = require('net');\n-const { TTY, isTTY } = process.binding('tty_wrap');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { TTY, isTTY } = internalBinding('tty_wrap');\n const errors = require('internal/errors');\n const {\n   ERR_INVALID_FD,"
        },
        {
            "sha": "f1cfa300f8f215d6599849cde471751d44ed7f04",
            "filename": "src/tty_wrap.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/src%2Ftty_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/src%2Ftty_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftty_wrap.cc?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -173,4 +173,4 @@ TTYWrap::TTYWrap(Environment* env,\n \n }  // namespace node\n \n-NODE_BUILTIN_MODULE_CONTEXT_AWARE(tty_wrap, node::TTYWrap::Initialize)\n+NODE_MODULE_CONTEXT_AWARE_INTERNAL(tty_wrap, node::TTYWrap::Initialize)"
        },
        {
            "sha": "4cb84e0f12ae91d3a92d0aac058d9dbd2bc0f473",
            "filename": "test/parallel/test-accessor-properties.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fparallel%2Ftest-accessor-properties.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fparallel%2Ftest-accessor-properties.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-accessor-properties.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --expose-internals\n 'use strict';\n \n require('../common');\n@@ -9,7 +10,8 @@ const assert = require('assert');\n \n // Objects that call StreamBase::AddMethods, when setting up\n // their prototype\n-const TTY = process.binding('tty_wrap').TTY;\n+const { internalBinding } = require('internal/test/binding');\n+const TTY = internalBinding('tty_wrap').TTY;\n const UDP = process.binding('udp_wrap').UDP;\n \n {"
        },
        {
            "sha": "d060a0cb84ce50ce3b9df49d3489f8552816269a",
            "filename": "test/parallel/test-stream-base-prototype-accessors-enumerability.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fparallel%2Ftest-stream-base-prototype-accessors-enumerability.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fparallel%2Ftest-stream-base-prototype-accessors-enumerability.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-base-prototype-accessors-enumerability.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --expose-internals\n 'use strict';\n \n require('../common');\n@@ -9,7 +10,8 @@ require('../common');\n const assert = require('assert');\n \n // Or anything that calls StreamBase::AddMethods when setting up its prototype\n-const TTY = process.binding('tty_wrap').TTY;\n+const { internalBinding } = require('internal/test/binding');\n+const TTY = internalBinding('tty_wrap').TTY;\n \n {\n   assert.strictEqual(TTY.prototype.propertyIsEnumerable('bytesRead'), false);"
        },
        {
            "sha": "7b6dc3c09257bf74e2c219f7ffae18a52c30f35c",
            "filename": "test/parallel/test-tty-backwards-api.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fparallel%2Ftest-tty-backwards-api.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fparallel%2Ftest-tty-backwards-api.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tty-backwards-api.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -1,8 +1,10 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n \n const noop = () => {};\n-const TTY = process.binding('tty_wrap').TTY = function() {};\n+const { internalBinding } = require('internal/test/binding');\n+const TTY = internalBinding('tty_wrap').TTY = function() {};\n \n TTY.prototype = {\n   setBlocking: noop,"
        },
        {
            "sha": "52761c140eddac60cf102a4f109e841e104fa550",
            "filename": "test/pseudo-tty/ref_keeps_node_running.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Fref_keeps_node_running.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Fref_keeps_node_running.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Fref_keeps_node_running.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -1,8 +1,10 @@\n+// Flags: --expose-internals --no-warnings\n 'use strict';\n \n require('../common');\n \n-const { TTY, isTTY } = process.binding('tty_wrap');\n+const { internalBinding } = require('internal/test/binding');\n+const { TTY, isTTY } = internalBinding('tty_wrap');\n const strictEqual = require('assert').strictEqual;\n \n strictEqual(isTTY(0), true, 'fd 0 is not a TTY');"
        },
        {
            "sha": "80ffe9e7cce303339fd03e7ae8d03ff377799dee",
            "filename": "test/pseudo-tty/test-async-wrap-getasyncid-tty.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Ftest-async-wrap-getasyncid-tty.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Ftest-async-wrap-getasyncid-tty.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-async-wrap-getasyncid-tty.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -5,9 +5,9 @@\n \n const common = require('../common');\n const assert = require('assert');\n-const tty_wrap = process.binding('tty_wrap');\n const { internalBinding } = require('internal/test/binding');\n const { TTYWRAP } = internalBinding('async_wrap').Providers;\n+const tty_wrap = internalBinding('tty_wrap');\n const providers = { TTYWRAP };\n \n // Make sure that the TTYWRAP Provider is tested."
        },
        {
            "sha": "3654d4a15f0a7c2025dc4b864f71d717a29682a5",
            "filename": "test/pseudo-tty/test-handle-wrap-isrefed-tty.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Ftest-handle-wrap-isrefed-tty.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Ftest-handle-wrap-isrefed-tty.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-handle-wrap-isrefed-tty.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --expose-internals --no-warnings\n 'use strict';\n \n // see also test/parallel/test-handle-wrap-isrefed.js\n@@ -6,7 +7,8 @@ const common = require('../common');\n const strictEqual = require('assert').strictEqual;\n const ReadStream = require('tty').ReadStream;\n const tty = new ReadStream(0);\n-const isTTY = process.binding('tty_wrap').isTTY;\n+const { internalBinding } = require('internal/test/binding');\n+const isTTY = internalBinding('tty_wrap').isTTY;\n strictEqual(isTTY(0), true, 'tty_wrap: stdin is not a TTY');\n strictEqual(Object.getPrototypeOf(tty._handle).hasOwnProperty('hasRef'),\n             true, 'tty_wrap: hasRef() missing');"
        },
        {
            "sha": "2a9891bd19e68edccffdaeaa4ba446f139810a3f",
            "filename": "test/pseudo-tty/test-tty-window-size.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Ftest-tty-window-size.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Ftest-tty-window-size.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-tty-window-size.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -1,8 +1,10 @@\n+// Flags: --expose-internals --no-warnings\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n const { WriteStream } = require('tty');\n-const { TTY } = process.binding('tty_wrap');\n+const { internalBinding } = require('internal/test/binding');\n+const { TTY } = internalBinding('tty_wrap');\n const getWindowSize = TTY.prototype.getWindowSize;\n \n function monkeyPatchGetWindowSize(fn) {"
        },
        {
            "sha": "917f04869ab5fe3fb8e0206a157b4bd98550279f",
            "filename": "test/pseudo-tty/test-tty-wrap.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Ftest-tty-wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/df073cdda4d9f3afb5ae7a5dd0bd153537b66181/test%2Fpseudo-tty%2Ftest-tty-wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-tty-wrap.js?ref=df073cdda4d9f3afb5ae7a5dd0bd153537b66181",
            "patch": "@@ -3,7 +3,7 @@\n require('../common');\n \n const { internalBinding } = require('internal/test/binding');\n-const { TTY } = process.binding('tty_wrap');\n+const { TTY } = internalBinding('tty_wrap');\n const { WriteWrap } = internalBinding('stream_wrap');\n \n const handle = new TTY(1);"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 32,
        "deletions": 16
    }
}