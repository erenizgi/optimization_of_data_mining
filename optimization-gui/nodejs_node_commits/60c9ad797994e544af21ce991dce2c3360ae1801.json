{
    "author": "BridgeAR",
    "message": "repl: remove deprecated NODE_REPL_HISTORY_FILE\n\nPR-URL: https://github.com/nodejs/node/pull/13876\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Gibson Fahnestock <gibfahn@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "60c9ad797994e544af21ce991dce2c3360ae1801",
    "files": [
        {
            "sha": "c0778aebadbd36730aa81f9d84ea5aab1e05f840",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/60c9ad797994e544af21ce991dce2c3360ae1801/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/60c9ad797994e544af21ce991dce2c3360ae1801/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=60c9ad797994e544af21ce991dce2c3360ae1801",
            "patch": "@@ -378,9 +378,10 @@ instead.\n <a id=\"DEP0041\"></a>\n ### DEP0041: NODE\\_REPL\\_HISTORY\\_FILE environment variable\n \n-Type: Documentation-only\n+Type: End-of-life\n \n-The `NODE_REPL_HISTORY_FILE` environment variable has been deprecated.\n+The `NODE_REPL_HISTORY_FILE` environment variable was removed. Please use\n+`NODE_REPL_HISTORY` instead.\n \n <a id=\"DEP0042\"></a>\n ### DEP0042: tls.CryptoStream"
        },
        {
            "sha": "182c0434c0340af664e35193ff3acd8ca36caf66",
            "filename": "doc/api/repl.md",
            "status": "modified",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/60c9ad797994e544af21ce991dce2c3360ae1801/doc%2Fapi%2Frepl.md",
            "raw_url": "https://github.com/nodejs/node/raw/60c9ad797994e544af21ce991dce2c3360ae1801/doc%2Fapi%2Frepl.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Frepl.md?ref=60c9ad797994e544af21ce991dce2c3360ae1801",
            "patch": "@@ -506,22 +506,6 @@ by saving inputs to a `.node_repl_history` file located in the user's home\n directory. This can be disabled by setting the environment variable\n `NODE_REPL_HISTORY=\"\"`.\n \n-#### NODE_REPL_HISTORY_FILE\n-<!-- YAML\n-added: v2.0.0\n-deprecated: v3.0.0\n--->\n-\n-> Stability: 0 - Deprecated: Use `NODE_REPL_HISTORY` instead.\n-\n-Previously in Node.js/io.js v2.x, REPL history was controlled by using a\n-`NODE_REPL_HISTORY_FILE` environment variable, and the history was saved in JSON\n-format. This variable has now been deprecated, and the old JSON REPL history\n-file will be automatically converted to a simplified plain text format. This new\n-file will be saved to either the user's home directory, or a directory defined\n-by the `NODE_REPL_HISTORY` variable, as documented in the\n-[Environment Variable Options](#repl_environment_variable_options).\n-\n ### Using the Node.js REPL with advanced line-editors\n \n For advanced line-editors, start Node.js with the environment variable"
        },
        {
            "sha": "a852f87bc889bf75465ea1f155bc4258f8d21546",
            "filename": "lib/internal/repl.js",
            "status": "modified",
            "additions": 7,
            "deletions": 51,
            "changes": 58,
            "blob_url": "https://github.com/nodejs/node/blob/60c9ad797994e544af21ce991dce2c3360ae1801/lib%2Finternal%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/60c9ad797994e544af21ce991dce2c3360ae1801/lib%2Finternal%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Frepl.js?ref=60c9ad797994e544af21ce991dce2c3360ae1801",
            "patch": "@@ -34,7 +34,7 @@ function createInternalRepl(env, opts, cb) {\n   if (parseInt(env.NODE_NO_READLINE)) {\n     opts.terminal = false;\n   }\n-  // the \"dumb\" special terminal, as defined by terminfo, doesn't support\n+  // The \"dumb\" special terminal, as defined by terminfo, doesn't support\n   // ANSI color control codes.\n   // see http://invisible-island.net/ncurses/terminfo.ti.html#toc-_Specials\n   if (parseInt(env.NODE_DISABLE_COLORS) || env.TERM === 'dumb') {\n@@ -61,17 +61,15 @@ function createInternalRepl(env, opts, cb) {\n \n   const repl = REPL.start(opts);\n   if (opts.terminal) {\n-    return setupHistory(repl, env.NODE_REPL_HISTORY,\n-                        env.NODE_REPL_HISTORY_FILE, cb);\n+    return setupHistory(repl, env.NODE_REPL_HISTORY, cb);\n   }\n \n   repl._historyPrev = _replHistoryMessage;\n   cb(null, repl);\n }\n \n-function setupHistory(repl, historyPath, oldHistoryPath, ready) {\n-  // Empty string disables persistent history.\n-\n+function setupHistory(repl, historyPath, ready) {\n+  // Empty string disables persistent history\n   if (typeof historyPath === 'string')\n     historyPath = historyPath.trim();\n \n@@ -131,50 +129,8 @@ function setupHistory(repl, historyPath, oldHistoryPath, ready) {\n \n     if (data) {\n       repl.history = data.split(/[\\n\\r]+/, repl.historySize);\n-    } else if (oldHistoryPath === historyPath) {\n-      // If pre-v3.0, the user had set NODE_REPL_HISTORY_FILE to\n-      // ~/.node_repl_history, warn the user about it and proceed.\n-      _writeToOutput(\n-        repl,\n-        '\\nThe old repl history file has the same name and location as ' +\n-          `the new one i.e., ${historyPath} and is empty.\\nUsing it as is.\\n`);\n-\n-    } else if (oldHistoryPath) {\n-      let threw = false;\n-      try {\n-        // Pre-v3.0, repl history was stored as JSON.\n-        // Try and convert it to line separated history.\n-        const oldReplJSONHistory = fs.readFileSync(oldHistoryPath, 'utf8');\n-\n-        // Only attempt to use the history if there was any.\n-        if (oldReplJSONHistory) repl.history = JSON.parse(oldReplJSONHistory);\n-\n-        if (Array.isArray(repl.history)) {\n-          repl.history = repl.history.slice(0, repl.historySize);\n-        } else {\n-          threw = true;\n-          _writeToOutput(\n-            repl,\n-            '\\nError: The old history file data has to be an Array.\\n' +\n-              'REPL session history will not be persisted.\\n');\n-        }\n-      } catch (err) {\n-        // Cannot open or parse history file.\n-        // Don't crash, just don't persist history.\n-        threw = true;\n-        const type = err instanceof SyntaxError ? 'parse' : 'open';\n-        _writeToOutput(repl, `\\nError: Could not ${type} old history file.\\n` +\n-                            'REPL session history will not be persisted.\\n');\n-      }\n-      if (!threw) {\n-        // Grab data from the older pre-v3.0 JSON NODE_REPL_HISTORY_FILE format.\n-        _writeToOutput(\n-          repl,\n-          '\\nConverted old JSON repl history to line-separated history.\\n' +\n-            `The new repl history file can be found at ${historyPath}.\\n`);\n-      } else {\n-        repl.history = [];\n-      }\n+    } else {\n+      repl.history = [];\n     }\n \n     fs.open(historyPath, 'r+', onhandle);\n@@ -188,7 +144,7 @@ function setupHistory(repl, historyPath, oldHistoryPath, ready) {\n       repl._historyHandle = hnd;\n       repl.on('line', online);\n \n-      // reading the file data out erases it\n+      // Reading the file data out erases it\n       repl.once('flushHistory', function() {\n         repl.resume();\n         ready(null, repl);"
        },
        {
            "sha": "963d93ddf379c09e40fc468a8632b5140caf340c",
            "filename": "test/fixtures/old-repl-history-file.json",
            "status": "removed",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/1a5f6705c611bc9376e8cd49ff2b03b08c3b97b0/test%2Ffixtures%2Fold-repl-history-file.json",
            "raw_url": "https://github.com/nodejs/node/raw/1a5f6705c611bc9376e8cd49ff2b03b08c3b97b0/test%2Ffixtures%2Fold-repl-history-file.json",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Fold-repl-history-file.json?ref=1a5f6705c611bc9376e8cd49ff2b03b08c3b97b0",
            "patch": "@@ -1,4 +0,0 @@\n-[\n-  \"'=^.^='\",\n-  \"'hello world'\"\n-]"
        },
        {
            "sha": "4d0330272ab3c6361fd8dc7c092a8ccdbe65f480",
            "filename": "test/parallel/test-repl-persistent-history.js",
            "status": "modified",
            "additions": 4,
            "deletions": 78,
            "changes": 82,
            "blob_url": "https://github.com/nodejs/node/blob/60c9ad797994e544af21ce991dce2c3360ae1801/test%2Fparallel%2Ftest-repl-persistent-history.js",
            "raw_url": "https://github.com/nodejs/node/raw/60c9ad797994e544af21ce991dce2c3360ae1801/test%2Fparallel%2Ftest-repl-persistent-history.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-persistent-history.js?ref=60c9ad797994e544af21ce991dce2c3360ae1801",
            "patch": "@@ -58,11 +58,6 @@ const CLEAR = { ctrl: true, name: 'u' };\n const historyFixturePath = fixtures.path('.node_repl_history');\n const historyPath = path.join(tmpdir.path, '.fixture_copy_repl_history');\n const historyPathFail = fixtures.path('nonexistent_folder', 'filename');\n-const oldHistoryPathObj = fixtures.path('old-repl-history-file-obj.json');\n-const oldHistoryPathFaulty = fixtures.path('old-repl-history-file-faulty.json');\n-const oldHistoryPath = fixtures.path('old-repl-history-file.json');\n-const enoentHistoryPath = fixtures.path('enoent-repl-history-file.json');\n-const emptyHistoryPath = fixtures.path('.empty-repl-history-file');\n const defaultHistoryPath = path.join(tmpdir.path, '.node_repl_history');\n const emptyHiddenHistoryPath = fixtures.path('.empty-hidden-repl-history-file');\n const devNullHistoryPath = path.join(tmpdir.path,\n@@ -72,23 +67,10 @@ const prompt = '> ';\n const replDisabled = '\\nPersistent history support disabled. Set the ' +\n                      'NODE_REPL_HISTORY environment\\nvariable to a valid, ' +\n                      'user-writable path to enable.\\n';\n-const convertMsg = '\\nConverted old JSON repl history to line-separated ' +\n-                   'history.\\nThe new repl history file can be found at ' +\n-                   `${defaultHistoryPath}.\\n`;\n const homedirErr = '\\nError: Could not get the home directory.\\n' +\n                    'REPL session history will not be persisted.\\n';\n const replFailedRead = '\\nError: Could not open history file.\\n' +\n                        'REPL session history will not be persisted.\\n';\n-const oldHistoryFailedOpen = '\\nError: Could not open old history file.\\n' +\n-                             'REPL session history will not be persisted.\\n';\n-const oldHistoryFailedParse = '\\nError: Could not parse old history file.\\n' +\n-                              'REPL session history will not be persisted.\\n';\n-const oldHistoryObj = '\\nError: The old history file data has to be an Array' +\n-                      '.\\nREPL session history will not be persisted.\\n';\n-const sameHistoryFilePaths = '\\nThe old repl history file has the same name ' +\n-                             'and location as the new one i.e., ' +\n-                             `${defaultHistoryPath}` +\n-                             ' and is empty.\\nUsing it as is.\\n';\n \n const tests = [\n   {\n@@ -101,84 +83,28 @@ const tests = [\n     test: [UP],\n     expected: [prompt, replDisabled, prompt]\n   },\n-  {\n-    env: { NODE_REPL_HISTORY_FILE: enoentHistoryPath },\n-    test: [UP],\n-    expected: [prompt, oldHistoryFailedOpen, prompt]\n-  },\n-  {\n-    env: { NODE_REPL_HISTORY_FILE: oldHistoryPathObj },\n-    test: [UP],\n-    expected: [prompt, oldHistoryObj, prompt]\n-  },\n-  {\n-    env: { NODE_REPL_HISTORY_FILE: oldHistoryPathFaulty },\n-    test: [UP],\n-    expected: [prompt, oldHistoryFailedParse, prompt]\n-  },\n-  {\n-    env: { NODE_REPL_HISTORY: '',\n-           NODE_REPL_HISTORY_FILE: oldHistoryPath },\n-    test: [UP],\n-    expected: [prompt, replDisabled, prompt]\n-  },\n-  {\n-    env: { NODE_REPL_HISTORY_FILE: emptyHistoryPath },\n-    test: [UP],\n-    expected: [prompt, convertMsg, prompt]\n-  },\n-  {\n-    env: { NODE_REPL_HISTORY_FILE: defaultHistoryPath },\n-    test: [UP],\n-    expected: [prompt, sameHistoryFilePaths, prompt]\n-  },\n   {\n     env: { NODE_REPL_HISTORY: historyPath },\n     test: [UP, CLEAR],\n     expected: [prompt, `${prompt}'you look fabulous today'`, prompt]\n   },\n-  {\n-    env: { NODE_REPL_HISTORY: historyPath,\n-           NODE_REPL_HISTORY_FILE: oldHistoryPath },\n-    test: [UP, CLEAR],\n-    expected: [prompt, `${prompt}'you look fabulous today'`, prompt]\n-  },\n-  {\n-    env: { NODE_REPL_HISTORY: historyPath,\n-           NODE_REPL_HISTORY_FILE: '' },\n-    test: [UP, CLEAR],\n-    expected: [prompt, `${prompt}'you look fabulous today'`, prompt]\n-  },\n   {\n     env: {},\n-    test: [UP],\n-    expected: [prompt]\n-  },\n-  {\n-    env: { NODE_REPL_HISTORY_FILE: oldHistoryPath },\n-    test: [UP, CLEAR, '\\'42\\'', ENTER],\n-    expected: [prompt, convertMsg, prompt, `${prompt}'=^.^='`, prompt, '\\'',\n-               '4', '2', '\\'', '\\'42\\'\\n', prompt, prompt],\n+    test: [UP, '\\'42\\'', ENTER],\n+    expected: [prompt, '\\'', '4', '2', '\\'', '\\'42\\'\\n', prompt, prompt],\n     clean: false\n   },\n-  { // Requires the above testcase\n+  { // Requires the above test case\n     env: {},\n     test: [UP, UP, ENTER],\n-    expected: [prompt, `${prompt}'42'`, `${prompt}'=^.^='`, '\\'=^.^=\\'\\n',\n-               prompt]\n+    expected: [prompt, `${prompt}'42'`, '\\'42\\'\\n', prompt]\n   },\n   {\n     env: { NODE_REPL_HISTORY: historyPath,\n            NODE_REPL_HISTORY_SIZE: 1 },\n     test: [UP, UP, CLEAR],\n     expected: [prompt, `${prompt}'you look fabulous today'`, prompt]\n   },\n-  {\n-    env: { NODE_REPL_HISTORY_FILE: oldHistoryPath,\n-           NODE_REPL_HISTORY_SIZE: 1 },\n-    test: [UP, UP, UP, CLEAR],\n-    expected: [prompt, convertMsg, prompt, `${prompt}'=^.^='`, prompt]\n-  },\n   {\n     env: { NODE_REPL_HISTORY: historyPathFail,\n            NODE_REPL_HISTORY_SIZE: 1 },"
        }
    ],
    "stats": {
        "total": 165,
        "additions": 14,
        "deletions": 151
    }
}