{
    "author": "Hackzzila",
    "message": "http,https,tls: switch to WHATWG URL parser\n\nThis switches the url parser from `url.parse()` to the WHATWG URL\nparser while keeping `url.parse()` as fallback.\n\nAlso add tests for invalid url deprecations and correct hostname\nchecks.\n\nPR-URL: https://github.com/nodejs/node/pull/20270\nFixes: https://github.com/nodejs/node/issues/19468\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Daijiro Wachi <daijiro.wachi@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "564048dc2984c45884e5eb58c903f9a0ebe29ab4",
    "files": [
        {
            "sha": "5d4a8714430171cd9b263cf4fa6291dd13bcd84f",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -994,6 +994,18 @@ because it also made sense to interpret the value as the number of bytes\n read by the engine, but is inconsistent with other streams in Node.js that\n expose values under these names.\n \n+<a id=\"DEP0109\"></a>\n+### DEP0109: http, https, and tls support for invalid URLs\n+\n+Type: Runtime\n+\n+Some previously supported (but strictly invalid) URLs were accepted through the\n+[`http.request()`][], [`http.get()`][], [`https.request()`][],\n+[`https.get()`][], and [`tls.checkServerIdentity()`][] APIs because those were\n+accepted by the legacy `url.parse()` API. The mentioned APIs now use the WHATWG\n+URL parser that requires strictly valid URLs. Passing an invalid URL is\n+deprecated and support will be removed in the future.\n+\n [`--pending-deprecation`]: cli.html#cli_pending_deprecation\n [`Buffer.allocUnsafeSlow(size)`]: buffer.html#buffer_class_method_buffer_allocunsafeslow_size\n [`Buffer.from(array)`]: buffer.html#buffer_class_method_buffer_from_array\n@@ -1035,6 +1047,10 @@ expose values under these names.\n [`fs.read()`]: fs.html#fs_fs_read_fd_buffer_offset_length_position_callback\n [`fs.readSync()`]: fs.html#fs_fs_readsync_fd_buffer_offset_length_position\n [`fs.stat()`]: fs.html#fs_fs_stat_path_callback\n+[`http.get()`]: http.html#http_http_get_options_callback\n+[`http.request()`]: http.html#http_http_request_options_callback\n+[`https.get()`]: https.html#https_https_get_options_callback\n+[`https.request()`]: https.html#https_https_request_options_callback\n [`os.networkInterfaces`]: os.html#os_os_networkinterfaces\n [`os.tmpdir()`]: os.html#os_os_tmpdir\n [`process.env`]: process.html#process_process_env\n@@ -1046,6 +1062,7 @@ expose values under these names.\n [`tls.SecureContext`]: tls.html#tls_tls_createsecurecontext_options\n [`tls.SecurePair`]: tls.html#tls_class_securepair\n [`tls.TLSSocket`]: tls.html#tls_class_tls_tlssocket\n+[`tls.checkServerIdentity()`]: tls.html#tls_tls_checkserveridentity_host_cert\n [`tls.createSecureContext()`]: tls.html#tls_tls_createsecurecontext_options\n [`util._extend()`]: util.html#util_util_extend_target_source\n [`util.debug()`]: util.html#util_util_debug_string"
        },
        {
            "sha": "b36cd241bce7450b52af8dd92bb3da3f55dbe6a9",
            "filename": "doc/api/errors.md",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/doc%2Fapi%2Ferrors.md",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/doc%2Fapi%2Ferrors.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ferrors.md?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -1111,11 +1111,6 @@ Invalid characters were detected in headers.\n A cursor on a given stream cannot be moved to a specified row without a\n specified column.\n \n-<a id=\"ERR_INVALID_DOMAIN_NAME\"></a>\n-### ERR_INVALID_DOMAIN_NAME\n-\n-`hostname` can not be parsed from a provided URL.\n-\n <a id=\"ERR_INVALID_FD\"></a>\n ### ERR_INVALID_FD\n "
        },
        {
            "sha": "f50199dfaf9d9c1566bc661ef8ac228901a84dcc",
            "filename": "doc/api/http.md",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/doc%2Fapi%2Fhttp.md",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/doc%2Fapi%2Fhttp.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttp.md?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -1900,7 +1900,7 @@ Node.js maintains several connections per server to make HTTP requests.\n This function allows one to transparently issue requests.\n \n `options` can be an object, a string, or a [`URL`][] object. If `options` is a\n-string, it is automatically parsed with [`url.parse()`][]. If it is a [`URL`][]\n+string, it is automatically parsed with [`new URL()`][]. If it is a [`URL`][]\n object, it will be automatically converted to an ordinary `options` object.\n \n The optional `callback` parameter will be added as a one-time listener for\n@@ -2050,6 +2050,7 @@ not abort the request or do anything besides add a `'timeout'` event.\n [`net.Server`]: net.html#net_class_net_server\n [`net.Socket`]: net.html#net_class_net_socket\n [`net.createConnection()`]: net.html#net_net_createconnection_options_connectlistener\n+[`new URL()`]: url.html#url_constructor_new_url_input_base\n [`removeHeader(name)`]: #http_request_removeheader_name\n [`request.end()`]: #http_request_end_data_encoding_callback\n [`request.getHeader()`]: #http_request_getheader_name"
        },
        {
            "sha": "89229ca621d683f7dfeb1a0d433841d122ddc7f1",
            "filename": "doc/api/https.md",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/doc%2Fapi%2Fhttps.md",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/doc%2Fapi%2Fhttps.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttps.md?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -119,7 +119,7 @@ changes:\n Like [`http.get()`][] but for HTTPS.\n \n `options` can be an object, a string, or a [`URL`][] object. If `options` is a\n-string, it is automatically parsed with [`url.parse()`][]. If it is a [`URL`][]\n+string, it is automatically parsed with [`new URL()`][]. If it is a [`URL`][]\n object, it will be automatically converted to an ordinary `options` object.\n \n Example:\n@@ -173,7 +173,7 @@ The following additional `options` from [`tls.connect()`][] are also accepted:\n `secureOptions`, `secureProtocol`, `servername`, `sessionIdContext`\n \n `options` can be an object, a string, or a [`URL`][] object. If `options` is a\n-string, it is automatically parsed with [`url.parse()`][]. If it is a [`URL`][]\n+string, it is automatically parsed with [`new URL()`][]. If it is a [`URL`][]\n object, it will be automatically converted to an ordinary `options` object.\n \n Example:\n@@ -358,8 +358,8 @@ headers: max-age=0; pin-sha256=\"WoiWRyIOVNa9ihaBciRSC7XHjliYS9VwUGOIud4PB18=\"; p\n [`https.Agent`]: #https_class_https_agent\n [`https.request()`]: #https_https_request_options_callback\n [`net.Server`]: net.html#net_class_net_server\n+[`new URL()`]: url.html#url_constructor_new_url_input_base\n [`server.listen()`]: net.html#net_server_listen\n [`tls.connect()`]: tls.html#tls_tls_connect_options_callback\n [`tls.createSecureContext()`]: tls.html#tls_tls_createsecurecontext_options\n [`tls.createServer()`]: tls.html#tls_tls_createserver_options_secureconnectionlistener\n-[`url.parse()`]: url.html#url_url_parse_urlstring_parsequerystring_slashesdenotehost"
        },
        {
            "sha": "1985c617bec537784081467bb75469dd6ce90d57",
            "filename": "lib/_http_client.js",
            "status": "modified",
            "additions": 17,
            "deletions": 5,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/lib%2F_http_client.js",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/lib%2F_http_client.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_client.js?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -37,12 +37,11 @@ const { OutgoingMessage } = require('_http_outgoing');\n const Agent = require('_http_agent');\n const { Buffer } = require('buffer');\n const { defaultTriggerAsyncIdScope } = require('internal/async_hooks');\n-const { urlToOptions, searchParamsSymbol } = require('internal/url');\n+const { URL, urlToOptions, searchParamsSymbol } = require('internal/url');\n const { outHeadersKey, ondrain } = require('internal/http');\n const {\n   ERR_HTTP_HEADERS_SENT,\n   ERR_INVALID_ARG_TYPE,\n-  ERR_INVALID_DOMAIN_NAME,\n   ERR_INVALID_HTTP_TOKEN,\n   ERR_INVALID_PROTOCOL,\n   ERR_UNESCAPED_CHARACTERS\n@@ -60,13 +59,26 @@ function validateHost(host, name) {\n   return host;\n }\n \n+let urlWarningEmitted = false;\n function ClientRequest(options, cb) {\n   OutgoingMessage.call(this);\n \n   if (typeof options === 'string') {\n-    options = url.parse(options);\n-    if (!options.hostname) {\n-      throw new ERR_INVALID_DOMAIN_NAME();\n+    const urlStr = options;\n+    try {\n+      options = urlToOptions(new URL(urlStr));\n+    } catch (err) {\n+      options = url.parse(urlStr);\n+      if (!options.hostname) {\n+        throw err;\n+      }\n+      if (!urlWarningEmitted && !process.noDeprecation) {\n+        urlWarningEmitted = true;\n+        process.emitWarning(\n+          `The provided URL ${urlStr} is not a valid URL, and is supported ` +\n+          'in the http module solely for compatibility.',\n+          'DeprecationWarning', 'DEP0109');\n+      }\n     }\n   } else if (options && options[searchParamsSymbol] &&\n              options[searchParamsSymbol][searchParamsSymbol]) {"
        },
        {
            "sha": "ead7a2bb927dad0ef1834f02c6ee0e80d9896fd6",
            "filename": "lib/https.js",
            "status": "modified",
            "additions": 17,
            "deletions": 5,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/lib%2Fhttps.js",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/lib%2Fhttps.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fhttps.js?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -34,8 +34,7 @@ const {\n const { ClientRequest } = require('_http_client');\n const { inherits } = util;\n const debug = util.debuglog('https');\n-const { urlToOptions, searchParamsSymbol } = require('internal/url');\n-const { ERR_INVALID_DOMAIN_NAME } = require('internal/errors').codes;\n+const { URL, urlToOptions, searchParamsSymbol } = require('internal/url');\n const { IncomingMessage, ServerResponse } = require('http');\n const { kIncomingMessage } = require('_http_common');\n const { kServerResponse } = require('_http_server');\n@@ -254,11 +253,24 @@ Agent.prototype._evictSession = function _evictSession(key) {\n \n const globalAgent = new Agent();\n \n+let urlWarningEmitted = false;\n function request(options, cb) {\n   if (typeof options === 'string') {\n-    options = url.parse(options);\n-    if (!options.hostname) {\n-      throw new ERR_INVALID_DOMAIN_NAME();\n+    const urlStr = options;\n+    try {\n+      options = urlToOptions(new URL(urlStr));\n+    } catch (err) {\n+      options = url.parse(urlStr);\n+      if (!options.hostname) {\n+        throw err;\n+      }\n+      if (!urlWarningEmitted && !process.noDeprecation) {\n+        urlWarningEmitted = true;\n+        process.emitWarning(\n+          `The provided URL ${urlStr} is not a valid URL, and is supported ` +\n+          'in the https module solely for compatibility.',\n+          'DeprecationWarning', 'DEP0109');\n+      }\n     }\n   } else if (options && options[searchParamsSymbol] &&\n              options[searchParamsSymbol][searchParamsSymbol]) {"
        },
        {
            "sha": "51acc211d9a1c764cfd76fb62f8988a3ecff2a8c",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -881,7 +881,6 @@ E('ERR_INVALID_CALLBACK', 'Callback must be a function', TypeError);\n E('ERR_INVALID_CHAR', invalidChar, TypeError);\n E('ERR_INVALID_CURSOR_POS',\n   'Cannot set cursor row without setting its column', TypeError);\n-E('ERR_INVALID_DOMAIN_NAME', 'Unable to determine the domain name', TypeError);\n E('ERR_INVALID_FD',\n   '\"fd\" must be a positive integer: %s', RangeError);\n E('ERR_INVALID_FD_TYPE', 'Unsupported fd type: %s', TypeError);"
        },
        {
            "sha": "28cd302674b04c01ccbdfd947781b8ac35c21767",
            "filename": "lib/tls.js",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/lib%2Ftls.js",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/lib%2Ftls.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftls.js?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -32,6 +32,7 @@ const url = require('url');\n const binding = process.binding('crypto');\n const { Buffer } = require('buffer');\n const EventEmitter = require('events');\n+const { URL } = require('internal/url');\n const DuplexPair = require('internal/streams/duplexpair');\n const { canonicalizeIP } = process.binding('cares_wrap');\n const _tls_common = require('_tls_common');\n@@ -169,6 +170,7 @@ function check(hostParts, pattern, wildcards) {\n   return true;\n }\n \n+let urlWarningEmitted = false;\n exports.checkServerIdentity = function checkServerIdentity(host, cert) {\n   const subject = cert.subject;\n   const altNames = cert.subjectaltname;\n@@ -183,7 +185,21 @@ exports.checkServerIdentity = function checkServerIdentity(host, cert) {\n       if (name.startsWith('DNS:')) {\n         dnsNames.push(name.slice(4));\n       } else if (name.startsWith('URI:')) {\n-        const uri = url.parse(name.slice(4));\n+        let uri;\n+        try {\n+          uri = new URL(name.slice(4));\n+        } catch (err) {\n+          uri = url.parse(name.slice(4));\n+          if (!urlWarningEmitted && !process.noDeprecation) {\n+            urlWarningEmitted = true;\n+            process.emitWarning(\n+              `The URI ${name.slice(4)} found in cert.subjectaltname ` +\n+              'is not a valid URI, and is supported in the tls module ' +\n+              'solely for compatibility.',\n+              'DeprecationWarning', 'DEP0109');\n+          }\n+        }\n+\n         uriNames.push(uri.hostname);  // TODO(bnoordhuis) Also use scheme.\n       } else if (name.startsWith('IP Address:')) {\n         ips.push(canonicalizeIP(name.slice(11)));"
        },
        {
            "sha": "b4279c1da4339f7a475ccee478784c66408b462e",
            "filename": "test/parallel/test-http-correct-hostname.js",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-http-correct-hostname.js",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-http-correct-hostname.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-correct-hostname.js?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -0,0 +1,28 @@\n+/* eslint-disable node-core/crypto-check */\n+// Flags: --expose-internals\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+\n+const { outHeadersKey } = require('internal/http');\n+\n+const http = require('http');\n+const modules = { http };\n+\n+if (common.hasCrypto) {\n+  const https = require('https');\n+  modules.https = https;\n+}\n+\n+Object.keys(modules).forEach((module) => {\n+  const doNotCall = common.mustNotCall(\n+    `${module}.request should not connect to ${module}://example.com%60x.example.com`\n+  );\n+  const req = modules[module].request(`${module}://example.com%60x.example.com`, doNotCall);\n+  assert.deepStrictEqual(req[outHeadersKey].host, [\n+    'Host',\n+    'example.com`x.example.com',\n+  ]);\n+  req.abort();\n+});"
        },
        {
            "sha": "5bb9f66ebe71267a1f551656a8d20624ab6d2133",
            "filename": "test/parallel/test-http-deprecated-urls.js",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-http-deprecated-urls.js",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-http-deprecated-urls.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-deprecated-urls.js?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -0,0 +1,33 @@\n+/* eslint-disable node-core/crypto-check */\n+\n+'use strict';\n+\n+const common = require('../common');\n+\n+const http = require('http');\n+const modules = { http };\n+\n+const deprecations = [\n+  ['The provided URL http://[www.nodejs.org] is not a valid URL, and is supported ' +\n+  'in the http module solely for compatibility.',\n+   'DEP0109'],\n+];\n+\n+if (common.hasCrypto) {\n+  const https = require('https');\n+  modules.https = https;\n+  deprecations.push(\n+    ['The provided URL https://[www.nodejs.org] is not a valid URL, and is supported ' +\n+    'in the https module solely for compatibility.',\n+     'DEP0109'],\n+  );\n+}\n+\n+common.expectWarning('DeprecationWarning', deprecations);\n+\n+Object.keys(modules).forEach((module) => {\n+  const doNotCall = common.mustNotCall(\n+    `${module}.request should not connect to ${module}://[www.nodejs.org]`\n+  );\n+  modules[module].request(`${module}://[www.nodejs.org]`, doNotCall).abort();\n+});"
        },
        {
            "sha": "7c9f67c47348100dfd0c8c2397f07ef4e7a9d031",
            "filename": "test/parallel/test-http-invalid-urls.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-http-invalid-urls.js",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-http-invalid-urls.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-invalid-urls.js?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -21,7 +21,7 @@ function test(host) {\n       const throws = () => { modules[module][fn](host, doNotCall); };\n       common.expectsError(throws, {\n         type: TypeError,\n-        code: 'ERR_INVALID_DOMAIN_NAME'\n+        code: 'ERR_INVALID_URL'\n       });\n     });\n   });"
        },
        {
            "sha": "f3ca3c99ac87af41a03ebad615013f0691c22d62",
            "filename": "test/parallel/test-internal-errors.js",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-internal-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-internal-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-internal-errors.js?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -148,11 +148,6 @@ assert.strictEqual(\n   'Cannot render headers after they are sent to the client'\n );\n \n-assert.strictEqual(\n-  errors.message('ERR_INVALID_DOMAIN_NAME'),\n-  'Unable to determine the domain name'\n-);\n-\n assert.strictEqual(\n   errors.message('ERR_INVALID_HTTP_TOKEN', ['Method', 'foo']),\n   'Method must be a valid HTTP token [\"foo\"]'"
        },
        {
            "sha": "fe27770c1ebc848d6097bbd0eb518b9c2859e0cc",
            "filename": "test/parallel/test-tls-check-server-identity.js",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-tls-check-server-identity.js",
            "raw_url": "https://github.com/nodejs/node/raw/564048dc2984c45884e5eb58c903f9a0ebe29ab4/test%2Fparallel%2Ftest-tls-check-server-identity.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-check-server-identity.js?ref=564048dc2984c45884e5eb58c903f9a0ebe29ab4",
            "patch": "@@ -30,6 +30,13 @@ const util = require('util');\n \n const tls = require('tls');\n \n+common.expectWarning('DeprecationWarning', [\n+  ['The URI http://[a.b.a.com]/ found in cert.subjectaltname ' +\n+  'is not a valid URI, and is supported in the tls module ' +\n+  'solely for compatibility.',\n+   'DEP0109'],\n+]);\n+\n const tests = [\n   // False-y values.\n   {\n@@ -218,6 +225,13 @@ const tests = [\n     error: 'Host: a.b.a.com. is not in the cert\\'s altnames: ' +\n            'URI:http://*.b.a.com/'\n   },\n+  // Invalid URI\n+  {\n+    host: 'a.b.a.com', cert: {\n+      subjectaltname: 'URI:http://[a.b.a.com]/',\n+      subject: {}\n+    }\n+  },\n   // IP addresses\n   {\n     host: 'a.b.a.com', cert: {"
        }
    ],
    "stats": {
        "total": 176,
        "additions": 149,
        "deletions": 27
    }
}