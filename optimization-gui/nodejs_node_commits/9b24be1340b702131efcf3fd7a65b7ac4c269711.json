{
    "author": "danbev",
    "message": "stream: refactor getHighWaterMark in state.js\n\nThis commit aims to reduce some code duplication in state.js\n\nPR-URL: https://github.com/nodejs/node/pull/20415\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "9b24be1340b702131efcf3fd7a65b7ac4c269711",
    "files": [
        {
            "sha": "c54c8230c7222713127d57491d10b180ce5bf8c5",
            "filename": "lib/internal/streams/state.js",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/9b24be1340b702131efcf3fd7a65b7ac4c269711/lib%2Finternal%2Fstreams%2Fstate.js",
            "raw_url": "https://github.com/nodejs/node/raw/9b24be1340b702131efcf3fd7a65b7ac4c269711/lib%2Finternal%2Fstreams%2Fstate.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fstreams%2Fstate.js?ref=9b24be1340b702131efcf3fd7a65b7ac4c269711",
            "patch": "@@ -2,19 +2,19 @@\n \n const { ERR_INVALID_OPT_VALUE } = require('internal/errors').codes;\n \n+function highWaterMarkFrom(options, isDuplex, duplexKey) {\n+  return options.highWaterMark != null ? options.highWaterMark :\n+    isDuplex ? options[duplexKey] : null;\n+}\n+\n function getHighWaterMark(state, options, duplexKey, isDuplex) {\n-  let hwm = options.highWaterMark;\n+  const hwm = highWaterMarkFrom(options, isDuplex, duplexKey);\n   if (hwm != null) {\n-    if (typeof hwm !== 'number' || !(hwm >= 0))\n-      throw new ERR_INVALID_OPT_VALUE('highWaterMark', hwm);\n-    return Math.floor(hwm);\n-  } else if (isDuplex) {\n-    hwm = options[duplexKey];\n-    if (hwm != null) {\n-      if (typeof hwm !== 'number' || !(hwm >= 0))\n-        throw new ERR_INVALID_OPT_VALUE(duplexKey, hwm);\n-      return Math.floor(hwm);\n+    if (!Number.isInteger(hwm) || hwm < 0) {\n+      const name = isDuplex ? duplexKey : 'highWaterMark';\n+      throw new ERR_INVALID_OPT_VALUE(name, hwm);\n     }\n+    return Math.floor(hwm);\n   }\n \n   // Default value"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 10,
        "deletions": 10
    }
}