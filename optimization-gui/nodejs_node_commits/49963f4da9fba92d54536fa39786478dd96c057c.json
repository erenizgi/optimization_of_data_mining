{
    "author": "targos",
    "message": "lib: remove unused internal error constructors\n\nPR-URL: https://github.com/nodejs/node/pull/19203\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>",
    "sha": "49963f4da9fba92d54536fa39786478dd96c057c",
    "files": [
        {
            "sha": "f890e431d2a9f522dea177c16bacf155e9202131",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/49963f4da9fba92d54536fa39786478dd96c057c/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/49963f4da9fba92d54536fa39786478dd96c057c/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=49963f4da9fba92d54536fa39786478dd96c057c",
            "patch": "@@ -36,6 +36,8 @@ const fs = exports;\n const { Buffer } = require('buffer');\n const errors = require('internal/errors');\n const {\n+  ERR_FS_WATCHER_ALREADY_STARTED,\n+  ERR_FS_WATCHER_NOT_STARTED,\n   ERR_INVALID_ARG_TYPE,\n   ERR_INVALID_CALLBACK,\n   ERR_OUT_OF_RANGE\n@@ -1349,7 +1351,7 @@ FSWatcher.prototype.start = function(filename,\n                                      encoding) {\n   lazyAssert()(this._handle instanceof FSEvent, 'handle must be a FSEvent');\n   if (this._handle.initialized) {\n-    throw new errors.Error('ERR_FS_WATCHER_ALREADY_STARTED');\n+    throw new ERR_FS_WATCHER_ALREADY_STARTED();\n   }\n \n   filename = getPathFromURL(filename);\n@@ -1373,7 +1375,7 @@ FSWatcher.prototype.start = function(filename,\n FSWatcher.prototype.close = function() {\n   lazyAssert()(this._handle instanceof FSEvent, 'handle must be a FSEvent');\n   if (!this._handle.initialized) {\n-    throw new errors.Error('ERR_FS_WATCHER_NOT_STARTED');\n+    throw new ERR_FS_WATCHER_NOT_STARTED();\n   }\n   this._handle.close();\n };"
        },
        {
            "sha": "8af2ff164e2be756b923aadd9e0111e30173a73d",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/49963f4da9fba92d54536fa39786478dd96c057c/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/49963f4da9fba92d54536fa39786478dd96c057c/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=49963f4da9fba92d54536fa39786478dd96c057c",
            "patch": "@@ -125,7 +125,6 @@ function makeNodeErrorWithCode(Base, key) {\n // *only* to allow for testing.\n function E(sym, val, def, ...otherClasses) {\n   messages.set(sym, val);\n-  if (def === undefined) return;\n   def = makeNodeErrorWithCode(def, sym);\n   if (otherClasses.length !== 0) {\n     otherClasses.forEach((clazz) => {\n@@ -572,23 +571,20 @@ module.exports = exports = {\n   exceptionWithHostPort,\n   uvException,\n   message,\n-  Error: makeNodeError(Error),\n-  TypeError: makeNodeError(TypeError),\n-  RangeError: makeNodeError(RangeError),\n-  URIError: makeNodeError(URIError),\n   AssertionError,\n   SystemError,\n   codes,\n   E, // This is exported only to facilitate testing.\n   errorCache: new Map() // This is in here only to facilitate testing.\n };\n \n-// To declare an error message, use the E(sym, val) function above. The sym\n+// To declare an error message, use the E(sym, val, def) function above. The sym\n // must be an upper case string. The val can be either a function or a string.\n+// The def must be an error class.\n // The return value of the function must be a string.\n // Examples:\n-// E('EXAMPLE_KEY1', 'This is the error value');\n-// E('EXAMPLE_KEY2', (a, b) => return `${a} ${b}`);\n+// E('EXAMPLE_KEY1', 'This is the error value', Error);\n+// E('EXAMPLE_KEY2', (a, b) => return `${a} ${b}`, RangeError);\n //\n // Once an error code has been assigned, the code itself MUST NOT change and\n // any given error code must never be reused to identify a different error.\n@@ -858,7 +854,6 @@ E('ERR_STREAM_UNSHIFT_AFTER_END_EVENT',\n   'stream.unshift() after end event', Error);\n E('ERR_STREAM_WRAP', 'Stream has StringDecoder set or is in objectMode', Error);\n E('ERR_STREAM_WRITE_AFTER_END', 'write after end', Error);\n-E('ERR_SYSTEM_ERROR', sysError);\n E('ERR_TLS_CERT_ALTNAME_INVALID',\n   'Hostname/IP does not match certificate\\'s altnames: %s', Error);\n E('ERR_TLS_DH_PARAM_SIZE', 'DH parameter size %s is less than 2048', Error);\n@@ -934,6 +929,7 @@ function sysError(code, syscall, path, dest,\n   }\n   return message;\n }\n+messages.set('ERR_SYSTEM_ERROR', sysError);\n \n function invalidArgType(name, expected, actual) {\n   internalAssert(name, 'name is required');"
        },
        {
            "sha": "dd6491ebce5219a1a5c9ac2d017556b32d6921c8",
            "filename": "test/parallel/test-internal-errors.js",
            "status": "modified",
            "additions": 22,
            "deletions": 111,
            "changes": 133,
            "blob_url": "https://github.com/nodejs/node/blob/49963f4da9fba92d54536fa39786478dd96c057c/test%2Fparallel%2Ftest-internal-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/49963f4da9fba92d54536fa39786478dd96c057c/test%2Fparallel%2Ftest-internal-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-internal-errors.js?ref=49963f4da9fba92d54536fa39786478dd96c057c",
            "patch": "@@ -5,153 +5,64 @@ const common = require('../common');\n const assert = require('assert');\n const errors = require('internal/errors');\n \n-function invalidKey(key) {\n-  return new RegExp(`^An invalid error message key was used: ${key}\\\\.$`);\n-}\n-\n-errors.E('TEST_ERROR_1', 'Error for testing purposes: %s');\n-errors.E('TEST_ERROR_2', (a, b) => `${a} ${b}`);\n+errors.E('TEST_ERROR_1', 'Error for testing purposes: %s',\n+         Error, TypeError, RangeError);\n+errors.E('TEST_ERROR_2', (a, b) => `${a} ${b}`, Error);\n \n {\n-  const err = new errors.Error('TEST_ERROR_1', 'test');\n+  const err = new errors.codes.TEST_ERROR_1('test');\n   assert(err instanceof Error);\n   assert.strictEqual(err.name, 'Error [TEST_ERROR_1]');\n   assert.strictEqual(err.message, 'Error for testing purposes: test');\n   assert.strictEqual(err.code, 'TEST_ERROR_1');\n }\n \n {\n-  const err = new errors.TypeError('TEST_ERROR_1', 'test');\n+  const err = new errors.codes.TEST_ERROR_1.TypeError('test');\n   assert(err instanceof TypeError);\n   assert.strictEqual(err.name, 'TypeError [TEST_ERROR_1]');\n   assert.strictEqual(err.message, 'Error for testing purposes: test');\n   assert.strictEqual(err.code, 'TEST_ERROR_1');\n }\n \n {\n-  const err = new errors.RangeError('TEST_ERROR_1', 'test');\n+  const err = new errors.codes.TEST_ERROR_1.RangeError('test');\n   assert(err instanceof RangeError);\n   assert.strictEqual(err.name, 'RangeError [TEST_ERROR_1]');\n   assert.strictEqual(err.message, 'Error for testing purposes: test');\n   assert.strictEqual(err.code, 'TEST_ERROR_1');\n }\n \n {\n-  const err = new errors.Error('TEST_ERROR_2', 'abc', 'xyz');\n+  const err = new errors.codes.TEST_ERROR_2('abc', 'xyz');\n   assert(err instanceof Error);\n   assert.strictEqual(err.name, 'Error [TEST_ERROR_2]');\n   assert.strictEqual(err.message, 'abc xyz');\n   assert.strictEqual(err.code, 'TEST_ERROR_2');\n }\n \n {\n-  const err = new errors.Error('TEST_ERROR_1');\n+  const err = new errors.codes.TEST_ERROR_1();\n   assert(err instanceof Error);\n   assert.strictEqual(err.name, 'Error [TEST_ERROR_1]');\n   assert.strictEqual(err.message, 'Error for testing purposes: %s');\n   assert.strictEqual(err.code, 'TEST_ERROR_1');\n }\n \n-common.expectsError(\n-  () => new errors.Error('TEST_FOO_KEY'),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('TEST_FOO_KEY')\n-  });\n-// Calling it twice yields same result (using the key does not create it)\n-common.expectsError(\n-  () => new errors.Error('TEST_FOO_KEY'),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('TEST_FOO_KEY')\n-  });\n-common.expectsError(\n-  () => new errors.Error(1),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey(1)\n-  });\n-common.expectsError(\n-  () => new errors.Error({}),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('\\\\[object Object\\\\]')\n-  });\n-common.expectsError(\n-  () => new errors.Error([]),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('')\n-  });\n-common.expectsError(\n-  () => new errors.Error(true),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('true')\n-  });\n-common.expectsError(\n-  () => new errors.TypeError(1),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey(1)\n-  });\n-common.expectsError(\n-  () => new errors.TypeError({}),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('\\\\[object Object\\\\]')\n-  });\n-common.expectsError(\n-  () => new errors.TypeError([]),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('')\n-  });\n-common.expectsError(\n-  () => new errors.TypeError(true),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('true')\n-  });\n-common.expectsError(\n-  () => new errors.RangeError(1),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey(1)\n-  });\n-common.expectsError(\n-  () => new errors.RangeError({}),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('\\\\[object Object\\\\]')\n-  });\n-common.expectsError(\n-  () => new errors.RangeError([]),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('')\n-  });\n-common.expectsError(\n-  () => new errors.RangeError(true),\n-  {\n-    code: 'ERR_ASSERTION',\n-    message: invalidKey('true')\n-  });\n-\n // Tests for common.expectsError\n common.expectsError(() => {\n-  throw new errors.TypeError('TEST_ERROR_1', 'a');\n+  throw new errors.codes.TEST_ERROR_1.TypeError('a');\n }, { code: 'TEST_ERROR_1' });\n common.expectsError(() => {\n-  throw new errors.TypeError('TEST_ERROR_1', 'a');\n+  throw new errors.codes.TEST_ERROR_1.TypeError('a');\n }, { code: 'TEST_ERROR_1',\n      type: TypeError,\n      message: /^Error for testing/ });\n common.expectsError(() => {\n-  throw new errors.TypeError('TEST_ERROR_1', 'a');\n+  throw new errors.codes.TEST_ERROR_1.TypeError('a');\n }, { code: 'TEST_ERROR_1', type: TypeError });\n common.expectsError(() => {\n-  throw new errors.TypeError('TEST_ERROR_1', 'a');\n+  throw new errors.codes.TEST_ERROR_1.TypeError('a');\n }, {\n   code: 'TEST_ERROR_1',\n   type: TypeError,\n@@ -160,7 +71,7 @@ common.expectsError(() => {\n \n common.expectsError(() => {\n   common.expectsError(() => {\n-    throw new errors.TypeError('TEST_ERROR_1', 'a');\n+    throw new errors.codes.TEST_ERROR_1.TypeError('a');\n   }, { code: 'TEST_ERROR_1', type: RangeError });\n }, {\n   code: 'ERR_ASSERTION',\n@@ -169,7 +80,7 @@ common.expectsError(() => {\n \n common.expectsError(() => {\n   common.expectsError(() => {\n-    throw new errors.TypeError('TEST_ERROR_1', 'a');\n+    throw new errors.codes.TEST_ERROR_1.TypeError('a');\n   }, { code: 'TEST_ERROR_1',\n        type: TypeError,\n        message: /^Error for testing 2/ });\n@@ -318,25 +229,25 @@ assert.strictEqual(\n \n {\n   const { kMaxLength } = process.binding('buffer');\n-  const error = new errors.Error('ERR_BUFFER_TOO_LARGE');\n+  const error = new errors.codes.ERR_BUFFER_TOO_LARGE();\n   assert.strictEqual(\n     error.message,\n     `Cannot create a Buffer larger than 0x${kMaxLength.toString(16)} bytes`\n   );\n }\n \n {\n-  const error = new errors.Error('ERR_INVALID_ARG_VALUE', 'foo', '\\u0000bar');\n+  const error = new errors.codes.ERR_INVALID_ARG_VALUE('foo', '\\u0000bar');\n   assert.strictEqual(\n     error.message,\n     'The argument \\'foo\\' is invalid. Received \\'\\\\u0000bar\\''\n   );\n }\n \n {\n-  const error = new errors.Error(\n-    'ERR_INVALID_ARG_VALUE',\n-    'foo', { a: 1 }, 'must have property \\'b\\'');\n+  const error = new errors.codes.ERR_INVALID_ARG_VALUE(\n+    'foo', { a: 1 }, 'must have property \\'b\\''\n+  );\n   assert.strictEqual(\n     error.message,\n     'The argument \\'foo\\' must have property \\'b\\'. Received { a: 1 }'\n@@ -346,7 +257,7 @@ assert.strictEqual(\n // Test that `code` property is mutable and that changing it does not change the\n // name.\n {\n-  const myError = new errors.Error('ERR_TLS_HANDSHAKE_TIMEOUT');\n+  const myError = new errors.codes.ERR_TLS_HANDSHAKE_TIMEOUT();\n   assert.strictEqual(myError.code, 'ERR_TLS_HANDSHAKE_TIMEOUT');\n   assert.strictEqual(myError.hasOwnProperty('code'), false);\n   assert.strictEqual(myError.hasOwnProperty('name'), false);\n@@ -364,7 +275,7 @@ assert.strictEqual(\n // `console.log()` results, which is the behavior of `Error` objects in the\n // browser. Note that `name` becomes enumerable after being assigned.\n {\n-  const myError = new errors.Error('ERR_TLS_HANDSHAKE_TIMEOUT');\n+  const myError = new errors.codes.ERR_TLS_HANDSHAKE_TIMEOUT();\n   assert.deepStrictEqual(Object.keys(myError), []);\n   const initialToString = myError.toString();\n \n@@ -379,7 +290,7 @@ assert.strictEqual(\n {\n   let initialConsoleLog = '';\n   common.hijackStdout((data) => { initialConsoleLog += data; });\n-  const myError = new errors.Error('ERR_TLS_HANDSHAKE_TIMEOUT');\n+  const myError = new errors.codes.ERR_TLS_HANDSHAKE_TIMEOUT();\n   assert.deepStrictEqual(Object.keys(myError), []);\n   const initialToString = myError.toString();\n   console.log(myError);"
        },
        {
            "sha": "10ad1db4eeb2bac47d43b3a0337a6c13c111b257",
            "filename": "test/parallel/test-util.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/49963f4da9fba92d54536fa39786478dd96c057c/test%2Fparallel%2Ftest-util.js",
            "raw_url": "https://github.com/nodejs/node/raw/49963f4da9fba92d54536fa39786478dd96c057c/test%2Fparallel%2Ftest-util.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util.js?ref=49963f4da9fba92d54536fa39786478dd96c057c",
            "patch": "@@ -170,7 +170,7 @@ util.error('test');\n   assert.strictEqual(util.types.isNativeError(Object.create(Error.prototype)),\n                      false);\n   assert.strictEqual(\n-    util.types.isNativeError(new errors.Error('ERR_IPC_CHANNEL_CLOSED')),\n+    util.types.isNativeError(new errors.codes.ERR_IPC_CHANNEL_CLOSED()),\n     true\n   );\n }"
        }
    ],
    "stats": {
        "total": 155,
        "additions": 32,
        "deletions": 123
    }
}