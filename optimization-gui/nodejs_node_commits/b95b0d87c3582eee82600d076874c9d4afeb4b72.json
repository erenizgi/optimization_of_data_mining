{
    "author": "BridgeAR",
    "message": "util: add order option to `.inspect()`\n\nThe order option can be used to sort the inspected values in case\nthey do not rely on their order as arrays. That way the output is\nstable no matter of the object property inspection order.\n\nPR-URL: https://github.com/nodejs/node/pull/22788\nRefs: https://github.com/nodejs/node/issues/22763\nReviewed-By: John-David Dalton <john.david.dalton@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "b95b0d87c3582eee82600d076874c9d4afeb4b72",
    "files": [
        {
            "sha": "b0e942274c667a130d933efac8453896e0d819a9",
            "filename": "doc/api/util.md",
            "status": "modified",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/nodejs/node/blob/b95b0d87c3582eee82600d076874c9d4afeb4b72/doc%2Fapi%2Futil.md",
            "raw_url": "https://github.com/nodejs/node/raw/b95b0d87c3582eee82600d076874c9d4afeb4b72/doc%2Fapi%2Futil.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Futil.md?ref=b95b0d87c3582eee82600d076874c9d4afeb4b72",
            "patch": "@@ -360,6 +360,9 @@ stream.write('With ES6');\n <!-- YAML\n added: v0.3.0\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/22788\n+    description: The `sorted` option is supported now.\n   - version: REPLACEME\n     pr-url: https://github.com/nodejs/node/pull/22756\n     description: The inspection output is now limited to about 128 MB. Data\n@@ -426,6 +429,10 @@ changes:\n     objects the same as arrays. Note that no text will be reduced below 16\n     characters, no matter the `breakLength` size. For more information, see the\n     example below. **Default:** `true`.\n+  * `sorted` {boolean|Function} If set to `true` or a function, all properties\n+    of an object and Set and Map entries will be sorted in the returned string.\n+    If set to `true` the [default sort][] is going to be used. If set to a\n+    function, it is used as a [compare function][].\n * Returns: {string} The representation of passed object\n \n The `util.inspect()` method returns a string representation of `object` that is\n@@ -535,6 +542,34 @@ console.log(inspect(weakSet, { showHidden: true }));\n // WeakSet { { a: 1 }, { b: 2 } }\n ```\n \n+The `sorted` option makes sure the output is identical, no matter of the\n+properties insertion order:\n+\n+```js\n+const { inspect } = require('util');\n+const assert = require('assert');\n+\n+const o1 = {\n+  b: [2, 3, 1],\n+  a: '`a` comes before `b`',\n+  c: new Set([2, 3, 1])\n+};\n+console.log(inspect(o1, { sorted: true }));\n+// { a: '`a` comes before `b`', b: [ 2, 3, 1 ], c: Set { 1, 2, 3 } }\n+console.log(inspect(o1, { sorted: (a, b) => a < b }));\n+// { c: Set { 3, 2, 1 }, b: [ 2, 3, 1 ], a: '`a` comes before `b`' }\n+\n+const o2 = {\n+  c: new Set([2, 1, 3]),\n+  a: '`a` comes before `b`',\n+  b: [2, 3, 1]\n+};\n+assert.strict.equal(\n+  inspect(o1, { sorted: true }),\n+  inspect(o2, { sorted: true })\n+);\n+```\n+\n Please note that `util.inspect()` is a synchronous method that is mainly\n intended as a debugging tool. Its maximum output length is limited to\n approximately 128 MB and input values that result in output bigger than that\n@@ -2165,7 +2200,9 @@ Deprecated predecessor of `console.log`.\n [WHATWG Encoding Standard]: https://encoding.spec.whatwg.org/\n [Common System Errors]: errors.html#errors_common_system_errors\n [async function]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/async_function\n+[compare function]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort#Parameters\n [constructor]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor\n+[default sort]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/sort\n [global symbol registry]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Symbol/for\n [list of deprecated APIS]: deprecations.html#deprecations_list_of_deprecated_apis\n [semantically incompatible]: https://github.com/nodejs/node/issues/4179"
        },
        {
            "sha": "d1a483cf17bff797fd5751810e8d850a062abce8",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 15,
            "deletions": 3,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/b95b0d87c3582eee82600d076874c9d4afeb4b72/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/b95b0d87c3582eee82600d076874c9d4afeb4b72/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=b95b0d87c3582eee82600d076874c9d4afeb4b72",
            "patch": "@@ -99,7 +99,8 @@ const inspectDefaultOptions = Object.seal({\n   showProxy: false,\n   maxArrayLength: 100,\n   breakLength: 60,\n-  compact: true\n+  compact: true,\n+  sorted: false\n });\n \n const kObjectType = 0;\n@@ -394,6 +395,8 @@ function debuglog(set) {\n function inspect(value, opts) {\n   // Default options\n   const ctx = {\n+    budget: {},\n+    indentationLvl: 0,\n     seen: [],\n     stylize: stylizeNoColor,\n     showHidden: inspectDefaultOptions.showHidden,\n@@ -405,9 +408,8 @@ function inspect(value, opts) {\n     // `maxEntries`.\n     maxArrayLength: inspectDefaultOptions.maxArrayLength,\n     breakLength: inspectDefaultOptions.breakLength,\n-    indentationLvl: 0,\n     compact: inspectDefaultOptions.compact,\n-    budget: {}\n+    sorted: inspectDefaultOptions.sorted\n   };\n   if (arguments.length > 1) {\n     // Legacy...\n@@ -894,6 +896,16 @@ function formatRaw(ctx, value, recurseTimes) {\n   }\n   ctx.seen.pop();\n \n+  if (ctx.sorted) {\n+    const comparator = ctx.sorted === true ? undefined : ctx.sorted;\n+    if (extrasType === kObjectType) {\n+      output = output.sort(comparator);\n+    } else if (keys.length > 1) {\n+      const sorted = output.slice(output.length - keys.length).sort(comparator);\n+      output.splice(output.length - keys.length, keys.length, ...sorted);\n+    }\n+  }\n+\n   const res = reduceToSingleString(ctx, output, base, braces);\n   const budget = ctx.budget[ctx.indentationLvl] || 0;\n   const newLength = budget + res.length;"
        },
        {
            "sha": "cd7d08caf0a0f89e07dd0b0bcb11b108315f2202",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/b95b0d87c3582eee82600d076874c9d4afeb4b72/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/b95b0d87c3582eee82600d076874c9d4afeb4b72/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=b95b0d87c3582eee82600d076874c9d4afeb4b72",
            "patch": "@@ -1676,3 +1676,33 @@ assert.strictEqual(inspect(new BigUint64Array([0n])), 'BigUint64Array [ 0n ]');\n   );\n   rejection.catch(() => {});\n }\n+\n+assert.strictEqual(\n+  inspect([1, 3, 2], { sorted: true }),\n+  inspect([1, 3, 2])\n+);\n+assert.strictEqual(\n+  inspect({ c: 3, a: 1, b: 2 }, { sorted: true }),\n+  '{ a: 1, b: 2, c: 3 }'\n+);\n+assert.strictEqual(\n+  inspect(\n+    { a200: 4, a100: 1, a102: 3, a101: 2 },\n+    { sorted(a, b) { return a < b; } }\n+  ),\n+  '{ a200: 4, a102: 3, a101: 2, a100: 1 }'\n+);\n+\n+// Non-indices array properties are sorted as well.\n+{\n+  const arr = [3, 2, 1];\n+  arr.b = 2;\n+  arr.c = 3;\n+  arr.a = 1;\n+  arr[Symbol('b')] = true;\n+  arr[Symbol('a')] = false;\n+  assert.strictEqual(\n+    inspect(arr, { sorted: true }),\n+    '[ 3, 2, 1, [Symbol(a)]: false, [Symbol(b)]: true, a: 1, b: 2, c: 3 ]'\n+  );\n+}"
        }
    ],
    "stats": {
        "total": 85,
        "additions": 82,
        "deletions": 3
    }
}