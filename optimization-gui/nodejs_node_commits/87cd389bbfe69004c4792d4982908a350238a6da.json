{
    "author": "apapirovski",
    "message": "http2: delay closing stream\n\nDelay automatically closing the stream with setImmediate in order\nto allow any pushStreams to be sent first.\n\nPR-URL: https://github.com/nodejs/node/pull/20997\nFixes: https://github.com/nodejs/node/issues/20992\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "87cd389bbfe69004c4792d4982908a350238a6da",
    "files": [
        {
            "sha": "7e2faa97bf02da9cd0a8d39463166d47d5d3e873",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/87cd389bbfe69004c4792d4982908a350238a6da/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/87cd389bbfe69004c4792d4982908a350238a6da/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=87cd389bbfe69004c4792d4982908a350238a6da",
            "patch": "@@ -1906,7 +1906,10 @@ class Http2Stream extends Duplex {\n           !(state.flags & STREAM_FLAGS_HAS_TRAILERS) &&\n           !state.didRead &&\n           this.readableFlowing === null) {\n-        this.close();\n+        // By using setImmediate we allow pushStreams to make it through\n+        // before the stream is officially closed. This prevents a bug\n+        // in most browsers where those pushStreams would be rejected.\n+        setImmediate(this.close.bind(this));\n       }\n     }\n   }\n@@ -2178,7 +2181,7 @@ class ServerHttp2Stream extends Http2Stream {\n     let headRequest = false;\n     if (headers[HTTP2_HEADER_METHOD] === HTTP2_METHOD_HEAD)\n       headRequest = options.endStream = true;\n-    options.readable = !options.endStream;\n+    options.readable = false;\n \n     const headersList = mapToHeaders(headers);\n     if (!Array.isArray(headersList))"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 5,
        "deletions": 2
    }
}