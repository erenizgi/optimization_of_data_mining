{
    "author": "lundibundi",
    "message": "test: improve test-gc-http-client-onerror\n\n* refactor out usage of 'function' for scoping\n* inline runTest function\n\nPR-URL: https://github.com/nodejs/node/pull/23196\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "0ea804aae58568d6bf18e4eee7976ccccdbe6704",
    "files": [
        {
            "sha": "28a8aecd27e7946c8ba9b21a232e445e15c76a5f",
            "filename": "test/sequential/test-gc-http-client-onerror.js",
            "status": "modified",
            "additions": 19,
            "deletions": 22,
            "changes": 41,
            "blob_url": "https://github.com/nodejs/node/blob/0ea804aae58568d6bf18e4eee7976ccccdbe6704/test%2Fsequential%2Ftest-gc-http-client-onerror.js",
            "raw_url": "https://github.com/nodejs/node/raw/0ea804aae58568d6bf18e4eee7976ccccdbe6704/test%2Fsequential%2Ftest-gc-http-client-onerror.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-gc-http-client-onerror.js?ref=0ea804aae58568d6bf18e4eee7976ccccdbe6704",
            "patch": "@@ -3,7 +3,7 @@\n // just like test-gc-http-client.js,\n // but with an on('error') handler that does nothing.\n \n-require('../common');\n+const common = require('../common');\n const onGC = require('../common/ongc');\n \n function serverHandler(req, res) {\n@@ -21,37 +21,34 @@ let countGC = 0;\n console.log(`We should do ${todo} requests`);\n \n const server = http.createServer(serverHandler);\n-server.listen(0, runTest);\n+server.listen(0, common.mustCall(() => {\n+  for (let i = 0; i < 10; i++)\n+    getall();\n+}));\n \n function getall() {\n   if (count >= todo)\n     return;\n \n-  (function() {\n-    function cb(res) {\n-      res.resume();\n-      done += 1;\n-    }\n-    function onerror(er) {\n-      throw er;\n-    }\n+  const req = http.get({\n+    hostname: 'localhost',\n+    pathname: '/',\n+    port: server.address().port\n+  }, cb).on('error', onerror);\n \n-    const req = http.get({\n-      hostname: 'localhost',\n-      pathname: '/',\n-      port: server.address().port\n-    }, cb).on('error', onerror);\n-\n-    count++;\n-    onGC(req, { ongc });\n-  })();\n+  count++;\n+  onGC(req, { ongc });\n \n   setImmediate(getall);\n }\n \n-function runTest() {\n-  for (let i = 0; i < 10; i++)\n-    getall();\n+function cb(res) {\n+  res.resume();\n+  done += 1;\n+}\n+\n+function onerror(err) {\n+  throw err;\n }\n \n function ongc() {"
        }
    ],
    "stats": {
        "total": 41,
        "additions": 19,
        "deletions": 22
    }
}