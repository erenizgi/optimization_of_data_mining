{
    "author": "danbev",
    "message": "src: remove abort_on_uncaught_exception node.cc\n\nThis commit removes the static variable abort_on_uncaught_exception and\nadds it to the environment options.\n\nPR-URL: https://github.com/nodejs/node/pull/22724\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "6a9e776200bc0893d6d17d73488be28178e6f6fe",
    "files": [
        {
            "sha": "2e0c4c5d1c684022c25497248fd7ee9f16750cfb",
            "filename": "src/env-inl.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/6a9e776200bc0893d6d17d73488be28178e6f6fe/src%2Fenv-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/6a9e776200bc0893d6d17d73488be28178e6f6fe/src%2Fenv-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv-inl.h?ref=6a9e776200bc0893d6d17d73488be28178e6f6fe",
            "patch": "@@ -420,11 +420,11 @@ inline void Environment::set_trace_sync_io(bool value) {\n }\n \n inline bool Environment::abort_on_uncaught_exception() const {\n-  return abort_on_uncaught_exception_;\n+  return options_->abort_on_uncaught_exception;\n }\n \n inline void Environment::set_abort_on_uncaught_exception(bool value) {\n-  abort_on_uncaught_exception_ = value;\n+  options_->abort_on_uncaught_exception = value;\n }\n \n inline AliasedBuffer<uint32_t, v8::Uint32Array>&"
        },
        {
            "sha": "058960861492cf858a875032af3978e06fafbc97",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/6a9e776200bc0893d6d17d73488be28178e6f6fe/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/6a9e776200bc0893d6d17d73488be28178e6f6fe/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=6a9e776200bc0893d6d17d73488be28178e6f6fe",
            "patch": "@@ -183,9 +183,6 @@ static node_module* modlist_internal;\n static node_module* modlist_linked;\n static node_module* modlist_addon;\n \n-// TODO(addaleax): This should not be global.\n-static bool abort_on_uncaught_exception = false;\n-\n // Bit flag used to track security reverts (see node_revert.h)\n unsigned int reverted = 0;\n \n@@ -2670,7 +2667,7 @@ void ProcessArgv(std::vector<std::string>* args,\n                 \"--abort-on-uncaught-exception\") != v8_args.end() ||\n       std::find(v8_args.begin(), v8_args.end(),\n                 \"--abort_on_uncaught_exception\") != v8_args.end()) {\n-    abort_on_uncaught_exception = true;\n+    env_opts->abort_on_uncaught_exception = true;\n   }\n \n   // TODO(bnoordhuis) Intercept --prof arguments and start the CPU profiler\n@@ -3042,8 +3039,6 @@ inline int Start(Isolate* isolate, IsolateData* isolate_data,\n     return 12;  // Signal internal error.\n   }\n \n-  env.set_abort_on_uncaught_exception(abort_on_uncaught_exception);\n-\n   // TODO(addaleax): Maybe access this option directly instead of setting\n   // a boolean member of Environment. Ditto below for trace_sync_io.\n   if (env.options()->no_force_async_hooks_checks) {"
        },
        {
            "sha": "71615cf0839aa48f7a6c0573769a206cf5924c61",
            "filename": "src/node_options.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6a9e776200bc0893d6d17d73488be28178e6f6fe/src%2Fnode_options.h",
            "raw_url": "https://github.com/nodejs/node/raw/6a9e776200bc0893d6d17d73488be28178e6f6fe/src%2Fnode_options.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.h?ref=6a9e776200bc0893d6d17d73488be28178e6f6fe",
            "patch": "@@ -60,6 +60,7 @@ class DebugOptions {\n class EnvironmentOptions {\n  public:\n   std::shared_ptr<DebugOptions> debug_options { new DebugOptions() };\n+  bool abort_on_uncaught_exception = false;\n   bool experimental_modules = false;\n   bool experimental_repl_await = false;\n   bool experimental_vm_modules = false;"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 4,
        "deletions": 8
    }
}