{
    "author": "joyeecheung",
    "message": "lib: move internalBinding whitelisting into loaders.js\n\nInstead of setting the internalBinding white list in node.js and\nwrapping process.binding twice, put it directly in loaders.js\nwhere the user land process.binding is defined.\n\nPR-URL: https://github.com/nodejs/node/pull/24088\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "7bd8bbaabf4ed964476fca4bed267815b2b3967e",
    "files": [
        {
            "sha": "ec67df59ce5a007abd14699241409551a9248757",
            "filename": "lib/internal/bootstrap/loaders.js",
            "status": "modified",
            "additions": 48,
            "deletions": 0,
            "changes": 48,
            "blob_url": "https://github.com/nodejs/node/blob/7bd8bbaabf4ed964476fca4bed267815b2b3967e/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "raw_url": "https://github.com/nodejs/node/raw/7bd8bbaabf4ed964476fca4bed267815b2b3967e/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Floaders.js?ref=7bd8bbaabf4ed964476fca4bed267815b2b3967e",
            "patch": "@@ -70,12 +70,52 @@\n     writable: false\n   });\n \n+  // internalBindingWhitelist contains the name of internalBinding modules\n+  // that are whitelisted for access via process.binding()... this is used\n+  // to provide a transition path for modules that are being moved over to\n+  // internalBinding.\n+  const internalBindingWhitelist = [\n+    'cares_wrap',\n+    'fs_event_wrap',\n+    'icu',\n+    'udp_wrap',\n+    'uv',\n+    'pipe_wrap',\n+    'http_parser',\n+    'process_wrap',\n+    'v8',\n+    'tty_wrap',\n+    'stream_wrap',\n+    'signal_wrap',\n+    'crypto',\n+    'contextify',\n+    'tcp_wrap',\n+    'tls_wrap',\n+    'util',\n+    'async_wrap',\n+    'url',\n+    'spawn_sync',\n+    'js_stream',\n+    'zlib',\n+    'buffer',\n+    'natives',\n+    'constants'\n+  ];\n+  // We will use a lazy loaded SafeSet in internalBindingWhitelistHas\n+  // for checking existence in this list.\n+  let internalBindingWhitelistSet;\n+\n   // Set up process.binding() and process._linkedBinding()\n   {\n     const bindingObj = ObjectCreate(null);\n \n     process.binding = function binding(module) {\n       module = String(module);\n+      // Deprecated specific process.binding() modules, but not all, allow\n+      // selective fallback to internalBinding for the deprecated ones.\n+      if (internalBindingWhitelistHas(module)) {\n+        return internalBinding(module);\n+      }\n       let mod = bindingObj[module];\n       if (typeof mod !== 'object') {\n         mod = bindingObj[module] = getBinding(module);\n@@ -376,6 +416,14 @@\n     NativeModule.require('internal/process/coverage').setup();\n   }\n \n+  function internalBindingWhitelistHas(name) {\n+    if (!internalBindingWhitelistSet) {\n+      const { SafeSet } = NativeModule.require('internal/safe_globals');\n+      internalBindingWhitelistSet = new SafeSet(internalBindingWhitelist);\n+    }\n+    return internalBindingWhitelistSet.has(name);\n+  }\n+\n   // This will be passed to the bootstrapNodeJSCore function in\n   // bootstrap/node.js.\n   return loaderExports;"
        },
        {
            "sha": "324fdb71a623897ac045e569e1519fed80d09f30",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 0,
            "deletions": 41,
            "changes": 41,
            "blob_url": "https://github.com/nodejs/node/blob/7bd8bbaabf4ed964476fca4bed267815b2b3967e/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/7bd8bbaabf4ed964476fca4bed267815b2b3967e/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=7bd8bbaabf4ed964476fca4bed267815b2b3967e",
            "patch": "@@ -384,47 +384,6 @@\n       for (var i = 0; i < arguments.length; i++)\n         this.push(arguments[i]);\n     }\n-\n-    // Deprecated specific process.binding() modules, but not all, allow\n-    // selective fallback to internalBinding for the deprecated ones.\n-    const { SafeSet } = NativeModule.require('internal/safe_globals');\n-    const processBinding = process.binding;\n-    // internalBindingWhitelist contains the name of internalBinding modules\n-    // that are whitelisted for access via process.binding()... this is used\n-    // to provide a transition path for modules that are being moved over to\n-    // internalBinding.\n-    const internalBindingWhitelist =\n-      new SafeSet([\n-        'cares_wrap',\n-        'fs_event_wrap',\n-        'icu',\n-        'udp_wrap',\n-        'uv',\n-        'pipe_wrap',\n-        'http_parser',\n-        'process_wrap',\n-        'v8',\n-        'tty_wrap',\n-        'stream_wrap',\n-        'signal_wrap',\n-        'crypto',\n-        'contextify',\n-        'tcp_wrap',\n-        'tls_wrap',\n-        'util',\n-        'async_wrap',\n-        'url',\n-        'spawn_sync',\n-        'js_stream',\n-        'zlib',\n-        'buffer',\n-        'natives',\n-        'constants']);\n-    process.binding = function binding(name) {\n-      return internalBindingWhitelist.has(name) ?\n-        internalBinding(name) :\n-        processBinding(name);\n-    };\n   }\n \n   function setupGlobalVariables() {"
        }
    ],
    "stats": {
        "total": 89,
        "additions": 48,
        "deletions": 41
    }
}