{
    "author": "apapirovski",
    "message": "util: improve spliceOne perf\n\nDo less variable allocations and reassignments inside spliceOne\nsince it's relied on by some performance sensitive code.\n\nPR-URL: https://github.com/nodejs/node/pull/20453\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "b04d0921aeaa70521dea5fcb27256c686157eb87",
    "files": [
        {
            "sha": "5c2a39f6d72a11ea95b7f668eeda7f1da0a70dc8",
            "filename": "benchmark/util/splice-one.js",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/b04d0921aeaa70521dea5fcb27256c686157eb87/benchmark%2Futil%2Fsplice-one.js",
            "raw_url": "https://github.com/nodejs/node/raw/b04d0921aeaa70521dea5fcb27256c686157eb87/benchmark%2Futil%2Fsplice-one.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Futil%2Fsplice-one.js?ref=b04d0921aeaa70521dea5fcb27256c686157eb87",
            "patch": "@@ -0,0 +1,33 @@\n+'use strict';\n+\n+const common = require('../common');\n+\n+const bench = common.createBenchmark(main, {\n+  n: [1e7],\n+  pos: ['start', 'middle', 'end'],\n+  size: [10, 100, 500],\n+}, { flags: ['--expose-internals'] });\n+\n+function main({ n, pos, size }) {\n+  const { spliceOne } = require('internal/util');\n+  const arr = new Array(size);\n+  arr.fill('');\n+  let index;\n+  switch (pos) {\n+    case 'end':\n+      index = size - 1;\n+      break;\n+    case 'middle':\n+      index = Math.floor(size / 2);\n+      break;\n+    default: // start\n+      index = 0;\n+  }\n+\n+  bench.start();\n+  for (var i = 0; i < n; i++) {\n+    spliceOne(arr, index);\n+    arr.push('');\n+  }\n+  bench.end(n);\n+}"
        },
        {
            "sha": "07515e2e090daae91633584237381976970b836c",
            "filename": "lib/internal/util.js",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/b04d0921aeaa70521dea5fcb27256c686157eb87/lib%2Finternal%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/b04d0921aeaa70521dea5fcb27256c686157eb87/lib%2Finternal%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil.js?ref=b04d0921aeaa70521dea5fcb27256c686157eb87",
            "patch": "@@ -322,10 +322,11 @@ function join(output, separator) {\n   return str;\n }\n \n-// About 1.5x faster than the two-arg version of Array#splice().\n+// As of V8 6.6, depending on the size of the array, this is anywhere\n+// between 1.5-10x faster than the two-arg version of Array#splice()\n function spliceOne(list, index) {\n-  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)\n-    list[i] = list[k];\n+  for (; index + 1 < list.length; index++)\n+    list[index] = list[index + 1];\n   list.pop();\n }\n "
        },
        {
            "sha": "838e51daac26b41af5cccca3db4ecedeef95bbc4",
            "filename": "test/parallel/test-benchmark-util.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b04d0921aeaa70521dea5fcb27256c686157eb87/test%2Fparallel%2Ftest-benchmark-util.js",
            "raw_url": "https://github.com/nodejs/node/raw/b04d0921aeaa70521dea5fcb27256c686157eb87/test%2Fparallel%2Ftest-benchmark-util.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-benchmark-util.js?ref=b04d0921aeaa70521dea5fcb27256c686157eb87",
            "patch": "@@ -10,6 +10,8 @@ runBenchmark('util',\n               'method=Array',\n               'n=1',\n               'option=none',\n+              'pos=start',\n+              'size=1',\n               'type=',\n               'version=native'],\n              { NODEJS_BENCHMARK_ZERO_ALLOWED: 1 });"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 39,
        "deletions": 3
    }
}