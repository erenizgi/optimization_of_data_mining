{
    "author": "XadillaX",
    "message": "deps: patch to fix *.onion MX query on c-ares\n\nc-ares rejects *.onion MX query but forgot to set `*bufp` to NULL. This\nwill occur SegmentFault when free `*bufp`.\n\nI make this quick fix and then will make a PR for c-ares either.\n\nPR-URL: https://github.com/nodejs/node/pull/25840\nFixes: https://github.com/nodejs/node/issues/25839\nRefs: https://github.com/c-ares/c-ares/blob/955df98/ares_create_query.c#L97-L103\nRefs: https://github.com/c-ares/c-ares/blob/955df98/ares_query.c#L124\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "4cc9b5f28579d2b5f0ae9ef071fa2e6a4dcfd2ae",
    "files": [
        {
            "sha": "9efce17cfa32aabf50f0a3593878b94ac3794f1d",
            "filename": "deps/cares/src/ares_create_query.c",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/4cc9b5f28579d2b5f0ae9ef071fa2e6a4dcfd2ae/deps%2Fcares%2Fsrc%2Fares_create_query.c",
            "raw_url": "https://github.com/nodejs/node/raw/4cc9b5f28579d2b5f0ae9ef071fa2e6a4dcfd2ae/deps%2Fcares%2Fsrc%2Fares_create_query.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fcares%2Fsrc%2Fares_create_query.c?ref=4cc9b5f28579d2b5f0ae9ef071fa2e6a4dcfd2ae",
            "patch": "@@ -94,14 +94,14 @@ int ares_create_query(const char *name, int dnsclass, int type,\n   size_t buflen;\n   unsigned char *buf;\n \n-  /* Per RFC 7686, reject queries for \".onion\" domain names with NXDOMAIN. */\n-  if (ares__is_onion_domain(name))\n-    return ARES_ENOTFOUND;\n-\n   /* Set our results early, in case we bail out early with an error. */\n   *buflenp = 0;\n   *bufp = NULL;\n \n+  /* Per RFC 7686, reject queries for \".onion\" domain names with NXDOMAIN. */\n+  if (ares__is_onion_domain(name))\n+    return ARES_ENOTFOUND;\n+\n   /* Allocate a memory area for the maximum size this packet might need. +2\n    * is for the length byte and zero termination if no dots or ecscaping is\n    * used."
        },
        {
            "sha": "b96055ba4dceabfb6e3f8d912b0fa347fb6eeb5e",
            "filename": "test/parallel/test-dns.js",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/4cc9b5f28579d2b5f0ae9ef071fa2e6a4dcfd2ae/test%2Fparallel%2Ftest-dns.js",
            "raw_url": "https://github.com/nodejs/node/raw/4cc9b5f28579d2b5f0ae9ef071fa2e6a4dcfd2ae/test%2Fparallel%2Ftest-dns.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-dns.js?ref=4cc9b5f28579d2b5f0ae9ef071fa2e6a4dcfd2ae",
            "patch": "@@ -314,3 +314,13 @@ common.expectsError(() => {\n   code: 'ERR_INVALID_CALLBACK',\n   type: TypeError\n });\n+\n+{\n+  dns.resolveMx('foo.onion', function(err) {\n+    assert.deepStrictEqual(err.errno, 'ENOTFOUND');\n+    assert.deepStrictEqual(err.code, 'ENOTFOUND');\n+    assert.deepStrictEqual(err.syscall, 'queryMx');\n+    assert.deepStrictEqual(err.hostname, 'foo.onion');\n+    assert.deepStrictEqual(err.message, 'queryMx ENOTFOUND foo.onion');\n+  });\n+}"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 14,
        "deletions": 4
    }
}