{
    "author": "richardlau",
    "message": "report: separate release metadata\n\nReport release metadata separately from `componentVersions`.\nTest `componentVersions` and `release` values in the report.\n\nPR-URL: https://github.com/nodejs/node/pull/25826\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "d0d84b009ce4f2fe274568ed39754c02167e27d3",
    "files": [
        {
            "sha": "66770fcbc978f41e221a5b70adccadea0ba04f17",
            "filename": "doc/api/report.md",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/d0d84b009ce4f2fe274568ed39754c02167e27d3/doc%2Fapi%2Freport.md",
            "raw_url": "https://github.com/nodejs/node/raw/d0d84b009ce4f2fe274568ed39754c02167e27d3/doc%2Fapi%2Freport.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Freport.md?ref=d0d84b009ce4f2fe274568ed39754c02167e27d3",
            "patch": "@@ -39,6 +39,8 @@ is provided below for reference.\n     \"glibcVersionRuntime\": \"2.17\",\n     \"glibcVersionCompiler\": \"2.17\",\n     \"wordSize\": \"64 bit\",\n+    \"arch\": \"x64\",\n+    \"platform\": \"linux\",\n     \"componentVersions\": {\n       \"node\": \"12.0.0-pre\",\n       \"v8\": \"7.1.302.28-node.5\",\n@@ -50,10 +52,10 @@ is provided below for reference.\n       \"napi\": \"3\",\n       \"llhttp\": \"1.0.1\",\n       \"http_parser\": \"2.8.0\",\n-      \"openssl\": \"1.1.0j\",\n-      \"arch\": \"x64\",\n-      \"platform\": \"linux\",\n-      \"release\": \"node\"\n+      \"openssl\": \"1.1.0j\"\n+    },\n+    \"release\": {\n+      \"name\": \"node\"\n     },\n     \"osVersion\": \"Linux 3.10.0-862.el7.x86_64 #1 SMP Wed Mar 21 18:14:51 EDT 2018\",\n     \"machine\": \"Linux 3.10.0-862.el7.x86_64 #1 SMP Wed Mar 21 18:14:51 EDT 2018test_machine x86_64\""
        },
        {
            "sha": "08d3642e7a389123abe175ca35b3c90446359137",
            "filename": "src/node_report.cc",
            "status": "modified",
            "additions": 27,
            "deletions": 6,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/d0d84b009ce4f2fe274568ed39754c02167e27d3/src%2Fnode_report.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d0d84b009ce4f2fe274568ed39754c02167e27d3/src%2Fnode_report.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_report.cc?ref=d0d84b009ce4f2fe274568ed39754c02167e27d3",
            "patch": "@@ -86,6 +86,7 @@ static void PrintGCStatistics(JSONWriter* writer, Isolate* isolate);\n static void PrintSystemInformation(JSONWriter* writer);\n static void PrintLoadedLibraries(JSONWriter* writer);\n static void PrintComponentVersions(JSONWriter* writer);\n+static void PrintRelease(JSONWriter* writer);\n static void LocalTime(TIME_TYPE* tm_struct);\n \n // Global variables\n@@ -341,10 +342,15 @@ static void PrintVersionInformation(JSONWriter* writer) {\n \n   // Report Process word size\n   writer->json_keyvalue(\"wordSize\", sizeof(void*) * 8);\n+  writer->json_keyvalue(\"arch\", node::per_process::metadata.arch);\n+  writer->json_keyvalue(\"platform\", node::per_process::metadata.platform);\n \n   // Report deps component versions\n   PrintComponentVersions(writer);\n \n+  // Report release metadata.\n+  PrintRelease(writer);\n+\n   // Report operating system and machine information (Windows)\n #ifdef _WIN32\n   {\n@@ -724,12 +730,27 @@ static void PrintComponentVersions(JSONWriter* writer) {\n   NODE_VERSIONS_KEYS(V)\n #undef V\n \n-  // Some extra information that is not present in node_metadata.\n-  writer->json_keyvalue(\"arch\", NODE_ARCH);\n-  writer->json_keyvalue(\"platform\", NODE_PLATFORM);\n-  writer->json_keyvalue(\"release\", NODE_RELEASE);\n-  if (NODE_VERSION_IS_LTS != 0)\n-    writer->json_keyvalue(\"lts\", NODE_VERSION_LTS_CODENAME);\n+  writer->json_objectend();\n+}\n+\n+// Report runtime release information.\n+static void PrintRelease(JSONWriter* writer) {\n+  writer->json_objectstart(\"release\");\n+  writer->json_keyvalue(\"name\", node::per_process::metadata.release.name);\n+#if NODE_VERSION_IS_LTS\n+  writer->json_keyvalue(\"lts\", node::per_process::metadata.release.lts);\n+#endif\n+\n+#ifdef NODE_HAS_RELEASE_URLS\n+  writer->json_keyvalue(\"headersUrl\",\n+                        node::per_process::metadata.release.headers_url);\n+  writer->json_keyvalue(\"sourceUrl\",\n+                        node::per_process::metadata.release.source_url);\n+#ifdef _WIN32\n+  writer->json_keyvalue(\"libUrl\", node::per_process::metadata.release.lib_url);\n+#endif  // _WIN32\n+#endif  // NODE_HAS_RELEASE_URLS\n+\n   writer->json_objectend();\n }\n "
        },
        {
            "sha": "ee3c1f720333f6fcb7eaf88b2085a91d30dac201",
            "filename": "test/common/report.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d0d84b009ce4f2fe274568ed39754c02167e27d3/test%2Fcommon%2Freport.js",
            "raw_url": "https://github.com/nodejs/node/raw/d0d84b009ce4f2fe274568ed39754c02167e27d3/test%2Fcommon%2Freport.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Freport.js?ref=d0d84b009ce4f2fe274568ed39754c02167e27d3",
            "patch": "@@ -34,6 +34,9 @@ function validateContent(data) {\n    'libuv', 'environmentVariables', 'sharedObjects'].forEach((section) => {\n     assert(report.hasOwnProperty(section));\n   });\n+\n+  assert.deepStrictEqual(report.header.componentVersions, process.versions);\n+  assert.deepStrictEqual(report.header.release, process.release);\n }\n \n module.exports = { findReports, validate, validateContent };"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 36,
        "deletions": 10
    }
}