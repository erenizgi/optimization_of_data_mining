{
    "author": "ofrobots",
    "message": "lib: improve error message for MODULE_NOT_FOUND\n\nInclude the require stack in the reported error message.\n\nPR-URL: https://github.com/nodejs/node/pull/25690\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "a02e3e2d5f1f96f3c408270d45935afdd5d1fffc",
    "files": [
        {
            "sha": "b636f39041a5fc8372241098d32d0f14cdd29936",
            "filename": "lib/internal/modules/cjs/loader.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "raw_url": "https://github.com/nodejs/node/raw/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js?ref=a02e3e2d5f1f96f3c408270d45935afdd5d1fffc",
            "patch": "@@ -612,8 +612,12 @@ Module._resolveFilename = function(request, parent, isMain, options) {\n       cursor = cursor.parent) {\n       requireStack.push(cursor.filename || cursor.id);\n     }\n+    let message = `Cannot find module '${request}'`;\n+    if (requireStack.length > 0) {\n+      message = message + '\\nRequire stack:\\n- ' + requireStack.join('\\n- ');\n+    }\n     // eslint-disable-next-line no-restricted-syntax\n-    var err = new Error(`Cannot find module '${request}'`);\n+    var err = new Error(message);\n     err.code = 'MODULE_NOT_FOUND';\n     err.requireStack = requireStack;\n     throw err;"
        },
        {
            "sha": "aa496e5eb66f70b9cffd6da50d544082fd126205",
            "filename": "test/fixtures/require-resolve.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Ffixtures%2Frequire-resolve.js",
            "raw_url": "https://github.com/nodejs/node/raw/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Ffixtures%2Frequire-resolve.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Frequire-resolve.js?ref=a02e3e2d5f1f96f3c408270d45935afdd5d1fffc",
            "patch": "@@ -15,21 +15,21 @@ assert.strictEqual(\n // Verify that existing paths are removed.\n assert.throws(() => {\n   require.resolve('bar', { paths: [] })\n-}, /^Error: Cannot find module 'bar'$/);\n+}, /^Error: Cannot find module 'bar'/);\n \n // Verify that resolution path can be overwritten.\n {\n   // three.js cannot be loaded from this file by default.\n   assert.throws(() => {\n     require.resolve('three')\n-  }, /^Error: Cannot find module 'three'$/);\n+  }, /^Error: Cannot find module 'three'/);\n \n   // If the nested-index directory is provided as a resolve path, 'three'\n   // cannot be found because nested-index is used as a starting point and not\n   // a searched directory.\n   assert.throws(() => {\n     require.resolve('three', { paths: [nestedIndex] })\n-  }, /^Error: Cannot find module 'three'$/);\n+  }, /^Error: Cannot find module 'three'/);\n \n   // Resolution from nested index directory also checks node_modules.\n   assert.strictEqual("
        },
        {
            "sha": "e6bd0c9e14132837b7831c59bf85f11033f95606",
            "filename": "test/parallel/test-internal-modules.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-internal-modules.js",
            "raw_url": "https://github.com/nodejs/node/raw/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-internal-modules.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-internal-modules.js?ref=a02e3e2d5f1f96f3c408270d45935afdd5d1fffc",
            "patch": "@@ -5,7 +5,7 @@ const assert = require('assert');\n \n assert.throws(function() {\n   require('internal/freelist');\n-}, /^Error: Cannot find module 'internal\\/freelist'$/);\n+}, /^Error: Cannot find module 'internal\\/freelist'/);\n \n assert.strictEqual(\n   require(fixtures.path('internal-modules')),"
        },
        {
            "sha": "104681bd792bdf4ae3400eee126b52ff4e858e14",
            "filename": "test/parallel/test-loaders-hidden-from-users.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-loaders-hidden-from-users.js",
            "raw_url": "https://github.com/nodejs/node/raw/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-loaders-hidden-from-users.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-loaders-hidden-from-users.js?ref=a02e3e2d5f1f96f3c408270d45935afdd5d1fffc",
            "patch": "@@ -9,7 +9,7 @@ common.expectsError(\n     require('internal/bootstrap/loaders');\n   }, {\n     code: 'MODULE_NOT_FOUND',\n-    message: 'Cannot find module \\'internal/bootstrap/loaders\\''\n+    message: /Cannot find module 'internal\\/bootstrap\\/loaders'/\n   }\n );\n \n@@ -20,6 +20,6 @@ common.expectsError(\n     require('owo');\n   }, {\n     code: 'MODULE_NOT_FOUND',\n-    message: 'Cannot find module \\'owo\\''\n+    message: /Cannot find module 'owo'/\n   }\n );"
        },
        {
            "sha": "40b6de72a3299bb52237d6f6644cb7d9204e1e9b",
            "filename": "test/parallel/test-module-loading-error.js",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-module-loading-error.js",
            "raw_url": "https://github.com/nodejs/node/raw/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-module-loading-error.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-module-loading-error.js?ref=a02e3e2d5f1f96f3c408270d45935afdd5d1fffc",
            "patch": "@@ -80,9 +80,10 @@ common.expectsError(\n     message: 'The argument \\'id\\' must be a non-empty string. Received \\'\\''\n   });\n \n-common.expectsError(\n+assert.throws(\n   () => { require('../fixtures/packages/is-dir'); },\n   {\n     code: 'MODULE_NOT_FOUND',\n-    message: 'Cannot find module \\'../fixtures/packages/is-dir\\''\n-  });\n+    message: /Cannot find module '\\.\\.\\/fixtures\\/packages\\/is-dir'/\n+  }\n+);"
        },
        {
            "sha": "1257854115a5b5e0ea63436ef4ca87bd986157c4",
            "filename": "test/parallel/test-module-multi-extensions.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-module-multi-extensions.js",
            "raw_url": "https://github.com/nodejs/node/raw/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-module-multi-extensions.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-module-multi-extensions.js?ref=a02e3e2d5f1f96f3c408270d45935afdd5d1fffc",
            "patch": "@@ -35,7 +35,7 @@ fs.writeFileSync(dotfileWithExtension, 'console.log(__filename);', 'utf8');\n   require(modulePath);\n   assert.throws(\n     () => require(`${modulePath}.foo`),\n-    new Error(`Cannot find module '${modulePath}.foo'`)\n+    (err) => err.message.startsWith(`Cannot find module '${modulePath}.foo'`)\n   );\n   require(`${modulePath}.foo.bar`);\n   delete require.cache[file];\n@@ -47,7 +47,7 @@ fs.writeFileSync(dotfileWithExtension, 'console.log(__filename);', 'utf8');\n   const modulePath = path.join(tmpdir.path, 'test-extensions');\n   assert.throws(\n     () => require(modulePath),\n-    new Error(`Cannot find module '${modulePath}'`)\n+    (err) => err.message.startsWith(`Cannot find module '${modulePath}'`)\n   );\n   delete require.cache[file];\n   Module._pathCache = Object.create(null);\n@@ -69,7 +69,7 @@ fs.writeFileSync(dotfileWithExtension, 'console.log(__filename);', 'utf8');\n   const modulePath = path.join(tmpdir.path, 'test-extensions.foo');\n   assert.throws(\n     () => require(modulePath),\n-    new Error(`Cannot find module '${modulePath}'`)\n+    (err) => err.message.startsWith(`Cannot find module '${modulePath}'`)\n   );\n   delete require.extensions['.foo.bar'];\n   Module._pathCache = Object.create(null);"
        },
        {
            "sha": "a53f4a2833d43906f98d3c7a9ecfe61557ab2742",
            "filename": "test/parallel/test-repl.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-repl.js",
            "raw_url": "https://github.com/nodejs/node/raw/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fparallel%2Ftest-repl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl.js?ref=a02e3e2d5f1f96f3c408270d45935afdd5d1fffc",
            "patch": "@@ -534,6 +534,8 @@ const errorTests = [\n     expect: [\n       'Thrown:',\n       /^{ Error: Cannot find module 'internal\\/repl'/,\n+      /^Require stack:/,\n+      /^- <repl>/,\n       /^    at .*/,\n       /^    at .*/,\n       /^    at .*/,"
        },
        {
            "sha": "90ab1d4f4f285c798e272186cf30be5183456b6e",
            "filename": "test/sequential/test-module-loading.js",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fsequential%2Ftest-module-loading.js",
            "raw_url": "https://github.com/nodejs/node/raw/a02e3e2d5f1f96f3c408270d45935afdd5d1fffc/test%2Fsequential%2Ftest-module-loading.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-module-loading.js?ref=a02e3e2d5f1f96f3c408270d45935afdd5d1fffc",
            "patch": "@@ -131,7 +131,7 @@ require('../fixtures/node_modules/foo');\n   assert.ok(my_path.path_func instanceof Function);\n   // this one does not exist and should throw\n   assert.throws(function() { require('./utils'); },\n-                /^Error: Cannot find module '\\.\\/utils'$/);\n+                /^Error: Cannot find module '\\.\\/utils'/);\n }\n \n let errorThrown = false;\n@@ -170,12 +170,13 @@ assert.strictEqual(require('../fixtures/registerExt2').custom, 'passed');\n assert.strictEqual(require('../fixtures/foo').foo, 'ok');\n \n // Should not attempt to load a directory\n-try {\n-  tmpdir.refresh();\n-  require(tmpdir.path);\n-} catch (err) {\n-  assert.strictEqual(err.message, `Cannot find module '${tmpdir.path}'`);\n-}\n+assert.throws(\n+  () => {\n+    tmpdir.refresh();\n+    require(tmpdir.path);\n+  },\n+  (err) => err.message.startsWith(`Cannot find module '${tmpdir.path}`)\n+);\n \n {\n   // Check load order is as expected"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 28,
        "deletions": 20
    }
}