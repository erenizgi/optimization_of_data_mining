{
    "author": "addaleax",
    "message": "fs: simplify FSReqBase slightly\n\nReplace the `data_` member of `FSReqBase` by a boolean flag, because\nthe pointer that `data()` returns is already available through the\n`buffer_` member, and set the default size for not requiring an\nextra allocation to a more reasonable value, as the input is\nusually something like a file path.\n\nPR-URL: https://github.com/nodejs/node/pull/19174\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>",
    "sha": "f96bd54dd54c66970e8d268503fc77803cb9dbfc",
    "files": [
        {
            "sha": "bf277a0e43352506329f640e51586ed3802862da",
            "filename": "src/node_file.h",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/f96bd54dd54c66970e8d268503fc77803cb9dbfc/src%2Fnode_file.h",
            "raw_url": "https://github.com/nodejs/node/raw/f96bd54dd54c66970e8d268503fc77803cb9dbfc/src%2Fnode_file.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.h?ref=f96bd54dd54c66970e8d268503fc77803cb9dbfc",
            "patch": "@@ -39,11 +39,11 @@ class FSReqBase : public ReqWrap<uv_fs_t> {\n     encoding_ = encoding;\n \n     if (data != nullptr) {\n-      CHECK_EQ(data_, nullptr);\n+      CHECK(!has_data_);\n       buffer_.AllocateSufficientStorage(len + 1);\n       buffer_.SetLengthAndZeroTerminate(len);\n       memcpy(*buffer_, data, len);\n-      data_ = *buffer_;\n+      has_data_ = true;\n     }\n   }\n \n@@ -54,17 +54,19 @@ class FSReqBase : public ReqWrap<uv_fs_t> {\n   virtual void SetReturnValue(const FunctionCallbackInfo<Value>& args) = 0;\n \n   const char* syscall() const { return syscall_; }\n-  const char* data() const { return data_; }\n+  const char* data() const { return has_data_ ? *buffer_ : nullptr; }\n   enum encoding encoding() const { return encoding_; }\n \n   size_t self_size() const override { return sizeof(*this); }\n \n  private:\n   enum encoding encoding_ = UTF8;\n+  bool has_data_ = false;\n   const char* syscall_ = nullptr;\n \n-  const char* data_ = nullptr;\n-  MaybeStackBuffer<char> buffer_;\n+  // Typically, the content of buffer_ is something like a file name, so\n+  // something around 64 bytes should be enough.\n+  MaybeStackBuffer<char, 64> buffer_;\n \n   DISALLOW_COPY_AND_ASSIGN(FSReqBase);\n };"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 7,
        "deletions": 5
    }
}