{
    "author": "unknown",
    "message": "deps: cherry-pick 23652c5f from upstream V8\n\nOriginal commit message:\n    Custom tag for the traceEvents array\n\n    This API will be used by Node.js to provide output compatible with\n    Chrome devtools.\n\n    Cq-Include-Trybots: luci.chromium.try:linux_chromium_rel_ng\n    Change-Id: I265495f8af39bfc78d7fdbe43ac308f0920e817d\n    Reviewed-on: https://chromium-review.googlesource.com/1044491\n    Reviewed-by: Aleksey Kozyatinskiy <kozyatinskiy@chromium.org>\n    Reviewed-by: Ulan Degenbaev <ulan@chromium.org>\n    Commit-Queue: Eugene Ostroukhov <eostroukhov@chromium.org>\n    Cr-Commit-Position: refs/heads/master@{#53041}\n\nPR-URL: https://github.com/nodejs/node/pull/20608\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ali Ijaz Sheikh <ofrobots@google.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "1fb0b2cb92bdfb0b73cd4d333436794775d4630d",
    "files": [
        {
            "sha": "dff0f092ebe451d1d92f48b4bd39f86ee136cbe5",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=1fb0b2cb92bdfb0b73cd4d333436794775d4630d",
            "patch": "@@ -27,7 +27,7 @@\n \n     # Reset this number to 0 on major V8 upgrades.\n     # Increment by one for each non-official patch applied to deps/v8.\n-    'v8_embedder_string': '-node.3',\n+    'v8_embedder_string': '-node.4',\n \n     # Enable disassembler for `--print-code` v8 options\n     'v8_enable_disassembler': 1,"
        },
        {
            "sha": "e430e7c3502741bc91d021b9dbab5e1bfd6949bb",
            "filename": "deps/v8/include/libplatform/v8-tracing.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/deps%2Fv8%2Finclude%2Flibplatform%2Fv8-tracing.h",
            "raw_url": "https://github.com/nodejs/node/raw/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/deps%2Fv8%2Finclude%2Flibplatform%2Fv8-tracing.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Flibplatform%2Fv8-tracing.h?ref=1fb0b2cb92bdfb0b73cd4d333436794775d4630d",
            "patch": "@@ -112,6 +112,8 @@ class V8_PLATFORM_EXPORT TraceWriter {\n   virtual void Flush() = 0;\n \n   static TraceWriter* CreateJSONTraceWriter(std::ostream& stream);\n+  static TraceWriter* CreateJSONTraceWriter(std::ostream& stream,\n+                                            const std::string& tag);\n \n  private:\n   // Disallow copy and assign"
        },
        {
            "sha": "7bfc7664694f8d4dc21b2db5b7148cc72150ff4d",
            "filename": "deps/v8/src/libplatform/tracing/trace-writer.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 2,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/deps%2Fv8%2Fsrc%2Flibplatform%2Ftracing%2Ftrace-writer.cc",
            "raw_url": "https://github.com/nodejs/node/raw/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/deps%2Fv8%2Fsrc%2Flibplatform%2Ftracing%2Ftrace-writer.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Flibplatform%2Ftracing%2Ftrace-writer.cc?ref=1fb0b2cb92bdfb0b73cd4d333436794775d4630d",
            "patch": "@@ -119,8 +119,12 @@ void JSONTraceWriter::AppendArgValue(ConvertableToTraceFormat* value) {\n   stream_ << arg_stringified;\n }\n \n-JSONTraceWriter::JSONTraceWriter(std::ostream& stream) : stream_(stream) {\n-  stream_ << \"{\\\"traceEvents\\\":[\";\n+JSONTraceWriter::JSONTraceWriter(std::ostream& stream)\n+    : JSONTraceWriter(stream, \"traceEvents\") {}\n+\n+JSONTraceWriter::JSONTraceWriter(std::ostream& stream, const std::string& tag)\n+    : stream_(stream) {\n+  stream_ << \"{\\\"\" << tag << \"\\\":[\";\n }\n \n JSONTraceWriter::~JSONTraceWriter() { stream_ << \"]}\"; }\n@@ -171,6 +175,11 @@ TraceWriter* TraceWriter::CreateJSONTraceWriter(std::ostream& stream) {\n   return new JSONTraceWriter(stream);\n }\n \n+TraceWriter* TraceWriter::CreateJSONTraceWriter(std::ostream& stream,\n+                                                const std::string& tag) {\n+  return new JSONTraceWriter(stream, tag);\n+}\n+\n }  // namespace tracing\n }  // namespace platform\n }  // namespace v8"
        },
        {
            "sha": "d81135138992f726ad9e440ef29757f0a9f4fa17",
            "filename": "deps/v8/src/libplatform/tracing/trace-writer.h",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/deps%2Fv8%2Fsrc%2Flibplatform%2Ftracing%2Ftrace-writer.h",
            "raw_url": "https://github.com/nodejs/node/raw/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/deps%2Fv8%2Fsrc%2Flibplatform%2Ftracing%2Ftrace-writer.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Flibplatform%2Ftracing%2Ftrace-writer.h?ref=1fb0b2cb92bdfb0b73cd4d333436794775d4630d",
            "patch": "@@ -14,6 +14,7 @@ namespace tracing {\n class JSONTraceWriter : public TraceWriter {\n  public:\n   explicit JSONTraceWriter(std::ostream& stream);\n+  JSONTraceWriter(std::ostream& stream, const std::string& tag);\n   ~JSONTraceWriter();\n   void AppendTraceEvent(TraceObject* trace_event) override;\n   void Flush() override;"
        },
        {
            "sha": "b949785bcfacbefed21622d3d4574eeea9a73041",
            "filename": "deps/v8/test/cctest/libplatform/test-tracing.cc",
            "status": "modified",
            "additions": 48,
            "deletions": 35,
            "changes": 83,
            "blob_url": "https://github.com/nodejs/node/blob/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/deps%2Fv8%2Ftest%2Fcctest%2Flibplatform%2Ftest-tracing.cc",
            "raw_url": "https://github.com/nodejs/node/raw/1fb0b2cb92bdfb0b73cd4d333436794775d4630d/deps%2Fv8%2Ftest%2Fcctest%2Flibplatform%2Ftest-tracing.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Flibplatform%2Ftest-tracing.cc?ref=1fb0b2cb92bdfb0b73cd4d333436794775d4630d",
            "patch": "@@ -128,44 +128,42 @@ TEST(TestTraceBufferRingBuffer) {\n   delete ring_buffer;\n }\n \n-TEST(TestJSONTraceWriter) {\n-  std::ostringstream stream;\n-  // Create a scope for the tracing controller to terminate the trace writer.\n-  {\n-    v8::Platform* old_platform = i::V8::GetCurrentPlatform();\n-    std::unique_ptr<v8::Platform> default_platform(\n-        v8::platform::NewDefaultPlatform());\n-    i::V8::SetPlatformForTesting(default_platform.get());\n-    auto tracing =\n-        base::make_unique<v8::platform::tracing::TracingController>();\n-    v8::platform::tracing::TracingController* tracing_controller =\n-        tracing.get();\n-    static_cast<v8::platform::DefaultPlatform*>(default_platform.get())\n-        ->SetTracingController(std::move(tracing));\n-    TraceWriter* writer = TraceWriter::CreateJSONTraceWriter(stream);\n+void PopulateJSONWriter(TraceWriter* writer) {\n+  v8::Platform* old_platform = i::V8::GetCurrentPlatform();\n+  std::unique_ptr<v8::Platform> default_platform(\n+      v8::platform::NewDefaultPlatform());\n+  i::V8::SetPlatformForTesting(default_platform.get());\n+  auto tracing = base::make_unique<v8::platform::tracing::TracingController>();\n+  v8::platform::tracing::TracingController* tracing_controller = tracing.get();\n+  static_cast<v8::platform::DefaultPlatform*>(default_platform.get())\n+      ->SetTracingController(std::move(tracing));\n \n-    TraceBuffer* ring_buffer =\n-        TraceBuffer::CreateTraceBufferRingBuffer(1, writer);\n-    tracing_controller->Initialize(ring_buffer);\n-    TraceConfig* trace_config = new TraceConfig();\n-    trace_config->AddIncludedCategory(\"v8-cat\");\n-    tracing_controller->StartTracing(trace_config);\n+  TraceBuffer* ring_buffer =\n+      TraceBuffer::CreateTraceBufferRingBuffer(1, writer);\n+  tracing_controller->Initialize(ring_buffer);\n+  TraceConfig* trace_config = new TraceConfig();\n+  trace_config->AddIncludedCategory(\"v8-cat\");\n+  tracing_controller->StartTracing(trace_config);\n \n-    TraceObject trace_object;\n-    trace_object.InitializeForTesting(\n-        'X', tracing_controller->GetCategoryGroupEnabled(\"v8-cat\"), \"Test0\",\n-        v8::internal::tracing::kGlobalScope, 42, 123, 0, nullptr, nullptr,\n-        nullptr, nullptr, TRACE_EVENT_FLAG_HAS_ID, 11, 22, 100, 50, 33, 44);\n-    writer->AppendTraceEvent(&trace_object);\n-    trace_object.InitializeForTesting(\n-        'Y', tracing_controller->GetCategoryGroupEnabled(\"v8-cat\"), \"Test1\",\n-        v8::internal::tracing::kGlobalScope, 43, 456, 0, nullptr, nullptr,\n-        nullptr, nullptr, 0, 55, 66, 110, 55, 77, 88);\n-    writer->AppendTraceEvent(&trace_object);\n-    tracing_controller->StopTracing();\n-    i::V8::SetPlatformForTesting(old_platform);\n-  }\n+  TraceObject trace_object;\n+  trace_object.InitializeForTesting(\n+      'X', tracing_controller->GetCategoryGroupEnabled(\"v8-cat\"), \"Test0\",\n+      v8::internal::tracing::kGlobalScope, 42, 123, 0, nullptr, nullptr,\n+      nullptr, nullptr, TRACE_EVENT_FLAG_HAS_ID, 11, 22, 100, 50, 33, 44);\n+  writer->AppendTraceEvent(&trace_object);\n+  trace_object.InitializeForTesting(\n+      'Y', tracing_controller->GetCategoryGroupEnabled(\"v8-cat\"), \"Test1\",\n+      v8::internal::tracing::kGlobalScope, 43, 456, 0, nullptr, nullptr,\n+      nullptr, nullptr, 0, 55, 66, 110, 55, 77, 88);\n+  writer->AppendTraceEvent(&trace_object);\n+  tracing_controller->StopTracing();\n+  i::V8::SetPlatformForTesting(old_platform);\n+}\n \n+TEST(TestJSONTraceWriter) {\n+  std::ostringstream stream;\n+  TraceWriter* writer = TraceWriter::CreateJSONTraceWriter(stream);\n+  PopulateJSONWriter(writer);\n   std::string trace_str = stream.str();\n   std::string expected_trace_str =\n       \"{\\\"traceEvents\\\":[{\\\"pid\\\":11,\\\"tid\\\":22,\\\"ts\\\":100,\\\"tts\\\":50,\"\n@@ -177,6 +175,21 @@ TEST(TestJSONTraceWriter) {\n   CHECK_EQ(expected_trace_str, trace_str);\n }\n \n+TEST(TestJSONTraceWriterWithCustomtag) {\n+  std::ostringstream stream;\n+  TraceWriter* writer = TraceWriter::CreateJSONTraceWriter(stream, \"customTag\");\n+  PopulateJSONWriter(writer);\n+  std::string trace_str = stream.str();\n+  std::string expected_trace_str =\n+      \"{\\\"customTag\\\":[{\\\"pid\\\":11,\\\"tid\\\":22,\\\"ts\\\":100,\\\"tts\\\":50,\"\n+      \"\\\"ph\\\":\\\"X\\\",\\\"cat\\\":\\\"v8-cat\\\",\\\"name\\\":\\\"Test0\\\",\\\"dur\\\":33,\"\n+      \"\\\"tdur\\\":44,\\\"id\\\":\\\"0x2a\\\",\\\"args\\\":{}},{\\\"pid\\\":55,\\\"tid\\\":66,\"\n+      \"\\\"ts\\\":110,\\\"tts\\\":55,\\\"ph\\\":\\\"Y\\\",\\\"cat\\\":\\\"v8-cat\\\",\\\"name\\\":\"\n+      \"\\\"Test1\\\",\\\"dur\\\":77,\\\"tdur\\\":88,\\\"args\\\":{}}]}\";\n+\n+  CHECK_EQ(expected_trace_str, trace_str);\n+}\n+\n TEST(TestTracingController) {\n   v8::Platform* old_platform = i::V8::GetCurrentPlatform();\n   std::unique_ptr<v8::Platform> default_platform("
        }
    ],
    "stats": {
        "total": 101,
        "additions": 63,
        "deletions": 38
    }
}