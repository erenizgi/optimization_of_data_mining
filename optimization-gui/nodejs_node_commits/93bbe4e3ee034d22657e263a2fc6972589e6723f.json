{
    "author": "addaleax",
    "message": "deps,src: align ssize_t ABI between Node & nghttp2\n\nPreviously, we performed casts that are considered undefined behavior.\nInstead, just define `ssize_t` for nghttp2 the same way we define it\nfor the rest of Node.\n\nAlso, remove a TODO comment that would probably also be *technically*\ncorrect but shouldnâ€™t matter as long as nobody is complaining.\n\nPR-URL: https://github.com/nodejs/node/pull/18565\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "93bbe4e3ee034d22657e263a2fc6972589e6723f",
    "files": [
        {
            "sha": "242bbcfb62ff7aafa6f2ed788848908751e0cb17",
            "filename": "deps/nghttp2/lib/includes/config.h",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/93bbe4e3ee034d22657e263a2fc6972589e6723f/deps%2Fnghttp2%2Flib%2Fincludes%2Fconfig.h",
            "raw_url": "https://github.com/nodejs/node/raw/93bbe4e3ee034d22657e263a2fc6972589e6723f/deps%2Fnghttp2%2Flib%2Fincludes%2Fconfig.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fnghttp2%2Flib%2Fincludes%2Fconfig.h?ref=93bbe4e3ee034d22657e263a2fc6972589e6723f",
            "patch": "@@ -1,8 +1,18 @@\n /* Hint to the compiler that a function never returns */\n #define NGHTTP2_NORETURN\n \n-/* Define to `int' if <sys/types.h> does not define. */\n-#define ssize_t int\n+/* Edited to match src/node.h. */\n+#include <stdint.h>\n+\n+#ifdef _WIN32\n+#if !defined(_SSIZE_T_) && !defined(_SSIZE_T_DEFINED)\n+typedef intptr_t ssize_t;\n+# define _SSIZE_T_\n+# define _SSIZE_T_DEFINED\n+#endif\n+#else  // !_WIN32\n+# include <sys/types.h>  // size_t, ssize_t\n+#endif  // _WIN32\n \n /* Define to 1 if you have the `std::map::emplace`. */\n #define HAVE_STD_MAP_EMPLACE 1"
        },
        {
            "sha": "89dbdfc727b0c5cefc47e230a94a017225dd1bf7",
            "filename": "src/node.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/93bbe4e3ee034d22657e263a2fc6972589e6723f/src%2Fnode.h",
            "raw_url": "https://github.com/nodejs/node/raw/93bbe4e3ee034d22657e263a2fc6972589e6723f/src%2Fnode.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.h?ref=93bbe4e3ee034d22657e263a2fc6972589e6723f",
            "patch": "@@ -184,7 +184,6 @@ NODE_EXTERN v8::Local<v8::Value> MakeCallback(\n #endif\n \n #ifdef _WIN32\n-// TODO(tjfontaine) consider changing the usage of ssize_t to ptrdiff_t\n #if !defined(_SSIZE_T_) && !defined(_SSIZE_T_DEFINED)\n typedef intptr_t ssize_t;\n # define _SSIZE_T_"
        },
        {
            "sha": "2f688a4b352a15ac815076412093e006f0c536a5",
            "filename": "src/node_http2.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 11,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/93bbe4e3ee034d22657e263a2fc6972589e6723f/src%2Fnode_http2.cc",
            "raw_url": "https://github.com/nodejs/node/raw/93bbe4e3ee034d22657e263a2fc6972589e6723f/src%2Fnode_http2.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http2.cc?ref=93bbe4e3ee034d22657e263a2fc6972589e6723f",
            "patch": "@@ -764,13 +764,7 @@ inline ssize_t Http2Session::Write(const uv_buf_t* bufs, size_t nbufs) {\n                                bufs[n].len);\n     CHECK_NE(ret, NGHTTP2_ERR_NOMEM);\n \n-    // If there is an error calling any of the callbacks, ret will be a\n-    // negative number identifying the error code. This can happen, for\n-    // instance, if the session is destroyed during any of the JS callbacks\n-    // Note: if ssize_t is not defined (e.g. on Win32), nghttp2 will typedef\n-    // ssize_t to int. Cast here so that the < 0 check actually works on\n-    // Windows.\n-    if (static_cast<int>(ret) < 0)\n+    if (ret < 0)\n       return ret;\n \n     total += ret;\n@@ -1709,10 +1703,7 @@ void Http2Session::OnStreamRead(ssize_t nread, const uv_buf_t& buf) {\n     statistics_.data_received += nread;\n     ssize_t ret = Write(&stream_buf_, 1);\n \n-    // Note: if ssize_t is not defined (e.g. on Win32), nghttp2 will typedef\n-    // ssize_t to int. Cast here so that the < 0 check actually works on\n-    // Windows.\n-    if (static_cast<int>(ret) < 0) {\n+    if (ret < 0) {\n       DEBUG_HTTP2SESSION2(this, \"fatal error receiving data: %d\", ret);\n \n       Local<Value> argv[] = {"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 14,
        "deletions": 14
    }
}