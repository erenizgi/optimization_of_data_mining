{
    "author": "mcollina",
    "message": "test: fixed flaky test-http-readable-data-event\n\nFixes: https://github.com/nodejs/node/issues/19905\n\nPR-URL: https://github.com/nodejs/node/pull/19931\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "5a8fcd0d94f654af89d722760c00c03f2bbb972f",
    "files": [
        {
            "sha": "1c48a451ef9714a894249e55168e9886023fdd51",
            "filename": "test/parallel/test-http-readable-data-event.js",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/5a8fcd0d94f654af89d722760c00c03f2bbb972f/test%2Fparallel%2Ftest-http-readable-data-event.js",
            "raw_url": "https://github.com/nodejs/node/raw/5a8fcd0d94f654af89d722760c00c03f2bbb972f/test%2Fparallel%2Ftest-http-readable-data-event.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-readable-data-event.js?ref=5a8fcd0d94f654af89d722760c00c03f2bbb972f",
            "patch": "@@ -6,16 +6,21 @@ const http = require('http');\n const helloWorld = 'Hello World!';\n const helloAgainLater = 'Hello again later!';\n \n+let next = null;\n+\n const server = http.createServer((req, res) => {\n   res.writeHead(200, {\n     'Content-Length': '' + (helloWorld.length + helloAgainLater.length)\n   });\n-  res.write(helloWorld);\n \n   // we need to make sure the data is flushed\n-  setTimeout(() => {\n+  // before writing again\n+  next = () => {\n     res.end(helloAgainLater);\n-  }, common.platformTimeout(10));\n+    next = () => {};\n+  };\n+\n+  res.write(helloWorld);\n }).listen(0, function() {\n   const opts = {\n     hostname: 'localhost',\n@@ -27,14 +32,15 @@ const server = http.createServer((req, res) => {\n   const expectedRead = [helloWorld, null, helloAgainLater, null];\n \n   const req = http.request(opts, (res) => {\n-    res.on('error', common.mustNotCall);\n+    res.on('error', common.mustNotCall());\n \n     res.on('readable', common.mustCall(() => {\n       let data;\n \n       do {\n         data = res.read();\n         assert.strictEqual(data, expectedRead.shift());\n+        next();\n       } while (data !== null);\n     }, 2));\n "
        }
    ],
    "stats": {
        "total": 14,
        "additions": 10,
        "deletions": 4
    }
}