{
    "author": "timdp",
    "message": "http: make ClientRequest#setTimeout() noop at end\n\nOriginally discovered and resolved by @szmarczak.\n\nPR-URL: https://github.com/nodejs/node/pull/25536\nFixes: https://github.com/nodejs/node/issues/25499\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "1b11824f514ac6fea77b7ae7b92e2ab64d970351",
    "files": [
        {
            "sha": "943441f1a1db33dd4ef5fe410309e7b96dfa1e67",
            "filename": "lib/_http_client.js",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/1b11824f514ac6fea77b7ae7b92e2ab64d970351/lib%2F_http_client.js",
            "raw_url": "https://github.com/nodejs/node/raw/1b11824f514ac6fea77b7ae7b92e2ab64d970351/lib%2F_http_client.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_client.js?ref=1b11824f514ac6fea77b7ae7b92e2ab64d970351",
            "patch": "@@ -731,6 +731,10 @@ function _deferToConnect(method, arguments_, cb) {\n }\n \n ClientRequest.prototype.setTimeout = function setTimeout(msecs, callback) {\n+  if (this._ended) {\n+    return this;\n+  }\n+\n   listenSocketTimeout(this);\n   msecs = validateTimerDuration(msecs);\n   if (callback) this.once('timeout', callback);"
        },
        {
            "sha": "99bbf3dd1bc766614e922cf87f440b18d8d80ff3",
            "filename": "test/parallel/test-http-client-set-timeout-after-end.js",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/1b11824f514ac6fea77b7ae7b92e2ab64d970351/test%2Fparallel%2Ftest-http-client-set-timeout-after-end.js",
            "raw_url": "https://github.com/nodejs/node/raw/1b11824f514ac6fea77b7ae7b92e2ab64d970351/test%2Fparallel%2Ftest-http-client-set-timeout-after-end.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-client-set-timeout-after-end.js?ref=1b11824f514ac6fea77b7ae7b92e2ab64d970351",
            "patch": "@@ -0,0 +1,33 @@\n+'use strict';\n+\n+// Test https://github.com/nodejs/node/issues/25499 fix.\n+\n+const { mustCall } = require('../common');\n+\n+const { Agent, createServer, get } = require('http');\n+const { strictEqual } = require('assert');\n+\n+const server = createServer(mustCall((req, res) => {\n+  res.end();\n+}));\n+\n+server.listen(0, () => {\n+  const agent = new Agent({ keepAlive: true, maxSockets: 1 });\n+  const port = server.address().port;\n+\n+  let socket;\n+\n+  const req = get({ agent, port }, (res) => {\n+    res.on('end', () => {\n+      strictEqual(req.setTimeout(0), req);\n+      strictEqual(socket.listenerCount('timeout'), 0);\n+      agent.destroy();\n+      server.close();\n+    });\n+    res.resume();\n+  });\n+\n+  req.on('socket', (sock) => {\n+    socket = sock;\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 37,
        "deletions": 0
    }
}