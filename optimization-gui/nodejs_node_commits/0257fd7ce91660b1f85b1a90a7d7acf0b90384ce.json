{
    "author": "jasnell",
    "message": "process: wrap process.binding for selective fallthrough\n\nSelectively fallthrough `process.binding()` to `internalBinding()`\n\nRefs: https://github.com/nodejs/node/pull/22163\n\nPR-URL: https://github.com/nodejs/node/pull/22269\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: John-David Dalton <john.david.dalton@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "0257fd7ce91660b1f85b1a90a7d7acf0b90384ce",
    "files": [
        {
            "sha": "08daeb191551e59d0ae0f46be5409669da358394",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/0257fd7ce91660b1f85b1a90a7d7acf0b90384ce/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/0257fd7ce91660b1f85b1a90a7d7acf0b90384ce/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=0257fd7ce91660b1f85b1a90a7d7acf0b90384ce",
            "patch": "@@ -318,6 +318,21 @@\n       for (var i = 0; i < arguments.length; i++)\n         this.push(arguments[i]);\n     }\n+\n+    // Deprecated specific process.binding() modules, but not all, allow\n+    // selective fallback to internalBinding for the deprecated ones.\n+    const { SafeSet } = NativeModule.require('internal/safe_globals');\n+    const processBinding = process.binding;\n+    // internalBindingWhitelist contains the name of internalBinding modules\n+    // that are whitelisted for access via process.binding()... this is used\n+    // to provide a transition path for modules that are being moved over to\n+    // internalBinding.\n+    const internalBindingWhitelist = new SafeSet(['uv']);\n+    process.binding = function binding(name) {\n+      return internalBindingWhitelist.has(name) ?\n+        internalBinding(name) :\n+        processBinding(name);\n+    };\n   }\n \n   function setupGlobalVariables() {"
        },
        {
            "sha": "ece967a0b76ab9d056b0236fc7f576613e7ce4aa",
            "filename": "test/parallel/test-process-binding-internalbinding-whitelist.js",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/0257fd7ce91660b1f85b1a90a7d7acf0b90384ce/test%2Fparallel%2Ftest-process-binding-internalbinding-whitelist.js",
            "raw_url": "https://github.com/nodejs/node/raw/0257fd7ce91660b1f85b1a90a7d7acf0b90384ce/test%2Fparallel%2Ftest-process-binding-internalbinding-whitelist.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-binding-internalbinding-whitelist.js?ref=0257fd7ce91660b1f85b1a90a7d7acf0b90384ce",
            "patch": "@@ -0,0 +1,9 @@\n+// Flags: --no-warnings\n+'use strict';\n+\n+require('../common');\n+const assert = require('assert');\n+\n+// Assert that whitelisted internalBinding modules are accessible via\n+// process.binding().\n+assert(process.binding('uv'));"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 24,
        "deletions": 0
    }
}