{
    "author": "Trott",
    "message": "test: apply promises API to third appendFile test\n\nAdd tests for `fs.promises.appendFile()` to the third (of five) test\ncase in `test-fs-access`. (First and second test cases already have\npromises API versions.)\n\nPR-URL: https://github.com/nodejs/node/pull/21131\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "16d63e629d433c27d431260322fd3cd53f910e0c",
    "files": [
        {
            "sha": "05dcee43e6cf5ec6b60df82a338c338d450eac7f",
            "filename": "test/parallel/test-fs-append-file.js",
            "status": "modified",
            "additions": 28,
            "deletions": 15,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/16d63e629d433c27d431260322fd3cd53f910e0c/test%2Fparallel%2Ftest-fs-append-file.js",
            "raw_url": "https://github.com/nodejs/node/raw/16d63e629d433c27d431260322fd3cd53f910e0c/test%2Fparallel%2Ftest-fs-append-file.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-append-file.js?ref=16d63e629d433c27d431260322fd3cd53f910e0c",
            "patch": "@@ -100,23 +100,37 @@ const throwNextTick = (e) => { process.nextTick(() => { throw e; }); };\n     .catch(throwNextTick);\n }\n \n-// test that appendFile accepts buffers\n-const filename3 = join(tmpdir.path, 'append3.txt');\n-fs.writeFileSync(filename3, currentFileData);\n+// test that appendFile accepts buffers (callback API)\n+{\n+  const filename = join(tmpdir.path, 'append-buffer.txt');\n+  fs.writeFileSync(filename, currentFileData);\n \n-const buf = Buffer.from(s, 'utf8');\n+  const buf = Buffer.from(s, 'utf8');\n \n-fs.appendFile(filename3, buf, function(e) {\n-  assert.ifError(e);\n+  fs.appendFile(filename, buf, common.mustCall((e) => {\n+    assert.ifError(e);\n \n-  ncallbacks++;\n+    fs.readFile(filename, common.mustCall((e, buffer) => {\n+      assert.ifError(e);\n+      assert.strictEqual(buf.length + currentFileData.length, buffer.length);\n+    }));\n+  }));\n+}\n \n-  fs.readFile(filename3, function(e, buffer) {\n-    assert.ifError(e);\n-    ncallbacks++;\n-    assert.strictEqual(buf.length + currentFileData.length, buffer.length);\n-  });\n-});\n+// test that appendFile accepts buffers (promises API)\n+{\n+  const filename = join(tmpdir.path, 'append-buffer-promises.txt');\n+  fs.writeFileSync(filename, currentFileData);\n+\n+  const buf = Buffer.from(s, 'utf8');\n+\n+  fs.promises.appendFile(filename, buf)\n+    .then(common.mustCall(() => fs.promises.readFile(filename)))\n+    .then((buffer) => {\n+      assert.strictEqual(buf.length + currentFileData.length, buffer.length);\n+    })\n+    .catch(throwNextTick);\n+}\n \n // test that appendFile accepts numbers.\n const filename4 = join(tmpdir.path, 'append4.txt');\n@@ -177,9 +191,8 @@ assert.throws(\n   { code: 'ERR_INVALID_CALLBACK' });\n \n process.on('exit', function() {\n-  assert.strictEqual(ncallbacks, 8);\n+  assert.strictEqual(ncallbacks, 6);\n \n-  fs.unlinkSync(filename3);\n   fs.unlinkSync(filename4);\n   fs.unlinkSync(filename5);\n });"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 28,
        "deletions": 15
    }
}