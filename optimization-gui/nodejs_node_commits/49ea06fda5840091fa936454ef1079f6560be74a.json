{
    "author": "cjihrig",
    "message": "net: report uv_tcp_open() errors\n\nuv_tcp_open() can fail. Prior to this commit, any error was\nbeing silently ignored. This commit raises the errors.\n\nPR-URL: https://github.com/nodejs/node/pull/21428\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "49ea06fda5840091fa936454ef1079f6560be74a",
    "files": [
        {
            "sha": "f8af082a85a1a4e852a0c33d3c31c4feb48bbd2e",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/49ea06fda5840091fa936454ef1079f6560be74a/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/49ea06fda5840091fa936454ef1079f6560be74a/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=49ea06fda5840091fa936454ef1079f6560be74a",
            "patch": "@@ -260,8 +260,14 @@ function Socket(options) {\n     this[async_id_symbol] = getNewAsyncId(this._handle);\n   } else if (options.fd !== undefined) {\n     const { fd } = options;\n+    let err;\n+\n     this._handle = createHandle(fd, false);\n-    this._handle.open(fd);\n+\n+    err = this._handle.open(fd);\n+    if (err)\n+      throw errnoException(err, 'open');\n+\n     this[async_id_symbol] = this._handle.getAsyncId();\n     // options.fd can be string (since it is user-defined),\n     // so changing this to === would be semver-major\n@@ -271,7 +277,7 @@ function Socket(options) {\n         (this._handle instanceof Pipe) &&\n         process.platform === 'win32') {\n       // Make stdout and stderr blocking on Windows\n-      var err = this._handle.setBlocking(true);\n+      err = this._handle.setBlocking(true);\n       if (err)\n         throw errnoException(err, 'setBlocking');\n \n@@ -1237,7 +1243,11 @@ function createServerHandle(address, port, addressType, fd) {\n       debug('listen invalid fd=%d:', fd, e.message);\n       return UV_EINVAL;\n     }\n-    handle.open(fd);\n+\n+    err = handle.open(fd);\n+    if (err)\n+      return err;\n+\n     handle.readable = true;\n     handle.writable = true;\n     assert(!address && !port);"
        },
        {
            "sha": "28a970a22647ca1ac598f4b96061f7581d6f9914",
            "filename": "src/tcp_wrap.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/49ea06fda5840091fa936454ef1079f6560be74a/src%2Ftcp_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/49ea06fda5840091fa936454ef1079f6560be74a/src%2Ftcp_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftcp_wrap.cc?ref=49ea06fda5840091fa936454ef1079f6560be74a",
            "patch": "@@ -211,8 +211,12 @@ void TCPWrap::Open(const FunctionCallbackInfo<Value>& args) {\n                           args.Holder(),\n                           args.GetReturnValue().Set(UV_EBADF));\n   int fd = static_cast<int>(args[0]->IntegerValue());\n-  uv_tcp_open(&wrap->handle_, fd);\n-  wrap->set_fd(fd);\n+  int err = uv_tcp_open(&wrap->handle_, fd);\n+\n+  if (err == 0)\n+    wrap->set_fd(fd);\n+\n+  args.GetReturnValue().Set(err);\n }\n \n "
        }
    ],
    "stats": {
        "total": 24,
        "additions": 19,
        "deletions": 5
    }
}