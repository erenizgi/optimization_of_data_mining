{
    "author": "cjihrig",
    "message": "report: remove verbose setting\n\nThis commit removes the --diagnostic-report-verbose CLI option\nand all associated logic. The flag is currently only used in one\nplace, and only reflects the settings at startup. Additionally,\nNode tends to use the NODE_DEBUG mechanism for adding verbose\noutput.\n\nPR-URL: https://github.com/nodejs/node/pull/26195\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "823c988b482e609978869820758b7182f32e9de5",
    "files": [
        {
            "sha": "a4866e94d51e9c6ebccbe290aae3640ad61390c9",
            "filename": "doc/api/cli.md",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/823c988b482e609978869820758b7182f32e9de5/doc%2Fapi%2Fcli.md",
            "raw_url": "https://github.com/nodejs/node/raw/823c988b482e609978869820758b7182f32e9de5/doc%2Fapi%2Fcli.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fcli.md?ref=823c988b482e609978869820758b7182f32e9de5",
            "patch": "@@ -126,13 +126,6 @@ Enables report to be generated on un-caught exceptions, if\n `--experimental-report` is enabled. Useful when inspecting JavaScript stack in\n conjunction with native stack and other runtime environment data.\n \n-### `--diagnostic-report-verbose`\n-<!-- YAML\n-added: v11.8.0\n--->\n-\n-Flag that enables additional information to be printed during report generation.\n-\n ### `--enable-fips`\n <!-- YAML\n added: v6.0.0\n@@ -688,7 +681,6 @@ Node.js options that are allowed are:\n - `--diagnostic-report-on-signal`\n - `--diagnostic-report-signal`\n - `--diagnostic-report-uncaught-exception`\n-- `--diagnostic-report-verbose`\n - `--enable-fips`\n - `--experimental-modules`\n - `--experimental-repl-await`"
        },
        {
            "sha": "1a009bce546473e4e90b9aae8ef2f4f0e4eacd6a",
            "filename": "doc/api/process.md",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/823c988b482e609978869820758b7182f32e9de5/doc%2Fapi%2Fprocess.md",
            "raw_url": "https://github.com/nodejs/node/raw/823c988b482e609978869820758b7182f32e9de5/doc%2Fapi%2Fprocess.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fprocess.md?ref=823c988b482e609978869820758b7182f32e9de5",
            "patch": "@@ -1703,8 +1703,6 @@ added: v11.8.0\n   * `filename` {string} Name of the file where the report is written.\n   * `path` {string} Directory where the report is written.\n     **Default:** the current working directory of the Node.js process.\n-  * `verbose` {boolean} Flag that controls additional verbose information on\n-    report generation. **Default:** `false`.\n \n Configures the diagnostic reporting behavior. Upon invocation, the runtime\n is reconfigured to generate reports based on `options`. Several usage examples\n@@ -1721,9 +1719,6 @@ process.report.setOptions({ filename: 'foo.json', path: '/home' });\n // to `stdout` and `stderr`. Usage of these will result in report being written\n // to the associated standard streams. URLs are not supported.\n process.report.setOptions({ filename: 'stdout' });\n-\n-// Enable verbose option on report generation.\n-process.report.setOptions({ verbose: true });\n ```\n \n Signal based report generation is not supported on Windows."
        },
        {
            "sha": "419fe33417345d5772100bce9df1b9112d710585",
            "filename": "doc/api/report.md",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/823c988b482e609978869820758b7182f32e9de5/doc%2Fapi%2Freport.md",
            "raw_url": "https://github.com/nodejs/node/raw/823c988b482e609978869820758b7182f32e9de5/doc%2Fapi%2Freport.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Freport.md?ref=823c988b482e609978869820758b7182f32e9de5",
            "patch": "@@ -401,9 +401,6 @@ written.\n * `--diagnostic-report-signal` Sets or resets the signal for report generation\n (not supported on Windows). Default signal is `SIGUSR2`.\n \n-* `--diagnostic-report-verbose` Flag that enables additional information to be\n-printed during report generation.\n-\n A report can also be triggered via an API call from a JavaScript application:\n \n ```js\n@@ -495,8 +492,7 @@ process.report.setOptions({\n   events: ['exception', 'fatalerror', 'signal'],\n   signal: 'SIGUSR2',\n   filename: 'myreport.json',\n-  path: '/home/nodeuser',\n-  verbose: true\n+  path: '/home/nodeuser'\n });\n ```\n \n@@ -519,9 +515,6 @@ timestamp, PID and sequence number.\n URLs are not supported. Defaults to the current working directory of the\n Node.js process.\n \n-`verbose` specifies whether to print additional verbose messages\n-pertinent to the report generation. Defaults to `false`.\n-\n ```js\n // Trigger report only on uncaught exceptions.\n process.report.setOptions({ events: ['exception'] });\n@@ -541,7 +534,7 @@ environment variables:\n NODE_OPTIONS=\"--experimental-report --diagnostic-report-uncaught-exception \\\n   --diagnostic-report-on-fatalerror --diagnostic-report-on-signal \\\n   --diagnostic-report-signal=SIGUSR2  --diagnostic-report-filename=./report.json \\\n-  --diagnostic-report-directory=/home/nodeuser --diagnostic-report-verbose\"\n+  --diagnostic-report-directory=/home/nodeuser\"\n ```\n \n Specific API documentation can be found under"
        },
        {
            "sha": "266a5a3f9d2f106d58c164e11ca82dd343b83213",
            "filename": "doc/node.1",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/823c988b482e609978869820758b7182f32e9de5/doc%2Fnode.1",
            "raw_url": "https://github.com/nodejs/node/raw/823c988b482e609978869820758b7182f32e9de5/doc%2Fnode.1",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fnode.1?ref=823c988b482e609978869820758b7182f32e9de5",
            "patch": "@@ -114,11 +114,6 @@ to be generated on un-caught exceptions, if\n .Sy --experimental-report\n is enabled. Useful when inspecting JavaScript stack in conjunction with native stack and other runtime environment data.\n .\n-.It Fl -diagnostic-report-verbose\n-Flag that enables additional information to be printed during\n-.Sy diagnostic report\n-generation.\n-.\n .It Fl -enable-fips\n Enable FIPS-compliant crypto at startup.\n Requires Node.js to be built with"
        },
        {
            "sha": "87fad4c1958e5a395a627df70a46970af506e020",
            "filename": "lib/internal/process/report.js",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/823c988b482e609978869820758b7182f32e9de5/lib%2Finternal%2Fprocess%2Freport.js",
            "raw_url": "https://github.com/nodejs/node/raw/823c988b482e609978869820758b7182f32e9de5/lib%2Finternal%2Fprocess%2Freport.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Freport.js?ref=823c988b482e609978869820758b7182f32e9de5",
            "patch": "@@ -25,8 +25,7 @@ let config = {\n   events: [],\n   signal: 'SIGUSR2',\n   filename: '',\n-  path: '',\n-  verbose: false\n+  path: ''\n };\n const report = {\n   setOptions(options) {\n@@ -58,13 +57,6 @@ const report = {\n     else\n       throw new ERR_INVALID_ARG_TYPE('path', 'string', options.path);\n \n-    if (typeof options.verbose === 'boolean')\n-      newConfig.verbose = options.verbose;\n-    else if (options.verbose === undefined)\n-      newConfig.verbose = false;\n-    else\n-      throw new ERR_INVALID_ARG_TYPE('verbose', 'boolean', options.verbose);\n-\n     if (typeof options.signal === 'string')\n       newConfig.signal = convertToValidSignal(options.signal);\n     else if (options.signal === undefined)"
        },
        {
            "sha": "937298e0d833df0c3f851b14b0d7b6141e9b7e50",
            "filename": "src/node_options.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/823c988b482e609978869820758b7182f32e9de5/src%2Fnode_options.cc",
            "raw_url": "https://github.com/nodejs/node/raw/823c988b482e609978869820758b7182f32e9de5/src%2Fnode_options.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.cc?ref=823c988b482e609978869820758b7182f32e9de5",
            "patch": "@@ -90,11 +90,6 @@ void PerIsolateOptions::CheckOptions(std::vector<std::string>* errors) {\n         \"--diagnostic-report-uncaught-exception option is valid only when \"\n         \"--experimental-report is set\");\n   }\n-\n-  if (report_verbose) {\n-    errors->push_back(\"--diagnostic-report-verbose option is valid only when \"\n-                      \"--experimental-report is set\");\n-  }\n #endif  // NODE_REPORT\n }\n \n@@ -357,11 +352,6 @@ PerIsolateOptionsParser::PerIsolateOptionsParser() {\n             \" (default: current working directory of Node.js process)\",\n             &PerIsolateOptions::report_directory,\n             kAllowedInEnvironment);\n-  AddOption(\"--diagnostic-report-verbose\",\n-            \"verbose option for report generation(true|false).\"\n-            \" (default: false)\",\n-            &PerIsolateOptions::report_verbose,\n-            kAllowedInEnvironment);\n #endif  // NODE_REPORT\n \n   Insert(&EnvironmentOptionsParser::instance,"
        },
        {
            "sha": "fe2e1034c937aa44ddaadaf19b41c33ccf5717bd",
            "filename": "src/node_options.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/823c988b482e609978869820758b7182f32e9de5/src%2Fnode_options.h",
            "raw_url": "https://github.com/nodejs/node/raw/823c988b482e609978869820758b7182f32e9de5/src%2Fnode_options.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.h?ref=823c988b482e609978869820758b7182f32e9de5",
            "patch": "@@ -143,7 +143,6 @@ class PerIsolateOptions : public Options {\n   std::string report_signal;\n   std::string report_filename;\n   std::string report_directory;\n-  bool report_verbose;\n #endif  //  NODE_REPORT\n   inline EnvironmentOptions* get_per_env_options();\n   void CheckOptions(std::vector<std::string>* errors) override;"
        },
        {
            "sha": "f56da94bac196da2708d260cc8e6e728eca1554e",
            "filename": "src/node_report_module.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 34,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/823c988b482e609978869820758b7182f32e9de5/src%2Fnode_report_module.cc",
            "raw_url": "https://github.com/nodejs/node/raw/823c988b482e609978869820758b7182f32e9de5/src%2Fnode_report_module.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_report_module.cc?ref=823c988b482e609978869820758b7182f32e9de5",
            "patch": "@@ -167,17 +167,6 @@ void SyncConfig(const FunctionCallbackInfo<Value>& info) {\n \n   Utf8Value pathstr(env->isolate(), path);\n \n-  // Report verbosity\n-  Local<String> verbosekey = FIXED_ONE_BYTE_STRING(env->isolate(), \"verbose\");\n-  Local<Value> verbose_unchecked;\n-  if (!obj->Get(context, verbosekey).ToLocal(&verbose_unchecked)) return;\n-  Local<Boolean> verbose;\n-  if (verbose_unchecked->IsUndefined() || verbose_unchecked->IsNull())\n-    verbose_unchecked = Boolean::New(env->isolate(), \"verbose\");\n-  verbose = verbose_unchecked.As<Boolean>();\n-\n-  bool verb = verbose->BooleanValue(env->isolate());\n-\n   if (sync) {\n     static const std::string e = \"exception\";\n     static const std::string s = \"signal\";\n@@ -202,7 +191,6 @@ void SyncConfig(const FunctionCallbackInfo<Value>& info) {\n     options->report_filename = *filestr;\n     CHECK_NOT_NULL(*pathstr);\n     options->report_directory = *pathstr;\n-    options->report_verbose = verb;\n   } else {\n     int i = 0;\n     if (options->report_uncaught_exception &&\n@@ -242,12 +230,6 @@ void SyncConfig(const FunctionCallbackInfo<Value>& info) {\n              .ToLocal(&path_value))\n       return;\n     if (!obj->Set(context, pathkey, path_value).FromJust()) return;\n-\n-    if (!obj->Set(context,\n-                  verbosekey,\n-                  Boolean::New(env->isolate(), options->report_verbose))\n-             .FromJust())\n-      return;\n   }\n }\n \n@@ -261,22 +243,6 @@ static void Initialize(Local<Object> exports,\n   env->SetMethod(exports, \"onUnCaughtException\", OnUncaughtException);\n   env->SetMethod(exports, \"onUserSignal\", OnUserSignal);\n   env->SetMethod(exports, \"syncConfig\", SyncConfig);\n-\n-  // TODO(gireeshpunathil) if we are retaining this flag,\n-  // insert more verbose information at vital control flow\n-  // points. Right now, it is only this one.\n-  if (options->report_verbose) {\n-    std::cerr << \"report: initialization complete, event flags:\" << std::endl;\n-    std::cerr << \"report_uncaught_exception: \"\n-              << options->report_uncaught_exception << std::endl;\n-    std::cerr << \"report_on_signal: \" << options->report_on_signal << std::endl;\n-    std::cerr << \"report_on_fatalerror: \" << options->report_on_fatalerror\n-              << std::endl;\n-    std::cerr << \"report_signal: \" << options->report_signal << std::endl;\n-    std::cerr << \"report_filename: \" << options->report_filename << std::endl;\n-    std::cerr << \"report_directory: \" << options->report_directory << std::endl;\n-    std::cerr << \"report_verbose: \" << options->report_verbose << std::endl;\n-  }\n }\n \n }  // namespace report"
        },
        {
            "sha": "f59b07d62a9f0798e8cdeb4fd50c8be777ecfb11",
            "filename": "test/node-report/test-diagnostic-report-verbose.js",
            "status": "removed",
            "additions": 0,
            "deletions": 43,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/11a8a940d7bf03dc108082bdd456668210b949c1/test%2Fnode-report%2Ftest-diagnostic-report-verbose.js",
            "raw_url": "https://github.com/nodejs/node/raw/11a8a940d7bf03dc108082bdd456668210b949c1/test%2Fnode-report%2Ftest-diagnostic-report-verbose.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fnode-report%2Ftest-diagnostic-report-verbose.js?ref=11a8a940d7bf03dc108082bdd456668210b949c1",
            "patch": "@@ -1,43 +0,0 @@\n-'use strict';\n-\n-// Tests --diagnostic-report-verbose option.\n-const common = require('../common');\n-common.skipIfReportDisabled();\n-if (process.argv[2] === 'child') {\n-  // no-op\n-} else {\n-  const helper = require('../common/report.js');\n-  const spawn = require('child_process').spawn;\n-  const assert = require('assert');\n-  const tmpdir = require('../common/tmpdir');\n-  tmpdir.refresh();\n-\n-  const expected = [ 'report: initialization complete, event flags:',\n-                     'report_uncaught_exception: 0',\n-                     'report_on_signal: 0',\n-                     'report_on_fatalerror: 0',\n-                     'report_signal:',\n-                     'report_filename:',\n-                     'report_directory:',\n-                     'report_verbose: 1' ];\n-\n-  const child = spawn(process.execPath,\n-                      ['--experimental-report',\n-                       '--diagnostic-report-verbose',\n-                       __filename,\n-                       'child',\n-                      ],\n-                      { cwd: tmpdir.path });\n-  let stderr;\n-  child.stderr.on('data', (data) => stderr += data);\n-  child.on('exit', common.mustCall((code) => {\n-    const process_msg = 'Process exited unexpectedly';\n-    assert.strictEqual(code, 0, process_msg + ':' + code);\n-    const reports = helper.findReports(child.pid, tmpdir.path);\n-    assert.strictEqual(reports.length, 0,\n-                       `Found unexpected report ${reports[0]}`);\n-    for (const line of expected) {\n-      assert.ok(stderr.includes(line), `'${line}' not found in '${stderr}'`);\n-    }\n-  }));\n-}"
        }
    ],
    "stats": {
        "total": 127,
        "additions": 3,
        "deletions": 124
    }
}