{
    "author": "jasnell",
    "message": "test: remove isGlibc from common\n\nThe `common.isGlibc()` function is called exactly once from only\none test. There's no reason for it to be in `require('../common')`\nat the current time. If it ends up needing to be used by multiple\ntests, it can easily be moved into it's own common sub-module\n(e.g. `require('../common/isglibc')` ... for now tho, just move\nit into the one test that uses it and simplify the implementation\na bit to remove unnecessary caching.\n\nPR-URL: https://github.com/nodejs/node/pull/22443\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>",
    "sha": "2d64a51270f20e47de663fd45326a93dda1694e4",
    "files": [
        {
            "sha": "96608f8dda95fda59986d7d2048308a1b4d1babf",
            "filename": "test/abort/test-addon-uv-handle-leak.js",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/2d64a51270f20e47de663fd45326a93dda1694e4/test%2Fabort%2Ftest-addon-uv-handle-leak.js",
            "raw_url": "https://github.com/nodejs/node/raw/2d64a51270f20e47de663fd45326a93dda1694e4/test%2Fabort%2Ftest-addon-uv-handle-leak.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fabort%2Ftest-addon-uv-handle-leak.js?ref=2d64a51270f20e47de663fd45326a93dda1694e4",
            "patch": "@@ -6,6 +6,7 @@ const fs = require('fs');\n const path = require('path');\n const cp = require('child_process');\n const { Worker } = require('worker_threads');\n+const { spawnSync } = require('child_process');\n \n // This is a sibling test to test/addons/uv-handle-leak.\n \n@@ -49,9 +50,25 @@ if (process.argv[2] === 'child') {\n   //         Close callback: 0x7f2df31de220 CloseCallback(uv_handle_s*) [...]\n   //         Data: 0x42\n \n+  function isGlibc() {\n+    try {\n+      const lddOut = spawnSync('ldd', [process.execPath]).stdout;\n+      const libcInfo = lddOut.toString().split('\\n').map(\n+        (line) => line.match(/libc\\.so.+=>\\s*(\\S+)\\s/)).filter((info) => info);\n+      if (libcInfo.length === 0)\n+        return false;\n+      const nmOut = spawnSync('nm', ['-D', libcInfo[0][1]]).stdout;\n+      if (/gnu_get_libc_version/.test(nmOut))\n+        return true;\n+    } catch {\n+      return false;\n+    }\n+  }\n+\n+\n   if (!(common.isFreeBSD ||\n         common.isAIX ||\n-        (common.isLinux && !common.isGlibc()) ||\n+        (common.isLinux && !isGlibc()) ||\n         common.isWindows)) {\n     assert(stderr.includes('ExampleOwnerClass'), stderr);\n     assert(stderr.includes('CloseCallback'), stderr);"
        },
        {
            "sha": "8254f5410165051864c1d1251dea7e1afde10a51",
            "filename": "test/common/index.js",
            "status": "modified",
            "additions": 0,
            "deletions": 17,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/2d64a51270f20e47de663fd45326a93dda1694e4/test%2Fcommon%2Findex.js",
            "raw_url": "https://github.com/nodejs/node/raw/2d64a51270f20e47de663fd45326a93dda1694e4/test%2Fcommon%2Findex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.js?ref=2d64a51270f20e47de663fd45326a93dda1694e4",
            "patch": "@@ -66,23 +66,6 @@ exports.isOpenBSD = process.platform === 'openbsd';\n exports.isLinux = process.platform === 'linux';\n exports.isOSX = process.platform === 'darwin';\n \n-let isGlibc;\n-exports.isGlibc = () => {\n-  if (isGlibc !== undefined)\n-    return isGlibc;\n-  try {\n-    const lddOut = spawnSync('ldd', [process.execPath]).stdout;\n-    const libcInfo = lddOut.toString().split('\\n').map(\n-      (line) => line.match(/libc\\.so.+=>\\s*(\\S+)\\s/)).filter((info) => info);\n-    if (libcInfo.length === 0)\n-      return isGlibc = false;\n-    const nmOut = spawnSync('nm', ['-D', libcInfo[0][1]]).stdout;\n-    if (/gnu_get_libc_version/.test(nmOut))\n-      return isGlibc = true;\n-  } catch {}\n-  return isGlibc = false;\n-};\n-\n exports.enoughTestMem = os.totalmem() > 0x70000000; /* 1.75 Gb */\n const cpus = os.cpus();\n exports.enoughTestCpu = Array.isArray(cpus) &&"
        },
        {
            "sha": "3ad51d4cae7e0ef852f1c99d0c4baa7c9f3223ee",
            "filename": "test/common/index.mjs",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2d64a51270f20e47de663fd45326a93dda1694e4/test%2Fcommon%2Findex.mjs",
            "raw_url": "https://github.com/nodejs/node/raw/2d64a51270f20e47de663fd45326a93dda1694e4/test%2Fcommon%2Findex.mjs",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.mjs?ref=2d64a51270f20e47de663fd45326a93dda1694e4",
            "patch": "@@ -13,7 +13,6 @@ const {\n   isOpenBSD,\n   isLinux,\n   isOSX,\n-  isGlibc,\n   enoughTestMem,\n   enoughTestCpu,\n   rootDir,\n@@ -71,7 +70,6 @@ export {\n   isOpenBSD,\n   isLinux,\n   isOSX,\n-  isGlibc,\n   enoughTestMem,\n   enoughTestCpu,\n   rootDir,"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 18,
        "deletions": 20
    }
}