{
    "author": "apapirovski",
    "message": "tls: provide now value from C++\n\nInstead of separately calling into C++ from JS to retrieve\nthe Timer.now() value, pass it in as an argument.\n\nPR-URL: https://github.com/nodejs/node/pull/18562\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "92ba624fa1da61c4061aa554877bfa3c94c83324",
    "files": [
        {
            "sha": "fcd447bb5901fe249b86397f51324c8c557e4e36",
            "filename": "lib/_tls_wrap.js",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92ba624fa1da61c4061aa554877bfa3c94c83324/lib%2F_tls_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/92ba624fa1da61c4061aa554877bfa3c94c83324/lib%2F_tls_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_wrap.js?ref=92ba624fa1da61c4061aa554877bfa3c94c83324",
            "patch": "@@ -32,7 +32,6 @@ const common = require('_tls_common');\n const { StreamWrap } = require('_stream_wrap');\n const { Buffer } = require('buffer');\n const debug = util.debuglog('tls');\n-const { Timer } = process.binding('timer_wrap');\n const tls_wrap = process.binding('tls_wrap');\n const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n const { Pipe, constants: PipeConstants } = process.binding('pipe_wrap');\n@@ -49,14 +48,13 @@ const kSNICallback = Symbol('snicallback');\n \n const noop = () => {};\n \n-function onhandshakestart() {\n+function onhandshakestart(now) {\n   debug('onhandshakestart');\n \n-  const owner = this.owner;\n-  const now = Timer.now();\n-\n   assert(now >= this.lastHandshakeTime);\n \n+  const owner = this.owner;\n+\n   if ((now - this.lastHandshakeTime) >= tls.CLIENT_RENEG_WINDOW * 1000) {\n     this.handshakes = 0;\n   }"
        },
        {
            "sha": "0cba1898fbaaad1209a812399d85d661390dcf31",
            "filename": "src/tls_wrap.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/92ba624fa1da61c4061aa554877bfa3c94c83324/src%2Ftls_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92ba624fa1da61c4061aa554877bfa3c94c83324/src%2Ftls_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftls_wrap.cc?ref=92ba624fa1da61c4061aa554877bfa3c94c83324",
            "patch": "@@ -230,7 +230,8 @@ void TLSWrap::SSLInfoCallback(const SSL* ssl_, int where, int ret) {\n   if (where & SSL_CB_HANDSHAKE_START) {\n     Local<Value> callback = object->Get(env->onhandshakestart_string());\n     if (callback->IsFunction()) {\n-      c->MakeCallback(callback.As<Function>(), 0, nullptr);\n+      Local<Value> argv[] = { env->GetNow() };\n+      c->MakeCallback(callback.As<Function>(), arraysize(argv), argv);\n     }\n   }\n "
        }
    ],
    "stats": {
        "total": 11,
        "additions": 5,
        "deletions": 6
    }
}