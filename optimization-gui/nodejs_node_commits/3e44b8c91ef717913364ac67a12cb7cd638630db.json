{
    "author": "maclover7",
    "message": "lib: extract validateNumber validator\n\nPulls out another common argument validator to `internal/validators`\n\nPR-URL: https://github.com/nodejs/node/pull/22249\nReviewed-By: Bryan English <bryan@bryanenglish.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "3e44b8c91ef717913364ac67a12cb7cd638630db",
    "files": [
        {
            "sha": "acb0e22e568a92fbc934041635437ebbfd5433be",
            "filename": "lib/dgram.js",
            "status": "modified",
            "additions": 10,
            "deletions": 19,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Fdgram.js",
            "raw_url": "https://github.com/nodejs/node/raw/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Fdgram.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fdgram.js?ref=3e44b8c91ef717913364ac67a12cb7cd638630db",
            "patch": "@@ -39,7 +39,11 @@ const {\n   ERR_SOCKET_DGRAM_NOT_RUNNING,\n   ERR_INVALID_FD_TYPE\n } = errors.codes;\n-const { isInt32, validateString } = require('internal/validators');\n+const {\n+  isInt32,\n+  validateString,\n+  validateNumber\n+} = require('internal/validators');\n const { Buffer } = require('buffer');\n const util = require('util');\n const { isUint8Array } = require('internal/util/types');\n@@ -308,18 +312,9 @@ Socket.prototype.sendto = function(buffer,\n                                    port,\n                                    address,\n                                    callback) {\n-  if (typeof offset !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('offset', 'number', offset);\n-  }\n-\n-  if (typeof length !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('length', 'number', length);\n-  }\n-\n-  if (typeof port !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('port', 'number', port);\n-  }\n-\n+  validateNumber(offset, 'offset');\n+  validateNumber(length, 'length');\n+  validateNumber(port, 'port');\n   validateString(address, 'address');\n \n   this.send(buffer, offset, length, port, address, callback);\n@@ -580,9 +575,7 @@ Socket.prototype.setBroadcast = function(arg) {\n \n \n Socket.prototype.setTTL = function(ttl) {\n-  if (typeof ttl !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('ttl', 'number', ttl);\n-  }\n+  validateNumber(ttl, 'ttl');\n \n   var err = this[kStateSymbol].handle.setTTL(ttl);\n   if (err) {\n@@ -594,9 +587,7 @@ Socket.prototype.setTTL = function(ttl) {\n \n \n Socket.prototype.setMulticastTTL = function(ttl) {\n-  if (typeof ttl !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('ttl', 'number', ttl);\n-  }\n+  validateNumber(ttl, 'ttl');\n \n   var err = this[kStateSymbol].handle.setMulticastTTL(ttl);\n   if (err) {"
        },
        {
            "sha": "3ea34af59e2072ea2e65fef40c05b590a64c93d0",
            "filename": "lib/internal/buffer.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Fbuffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Fbuffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbuffer.js?ref=3e44b8c91ef717913364ac67a12cb7cd638630db",
            "patch": "@@ -6,6 +6,7 @@ const {\n   ERR_INVALID_ARG_TYPE,\n   ERR_OUT_OF_RANGE\n } = require('internal/errors').codes;\n+const { validateNumber } = require('internal/validators');\n const { setupBufferJS } = binding;\n \n // Remove from the binding so that function is only available as exported here.\n@@ -38,9 +39,7 @@ function checkInt(value, min, max, buf, offset, byteLength) {\n }\n \n function checkNumberType(value, type) {\n-  if (typeof value !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE(type || 'offset', 'number', value);\n-  }\n+  validateNumber(value, type || 'offset');\n }\n \n function boundsError(value, length, type) {"
        },
        {
            "sha": "ea73c85ec5dbf0628795a9eefb911b46efa0eaa2",
            "filename": "lib/internal/crypto/random.js",
            "status": "modified",
            "additions": 3,
            "deletions": 8,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Fcrypto%2Frandom.js",
            "raw_url": "https://github.com/nodejs/node/raw/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Fcrypto%2Frandom.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Frandom.js?ref=3e44b8c91ef717913364ac67a12cb7cd638630db",
            "patch": "@@ -8,16 +8,14 @@ const {\n   ERR_INVALID_CALLBACK,\n   ERR_OUT_OF_RANGE\n } = require('internal/errors').codes;\n+const { validateNumber } = require('internal/validators');\n const { isArrayBufferView } = require('internal/util/types');\n \n const kMaxUint32 = 2 ** 32 - 1;\n const kMaxPossibleLength = Math.min(kMaxLength, kMaxUint32);\n \n function assertOffset(offset, elementSize, length) {\n-  if (typeof offset !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('offset', 'number', offset);\n-  }\n-\n+  validateNumber(offset, 'offset');\n   offset *= elementSize;\n \n   const maxLength = Math.min(length, kMaxPossibleLength);\n@@ -29,10 +27,7 @@ function assertOffset(offset, elementSize, length) {\n }\n \n function assertSize(size, elementSize, offset, length) {\n-  if (typeof size !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('size', 'number', size);\n-  }\n-\n+  validateNumber(size, 'size');\n   size *= elementSize;\n \n   if (Number.isNaN(size) || size > kMaxPossibleLength || size < 0) {"
        },
        {
            "sha": "502b3c143086f7bd7286a8b17218164004b7ba17",
            "filename": "lib/internal/fs/streams.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Ffs%2Fstreams.js",
            "raw_url": "https://github.com/nodejs/node/raw/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Ffs%2Fstreams.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Fstreams.js?ref=3e44b8c91ef717913364ac67a12cb7cd638630db",
            "patch": "@@ -8,6 +8,7 @@ const {\n   ERR_INVALID_ARG_TYPE,\n   ERR_OUT_OF_RANGE\n } = require('internal/errors').codes;\n+const { validateNumber } = require('internal/validators');\n const fs = require('fs');\n const { Buffer } = require('buffer');\n const {\n@@ -65,8 +66,7 @@ function ReadStream(path, options) {\n \n   if (this.start !== undefined) {\n     if (!Number.isSafeInteger(this.start)) {\n-      if (typeof this.start !== 'number')\n-        throw new ERR_INVALID_ARG_TYPE('start', 'number', this.start);\n+      validateNumber(this.start, 'start');\n       if (!Number.isInteger(this.start))\n         throw new ERR_OUT_OF_RANGE('start', 'an integer', this.start);\n       throw new ERR_OUT_OF_RANGE("
        },
        {
            "sha": "e5c2bf99ec37b02da28b1f55804b8a16452c3eb8",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 6,
            "deletions": 12,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=3e44b8c91ef717913364ac67a12cb7cd638630db",
            "patch": "@@ -76,6 +76,7 @@ const {\n     ERR_SOCKET_CLOSED\n   }\n } = require('internal/errors');\n+const { validateNumber } = require('internal/validators');\n const { utcDate } = require('internal/http');\n const { onServerStream,\n         Http2ServerRequest,\n@@ -1002,8 +1003,7 @@ class Http2Session extends EventEmitter {\n     if (this.destroyed)\n       throw new ERR_HTTP2_INVALID_SESSION();\n \n-    if (typeof id !== 'number')\n-      throw new ERR_INVALID_ARG_TYPE('id', 'number', id);\n+    validateNumber(id, 'id');\n     if (id <= 0 || id > kMaxStreams)\n       throw new ERR_OUT_OF_RANGE('id', `> 0 and <= ${kMaxStreams}`, id);\n     this[kHandle].setNextStreamID(id);\n@@ -1145,12 +1145,8 @@ class Http2Session extends EventEmitter {\n                                      ['Buffer', 'TypedArray', 'DataView'],\n                                      opaqueData);\n     }\n-    if (typeof code !== 'number') {\n-      throw new ERR_INVALID_ARG_TYPE('code', 'number', code);\n-    }\n-    if (typeof lastStreamID !== 'number') {\n-      throw new ERR_INVALID_ARG_TYPE('lastStreamID', 'number', lastStreamID);\n-    }\n+    validateNumber(code, 'code');\n+    validateNumber(lastStreamID, 'lastStreamID');\n \n     const goawayFn = submitGoaway.bind(this, code, lastStreamID, opaqueData);\n     if (this.connecting) {\n@@ -1832,8 +1828,7 @@ class Http2Stream extends Duplex {\n   // close, it is still possible to queue up PRIORITY and RST_STREAM frames,\n   // but no DATA and HEADERS frames may be sent.\n   close(code = NGHTTP2_NO_ERROR, callback) {\n-    if (typeof code !== 'number')\n-      throw new ERR_INVALID_ARG_TYPE('code', 'number', code);\n+    validateNumber(code, 'code');\n     if (code < 0 || code > kMaxInt)\n       throw new ERR_OUT_OF_RANGE('code', `>= 0 && <= ${kMaxInt}`, code);\n     if (callback !== undefined && typeof callback !== 'function')\n@@ -2327,8 +2322,7 @@ class ServerHttp2Stream extends Http2Stream {\n       this[kState].flags |= STREAM_FLAGS_HAS_TRAILERS;\n     }\n \n-    if (typeof fd !== 'number')\n-      throw new ERR_INVALID_ARG_TYPE('fd', 'number', fd);\n+    validateNumber(fd, 'fd');\n \n     debug(`Http2Stream ${this[kID]} [Http2Session ` +\n           `${sessionName(session[kType])}]: initiating response from fd`);"
        },
        {
            "sha": "093284a80d405cbee4f39daa70a856b01ce13d0c",
            "filename": "lib/internal/timers.js",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Ftimers.js",
            "raw_url": "https://github.com/nodejs/node/raw/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Ftimers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ftimers.js?ref=3e44b8c91ef717913364ac67a12cb7cd638630db",
            "patch": "@@ -12,10 +12,10 @@ const async_id_symbol = Symbol('asyncId');\n const trigger_async_id_symbol = Symbol('triggerId');\n \n const {\n-  ERR_INVALID_ARG_TYPE,\n   ERR_INVALID_CALLBACK,\n   ERR_OUT_OF_RANGE\n } = require('internal/errors').codes;\n+const { validateNumber } = require('internal/validators');\n \n // Timeout values > TIMEOUT_MAX are set to 1.\n const TIMEOUT_MAX = 2 ** 31 - 1;\n@@ -126,10 +126,7 @@ function setUnrefTimeout(callback, after, arg1, arg2, arg3) {\n \n // Type checking used by timers.enroll() and Socket#setTimeout()\n function validateTimerDuration(msecs) {\n-  if (typeof msecs !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('msecs', 'number', msecs);\n-  }\n-\n+  validateNumber(msecs, 'msecs');\n   if (msecs < 0 || !isFinite(msecs)) {\n     throw new ERR_OUT_OF_RANGE('msecs', 'a non-negative finite number', msecs);\n   }"
        },
        {
            "sha": "0ecf286266678afce6069e09b6de050447b7452c",
            "filename": "lib/internal/validators.js",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Fvalidators.js",
            "raw_url": "https://github.com/nodejs/node/raw/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Finternal%2Fvalidators.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fvalidators.js?ref=3e44b8c91ef717913364ac67a12cb7cd638630db",
            "patch": "@@ -125,12 +125,18 @@ function validateString(value, name) {\n     throw new ERR_INVALID_ARG_TYPE(name, 'string', value);\n }\n \n+function validateNumber(value, name) {\n+  if (typeof value !== 'number')\n+    throw new ERR_INVALID_ARG_TYPE(name, 'number', value);\n+}\n+\n module.exports = {\n   isInt32,\n   isUint32,\n   validateMode,\n   validateInteger,\n   validateInt32,\n   validateUint32,\n-  validateString\n+  validateString,\n+  validateNumber\n };"
        },
        {
            "sha": "a877c255549bc16ac11624250fecae3ac4d42cab",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/3e44b8c91ef717913364ac67a12cb7cd638630db/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=3e44b8c91ef717913364ac67a12cb7cd638630db",
            "patch": "@@ -27,6 +27,7 @@ const {\n   ERR_INVALID_ARG_TYPE,\n   ERR_OUT_OF_RANGE\n } = errors.codes;\n+const { validateNumber } = require('internal/validators');\n const { TextDecoder, TextEncoder } = require('internal/encoding');\n const { isBuffer } = require('buffer').Buffer;\n \n@@ -1455,9 +1456,7 @@ function callbackify(original) {\n }\n \n function getSystemErrorName(err) {\n-  if (typeof err !== 'number') {\n-    throw new ERR_INVALID_ARG_TYPE('err', 'number', err);\n-  }\n+  validateNumber(err, 'err');\n   if (err >= 0 || !Number.isSafeInteger(err)) {\n     throw new ERR_OUT_OF_RANGE('err', 'a negative integer', err);\n   }"
        }
    ],
    "stats": {
        "total": 87,
        "additions": 34,
        "deletions": 53
    }
}