{
    "author": "princejwesley",
    "message": "repl: better handling of recoverable errors\n\nBelow syntax errors are handled without force .break/clear\n  - Unexpected Token (prefix errors)\n  - missing ) after argument list\n\nIn the multiline expression, recoverable errors are truly\nrecoverable, otherwise syntax error will be thrown.\n\nPR-URL: https://github.com/nodejs/node/pull/18915\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Shingo Inoue <leko.noor@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "ebfa8b14645798b486e010e3f8bcec693f42cd6f",
    "files": [
        {
            "sha": "078bb208ae15449b0605c2a21a28ddbac5eab7c9",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/ebfa8b14645798b486e010e3f8bcec693f42cd6f/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/ebfa8b14645798b486e010e3f8bcec693f42cd6f/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=ebfa8b14645798b486e010e3f8bcec693f42cd6f",
            "patch": "@@ -1473,14 +1473,15 @@ function isRecoverableError(e, code) {\n   if (e && e.name === 'SyntaxError') {\n     var message = e.message;\n     if (message === 'Unterminated template literal' ||\n-        message === 'Missing } in template expression') {\n+        message === 'Unexpected end of input') {\n       return true;\n     }\n \n-    if (message.startsWith('Unexpected end of input') ||\n-        message.startsWith('missing ) after argument list') ||\n-        message.startsWith('Unexpected token'))\n-      return true;\n+    if (message === 'missing ) after argument list') {\n+      const frames = e.stack.split(/\\r?\\n/);\n+      const pos = frames.findIndex((f) => f.match(/^\\s*\\^+$/));\n+      return pos > 0 && frames[pos - 1].length === frames[pos].length;\n+    }\n \n     if (message === 'Invalid or unexpected token')\n       return isCodeRecoverable(code);"
        },
        {
            "sha": "e14398541dd8deca8fd9ae2d457c93038f4e63f8",
            "filename": "test/parallel/test-repl.js",
            "status": "modified",
            "additions": 69,
            "deletions": 5,
            "changes": 74,
            "blob_url": "https://github.com/nodejs/node/blob/ebfa8b14645798b486e010e3f8bcec693f42cd6f/test%2Fparallel%2Ftest-repl.js",
            "raw_url": "https://github.com/nodejs/node/raw/ebfa8b14645798b486e010e3f8bcec693f42cd6f/test%2Fparallel%2Ftest-repl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl.js?ref=ebfa8b14645798b486e010e3f8bcec693f42cd6f",
            "patch": "@@ -163,13 +163,23 @@ const errorTests = [\n     send: '.break',\n     expect: ''\n   },\n-  // Template expressions can cross lines\n+  // Template expressions\n   {\n     send: '`io.js ${\"1.0\"',\n+    expect: [\n+      kSource,\n+      kArrow,\n+      '',\n+      /^SyntaxError: /,\n+      ''\n+    ]\n+  },\n+  {\n+    send: '`io.js ${',\n     expect: '... '\n   },\n   {\n-    send: '+ \".2\"}`',\n+    send: '\"1.0\" + \".2\"}`',\n     expect: '\\'io.js 1.0.2\\''\n   },\n   // Dot prefix in multiline commands aren't treated as commands\n@@ -644,14 +654,68 @@ const errorTests = [\n   },\n   // Do not parse `...[]` as a REPL keyword\n   {\n-    send: '...[]\\n',\n-    expect: '... ... '\n+    send: '...[]',\n+    expect: [\n+      kSource,\n+      kArrow,\n+      '',\n+      /^SyntaxError: /,\n+      ''\n+    ]\n   },\n   // bring back the repl to prompt\n   {\n     send: '.break',\n     expect: ''\n-  }\n+  },\n+  {\n+    send: 'console.log(\"Missing comma in arg list\" process.version)',\n+    expect: [\n+      kSource,\n+      kArrow,\n+      '',\n+      /^SyntaxError: /,\n+      ''\n+    ]\n+  },\n+  {\n+    send: 'x = {\\nfield\\n{',\n+    expect: [\n+      '... ... {',\n+      kArrow,\n+      '',\n+      /^SyntaxError: /,\n+      ''\n+    ]\n+  },\n+  {\n+    send: '(2 + 3))',\n+    expect: [\n+      kSource,\n+      kArrow,\n+      '',\n+      /^SyntaxError: /,\n+      ''\n+    ]\n+  },\n+  {\n+    send: 'if (typeof process === \"object\"); {',\n+    expect: '... '\n+  },\n+  {\n+    send: 'console.log(\"process is defined\");',\n+    expect: '... '\n+  },\n+  {\n+    send: '} else {',\n+    expect: [\n+      kSource,\n+      kArrow,\n+      '',\n+      /^SyntaxError: /,\n+      ''\n+    ]\n+  },\n ];\n \n const tcpTests = ["
        }
    ],
    "stats": {
        "total": 85,
        "additions": 75,
        "deletions": 10
    }
}