{
    "author": "BridgeAR",
    "message": "assert: add comments for diff algorithm\n\nIt became hard to follow what was actually happening in the\nalgorithm. This adds comments to improve the situation.\n\nPR-URL: https://github.com/nodejs/node/pull/23048\nRefs: https://github.com/nodejs/node/issues/22763\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Shingo Inoue <leko.noor@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "eccc65919a6dc9a05936e070181a16604ba346e6",
    "files": [
        {
            "sha": "e174cddb60a4e30eb248cae174d46dcbb5c61a29",
            "filename": "lib/internal/assert.js",
            "status": "modified",
            "additions": 33,
            "deletions": 1,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/eccc65919a6dc9a05936e070181a16604ba346e6/lib%2Finternal%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/eccc65919a6dc9a05936e070181a16604ba346e6/lib%2Finternal%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fassert.js?ref=eccc65919a6dc9a05936e070181a16604ba346e6",
            "patch": "@@ -174,6 +174,9 @@ function createErrDiff(actual, expected, operator) {\n     // Only extra expected lines exist\n     const cur = i - lastPos;\n     if (actualLines.length < i + 1) {\n+      // If the last diverging line is more than one line above and the\n+      // current line is at least line three, add some of the former lines and\n+      // also add dots to indicate skipped entries.\n       if (cur > 1 && i > 2) {\n         if (cur > 4) {\n           res += `\\n${blue}...${white}`;\n@@ -185,11 +188,16 @@ function createErrDiff(actual, expected, operator) {\n         res += `\\n  ${expectedLines[i - 1]}`;\n         printedLines++;\n       }\n+      // Mark the current line as the last diverging one.\n       lastPos = i;\n+      // Add the expected line to the cache.\n       other += `\\n${red}-${white} ${expectedLines[i]}`;\n       printedLines++;\n     // Only extra actual lines exist\n     } else if (expectedLines.length < i + 1) {\n+      // If the last diverging line is more than one line above and the\n+      // current line is at least line three, add some of the former lines and\n+      // also add dots to indicate skipped entries.\n       if (cur > 1 && i > 2) {\n         if (cur > 4) {\n           res += `\\n${blue}...${white}`;\n@@ -201,23 +209,40 @@ function createErrDiff(actual, expected, operator) {\n         res += `\\n  ${actualLines[i - 1]}`;\n         printedLines++;\n       }\n+      // Mark the current line as the last diverging one.\n       lastPos = i;\n+      // Add the actual line to the result.\n       res += `\\n${green}+${white} ${actualLines[i]}`;\n       printedLines++;\n     // Lines diverge\n     } else {\n       const expectedLine = expectedLines[i];\n       let actualLine = actualLines[i];\n+      // If the lines diverge, specifically check for lines that only diverge by\n+      // a trailing comma. In that case it is actually identical and we should\n+      // mark it as such.\n       let divergingLines = actualLine !== expectedLine &&\n                            (!actualLine.endsWith(',') ||\n                             actualLine.slice(0, -1) !== expectedLine);\n+      // If the expected line has a trailing comma but is otherwise identical,\n+      // add a comma at the end of the actual line. Otherwise the output could\n+      // look weird as in:\n+      //\n+      //   [\n+      //     1         // No comma at the end!\n+      // +   2\n+      //   ]\n+      //\n       if (divergingLines &&\n           expectedLine.endsWith(',') &&\n           expectedLine.slice(0, -1) === actualLine) {\n         divergingLines = false;\n         actualLine += ',';\n       }\n       if (divergingLines) {\n+        // If the last diverging line is more than one line above and the\n+        // current line is at least line three, add some of the former lines and\n+        // also add dots to indicate skipped entries.\n         if (cur > 1 && i > 2) {\n           if (cur > 4) {\n             res += `\\n${blue}...${white}`;\n@@ -229,14 +254,21 @@ function createErrDiff(actual, expected, operator) {\n           res += `\\n  ${actualLines[i - 1]}`;\n           printedLines++;\n         }\n+        // Mark the current line as the last diverging one.\n         lastPos = i;\n+        // Add the actual line to the result and cache the expected diverging\n+        // line so consecutive diverging lines show up as +++--- and not +-+-+-.\n         res += `\\n${green}+${white} ${actualLine}`;\n         other += `\\n${red}-${white} ${expectedLine}`;\n         printedLines += 2;\n       // Lines are identical\n       } else {\n+        // Add all cached information to the result before adding other things\n+        // and reset the cache.\n         res += other;\n         other = '';\n+        // If the last diverging line is exactly one line above or if it is the\n+        // very first line, add the line to the result.\n         if (cur === 1 || i === 0) {\n           res += `\\n  ${actualLine}`;\n           printedLines++;\n@@ -246,7 +278,7 @@ function createErrDiff(actual, expected, operator) {\n     // Inspected object to big (Show ~20 rows max)\n     if (printedLines > 20 && i < maxLines - 2) {\n       return `${msg}${skippedMsg}\\n${res}\\n${blue}...${white}${other}\\n` +\n-        `${blue}...${white}`;\n+             `${blue}...${white}`;\n     }\n   }\n "
        }
    ],
    "stats": {
        "total": 34,
        "additions": 33,
        "deletions": 1
    }
}