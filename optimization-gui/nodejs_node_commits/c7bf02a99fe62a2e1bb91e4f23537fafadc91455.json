{
    "author": "Trott",
    "message": "test: increase coverage for worker_threads\n\nProvide a test to cover adding setting `onmessage` to a non-function.\n\nThis provides previously-missing coverage for an else block in the\n`onmessage` setter.\n\nPR-URL: https://github.com/nodejs/node/pull/22942\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Yuta Hiroto <hello@hiroppy.me>",
    "sha": "c7bf02a99fe62a2e1bb91e4f23537fafadc91455",
    "files": [
        {
            "sha": "9142c19b3211fc460173d57c868e598d5098e28e",
            "filename": "test/parallel/test-worker-onmessage-not-a-function.js",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/nodejs/node/blob/c7bf02a99fe62a2e1bb91e4f23537fafadc91455/test%2Fparallel%2Ftest-worker-onmessage-not-a-function.js",
            "raw_url": "https://github.com/nodejs/node/raw/c7bf02a99fe62a2e1bb91e4f23537fafadc91455/test%2Fparallel%2Ftest-worker-onmessage-not-a-function.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-onmessage-not-a-function.js?ref=c7bf02a99fe62a2e1bb91e4f23537fafadc91455",
            "patch": "@@ -0,0 +1,26 @@\n+// When MessagePort.onmessage is set to a value that is not a function, the\n+// setter should call .unref() and .stop(), clearing a previous onmessage\n+// listener from holding the event loop open. This test confirms that\n+// functionality.\n+\n+// Flags: --experimental-worker\n+'use strict';\n+const common = require('../common');\n+const { Worker, parentPort } = require('worker_threads');\n+\n+// Do not use isMainThread so that this test itself can be run inside a Worker.\n+if (!process.env.HAS_STARTED_WORKER) {\n+  process.env.HAS_STARTED_WORKER = 1;\n+  const w = new Worker(__filename);\n+  w.postMessage(2);\n+} else {\n+  // .onmessage uses a setter. Set .onmessage to a function that ultimately\n+  // should not be called. This will call .ref() and .start() which will keep\n+  // the event loop open (and prevent this from exiting) if the subsequent\n+  // assignment of a value to .onmessage doesn't call .unref() and .stop().\n+  parentPort.onmessage = common.mustNotCall();\n+  // Setting `onmessage` to a value that is not a function should clear the\n+  // previous value and also should allow the event loop to exit. (In other\n+  // words, this test should exit rather than run indefinitely.)\n+  parentPort.onmessage = 'fhqwhgads';\n+}"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 26,
        "deletions": 0
    }
}