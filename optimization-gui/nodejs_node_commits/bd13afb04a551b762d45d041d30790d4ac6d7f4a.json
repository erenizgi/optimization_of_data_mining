{
    "author": "BridgeAR",
    "message": "util: make inspect aware of RegExp subclasses and null prototype\n\nThis adds support for inspect to distinguish regular expression\nsubclasses and ones with null prototype from \"normal\" regular\nexpressions.\n\nPR-URL: https://github.com/nodejs/node/pull/25192\nReviewed-By: Anto Aravinth <anto.aravinth.cse@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "bd13afb04a551b762d45d041d30790d4ac6d7f4a",
    "files": [
        {
            "sha": "b47ed5411f46fbc4d4270533dddebfd073fc16f2",
            "filename": "lib/internal/util/inspect.js",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/bd13afb04a551b762d45d041d30790d4ac6d7f4a/lib%2Finternal%2Futil%2Finspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/bd13afb04a551b762d45d041d30790d4ac6d7f4a/lib%2Finternal%2Futil%2Finspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspect.js?ref=bd13afb04a551b762d45d041d30790d4ac6d7f4a",
            "patch": "@@ -634,9 +634,12 @@ function formatRaw(ctx, value, recurseTimes) {\n       base = `[${name}]`;\n     } else if (isRegExp(value)) {\n       // Make RegExps say that they are RegExps\n+      base = regExpToString(constructor !== null ? value : new RegExp(value));\n+      const prefix = getPrefix(constructor, tag, 'RegExp');\n+      if (prefix !== 'RegExp ')\n+        base = `${prefix}${base}`;\n       if (keys.length === 0 || recurseTimes < 0)\n-        return ctx.stylize(regExpToString(value), 'regexp');\n-      base = `${regExpToString(value)}`;\n+        return ctx.stylize(base, 'regexp');\n     } else if (isDate(value)) {\n       // Make dates with properties first say the date\n       if (keys.length === 0) {"
        },
        {
            "sha": "b16b0f3ffcb911c02faa340eefa85c78a79dce13",
            "filename": "test/parallel/test-assert-deep.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/bd13afb04a551b762d45d041d30790d4ac6d7f4a/test%2Fparallel%2Ftest-assert-deep.js",
            "raw_url": "https://github.com/nodejs/node/raw/bd13afb04a551b762d45d041d30790d4ac6d7f4a/test%2Fparallel%2Ftest-assert-deep.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert-deep.js?ref=bd13afb04a551b762d45d041d30790d4ac6d7f4a",
            "patch": "@@ -149,7 +149,7 @@ assert.throws(\n   {\n     code: 'ERR_ASSERTION',\n     message: `${defaultMsgStartFull}\\n\\n` +\n-             \"+ /test/\\n- /test/ {\\n-   '0': '1'\\n- }\"\n+             \"+ /test/\\n- MyRegExp /test/ {\\n-   '0': '1'\\n- }\"\n   }\n );\n "
        },
        {
            "sha": "9ee02720897505a96e004d00026896d13207d337",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 33,
            "deletions": 10,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/bd13afb04a551b762d45d041d30790d4ac6d7f4a/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/bd13afb04a551b762d45d041d30790d4ac6d7f4a/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=bd13afb04a551b762d45d041d30790d4ac6d7f4a",
            "patch": "@@ -1580,15 +1580,7 @@ assert.strictEqual(util.inspect('\"\\''), '`\"\\'`');\n // eslint-disable-next-line no-template-curly-in-string\n assert.strictEqual(util.inspect('\"\\'${a}'), \"'\\\"\\\\'${a}'\");\n \n-{\n-  assert.strictEqual(\n-    util.inspect(Object.setPrototypeOf(/a/, null)),\n-    '/undefined/undefined'\n-  );\n-}\n-\n-// Verify that throwing in valueOf and having no prototype still produces nice\n-// results.\n+// Verify that throwing in valueOf and toString still produces nice results.\n [\n   [new String(55), \"[String: '55']\"],\n   [new Boolean(true), '[Boolean: true]'],\n@@ -1609,6 +1601,7 @@ assert.strictEqual(util.inspect('\"\\'${a}'), \"'\\\"\\\\'${a}'\");\n   [new Promise((resolve) => setTimeout(resolve, 10)), 'Promise { <pending> }'],\n   [new WeakSet(), 'WeakSet { <items unknown> }'],\n   [new WeakMap(), 'WeakMap { <items unknown> }'],\n+  [/foobar/g, '/foobar/g']\n ].forEach(([value, expected]) => {\n   Object.defineProperty(value, 'valueOf', {\n     get() {\n@@ -1628,6 +1621,7 @@ assert.strictEqual(util.inspect('\"\\'${a}'), \"'\\\"\\\\'${a}'\");\n   assert.notStrictEqual(util.inspect(value), expected);\n });\n \n+// Verify that having no prototype still produces nice results.\n [\n   [[1, 3, 4], '[Array: null prototype] [ 1, 3, 4 ]'],\n   [new Set([1, 2]), '[Set: null prototype] { 1, 2 }'],\n@@ -1652,7 +1646,8 @@ assert.strictEqual(util.inspect('\"\\'${a}'), \"'\\\"\\\\'${a}'\");\n    '[DataView: null prototype] {\\n  byteLength: undefined,\\n  ' +\n     'byteOffset: undefined,\\n  buffer: undefined }'],\n   [new SharedArrayBuffer(2), '[SharedArrayBuffer: null prototype] ' +\n-  '{ byteLength: undefined }']\n+  '{ byteLength: undefined }'],\n+  [/foobar/, '[RegExp: null prototype] /foobar/']\n ].forEach(([value, expected]) => {\n   assert.strictEqual(\n     util.inspect(Object.setPrototypeOf(value, null)),\n@@ -1665,6 +1660,34 @@ assert.strictEqual(util.inspect('\"\\'${a}'), \"'\\\"\\\\'${a}'\");\n   assert.notStrictEqual(util.inspect(value), expected);\n });\n \n+// Verify that subclasses with and without prototype produce nice results.\n+[\n+  [RegExp, ['foobar', 'g'], '/foobar/g']\n+].forEach(([base, input, rawExpected]) => {\n+  class Foo extends base {}\n+  const value = new Foo(...input);\n+  const symbol = value[Symbol.toStringTag];\n+  const expected = `Foo ${symbol ? `[${symbol}] ` : ''}${rawExpected}`;\n+  const expectedWithoutProto = `[${base.name}: null prototype] ${rawExpected}`;\n+  assert.strictEqual(util.inspect(value), expected);\n+  value.foo = 'bar';\n+  assert.notStrictEqual(util.inspect(value), expected);\n+  delete value.foo;\n+  assert.strictEqual(\n+    util.inspect(Object.setPrototypeOf(value, null)),\n+    expectedWithoutProto\n+  );\n+  value.foo = 'bar';\n+  let res = util.inspect(value);\n+  assert.notStrictEqual(res, expectedWithoutProto);\n+  assert(/foo: 'bar'/.test(res), res);\n+  delete value.foo;\n+  value[Symbol('foo')] = 'yeah';\n+  res = util.inspect(value);\n+  assert.notStrictEqual(res, expectedWithoutProto);\n+  assert(/\\[Symbol\\(foo\\)]: 'yeah'/.test(res), res);\n+});\n+\n assert.strictEqual(inspect(1n), '1n');\n assert.strictEqual(inspect(Object(-1n)), '[BigInt: -1n]');\n assert.strictEqual(inspect(Object(13n)), '[BigInt: 13n]');"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 39,
        "deletions": 13
    }
}