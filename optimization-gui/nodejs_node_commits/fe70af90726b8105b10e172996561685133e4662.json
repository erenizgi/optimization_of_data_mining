{
    "author": "danbev",
    "message": "crypto: add checkIsArrayBufferView\n\nThis commit adds a checkIsArrayBufferView function to avoid some code\nduplication in sig.js\n\nPR-URL: https://github.com/nodejs/node/pull/20251\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "fe70af90726b8105b10e172996561685133e4662",
    "files": [
        {
            "sha": "1073b83d7200989af9c36e37efc6fad531f4690f",
            "filename": "lib/internal/crypto/sig.js",
            "status": "modified",
            "additions": 6,
            "deletions": 33,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/fe70af90726b8105b10e172996561685133e4662/lib%2Finternal%2Fcrypto%2Fsig.js",
            "raw_url": "https://github.com/nodejs/node/raw/fe70af90726b8105b10e172996561685133e4662/lib%2Finternal%2Fcrypto%2Fsig.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fsig.js?ref=fe70af90726b8105b10e172996561685133e4662",
            "patch": "@@ -14,10 +14,10 @@ const {\n   RSA_PKCS1_PADDING\n } = process.binding('constants').crypto;\n const {\n+  checkIsArrayBufferView,\n   getDefaultEncoding,\n   toBuf\n } = require('internal/crypto/util');\n-const { isArrayBufferView } = require('internal/util/types');\n const { Writable } = require('stream');\n const { inherits } = require('util');\n \n@@ -41,14 +41,7 @@ Sign.prototype._write = function _write(chunk, encoding, callback) {\n \n Sign.prototype.update = function update(data, encoding) {\n   encoding = encoding || getDefaultEncoding();\n-  data = toBuf(data, encoding);\n-  if (!isArrayBufferView(data)) {\n-    throw new ERR_INVALID_ARG_TYPE(\n-      'data',\n-      ['string', 'Buffer', 'TypedArray', 'DataView'],\n-      data\n-    );\n-  }\n+  data = checkIsArrayBufferView('data', toBuf(data, encoding));\n   this._handle.update(data);\n   return this;\n };\n@@ -84,14 +77,7 @@ Sign.prototype.sign = function sign(options, encoding) {\n \n   var pssSaltLength = getSaltLength(options);\n \n-  key = toBuf(key);\n-  if (!isArrayBufferView(key)) {\n-    throw new ERR_INVALID_ARG_TYPE(\n-      'key',\n-      ['string', 'Buffer', 'TypedArray', 'DataView'],\n-      key\n-    );\n-  }\n+  key = checkIsArrayBufferView('key', toBuf(key));\n \n   var ret = this._handle.sign(key, passphrase, rsaPadding, pssSaltLength);\n \n@@ -128,23 +114,10 @@ Verify.prototype.verify = function verify(options, signature, sigEncoding) {\n \n   var pssSaltLength = getSaltLength(options);\n \n-  key = toBuf(key);\n-  if (!isArrayBufferView(key)) {\n-    throw new ERR_INVALID_ARG_TYPE(\n-      'key',\n-      ['string', 'Buffer', 'TypedArray', 'DataView'],\n-      key\n-    );\n-  }\n+  key = checkIsArrayBufferView('key', toBuf(key));\n \n-  signature = toBuf(signature, sigEncoding);\n-  if (!isArrayBufferView(signature)) {\n-    throw new ERR_INVALID_ARG_TYPE(\n-      'signature',\n-      ['string', 'Buffer', 'TypedArray', 'DataView'],\n-      signature\n-    );\n-  }\n+  signature = checkIsArrayBufferView('signature',\n+                                     toBuf(signature, sigEncoding));\n \n   return this._handle.verify(key, signature, rsaPadding, pssSaltLength);\n };"
        },
        {
            "sha": "59a5d57a1e4f395365b5e6a0afd40ff912c5142b",
            "filename": "lib/internal/crypto/util.js",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/fe70af90726b8105b10e172996561685133e4662/lib%2Finternal%2Fcrypto%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/fe70af90726b8105b10e172996561685133e4662/lib%2Finternal%2Fcrypto%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Futil.js?ref=fe70af90726b8105b10e172996561685133e4662",
            "patch": "@@ -83,7 +83,19 @@ function timingSafeEqual(buf1, buf2) {\n   return _timingSafeEqual(buf1, buf2);\n }\n \n+function checkIsArrayBufferView(name, buffer) {\n+  if (!isArrayBufferView(buffer)) {\n+    throw new ERR_INVALID_ARG_TYPE(\n+      name,\n+      ['string', 'Buffer', 'TypedArray', 'DataView'],\n+      buffer\n+    );\n+  }\n+  return buffer;\n+}\n+\n module.exports = {\n+  checkIsArrayBufferView,\n   getCiphers,\n   getCurves,\n   getDefaultEncoding,"
        }
    ],
    "stats": {
        "total": 51,
        "additions": 18,
        "deletions": 33
    }
}