{
    "author": "BridgeAR",
    "message": "assert: fix wrong message indentation\n\nIf code is read from a file and that code is indented, it would be\nmisaligned. This makes sure it has a natural indentation that is\nrelative to the starting point of the assertion.\n\nPR-URL: https://github.com/nodejs/node/pull/20791\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Khaidi Chu <i@2333.moe>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "9c2e67ba97a4af0bb83c621b0c724f84198eac2d",
    "files": [
        {
            "sha": "0abe92112787739d0072daf0ff32de1b12d82e83",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/9c2e67ba97a4af0bb83c621b0c724f84198eac2d/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/9c2e67ba97a4af0bb83c621b0c724f84198eac2d/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=9c2e67ba97a4af0bb83c621b0c724f84198eac2d",
            "patch": "@@ -193,6 +193,19 @@ function getErrMessage(call) {\n       if (EOL === '\\r\\n') {\n         message = message.replace(/\\r\\n/g, '\\n');\n       }\n+      // Always normalize indentation, otherwise the message could look weird.\n+      if (message.indexOf('\\n') !== -1) {\n+        const tmp = message.split('\\n');\n+        message = tmp[0];\n+        for (var i = 1; i < tmp.length; i++) {\n+          let pos = 0;\n+          while (pos < column &&\n+              (tmp[i][pos] === ' ' || tmp[i][pos] === '\\t')) {\n+            pos++;\n+          }\n+          message += `\\n  ${tmp[i].slice(pos)}`;\n+        }\n+      }\n       message = 'The expression evaluated to a falsy value:' +\n         `\\n\\n  assert${ok}(${message})\\n`;\n     }"
        },
        {
            "sha": "bb58e2857f4742b0adc2a903a8ccda9f8a9f226f",
            "filename": "test/parallel/test-assert.js",
            "status": "modified",
            "additions": 47,
            "deletions": 6,
            "changes": 53,
            "blob_url": "https://github.com/nodejs/node/blob/9c2e67ba97a4af0bb83c621b0c724f84198eac2d/test%2Fparallel%2Ftest-assert.js",
            "raw_url": "https://github.com/nodejs/node/raw/9c2e67ba97a4af0bb83c621b0c724f84198eac2d/test%2Fparallel%2Ftest-assert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert.js?ref=9c2e67ba97a4af0bb83c621b0c724f84198eac2d",
            "patch": "@@ -694,14 +694,55 @@ common.expectsError(\n   {\n     code: 'ERR_ASSERTION',\n     type: assert.AssertionError,\n-    message: 'The expression evaluated to a falsy value:\\n\\n  ' +\n-             \"assert((() => 'string')()\\n\" +\n-             '      // eslint-disable-next-line\\n' +\n-             '      ===\\n' +\n-             '      123 instanceof\\n' +\n-             '          Buffer)\\n'\n+    message: 'The expression evaluated to a falsy value:\\n\\n' +\n+             '  assert((() => \\'string\\')()\\n' +\n+             '    // eslint-disable-next-line\\n' +\n+             '    ===\\n' +\n+             '    123 instanceof\\n' +\n+             '        Buffer)\\n'\n+  }\n+);\n+\n+common.expectsError(\n+  () => {\n+    a(\n+      (() => 'string')()\n+      // eslint-disable-next-line\n+      ===\n+  123 instanceof\n+          Buffer\n+    );\n+  },\n+  {\n+    code: 'ERR_ASSERTION',\n+    type: assert.AssertionError,\n+    message: 'The expression evaluated to a falsy value:\\n\\n' +\n+             '  assert((() => \\'string\\')()\\n' +\n+             '    // eslint-disable-next-line\\n' +\n+             '    ===\\n' +\n+             '  123 instanceof\\n' +\n+             '        Buffer)\\n'\n+  }\n+);\n+\n+/* eslint-disable indent */\n+common.expectsError(() => {\n+a((\n+  () => 'string')() ===\n+123 instanceof\n+Buffer\n+);\n+}, {\n+  code: 'ERR_ASSERTION',\n+  type: assert.AssertionError,\n+  message: 'The expression evaluated to a falsy value:\\n\\n' +\n+           '  assert((\\n' +\n+           '    () => \\'string\\')() ===\\n' +\n+           '  123 instanceof\\n' +\n+           '  Buffer)\\n'\n   }\n );\n+/* eslint-enable indent */\n \n common.expectsError(\n   () => assert(null, undefined),"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 60,
        "deletions": 6
    }
}