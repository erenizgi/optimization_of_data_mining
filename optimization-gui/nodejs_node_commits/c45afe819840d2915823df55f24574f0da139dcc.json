{
    "author": "unknown",
    "message": "tools: non-Ascii linter for /lib only\n\nNon-ASCII characters in /lib get compiled into the node binary,\nand may bloat the binary size unnecessarily. A linter rule may\nhelp prevent this.\n\nPR-URL: https://github.com/nodejs/node/pull/18043\nFixes: https://github.com/nodejs/node/issues/11209\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Teddy Katz <teddy.katz@gmail.com>",
    "sha": "c45afe819840d2915823df55f24574f0da139dcc",
    "files": [
        {
            "sha": "0b00638e2a638c106368371724eda4eb8ee04bba",
            "filename": "lib/.eslintrc.yaml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/c45afe819840d2915823df55f24574f0da139dcc/lib%2F.eslintrc.yaml",
            "raw_url": "https://github.com/nodejs/node/raw/c45afe819840d2915823df55f24574f0da139dcc/lib%2F.eslintrc.yaml",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F.eslintrc.yaml?ref=c45afe819840d2915823df55f24574f0da139dcc",
            "patch": "@@ -6,3 +6,4 @@ rules:\n   buffer-constructor: error\n   no-let-in-for-declaration: error\n   lowercase-name-for-primitive: error\n+  non-ascii-character: error"
        },
        {
            "sha": "e216934a7f746412f2976f3faae0133acf87d805",
            "filename": "lib/console.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/c45afe819840d2915823df55f24574f0da139dcc/lib%2Fconsole.js",
            "raw_url": "https://github.com/nodejs/node/raw/c45afe819840d2915823df55f24574f0da139dcc/lib%2Fconsole.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fconsole.js?ref=c45afe819840d2915823df55f24574f0da139dcc",
            "patch": "@@ -84,7 +84,7 @@ function createWriteErrorHandler(stream) {\n       // If there was an error, it will be emitted on `stream` as\n       // an `error` event. Adding a `once` listener will keep that error\n       // from becoming an uncaught exception, but since the handler is\n-      // removed after the event, non-console.* writes won’t be affected.\n+      // removed after the event, non-console.* writes won't be affected.\n       // we are only adding noop if there is no one else listening for 'error'\n       if (stream.listenerCount('error') === 0) {\n         stream.on('error', noop);\n@@ -125,7 +125,7 @@ function write(ignoreErrors, stream, string, errorhandler, groupIndent) {\n     // even in edge cases such as low stack space.\n     if (e.message === MAX_STACK_MESSAGE && e.name === 'RangeError')\n       throw e;\n-    // Sorry, there’s no proper way to pass along the error here.\n+    // Sorry, there's no proper way to pass along the error here.\n   } finally {\n     stream.removeListener('error', noop);\n   }"
        },
        {
            "sha": "7702d998fa72688b3e783eae720c9da352374229",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c45afe819840d2915823df55f24574f0da139dcc/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/c45afe819840d2915823df55f24574f0da139dcc/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=c45afe819840d2915823df55f24574f0da139dcc",
            "patch": "@@ -1884,7 +1884,7 @@ function processRespondWithFD(self, fd, headers, offset = 0, length = -1,\n     return;\n   }\n   // exact length of the file doesn't matter here, since the\n-  // stream is closing anyway — just use 1 to signify that\n+  // stream is closing anyway - just use 1 to signify that\n   // a write does exist\n   trackWriteState(self, 1);\n }"
        },
        {
            "sha": "7172a43ec20a8ae29f829794ade0acc7e469e58b",
            "filename": "lib/internal/test/unicode.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c45afe819840d2915823df55f24574f0da139dcc/lib%2Finternal%2Ftest%2Funicode.js",
            "raw_url": "https://github.com/nodejs/node/raw/c45afe819840d2915823df55f24574f0da139dcc/lib%2Finternal%2Ftest%2Funicode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ftest%2Funicode.js?ref=c45afe819840d2915823df55f24574f0da139dcc",
            "patch": "@@ -3,4 +3,6 @@\n // This module exists entirely for regression testing purposes.\n // See `test/parallel/test-internal-unicode.js`.\n \n+/* eslint-disable non-ascii-character */\n module.exports = '✓';\n+/* eslint-enable non-ascii-character */"
        },
        {
            "sha": "9a816600a05e5a0f55d4d435423d9f81bfebb3f1",
            "filename": "lib/stream.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c45afe819840d2915823df55f24574f0da139dcc/lib%2Fstream.js",
            "raw_url": "https://github.com/nodejs/node/raw/c45afe819840d2915823df55f24574f0da139dcc/lib%2Fstream.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fstream.js?ref=c45afe819840d2915823df55f24574f0da139dcc",
            "patch": "@@ -45,7 +45,7 @@ try {\n   try {\n     Stream._isUint8Array = process.binding('util').isUint8Array;\n   } catch (e) {\n-    // This throws for Node < 4.2.0 because there’s no util binding and\n+    // This throws for Node < 4.2.0 because there's no util binding and\n     // returns undefined for Node < 7.4.0.\n   }\n }"
        },
        {
            "sha": "8d061ab0147e3df1f300d1fd84cab3ef210fb184",
            "filename": "lib/timers.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c45afe819840d2915823df55f24574f0da139dcc/lib%2Ftimers.js",
            "raw_url": "https://github.com/nodejs/node/raw/c45afe819840d2915823df55f24574f0da139dcc/lib%2Ftimers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftimers.js?ref=c45afe819840d2915823df55f24574f0da139dcc",
            "patch": "@@ -97,6 +97,7 @@ const Timeout = timerInternals.Timeout;\n // TimerWrap C++ handle, which makes the call after the duration to process the\n // list it is attached to.\n //\n+/* eslint-disable non-ascii-character */\n //\n // ╔════ > Object Map\n // ║\n@@ -118,6 +119,7 @@ const Timeout = timerInternals.Timeout;\n // ║\n // ╚════ > Linked List\n //\n+/* eslint-enable non-ascii-character */\n //\n // With this, virtually constant-time insertion (append), removal, and timeout\n // is possible in the JavaScript layer. Any one list of timers is able to be"
        },
        {
            "sha": "6262ddb6bc652285e144b57eb7f2bf6876469e5d",
            "filename": "lib/zlib.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/c45afe819840d2915823df55f24574f0da139dcc/lib%2Fzlib.js",
            "raw_url": "https://github.com/nodejs/node/raw/c45afe819840d2915823df55f24574f0da139dcc/lib%2Fzlib.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fzlib.js?ref=c45afe819840d2915823df55f24574f0da139dcc",
            "patch": "@@ -374,7 +374,7 @@ Zlib.prototype.flush = function flush(kind, callback) {\n     this._scheduledFlushFlag = maxFlush(kind, this._scheduledFlushFlag);\n \n     // If a callback was passed, always register a new `drain` + flush handler,\n-    // mostly because that’s simpler and flush callbacks piling up is a rare\n+    // mostly because that's simpler and flush callbacks piling up is a rare\n     // thing anyway.\n     if (!alreadyHadFlushScheduled || callback) {\n       const drainHandler = () => this.flush(this._scheduledFlushFlag, callback);"
        },
        {
            "sha": "e67aac7cd91e822ebf655ce61b83bbc344e55fc7",
            "filename": "tools/eslint-rules/non-ascii-character.js",
            "status": "added",
            "additions": 61,
            "deletions": 0,
            "changes": 61,
            "blob_url": "https://github.com/nodejs/node/blob/c45afe819840d2915823df55f24574f0da139dcc/tools%2Feslint-rules%2Fnon-ascii-character.js",
            "raw_url": "https://github.com/nodejs/node/raw/c45afe819840d2915823df55f24574f0da139dcc/tools%2Feslint-rules%2Fnon-ascii-character.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Feslint-rules%2Fnon-ascii-character.js?ref=c45afe819840d2915823df55f24574f0da139dcc",
            "patch": "@@ -0,0 +1,61 @@\n+/**\n+ * @fileOverview Any non-ASCII characters in lib/ will increase the size\n+ *               of the compiled node binary. This linter rule ensures that\n+ *               any such character is reported.\n+ * @author Sarat Addepalli <sarat.addepalli@gmail.com>\n+ */\n+\n+'use strict';\n+\n+//------------------------------------------------------------------------------\n+// Rule Definition\n+//------------------------------------------------------------------------------\n+\n+const nonAsciiRegexPattern = /[^\\r\\n\\x20-\\x7e]/;\n+const suggestions = {\n+  '’': '\\'',\n+  '‛': '\\'',\n+  '‘': '\\'',\n+  '“': '\"',\n+  '‟': '\"',\n+  '”': '\"',\n+  '«': '\"',\n+  '»': '\"',\n+  '—': '-'\n+};\n+\n+module.exports = (context) => {\n+\n+  const reportIfError = (node, sourceCode) => {\n+\n+    const matches = sourceCode.text.match(nonAsciiRegexPattern);\n+\n+    if (!matches) return;\n+\n+    const offendingCharacter = matches[0];\n+    const offendingCharacterPosition = matches.index;\n+    const suggestion = suggestions[offendingCharacter];\n+\n+    let message = `Non-ASCII character '${offendingCharacter}' detected.`;\n+\n+    message = suggestion ?\n+      `${message} Consider replacing with: ${suggestion}` :\n+      message;\n+\n+    context.report({\n+      node,\n+      message,\n+      loc: sourceCode.getLocFromIndex(offendingCharacterPosition),\n+      fix: (fixer) => {\n+        return fixer.replaceText(\n+          node,\n+          suggestion ? `${suggestion}` : ''\n+        );\n+      }\n+    });\n+  };\n+\n+  return {\n+    Program: (node) => reportIfError(node, context.getSourceCode())\n+  };\n+};"
        }
    ],
    "stats": {
        "total": 76,
        "additions": 71,
        "deletions": 5
    }
}