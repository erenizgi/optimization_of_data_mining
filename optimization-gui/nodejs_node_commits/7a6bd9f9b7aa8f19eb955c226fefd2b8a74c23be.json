{
    "author": "joyeecheung",
    "message": "src: pass isMainThread into bootstrap/node.js directly\n\nInstead of loading the working binding for the sole purpose of\ndetecting whether we are inside the main thread unconditionally.\n\nPR-URL: https://github.com/nodejs/node/pull/25017\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be",
    "files": [
        {
            "sha": "35565769d21706506f0e511da4a068a022622d1c",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be",
            "patch": "@@ -15,6 +15,8 @@\n // This file is compiled as if it's wrapped in a function with arguments\n // passed by node::LoadEnvironment()\n /* global process, bootstrappers, loaderExports, triggerFatalException */\n+/* global isMainThread */\n+\n const {\n   _setupTraceCategoryState,\n   _setupNextTick,\n@@ -28,7 +30,6 @@ const {\n const { internalBinding, NativeModule } = loaderExports;\n \n const exceptionHandlerState = { captureFn: null };\n-const isMainThread = internalBinding('worker').threadId === 0;\n \n function startup() {\n   setupTraceCategoryState();"
        },
        {
            "sha": "93fcca6bebcd3c1b25fa84e12f24a30cd387dc9f",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be",
            "patch": "@@ -1276,14 +1276,16 @@ void LoadEnvironment(Environment* env) {\n       env->process_string(),\n       FIXED_ONE_BYTE_STRING(isolate, \"bootstrappers\"),\n       FIXED_ONE_BYTE_STRING(isolate, \"loaderExports\"),\n-      FIXED_ONE_BYTE_STRING(isolate, \"triggerFatalException\")};\n+      FIXED_ONE_BYTE_STRING(isolate, \"triggerFatalException\"),\n+      FIXED_ONE_BYTE_STRING(isolate, \"isMainThread\")};\n   std::vector<Local<Value>> node_args = {\n       process,\n       bootstrapper,\n       loader_exports.ToLocalChecked(),\n       env->NewFunctionTemplate(FatalException)\n           ->GetFunction(context)\n-          .ToLocalChecked()};\n+          .ToLocalChecked(),\n+      Boolean::New(isolate, env->is_main_thread())};\n \n   if (ExecuteBootstrapper(\n           env, \"internal/bootstrap/node\", &node_params, &node_args)"
        },
        {
            "sha": "8f1592084cd31f61635566957e837085767ebf0d",
            "filename": "test/parallel/test-bootstrap-modules.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be/test%2Fparallel%2Ftest-bootstrap-modules.js",
            "raw_url": "https://github.com/nodejs/node/raw/7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be/test%2Fparallel%2Ftest-bootstrap-modules.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-bootstrap-modules.js?ref=7a6bd9f9b7aa8f19eb955c226fefd2b8a74c23be",
            "patch": "@@ -9,7 +9,7 @@ const common = require('../common');\n const assert = require('assert');\n \n const isMainThread = common.isMainThread;\n-const kMaxModuleCount = isMainThread ? 60 : 82;\n+const kMaxModuleCount = isMainThread ? 59 : 82;\n \n assert(list.length <= kMaxModuleCount,\n        `Total length: ${list.length}\\n` + list.join('\\n')"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 7,
        "deletions": 4
    }
}