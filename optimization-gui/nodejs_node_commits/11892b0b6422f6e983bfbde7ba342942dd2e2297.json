{
    "author": "AyushG3112",
    "message": "url: introduce `URL_FLAGS_IS_DEFAULT_SCHEME_PORT` flag\n\nIntroduce `URL_FLAGS_IS_DEFAULT_SCHEME_PORT` flag which is retured\nwhen the parser detects that the port passed is the default port\nfor that scheme.\n\nPR-URL: https://github.com/nodejs/node/pull/20479\nFixes: https://github.com/nodejs/node/issues/20465\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "11892b0b6422f6e983bfbde7ba342942dd2e2297",
    "files": [
        {
            "sha": "7a67fe2f15ef4adfaac95229d33c906658c35e5d",
            "filename": "lib/internal/url.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/11892b0b6422f6e983bfbde7ba342942dd2e2297/lib%2Finternal%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/11892b0b6422f6e983bfbde7ba342942dd2e2297/lib%2Finternal%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Furl.js?ref=11892b0b6422f6e983bfbde7ba342942dd2e2297",
            "patch": "@@ -46,6 +46,7 @@ const {\n   URL_FLAGS_HAS_PATH,\n   URL_FLAGS_HAS_QUERY,\n   URL_FLAGS_HAS_USERNAME,\n+  URL_FLAGS_IS_DEFAULT_SCHEME_PORT,\n   URL_FLAGS_SPECIAL,\n   kFragment,\n   kHost,\n@@ -276,7 +277,7 @@ function onParsePortComplete(flags, protocol, username, password,\n function onParseHostComplete(flags, protocol, username, password,\n                              host, port, path, query, fragment) {\n   onParseHostnameComplete.apply(this, arguments);\n-  if (port !== null)\n+  if (port !== null || ((flags & URL_FLAGS_IS_DEFAULT_SCHEME_PORT) !== 0))\n     onParsePortComplete.apply(this, arguments);\n }\n "
        },
        {
            "sha": "82c093d516bc4a06dfc54ae97161fb5ea585d6b4",
            "filename": "src/node_url.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/11892b0b6422f6e983bfbde7ba342942dd2e2297/src%2Fnode_url.cc",
            "raw_url": "https://github.com/nodejs/node/raw/11892b0b6422f6e983bfbde7ba342942dd2e2297/src%2Fnode_url.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_url.cc?ref=11892b0b6422f6e983bfbde7ba342942dd2e2297",
            "patch": "@@ -1749,6 +1749,8 @@ void URL::Parse(const char* input,\n             }\n             // the port is valid\n             url->port = NormalizePort(url->scheme, static_cast<int>(port));\n+            if (url->port == -1)\n+              url->flags |= URL_FLAGS_IS_DEFAULT_SCHEME_PORT;\n             buffer.clear();\n           } else if (has_state_override) {\n             // TODO(TimothyGu): Similar case as above."
        },
        {
            "sha": "b2eadf9923a7ea3ec398506a5dd87928349f3146",
            "filename": "src/node_url.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/11892b0b6422f6e983bfbde7ba342942dd2e2297/src%2Fnode_url.h",
            "raw_url": "https://github.com/nodejs/node/raw/11892b0b6422f6e983bfbde7ba342942dd2e2297/src%2Fnode_url.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_url.h?ref=11892b0b6422f6e983bfbde7ba342942dd2e2297",
            "patch": "@@ -50,7 +50,8 @@ using v8::Value;\n   XX(URL_FLAGS_HAS_HOST, 0x80)                                                \\\n   XX(URL_FLAGS_HAS_PATH, 0x100)                                               \\\n   XX(URL_FLAGS_HAS_QUERY, 0x200)                                              \\\n-  XX(URL_FLAGS_HAS_FRAGMENT, 0x400)\n+  XX(URL_FLAGS_HAS_FRAGMENT, 0x400)                                           \\\n+  XX(URL_FLAGS_IS_DEFAULT_SCHEME_PORT, 0x800)                                 \\\n \n enum url_parse_state {\n   kUnknownState = -1,"
        },
        {
            "sha": "1e460ff2d8dd7c50e01229bf94d68a63da93f849",
            "filename": "test/fixtures/url-setter-tests.js",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/11892b0b6422f6e983bfbde7ba342942dd2e2297/test%2Ffixtures%2Furl-setter-tests.js",
            "raw_url": "https://github.com/nodejs/node/raw/11892b0b6422f6e983bfbde7ba342942dd2e2297/test%2Ffixtures%2Furl-setter-tests.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Ffixtures%2Furl-setter-tests.js?ref=11892b0b6422f6e983bfbde7ba342942dd2e2297",
            "patch": "@@ -2,7 +2,7 @@\n \n /* The following tests are copied from WPT. Modifications to them should be\n    upstreamed first. Refs:\n-   https://github.com/w3c/web-platform-tests/blob/ed4bb727ed/url/setters_tests.json\n+   https://github.com/w3c/web-platform-tests/blob/f0fe479/url/setters_tests.json\n    License: http://www.w3.org/Consortium/Legal/2008/04-testsuite-copyright.html\n */\n module.exports =\n@@ -727,6 +727,17 @@ module.exports =\n                 \"port\": \"80\"\n             }\n         },\n+        {\n+            \"comment\": \"Port number is removed if new port is scheme default and existing URL has a non-default port\",\n+            \"href\": \"http://example.net:8080\",\n+            \"new_value\": \"example.com:80\",\n+            \"expected\": {\n+                \"href\": \"http://example.com/\",\n+                \"host\": \"example.com\",\n+                \"hostname\": \"example.com\",\n+                \"port\": \"\"\n+            }\n+        },\n         {\n             \"comment\": \"Stuff after a / delimiter is ignored\",\n             \"href\": \"http://example.net/path\","
        }
    ],
    "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
    }
}