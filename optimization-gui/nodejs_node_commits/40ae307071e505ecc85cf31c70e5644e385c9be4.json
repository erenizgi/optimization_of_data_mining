{
    "author": "addaleax",
    "message": "src: avoid possible race during NodeBIO initialization\n\nPR-URL: https://github.com/nodejs/node/pull/21984\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "40ae307071e505ecc85cf31c70e5644e385c9be4",
    "files": [
        {
            "sha": "7f5544b8f221808aa43b971a65a07453927f5cb9",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/40ae307071e505ecc85cf31c70e5644e385c9be4/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/40ae307071e505ecc85cf31c70e5644e385c9be4/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=40ae307071e505ecc85cf31c70e5644e385c9be4",
            "patch": "@@ -5141,6 +5141,8 @@ void InitCryptoOnce() {\n   ERR_load_ENGINE_strings();\n   ENGINE_load_builtin_engines();\n #endif  // !OPENSSL_NO_ENGINE\n+\n+  NodeBIO::GetMethod();\n }\n \n "
        },
        {
            "sha": "269bccbc03a1d72ca4b56edee3258c1ea1400569",
            "filename": "src/node_crypto.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/40ae307071e505ecc85cf31c70e5644e385c9be4/src%2Fnode_crypto.h",
            "raw_url": "https://github.com/nodejs/node/raw/40ae307071e505ecc85cf31c70e5644e385c9be4/src%2Fnode_crypto.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.h?ref=40ae307071e505ecc85cf31c70e5644e385c9be4",
            "patch": "@@ -97,6 +97,8 @@ extern int VerifyCallback(int preverify_ok, X509_STORE_CTX* ctx);\n \n extern void UseExtraCaCerts(const std::string& file);\n \n+void InitCryptoOnce();\n+\n class SecureContext : public BaseObject {\n  public:\n   ~SecureContext() override {"
        },
        {
            "sha": "baa90204f2f97a3bd73d1ab82753d77a183b0ac3",
            "filename": "src/node_crypto_bio.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/40ae307071e505ecc85cf31c70e5644e385c9be4/src%2Fnode_crypto_bio.cc",
            "raw_url": "https://github.com/nodejs/node/raw/40ae307071e505ecc85cf31c70e5644e385c9be4/src%2Fnode_crypto_bio.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto_bio.cc?ref=40ae307071e505ecc85cf31c70e5644e385c9be4",
            "patch": "@@ -247,6 +247,8 @@ const BIO_METHOD* NodeBIO::GetMethod() {\n \n   return &method;\n #else\n+  // This is called from InitCryptoOnce() to avoid race conditions during\n+  // initialization.\n   static BIO_METHOD* method = nullptr;\n \n   if (method == nullptr) {"
        },
        {
            "sha": "0c61f19d0189d201c0f1a5038bf622b38041a17a",
            "filename": "src/node_crypto_bio.h",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/40ae307071e505ecc85cf31c70e5644e385c9be4/src%2Fnode_crypto_bio.h",
            "raw_url": "https://github.com/nodejs/node/raw/40ae307071e505ecc85cf31c70e5644e385c9be4/src%2Fnode_crypto_bio.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto_bio.h?ref=40ae307071e505ecc85cf31c70e5644e385c9be4",
            "patch": "@@ -164,6 +164,8 @@ class NodeBIO : public MemoryRetainer {\n   int eof_return_ = -1;\n   Buffer* read_head_ = nullptr;\n   Buffer* write_head_ = nullptr;\n+\n+  friend void node::crypto::InitCryptoOnce();\n };\n \n }  // namespace crypto"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 8,
        "deletions": 0
    }
}