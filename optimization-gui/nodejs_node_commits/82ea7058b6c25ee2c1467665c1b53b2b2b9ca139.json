{
    "author": "sagitsofan",
    "message": "lib: http server, friendly error messages\n\nImproved error message description for the http server binding errors.\n\nCurrently changed only in `setupListenHandle`, but needs to be\nchange all over.\n\nAdded new `uvExceptionWithHostPort` function (+export) in\n`lib/internal/error.js` that extracts the error message defined by\nlibuv, using the error code, and returns an error object with the\nfull error description.\n\nexample:\nold error message: `listen EADDRINUSE`\nnew error message: `listen EADDRINUSE: Address already in use`\n\nRemoved exportable function `_exceptionWithHostPort` from\n`lib/util.js` - exported by accident\n\nReplaced `exceptionWithHostPort` to the new function\n`uvExceptionWithHostPort` for a more detailed error.\n\nFixes: https://github.com/nodejs/node/issues/22936\n\nPR-URL: https://github.com/nodejs/node/pull/22995\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "82ea7058b6c25ee2c1467665c1b53b2b2b9ca139",
    "files": [
        {
            "sha": "58eba742e08685163d8db7d760f6dd4ac2de2edf",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 44,
            "deletions": 2,
            "changes": 46,
            "blob_url": "https://github.com/nodejs/node/blob/82ea7058b6c25ee2c1467665c1b53b2b2b9ca139/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/82ea7058b6c25ee2c1467665c1b53b2b2b9ca139/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=82ea7058b6c25ee2c1467665c1b53b2b2b9ca139",
            "patch": "@@ -285,6 +285,46 @@ function uvException(ctx) {\n   return err;\n }\n \n+/**\n+ * This creates an error compatible with errors produced in the C++\n+ * This function should replace the deprecated\n+ * `exceptionWithHostPort()` function.\n+ *\n+ * @param {number} err - A libuv error number\n+ * @param {string} syscall\n+ * @param {string} address\n+ * @param {number} [port]\n+ * @param {string} [additional]\n+ * @returns {Error}\n+ */\n+function uvExceptionWithHostPort(err, syscall, address, port, additional) {\n+  const [ code, uvmsg ] = errmap.get(err);\n+  const message = `${syscall} ${code}: ${uvmsg}`;\n+  let details = '';\n+\n+  if (port && port > 0) {\n+    details = ` ${address}:${port}`;\n+  } else if (address) {\n+    details = ` ${address}`;\n+  }\n+  if (additional) {\n+    details += ` - Local (${additional})`;\n+  }\n+\n+  // eslint-disable-next-line no-restricted-syntax\n+  const ex = new Error(`${message}${details}`);\n+  ex.code = code;\n+  ex.errno = code;\n+  ex.syscall = syscall;\n+  ex.address = address;\n+  if (port) {\n+    ex.port = port;\n+  }\n+\n+  Error.captureStackTrace(ex, uvExceptionWithHostPort);\n+  return ex;\n+}\n+\n /**\n  * This used to be util._errnoException().\n  *\n@@ -314,8 +354,9 @@ function errnoException(err, syscall, original) {\n }\n \n /**\n- * This used to be util._exceptionWithHostPort().\n- *\n+ * Deprecated, new function is `uvExceptionWithHostPort()`\n+ * New function added the error description directly\n+ * from C++. this method for backwards compatibility\n  * @param {number} err - A libuv error number\n  * @param {string} syscall\n  * @param {string} address\n@@ -437,6 +478,7 @@ module.exports = {\n   errnoException,\n   exceptionWithHostPort,\n   uvException,\n+  uvExceptionWithHostPort,\n   isStackOverflowError,\n   getMessage,\n   SystemError,"
        },
        {
            "sha": "33ce1f74eb2fbafd5a84ae81e024be8f21d404e4",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/82ea7058b6c25ee2c1467665c1b53b2b2b9ca139/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/82ea7058b6c25ee2c1467665c1b53b2b2b9ca139/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=82ea7058b6c25ee2c1467665c1b53b2b2b9ca139",
            "patch": "@@ -84,7 +84,11 @@ const kLastWriteQueueSize = Symbol('lastWriteQueueSize');\n let cluster;\n let dns;\n \n-const { errnoException, exceptionWithHostPort } = errors;\n+const {\n+  errnoException,\n+  exceptionWithHostPort,\n+  uvExceptionWithHostPort\n+} = errors;\n \n const {\n   kTimeout,\n@@ -1266,7 +1270,7 @@ function setupListenHandle(address, port, addressType, backlog, fd) {\n       rval = createServerHandle(address, port, addressType, fd);\n \n     if (typeof rval === 'number') {\n-      var error = exceptionWithHostPort(rval, 'listen', address, port);\n+      var error = uvExceptionWithHostPort(rval, 'listen', address, port);\n       process.nextTick(emitErrorNT, this, error);\n       return;\n     }\n@@ -1283,7 +1287,7 @@ function setupListenHandle(address, port, addressType, backlog, fd) {\n   var err = this._handle.listen(backlog || 511);\n \n   if (err) {\n-    var ex = exceptionWithHostPort(err, 'listen', address, port);\n+    var ex = uvExceptionWithHostPort(err, 'listen', address, port);\n     this._handle.close();\n     this._handle = null;\n     defaultTriggerAsyncIdScope(this[async_id_symbol],"
        },
        {
            "sha": "0d59bd76cad8a825ae1dd5f949af377a17342841",
            "filename": "test/parallel/test-net-server-listen-handle.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/82ea7058b6c25ee2c1467665c1b53b2b2b9ca139/test%2Fparallel%2Ftest-net-server-listen-handle.js",
            "raw_url": "https://github.com/nodejs/node/raw/82ea7058b6c25ee2c1467665c1b53b2b2b9ca139/test%2Fparallel%2Ftest-net-server-listen-handle.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-net-server-listen-handle.js?ref=82ea7058b6c25ee2c1467665c1b53b2b2b9ca139",
            "patch": "@@ -150,7 +150,7 @@ if (!common.isWindows) {  // Windows doesn't support {fd: <n>}\n   net.createServer()\n     .listen({ fd }, common.mustNotCall())\n     .on('error', common.mustCall(function(err) {\n-      assert.strictEqual(String(err), 'Error: listen EINVAL');\n+      assert.strictEqual(String(err), 'Error: listen EINVAL: invalid argument');\n       this.close();\n     }));\n }"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 52,
        "deletions": 6
    }
}