{
    "author": "danbev",
    "message": "test: fix NewFromUtf8 compiler warning\n\nCurrently there are a number of compiler warnings like the following:\n\n../binding.cc:6:41:\nwarning: 'NewFromUtf8' is deprecated:\nUse maybe version [-Wdeprecated-declarations]\n  args.GetReturnValue().Set(v8::String::NewFromUtf8(isolate, \"world\"));\n                                        ^\n/node/deps/v8/include/v8.h:2883:10:\nnote: 'NewFromUtf8' has been explicitly marked deprecated here\n  static V8_DEPRECATE_SOON(\n         ^\n/node/deps/v8/include/v8config.h:341:29:\nnote: expanded from macro 'V8_DEPRECATE_SOON'\n  declarator __attribute__((deprecated(message)))\n                            ^\n\nThis commit updates the code to use the maybe versions.\n\nPR-URL: https://github.com/nodejs/node/pull/24216\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "d58a0c628591a318b4692355f4a08140e17d61df",
    "files": [
        {
            "sha": "e2530acb77d5e0c8a28fcb26ba924882067a9831",
            "filename": "doc/api/addons.md",
            "status": "modified",
            "additions": 35,
            "deletions": 11,
            "changes": 46,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/doc%2Fapi%2Faddons.md",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/doc%2Fapi%2Faddons.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Faddons.md?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -63,13 +63,15 @@ namespace demo {\n using v8::FunctionCallbackInfo;\n using v8::Isolate;\n using v8::Local;\n+using v8::NewStringType;\n using v8::Object;\n using v8::String;\n using v8::Value;\n \n void Method(const FunctionCallbackInfo<Value>& args) {\n   Isolate* isolate = args.GetIsolate();\n-  args.GetReturnValue().Set(String::NewFromUtf8(isolate, \"world\"));\n+  args.GetReturnValue().Set(String::NewFromUtf8(\n+      isolate, \"world\", NewStringType::kNormal).ToLocalChecked());\n }\n \n void Initialize(Local<Object> exports) {\n@@ -464,6 +466,7 @@ using v8::Exception;\n using v8::FunctionCallbackInfo;\n using v8::Isolate;\n using v8::Local;\n+using v8::NewStringType;\n using v8::Number;\n using v8::Object;\n using v8::String;\n@@ -479,14 +482,18 @@ void Add(const FunctionCallbackInfo<Value>& args) {\n   if (args.Length() < 2) {\n     // Throw an Error that is passed back to JavaScript\n     isolate->ThrowException(Exception::TypeError(\n-        String::NewFromUtf8(isolate, \"Wrong number of arguments\")));\n+        String::NewFromUtf8(isolate,\n+                            \"Wrong number of arguments\",\n+                            NewStringType::kNormal).ToLocalChecked()));\n     return;\n   }\n \n   // Check the argument types\n   if (!args[0]->IsNumber() || !args[1]->IsNumber()) {\n     isolate->ThrowException(Exception::TypeError(\n-        String::NewFromUtf8(isolate, \"Wrong arguments\")));\n+        String::NewFromUtf8(isolate,\n+                            \"Wrong arguments\",\n+                            NewStringType::kNormal).ToLocalChecked()));\n     return;\n   }\n \n@@ -534,6 +541,7 @@ using v8::Function;\n using v8::FunctionCallbackInfo;\n using v8::Isolate;\n using v8::Local;\n+using v8::NewStringType;\n using v8::Null;\n using v8::Object;\n using v8::String;\n@@ -543,7 +551,10 @@ void RunCallback(const FunctionCallbackInfo<Value>& args) {\n   Isolate* isolate = args.GetIsolate();\n   Local<Function> cb = Local<Function>::Cast(args[0]);\n   const unsigned argc = 1;\n-  Local<Value> argv[argc] = { String::NewFromUtf8(isolate, \"hello world\") };\n+  Local<Value> argv[argc] = {\n+      String::NewFromUtf8(isolate,\n+                          \"hello world\",\n+                          NewStringType::kNormal).ToLocalChecked() };\n   cb->Call(Null(isolate), argc, argv);\n }\n \n@@ -591,6 +602,7 @@ using v8::Context;\n using v8::FunctionCallbackInfo;\n using v8::Isolate;\n using v8::Local;\n+using v8::NewStringType;\n using v8::Object;\n using v8::String;\n using v8::Value;\n@@ -600,7 +612,9 @@ void CreateObject(const FunctionCallbackInfo<Value>& args) {\n   Local<Context> context = isolate->GetCurrentContext();\n \n   Local<Object> obj = Object::New(isolate);\n-  obj->Set(String::NewFromUtf8(isolate, \"msg\"),\n+  obj->Set(String::NewFromUtf8(isolate,\n+                               \"msg\",\n+                               NewStringType::kNormal).ToLocalChecked(),\n                                args[0]->ToString(context).ToLocalChecked());\n \n   args.GetReturnValue().Set(obj);\n@@ -644,13 +658,15 @@ using v8::FunctionCallbackInfo;\n using v8::FunctionTemplate;\n using v8::Isolate;\n using v8::Local;\n+using v8::NewStringType;\n using v8::Object;\n using v8::String;\n using v8::Value;\n \n void MyFunction(const FunctionCallbackInfo<Value>& args) {\n   Isolate* isolate = args.GetIsolate();\n-  args.GetReturnValue().Set(String::NewFromUtf8(isolate, \"hello world\"));\n+  args.GetReturnValue().Set(String::NewFromUtf8(\n+      isolate, \"hello world\", NewStringType::kNormal).ToLocalChecked());\n }\n \n void CreateFunction(const FunctionCallbackInfo<Value>& args) {\n@@ -661,7 +677,8 @@ void CreateFunction(const FunctionCallbackInfo<Value>& args) {\n   Local<Function> fn = tpl->GetFunction(context).ToLocalChecked();\n \n   // omit this to make it anonymous\n-  fn->SetName(String::NewFromUtf8(isolate, \"theFunction\"));\n+  fn->SetName(String::NewFromUtf8(\n+      isolate, \"theFunction\", NewStringType::kNormal).ToLocalChecked());\n \n   args.GetReturnValue().Set(fn);\n }\n@@ -757,6 +774,7 @@ using v8::FunctionCallbackInfo;\n using v8::FunctionTemplate;\n using v8::Isolate;\n using v8::Local;\n+using v8::NewStringType;\n using v8::Number;\n using v8::Object;\n using v8::Persistent;\n@@ -776,15 +794,17 @@ void MyObject::Init(Local<Object> exports) {\n \n   // Prepare constructor template\n   Local<FunctionTemplate> tpl = FunctionTemplate::New(isolate, New);\n-  tpl->SetClassName(String::NewFromUtf8(isolate, \"MyObject\"));\n+  tpl->SetClassName(String::NewFromUtf8(\n+      isolate, \"MyObject\", NewStringType::kNormal).ToLocalChecked());\n   tpl->InstanceTemplate()->SetInternalFieldCount(1);\n \n   // Prototype\n   NODE_SET_PROTOTYPE_METHOD(tpl, \"plusOne\", PlusOne);\n \n   Local<Context> context = isolate->GetCurrentContext();\n   constructor.Reset(isolate, tpl->GetFunction(context).ToLocalChecked());\n-  exports->Set(String::NewFromUtf8(isolate, \"MyObject\"),\n+  exports->Set(String::NewFromUtf8(\n+      isolate, \"MyObject\", NewStringType::kNormal).ToLocalChecked(),\n                tpl->GetFunction(context).ToLocalChecked());\n }\n \n@@ -952,6 +972,7 @@ using v8::FunctionCallbackInfo;\n using v8::FunctionTemplate;\n using v8::Isolate;\n using v8::Local;\n+using v8::NewStringType;\n using v8::Number;\n using v8::Object;\n using v8::Persistent;\n@@ -969,7 +990,8 @@ MyObject::~MyObject() {\n void MyObject::Init(Isolate* isolate) {\n   // Prepare constructor template\n   Local<FunctionTemplate> tpl = FunctionTemplate::New(isolate, New);\n-  tpl->SetClassName(String::NewFromUtf8(isolate, \"MyObject\"));\n+  tpl->SetClassName(String::NewFromUtf8(\n+      isolate, \"MyObject\", NewStringType::kNormal).ToLocalChecked());\n   tpl->InstanceTemplate()->SetInternalFieldCount(1);\n \n   // Prototype\n@@ -1167,6 +1189,7 @@ using v8::FunctionCallbackInfo;\n using v8::FunctionTemplate;\n using v8::Isolate;\n using v8::Local;\n+using v8::NewStringType;\n using v8::Object;\n using v8::Persistent;\n using v8::String;\n@@ -1183,7 +1206,8 @@ MyObject::~MyObject() {\n void MyObject::Init(Isolate* isolate) {\n   // Prepare constructor template\n   Local<FunctionTemplate> tpl = FunctionTemplate::New(isolate, New);\n-  tpl->SetClassName(String::NewFromUtf8(isolate, \"MyObject\"));\n+  tpl->SetClassName(String::NewFromUtf8(\n+      isolate, \"MyObject\", NewStringType::kNormal).ToLocalChecked());\n   tpl->InstanceTemplate()->SetInternalFieldCount(1);\n \n   Local<Context> context = isolate->GetCurrentContext();"
        },
        {
            "sha": "6a6c297b52fff9ca2960fb4a112a9f8d4c0a2bc7",
            "filename": "test/addons/dlopen-ping-pong/binding.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fdlopen-ping-pong%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fdlopen-ping-pong%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fdlopen-ping-pong%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -15,6 +15,7 @@ using v8::FunctionCallbackInfo;\n using v8::Isolate;\n using v8::Local;\n using v8::Object;\n+using v8::NewStringType;\n using v8::String;\n using v8::Value;\n \n@@ -33,7 +34,8 @@ void LoadLibrary(const FunctionCallbackInfo<Value>& args) {\n void Ping(const FunctionCallbackInfo<Value>& args) {\n   Isolate* isolate = args.GetIsolate();\n   assert(ping_func != nullptr);\n-  args.GetReturnValue().Set(String::NewFromUtf8(isolate, ping_func()));\n+  args.GetReturnValue().Set(String::NewFromUtf8(\n+        isolate, ping_func(), NewStringType::kNormal).ToLocalChecked());\n }\n \n void init(Local<Object> exports) {"
        },
        {
            "sha": "29f58a5920825a5016def0cd10f6e16ca6b731cf",
            "filename": "test/addons/heap-profiler/binding.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fheap-profiler%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fheap-profiler%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fheap-profiler%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -19,7 +19,8 @@ inline void Test(const v8::FunctionCallbackInfo<v8::Value>& args) {\n inline void Initialize(v8::Local<v8::Object> binding) {\n   v8::Isolate* const isolate = binding->GetIsolate();\n   v8::Local<v8::Context> context = isolate->GetCurrentContext();\n-  binding->Set(v8::String::NewFromUtf8(isolate, \"test\"),\n+  binding->Set(v8::String::NewFromUtf8(\n+        isolate, \"test\", v8::NewStringType::kNormal).ToLocalChecked(),\n                v8::FunctionTemplate::New(isolate, Test)\n                    ->GetFunction(context)\n                    .ToLocalChecked());"
        },
        {
            "sha": "02eecec099807a1add9d1fdc8dad4e0798abd7cf",
            "filename": "test/addons/hello-world-esm/binding.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fhello-world-esm%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fhello-world-esm%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fhello-world-esm%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -3,7 +3,8 @@\n \n void Method(const v8::FunctionCallbackInfo<v8::Value>& args) {\n   v8::Isolate* isolate = args.GetIsolate();\n-  args.GetReturnValue().Set(v8::String::NewFromUtf8(isolate, \"world\"));\n+  args.GetReturnValue().Set(v8::String::NewFromUtf8(\n+        isolate, \"world\", v8::NewStringType::kNormal).ToLocalChecked());\n }\n \n void init(v8::Local<v8::Object> exports) {"
        },
        {
            "sha": "e5476c4ee1e3640863ea5b81e71b177502e50b4c",
            "filename": "test/addons/hello-world-function-export/binding.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fhello-world-function-export%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fhello-world-function-export%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fhello-world-function-export%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -3,7 +3,8 @@\n \n void Method(const v8::FunctionCallbackInfo<v8::Value>& args) {\n   v8::Isolate* isolate = args.GetIsolate();\n-  args.GetReturnValue().Set(v8::String::NewFromUtf8(isolate, \"world\"));\n+  args.GetReturnValue().Set(v8::String::NewFromUtf8(\n+        isolate, \"world\", v8::NewStringType::kNormal).ToLocalChecked());\n }\n \n void init(v8::Local<v8::Object> exports, v8::Local<v8::Object> module) {"
        },
        {
            "sha": "81bcbc29c786457b3305aedd6728f6778439628d",
            "filename": "test/addons/hello-world/binding.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fhello-world%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fhello-world%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fhello-world%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -3,7 +3,8 @@\n \n void Method(const v8::FunctionCallbackInfo<v8::Value>& args) {\n   v8::Isolate* isolate = args.GetIsolate();\n-  args.GetReturnValue().Set(v8::String::NewFromUtf8(isolate, \"world\"));\n+  args.GetReturnValue().Set(v8::String::NewFromUtf8(\n+        isolate, \"world\", v8::NewStringType::kNormal).ToLocalChecked());\n }\n \n // Not using the full NODE_MODULE_INIT() macro here because we want to test the"
        },
        {
            "sha": "02eecec099807a1add9d1fdc8dad4e0798abd7cf",
            "filename": "test/addons/load-long-path/binding.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fload-long-path%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fload-long-path%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fload-long-path%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -3,7 +3,8 @@\n \n void Method(const v8::FunctionCallbackInfo<v8::Value>& args) {\n   v8::Isolate* isolate = args.GetIsolate();\n-  args.GetReturnValue().Set(v8::String::NewFromUtf8(isolate, \"world\"));\n+  args.GetReturnValue().Set(v8::String::NewFromUtf8(\n+        isolate, \"world\", v8::NewStringType::kNormal).ToLocalChecked());\n }\n \n void init(v8::Local<v8::Object> exports) {"
        },
        {
            "sha": "c2777c831e484abf27c163af2cf0a24aa991760a",
            "filename": "test/addons/new-target/binding.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fnew-target%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fnew-target%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fnew-target%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -12,7 +12,8 @@ inline void NewClass(const v8::FunctionCallbackInfo<v8::Value>& args) {\n inline void Initialize(v8::Local<v8::Object> binding) {\n   auto isolate = binding->GetIsolate();\n   auto context = isolate->GetCurrentContext();\n-  binding->Set(v8::String::NewFromUtf8(isolate, \"Class\"),\n+  binding->Set(v8::String::NewFromUtf8(\n+        isolate, \"Class\", v8::NewStringType::kNormal).ToLocalChecked(),\n                v8::FunctionTemplate::New(isolate, NewClass)\n                    ->GetFunction(context)\n                    .ToLocalChecked());"
        },
        {
            "sha": "122d420bc14e0b4f0389ff6168c66506a1b4a96b",
            "filename": "test/addons/openssl-binding/binding.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fopenssl-binding%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fopenssl-binding%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fopenssl-binding%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -22,7 +22,8 @@ inline void Initialize(v8::Local<v8::Object> exports,\n                        v8::Local<v8::Value> module,\n                        v8::Local<v8::Context> context) {\n   auto isolate = context->GetIsolate();\n-  auto key = v8::String::NewFromUtf8(isolate, \"randomBytes\");\n+  auto key = v8::String::NewFromUtf8(\n+      isolate, \"randomBytes\", v8::NewStringType::kNormal).ToLocalChecked();\n   auto value = v8::FunctionTemplate::New(isolate, RandomBytes)\n                    ->GetFunction(context)\n                    .ToLocalChecked();"
        },
        {
            "sha": "02eecec099807a1add9d1fdc8dad4e0798abd7cf",
            "filename": "test/addons/symlinked-module/binding.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fsymlinked-module%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fsymlinked-module%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fsymlinked-module%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -3,7 +3,8 @@\n \n void Method(const v8::FunctionCallbackInfo<v8::Value>& args) {\n   v8::Isolate* isolate = args.GetIsolate();\n-  args.GetReturnValue().Set(v8::String::NewFromUtf8(isolate, \"world\"));\n+  args.GetReturnValue().Set(v8::String::NewFromUtf8(\n+        isolate, \"world\", v8::NewStringType::kNormal).ToLocalChecked());\n }\n \n void init(v8::Local<v8::Object> exports) {"
        },
        {
            "sha": "0b82de211a8430e35c41f541f235786830af2438",
            "filename": "test/addons/zlib-binding/binding.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fzlib-binding%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/d58a0c628591a318b4692355f4a08140e17d61df/test%2Faddons%2Fzlib-binding%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fzlib-binding%2Fbinding.cc?ref=d58a0c628591a318b4692355f4a08140e17d61df",
            "patch": "@@ -45,7 +45,8 @@ inline void Initialize(v8::Local<v8::Object> exports,\n                        v8::Local<v8::Value> module,\n                        v8::Local<v8::Context> context) {\n   auto isolate = context->GetIsolate();\n-  auto key = v8::String::NewFromUtf8(isolate, \"compressBytes\");\n+  auto key = v8::String::NewFromUtf8(\n+      isolate, \"compressBytes\", v8::NewStringType::kNormal).ToLocalChecked();\n   auto value = v8::FunctionTemplate::New(isolate, CompressBytes)\n                    ->GetFunction(context)\n                    .ToLocalChecked();"
        }
    ],
    "stats": {
        "total": 77,
        "additions": 56,
        "deletions": 21
    }
}