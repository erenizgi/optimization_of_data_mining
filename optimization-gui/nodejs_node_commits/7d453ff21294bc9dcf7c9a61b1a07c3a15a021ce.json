{
    "author": "Trott",
    "message": "test: replace internals with public API\n\nRemove instances where `--expose-internals` is used to gain access to\nbuffer.kStringMaxLength. The property is availalble without a flag. It\nis undocumented but the same as the documented\n`buffer.constants.MAX_STRING_LENGTH` so use that. (We even have a test\nthat confirms that they are the same value.)\n\nPR-URL: https://github.com/nodejs/node/pull/25309\nReviewed-By: Сковорода Никита Андреевич <chalkerx@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
    "files": [
        {
            "sha": "fcf5279dd3ceae816ea58f133055e7d7a2e32ed7",
            "filename": "test/addons/stringbytes-external-exceed-max/test-stringbytes-external-at-max.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-at-max.js",
            "raw_url": "https://github.com/nodejs/node/raw/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-at-max.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-at-max.js?ref=7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
            "patch": "@@ -1,8 +1,6 @@\n 'use strict';\n-// Flags: --expose-internals\n \n const common = require('../../common');\n-const { internalBinding } = require('internal/test/binding');\n const skipMessage = 'intensive toString tests due to memory confinements';\n if (!common.enoughTestMem)\n   common.skip(skipMessage);\n@@ -12,7 +10,7 @@ const assert = require('assert');\n \n // v8 fails silently if string length > v8::String::kMaxLength\n // v8::String::kMaxLength defined in v8.h\n-const kStringMaxLength = internalBinding('buffer').kStringMaxLength;\n+const kStringMaxLength = require('buffer').constants.MAX_STRING_LENGTH;\n \n let buf;\n try {"
        },
        {
            "sha": "5e3033db3ea193f0b08433ab30f0961f31661385",
            "filename": "test/addons/stringbytes-external-exceed-max/test-stringbytes-external-exceed-max-by-1-ascii.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-ascii.js",
            "raw_url": "https://github.com/nodejs/node/raw/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-ascii.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-ascii.js?ref=7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
            "patch": "@@ -1,8 +1,6 @@\n 'use strict';\n-// Flags: --expose-internals\n \n const common = require('../../common');\n-const { internalBinding } = require('internal/test/binding');\n const skipMessage = 'intensive toString tests due to memory confinements';\n if (!common.enoughTestMem)\n   common.skip(skipMessage);\n@@ -11,7 +9,7 @@ const binding = require(`./build/${common.buildType}/binding`);\n \n // v8 fails silently if string length > v8::String::kMaxLength\n // v8::String::kMaxLength defined in v8.h\n-const kStringMaxLength = internalBinding('buffer').kStringMaxLength;\n+const kStringMaxLength = require('buffer').constants.MAX_STRING_LENGTH;\n \n let buf;\n try {"
        },
        {
            "sha": "400477034d00108469912357118f77ad88e3c0d2",
            "filename": "test/addons/stringbytes-external-exceed-max/test-stringbytes-external-exceed-max-by-1-base64.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-base64.js",
            "raw_url": "https://github.com/nodejs/node/raw/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-base64.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-base64.js?ref=7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
            "patch": "@@ -1,8 +1,6 @@\n 'use strict';\n-// Flags: --expose-internals\n \n const common = require('../../common');\n-const { internalBinding } = require('internal/test/binding');\n const skipMessage = 'intensive toString tests due to memory confinements';\n if (!common.enoughTestMem)\n   common.skip(skipMessage);\n@@ -11,7 +9,7 @@ const binding = require(`./build/${common.buildType}/binding`);\n \n // v8 fails silently if string length > v8::String::kMaxLength\n // v8::String::kMaxLength defined in v8.h\n-const kStringMaxLength = internalBinding('buffer').kStringMaxLength;\n+const kStringMaxLength = require('buffer').constants.MAX_STRING_LENGTH;\n \n let buf;\n try {"
        },
        {
            "sha": "ef5d6a21ed0042b282e7df78fe14fadc80fae86c",
            "filename": "test/addons/stringbytes-external-exceed-max/test-stringbytes-external-exceed-max-by-1-binary.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-binary.js",
            "raw_url": "https://github.com/nodejs/node/raw/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-binary.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-binary.js?ref=7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
            "patch": "@@ -1,8 +1,7 @@\n-// Flags: --expose-gc --expose-internals\n+// Flags: --expose-gc\n 'use strict';\n \n const common = require('../../common');\n-const { internalBinding } = require('internal/test/binding');\n const skipMessage = 'intensive toString tests due to memory confinements';\n if (!common.enoughTestMem)\n   common.skip(skipMessage);\n@@ -12,7 +11,7 @@ const assert = require('assert');\n \n // v8 fails silently if string length > v8::String::kMaxLength\n // v8::String::kMaxLength defined in v8.h\n-const kStringMaxLength = internalBinding('buffer').kStringMaxLength;\n+const kStringMaxLength = require('buffer').constants.MAX_STRING_LENGTH;\n \n let buf;\n try {"
        },
        {
            "sha": "844c8bcb335a87948a1a9babe719e5dc31657024",
            "filename": "test/addons/stringbytes-external-exceed-max/test-stringbytes-external-exceed-max-by-1-hex.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-hex.js",
            "raw_url": "https://github.com/nodejs/node/raw/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-hex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-hex.js?ref=7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
            "patch": "@@ -1,8 +1,6 @@\n 'use strict';\n-// Flags: --expose-internals\n \n const common = require('../../common');\n-const { internalBinding } = require('internal/test/binding');\n const skipMessage = 'intensive toString tests due to memory confinements';\n if (!common.enoughTestMem)\n   common.skip(skipMessage);\n@@ -11,7 +9,7 @@ const binding = require(`./build/${common.buildType}/binding`);\n \n // v8 fails silently if string length > v8::String::kMaxLength\n // v8::String::kMaxLength defined in v8.h\n-const kStringMaxLength = internalBinding('buffer').kStringMaxLength;\n+const kStringMaxLength = require('buffer').constants.MAX_STRING_LENGTH;\n \n let buf;\n try {"
        },
        {
            "sha": "15ec78b6c9ab1c8a8fdcb250628eaee43c0938e8",
            "filename": "test/addons/stringbytes-external-exceed-max/test-stringbytes-external-exceed-max-by-1-utf8.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-utf8.js",
            "raw_url": "https://github.com/nodejs/node/raw/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-utf8.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-1-utf8.js?ref=7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
            "patch": "@@ -1,8 +1,6 @@\n 'use strict';\n-// Flags: --expose-internals\n \n const common = require('../../common');\n-const { internalBinding } = require('internal/test/binding');\n const skipMessage = 'intensive toString tests due to memory confinements';\n if (!common.enoughTestMem)\n   common.skip(skipMessage);\n@@ -12,7 +10,7 @@ const assert = require('assert');\n \n // v8 fails silently if string length > v8::String::kMaxLength\n // v8::String::kMaxLength defined in v8.h\n-const kStringMaxLength = internalBinding('buffer').kStringMaxLength;\n+const kStringMaxLength = require('buffer').constants.MAX_STRING_LENGTH;\n \n let buf;\n try {"
        },
        {
            "sha": "121ca2d62bae6b874ef231ebf2d30dca2f94b6e0",
            "filename": "test/addons/stringbytes-external-exceed-max/test-stringbytes-external-exceed-max-by-2.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-2.js",
            "raw_url": "https://github.com/nodejs/node/raw/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-2.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max-by-2.js?ref=7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
            "patch": "@@ -1,8 +1,6 @@\n 'use strict';\n-// Flags: --expose-internals\n \n const common = require('../../common');\n-const { internalBinding } = require('internal/test/binding');\n const skipMessage = 'intensive toString tests due to memory confinements';\n if (!common.enoughTestMem)\n   common.skip(skipMessage);\n@@ -12,7 +10,7 @@ const assert = require('assert');\n \n // v8 fails silently if string length > v8::String::kMaxLength\n // v8::String::kMaxLength defined in v8.h\n-const kStringMaxLength = internalBinding('buffer').kStringMaxLength;\n+const kStringMaxLength = require('buffer').constants.MAX_STRING_LENGTH;\n \n let buf;\n try {"
        },
        {
            "sha": "d65144e04d457c87bbac60a05a1c6827a857d153",
            "filename": "test/addons/stringbytes-external-exceed-max/test-stringbytes-external-exceed-max.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max.js",
            "raw_url": "https://github.com/nodejs/node/raw/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons%2Fstringbytes-external-exceed-max%2Ftest-stringbytes-external-exceed-max.js?ref=7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
            "patch": "@@ -1,8 +1,6 @@\n 'use strict';\n-// Flags: --expose-internals\n \n const common = require('../../common');\n-const { internalBinding } = require('internal/test/binding');\n const skipMessage = 'intensive toString tests due to memory confinements';\n if (!common.enoughTestMem)\n   common.skip(skipMessage);\n@@ -11,7 +9,7 @@ const binding = require(`./build/${common.buildType}/binding`);\n \n // v8 fails silently if string length > v8::String::kMaxLength\n // v8::String::kMaxLength defined in v8.h\n-const kStringMaxLength = internalBinding('buffer').kStringMaxLength;\n+const kStringMaxLength = require('buffer').constants.MAX_STRING_LENGTH;\n \n let buf;\n try {"
        },
        {
            "sha": "9a443fc71bb2c323de7b3abc5852b25a4ce8e470",
            "filename": "test/sequential/test-fs-readfile-tostring-fail.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Fsequential%2Ftest-fs-readfile-tostring-fail.js",
            "raw_url": "https://github.com/nodejs/node/raw/7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce/test%2Fsequential%2Ftest-fs-readfile-tostring-fail.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-fs-readfile-tostring-fail.js?ref=7d453ff21294bc9dcf7c9a61b1a07c3a15a021ce",
            "patch": "@@ -1,8 +1,6 @@\n 'use strict';\n-// Flags: --expose-internals\n \n const common = require('../common');\n-const { internalBinding } = require('internal/test/binding');\n \n if (!common.enoughTestMem)\n   common.skip('intensive toString tests due to memory confinements');\n@@ -11,7 +9,7 @@ const assert = require('assert');\n const fs = require('fs');\n const path = require('path');\n const cp = require('child_process');\n-const kStringMaxLength = internalBinding('buffer').kStringMaxLength;\n+const kStringMaxLength = require('buffer').constants.MAX_STRING_LENGTH;\n if (common.isAIX && (Number(cp.execSync('ulimit -f')) * 512) < kStringMaxLength)\n   common.skip('intensive toString tests due to file size confinements');\n "
        }
    ],
    "stats": {
        "total": 37,
        "additions": 10,
        "deletions": 27
    }
}