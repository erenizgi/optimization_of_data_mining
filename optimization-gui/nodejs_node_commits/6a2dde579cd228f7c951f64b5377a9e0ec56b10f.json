{
    "author": "addaleax",
    "message": "test,worker: add more tests for worker.ref()/.unref()\n\nPR-URL: https://github.com/nodejs/node/pull/26083\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "6a2dde579cd228f7c951f64b5377a9e0ec56b10f",
    "files": [
        {
            "sha": "0250c592ce91ae1876693613c38167eaae34203e",
            "filename": "test/parallel/test-worker-ref-onexit.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/6a2dde579cd228f7c951f64b5377a9e0ec56b10f/test%2Fparallel%2Ftest-worker-ref-onexit.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a2dde579cd228f7c951f64b5377a9e0ec56b10f/test%2Fparallel%2Ftest-worker-ref-onexit.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-ref-onexit.js?ref=6a2dde579cd228f7c951f64b5377a9e0ec56b10f",
            "patch": "@@ -0,0 +1,10 @@\n+'use strict';\n+const common = require('../common');\n+const { Worker } = require('worker_threads');\n+\n+// Check that worker.unref() makes the 'exit' event not be emitted, if it is\n+// the only thing we would otherwise be waiting for.\n+\n+const w = new Worker('', { eval: true });\n+w.unref();\n+w.on('exit', common.mustNotCall());"
        },
        {
            "sha": "645fc0fbad8e37a7fda22e8ea373e166021186a9",
            "filename": "test/parallel/test-worker-ref.js",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/6a2dde579cd228f7c951f64b5377a9e0ec56b10f/test%2Fparallel%2Ftest-worker-ref.js",
            "raw_url": "https://github.com/nodejs/node/raw/6a2dde579cd228f7c951f64b5377a9e0ec56b10f/test%2Fparallel%2Ftest-worker-ref.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-ref.js?ref=6a2dde579cd228f7c951f64b5377a9e0ec56b10f",
            "patch": "@@ -0,0 +1,29 @@\n+'use strict';\n+const common = require('../common');\n+const { Worker } = require('worker_threads');\n+\n+// Test that calling worker.unref() leads to 'beforeExit' being emitted, and\n+// that we can resurrect the worker using worker.ref() from there.\n+\n+const w = new Worker(`\n+const { parentPort } = require('worker_threads');\n+parentPort.once('message', (msg) => {\n+  parentPort.postMessage(msg);\n+});\n+`, { eval: true });\n+\n+process.once('beforeExit', common.mustCall(() => {\n+  console.log('beforeExit');\n+  w.ref();\n+  w.postMessage({ hello: 'world' });\n+}));\n+\n+w.once('message', common.mustCall((msg) => {\n+  console.log('message', msg);\n+}));\n+\n+w.on('exit', common.mustCall(() => {\n+  console.log('exit');\n+}));\n+\n+w.unref();"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 39,
        "deletions": 0
    }
}