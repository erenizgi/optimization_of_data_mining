{
    "author": "sam-github",
    "message": "test: check for tls renegotiation errors\n\nCheck that the return value and callback error for tls.renegotiate()\ndoes not indicate a failure. Also, remove unnecessary line wrapping and\nindentation.\n\nPR-URL: https://github.com/nodejs/node/pull/25437\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "641b0135cf77a366064757e17039c2524c5fb3f9",
    "files": [
        {
            "sha": "f43276460910f7f7c317be23889b9099494357e7",
            "filename": "test/parallel/test-tls-disable-renegotiation.js",
            "status": "modified",
            "additions": 22,
            "deletions": 24,
            "changes": 46,
            "blob_url": "https://github.com/nodejs/node/blob/641b0135cf77a366064757e17039c2524c5fb3f9/test%2Fparallel%2Ftest-tls-disable-renegotiation.js",
            "raw_url": "https://github.com/nodejs/node/raw/641b0135cf77a366064757e17039c2524c5fb3f9/test%2Fparallel%2Ftest-tls-disable-renegotiation.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-disable-renegotiation.js?ref=641b0135cf77a366064757e17039c2524c5fb3f9",
            "patch": "@@ -12,7 +12,7 @@ const tls = require('tls');\n \n const options = {\n   key: fixtures.readKey('agent1-key.pem'),\n-  cert: fixtures.readKey('agent1-cert.pem')\n+  cert: fixtures.readKey('agent1-cert.pem'),\n };\n \n const server = tls.Server(options, common.mustCall((socket) => {\n@@ -45,28 +45,26 @@ server.listen(0, common.mustCall(() => {\n     rejectUnauthorized: false,\n     port\n   };\n-  const client =\n-    tls.connect(options, common.mustCall(() => {\n-      client.write('');\n-      // Negotiation is still permitted for this first\n-      // attempt. This should succeed.\n-      client.renegotiate(\n-        { rejectUnauthorized: false },\n-        common.mustCall(() => {\n-          // Once renegotiation completes, we write some\n-          // data to the socket, which triggers the on\n-          // data event on the server. After that data\n-          // is received, disableRenegotiation is called.\n-          client.write('data', common.mustCall(() => {\n-            client.write('');\n-            // This second renegotiation attempt should fail\n-            // and the callback should never be invoked. The\n-            // server will simply drop the connection after\n-            // emitting the error.\n-            client.renegotiate(\n-              { rejectUnauthorized: false },\n-              common.mustNotCall());\n-          }));\n-        }));\n+  const client = tls.connect(options, common.mustCall(() => {\n+    client.write('');\n+    // Negotiation is still permitted for this first\n+    // attempt. This should succeed.\n+    let ok = client.renegotiate(options, common.mustCall((err) => {\n+      assert.ifError(err);\n+      // Once renegotiation completes, we write some\n+      // data to the socket, which triggers the on\n+      // data event on the server. After that data\n+      // is received, disableRenegotiation is called.\n+      client.write('data', common.mustCall(() => {\n+        client.write('');\n+        // This second renegotiation attempt should fail\n+        // and the callback should never be invoked. The\n+        // server will simply drop the connection after\n+        // emitting the error.\n+        ok = client.renegotiate(options, common.mustNotCall());\n+        assert.strictEqual(ok, true);\n+      }));\n     }));\n+    assert.strictEqual(ok, true);\n+  }));\n }));"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 22,
        "deletions": 24
    }
}