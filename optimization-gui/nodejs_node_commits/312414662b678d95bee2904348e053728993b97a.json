{
    "author": "targos",
    "message": "url: expose the WHATWG URL API globally\n\nInstall URL and URLSearchParams on the global object, like they can be\nfound in browser environments.\n\nPR-URL: https://github.com/nodejs/node/pull/18281\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Daijiro Wachi <daijiro.wachi@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Evan Lucas <evanlucas@me.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "312414662b678d95bee2904348e053728993b97a",
    "files": [
        {
            "sha": "d78caacd63a793708d17119b247f6939ee11af58",
            "filename": "doc/api/errors.md",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Ferrors.md",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Ferrors.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ferrors.md?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -1204,7 +1204,6 @@ A Node.js API function was called with an incompatible `this` value.\n Example:\n \n ```js\n-const { URLSearchParams } = require('url');\n const urlSearchParams = new URLSearchParams('foo=bar&baz=new');\n \n const buf = Buffer.alloc(1);"
        },
        {
            "sha": "e9b38735bef9900e69f8acb91661551cb57f1e27",
            "filename": "doc/api/esm.md",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fesm.md",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fesm.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fesm.md?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -143,7 +143,6 @@ rules with only JS file extension and Node builtin modules support could\n be written:\n \n ```js\n-import url from 'url';\n import path from 'path';\n import process from 'process';\n import Module from 'module';\n@@ -164,7 +163,7 @@ export function resolve(specifier, parentModuleURL/*, defaultResolve */) {\n     throw new Error(\n       `imports must begin with '/', './', or '../'; '${specifier}' does not`);\n   }\n-  const resolved = new url.URL(specifier, parentModuleURL);\n+  const resolved = new URL(specifier, parentModuleURL);\n   const ext = path.extname(resolved.pathname);\n   if (!JS_EXTENSIONS.has(ext)) {\n     throw new Error("
        },
        {
            "sha": "8e6ca9e7dd2beb2120e971838200fad02838b107",
            "filename": "doc/api/fs.md",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Ffs.md",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Ffs.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ffs.md?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -173,7 +173,6 @@ are supported.\n \n ```js\n const fs = require('fs');\n-const { URL } = require('url');\n const fileUrl = new URL('file:///tmp/hello');\n \n fs.readFileSync(fileUrl);"
        },
        {
            "sha": "9ed63764d3b44fca9cfa546cc27b753b8a709e14",
            "filename": "doc/api/globals.md",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fglobals.md",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fglobals.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fglobals.md?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -138,6 +138,24 @@ added: v0.0.1\n \n [`setTimeout`] is described in the [timers][] section.\n \n+## URL\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+<!-- type=global -->\n+\n+The WHATWG `URL` class. See the [`URL`][] section.\n+\n+## URLSearchParams\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+<!-- type=global -->\n+\n+The WHATWG `URLSearchParams` class. See the [`URLSearchParams`][] section.\n+\n [`__dirname`]: modules.html#modules_dirname\n [`__filename`]: modules.html#modules_filename\n [`clearImmediate`]: timers.html#timers_clearimmediate_immediate\n@@ -151,6 +169,8 @@ added: v0.0.1\n [`setImmediate`]: timers.html#timers_setimmediate_callback_args\n [`setInterval`]: timers.html#timers_setinterval_callback_delay_args\n [`setTimeout`]: timers.html#timers_settimeout_callback_delay_args\n+[`URL`]: url.html#url_class_url\n+[`URLSearchParams`]: url.html#url_class_urlsearchparams\n [buffer section]: buffer.html\n [built-in objects]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects\n [module system documentation]: modules.html"
        },
        {
            "sha": "46ea8511ffe6b8e642f790fe93ee423de4b7299c",
            "filename": "doc/api/http.md",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fhttp.md",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fhttp.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttp.md?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -1871,8 +1871,6 @@ There are a few special headers that should be noted.\n Example using a [`URL`][] as `options`:\n \n ```js\n-const { URL } = require('url');\n-\n const options = new URL('http://abc:xyz@example.com');\n \n const req = http.request(options, (res) => {"
        },
        {
            "sha": "ab4fb03cb5b34c5fdd6453c7e3275e4bbc2a4814",
            "filename": "doc/api/http2.md",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fhttp2.md",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fhttp2.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttp2.md?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -2186,7 +2186,6 @@ An HTTP/2 CONNECT proxy:\n const http2 = require('http2');\n const { NGHTTP2_REFUSED_STREAM } = http2.constants;\n const net = require('net');\n-const { URL } = require('url');\n \n const proxy = http2.createServer();\n proxy.on('stream', (stream, headers) => {"
        },
        {
            "sha": "1db1e8eb069553d20e13084da47864986d0431b4",
            "filename": "doc/api/https.md",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fhttps.md",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Fhttps.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttps.md?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -242,8 +242,6 @@ const req = https.request(options, (res) => {\n Example using a [`URL`][] as `options`:\n \n ```js\n-const { URL } = require('url');\n-\n const options = new URL('https://abc:xyz@example.com');\n \n const req = https.request(options, (res) => {"
        },
        {
            "sha": "3f75de06026306b39d752e47c180546fca930db7",
            "filename": "doc/api/url.md",
            "status": "modified",
            "additions": 12,
            "deletions": 36,
            "changes": 48,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Furl.md",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/doc%2Fapi%2Furl.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Furl.md?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -57,15 +57,10 @@ properties of a WHATWG `URL` object.\n Parsing the URL string using the WHATWG API:\n \n ```js\n-const { URL } = require('url');\n const myURL =\n   new URL('https://user:pass@sub.host.com:8080/p/a/t/h?query=string#hash');\n ```\n \n-*Note*: In Web Browsers, the WHATWG `URL` class is a global that is always\n-available. In Node.js, however, the `URL` class must be accessed via\n-`require('url').URL`.\n-\n Parsing the URL string using the Legacy API:\n \n ```js\n@@ -75,14 +70,19 @@ const myURL =\n ```\n \n ## The WHATWG URL API\n+\n+### Class: URL\n <!-- YAML\n added: v7.0.0\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/18281\n+    description: The class is now available on the global object.\n -->\n \n-### Class: URL\n-\n Browser-compatible `URL` class, implemented by following the WHATWG URL\n Standard. [Examples of parsed URLs][] may be found in the Standard itself.\n+The `URL` class is also available on the global object.\n \n *Note*: In accordance with browser conventions, all properties of `URL` objects\n are implemented as getters and setters on the class prototype, rather than as\n@@ -101,7 +101,6 @@ Creates a new `URL` object by parsing the `input` relative to the `base`. If\n `base` is passed as a string, it will be parsed equivalent to `new URL(base)`.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('/foo', 'https://example.org/');\n // https://example.org/foo\n ```\n@@ -111,7 +110,6 @@ that an effort will be made to coerce the given values into strings. For\n instance:\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL({ toString: () => 'https://example.org/' });\n // https://example.org/\n ```\n@@ -120,7 +118,6 @@ Unicode characters appearing within the hostname of `input` will be\n automatically converted to ASCII using the [Punycode][] algorithm.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://你好你好');\n // https://xn--6qqa088eba/\n ```\n@@ -135,7 +132,6 @@ with [ICU][] enabled. If not, the domain names are passed through unchanged.\n Gets and sets the fragment portion of the URL.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org/foo#bar');\n console.log(myURL.hash);\n // Prints #bar\n@@ -157,7 +153,6 @@ percent-encode may vary somewhat from what the [`url.parse()`][] and\n Gets and sets the host portion of the URL.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org:81/foo');\n console.log(myURL.host);\n // Prints example.org:81\n@@ -178,7 +173,6 @@ Gets and sets the hostname portion of the URL. The key difference between\n port.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org:81/foo');\n console.log(myURL.hostname);\n // Prints example.org\n@@ -197,7 +191,6 @@ Invalid hostname values assigned to the `hostname` property are ignored.\n Gets and sets the serialized URL.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org/foo');\n console.log(myURL.href);\n // Prints https://example.org/foo\n@@ -224,14 +217,12 @@ will be thrown.\n Gets the read-only serialization of the URL's origin.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org/foo/bar?baz');\n console.log(myURL.origin);\n // Prints https://example.org\n ```\n \n ```js\n-const { URL } = require('url');\n const idnURL = new URL('https://你好你好');\n console.log(idnURL.origin);\n // Prints https://xn--6qqa088eba\n@@ -247,7 +238,6 @@ console.log(idnURL.hostname);\n Gets and sets the password portion of the URL.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://abc:xyz@example.com');\n console.log(myURL.password);\n // Prints xyz\n@@ -269,7 +259,6 @@ percent-encode may vary somewhat from what the [`url.parse()`][] and\n Gets and sets the path portion of the URL.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org/abc/xyz?123');\n console.log(myURL.pathname);\n // Prints /abc/xyz\n@@ -291,7 +280,6 @@ to percent-encode may vary somewhat from what the [`url.parse()`][] and\n Gets and sets the port portion of the URL.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org:8888');\n console.log(myURL.port);\n // Prints 8888\n@@ -347,7 +335,6 @@ lies outside the range denoted above, it is ignored.\n Gets and sets the protocol portion of the URL.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org');\n console.log(myURL.protocol);\n // Prints https:\n@@ -366,7 +353,6 @@ Invalid URL protocol values assigned to the `protocol` property are ignored.\n Gets and sets the serialized query portion of the URL.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org/abc?123');\n console.log(myURL.search);\n // Prints ?123\n@@ -397,7 +383,6 @@ documentation for details.\n Gets and sets the username portion of the URL.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://abc:xyz@example.com');\n console.log(myURL.username);\n // Prints abc\n@@ -435,7 +420,6 @@ This method is automatically called when an `URL` object is serialized\n with [`JSON.stringify()`][].\n \n ```js\n-const { URL } = require('url');\n const myURLs = [\n   new URL('https://www.example.com'),\n   new URL('https://test.example.org')\n@@ -447,20 +431,23 @@ console.log(JSON.stringify(myURLs));\n ### Class: URLSearchParams\n <!-- YAML\n added: v7.5.0\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/18281\n+    description: The class is now available on the global object.\n -->\n \n The `URLSearchParams` API provides read and write access to the query of a\n `URL`. The `URLSearchParams` class can also be used standalone with one of the\n four following constructors.\n+The `URLSearchParams` class is also available on the global object.\n \n The WHATWG `URLSearchParams` interface and the [`querystring`][] module have\n similar purpose, but the purpose of the [`querystring`][] module is more\n general, as it allows the customization of delimiter characters (`&` and `=`).\n On the other hand, this API is designed purely for URL query strings.\n \n ```js\n-const { URL, URLSearchParams } = require('url');\n-\n const myURL = new URL('https://example.org/?abc=123');\n console.log(myURL.searchParams.get('abc'));\n // Prints 123\n@@ -505,7 +492,6 @@ Parse the `string` as a query string, and use it to instantiate a new\n `URLSearchParams` object. A leading `'?'`, if present, is ignored.\n \n ```js\n-const { URLSearchParams } = require('url');\n let params;\n \n params = new URLSearchParams('user=abc&query=xyz');\n@@ -534,7 +520,6 @@ values are not allowed. Arrays are stringified using [`array.toString()`][],\n which simply joins all array elements with commas.\n \n ```js\n-const { URLSearchParams } = require('url');\n const params = new URLSearchParams({\n   user: 'abc',\n   query: ['first', 'second']\n@@ -562,7 +547,6 @@ themselves be any iterable object.\n Duplicate keys are allowed.\n \n ```js\n-const { URLSearchParams } = require('url');\n let params;\n \n // Using an array\n@@ -631,7 +615,6 @@ Alias for [`urlSearchParams[@@iterator]()`][`urlSearchParams@@iterator()`].\n Iterates over each name-value pair in the query and invokes the given function.\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://example.org/?a=b&c=d');\n myURL.searchParams.forEach((value, name, searchParams) => {\n   console.log(name, value, myURL.searchParams === searchParams);\n@@ -672,7 +655,6 @@ Returns `true` if there is at least one name-value pair whose name is `name`.\n Returns an ES6 Iterator over the names of each name-value pair.\n \n ```js\n-const { URLSearchParams } = require('url');\n const params = new URLSearchParams('foo=bar&foo=baz');\n for (const name of params.keys()) {\n   console.log(name);\n@@ -693,8 +675,6 @@ set the first such pair's value to `value` and remove all others. If not,\n append the name-value pair to the query string.\n \n ```js\n-const { URLSearchParams } = require('url');\n-\n const params = new URLSearchParams();\n params.append('foo', 'bar');\n params.append('foo', 'baz');\n@@ -720,7 +700,6 @@ with the same name is preserved.\n This method can be used, in particular, to increase cache hits.\n \n ```js\n-const { URLSearchParams } = require('url');\n const params = new URLSearchParams('query[]=abc&type=search&query[]=123');\n params.sort();\n console.log(params.toString());\n@@ -751,7 +730,6 @@ is the `name`, the second item of the Array is the `value`.\n Alias for [`urlSearchParams.entries()`][].\n \n ```js\n-const { URLSearchParams } = require('url');\n const params = new URLSearchParams('foo=bar&xyz=baz');\n for (const [name, value] of params) {\n   console.log(name, value);\n@@ -835,7 +813,6 @@ of the output.\n For example:\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://a:b@你好你好?abc#foo');\n \n console.log(myURL.href);\n@@ -1135,7 +1112,6 @@ using the [Punycode][] algorithm. Note, however, that a hostname *may* contain\n *both* Punycode encoded and percent-encoded characters. For example:\n \n ```js\n-const { URL } = require('url');\n const myURL = new URL('https://%CF%80.com/foo');\n console.log(myURL.href);\n // Prints https://xn--1xa.com/foo"
        },
        {
            "sha": "e269d7dc153a4dd5ca7f69f91677a2a7bbbc130a",
            "filename": "lib/internal/bootstrap_node.js",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/lib%2Finternal%2Fbootstrap_node.js",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/lib%2Finternal%2Fbootstrap_node.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap_node.js?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -72,6 +72,7 @@\n     if (browserGlobals) {\n       setupGlobalTimeouts();\n       setupGlobalConsole();\n+      setupGlobalURL();\n     }\n \n     // Ensure setURLConstructor() is called before the native\n@@ -372,6 +373,24 @@\n     setupInspector(originalConsole, wrappedConsole, Module);\n   }\n \n+  function setupGlobalURL() {\n+    const { URL, URLSearchParams } = NativeModule.require('internal/url');\n+    Object.defineProperties(global, {\n+      URL: {\n+        value: URL,\n+        writable: true,\n+        configurable: true,\n+        enumerable: false\n+      },\n+      URLSearchParams: {\n+        value: URLSearchParams,\n+        writable: true,\n+        configurable: true,\n+        enumerable: false\n+      }\n+    });\n+  }\n+\n   function setupInspector(originalConsole, wrappedConsole, Module) {\n     if (!process.config.variables.v8_enable_inspector) {\n       return;"
        },
        {
            "sha": "b4e85a49ad63437f344c7360491e027964074e91",
            "filename": "test/parallel/test-whatwg-url-global.js",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/312414662b678d95bee2904348e053728993b97a/test%2Fparallel%2Ftest-whatwg-url-global.js",
            "raw_url": "https://github.com/nodejs/node/raw/312414662b678d95bee2904348e053728993b97a/test%2Fparallel%2Ftest-whatwg-url-global.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-url-global.js?ref=312414662b678d95bee2904348e053728993b97a",
            "patch": "@@ -0,0 +1,25 @@\n+'use strict';\n+\n+require('../common');\n+const assert = require('assert');\n+const { URL, URLSearchParams } = require('url');\n+\n+assert.deepStrictEqual(\n+  Object.getOwnPropertyDescriptor(global, 'URL'),\n+  {\n+    value: URL,\n+    writable: true,\n+    configurable: true,\n+    enumerable: false\n+  }\n+);\n+\n+assert.deepStrictEqual(\n+  Object.getOwnPropertyDescriptor(global, 'URLSearchParams'),\n+  {\n+    value: URLSearchParams,\n+    writable: true,\n+    configurable: true,\n+    enumerable: false\n+  }\n+);"
        }
    ],
    "stats": {
        "total": 122,
        "additions": 77,
        "deletions": 45
    }
}