{
    "author": "rvagg",
    "message": "tools: don't use GH API for commit message checks\n\nFixes: https://github.com/nodejs/node/issues/24567\n\nPR-URL: https://github.com/nodejs/node/pull/24574\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>",
    "sha": "76faccccbb51bb477a88ebfa3fa2a8254da37696",
    "files": [
        {
            "sha": "01afd9bab567c8bfcd82dbcd23ecdb3379a059e6",
            "filename": "tools/lint-pr-commit-message.sh",
            "status": "modified",
            "additions": 11,
            "deletions": 17,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/76faccccbb51bb477a88ebfa3fa2a8254da37696/tools%2Flint-pr-commit-message.sh",
            "raw_url": "https://github.com/nodejs/node/raw/76faccccbb51bb477a88ebfa3fa2a8254da37696/tools%2Flint-pr-commit-message.sh",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Flint-pr-commit-message.sh?ref=76faccccbb51bb477a88ebfa3fa2a8254da37696",
            "patch": "@@ -25,21 +25,15 @@ if [ -z \"${PR_ID}\" ]; then\n   echo \" e.g. $0 <PR_NUMBER>\"\n   exit 1\n fi\n-# Retrieve the first commit of the pull request via GitHub API\n-# TODO: If we teach core-validate-commit to ignore \"fixup!\" and \"squash!\"\n-#       commits and lint messages for all commits in the pull request\n-#       we could simplify the following to:\n-#         npx -q core-validate-commit --no-validate-metadata ${GH_API_URL}/repos/nodejs/node/pulls/${PR_ID}/commits\n-if PR_COMMITS=\"$( curl -s ${GH_API_URL}/repos/nodejs/node/pulls/${PR_ID}/commits )\"; then\n-  if FIRST_COMMIT=\"$( node -p 'JSON.parse(process.argv[1])[0].url' \"${PR_COMMITS}\" 2> /dev/null )\"; then\n-    echo \"Linting the first commit message for pull request ${PR_ID}\"\n-    echo \"according to the guidelines at https://goo.gl/p2fr5Q.\"\n-    # Print the commit message to make it more obvious what is being checked.\n-    echo \"Commit message for ${FIRST_COMMIT##*/} is:\"\n-    node -p 'JSON.parse(process.argv[1])[0].commit.message' \"${PR_COMMITS}\" 2> /dev/null\n-    npx -q core-validate-commit --no-validate-metadata \"${FIRST_COMMIT}\"\n-  else\n-    echo \"Unable to determine the first commit for pull request ${PR_ID}.\"\n-    exit 1\n-  fi\n+\n+PATCH=$( curl -sL https://github.com/nodejs/node/pull/${PR_ID}.patch | grep '^From ' )\n+if FIRST_COMMIT=\"$( echo \"$PATCH\" | awk '/^From [0-9a-f]{40} / { if (count++ == 0) print $2 }' )\"; then\n+  MESSAGE=$( git show --quiet --format='format:%B' $FIRST_COMMIT )\n+  echo \"\n+*** Linting the first commit message for pull request ${PR_ID}\n+*** according to the guidelines at https://goo.gl/p2fr5Q.\n+*** Commit message for $(echo $FIRST_COMMIT | cut -c 1-10) is:\n+${MESSAGE}\n+\"\n+  npx -q core-validate-commit --no-validate-metadata \"${FIRST_COMMIT}\"\n fi"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 11,
        "deletions": 17
    }
}