{
    "author": "cjihrig",
    "message": "Revert \"repl: add friendly tips about how to exit repl\"\n\nThis reverts commit 9aa4ec43fce7fd9166459c98f347760cf450a350.\n\nThis commit in question introduced a regression in repl.eval(),\nas the context argument is no longer passed to runInContext().\n\nPR-URL: https://github.com/nodejs/node/pull/20972\nFixes: https://github.com/nodejs/node/issues/20965\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: John-David Dalton <john.david.dalton@gmail.com>",
    "sha": "4dbfb096f04c49aaa8349626296193ecff6bf2f6",
    "files": [
        {
            "sha": "6b5f4803870c4aedfa6663f7b4bbf147dc0eb15f",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 4,
            "deletions": 14,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/4dbfb096f04c49aaa8349626296193ecff6bf2f6/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/4dbfb096f04c49aaa8349626296193ecff6bf2f6/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=4dbfb096f04c49aaa8349626296193ecff6bf2f6",
            "patch": "@@ -215,15 +215,9 @@ function REPLServer(prompt,\n \n   function defaultEval(code, context, file, cb) {\n     var err, result, script, wrappedErr;\n-    var isExitCommand = false;\n     var wrappedCmd = false;\n     var awaitPromise = false;\n     var input = code;\n-    var trimmedCommand = code.trim();\n-\n-    if (trimmedCommand === 'exit' || trimmedCommand === 'quit') {\n-      isExitCommand = true;\n-    }\n \n     if (/^\\s*\\{/.test(code) && /\\}\\s*$/.test(code)) {\n       // It's confusing for `{ a : 1 }` to be interpreted as a block\n@@ -319,16 +313,10 @@ function REPLServer(prompt,\n             breakOnSigint: self.breakEvalOnSigint\n           };\n \n-          const localContext = self.useGlobal ? global : self.context;\n-          if (isExitCommand && !localContext.hasOwnProperty(trimmedCommand)) {\n-            self.outputStream.write('(To exit, press ^D or type .exit)\\n');\n-            return self.displayPrompt();\n-          }\n-\n           if (self.useGlobal) {\n             result = script.runInThisContext(scriptOptions);\n           } else {\n-            result = script.runInContext(localContext, scriptOptions);\n+            result = script.runInContext(context, scriptOptions);\n           }\n         } finally {\n           if (self.breakEvalOnSigint) {\n@@ -344,10 +332,12 @@ function REPLServer(prompt,\n         }\n       } catch (e) {\n         err = e;\n+\n         if (err && err.code === 'ERR_SCRIPT_EXECUTION_INTERRUPTED') {\n-        // The stack trace for this case is not very useful anyway.\n+          // The stack trace for this case is not very useful anyway.\n           Object.defineProperty(err, 'stack', { value: '' });\n         }\n+\n         if (process.domain) {\n           debug('not recoverable, send to domain');\n           process.domain.emit('error', err);"
        },
        {
            "sha": "5459371f00c24d4949765014cca189ec481690d7",
            "filename": "test/parallel/test-repl.js",
            "status": "modified",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/4dbfb096f04c49aaa8349626296193ecff6bf2f6/test%2Fparallel%2Ftest-repl.js",
            "raw_url": "https://github.com/nodejs/node/raw/4dbfb096f04c49aaa8349626296193ecff6bf2f6/test%2Fparallel%2Ftest-repl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl.js?ref=4dbfb096f04c49aaa8349626296193ecff6bf2f6",
            "patch": "@@ -130,29 +130,6 @@ const strictModeTests = [\n   }\n ];\n \n-const friendlyExitTests = [\n-  {\n-    send: 'exit',\n-    expect: '(To exit, press ^D or type .exit)'\n-  },\n-  {\n-    send: 'quit',\n-    expect: '(To exit, press ^D or type .exit)'\n-  },\n-  {\n-    send: 'quit = 1',\n-    expect: '1'\n-  },\n-  {\n-    send: 'quit',\n-    expect: '1'\n-  },\n-  {\n-    send: 'exit',\n-    expect: '(To exit, press ^D or type .exit)'\n-  },\n-];\n-\n const errorTests = [\n   // Uncaught error throws and prints out\n   {\n@@ -763,7 +740,6 @@ const tcpTests = [\n     const [ socket, replServer ] = await startUnixRepl();\n \n     await runReplTests(socket, prompt_unix, unixTests);\n-    await runReplTests(socket, prompt_unix, friendlyExitTests);\n     await runReplTests(socket, prompt_unix, errorTests);\n     replServer.replMode = repl.REPL_MODE_STRICT;\n     await runReplTests(socket, prompt_unix, strictModeTests);"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 4,
        "deletions": 38
    }
}