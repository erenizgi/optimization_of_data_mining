{
    "author": "yhwang",
    "message": "test: check symbols in shared lib\n\nWhen building the node with `--shared` option, we need\nto verify the symbols in shared lib instead of executable.\n\nRefs: https://github.com/nodejs/node/issues/18535\n\nSigned-off-by: Yihong Wang <yh.wang@ibm.com>\nPR-URL: https://github.com/nodejs/node/pull/18806\nRefs: https://github.com/nodejs/node/issues/18535\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Gibson Fahnestock <gibfahn@gmail.com>\nReviewed-By: Yuta Hiroto <hello@about-hiroppy.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "ab7c627e5327d621a734a32680cbfc99453f8b20",
    "files": [
        {
            "sha": "963c6ee1391d8eff0cf8271bfd1dc5455ca4f49a",
            "filename": "test/common/shared-lib-util.js",
            "status": "modified",
            "additions": 15,
            "deletions": 1,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/ab7c627e5327d621a734a32680cbfc99453f8b20/test%2Fcommon%2Fshared-lib-util.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab7c627e5327d621a734a32680cbfc99453f8b20/test%2Fcommon%2Fshared-lib-util.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Fshared-lib-util.js?ref=ab7c627e5327d621a734a32680cbfc99453f8b20",
            "patch": "@@ -1,5 +1,5 @@\n-/* eslint-disable node-core/required-modules */\n 'use strict';\n+const common = require('../common');\n const path = require('path');\n \n // If node executable is linked to shared lib, need to take care about the\n@@ -27,3 +27,17 @@ exports.addLibraryPath = function(env) {\n     (env.PATH ? env.PATH + path.delimiter : '') +\n     path.dirname(process.execPath);\n };\n+\n+// Get the full path of shared lib\n+exports.getSharedLibPath = function() {\n+  if (common.isWindows) {\n+    return path.join(path.dirname(process.execPath), 'node.dll');\n+  } else if (common.isOSX) {\n+    return path.join(path.dirname(process.execPath),\n+                     `libnode.${process.config.variables.shlib_suffix}`);\n+  } else {\n+    return path.join(path.dirname(process.execPath),\n+                     'lib.target',\n+                     `libnode.${process.config.variables.shlib_suffix}`);\n+  }\n+};"
        },
        {
            "sha": "0438f7fccb71c10ddd12ace40e2d47887670827e",
            "filename": "test/parallel/test-postmortem-metadata.js",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/ab7c627e5327d621a734a32680cbfc99453f8b20/test%2Fparallel%2Ftest-postmortem-metadata.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab7c627e5327d621a734a32680cbfc99453f8b20/test%2Fparallel%2Ftest-postmortem-metadata.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-postmortem-metadata.js?ref=ab7c627e5327d621a734a32680cbfc99453f8b20",
            "patch": "@@ -7,7 +7,13 @@\n const common = require('../common');\n const assert = require('assert');\n const { spawnSync } = require('child_process');\n-const args = [process.execPath];\n+const { getSharedLibPath } = require('../common/shared-lib-util.js');\n+\n+// For shared lib case, check shared lib instead\n+const args = [\n+  process.config.variables.node_shared ?\n+    getSharedLibPath() : process.execPath\n+];\n \n if (common.isAIX)\n   args.unshift('-Xany', '-B');"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 22,
        "deletions": 2
    }
}