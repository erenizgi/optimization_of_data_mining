{
    "author": "qubyte",
    "message": "http: makes response.writeHead return the response\n\nFixes: https://github.com/nodejs/node/issues/25935\n\nPR-URL: https://github.com/nodejs/node/pull/25974\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "f93df511558609fad38fe0ae34635c7c914ad2f8",
    "files": [
        {
            "sha": "87de5a9bba4ad786d8a02d764cc87c37b218bc00",
            "filename": "doc/api/http.md",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/f93df511558609fad38fe0ae34635c7c914ad2f8/doc%2Fapi%2Fhttp.md",
            "raw_url": "https://github.com/nodejs/node/raw/f93df511558609fad38fe0ae34635c7c914ad2f8/doc%2Fapi%2Fhttp.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttp.md?ref=f93df511558609fad38fe0ae34635c7c914ad2f8",
            "patch": "@@ -1450,6 +1450,10 @@ the request body should be sent. See the [`'checkContinue'`][] event on\n <!-- YAML\n added: v0.1.30\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/25974\n+    description: Return `this` from `writeHead()` to allow chaining with\n+                 `end()`.\n   - version: v5.11.0, v4.4.5\n     pr-url: https://github.com/nodejs/node/pull/6291\n     description: A `RangeError` is thrown if `statusCode` is not a number in\n@@ -1459,17 +1463,23 @@ changes:\n * `statusCode` {number}\n * `statusMessage` {string}\n * `headers` {Object}\n+* Returns: {http.ServerResponse}\n \n Sends a response header to the request. The status code is a 3-digit HTTP\n status code, like `404`. The last argument, `headers`, are the response headers.\n Optionally one can give a human-readable `statusMessage` as the second\n argument.\n \n+Returns a reference to the `ServerResponse`, so that calls can be chained.\n+\n ```js\n const body = 'hello world';\n-response.writeHead(200, {\n-  'Content-Length': Buffer.byteLength(body),\n-  'Content-Type': 'text/plain' });\n+response\n+  .writeHead(200, {\n+    'Content-Length': Buffer.byteLength(body),\n+    'Content-Type': 'text/plain'\n+  })\n+  .end(body);\n ```\n \n This method must only be called once on a message and it must"
        },
        {
            "sha": "a899f651be302a08df81fa4445a4eb24ae1216db",
            "filename": "lib/_http_server.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f93df511558609fad38fe0ae34635c7c914ad2f8/lib%2F_http_server.js",
            "raw_url": "https://github.com/nodejs/node/raw/f93df511558609fad38fe0ae34635c7c914ad2f8/lib%2F_http_server.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_server.js?ref=f93df511558609fad38fe0ae34635c7c914ad2f8",
            "patch": "@@ -270,6 +270,8 @@ function writeHead(statusCode, reason, obj) {\n   }\n \n   this._storeHeader(statusLine, headers);\n+\n+  return this;\n }\n \n // Docs-only deprecated: DEP0063"
        },
        {
            "sha": "a62c2eca03585cd095d58716cd7e42b749ef5ed7",
            "filename": "test/parallel/test-http-response-writehead-returns-this.js",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/f93df511558609fad38fe0ae34635c7c914ad2f8/test%2Fparallel%2Ftest-http-response-writehead-returns-this.js",
            "raw_url": "https://github.com/nodejs/node/raw/f93df511558609fad38fe0ae34635c7c914ad2f8/test%2Fparallel%2Ftest-http-response-writehead-returns-this.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-response-writehead-returns-this.js?ref=f93df511558609fad38fe0ae34635c7c914ad2f8",
            "patch": "@@ -0,0 +1,22 @@\n+'use strict';\n+require('../common');\n+const http = require('http');\n+const assert = require('assert');\n+\n+const server = http.createServer((req, res) => {\n+  res.writeHead(200, { 'a-header': 'a-header-value' }).end('abc');\n+});\n+\n+server.listen(0, () => {\n+  http.get({ port: server.address().port }, (res) => {\n+    assert.strictEqual(res.headers['a-header'], 'a-header-value');\n+\n+    const chunks = [];\n+\n+    res.on('data', (chunk) => chunks.push(chunk));\n+    res.on('end', () => {\n+      assert.strictEqual(Buffer.concat(chunks).toString(), 'abc');\n+      server.close();\n+    });\n+  });\n+});"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 37,
        "deletions": 3
    }
}