{
    "author": "addaleax",
    "message": "src,lib: prefer internal/options over process._foo\n\nThis addresses a couple `TODO` comments and allows us\nto remove a number of underscored properties from `process`\n(in a semver-major follow-up).\n\nPR-URL: https://github.com/nodejs/node/pull/25063\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "8b5720833f1a48bcfe9072305682bea76f833ab4",
    "files": [
        {
            "sha": "c51961e9ce98dcaf49d9bcf334b42a513df0ed37",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 10,
            "deletions": 15,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/8b5720833f1a48bcfe9072305682bea76f833ab4/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b5720833f1a48bcfe9072305682bea76f833ab4/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=8b5720833f1a48bcfe9072305682bea76f833ab4",
            "patch": "@@ -29,6 +29,7 @@ const {\n const { internalBinding, NativeModule } = loaderExports;\n \n const exceptionHandlerState = { captureFn: null };\n+let getOptionValue;\n \n function startup() {\n   setupTraceCategoryState();\n@@ -117,7 +118,7 @@ function startup() {\n     NativeModule.require('internal/inspector_async_hook').setup();\n   }\n \n-  const { getOptionValue } = NativeModule.require('internal/options');\n+  getOptionValue = NativeModule.require('internal/options').getOptionValue;\n \n   if (getOptionValue('--help')) {\n     NativeModule.require('internal/print_help').print(process.stdout);\n@@ -253,8 +254,7 @@ function startExecution() {\n   }\n \n   // `node --prof-process`\n-  // TODO(joyeecheung): use internal/options instead of process.profProcess\n-  if (process.profProcess) {\n+  if (getOptionValue('--prof-process')) {\n     NativeModule.require('internal/v8_prof_processor');\n     return;\n   }\n@@ -276,13 +276,12 @@ function prepareUserCodeExecution() {\n   }\n \n   // For user code, we preload modules if `-r` is passed\n-  // TODO(joyeecheung): use internal/options instead of\n-  // process._preload_modules\n-  if (process._preload_modules) {\n+  const preloadModules = getOptionValue('--require');\n+  if (preloadModules) {\n     const {\n       _preloadModules\n     } = NativeModule.require('internal/modules/cjs/loader');\n-    _preloadModules(process._preload_modules);\n+    _preloadModules(preloadModules);\n   }\n }\n \n@@ -291,14 +290,12 @@ function executeUserCode() {\n   // `--interactive`.\n   // Note that the name `forceRepl` is merely an alias of `interactive`\n   // in code.\n-  // TODO(joyeecheung): use internal/options instead of\n-  // process._eval/process._forceRepl\n-  if (process._eval != null && !process._forceRepl) {\n+  if (getOptionValue('[has_eval_string]') && !getOptionValue('--interactive')) {\n     const {\n       addBuiltinLibsToObject\n     } = NativeModule.require('internal/modules/cjs/helpers');\n     addBuiltinLibsToObject(global);\n-    evalScript('[eval]', wrapForBreakOnFirstLine(process._eval));\n+    evalScript('[eval]', wrapForBreakOnFirstLine(getOptionValue('--eval')));\n     return;\n   }\n \n@@ -312,9 +309,7 @@ function executeUserCode() {\n \n     // If user passed `-c` or `--check` arguments to Node, check its syntax\n     // instead of actually running the file.\n-    // TODO(joyeecheung): use internal/options instead of\n-    // process._syntax_check_only\n-    if (process._syntax_check_only != null) {\n+    if (getOptionValue('--check')) {\n       const fs = NativeModule.require('fs');\n       // Read the source.\n       const filename = CJSModule._resolveFilename(process.argv[1]);\n@@ -661,7 +656,7 @@ function evalScript(name, body) {\n                   `${JSON.stringify(body)}, { filename: ` +\n                   `${JSON.stringify(name)}, displayErrors: true });\\n`;\n   const result = module._compile(script, `${name}-wrapper`);\n-  if (process._print_eval) console.log(result);\n+  if (getOptionValue('--print')) console.log(result);\n   // Handle any nextTicks added in the first tick of the program.\n   process._tickCallback();\n }"
        },
        {
            "sha": "077d9c49966d611830e05143de46b78379c445f9",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/8b5720833f1a48bcfe9072305682bea76f833ab4/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/8b5720833f1a48bcfe9072305682bea76f833ab4/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=8b5720833f1a48bcfe9072305682bea76f833ab4",
            "patch": "@@ -974,6 +974,7 @@ void SetupProcessObject(Environment* env,\n                              GetParentProcessId).FromJust());\n \n   // -e, --eval\n+  // TODO(addaleax): Remove this.\n   if (env->options()->has_eval_string) {\n     READONLY_PROPERTY(process,\n                       \"_eval\",\n@@ -984,23 +985,27 @@ void SetupProcessObject(Environment* env,\n   }\n \n   // -p, --print\n+  // TODO(addaleax): Remove this.\n   if (env->options()->print_eval) {\n     READONLY_PROPERTY(process, \"_print_eval\", True(env->isolate()));\n   }\n \n   // -c, --check\n+  // TODO(addaleax): Remove this.\n   if (env->options()->syntax_check_only) {\n     READONLY_PROPERTY(process, \"_syntax_check_only\", True(env->isolate()));\n   }\n \n   // -i, --interactive\n+  // TODO(addaleax): Remove this.\n   if (env->options()->force_repl) {\n     READONLY_PROPERTY(process, \"_forceRepl\", True(env->isolate()));\n   }\n \n   // -r, --require\n-  std::vector<std::string> preload_modules =\n-      std::move(env->options()->preload_modules);\n+  // TODO(addaleax): Remove this.\n+  const std::vector<std::string>& preload_modules =\n+      env->options()->preload_modules;\n   if (!preload_modules.empty()) {\n     Local<Array> array = Array::New(env->isolate());\n     for (unsigned int i = 0; i < preload_modules.size(); ++i) {\n@@ -1013,8 +1018,6 @@ void SetupProcessObject(Environment* env,\n     READONLY_PROPERTY(process,\n                       \"_preload_modules\",\n                       array);\n-\n-    preload_modules.clear();\n   }\n \n   // --no-deprecation\n@@ -1043,6 +1046,7 @@ void SetupProcessObject(Environment* env,\n #endif  // NODE_NO_BROWSER_GLOBALS\n \n   // --prof-process\n+  // TODO(addaleax): Remove this.\n   if (env->options()->prof_process) {\n     READONLY_PROPERTY(process, \"profProcess\", True(env->isolate()));\n   }"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 18,
        "deletions": 19
    }
}