{
    "author": "addaleax",
    "message": "crypto: add better scrypt option aliases\n\nMake parameter names available in a human-readable way, for\nmore accessible/self-documenting usage of the `scrypt` functions.\n\nThis implements a review comment from the original PR that has\nnot been addressed.\n\nRefs: https://github.com/nodejs/node/pull/20816#discussion_r189220776\n\nPR-URL: https://github.com/nodejs/node/pull/21525\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>",
    "sha": "e9b22e9569008de8485ece22bcbb2ce8b143d4b2",
    "files": [
        {
            "sha": "0e038d93e3691a2af6ddd536a177e0e2040d6e02",
            "filename": "doc/api/crypto.md",
            "status": "modified",
            "additions": 22,
            "deletions": 6,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/e9b22e9569008de8485ece22bcbb2ce8b143d4b2/doc%2Fapi%2Fcrypto.md",
            "raw_url": "https://github.com/nodejs/node/raw/e9b22e9569008de8485ece22bcbb2ce8b143d4b2/doc%2Fapi%2Fcrypto.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fcrypto.md?ref=e9b22e9569008de8485ece22bcbb2ce8b143d4b2",
            "patch": "@@ -2137,15 +2137,23 @@ request.\n ### crypto.scrypt(password, salt, keylen[, options], callback)\n <!-- YAML\n added: v10.5.0\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/XXX\n+    description: The `cost`, `blockSize` and `parallelization` option names\n+                 have been added.\n -->\n * `password` {string|Buffer|TypedArray|DataView}\n * `salt` {string|Buffer|TypedArray|DataView}\n * `keylen` {number}\n * `options` {Object}\n-  - `N` {number} CPU/memory cost parameter. Must be a power of two greater\n+  - `cost` {number} CPU/memory cost parameter. Must be a power of two greater\n     than one. **Default:** `16384`.\n-  - `r` {number} Block size parameter. **Default:** `8`.\n-  - `p` {number} Parallelization parameter. **Default:** `1`.\n+  - `blockSize` {number} Block size parameter. **Default:** `8`.\n+  - `parallelization` {number} Parallelization parameter. **Default:** `1`.\n+  - `N` {number} Alias for `cost`. Only one of both may be specified.\n+  - `r` {number} Alias for `blockSize`. Only one of both may be specified.\n+  - `p` {number} Alias for `parallelization`. Only one of both may be specified.\n   - `maxmem` {number} Memory upper bound. It is an error when (approximately)\n     `128 * N * r > maxmem`. **Default:** `32 * 1024 * 1024`.\n * `callback` {Function}\n@@ -2183,15 +2191,23 @@ crypto.scrypt('secret', 'salt', 64, { N: 1024 }, (err, derivedKey) => {\n ### crypto.scryptSync(password, salt, keylen[, options])\n <!-- YAML\n added: v10.5.0\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/XXX\n+    description: The `cost`, `blockSize` and `parallelization` option names\n+                 have been added.\n -->\n * `password` {string|Buffer|TypedArray|DataView}\n * `salt` {string|Buffer|TypedArray|DataView}\n * `keylen` {number}\n * `options` {Object}\n-  - `N` {number} CPU/memory cost parameter. Must be a power of two greater\n+  - `cost` {number} CPU/memory cost parameter. Must be a power of two greater\n     than one. **Default:** `16384`.\n-  - `r` {number} Block size parameter. **Default:** `8`.\n-  - `p` {number} Parallelization parameter. **Default:** `1`.\n+  - `blockSize` {number} Block size parameter. **Default:** `8`.\n+  - `parallelization` {number} Parallelization parameter. **Default:** `1`.\n+  - `N` {number} Alias for `cost`. Only one of both may be specified.\n+  - `r` {number} Alias for `blockSize`. Only one of both may be specified.\n+  - `p` {number} Alias for `parallelization`. Only one of both may be specified.\n   - `maxmem` {number} Memory upper bound. It is an error when (approximately)\n     `128 * N * r > maxmem`. **Default:** `32 * 1024 * 1024`.\n * Returns: {Buffer}"
        },
        {
            "sha": "edfe522be47a7488e01ff16989053bc2a7f039d5",
            "filename": "lib/internal/crypto/scrypt.js",
            "status": "modified",
            "additions": 17,
            "deletions": 4,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/e9b22e9569008de8485ece22bcbb2ce8b143d4b2/lib%2Finternal%2Fcrypto%2Fscrypt.js",
            "raw_url": "https://github.com/nodejs/node/raw/e9b22e9569008de8485ece22bcbb2ce8b143d4b2/lib%2Finternal%2Fcrypto%2Fscrypt.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fscrypt.js?ref=e9b22e9569008de8485ece22bcbb2ce8b143d4b2",
            "patch": "@@ -80,13 +80,26 @@ function check(password, salt, keylen, options, callback) {\n \n   let { N, r, p, maxmem } = defaults;\n   if (options && options !== defaults) {\n-    if (options.hasOwnProperty('N'))\n+    let has_N, has_r, has_p;\n+    if (has_N = (options.N !== undefined))\n       N = validateInt32(options.N, 'N', 0, INT_MAX);\n-    if (options.hasOwnProperty('r'))\n+    if (options.cost !== undefined) {\n+      if (has_N) throw new ERR_CRYPTO_SCRYPT_INVALID_PARAMETER();\n+      N = validateInt32(options.cost, 'cost', 0, INT_MAX);\n+    }\n+    if (has_r = (options.r !== undefined))\n       r = validateInt32(options.r, 'r', 0, INT_MAX);\n-    if (options.hasOwnProperty('p'))\n+    if (options.blockSize !== undefined) {\n+      if (has_r) throw new ERR_CRYPTO_SCRYPT_INVALID_PARAMETER();\n+      r = validateInt32(options.blockSize, 'blockSize', 0, INT_MAX);\n+    }\n+    if (has_p = (options.p !== undefined))\n       p = validateInt32(options.p, 'p', 0, INT_MAX);\n-    if (options.hasOwnProperty('maxmem'))\n+    if (options.parallelization !== undefined) {\n+      if (has_p) throw new ERR_CRYPTO_SCRYPT_INVALID_PARAMETER();\n+      p = validateInt32(options.parallelization, 'parallelization', 0, INT_MAX);\n+    }\n+    if (options.maxmem !== undefined)\n       maxmem = validateInt32(options.maxmem, 'maxmem', 0, INT_MAX);\n     if (N === 0) N = defaults.N;\n     if (r === 0) r = defaults.r;"
        },
        {
            "sha": "a99bff9255f97a4ff20992070c545a77e437b601",
            "filename": "test/parallel/test-crypto-scrypt.js",
            "status": "modified",
            "additions": 40,
            "deletions": 4,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/e9b22e9569008de8485ece22bcbb2ce8b143d4b2/test%2Fparallel%2Ftest-crypto-scrypt.js",
            "raw_url": "https://github.com/nodejs/node/raw/e9b22e9569008de8485ece22bcbb2ce8b143d4b2/test%2Fparallel%2Ftest-crypto-scrypt.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-scrypt.js?ref=e9b22e9569008de8485ece22bcbb2ce8b143d4b2",
            "patch": "@@ -56,14 +56,50 @@ const good = [\n         '7023bdcb3afd7348461c06cd81fd38ebfda8fbba904f8e3ea9b543f6545da1f2' +\n         'd5432955613f0fcf62d49705242a9af9e61e85dc0d651e40dfcf017b45575887',\n   },\n+  {\n+    pass: '',\n+    salt: '',\n+    keylen: 64,\n+    cost: 16,\n+    parallelization: 1,\n+    blockSize: 1,\n+    expected:\n+        '77d6576238657b203b19ca42c18a0497f16b4844e3074ae8dfdffa3fede21442' +\n+        'fcd0069ded0948f8326a753a0fc81f17e8d3e0fb2e0d3628cf35e20c38d18906',\n+  },\n+  {\n+    pass: 'password',\n+    salt: 'NaCl',\n+    keylen: 64,\n+    cost: 1024,\n+    parallelization: 16,\n+    blockSize: 8,\n+    expected:\n+        'fdbabe1c9d3472007856e7190d01e9fe7c6ad7cbc8237830e77376634b373162' +\n+        '2eaf30d92e22a3886ff109279d9830dac727afb94a83ee6d8360cbdfa2cc0640',\n+  },\n+  {\n+    pass: 'pleaseletmein',\n+    salt: 'SodiumChloride',\n+    keylen: 64,\n+    cost: 16384,\n+    parallelization: 1,\n+    blockSize: 8,\n+    expected:\n+        '7023bdcb3afd7348461c06cd81fd38ebfda8fbba904f8e3ea9b543f6545da1f2' +\n+        'd5432955613f0fcf62d49705242a9af9e61e85dc0d651e40dfcf017b45575887',\n+  },\n ];\n \n // Test vectors that should fail.\n const bad = [\n-  { N: 1, p: 1, r: 1 },        // N < 2\n-  { N: 3, p: 1, r: 1 },        // Not power of 2.\n-  { N: 2 ** 16, p: 1, r: 1 },  // N >= 2**(r*16)\n-  { N: 2, p: 2 ** 30, r: 1 },  // p > (2**30-1)/r\n+  { N: 1, p: 1, r: 1 },         // N < 2\n+  { N: 3, p: 1, r: 1 },         // Not power of 2.\n+  { N: 2 ** 16, p: 1, r: 1 },   // N >= 2**(r*16)\n+  { N: 2, p: 2 ** 30, r: 1 },   // p > (2**30-1)/r\n+  { N: 1, cost: 1 },            // both N and cost\n+  { p: 1, parallelization: 1 }, // both p and parallelization\n+  { r: 1, blockSize: 1 }        // both r and blocksize\n ];\n \n // Test vectors where 128*N*r exceeds maxmem."
        }
    ],
    "stats": {
        "total": 93,
        "additions": 79,
        "deletions": 14
    }
}