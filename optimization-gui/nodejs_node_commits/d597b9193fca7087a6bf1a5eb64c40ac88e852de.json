{
    "author": "sam-github",
    "message": "test: use mustCall(), not global state checks\n\nInstead of pushing state into global arrays and checking the results\nbefore exit, use common.mustCall() and make the checks immediately.\n\nPR-URL: https://github.com/nodejs/node/pull/25508\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "d597b9193fca7087a6bf1a5eb64c40ac88e852de",
    "files": [
        {
            "sha": "686f6444ef9d2f67a3976092cf7e1fa20d2a6a74",
            "filename": "test/parallel/test-tls-socket-constructor-alpn-options-parsing.js",
            "status": "modified",
            "additions": 4,
            "deletions": 13,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/d597b9193fca7087a6bf1a5eb64c40ac88e852de/test%2Fparallel%2Ftest-tls-socket-constructor-alpn-options-parsing.js",
            "raw_url": "https://github.com/nodejs/node/raw/d597b9193fca7087a6bf1a5eb64c40ac88e852de/test%2Fparallel%2Ftest-tls-socket-constructor-alpn-options-parsing.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-socket-constructor-alpn-options-parsing.js?ref=d597b9193fca7087a6bf1a5eb64c40ac88e852de",
            "patch": "@@ -20,8 +20,6 @@ const fixtures = require('../common/fixtures');\n const key = fixtures.readKey('agent1-key.pem');\n const cert = fixtures.readKey('agent1-cert.pem');\n \n-const protocols = [];\n-\n const server = net.createServer(common.mustCall((s) => {\n   const tlsSocket = new tls.TLSSocket(s, {\n     isServer: true,\n@@ -32,10 +30,9 @@ const server = net.createServer(common.mustCall((s) => {\n   });\n \n   tlsSocket.on('secure', common.mustCall(() => {\n-    protocols.push({\n-      alpnProtocol: tlsSocket.alpnProtocol,\n-    });\n+    assert.strictEqual(tlsSocket.alpnProtocol, 'http/1.1');\n     tlsSocket.end();\n+    server.close();\n   }));\n }));\n \n@@ -46,13 +43,7 @@ server.listen(0, common.mustCall(() => {\n     ALPNProtocols: ['h2', 'http/1.1']\n   };\n \n-  tls.connect(alpnOpts, function() {\n+  tls.connect(alpnOpts, common.mustCall(function() {\n     this.end();\n-\n-    server.close();\n-\n-    assert.deepStrictEqual(protocols, [\n-      { alpnProtocol: 'http/1.1' },\n-    ]);\n-  });\n+  }));\n }));"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 4,
        "deletions": 13
    }
}