{
    "author": "tniessen",
    "message": "crypto: fix key object wrapping in sync keygen\n\nPR-URL: https://github.com/nodejs/node/pull/25326\nFixes: https://github.com/nodejs/node/issues/25322\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Sam Roberts <vieuxtech@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "7afdfaec083310baa66c05daf33409a7b55528dd",
    "files": [
        {
            "sha": "95b1e9114ab5369ca1bcbc0c40391564266dcf20",
            "filename": "doc/api/crypto.md",
            "status": "modified",
            "additions": 9,
            "deletions": 14,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/7afdfaec083310baa66c05daf33409a7b55528dd/doc%2Fapi%2Fcrypto.md",
            "raw_url": "https://github.com/nodejs/node/raw/7afdfaec083310baa66c05daf33409a7b55528dd/doc%2Fapi%2Fcrypto.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fcrypto.md?ref=7afdfaec083310baa66c05daf33409a7b55528dd",
            "patch": "@@ -1951,27 +1951,22 @@ changes:\n   - `publicExponent`: {number} Public exponent (RSA). **Default:** `0x10001`.\n   - `divisorLength`: {number} Size of `q` in bits (DSA).\n   - `namedCurve`: {string} Name of the curve to use (EC).\n-  - `publicKeyEncoding`: {Object}\n-    - `type`: {string} Must be one of `'pkcs1'` (RSA only) or `'spki'`.\n-    - `format`: {string} Must be `'pem'` or `'der'`.\n-  - `privateKeyEncoding`: {Object}\n-    - `type`: {string} Must be one of `'pkcs1'` (RSA only), `'pkcs8'` or\n-      `'sec1'` (EC only).\n-    - `format`: {string} Must be `'pem'` or `'der'`.\n-    - `cipher`: {string} If specified, the private key will be encrypted with\n-      the given `cipher` and `passphrase` using PKCS#5 v2.0 password based\n-      encryption.\n-    - `passphrase`: {string | Buffer} The passphrase to use for encryption, see\n-      `cipher`.\n+  - `publicKeyEncoding`: {Object} See [`keyObject.export()`][].\n+  - `privateKeyEncoding`: {Object} See [`keyObject.export()`][].\n * Returns: {Object}\n   - `publicKey`: {string | Buffer | KeyObject}\n   - `privateKey`: {string | Buffer | KeyObject}\n \n Generates a new asymmetric key pair of the given `type`. Only RSA, DSA and EC\n are currently supported.\n \n-It is recommended to encode public keys as `'spki'` and private keys as\n-`'pkcs8'` with encryption:\n+If a `publicKeyEncoding` or `privateKeyEncoding` was specified, this function\n+behaves as if [`keyObject.export()`][] had been called on its result. Otherwise,\n+the respective part of the key is returned as a [`KeyObject`].\n+\n+When encoding public keys, it is recommended to use `'spki'`. When encoding\n+private keys, it is recommended to use `'pks8'` with a strong passphrase, and to\n+keep the passphrase confidential.\n \n ```js\n const { generateKeyPairSync } = require('crypto');"
        },
        {
            "sha": "21dbf5ff8a136e8793deb90e82518665fa685029",
            "filename": "lib/internal/crypto/keygen.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/7afdfaec083310baa66c05daf33409a7b55528dd/lib%2Finternal%2Fcrypto%2Fkeygen.js",
            "raw_url": "https://github.com/nodejs/node/raw/7afdfaec083310baa66c05daf33409a7b55528dd/lib%2Finternal%2Fcrypto%2Fkeygen.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fkeygen.js?ref=7afdfaec083310baa66c05daf33409a7b55528dd",
            "patch": "@@ -74,7 +74,11 @@ function handleError(impl, wrap) {\n   if (err !== undefined)\n     throw err;\n \n-  return { publicKey, privateKey };\n+  // If no encoding was chosen, return key objects instead.\n+  return {\n+    publicKey: wrapKey(publicKey, PublicKeyObject),\n+    privateKey: wrapKey(privateKey, PrivateKeyObject)\n+  };\n }\n \n function parseKeyEncoding(keyType, options) {"
        },
        {
            "sha": "aabd92e369a3c077fe459917054195463df41666",
            "filename": "test/parallel/test-crypto-keygen.js",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/7afdfaec083310baa66c05daf33409a7b55528dd/test%2Fparallel%2Ftest-crypto-keygen.js",
            "raw_url": "https://github.com/nodejs/node/raw/7afdfaec083310baa66c05daf33409a7b55528dd/test%2Fparallel%2Ftest-crypto-keygen.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-keygen.js?ref=7afdfaec083310baa66c05daf33409a7b55528dd",
            "patch": "@@ -95,6 +95,21 @@ const sec1EncExp = (cipher) => getRegExpForPEM('EC PRIVATE KEY', cipher);\n   testSignVerify(publicKey, privateKey);\n }\n \n+{\n+  // Test sync key generation with key objects.\n+  const { publicKey, privateKey } = generateKeyPairSync('rsa', {\n+    modulusLength: 512\n+  });\n+\n+  assert.strictEqual(typeof publicKey, 'object');\n+  assert.strictEqual(publicKey.type, 'public');\n+  assert.strictEqual(publicKey.asymmetricKeyType, 'rsa');\n+\n+  assert.strictEqual(typeof privateKey, 'object');\n+  assert.strictEqual(privateKey.type, 'private');\n+  assert.strictEqual(privateKey.asymmetricKeyType, 'rsa');\n+}\n+\n {\n   const publicKeyEncoding = {\n     type: 'pkcs1',"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 29,
        "deletions": 15
    }
}