{
    "author": "joyeecheung",
    "message": "fs: throw openSync errors in JS\n\nPR-URL: https://github.com/nodejs/node/pull/18871\nRefs: https://github.com/nodejs/node/issues/18106\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "fea5dda1d1ee4ebc2883fc9b4019c254176cc2c6",
    "files": [
        {
            "sha": "60134b1c321f18c54d78b0886e61b3c678ef5864",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/fea5dda1d1ee4ebc2883fc9b4019c254176cc2c6/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/fea5dda1d1ee4ebc2883fc9b4019c254176cc2c6/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=fea5dda1d1ee4ebc2883fc9b4019c254176cc2c6",
            "patch": "@@ -521,8 +521,12 @@ fs.openSync = function(path, flags, mode) {\n   validatePath(path);\n   validateUint32(mode, 'mode');\n \n-  return binding.open(pathModule.toNamespacedPath(path),\n-                      stringToFlags(flags), mode);\n+  const ctx = { path };\n+  const result = binding.open(pathModule.toNamespacedPath(path),\n+                              stringToFlags(flags), mode,\n+                              undefined, ctx);\n+  handleErrorFromBinding(ctx);\n+  return result;\n };\n \n fs.read = function(fd, buffer, offset, length, position, callback) {"
        },
        {
            "sha": "8f9b71a238edad1ae26c2156c0db34b94cb7370e",
            "filename": "src/node_file.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 10,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/fea5dda1d1ee4ebc2883fc9b4019c254176cc2c6/src%2Fnode_file.cc",
            "raw_url": "https://github.com/nodejs/node/raw/fea5dda1d1ee4ebc2883fc9b4019c254176cc2c6/src%2Fnode_file.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.cc?ref=fea5dda1d1ee4ebc2883fc9b4019c254176cc2c6",
            "patch": "@@ -1169,25 +1169,29 @@ static void ReadDir(const FunctionCallbackInfo<Value>& args) {\n \n static void Open(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n-  Local<Context> context = env->context();\n \n-  CHECK_GE(args.Length(), 3);\n-  CHECK(args[1]->IsInt32());\n-  CHECK(args[2]->IsInt32());\n+  const int argc = args.Length();\n+  CHECK_GE(argc, 3);\n \n   BufferValue path(env->isolate(), args[0]);\n   CHECK_NE(*path, nullptr);\n \n-  int flags = args[1]->Int32Value(context).ToChecked();\n-  int mode = args[2]->Int32Value(context).ToChecked();\n+  CHECK(args[1]->IsInt32());\n+  const int flags = args[1].As<Int32>()->Value();\n+\n+  CHECK(args[2]->IsInt32());\n+  const int mode = args[2].As<Int32>()->Value();\n \n   FSReqBase* req_wrap = GetReqWrap(env, args[3]);\n-  if (req_wrap != nullptr) {\n+  if (req_wrap != nullptr) {  // open(path, flags, mode, req)\n     AsyncCall(env, req_wrap, args, \"open\", UTF8, AfterInteger,\n               uv_fs_open, *path, flags, mode);\n-  } else {\n-    SYNC_CALL(open, *path, *path, flags, mode)\n-    args.GetReturnValue().Set(SYNC_RESULT);\n+  } else {  // open(path, flags, mode, undefined, ctx)\n+    CHECK_EQ(argc, 5);\n+    fs_req_wrap req_wrap;\n+    int result = SyncCall(env, args[4], &req_wrap, \"open\",\n+                          uv_fs_open, *path, flags, mode);\n+    args.GetReturnValue().Set(result);\n   }\n }\n "
        }
    ],
    "stats": {
        "total": 32,
        "additions": 20,
        "deletions": 12
    }
}