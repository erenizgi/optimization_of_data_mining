{
    "author": "unknown",
    "message": "fs: fix fsPromises.lchmod error on non-Mac\n\nOn non-macOS, fsPromises.lchmod throws AssertionError.\nExpected behavior is `Error [ERR_METHOD_NOT_IMPLEMENTED]`.\n`ERR_METHOD_NOT_IMPLEMENTED()` requires argument, but it wasn't set.\n\nFixes `ERR_METHOD_NOT_IMPLEMENTED()` to\n`ERR_METHOD_NOT_IMPLEMENTED('lchmod()')`.\n\nPR-URL: https://github.com/nodejs/node/pull/21435\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Weijia Wang <starkwang@126.com>\nReviewed-By: Сковорода Никита Андреевич <chalkerx@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Yuta Hiroto <hello@hiroppy.me>",
    "sha": "f54958ef2f6f66213f300f4fd2322e8d8c802e28",
    "files": [
        {
            "sha": "fac430bbe227e189aa8f7d7319bf1d29dfd2c38f",
            "filename": "lib/internal/fs/promises.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f54958ef2f6f66213f300f4fd2322e8d8c802e28/lib%2Finternal%2Ffs%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/f54958ef2f6f66213f300f4fd2322e8d8c802e28/lib%2Finternal%2Ffs%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Fpromises.js?ref=f54958ef2f6f66213f300f4fd2322e8d8c802e28",
            "patch": "@@ -371,7 +371,7 @@ async function chmod(path, mode) {\n \n async function lchmod(path, mode) {\n   if (O_SYMLINK === undefined)\n-    throw new ERR_METHOD_NOT_IMPLEMENTED();\n+    throw new ERR_METHOD_NOT_IMPLEMENTED('lchmod()');\n \n   const fd = await open(path, O_WRONLY | O_SYMLINK);\n   return fchmod(fd, mode).finally(fd.close.bind(fd));"
        },
        {
            "sha": "602f1191b7aef5b3fd2bfc44fcf4faf287968634",
            "filename": "test/parallel/test-fs-promises.js",
            "status": "modified",
            "additions": 13,
            "deletions": 2,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/f54958ef2f6f66213f300f4fd2322e8d8c802e28/test%2Fparallel%2Ftest-fs-promises.js",
            "raw_url": "https://github.com/nodejs/node/raw/f54958ef2f6f66213f300f4fd2322e8d8c802e28/test%2Fparallel%2Ftest-fs-promises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-promises.js?ref=f54958ef2f6f66213f300f4fd2322e8d8c802e28",
            "patch": "@@ -140,15 +140,26 @@ function verifyStatObject(stat) {\n                          (await realpath(newLink)).toLowerCase());\n       assert.strictEqual(newPath.toLowerCase(),\n                          (await readlink(newLink)).toLowerCase());\n+\n+      const newMode = 0o666;\n       if (common.isOSX) {\n         // lchmod is only available on macOS\n-        const newMode = 0o666;\n         await lchmod(newLink, newMode);\n         stats = await lstat(newLink);\n         assert.strictEqual(stats.mode & 0o777, newMode);\n+      } else {\n+        await Promise.all([\n+          assert.rejects(\n+            lchmod(newLink, newMode),\n+            common.expectsError({\n+              code: 'ERR_METHOD_NOT_IMPLEMENTED',\n+              type: Error,\n+              message: 'The lchmod() method is not implemented'\n+            })\n+          )\n+        ]);\n       }\n \n-\n       await unlink(newLink);\n     }\n "
        }
    ],
    "stats": {
        "total": 17,
        "additions": 14,
        "deletions": 3
    }
}