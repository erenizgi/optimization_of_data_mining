{
    "author": "unknown",
    "message": "build: enabling lto at configure\n\nThis modification allows for compiling with link time optimization (lto)\nusing the flag --enable-lto.\n\nRefs: https://github.com/nodejs/node/issues/7400\n\nPR-URL: https://github.com/nodejs/node/pull/21677\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "32cad739b12c3f1b24dff9a24e8321927e9b2eb2",
    "files": [
        {
            "sha": "9d74b46a8d5c70610e23f4d148ea7120a449341a",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/32cad739b12c3f1b24dff9a24e8321927e9b2eb2/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/32cad739b12c3f1b24dff9a24e8321927e9b2eb2/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=32cad739b12c3f1b24dff9a24e8321927e9b2eb2",
            "patch": "@@ -176,6 +176,17 @@\n           ['OS!=\"mac\" and OS!=\"win\"', {\n             'cflags': [ '-fno-omit-frame-pointer' ],\n           }],\n+          ['OS==\"linux\"', {\n+            'variables': {\n+              'lto': ' -flto=4 -fuse-linker-plugin -ffat-lto-objects ',\n+            },\n+            'conditions': [\n+              ['enable_lto==\"true\"', {\n+                'cflags': ['<(lto)'],\n+                'ldflags': ['<(lto)'],\n+              },],\n+            ],\n+          },],\n           ['OS == \"android\"', {\n             'cflags': [ '-fPIE' ],\n             'ldflags': [ '-fPIE', '-pie' ]"
        },
        {
            "sha": "068fb8a76999a1c2344efb7efb174a3cd5d14eea",
            "filename": "configure",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/32cad739b12c3f1b24dff9a24e8321927e9b2eb2/configure",
            "raw_url": "https://github.com/nodejs/node/raw/32cad739b12c3f1b24dff9a24e8321927e9b2eb2/configure",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/configure?ref=32cad739b12c3f1b24dff9a24e8321927e9b2eb2",
            "patch": "@@ -157,6 +157,11 @@ parser.add_option(\"--enable-vtune-profiling\",\n          \"JavaScript code executed in nodejs. This feature is only available \"\n          \"for x32, x86, and x64 architectures.\")\n \n+parser.add_option(\"--enable-lto\",\n+    action=\"store_true\",\n+    dest=\"enable_lto\",\n+    help=\"Enable compiling with lto of a binary. This feature is only available \"\n+         \"on linux with gcc and g++.\")\n \n parser.add_option(\"--link-module\",\n     action=\"append\",\n@@ -932,6 +937,25 @@ def configure_node(o):\n   else:\n     o['variables']['node_enable_v8_vtunejit'] = 'false'\n \n+  if flavor != 'linux' and (options.enable_lto):\n+    raise Exception(\n+      'The lto option is supported only on linux.')\n+\n+  if flavor == 'linux':\n+    if options.enable_lto:\n+      version_checked = (5, 4, 1)\n+      for compiler in [(CC, 'c'), (CXX, 'c++')]:\n+        ok, is_clang, clang_version, compiler_version = \\\n+          try_check_compiler(compiler[0], compiler[1])\n+        compiler_version_num = tuple(map(int, compiler_version))\n+        if is_clang or compiler_version_num < version_checked:\n+          version_checked_str = \".\".join(map(str, version_checked))\n+          raise Exception(\n+            'The option --enable-lto is supported for gcc and gxx %s'\n+            ' or newer only.' % (version_checked_str))\n+\n+  o['variables']['enable_lto'] = b(options.enable_lto)\n+\n   if flavor in ('solaris', 'mac', 'linux', 'freebsd'):\n     use_dtrace = not options.without_dtrace\n     # Don't enable by default on linux and freebsd"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 35,
        "deletions": 0
    }
}