{
    "author": "bnoordhuis",
    "message": "tls: disable TLS v1.0 and v1.1 by default\n\nRefs: https://blog.mozilla.org/security/2018/10/15/removing-old-versions-of-tls/\n\nPR-URL: https://github.com/nodejs/node/pull/23814\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Sam Roberts <vieuxtech@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Rod Vagg <rod@vagg.org>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
    "files": [
        {
            "sha": "723e849d4e467fe246e3f227b4fbd3557b635ac0",
            "filename": "doc/api/cli.md",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/doc%2Fapi%2Fcli.md",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/doc%2Fapi%2Fcli.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fcli.md?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -342,6 +342,22 @@ added: v4.0.0\n Specify an alternative default TLS cipher list. Requires Node.js to be built\n with crypto support (default).\n \n+### `--tls-v1.0`\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+Enable TLSv1.0. This should only be used for compatibility with old TLS\n+clients or servers.\n+\n+### `--tls-v1.1`\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+Enable TLSv1.1. This should only be used for compatibility with old TLS\n+clients or servers.\n+\n ### `--trace-deprecation`\n <!-- YAML\n added: v0.8.0"
        },
        {
            "sha": "8380353934f3fe35e89ecb6fabdf170fe541c573",
            "filename": "doc/api/tls.md",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/doc%2Fapi%2Ftls.md",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/doc%2Fapi%2Ftls.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ftls.md?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -1102,7 +1102,8 @@ changes:\n     [OpenSSL Options][].\n   * `secureProtocol` {string} SSL method to use. The possible values are listed\n     as [SSL_METHODS][], use the function names as strings. For example,\n-    `'TLSv1_2_method'` to force TLS version 1.2. **Default:** `'TLS_method'`.\n+    `'TLSv1_2_method'` to force TLS version 1.2.\n+    **Default:** `'TLSv1_2_method'`.\n   * `sessionIdContext` {string} Opaque identifier used by servers to ensure\n     session state is not shared between applications. Unused by clients.\n "
        },
        {
            "sha": "52e307a6d6c163af34ce352df9ebd2740adcb05c",
            "filename": "doc/node.1",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/doc%2Fnode.1",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/doc%2Fnode.1",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fnode.1?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -183,6 +183,14 @@ Specify process.title on startup.\n Specify an alternative default TLS cipher list.\n Requires Node.js to be built with crypto support. (Default)\n .\n+.It Fl -tls-v1.0\n+Enable TLSv1.0. This should only be used for compatibility with old TLS\n+clients or servers.\n+.\n+.It Fl -tls-v1.1\n+Enable TLSv1.1. This should only be used for compatibility with old TLS\n+clients or servers.\n+.\n .It Fl -trace-deprecation\n Print stack traces for deprecations.\n ."
        },
        {
            "sha": "f34c37c7db7ac45a8807805e71a7148839e33bd4",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -396,10 +396,13 @@ void SecureContext::Init(const FunctionCallbackInfo<Value>& args) {\n   ASSIGN_OR_RETURN_UNWRAP(&sc, args.Holder());\n   Environment* env = sc->env();\n \n-  int min_version = 0;\n+  int min_version = TLS1_2_VERSION;\n   int max_version = 0;\n   const SSL_METHOD* method = TLS_method();\n \n+  if (env->options()->tls_v1_1) min_version = TLS1_1_VERSION;\n+  if (env->options()->tls_v1_0) min_version = TLS1_VERSION;\n+\n   if (args.Length() == 1 && args[0]->IsString()) {\n     const node::Utf8Value sslmethod(env->isolate(), args[0]);\n \n@@ -425,6 +428,9 @@ void SecureContext::Init(const FunctionCallbackInfo<Value>& args) {\n       method = TLS_server_method();\n     } else if (strcmp(*sslmethod, \"SSLv23_client_method\") == 0) {\n       method = TLS_client_method();\n+    } else if (strcmp(*sslmethod, \"TLS_method\") == 0) {\n+      min_version = 0;\n+      max_version = 0;\n     } else if (strcmp(*sslmethod, \"TLSv1_method\") == 0) {\n       min_version = TLS1_VERSION;\n       max_version = TLS1_VERSION;"
        },
        {
            "sha": "5dc6779bc41a0c56a0900076186f9c442c7b8e2b",
            "filename": "src/node_options.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/src%2Fnode_options.cc",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/src%2Fnode_options.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.cc?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -189,6 +189,17 @@ EnvironmentOptionsParser::EnvironmentOptionsParser() {\n \n   AddOption(\"--napi-modules\", \"\", NoOp{}, kAllowedInEnvironment);\n \n+#if HAVE_OPENSSL\n+  AddOption(\"--tls-v1.0\",\n+            \"enable TLSv1.0\",\n+            &EnvironmentOptions::tls_v1_0,\n+            kAllowedInEnvironment);\n+  AddOption(\"--tls-v1.1\",\n+            \"enable TLSv1.1\",\n+            &EnvironmentOptions::tls_v1_1,\n+            kAllowedInEnvironment);\n+#endif\n+\n   Insert(&DebugOptionsParser::instance,\n          &EnvironmentOptions::get_debug_options);\n }"
        },
        {
            "sha": "8e9ea6304e64ed874ef2bf3c7fb2999865f3cd1b",
            "filename": "src/node_options.h",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/src%2Fnode_options.h",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/src%2Fnode_options.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.h?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -92,6 +92,11 @@ class EnvironmentOptions : public Options {\n   bool print_eval = false;\n   bool force_repl = false;\n \n+#if HAVE_OPENSSL\n+  bool tls_v1_0 = false;\n+  bool tls_v1_1 = false;\n+#endif\n+\n   std::vector<std::string> preload_modules;\n \n   std::vector<std::string> user_argv;"
        },
        {
            "sha": "1bbff96001202ba889bcea3ac4e067256d36c069",
            "filename": "test/parallel/test-https-agent-additional-options.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-https-agent-additional-options.js",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-https-agent-additional-options.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-https-agent-additional-options.js?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --tls-v1.1\n 'use strict';\n const common = require('../common');\n if (!common.hasCrypto)\n@@ -34,7 +35,7 @@ const updatedValues = new Map([\n   ['ecdhCurve', 'secp384r1'],\n   ['honorCipherOrder', true],\n   ['secureOptions', crypto.constants.SSL_OP_CIPHER_SERVER_PREFERENCE],\n-  ['secureProtocol', 'TLSv1_method'],\n+  ['secureProtocol', 'TLSv1_1_method'],\n   ['sessionIdContext', 'sessionIdContext'],\n ]);\n "
        },
        {
            "sha": "785f4737bddb277db6cbaaf4f6ab83c33fc47934",
            "filename": "test/parallel/test-https-agent-session-eviction.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-https-agent-session-eviction.js",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-https-agent-session-eviction.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-https-agent-session-eviction.js?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --tls-v1.0\n 'use strict';\n \n const common = require('../common');"
        },
        {
            "sha": "13bc8a4a019c67034ad0f46a8f89e2f0e6f4a81a",
            "filename": "test/parallel/test-process-env-allowed-flags.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-process-env-allowed-flags.js",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-process-env-allowed-flags.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-env-allowed-flags.js?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -51,7 +51,8 @@ require('../common');\n // assert all \"canonical\" flags begin with dash(es)\n {\n   process.allowedNodeEnvironmentFlags.forEach((flag) => {\n-    assert(/^--?[a-z8_-]+$/.test(flag), `Unexpected format for flag ${flag}`);\n+    assert(/^--?[a-z0-9._-]+$/.test(flag),\n+           `Unexpected format for flag ${flag}`);\n   });\n }\n "
        },
        {
            "sha": "20018241e33572d685dd5385a096619a8fe26563",
            "filename": "test/parallel/test-tls-getprotocol.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-tls-getprotocol.js",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-tls-getprotocol.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-getprotocol.js?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -17,6 +17,7 @@ const clientConfigs = [\n ];\n \n const serverConfig = {\n+  secureProtocol: 'TLS_method',\n   key: fixtures.readSync('/keys/agent2-key.pem'),\n   cert: fixtures.readSync('/keys/agent2-cert.pem')\n };"
        },
        {
            "sha": "2a74be0521df215797c42f8c0a7ccb5d00f718a4",
            "filename": "test/parallel/test-tls-session-cache.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-tls-session-cache.js",
            "raw_url": "https://github.com/nodejs/node/raw/60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354/test%2Fparallel%2Ftest-tls-session-cache.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-session-cache.js?ref=60eca6a5d4fb5d70c4affceb1fbe78f1c1db8354",
            "patch": "@@ -48,7 +48,8 @@ function doTest(testOptions, callback) {\n     cert,\n     ca: [cert],\n     requestCert: true,\n-    rejectUnauthorized: false\n+    rejectUnauthorized: false,\n+    secureProtocol: 'TLS_method',\n   };\n   let requestCount = 0;\n   let resumeCount = 0;"
        }
    ],
    "stats": {
        "total": 62,
        "additions": 57,
        "deletions": 5
    }
}