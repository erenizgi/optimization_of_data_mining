{
    "author": "cjihrig",
    "message": "deps: upgrade to libuv 1.20.2\n\nPR-URL: https://github.com/nodejs/node/pull/20129\nFixes: https://github.com/nodejs/node/issues/20112\nFixes: https://github.com/nodejs/node/issues/19903\nReviewed-By: Myles Borins <myles.borins@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "63d991b7cf229a713d0d72b51dcb7b52691d7d65",
    "files": [
        {
            "sha": "ba360e3f74e2778226dc2fc0aa193e9d10405199",
            "filename": "deps/uv/AUTHORS",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2FAUTHORS",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2FAUTHORS",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2FAUTHORS?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -332,3 +332,8 @@ Ryuichi KAWAMATA <ryuichi.kawamata@dena.jp>\n Joyee Cheung <joyeec9h3@gmail.com>\n Michael Kilburn <crusader.mike@gmail.com>\n Ruslan Bekenev <furyinbox@gmail.com>\n+Bob Burger <rgburger@beckman.com>\n+Thomas Versteeg <thomasversteeg@gmx.com>\n+zzzjim <zzzjim@users.noreply.github.com>\n+Alex Arslan <ararslan@comcast.net>\n+Kyle Farnung <kfarnung@microsoft.com>"
        },
        {
            "sha": "a7cd0ad2dc50035cef3a3dec35648933a6726025",
            "filename": "deps/uv/ChangeLog",
            "status": "modified",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2FChangeLog",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2FChangeLog",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2FChangeLog?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -1,3 +1,39 @@\n+2018.04.23, Version 1.20.2 (Stable), c51fd3f66bbb386a1efdeba6812789f35a372d1e\n+\n+Changes since version 1.20.1:\n+\n+* zos: use custom semaphore (jBarz)\n+\n+* win: fix registry API error handling (Kyle Farnung)\n+\n+* build: add support for 64-bit AIX (Richard Lau)\n+\n+* aix: guard STATIC_ASSERT for glibc work around (Richard Lau)\n+\n+\n+2018.04.19, Version 1.20.1 (Stable), 36ac2fc8edfd5ff3e9be529be1d4a3f0d5364e94\n+\n+Changes since version 1.20.0:\n+\n+* doc,fs: improve documentation (Bob Burger)\n+\n+* win: return a floored double from uv_uptime() (Refael Ackermann)\n+\n+* doc: clarify platform specific pipe naming (Thomas Versteeg)\n+\n+* unix: fix uv_pipe_chmod() on macOS (zzzjim)\n+\n+* unix: work around glibc semaphore race condition (Anna Henningsen)\n+\n+* tcp,openbsd: disable Unix TCP check for IPV6_ONLY (Alex Arslan)\n+\n+* test,openbsd: use RETURN_SKIP in UDP IPv6 tests (Alex Arslan)\n+\n+* test,openbsd: fix multicast test (Alex Arslan)\n+\n+* Revert \"win, fs: use FILE_WRITE_ATTRIBUTES when opening files\" (cjihrig)\n+\n+\n 2018.04.03, Version 1.20.0 (Stable), 0012178ee2b04d9e4a2c66c27cf8891ad8325ceb\n \n Changes since version 1.19.2:"
        },
        {
            "sha": "2297bdf0fb0c620dc02a15ed5d31110eb8e31aaa",
            "filename": "deps/uv/common.gypi",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fcommon.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fcommon.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fcommon.gypi?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -134,7 +134,7 @@\n           }]\n         ]\n       }],\n-      ['OS in \"freebsd dragonflybsd linux openbsd solaris android\"', {\n+      ['OS in \"freebsd dragonflybsd linux openbsd solaris android aix\"', {\n         'cflags': [ '-Wall' ],\n         'cflags_cc': [ '-fno-rtti', '-fno-exceptions' ],\n         'target_conditions': [\n@@ -162,6 +162,10 @@\n             'cflags': [ '-pthread' ],\n             'ldflags': [ '-pthread' ],\n           }],\n+          [ 'OS==\"aix\" and target_arch==\"ppc64\"', {\n+            'cflags': [ '-maix64' ],\n+            'ldflags': [ '-maix64' ],\n+          }],\n         ],\n       }],\n       ['OS==\"mac\"', {"
        },
        {
            "sha": "f4d97daaba0cb9023364736bf35b4f0ad3613b57",
            "filename": "deps/uv/configure.ac",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fconfigure.ac",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fconfigure.ac",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fconfigure.ac?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -13,7 +13,7 @@\n # OR IN CONNECTION WITH THE USE OR PERFORMANCE OF THIS SOFTWARE.\n \n AC_PREREQ(2.57)\n-AC_INIT([libuv], [1.20.0], [https://github.com/libuv/libuv/issues])\n+AC_INIT([libuv], [1.20.2], [https://github.com/libuv/libuv/issues])\n AC_CONFIG_MACRO_DIR([m4])\n m4_include([m4/libuv-extra-automake-flags.m4])\n m4_include([m4/as_case.m4])"
        },
        {
            "sha": "8e8fc2f1d5d605a9800e7d6e30c4ad502e665c54",
            "filename": "deps/uv/docs/src/fs.rst",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fdocs%2Fsrc%2Ffs.rst",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fdocs%2Fsrc%2Ffs.rst",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fdocs%2Fsrc%2Ffs.rst?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -148,8 +148,8 @@ Public members\n \n .. c:member:: void* uv_fs_t.ptr\n \n-    Stores the result of :c:func:`uv_fs_readlink` and serves as an alias to\n-    `statbuf`.\n+    Stores the result of :c:func:`uv_fs_readlink` and\n+    :c:func:`uv_fs_realpath` and serves as an alias to `statbuf`.\n \n .. seealso:: The :c:type:`uv_req_t` members also apply.\n \n@@ -311,10 +311,12 @@ API\n .. c:function:: int uv_fs_readlink(uv_loop_t* loop, uv_fs_t* req, const char* path, uv_fs_cb cb)\n \n     Equivalent to :man:`readlink(2)`.\n+    The resulting string is stored in `req->ptr`.\n \n .. c:function:: int uv_fs_realpath(uv_loop_t* loop, uv_fs_t* req, const char* path, uv_fs_cb cb)\n \n     Equivalent to :man:`realpath(3)` on Unix. Windows uses `GetFinalPathNameByHandle <https://msdn.microsoft.com/en-us/library/windows/desktop/aa364962(v=vs.85).aspx>`_.\n+    The resulting string is stored in `req->ptr`.\n \n     .. warning::\n         This function has certain platform-specific caveats that were discovered when used in Node."
        },
        {
            "sha": "0267d74cbd02c93d34c02bbc2750932a7e842898",
            "filename": "deps/uv/include/uv-os390.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Finclude%2Fuv-os390.h",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Finclude%2Fuv-os390.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Finclude%2Fuv-os390.h?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -22,7 +22,7 @@\n #ifndef UV_MVS_H\n #define UV_MVS_H\n \n-#define UV_PLATFORM_SEM_T int\n+#define UV_PLATFORM_SEM_T long\n \n #define UV_PLATFORM_LOOP_FIELDS                                               \\\n   void* ep;                                                                   \\"
        },
        {
            "sha": "18f40da890bcb915d6732708eef772f44058a8c4",
            "filename": "deps/uv/include/uv-version.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Finclude%2Fuv-version.h",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Finclude%2Fuv-version.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Finclude%2Fuv-version.h?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -32,7 +32,7 @@\n \n #define UV_VERSION_MAJOR 1\n #define UV_VERSION_MINOR 20\n-#define UV_VERSION_PATCH 0\n+#define UV_VERSION_PATCH 2\n #define UV_VERSION_IS_RELEASE 1\n #define UV_VERSION_SUFFIX \"\"\n "
        },
        {
            "sha": "2c578dcb359957c0aa33dd238993ebc2d6e51f85",
            "filename": "deps/uv/src/unix/pipe.c",
            "status": "modified",
            "additions": 20,
            "deletions": 15,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Funix%2Fpipe.c",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Funix%2Fpipe.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Fpipe.c?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -319,21 +319,6 @@ int uv_pipe_chmod(uv_pipe_t* handle, int mode) {\n       mode != (UV_WRITABLE | UV_READABLE))\n     return UV_EINVAL;\n \n-  if (fstat(uv__stream_fd(handle), &pipe_stat) == -1)\n-    return UV__ERR(errno);\n-\n-  desired_mode = 0;\n-  if (mode & UV_READABLE)\n-    desired_mode |= S_IRUSR | S_IRGRP | S_IROTH;\n-  if (mode & UV_WRITABLE)\n-    desired_mode |= S_IWUSR | S_IWGRP | S_IWOTH;\n-\n-  /* Exit early if pipe already has desired mode. */\n-  if ((pipe_stat.st_mode & desired_mode) == desired_mode)\n-    return 0;\n-\n-  pipe_stat.st_mode |= desired_mode;\n-\n   /* Unfortunately fchmod does not work on all platforms, we will use chmod. */\n   name_len = 0;\n   r = uv_pipe_getsockname(handle, NULL, &name_len);\n@@ -350,6 +335,26 @@ int uv_pipe_chmod(uv_pipe_t* handle, int mode) {\n     return r;\n   }\n \n+  /* stat must be used as fstat has a bug on Darwin */\n+  if (stat(name_buffer, &pipe_stat) == -1) {\n+    uv__free(name_buffer);\n+    return -errno;\n+  }\n+\n+  desired_mode = 0;\n+  if (mode & UV_READABLE)\n+    desired_mode |= S_IRUSR | S_IRGRP | S_IROTH;\n+  if (mode & UV_WRITABLE)\n+    desired_mode |= S_IWUSR | S_IWGRP | S_IWOTH;\n+\n+  /* Exit early if pipe already has desired mode. */\n+  if ((pipe_stat.st_mode & desired_mode) == desired_mode) {\n+    uv__free(name_buffer);\n+    return 0;\n+  }\n+\n+  pipe_stat.st_mode |= desired_mode;\n+\n   r = chmod(name_buffer, pipe_stat.st_mode);\n   uv__free(name_buffer);\n "
        },
        {
            "sha": "9a46793fdbb9e62c655f15d86c172d538a67a307",
            "filename": "deps/uv/src/unix/tcp.c",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Funix%2Ftcp.c",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Funix%2Ftcp.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Ftcp.c?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -164,6 +164,7 @@ int uv__tcp_bind(uv_tcp_t* tcp,\n   if (setsockopt(tcp->io_watcher.fd, SOL_SOCKET, SO_REUSEADDR, &on, sizeof(on)))\n     return UV__ERR(errno);\n \n+#ifndef __OpenBSD__\n #ifdef IPV6_V6ONLY\n   if (addr->sa_family == AF_INET6) {\n     on = (flags & UV_TCP_IPV6ONLY) != 0;\n@@ -179,6 +180,7 @@ int uv__tcp_bind(uv_tcp_t* tcp,\n       return UV__ERR(errno);\n     }\n   }\n+#endif\n #endif\n \n   errno = 0;"
        },
        {
            "sha": "303bc6ec84f341a256abecb12d1b74dba344afc7",
            "filename": "deps/uv/src/unix/thread.c",
            "status": "modified",
            "additions": 142,
            "deletions": 59,
            "changes": 201,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Funix%2Fthread.c",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Funix%2Fthread.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Funix%2Fthread.c?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -37,6 +37,10 @@\n #include <sys/sem.h>\n #endif\n \n+#ifdef __GLIBC__\n+#include <gnu/libc-version.h>  /* gnu_get_libc_version() */\n+#endif\n+\n #undef NANOSEC\n #define NANOSEC ((uint64_t) 1e9)\n \n@@ -419,109 +423,145 @@ int uv_sem_trywait(uv_sem_t* sem) {\n   return UV_EINVAL;  /* Satisfy the compiler. */\n }\n \n+#else /* !(defined(__APPLE__) && defined(__MACH__)) */\n+\n+#ifdef __GLIBC__\n+\n+/* Hack around https://sourceware.org/bugzilla/show_bug.cgi?id=12674\n+ * by providing a custom implementation for glibc < 2.21 in terms of other\n+ * concurrency primitives.\n+ * Refs: https://github.com/nodejs/node/issues/19903 */\n+\n+/* To preserve ABI compatibility, we treat the uv_sem_t as storage for\n+ * a pointer to the actual struct we're using underneath. */\n+\n+static uv_once_t glibc_version_check_once = UV_ONCE_INIT;\n+static int platform_needs_custom_semaphore = 0;\n+\n+static void glibc_version_check(void) {\n+  const char* version = gnu_get_libc_version();\n+  platform_needs_custom_semaphore =\n+      version[0] == '2' && version[1] == '.' &&\n+      atoi(version + 2) < 21;\n+}\n+\n #elif defined(__MVS__)\n \n-int uv_sem_init(uv_sem_t* sem, unsigned int value) {\n-  uv_sem_t semid;\n+#define platform_needs_custom_semaphore 1\n+\n+#else /* !defined(__GLIBC__) && !defined(__MVS__) */\n+\n+#define platform_needs_custom_semaphore 0\n+\n+#endif\n+\n+typedef struct uv_semaphore_s {\n+  uv_mutex_t mutex;\n+  uv_cond_t cond;\n+  unsigned int value;\n+} uv_semaphore_t;\n+\n+#if defined(__GLIBC__) || platform_needs_custom_semaphore\n+STATIC_ASSERT(sizeof(uv_sem_t) >= sizeof(uv_semaphore_t*));\n+#endif\n+\n+static int uv__custom_sem_init(uv_sem_t* sem_, unsigned int value) {\n   int err;\n-  union {\n-    int val;\n-    struct semid_ds* buf;\n-    unsigned short* array;\n-  } arg;\n+  uv_semaphore_t* sem;\n \n+  sem = uv__malloc(sizeof(*sem));\n+  if (sem == NULL)\n+    return UV_ENOMEM;\n \n-  semid = semget(IPC_PRIVATE, 1, S_IRUSR | S_IWUSR);\n-  if (semid == -1)\n-    return UV__ERR(errno);\n+  if ((err = uv_mutex_init(&sem->mutex)) != 0) {\n+    uv__free(sem);\n+    return err;\n+  }\n \n-  arg.val = value;\n-  if (-1 == semctl(semid, 0, SETVAL, arg)) {\n-    err = errno;\n-    if (-1 == semctl(*sem, 0, IPC_RMID))\n-      abort();\n-    return UV__ERR(err);\n+  if ((err = uv_cond_init(&sem->cond)) != 0) {\n+    uv_mutex_destroy(&sem->mutex);\n+    uv__free(sem);\n+    return err;\n   }\n \n-  *sem = semid;\n+  sem->value = value;\n+  *(uv_semaphore_t**)sem_ = sem;\n   return 0;\n }\n \n-void uv_sem_destroy(uv_sem_t* sem) {\n-  if (-1 == semctl(*sem, 0, IPC_RMID))\n-    abort();\n+\n+static void uv__custom_sem_destroy(uv_sem_t* sem_) {\n+  uv_semaphore_t* sem;\n+\n+  sem = *(uv_semaphore_t**)sem_;\n+  uv_cond_destroy(&sem->cond);\n+  uv_mutex_destroy(&sem->mutex);\n+  uv__free(sem);\n }\n \n-void uv_sem_post(uv_sem_t* sem) {\n-  struct sembuf buf;\n \n-  buf.sem_num = 0;\n-  buf.sem_op = 1;\n-  buf.sem_flg = 0;\n+static void uv__custom_sem_post(uv_sem_t* sem_) {\n+  uv_semaphore_t* sem;\n \n-  if (-1 == semop(*sem, &buf, 1))\n-    abort();\n+  sem = *(uv_semaphore_t**)sem_;\n+  uv_mutex_lock(&sem->mutex);\n+  sem->value++;\n+  if (sem->value == 1)\n+    uv_cond_signal(&sem->cond);\n+  uv_mutex_unlock(&sem->mutex);\n }\n \n-void uv_sem_wait(uv_sem_t* sem) {\n-  struct sembuf buf;\n-  int op_status;\n-\n-  buf.sem_num = 0;\n-  buf.sem_op = -1;\n-  buf.sem_flg = 0;\n \n-  do\n-    op_status = semop(*sem, &buf, 1);\n-  while (op_status == -1 && errno == EINTR);\n+static void uv__custom_sem_wait(uv_sem_t* sem_) {\n+  uv_semaphore_t* sem;\n \n-  if (op_status)\n-    abort();\n+  sem = *(uv_semaphore_t**)sem_;\n+  uv_mutex_lock(&sem->mutex);\n+  while (sem->value == 0)\n+    uv_cond_wait(&sem->cond, &sem->mutex);\n+  sem->value--;\n+  uv_mutex_unlock(&sem->mutex);\n }\n \n-int uv_sem_trywait(uv_sem_t* sem) {\n-  struct sembuf buf;\n-  int op_status;\n \n-  buf.sem_num = 0;\n-  buf.sem_op = -1;\n-  buf.sem_flg = IPC_NOWAIT;\n+static int uv__custom_sem_trywait(uv_sem_t* sem_) {\n+  uv_semaphore_t* sem;\n \n-  do\n-    op_status = semop(*sem, &buf, 1);\n-  while (op_status == -1 && errno == EINTR);\n+  sem = *(uv_semaphore_t**)sem_;\n+  if (uv_mutex_trylock(&sem->mutex) != 0)\n+    return UV_EAGAIN;\n \n-  if (op_status) {\n-    if (errno == EAGAIN)\n-      return UV_EAGAIN;\n-    abort();\n+  if (sem->value == 0) {\n+    uv_mutex_unlock(&sem->mutex);\n+    return UV_EAGAIN;\n   }\n \n+  sem->value--;\n+  uv_mutex_unlock(&sem->mutex);\n+\n   return 0;\n }\n \n-#else /* !(defined(__APPLE__) && defined(__MACH__)) */\n-\n-int uv_sem_init(uv_sem_t* sem, unsigned int value) {\n+static int uv__sem_init(uv_sem_t* sem, unsigned int value) {\n   if (sem_init(sem, 0, value))\n     return UV__ERR(errno);\n   return 0;\n }\n \n \n-void uv_sem_destroy(uv_sem_t* sem) {\n+static void uv__sem_destroy(uv_sem_t* sem) {\n   if (sem_destroy(sem))\n     abort();\n }\n \n \n-void uv_sem_post(uv_sem_t* sem) {\n+static void uv__sem_post(uv_sem_t* sem) {\n   if (sem_post(sem))\n     abort();\n }\n \n \n-void uv_sem_wait(uv_sem_t* sem) {\n+static void uv__sem_wait(uv_sem_t* sem) {\n   int r;\n \n   do\n@@ -533,7 +573,7 @@ void uv_sem_wait(uv_sem_t* sem) {\n }\n \n \n-int uv_sem_trywait(uv_sem_t* sem) {\n+static int uv__sem_trywait(uv_sem_t* sem) {\n   int r;\n \n   do\n@@ -549,6 +589,49 @@ int uv_sem_trywait(uv_sem_t* sem) {\n   return 0;\n }\n \n+int uv_sem_init(uv_sem_t* sem, unsigned int value) {\n+#ifdef __GLIBC__\n+  uv_once(&glibc_version_check_once, glibc_version_check);\n+#endif\n+\n+  if (platform_needs_custom_semaphore)\n+    return uv__custom_sem_init(sem, value);\n+  else\n+    return uv__sem_init(sem, value);\n+}\n+\n+\n+void uv_sem_destroy(uv_sem_t* sem) {\n+  if (platform_needs_custom_semaphore)\n+    uv__custom_sem_destroy(sem);\n+  else\n+    uv__sem_destroy(sem);\n+}\n+\n+\n+void uv_sem_post(uv_sem_t* sem) {\n+  if (platform_needs_custom_semaphore)\n+    uv__custom_sem_post(sem);\n+  else\n+    uv__sem_post(sem);\n+}\n+\n+\n+void uv_sem_wait(uv_sem_t* sem) {\n+  if (platform_needs_custom_semaphore)\n+    uv__custom_sem_wait(sem);\n+  else\n+    uv__sem_wait(sem);\n+}\n+\n+\n+int uv_sem_trywait(uv_sem_t* sem) {\n+  if (platform_needs_custom_semaphore)\n+    return uv__custom_sem_trywait(sem);\n+  else\n+    return uv__sem_trywait(sem);\n+}\n+\n #endif /* defined(__APPLE__) && defined(__MACH__) */\n \n "
        },
        {
            "sha": "30b87ac51549f0dceaf05be53a1e3b46ae9feabe",
            "filename": "deps/uv/src/win/fs.c",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Fwin%2Ffs.c",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Fwin%2Ffs.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Ffs.c?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -434,8 +434,6 @@ void fs__open(uv_fs_t* req) {\n     access |= FILE_APPEND_DATA;\n   }\n \n-  access |= FILE_WRITE_ATTRIBUTES;\n-\n   /*\n    * Here is where we deviate significantly from what CRT's _open()\n    * does. We indiscriminately use all the sharing modes, to match"
        },
        {
            "sha": "5d1c812dd75b2cfd0f95d0d9e13c061d86ba5439",
            "filename": "deps/uv/src/win/util.c",
            "status": "modified",
            "additions": 23,
            "deletions": 24,
            "changes": 47,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Fwin%2Futil.c",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Fsrc%2Fwin%2Futil.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Fsrc%2Fwin%2Futil.c?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -587,8 +587,8 @@ int uv_uptime(double* uptime) {\n         BYTE* address = (BYTE*) object_type + object_type->DefinitionLength +\n                         counter_definition->CounterOffset;\n         uint64_t value = *((uint64_t*) address);\n-        *uptime = (double) (object_type->PerfTime.QuadPart - value) /\n-                  (double) object_type->PerfFreq.QuadPart;\n+        *uptime = floor((double) (object_type->PerfTime.QuadPart - value) /\n+                        (double) object_type->PerfFreq.QuadPart);\n         uv__free(malloced_buffer);\n         return 0;\n       }\n@@ -615,7 +615,7 @@ int uv_cpu_info(uv_cpu_info_t** cpu_infos_ptr, int* cpu_count_ptr) {\n   SYSTEM_PROCESSOR_PERFORMANCE_INFORMATION* sppi;\n   DWORD sppi_size;\n   SYSTEM_INFO system_info;\n-  DWORD cpu_count, r, i;\n+  DWORD cpu_count, i;\n   NTSTATUS status;\n   ULONG result_size;\n   int err;\n@@ -670,34 +670,33 @@ int uv_cpu_info(uv_cpu_info_t** cpu_infos_ptr, int* cpu_count_ptr) {\n \n     assert(len > 0 && len < ARRAY_SIZE(key_name));\n \n-    r = RegOpenKeyExW(HKEY_LOCAL_MACHINE,\n-                      key_name,\n-                      0,\n-                      KEY_QUERY_VALUE,\n-                      &processor_key);\n-    if (r != ERROR_SUCCESS) {\n-      err = GetLastError();\n+    err = RegOpenKeyExW(HKEY_LOCAL_MACHINE,\n+                        key_name,\n+                        0,\n+                        KEY_QUERY_VALUE,\n+                        &processor_key);\n+    if (err != ERROR_SUCCESS) {\n       goto error;\n     }\n \n-    if (RegQueryValueExW(processor_key,\n-                         L\"~MHz\",\n-                         NULL,\n-                         NULL,\n-                         (BYTE*) &cpu_speed,\n-                         &cpu_speed_size) != ERROR_SUCCESS) {\n-      err = GetLastError();\n+    err = RegQueryValueExW(processor_key,\n+                           L\"~MHz\",\n+                           NULL,\n+                           NULL,\n+                           (BYTE*)&cpu_speed,\n+                           &cpu_speed_size);\n+    if (err != ERROR_SUCCESS) {\n       RegCloseKey(processor_key);\n       goto error;\n     }\n \n-    if (RegQueryValueExW(processor_key,\n-                         L\"ProcessorNameString\",\n-                         NULL,\n-                         NULL,\n-                         (BYTE*) &cpu_brand,\n-                         &cpu_brand_size) != ERROR_SUCCESS) {\n-      err = GetLastError();\n+    err = RegQueryValueExW(processor_key,\n+                           L\"ProcessorNameString\",\n+                           NULL,\n+                           NULL,\n+                           (BYTE*)&cpu_brand,\n+                           &cpu_brand_size);\n+    if (err != ERROR_SUCCESS) {\n       RegCloseKey(processor_key);\n       goto error;\n     }"
        },
        {
            "sha": "000a151a64ee2d99d5557b30a8c2026f22c1537b",
            "filename": "deps/uv/test/test-fs.c",
            "status": "modified",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Ftest%2Ftest-fs.c",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Ftest%2Ftest-fs.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-fs.c?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -1367,28 +1367,6 @@ TEST_IMPL(fs_chmod) {\n \n   check_permission(\"test_file\", 0600);\n \n-#ifdef _WIN32\n-  /* Test clearing read-only flag from files with Archive flag cleared */\n-  /* Make the file read-only and clear archive flag */\n-  r = SetFileAttributes(\"test_file\", FILE_ATTRIBUTE_READONLY);\n-  ASSERT(r != 0);\n-  check_permission(\"test_file\", 0400);\n-\n-  r = uv_fs_open(NULL, &req, \"test_file\", 0, 0, NULL);\n-  ASSERT(r >= 0);\n-  ASSERT(req.result >= 0);\n-  uv_fs_req_cleanup(&req);\n-\n-  r = uv_fs_fchmod(NULL, &req, file, 0600, NULL);\n-  ASSERT(r == 0);\n-  ASSERT(req.result == 0);\n-  uv_fs_req_cleanup(&req);\n-\n-  check_permission(\"test_file\", 0600);\n-  /* Restore Archive flag for rest of the tests */\n-  r = SetFileAttributes(\"test_file\", FILE_ATTRIBUTE_ARCHIVE);\n-  ASSERT(r != 0);\n-#endif\n #ifndef _WIN32\n   /* async chmod */\n   {"
        },
        {
            "sha": "de4932dc1ae370777f5101a1233fd7adec5f49ba",
            "filename": "deps/uv/test/test-pipe-set-fchmod.c",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Ftest%2Ftest-pipe-set-fchmod.c",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Ftest%2Ftest-pipe-set-fchmod.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-pipe-set-fchmod.c?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -27,6 +27,9 @@ TEST_IMPL(pipe_set_chmod) {\n   uv_pipe_t pipe_handle;\n   uv_loop_t* loop;\n   int r;\n+#ifndef _WIN32\n+  struct stat stat_buf;\n+#endif\n \n   loop = uv_default_loop();\n \n@@ -44,12 +47,33 @@ TEST_IMPL(pipe_set_chmod) {\n     RETURN_SKIP(\"Insufficient privileges to alter pipe fmode\");\n   }\n   ASSERT(r == 0);\n+#ifndef _WIN32\n+  stat(TEST_PIPENAME, &stat_buf);\n+  ASSERT(stat_buf.st_mode & S_IRUSR);\n+  ASSERT(stat_buf.st_mode & S_IRGRP);\n+  ASSERT(stat_buf.st_mode & S_IROTH);\n+#endif\n \n   r = uv_pipe_chmod(&pipe_handle, UV_WRITABLE);\n   ASSERT(r == 0);\n+#ifndef _WIN32\n+  stat(TEST_PIPENAME, &stat_buf);\n+  ASSERT(stat_buf.st_mode & S_IWUSR);\n+  ASSERT(stat_buf.st_mode & S_IWGRP);\n+  ASSERT(stat_buf.st_mode & S_IWOTH);\n+#endif\n \n   r = uv_pipe_chmod(&pipe_handle, UV_WRITABLE | UV_READABLE);\n   ASSERT(r == 0);\n+#ifndef _WIN32\n+  stat(TEST_PIPENAME, &stat_buf);\n+  ASSERT(stat_buf.st_mode & S_IRUSR);\n+  ASSERT(stat_buf.st_mode & S_IRGRP);\n+  ASSERT(stat_buf.st_mode & S_IROTH);\n+  ASSERT(stat_buf.st_mode & S_IWUSR);\n+  ASSERT(stat_buf.st_mode & S_IWGRP);\n+  ASSERT(stat_buf.st_mode & S_IWOTH);\n+#endif\n \n   r = uv_pipe_chmod(NULL, UV_WRITABLE | UV_READABLE);\n   ASSERT(r == UV_EBADF);"
        },
        {
            "sha": "9d4db2bc4fedf09beb6f9dd628cfff766a37a2dd",
            "filename": "deps/uv/test/test-udp-ipv6.c",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Ftest%2Ftest-udp-ipv6.c",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Ftest%2Ftest-udp-ipv6.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-udp-ipv6.c?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -174,6 +174,8 @@ TEST_IMPL(udp_dual_stack) {\n #if defined(__FreeBSD__) || defined(__FreeBSD_kernel__) || defined(__NetBSD__)\n   if (!can_ipv6_ipv4_dual())\n     RETURN_SKIP(\"IPv6-IPv4 dual stack not supported\");\n+#elif defined(__OpenBSD__)\n+  RETURN_SKIP(\"IPv6-IPv4 dual stack not supported\");\n #endif\n \n   do_test(ipv6_recv_ok, 0);"
        },
        {
            "sha": "cf316e107a04059699a10175c99b8fa3c528d917",
            "filename": "deps/uv/test/test-udp-multicast-join6.c",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Ftest%2Ftest-udp-multicast-join6.c",
            "raw_url": "https://github.com/nodejs/node/raw/63d991b7cf229a713d0d72b51dcb7b52691d7d65/deps%2Fuv%2Ftest%2Ftest-udp-multicast-join6.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fuv%2Ftest%2Ftest-udp-multicast-join6.c?ref=63d991b7cf229a713d0d72b51dcb7b52691d7d65",
            "patch": "@@ -123,7 +123,8 @@ TEST_IMPL(udp_multicast_join6) {\n     defined(_AIX)               || \\\n     defined(__MVS__)            || \\\n     defined(__FreeBSD_kernel__) || \\\n-    defined(__NetBSD__)\n+    defined(__NetBSD__)         || \\\n+    defined(__OpenBSD__)\n   r = uv_udp_set_membership(&client, \"ff02::1\", \"::1%lo0\", UV_JOIN_GROUP);\n #else\n   r = uv_udp_set_membership(&client, \"ff02::1\", NULL, UV_JOIN_GROUP);"
        }
    ],
    "stats": {
        "total": 397,
        "additions": 268,
        "deletions": 129
    }
}