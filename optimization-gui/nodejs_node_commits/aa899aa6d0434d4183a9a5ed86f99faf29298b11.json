{
    "author": "cjihrig",
    "message": "cluster: use Map to track indexes\n\nPR-URL: https://github.com/nodejs/node/pull/23125\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>",
    "sha": "aa899aa6d0434d4183a9a5ed86f99faf29298b11",
    "files": [
        {
            "sha": "05cb6d25e81a9d6b2a0654d8e3bbb55380696b64",
            "filename": "lib/internal/cluster/child.js",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/aa899aa6d0434d4183a9a5ed86f99faf29298b11/lib%2Finternal%2Fcluster%2Fchild.js",
            "raw_url": "https://github.com/nodejs/node/raw/aa899aa6d0434d4183a9a5ed86f99faf29298b11/lib%2Finternal%2Fcluster%2Fchild.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcluster%2Fchild.js?ref=aa899aa6d0434d4183a9a5ed86f99faf29298b11",
            "patch": "@@ -8,7 +8,7 @@ const Worker = require('internal/cluster/worker');\n const { internal, sendHelper } = require('internal/cluster/utils');\n const cluster = new EventEmitter();\n const handles = {};\n-const indexes = {};\n+const indexes = new Map();\n const noop = () => {};\n \n module.exports = cluster;\n@@ -62,14 +62,18 @@ cluster._getServer = function(obj, options, cb) {\n                       options.addressType,\n                       options.fd ].join(':');\n \n-  if (indexes[indexesKey] === undefined)\n-    indexes[indexesKey] = 0;\n+  let index = indexes.get(indexesKey);\n+\n+  if (index === undefined)\n+    index = 0;\n   else\n-    indexes[indexesKey]++;\n+    index++;\n+\n+  indexes.set(indexesKey, index);\n \n   const message = util._extend({\n     act: 'queryServer',\n-    index: indexes[indexesKey],\n+    index,\n     data: null\n   }, options);\n \n@@ -108,7 +112,7 @@ function shared(message, handle, indexesKey, cb) {\n   handle.close = function() {\n     send({ act: 'close', key });\n     delete handles[key];\n-    delete indexes[indexesKey];\n+    indexes.delete(indexesKey);\n     return close.apply(this, arguments);\n   }.bind(handle);\n   assert(handles[key] === undefined);\n@@ -141,7 +145,7 @@ function rr(message, indexesKey, cb) {\n \n     send({ act: 'close', key });\n     delete handles[key];\n-    delete indexes[indexesKey];\n+    indexes.delete(indexesKey);\n     key = undefined;\n   }\n "
        }
    ],
    "stats": {
        "total": 18,
        "additions": 11,
        "deletions": 7
    }
}