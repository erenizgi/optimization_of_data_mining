{
    "author": "jasnell",
    "message": "stream: move process.binding('stream_wrap') to internalBinding\n\nPR-URL: https://github.com/nodejs/node/pull/22345\nRefs: https://github.com/nodejs/node/issues/22160\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "884b23daf723db60ebe939e6dde492fa5f9230eb",
    "files": [
        {
            "sha": "d6666011d5601d1564638748516932a10dfe984b",
            "filename": "benchmark/net/tcp-raw-c2s.js",
            "status": "modified",
            "additions": 57,
            "deletions": 57,
            "changes": 114,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/benchmark%2Fnet%2Ftcp-raw-c2s.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/benchmark%2Fnet%2Ftcp-raw-c2s.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fnet%2Ftcp-raw-c2s.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -12,14 +12,15 @@ const bench = common.createBenchmark(main, {\n   len: [102400, 1024 * 1024 * 16],\n   type: ['utf', 'asc', 'buf'],\n   dur: [5]\n-});\n-\n-const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n-const TCPConnectWrap = process.binding('tcp_wrap').TCPConnectWrap;\n-const WriteWrap = process.binding('stream_wrap').WriteWrap;\n-const PORT = common.PORT;\n+}, { flags: [ '--expose-internals', '--no-warnings' ] });\n \n function main({ dur, len, type }) {\n+  const { internalBinding } = require('internal/test/binding');\n+  const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n+  const { TCPConnectWrap } = process.binding('tcp_wrap');\n+  const { WriteWrap } = internalBinding('stream_wrap');\n+  const PORT = common.PORT;\n+\n   const serverHandle = new TCP(TCPConstants.SERVER);\n   var err = serverHandle.bind('127.0.0.1', PORT);\n   if (err)\n@@ -58,71 +59,70 @@ function main({ dur, len, type }) {\n   };\n \n   client(type, len);\n-}\n-\n \n-function fail(err, syscall) {\n-  throw util._errnoException(err, syscall);\n-}\n-\n-function client(type, len) {\n-  var chunk;\n-  switch (type) {\n-    case 'buf':\n-      chunk = Buffer.alloc(len, 'x');\n-      break;\n-    case 'utf':\n-      chunk = 'ü'.repeat(len / 2);\n-      break;\n-    case 'asc':\n-      chunk = 'x'.repeat(len);\n-      break;\n-    default:\n-      throw new Error(`invalid type: ${type}`);\n+  function fail(err, syscall) {\n+    throw util._errnoException(err, syscall);\n   }\n \n-  const clientHandle = new TCP(TCPConstants.SOCKET);\n-  const connectReq = new TCPConnectWrap();\n-  const err = clientHandle.connect(connectReq, '127.0.0.1', PORT);\n-\n-  if (err)\n-    fail(err, 'connect');\n-\n-  clientHandle.readStart();\n-\n-  connectReq.oncomplete = function(err) {\n-    if (err)\n-      fail(err, 'connect');\n-\n-    while (clientHandle.writeQueueSize === 0)\n-      write();\n-  };\n-\n-  function write() {\n-    const writeReq = new WriteWrap();\n-    writeReq.oncomplete = afterWrite;\n-    var err;\n+  function client(type, len) {\n+    var chunk;\n     switch (type) {\n       case 'buf':\n-        err = clientHandle.writeBuffer(writeReq, chunk);\n+        chunk = Buffer.alloc(len, 'x');\n         break;\n       case 'utf':\n-        err = clientHandle.writeUtf8String(writeReq, chunk);\n+        chunk = 'ü'.repeat(len / 2);\n         break;\n       case 'asc':\n-        err = clientHandle.writeAsciiString(writeReq, chunk);\n+        chunk = 'x'.repeat(len);\n         break;\n+      default:\n+        throw new Error(`invalid type: ${type}`);\n     }\n \n-    if (err)\n-      fail(err, 'write');\n-  }\n+    const clientHandle = new TCP(TCPConstants.SOCKET);\n+    const connectReq = new TCPConnectWrap();\n+    const err = clientHandle.connect(connectReq, '127.0.0.1', PORT);\n \n-  function afterWrite(err, handle) {\n     if (err)\n-      fail(err, 'write');\n+      fail(err, 'connect');\n+\n+    clientHandle.readStart();\n+\n+    connectReq.oncomplete = function(err) {\n+      if (err)\n+        fail(err, 'connect');\n \n-    while (clientHandle.writeQueueSize === 0)\n-      write();\n+      while (clientHandle.writeQueueSize === 0)\n+        write();\n+    };\n+\n+    function write() {\n+      const writeReq = new WriteWrap();\n+      writeReq.oncomplete = afterWrite;\n+      var err;\n+      switch (type) {\n+        case 'buf':\n+          err = clientHandle.writeBuffer(writeReq, chunk);\n+          break;\n+        case 'utf':\n+          err = clientHandle.writeUtf8String(writeReq, chunk);\n+          break;\n+        case 'asc':\n+          err = clientHandle.writeAsciiString(writeReq, chunk);\n+          break;\n+      }\n+\n+      if (err)\n+        fail(err, 'write');\n+    }\n+\n+    function afterWrite(err, handle) {\n+      if (err)\n+        fail(err, 'write');\n+\n+      while (clientHandle.writeQueueSize === 0)\n+        write();\n+    }\n   }\n }"
        },
        {
            "sha": "8203abca6e92b9e1b8755efd4d34fc9186ab89cd",
            "filename": "benchmark/net/tcp-raw-pipe.js",
            "status": "modified",
            "additions": 12,
            "deletions": 9,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/benchmark%2Fnet%2Ftcp-raw-pipe.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/benchmark%2Fnet%2Ftcp-raw-pipe.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fnet%2Ftcp-raw-pipe.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -12,18 +12,21 @@ const bench = common.createBenchmark(main, {\n   len: [102400, 1024 * 1024 * 16],\n   type: ['utf', 'asc', 'buf'],\n   dur: [5]\n+}, {\n+  flags: [ '--expose-internals', '--no-warnings' ]\n });\n \n-function fail(err, syscall) {\n-  throw util._errnoException(err, syscall);\n-}\n-\n-const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n-const TCPConnectWrap = process.binding('tcp_wrap').TCPConnectWrap;\n-const WriteWrap = process.binding('stream_wrap').WriteWrap;\n-const PORT = common.PORT;\n-\n function main({ dur, len, type }) {\n+  const { internalBinding } = require('internal/test/binding');\n+  const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n+  const { TCPConnectWrap } = process.binding('tcp_wrap');\n+  const { WriteWrap } = internalBinding('stream_wrap');\n+  const PORT = common.PORT;\n+\n+  function fail(err, syscall) {\n+    throw util._errnoException(err, syscall);\n+  }\n+\n   // Server\n   const serverHandle = new TCP(TCPConstants.SERVER);\n   var err = serverHandle.bind('127.0.0.1', PORT);"
        },
        {
            "sha": "1e42b311ad7b2a04747b2f3cf9f14f85177d78ba",
            "filename": "benchmark/net/tcp-raw-s2c.js",
            "status": "modified",
            "additions": 42,
            "deletions": 39,
            "changes": 81,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/benchmark%2Fnet%2Ftcp-raw-s2c.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/benchmark%2Fnet%2Ftcp-raw-s2c.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fnet%2Ftcp-raw-s2c.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -12,14 +12,17 @@ const bench = common.createBenchmark(main, {\n   len: [102400, 1024 * 1024 * 16],\n   type: ['utf', 'asc', 'buf'],\n   dur: [5]\n+}, {\n+  flags: [ '--expose-internals', '--no-warnings' ]\n });\n \n-const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n-const TCPConnectWrap = process.binding('tcp_wrap').TCPConnectWrap;\n-const WriteWrap = process.binding('stream_wrap').WriteWrap;\n-const PORT = common.PORT;\n-\n function main({ dur, len, type }) {\n+  const { internalBinding } = require('internal/test/binding');\n+  const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n+  const { TCPConnectWrap } = process.binding('tcp_wrap');\n+  const { WriteWrap } = internalBinding('stream_wrap');\n+  const PORT = common.PORT;\n+\n   const serverHandle = new TCP(TCPConstants.SERVER);\n   var err = serverHandle.bind('127.0.0.1', PORT);\n   if (err)\n@@ -89,42 +92,42 @@ function main({ dur, len, type }) {\n   };\n \n   client(dur);\n-}\n \n-function fail(err, syscall) {\n-  throw util._errnoException(err, syscall);\n-}\n+  function fail(err, syscall) {\n+    throw util._errnoException(err, syscall);\n+  }\n \n-function client(dur) {\n-  const clientHandle = new TCP(TCPConstants.SOCKET);\n-  const connectReq = new TCPConnectWrap();\n-  const err = clientHandle.connect(connectReq, '127.0.0.1', PORT);\n-\n-  if (err)\n-    fail(err, 'connect');\n-\n-  connectReq.oncomplete = function() {\n-    var bytes = 0;\n-    clientHandle.onread = function(nread, buffer) {\n-      // we're not expecting to ever get an EOF from the client.\n-      // just lots of data forever.\n-      if (nread < 0)\n-        fail(nread, 'read');\n-\n-      // don't slice the buffer.  the point of this is to isolate, not\n-      // simulate real traffic.\n-      bytes += buffer.length;\n-    };\n+  function client(dur) {\n+    const clientHandle = new TCP(TCPConstants.SOCKET);\n+    const connectReq = new TCPConnectWrap();\n+    const err = clientHandle.connect(connectReq, '127.0.0.1', PORT);\n \n-    clientHandle.readStart();\n-\n-    // the meat of the benchmark is right here:\n-    bench.start();\n+    if (err)\n+      fail(err, 'connect');\n \n-    setTimeout(function() {\n-      // report in Gb/sec\n-      bench.end((bytes * 8) / (1024 * 1024 * 1024));\n-      process.exit(0);\n-    }, dur * 1000);\n-  };\n+    connectReq.oncomplete = function() {\n+      var bytes = 0;\n+      clientHandle.onread = function(nread, buffer) {\n+        // we're not expecting to ever get an EOF from the client.\n+        // just lots of data forever.\n+        if (nread < 0)\n+          fail(nread, 'read');\n+\n+        // don't slice the buffer.  the point of this is to isolate, not\n+        // simulate real traffic.\n+        bytes += buffer.length;\n+      };\n+\n+      clientHandle.readStart();\n+\n+      // the meat of the benchmark is right here:\n+      bench.start();\n+\n+      setTimeout(function() {\n+        // report in Gb/sec\n+        bench.end((bytes * 8) / (1024 * 1024 * 1024));\n+        process.exit(0);\n+      }, dur * 1000);\n+    };\n+  }\n }"
        },
        {
            "sha": "661b1eb3803be6f876e0455f0aa3781faeda4b10",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -344,7 +344,12 @@\n     // that are whitelisted for access via process.binding()... this is used\n     // to provide a transition path for modules that are being moved over to\n     // internalBinding.\n-    const internalBindingWhitelist = new SafeSet(['uv', 'http_parser', 'v8']);\n+    const internalBindingWhitelist =\n+      new SafeSet([\n+        'uv',\n+        'http_parser',\n+        'v8',\n+        'stream_wrap']);\n     process.binding = function binding(name) {\n       return internalBindingWhitelist.has(name) ?\n         internalBinding(name) :"
        },
        {
            "sha": "cf7e23bf7a924818457b541ab8a0d7a5f1fab8d0",
            "filename": "lib/internal/child_process.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Finternal%2Fchild_process.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Finternal%2Fchild_process.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fchild_process.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -24,7 +24,7 @@ const assert = require('assert');\n const { internalBinding } = require('internal/bootstrap/loaders');\n \n const { Process } = process.binding('process_wrap');\n-const { WriteWrap } = process.binding('stream_wrap');\n+const { WriteWrap } = internalBinding('stream_wrap');\n const { Pipe, constants: PipeConstants } = process.binding('pipe_wrap');\n const { TTY } = process.binding('tty_wrap');\n const { TCP } = process.binding('tcp_wrap');"
        },
        {
            "sha": "c0c452a35f175fb4b83452a92e81c1b954878962",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -115,7 +115,7 @@ const { isArrayBufferView } = require('internal/util/types');\n \n const { FileHandle } = process.binding('fs');\n const binding = internalBinding('http2');\n-const { ShutdownWrap } = process.binding('stream_wrap');\n+const { ShutdownWrap } = internalBinding('stream_wrap');\n const { UV_EOF } = internalBinding('uv');\n \n const { StreamPipe } = internalBinding('stream_pipe');"
        },
        {
            "sha": "9bd2dd90bc119ee681bfcf885845ec3adf386bff",
            "filename": "lib/internal/stream_base_commons.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Finternal%2Fstream_base_commons.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Finternal%2Fstream_base_commons.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fstream_base_commons.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -2,7 +2,8 @@\n \n const { Buffer } = require('buffer');\n const errors = require('internal/errors');\n-const { WriteWrap } = process.binding('stream_wrap');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { WriteWrap } = internalBinding('stream_wrap');\n \n const errnoException = errors.errnoException;\n "
        },
        {
            "sha": "428675173f3e3e3eb476684c60f0007a991d69f7",
            "filename": "lib/net.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/lib%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fnet.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -43,7 +43,7 @@ const {\n \n const { Buffer } = require('buffer');\n const TTYWrap = process.binding('tty_wrap');\n-const { ShutdownWrap } = process.binding('stream_wrap');\n+const { ShutdownWrap } = internalBinding('stream_wrap');\n const {\n   TCP,\n   TCPConnectWrap,"
        },
        {
            "sha": "59f7eb9503f4b00d6c6287d81dde797f26fd4544",
            "filename": "src/stream_wrap.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/src%2Fstream_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/src%2Fstream_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_wrap.cc?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -374,5 +374,5 @@ void LibuvStreamWrap::AfterUvWrite(uv_write_t* req, int status) {\n \n }  // namespace node\n \n-NODE_BUILTIN_MODULE_CONTEXT_AWARE(stream_wrap,\n-                                  node::LibuvStreamWrap::Initialize)\n+NODE_MODULE_CONTEXT_AWARE_INTERNAL(stream_wrap,\n+                                   node::LibuvStreamWrap::Initialize)"
        },
        {
            "sha": "9c8cca25035031319aef0bdf1bde87d7b11ef210",
            "filename": "test/parallel/test-process-binding-internalbinding-whitelist.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-process-binding-internalbinding-whitelist.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-process-binding-internalbinding-whitelist.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-binding-internalbinding-whitelist.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -9,3 +9,4 @@ const assert = require('assert');\n assert(process.binding('uv'));\n assert(process.binding('http_parser'));\n assert(process.binding('v8'));\n+assert(process.binding('stream_wrap'));"
        },
        {
            "sha": "9a279790d8acebc6d8089660393dff8c7b3ca134",
            "filename": "test/parallel/test-stream-wrap.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-stream-wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-stream-wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-wrap.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -1,10 +1,12 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n \n+const { internalBinding } = require('internal/test/binding');\n const StreamWrap = require('_stream_wrap');\n-const Duplex = require('stream').Duplex;\n-const ShutdownWrap = process.binding('stream_wrap').ShutdownWrap;\n+const { Duplex } = require('stream');\n+const { ShutdownWrap } = internalBinding('stream_wrap');\n \n function testShutdown(callback) {\n   const stream = new Duplex({"
        },
        {
            "sha": "a903307e5b6ccab305bc3ea8ff9097f95adde45f",
            "filename": "test/parallel/test-tcp-wrap-connect.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-tcp-wrap-connect.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-tcp-wrap-connect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tcp-wrap-connect.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -1,9 +1,11 @@\n+// Flags: --expose-internals\n 'use strict';\n require('../common');\n const assert = require('assert');\n+const { internalBinding } = require('internal/test/binding');\n const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n-const TCPConnectWrap = process.binding('tcp_wrap').TCPConnectWrap;\n-const ShutdownWrap = process.binding('stream_wrap').ShutdownWrap;\n+const { TCPConnectWrap } = process.binding('tcp_wrap');\n+const { ShutdownWrap } = internalBinding('stream_wrap');\n \n function makeConnection() {\n   const client = new TCP(TCPConstants.SOCKET);"
        },
        {
            "sha": "7df5a11ff1861e893a27a78ffd067341c57ba4fe",
            "filename": "test/parallel/test-tcp-wrap-listen.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-tcp-wrap-listen.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-tcp-wrap-listen.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tcp-wrap-listen.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -1,9 +1,11 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n \n+const { internalBinding } = require('internal/test/binding');\n const { TCP, constants: TCPConstants } = process.binding('tcp_wrap');\n-const WriteWrap = process.binding('stream_wrap').WriteWrap;\n+const { WriteWrap } = internalBinding('stream_wrap');\n \n const server = new TCP(TCPConstants.SOCKET);\n "
        },
        {
            "sha": "808727b12739b27aed01a17787add5e4575bbe3a",
            "filename": "test/parallel/test-tls-close-notify.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-tls-close-notify.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fparallel%2Ftest-tls-close-notify.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-close-notify.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -19,15 +19,17 @@\n // OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n // USE OR OTHER DEALINGS IN THE SOFTWARE.\n \n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n \n if (!common.hasCrypto)\n   common.skip('missing crypto');\n \n+const { internalBinding } = require('internal/test/binding');\n const tls = require('tls');\n const fixtures = require('../common/fixtures');\n-const { ShutdownWrap } = process.binding('stream_wrap');\n+const { ShutdownWrap } = internalBinding('stream_wrap');\n \n const server = tls.createServer({\n   key: fixtures.readKey('agent1-key.pem'),"
        },
        {
            "sha": "cb961d04033b6b1fb88b56a79f051cff38b70e03",
            "filename": "test/pseudo-tty/test-tty-wrap.js",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fpseudo-tty%2Ftest-tty-wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fpseudo-tty%2Ftest-tty-wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpseudo-tty%2Ftest-tty-wrap.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -1,8 +1,10 @@\n+// Flags: --expose-internals --no-warnings\n 'use strict';\n require('../common');\n \n-const TTY = process.binding('tty_wrap').TTY;\n-const WriteWrap = process.binding('stream_wrap').WriteWrap;\n+const { internalBinding } = require('internal/test/binding');\n+const { TTY } = process.binding('tty_wrap');\n+const { WriteWrap } = internalBinding('stream_wrap');\n \n const handle = new TTY(1);\n const req = new WriteWrap();"
        },
        {
            "sha": "917f84bd8211506e52467a005340081cc1c3cf29",
            "filename": "test/sequential/test-async-wrap-getasyncid.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "raw_url": "https://github.com/nodejs/node/raw/884b23daf723db60ebe939e6dde492fa5f9230eb/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-async-wrap-getasyncid.js?ref=884b23daf723db60ebe939e6dde492fa5f9230eb",
            "patch": "@@ -201,12 +201,12 @@ if (common.hasCrypto) { // eslint-disable-line node-core/crypto-check\n }\n \n {\n-  const binding = process.binding('stream_wrap');\n+  const binding = internalBinding('stream_wrap');\n   testUninitialized(new binding.WriteWrap(), 'WriteWrap');\n }\n \n {\n-  const stream_wrap = process.binding('stream_wrap');\n+  const stream_wrap = internalBinding('stream_wrap');\n   const tcp_wrap = process.binding('tcp_wrap');\n   const server = net.createServer(common.mustCall((socket) => {\n     server.close();"
        }
    ],
    "stats": {
        "total": 267,
        "additions": 145,
        "deletions": 122
    }
}