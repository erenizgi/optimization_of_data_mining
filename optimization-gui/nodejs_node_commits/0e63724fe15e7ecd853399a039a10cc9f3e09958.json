{
    "author": "tniessen",
    "message": "crypto: use new OpenSSL constants in CipherBase\n\nThis change replaces some constants with better alternatives which were\nunavailable in OpenSSL 1.0.2.\n\nPR-URL: https://github.com/nodejs/node/pull/20339\nRefs: https://github.com/nodejs/node/pull/19794\nRefs: https://github.com/nodejs/node/pull/18138\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "0e63724fe15e7ecd853399a039a10cc9f3e09958",
    "files": [
        {
            "sha": "20a9e2ec4e13337ea1cf3a2c3c87c0e982179e44",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 8,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/0e63724fe15e7ecd853399a039a10cc9f3e09958/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/0e63724fe15e7ecd853399a039a10cc9f3e09958/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=0e63724fe15e7ecd853399a039a10cc9f3e09958",
            "patch": "@@ -2809,10 +2809,7 @@ bool CipherBase::InitAuthenticated(const char *cipher_type, int iv_len,\n                                    unsigned int auth_tag_len) {\n   CHECK(IsAuthenticatedMode());\n \n-  // TODO(tniessen) Use EVP_CTRL_AEAD_SET_IVLEN when migrating to OpenSSL 1.1.0\n-  static_assert(EVP_CTRL_CCM_SET_IVLEN == EVP_CTRL_GCM_SET_IVLEN,\n-                \"OpenSSL constants differ between GCM and CCM\");\n-  if (!EVP_CIPHER_CTX_ctrl(ctx_, EVP_CTRL_GCM_SET_IVLEN, iv_len, nullptr)) {\n+  if (!EVP_CIPHER_CTX_ctrl(ctx_, EVP_CTRL_AEAD_SET_IVLEN, iv_len, nullptr)) {\n     env()->ThrowError(\"Invalid IV length\");\n     return false;\n   }\n@@ -3122,10 +3119,8 @@ bool CipherBase::Final(unsigned char** out, int *out_len) {\n       // be given by the user.\n       if (mode == EVP_CIPH_GCM_MODE && auth_tag_len_ == kNoAuthTagLength)\n         auth_tag_len_ = sizeof(auth_tag_);\n-      // TOOD(tniessen) Use EVP_CTRL_AEAP_GET_TAG in OpenSSL 1.1.0\n-      static_assert(EVP_CTRL_CCM_GET_TAG == EVP_CTRL_GCM_GET_TAG,\n-                    \"OpenSSL constants differ between GCM and CCM\");\n-      CHECK_EQ(1, EVP_CIPHER_CTX_ctrl(ctx_, EVP_CTRL_GCM_GET_TAG, auth_tag_len_,\n+      CHECK_EQ(1, EVP_CIPHER_CTX_ctrl(ctx_, EVP_CTRL_AEAD_GET_TAG,\n+                      auth_tag_len_,\n                       reinterpret_cast<unsigned char*>(auth_tag_)));\n     }\n   }"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 3,
        "deletions": 8
    }
}