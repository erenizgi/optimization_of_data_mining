{
    "author": "apapirovski",
    "message": "events: optimize condition for optimal scenario\n\nInstead of always checking whether we've already warned about a\npossible EventEmitter memory leak, first run the rest of the\ncode as accessing random properties on an Array is expensive.\n\nIn addition, remove an unnecessary truthy check.\n\nPR-URL: https://github.com/nodejs/node/pull/20452\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>",
    "sha": "fe8794560a22cc62a482bf071e2050ce1ea6ea3e",
    "files": [
        {
            "sha": "54e680f74ae3e1a31d388636df828d3ef037bc91",
            "filename": "benchmark/events/ee-add-remove.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/fe8794560a22cc62a482bf071e2050ce1ea6ea3e/benchmark%2Fevents%2Fee-add-remove.js",
            "raw_url": "https://github.com/nodejs/node/raw/fe8794560a22cc62a482bf071e2050ce1ea6ea3e/benchmark%2Fevents%2Fee-add-remove.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fevents%2Fee-add-remove.js?ref=fe8794560a22cc62a482bf071e2050ce1ea6ea3e",
            "patch": "@@ -2,7 +2,7 @@\n const common = require('../common.js');\n const events = require('events');\n \n-const bench = common.createBenchmark(main, { n: [25e4] });\n+const bench = common.createBenchmark(main, { n: [1e6] });\n \n function main({ n }) {\n   const ee = new events.EventEmitter();"
        },
        {
            "sha": "ff1648d6aa13e72a4dc51195d33bac1eb751d76a",
            "filename": "lib/events.js",
            "status": "modified",
            "additions": 14,
            "deletions": 16,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/fe8794560a22cc62a482bf071e2050ce1ea6ea3e/lib%2Fevents.js",
            "raw_url": "https://github.com/nodejs/node/raw/fe8794560a22cc62a482bf071e2050ce1ea6ea3e/lib%2Fevents.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fevents.js?ref=fe8794560a22cc62a482bf071e2050ce1ea6ea3e",
            "patch": "@@ -235,22 +235,20 @@ function _addListener(target, type, listener, prepend) {\n     }\n \n     // Check for listener leak\n-    if (!existing.warned) {\n-      m = $getMaxListeners(target);\n-      if (m && m > 0 && existing.length > m) {\n-        existing.warned = true;\n-        // No error code for this since it is a Warning\n-        // eslint-disable-next-line no-restricted-syntax\n-        const w = new Error('Possible EventEmitter memory leak detected. ' +\n-                            `${existing.length} ${String(type)} listeners ` +\n-                            'added. Use emitter.setMaxListeners() to ' +\n-                            'increase limit');\n-        w.name = 'MaxListenersExceededWarning';\n-        w.emitter = target;\n-        w.type = type;\n-        w.count = existing.length;\n-        process.emitWarning(w);\n-      }\n+    m = $getMaxListeners(target);\n+    if (m > 0 && existing.length > m && !existing.warned) {\n+      existing.warned = true;\n+      // No error code for this since it is a Warning\n+      // eslint-disable-next-line no-restricted-syntax\n+      const w = new Error('Possible EventEmitter memory leak detected. ' +\n+                          `${existing.length} ${String(type)} listeners ` +\n+                          'added. Use emitter.setMaxListeners() to ' +\n+                          'increase limit');\n+      w.name = 'MaxListenersExceededWarning';\n+      w.emitter = target;\n+      w.type = type;\n+      w.count = existing.length;\n+      process.emitWarning(w);\n     }\n   }\n "
        }
    ],
    "stats": {
        "total": 32,
        "additions": 15,
        "deletions": 17
    }
}