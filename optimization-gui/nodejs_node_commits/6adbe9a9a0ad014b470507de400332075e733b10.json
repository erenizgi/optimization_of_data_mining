{
    "author": "refack",
    "message": "Revert \"src: enable detailed source positions in V8\"\n\nThis reverts commit e2a8e3221b2580c44579c738c12d00fb37298f4a.\nThis reverts commit 715bbb9d04a320b4c1a234e1f9d878c116beb3f4.\n\nPR-URL: https://github.com/nodejs/node/pull/24394\nFixes: https://github.com/nodejs/node/issues/24393\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Ujjwal Sharma <usharma1998@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "6adbe9a9a0ad014b470507de400332075e733b10",
    "files": [
        {
            "sha": "9981061a44bf0647fca1273f6ac0f1f625ff0e86",
            "filename": "deps/v8/include/v8-profiler.h",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Finclude%2Fv8-profiler.h",
            "raw_url": "https://github.com/nodejs/node/raw/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Finclude%2Fv8-profiler.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8-profiler.h?ref=6adbe9a9a0ad014b470507de400332075e733b10",
            "patch": "@@ -341,12 +341,6 @@ class V8_EXPORT CpuProfiler {\n   V8_DEPRECATED(\"Use Isolate::SetIdle(bool) instead.\",\n                 void SetIdle(bool is_idle));\n \n-  /**\n-   * Generate more detailed source positions to code objects. This results in\n-   * better results when mapping profiling samples to script source.\n-   */\n-  static void UseDetailedSourcePositionsForProfiling(Isolate* isolate);\n-\n  private:\n   CpuProfiler();\n   ~CpuProfiler();"
        },
        {
            "sha": "c1afe8d93b9d0dc3b201bb51f05266c9b6fcbcd6",
            "filename": "deps/v8/src/api.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Fsrc%2Fapi.cc",
            "raw_url": "https://github.com/nodejs/node/raw/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Fsrc%2Fapi.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fapi.cc?ref=6adbe9a9a0ad014b470507de400332075e733b10",
            "patch": "@@ -10132,11 +10132,6 @@ void CpuProfiler::SetIdle(bool is_idle) {\n   isolate->SetIdle(is_idle);\n }\n \n-void CpuProfiler::UseDetailedSourcePositionsForProfiling(Isolate* isolate) {\n-  reinterpret_cast<i::Isolate*>(isolate)\n-      ->set_detailed_source_positions_for_profiling(true);\n-}\n-\n uintptr_t CodeEvent::GetCodeStartAddress() {\n   return reinterpret_cast<i::CodeEvent*>(this)->code_start_address;\n }"
        },
        {
            "sha": "89fecce80431c51d9911b1d847108fa345b3b9c0",
            "filename": "deps/v8/src/isolate.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Fsrc%2Fisolate.cc",
            "raw_url": "https://github.com/nodejs/node/raw/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Fsrc%2Fisolate.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fisolate.cc?ref=6adbe9a9a0ad014b470507de400332075e733b10",
            "patch": "@@ -3257,8 +3257,7 @@ bool Isolate::use_optimizer() {\n }\n \n bool Isolate::NeedsDetailedOptimizedCodeLineInfo() const {\n-  return NeedsSourcePositionsForProfiling() ||\n-         detailed_source_positions_for_profiling();\n+  return NeedsSourcePositionsForProfiling() || FLAG_detailed_line_info;\n }\n \n bool Isolate::NeedsSourcePositionsForProfiling() const {"
        },
        {
            "sha": "e199a93ec47859043483cae51b505ad0e7f981c1",
            "filename": "deps/v8/src/isolate.h",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Fsrc%2Fisolate.h",
            "raw_url": "https://github.com/nodejs/node/raw/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Fsrc%2Fisolate.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fisolate.h?ref=6adbe9a9a0ad014b470507de400332075e733b10",
            "patch": "@@ -553,8 +553,7 @@ typedef std::vector<HeapObject*> DebugObjectCache;\n   V(int, last_console_context_id, 0)                                          \\\n   V(v8_inspector::V8Inspector*, inspector, nullptr)                           \\\n   V(bool, next_v8_call_is_safe_for_termination, false)                        \\\n-  V(bool, only_terminate_in_safe_scope, false)                                \\\n-  V(bool, detailed_source_positions_for_profiling, FLAG_detailed_line_info)\n+  V(bool, only_terminate_in_safe_scope, false)\n \n #define THREAD_LOCAL_TOP_ACCESSOR(type, name)                        \\\n   inline void set_##name(type v) { thread_local_top_.name##_ = v; }  \\"
        },
        {
            "sha": "75af3f6d98f127836d4fe005f8991e79055fbfe4",
            "filename": "deps/v8/test/cctest/test-cpu-profiler.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 41,
            "changes": 41,
            "blob_url": "https://github.com/nodejs/node/blob/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Ftest%2Fcctest%2Ftest-cpu-profiler.cc",
            "raw_url": "https://github.com/nodejs/node/raw/6adbe9a9a0ad014b470507de400332075e733b10/deps%2Fv8%2Ftest%2Fcctest%2Ftest-cpu-profiler.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Ftest-cpu-profiler.cc?ref=6adbe9a9a0ad014b470507de400332075e733b10",
            "patch": "@@ -40,7 +40,6 @@\n #include \"src/objects-inl.h\"\n #include \"src/profiler/cpu-profiler-inl.h\"\n #include \"src/profiler/profiler-listener.h\"\n-#include \"src/source-position-table.h\"\n #include \"src/utils.h\"\n #include \"test/cctest/cctest.h\"\n #include \"test/cctest/profiler-extension.h\"\n@@ -2545,46 +2544,6 @@ TEST(MultipleProfilers) {\n   profiler2->StopProfiling(\"2\");\n }\n \n-UNINITIALIZED_TEST(DetailedSourcePositionAPI) {\n-  i::FLAG_detailed_line_info = false;\n-  i::FLAG_allow_natives_syntax = true;\n-  v8::Isolate::CreateParams create_params;\n-  create_params.array_buffer_allocator = CcTest::array_buffer_allocator();\n-  v8::Isolate* isolate = v8::Isolate::New(create_params);\n-\n-  const char* source =\n-      \"function fib(i) {\"\n-      \"  if (i <= 1) return 1; \"\n-      \"  return fib(i - 1) +\"\n-      \"         fib(i - 2);\"\n-      \"}\"\n-      \"fib(5);\"\n-      \"%OptimizeFunctionOnNextCall(fib);\"\n-      \"fib(5);\"\n-      \"fib\";\n-  {\n-    v8::Isolate::Scope isolate_scope(isolate);\n-    v8::HandleScope handle_scope(isolate);\n-    v8::Local<v8::Context> context = v8::Context::New(isolate);\n-    v8::Context::Scope context_scope(context);\n-    i::Isolate* i_isolate = reinterpret_cast<i::Isolate*>(isolate);\n-\n-    CHECK(!i_isolate->NeedsDetailedOptimizedCodeLineInfo());\n-\n-    int non_detailed_positions = GetSourcePositionEntryCount(i_isolate, source);\n-\n-    v8::CpuProfiler::UseDetailedSourcePositionsForProfiling(isolate);\n-    CHECK(i_isolate->NeedsDetailedOptimizedCodeLineInfo());\n-\n-    int detailed_positions = GetSourcePositionEntryCount(i_isolate, source);\n-\n-    CHECK((non_detailed_positions == -1 && detailed_positions == -1) ||\n-          non_detailed_positions < detailed_positions);\n-  }\n-\n-  isolate->Dispose();\n-}\n-\n }  // namespace test_cpu_profiler\n }  // namespace internal\n }  // namespace v8"
        },
        {
            "sha": "faef976e974b4c345409a93f115d0525f3e8bff4",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/6adbe9a9a0ad014b470507de400332075e733b10/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/6adbe9a9a0ad014b470507de400332075e733b10/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=6adbe9a9a0ad014b470507de400332075e733b10",
            "patch": "@@ -2611,7 +2611,6 @@ Isolate* NewIsolate(ArrayBufferAllocator* allocator, uv_loop_t* event_loop) {\n   isolate->SetMicrotasksPolicy(MicrotasksPolicy::kExplicit);\n   isolate->SetFatalErrorHandler(OnFatalError);\n   isolate->SetAllowWasmCodeGenerationCallback(AllowWasmCodeGenerationCallback);\n-  v8::CpuProfiler::UseDetailedSourcePositionsForProfiling(isolate);\n \n   return isolate;\n }"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 2,
        "deletions": 57
    }
}