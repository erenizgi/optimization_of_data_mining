{
    "author": "BridgeAR",
    "message": "util: switch recurseTimes counter\n\nThis makes sure the counter goes up instead of going down. This allows\nto properly track the current inspection depth no matter what the\n`depth` option was set to.\n\nPR-URL: https://github.com/nodejs/node/pull/25255\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "eca2760ab167a253bf57e43b1f3531404aaceef9",
    "files": [
        {
            "sha": "1c777389751e6b46c5ead155a104dde743a6640c",
            "filename": "lib/internal/util/inspect.js",
            "status": "modified",
            "additions": 12,
            "deletions": 11,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/eca2760ab167a253bf57e43b1f3531404aaceef9/lib%2Finternal%2Futil%2Finspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/eca2760ab167a253bf57e43b1f3531404aaceef9/lib%2Finternal%2Futil%2Finspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspect.js?ref=eca2760ab167a253bf57e43b1f3531404aaceef9",
            "patch": "@@ -193,7 +193,7 @@ function inspect(value, opts) {\n   }\n   if (ctx.colors) ctx.stylize = stylizeWithColor;\n   if (ctx.maxArrayLength === null) ctx.maxArrayLength = Infinity;\n-  return formatValue(ctx, value, ctx.depth);\n+  return formatValue(ctx, value, 0);\n }\n inspect.custom = customInspectSymbol;\n \n@@ -407,11 +407,10 @@ function getCtxStyle(constructor, tag) {\n }\n \n function formatProxy(ctx, proxy, recurseTimes) {\n-  if (recurseTimes != null) {\n-    if (recurseTimes < 0)\n-      return ctx.stylize('Proxy [Array]', 'special');\n-    recurseTimes -= 1;\n+  if (recurseTimes > ctx.depth && ctx.depth !== null) {\n+    return ctx.stylize('Proxy [Array]', 'special');\n   }\n+  recurseTimes += 1;\n   ctx.indentationLvl += 2;\n   const res = [\n     formatValue(ctx, proxy[0], recurseTimes),\n@@ -526,7 +525,10 @@ function formatValue(ctx, value, recurseTimes, typedArray) {\n         maybeCustom !== inspect &&\n         // Also filter out any prototype objects using the circular check.\n         !(value.constructor && value.constructor.prototype === value)) {\n-      const ret = maybeCustom.call(value, recurseTimes, ctx);\n+      // This makes sure the recurseTimes are reported as before while using\n+      // a counter internally.\n+      const depth = ctx.depth === null ? null : ctx.depth - recurseTimes;\n+      const ret = maybeCustom.call(value, depth, ctx);\n \n       // If the custom inspection method returned `this`, don't go into\n       // infinite recursion.\n@@ -643,7 +645,7 @@ function formatRaw(ctx, value, recurseTimes, typedArray) {\n       const prefix = getPrefix(constructor, tag, 'RegExp');\n       if (prefix !== 'RegExp ')\n         base = `${prefix}${base}`;\n-      if (keys.length === 0 || recurseTimes < 0)\n+      if (keys.length === 0 || recurseTimes > ctx.depth && ctx.depth !== null)\n         return ctx.stylize(base, 'regexp');\n     } else if (isDate(value)) {\n       // Make dates with properties first say the date\n@@ -757,11 +759,10 @@ function formatRaw(ctx, value, recurseTimes, typedArray) {\n     }\n   }\n \n-  if (recurseTimes != null) {\n-    if (recurseTimes < 0)\n-      return ctx.stylize(`[${getCtxStyle(constructor, tag)}]`, 'special');\n-    recurseTimes -= 1;\n+  if (recurseTimes > ctx.depth && ctx.depth !== null) {\n+    return ctx.stylize(`[${getCtxStyle(constructor, tag)}]`, 'special');\n   }\n+  recurseTimes += 1;\n \n   ctx.seen.push(value);\n   let output;"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 12,
        "deletions": 11
    }
}