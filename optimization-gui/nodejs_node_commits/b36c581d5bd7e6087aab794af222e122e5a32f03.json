{
    "author": "joaocgreis",
    "message": "module: accept Windows relative path\n\nBefore this change, require('.\\\\test.js') failed while\nrequire('./test.js') succeeded. This changes _resolveLookupPaths so\nthat both ways are accepted on Windows.\n\nFixes: https://github.com/nodejs/node/issues/21918\nPR-URL: https://github.com/nodejs/node/pull/22186\nReviewed-By: Phillip Johnsen <johphi@gmail.com>\nReviewed-By: John-David Dalton <john.david.dalton@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "b36c581d5bd7e6087aab794af222e122e5a32f03",
    "files": [
        {
            "sha": "86ed3ac1a96fba569233c410af7b61898f9e9e44",
            "filename": "lib/internal/modules/cjs/loader.js",
            "status": "modified",
            "additions": 9,
            "deletions": 6,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/b36c581d5bd7e6087aab794af222e122e5a32f03/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "raw_url": "https://github.com/nodejs/node/raw/b36c581d5bd7e6087aab794af222e122e5a32f03/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js?ref=b36c581d5bd7e6087aab794af222e122e5a32f03",
            "patch": "@@ -80,6 +80,8 @@ const {\n   CHAR_9,\n } = require('internal/constants');\n \n+const isWindows = process.platform === 'win32';\n+\n function stat(filename) {\n   filename = path.toNamespacedPath(filename);\n   const cache = stat.cache;\n@@ -310,7 +312,7 @@ Module._findPath = function(request, paths, isMain) {\n // 'node_modules' character codes reversed\n var nmChars = [ 115, 101, 108, 117, 100, 111, 109, 95, 101, 100, 111, 110 ];\n var nmLen = nmChars.length;\n-if (process.platform === 'win32') {\n+if (isWindows) {\n   // 'from' is the __dirname of the module.\n   Module._nodeModulePaths = function(from) {\n     // guarantee that 'from' is absolute.\n@@ -403,11 +405,12 @@ Module._resolveLookupPaths = function(request, parent, newReturn) {\n     return (newReturn ? null : [request, []]);\n   }\n \n-  // Check for relative path\n+  // Check for non-relative path\n   if (request.length < 2 ||\n       request.charCodeAt(0) !== CHAR_DOT ||\n       (request.charCodeAt(1) !== CHAR_DOT &&\n-       request.charCodeAt(1) !== CHAR_FORWARD_SLASH)) {\n+       request.charCodeAt(1) !== CHAR_FORWARD_SLASH &&\n+       (!isWindows || request.charCodeAt(1) !== CHAR_BACKWARD_SLASH))) {\n     var paths = modulePaths;\n     if (parent) {\n       if (!parent.paths)\n@@ -480,7 +483,9 @@ Module._resolveLookupPaths = function(request, parent, newReturn) {\n \n   // make sure require('./path') and require('path') get distinct ids, even\n   // when called from the toplevel js file\n-  if (parentIdPath === '.' && id.indexOf('/') === -1) {\n+  if (parentIdPath === '.' &&\n+      id.indexOf('/') === -1 &&\n+      (!isWindows || id.indexOf('\\\\') === -1)) {\n     id = './' + id;\n   }\n \n@@ -746,8 +751,6 @@ Module.runMain = function() {\n };\n \n Module._initPaths = function() {\n-  const isWindows = process.platform === 'win32';\n-\n   var homeDir;\n   var nodePath;\n   if (isWindows) {"
        },
        {
            "sha": "c5350e11facda4f1a5963a3e16448992420aa732",
            "filename": "test/parallel/test-module-relative-lookup.js",
            "status": "modified",
            "additions": 17,
            "deletions": 7,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/b36c581d5bd7e6087aab794af222e122e5a32f03/test%2Fparallel%2Ftest-module-relative-lookup.js",
            "raw_url": "https://github.com/nodejs/node/raw/b36c581d5bd7e6087aab794af222e122e5a32f03/test%2Fparallel%2Ftest-module-relative-lookup.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-module-relative-lookup.js?ref=b36c581d5bd7e6087aab794af222e122e5a32f03",
            "patch": "@@ -1,15 +1,25 @@\n 'use strict';\n \n-require('../common');\n+const common = require('../common');\n const assert = require('assert');\n const _module = require('module'); // avoid collision with global.module\n-const lookupResults = _module._resolveLookupPaths('./lodash');\n-let paths = lookupResults[1];\n \n // Current directory gets highest priority for local modules\n-assert.strictEqual(paths[0], '.');\n+function testFirstInPath(moduleName, isLocalModule) {\n+  const assertFunction = isLocalModule ?\n+    assert.strictEqual :\n+    assert.notStrictEqual;\n \n-paths = _module._resolveLookupPaths('./lodash', null, true);\n+  const lookupResults = _module._resolveLookupPaths(moduleName);\n \n-// Current directory gets highest priority for local modules\n-assert.strictEqual(paths && paths[0], '.');\n+  let paths = lookupResults[1];\n+  assertFunction(paths[0], '.');\n+\n+  paths = _module._resolveLookupPaths(moduleName, null, true);\n+  assertFunction(paths && paths[0], '.');\n+}\n+\n+testFirstInPath('./lodash', true);\n+\n+// Relative path on Windows, but a regular file name elsewhere\n+testFirstInPath('.\\\\lodash', common.isWindows);"
        },
        {
            "sha": "8a2b56666d6bf02c8f115633c37208cb328691cd",
            "filename": "test/parallel/test-preload.js",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/b36c581d5bd7e6087aab794af222e122e5a32f03/test%2Fparallel%2Ftest-preload.js",
            "raw_url": "https://github.com/nodejs/node/raw/b36c581d5bd7e6087aab794af222e122e5a32f03/test%2Fparallel%2Ftest-preload.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-preload.js?ref=b36c581d5bd7e6087aab794af222e122e5a32f03",
            "patch": "@@ -132,6 +132,26 @@ childProcess.exec(\n   }\n );\n \n+// test that preloading with a relative path works\n+process.chdir(fixtures.fixturesDir);\n+childProcess.exec(\n+  `\"${nodeBinary}\" ${preloadOption(['./printA.js'])} \"${fixtureB}\"`,\n+  common.mustCall(function(err, stdout, stderr) {\n+    assert.ifError(err);\n+    assert.strictEqual(stdout, 'A\\nB\\n');\n+  })\n+);\n+if (common.isWindows) {\n+  // https://github.com/nodejs/node/issues/21918\n+  childProcess.exec(\n+    `\"${nodeBinary}\" ${preloadOption(['.\\\\printA.js'])} \"${fixtureB}\"`,\n+    common.mustCall(function(err, stdout, stderr) {\n+      assert.ifError(err);\n+      assert.strictEqual(stdout, 'A\\nB\\n');\n+    })\n+  );\n+}\n+\n // https://github.com/nodejs/node/issues/1691\n process.chdir(fixtures.fixturesDir);\n childProcess.exec("
        }
    ],
    "stats": {
        "total": 59,
        "additions": 46,
        "deletions": 13
    }
}