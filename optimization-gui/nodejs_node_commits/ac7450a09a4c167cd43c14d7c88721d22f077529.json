{
    "author": "BridgeAR",
    "message": "util: change util.inspect depth default\n\nThe current default is not ideal in most use cases. Therefore it is\nchanged to inspect objects to a maximum depth of 20 in case\nutil.inspect is called with it's defaults. The default is kept at 2\nwhen using console.log() and similar in the repl.\n\nPR-URL: https://github.com/nodejs/node/pull/17907\nRefs: https://github.com/nodejs/node/issues/12693\n\nPR-URL: https://github.com/nodejs/node/pull/22846\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>\nReviewed-By: Roman Reiss <me@silverwind.io>",
    "sha": "ac7450a09a4c167cd43c14d7c88721d22f077529",
    "files": [
        {
            "sha": "00604813c3a9edfa56d2502b36ec67b86daa73ce",
            "filename": "doc/api/util.md",
            "status": "modified",
            "additions": 19,
            "deletions": 5,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/ac7450a09a4c167cd43c14d7c88721d22f077529/doc%2Fapi%2Futil.md",
            "raw_url": "https://github.com/nodejs/node/raw/ac7450a09a4c167cd43c14d7c88721d22f077529/doc%2Fapi%2Futil.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Futil.md?ref=ac7450a09a4c167cd43c14d7c88721d22f077529",
            "patch": "@@ -360,6 +360,9 @@ stream.write('With ES6');\n <!-- YAML\n added: v0.3.0\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/22846\n+    description: The `depth` default changed to `20`.\n   - version: REPLACEME\n     pr-url: https://github.com/nodejs/node/pull/22788\n     description: The `sorted` option is supported now.\n@@ -401,7 +404,7 @@ changes:\n   * `depth` {number} Specifies the number of times to recurse while formatting\n     the `object`. This is useful for inspecting large complicated objects. To\n     make it recurse up to the maximum call stack size pass `Infinity` or `null`.\n-    **Default:** `2`.\n+    **Default:** `20`.\n   * `colors` {boolean} If `true`, the output will be styled with ANSI color\n     codes. Colors are customizable, see [Customizing `util.inspect` colors][].\n     **Default:** `false`.\n@@ -458,12 +461,23 @@ util.inspect(new Bar()); // 'Bar {}'\n util.inspect(baz);       // '[foo] {}'\n ```\n \n-The following example inspects all properties of the `util` object:\n+The following example limits the inspected output of the `paths` property:\n \n ```js\n const util = require('util');\n \n-console.log(util.inspect(util, { showHidden: true, depth: null }));\n+console.log(util.inspect(module, { depth: 0 }));\n+// Instead of showing all entries in `paths` `[Array]` is used to limit the\n+// output for readability:\n+\n+// Module {\n+//   id: '<repl>',\n+//   exports: {},\n+//   parent: undefined,\n+//   filename: null,\n+//   loaded: false,\n+//   children: [],\n+//   paths: [Array] }\n ```\n \n The following example highlights the difference with the `compact` option:\n@@ -479,7 +493,7 @@ const o = {\n     'foo']], 4],\n   b: new Map([['za', 1], ['zb', 'test']])\n };\n-console.log(util.inspect(o, { compact: true, depth: 5, breakLength: 80 }));\n+console.log(util.inspect(o, { compact: true, breakLength: 80 }));\n \n // This will print\n \n@@ -493,7 +507,7 @@ console.log(util.inspect(o, { compact: true, depth: 5, breakLength: 80 }));\n //   b: Map { 'za' => 1, 'zb' => 'test' } }\n \n // Setting `compact` to false changes the output to be more reader friendly.\n-console.log(util.inspect(o, { compact: false, depth: 5, breakLength: 80 }));\n+console.log(util.inspect(o, { compact: false, breakLength: 80 }));\n \n // {\n //   a: ["
        },
        {
            "sha": "4f018ed314be51b43d47f4805c702dbe14295b46",
            "filename": "lib/internal/util/inspect.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ac7450a09a4c167cd43c14d7c88721d22f077529/lib%2Finternal%2Futil%2Finspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/ac7450a09a4c167cd43c14d7c88721d22f077529/lib%2Finternal%2Futil%2Finspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspect.js?ref=ac7450a09a4c167cd43c14d7c88721d22f077529",
            "patch": "@@ -94,7 +94,7 @@ const hasOwnProperty = uncurryThis(Object.prototype.hasOwnProperty);\n \n const inspectDefaultOptions = Object.seal({\n   showHidden: false,\n-  depth: 2,\n+  depth: 20,\n   colors: false,\n   customInspect: true,\n   showProxy: false,"
        },
        {
            "sha": "a9bb9d6ab8ced8c530bc06215f566e6c1a8017dc",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/ac7450a09a4c167cd43c14d7c88721d22f077529/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/ac7450a09a4c167cd43c14d7c88721d22f077529/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=ac7450a09a4c167cd43c14d7c88721d22f077529",
            "patch": "@@ -128,8 +128,9 @@ function hasOwnProperty(obj, prop) {\n // Can overridden with custom print functions, such as `probe` or `eyes.js`.\n // This is the default \"writer\" value if none is passed in the REPL options.\n const writer = exports.writer = (obj) => util.inspect(obj, writer.options);\n-writer.options =\n-    Object.assign({}, util.inspect.defaultOptions, { showProxy: true });\n+writer.options = Object.assign({},\n+                               util.inspect.defaultOptions,\n+                               { showProxy: true, depth: 2 });\n \n exports._builtinLibs = builtinLibs;\n "
        },
        {
            "sha": "ef9b1fef6dbdabcbdf1f48749ddb5623c5ec2d15",
            "filename": "test/parallel/test-stream-buffer-list.js",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/ac7450a09a4c167cd43c14d7c88721d22f077529/test%2Fparallel%2Ftest-stream-buffer-list.js",
            "raw_url": "https://github.com/nodejs/node/raw/ac7450a09a4c167cd43c14d7c88721d22f077529/test%2Fparallel%2Ftest-stream-buffer-list.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-buffer-list.js?ref=ac7450a09a4c167cd43c14d7c88721d22f077529",
            "patch": "@@ -3,6 +3,7 @@\n require('../common');\n const assert = require('assert');\n const BufferList = require('internal/streams/buffer_list');\n+const util = require('util');\n \n // Test empty buffer list.\n const emptyList = new BufferList();\n@@ -30,3 +31,10 @@ assert.strictEqual(list.join(','), 'foo');\n const shifted = list.shift();\n assert.strictEqual(shifted, buf);\n assert.deepStrictEqual(list, new BufferList());\n+\n+const tmp = util.inspect.defaultOptions.colors;\n+util.inspect.defaultOptions = { colors: true };\n+assert.strictEqual(\n+  util.inspect(list),\n+  'BufferList { length: \\u001b[33m0\\u001b[39m }');\n+util.inspect.defaultOptions = { colors: tmp };"
        },
        {
            "sha": "45f7abba213596197daba36edb878efe2bad58bf",
            "filename": "test/parallel/test-util-inspect-proxy.js",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/ac7450a09a4c167cd43c14d7c88721d22f077529/test%2Fparallel%2Ftest-util-inspect-proxy.js",
            "raw_url": "https://github.com/nodejs/node/raw/ac7450a09a4c167cd43c14d7c88721d22f077529/test%2Fparallel%2Ftest-util-inspect-proxy.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect-proxy.js?ref=ac7450a09a4c167cd43c14d7c88721d22f077529",
            "patch": "@@ -50,13 +50,17 @@ const expected1 = 'Proxy [ {}, {} ]';\n const expected2 = 'Proxy [ Proxy [ {}, {} ], {} ]';\n const expected3 = 'Proxy [ Proxy [ Proxy [ {}, {} ], {} ], Proxy [ {}, {} ] ]';\n const expected4 = 'Proxy [ Proxy [ {}, {} ], Proxy [ Proxy [ {}, {} ], {} ] ]';\n-const expected5 = 'Proxy [ Proxy [ Proxy [ Proxy [Array], {} ],' +\n+const expected5 = 'Proxy [ Proxy [ Proxy [ Proxy [ {}, {} ], {} ],' +\n                   ' Proxy [ {}, {} ] ],\\n  Proxy [ Proxy [ {}, {} ]' +\n-                  ', Proxy [ Proxy [Array], {} ] ] ]';\n-const expected6 = 'Proxy [ Proxy [ Proxy [ Proxy [Array], Proxy [Array]' +\n-                  ' ],\\n    Proxy [ Proxy [Array], Proxy [Array] ] ],\\n' +\n-                  '  Proxy [ Proxy [ Proxy [Array], Proxy [Array] ],\\n' +\n-                  '    Proxy [ Proxy [Array], Proxy [Array] ] ] ]';\n+                  ', Proxy [ Proxy [ {}, {} ], {} ] ] ]';\n+const expected6 = 'Proxy [ Proxy [ Proxy [ Proxy [ Proxy [ {}, {} ], {} ], ' +\n+                    'Proxy [ {}, {} ] ],\\n' +\n+                  '    Proxy [ Proxy [ {}, {} ], ' +\n+                    'Proxy [ Proxy [ {}, {} ], {} ] ] ],\\n' +\n+                  '  Proxy [ Proxy [ Proxy [ Proxy [ {}, {} ], {} ], ' +\n+                    'Proxy [ {}, {} ] ],\\n' +\n+                  '    Proxy [ Proxy [ {}, {} ], ' +\n+                    'Proxy [ Proxy [ {}, {} ], {} ] ] ] ]';\n assert.strictEqual(\n   util.inspect(proxy1, { showProxy: true, depth: null }),\n   expected1);"
        },
        {
            "sha": "713bf047ddd3459a6c66a39a8cd004c5a2d33d8f",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 21,
            "deletions": 13,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/ac7450a09a4c167cd43c14d7c88721d22f077529/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/ac7450a09a4c167cd43c14d7c88721d22f077529/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=ac7450a09a4c167cd43c14d7c88721d22f077529",
            "patch": "@@ -71,7 +71,7 @@ assert.strictEqual(util.inspect({ a: 1, b: 2 }), '{ a: 1, b: 2 }');\n assert.strictEqual(util.inspect({ 'a': {} }), '{ a: {} }');\n assert.strictEqual(util.inspect({ 'a': { 'b': 2 } }), '{ a: { b: 2 } }');\n assert.strictEqual(util.inspect({ 'a': { 'b': { 'c': { 'd': 2 } } } }),\n-                   '{ a: { b: { c: [Object] } } }');\n+                   '{ a: { b: { c: { d: 2 } } } }');\n assert.strictEqual(\n   util.inspect({ 'a': { 'b': { 'c': { 'd': 2 } } } }, false, null),\n   '{ a: { b: { c: { d: 2 } } } }');\n@@ -110,7 +110,7 @@ assert.strictEqual(util.inspect((new JSStream())._externalStream),\n   assert.strictEqual(util.inspect({ a: regexp }, false, 0), '{ a: /regexp/ }');\n }\n \n-assert(/Object/.test(\n+assert(!/Object/.test(\n   util.inspect({ a: { a: { a: { a: {} } } } }, undefined, undefined, true)\n ));\n assert(!/Object/.test(\n@@ -1055,15 +1055,15 @@ if (typeof Symbol !== 'undefined') {\n // Empty and circular before depth.\n {\n   const arr = [[[[]]]];\n-  assert.strictEqual(util.inspect(arr), '[ [ [ [] ] ] ]');\n+  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [] ] ] ]');\n   arr[0][0][0][0] = [];\n-  assert.strictEqual(util.inspect(arr), '[ [ [ [Array] ] ] ]');\n+  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [Array] ] ] ]');\n   arr[0][0][0] = {};\n-  assert.strictEqual(util.inspect(arr), '[ [ [ {} ] ] ]');\n+  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ {} ] ] ]');\n   arr[0][0][0] = { a: 2 };\n-  assert.strictEqual(util.inspect(arr), '[ [ [ [Object] ] ] ]');\n+  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [Object] ] ] ]');\n   arr[0][0][0] = arr;\n-  assert.strictEqual(util.inspect(arr), '[ [ [ [Circular] ] ] ]');\n+  assert.strictEqual(util.inspect(arr, { depth: 2 }), '[ [ [ [Circular] ] ] ]');\n }\n \n // Corner cases.\n@@ -1160,10 +1160,10 @@ if (typeof Symbol !== 'undefined') {\n   assert(!/1 more item/.test(util.inspect(arr)));\n   util.inspect.defaultOptions.maxArrayLength = oldOptions.maxArrayLength;\n   assert(/1 more item/.test(util.inspect(arr)));\n-  util.inspect.defaultOptions.depth = null;\n-  assert(!/Object/.test(util.inspect(obj)));\n-  util.inspect.defaultOptions.depth = oldOptions.depth;\n+  util.inspect.defaultOptions.depth = 2;\n   assert(/Object/.test(util.inspect(obj)));\n+  util.inspect.defaultOptions.depth = oldOptions.depth;\n+  assert(!/Object/.test(util.inspect(obj)));\n   assert.strictEqual(\n     JSON.stringify(util.inspect.defaultOptions),\n     JSON.stringify(oldOptions)\n@@ -1175,7 +1175,7 @@ if (typeof Symbol !== 'undefined') {\n   assert(/Object/.test(util.inspect(obj)));\n   util.inspect.defaultOptions = oldOptions;\n   assert(/1 more item/.test(util.inspect(arr)));\n-  assert(/Object/.test(util.inspect(obj)));\n+  assert(!/Object/.test(util.inspect(obj)));\n   assert.strictEqual(\n     JSON.stringify(util.inspect.defaultOptions),\n     JSON.stringify(oldOptions)\n@@ -1561,11 +1561,19 @@ util.inspect(process);\n   let head = list;\n   // A linked list of length 100k should be inspectable in some way, even though\n   // the real cutoff value is much lower than 100k.\n-  for (let i = 0; i < 100000; i++)\n+  for (let i = 0; i < 100000; i++) {\n     head = head.next = {};\n+  }\n+\n+  const res = Array(15)\n+    .fill(0)\n+    .map((_, i) => `{ next:\\n${'   '.repeat(i + 1)}`)\n+    .join('') +\n+    '{ next: { next: { next: { next: { next: { next:' +\n+    ' [Object] } } } } } } } } } } } } } } } } } } } } }';\n   assert.strictEqual(\n     util.inspect(list),\n-    '{ next: { next: { next: [Object] } } }'\n+    res\n   );\n   const longList = util.inspect(list, { depth: Infinity });\n   const match = longList.match(/next/g);"
        }
    ],
    "stats": {
        "total": 89,
        "additions": 62,
        "deletions": 27
    }
}