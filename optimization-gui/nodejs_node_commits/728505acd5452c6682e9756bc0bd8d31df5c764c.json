{
    "author": "Mnwa",
    "message": "buffer: refactor checks for SlowBuffer creation\n\nPR-URL: https://github.com/nodejs/node/pull/25266\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "728505acd5452c6682e9756bc0bd8d31df5c764c",
    "files": [
        {
            "sha": "0b765832663b3ac3d0f190df8996d3c6f920d74c",
            "filename": "lib/buffer.js",
            "status": "modified",
            "additions": 15,
            "deletions": 18,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/728505acd5452c6682e9756bc0bd8d31df5c764c/lib%2Fbuffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/728505acd5452c6682e9756bc0bd8d31df5c764c/lib%2Fbuffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fbuffer.js?ref=728505acd5452c6682e9756bc0bd8d31df5c764c",
            "patch": "@@ -102,7 +102,7 @@ const constants = Object.defineProperties({}, {\n });\n \n Buffer.poolSize = 8 * 1024;\n-var poolSize, poolOffset, allocPool;\n+let poolSize, poolOffset, allocPool;\n \n setupBufferJS(Buffer.prototype, bindingObj);\n \n@@ -221,7 +221,7 @@ Buffer.from = function from(value, encodingOrOffset, length) {\n   if (valueOf !== null && valueOf !== undefined && valueOf !== value)\n     return Buffer.from(valueOf, encodingOrOffset, length);\n \n-  var b = fromObject(value);\n+  const b = fromObject(value);\n   if (b)\n     return b;\n \n@@ -307,13 +307,10 @@ Buffer.allocUnsafeSlow = function allocUnsafeSlow(size) {\n // If --zero-fill-buffers command line argument is set, a zero-filled\n // buffer is returned.\n function SlowBuffer(length) {\n-  const len = +length;\n-  // eslint-disable-next-line eqeqeq\n-  if (len != length)\n-    length = 0;\n-  else\n-    assertSize(len);\n-  return createUnsafeBuffer(len);\n+  if (typeof length !== 'number')\n+    length = +length;\n+  assertSize(length);\n+  return createUnsafeBuffer(length);\n }\n \n Object.setPrototypeOf(SlowBuffer.prototype, Uint8Array.prototype);\n@@ -326,7 +323,7 @@ function allocate(size) {\n   if (size < (Buffer.poolSize >>> 1)) {\n     if (size > (poolSize - poolOffset))\n       createPool();\n-    var b = new FastBuffer(allocPool, poolOffset, size);\n+    const b = new FastBuffer(allocPool, poolOffset, size);\n     poolOffset += size;\n     alignPool();\n     return b;\n@@ -335,7 +332,7 @@ function allocate(size) {\n }\n \n function fromString(string, encoding) {\n-  var length;\n+  let length;\n   if (typeof encoding !== 'string' || encoding.length === 0) {\n     if (string.length === 0)\n       return new FastBuffer();\n@@ -354,7 +351,7 @@ function fromString(string, encoding) {\n \n   if (length > (poolSize - poolOffset))\n     createPool();\n-  var b = new FastBuffer(allocPool, poolOffset, length);\n+  let b = new FastBuffer(allocPool, poolOffset, length);\n   const actual = b.write(string, encoding);\n   if (actual !== length) {\n     // byteLength() may overestimate. That's a rare case, though.\n@@ -456,7 +453,7 @@ Buffer.isEncoding = function isEncoding(encoding) {\n Buffer[kIsEncodingSymbol] = Buffer.isEncoding;\n \n Buffer.concat = function concat(list, length) {\n-  var i;\n+  let i;\n   if (!Array.isArray(list)) {\n     throw new ERR_INVALID_ARG_TYPE(\n       'list', ['Array', 'Buffer', 'Uint8Array'], list);\n@@ -473,10 +470,10 @@ Buffer.concat = function concat(list, length) {\n     length = length >>> 0;\n   }\n \n-  var buffer = Buffer.allocUnsafe(length);\n-  var pos = 0;\n+  const buffer = Buffer.allocUnsafe(length);\n+  let pos = 0;\n   for (i = 0; i < list.length; i++) {\n-    var buf = list[i];\n+    const buf = list[i];\n     if (!isUint8Array(buf)) {\n       // TODO(BridgeAR): This should not be of type ERR_INVALID_ARG_TYPE.\n       // Instead, find the proper error code for this.\n@@ -791,7 +788,7 @@ function bidirectionalIndexOf(buffer, val, byteOffset, encoding, dir) {\n }\n \n function slowIndexOf(buffer, val, byteOffset, encoding, dir) {\n-  var loweredCase = false;\n+  let loweredCase = false;\n   for (;;) {\n     switch (encoding) {\n       case 'utf8':\n@@ -926,7 +923,7 @@ Buffer.prototype.write = function write(string, offset, length, encoding) {\n       length = undefined;\n     }\n \n-    var remaining = this.length - offset;\n+    const remaining = this.length - offset;\n     if (length === undefined || length > remaining)\n       length = remaining;\n "
        }
    ],
    "stats": {
        "total": 33,
        "additions": 15,
        "deletions": 18
    }
}