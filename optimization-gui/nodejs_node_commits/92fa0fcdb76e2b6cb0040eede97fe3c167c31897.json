{
    "author": "joyeecheung",
    "message": "src: name EmbededderGraph edges and use class names for nodes\n\nThis patch:\n\n- Refactors the `MemoryRetainer` API so that the impementer no longer\n  calls `TrackThis()` that sets the size of node on the top of the\n  stack, which may be hard to understand. Instead now they implements\n  `SelfSize()` to provide their self sizes. Also documents\n  the API in the header.\n- Refactors `MemoryTracker` so it calls `MemoryInfoName()` and\n  `SelfSize()` of `MemoryRetainer` to retrieve info about them, and\n  separate `node_names` and `edge_names` so the edges can be properly\n  named with reference names and the nodes can be named with class\n  names. (Previously the nodes are named with reference names while the\n  edges are all indexed and appear as array elements).\n- Adds `SET_MEMORY_INFO_NAME()`, `SET_SELF_SIZE()` and\n  `SET_NO_MEMORY_INFO()` convenience macros\n- Fixes a few `MemoryInfo` calls in some `MemoryRetainers` to track\n  their references properly.\n- Refactors the heapdump tests to check both node names and edge names,\n  distinguishing between wrapped JS nodes (without prefixes)\n  and embedder wrappers (prefixed with `Node / `).\n\nPR-URL: https://github.com/nodejs/node/pull/23072\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
    "files": [
        {
            "sha": "61fe5916fd7584fcb513e30401899dda4642766e",
            "filename": "lib/internal/test/heap.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/lib%2Finternal%2Ftest%2Fheap.js",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/lib%2Finternal%2Ftest%2Fheap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ftest%2Fheap.js?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -36,8 +36,8 @@ function createJSHeapDump() {\n     const fromNode = nodes[fromNodeIndex];\n     const edge = {\n       type,\n-      toNode,\n-      fromNode,\n+      to: toNode,\n+      from: fromNode,\n       name: typeof name_or_index === 'string' ? name_or_index : null\n     };\n     toNode.incomingEdges.push(edge);"
        },
        {
            "sha": "2b163a5fa283d105665322847f3299e96f9fc56a",
            "filename": "src/async_wrap.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fasync_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fasync_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fasync_wrap.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -73,9 +73,9 @@ struct AsyncWrapObject : public AsyncWrap {\n   inline AsyncWrapObject(Environment* env, Local<Object> object,\n                          ProviderType type) : AsyncWrap(env, object, type) {}\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(AsyncWrapObject)\n+  SET_SELF_SIZE(AsyncWrapObject)\n };\n \n \n@@ -181,9 +181,9 @@ class PromiseWrap : public AsyncWrap {\n     MakeWeak();\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(PromiseWrap)\n+  SET_SELF_SIZE(PromiseWrap)\n \n   static constexpr int kPromiseField = 1;\n   static constexpr int kIsChainedPromiseField = 2;"
        },
        {
            "sha": "e0f3f27950e7d0d16679b6e70d6f4f8d8ba858e0",
            "filename": "src/base_object.h",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fbase_object.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fbase_object.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fbase_object.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -33,11 +33,6 @@ namespace node {\n \n class Environment;\n \n-#define ADD_MEMORY_INFO_NAME(name)                                          \\\n-  std::string MemoryInfoName() const override {                             \\\n-    return #name;                                                           \\\n-  }\n-\n class BaseObject : public MemoryRetainer {\n  public:\n   // Associates this object with `object`. It uses the 0th internal field for"
        },
        {
            "sha": "3fb00859d300c75537438d9f346f365ee34589c6",
            "filename": "src/cares_wrap.cc",
            "status": "modified",
            "additions": 52,
            "deletions": 81,
            "changes": 133,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fcares_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fcares_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fcares_wrap.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -127,8 +127,9 @@ struct node_ares_task : public MemoryRetainer {\n   ares_socket_t sock;\n   uv_poll_t poll_watcher;\n \n-  void MemoryInfo(MemoryTracker* tracker) const override;\n-  ADD_MEMORY_INFO_NAME(node_ares_task)\n+  inline void MemoryInfo(MemoryTracker* tracker) const override;\n+  SET_MEMORY_INFO_NAME(node_ares_task)\n+  SET_SELF_SIZE(node_ares_task)\n };\n \n struct TaskHash {\n@@ -172,13 +173,13 @@ class ChannelWrap : public AsyncWrap {\n   inline node_ares_task_list* task_list() { return &task_list_; }\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     if (timer_handle_ != nullptr)\n-      tracker->TrackFieldWithSize(\"timer handle\", sizeof(*timer_handle_));\n-    tracker->TrackField(\"node_ares_task_list\", task_list_);\n+      tracker->TrackField(\"timer_handle\", *timer_handle_);\n+    tracker->TrackField(\"task_list\", task_list_, \"node_ares_task_list\");\n   }\n \n-  ADD_MEMORY_INFO_NAME(ChannelWrap)\n+  SET_MEMORY_INFO_NAME(ChannelWrap)\n+  SET_SELF_SIZE(ChannelWrap)\n \n   static void AresTimeout(uv_timer_t* handle);\n \n@@ -192,11 +193,6 @@ class ChannelWrap : public AsyncWrap {\n   node_ares_task_list task_list_;\n };\n \n-void node_ares_task::MemoryInfo(MemoryTracker* tracker) const {\n-  tracker->TrackThis(this);\n-  tracker->TrackField(\"channel\", channel);\n-}\n-\n ChannelWrap::ChannelWrap(Environment* env,\n                          Local<Object> object)\n   : AsyncWrap(env, object, PROVIDER_DNSCHANNEL),\n@@ -225,11 +221,9 @@ class GetAddrInfoReqWrap : public ReqWrap<uv_getaddrinfo_t> {\n                      Local<Object> req_wrap_obj,\n                      bool verbatim);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(GetAddrInfoReqWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(GetAddrInfoReqWrap)\n+  SET_SELF_SIZE(GetAddrInfoReqWrap)\n \n   bool verbatim() const { return verbatim_; }\n \n@@ -249,11 +243,9 @@ class GetNameInfoReqWrap : public ReqWrap<uv_getnameinfo_t> {\n  public:\n   GetNameInfoReqWrap(Environment* env, Local<Object> req_wrap_obj);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(GetNameInfoReqWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(GetNameInfoReqWrap)\n+  SET_SELF_SIZE(GetNameInfoReqWrap)\n };\n \n GetNameInfoReqWrap::GetNameInfoReqWrap(Environment* env,\n@@ -298,6 +290,9 @@ void ares_poll_close_cb(uv_poll_t* watcher) {\n   delete task;\n }\n \n+void node_ares_task::MemoryInfo(MemoryTracker* tracker) const {\n+  tracker->TrackField(\"channel\", channel);\n+}\n \n /* Allocates and returns a new node_ares_task */\n node_ares_task* ares_task_create(ChannelWrap* channel, ares_socket_t sock) {\n@@ -1195,11 +1190,9 @@ class QueryAnyWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QueryAnyWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QueryAnyWrap)\n+  SET_SELF_SIZE(QueryAnyWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1376,11 +1369,9 @@ class QueryAWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QueryAWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QueryAWrap)\n+  SET_SELF_SIZE(QueryAWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1424,11 +1415,9 @@ class QueryAaaaWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QueryAaaaWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QueryAaaaWrap)\n+  SET_SELF_SIZE(QueryAaaaWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1472,11 +1461,9 @@ class QueryCnameWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QueryCnameWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QueryCnameWrap)\n+  SET_SELF_SIZE(QueryCnameWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1507,11 +1494,9 @@ class QueryMxWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QueryMxWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QueryMxWrap)\n+  SET_SELF_SIZE(QueryMxWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1542,11 +1527,9 @@ class QueryNsWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QueryNsWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QueryNsWrap)\n+  SET_SELF_SIZE(QueryNsWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1577,11 +1560,9 @@ class QueryTxtWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QueryTxtWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QueryTxtWrap)\n+  SET_SELF_SIZE(QueryTxtWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1611,11 +1592,9 @@ class QuerySrvWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QuerySrvWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QuerySrvWrap)\n+  SET_SELF_SIZE(QuerySrvWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1644,11 +1623,9 @@ class QueryPtrWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QueryPtrWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QueryPtrWrap)\n+  SET_SELF_SIZE(QueryPtrWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1679,11 +1656,9 @@ class QueryNaptrWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QueryNaptrWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QueryNaptrWrap)\n+  SET_SELF_SIZE(QueryNaptrWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1713,11 +1688,9 @@ class QuerySoaWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(QuerySoaWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(QuerySoaWrap)\n+  SET_SELF_SIZE(QuerySoaWrap)\n \n  protected:\n   void Parse(unsigned char* buf, int len) override {\n@@ -1801,11 +1774,9 @@ class GetHostByAddrWrap: public QueryWrap {\n     return 0;\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(GetHostByAddrWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(GetHostByAddrWrap)\n+  SET_SELF_SIZE(GetHostByAddrWrap)\n \n  protected:\n   void Parse(struct hostent* host) override {"
        },
        {
            "sha": "88221b774686315c75e69066551ecfe8f64e07b9",
            "filename": "src/connect_wrap.h",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fconnect_wrap.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fconnect_wrap.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fconnect_wrap.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -16,11 +16,9 @@ class ConnectWrap : public ReqWrap<uv_connect_t> {\n               v8::Local<v8::Object> req_wrap_obj,\n               AsyncWrap::ProviderType provider);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(ConnectWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(ConnectWrap)\n+  SET_SELF_SIZE(ConnectWrap)\n };\n \n }  // namespace node"
        },
        {
            "sha": "739794665b2cfea29a582967fd887b179420e67b",
            "filename": "src/fs_event_wrap.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ffs_event_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ffs_event_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ffs_event_wrap.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -57,11 +57,9 @@ class FSEventWrap: public HandleWrap {\n   static void Start(const FunctionCallbackInfo<Value>& args);\n   static void GetInitialized(const FunctionCallbackInfo<Value>& args);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(FSEventWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(FSEventWrap)\n+  SET_SELF_SIZE(FSEventWrap)\n \n  private:\n   static const encoding kDefaultEncoding = UTF8;"
        },
        {
            "sha": "72ad33c99a1e80ba6329735d5c86150c53366668",
            "filename": "src/heap_utils.cc",
            "status": "modified",
            "additions": 31,
            "deletions": 17,
            "changes": 48,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fheap_utils.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fheap_utils.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fheap_utils.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -103,15 +103,28 @@ class JSGraph : public EmbedderGraph {\n       for (const std::unique_ptr<Node>& n : nodes_) {\n         Local<Object> obj = info_objects[n.get()];\n         Local<Value> value;\n-        if (!String::NewFromUtf8(isolate_, n->Name(),\n-                                 v8::NewStringType::kNormal).ToLocal(&value) ||\n+        std::string name_str;\n+        const char* prefix = n->NamePrefix();\n+        if (prefix == nullptr) {\n+          name_str = n->Name();\n+        } else {\n+          name_str = n->NamePrefix();\n+          name_str += \" \";\n+          name_str += n->Name();\n+        }\n+        if (!String::NewFromUtf8(\n+                 isolate_, name_str.c_str(), v8::NewStringType::kNormal)\n+                 .ToLocal(&value) ||\n             obj->Set(context, name_string, value).IsNothing() ||\n-            obj->Set(context, is_root_string,\n-                     Boolean::New(isolate_, n->IsRootNode())).IsNothing() ||\n-            obj->Set(context, size_string,\n-                     Number::New(isolate_, n->SizeInBytes())).IsNothing() ||\n-            obj->Set(context, edges_string,\n-                     Array::New(isolate_)).IsNothing()) {\n+            obj->Set(context,\n+                     is_root_string,\n+                     Boolean::New(isolate_, n->IsRootNode()))\n+                .IsNothing() ||\n+            obj->Set(context,\n+                     size_string,\n+                     Number::New(isolate_, n->SizeInBytes()))\n+                .IsNothing() ||\n+            obj->Set(context, edges_string, Array::New(isolate_)).IsNothing()) {\n           return MaybeLocal<Array>();\n         }\n         if (nodes->Set(context, i++, obj).IsNothing())\n@@ -145,20 +158,21 @@ class JSGraph : public EmbedderGraph {\n       size_t j = 0;\n       for (const auto& edge : edge_info.second) {\n         Local<Object> to_object = info_objects[edge.second];\n-        Local<Object> edge_info = Object::New(isolate_);\n+        Local<Object> edge_obj = Object::New(isolate_);\n         Local<Value> edge_name_value;\n         const char* edge_name = edge.first;\n-        if (edge_name != nullptr &&\n-            !String::NewFromUtf8(\n-                 isolate_, edge_name, v8::NewStringType::kNormal)\n-                 .ToLocal(&edge_name_value)) {\n-          return MaybeLocal<Array>();\n+        if (edge_name != nullptr) {\n+          if (!String::NewFromUtf8(\n+                  isolate_, edge_name, v8::NewStringType::kNormal)\n+                  .ToLocal(&edge_name_value)) {\n+            return MaybeLocal<Array>();\n+          }\n         } else {\n           edge_name_value = Number::New(isolate_, j++);\n         }\n-        if (edge_info->Set(context, name_string, edge_name_value).IsNothing() ||\n-            edge_info->Set(context, to_string, to_object).IsNothing() ||\n-            edges.As<Array>()->Set(context, i++, edge_info).IsNothing()) {\n+        if (edge_obj->Set(context, name_string, edge_name_value).IsNothing() ||\n+            edge_obj->Set(context, to_string, to_object).IsNothing() ||\n+            edges.As<Array>()->Set(context, i++, edge_obj).IsNothing()) {\n           return MaybeLocal<Array>();\n         }\n       }"
        },
        {
            "sha": "8ec6603e5b4bc3fa6b6c2c92df5d02444e30e67d",
            "filename": "src/inspector_js_api.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Finspector_js_api.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Finspector_js_api.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector_js_api.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -105,12 +105,13 @@ class JSBindingsConnection : public AsyncWrap {\n   }\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"callback\", callback_);\n-    tracker->TrackFieldWithSize(\"session\", sizeof(*session_));\n+    tracker->TrackFieldWithSize(\n+        \"session\", sizeof(*session_), \"InspectorSession\");\n   }\n \n-  ADD_MEMORY_INFO_NAME(JSBindingsConnection)\n+  SET_MEMORY_INFO_NAME(JSBindingsConnection)\n+  SET_SELF_SIZE(JSBindingsConnection)\n \n  private:\n   std::unique_ptr<InspectorSession> session_;"
        },
        {
            "sha": "6612e558aea1d7e9338daffba129ed2f8c69197b",
            "filename": "src/js_stream.h",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fjs_stream.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fjs_stream.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fjs_stream.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -27,11 +27,9 @@ class JSStream : public AsyncWrap, public StreamBase {\n               size_t count,\n               uv_stream_t* send_handle) override;\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(JSStream)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(JSStream)\n+  SET_SELF_SIZE(JSStream)\n \n  protected:\n   JSStream(Environment* env, v8::Local<v8::Object> obj);"
        },
        {
            "sha": "65bcbccdc02aa412cc6ce3e865e940a0325179f4",
            "filename": "src/memory_tracker-inl.h",
            "status": "modified",
            "additions": 178,
            "deletions": 73,
            "changes": 251,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fmemory_tracker-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fmemory_tracker-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fmemory_tracker-inl.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -7,23 +7,40 @@\n \n namespace node {\n \n+// Fallback edge_name if node_name is not available, or \"\" if edge_name\n+// is not available either.\n+inline const char* GetNodeName(const char* node_name, const char* edge_name) {\n+  if (node_name != nullptr) {\n+    return node_name;\n+  }\n+  if (edge_name != nullptr) {\n+    return edge_name;\n+  }\n+  return \"\";\n+}\n+\n class MemoryRetainerNode : public v8::EmbedderGraph::Node {\n  public:\n-  explicit inline MemoryRetainerNode(MemoryTracker* tracker,\n-                                     const MemoryRetainer* retainer,\n-                                     const char* name)\n-     : retainer_(retainer) {\n-    if (retainer_ != nullptr) {\n-      v8::HandleScope handle_scope(tracker->isolate());\n-      v8::Local<v8::Object> obj = retainer_->WrappedObject();\n-      if (!obj.IsEmpty())\n-        wrapper_node_ = tracker->graph()->V8Node(obj);\n+  inline MemoryRetainerNode(MemoryTracker* tracker,\n+                                     const MemoryRetainer* retainer)\n+      : retainer_(retainer) {\n+    CHECK_NOT_NULL(retainer_);\n+    v8::HandleScope handle_scope(tracker->isolate());\n+    v8::Local<v8::Object> obj = retainer_->WrappedObject();\n+    if (!obj.IsEmpty()) wrapper_node_ = tracker->graph()->V8Node(obj);\n+\n+    name_ = retainer_->MemoryInfoName();\n+    size_ = retainer_->SelfSize();\n+  }\n \n-      name_ = retainer_->MemoryInfoName();\n-    }\n-    if (name_.empty() && name != nullptr) {\n-      name_ = name;\n-    }\n+  inline MemoryRetainerNode(MemoryTracker* tracker,\n+                                     const char* name,\n+                                     size_t size,\n+                                     bool is_root_node = false)\n+      : retainer_(nullptr) {\n+    name_ = name;\n+    size_ = size;\n+    is_root_node_ = is_root_node;\n   }\n \n   const char* Name() override { return name_.c_str(); }\n@@ -35,60 +52,90 @@ class MemoryRetainerNode : public v8::EmbedderGraph::Node {\n   Node* JSWrapperNode() { return wrapper_node_; }\n \n   bool IsRootNode() override {\n-    return retainer_ != nullptr && retainer_->IsRootNode();\n+    if (retainer_ != nullptr) {\n+      return retainer_->IsRootNode();\n+    }\n+    return is_root_node_;\n   }\n \n  private:\n   friend class MemoryTracker;\n \n-  Node* wrapper_node_ = nullptr;\n+  // If retainer_ is not nullptr, then it must have a wrapper_node_,\n+  // and we have\n+  // name_ == retainer_->MemoryInfoName()\n+  // size_ == retainer_->SelfSize()\n+  // is_root_node_ == retainer_->IsRootNode()\n   const MemoryRetainer* retainer_;\n+  Node* wrapper_node_ = nullptr;\n+\n+  // Otherwise (retainer == nullptr), we set these fields in an ad-hoc way\n+  bool is_root_node_ = false;\n   std::string name_;\n   size_t size_ = 0;\n };\n \n-template <typename T>\n-void MemoryTracker::TrackThis(const T* obj) {\n-  CurrentNode()->size_ = sizeof(T);\n-}\n-\n-void MemoryTracker::TrackFieldWithSize(const char* name, size_t size) {\n-  if (size > 0)\n-    AddNode(name)->size_ = size;\n+void MemoryTracker::TrackFieldWithSize(const char* edge_name,\n+                                       size_t size,\n+                                       const char* node_name) {\n+  if (size > 0) AddNode(GetNodeName(node_name, edge_name), size, edge_name);\n }\n \n-void MemoryTracker::TrackField(const char* name, const MemoryRetainer& value) {\n-  TrackField(name, &value);\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const MemoryRetainer& value,\n+                               const char* node_name) {\n+  TrackField(edge_name, &value);\n }\n \n-void MemoryTracker::TrackField(const char* name, const MemoryRetainer* value) {\n-  if (track_only_self_ || value == nullptr) return;\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const MemoryRetainer* value,\n+                               const char* node_name) {\n+  if (value == nullptr) return;\n   auto it = seen_.find(value);\n   if (it != seen_.end()) {\n-    graph_->AddEdge(CurrentNode(), it->second);\n+    graph_->AddEdge(CurrentNode(), it->second, edge_name);\n   } else {\n-    Track(value, name);\n+    Track(value, edge_name);\n   }\n }\n \n template <typename T>\n-void MemoryTracker::TrackField(const char* name,\n-                               const std::unique_ptr<T>& value) {\n-  TrackField(name, value.get());\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const std::unique_ptr<T>& value,\n+                               const char* node_name) {\n+  if (value.get() == nullptr) {\n+    return;\n+  }\n+  TrackField(edge_name, value.get(), node_name);\n }\n \n template <typename T, typename Iterator>\n-void MemoryTracker::TrackField(const char* name, const T& value) {\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const T& value,\n+                               const char* node_name,\n+                               const char* element_name,\n+                               bool subtract_from_self) {\n+  // If the container is empty, the size has been accounted into the parent's\n+  // self size\n   if (value.begin() == value.end()) return;\n-  size_t index = 0;\n-  PushNode(name);\n-  for (Iterator it = value.begin(); it != value.end(); ++it)\n-    TrackField(std::to_string(index++).c_str(), *it);\n+  // Fall back to edge name if node names are not provided\n+  if (CurrentNode() != nullptr && subtract_from_self) {\n+    // Shift the self size of this container out to a separate node\n+    CurrentNode()->size_ -= sizeof(T);\n+  }\n+  PushNode(GetNodeName(node_name, edge_name), sizeof(T), edge_name);\n+  for (Iterator it = value.begin(); it != value.end(); ++it) {\n+    // Use nullptr as edge names so the elements appear as indexed properties\n+    TrackField(nullptr, *it, element_name);\n+  }\n   PopNode();\n }\n \n template <typename T>\n-void MemoryTracker::TrackField(const char* name, const std::queue<T>& value) {\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const std::queue<T>& value,\n+                               const char* node_name,\n+                               const char* element_name) {\n   struct ContainerGetter : public std::queue<T> {\n     static const typename std::queue<T>::container_type& Get(\n         const std::queue<T>& value) {\n@@ -97,61 +144,98 @@ void MemoryTracker::TrackField(const char* name, const std::queue<T>& value) {\n   };\n \n   const auto& container = ContainerGetter::Get(value);\n-  TrackField(name, container);\n+  TrackField(edge_name, container, node_name, element_name);\n }\n \n template <typename T, typename test_for_number, typename dummy>\n-void MemoryTracker::TrackField(const char* name, const T& value) {\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const T& value,\n+                               const char* node_name) {\n   // For numbers, creating new nodes is not worth the overhead.\n   CurrentNode()->size_ += sizeof(T);\n }\n \n template <typename T, typename U>\n-void MemoryTracker::TrackField(const char* name, const std::pair<T, U>& value) {\n-  PushNode(name);\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const std::pair<T, U>& value,\n+                               const char* node_name) {\n+  PushNode(node_name == nullptr ? \"pair\" : node_name,\n+           sizeof(const std::pair<T, U>),\n+           edge_name);\n+  // TODO(joyeecheung): special case if one of these is a number type\n+  // that meets the test_for_number trait so that their sizes don't get\n+  // merged into the pair node\n   TrackField(\"first\", value.first);\n   TrackField(\"second\", value.second);\n   PopNode();\n }\n \n template <typename T>\n-void MemoryTracker::TrackField(const char* name,\n-                               const std::basic_string<T>& value) {\n-  TrackFieldWithSize(name, value.size() * sizeof(T));\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const std::basic_string<T>& value,\n+                               const char* node_name) {\n+  TrackFieldWithSize(edge_name, value.size() * sizeof(T), \"std::basic_string\");\n }\n \n template <typename T, typename Traits>\n-void MemoryTracker::TrackField(const char* name,\n-                               const v8::Persistent<T, Traits>& value) {\n-  TrackField(name, value.Get(isolate_));\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const v8::Persistent<T, Traits>& value,\n+                               const char* node_name) {\n+  TrackField(edge_name, value.Get(isolate_));\n }\n \n template <typename T>\n-void MemoryTracker::TrackField(const char* name, const v8::Local<T>& value) {\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const v8::Local<T>& value,\n+                               const char* node_name) {\n   if (!value.IsEmpty())\n-    graph_->AddEdge(CurrentNode(), graph_->V8Node(value));\n+    graph_->AddEdge(CurrentNode(), graph_->V8Node(value), edge_name);\n }\n \n template <typename T>\n+void MemoryTracker::TrackField(const char* edge_name,\n+                               const MallocedBuffer<T>& value,\n+                               const char* node_name) {\n+  TrackFieldWithSize(edge_name, value.size, \"MallocedBuffer\");\n+}\n+\n+void MemoryTracker::TrackField(const char* name,\n+                               const uv_buf_t& value,\n+                               const char* node_name) {\n+  TrackFieldWithSize(name, value.len, \"uv_buf_t\");\n+}\n+\n void MemoryTracker::TrackField(const char* name,\n-                               const MallocedBuffer<T>& value) {\n-  TrackFieldWithSize(name, value.size);\n+                               const uv_timer_t& value,\n+                               const char* node_name) {\n+  TrackFieldWithSize(name, sizeof(value), \"uv_timer_t\");\n }\n \n-void MemoryTracker::TrackField(const char* name, const uv_buf_t& value) {\n-  TrackFieldWithSize(name, value.len);\n+void MemoryTracker::TrackField(const char* name,\n+                               const uv_async_t& value,\n+                               const char* node_name) {\n+  TrackFieldWithSize(name, sizeof(value), \"uv_async_t\");\n }\n \n template <class NativeT, class V8T>\n void MemoryTracker::TrackField(const char* name,\n-                       const AliasedBuffer<NativeT, V8T>& value) {\n-  TrackField(name, value.GetJSArray());\n+                               const AliasedBuffer<NativeT, V8T>& value,\n+                               const char* node_name) {\n+  TrackField(name, value.GetJSArray(), \"AliasedBuffer\");\n }\n \n-void MemoryTracker::Track(const MemoryRetainer* value, const char* name) {\n+void MemoryTracker::Track(const MemoryRetainer* retainer,\n+                          const char* edge_name) {\n   v8::HandleScope handle_scope(isolate_);\n-  MemoryRetainerNode* n = PushNode(name, value);\n-  value->MemoryInfo(this);\n+  auto it = seen_.find(retainer);\n+  if (it != seen_.end()) {\n+    if (CurrentNode() != nullptr) {\n+      graph_->AddEdge(CurrentNode(), it->second, edge_name);\n+    }\n+    return;  // It has already been tracked, no need to call MemoryInfo again\n+  }\n+  MemoryRetainerNode* n = PushNode(retainer, edge_name);\n+  retainer->MemoryInfo(this);\n   CHECK_EQ(CurrentNode(), n);\n   CHECK_NE(n->size_, 0);\n   PopNode();\n@@ -162,27 +246,48 @@ MemoryRetainerNode* MemoryTracker::CurrentNode() const {\n   return node_stack_.top();\n }\n \n-MemoryRetainerNode* MemoryTracker::AddNode(\n-    const char* name, const MemoryRetainer* retainer) {\n-  MemoryRetainerNode* n = new MemoryRetainerNode(this, retainer, name);\n-  graph_->AddNode(std::unique_ptr<v8::EmbedderGraph::Node>(n));\n-  if (retainer != nullptr)\n-    seen_[retainer] = n;\n+MemoryRetainerNode* MemoryTracker::AddNode(const MemoryRetainer* retainer,\n+                                           const char* edge_name) {\n+  auto it = seen_.find(retainer);\n+  if (it != seen_.end()) {\n+    return it->second;\n+  }\n \n-  if (CurrentNode() != nullptr)\n-    graph_->AddEdge(CurrentNode(), n);\n+  MemoryRetainerNode* n = new MemoryRetainerNode(this, retainer);\n+  graph_->AddNode(std::unique_ptr<v8::EmbedderGraph::Node>(n));\n+  seen_[retainer] = n;\n+  if (CurrentNode() != nullptr) graph_->AddEdge(CurrentNode(), n, edge_name);\n \n   if (n->JSWrapperNode() != nullptr) {\n-    graph_->AddEdge(n, n->JSWrapperNode());\n-    graph_->AddEdge(n->JSWrapperNode(), n);\n+    graph_->AddEdge(n, n->JSWrapperNode(), \"wrapped\");\n+    graph_->AddEdge(n->JSWrapperNode(), n, \"wrapper\");\n   }\n \n   return n;\n }\n \n-MemoryRetainerNode* MemoryTracker::PushNode(\n-    const char* name, const MemoryRetainer* retainer) {\n-  MemoryRetainerNode* n = AddNode(name, retainer);\n+MemoryRetainerNode* MemoryTracker::AddNode(const char* node_name,\n+                                           size_t size,\n+                                           const char* edge_name) {\n+  MemoryRetainerNode* n = new MemoryRetainerNode(this, node_name, size);\n+  graph_->AddNode(std::unique_ptr<v8::EmbedderGraph::Node>(n));\n+\n+  if (CurrentNode() != nullptr) graph_->AddEdge(CurrentNode(), n, edge_name);\n+\n+  return n;\n+}\n+\n+MemoryRetainerNode* MemoryTracker::PushNode(const MemoryRetainer* retainer,\n+                                            const char* edge_name) {\n+  MemoryRetainerNode* n = AddNode(retainer, edge_name);\n+  node_stack_.push(n);\n+  return n;\n+}\n+\n+MemoryRetainerNode* MemoryTracker::PushNode(const char* node_name,\n+                                            size_t size,\n+                                            const char* edge_name) {\n+  MemoryRetainerNode* n = AddNode(node_name, size, edge_name);\n   node_stack_.push(n);\n   return n;\n }"
        },
        {
            "sha": "1799279212880940040cef3fc5c1ed5950989193",
            "filename": "src/memory_tracker.h",
            "status": "modified",
            "additions": 161,
            "deletions": 35,
            "changes": 196,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fmemory_tracker.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fmemory_tracker.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fmemory_tracker.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -14,68 +14,189 @@\n \n namespace node {\n \n+// Set the node name of a MemoryRetainer to klass\n+#define SET_MEMORY_INFO_NAME(Klass)                                            \\\n+  inline std::string MemoryInfoName() const override { return #Klass; }\n+\n+// Set the self size of a MemoryRetainer to the stack-allocated size of a\n+// certain class\n+#define SET_SELF_SIZE(Klass)                                                   \\\n+  inline size_t SelfSize() const override { return sizeof(Klass); }\n+\n+// Used when there is no additional fields to track\n+#define SET_NO_MEMORY_INFO()                                                   \\\n+  inline void MemoryInfo(node::MemoryTracker* tracker) const override {}\n+\n class MemoryTracker;\n class MemoryRetainerNode;\n \n namespace crypto {\n class NodeBIO;\n }\n \n+/* Example:\n+ *\n+ * class ExampleRetainer : public MemoryRetainer {\n+ *   public:\n+ *     // Or use SET_NO_MEMORY_INFO() when there is no additional fields\n+ *     // to track.\n+ *     void MemoryInfo(MemoryTracker* tracker) const override {\n+ *       // Node name and size comes from the MemoryInfoName and SelfSize of\n+ *       // AnotherRetainerClass\n+ *       tracker->TrackField(\"another_retainer\", another_retainer_);\n+ *       // Specify node name and size explicitly\n+ *       tracker->TrackFieldWithSize(\"internal_member\",\n+ *                                   internal_member_.size(),\n+ *                                   \"InternalClass\");\n+ *       // Node name falls back to the edge name,\n+ *       // elements in the container appear as grandchildren nodes\n+ *       tracker->TrackField(\"vector\", vector_);\n+ *       // Node name and size come from the JS object\n+ *       tracker->TrackField(\"target\", target_);\n+ *     }\n+ *\n+ *     // Or use SET_MEMORY_INFO_NAME(ExampleRetainer)\n+ *     std::string MemoryInfoName() const override {\n+ *       return \"ExampleRetainer\";\n+ *     }\n+ *\n+ *     // Or use SET_SELF_SIZE(ExampleRetainer)\n+ *     size_t SelfSize() const override {\n+ *       return sizeof(ExampleRetainer);\n+ *     }\n+ *\n+ *     // Note: no need to implement these two methods when implementing\n+ *     // a BaseObject or an AsyncWrap class\n+ *     bool IsRootNode() const override { return !wrapped_.IsWeak(); }\n+ *     v8::Local<v8::Object> WrappedObject() const override {\n+ *       return node::PersistentToLocal(wrapped_);\n+ *     }\n+ *   private:\n+ *     AnotherRetainerClass another_retainer_;\n+ *     InternalClass internal_member_;\n+ *     std::vector<uv_async_t> vector_;\n+ *     node::Persistent<Object> target_;\n+ *\n+ *     node::Persistent<Object> wrapped_;\n+ * }\n+ *\n+ * This creates the following graph:\n+ *   Node / ExampleRetainer\n+ *    |> another_retainer :: Node / AnotherRetainerClass\n+ *    |> internal_member :: Node / InternalClass\n+ *    |> vector :: Node / vector (elements will be grandchildren)\n+ *        |> [1] :: Node / uv_async_t (uv_async_t has predefined names)\n+ *        |> [2] :: Node / uv_async_t\n+ *        |> ...\n+ *    |> target :: TargetClass (JS class name of the target object)\n+ *    |> wrapped :: WrappedClass (JS class name of the wrapped object)\n+ *        |> wrapper :: Node / ExampleRetainer (back reference)\n+ */\n class MemoryRetainer {\n  public:\n   virtual ~MemoryRetainer() {}\n \n-  // Subclasses should implement this to provide information for heap snapshots.\n+  // Subclasses should implement these methods to provide information\n+  // for the V8 heap snapshot generator.\n+  // The MemoryInfo() method is assumed to be called within a context\n+  // where all the edges start from the node of the current retainer,\n+  // and point to the nodes as specified by tracker->Track* calls.\n   virtual void MemoryInfo(MemoryTracker* tracker) const = 0;\n+  virtual std::string MemoryInfoName() const = 0;\n+  virtual size_t SelfSize() const = 0;\n \n   virtual v8::Local<v8::Object> WrappedObject() const {\n     return v8::Local<v8::Object>();\n   }\n \n   virtual bool IsRootNode() const { return false; }\n-\n-  virtual std::string MemoryInfoName() const { return std::string(); }\n };\n \n class MemoryTracker {\n  public:\n+  // Used to specify node name and size explicitly\n+  inline void TrackFieldWithSize(const char* edge_name,\n+                                 size_t size,\n+                                 const char* node_name = nullptr);\n+  // Shortcut to extract the underlying object out of the smart pointer\n   template <typename T>\n-  inline void TrackThis(const T* obj);\n-\n-  inline void TrackFieldWithSize(const char* name, size_t size);\n-\n-  inline void TrackField(const char* name, const MemoryRetainer& value);\n-  inline void TrackField(const char* name, const MemoryRetainer* value);\n-  template <typename T>\n-  inline void TrackField(const char* name, const std::unique_ptr<T>& value);\n+  inline void TrackField(const char* edge_name,\n+                         const std::unique_ptr<T>& value,\n+                         const char* node_name = nullptr);\n+\n+  // For containers, the elements will be graphed as grandchildren nodes\n+  // if the container is not empty.\n+  // By default, we assume the parent count the stack size of the container\n+  // into its SelfSize so that will be subtracted from the parent size when we\n+  // spin off a new node for the container.\n+  // TODO(joyeecheung): use RTTI to retrieve the class name at runtime?\n   template <typename T, typename Iterator = typename T::const_iterator>\n-  inline void TrackField(const char* name, const T& value);\n+  inline void TrackField(const char* edge_name,\n+                         const T& value,\n+                         const char* node_name = nullptr,\n+                         const char* element_name = nullptr,\n+                         bool subtract_from_self = true);\n   template <typename T>\n-  inline void TrackField(const char* name, const std::queue<T>& value);\n-  template <typename T>\n-  inline void TrackField(const char* name, const std::basic_string<T>& value);\n-  template <typename T, typename test_for_number =\n-      typename std::enable_if<\n-          std::numeric_limits<T>::is_specialized, bool>::type,\n-      typename dummy = bool>\n-  inline void TrackField(const char* name, const T& value);\n+  inline void TrackField(const char* edge_name,\n+                         const std::queue<T>& value,\n+                         const char* node_name = nullptr,\n+                         const char* element_name = nullptr);\n   template <typename T, typename U>\n-  inline void TrackField(const char* name, const std::pair<T, U>& value);\n+  inline void TrackField(const char* edge_name,\n+                         const std::pair<T, U>& value,\n+                         const char* node_name = nullptr);\n+\n+  // For the following types, node_name will be ignored and predefined names\n+  // will be used instead. They are only in the signature for template\n+  // expansion.\n+  inline void TrackField(const char* edge_name,\n+                         const MemoryRetainer& value,\n+                         const char* node_name = nullptr);\n+  inline void TrackField(const char* edge_name,\n+                         const MemoryRetainer* value,\n+                         const char* node_name = nullptr);\n+  template <typename T>\n+  inline void TrackField(const char* edge_name,\n+                         const std::basic_string<T>& value,\n+                         const char* node_name = nullptr);\n+  template <typename T,\n+            typename test_for_number = typename std::\n+                enable_if<std::numeric_limits<T>::is_specialized, bool>::type,\n+            typename dummy = bool>\n+  inline void TrackField(const char* edge_name,\n+                         const T& value,\n+                         const char* node_name = nullptr);\n   template <typename T, typename Traits>\n-  inline void TrackField(const char* name,\n-                         const v8::Persistent<T, Traits>& value);\n+  inline void TrackField(const char* edge_name,\n+                         const v8::Persistent<T, Traits>& value,\n+                         const char* node_name = nullptr);\n   template <typename T>\n-  inline void TrackField(const char* name, const v8::Local<T>& value);\n+  inline void TrackField(const char* edge_name,\n+                         const v8::Local<T>& value,\n+                         const char* node_name = nullptr);\n   template <typename T>\n-  inline void TrackField(const char* name, const MallocedBuffer<T>& value);\n-  inline void TrackField(const char* name, const uv_buf_t& value);\n+  inline void TrackField(const char* edge_name,\n+                         const MallocedBuffer<T>& value,\n+                         const char* node_name = nullptr);\n+  inline void TrackField(const char* edge_name,\n+                         const uv_buf_t& value,\n+                         const char* node_name = nullptr);\n+  inline void TrackField(const char* edge_name,\n+                         const uv_timer_t& value,\n+                         const char* node_name = nullptr);\n+  inline void TrackField(const char* edge_name,\n+                         const uv_async_t& value,\n+                         const char* node_name = nullptr);\n   template <class NativeT, class V8T>\n-  inline void TrackField(const char* name,\n-                         const AliasedBuffer<NativeT, V8T>& value);\n+  inline void TrackField(const char* edge_name,\n+                         const AliasedBuffer<NativeT, V8T>& value,\n+                         const char* node_name = nullptr);\n \n-  inline void Track(const MemoryRetainer* value, const char* name = nullptr);\n+  // Put a memory container into the graph, create an edge from\n+  // the current node if there is one on the stack.\n+  inline void Track(const MemoryRetainer* retainer,\n+                    const char* edge_name = nullptr);\n \n-  inline void set_track_only_self(bool value) { track_only_self_ = value; }\n   inline v8::EmbedderGraph* graph() { return graph_; }\n   inline v8::Isolate* isolate() { return isolate_; }\n \n@@ -88,13 +209,18 @@ class MemoryTracker {\n       NodeMap;\n \n   inline MemoryRetainerNode* CurrentNode() const;\n-  inline MemoryRetainerNode* AddNode(const char* name,\n-                                     const MemoryRetainer* retainer = nullptr);\n-  inline MemoryRetainerNode* PushNode(const char* name,\n-                                      const MemoryRetainer* retainer = nullptr);\n+  inline MemoryRetainerNode* AddNode(const MemoryRetainer* retainer,\n+                                     const char* edge_name = nullptr);\n+  inline MemoryRetainerNode* PushNode(const MemoryRetainer* retainer,\n+                                      const char* edge_name = nullptr);\n+  inline MemoryRetainerNode* AddNode(const char* node_name,\n+                                     size_t size,\n+                                     const char* edge_name = nullptr);\n+  inline MemoryRetainerNode* PushNode(const char* node_name,\n+                                      size_t size,\n+                                      const char* edge_name = nullptr);\n   inline void PopNode();\n \n-  bool track_only_self_ = false;\n   v8::Isolate* isolate_;\n   v8::EmbedderGraph* graph_;\n   std::stack<MemoryRetainerNode*> node_stack_;"
        },
        {
            "sha": "d6593c48135d187298b94fa3efbcfe402486222c",
            "filename": "src/module_wrap.h",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fmodule_wrap.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fmodule_wrap.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fmodule_wrap.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -34,12 +34,12 @@ class ModuleWrap : public BaseObject {\n       v8::Local<v8::Object> meta);\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"url\", url_);\n     tracker->TrackField(\"resolve_cache\", resolve_cache_);\n   }\n \n-  ADD_MEMORY_INFO_NAME(ModuleWrap)\n+  SET_MEMORY_INFO_NAME(ModuleWrap)\n+  SET_SELF_SIZE(ModuleWrap)\n \n  private:\n   ModuleWrap(Environment* env,"
        },
        {
            "sha": "4239f07f061cc9038f39fc1414d08f5689225b9d",
            "filename": "src/node_contextify.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_contextify.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_contextify.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_contextify.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -590,13 +590,11 @@ class ContextifyScript : public BaseObject {\n  private:\n   Persistent<UnboundScript> script_;\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(ContextifyScript)\n-\n  public:\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(ContextifyScript)\n+  SET_SELF_SIZE(ContextifyScript)\n+\n   static void Init(Environment* env, Local<Object> target) {\n     HandleScope scope(env->isolate());\n     Local<String> class_name ="
        },
        {
            "sha": "acb61885f282131a4ed263450cef97ddb15c0afc",
            "filename": "src/node_crypto.h",
            "status": "modified",
            "additions": 28,
            "deletions": 35,
            "changes": 63,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_crypto.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_crypto.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -107,11 +107,10 @@ class SecureContext : public BaseObject {\n \n   static void Initialize(Environment* env, v8::Local<v8::Object> target);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(SecureContext)\n+  // TODO(joyeecheung): track the memory used by OpenSSL types\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(SecureContext)\n+  SET_SELF_SIZE(SecureContext)\n \n   SSLCtxPointer ctx_;\n   X509Pointer cert_;\n@@ -347,11 +346,10 @@ class CipherBase : public BaseObject {\n  public:\n   static void Initialize(Environment* env, v8::Local<v8::Object> target);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(CipherBase)\n+  // TODO(joyeecheung): track the memory used by OpenSSL types\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(CipherBase)\n+  SET_SELF_SIZE(CipherBase)\n \n  protected:\n   enum CipherKind {\n@@ -436,11 +434,10 @@ class Hmac : public BaseObject {\n  public:\n   static void Initialize(Environment* env, v8::Local<v8::Object> target);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(Hmac)\n+  // TODO(joyeecheung): track the memory used by OpenSSL types\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(Hmac)\n+  SET_SELF_SIZE(Hmac)\n \n  protected:\n   void HmacInit(const char* hash_type, const char* key, int key_len);\n@@ -465,11 +462,10 @@ class Hash : public BaseObject {\n  public:\n   static void Initialize(Environment* env, v8::Local<v8::Object> target);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(Hash)\n+  // TODO(joyeecheung): track the memory used by OpenSSL types\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(Hash)\n+  SET_SELF_SIZE(Hash)\n \n   bool HashInit(const char* hash_type);\n   bool HashUpdate(const char* data, int len);\n@@ -510,11 +506,10 @@ class SignBase : public BaseObject {\n   Error Init(const char* sign_type);\n   Error Update(const char* data, int len);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(SignBase)\n+  // TODO(joyeecheung): track the memory used by OpenSSL types\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(SignBase)\n+  SET_SELF_SIZE(SignBase)\n \n  protected:\n   void CheckThrow(Error error);\n@@ -628,11 +623,10 @@ class DiffieHellman : public BaseObject {\n     MakeWeak();\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(DiffieHellman)\n+  // TODO(joyeecheung): track the memory used by OpenSSL types\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(DiffieHellman)\n+  SET_SELF_SIZE(DiffieHellman)\n \n  private:\n   static void GetField(const v8::FunctionCallbackInfo<v8::Value>& args,\n@@ -659,11 +653,10 @@ class ECDH : public BaseObject {\n                                       char* data,\n                                       size_t len);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(ECDH)\n+  // TODO(joyeecheung): track the memory used by OpenSSL types\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(ECDH)\n+  SET_SELF_SIZE(ECDH)\n \n  protected:\n   ECDH(Environment* env, v8::Local<v8::Object> wrap, ECKeyPointer&& key)"
        },
        {
            "sha": "1c62fbbd3594059485fd72a5846e68e4ea18d8d6",
            "filename": "src/node_crypto_bio.h",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_crypto_bio.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_crypto_bio.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto_bio.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -108,11 +108,11 @@ class NodeBIO : public MemoryRetainer {\n   static NodeBIO* FromBIO(BIO* bio);\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-    tracker->TrackFieldWithSize(\"buffer\", length_);\n+    tracker->TrackFieldWithSize(\"buffer\", length_, \"NodeBIO::Buffer\");\n   }\n \n-  ADD_MEMORY_INFO_NAME(NodeBIO)\n+  SET_MEMORY_INFO_NAME(NodeBIO)\n+  SET_SELF_SIZE(NodeBIO)\n \n  private:\n   static int New(BIO* bio);"
        },
        {
            "sha": "5b102269258e0bcb27790dd0ad010337b5385ce7",
            "filename": "src/node_file.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_file.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_file.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -277,6 +277,10 @@ void FileHandle::AfterClose() {\n     EmitRead(UV_EOF);\n }\n \n+void FileHandleReadWrap::MemoryInfo(MemoryTracker* tracker) const {\n+  tracker->TrackField(\"buffer\", buffer_);\n+  tracker->TrackField(\"file_handle\", this->file_handle_);\n+}\n \n FileHandleReadWrap::FileHandleReadWrap(FileHandle* handle, Local<Object> obj)\n   : ReqWrap(handle->env(), obj, AsyncWrap::PROVIDER_FSREQCALLBACK),"
        },
        {
            "sha": "31242e1a1b1055959d3c55cc7392b4c40b94512c",
            "filename": "src/node_file.h",
            "status": "modified",
            "additions": 14,
            "deletions": 15,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_file.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_file.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -53,10 +53,12 @@ class FSContinuationData : public MemoryRetainer {\n   }\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"paths\", paths);\n   }\n \n+  SET_MEMORY_INFO_NAME(FSContinuationData)\n+  SET_SELF_SIZE(FSContinuationData)\n+\n  private:\n   uv_fs_cb done_cb;\n };\n@@ -136,11 +138,11 @@ class FSReqCallback : public FSReqBase {\n   void SetReturnValue(const FunctionCallbackInfo<Value>& args) override;\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"continuation_data\", continuation_data);\n   }\n \n-  ADD_MEMORY_INFO_NAME(FSReqCallback)\n+  SET_MEMORY_INFO_NAME(FSReqCallback)\n+  SET_SELF_SIZE(FSReqCallback)\n \n  private:\n   DISALLOW_COPY_AND_ASSIGN(FSReqCallback);\n@@ -201,12 +203,12 @@ class FSReqPromise : public FSReqBase {\n   }\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"stats_field_array\", stats_field_array_);\n     tracker->TrackField(\"continuation_data\", continuation_data);\n   }\n \n-  ADD_MEMORY_INFO_NAME(FSReqPromise)\n+  SET_MEMORY_INFO_NAME(FSReqPromise)\n+  SET_SELF_SIZE(FSReqPromise)\n \n  private:\n   bool finished_ = false;\n@@ -242,12 +244,9 @@ class FileHandleReadWrap : public ReqWrap<uv_fs_t> {\n     return static_cast<FileHandleReadWrap*>(ReqWrap::from_req(req));\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-    tracker->TrackField(\"buffer\", buffer_);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(FileHandleReadWrap)\n+  void MemoryInfo(MemoryTracker* tracker) const override;\n+  SET_MEMORY_INFO_NAME(FileHandleReadWrap)\n+  SET_SELF_SIZE(FileHandleReadWrap)\n \n  private:\n   FileHandle* file_handle_;\n@@ -296,11 +295,11 @@ class FileHandle : public AsyncWrap, public StreamBase {\n   }\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"current_read\", current_read_);\n   }\n \n-  ADD_MEMORY_INFO_NAME(FileHandle)\n+  SET_MEMORY_INFO_NAME(FileHandle)\n+  SET_SELF_SIZE(FileHandle)\n \n  private:\n   // Synchronous close that emits a warning\n@@ -329,12 +328,12 @@ class FileHandle : public AsyncWrap, public StreamBase {\n     FileHandle* file_handle();\n \n     void MemoryInfo(MemoryTracker* tracker) const override {\n-      tracker->TrackThis(this);\n       tracker->TrackField(\"promise\", promise_);\n       tracker->TrackField(\"ref\", ref_);\n     }\n \n-    ADD_MEMORY_INFO_NAME(CloseReq)\n+    SET_MEMORY_INFO_NAME(CloseReq)\n+    SET_SELF_SIZE(CloseReq)\n \n     void Resolve();\n "
        },
        {
            "sha": "44353e2d57414cb2d1d01f198ab3df8f757ac6da",
            "filename": "src/node_http2.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_http2.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_http2.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http2.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -2897,15 +2897,13 @@ void Http2Session::Http2Ping::Done(bool ack, const uint8_t* payload) {\n \n \n void nghttp2_stream_write::MemoryInfo(MemoryTracker* tracker) const {\n-  tracker->TrackThis(this);\n   if (req_wrap != nullptr)\n     tracker->TrackField(\"req_wrap\", req_wrap->GetAsyncWrap());\n   tracker->TrackField(\"buf\", buf);\n }\n \n \n void nghttp2_header::MemoryInfo(MemoryTracker* tracker) const {\n-  tracker->TrackThis(this);\n   tracker->TrackFieldWithSize(\"name\", nghttp2_rcbuf_get_buf(name).len);\n   tracker->TrackFieldWithSize(\"value\", nghttp2_rcbuf_get_buf(value).len);\n }"
        },
        {
            "sha": "2ab452bf02aaa8afffde99b86b83e40a3e5fd662",
            "filename": "src/node_http2.h",
            "status": "modified",
            "additions": 12,
            "deletions": 8,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_http2.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_http2.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http2.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -92,6 +92,8 @@ struct nghttp2_stream_write : public MemoryRetainer {\n       req_wrap(req), buf(buf_) {}\n \n   void MemoryInfo(MemoryTracker* tracker) const override;\n+  SET_MEMORY_INFO_NAME(nghttp2_stream_write)\n+  SET_SELF_SIZE(nghttp2_stream_write)\n };\n \n struct nghttp2_header : public MemoryRetainer {\n@@ -100,6 +102,8 @@ struct nghttp2_header : public MemoryRetainer {\n   uint8_t flags = 0;\n \n   void MemoryInfo(MemoryTracker* tracker) const override;\n+  SET_MEMORY_INFO_NAME(nghttp2_header)\n+  SET_SELF_SIZE(nghttp2_header)\n };\n \n \n@@ -570,12 +574,12 @@ class Http2Stream : public AsyncWrap,\n               uv_stream_t* send_handle) override;\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"current_headers\", current_headers_);\n     tracker->TrackField(\"queue\", queue_);\n   }\n \n-  ADD_MEMORY_INFO_NAME(Http2Stream)\n+  SET_MEMORY_INFO_NAME(Http2Stream)\n+  SET_SELF_SIZE(Http2Stream)\n \n   std::string diagnostic_name() const override;\n \n@@ -755,7 +759,6 @@ class Http2Session : public AsyncWrap, public StreamListener {\n   ssize_t Write(const uv_buf_t* bufs, size_t nbufs);\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"streams\", streams_);\n     tracker->TrackField(\"outstanding_pings\", outstanding_pings_);\n     tracker->TrackField(\"outstanding_settings\", outstanding_settings_);\n@@ -765,7 +768,8 @@ class Http2Session : public AsyncWrap, public StreamListener {\n                                 pending_rst_streams_.size() * sizeof(int32_t));\n   }\n \n-  ADD_MEMORY_INFO_NAME(Http2Session)\n+  SET_MEMORY_INFO_NAME(Http2Session)\n+  SET_SELF_SIZE(Http2Session)\n \n   std::string diagnostic_name() const override;\n \n@@ -1085,11 +1089,11 @@ class Http2Session::Http2Ping : public AsyncWrap {\n   explicit Http2Ping(Http2Session* session);\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"session\", session_);\n   }\n \n-  ADD_MEMORY_INFO_NAME(Http2Ping)\n+  SET_MEMORY_INFO_NAME(Http2Ping)\n+  SET_SELF_SIZE(Http2Ping)\n \n   void Send(uint8_t* payload);\n   void Done(bool ack, const uint8_t* payload = nullptr);\n@@ -1110,11 +1114,11 @@ class Http2Session::Http2Settings : public AsyncWrap {\n   explicit Http2Settings(Http2Session* session);\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"session\", session_);\n   }\n \n-  ADD_MEMORY_INFO_NAME(Http2Settings)\n+  SET_MEMORY_INFO_NAME(Http2Settings)\n+  SET_SELF_SIZE(Http2Settings)\n \n   void Send();\n   void Done(bool ack);"
        },
        {
            "sha": "5d093b27c39d3c293c1c7dc79d216ded747fe39b",
            "filename": "src/node_http_parser.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_http_parser.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_http_parser.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http_parser.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -157,11 +157,11 @@ class Parser : public AsyncWrap, public StreamListener {\n \n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"current_buffer\", current_buffer_);\n   }\n \n-  ADD_MEMORY_INFO_NAME(Parser)\n+  SET_MEMORY_INFO_NAME(Parser)\n+  SET_SELF_SIZE(Parser)\n \n   int on_message_begin() {\n     num_fields_ = num_values_ = 0;"
        },
        {
            "sha": "5966e3ff678e34ca3a02a6eeebfbfdcd6078ea63",
            "filename": "src/node_i18n.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_i18n.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_i18n.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_i18n.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -251,11 +251,9 @@ class ConverterObject : public BaseObject, Converter {\n     args.GetReturnValue().Set(status);\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(ConverterObject)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(ConverterObject)\n+  SET_SELF_SIZE(ConverterObject)\n \n  protected:\n   ConverterObject(Environment* env,"
        },
        {
            "sha": "a8b95401fdf06c145e33c079897835c93853d0eb",
            "filename": "src/node_messaging.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_messaging.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_messaging.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_messaging.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -326,7 +326,6 @@ Maybe<bool> Message::Serialize(Environment* env,\n }\n \n void Message::MemoryInfo(MemoryTracker* tracker) const {\n-  tracker->TrackThis(this);\n   tracker->TrackField(\"array_buffer_contents\", array_buffer_contents_);\n   tracker->TrackFieldWithSize(\"shared_array_buffers\",\n       shared_array_buffers_.size() * sizeof(shared_array_buffers_[0]));\n@@ -342,7 +341,6 @@ MessagePortData::~MessagePortData() {\n \n void MessagePortData::MemoryInfo(MemoryTracker* tracker) const {\n   Mutex::ScopedLock lock(mutex_);\n-  tracker->TrackThis(this);\n   tracker->TrackField(\"incoming_messages\", incoming_messages_);\n }\n "
        },
        {
            "sha": "e4674885d2b89ecdc07a7c22fbda54ccb1e68811",
            "filename": "src/node_messaging.h",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_messaging.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_messaging.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_messaging.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -57,7 +57,8 @@ class Message : public MemoryRetainer {\n \n   void MemoryInfo(MemoryTracker* tracker) const override;\n \n-  ADD_MEMORY_INFO_NAME(Message)\n+  SET_MEMORY_INFO_NAME(Message)\n+  SET_SELF_SIZE(Message)\n \n  private:\n   MallocedBuffer<char> main_message_buf_;\n@@ -100,7 +101,8 @@ class MessagePortData : public MemoryRetainer {\n \n   void MemoryInfo(MemoryTracker* tracker) const override;\n \n-  ADD_MEMORY_INFO_NAME(MessagePortData)\n+  SET_MEMORY_INFO_NAME(MessagePortData)\n+  SET_SELF_SIZE(MessagePortData)\n \n  private:\n   // After disentangling this message port, the owner handle (if any)\n@@ -187,11 +189,11 @@ class MessagePort : public HandleWrap {\n   inline bool IsDetached() const;\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"data\", data_);\n   }\n \n-  ADD_MEMORY_INFO_NAME(MessagePort)\n+  SET_MEMORY_INFO_NAME(MessagePort)\n+  SET_SELF_SIZE(MessagePort)\n \n  private:\n   void OnClose() override;"
        },
        {
            "sha": "bb7890a7300e161e4c2e167229d541028cd63c01",
            "filename": "src/node_serdes.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 10,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_serdes.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_serdes.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_serdes.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -53,11 +53,9 @@ class SerializerContext : public BaseObject,\n   static void WriteDouble(const FunctionCallbackInfo<Value>& args);\n   static void WriteRawBytes(const FunctionCallbackInfo<Value>& args);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(SerializerContext)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(SerializerContext)\n+  SET_SELF_SIZE(SerializerContext)\n \n  private:\n   ValueSerializer serializer_;\n@@ -84,11 +82,9 @@ class DeserializerContext : public BaseObject,\n   static void ReadDouble(const FunctionCallbackInfo<Value>& args);\n   static void ReadRawBytes(const FunctionCallbackInfo<Value>& args);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(DeserializerContext)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(DeserializerContext)\n+  SET_SELF_SIZE(DeserializerContext)\n \n  private:\n   const uint8_t* data_;"
        },
        {
            "sha": "3d819b45787e9816a2456347e0312634db677d04",
            "filename": "src/node_stat_watcher.h",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_stat_watcher.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_stat_watcher.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_stat_watcher.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -44,11 +44,9 @@ class StatWatcher : public HandleWrap {\n   static void New(const v8::FunctionCallbackInfo<v8::Value>& args);\n   static void Start(const v8::FunctionCallbackInfo<v8::Value>& args);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(StatWatcher)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(StatWatcher)\n+  SET_SELF_SIZE(StatWatcher)\n \n  private:\n   static void Callback(uv_fs_poll_t* handle,"
        },
        {
            "sha": "6530bdb04c44e812936ad62567829b440f638822",
            "filename": "src/node_trace_events.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_trace_events.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_trace_events.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_trace_events.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -27,11 +27,11 @@ class NodeCategorySet : public BaseObject {\n   const std::set<std::string>& GetCategories() const { return categories_; }\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"categories\", categories_);\n   }\n \n-  ADD_MEMORY_INFO_NAME(NodeCategorySet)\n+  SET_MEMORY_INFO_NAME(NodeCategorySet)\n+  SET_SELF_SIZE(NodeCategorySet)\n \n  private:\n   NodeCategorySet(Environment* env,"
        },
        {
            "sha": "cbd4a861570b272207979d50484ff4e832046405",
            "filename": "src/node_worker.h",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_worker.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_worker.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_worker.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -26,15 +26,15 @@ class Worker : public AsyncWrap {\n   void JoinThread();\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-    tracker->TrackFieldWithSize(\"isolate_data\", sizeof(IsolateData));\n-    tracker->TrackFieldWithSize(\"env\", sizeof(Environment));\n-    tracker->TrackFieldWithSize(\"thread_exit_async\", sizeof(uv_async_t));\n+    tracker->TrackFieldWithSize(\n+        \"isolate_data\", sizeof(IsolateData), \"IsolateData\");\n+    tracker->TrackFieldWithSize(\"env\", sizeof(Environment), \"Environment\");\n+    tracker->TrackField(\"thread_exit_async\", *thread_exit_async_);\n     tracker->TrackField(\"parent_port\", parent_port_);\n   }\n \n-\n-  ADD_MEMORY_INFO_NAME(Worker)\n+  SET_MEMORY_INFO_NAME(Worker)\n+  SET_SELF_SIZE(Worker)\n \n   bool is_stopped() const;\n "
        },
        {
            "sha": "6e99f68108730f4a7836dfa306c1d652750feab8",
            "filename": "src/node_zlib.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_zlib.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fnode_zlib.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_zlib.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -661,14 +661,13 @@ class ZCtx : public AsyncWrap, public ThreadPoolWork {\n   }\n \n   void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n     tracker->TrackField(\"dictionary\", dictionary_);\n-    tracker->TrackFieldWithSize(\"zlib memory\",\n-        zlib_memory_ + unreported_allocations_);\n+    tracker->TrackFieldWithSize(\"zlib_memory\",\n+                                zlib_memory_ + unreported_allocations_);\n   }\n \n-\n-  ADD_MEMORY_INFO_NAME(ZCtx)\n+  SET_MEMORY_INFO_NAME(ZCtx)\n+  SET_SELF_SIZE(ZCtx)\n \n  private:\n   void Ref() {"
        },
        {
            "sha": "05a5ba6e113a1866c9fe407e6e5ccaef151b0b1b",
            "filename": "src/pipe_wrap.h",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fpipe_wrap.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fpipe_wrap.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fpipe_wrap.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -45,11 +45,9 @@ class PipeWrap : public ConnectionWrap<PipeWrap, uv_pipe_t> {\n                          v8::Local<v8::Value> unused,\n                          v8::Local<v8::Context> context);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(PipeWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(PipeWrap)\n+  SET_SELF_SIZE(PipeWrap)\n \n  private:\n   PipeWrap(Environment* env,"
        },
        {
            "sha": "edf79177d32502ce21509f1807ea6f6fd1538858",
            "filename": "src/process_wrap.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fprocess_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fprocess_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fprocess_wrap.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -66,11 +66,9 @@ class ProcessWrap : public HandleWrap {\n                 constructor->GetFunction(context).ToLocalChecked());\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(ProcessWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(ProcessWrap)\n+  SET_SELF_SIZE(ProcessWrap)\n \n  private:\n   static void New(const FunctionCallbackInfo<Value>& args) {"
        },
        {
            "sha": "b20d9f46a44d5ea8b102840aba05369525dd4499",
            "filename": "src/sharedarraybuffer_metadata.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fsharedarraybuffer_metadata.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fsharedarraybuffer_metadata.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fsharedarraybuffer_metadata.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -47,11 +47,9 @@ class SABLifetimePartner : public BaseObject {\n     MakeWeak();\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(SABLifetimePartner)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(SABLifetimePartner)\n+  SET_SELF_SIZE(SABLifetimePartner)\n \n   SharedArrayBufferMetadataReference reference;\n };"
        },
        {
            "sha": "afdf140d8b07c329e6965477a3dffaecc358441f",
            "filename": "src/signal_wrap.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fsignal_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fsignal_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fsignal_wrap.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -59,11 +59,9 @@ class SignalWrap : public HandleWrap {\n                 constructor->GetFunction(env->context()).ToLocalChecked());\n   }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(SignalWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(SignalWrap)\n+  SET_SELF_SIZE(SignalWrap)\n \n  private:\n   static void New(const FunctionCallbackInfo<Value>& args) {"
        },
        {
            "sha": "d8e6df960f4f5444ee4e5a402003594ae60f919a",
            "filename": "src/stream_base.h",
            "status": "modified",
            "additions": 6,
            "deletions": 12,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fstream_base.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fstream_base.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_base.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -347,11 +347,9 @@ class SimpleShutdownWrap : public ShutdownWrap, public OtherBase {\n \n   AsyncWrap* GetAsyncWrap() override { return this; }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(SimpleShutdownWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(SimpleShutdownWrap)\n+  SET_SELF_SIZE(SimpleShutdownWrap)\n };\n \n template <typename OtherBase>\n@@ -362,13 +360,9 @@ class SimpleWriteWrap : public WriteWrap, public OtherBase {\n \n   AsyncWrap* GetAsyncWrap() override { return this; }\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-    tracker->TrackFieldWithSize(\"storage\", StorageSize());\n-  }\n-\n-\n-  ADD_MEMORY_INFO_NAME(SimpleWriteWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(SimpleWriteWrap)\n+  SET_SELF_SIZE(SimpleWriteWrap)\n };\n \n }  // namespace node"
        },
        {
            "sha": "51a33b7ef69776beb59c510e02ce3bc96ebd435b",
            "filename": "src/stream_pipe.h",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fstream_pipe.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fstream_pipe.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_pipe.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -18,11 +18,9 @@ class StreamPipe : public AsyncWrap {\n   static void Start(const v8::FunctionCallbackInfo<v8::Value>& args);\n   static void Unpipe(const v8::FunctionCallbackInfo<v8::Value>& args);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(StreamPipe)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(StreamPipe)\n+  SET_SELF_SIZE(StreamPipe)\n \n  private:\n   inline StreamBase* source();"
        },
        {
            "sha": "90c81bcae6fd6f5b9b8734d06f2c0058bfff5188",
            "filename": "src/tcp_wrap.h",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftcp_wrap.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftcp_wrap.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftcp_wrap.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -44,10 +44,8 @@ class TCPWrap : public ConnectionWrap<TCPWrap, uv_tcp_t> {\n                          v8::Local<v8::Value> unused,\n                          v8::Local<v8::Context> context);\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n+  SET_NO_MEMORY_INFO()\n+  SET_SELF_SIZE(TCPWrap)\n   std::string MemoryInfoName() const override {\n     switch (provider_type()) {\n       case ProviderType::PROVIDER_TCPWRAP:"
        },
        {
            "sha": "3dbeabd891ad2057e0da8ec77f4134caf8cabc8a",
            "filename": "src/tls_wrap.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftls_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftls_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftls_wrap.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -858,7 +858,6 @@ void TLSWrap::GetWriteQueueSize(const FunctionCallbackInfo<Value>& info) {\n \n \n void TLSWrap::MemoryInfo(MemoryTracker* tracker) const {\n-  tracker->TrackThis(this);\n   tracker->TrackField(\"error\", error_);\n   tracker->TrackField(\"pending_cleartext_input\", pending_cleartext_input_);\n   if (enc_in_ != nullptr)"
        },
        {
            "sha": "0e265764822f293e174bfbc4e5d3259474a85a46",
            "filename": "src/tls_wrap.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftls_wrap.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftls_wrap.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftls_wrap.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -78,7 +78,8 @@ class TLSWrap : public AsyncWrap,\n \n   void MemoryInfo(MemoryTracker* tracker) const override;\n \n-  ADD_MEMORY_INFO_NAME(TLSWrap)\n+  SET_MEMORY_INFO_NAME(TLSWrap)\n+  SET_SELF_SIZE(TLSWrap)\n \n  protected:\n   inline StreamBase* underlying_stream() {"
        },
        {
            "sha": "ad5f364134e3e2af432ab3d9e7c84fa4e54837cf",
            "filename": "src/tty_wrap.h",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftty_wrap.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftty_wrap.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftty_wrap.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -38,11 +38,9 @@ class TTYWrap : public LibuvStreamWrap {\n \n   uv_tty_t* UVHandle();\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(TTYWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(TTYWrap)\n+  SET_SELF_SIZE(TTYWrap)\n \n  private:\n   TTYWrap(Environment* env,"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "src/txt",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftxt",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Ftxt",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Ftxt?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897"
        },
        {
            "sha": "92fc036778f9984d125306246231f6ccec452a59",
            "filename": "src/udp_wrap.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fudp_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fudp_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fudp_wrap.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -56,11 +56,9 @@ class SendWrap : public ReqWrap<uv_udp_send_t> {\n   inline bool have_callback() const;\n   size_t msg_size;\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(SendWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(SendWrap)\n+  SET_SELF_SIZE(SendWrap)\n \n  private:\n   const bool have_callback_;"
        },
        {
            "sha": "030abdf74d958d5c4cea8b4e129669ab1a1de771",
            "filename": "src/udp_wrap.h",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fudp_wrap.h",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/src%2Fudp_wrap.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fudp_wrap.h?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -65,11 +65,9 @@ class UDPWrap: public HandleWrap {\n                                            SocketType type);\n   uv_udp_t* UVHandle();\n \n-  void MemoryInfo(MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n-\n-  ADD_MEMORY_INFO_NAME(UDPWrap)\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(UDPWrap)\n+  SET_SELF_SIZE(UDPWrap)\n \n  private:\n   typedef uv_udp_t HandleType;"
        },
        {
            "sha": "79b766939b9d0d050b3173a6e6ff5b1e589b2177",
            "filename": "test/cctest/test_node_postmortem_metadata.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fcctest%2Ftest_node_postmortem_metadata.cc",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fcctest%2Ftest_node_postmortem_metadata.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcctest%2Ftest_node_postmortem_metadata.cc?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -34,9 +34,9 @@ class DebugSymbolsTest : public EnvironmentTestFixture {};\n \n class TestHandleWrap : public node::HandleWrap {\n  public:\n-  void MemoryInfo(node::MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(TestHandleWrap)\n+  SET_SELF_SIZE(TestHandleWrap)\n \n   TestHandleWrap(node::Environment* env,\n                  v8::Local<v8::Object> object,\n@@ -50,9 +50,9 @@ class TestHandleWrap : public node::HandleWrap {\n \n class TestReqWrap : public node::ReqWrap<uv_req_t> {\n  public:\n-  void MemoryInfo(node::MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(TestReqWrap)\n+  SET_SELF_SIZE(TestReqWrap)\n \n   TestReqWrap(node::Environment* env, v8::Local<v8::Object> object)\n       : node::ReqWrap<uv_req_t>(env,\n@@ -76,9 +76,9 @@ class DummyBaseObject : public node::BaseObject {\n   DummyBaseObject(node::Environment* env, v8::Local<v8::Object> obj) :\n     BaseObject(env, obj) {}\n \n-  void MemoryInfo(node::MemoryTracker* tracker) const override {\n-    tracker->TrackThis(this);\n-  }\n+  SET_NO_MEMORY_INFO()\n+  SET_MEMORY_INFO_NAME(DummyBaseObject)\n+  SET_SELF_SIZE(DummyBaseObject)\n };\n \n TEST_F(DebugSymbolsTest, BaseObjectPersistentHandle) {"
        },
        {
            "sha": "e23670b64c8a2dba035adfc7d585d452e165181d",
            "filename": "test/common/heap.js",
            "status": "modified",
            "additions": 72,
            "deletions": 40,
            "changes": 112,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fcommon%2Fheap.js",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fcommon%2Fheap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Fheap.js?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -12,75 +12,107 @@ try {\n }\n const { createJSHeapDump, buildEmbedderGraph } = internalTestHeap;\n \n+function inspectNode(snapshot) {\n+  return util.inspect(snapshot, { depth: 4 });\n+}\n+\n+function isEdge(edge, { node_name, edge_name }) {\n+  if (edge.name !== edge_name) {\n+    return false;\n+  }\n+  // From our internal embedded graph\n+  if (edge.to.value) {\n+    if (edge.to.value.constructor.name !== node_name) {\n+      return false;\n+    }\n+  } else if (edge.to.name !== node_name) {\n+    return false;\n+  }\n+  return true;\n+}\n+\n class State {\n   constructor() {\n     this.snapshot = createJSHeapDump();\n     this.embedderGraph = buildEmbedderGraph();\n   }\n \n-  validateSnapshotNodes(name, expected, { loose = false } = {}) {\n-    const snapshot = this.snapshot.filter(\n-      (node) => node.name === 'Node / ' + name && node.type !== 'string');\n-    if (loose)\n-      assert(snapshot.length >= expected.length);\n-    else\n-      assert.strictEqual(snapshot.length, expected.length);\n-    for (const expectedNode of expected) {\n-      if (expectedNode.children) {\n-        for (const expectedChild of expectedNode.children) {\n-          const check = typeof expectedChild === 'function' ?\n-            expectedChild :\n-            (node) => [expectedChild.name, 'Node / ' + expectedChild.name]\n-              .includes(node.name);\n+  // Validate the v8 heap snapshot\n+  validateSnapshot(rootName, expected, { loose = false } = {}) {\n+    const rootNodes = this.snapshot.filter(\n+      (node) => node.name === rootName && node.type !== 'string');\n+    if (loose) {\n+      assert(rootNodes.length >= expected.length,\n+             `Expect to find at least ${expected.length} '${rootName}', ` +\n+             `found ${rootNodes.length}`);\n+    } else {\n+      assert.strictEqual(\n+        rootNodes.length, expected.length,\n+        `Expect to find ${expected.length} '${rootName}', ` +\n+        `found ${rootNodes.length}`);\n+    }\n \n-          const hasChild = snapshot.some((node) => {\n-            return node.outgoingEdges.map((edge) => edge.toNode).some(check);\n-          });\n+    for (const expectation of expected) {\n+      if (expectation.children) {\n+        for (const expectedEdge of expectation.children) {\n+          const check = typeof expectedEdge === 'function' ? expectedEdge :\n+            (edge) => (isEdge(edge, expectedEdge));\n+          const hasChild = rootNodes.some(\n+            (node) => node.outgoingEdges.some(check)\n+          );\n           // Don't use assert with a custom message here. Otherwise the\n           // inspection in the message is done eagerly and wastes a lot of CPU\n           // time.\n           if (!hasChild) {\n             throw new Error(\n               'expected to find child ' +\n-              `${util.inspect(expectedChild)} in ${util.inspect(snapshot)}`);\n+              `${util.inspect(expectedEdge)} in ${inspectNode(rootNodes)}`);\n           }\n         }\n       }\n     }\n+  }\n \n-    const graph = this.embedderGraph.filter((node) => node.name === name);\n-    if (loose)\n-      assert(graph.length >= expected.length);\n-    else\n-      assert.strictEqual(graph.length, expected.length);\n-    for (const expectedNode of expected) {\n-      if (expectedNode.children) {\n-        for (const expectedChild of expectedNode.children) {\n-          const check = (edge) => {\n-            // TODO(joyeecheung): check the edge names\n-            const node = edge.to;\n-            if (typeof expectedChild === 'function') {\n-              return expectedChild(node);\n-            }\n-            return node.name === expectedChild.name ||\n-              (node.value &&\n-                node.value.constructor &&\n-                node.value.constructor.name === expectedChild.name);\n-          };\n-\n+  // Validate our internal embedded graph representation\n+  validateGraph(rootName, expected, { loose = false } = {}) {\n+    const rootNodes = this.embedderGraph.filter(\n+      (node) => node.name === rootName\n+    );\n+    if (loose) {\n+      assert(rootNodes.length >= expected.length,\n+             `Expect to find at least ${expected.length} '${rootName}', ` +\n+             `found ${rootNodes.length}`);\n+    } else {\n+      assert.strictEqual(\n+        rootNodes.length, expected.length,\n+        `Expect to find ${expected.length} '${rootName}', ` +\n+        `found ${rootNodes.length}`);\n+    }\n+    for (const expectation of expected) {\n+      if (expectation.children) {\n+        for (const expectedEdge of expectation.children) {\n+          const check = typeof expectedEdge === 'function' ? expectedEdge :\n+            (edge) => (isEdge(edge, expectedEdge));\n           // Don't use assert with a custom message here. Otherwise the\n           // inspection in the message is done eagerly and wastes a lot of CPU\n           // time.\n-          const hasChild = graph.some((node) => node.edges.some(check));\n+          const hasChild = rootNodes.some(\n+            (node) => node.edges.some(check)\n+          );\n           if (!hasChild) {\n             throw new Error(\n               'expected to find child ' +\n-              `${util.inspect(expectedChild)} in ${util.inspect(snapshot)}`);\n+              `${util.inspect(expectedEdge)} in ${inspectNode(rootNodes)}`);\n           }\n         }\n       }\n     }\n   }\n+\n+  validateSnapshotNodes(rootName, expected, { loose = false } = {}) {\n+    this.validateSnapshot(rootName, expected, { loose });\n+    this.validateGraph(rootName, expected, { loose });\n+  }\n }\n \n function recordState() {"
        },
        {
            "sha": "6fe79f7dd4ec5a9a5b2661a027daceaf4e89318b",
            "filename": "test/parallel/test-heapdump-dns.js",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-dns.js",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-dns.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-heapdump-dns.js?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -3,16 +3,16 @@\n require('../common');\n const { validateSnapshotNodes } = require('../common/heap');\n \n-validateSnapshotNodes('ChannelWrap', []);\n+validateSnapshotNodes('Node / ChannelWrap', []);\n const dns = require('dns');\n-validateSnapshotNodes('ChannelWrap', [{}]);\n+validateSnapshotNodes('Node / ChannelWrap', [{}]);\n dns.resolve('localhost', () => {});\n-validateSnapshotNodes('ChannelWrap', [\n+validateSnapshotNodes('Node / ChannelWrap', [\n   {\n     children: [\n-      { name: 'node_ares_task_list' },\n+      { node_name: 'Node / node_ares_task_list', edge_name: 'task_list' },\n       // `Node / ChannelWrap` (C++) -> `ChannelWrap` (JS)\n-      { name: 'ChannelWrap' }\n+      { node_name: 'ChannelWrap', edge_name: 'wrapped' }\n     ]\n   }\n ]);"
        },
        {
            "sha": "ca170e13a6177049d53ad64f9fef14d563889d44",
            "filename": "test/parallel/test-heapdump-fs-promise.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-fs-promise.js",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-fs-promise.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-heapdump-fs-promise.js?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -4,13 +4,13 @@ require('../common');\n const { validateSnapshotNodes } = require('../common/heap');\n const fs = require('fs').promises;\n \n-validateSnapshotNodes('FSReqPromise', []);\n+validateSnapshotNodes('Node / FSReqPromise', []);\n fs.stat(__filename);\n-validateSnapshotNodes('FSReqPromise', [\n+validateSnapshotNodes('Node / FSReqPromise', [\n   {\n     children: [\n-      { name: 'FSReqPromise' },\n-      { name: 'Float64Array' }  // Stat array\n+      { node_name: 'FSReqPromise', edge_name: 'wrapped' },\n+      { node_name: 'Float64Array', edge_name: 'stats_field_array' }\n     ]\n   }\n ]);"
        },
        {
            "sha": "caece96d01cc727f1a4846ea81ae22ad9b307d51",
            "filename": "test/parallel/test-heapdump-http2.js",
            "status": "modified",
            "additions": 22,
            "deletions": 16,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-http2.js",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-http2.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-heapdump-http2.js?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -8,8 +8,8 @@ const http2 = require('http2');\n \n {\n   const state = recordState();\n-  state.validateSnapshotNodes('Http2Session', []);\n-  state.validateSnapshotNodes('Http2Stream', []);\n+  state.validateSnapshotNodes('Node / Http2Session', []);\n+  state.validateSnapshotNodes('Node / Http2Stream', []);\n }\n \n const server = http2.createServer();\n@@ -24,50 +24,56 @@ server.listen(0, () => {\n     const state = recordState();\n \n     // `Node / Http2Stream` (C++) -> Http2Stream (JS)\n-    state.validateSnapshotNodes('Http2Stream', [\n+    state.validateSnapshotNodes('Node / Http2Stream', [\n       {\n         children: [\n-          { name: 'Http2Stream' }\n+          // current_headers and/or queue could be empty\n+          { node_name: 'Http2Stream', edge_name: 'wrapped' }\n         ]\n       },\n     ], { loose: true });\n \n     // `Node / FileHandle` (C++) -> FileHandle (JS)\n-    state.validateSnapshotNodes('FileHandle', [\n+    state.validateSnapshotNodes('Node / FileHandle', [\n       {\n         children: [\n-          { name: 'FileHandle' }\n+          { node_name: 'FileHandle', edge_name: 'wrapped' }\n+          // current_headers could be empty\n         ]\n       }\n-    ]);\n-    state.validateSnapshotNodes('TCPSocketWrap', [\n+    ], { loose: true });\n+    state.validateSnapshotNodes('Node / TCPSocketWrap', [\n       {\n         children: [\n-          { name: 'TCP' }\n+          { node_name: 'TCP', edge_name: 'wrapped' }\n         ]\n       }\n     ], { loose: true });\n-    state.validateSnapshotNodes('TCPServerWrap', [\n+    state.validateSnapshotNodes('Node / TCPServerWrap', [\n       {\n         children: [\n-          { name: 'TCP' }\n+          { node_name: 'TCP', edge_name: 'wrapped' }\n         ]\n       }\n     ], { loose: true });\n     // `Node / StreamPipe` (C++) -> StreamPipe (JS)\n-    state.validateSnapshotNodes('StreamPipe', [\n+    state.validateSnapshotNodes('Node / StreamPipe', [\n       {\n         children: [\n-          { name: 'StreamPipe' }\n+          { node_name: 'StreamPipe', edge_name: 'wrapped' }\n         ]\n       }\n     ]);\n     // `Node / Http2Session` (C++) -> Http2Session (JS)\n-    state.validateSnapshotNodes('Http2Session', [\n+    state.validateSnapshotNodes('Node / Http2Session', [\n       {\n         children: [\n-          { name: 'Http2Session' },\n-          { name: 'streams' }\n+          { node_name: 'Http2Session', edge_name: 'wrapped' },\n+          {\n+            node_name: 'Node / streams', edge_name: 'streams'\n+          }\n+          // outstanding_pings, outgoing_buffers, outgoing_storage,\n+          // pending_rst_streams could be empty\n         ]\n       }\n     ], { loose: true });"
        },
        {
            "sha": "3d031d87eb1a99d3fc07f9a88a2ba34d65a14b16",
            "filename": "test/parallel/test-heapdump-inspector.js",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-inspector.js",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-inspector.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-heapdump-inspector.js?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -8,14 +8,16 @@ const { validateSnapshotNodes } = require('../common/heap');\n const inspector = require('inspector');\n \n const session = new inspector.Session();\n-validateSnapshotNodes('JSBindingsConnection', []);\n+validateSnapshotNodes('Node / JSBindingsConnection', []);\n session.connect();\n-validateSnapshotNodes('JSBindingsConnection', [\n+validateSnapshotNodes('Node / JSBindingsConnection', [\n   {\n     children: [\n-      { name: 'session' },\n-      { name: 'Connection' },\n-      (node) => node.type === 'closure' || typeof node.value === 'function'\n+      { node_name: 'Node / InspectorSession', edge_name: 'session' },\n+      { node_name: 'Connection', edge_name: 'wrapped' },\n+      (edge) => edge.name === 'callback' &&\n+        (edge.to.type === undefined || // embedded graph\n+         edge.to.type === 'closure') // snapshot\n     ]\n   }\n ]);"
        },
        {
            "sha": "fee19bf67625b2e76adfd42ba63fdd1dae3a6650",
            "filename": "test/parallel/test-heapdump-tls.js",
            "status": "modified",
            "additions": 6,
            "deletions": 5,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-tls.js",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-tls.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-heapdump-tls.js?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -9,7 +9,7 @@ const { validateSnapshotNodes } = require('../common/heap');\n const net = require('net');\n const tls = require('tls');\n \n-validateSnapshotNodes('TLSWrap', []);\n+validateSnapshotNodes('Node / TLSWrap', []);\n \n const server = net.createServer(common.mustCall((c) => {\n   c.end();\n@@ -21,13 +21,14 @@ const server = net.createServer(common.mustCall((c) => {\n   }));\n   c.write('hello');\n \n-  validateSnapshotNodes('TLSWrap', [\n+  validateSnapshotNodes('Node / TLSWrap', [\n     {\n       children: [\n-        { name: 'NodeBIO' },\n-        { name: 'NodeBIO' },\n+        { node_name: 'Node / NodeBIO', edge_name: 'enc_out' },\n+        { node_name: 'Node / NodeBIO', edge_name: 'enc_in' },\n         // `Node / TLSWrap` (C++) -> `TLSWrap` (JS)\n-        { name: 'TLSWrap' }\n+        { node_name: 'TLSWrap', edge_name: 'wrapped' }\n+        // pending_cleartext_input could be empty\n       ]\n     }\n   ]);"
        },
        {
            "sha": "02b989c6b324dd2b7327d5892497de6f1bab1785",
            "filename": "test/parallel/test-heapdump-worker.js",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-worker.js",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-worker.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-heapdump-worker.js?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -4,22 +4,22 @@ require('../common');\n const { validateSnapshotNodes } = require('../common/heap');\n const { Worker } = require('worker_threads');\n \n-validateSnapshotNodes('Worker', []);\n+validateSnapshotNodes('Node / Worker', []);\n const worker = new Worker('setInterval(() => {}, 100);', { eval: true });\n-validateSnapshotNodes('Worker', [\n+validateSnapshotNodes('Node / Worker', [\n   {\n     children: [\n-      { name: 'thread_exit_async' },\n-      { name: 'env' },\n-      { name: 'MessagePort' },\n-      { name: 'Worker' }\n+      { node_name: 'Node / uv_async_t', edge_name: 'thread_exit_async' },\n+      { node_name: 'Node / Environment', edge_name: 'env' },\n+      { node_name: 'Node / MessagePort', edge_name: 'parent_port' },\n+      { node_name: 'Worker', edge_name: 'wrapped' }\n     ]\n   }\n ]);\n-validateSnapshotNodes('MessagePort', [\n+validateSnapshotNodes('Node / MessagePort', [\n   {\n     children: [\n-      { name: 'MessagePortData' }\n+      { node_name: 'Node / MessagePortData', edge_name: 'data' }\n     ]\n   }\n ], { loose: true });"
        },
        {
            "sha": "f79e345821ea5027959e182f26b5b7e2c6270664",
            "filename": "test/parallel/test-heapdump-zlib.js",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-zlib.js",
            "raw_url": "https://github.com/nodejs/node/raw/92fa0fcdb76e2b6cb0040eede97fe3c167c31897/test%2Fparallel%2Ftest-heapdump-zlib.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-heapdump-zlib.js?ref=92fa0fcdb76e2b6cb0040eede97fe3c167c31897",
            "patch": "@@ -4,14 +4,14 @@ require('../common');\n const { validateSnapshotNodes } = require('../common/heap');\n const zlib = require('zlib');\n \n-validateSnapshotNodes('ZCtx', []);\n+validateSnapshotNodes('Node / ZCtx', []);\n // eslint-disable-next-line no-unused-vars\n const gunzip = zlib.createGunzip();\n-validateSnapshotNodes('ZCtx', [\n+validateSnapshotNodes('Node / ZCtx', [\n   {\n     children: [\n-      { name: 'Zlib' },\n-      { name: 'zlib memory' }\n+      { node_name: 'Zlib', edge_name: 'wrapped' },\n+      { node_name: 'Node / zlib_memory', edge_name: 'zlib_memory' }\n     ]\n   }\n ]);"
        }
    ],
    "stats": {
        "total": 1216,
        "additions": 713,
        "deletions": 503
    }
}