{
    "author": "devsnek",
    "message": "util: fix inspection of module namespaces\n\nPR-URL: https://github.com/nodejs/node/pull/20962\nReviewed-By: Guy Bedford <guybedford@gmail.com>\nReviewed-By: Matheus Marchini <matheus@sthima.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "a25730bda39b862da24a1dd633574cfebb926ee1",
    "files": [
        {
            "sha": "d5c3b3a8be8cbc470909cdf92ee12bcbde1ec80b",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 18,
            "deletions": 2,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/a25730bda39b862da24a1dd633574cfebb926ee1/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/a25730bda39b862da24a1dd633574cfebb926ee1/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=a25730bda39b862da24a1dd633574cfebb926ee1",
            "patch": "@@ -478,7 +478,23 @@ function formatValue(ctx, value, recurseTimes) {\n   if (ctx.showHidden) {\n     keys = Object.getOwnPropertyNames(value);\n   } else {\n-    keys = Object.keys(value);\n+    // This might throw if `value` is a Module Namespace Object from an\n+    // unevaluated module, but we don't want to perform the actual type\n+    // check because it's expensive.\n+    // TODO(devsnek): track https://github.com/tc39/ecma262/issues/1209\n+    // and modify this logic as needed.\n+    try {\n+      keys = Object.keys(value);\n+    } catch (err) {\n+      if (types.isNativeError(err) &&\n+          err.name === 'ReferenceError' &&\n+          types.isModuleNamespaceObject(value)) {\n+        keys = Object.getOwnPropertyNames(value);\n+      } else {\n+        throw err;\n+      }\n+    }\n+\n     if (symbols.length !== 0)\n       symbols = symbols.filter((key) => propertyIsEnumerable.call(value, key));\n   }\n@@ -772,7 +788,7 @@ function formatNamespaceObject(ctx, value, recurseTimes, keys) {\n     try {\n       output[i] = formatProperty(ctx, value, recurseTimes, keys[i], 0);\n     } catch (err) {\n-      if (!(err instanceof ReferenceError)) {\n+      if (!(types.isNativeError(err) && err.name === 'ReferenceError')) {\n         throw err;\n       }\n       // Use the existing functionality. This makes sure the indentation and"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 18,
        "deletions": 2
    }
}