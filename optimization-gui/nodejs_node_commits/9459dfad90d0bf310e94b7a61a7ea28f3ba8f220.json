{
    "author": "jasnell",
    "message": "src: cleanup beforeExit for consistency\n\nPR-URL: https://github.com/nodejs/node/pull/21113\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "9459dfad90d0bf310e94b7a61a7ea28f3ba8f220",
    "files": [
        {
            "sha": "12cf5b8855b4c12084d1847d26679fb92b07700d",
            "filename": "src/env.h",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/9459dfad90d0bf310e94b7a61a7ea28f3ba8f220/src%2Fenv.h",
            "raw_url": "https://github.com/nodejs/node/raw/9459dfad90d0bf310e94b7a61a7ea28f3ba8f220/src%2Fenv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.h?ref=9459dfad90d0bf310e94b7a61a7ea28f3ba8f220",
            "patch": "@@ -160,9 +160,7 @@ struct PackageConfig {\n   V(env_pairs_string, \"envPairs\")                                             \\\n   V(errno_string, \"errno\")                                                    \\\n   V(error_string, \"error\")                                                    \\\n-  V(exiting_string, \"_exiting\")                                               \\\n   V(exit_code_string, \"exitCode\")                                             \\\n-  V(exit_string, \"exit\")                                                      \\\n   V(expire_string, \"expire\")                                                  \\\n   V(exponent_string, \"exponent\")                                              \\\n   V(exports_string, \"exports\")                                                \\"
        },
        {
            "sha": "2ddaf6c80f2c7ef956d35d2d0cdec5570210adf3",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/9459dfad90d0bf310e94b7a61a7ea28f3ba8f220/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/9459dfad90d0bf310e94b7a61a7ea28f3ba8f220/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=9459dfad90d0bf310e94b7a61a7ea28f3ba8f220",
            "patch": "@@ -4117,10 +4117,11 @@ void EmitBeforeExit(Environment* env) {\n   HandleScope handle_scope(env->isolate());\n   Context::Scope context_scope(env->context());\n   Local<Object> process_object = env->process_object();\n-  Local<String> exit_code = FIXED_ONE_BYTE_STRING(env->isolate(), \"exitCode\");\n+  Local<String> exit_code = env->exit_code_string();\n   Local<Value> args[] = {\n     FIXED_ONE_BYTE_STRING(env->isolate(), \"beforeExit\"),\n-    process_object->Get(exit_code)->ToInteger(env->context()).ToLocalChecked()\n+    process_object->Get(env->context(), exit_code).ToLocalChecked()\n+        ->ToInteger(env->context()).ToLocalChecked()\n   };\n   MakeCallback(env->isolate(),\n                process_object, \"emit\", arraysize(args), args,\n@@ -4133,13 +4134,15 @@ int EmitExit(Environment* env) {\n   HandleScope handle_scope(env->isolate());\n   Context::Scope context_scope(env->context());\n   Local<Object> process_object = env->process_object();\n-  process_object->Set(env->exiting_string(), True(env->isolate()));\n+  process_object->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \"_exiting\"),\n+                      True(env->isolate()));\n \n-  Local<String> exitCode = env->exit_code_string();\n-  int code = process_object->Get(exitCode)->Int32Value();\n+  Local<String> exit_code = env->exit_code_string();\n+  int code = process_object->Get(env->context(), exit_code).ToLocalChecked()\n+      ->Int32Value(env->context()).ToChecked();\n \n   Local<Value> args[] = {\n-    env->exit_string(),\n+    FIXED_ONE_BYTE_STRING(env->isolate(), \"exit\"),\n     Integer::New(env->isolate(), code)\n   };\n \n@@ -4148,7 +4151,8 @@ int EmitExit(Environment* env) {\n                {0, 0}).ToLocalChecked();\n \n   // Reload exit code, it may be changed by `emit('exit')`\n-  return process_object->Get(exitCode)->Int32Value();\n+  return process_object->Get(env->context(), exit_code).ToLocalChecked()\n+      ->Int32Value(env->context()).ToChecked();\n }\n \n "
        }
    ],
    "stats": {
        "total": 20,
        "additions": 11,
        "deletions": 9
    }
}