{
    "author": "bnoordhuis",
    "message": "doc: remove GA tracking\n\nThe Google Analytics tracking wasn't wholly uncontroversial and hasn't\nbeen used in practice. Remove it.\n\nPR-URL: https://github.com/nodejs/node/pull/23083\nFixes: https://github.com/nodejs/node/issues/22652\nRefs: https://github.com/nodejs/node/pull/6601\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Roman Reiss <me@silverwind.io>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Сковорода Никита Андреевич <chalkerx@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8",
    "files": [
        {
            "sha": "c5a6b19da067327d66743dc349ec4d08a53bbf3a",
            "filename": "Makefile",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/Makefile",
            "raw_url": "https://github.com/nodejs/node/raw/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/Makefile",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/Makefile?ref=df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8",
            "patch": "@@ -597,11 +597,6 @@ test-v8 test-v8-intl test-v8-benchmarks test-v8-all:\n \t\t\"$ git clone https://github.com/nodejs/node.git\"\n endif\n \n-# Google Analytics ID used for tracking API docs page views, empty\n-# DOCS_ANALYTICS means no tracking scripts will be included in the\n-# generated .html files\n-DOCS_ANALYTICS ?=\n-\n apidoc_dirs = out/doc out/doc/api out/doc/api/assets\n apidoc_sources = $(wildcard doc/api/*.md)\n apidocs_html = $(addprefix out/,$(apidoc_sources:.md=.html))\n@@ -646,8 +641,7 @@ out/doc/api/assets/%: doc/api_assets/% out/doc/api/assets\n run-npm-ci = $(PWD)/$(NPM) ci\n \n gen-api = tools/doc/generate.js --node-version=$(FULLVERSION) \\\n-\t\t--apilinks=out/apilinks.json \\\n-\t\t--analytics=$(DOCS_ANALYTICS) $< --output-directory=out/doc/api\n+\t\t--apilinks=out/apilinks.json $< --output-directory=out/doc/api\n gen-apilink = tools/doc/apilinks.js $(wildcard lib/*.js) > $@\n \n out/apilinks.json: $(wildcard lib/*.js) tools/doc/apilinks.js"
        },
        {
            "sha": "3317eadf3d47e7adc858ffb3da4366a2077849df",
            "filename": "doc/template.html",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/doc%2Ftemplate.html",
            "raw_url": "https://github.com/nodejs/node/raw/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/doc%2Ftemplate.html",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Ftemplate.html?ref=df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8",
            "patch": "@@ -54,6 +54,5 @@ <h2>Table of Contents</h2>\n   <script src=\"assets/sh_main.js\"></script>\n   <script src=\"assets/sh_javascript.min.js\"></script>\n   <script>highlight(undefined, undefined, 'pre');</script>\n-  <!-- __TRACKING__ -->\n </body>\n </html>"
        },
        {
            "sha": "78f48ae54e8f26df8204b59eea13abea928acdfd",
            "filename": "test/doctool/test-doctool-html.js",
            "status": "modified",
            "additions": 3,
            "deletions": 18,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/test%2Fdoctool%2Ftest-doctool-html.js",
            "raw_url": "https://github.com/nodejs/node/raw/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/test%2Fdoctool%2Ftest-doctool-html.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fdoctool%2Ftest-doctool-html.js?ref=df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8",
            "patch": "@@ -22,7 +22,7 @@ const remark2rehype = require('remark-rehype');\n const raw = require('rehype-raw');\n const htmlStringify = require('rehype-stringify');\n \n-function toHTML({ input, filename, nodeVersion, analytics }, cb) {\n+function toHTML({ input, filename, nodeVersion }, cb) {\n   const content = unified()\n     .use(markdown)\n     .use(html.firstHeader)\n@@ -35,7 +35,7 @@ function toHTML({ input, filename, nodeVersion, analytics }, cb) {\n     .processSync(input);\n \n   html.toHTML(\n-    { input, content, filename, nodeVersion, analytics },\n+    { input, content, filename, nodeVersion },\n     cb\n   );\n }\n@@ -94,16 +94,14 @@ const testData = [\n     file: fixtures.path('sample_document.md'),\n     html: '<ol><li>fish</li><li>fish</li></ol>' +\n       '<ul><li>Red fish</li><li>Blue fish</li></ul>',\n-    analyticsId: 'UA-67020396-1'\n   },\n ];\n \n const spaces = /\\s/g;\n \n-testData.forEach(({ file, html, analyticsId }) => {\n+testData.forEach(({ file, html }) => {\n   // Normalize expected data by stripping whitespace.\n   const expected = html.replace(spaces, '');\n-  const includeAnalytics = typeof analyticsId !== 'undefined';\n \n   readFile(file, 'utf8', common.mustCall((err, input) => {\n     assert.ifError(err);\n@@ -112,7 +110,6 @@ testData.forEach(({ file, html, analyticsId }) => {\n         input: input,\n         filename: 'foo',\n         nodeVersion: process.version,\n-        analytics: analyticsId,\n       },\n       common.mustCall((err, output) => {\n         assert.ifError(err);\n@@ -121,18 +118,6 @@ testData.forEach(({ file, html, analyticsId }) => {\n         // Assert that the input stripped of all whitespace contains the\n         // expected markup.\n         assert(actual.includes(expected));\n-\n-        // Testing the insertion of Google Analytics script when\n-        // an analytics id is provided. Should not be present by default.\n-        const scriptDomain = 'google-analytics.com';\n-        if (includeAnalytics) {\n-          assert(actual.includes(scriptDomain),\n-                 `Google Analytics script was not present in \"${actual}\"`);\n-        } else {\n-          assert.strictEqual(actual.includes(scriptDomain), false,\n-                             'Google Analytics script was present in ' +\n-                             `\"${actual}\"`);\n-        }\n       })\n     );\n   }));"
        },
        {
            "sha": "7ca47e2ae06dc844e3fc345bf3dd69b88f7ff96b",
            "filename": "tools/doc/generate.js",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/tools%2Fdoc%2Fgenerate.js",
            "raw_url": "https://github.com/nodejs/node/raw/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/tools%2Fdoc%2Fgenerate.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fgenerate.js?ref=df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8",
            "patch": "@@ -38,7 +38,6 @@ const json = require('./json');\n const args = process.argv.slice(2);\n let filename = null;\n let nodeVersion = null;\n-let analytics = null;\n let outputDir = null;\n let apilinks = {};\n \n@@ -47,8 +46,6 @@ args.forEach(function(arg) {\n     filename = arg;\n   } else if (arg.startsWith('--node-version=')) {\n     nodeVersion = arg.replace(/^--node-version=/, '');\n-  } else if (arg.startsWith('--analytics=')) {\n-    analytics = arg.replace(/^--analytics=/, '');\n   } else if (arg.startsWith('--output-directory=')) {\n     outputDir = arg.replace(/^--output-directory=/, '');\n   } else if (arg.startsWith('--apilinks=')) {\n@@ -85,7 +82,7 @@ fs.readFile(filename, 'utf8', (er, input) => {\n   const basename = path.basename(filename, '.md');\n \n   html.toHTML(\n-    { input, content, filename, nodeVersion, analytics },\n+    { input, content, filename, nodeVersion },\n     (err, html) => {\n       const target = path.join(outputDir, `${basename}.html`);\n       if (err) throw err;"
        },
        {
            "sha": "fd74563dd7fc97027c0266d1f5b3b101c8ea6e2f",
            "filename": "tools/doc/html.js",
            "status": "modified",
            "additions": 1,
            "deletions": 25,
            "changes": 26,
            "blob_url": "https://github.com/nodejs/node/blob/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/tools%2Fdoc%2Fhtml.js",
            "raw_url": "https://github.com/nodejs/node/raw/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/tools%2Fdoc%2Fhtml.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fdoc%2Fhtml.js?ref=df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8",
            "patch": "@@ -62,7 +62,7 @@ const gtocHTML = unified()\n const templatePath = path.join(docPath, 'template.html');\n const template = fs.readFileSync(templatePath, 'utf8');\n \n-function toHTML({ input, content, filename, nodeVersion, analytics }, cb) {\n+function toHTML({ input, content, filename, nodeVersion }, cb) {\n   filename = path.basename(filename, '.md');\n \n   const id = filename.replace(/\\W+/g, '-');\n@@ -77,30 +77,6 @@ function toHTML({ input, content, filename, nodeVersion, analytics }, cb) {\n                      .replace('__EDIT_ON_GITHUB__', editOnGitHub(filename))\n                      .replace('__CONTENT__', content.toString());\n \n-  if (analytics) {\n-    HTML = HTML.replace('<!-- __TRACKING__ -->', `\n-    <script type=\"text/javascript\">\n-      // In all the browsers we'll get '1' or 'yes' (FF 32 or above) as a string\n-      // value when enabling 'DO NOT TRACK'.\n-      // For more:\n-      // https://developer.mozilla.org/en-US/docs/Web/API/navigator/doNotTrack\n-      function isDoNotTrack() {\n-        var isDoNotTrackEnabled = navigator.doNotTrack || window.doNotTrack ||\n-               navigator.msDoNotTrack;\n-        return isDoNotTrackEnabled === '1' || isDoNotTrackEnabled === 'yes';\n-      }\n-      if (!isDoNotTrack()) {\n-        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;\n-        i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},\n-        i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];\n-        a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,\n-        'script','//www.google-analytics.com/analytics.js','ga');\n-        ga('create', '${analytics}', 'auto');\n-        ga('send', 'pageview');\n-      }\n-    </script>`);\n-  }\n-\n   const docCreated = input.match(\n     /<!--\\s*introduced_in\\s*=\\s*v([0-9]+)\\.([0-9]+)\\.[0-9]+\\s*-->/);\n   if (docCreated) {"
        },
        {
            "sha": "1e31440cc29857450918e9f17f75e48ab6fca964",
            "filename": "vcbuild.bat",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/vcbuild.bat",
            "raw_url": "https://github.com/nodejs/node/raw/df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8/vcbuild.bat",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/vcbuild.bat?ref=df6a1306e8ed9fa50c8aa44bc037d2a34f61bfc8",
            "patch": "@@ -460,7 +460,7 @@ robocopy /e doc\\api %config%\\doc\\api\n robocopy /e doc\\api_assets %config%\\doc\\api\\assets\n \n for %%F in (%config%\\doc\\api\\*.md) do (\n-  %node_exe% tools\\doc\\generate.js --node-version=v%FULLVERSION% --analytics=%DOCS_ANALYTICS% %%F --output-directory=%%~dF%%~pF\n+  %node_exe% tools\\doc\\generate.js --node-version=v%FULLVERSION% %%F --output-directory=%%~dF%%~pF\n )\n \n :run"
        }
    ],
    "stats": {
        "total": 63,
        "additions": 7,
        "deletions": 56
    }
}