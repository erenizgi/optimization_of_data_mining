{
    "author": "joyeecheung",
    "message": "process: register the inspector async hooks in bootstrap/node.js\n\nSo it's easier to tell the side effects of this setup.\n\nPR-URL: https://github.com/nodejs/node/pull/25443\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "6b2af91a88b0a5e4d846701971065b8d668c8b1d",
    "files": [
        {
            "sha": "26585f5df9c28a61e79d8ec8b6731c29c492b070",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/6b2af91a88b0a5e4d846701971065b8d668c8b1d/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/6b2af91a88b0a5e4d846701971065b8d668c8b1d/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=6b2af91a88b0a5e4d846701971065b8d668c8b1d",
            "patch": "@@ -159,7 +159,11 @@ function startup() {\n   }\n \n   if (config.hasInspector) {\n-    NativeModule.require('internal/inspector_async_hook').setup();\n+    const {\n+      enable,\n+      disable\n+    } = NativeModule.require('internal/inspector_async_hook');\n+    internalBinding('inspector').registerAsyncHook(enable, disable);\n   }\n \n   // If the process is spawned with env NODE_CHANNEL_FD, it's probably"
        },
        {
            "sha": "b16e8d025ec95748211bbaa3a94c9e50ab1cb7b1",
            "filename": "lib/internal/inspector_async_hook.js",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/6b2af91a88b0a5e4d846701971065b8d668c8b1d/lib%2Finternal%2Finspector_async_hook.js",
            "raw_url": "https://github.com/nodejs/node/raw/6b2af91a88b0a5e4d846701971065b8d668c8b1d/lib%2Finternal%2Finspector_async_hook.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Finspector_async_hook.js?ref=6b2af91a88b0a5e4d846701971065b8d668c8b1d",
            "patch": "@@ -1,16 +1,10 @@\n 'use strict';\n \n-const inspector = internalBinding('inspector');\n-\n-if (!inspector || !inspector.asyncTaskScheduled) {\n-  exports.setup = function() {};\n-  return;\n-}\n-\n let hook;\n let config;\n \n function lazyHookCreation() {\n+  const inspector = internalBinding('inspector');\n   const { createHook } = require('async_hooks');\n   config = internalBinding('config');\n \n@@ -72,6 +66,7 @@ function disable() {\n   hook.disable();\n }\n \n-exports.setup = function() {\n-  inspector.registerAsyncHook(enable, disable);\n+module.exports = {\n+  enable,\n+  disable\n };"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 9,
        "deletions": 10
    }
}