{
    "author": "daynin",
    "message": "url: refactor \"escapeParam\" function to make it common\n\nPR-URL: https://github.com/nodejs/node/pull/19076\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "f32796fad2e77b789c0ad552dcddb891484e54fc",
    "files": [
        {
            "sha": "e42c5278d80734b64bfdc96bf9f517b30c06c1eb",
            "filename": "lib/internal/url.js",
            "status": "modified",
            "additions": 25,
            "deletions": 16,
            "changes": 41,
            "blob_url": "https://github.com/nodejs/node/blob/f32796fad2e77b789c0ad552dcddb891484e54fc/lib%2Finternal%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/f32796fad2e77b789c0ad552dcddb891484e54fc/lib%2Finternal%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Furl.js?ref=f32796fad2e77b789c0ad552dcddb891484e54fc",
            "patch": "@@ -814,7 +814,7 @@ const noEscape = [\n const paramHexTable = hexTable.slice();\n paramHexTable[0x20] = '+';\n \n-function escapeParam(str) {\n+function encodeStr(str, noEscapeTable, hexTable) {\n   const len = str.length;\n   if (len === 0)\n     return '';\n@@ -827,12 +827,12 @@ function escapeParam(str) {\n \n     // ASCII\n     if (c < 0x80) {\n-      if (noEscape[c] === 1)\n+      if (noEscapeTable[c] === 1)\n         continue;\n       if (lastPos < i)\n         out += str.slice(lastPos, i);\n       lastPos = i + 1;\n-      out += paramHexTable[c];\n+      out += hexTable[c];\n       continue;\n     }\n \n@@ -842,15 +842,15 @@ function escapeParam(str) {\n     // Multi-byte characters ...\n     if (c < 0x800) {\n       lastPos = i + 1;\n-      out += paramHexTable[0xC0 | (c >> 6)] +\n-             paramHexTable[0x80 | (c & 0x3F)];\n+      out += hexTable[0xC0 | (c >> 6)] +\n+             hexTable[0x80 | (c & 0x3F)];\n       continue;\n     }\n     if (c < 0xD800 || c >= 0xE000) {\n       lastPos = i + 1;\n-      out += paramHexTable[0xE0 | (c >> 12)] +\n-             paramHexTable[0x80 | ((c >> 6) & 0x3F)] +\n-             paramHexTable[0x80 | (c & 0x3F)];\n+      out += hexTable[0xE0 | (c >> 12)] +\n+             hexTable[0x80 | ((c >> 6) & 0x3F)] +\n+             hexTable[0x80 | (c & 0x3F)];\n       continue;\n     }\n     // Surrogate pair\n@@ -866,10 +866,10 @@ function escapeParam(str) {\n     }\n     lastPos = i + 1;\n     c = 0x10000 + (((c & 0x3FF) << 10) | c2);\n-    out += paramHexTable[0xF0 | (c >> 18)] +\n-           paramHexTable[0x80 | ((c >> 12) & 0x3F)] +\n-           paramHexTable[0x80 | ((c >> 6) & 0x3F)] +\n-           paramHexTable[0x80 | (c & 0x3F)];\n+    out += hexTable[0xF0 | (c >> 18)] +\n+           hexTable[0x80 | ((c >> 12) & 0x3F)] +\n+           hexTable[0x80 | ((c >> 6) & 0x3F)] +\n+           hexTable[0x80 | (c & 0x3F)];\n   }\n   if (lastPos === 0)\n     return str;\n@@ -885,9 +885,17 @@ function serializeParams(array) {\n   if (len === 0)\n     return '';\n \n-  var output = `${escapeParam(array[0])}=${escapeParam(array[1])}`;\n-  for (var i = 2; i < len; i += 2)\n-    output += `&${escapeParam(array[i])}=${escapeParam(array[i + 1])}`;\n+  const firstEncodedParam = encodeStr(array[0], noEscape, paramHexTable);\n+  const firstEncodedValue = encodeStr(array[1], noEscape, paramHexTable);\n+  let output =\n+    `${firstEncodedParam}=${firstEncodedValue}`;\n+\n+  for (var i = 2; i < len; i += 2) {\n+    const encodedParam = encodeStr(array[i], noEscape, paramHexTable);\n+    const encodedValue = encodeStr(array[i + 1], noEscape, paramHexTable);\n+    output += `&${encodedParam}=${encodedValue}`;\n+  }\n+\n   return output;\n }\n \n@@ -1431,5 +1439,6 @@ module.exports = {\n   domainToUnicode,\n   urlToOptions,\n   formatSymbol: kFormat,\n-  searchParamsSymbol: searchParams\n+  searchParamsSymbol: searchParams,\n+  encodeStr\n };"
        }
    ],
    "stats": {
        "total": 41,
        "additions": 25,
        "deletions": 16
    }
}