{
    "author": "targos",
    "message": "src: use String::Utf8Length with isolate\n\nPR-URL: https://github.com/nodejs/node/pull/22531\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7",
    "files": [
        {
            "sha": "d0c1a079210532f0533034119097d7ccf3825a9b",
            "filename": "benchmark/napi/function_args/binding.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7/benchmark%2Fnapi%2Ffunction_args%2Fbinding.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7/benchmark%2Fnapi%2Ffunction_args%2Fbinding.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fnapi%2Ffunction_args%2Fbinding.cc?ref=b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7",
            "patch": "@@ -19,7 +19,7 @@ void CallWithString(const FunctionCallbackInfo<Value>& args) {\n   assert(args.Length() == 1 && args[0]->IsString());\n   if (args.Length() == 1 && args[0]->IsString()) {\n     Local<String> str = args[0].As<String>();\n-    const int32_t length = str->Utf8Length() + 1;\n+    const int32_t length = str->Utf8Length(args.GetIsolate()) + 1;\n     char* buf = new char[length];\n     str->WriteUtf8(args.GetIsolate(), buf, length);\n     delete [] buf;"
        },
        {
            "sha": "727ca0cf7027f1af759870d9676dfeeaf786b610",
            "filename": "src/node_api.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7/src%2Fnode_api.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7/src%2Fnode_api.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_api.cc?ref=b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7",
            "patch": "@@ -2399,7 +2399,7 @@ napi_status napi_get_value_string_utf8(napi_env env,\n \n   if (!buf) {\n     CHECK_ARG(env, result);\n-    *result = val.As<v8::String>()->Utf8Length();\n+    *result = val.As<v8::String>()->Utf8Length(env->isolate);\n   } else {\n     int copied = val.As<v8::String>()->WriteUtf8(\n         env->isolate,"
        },
        {
            "sha": "9a280f7c127cc67080b6105cbfd0d202d5450e2a",
            "filename": "src/node_buffer.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7/src%2Fnode_buffer.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7/src%2Fnode_buffer.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_buffer.cc?ref=b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7",
            "patch": "@@ -599,7 +599,7 @@ void Fill(const FunctionCallbackInfo<Value>& args) {\n   // Can't use StringBytes::Write() in all cases. For example if attempting\n   // to write a two byte character into a one byte Buffer.\n   if (enc == UTF8) {\n-    str_length = str_obj->Utf8Length();\n+    str_length = str_obj->Utf8Length(env->isolate());\n     node::Utf8Value str(env->isolate(), args[1]);\n     memcpy(ts_obj_data + start, *str, MIN(str_length, fill_length));\n \n@@ -689,10 +689,11 @@ void StringWrite(const FunctionCallbackInfo<Value>& args) {\n }\n \n void ByteLengthUtf8(const FunctionCallbackInfo<Value> &args) {\n+  Environment* env = Environment::GetCurrent(args);\n   CHECK(args[0]->IsString());\n \n   // Fast case: avoid StringBytes on UTF8 string. Jump to v8.\n-  args.GetReturnValue().Set(args[0].As<String>()->Utf8Length());\n+  args.GetReturnValue().Set(args[0].As<String>()->Utf8Length(env->isolate()));\n }\n \n // Normalize val to be an integer in the range of [1, -1] since\n@@ -1062,7 +1063,7 @@ static void EncodeUtf8String(const FunctionCallbackInfo<Value>& args) {\n   CHECK(args[0]->IsString());\n \n   Local<String> str = args[0].As<String>();\n-  size_t length = str->Utf8Length();\n+  size_t length = str->Utf8Length(isolate);\n   char* data = node::UncheckedMalloc(length);\n   str->WriteUtf8(isolate,\n                  data,"
        },
        {
            "sha": "b7f009fe1fcc16f778f3cb59b3033ff29ebd38a3",
            "filename": "src/string_bytes.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7/src%2Fstring_bytes.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7/src%2Fstring_bytes.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstring_bytes.cc?ref=b2f0cfa6b0e139a2f990d4e1e7104abf015fe8e7",
            "patch": "@@ -465,7 +465,7 @@ size_t StringBytes::Size(Isolate* isolate,\n \n     case BUFFER:\n     case UTF8:\n-      return str->Utf8Length();\n+      return str->Utf8Length(isolate);\n \n     case UCS2:\n       return str->Length() * sizeof(uint16_t);"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 7,
        "deletions": 6
    }
}