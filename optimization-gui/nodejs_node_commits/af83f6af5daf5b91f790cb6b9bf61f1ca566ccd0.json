{
    "author": "joyeecheung",
    "message": "process: normalize process.execPath in CreateProcessObject()\n\nDirectly normalize `process.execPath` using `uv_fs_realpath`\non OpenBSD before serializing it into the process object,\ninstead of using `require('fs')` to normalize and override\nthe path in `bootstrap/node.js`.\n\nPR-URL: https://github.com/nodejs/node/pull/26002\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Minwoo Jung <minwoo@nodesource.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "af83f6af5daf5b91f790cb6b9bf61f1ca566ccd0",
    "files": [
        {
            "sha": "afb6340570e5f74988882237f94e03ae87c71860",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/af83f6af5daf5b91f790cb6b9bf61f1ca566ccd0/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/af83f6af5daf5b91f790cb6b9bf61f1ca566ccd0/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=af83f6af5daf5b91f790cb6b9bf61f1ca566ccd0",
            "patch": "@@ -187,13 +187,6 @@ if (browserGlobals) {\n \n setupDOMException();\n \n-// On OpenBSD process.execPath will be relative unless we\n-// get the full path before process.execPath is used.\n-if (process.platform === 'openbsd') {\n-  const { realpathSync } = NativeModule.require('fs');\n-  process.execPath = realpathSync.native(process.execPath);\n-}\n-\n Object.defineProperty(process, 'argv0', {\n   enumerable: true,\n   configurable: false,"
        },
        {
            "sha": "2f47b21f699d4e63dd3527215f060a77bc5c84bb",
            "filename": "src/node_process_object.cc",
            "status": "modified",
            "additions": 26,
            "deletions": 13,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/af83f6af5daf5b91f790cb6b9bf61f1ca566ccd0/src%2Fnode_process_object.cc",
            "raw_url": "https://github.com/nodejs/node/raw/af83f6af5daf5b91f790cb6b9bf61f1ca566ccd0/src%2Fnode_process_object.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_process_object.cc?ref=af83f6af5daf5b91f790cb6b9bf61f1ca566ccd0",
            "patch": "@@ -273,21 +273,34 @@ MaybeLocal<Object> CreateProcessObject(\n \n   // process.execPath\n   {\n-    size_t exec_path_len = 2 * PATH_MAX;\n-    std::vector<char> exec_path(exec_path_len);\n-    Local<String> exec_path_value;\n-    if (uv_exepath(exec_path.data(), &exec_path_len) == 0) {\n-      exec_path_value = String::NewFromUtf8(env->isolate(),\n-                                            exec_path.data(),\n-                                            NewStringType::kInternalized,\n-                                            exec_path_len).ToLocalChecked();\n+    char exec_path_buf[2 * PATH_MAX];\n+    size_t exec_path_len = sizeof(exec_path_buf);\n+    std::string exec_path;\n+    if (uv_exepath(exec_path_buf, &exec_path_len) == 0) {\n+      exec_path = std::string(exec_path_buf, exec_path_len);\n     } else {\n-      exec_path_value = String::NewFromUtf8(env->isolate(), args[0].c_str(),\n-          NewStringType::kInternalized).ToLocalChecked();\n+      exec_path = args[0];\n     }\n-    process->Set(env->context(),\n-                 FIXED_ONE_BYTE_STRING(env->isolate(), \"execPath\"),\n-                 exec_path_value).FromJust();\n+    // On OpenBSD process.execPath will be relative unless we\n+    // get the full path before process.execPath is used.\n+#if defined(__OpenBSD__)\n+    uv_fs_t req;\n+    req.ptr = nullptr;\n+    if (0 ==\n+        uv_fs_realpath(env->event_loop(), &req, exec_path.c_str(), nullptr)) {\n+      CHECK_NOT_NULL(req.ptr);\n+      exec_path = std::string(static_cast<char*>(req.ptr));\n+    }\n+#endif\n+    process\n+        ->Set(env->context(),\n+              FIXED_ONE_BYTE_STRING(env->isolate(), \"execPath\"),\n+              String::NewFromUtf8(env->isolate(),\n+                                  exec_path.c_str(),\n+                                  NewStringType::kInternalized,\n+                                  exec_path.size())\n+                  .ToLocalChecked())\n+        .FromJust();\n   }\n \n   // process.debugPort"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 26,
        "deletions": 20
    }
}