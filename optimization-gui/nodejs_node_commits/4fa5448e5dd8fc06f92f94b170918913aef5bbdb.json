{
    "author": "jasnell",
    "message": "http2: move process.binding('http2') to internalBinding\n\nRefs: https://github.com/nodejs/node/issues/22160\n\nPR-URL: https://github.com/nodejs/node/pull/22328\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>",
    "sha": "4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
    "files": [
        {
            "sha": "a20275b3131287aa568422d913d3754c297819f6",
            "filename": "lib/internal/http2/compat.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/lib%2Finternal%2Fhttp2%2Fcompat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcompat.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -1,8 +1,9 @@\n 'use strict';\n \n+const { internalBinding } = require('internal/bootstrap/loaders');\n const Stream = require('stream');\n const Readable = Stream.Readable;\n-const binding = process.binding('http2');\n+const binding = internalBinding('http2');\n const constants = binding.constants;\n const {\n   ERR_HTTP2_HEADERS_SENT,"
        },
        {
            "sha": "299949481350e17019cb4a53f51fe4a7006ba809",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -10,6 +10,7 @@ const {\n \n assertCrypto();\n \n+const { internalBinding } = require('internal/bootstrap/loaders');\n const assert = require('assert');\n const EventEmitter = require('events');\n const fs = require('fs');\n@@ -31,7 +32,6 @@ const {\n     owner_symbol,\n   },\n } = require('internal/async_hooks');\n-const { internalBinding } = require('internal/bootstrap/loaders');\n const {\n   codes: {\n     ERR_HTTP2_ALTSVC_INVALID_ORIGIN,\n@@ -114,7 +114,7 @@ const {\n const { isArrayBufferView } = require('internal/util/types');\n \n const { FileHandle } = process.binding('fs');\n-const binding = process.binding('http2');\n+const binding = internalBinding('http2');\n const { ShutdownWrap } = process.binding('stream_wrap');\n const { UV_EOF } = internalBinding('uv');\n "
        },
        {
            "sha": "473806aa18e3005ce604a1df2fbee3d04e86dffa",
            "filename": "lib/internal/http2/util.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/lib%2Finternal%2Fhttp2%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/lib%2Finternal%2Fhttp2%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Futil.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -1,6 +1,7 @@\n 'use strict';\n \n-const binding = process.binding('http2');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const binding = internalBinding('http2');\n const {\n   ERR_HTTP2_HEADER_SINGLE_VALUE,\n   ERR_HTTP2_INVALID_CONNECTION_HEADERS,"
        },
        {
            "sha": "37ede26aa789969b3948b3201bf6c5c10b9acd88",
            "filename": "lib/perf_hooks.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/lib%2Fperf_hooks.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/lib%2Fperf_hooks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fperf_hooks.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -80,10 +80,11 @@ let sessionStats;\n let streamStats;\n \n function collectHttp2Stats(entry) {\n+  const http2 = internalBinding('http2');\n   switch (entry.name) {\n     case 'Http2Stream':\n       if (streamStats === undefined)\n-        streamStats = process.binding('http2').streamStats;\n+        streamStats = http2.streamStats;\n       entry.id =\n         streamStats[IDX_STREAM_STATS_ID] >>> 0;\n       entry.timeToFirstByte =\n@@ -99,7 +100,7 @@ function collectHttp2Stats(entry) {\n       break;\n     case 'Http2Session':\n       if (sessionStats === undefined)\n-        sessionStats = process.binding('http2').sessionStats;\n+        sessionStats = http2.sessionStats;\n       entry.type =\n         sessionStats[IDX_SESSION_STATS_TYPE] >>> 0 === 0 ? 'server' : 'client';\n       entry.pingRTT ="
        },
        {
            "sha": "6711dc65a8281872773291b97da29c35c50e1a87",
            "filename": "src/node_http2.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/src%2Fnode_http2.cc",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/src%2Fnode_http2.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_http2.cc?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -2999,4 +2999,4 @@ HTTP_STATUS_CODES(V)\n }  // namespace http2\n }  // namespace node\n \n-NODE_BUILTIN_MODULE_CONTEXT_AWARE(http2, node::http2::Initialize)\n+NODE_MODULE_CONTEXT_AWARE_INTERNAL(http2, node::http2::Initialize)"
        },
        {
            "sha": "ae19149d1bc74dbc1a156b4aac92e11e83fddfbb",
            "filename": "test/parallel/test-http2-binding.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-binding.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-binding.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-binding.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -1,11 +1,13 @@\n+// Flags: --expose-internals\n 'use strict';\n \n const common = require('../common');\n if (!common.hasCrypto)\n   common.skip('missing crypto');\n const assert = require('assert');\n+const { internalBinding } = require('internal/test/binding');\n \n-const binding = process.binding('http2');\n+const binding = internalBinding('http2');\n const http2 = require('http2');\n \n assert(binding.Http2Session);"
        },
        {
            "sha": "e72b5f454ba650a46e24cc4e2a0f24a102307d87",
            "filename": "test/parallel/test-http2-client-onconnect-errors.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-client-onconnect-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-client-onconnect-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-client-onconnect-errors.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -5,11 +5,12 @@ const common = require('../common');\n if (!common.hasCrypto)\n   common.skip('missing crypto');\n \n+const { internalBinding } = require('internal/test/binding');\n const {\n   constants,\n   Http2Session,\n   nghttp2ErrorString\n-} = process.binding('http2');\n+} = internalBinding('http2');\n const http2 = require('http2');\n const { NghttpError } = require('internal/http2/util');\n "
        },
        {
            "sha": "e2cae58466bb82bba92cbefcbe80c9bb982b3e09",
            "filename": "test/parallel/test-http2-info-headers-errors.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-info-headers-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-info-headers-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-info-headers-errors.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -5,11 +5,12 @@ const common = require('../common');\n if (!common.hasCrypto)\n   common.skip('missing crypto');\n const http2 = require('http2');\n+const { internalBinding } = require('internal/test/binding');\n const {\n   constants,\n   Http2Stream,\n   nghttp2ErrorString\n-} = process.binding('http2');\n+} = internalBinding('http2');\n const { NghttpError } = require('internal/http2/util');\n \n // tests error handling within additionalHeaders"
        },
        {
            "sha": "98f2558253deff5a55f22d76da4ccef73c0ec18d",
            "filename": "test/parallel/test-http2-respond-errors.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-respond-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-respond-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-respond-errors.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -5,7 +5,8 @@ const common = require('../common');\n if (!common.hasCrypto)\n   common.skip('missing crypto');\n const http2 = require('http2');\n-const { Http2Stream } = process.binding('http2');\n+const { internalBinding } = require('internal/test/binding');\n+const { Http2Stream } = internalBinding('http2');\n \n const server = http2.createServer();\n "
        },
        {
            "sha": "5ebd24a65b1b2fcfeb4c0ab9c85243b2e052ec49",
            "filename": "test/parallel/test-http2-respond-nghttperrors.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-respond-nghttperrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-respond-nghttperrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-respond-nghttperrors.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -5,11 +5,12 @@ const common = require('../common');\n if (!common.hasCrypto)\n   common.skip('missing crypto');\n const http2 = require('http2');\n+const { internalBinding } = require('internal/test/binding');\n const {\n   constants,\n   Http2Stream,\n   nghttp2ErrorString\n-} = process.binding('http2');\n+} = internalBinding('http2');\n const { NghttpError } = require('internal/http2/util');\n \n // tests error handling within respond"
        },
        {
            "sha": "9dfd95ea5a2c7c36b3df44a23d7284991a58d24d",
            "filename": "test/parallel/test-http2-respond-with-fd-errors.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-respond-with-fd-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-respond-with-fd-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-respond-with-fd-errors.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -10,11 +10,12 @@ const fixtures = require('../common/fixtures');\n \n const http2 = require('http2');\n \n+const { internalBinding } = require('internal/test/binding');\n const {\n   constants,\n   Http2Stream,\n   nghttp2ErrorString\n-} = process.binding('http2');\n+} = internalBinding('http2');\n const { NghttpError } = require('internal/http2/util');\n \n // tests error handling within processRespondWithFD"
        },
        {
            "sha": "e489cae439205efa9f28a54ae61f29d1cce16a22",
            "filename": "test/parallel/test-http2-server-push-stream-errors.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-server-push-stream-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-server-push-stream-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-server-push-stream-errors.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -5,11 +5,12 @@ const common = require('../common');\n if (!common.hasCrypto)\n   common.skip('missing crypto');\n const http2 = require('http2');\n+const { internalBinding } = require('internal/test/binding');\n const {\n   constants,\n   Http2Stream,\n   nghttp2ErrorString\n-} = process.binding('http2');\n+} = internalBinding('http2');\n const { NghttpError } = require('internal/http2/util');\n \n // tests error handling within pushStream"
        },
        {
            "sha": "2402e01cbf329ef2f0563deec77eff50da90a990",
            "filename": "test/parallel/test-http2-util-headers-list.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-util-headers-list.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-util-headers-list.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-util-headers-list.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -9,7 +9,7 @@ if (!common.hasCrypto)\n   common.skip('missing crypto');\n const assert = require('assert');\n const { mapToHeaders, toHeaderObject } = require('internal/http2/util');\n-\n+const { internalBinding } = require('internal/test/binding');\n const {\n   HTTP2_HEADER_STATUS,\n   HTTP2_HEADER_METHOD,\n@@ -88,7 +88,7 @@ const {\n   HTTP2_HEADER_HOST,\n   HTTP2_HEADER_KEEP_ALIVE,\n   HTTP2_HEADER_PROXY_CONNECTION\n-} = process.binding('http2').constants;\n+} = internalBinding('http2').constants;\n \n {\n   const headers = {"
        },
        {
            "sha": "d9cfa0784926aeb720fccc28f0c1257bf35ac30e",
            "filename": "test/parallel/test-http2-util-update-options-buffer.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-util-update-options-buffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/4fa5448e5dd8fc06f92f94b170918913aef5bbdb/test%2Fparallel%2Ftest-http2-util-update-options-buffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-util-update-options-buffer.js?ref=4fa5448e5dd8fc06f92f94b170918913aef5bbdb",
            "patch": "@@ -9,7 +9,8 @@ if (!common.hasCrypto)\n // by the http2 implementation.\n \n const { updateOptionsBuffer } = require('internal/http2/util');\n-const { optionsBuffer } = process.binding('http2');\n+const { internalBinding } = require('internal/test/binding');\n+const { optionsBuffer } = internalBinding('http2');\n const { ok, strictEqual } = require('assert');\n \n const IDX_OPTIONS_MAX_DEFLATE_DYNAMIC_TABLE_SIZE = 0;"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 29,
        "deletions": 17
    }
}