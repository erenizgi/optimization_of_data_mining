{
    "author": "cjihrig",
    "message": "dns: make process.binding('cares_wrap') internal\n\nPR-URL: https://github.com/nodejs/node/pull/22474\nRefs: https://github.com/nodejs/node/issues/22160\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "8b0c482647004667ac9688f72264b9efca36b699",
    "files": [
        {
            "sha": "44fdb1764a13c046605064188e9cae4ae7b7edc3",
            "filename": "lib/dns.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/lib%2Fdns.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/lib%2Fdns.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fdns.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -21,7 +21,8 @@\n \n 'use strict';\n \n-const cares = process.binding('cares_wrap');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const cares = internalBinding('cares_wrap');\n const { isIP, isIPv4, isLegalPort } = require('internal/net');\n const { customPromisifyArgs } = require('internal/util');\n const errors = require('internal/errors');"
        },
        {
            "sha": "abe4d44b12ef06b4c6d5255b2a8da63be814d096",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -348,6 +348,7 @@\n     // internalBinding.\n     const internalBindingWhitelist =\n       new SafeSet([\n+        'cares_wrap',\n         'fs_event_wrap',\n         'uv',\n         'pipe_wrap',"
        },
        {
            "sha": "408dec712d821fd48e38c8f9b103cba7b614934e",
            "filename": "lib/internal/dns/promises.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/lib%2Finternal%2Fdns%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/lib%2Finternal%2Fdns%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fdns%2Fpromises.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -6,14 +6,15 @@ const {\n } = require('internal/dns/utils');\n const { codes, dnsException } = require('internal/errors');\n const { isIP, isIPv4, isLegalPort } = require('internal/net');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n const {\n   getaddrinfo,\n   getnameinfo,\n   ChannelWrap,\n   GetAddrInfoReqWrap,\n   GetNameInfoReqWrap,\n   QueryReqWrap\n-} = process.binding('cares_wrap');\n+} = internalBinding('cares_wrap');\n const {\n   ERR_INVALID_ARG_TYPE,\n   ERR_INVALID_OPT_VALUE,"
        },
        {
            "sha": "2362f28a821b9af24762a24ac35e585c3b2d3497",
            "filename": "lib/internal/dns/utils.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/lib%2Finternal%2Fdns%2Futils.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/lib%2Finternal%2Fdns%2Futils.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fdns%2Futils.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -1,12 +1,13 @@\n 'use strict';\n const errors = require('internal/errors');\n const { isIP } = require('internal/net');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n const {\n   ChannelWrap,\n   strerror,\n   AI_ADDRCONFIG,\n   AI_V4MAPPED\n-} = process.binding('cares_wrap');\n+} = internalBinding('cares_wrap');\n const IANA_DNS_PORT = 53;\n const IPv6RE = /^\\[([^[\\]]*)\\]/;\n const addrSplitRE = /(^.+?)(?::(\\d+))?$/;"
        },
        {
            "sha": "8e72033e555ffde3d2cba95335d90f804450890e",
            "filename": "lib/internal/net.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/lib%2Finternal%2Fnet.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/lib%2Finternal%2Fnet.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fnet.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -1,7 +1,8 @@\n 'use strict';\n \n const Buffer = require('buffer').Buffer;\n-const { isIPv6 } = process.binding('cares_wrap');\n+const { internalBinding } = require('internal/bootstrap/loaders');\n+const { isIPv6 } = internalBinding('cares_wrap');\n const { writeBuffer } = process.binding('fs');\n const errors = require('internal/errors');\n "
        },
        {
            "sha": "9da17411db3df6d1268ef3c61044e760a3f5ba15",
            "filename": "lib/tls.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/lib%2Ftls.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/lib%2Ftls.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftls.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -35,7 +35,7 @@ const { Buffer } = require('buffer');\n const EventEmitter = require('events');\n const { URL } = require('internal/url');\n const DuplexPair = require('internal/streams/duplexpair');\n-const { canonicalizeIP } = process.binding('cares_wrap');\n+const { canonicalizeIP } = internalBinding('cares_wrap');\n const _tls_common = require('_tls_common');\n const _tls_wrap = require('_tls_wrap');\n "
        },
        {
            "sha": "d32c8c2ba68788f1f98f6f1f5b599e70986ac848",
            "filename": "src/cares_wrap.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/src%2Fcares_wrap.cc",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/src%2Fcares_wrap.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fcares_wrap.cc?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -2238,4 +2238,4 @@ void Initialize(Local<Object> target,\n }  // namespace cares_wrap\n }  // namespace node\n \n-NODE_BUILTIN_MODULE_CONTEXT_AWARE(cares_wrap, node::cares_wrap::Initialize)\n+NODE_MODULE_CONTEXT_AWARE_INTERNAL(cares_wrap, node::cares_wrap::Initialize)"
        },
        {
            "sha": "5c53781fde4a69b131851926781e300ef2c59715",
            "filename": "test/internet/test-dns.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/test%2Finternet%2Ftest-dns.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/test%2Finternet%2Ftest-dns.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Finternet%2Ftest-dns.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --expose-internals\n // Copyright Joyent, Inc. and other Node contributors.\n //\n // Permission is hereby granted, free of charge, to any person obtaining a\n@@ -22,6 +23,7 @@\n 'use strict';\n const common = require('../common');\n const { addresses } = require('../common/internet');\n+const { internalBinding } = require('internal/test/binding');\n const assert = require('assert');\n const dns = require('dns');\n const net = require('net');\n@@ -674,7 +676,7 @@ let getaddrinfoCallbackCalled = false;\n \n console.log(`looking up ${addresses.INET4_HOST}..`);\n \n-const cares = process.binding('cares_wrap');\n+const cares = internalBinding('cares_wrap');\n const req = new cares.GetAddrInfoReqWrap();\n cares.getaddrinfo(req, addresses.INET4_HOST, 4,\n   /* hints */ 0, /* verbatim */ true);"
        },
        {
            "sha": "b20d403d37b6e4a1c49dc3ca40d7b1219e78b705",
            "filename": "test/parallel/test-dns-lookup.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/test%2Fparallel%2Ftest-dns-lookup.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/test%2Fparallel%2Ftest-dns-lookup.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-dns-lookup.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -3,12 +3,11 @@\n const common = require('../common');\n const { addresses } = require('../common/internet');\n const assert = require('assert');\n-const cares = process.binding('cares_wrap');\n+const { internalBinding } = require('internal/test/binding');\n+const cares = internalBinding('cares_wrap');\n const dns = require('dns');\n const dnsPromises = dns.promises;\n \n-const { internalBinding } = require('internal/test/binding');\n-\n // Stub `getaddrinfo` to *always* error.\n cares.getaddrinfo = () => internalBinding('uv').UV_ENOENT;\n "
        },
        {
            "sha": "f5a4aab17a203e29c2156489c3a82b6d5fb3a6b5",
            "filename": "test/parallel/test-tls-canonical-ip.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/test%2Fparallel%2Ftest-tls-canonical-ip.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/test%2Fparallel%2Ftest-tls-canonical-ip.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-canonical-ip.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -1,3 +1,4 @@\n+// Flags: --expose-internals\n 'use strict';\n require('../common');\n \n@@ -6,7 +7,8 @@ require('../common');\n // of a TLS certificate\n \n const assert = require('assert');\n-const { canonicalizeIP } = process.binding('cares_wrap');\n+const { internalBinding } = require('internal/test/binding');\n+const { canonicalizeIP } = internalBinding('cares_wrap');\n \n assert.strictEqual(canonicalizeIP('127.0.0.1'), '127.0.0.1');\n assert.strictEqual(canonicalizeIP('10.1.0.1'), '10.1.0.1');"
        },
        {
            "sha": "866970c0d6dafc4e7c217f820e38a6c3fe360398",
            "filename": "test/sequential/test-async-wrap-getasyncid.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/8b0c482647004667ac9688f72264b9efca36b699/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "raw_url": "https://github.com/nodejs/node/raw/8b0c482647004667ac9688f72264b9efca36b699/test%2Fsequential%2Ftest-async-wrap-getasyncid.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-async-wrap-getasyncid.js?ref=8b0c482647004667ac9688f72264b9efca36b699",
            "patch": "@@ -69,7 +69,7 @@ function testInitialized(req, ctor_name) {\n \n \n {\n-  const cares = process.binding('cares_wrap');\n+  const cares = internalBinding('cares_wrap');\n   const dns = require('dns');\n \n   testUninitialized(new cares.GetAddrInfoReqWrap(), 'GetAddrInfoReqWrap');"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 20,
        "deletions": 12
    }
}