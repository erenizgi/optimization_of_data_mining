{
    "author": "tniessen",
    "message": "crypto: simplify state failure handling\n\nIt is more intuitive to return true/false instead of undefined/false\nand also simplifies handling in the JS layer.\n\nPR-URL: https://github.com/nodejs/node/pull/22131\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ujjwal Sharma <usharma1998@gmail.com>",
    "sha": "77ac9628b3ccfadb7775625d15160cd6bf90d08e",
    "files": [
        {
            "sha": "94acc40639105b41d7e540ea9434c8ef54d36bbb",
            "filename": "lib/internal/crypto/cipher.js",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/77ac9628b3ccfadb7775625d15160cd6bf90d08e/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "raw_url": "https://github.com/nodejs/node/raw/77ac9628b3ccfadb7775625d15160cd6bf90d08e/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fcipher.js?ref=77ac9628b3ccfadb7775625d15160cd6bf90d08e",
            "patch": "@@ -181,7 +181,7 @@ Cipher.prototype.final = function final(outputEncoding) {\n \n \n Cipher.prototype.setAutoPadding = function setAutoPadding(ap) {\n-  if (this._handle.setAutoPadding(ap) === false)\n+  if (!this._handle.setAutoPadding(ap))\n     throw new ERR_CRYPTO_INVALID_STATE('setAutoPadding');\n   return this;\n };\n@@ -200,10 +200,7 @@ Cipher.prototype.setAuthTag = function setAuthTag(tagbuf) {\n                                    ['Buffer', 'TypedArray', 'DataView'],\n                                    tagbuf);\n   }\n-  // Do not do a normal falsy check because the method returns\n-  // undefined if it succeeds. Returns false specifically if it\n-  // errored\n-  if (this._handle.setAuthTag(tagbuf) === false)\n+  if (!this._handle.setAuthTag(tagbuf))\n     throw new ERR_CRYPTO_INVALID_STATE('setAuthTag');\n   return this;\n };\n@@ -216,7 +213,7 @@ Cipher.prototype.setAAD = function setAAD(aadbuf, options) {\n   }\n \n   const plaintextLength = getUIntOption(options, 'plaintextLength');\n-  if (this._handle.setAAD(aadbuf, plaintextLength) === false)\n+  if (!this._handle.setAAD(aadbuf, plaintextLength))\n     throw new ERR_CRYPTO_INVALID_STATE('setAAD');\n   return this;\n };"
        },
        {
            "sha": "0ee7156715cb14680405806db3bc2c7becc9db6d",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/77ac9628b3ccfadb7775625d15160cd6bf90d08e/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/77ac9628b3ccfadb7775625d15160cd6bf90d08e/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=77ac9628b3ccfadb7775625d15160cd6bf90d08e",
            "patch": "@@ -2939,6 +2939,8 @@ void CipherBase::SetAuthTag(const FunctionCallbackInfo<Value>& args) {\n \n   memset(cipher->auth_tag_, 0, sizeof(cipher->auth_tag_));\n   memcpy(cipher->auth_tag_, Buffer::Data(args[0]), cipher->auth_tag_len_);\n+\n+  args.GetReturnValue().Set(true);\n }\n \n \n@@ -2993,9 +2995,9 @@ void CipherBase::SetAAD(const FunctionCallbackInfo<Value>& args) {\n   CHECK(args[1]->IsInt32());\n   int plaintext_len = args[1].As<Int32>()->Value();\n \n-  if (!cipher->SetAAD(Buffer::Data(args[0]), Buffer::Length(args[0]),\n-                      plaintext_len))\n-    args.GetReturnValue().Set(false);  // Report invalid state failure\n+  bool b = cipher->SetAAD(Buffer::Data(args[0]), Buffer::Length(args[0]),\n+                          plaintext_len);\n+  args.GetReturnValue().Set(b);  // Possibly report invalid state failure\n }\n \n \n@@ -3107,8 +3109,8 @@ void CipherBase::SetAutoPadding(const FunctionCallbackInfo<Value>& args) {\n   CipherBase* cipher;\n   ASSIGN_OR_RETURN_UNWRAP(&cipher, args.Holder());\n \n-  if (!cipher->SetAutoPadding(args.Length() < 1 || args[0]->BooleanValue()))\n-    args.GetReturnValue().Set(false);  // Report invalid state failure\n+  bool b = cipher->SetAutoPadding(args.Length() < 1 || args[0]->BooleanValue());\n+  args.GetReturnValue().Set(b);  // Possibly report invalid state failure\n }\n \n "
        }
    ],
    "stats": {
        "total": 21,
        "additions": 10,
        "deletions": 11
    }
}