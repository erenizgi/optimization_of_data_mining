{
    "author": "addaleax",
    "message": "worker: hide MessagePort init function behind symbol\n\nThis reduces unintended exposure of internals.\n\nPR-URL: https://github.com/nodejs/node/pull/23037\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "2d65e67305a7c39f1c157f497fde25f3d84d9153",
    "files": [
        {
            "sha": "b5dab224211b132168b5a513ef0caefb1a1b83fc",
            "filename": "lib/internal/worker.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/2d65e67305a7c39f1c157f497fde25f3d84d9153/lib%2Finternal%2Fworker.js",
            "raw_url": "https://github.com/nodejs/node/raw/2d65e67305a7c39f1c157f497fde25f3d84d9153/lib%2Finternal%2Fworker.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fworker.js?ref=2d65e67305a7c39f1c157f497fde25f3d84d9153",
            "patch": "@@ -24,7 +24,8 @@ util.inherits(MessagePort, EventEmitter);\n const {\n   Worker: WorkerImpl,\n   getEnvMessagePort,\n-  threadId\n+  threadId,\n+  oninit: oninit_symbol\n } = internalBinding('worker');\n \n const isMainThread = threadId === 0;\n@@ -93,7 +94,7 @@ function oninit() {\n   setupPortReferencing(this, this, 'message');\n }\n \n-Object.defineProperty(MessagePort.prototype, 'oninit', {\n+Object.defineProperty(MessagePort.prototype, oninit_symbol, {\n   enumerable: true,\n   writable: false,\n   value: oninit"
        },
        {
            "sha": "feeeda661cec6648b7da292e5c1b03ac96792916",
            "filename": "src/env.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2d65e67305a7c39f1c157f497fde25f3d84d9153/src%2Fenv.h",
            "raw_url": "https://github.com/nodejs/node/raw/2d65e67305a7c39f1c157f497fde25f3d84d9153/src%2Fenv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.h?ref=2d65e67305a7c39f1c157f497fde25f3d84d9153",
            "patch": "@@ -113,6 +113,7 @@ struct PackageConfig {\n #define PER_ISOLATE_SYMBOL_PROPERTIES(V)                                      \\\n   V(handle_onclose_symbol, \"handle_onclose\")                                  \\\n   V(owner_symbol, \"owner\")                                                    \\\n+  V(oninit_symbol, \"oninit\")                                                  \\\n \n // Strings are per-isolate primitives but Environment proxies them\n // for the sake of convenience.  Strings should be ASCII-only.\n@@ -219,7 +220,6 @@ struct PackageConfig {\n   V(onhandshakedone_string, \"onhandshakedone\")                                \\\n   V(onhandshakestart_string, \"onhandshakestart\")                              \\\n   V(onheaders_string, \"onheaders\")                                            \\\n-  V(oninit_string, \"oninit\")                                                  \\\n   V(onmessage_string, \"onmessage\")                                            \\\n   V(onnewsession_string, \"onnewsession\")                                      \\\n   V(onocspresponse_string, \"onocspresponse\")                                  \\"
        },
        {
            "sha": "6dd66f243e8a2064cfcaaeb5534fe4c3fa86e421",
            "filename": "src/node_messaging.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2d65e67305a7c39f1c157f497fde25f3d84d9153/src%2Fnode_messaging.cc",
            "raw_url": "https://github.com/nodejs/node/raw/2d65e67305a7c39f1c157f497fde25f3d84d9153/src%2Fnode_messaging.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_messaging.cc?ref=2d65e67305a7c39f1c157f497fde25f3d84d9153",
            "patch": "@@ -421,7 +421,7 @@ MessagePort::MessagePort(Environment* env,\n   async()->data = static_cast<void*>(this);\n \n   Local<Value> fn;\n-  if (!wrap->Get(context, env->oninit_string()).ToLocal(&fn))\n+  if (!wrap->Get(context, env->oninit_symbol()).ToLocal(&fn))\n     return;\n \n   if (fn->IsFunction()) {"
        },
        {
            "sha": "14a61ceb1669485d4b7f658cf69d917d7ff6ad3c",
            "filename": "src/node_worker.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/2d65e67305a7c39f1c157f497fde25f3d84d9153/src%2Fnode_worker.cc",
            "raw_url": "https://github.com/nodejs/node/raw/2d65e67305a7c39f1c157f497fde25f3d84d9153/src%2Fnode_worker.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_worker.cc?ref=2d65e67305a7c39f1c157f497fde25f3d84d9153",
            "patch": "@@ -502,6 +502,10 @@ void InitWorker(Local<Object> target,\n               thread_id_string,\n               Number::New(env->isolate(),\n                           static_cast<double>(env->thread_id()))).FromJust();\n+  Local<String> oninit_string = FIXED_ONE_BYTE_STRING(env->isolate(), \"oninit\");\n+  target->Set(env->context(),\n+              oninit_string,\n+              env->oninit_symbol()).FromJust();\n }\n \n }  // anonymous namespace"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 9,
        "deletions": 4
    }
}