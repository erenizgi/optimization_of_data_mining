{
    "author": "addaleax",
    "message": "util: introduce `formatWithOptions()`\n\nIdentical to `format()` except that it takes an options argument\nthat is passed through to `inspect()`.\n\nPR-URL: https://github.com/nodejs/node/pull/19372\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "681c1d2f2c76540b114e868f601782c16bf6a493",
    "files": [
        {
            "sha": "23a1774a1fa6bf3957741233b0f34d47f1d1d69e",
            "filename": "doc/api/util.md",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/681c1d2f2c76540b114e868f601782c16bf6a493/doc%2Fapi%2Futil.md",
            "raw_url": "https://github.com/nodejs/node/raw/681c1d2f2c76540b114e868f601782c16bf6a493/doc%2Fapi%2Futil.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Futil.md?ref=681c1d2f2c76540b114e868f601782c16bf6a493",
            "patch": "@@ -254,6 +254,24 @@ intended as a debugging tool. Some input values can have a significant\n performance overhead that can block the event loop. Use this function\n with care and never in a hot code path.\n \n+## util.formatWithOptions(inspectOptions, format[, ...args])\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+* `inspectOptions` {Object}\n+* `format` {string}\n+\n+This function is identical to [`util.format()`][], except in that it takes\n+an `inspectOptions` argument which specifies options that are passed along to\n+[`util.inspect()`][].\n+\n+```js\n+util.formatWithOptions({ colors: true }, 'See object %O', { foo: 42 });\n+  // Returns 'See object { foo: 42 }', where `42` is colored as a number\n+  // when printed to a terminal.\n+```\n+\n ## util.getSystemErrorName(err)\n <!-- YAML\n added: v9.7.0\n@@ -2054,6 +2072,7 @@ Deprecated predecessor of `console.log`.\n [`Set`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Set\n [`SharedArrayBuffer`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/SharedArrayBuffer\n [`TypedArray`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray\n+[`util.format()`]: #util_util_format_format_args\n [`util.inspect()`]: #util_util_inspect_object_options\n [`util.promisify()`]: #util_util_promisify_original\n [`util.types.isAnyArrayBuffer()`]: #util_util_types_isanyarraybuffer_value"
        },
        {
            "sha": "0483e4e06758f69f65e766cdf38572737beabf24",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 22,
            "deletions": 11,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/681c1d2f2c76540b114e868f601782c16bf6a493/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/681c1d2f2c76540b114e868f601782c16bf6a493/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=681c1d2f2c76540b114e868f601782c16bf6a493",
            "patch": "@@ -173,23 +173,28 @@ function tryStringify(arg) {\n   }\n }\n \n-function format(f) {\n+const emptyOptions = {};\n+function format(...args) {\n+  return formatWithOptions(emptyOptions, ...args);\n+}\n+\n+function formatWithOptions(inspectOptions, f) {\n   let i, tempStr;\n   if (typeof f !== 'string') {\n-    if (arguments.length === 0) return '';\n+    if (arguments.length === 1) return '';\n     let res = '';\n-    for (i = 0; i < arguments.length - 1; i++) {\n-      res += inspect(arguments[i]);\n+    for (i = 1; i < arguments.length - 1; i++) {\n+      res += inspect(arguments[i], inspectOptions);\n       res += ' ';\n     }\n-    res += inspect(arguments[i]);\n+    res += inspect(arguments[i], inspectOptions);\n     return res;\n   }\n \n-  if (arguments.length === 1) return f;\n+  if (arguments.length === 2) return f;\n \n   let str = '';\n-  let a = 1;\n+  let a = 2;\n   let lastPos = 0;\n   for (i = 0; i < f.length - 1; i++) {\n     if (f.charCodeAt(i) === 37) { // '%'\n@@ -206,12 +211,17 @@ function format(f) {\n             tempStr = `${Number(arguments[a++])}`;\n             break;\n           case 79: // 'O'\n-            tempStr = inspect(arguments[a++]);\n+            tempStr = inspect(arguments[a++], inspectOptions);\n             break;\n           case 111: // 'o'\n-            tempStr = inspect(arguments[a++],\n-                              { showHidden: true, showProxy: true });\n+          {\n+            const opts = Object.assign({}, inspectOptions, {\n+              showHidden: true,\n+              showProxy: true\n+            });\n+            tempStr = inspect(arguments[a++], opts);\n             break;\n+          }\n           case 105: // 'i'\n             tempStr = `${parseInt(arguments[a++])}`;\n             break;\n@@ -244,7 +254,7 @@ function format(f) {\n     if ((typeof x !== 'object' && typeof x !== 'symbol') || x === null) {\n       str += ` ${x}`;\n     } else {\n-      str += ` ${inspect(x)}`;\n+      str += ` ${inspect(x, inspectOptions)}`;\n     }\n   }\n   return str;\n@@ -1206,6 +1216,7 @@ module.exports = exports = {\n   debuglog,\n   deprecate,\n   format,\n+  formatWithOptions,\n   getSystemErrorName,\n   inherits,\n   inspect,"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 41,
        "deletions": 11
    }
}