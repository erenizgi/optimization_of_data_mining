{
    "author": "oyyd",
    "message": "worker: remove redundant function call to `setupPortReferencing`\n\nThere is no need to call `setupPortReferencing` in `setupChild`\nas which has been called with the same arguments in the `oninit`\nprototype method of `MessagePort`.\n\nPR-URL: https://github.com/nodejs/node/pull/22298\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "3b5c9926e9bf8f17b2bc948450e6787c811ad6d6",
    "files": [
        {
            "sha": "a1abcff567d424df1137e01102ab187df22a0454",
            "filename": "lib/internal/worker.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/3b5c9926e9bf8f17b2bc948450e6787c811ad6d6/lib%2Finternal%2Fworker.js",
            "raw_url": "https://github.com/nodejs/node/raw/3b5c9926e9bf8f17b2bc948450e6787c811ad6d6/lib%2Finternal%2Fworker.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fworker.js?ref=3b5c9926e9bf8f17b2bc948450e6787c811ad6d6",
            "patch": "@@ -408,7 +408,6 @@ function setupChild(evalScript) {\n     if (message.type === messageTypes.LOAD_SCRIPT) {\n       const { filename, doEval, workerData, publicPort, hasStdin } = message;\n       publicWorker.parentPort = publicPort;\n-      setupPortReferencing(publicPort, publicPort, 'message');\n       publicWorker.workerData = workerData;\n \n       if (!hasStdin)"
        },
        {
            "sha": "48963f320f44503f4bd9cfcaa138d7381e8b7763",
            "filename": "test/parallel/test-worker-parent-port-ref.js",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/3b5c9926e9bf8f17b2bc948450e6787c811ad6d6/test%2Fparallel%2Ftest-worker-parent-port-ref.js",
            "raw_url": "https://github.com/nodejs/node/raw/3b5c9926e9bf8f17b2bc948450e6787c811ad6d6/test%2Fparallel%2Ftest-worker-parent-port-ref.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-worker-parent-port-ref.js?ref=3b5c9926e9bf8f17b2bc948450e6787c811ad6d6",
            "patch": "@@ -0,0 +1,25 @@\n+// Flags: --experimental-worker\n+'use strict';\n+const assert = require('assert');\n+const common = require('../common');\n+const { isMainThread, parentPort, Worker } = require('worker_threads');\n+\n+// This test makes sure that we manipulate the references of\n+// `parentPort` correctly so that any worker threads will\n+// automatically exit when there are no any other references.\n+{\n+  if (isMainThread) {\n+    const worker = new Worker(__filename);\n+\n+    worker.on('exit', common.mustCall((code) => {\n+      assert.strictEqual(code, 0);\n+    }), 1);\n+\n+    worker.on('online', common.mustCall());\n+  } else {\n+    const messageCallback = () => {};\n+    parentPort.on('message', messageCallback);\n+    // The thread won't exit if we don't make the 'message' listener off.\n+    parentPort.off('message', messageCallback);\n+  }\n+}"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 25,
        "deletions": 1
    }
}