{
    "author": "cjihrig",
    "message": "tls: deprecate Server.prototype.setOptions()\n\nThis function was undocumented and only used in one place\nthroughout the codebase, plus a test.\n\nPR-URL: https://github.com/nodejs/node/pull/23820\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Sam Roberts <vieuxtech@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Rich Trott <rtrott@gmail.com>",
    "sha": "246a6fc1078ae3ef257169847704dd8db4122095",
    "files": [
        {
            "sha": "15199b9ebeb64d056041131070499cd7a898426a",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/246a6fc1078ae3ef257169847704dd8db4122095/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/246a6fc1078ae3ef257169847704dd8db4122095/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=246a6fc1078ae3ef257169847704dd8db4122095",
            "patch": "@@ -2279,6 +2279,20 @@ and `cluster` modules on Windows. The function is not generally useful and\n is being removed. See discussion here:\n https://github.com/nodejs/node/issues/18391\n \n+<a id=\"DEP0122\"></a>\n+### DEP0122: tls Server.prototype.setOptions()\n+<!-- YAML\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/23820\n+    description: Runtime deprecation.\n+-->\n+\n+Type: Runtime\n+\n+Please use `Server.prototype.setSecureContext()` instead.\n+\n+\n [`--pending-deprecation`]: cli.html#cli_pending_deprecation\n [`Buffer.allocUnsafeSlow(size)`]: buffer.html#buffer_class_method_buffer_allocunsafeslow_size\n [`Buffer.from(array)`]: buffer.html#buffer_class_method_buffer_from_array"
        },
        {
            "sha": "f0d86f3d870f090a610f39e89083377d9edd497d",
            "filename": "lib/_tls_wrap.js",
            "status": "modified",
            "additions": 12,
            "deletions": 9,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/246a6fc1078ae3ef257169847704dd8db4122095/lib%2F_tls_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/246a6fc1078ae3ef257169847704dd8db4122095/lib%2F_tls_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_wrap.js?ref=246a6fc1078ae3ef257169847704dd8db4122095",
            "patch": "@@ -827,16 +827,19 @@ function Server(options, listener) {\n     throw new ERR_INVALID_ARG_TYPE('options', 'Object', options);\n   }\n \n-\n   this._contexts = [];\n+  this.requestCert = options.requestCert === true;\n+  this.rejectUnauthorized = options.rejectUnauthorized !== false;\n \n-  // Handle option defaults:\n-  this.setOptions(options);\n+  if (options.sessionTimeout)\n+    this.sessionTimeout = options.sessionTimeout;\n+\n+  if (options.ticketKeys)\n+    this.ticketKeys = options.ticketKeys;\n+\n+  if (options.ALPNProtocols)\n+    tls.convertALPNProtocols(options.ALPNProtocols, this);\n \n-  // setSecureContext() overlaps with setOptions() quite a bit. setOptions()\n-  // is an undocumented API that was probably never intended to be exposed\n-  // publicly. Unfortunately, it would be a breaking change to just remove it,\n-  // and there is at least one test that depends on it.\n   this.setSecureContext(options);\n \n   this[kHandshakeTimeout] = options.handshakeTimeout || (120 * 1000);\n@@ -998,7 +1001,7 @@ Server.prototype.setTicketKeys = function setTicketKeys(keys) {\n };\n \n \n-Server.prototype.setOptions = function(options) {\n+Server.prototype.setOptions = util.deprecate(function(options) {\n   this.requestCert = options.requestCert === true;\n   this.rejectUnauthorized = options.rejectUnauthorized !== false;\n \n@@ -1033,7 +1036,7 @@ Server.prototype.setOptions = function(options) {\n                                   .digest('hex')\n                                   .slice(0, 32);\n   }\n-};\n+}, 'Server.prototype.setOptions() is deprecated', 'DEP0122');\n \n // SNI Contexts High-Level API\n Server.prototype.addContext = function(servername, context) {"
        },
        {
            "sha": "56026c9b23d4eda6da0eee4601b02cb41f713f87",
            "filename": "test/parallel/test-tls-server-setoptions-clientcertengine.js",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/246a6fc1078ae3ef257169847704dd8db4122095/test%2Fparallel%2Ftest-tls-server-setoptions-clientcertengine.js",
            "raw_url": "https://github.com/nodejs/node/raw/246a6fc1078ae3ef257169847704dd8db4122095/test%2Fparallel%2Ftest-tls-server-setoptions-clientcertengine.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-server-setoptions-clientcertengine.js?ref=246a6fc1078ae3ef257169847704dd8db4122095",
            "patch": "@@ -10,6 +10,9 @@ const tls = require('tls');\n {\n   const server = tls.createServer();\n   assert.strictEqual(server.clientCertEngine, undefined);\n+  common.expectWarning('DeprecationWarning',\n+                       'Server.prototype.setOptions() is deprecated',\n+                       'DEP0122');\n   server.setOptions({ clientCertEngine: 'Cannonmouth' });\n   assert.strictEqual(server.clientCertEngine, 'Cannonmouth');\n }"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 29,
        "deletions": 9
    }
}