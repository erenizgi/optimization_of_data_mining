{
    "author": "richardlau",
    "message": "build: exclude npm test directories on Windows\n\nnpm test directories are excluded on other platforms by\n`tools/install.py`. Do the same on Windows.\n\nFixes: https://github.com/nodejs/node/issues/22901\n\nPR-URL: https://github.com/nodejs/node/pull/23001\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: João Reis <reis@janeasystems.com>",
    "sha": "b3b3f53a339135903133842888467a0e6798acd0",
    "files": [
        {
            "sha": "66a97f243d8dded59f7a4d7b0896ea56f6fdc36b",
            "filename": "tools/msvs/msi/nodemsi.wixproj",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/b3b3f53a339135903133842888467a0e6798acd0/tools%2Fmsvs%2Fmsi%2Fnodemsi.wixproj",
            "raw_url": "https://github.com/nodejs/node/raw/b3b3f53a339135903133842888467a0e6798acd0/tools%2Fmsvs%2Fmsi%2Fnodemsi.wixproj",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmsvs%2Fmsi%2Fnodemsi.wixproj?ref=b3b3f53a339135903133842888467a0e6798acd0",
            "patch": "@@ -1,4 +1,4 @@\n-﻿<?xml version=\"1.0\" encoding=\"utf-8\"?>\n+<?xml version=\"1.0\" encoding=\"utf-8\"?>\n <Project ToolsVersion=\"4.0\" DefaultTargets=\"Build\" xmlns=\"http://schemas.microsoft.com/developer/msbuild/2003\">\n   <PropertyGroup>\n     <Configuration Condition=\" '$(Configuration)' == '' \">Debug</Configuration>\n@@ -16,23 +16,23 @@\n   <PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Debug|x86' \">\n     <OutputPath>..\\..\\..\\</OutputPath>\n     <IntermediateOutputPath>obj\\$(Configuration)\\</IntermediateOutputPath>\n-    <DefineConstants>Debug;ProductVersion=$(NodeVersion);FullVersion=$(FullVersion);DistTypeDir=$(DistTypeDir);NoETW=$(NoETW);NpmSourceDir=..\\..\\..\\deps\\npm\\;ProgramFilesFolderId=ProgramFilesFolder</DefineConstants>\n+    <DefineConstants>Debug;ProductVersion=$(NodeVersion);FullVersion=$(FullVersion);DistTypeDir=$(DistTypeDir);NoETW=$(NoETW);NpmSourceDir=..\\..\\..\\Release\\node-v$(FullVersion)-win-$(Platform)\\node_modules\\npm\\;ProgramFilesFolderId=ProgramFilesFolder</DefineConstants>\n   </PropertyGroup>\n   <PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Release|x86' \">\n     <OutputPath>..\\..\\..\\</OutputPath>\n     <IntermediateOutputPath>obj\\$(Configuration)\\</IntermediateOutputPath>\n-    <DefineConstants>Debug;ProductVersion=$(NodeVersion);FullVersion=$(FullVersion);DistTypeDir=$(DistTypeDir);NoETW=$(NoETW);NpmSourceDir=..\\..\\..\\deps\\npm\\;ProgramFilesFolderId=ProgramFilesFolder</DefineConstants>\n+    <DefineConstants>Debug;ProductVersion=$(NodeVersion);FullVersion=$(FullVersion);DistTypeDir=$(DistTypeDir);NoETW=$(NoETW);NpmSourceDir=..\\..\\..\\Release\\node-v$(FullVersion)-win-$(Platform)\\node_modules\\npm\\;ProgramFilesFolderId=ProgramFilesFolder</DefineConstants>\n   </PropertyGroup>\n   <PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Debug|x64' \">\n     <OutputPath>..\\..\\..\\</OutputPath>\n     <IntermediateOutputPath>obj\\$(Configuration)\\</IntermediateOutputPath>\n-    <DefineConstants>Debug;ProductVersion=$(NodeVersion);FullVersion=$(FullVersion);DistTypeDir=$(DistTypeDir);NoETW=$(NoETW);NpmSourceDir=..\\..\\..\\deps\\npm\\;ProgramFilesFolderId=ProgramFiles64Folder</DefineConstants>\n+    <DefineConstants>Debug;ProductVersion=$(NodeVersion);FullVersion=$(FullVersion);DistTypeDir=$(DistTypeDir);NoETW=$(NoETW);NpmSourceDir=..\\..\\..\\Release\\node-v$(FullVersion)-win-$(Platform)\\node_modules\\npm\\;ProgramFilesFolderId=ProgramFiles64Folder</DefineConstants>\n     <Cultures>en-US</Cultures>\n   </PropertyGroup>\n   <PropertyGroup Condition=\" '$(Configuration)|$(Platform)' == 'Release|x64' \">\n     <OutputPath>..\\..\\..\\</OutputPath>\n     <IntermediateOutputPath>obj\\$(Configuration)\\</IntermediateOutputPath>\n-    <DefineConstants>Debug;ProductVersion=$(NodeVersion);FullVersion=$(FullVersion);DistTypeDir=$(DistTypeDir);NoETW=$(NoETW);NpmSourceDir=..\\..\\..\\deps\\npm\\;ProgramFilesFolderId=ProgramFiles64Folder</DefineConstants>\n+    <DefineConstants>Debug;ProductVersion=$(NodeVersion);FullVersion=$(FullVersion);DistTypeDir=$(DistTypeDir);NoETW=$(NoETW);NpmSourceDir=..\\..\\..\\Release\\node-v$(FullVersion)-win-$(Platform)\\node_modules\\npm\\;ProgramFilesFolderId=ProgramFiles64Folder</DefineConstants>\n   </PropertyGroup>\n   <PropertyGroup>\n     <EnableProjectHarvesting>True</EnableProjectHarvesting>\n@@ -73,7 +73,7 @@\n   </ItemGroup>\n   <Import Project=\"$(WixTargetsPath)\" />\n   <Target Name=\"BeforeBuild\">\n-    <HeatDirectory ToolPath=\"$(WixToolPath)\" Directory=\"..\\..\\..\\deps\\npm\" PreprocessorVariable=\"var.NpmSourceDir\" DirectoryRefId=\"NodeModulesFolder\" ComponentGroupName=\"NpmSourceFiles\" GenerateGuidsNow=\"true\" SuppressFragments=\"false\" OutputFile=\"..\\..\\..\\npm.wxs\" RunAsSeparateProcess=\"true\">\n+    <HeatDirectory ToolPath=\"$(WixToolPath)\" Directory=\"..\\..\\..\\Release\\node-v$(FullVersion)-win-$(Platform)\\node_modules\\npm\" PreprocessorVariable=\"var.NpmSourceDir\" DirectoryRefId=\"NodeModulesFolder\" ComponentGroupName=\"NpmSourceFiles\" GenerateGuidsNow=\"true\" SuppressFragments=\"false\" OutputFile=\"..\\..\\..\\npm.wxs\" RunAsSeparateProcess=\"true\">\n     </HeatDirectory>\n   </Target>\n   <PropertyGroup>"
        },
        {
            "sha": "b90d2b09cc44029a1fce387d885749ab0cb94e93",
            "filename": "vcbuild.bat",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/b3b3f53a339135903133842888467a0e6798acd0/vcbuild.bat",
            "raw_url": "https://github.com/nodejs/node/raw/b3b3f53a339135903133842888467a0e6798acd0/vcbuild.bat",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/vcbuild.bat?ref=b3b3f53a339135903133842888467a0e6798acd0",
            "patch": "@@ -25,6 +25,7 @@ set sign=\n set nosnapshot=\n set cctest_args=\n set test_args=\n+set stage_package=\n set package=\n set msi=\n set upload=\n@@ -153,6 +154,9 @@ if defined build_release (\n   set \"pch=\"\n )\n \n+if defined msi     set stage_package=1\n+if defined package set stage_package=1\n+\n :: assign path to node_exe\n set \"node_exe=%config%\\node.exe\"\n set \"node_gyp_exe=\"%node_exe%\" deps\\npm\\node_modules\\node-gyp\\bin\\node-gyp\"\n@@ -313,15 +317,17 @@ if errorlevel 1 echo Failed to sign exe&goto exit\n \n :licensertf\n @rem Skip license.rtf generation if not requested.\n-if not defined licensertf goto package\n+if not defined licensertf goto stage_package\n \n %config%\\node.exe tools\\license2rtf.js < LICENSE > %config%\\license.rtf\n if errorlevel 1 echo Failed to generate license.rtf&goto exit\n \n-:package\n-if not defined package goto msi\n+:stage_package\n+if not defined stage_package goto install-doctools\n+\n echo Creating package...\n cd Release\n+rmdir /S /Q node-v%FULLVERSION%-win-%target_arch% > nul 2> nul\n mkdir node-v%FULLVERSION%-win-%target_arch% > nul 2> nul\n mkdir node-v%FULLVERSION%-win-%target_arch%\\node_modules > nul 2>nul\n \n@@ -333,7 +339,7 @@ copy /Y ..\\README.md node-v%FULLVERSION%-win-%target_arch%\\ > nul\n if errorlevel 1 echo Cannot copy README.md && goto package_error\n copy /Y ..\\CHANGELOG.md node-v%FULLVERSION%-win-%target_arch%\\ > nul\n if errorlevel 1 echo Cannot copy CHANGELOG.md && goto package_error\n-robocopy /e ..\\deps\\npm node-v%FULLVERSION%-win-%target_arch%\\node_modules\\npm > nul\n+robocopy ..\\deps\\npm node-v%FULLVERSION%-win-%target_arch%\\node_modules\\npm /e /xd test > nul\n if errorlevel 8 echo Cannot copy npm package && goto package_error\n copy /Y ..\\deps\\npm\\bin\\npm node-v%FULLVERSION%-win-%target_arch%\\ > nul\n if errorlevel 1 echo Cannot copy npm && goto package_error\n@@ -349,7 +355,11 @@ if not defined noetw (\n     copy /Y ..\\src\\res\\node_etw_provider.man node-v%FULLVERSION%-win-%target_arch%\\ > nul\n     if errorlevel 1 echo Cannot copy node_etw_provider.man && goto package_error\n )\n+cd ..\n \n+:package\n+if not defined package goto msi\n+cd Release\n echo Creating node-v%FULLVERSION%-win-%target_arch%.7z\n del node-v%FULLVERSION%-win-%target_arch%.7z > nul 2> nul\n 7z a -r -mx9 -t7z node-v%FULLVERSION%-win-%target_arch%.7z node-v%FULLVERSION%-win-%target_arch% > nul"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 20,
        "deletions": 10
    }
}