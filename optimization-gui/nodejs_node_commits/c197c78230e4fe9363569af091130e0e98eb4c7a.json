{
    "author": "addaleax",
    "message": "http2: use original error for cancelling pending streams\n\nPreviously, if `session.destroy()` was called with an error object,\nthe information contained in it would be discarded and a generic\n`ERR_HTTP2_STREAM_CANCEL` would be used for all pending streams.\n\nInstead, make the information from the original error object\navailable.\n\nPR-URL: https://github.com/nodejs/node/pull/18988\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "c197c78230e4fe9363569af091130e0e98eb4c7a",
    "files": [
        {
            "sha": "f706ad49a24278f7ad61e7e460379404cf290f78",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/c197c78230e4fe9363569af091130e0e98eb4c7a/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/c197c78230e4fe9363569af091130e0e98eb4c7a/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=c197c78230e4fe9363569af091130e0e98eb4c7a",
            "patch": "@@ -1132,6 +1132,11 @@ class Http2Session extends EventEmitter {\n \n     // Destroy any pending and open streams\n     const cancel = new errors.Error('ERR_HTTP2_STREAM_CANCEL');\n+    if (error) {\n+      cancel.cause = error;\n+      if (typeof error.message === 'string')\n+        cancel.message += ` (caused by: ${error.message})`;\n+    }\n     state.pendingStreams.forEach((stream) => stream.destroy(cancel));\n     state.streams.forEach((stream) => stream.destroy(error));\n "
        },
        {
            "sha": "a75dc590c669a1eeb382f5575b01ee64c924b5fb",
            "filename": "test/parallel/test-http2-client-onconnect-errors.js",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/c197c78230e4fe9363569af091130e0e98eb4c7a/test%2Fparallel%2Ftest-http2-client-onconnect-errors.js",
            "raw_url": "https://github.com/nodejs/node/raw/c197c78230e4fe9363569af091130e0e98eb4c7a/test%2Fparallel%2Ftest-http2-client-onconnect-errors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-client-onconnect-errors.js?ref=c197c78230e4fe9363569af091130e0e98eb4c7a",
            "patch": "@@ -91,9 +91,14 @@ function runTest(test) {\n     req.on('error', errorMustCall);\n   } else {\n     client.on('error', errorMustCall);\n-    req.on('error', common.expectsError({\n-      code: 'ERR_HTTP2_STREAM_CANCEL'\n-    }));\n+    req.on('error', (err) => {\n+      common.expectsError({\n+        code: 'ERR_HTTP2_STREAM_CANCEL'\n+      })(err);\n+      common.expectsError({\n+        code: 'ERR_HTTP2_ERROR'\n+      })(err.cause);\n+    });\n   }\n \n   req.on('end', common.mustCall());"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 13,
        "deletions": 3
    }
}