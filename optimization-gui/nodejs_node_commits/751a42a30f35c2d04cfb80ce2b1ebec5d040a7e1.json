{
    "author": "cjihrig",
    "message": "fs: add length validation to fs.truncate()\n\nThis commit adds validation to the length parameter of\nfs.truncate(). Prior to this commit, passing a non-number would\ntrigger a CHECK() in the binding layer.\n\nPR-URL: https://github.com/nodejs/node/pull/20851\nFixes: https://github.com/nodejs/node/issues/20844\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>",
    "sha": "751a42a30f35c2d04cfb80ce2b1ebec5d040a7e1",
    "files": [
        {
            "sha": "cfb4f2777b838876cf7077a5aebc81b4f7f72079",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/751a42a30f35c2d04cfb80ce2b1ebec5d040a7e1/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/751a42a30f35c2d04cfb80ce2b1ebec5d040a7e1/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=751a42a30f35c2d04cfb80ce2b1ebec5d040a7e1",
            "patch": "@@ -78,6 +78,7 @@ const {\n const {\n   isUint32,\n   validateAndMaskMode,\n+  validateInteger,\n   validateInt32,\n   validateUint32\n } = require('internal/validators');\n@@ -609,6 +610,7 @@ function truncate(path, len, callback) {\n     len = 0;\n   }\n \n+  validateInteger(len, 'len');\n   callback = maybeCallback(callback);\n   fs.open(path, 'r+', function(er, fd) {\n     if (er) return callback(er);"
        },
        {
            "sha": "9bb601b7c9953c910877f869edc0736fcc3b75c7",
            "filename": "test/parallel/test-fs-truncate.js",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/nodejs/node/blob/751a42a30f35c2d04cfb80ce2b1ebec5d040a7e1/test%2Fparallel%2Ftest-fs-truncate.js",
            "raw_url": "https://github.com/nodejs/node/raw/751a42a30f35c2d04cfb80ce2b1ebec5d040a7e1/test%2Fparallel%2Ftest-fs-truncate.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-truncate.js?ref=751a42a30f35c2d04cfb80ce2b1ebec5d040a7e1",
            "patch": "@@ -179,6 +179,16 @@ function testFtruncate(cb) {\n   process.on('exit', () => fs.closeSync(fd));\n \n   ['', false, null, {}, []].forEach((input) => {\n+    assert.throws(\n+      () => fs.truncate(file5, input, common.mustNotCall()),\n+      {\n+        code: 'ERR_INVALID_ARG_TYPE',\n+        name: 'TypeError [ERR_INVALID_ARG_TYPE]',\n+        message: 'The \"len\" argument must be of type number. ' +\n+                 `Received type ${typeof input}`\n+      }\n+    );\n+\n     assert.throws(\n       () => fs.ftruncate(fd, input),\n       {\n@@ -191,6 +201,16 @@ function testFtruncate(cb) {\n   });\n \n   [-1.5, 1.5].forEach((input) => {\n+    assert.throws(\n+      () => fs.truncate(file5, input),\n+      {\n+        code: 'ERR_OUT_OF_RANGE',\n+        name: 'RangeError [ERR_OUT_OF_RANGE]',\n+        message: 'The value of \"len\" is out of range. It must be ' +\n+                  `an integer. Received ${input}`\n+      }\n+    );\n+\n     assert.throws(\n       () => fs.ftruncate(fd, input),\n       {"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 22,
        "deletions": 0
    }
}