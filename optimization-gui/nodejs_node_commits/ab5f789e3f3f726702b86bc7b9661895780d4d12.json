{
    "author": "unknown",
    "message": "inspector: enable Inspector JS API in workers\n\nPR-URL: https://github.com/nodejs/node/pull/22769\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "ab5f789e3f3f726702b86bc7b9661895780d4d12",
    "files": [
        {
            "sha": "6988eccf82c9ef207af64fefd50f4c0dca716c26",
            "filename": "lib/inspector.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/lib%2Finspector.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/lib%2Finspector.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finspector.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -14,7 +14,7 @@ const util = require('util');\n const { Connection, open, url } = process.binding('inspector');\n const { originalConsole } = require('internal/process/per_thread');\n \n-if (!Connection || !require('internal/worker').isMainThread)\n+if (!Connection)\n   throw new ERR_INSPECTOR_NOT_AVAILABLE();\n \n const connectionSymbol = Symbol('connectionProperty');"
        },
        {
            "sha": "634d330233358491c5a7f17c19fe96ab1547f3d6",
            "filename": "lib/internal/util/inspector.js",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/lib%2Finternal%2Futil%2Finspector.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/lib%2Finternal%2Futil%2Finspector.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspector.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -1,8 +1,6 @@\n 'use strict';\n \n-// TODO(addaleax): Figure out how to integrate the inspector with workers.\n-const hasInspector = process.config.variables.v8_enable_inspector === 1 &&\n-  require('internal/worker').isMainThread;\n+const hasInspector = process.config.variables.v8_enable_inspector === 1;\n const inspector = hasInspector ? require('inspector') : undefined;\n \n let session;"
        },
        {
            "sha": "4f797dd9e0094cfb5d0232a6b7ad576ac6c18cf2",
            "filename": "lib/internal/worker.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/lib%2Finternal%2Fworker.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/lib%2Finternal%2Fworker.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fworker.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -17,6 +17,7 @@ const { MessagePort, MessageChannel } = internalBinding('messaging');\n const { handle_onclose } = internalBinding('symbols');\n const { clearAsyncIdStack } = require('internal/async_hooks');\n const { serializeError, deserializeError } = require('internal/error-serdes');\n+const { pathToFileURL } = require('url');\n \n util.inherits(MessagePort, EventEmitter);\n \n@@ -257,8 +258,9 @@ class Worker extends EventEmitter {\n       }\n     }\n \n+    const url = options.eval ? null : pathToFileURL(filename);\n     // Set up the C++ handle for the worker, as well as some internal wiring.\n-    this[kHandle] = new WorkerImpl();\n+    this[kHandle] = new WorkerImpl(url);\n     this[kHandle].onexit = (code) => this[kOnExit](code);\n     this[kPort] = this[kHandle].messagePort;\n     this[kPort].on('message', (data) => this[kOnMessage](data));"
        },
        {
            "sha": "d3f553caac8f9f3962a5bd9e173b9becf45ee053",
            "filename": "src/inspector/main_thread_interface.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector%2Fmain_thread_interface.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector%2Fmain_thread_interface.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector%2Fmain_thread_interface.cc?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -354,13 +354,6 @@ void MainThreadHandle::Reset() {\n   main_thread_ = nullptr;\n }\n \n-Agent* MainThreadHandle::GetInspectorAgent() {\n-  Mutex::ScopedLock scoped_lock(block_lock_);\n-  if (main_thread_ == nullptr)\n-    return nullptr;\n-  return main_thread_->inspector_agent();\n-}\n-\n std::unique_ptr<InspectorSessionDelegate>\n MainThreadHandle::MakeDelegateThreadSafe(\n     std::unique_ptr<InspectorSessionDelegate> delegate) {"
        },
        {
            "sha": "7092310e553c19e2024221e3113e6ca679c687bc",
            "filename": "src/inspector/main_thread_interface.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector%2Fmain_thread_interface.h",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector%2Fmain_thread_interface.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector%2Fmain_thread_interface.h?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -54,7 +54,6 @@ class MainThreadHandle : public std::enable_shared_from_this<MainThreadHandle> {\n     return ++next_object_id_;\n   }\n   bool Post(std::unique_ptr<Request> request);\n-  Agent* GetInspectorAgent();\n   std::unique_ptr<InspectorSessionDelegate> MakeDelegateThreadSafe(\n       std::unique_ptr<InspectorSessionDelegate> delegate);\n   bool Expired();"
        },
        {
            "sha": "fe69e6f863e2a6af6c3318d8896f5b1c56889a3e",
            "filename": "src/inspector/tracing_agent.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector%2Ftracing_agent.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector%2Ftracing_agent.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector%2Ftracing_agent.cc?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -74,11 +74,14 @@ DispatchResponse TracingAgent::start(\n   if (categories_set.empty())\n     return DispatchResponse::Error(\"At least one category should be enabled\");\n \n-  trace_writer_ = env_->tracing_agent_writer()->agent()->AddClient(\n-      categories_set,\n-      std::unique_ptr<InspectorTraceWriter>(\n-          new InspectorTraceWriter(frontend_.get())),\n-      tracing::Agent::kIgnoreDefaultCategories);\n+  auto* writer = env_->tracing_agent_writer();\n+  if (writer != nullptr) {\n+    trace_writer_ = env_->tracing_agent_writer()->agent()->AddClient(\n+        categories_set,\n+        std::unique_ptr<InspectorTraceWriter>(\n+            new InspectorTraceWriter(frontend_.get())),\n+        tracing::Agent::kIgnoreDefaultCategories);\n+  }\n   return DispatchResponse::OK();\n }\n "
        },
        {
            "sha": "63b92663532e06997e52a8beb25e4fd1c3054c17",
            "filename": "src/inspector_agent.cc",
            "status": "modified",
            "additions": 25,
            "deletions": 5,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector_agent.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector_agent.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector_agent.cc?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -190,6 +190,12 @@ static int StartDebugSignalHandler() {\n \n const int CONTEXT_GROUP_ID = 1;\n \n+std::string GetWorkerLabel(node::Environment* env) {\n+  std::ostringstream result;\n+  result << \"Worker[\" << env->thread_id() << \"]\";\n+  return result.str();\n+}\n+\n class ChannelImpl final : public v8_inspector::V8Inspector::Channel,\n                           public protocol::FrontendChannel {\n  public:\n@@ -393,10 +399,13 @@ bool IsFilePath(const std::string& path) {\n \n class NodeInspectorClient : public V8InspectorClient {\n  public:\n-  explicit NodeInspectorClient(node::Environment* env) : env_(env) {\n+  explicit NodeInspectorClient(node::Environment* env, bool is_main)\n+      : env_(env), is_main_(is_main) {\n     client_ = V8Inspector::create(env->isolate(), this);\n     // TODO(bnoordhuis) Make name configurable from src/node.cc.\n-    ContextInfo info(GetHumanReadableProcessName());\n+    std::string name =\n+        is_main_ ? GetHumanReadableProcessName() : GetWorkerLabel(env);\n+    ContextInfo info(name);\n     info.is_default = true;\n     contextCreated(env->context(), info);\n   }\n@@ -625,6 +634,7 @@ class NodeInspectorClient : public V8InspectorClient {\n   }\n \n   node::Environment* env_;\n+  bool is_main_;\n   bool running_nested_loop_ = false;\n   std::unique_ptr<V8Inspector> client_;\n   std::unordered_map<int, std::unique_ptr<ChannelImpl>> channels_;\n@@ -642,13 +652,23 @@ Agent::Agent(Environment* env)\n   : parent_env_(env),\n     debug_options_(env->options()->debug_options) {}\n \n-Agent::~Agent() = default;\n+Agent::~Agent() {\n+  if (start_io_thread_async.data == this) {\n+    start_io_thread_async.data = nullptr;\n+    // This is global, will never get freed\n+    uv_close(reinterpret_cast<uv_handle_t*>(&start_io_thread_async), nullptr);\n+  }\n+}\n \n bool Agent::Start(const std::string& path,\n-                  std::shared_ptr<DebugOptions> options) {\n+                  std::shared_ptr<DebugOptions> options,\n+                  bool is_main) {\n+  if (options == nullptr) {\n+    options = std::make_shared<DebugOptions>();\n+  }\n   path_ = path;\n   debug_options_ = options;\n-  client_ = std::make_shared<NodeInspectorClient>(parent_env_);\n+  client_ = std::make_shared<NodeInspectorClient>(parent_env_, is_main);\n   if (parent_env_->is_main_thread()) {\n     CHECK_EQ(0, uv_async_init(parent_env_->event_loop(),\n                               &start_io_thread_async,"
        },
        {
            "sha": "79ae8d4cd99404d4810697ef75dbbc5f04ab3730",
            "filename": "src/inspector_agent.h",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector_agent.h",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Finspector_agent.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector_agent.h?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -47,7 +47,9 @@ class Agent {\n   ~Agent();\n \n   // Create client_, may create io_ if option enabled\n-  bool Start(const std::string& path, std::shared_ptr<DebugOptions> options);\n+  bool Start(const std::string& path,\n+             std::shared_ptr<DebugOptions> options,\n+             bool is_worker);\n   // Stop and destroy io_\n   void Stop();\n "
        },
        {
            "sha": "cd5173478170da428d6214556e8d7488c4ccabf5",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -327,7 +327,7 @@ static struct {\n     // right away on the websocket port and fails to bind/etc, this will return\n     // false.\n     return env->inspector_agent()->Start(\n-        script_path == nullptr ? \"\" : script_path, options);\n+        script_path == nullptr ? \"\" : script_path, options, true);\n   }\n \n   bool InspectorStarted(Environment* env) {"
        },
        {
            "sha": "1a90e3a64fd8433e9454f046ac7362f88c431be7",
            "filename": "src/node_worker.cc",
            "status": "modified",
            "additions": 29,
            "deletions": 3,
            "changes": 32,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Fnode_worker.cc",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Fnode_worker.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_worker.cc?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -35,10 +35,26 @@ namespace {\n uint64_t next_thread_id = 1;\n Mutex next_thread_id_mutex;\n \n+#if NODE_USE_V8_PLATFORM && HAVE_INSPECTOR\n+void StartWorkerInspector(Environment* child, const std::string& url) {\n+  child->inspector_agent()->Start(url, nullptr, false);\n+}\n+\n+void WaitForWorkerInspectorToStop(Environment* child) {\n+  child->inspector_agent()->WaitForDisconnect();\n+  child->inspector_agent()->Stop();\n+}\n+\n+#else\n+// No-ops\n+void StartWorkerInspector(Environment* child, const std::string& url) {}\n+void WaitForWorkerInspectorToStop(Environment* child) {}\n+#endif\n+\n }  // anonymous namespace\n \n-Worker::Worker(Environment* env, Local<Object> wrap)\n-    : AsyncWrap(env, wrap, AsyncWrap::PROVIDER_WORKER) {\n+Worker::Worker(Environment* env, Local<Object> wrap, const std::string& url)\n+    : AsyncWrap(env, wrap, AsyncWrap::PROVIDER_WORKER), url_(url) {\n   // Generate a new thread id.\n   {\n     Mutex::ScopedLock next_thread_id_lock(next_thread_id_mutex);\n@@ -155,6 +171,7 @@ void Worker::Run() {\n         env_->async_hooks()->pop_async_id(1);\n \n         Debug(this, \"Loaded environment for worker %llu\", thread_id_);\n+        StartWorkerInspector(env_.get(), url_);\n       }\n \n       {\n@@ -215,6 +232,7 @@ void Worker::Run() {\n       env_->stop_sub_worker_contexts();\n       env_->RunCleanup();\n       RunAtExit(env_.get());\n+      WaitForWorkerInspectorToStop(env_.get());\n \n       {\n         Mutex::ScopedLock stopped_lock(stopped_mutex_);\n@@ -351,7 +369,15 @@ void Worker::New(const FunctionCallbackInfo<Value>& args) {\n     return;\n   }\n \n-  new Worker(env, args.This());\n+  std::string url;\n+  // Argument might be a string or URL\n+  if (args.Length() == 1 && !args[0]->IsNullOrUndefined()) {\n+    Utf8Value value(\n+        args.GetIsolate(),\n+        args[0]->ToString(env->context()).FromMaybe(v8::Local<v8::String>()));\n+    url.append(value.out(), value.length());\n+  }\n+  new Worker(env, args.This(), url);\n }\n \n void Worker::StartThread(const FunctionCallbackInfo<Value>& args) {"
        },
        {
            "sha": "8491ad221b6dde9814c1377f8ef6eb8744bbf024",
            "filename": "src/node_worker.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Fnode_worker.h",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/src%2Fnode_worker.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_worker.h?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -12,7 +12,7 @@ namespace worker {\n // A worker thread, as represented in its parent thread.\n class Worker : public AsyncWrap {\n  public:\n-  Worker(Environment* env, v8::Local<v8::Object> wrap);\n+  Worker(Environment* env, v8::Local<v8::Object> wrap, const std::string& url);\n   ~Worker();\n \n   // Run the worker. This is only called from the worker thread.\n@@ -52,6 +52,7 @@ class Worker : public AsyncWrap {\n   uv_loop_t loop_;\n   DeleteFnPtr<IsolateData, FreeIsolateData> isolate_data_;\n   DeleteFnPtr<Environment, FreeEnvironment> env_;\n+  const std::string url_;\n   v8::Isolate* isolate_ = nullptr;\n   DeleteFnPtr<ArrayBufferAllocator, FreeArrayBufferAllocator>\n       array_buffer_allocator_;"
        },
        {
            "sha": "0b3a7e9201e4f6e38772894849447ec950b7a0d4",
            "filename": "test/common/README.md",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fcommon%2FREADME.md",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fcommon%2FREADME.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2FREADME.md?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -361,6 +361,11 @@ was disabled at compile time.\n Skip the rest of the tests in the current file when the Node.js executable\n was compiled with a pointer size smaller than 64 bits.\n \n+### skipIfWorker()\n+\n+Skip the rest of the tests in the current file when not running on a main\n+thread.\n+\n ## ArrayStream Module\n \n The `ArrayStream` module provides a simple `Stream` that pushes elements from"
        },
        {
            "sha": "f0f849e6afbacf9a14014cc4801e897e2ce74d75",
            "filename": "test/common/index.js",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fcommon%2Findex.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fcommon%2Findex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Findex.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -614,10 +614,6 @@ function skipIfInspectorDisabled() {\n   if (process.config.variables.v8_enable_inspector === 0) {\n     skip('V8 inspector is disabled');\n   }\n-  if (!isMainThread) {\n-    // TODO(addaleax): Fix me.\n-    skip('V8 inspector is not available in Workers');\n-  }\n }\n \n function skipIf32Bits() {\n@@ -626,6 +622,12 @@ function skipIf32Bits() {\n   }\n }\n \n+function skipIfWorker() {\n+  if (!isMainThread) {\n+    skip('This test only works on a main thread');\n+  }\n+}\n+\n function getArrayBufferViews(buf) {\n   const { buffer, byteOffset, byteLength } = buf;\n \n@@ -744,6 +746,7 @@ module.exports = {\n   skipIf32Bits,\n   skipIfEslintMissing,\n   skipIfInspectorDisabled,\n+  skipIfWorker,\n \n   get localhostIPv6() { return '::1'; },\n "
        },
        {
            "sha": "fdd651d3eeed84d6d6c6e3f2a2fed9905add7454",
            "filename": "test/parallel/test-bootstrap-modules.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-bootstrap-modules.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-bootstrap-modules.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-bootstrap-modules.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -11,4 +11,4 @@ const list = process.moduleLoadList.slice();\n \n const assert = require('assert');\n \n-assert(list.length <= 74, list);\n+assert(list.length <= 75, list);"
        },
        {
            "sha": "0330f1d50e6f70c639bac636b53125f6ba015531",
            "filename": "test/parallel/test-inspector-port-zero-cluster.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-inspector-port-zero-cluster.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-inspector-port-zero-cluster.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-inspector-port-zero-cluster.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -3,6 +3,7 @@\n const common = require('../common');\n \n common.skipIfInspectorDisabled();\n+common.skipIfWorker();\n \n // Assert that even when started with `--inspect=0` workers are assigned\n // consecutive (i.e. deterministically predictable) debug ports"
        },
        {
            "sha": "ecf15c5be976303597fe0ed781bb2df0e57dc244",
            "filename": "test/parallel/test-inspector-tracing-domain.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-inspector-tracing-domain.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-inspector-tracing-domain.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-inspector-tracing-domain.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -3,6 +3,7 @@\n const common = require('../common');\n \n common.skipIfInspectorDisabled();\n+common.skipIfWorker(); // https://github.com/nodejs/node/issues/22767\n \n const assert = require('assert');\n const { Session } = require('inspector');"
        },
        {
            "sha": "24a186c15a85c745e87591a169d0325c310dfc6e",
            "filename": "test/parallel/test-trace-events-dynamic-enable.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-trace-events-dynamic-enable.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-trace-events-dynamic-enable.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-trace-events-dynamic-enable.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -3,6 +3,7 @@\n const common = require('../common');\n \n common.skipIfInspectorDisabled();\n+common.skipIfWorker(); // https://github.com/nodejs/node/issues/22767\n \n const assert = require('assert');\n const { performance } = require('perf_hooks');"
        },
        {
            "sha": "c3986a27be1703af3b59f96033ceb62b74517b49",
            "filename": "test/parallel/test-warn-sigprof.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-warn-sigprof.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fparallel%2Ftest-warn-sigprof.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-warn-sigprof.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -10,6 +10,8 @@ common.skipIfInspectorDisabled();\n if (common.isWindows)\n   common.skip('test does not apply to Windows');\n \n+common.skipIfWorker(); // Worker inspector never has a server running\n+\n common.expectWarning('Warning',\n                      'process.on(SIGPROF) is reserved while debugging',\n                      common.noWarnCode);"
        },
        {
            "sha": "139678a1e5a49307789548a2d43cf433961731d9",
            "filename": "test/sequential/test-inspector-async-hook-setup-at-signal.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fsequential%2Ftest-inspector-async-hook-setup-at-signal.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fsequential%2Ftest-inspector-async-hook-setup-at-signal.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-inspector-async-hook-setup-at-signal.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -6,6 +6,8 @@ common.skipIf32Bits();\n const { NodeInstance } = require('../common/inspector-helper.js');\n const assert = require('assert');\n \n+common.skipIfWorker(); // Signal starts a server for a main thread inspector\n+\n const script = `\n process._rawDebug('Waiting until a signal enables the inspector...');\n let waiting = setInterval(waitUntilDebugged, 50);"
        },
        {
            "sha": "793868e3bc072c8005e584bdfaf95fcc65d07d14",
            "filename": "test/sequential/test-inspector-contexts.js",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fsequential%2Ftest-inspector-contexts.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fsequential%2Ftest-inspector-contexts.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-inspector-contexts.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -33,7 +33,11 @@ async function testContextCreatedAndDestroyed() {\n       // the PID.\n       strictEqual(name.includes(`[${process.pid}]`), true);\n     } else {\n-      strictEqual(`${process.argv0}[${process.pid}]`, name);\n+      let expects = `${process.argv0}[${process.pid}]`;\n+      if (!common.isMainThread) {\n+        expects = `Worker[${require('worker_threads').threadId}]`;\n+      }\n+      strictEqual(expects, name);\n     }\n     strictEqual(origin, '',\n                 JSON.stringify(contextCreated));"
        },
        {
            "sha": "b58dbd83b6159ad0e6d09e58ada1102f9e00abaf",
            "filename": "test/sequential/test-inspector-port-cluster.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fsequential%2Ftest-inspector-port-cluster.js",
            "raw_url": "https://github.com/nodejs/node/raw/ab5f789e3f3f726702b86bc7b9661895780d4d12/test%2Fsequential%2Ftest-inspector-port-cluster.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-inspector-port-cluster.js?ref=ab5f789e3f3f726702b86bc7b9661895780d4d12",
            "patch": "@@ -3,6 +3,7 @@\n const common = require('../common');\n \n common.skipIfInspectorDisabled();\n+common.skipIfWorker();\n \n const assert = require('assert');\n const cluster = require('cluster');"
        }
    ],
    "stats": {
        "total": 134,
        "additions": 99,
        "deletions": 35
    }
}