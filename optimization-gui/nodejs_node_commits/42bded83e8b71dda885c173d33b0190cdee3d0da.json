{
    "author": "AdityaSrivast",
    "message": "fs: throw ERR_INVALID_ARG_VALUE when buffer being written is empty\n\nFixes: https://github.com/nodejs/node/issues/21193\nPR-URL: https://github.com/nodejs/node/pull/21262\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "42bded83e8b71dda885c173d33b0190cdee3d0da",
    "files": [
        {
            "sha": "2c2a053c7f9bf937008e3eadb505cc9c7a31cdfa",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/42bded83e8b71dda885c173d33b0190cdee3d0da/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/42bded83e8b71dda885c173d33b0190cdee3d0da/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=42bded83e8b71dda885c173d33b0190cdee3d0da",
            "patch": "@@ -47,6 +47,7 @@ const { Buffer, kMaxLength } = require('buffer');\n const errors = require('internal/errors');\n const {\n   ERR_FS_FILE_TOO_LARGE,\n+  ERR_INVALID_ARG_VALUE,\n   ERR_INVALID_ARG_TYPE,\n   ERR_INVALID_CALLBACK\n } = errors.codes;\n@@ -457,6 +458,11 @@ function read(fd, buffer, offset, length, position, callback) {\n     });\n   }\n \n+  if (buffer.length === 0) {\n+    throw new ERR_INVALID_ARG_VALUE('buffer', buffer,\n+                                    'is empty and cannot be written');\n+  }\n+\n   validateOffsetLengthRead(offset, length, buffer.length);\n \n   if (!Number.isSafeInteger(position))\n@@ -487,6 +493,11 @@ function readSync(fd, buffer, offset, length, position) {\n     return 0;\n   }\n \n+  if (buffer.length === 0) {\n+    throw new ERR_INVALID_ARG_VALUE('buffer', buffer,\n+                                    'is empty and cannot be written');\n+  }\n+\n   validateOffsetLengthRead(offset, length, buffer.length);\n \n   if (!Number.isSafeInteger(position))"
        },
        {
            "sha": "f38a3e59befc050d54a9aa36a35e628f74fe23f2",
            "filename": "lib/internal/fs/promises.js",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/42bded83e8b71dda885c173d33b0190cdee3d0da/lib%2Finternal%2Ffs%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/42bded83e8b71dda885c173d33b0190cdee3d0da/lib%2Finternal%2Ffs%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Fpromises.js?ref=42bded83e8b71dda885c173d33b0190cdee3d0da",
            "patch": "@@ -12,6 +12,7 @@ const { Buffer, kMaxLength } = require('buffer');\n const {\n   ERR_FS_FILE_TOO_LARGE,\n   ERR_INVALID_ARG_TYPE,\n+  ERR_INVALID_ARG_VALUE,\n   ERR_METHOD_NOT_IMPLEMENTED\n } = require('internal/errors').codes;\n const { getPathFromURL } = require('internal/url');\n@@ -208,6 +209,11 @@ async function read(handle, buffer, offset, length, position) {\n   if (length === 0)\n     return { bytesRead: length, buffer };\n \n+  if (buffer.length === 0) {\n+    throw new ERR_INVALID_ARG_VALUE('buffer', buffer,\n+                                    'is empty and cannot be written');\n+  }\n+\n   validateOffsetLengthRead(offset, length, buffer.length);\n \n   if (!Number.isSafeInteger(position))"
        },
        {
            "sha": "a2f1015c62b8ff2a59b28190d4b9ddd8cfd2b760",
            "filename": "lib/internal/fs/utils.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/42bded83e8b71dda885c173d33b0190cdee3d0da/lib%2Finternal%2Ffs%2Futils.js",
            "raw_url": "https://github.com/nodejs/node/raw/42bded83e8b71dda885c173d33b0190cdee3d0da/lib%2Finternal%2Ffs%2Futils.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Futils.js?ref=42bded83e8b71dda885c173d33b0190cdee3d0da",
            "patch": "@@ -293,7 +293,8 @@ function validateOffsetLengthRead(offset, length, bufferLength) {\n   let err;\n \n   if (offset < 0 || offset >= bufferLength) {\n-    err = new ERR_OUT_OF_RANGE('offset', `>= 0 && <= ${bufferLength}`, offset);\n+    err = new ERR_OUT_OF_RANGE('offset',\n+                               `>= 0 && <= ${bufferLength}`, offset);\n   } else if (length < 0 || offset + length > bufferLength) {\n     err = new ERR_OUT_OF_RANGE('length',\n                                `>= 0 && <= ${bufferLength - offset}`, length);"
        },
        {
            "sha": "281d2675e7273033e74a5e3cf3ef5cc994cd6c17",
            "filename": "test/parallel/test-fs-read-empty-buffer.js",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/42bded83e8b71dda885c173d33b0190cdee3d0da/test%2Fparallel%2Ftest-fs-read-empty-buffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/42bded83e8b71dda885c173d33b0190cdee3d0da/test%2Fparallel%2Ftest-fs-read-empty-buffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-read-empty-buffer.js?ref=42bded83e8b71dda885c173d33b0190cdee3d0da",
            "patch": "@@ -0,0 +1,18 @@\n+'use strict';\n+require('../common');\n+const fixtures = require('../common/fixtures');\n+const assert = require('assert');\n+const fs = require('fs');\n+const filepath = fixtures.path('x.txt');\n+const fd = fs.openSync(filepath, 'r');\n+\n+const buffer = new Uint8Array();\n+\n+assert.throws(\n+  () => fs.readSync(fd, buffer, 0, 10, 0),\n+  {\n+    code: 'ERR_INVALID_ARG_VALUE',\n+    message: 'The argument \\'buffer\\' is empty and cannot be written. ' +\n+    'Received Uint8Array [  ]'\n+  }\n+);"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 37,
        "deletions": 1
    }
}