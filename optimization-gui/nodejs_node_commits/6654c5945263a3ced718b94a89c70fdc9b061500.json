{
    "author": "cjihrig",
    "message": "cluster: use Map to track round robin workers\n\nPR-URL: https://github.com/nodejs/node/pull/23125\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>",
    "sha": "6654c5945263a3ced718b94a89c70fdc9b061500",
    "files": [
        {
            "sha": "9f09d9fbf7663594e4f377955c5fb8db08560efd",
            "filename": "lib/internal/cluster/round_robin_handle.js",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/6654c5945263a3ced718b94a89c70fdc9b061500/lib%2Finternal%2Fcluster%2Fround_robin_handle.js",
            "raw_url": "https://github.com/nodejs/node/raw/6654c5945263a3ced718b94a89c70fdc9b061500/lib%2Finternal%2Fcluster%2Fround_robin_handle.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcluster%2Fround_robin_handle.js?ref=6654c5945263a3ced718b94a89c70fdc9b061500",
            "patch": "@@ -2,15 +2,14 @@\n const assert = require('assert');\n const net = require('net');\n const { sendHelper } = require('internal/cluster/utils');\n-const getOwnPropertyNames = Object.getOwnPropertyNames;\n const { internalBinding } = require('internal/bootstrap/loaders');\n const uv = internalBinding('uv');\n \n module.exports = RoundRobinHandle;\n \n function RoundRobinHandle(key, address, port, addressType, fd) {\n   this.key = key;\n-  this.all = {};\n+  this.all = new Map();\n   this.free = [];\n   this.handles = [];\n   this.handle = null;\n@@ -32,8 +31,8 @@ function RoundRobinHandle(key, address, port, addressType, fd) {\n }\n \n RoundRobinHandle.prototype.add = function(worker, send) {\n-  assert(worker.id in this.all === false);\n-  this.all[worker.id] = worker;\n+  assert(this.all.has(worker.id) === false);\n+  this.all.set(worker.id, worker);\n \n   const done = () => {\n     if (this.handle.getsockname) {\n@@ -62,16 +61,17 @@ RoundRobinHandle.prototype.add = function(worker, send) {\n };\n \n RoundRobinHandle.prototype.remove = function(worker) {\n-  if (worker.id in this.all === false)\n+  const existed = this.all.delete(worker.id);\n+\n+  if (!existed)\n     return false;\n \n-  delete this.all[worker.id];\n   const index = this.free.indexOf(worker);\n \n   if (index !== -1)\n     this.free.splice(index, 1);\n \n-  if (getOwnPropertyNames(this.all).length !== 0)\n+  if (this.all.size !== 0)\n     return false;\n \n   for (var handle; handle = this.handles.shift(); handle.close())\n@@ -91,7 +91,7 @@ RoundRobinHandle.prototype.distribute = function(err, handle) {\n };\n \n RoundRobinHandle.prototype.handoff = function(worker) {\n-  if (worker.id in this.all === false) {\n+  if (this.all.has(worker.id) === false) {\n     return;  // Worker is closing (or has closed) the server.\n   }\n "
        }
    ],
    "stats": {
        "total": 16,
        "additions": 8,
        "deletions": 8
    }
}