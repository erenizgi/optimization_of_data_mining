{
    "author": "mcollina",
    "message": "http: OutgoingMessage.end() should return this\n\nPR-URL: https://github.com/nodejs/node/pull/18780\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "8118da7430c33fc80a2f60c4a8cb3f568edbb29b",
    "files": [
        {
            "sha": "daa058a8b0b426a6a9a968b9140a931dbee9f07b",
            "filename": "doc/api/http.md",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/8118da7430c33fc80a2f60c4a8cb3f568edbb29b/doc%2Fapi%2Fhttp.md",
            "raw_url": "https://github.com/nodejs/node/raw/8118da7430c33fc80a2f60c4a8cb3f568edbb29b/doc%2Fapi%2Fhttp.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fhttp.md?ref=8118da7430c33fc80a2f60c4a8cb3f568edbb29b",
            "patch": "@@ -544,11 +544,16 @@ See [`request.socket`][]\n ### request.end([data[, encoding]][, callback])\n <!-- YAML\n added: v0.1.90\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/18780\n+    description: This method now returns a reference to `ClientRequest`.\n -->\n \n * `data` {string|Buffer}\n * `encoding` {string}\n * `callback` {Function}\n+* Returns: {this}\n \n Finishes sending the request. If any parts of the body are\n unsent, it will flush them to the stream. If the request is\n@@ -1041,11 +1046,16 @@ See [`response.socket`][].\n ### response.end([data][, encoding][, callback])\n <!-- YAML\n added: v0.1.90\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/18780\n+    description: This method now returns a reference to `ServerResponse`.\n -->\n \n * `data` {string|Buffer}\n * `encoding` {string}\n * `callback` {Function}\n+* Returns: {this}\n \n This method signals to the server that all of the response headers and body\n have been sent; that server should consider this message complete."
        },
        {
            "sha": "985b74679c00277bb4a4278698bd5d1d3292f763",
            "filename": "lib/_http_outgoing.js",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/8118da7430c33fc80a2f60c4a8cb3f568edbb29b/lib%2F_http_outgoing.js",
            "raw_url": "https://github.com/nodejs/node/raw/8118da7430c33fc80a2f60c4a8cb3f568edbb29b/lib%2F_http_outgoing.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_outgoing.js?ref=8118da7430c33fc80a2f60c4a8cb3f568edbb29b",
            "patch": "@@ -736,7 +736,7 @@ OutgoingMessage.prototype.end = function end(chunk, encoding, callback) {\n   }\n \n   if (this.finished) {\n-    return false;\n+    return this;\n   }\n \n   var uncork;\n@@ -766,12 +766,11 @@ OutgoingMessage.prototype.end = function end(chunk, encoding, callback) {\n \n   var finish = onFinish.bind(undefined, this);\n \n-  var ret;\n   if (this._hasBody && this.chunkedEncoding) {\n-    ret = this._send('0\\r\\n' + this._trailer + '\\r\\n', 'latin1', finish);\n+    this._send('0\\r\\n' + this._trailer + '\\r\\n', 'latin1', finish);\n   } else {\n     // Force a flush, HACK.\n-    ret = this._send('', 'latin1', finish);\n+    this._send('', 'latin1', finish);\n   }\n \n   if (uncork)\n@@ -788,7 +787,7 @@ OutgoingMessage.prototype.end = function end(chunk, encoding, callback) {\n     this._finish();\n   }\n \n-  return ret;\n+  return this;\n };\n \n "
        },
        {
            "sha": "47f08fd6e422f06a766291e3ec1dfe74620350b3",
            "filename": "test/parallel/test-http-request-end-twice.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/8118da7430c33fc80a2f60c4a8cb3f568edbb29b/test%2Fparallel%2Ftest-http-request-end-twice.js",
            "raw_url": "https://github.com/nodejs/node/raw/8118da7430c33fc80a2f60c4a8cb3f568edbb29b/test%2Fparallel%2Ftest-http-request-end-twice.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-request-end-twice.js?ref=8118da7430c33fc80a2f60c4a8cb3f568edbb29b",
            "patch": "@@ -31,7 +31,7 @@ const server = http.Server(function(req, res) {\n server.listen(0, function() {\n   const req = http.get({ port: this.address().port }, function(res) {\n     res.on('end', function() {\n-      assert.ok(!req.end());\n+      assert.strictEqual(req.end(), req);\n       server.close();\n     });\n     res.resume();"
        },
        {
            "sha": "a0cdcf27dd03a9f853b2edd8243327242a8309f8",
            "filename": "test/parallel/test-http-request-end.js",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/8118da7430c33fc80a2f60c4a8cb3f568edbb29b/test%2Fparallel%2Ftest-http-request-end.js",
            "raw_url": "https://github.com/nodejs/node/raw/8118da7430c33fc80a2f60c4a8cb3f568edbb29b/test%2Fparallel%2Ftest-http-request-end.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-request-end.js?ref=8118da7430c33fc80a2f60c4a8cb3f568edbb29b",
            "patch": "@@ -44,7 +44,7 @@ const server = http.Server(function(req, res) {\n });\n \n server.listen(0, function() {\n-  http.request({\n+  const req = http.request({\n     port: this.address().port,\n     path: '/',\n     method: 'POST'\n@@ -54,5 +54,9 @@ server.listen(0, function() {\n   }).on('error', function(e) {\n     console.log(e.message);\n     process.exit(1);\n-  }).end(expected);\n+  });\n+\n+  const result = req.end(expected);\n+\n+  assert.strictEqual(req, result);\n });"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 21,
        "deletions": 8
    }
}