{
    "author": "joyeecheung",
    "message": "stream: do not use crypto.DEFAULT_ENCODING in lazy_transform.js\n\nThe default encoding can be retrieved via\n`require('internal/crypto/util').getDefaultEncoding` instead of\nthe deprecated crypto.DEFAULT_ENCODING which triggers a warning.\n\nBackground:\n\nThe require chain goes like this:\n\n```\ninternal/streams/lazy_transform.js\n  -> crypto.js\n  -> internal/crypto/cipher.js (uses LazyTransform in the global scope)\n  -> internal/streams/lazy_transform.js\n```\n\nSo when `internal/streams/lazy_transform.js` is required before\n`lib/crypto.js`, we have a circular dependency and since\n`internal/crypto/cipher.js` uses destructuring to use LazyTransform\nwe will get an error. And it can also trigger a warning if\nlazy_transform.js is the first file that touches\ncrypto.DEFAULT_ENCODING.\n\nPR-URL: https://github.com/nodejs/node/pull/24396\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Sam Roberts <vieuxtech@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "413fcada8fb8289ec81010fe66a975e046d15ece",
    "files": [
        {
            "sha": "c4d8c64b3dd041be0f8abb2794c4d73bd4203d4a",
            "filename": "lib/internal/streams/lazy_transform.js",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/413fcada8fb8289ec81010fe66a975e046d15ece/lib%2Finternal%2Fstreams%2Flazy_transform.js",
            "raw_url": "https://github.com/nodejs/node/raw/413fcada8fb8289ec81010fe66a975e046d15ece/lib%2Finternal%2Fstreams%2Flazy_transform.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fstreams%2Flazy_transform.js?ref=413fcada8fb8289ec81010fe66a975e046d15ece",
            "patch": "@@ -5,7 +5,10 @@\n \n const stream = require('stream');\n const util = require('util');\n-const crypto = require('crypto');\n+\n+const {\n+  getDefaultEncoding\n+} = require('internal/crypto/util');\n \n module.exports = LazyTransform;\n \n@@ -22,7 +25,7 @@ function makeGetter(name) {\n     this._writableState.decodeStrings = false;\n \n     if (!this._options || !this._options.defaultEncoding) {\n-      this._writableState.defaultEncoding = crypto.DEFAULT_ENCODING;\n+      this._writableState.defaultEncoding = getDefaultEncoding();\n     }\n \n     return this[name];"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 5,
        "deletions": 2
    }
}