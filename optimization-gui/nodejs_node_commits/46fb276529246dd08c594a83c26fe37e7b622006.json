{
    "author": "Trott",
    "message": "test: refactor pummel/test-keep-alive\n\n* Reduce concurrent and duration options by half so as to avoid\n  interference with other tests. (Excessive TCP activity in this test\n  resulted in throttling that caused subsequent tests to fail on my\n  local setup.)\n* Use an OS-provided port rather than `common.PORT`. This possibly\n  reduces side-effects on other tests (that may also be using\n  `common.PORT`).\n* Add punctuation in comments.\n\nPR-URL: https://github.com/nodejs/node/pull/25485\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "46fb276529246dd08c594a83c26fe37e7b622006",
    "files": [
        {
            "sha": "5d2f00170d45b0e3f14aca810d64ac76a56de406",
            "filename": "test/pummel/test-keep-alive.js",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/46fb276529246dd08c594a83c26fe37e7b622006/test%2Fpummel%2Ftest-keep-alive.js",
            "raw_url": "https://github.com/nodejs/node/raw/46fb276529246dd08c594a83c26fe37e7b622006/test%2Fpummel%2Ftest-keep-alive.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fpummel%2Ftest-keep-alive.js?ref=46fb276529246dd08c594a83c26fe37e7b622006",
            "patch": "@@ -21,7 +21,7 @@\n \n 'use strict';\n \n-// This test requires the program 'wrk'\n+// This test requires the program 'wrk'.\n const common = require('../common');\n if (common.isWindows)\n   common.skip('no `wrk` on windows');\n@@ -47,9 +47,9 @@ let normalReqSec = 0;\n \n const runAb = (opts, callback) => {\n   const args = [\n-    '-c', opts.concurrent || 100,\n+    '-c', opts.concurrent || 50,\n     '-t', opts.threads || 2,\n-    '-d', opts.duration || '10s',\n+    '-d', opts.duration || '5s',\n   ];\n \n   if (!opts.keepalive) {\n@@ -58,7 +58,7 @@ const runAb = (opts, callback) => {\n   }\n \n   args.push(url.format({ hostname: '127.0.0.1',\n-                         port: common.PORT, protocol: 'http' }));\n+                         port: opts.port, protocol: 'http' }));\n \n   const child = spawn('wrk', args);\n   child.stderr.pipe(process.stderr);\n@@ -90,11 +90,12 @@ const runAb = (opts, callback) => {\n   });\n };\n \n-server.listen(common.PORT, () => {\n-  runAb({ keepalive: true }, (reqSec) => {\n+server.listen(0, () => {\n+  const port = server.address().port;\n+  runAb({ keepalive: true, port: port }, (reqSec) => {\n     keepAliveReqSec = reqSec;\n \n-    runAb({ keepalive: false }, (reqSec) => {\n+    runAb({ keepalive: false, port: port }, (reqSec) => {\n       normalReqSec = reqSec;\n       server.close();\n     });"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 8,
        "deletions": 7
    }
}