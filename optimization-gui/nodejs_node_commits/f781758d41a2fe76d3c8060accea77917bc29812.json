{
    "author": "MayaLekova",
    "message": "deps: backport 91ddb65d from upstream V8\n\nOriginal commit message:\n\n    Revert promises optimizations due to regressions in async hooks\n\n    Revert \"[async-await] Eliminate throwaway promise in async functions.\"\n\n    This reverts commit a840f1f8f7e6c9ab32dec456a954612619855093.\n\n    Revert \"[async-generators] Also avoid throwaway promise here.\"\n\n    This reverts commit feb545ceba5cb477ba883b46b60142f441ad5a3d.\n\n    Revert \"[async-await] Turn await closures into intrinsics.\"\n\n    This reverts commit d97bb317386506a6798386b74647cbe0502fce35.\n\n    Revert \"[async-generators] Add fast-path for primitives in AsyncGeneratorYield.\"\n\n    This reverts commit e57b500eb26dc595609613963468910eb4bcae2e.\n\n    Revert \"[async-generators] Add fast-path to skip \"then\" lookup in AsyncGeneratorResolve.\"\n\n    This reverts commit c15802e11e30976528d1b711a9b9e6ff6b490117.\n\n    Revert \"[promises] Correctly run before/after hooks for await.\"\n\n    This reverts commit ca7639239fc13e992e857710cbf7dbaac87163bf.\n\n    Bug: v8:7253, v8:7745\n    Change-Id: I25ad0d2df3cfbc84dbb431aa25b268bce8a39e89\n    Reviewed-on: https://chromium-review.googlesource.com/1049975\n    Commit-Queue: Maya Lekova <mslekova@chromium.org>\n    Reviewed-by: Benedikt Meurer <bmeurer@chromium.org>\n    Cr-Commit-Position: refs/heads/master@{#53139}\n\nRefs: https://github.com/v8/v8/commit/91ddb65d3b34c07c5026727de84dc91b5e0a43cd\nFixes: https://github.com/nodejs/node/issues/20516\nCo-authored-by: Matteo Collina <matteo.collina@gmail.com>\n\nPR-URL: https://github.com/nodejs/node/pull/19989\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matheus Marchini <matheus@sthima.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Myles Borins <myles.borins@gmail.com>",
    "sha": "f781758d41a2fe76d3c8060accea77917bc29812",
    "files": [
        {
            "sha": "077fd57f507e93dd118a8dfec0089ab6b3db4b0c",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -27,7 +27,7 @@\n \n     # Reset this number to 0 on major V8 upgrades.\n     # Increment by one for each non-official patch applied to deps/v8.\n-    'v8_embedder_string': '-node.5',\n+    'v8_embedder_string': '-node.6',\n \n     # Enable disassembler for `--print-code` v8 options\n     'v8_enable_disassembler': 1,"
        },
        {
            "sha": "2138b9c73d7db7afbde26465a9a01eeff998d9de",
            "filename": "deps/v8/src/bootstrapper.cc",
            "status": "modified",
            "additions": 72,
            "deletions": 0,
            "changes": 72,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbootstrapper.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbootstrapper.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbootstrapper.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -1584,6 +1584,50 @@ void Genesis::InitializeGlobal(Handle<JSGlobalObject> global_object,\n     native_context()->set_async_iterator_value_unwrap_shared_fun(*info);\n   }\n \n+  {  // --- A s y n c G e n e r a t o r ---\n+    Handle<JSFunction> await_caught =\n+        SimpleCreateFunction(isolate, factory->empty_string(),\n+                             Builtins::kAsyncGeneratorAwaitCaught, 1, false);\n+    native_context()->set_async_generator_await_caught(*await_caught);\n+\n+    Handle<JSFunction> await_uncaught =\n+        SimpleCreateFunction(isolate, factory->empty_string(),\n+                             Builtins::kAsyncGeneratorAwaitUncaught, 1, false);\n+    native_context()->set_async_generator_await_uncaught(*await_uncaught);\n+\n+    Handle<SharedFunctionInfo> info = SimpleCreateSharedFunctionInfo(\n+        isolate, Builtins::kAsyncGeneratorAwaitResolveClosure,\n+        factory->empty_string(), 1);\n+    native_context()->set_async_generator_await_resolve_shared_fun(*info);\n+\n+    info = SimpleCreateSharedFunctionInfo(\n+        isolate, Builtins::kAsyncGeneratorAwaitRejectClosure,\n+        factory->empty_string(), 1);\n+    native_context()->set_async_generator_await_reject_shared_fun(*info);\n+\n+    info = SimpleCreateSharedFunctionInfo(\n+        isolate, Builtins::kAsyncGeneratorYieldResolveClosure,\n+        factory->empty_string(), 1);\n+    native_context()->set_async_generator_yield_resolve_shared_fun(*info);\n+\n+    info = SimpleCreateSharedFunctionInfo(\n+        isolate, Builtins::kAsyncGeneratorReturnResolveClosure,\n+        factory->empty_string(), 1);\n+    native_context()->set_async_generator_return_resolve_shared_fun(*info);\n+\n+    info = SimpleCreateSharedFunctionInfo(\n+        isolate, Builtins::kAsyncGeneratorReturnClosedResolveClosure,\n+        factory->empty_string(), 1);\n+    native_context()->set_async_generator_return_closed_resolve_shared_fun(\n+        *info);\n+\n+    info = SimpleCreateSharedFunctionInfo(\n+        isolate, Builtins::kAsyncGeneratorReturnClosedRejectClosure,\n+        factory->empty_string(), 1);\n+    native_context()->set_async_generator_return_closed_reject_shared_fun(\n+        *info);\n+  }\n+\n   {  // --- A r r a y ---\n     Handle<JSFunction> array_function = InstallFunction(\n         global, \"Array\", JS_ARRAY_TYPE, JSArray::kSize, 0,\n@@ -3998,6 +4042,34 @@ void Bootstrapper::ExportFromRuntime(Isolate* isolate,\n     JSFunction::SetPrototype(async_function_constructor,\n                              async_function_prototype);\n \n+    {\n+      Handle<JSFunction> function =\n+          SimpleCreateFunction(isolate, factory->empty_string(),\n+                               Builtins::kAsyncFunctionAwaitCaught, 2, false);\n+      native_context->set_async_function_await_caught(*function);\n+    }\n+\n+    {\n+      Handle<JSFunction> function =\n+          SimpleCreateFunction(isolate, factory->empty_string(),\n+                               Builtins::kAsyncFunctionAwaitUncaught, 2, false);\n+      native_context->set_async_function_await_uncaught(*function);\n+    }\n+\n+    {\n+      Handle<SharedFunctionInfo> info = SimpleCreateSharedFunctionInfo(\n+          isolate, Builtins::kAsyncFunctionAwaitRejectClosure,\n+          factory->empty_string(), 1);\n+      native_context->set_async_function_await_reject_shared_fun(*info);\n+    }\n+\n+    {\n+      Handle<SharedFunctionInfo> info = SimpleCreateSharedFunctionInfo(\n+          isolate, Builtins::kAsyncFunctionAwaitResolveClosure,\n+          factory->empty_string(), 1);\n+      native_context->set_async_function_await_resolve_shared_fun(*info);\n+    }\n+\n     {\n       Handle<JSFunction> function =\n           SimpleCreateFunction(isolate, factory->empty_string(),"
        },
        {
            "sha": "0d0e34ee0da93a2b318200591dd055a2cd453b00",
            "filename": "deps/v8/src/builtins/builtins-async-function-gen.cc",
            "status": "modified",
            "additions": 69,
            "deletions": 27,
            "changes": 96,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-function-gen.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-function-gen.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-function-gen.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -21,18 +21,37 @@ class AsyncFunctionBuiltinsAssembler : public AsyncBuiltinsAssembler {\n                           Node* const awaited, Node* const outer_promise,\n                           const bool is_predicted_as_caught);\n \n-  void AsyncFunctionAwaitResume(Node* const context, Node* const argument,\n-                                Node* const generator,\n-                                JSGeneratorObject::ResumeMode resume_mode);\n+  void AsyncFunctionAwaitResumeClosure(\n+      Node* const context, Node* const sent_value,\n+      JSGeneratorObject::ResumeMode resume_mode);\n };\n \n-void AsyncFunctionBuiltinsAssembler::AsyncFunctionAwaitResume(\n-    Node* const context, Node* const argument, Node* const generator,\n+namespace {\n+\n+// Describe fields of Context associated with AsyncFunctionAwait resume\n+// closures.\n+// TODO(jgruber): Refactor to reuse code for upcoming async-generators.\n+class AwaitContext {\n+ public:\n+  enum Fields { kGeneratorSlot = Context::MIN_CONTEXT_SLOTS, kLength };\n+};\n+\n+}  // anonymous namespace\n+\n+void AsyncFunctionBuiltinsAssembler::AsyncFunctionAwaitResumeClosure(\n+    Node* context, Node* sent_value,\n     JSGeneratorObject::ResumeMode resume_mode) {\n-  CSA_ASSERT(this, IsJSGeneratorObject(generator));\n   DCHECK(resume_mode == JSGeneratorObject::kNext ||\n          resume_mode == JSGeneratorObject::kThrow);\n \n+  Node* const generator =\n+      LoadContextElement(context, AwaitContext::kGeneratorSlot);\n+  CSA_SLOW_ASSERT(this, HasInstanceType(generator, JS_GENERATOR_OBJECT_TYPE));\n+\n+  // Inline version of GeneratorPrototypeNext / GeneratorPrototypeReturn with\n+  // unnecessary runtime checks removed.\n+  // TODO(jgruber): Refactor to reuse code from builtins-generator.cc.\n+\n   // Ensure that the generator is neither closed nor running.\n   CSA_SLOW_ASSERT(\n       this,\n@@ -47,23 +66,31 @@ void AsyncFunctionBuiltinsAssembler::AsyncFunctionAwaitResume(\n \n   // Resume the {receiver} using our trampoline.\n   Callable callable = CodeFactory::ResumeGenerator(isolate());\n-  TailCallStub(callable, context, argument, generator);\n+  CallStub(callable, context, sent_value, generator);\n+\n+  // The resulting Promise is a throwaway, so it doesn't matter what it\n+  // resolves to. What is important is that we don't end up keeping the\n+  // whole chain of intermediate Promises alive by returning the return value\n+  // of ResumeGenerator, as that would create a memory leak.\n }\n \n-TF_BUILTIN(AsyncFunctionAwaitFulfill, AsyncFunctionBuiltinsAssembler) {\n-  Node* const argument = Parameter(Descriptor::kArgument);\n-  Node* const generator = Parameter(Descriptor::kGenerator);\n+TF_BUILTIN(AsyncFunctionAwaitRejectClosure, AsyncFunctionBuiltinsAssembler) {\n+  CSA_ASSERT_JS_ARGC_EQ(this, 1);\n+  Node* const sentError = Parameter(Descriptor::kSentError);\n   Node* const context = Parameter(Descriptor::kContext);\n-  AsyncFunctionAwaitResume(context, argument, generator,\n-                           JSGeneratorObject::kNext);\n+\n+  AsyncFunctionAwaitResumeClosure(context, sentError,\n+                                  JSGeneratorObject::kThrow);\n+  Return(UndefinedConstant());\n }\n \n-TF_BUILTIN(AsyncFunctionAwaitReject, AsyncFunctionBuiltinsAssembler) {\n-  Node* const argument = Parameter(Descriptor::kArgument);\n-  Node* const generator = Parameter(Descriptor::kGenerator);\n+TF_BUILTIN(AsyncFunctionAwaitResolveClosure, AsyncFunctionBuiltinsAssembler) {\n+  CSA_ASSERT_JS_ARGC_EQ(this, 1);\n+  Node* const sentValue = Parameter(Descriptor::kSentValue);\n   Node* const context = Parameter(Descriptor::kContext);\n-  AsyncFunctionAwaitResume(context, argument, generator,\n-                           JSGeneratorObject::kThrow);\n+\n+  AsyncFunctionAwaitResumeClosure(context, sentValue, JSGeneratorObject::kNext);\n+  Return(UndefinedConstant());\n }\n \n // ES#abstract-ops-async-function-await\n@@ -78,12 +105,25 @@ TF_BUILTIN(AsyncFunctionAwaitReject, AsyncFunctionBuiltinsAssembler) {\n void AsyncFunctionBuiltinsAssembler::AsyncFunctionAwait(\n     Node* const context, Node* const generator, Node* const awaited,\n     Node* const outer_promise, const bool is_predicted_as_caught) {\n-  CSA_SLOW_ASSERT(this, IsJSGeneratorObject(generator));\n-  CSA_SLOW_ASSERT(this, IsJSPromise(outer_promise));\n-\n-  Await(context, generator, awaited, outer_promise,\n-        Builtins::kAsyncFunctionAwaitFulfill,\n-        Builtins::kAsyncFunctionAwaitReject, is_predicted_as_caught);\n+  CSA_SLOW_ASSERT(this, HasInstanceType(generator, JS_GENERATOR_OBJECT_TYPE));\n+  CSA_SLOW_ASSERT(this, HasInstanceType(outer_promise, JS_PROMISE_TYPE));\n+\n+  ContextInitializer init_closure_context = [&](Node* context) {\n+    StoreContextElementNoWriteBarrier(context, AwaitContext::kGeneratorSlot,\n+                                      generator);\n+  };\n+\n+  // TODO(jgruber): AsyncBuiltinsAssembler::Await currently does not reuse\n+  // the awaited promise if it is already a promise. Reuse is non-spec compliant\n+  // but part of our old behavior gives us a couple of percent\n+  // performance boost.\n+  // TODO(jgruber): Use a faster specialized version of\n+  // InternalPerformPromiseThen.\n+\n+  Await(context, generator, awaited, outer_promise, AwaitContext::kLength,\n+        init_closure_context, Context::ASYNC_FUNCTION_AWAIT_RESOLVE_SHARED_FUN,\n+        Context::ASYNC_FUNCTION_AWAIT_REJECT_SHARED_FUN,\n+        is_predicted_as_caught);\n \n   // Return outer promise to avoid adding an load of the outer promise before\n   // suspending in BytecodeGenerator.\n@@ -93,28 +133,30 @@ void AsyncFunctionBuiltinsAssembler::AsyncFunctionAwait(\n // Called by the parser from the desugaring of 'await' when catch\n // prediction indicates that there is a locally surrounding catch block.\n TF_BUILTIN(AsyncFunctionAwaitCaught, AsyncFunctionBuiltinsAssembler) {\n+  CSA_ASSERT_JS_ARGC_EQ(this, 3);\n   Node* const generator = Parameter(Descriptor::kGenerator);\n-  Node* const value = Parameter(Descriptor::kValue);\n+  Node* const awaited = Parameter(Descriptor::kAwaited);\n   Node* const outer_promise = Parameter(Descriptor::kOuterPromise);\n   Node* const context = Parameter(Descriptor::kContext);\n \n   static const bool kIsPredictedAsCaught = true;\n \n-  AsyncFunctionAwait(context, generator, value, outer_promise,\n+  AsyncFunctionAwait(context, generator, awaited, outer_promise,\n                      kIsPredictedAsCaught);\n }\n \n // Called by the parser from the desugaring of 'await' when catch\n // prediction indicates no locally surrounding catch block.\n TF_BUILTIN(AsyncFunctionAwaitUncaught, AsyncFunctionBuiltinsAssembler) {\n+  CSA_ASSERT_JS_ARGC_EQ(this, 3);\n   Node* const generator = Parameter(Descriptor::kGenerator);\n-  Node* const value = Parameter(Descriptor::kValue);\n+  Node* const awaited = Parameter(Descriptor::kAwaited);\n   Node* const outer_promise = Parameter(Descriptor::kOuterPromise);\n   Node* const context = Parameter(Descriptor::kContext);\n \n   static const bool kIsPredictedAsCaught = false;\n \n-  AsyncFunctionAwait(context, generator, value, outer_promise,\n+  AsyncFunctionAwait(context, generator, awaited, outer_promise,\n                      kIsPredictedAsCaught);\n }\n "
        },
        {
            "sha": "ba0226d7b3a42abe6f523c087c22a1b28676fd33",
            "filename": "deps/v8/src/builtins/builtins-async-gen.cc",
            "status": "modified",
            "additions": 155,
            "deletions": 52,
            "changes": 207,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-gen.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-gen.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-gen.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -13,58 +13,6 @@ namespace internal {\n \n using compiler::Node;\n \n-void AsyncBuiltinsAssembler::Await(Node* context, Node* generator, Node* value,\n-                                   Node* outer_promise,\n-                                   Builtins::Name fulfill_builtin,\n-                                   Builtins::Name reject_builtin,\n-                                   Node* is_predicted_as_caught) {\n-  CSA_SLOW_ASSERT(this, Word32Or(IsJSAsyncGeneratorObject(generator),\n-                                 IsJSGeneratorObject(generator)));\n-  CSA_SLOW_ASSERT(this, IsJSPromise(outer_promise));\n-  CSA_SLOW_ASSERT(this, IsBoolean(is_predicted_as_caught));\n-\n-  Node* const native_context = LoadNativeContext(context);\n-\n-  // TODO(bmeurer): This could be optimized and folded into a single allocation.\n-  Node* const promise = AllocateAndInitJSPromise(native_context);\n-  Node* const promise_reactions =\n-      LoadObjectField(promise, JSPromise::kReactionsOrResultOffset);\n-  Node* const fulfill_handler =\n-      HeapConstant(Builtins::CallableFor(isolate(), fulfill_builtin).code());\n-  Node* const reject_handler =\n-      HeapConstant(Builtins::CallableFor(isolate(), reject_builtin).code());\n-  Node* const reaction = AllocatePromiseReaction(\n-      promise_reactions, generator, fulfill_handler, reject_handler);\n-  StoreObjectField(promise, JSPromise::kReactionsOrResultOffset, reaction);\n-  PromiseSetHasHandler(promise);\n-\n-  // Perform ! Call(promiseCapability.[[Resolve]], undefined, « value »).\n-  CallBuiltin(Builtins::kResolvePromise, native_context, promise, value);\n-\n-  // When debugging, we need to link from the {generator} to the\n-  // {outer_promise} of the async function/generator.\n-  Label done(this);\n-  GotoIfNot(IsPromiseHookEnabledOrDebugIsActive(), &done);\n-  CallRuntime(Runtime::kSetProperty, native_context, generator,\n-              LoadRoot(Heap::kgenerator_outer_promise_symbolRootIndex),\n-              outer_promise, SmiConstant(LanguageMode::kStrict));\n-  GotoIf(IsFalse(is_predicted_as_caught), &done);\n-  GotoIf(TaggedIsSmi(value), &done);\n-  GotoIfNot(IsJSPromise(value), &done);\n-  PromiseSetHandledHint(value);\n-  Goto(&done);\n-  BIND(&done);\n-}\n-\n-void AsyncBuiltinsAssembler::Await(Node* context, Node* generator, Node* value,\n-                                   Node* outer_promise,\n-                                   Builtins::Name fulfill_builtin,\n-                                   Builtins::Name reject_builtin,\n-                                   bool is_predicted_as_caught) {\n-  return Await(context, generator, value, outer_promise, fulfill_builtin,\n-               reject_builtin, BooleanConstant(is_predicted_as_caught));\n-}\n-\n namespace {\n // Describe fields of Context associated with the AsyncIterator unwrap closure.\n class ValueUnwrapContext {\n@@ -74,6 +22,161 @@ class ValueUnwrapContext {\n \n }  // namespace\n \n+Node* AsyncBuiltinsAssembler::Await(\n+    Node* context, Node* generator, Node* value, Node* outer_promise,\n+    int context_length, const ContextInitializer& init_closure_context,\n+    Node* on_resolve_context_index, Node* on_reject_context_index,\n+    Node* is_predicted_as_caught) {\n+  DCHECK_GE(context_length, Context::MIN_CONTEXT_SLOTS);\n+\n+  Node* const native_context = LoadNativeContext(context);\n+\n+  static const int kWrappedPromiseOffset = FixedArray::SizeFor(context_length);\n+  static const int kThrowawayPromiseOffset =\n+      kWrappedPromiseOffset + JSPromise::kSizeWithEmbedderFields;\n+  static const int kResolveClosureOffset =\n+      kThrowawayPromiseOffset + JSPromise::kSizeWithEmbedderFields;\n+  static const int kRejectClosureOffset =\n+      kResolveClosureOffset + JSFunction::kSizeWithoutPrototype;\n+  static const int kTotalSize =\n+      kRejectClosureOffset + JSFunction::kSizeWithoutPrototype;\n+\n+  Node* const base = AllocateInNewSpace(kTotalSize);\n+  Node* const closure_context = base;\n+  {\n+    // Initialize closure context\n+    InitializeFunctionContext(native_context, closure_context, context_length);\n+    init_closure_context(closure_context);\n+  }\n+\n+  // Let promiseCapability be ! NewPromiseCapability(%Promise%).\n+  Node* const promise_fun =\n+      LoadContextElement(native_context, Context::PROMISE_FUNCTION_INDEX);\n+  CSA_ASSERT(this, IsFunctionWithPrototypeSlotMap(LoadMap(promise_fun)));\n+  Node* const promise_map =\n+      LoadObjectField(promise_fun, JSFunction::kPrototypeOrInitialMapOffset);\n+  // Assert that the JSPromise map has an instance size is\n+  // JSPromise::kSizeWithEmbedderFields.\n+  CSA_ASSERT(this, WordEqual(LoadMapInstanceSizeInWords(promise_map),\n+                             IntPtrConstant(JSPromise::kSizeWithEmbedderFields /\n+                                            kPointerSize)));\n+  Node* const wrapped_value = InnerAllocate(base, kWrappedPromiseOffset);\n+  {\n+    // Initialize Promise\n+    StoreMapNoWriteBarrier(wrapped_value, promise_map);\n+    InitializeJSObjectFromMap(\n+        wrapped_value, promise_map,\n+        IntPtrConstant(JSPromise::kSizeWithEmbedderFields));\n+    PromiseInit(wrapped_value);\n+  }\n+\n+  Node* const throwaway = InnerAllocate(base, kThrowawayPromiseOffset);\n+  {\n+    // Initialize throwawayPromise\n+    StoreMapNoWriteBarrier(throwaway, promise_map);\n+    InitializeJSObjectFromMap(\n+        throwaway, promise_map,\n+        IntPtrConstant(JSPromise::kSizeWithEmbedderFields));\n+    PromiseInit(throwaway);\n+  }\n+\n+  Node* const on_resolve = InnerAllocate(base, kResolveClosureOffset);\n+  {\n+    // Initialize resolve handler\n+    InitializeNativeClosure(closure_context, native_context, on_resolve,\n+                            on_resolve_context_index);\n+  }\n+\n+  Node* const on_reject = InnerAllocate(base, kRejectClosureOffset);\n+  {\n+    // Initialize reject handler\n+    InitializeNativeClosure(closure_context, native_context, on_reject,\n+                            on_reject_context_index);\n+  }\n+\n+  {\n+    // Add PromiseHooks if needed\n+    Label next(this);\n+    GotoIfNot(IsPromiseHookEnabledOrDebugIsActive(), &next);\n+    CallRuntime(Runtime::kPromiseHookInit, context, wrapped_value,\n+                outer_promise);\n+    CallRuntime(Runtime::kPromiseHookInit, context, throwaway, wrapped_value);\n+    Goto(&next);\n+    BIND(&next);\n+  }\n+\n+  // Perform ! Call(promiseCapability.[[Resolve]], undefined, « promise »).\n+  CallBuiltin(Builtins::kResolvePromise, context, wrapped_value, value);\n+\n+  // The Promise will be thrown away and not handled, but it shouldn't trigger\n+  // unhandled reject events as its work is done\n+  PromiseSetHasHandler(throwaway);\n+\n+  Label do_perform_promise_then(this);\n+  GotoIfNot(IsDebugActive(), &do_perform_promise_then);\n+  {\n+    Label common(this);\n+    GotoIf(TaggedIsSmi(value), &common);\n+    GotoIfNot(HasInstanceType(value, JS_PROMISE_TYPE), &common);\n+    {\n+      // Mark the reject handler callback to be a forwarding edge, rather\n+      // than a meaningful catch handler\n+      Node* const key =\n+          HeapConstant(factory()->promise_forwarding_handler_symbol());\n+      CallRuntime(Runtime::kSetProperty, context, on_reject, key,\n+                  TrueConstant(), SmiConstant(LanguageMode::kStrict));\n+\n+      GotoIf(IsFalse(is_predicted_as_caught), &common);\n+      PromiseSetHandledHint(value);\n+    }\n+\n+    Goto(&common);\n+    BIND(&common);\n+    // Mark the dependency to outer Promise in case the throwaway Promise is\n+    // found on the Promise stack\n+    CSA_SLOW_ASSERT(this, HasInstanceType(outer_promise, JS_PROMISE_TYPE));\n+\n+    Node* const key = HeapConstant(factory()->promise_handled_by_symbol());\n+    CallRuntime(Runtime::kSetProperty, context, throwaway, key, outer_promise,\n+                SmiConstant(LanguageMode::kStrict));\n+  }\n+\n+  Goto(&do_perform_promise_then);\n+  BIND(&do_perform_promise_then);\n+  return CallBuiltin(Builtins::kPerformPromiseThen, context, wrapped_value,\n+                     on_resolve, on_reject, throwaway);\n+}\n+\n+void AsyncBuiltinsAssembler::InitializeNativeClosure(Node* context,\n+                                                     Node* native_context,\n+                                                     Node* function,\n+                                                     Node* context_index) {\n+  Node* const function_map = LoadContextElement(\n+      native_context, Context::STRICT_FUNCTION_WITHOUT_PROTOTYPE_MAP_INDEX);\n+  // Ensure that we don't have to initialize prototype_or_initial_map field of\n+  // JSFunction.\n+  CSA_ASSERT(this, WordEqual(LoadMapInstanceSizeInWords(function_map),\n+                             IntPtrConstant(JSFunction::kSizeWithoutPrototype /\n+                                            kPointerSize)));\n+  STATIC_ASSERT(JSFunction::kSizeWithoutPrototype == 7 * kPointerSize);\n+  StoreMapNoWriteBarrier(function, function_map);\n+  StoreObjectFieldRoot(function, JSObject::kPropertiesOrHashOffset,\n+                       Heap::kEmptyFixedArrayRootIndex);\n+  StoreObjectFieldRoot(function, JSObject::kElementsOffset,\n+                       Heap::kEmptyFixedArrayRootIndex);\n+  StoreObjectFieldRoot(function, JSFunction::kFeedbackCellOffset,\n+                       Heap::kManyClosuresCellRootIndex);\n+\n+  Node* shared_info = LoadContextElement(native_context, context_index);\n+  CSA_ASSERT(this, IsSharedFunctionInfo(shared_info));\n+  StoreObjectFieldNoWriteBarrier(\n+      function, JSFunction::kSharedFunctionInfoOffset, shared_info);\n+  StoreObjectFieldNoWriteBarrier(function, JSFunction::kContextOffset, context);\n+\n+  Node* const code = GetSharedFunctionInfoCode(shared_info);\n+  StoreObjectFieldNoWriteBarrier(function, JSFunction::kCodeOffset, code);\n+}\n+\n Node* AsyncBuiltinsAssembler::CreateUnwrapClosure(Node* native_context,\n                                                   Node* done) {\n   Node* const map = LoadContextElement("
        },
        {
            "sha": "45d7c8689a902a54a0c04248f1d4bf119dc0dbc5",
            "filename": "deps/v8/src/builtins/builtins-async-gen.h",
            "status": "modified",
            "additions": 34,
            "deletions": 9,
            "changes": 43,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-gen.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-gen.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-gen.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -16,23 +16,48 @@ class AsyncBuiltinsAssembler : public PromiseBuiltinsAssembler {\n       : PromiseBuiltinsAssembler(state) {}\n \n  protected:\n-  void Await(Node* context, Node* generator, Node* value, Node* outer_promise,\n-             Builtins::Name fulfill_builtin, Builtins::Name reject_builtin,\n-             Node* is_predicted_as_caught);\n-  void Await(Node* context, Node* generator, Node* value, Node* outer_promise,\n-             Builtins::Name fulfill_builtin, Builtins::Name reject_builtin,\n-             bool is_predicted_as_caught);\n+  typedef std::function<void(Node*)> ContextInitializer;\n+\n+  // Perform steps to resume generator after `value` is resolved.\n+  // `on_reject_context_index` is an index into the Native Context, which should\n+  // point to a SharedFunctioninfo instance used to create the closure. The\n+  // value following the reject index should be a similar value for the resolve\n+  // closure. Returns the Promise-wrapped `value`.\n+  Node* Await(Node* context, Node* generator, Node* value, Node* outer_promise,\n+              int context_length,\n+              const ContextInitializer& init_closure_context,\n+              Node* on_resolve_context_index, Node* on_reject_context_index,\n+              Node* is_predicted_as_caught);\n+  Node* Await(Node* context, Node* generator, Node* value, Node* outer_promise,\n+              int context_length,\n+              const ContextInitializer& init_closure_context,\n+              int on_resolve_context_index, int on_reject_context_index,\n+              Node* is_predicted_as_caught) {\n+    return Await(context, generator, value, outer_promise, context_length,\n+                 init_closure_context, IntPtrConstant(on_resolve_context_index),\n+                 IntPtrConstant(on_reject_context_index),\n+                 is_predicted_as_caught);\n+  }\n+  Node* Await(Node* context, Node* generator, Node* value, Node* outer_promise,\n+              int context_length,\n+              const ContextInitializer& init_closure_context,\n+              int on_resolve_context_index, int on_reject_context_index,\n+              bool is_predicted_as_caught) {\n+    return Await(context, generator, value, outer_promise, context_length,\n+                 init_closure_context, on_resolve_context_index,\n+                 on_reject_context_index,\n+                 BooleanConstant(is_predicted_as_caught));\n+  }\n \n   // Return a new built-in function object as defined in\n   // Async Iterator Value Unwrap Functions\n   Node* CreateUnwrapClosure(Node* const native_context, Node* const done);\n \n  private:\n+  void InitializeNativeClosure(Node* context, Node* native_context,\n+                               Node* function, Node* context_index);\n   Node* AllocateAsyncIteratorValueUnwrapContext(Node* native_context,\n                                                 Node* done);\n-  Node* AllocateAwaitPromiseJobTask(Node* generator, Node* fulfill_handler,\n-                                    Node* reject_handler, Node* promise,\n-                                    Node* context);\n };\n \n }  // namespace internal"
        },
        {
            "sha": "dd6c644196451f1c37fa00fe134626b64fd0f1b5",
            "filename": "deps/v8/src/builtins/builtins-async-generator-gen.cc",
            "status": "modified",
            "additions": 89,
            "deletions": 120,
            "changes": 209,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-generator-gen.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-generator-gen.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-async-generator-gen.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -140,8 +140,8 @@ class AsyncGeneratorBuiltinsAssembler : public AsyncBuiltinsAssembler {\n   // for AsyncGenerators.\n   template <typename Descriptor>\n   void AsyncGeneratorAwait(bool is_catchable);\n-  void AsyncGeneratorAwaitResume(\n-      Node* context, Node* generator, Node* argument,\n+  void AsyncGeneratorAwaitResumeClosure(\n+      Node* context, Node* value,\n       JSAsyncGeneratorObject::ResumeMode resume_mode);\n };\n \n@@ -219,9 +219,11 @@ Node* AsyncGeneratorBuiltinsAssembler::AllocateAsyncGeneratorRequest(\n   return request;\n }\n \n-void AsyncGeneratorBuiltinsAssembler::AsyncGeneratorAwaitResume(\n-    Node* context, Node* generator, Node* argument,\n+void AsyncGeneratorBuiltinsAssembler::AsyncGeneratorAwaitResumeClosure(\n+    Node* context, Node* value,\n     JSAsyncGeneratorObject::ResumeMode resume_mode) {\n+  Node* const generator =\n+      LoadContextElement(context, AwaitContext::kGeneratorSlot);\n   CSA_SLOW_ASSERT(this, TaggedIsAsyncGenerator(generator));\n \n   SetGeneratorNotAwaiting(generator);\n@@ -233,30 +235,36 @@ void AsyncGeneratorBuiltinsAssembler::AsyncGeneratorAwaitResume(\n                                  JSGeneratorObject::kResumeModeOffset,\n                                  SmiConstant(resume_mode));\n \n-  CallStub(CodeFactory::ResumeGenerator(isolate()), context, argument,\n-           generator);\n+  CallStub(CodeFactory::ResumeGenerator(isolate()), context, value, generator);\n \n   TailCallBuiltin(Builtins::kAsyncGeneratorResumeNext, context, generator);\n }\n \n template <typename Descriptor>\n void AsyncGeneratorBuiltinsAssembler::AsyncGeneratorAwait(bool is_catchable) {\n-  Node* const generator = Parameter(Descriptor::kGenerator);\n-  Node* const value = Parameter(Descriptor::kValue);\n-  Node* const context = Parameter(Descriptor::kContext);\n+  Node* generator = Parameter(Descriptor::kGenerator);\n+  Node* value = Parameter(Descriptor::kAwaited);\n+  Node* context = Parameter(Descriptor::kContext);\n \n   CSA_SLOW_ASSERT(this, TaggedIsAsyncGenerator(generator));\n \n   Node* const request = LoadFirstAsyncGeneratorRequestFromQueue(generator);\n   CSA_ASSERT(this, IsNotUndefined(request));\n \n+  ContextInitializer init_closure_context = [&](Node* context) {\n+    StoreContextElementNoWriteBarrier(context, AwaitContext::kGeneratorSlot,\n+                                      generator);\n+  };\n+\n   Node* outer_promise =\n       LoadObjectField(request, AsyncGeneratorRequest::kPromiseOffset);\n \n+  const int resolve_index = Context::ASYNC_GENERATOR_AWAIT_RESOLVE_SHARED_FUN;\n+  const int reject_index = Context::ASYNC_GENERATOR_AWAIT_REJECT_SHARED_FUN;\n+\n   SetGeneratorAwaiting(generator);\n-  Await(context, generator, value, outer_promise,\n-        Builtins::kAsyncGeneratorAwaitFulfill,\n-        Builtins::kAsyncGeneratorAwaitReject, is_catchable);\n+  Await(context, generator, value, outer_promise, AwaitContext::kLength,\n+        init_closure_context, resolve_index, reject_index, is_catchable);\n   Return(UndefinedConstant());\n }\n \n@@ -367,20 +375,18 @@ TF_BUILTIN(AsyncGeneratorPrototypeThrow, AsyncGeneratorBuiltinsAssembler) {\n                         \"[AsyncGenerator].prototype.throw\");\n }\n \n-TF_BUILTIN(AsyncGeneratorAwaitFulfill, AsyncGeneratorBuiltinsAssembler) {\n-  Node* const generator = Parameter(Descriptor::kGenerator);\n-  Node* const argument = Parameter(Descriptor::kArgument);\n-  Node* const context = Parameter(Descriptor::kContext);\n-  AsyncGeneratorAwaitResume(context, generator, argument,\n-                            JSAsyncGeneratorObject::kNext);\n+TF_BUILTIN(AsyncGeneratorAwaitResolveClosure, AsyncGeneratorBuiltinsAssembler) {\n+  Node* value = Parameter(Descriptor::kValue);\n+  Node* context = Parameter(Descriptor::kContext);\n+  AsyncGeneratorAwaitResumeClosure(context, value,\n+                                   JSAsyncGeneratorObject::kNext);\n }\n \n-TF_BUILTIN(AsyncGeneratorAwaitReject, AsyncGeneratorBuiltinsAssembler) {\n-  Node* const generator = Parameter(Descriptor::kGenerator);\n-  Node* const argument = Parameter(Descriptor::kArgument);\n-  Node* const context = Parameter(Descriptor::kContext);\n-  AsyncGeneratorAwaitResume(context, generator, argument,\n-                            JSAsyncGeneratorObject::kThrow);\n+TF_BUILTIN(AsyncGeneratorAwaitRejectClosure, AsyncGeneratorBuiltinsAssembler) {\n+  Node* value = Parameter(Descriptor::kValue);\n+  Node* context = Parameter(Descriptor::kContext);\n+  AsyncGeneratorAwaitResumeClosure(context, value,\n+                                   JSAsyncGeneratorObject::kThrow);\n }\n \n TF_BUILTIN(AsyncGeneratorAwaitUncaught, AsyncGeneratorBuiltinsAssembler) {\n@@ -518,34 +524,11 @@ TF_BUILTIN(AsyncGeneratorResolve, AsyncGeneratorBuiltinsAssembler) {\n                                    done);\n   }\n \n-  // We know that {iter_result} itself doesn't have any \"then\" property and\n-  // we also know that the [[Prototype]] of {iter_result} is the intrinsic\n-  // %ObjectPrototype%. So we can skip the [[Resolve]] logic here completely\n-  // and directly call into the FulfillPromise operation if we can prove\n-  // that the %ObjectPrototype% also doesn't have any \"then\" property. This\n-  // is guarded by the Promise#then protector.\n-  Label if_fast(this), if_slow(this, Label::kDeferred), return_promise(this);\n-  GotoIfForceSlowPath(&if_slow);\n-  Branch(IsPromiseThenProtectorCellInvalid(), &if_slow, &if_fast);\n-\n-  BIND(&if_fast);\n-  {\n-    // Skip the \"then\" on {iter_result} and directly fulfill the {promise}\n-    // with the {iter_result}.\n-    CallBuiltin(Builtins::kFulfillPromise, context, promise, iter_result);\n-    Goto(&return_promise);\n-  }\n-\n-  BIND(&if_slow);\n-  {\n-    // Perform Call(promiseCapability.[[Resolve]], undefined, «iteratorResult»).\n-    CallBuiltin(Builtins::kResolvePromise, context, promise, iter_result);\n-    Goto(&return_promise);\n-  }\n+  // Perform Call(promiseCapability.[[Resolve]], undefined, «iteratorResult»).\n+  CallBuiltin(Builtins::kResolvePromise, context, promise, iter_result);\n \n   // Per spec, AsyncGeneratorResolve() returns undefined. However, for the\n   // benefit of %TraceExit(), return the Promise.\n-  BIND(&return_promise);\n   Return(promise);\n }\n \n@@ -571,54 +554,31 @@ TF_BUILTIN(AsyncGeneratorYield, AsyncGeneratorBuiltinsAssembler) {\n   Node* const request = LoadFirstAsyncGeneratorRequestFromQueue(generator);\n   Node* const outer_promise = LoadPromiseFromAsyncGeneratorRequest(request);\n \n-  // Mark the generator as \"awaiting\".\n-  SetGeneratorAwaiting(generator);\n+  ContextInitializer init_closure_context = [&](Node* context) {\n+    StoreContextElementNoWriteBarrier(context, AwaitContext::kGeneratorSlot,\n+                                      generator);\n+  };\n \n-  // We can skip the creation of a temporary promise and the whole\n-  // [[Resolve]] logic if we already know that the {value} that's\n-  // being yielded is a primitive, as in that case we would immediately\n-  // fulfill the temporary promise anyways and schedule a fulfill\n-  // reaction job. This gives a nice performance boost for async\n-  // generators that yield only primitives, e.g. numbers or strings.\n-  Label if_primitive(this), if_generic(this);\n-  GotoIfForceSlowPath(&if_generic);\n-  GotoIf(IsPromiseHookEnabledOrDebugIsActive(), &if_generic);\n-  GotoIf(TaggedIsSmi(value), &if_primitive);\n-  Branch(IsJSReceiver(value), &if_generic, &if_primitive);\n-\n-  BIND(&if_generic);\n-  {\n-    Await(context, generator, value, outer_promise,\n-          Builtins::kAsyncGeneratorYieldFulfill,\n-          Builtins::kAsyncGeneratorAwaitReject, is_caught);\n-    Return(UndefinedConstant());\n-  }\n+  const int on_resolve = Context::ASYNC_GENERATOR_YIELD_RESOLVE_SHARED_FUN;\n+  const int on_reject = Context::ASYNC_GENERATOR_AWAIT_REJECT_SHARED_FUN;\n \n-  BIND(&if_primitive);\n-  {\n-    // For primitive {value}s we can skip the allocation of the temporary\n-    // promise and the resolution of that, and directly allocate the fulfill\n-    // reaction job.\n-    Node* const microtask = AllocatePromiseReactionJobTask(\n-        Heap::kPromiseFulfillReactionJobTaskMapRootIndex, context, value,\n-        HeapConstant(Builtins::CallableFor(\n-                         isolate(), Builtins::kAsyncGeneratorYieldFulfill)\n-                         .code()),\n-        generator);\n-    TailCallBuiltin(Builtins::kEnqueueMicrotask, context, microtask);\n-  }\n+  SetGeneratorAwaiting(generator);\n+  Await(context, generator, value, outer_promise, AwaitContext::kLength,\n+        init_closure_context, on_resolve, on_reject, is_caught);\n+  Return(UndefinedConstant());\n }\n \n-TF_BUILTIN(AsyncGeneratorYieldFulfill, AsyncGeneratorBuiltinsAssembler) {\n+TF_BUILTIN(AsyncGeneratorYieldResolveClosure, AsyncGeneratorBuiltinsAssembler) {\n   Node* const context = Parameter(Descriptor::kContext);\n-  Node* const generator = Parameter(Descriptor::kGenerator);\n-  Node* const argument = Parameter(Descriptor::kArgument);\n+  Node* const value = Parameter(Descriptor::kValue);\n+  Node* const generator =\n+      LoadContextElement(context, AwaitContext::kGeneratorSlot);\n \n   SetGeneratorNotAwaiting(generator);\n \n   // Per proposal-async-iteration/#sec-asyncgeneratoryield step 9\n   // Return ! AsyncGeneratorResolve(_F_.[[Generator]], _value_, *false*).\n-  CallBuiltin(Builtins::kAsyncGeneratorResolve, context, generator, argument,\n+  CallBuiltin(Builtins::kAsyncGeneratorResolve, context, generator, value,\n               FalseConstant());\n \n   TailCallBuiltin(Builtins::kAsyncGeneratorResumeNext, context, generator);\n@@ -644,78 +604,87 @@ TF_BUILTIN(AsyncGeneratorReturn, AsyncGeneratorBuiltinsAssembler) {\n   Node* const generator = Parameter(Descriptor::kGenerator);\n   Node* const value = Parameter(Descriptor::kValue);\n   Node* const is_caught = Parameter(Descriptor::kIsCaught);\n-  Node* const context = Parameter(Descriptor::kContext);\n   Node* const req = LoadFirstAsyncGeneratorRequestFromQueue(generator);\n-  Node* const outer_promise = LoadPromiseFromAsyncGeneratorRequest(req);\n   CSA_ASSERT(this, IsNotUndefined(req));\n \n-  Label if_closed(this, Label::kDeferred), if_not_closed(this), done(this);\n+  Label perform_await(this);\n+  VARIABLE(var_on_resolve, MachineType::PointerRepresentation(),\n+           IntPtrConstant(\n+               Context::ASYNC_GENERATOR_RETURN_CLOSED_RESOLVE_SHARED_FUN));\n+  VARIABLE(\n+      var_on_reject, MachineType::PointerRepresentation(),\n+      IntPtrConstant(Context::ASYNC_GENERATOR_RETURN_CLOSED_REJECT_SHARED_FUN));\n+\n   Node* const state = LoadGeneratorState(generator);\n-  SetGeneratorAwaiting(generator);\n-  Branch(IsGeneratorStateClosed(state), &if_closed, &if_not_closed);\n+  GotoIf(IsGeneratorStateClosed(state), &perform_await);\n+  var_on_resolve.Bind(\n+      IntPtrConstant(Context::ASYNC_GENERATOR_RETURN_RESOLVE_SHARED_FUN));\n+  var_on_reject.Bind(\n+      IntPtrConstant(Context::ASYNC_GENERATOR_AWAIT_REJECT_SHARED_FUN));\n+  Goto(&perform_await);\n \n-  BIND(&if_closed);\n-  {\n-    Await(context, generator, value, outer_promise,\n-          Builtins::kAsyncGeneratorReturnClosedFulfill,\n-          Builtins::kAsyncGeneratorReturnClosedReject, is_caught);\n-    Goto(&done);\n-  }\n+  BIND(&perform_await);\n \n-  BIND(&if_not_closed);\n-  {\n-    Await(context, generator, value, outer_promise,\n-          Builtins::kAsyncGeneratorReturnFulfill,\n-          Builtins::kAsyncGeneratorAwaitReject, is_caught);\n-    Goto(&done);\n-  }\n+  ContextInitializer init_closure_context = [&](Node* context) {\n+    StoreContextElementNoWriteBarrier(context, AwaitContext::kGeneratorSlot,\n+                                      generator);\n+  };\n+\n+  SetGeneratorAwaiting(generator);\n+  Node* const context = Parameter(Descriptor::kContext);\n+  Node* const outer_promise = LoadPromiseFromAsyncGeneratorRequest(req);\n+  Await(context, generator, value, outer_promise, AwaitContext::kLength,\n+        init_closure_context, var_on_resolve.value(), var_on_reject.value(),\n+        is_caught);\n \n-  BIND(&done);\n   Return(UndefinedConstant());\n }\n \n // On-resolve closure for Await in AsyncGeneratorReturn\n // Resume the generator with \"return\" resume_mode, and finally perform\n // AsyncGeneratorResumeNext. Per\n // proposal-async-iteration/#sec-asyncgeneratoryield step 8.e\n-TF_BUILTIN(AsyncGeneratorReturnFulfill, AsyncGeneratorBuiltinsAssembler) {\n-  Node* const generator = Parameter(Descriptor::kGenerator);\n-  Node* const argument = Parameter(Descriptor::kArgument);\n+TF_BUILTIN(AsyncGeneratorReturnResolveClosure,\n+           AsyncGeneratorBuiltinsAssembler) {\n   Node* const context = Parameter(Descriptor::kContext);\n-  AsyncGeneratorAwaitResume(context, generator, argument,\n-                            JSGeneratorObject::kReturn);\n+  Node* const value = Parameter(Descriptor::kValue);\n+  AsyncGeneratorAwaitResumeClosure(context, value, JSGeneratorObject::kReturn);\n }\n \n // On-resolve closure for Await in AsyncGeneratorReturn\n // Perform AsyncGeneratorResolve({awaited_value}, true) and finally perform\n // AsyncGeneratorResumeNext.\n-TF_BUILTIN(AsyncGeneratorReturnClosedFulfill, AsyncGeneratorBuiltinsAssembler) {\n-  Node* const generator = Parameter(Descriptor::kGenerator);\n-  Node* const argument = Parameter(Descriptor::kArgument);\n+TF_BUILTIN(AsyncGeneratorReturnClosedResolveClosure,\n+           AsyncGeneratorBuiltinsAssembler) {\n   Node* const context = Parameter(Descriptor::kContext);\n+  Node* const value = Parameter(Descriptor::kValue);\n+  Node* const generator =\n+      LoadContextElement(context, AwaitContext::kGeneratorSlot);\n \n   SetGeneratorNotAwaiting(generator);\n \n   // https://tc39.github.io/proposal-async-iteration/\n   //    #async-generator-resume-next-return-processor-fulfilled step 2:\n   //  Return ! AsyncGeneratorResolve(_F_.[[Generator]], _value_, *true*).\n-  CallBuiltin(Builtins::kAsyncGeneratorResolve, context, generator, argument,\n+  CallBuiltin(Builtins::kAsyncGeneratorResolve, context, generator, value,\n               TrueConstant());\n \n   TailCallBuiltin(Builtins::kAsyncGeneratorResumeNext, context, generator);\n }\n \n-TF_BUILTIN(AsyncGeneratorReturnClosedReject, AsyncGeneratorBuiltinsAssembler) {\n-  Node* const generator = Parameter(Descriptor::kGenerator);\n-  Node* const argument = Parameter(Descriptor::kArgument);\n+TF_BUILTIN(AsyncGeneratorReturnClosedRejectClosure,\n+           AsyncGeneratorBuiltinsAssembler) {\n   Node* const context = Parameter(Descriptor::kContext);\n+  Node* const value = Parameter(Descriptor::kValue);\n+  Node* const generator =\n+      LoadContextElement(context, AwaitContext::kGeneratorSlot);\n \n   SetGeneratorNotAwaiting(generator);\n \n   // https://tc39.github.io/proposal-async-iteration/\n   //    #async-generator-resume-next-return-processor-rejected step 2:\n   // Return ! AsyncGeneratorReject(_F_.[[Generator]], _reason_).\n-  CallBuiltin(Builtins::kAsyncGeneratorReject, context, generator, argument);\n+  CallBuiltin(Builtins::kAsyncGeneratorReject, context, generator, value);\n \n   TailCallBuiltin(Builtins::kAsyncGeneratorResumeNext, context, generator);\n }"
        },
        {
            "sha": "5f06abeceb0d76f1f452a895e1c47bd44abf375e",
            "filename": "deps/v8/src/builtins/builtins-definitions.h",
            "status": "modified",
            "additions": 21,
            "deletions": 17,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-definitions.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-definitions.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-definitions.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -381,10 +381,10 @@ namespace internal {\n   CPP(ArrayBufferPrototypeSlice)                                               \\\n                                                                                \\\n   /* AsyncFunction */                                                          \\\n-  TFC(AsyncFunctionAwaitFulfill, PromiseReactionHandler, 1)                    \\\n-  TFC(AsyncFunctionAwaitReject, PromiseReactionHandler, 1)                     \\\n-  TFS(AsyncFunctionAwaitCaught, kGenerator, kValue, kOuterPromise)             \\\n-  TFS(AsyncFunctionAwaitUncaught, kGenerator, kValue, kOuterPromise)           \\\n+  TFJ(AsyncFunctionAwaitCaught, 3, kGenerator, kAwaited, kOuterPromise)        \\\n+  TFJ(AsyncFunctionAwaitUncaught, 3, kGenerator, kAwaited, kOuterPromise)      \\\n+  TFJ(AsyncFunctionAwaitRejectClosure, 1, kSentError)                          \\\n+  TFJ(AsyncFunctionAwaitResolveClosure, 1, kSentValue)                         \\\n   TFJ(AsyncFunctionPromiseCreate, 0)                                           \\\n   TFJ(AsyncFunctionPromiseRelease, 1, kPromise)                                \\\n                                                                                \\\n@@ -838,8 +838,8 @@ namespace internal {\n   /* ES #sec-promise.prototype.catch */                                        \\\n   TFJ(PromisePrototypeCatch, 1, kOnRejected)                                   \\\n   /* ES #sec-promisereactionjob */                                             \\\n-  TFS(PromiseRejectReactionJob, kReason, kHandler, kPayload)                   \\\n-  TFS(PromiseFulfillReactionJob, kValue, kHandler, kPayload)                   \\\n+  TFS(PromiseRejectReactionJob, kReason, kHandler, kPromiseOrCapability)       \\\n+  TFS(PromiseFulfillReactionJob, kValue, kHandler, kPromiseOrCapability)       \\\n   /* ES #sec-promiseresolvethenablejob */                                      \\\n   TFS(PromiseResolveThenableJob, kPromiseToResolve, kThenable, kThen)          \\\n   /* ES #sec-promise.resolve */                                                \\\n@@ -1203,17 +1203,6 @@ namespace internal {\n                                                                                \\\n   /* AsyncGenerator */                                                         \\\n                                                                                \\\n-  /* Await (proposal-async-iteration/#await), with resume behaviour */         \\\n-  /* specific to Async Generators. Internal / Not exposed to JS code. */       \\\n-  TFS(AsyncGeneratorAwaitCaught, kGenerator, kValue)                           \\\n-  TFS(AsyncGeneratorAwaitUncaught, kGenerator, kValue)                         \\\n-  TFC(AsyncGeneratorAwaitFulfill, PromiseReactionHandler, 1)                   \\\n-  TFC(AsyncGeneratorAwaitReject, PromiseReactionHandler, 1)                    \\\n-  TFC(AsyncGeneratorYieldFulfill, PromiseReactionHandler, 1)                   \\\n-  TFC(AsyncGeneratorReturnClosedFulfill, PromiseReactionHandler, 1)            \\\n-  TFC(AsyncGeneratorReturnClosedReject, PromiseReactionHandler, 1)             \\\n-  TFC(AsyncGeneratorReturnFulfill, PromiseReactionHandler, 1)                  \\\n-                                                                               \\\n   TFS(AsyncGeneratorResolve, kGenerator, kValue, kDone)                        \\\n   TFS(AsyncGeneratorReject, kGenerator, kValue)                                \\\n   TFS(AsyncGeneratorYield, kGenerator, kValue, kIsCaught)                      \\\n@@ -1236,6 +1225,17 @@ namespace internal {\n   TFJ(AsyncGeneratorPrototypeThrow,                                            \\\n       SharedFunctionInfo::kDontAdaptArgumentsSentinel)                         \\\n                                                                                \\\n+  /* Await (proposal-async-iteration/#await), with resume behaviour */         \\\n+  /* specific to Async Generators. Internal / Not exposed to JS code. */       \\\n+  TFJ(AsyncGeneratorAwaitCaught, 2, kGenerator, kAwaited)                      \\\n+  TFJ(AsyncGeneratorAwaitUncaught, 2, kGenerator, kAwaited)                    \\\n+  TFJ(AsyncGeneratorAwaitResolveClosure, 1, kValue)                            \\\n+  TFJ(AsyncGeneratorAwaitRejectClosure, 1, kValue)                             \\\n+  TFJ(AsyncGeneratorYieldResolveClosure, 1, kValue)                            \\\n+  TFJ(AsyncGeneratorReturnClosedResolveClosure, 1, kValue)                     \\\n+  TFJ(AsyncGeneratorReturnClosedRejectClosure, 1, kValue)                      \\\n+  TFJ(AsyncGeneratorReturnResolveClosure, 1, kValue)                           \\\n+                                                                               \\\n   /* Async-from-Sync Iterator */                                               \\\n                                                                                \\\n   /* %AsyncFromSyncIteratorPrototype% */                                       \\\n@@ -1284,7 +1284,11 @@ namespace internal {\n   V(AsyncFromSyncIteratorPrototypeNext)              \\\n   V(AsyncFromSyncIteratorPrototypeReturn)            \\\n   V(AsyncFromSyncIteratorPrototypeThrow)             \\\n+  V(AsyncFunctionAwaitCaught)                        \\\n+  V(AsyncFunctionAwaitUncaught)                      \\\n   V(AsyncGeneratorResolve)                           \\\n+  V(AsyncGeneratorAwaitCaught)                       \\\n+  V(AsyncGeneratorAwaitUncaught)                     \\\n   V(PromiseAll)                                      \\\n   V(PromiseConstructor)                              \\\n   V(PromiseConstructorLazyDeoptContinuation)         \\"
        },
        {
            "sha": "4e533ad1c4c503b2282b9e490e760954586b59a8",
            "filename": "deps/v8/src/builtins/builtins-internal-gen.cc",
            "status": "modified",
            "additions": 25,
            "deletions": 13,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-internal-gen.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-internal-gen.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-internal-gen.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -669,7 +669,7 @@ class InternalBuiltinsAssembler : public CodeStubAssembler {\n   void LeaveMicrotaskContext();\n \n   void RunPromiseHook(Runtime::FunctionId id, TNode<Context> context,\n-                      SloppyTNode<HeapObject> payload);\n+                      SloppyTNode<HeapObject> promise_or_capability);\n \n   TNode<Object> GetPendingException() {\n     auto ref = ExternalReference(kPendingExceptionAddress, isolate());\n@@ -790,12 +790,20 @@ void InternalBuiltinsAssembler::LeaveMicrotaskContext() {\n \n void InternalBuiltinsAssembler::RunPromiseHook(\n     Runtime::FunctionId id, TNode<Context> context,\n-    SloppyTNode<HeapObject> payload) {\n+    SloppyTNode<HeapObject> promise_or_capability) {\n   Label hook(this, Label::kDeferred), done_hook(this);\n   Branch(IsPromiseHookEnabledOrDebugIsActive(), &hook, &done_hook);\n   BIND(&hook);\n   {\n-    CallRuntime(id, context, payload);\n+    // Get to the underlying JSPromise instance.\n+    Node* const promise = Select<HeapObject>(\n+        IsJSPromise(promise_or_capability),\n+        [=] { return promise_or_capability; },\n+        [=] {\n+          return CAST(LoadObjectField(promise_or_capability,\n+                                      PromiseCapability::kPromiseOffset));\n+        });\n+    CallRuntime(id, context, promise);\n     Goto(&done_hook);\n   }\n   BIND(&done_hook);\n@@ -1008,19 +1016,21 @@ TF_BUILTIN(RunMicrotasks, InternalBuiltinsAssembler) {\n             LoadObjectField(microtask, PromiseReactionJobTask::kArgumentOffset);\n         Node* const handler =\n             LoadObjectField(microtask, PromiseReactionJobTask::kHandlerOffset);\n-        Node* const payload =\n-            LoadObjectField(microtask, PromiseReactionJobTask::kPayloadOffset);\n+        Node* const promise_or_capability = LoadObjectField(\n+            microtask, PromiseReactionJobTask::kPromiseOrCapabilityOffset);\n \n         // Run the promise before/debug hook if enabled.\n-        RunPromiseHook(Runtime::kPromiseHookBefore, microtask_context, payload);\n+        RunPromiseHook(Runtime::kPromiseHookBefore, microtask_context,\n+                       promise_or_capability);\n \n         Node* const result =\n             CallBuiltin(Builtins::kPromiseFulfillReactionJob, microtask_context,\n-                        argument, handler, payload);\n+                        argument, handler, promise_or_capability);\n         GotoIfException(result, &if_exception, &var_exception);\n \n         // Run the promise after/debug hook if enabled.\n-        RunPromiseHook(Runtime::kPromiseHookAfter, microtask_context, payload);\n+        RunPromiseHook(Runtime::kPromiseHookAfter, microtask_context,\n+                       promise_or_capability);\n \n         LeaveMicrotaskContext();\n         SetCurrentContext(current_context);\n@@ -1041,19 +1051,21 @@ TF_BUILTIN(RunMicrotasks, InternalBuiltinsAssembler) {\n             LoadObjectField(microtask, PromiseReactionJobTask::kArgumentOffset);\n         Node* const handler =\n             LoadObjectField(microtask, PromiseReactionJobTask::kHandlerOffset);\n-        Node* const payload =\n-            LoadObjectField(microtask, PromiseReactionJobTask::kPayloadOffset);\n+        Node* const promise_or_capability = LoadObjectField(\n+            microtask, PromiseReactionJobTask::kPromiseOrCapabilityOffset);\n \n         // Run the promise before/debug hook if enabled.\n-        RunPromiseHook(Runtime::kPromiseHookBefore, microtask_context, payload);\n+        RunPromiseHook(Runtime::kPromiseHookBefore, microtask_context,\n+                       promise_or_capability);\n \n         Node* const result =\n             CallBuiltin(Builtins::kPromiseRejectReactionJob, microtask_context,\n-                        argument, handler, payload);\n+                        argument, handler, promise_or_capability);\n         GotoIfException(result, &if_exception, &var_exception);\n \n         // Run the promise after/debug hook if enabled.\n-        RunPromiseHook(Runtime::kPromiseHookAfter, microtask_context, payload);\n+        RunPromiseHook(Runtime::kPromiseHookAfter, microtask_context,\n+                       promise_or_capability);\n \n         LeaveMicrotaskContext();\n         SetCurrentContext(current_context);"
        },
        {
            "sha": "868b45a8316ff55230526f716c963464fa5a1899",
            "filename": "deps/v8/src/builtins/builtins-promise-gen.cc",
            "status": "modified",
            "additions": 54,
            "deletions": 71,
            "changes": 125,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-promise-gen.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-promise-gen.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-promise-gen.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -391,15 +391,15 @@ TF_BUILTIN(PerformPromiseThen, PromiseBuiltinsAssembler) {\n   Return(result_promise);\n }\n \n-Node* PromiseBuiltinsAssembler::AllocatePromiseReaction(Node* next,\n-                                                        Node* payload,\n-                                                        Node* fulfill_handler,\n-                                                        Node* reject_handler) {\n+Node* PromiseBuiltinsAssembler::AllocatePromiseReaction(\n+    Node* next, Node* promise_or_capability, Node* fulfill_handler,\n+    Node* reject_handler) {\n   Node* const reaction = Allocate(PromiseReaction::kSize);\n   StoreMapNoWriteBarrier(reaction, Heap::kPromiseReactionMapRootIndex);\n   StoreObjectFieldNoWriteBarrier(reaction, PromiseReaction::kNextOffset, next);\n-  StoreObjectFieldNoWriteBarrier(reaction, PromiseReaction::kPayloadOffset,\n-                                 payload);\n+  StoreObjectFieldNoWriteBarrier(reaction,\n+                                 PromiseReaction::kPromiseOrCapabilityOffset,\n+                                 promise_or_capability);\n   StoreObjectFieldNoWriteBarrier(\n       reaction, PromiseReaction::kFulfillHandlerOffset, fulfill_handler);\n   StoreObjectFieldNoWriteBarrier(\n@@ -408,7 +408,8 @@ Node* PromiseBuiltinsAssembler::AllocatePromiseReaction(Node* next,\n }\n \n Node* PromiseBuiltinsAssembler::AllocatePromiseReactionJobTask(\n-    Node* map, Node* context, Node* argument, Node* handler, Node* payload) {\n+    Node* map, Node* context, Node* argument, Node* handler,\n+    Node* promise_or_capability) {\n   Node* const microtask = Allocate(PromiseReactionJobTask::kSize);\n   StoreMapNoWriteBarrier(microtask, map);\n   StoreObjectFieldNoWriteBarrier(\n@@ -418,18 +419,19 @@ Node* PromiseBuiltinsAssembler::AllocatePromiseReactionJobTask(\n   StoreObjectFieldNoWriteBarrier(\n       microtask, PromiseReactionJobTask::kHandlerOffset, handler);\n   StoreObjectFieldNoWriteBarrier(\n-      microtask, PromiseReactionJobTask::kPayloadOffset, payload);\n+      microtask, PromiseReactionJobTask::kPromiseOrCapabilityOffset,\n+      promise_or_capability);\n   return microtask;\n }\n \n Node* PromiseBuiltinsAssembler::AllocatePromiseReactionJobTask(\n     Heap::RootListIndex map_root_index, Node* context, Node* argument,\n-    Node* handler, Node* payload) {\n+    Node* handler, Node* promise_or_capability) {\n   DCHECK(map_root_index == Heap::kPromiseFulfillReactionJobTaskMapRootIndex ||\n          map_root_index == Heap::kPromiseRejectReactionJobTaskMapRootIndex);\n   Node* const map = LoadRoot(map_root_index);\n   return AllocatePromiseReactionJobTask(map, context, argument, handler,\n-                                        payload);\n+                                        promise_or_capability);\n }\n \n Node* PromiseBuiltinsAssembler::AllocatePromiseResolveThenableJobTask(\n@@ -502,8 +504,8 @@ Node* PromiseBuiltinsAssembler::TriggerPromiseReactions(\n                          context);\n         STATIC_ASSERT(PromiseReaction::kFulfillHandlerOffset ==\n                       PromiseReactionJobTask::kHandlerOffset);\n-        STATIC_ASSERT(PromiseReaction::kPayloadOffset ==\n-                      PromiseReactionJobTask::kPayloadOffset);\n+        STATIC_ASSERT(PromiseReaction::kPromiseOrCapabilityOffset ==\n+                      PromiseReactionJobTask::kPromiseOrCapabilityOffset);\n       } else {\n         Node* handler =\n             LoadObjectField(current, PromiseReaction::kRejectHandlerOffset);\n@@ -515,8 +517,8 @@ Node* PromiseBuiltinsAssembler::TriggerPromiseReactions(\n                          context);\n         StoreObjectField(current, PromiseReactionJobTask::kHandlerOffset,\n                          handler);\n-        STATIC_ASSERT(PromiseReaction::kPayloadOffset ==\n-                      PromiseReactionJobTask::kPayloadOffset);\n+        STATIC_ASSERT(PromiseReaction::kPromiseOrCapabilityOffset ==\n+                      PromiseReactionJobTask::kPromiseOrCapabilityOffset);\n       }\n       CallBuiltin(Builtins::kEnqueueMicrotask, NoContextConstant(), current);\n       Goto(&loop);\n@@ -1118,28 +1120,20 @@ TF_BUILTIN(PromiseResolveThenableJob, PromiseBuiltinsAssembler) {\n \n // ES #sec-promisereactionjob\n void PromiseBuiltinsAssembler::PromiseReactionJob(Node* context, Node* argument,\n-                                                  Node* handler, Node* payload,\n+                                                  Node* handler,\n+                                                  Node* promise_or_capability,\n                                                   PromiseReaction::Type type) {\n   CSA_ASSERT(this, TaggedIsNotSmi(handler));\n-  CSA_ASSERT(this, Word32Or(IsCallable(handler),\n-                            Word32Or(IsCode(handler), IsUndefined(handler))));\n-  CSA_ASSERT(this, TaggedIsNotSmi(payload));\n+  CSA_ASSERT(this, Word32Or(IsUndefined(handler), IsCallable(handler)));\n+  CSA_ASSERT(this, TaggedIsNotSmi(promise_or_capability));\n+  CSA_ASSERT(this, Word32Or(IsJSPromise(promise_or_capability),\n+                            IsPromiseCapability(promise_or_capability)));\n \n   VARIABLE(var_handler_result, MachineRepresentation::kTagged, argument);\n-  Label if_handler_callable(this), if_fulfill(this), if_reject(this),\n-      if_code_handler(this);\n-\n-  GotoIf(IsUndefined(handler),\n-         type == PromiseReaction::kFulfill ? &if_fulfill : &if_reject);\n-  Branch(IsCode(handler), &if_code_handler, &if_handler_callable);\n-\n-  BIND(&if_code_handler);\n-  {\n-    // The {handler} is a Code object that knows how to deal with\n-    // the {payload} and the {argument}.\n-    PromiseReactionHandlerDescriptor descriptor(isolate());\n-    TailCallStub(descriptor, handler, context, argument, payload);\n-  }\n+  Label if_handler_callable(this), if_fulfill(this), if_reject(this);\n+  Branch(IsUndefined(handler),\n+         type == PromiseReaction::kFulfill ? &if_fulfill : &if_reject,\n+         &if_handler_callable);\n \n   BIND(&if_handler_callable);\n   {\n@@ -1155,22 +1149,24 @@ void PromiseBuiltinsAssembler::PromiseReactionJob(Node* context, Node* argument,\n   {\n     Label if_promise(this), if_promise_capability(this, Label::kDeferred);\n     Node* const value = var_handler_result.value();\n-    Branch(IsPromiseCapability(payload), &if_promise_capability, &if_promise);\n+    Branch(IsPromiseCapability(promise_or_capability), &if_promise_capability,\n+           &if_promise);\n \n     BIND(&if_promise);\n     {\n       // For fast native promises we can skip the indirection\n       // via the promiseCapability.[[Resolve]] function and\n       // run the resolve logic directly from here.\n-      TailCallBuiltin(Builtins::kResolvePromise, context, payload, value);\n+      TailCallBuiltin(Builtins::kResolvePromise, context, promise_or_capability,\n+                      value);\n     }\n \n     BIND(&if_promise_capability);\n     {\n       // In the general case we need to call the (user provided)\n       // promiseCapability.[[Resolve]] function.\n-      Node* const resolve =\n-          LoadObjectField(payload, PromiseCapability::kResolveOffset);\n+      Node* const resolve = LoadObjectField(promise_or_capability,\n+                                            PromiseCapability::kResolveOffset);\n       Node* const result = CallJS(\n           CodeFactory::Call(isolate(), ConvertReceiverMode::kNullOrUndefined),\n           context, resolve, UndefinedConstant(), value);\n@@ -1183,15 +1179,16 @@ void PromiseBuiltinsAssembler::PromiseReactionJob(Node* context, Node* argument,\n   if (type == PromiseReaction::kReject) {\n     Label if_promise(this), if_promise_capability(this, Label::kDeferred);\n     Node* const reason = var_handler_result.value();\n-    Branch(IsPromiseCapability(payload), &if_promise_capability, &if_promise);\n+    Branch(IsPromiseCapability(promise_or_capability), &if_promise_capability,\n+           &if_promise);\n \n     BIND(&if_promise);\n     {\n       // For fast native promises we can skip the indirection\n       // via the promiseCapability.[[Reject]] function and\n       // run the resolve logic directly from here.\n-      TailCallBuiltin(Builtins::kRejectPromise, context, payload, reason,\n-                      FalseConstant());\n+      TailCallBuiltin(Builtins::kRejectPromise, context, promise_or_capability,\n+                      reason, FalseConstant());\n     }\n \n     BIND(&if_promise_capability);\n@@ -1201,8 +1198,8 @@ void PromiseBuiltinsAssembler::PromiseReactionJob(Node* context, Node* argument,\n       Label if_exception(this, Label::kDeferred);\n       VARIABLE(var_exception, MachineRepresentation::kTagged,\n                TheHoleConstant());\n-      Node* const reject =\n-          LoadObjectField(payload, PromiseCapability::kRejectOffset);\n+      Node* const reject = LoadObjectField(promise_or_capability,\n+                                           PromiseCapability::kRejectOffset);\n       Node* const result = CallJS(\n           CodeFactory::Call(isolate(), ConvertReceiverMode::kNullOrUndefined),\n           context, reject, UndefinedConstant(), reason);\n@@ -1219,7 +1216,8 @@ void PromiseBuiltinsAssembler::PromiseReactionJob(Node* context, Node* argument,\n     // predictions in the debugger will be wrong, which just walks the stack\n     // and checks for certain builtins.\n     TailCallBuiltin(Builtins::kPromiseRejectReactionJob, context,\n-                    var_handler_result.value(), UndefinedConstant(), payload);\n+                    var_handler_result.value(), UndefinedConstant(),\n+                    promise_or_capability);\n   }\n }\n \n@@ -1228,9 +1226,10 @@ TF_BUILTIN(PromiseFulfillReactionJob, PromiseBuiltinsAssembler) {\n   Node* const context = Parameter(Descriptor::kContext);\n   Node* const value = Parameter(Descriptor::kValue);\n   Node* const handler = Parameter(Descriptor::kHandler);\n-  Node* const payload = Parameter(Descriptor::kPayload);\n+  Node* const promise_or_capability =\n+      Parameter(Descriptor::kPromiseOrCapability);\n \n-  PromiseReactionJob(context, value, handler, payload,\n+  PromiseReactionJob(context, value, handler, promise_or_capability,\n                      PromiseReaction::kFulfill);\n }\n \n@@ -1239,9 +1238,10 @@ TF_BUILTIN(PromiseRejectReactionJob, PromiseBuiltinsAssembler) {\n   Node* const context = Parameter(Descriptor::kContext);\n   Node* const reason = Parameter(Descriptor::kReason);\n   Node* const handler = Parameter(Descriptor::kHandler);\n-  Node* const payload = Parameter(Descriptor::kPayload);\n+  Node* const promise_or_capability =\n+      Parameter(Descriptor::kPromiseOrCapability);\n \n-  PromiseReactionJob(context, reason, handler, payload,\n+  PromiseReactionJob(context, reason, handler, promise_or_capability,\n                      PromiseReaction::kReject);\n }\n \n@@ -1717,23 +1717,21 @@ TF_BUILTIN(ResolvePromise, PromiseBuiltinsAssembler) {\n \n   // 7. If Type(resolution) is not Object, then\n   GotoIf(TaggedIsSmi(resolution), &if_fulfill);\n-  Node* const resolution_map = LoadMap(resolution);\n-  GotoIfNot(IsJSReceiverMap(resolution_map), &if_fulfill);\n+  Node* const result_map = LoadMap(resolution);\n+  GotoIfNot(IsJSReceiverMap(result_map), &if_fulfill);\n \n   // We can skip the \"then\" lookup on {resolution} if its [[Prototype]]\n   // is the (initial) Promise.prototype and the Promise#then protector\n   // is intact, as that guards the lookup path for the \"then\" property\n   // on JSPromise instances which have the (initial) %PromisePrototype%.\n-  Label if_fast(this), if_generic(this), if_slow(this, Label::kDeferred);\n+  Label if_fast(this), if_slow(this, Label::kDeferred);\n   Node* const native_context = LoadNativeContext(context);\n-  GotoIfForceSlowPath(&if_slow);\n-  GotoIf(IsPromiseThenProtectorCellInvalid(), &if_slow);\n-  GotoIfNot(IsJSPromiseMap(resolution_map), &if_generic);\n-  Node* const promise_prototype =\n-      LoadContextElement(native_context, Context::PROMISE_PROTOTYPE_INDEX);\n-  Branch(WordEqual(LoadMapPrototype(resolution_map), promise_prototype),\n-         &if_fast, &if_slow);\n+  BranchIfPromiseThenLookupChainIntact(native_context, result_map, &if_fast,\n+                                       &if_slow);\n \n+  // Resolution is a native promise and if it's already resolved or\n+  // rejected, shortcircuit the resolution procedure by directly\n+  // reusing the value from the promise.\n   BIND(&if_fast);\n   {\n     Node* const then =\n@@ -1742,21 +1740,6 @@ TF_BUILTIN(ResolvePromise, PromiseBuiltinsAssembler) {\n     Goto(&do_enqueue);\n   }\n \n-  BIND(&if_generic);\n-  {\n-    // We can skip the lookup of \"then\" if the {resolution} is a (newly\n-    // created) IterResultObject, as the Promise#then protector also\n-    // ensures that the intrinsic %ObjectPrototype% doesn't contain any\n-    // \"then\" property. This helps to avoid negative lookups on iterator\n-    // results from async generators.\n-    CSA_ASSERT(this, IsJSReceiverMap(resolution_map));\n-    CSA_ASSERT(this, Word32BinaryNot(IsPromiseThenProtectorCellInvalid()));\n-    Node* const iterator_result_map =\n-        LoadContextElement(native_context, Context::ITERATOR_RESULT_MAP_INDEX);\n-    Branch(WordEqual(resolution_map, iterator_result_map), &if_fulfill,\n-           &if_slow);\n-  }\n-\n   BIND(&if_slow);\n   {\n     // 8. Let then be Get(resolution, \"then\")."
        },
        {
            "sha": "694cea28c06b5adf9ae281cc30b4bdc359e46f80",
            "filename": "deps/v8/src/builtins/builtins-promise-gen.h",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-promise-gen.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-promise-gen.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins-promise-gen.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -85,14 +85,16 @@ class PromiseBuiltinsAssembler : public CodeStubAssembler {\n   Node* AllocateAndSetJSPromise(Node* context, v8::Promise::PromiseState status,\n                                 Node* result);\n \n-  Node* AllocatePromiseReaction(Node* next, Node* payload,\n+  Node* AllocatePromiseReaction(Node* next, Node* promise_or_capability,\n                                 Node* fulfill_handler, Node* reject_handler);\n \n   Node* AllocatePromiseReactionJobTask(Heap::RootListIndex map_root_index,\n                                        Node* context, Node* argument,\n-                                       Node* handler, Node* payload);\n+                                       Node* handler,\n+                                       Node* promise_or_capability);\n   Node* AllocatePromiseReactionJobTask(Node* map, Node* context, Node* argument,\n-                                       Node* handler, Node* payload);\n+                                       Node* handler,\n+                                       Node* promise_or_capability);\n   Node* AllocatePromiseResolveThenableJobTask(Node* promise_to_resolve,\n                                               Node* then, Node* thenable,\n                                               Node* context);\n@@ -192,7 +194,8 @@ class PromiseBuiltinsAssembler : public CodeStubAssembler {\n   Node* PromiseStatus(Node* promise);\n \n   void PromiseReactionJob(Node* context, Node* argument, Node* handler,\n-                          Node* payload, PromiseReaction::Type type);\n+                          Node* promise_or_capability,\n+                          PromiseReaction::Type type);\n \n   Node* IsPromiseStatus(Node* actual, v8::Promise::PromiseState expected);\n   void PromiseSetStatus(Node* promise, v8::Promise::PromiseState status);"
        },
        {
            "sha": "7e6a0459a7da9048a0f883577f5e7b69bbc9544a",
            "filename": "deps/v8/src/builtins/builtins.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 8,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fbuiltins%2Fbuiltins.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -364,17 +364,12 @@ bool Builtins::IsIsolateIndependent(int index) {\n     case kAsyncFromSyncIteratorPrototypeNext:\n     case kAsyncFromSyncIteratorPrototypeReturn:\n     case kAsyncFromSyncIteratorPrototypeThrow:\n-    case kAsyncFunctionAwaitFulfill:\n-    case kAsyncFunctionAwaitReject:\n+    case kAsyncFunctionAwaitCaught:\n     case kAsyncFunctionPromiseCreate:\n     case kAsyncFunctionPromiseRelease:\n-    case kAsyncGeneratorAwaitFulfill:\n-    case kAsyncGeneratorAwaitReject:\n     case kAsyncGeneratorResumeNext:\n-    case kAsyncGeneratorReturnClosedFulfill:\n-    case kAsyncGeneratorReturnClosedReject:\n-    case kAsyncGeneratorReturnFulfill:\n-    case kAsyncGeneratorYieldFulfill:\n+    case kAsyncGeneratorReturnClosedRejectClosure:\n+    case kAsyncGeneratorReturn:\n     case kAsyncIteratorValueUnwrap:\n     case kBitwiseNot:\n     case kBooleanPrototypeToString:"
        },
        {
            "sha": "d9742e47d9fd2f24e8b2d263b4ab12193527817b",
            "filename": "deps/v8/src/compiler/js-intrinsic-lowering.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 35,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fcompiler%2Fjs-intrinsic-lowering.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fcompiler%2Fjs-intrinsic-lowering.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fcompiler%2Fjs-intrinsic-lowering.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -41,14 +41,6 @@ Reduction JSIntrinsicLowering::Reduce(Node* node) {\n       return ReduceCreateJSGeneratorObject(node);\n     case Runtime::kInlineGeneratorGetInputOrDebugPos:\n       return ReduceGeneratorGetInputOrDebugPos(node);\n-    case Runtime::kInlineAsyncFunctionAwaitCaught:\n-      return ReduceAsyncFunctionAwaitCaught(node);\n-    case Runtime::kInlineAsyncFunctionAwaitUncaught:\n-      return ReduceAsyncFunctionAwaitUncaught(node);\n-    case Runtime::kInlineAsyncGeneratorAwaitCaught:\n-      return ReduceAsyncGeneratorAwaitCaught(node);\n-    case Runtime::kInlineAsyncGeneratorAwaitUncaught:\n-      return ReduceAsyncGeneratorAwaitUncaught(node);\n     case Runtime::kInlineAsyncGeneratorReject:\n       return ReduceAsyncGeneratorReject(node);\n     case Runtime::kInlineAsyncGeneratorResolve:\n@@ -185,33 +177,6 @@ Reduction JSIntrinsicLowering::ReduceGeneratorGetInputOrDebugPos(Node* node) {\n   return Change(node, op, generator, effect, control);\n }\n \n-Reduction JSIntrinsicLowering::ReduceAsyncFunctionAwaitCaught(Node* node) {\n-  return Change(\n-      node,\n-      Builtins::CallableFor(isolate(), Builtins::kAsyncFunctionAwaitCaught), 0);\n-}\n-\n-Reduction JSIntrinsicLowering::ReduceAsyncFunctionAwaitUncaught(Node* node) {\n-  return Change(\n-      node,\n-      Builtins::CallableFor(isolate(), Builtins::kAsyncFunctionAwaitUncaught),\n-      0);\n-}\n-\n-Reduction JSIntrinsicLowering::ReduceAsyncGeneratorAwaitCaught(Node* node) {\n-  return Change(\n-      node,\n-      Builtins::CallableFor(isolate(), Builtins::kAsyncGeneratorAwaitCaught),\n-      0);\n-}\n-\n-Reduction JSIntrinsicLowering::ReduceAsyncGeneratorAwaitUncaught(Node* node) {\n-  return Change(\n-      node,\n-      Builtins::CallableFor(isolate(), Builtins::kAsyncGeneratorAwaitUncaught),\n-      0);\n-}\n-\n Reduction JSIntrinsicLowering::ReduceAsyncGeneratorReject(Node* node) {\n   return Change(\n       node, Builtins::CallableFor(isolate(), Builtins::kAsyncGeneratorReject),"
        },
        {
            "sha": "18fe1248c7aa521c241c2c0b5471b7350c05598b",
            "filename": "deps/v8/src/compiler/js-intrinsic-lowering.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fcompiler%2Fjs-intrinsic-lowering.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fcompiler%2Fjs-intrinsic-lowering.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fcompiler%2Fjs-intrinsic-lowering.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -45,10 +45,6 @@ class V8_EXPORT_PRIVATE JSIntrinsicLowering final\n   Reduction ReduceCreateJSGeneratorObject(Node* node);\n   Reduction ReduceGeneratorClose(Node* node);\n   Reduction ReduceGeneratorGetInputOrDebugPos(Node* node);\n-  Reduction ReduceAsyncFunctionAwaitCaught(Node* node);\n-  Reduction ReduceAsyncFunctionAwaitUncaught(Node* node);\n-  Reduction ReduceAsyncGeneratorAwaitCaught(Node* node);\n-  Reduction ReduceAsyncGeneratorAwaitUncaught(Node* node);\n   Reduction ReduceAsyncGeneratorReject(Node* node);\n   Reduction ReduceAsyncGeneratorResolve(Node* node);\n   Reduction ReduceAsyncGeneratorYield(Node* node);"
        },
        {
            "sha": "fcfeccdc44e08f6cf3b24c620c9ee4220550e329",
            "filename": "deps/v8/src/contexts.h",
            "status": "modified",
            "additions": 54,
            "deletions": 31,
            "changes": 85,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fcontexts.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fcontexts.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fcontexts.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -32,37 +32,44 @@ enum ContextLookupFlags {\n // must always be allocated via Heap::AllocateContext() or\n // Factory::NewContext.\n \n-#define NATIVE_CONTEXT_INTRINSIC_FUNCTIONS(V)                           \\\n-  V(ASYNC_FUNCTION_PROMISE_CREATE_INDEX, JSFunction,                    \\\n-    async_function_promise_create)                                      \\\n-  V(ASYNC_FUNCTION_PROMISE_RELEASE_INDEX, JSFunction,                   \\\n-    async_function_promise_release)                                     \\\n-  V(IS_ARRAYLIKE, JSFunction, is_arraylike)                             \\\n-  V(GENERATOR_NEXT_INTERNAL, JSFunction, generator_next_internal)       \\\n-  V(MAKE_ERROR_INDEX, JSFunction, make_error)                           \\\n-  V(MAKE_RANGE_ERROR_INDEX, JSFunction, make_range_error)               \\\n-  V(MAKE_SYNTAX_ERROR_INDEX, JSFunction, make_syntax_error)             \\\n-  V(MAKE_TYPE_ERROR_INDEX, JSFunction, make_type_error)                 \\\n-  V(MAKE_URI_ERROR_INDEX, JSFunction, make_uri_error)                   \\\n-  V(OBJECT_CREATE, JSFunction, object_create)                           \\\n-  V(OBJECT_DEFINE_PROPERTIES, JSFunction, object_define_properties)     \\\n-  V(OBJECT_DEFINE_PROPERTY, JSFunction, object_define_property)         \\\n-  V(OBJECT_GET_PROTOTYPE_OF, JSFunction, object_get_prototype_of)       \\\n-  V(OBJECT_IS_EXTENSIBLE, JSFunction, object_is_extensible)             \\\n-  V(OBJECT_IS_FROZEN, JSFunction, object_is_frozen)                     \\\n-  V(OBJECT_IS_SEALED, JSFunction, object_is_sealed)                     \\\n-  V(OBJECT_KEYS, JSFunction, object_keys)                               \\\n-  V(REGEXP_INTERNAL_MATCH, JSFunction, regexp_internal_match)           \\\n-  V(REFLECT_APPLY_INDEX, JSFunction, reflect_apply)                     \\\n-  V(REFLECT_CONSTRUCT_INDEX, JSFunction, reflect_construct)             \\\n-  V(REFLECT_DEFINE_PROPERTY_INDEX, JSFunction, reflect_define_property) \\\n-  V(REFLECT_DELETE_PROPERTY_INDEX, JSFunction, reflect_delete_property) \\\n-  V(MATH_FLOOR_INDEX, JSFunction, math_floor)                           \\\n-  V(MATH_POW_INDEX, JSFunction, math_pow)                               \\\n-  V(PROMISE_INTERNAL_CONSTRUCTOR_INDEX, JSFunction,                     \\\n-    promise_internal_constructor)                                       \\\n-  V(IS_PROMISE_INDEX, JSFunction, is_promise)                           \\\n-  V(PROMISE_THEN_INDEX, JSFunction, promise_then)\n+#define NATIVE_CONTEXT_INTRINSIC_FUNCTIONS(V)                               \\\n+  V(ASYNC_FUNCTION_AWAIT_CAUGHT_INDEX, JSFunction,                          \\\n+    async_function_await_caught)                                            \\\n+  V(ASYNC_FUNCTION_AWAIT_UNCAUGHT_INDEX, JSFunction,                        \\\n+    async_function_await_uncaught)                                          \\\n+  V(ASYNC_FUNCTION_PROMISE_CREATE_INDEX, JSFunction,                        \\\n+    async_function_promise_create)                                          \\\n+  V(ASYNC_FUNCTION_PROMISE_RELEASE_INDEX, JSFunction,                       \\\n+    async_function_promise_release)                                         \\\n+  V(IS_ARRAYLIKE, JSFunction, is_arraylike)                                 \\\n+  V(GENERATOR_NEXT_INTERNAL, JSFunction, generator_next_internal)           \\\n+  V(MAKE_ERROR_INDEX, JSFunction, make_error)                               \\\n+  V(MAKE_RANGE_ERROR_INDEX, JSFunction, make_range_error)                   \\\n+  V(MAKE_SYNTAX_ERROR_INDEX, JSFunction, make_syntax_error)                 \\\n+  V(MAKE_TYPE_ERROR_INDEX, JSFunction, make_type_error)                     \\\n+  V(MAKE_URI_ERROR_INDEX, JSFunction, make_uri_error)                       \\\n+  V(OBJECT_CREATE, JSFunction, object_create)                               \\\n+  V(OBJECT_DEFINE_PROPERTIES, JSFunction, object_define_properties)         \\\n+  V(OBJECT_DEFINE_PROPERTY, JSFunction, object_define_property)             \\\n+  V(OBJECT_GET_PROTOTYPE_OF, JSFunction, object_get_prototype_of)           \\\n+  V(OBJECT_IS_EXTENSIBLE, JSFunction, object_is_extensible)                 \\\n+  V(OBJECT_IS_FROZEN, JSFunction, object_is_frozen)                         \\\n+  V(OBJECT_IS_SEALED, JSFunction, object_is_sealed)                         \\\n+  V(OBJECT_KEYS, JSFunction, object_keys)                                   \\\n+  V(REGEXP_INTERNAL_MATCH, JSFunction, regexp_internal_match)               \\\n+  V(REFLECT_APPLY_INDEX, JSFunction, reflect_apply)                         \\\n+  V(REFLECT_CONSTRUCT_INDEX, JSFunction, reflect_construct)                 \\\n+  V(REFLECT_DEFINE_PROPERTY_INDEX, JSFunction, reflect_define_property)     \\\n+  V(REFLECT_DELETE_PROPERTY_INDEX, JSFunction, reflect_delete_property)     \\\n+  V(MATH_FLOOR_INDEX, JSFunction, math_floor)                               \\\n+  V(MATH_POW_INDEX, JSFunction, math_pow)                                   \\\n+  V(NEW_PROMISE_CAPABILITY_INDEX, JSFunction, new_promise_capability)       \\\n+  V(PROMISE_INTERNAL_CONSTRUCTOR_INDEX, JSFunction,                         \\\n+    promise_internal_constructor)                                           \\\n+  V(IS_PROMISE_INDEX, JSFunction, is_promise)                               \\\n+  V(PROMISE_THEN_INDEX, JSFunction, promise_then)                           \\\n+  V(ASYNC_GENERATOR_AWAIT_CAUGHT, JSFunction, async_generator_await_caught) \\\n+  V(ASYNC_GENERATOR_AWAIT_UNCAUGHT, JSFunction, async_generator_await_uncaught)\n \n #define NATIVE_CONTEXT_IMPORTED_FIELDS(V)                                 \\\n   V(ARRAY_POP_INDEX, JSFunction, array_pop)                               \\\n@@ -116,11 +123,27 @@ enum ContextLookupFlags {\n   V(ARRAY_BUFFER_NOINIT_FUN_INDEX, JSFunction, array_buffer_noinit_fun)        \\\n   V(ARRAY_FUNCTION_INDEX, JSFunction, array_function)                          \\\n   V(ASYNC_FROM_SYNC_ITERATOR_MAP_INDEX, Map, async_from_sync_iterator_map)     \\\n+  V(ASYNC_FUNCTION_AWAIT_REJECT_SHARED_FUN, SharedFunctionInfo,                \\\n+    async_function_await_reject_shared_fun)                                    \\\n+  V(ASYNC_FUNCTION_AWAIT_RESOLVE_SHARED_FUN, SharedFunctionInfo,               \\\n+    async_function_await_resolve_shared_fun)                                   \\\n   V(ASYNC_FUNCTION_FUNCTION_INDEX, JSFunction, async_function_constructor)     \\\n   V(ASYNC_GENERATOR_FUNCTION_FUNCTION_INDEX, JSFunction,                       \\\n     async_generator_function_function)                                         \\\n   V(ASYNC_ITERATOR_VALUE_UNWRAP_SHARED_FUN, SharedFunctionInfo,                \\\n     async_iterator_value_unwrap_shared_fun)                                    \\\n+  V(ASYNC_GENERATOR_AWAIT_REJECT_SHARED_FUN, SharedFunctionInfo,               \\\n+    async_generator_await_reject_shared_fun)                                   \\\n+  V(ASYNC_GENERATOR_AWAIT_RESOLVE_SHARED_FUN, SharedFunctionInfo,              \\\n+    async_generator_await_resolve_shared_fun)                                  \\\n+  V(ASYNC_GENERATOR_YIELD_RESOLVE_SHARED_FUN, SharedFunctionInfo,              \\\n+    async_generator_yield_resolve_shared_fun)                                  \\\n+  V(ASYNC_GENERATOR_RETURN_RESOLVE_SHARED_FUN, SharedFunctionInfo,             \\\n+    async_generator_return_resolve_shared_fun)                                 \\\n+  V(ASYNC_GENERATOR_RETURN_CLOSED_RESOLVE_SHARED_FUN, SharedFunctionInfo,      \\\n+    async_generator_return_closed_resolve_shared_fun)                          \\\n+  V(ASYNC_GENERATOR_RETURN_CLOSED_REJECT_SHARED_FUN, SharedFunctionInfo,       \\\n+    async_generator_return_closed_reject_shared_fun)                           \\\n   V(ATOMICS_OBJECT, JSObject, atomics_object)                                  \\\n   V(BIGINT_FUNCTION_INDEX, JSFunction, bigint_function)                        \\\n   V(BIGINT64_ARRAY_FUN_INDEX, JSFunction, bigint64_array_fun)                  \\"
        },
        {
            "sha": "c15aa9ba1380dbf05048535ca7540834555614fc",
            "filename": "deps/v8/src/heap-symbols.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fheap-symbols.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fheap-symbols.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fheap-symbols.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -237,7 +237,6 @@\n   V(error_script_symbol)               \\\n   V(error_start_pos_symbol)            \\\n   V(frozen_symbol)                     \\\n-  V(generator_outer_promise_symbol)    \\\n   V(generic_symbol)                    \\\n   V(home_object_symbol)                \\\n   V(intl_initialized_marker_symbol)    \\"
        },
        {
            "sha": "8375ea11971ac462a65b168c7859b58469795328",
            "filename": "deps/v8/src/interface-descriptors.h",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Finterface-descriptors.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Finterface-descriptors.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finterface-descriptors.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -81,7 +81,6 @@ class PlatformInterfaceDescriptor;\n   V(FrameDropperTrampoline)           \\\n   V(WasmRuntimeCall)                  \\\n   V(RunMicrotasks)                    \\\n-  V(PromiseReactionHandler)           \\\n   BUILTIN_LIST_TFS(V)\n \n class V8_EXPORT_PRIVATE CallInterfaceDescriptorData {\n@@ -889,13 +888,6 @@ class RunMicrotasksDescriptor final : public CallInterfaceDescriptor {\n                              0)\n };\n \n-class PromiseReactionHandlerDescriptor final : public CallInterfaceDescriptor {\n- public:\n-  DEFINE_PARAMETERS(kArgument, kGenerator)\n-  DECLARE_DEFAULT_DESCRIPTOR(PromiseReactionHandlerDescriptor,\n-                             CallInterfaceDescriptor, 2)\n-};\n-\n #define DEFINE_TFS_BUILTIN_DESCRIPTOR(Name, ...)                          \\\n   class Name##Descriptor : public CallInterfaceDescriptor {               \\\n    public:                                                                \\"
        },
        {
            "sha": "744c6614f7a2ec35b8a35a888de2fa740542016f",
            "filename": "deps/v8/src/interpreter/bytecode-generator.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 8,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Finterpreter%2Fbytecode-generator.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Finterpreter%2Fbytecode-generator.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finterpreter%2Fbytecode-generator.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -3239,20 +3239,22 @@ void BytecodeGenerator::BuildAwait(Expression* await_expr) {\n     // Await(operand) and suspend.\n     RegisterAllocationScope register_scope(this);\n \n-    Runtime::FunctionId id;\n+    int await_builtin_context_index;\n     RegisterList args;\n     if (IsAsyncGeneratorFunction(function_kind())) {\n-      id = catch_prediction() == HandlerTable::ASYNC_AWAIT\n-               ? Runtime::kInlineAsyncGeneratorAwaitUncaught\n-               : Runtime::kInlineAsyncGeneratorAwaitCaught;\n+      await_builtin_context_index =\n+          catch_prediction() == HandlerTable::ASYNC_AWAIT\n+              ? Context::ASYNC_GENERATOR_AWAIT_UNCAUGHT\n+              : Context::ASYNC_GENERATOR_AWAIT_CAUGHT;\n       args = register_allocator()->NewRegisterList(2);\n       builder()\n           ->MoveRegister(generator_object(), args[0])\n           .StoreAccumulatorInRegister(args[1]);\n     } else {\n-      id = catch_prediction() == HandlerTable::ASYNC_AWAIT\n-               ? Runtime::kInlineAsyncFunctionAwaitUncaught\n-               : Runtime::kInlineAsyncFunctionAwaitCaught;\n+      await_builtin_context_index =\n+          catch_prediction() == HandlerTable::ASYNC_AWAIT\n+              ? Context::ASYNC_FUNCTION_AWAIT_UNCAUGHT_INDEX\n+              : Context::ASYNC_FUNCTION_AWAIT_CAUGHT_INDEX;\n       args = register_allocator()->NewRegisterList(3);\n       builder()\n           ->MoveRegister(generator_object(), args[0])\n@@ -3265,7 +3267,7 @@ void BytecodeGenerator::BuildAwait(Expression* await_expr) {\n       builder()->StoreAccumulatorInRegister(args[2]);\n     }\n \n-    builder()->CallRuntime(id, args);\n+    builder()->CallJSRuntime(await_builtin_context_index, args);\n   }\n \n   BuildSuspendPoint(await_expr);"
        },
        {
            "sha": "0480dec6cc65168b5d9479fa672cb14334bff4e1",
            "filename": "deps/v8/src/interpreter/interpreter-intrinsics-generator.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Finterpreter%2Finterpreter-intrinsics-generator.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Finterpreter%2Finterpreter-intrinsics-generator.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finterpreter%2Finterpreter-intrinsics-generator.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -402,30 +402,6 @@ Node* IntrinsicsGenerator::GetImportMetaObject(\n   return return_value.value();\n }\n \n-Node* IntrinsicsGenerator::AsyncFunctionAwaitCaught(\n-    const InterpreterAssembler::RegListNodePair& args, Node* context) {\n-  return IntrinsicAsBuiltinCall(args, context,\n-                                Builtins::kAsyncFunctionAwaitCaught);\n-}\n-\n-Node* IntrinsicsGenerator::AsyncFunctionAwaitUncaught(\n-    const InterpreterAssembler::RegListNodePair& args, Node* context) {\n-  return IntrinsicAsBuiltinCall(args, context,\n-                                Builtins::kAsyncFunctionAwaitUncaught);\n-}\n-\n-Node* IntrinsicsGenerator::AsyncGeneratorAwaitCaught(\n-    const InterpreterAssembler::RegListNodePair& args, Node* context) {\n-  return IntrinsicAsBuiltinCall(args, context,\n-                                Builtins::kAsyncGeneratorAwaitCaught);\n-}\n-\n-Node* IntrinsicsGenerator::AsyncGeneratorAwaitUncaught(\n-    const InterpreterAssembler::RegListNodePair& args, Node* context) {\n-  return IntrinsicAsBuiltinCall(args, context,\n-                                Builtins::kAsyncGeneratorAwaitUncaught);\n-}\n-\n Node* IntrinsicsGenerator::AsyncGeneratorReject(\n     const InterpreterAssembler::RegListNodePair& args, Node* context) {\n   return IntrinsicAsBuiltinCall(args, context, Builtins::kAsyncGeneratorReject);"
        },
        {
            "sha": "3016183c0b96d728a40f8622ee5f03e222f83e16",
            "filename": "deps/v8/src/interpreter/interpreter-intrinsics.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Finterpreter%2Finterpreter-intrinsics.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Finterpreter%2Finterpreter-intrinsics.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finterpreter%2Finterpreter-intrinsics.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -14,10 +14,6 @@ namespace interpreter {\n // List of supported intrisics, with upper case name, lower case name and\n // expected number of arguments (-1 denoting argument count is variable).\n #define INTRINSICS_LIST(V)                                            \\\n-  V(AsyncFunctionAwaitCaught, async_function_await_caught, 3)         \\\n-  V(AsyncFunctionAwaitUncaught, async_function_await_uncaught, 3)     \\\n-  V(AsyncGeneratorAwaitCaught, async_generator_await_caught, 2)       \\\n-  V(AsyncGeneratorAwaitUncaught, async_generator_await_uncaught, 2)   \\\n   V(AsyncGeneratorReject, async_generator_reject, 2)                  \\\n   V(AsyncGeneratorResolve, async_generator_resolve, 3)                \\\n   V(AsyncGeneratorYield, async_generator_yield, 3)                    \\"
        },
        {
            "sha": "2c4e22726d73015146ae1236e4266f27a03ecb77",
            "filename": "deps/v8/src/isolate.cc",
            "status": "modified",
            "additions": 21,
            "deletions": 20,
            "changes": 41,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fisolate.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fisolate.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fisolate.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -2048,7 +2048,6 @@ void Isolate::PopPromise() {\n }\n \n namespace {\n-\n bool InternalPromiseHasUserDefinedRejectHandler(Isolate* isolate,\n                                                 Handle<JSPromise> promise);\n \n@@ -2095,27 +2094,29 @@ bool InternalPromiseHasUserDefinedRejectHandler(Isolate* isolate,\n   }\n \n   if (promise->status() == Promise::kPending) {\n-    Handle<Object> current(promise->reactions(), isolate);\n-    while (!current->IsSmi()) {\n-      Handle<PromiseReaction> current_reaction =\n-          Handle<PromiseReaction>::cast(current);\n-      Handle<HeapObject> payload(current_reaction->payload(), isolate);\n-      Handle<JSPromise> current_promise;\n-      if (JSPromise::From(payload).ToHandle(&current_promise)) {\n-        if (current_reaction->reject_handler()->IsCallable()) {\n-          Handle<JSReceiver> current_handler(\n-              JSReceiver::cast(current_reaction->reject_handler()), isolate);\n-          if (PromiseHandlerCheck(isolate, current_handler, current_promise)) {\n-            return true;\n-          }\n-        } else {\n-          if (InternalPromiseHasUserDefinedRejectHandler(isolate,\n-                                                         current_promise)) {\n-            return true;\n-          }\n+    for (Handle<Object> current(promise->reactions(), isolate);\n+         !current->IsSmi();) {\n+      Handle<PromiseReaction> reaction = Handle<PromiseReaction>::cast(current);\n+      Handle<HeapObject> promise_or_capability(\n+          reaction->promise_or_capability(), isolate);\n+      Handle<JSPromise> promise = Handle<JSPromise>::cast(\n+          promise_or_capability->IsJSPromise()\n+              ? promise_or_capability\n+              : handle(Handle<PromiseCapability>::cast(promise_or_capability)\n+                           ->promise(),\n+                       isolate));\n+      if (reaction->reject_handler()->IsUndefined(isolate)) {\n+        if (InternalPromiseHasUserDefinedRejectHandler(isolate, promise)) {\n+          return true;\n+        }\n+      } else {\n+        Handle<JSReceiver> current_handler(\n+            JSReceiver::cast(reaction->reject_handler()), isolate);\n+        if (PromiseHandlerCheck(isolate, current_handler, promise)) {\n+          return true;\n         }\n       }\n-      current = handle(current_reaction->next(), isolate);\n+      current = handle(reaction->next(), isolate);\n     }\n   }\n "
        },
        {
            "sha": "82d33033737c36cff32d175ebd333ed6eb3bac80",
            "filename": "deps/v8/src/isolate.h",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fisolate.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fisolate.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fisolate.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -1096,10 +1096,7 @@ class Isolate {\n   bool IsPromiseResolveLookupChainIntact();\n \n   // Make sure a lookup of \"then\" on any JSPromise whose [[Prototype]] is the\n-  // initial %PromisePrototype% yields the initial method. In addition this\n-  // protector also guards the negative lookup of \"then\" on the intrinsic\n-  // %ObjectPrototype%, meaning that such lookups are guaranteed to yield\n-  // undefined without triggering any side-effects.\n+  // initial %PromisePrototype% yields the initial method.\n   bool IsPromiseThenLookupChainIntact();\n   bool IsPromiseThenLookupChainIntact(Handle<JSReceiver> receiver);\n "
        },
        {
            "sha": "a4cca33d6c3e8a7055c9ef478a8f9994ac9c82c7",
            "filename": "deps/v8/src/lookup.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Flookup.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Flookup.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Flookup.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -364,14 +364,7 @@ void LookupIterator::InternalUpdateProtector() {\n     if (!isolate_->IsPromiseThenLookupChainIntact()) return;\n     // Setting the \"then\" property on any JSPromise instance or on the\n     // initial %PromisePrototype% invalidates the Promise#then protector.\n-    // Also setting the \"then\" property on the initial %ObjectPrototype%\n-    // invalidates the Promise#then protector, since we use this protector\n-    // to guard the fast-path in AsyncGeneratorResolve, where we can skip\n-    // the ResolvePromise step and go directly to FulfillPromise if we\n-    // know that the Object.prototype doesn't contain a \"then\" method.\n     if (holder_->IsJSPromise() ||\n-        isolate_->IsInAnyContext(*holder_,\n-                                 Context::INITIAL_OBJECT_PROTOTYPE_INDEX) ||\n         isolate_->IsInAnyContext(*holder_, Context::PROMISE_PROTOTYPE_INDEX)) {\n       isolate_->InvalidatePromiseThenProtector();\n     }"
        },
        {
            "sha": "086078bb251dc4c0b9ea09d7e270101afa54b231",
            "filename": "deps/v8/src/objects-debug.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 18,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects-debug.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects-debug.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects-debug.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -1172,13 +1172,10 @@ void PromiseReactionJobTask::PromiseReactionJobTaskVerify() {\n   VerifyHeapPointer(context());\n   CHECK(context()->IsContext());\n   VerifyHeapPointer(handler());\n-  VerifyHeapPointer(payload());\n-  if (handler()->IsCode()) {\n-    CHECK(payload()->IsJSReceiver());\n-  } else {\n-    CHECK(handler()->IsUndefined(isolate) || handler()->IsCallable());\n-    CHECK(payload()->IsJSPromise() || payload()->IsPromiseCapability());\n-  }\n+  CHECK(handler()->IsUndefined(isolate) || handler()->IsCallable());\n+  VerifyHeapPointer(promise_or_capability());\n+  CHECK(promise_or_capability()->IsJSPromise() ||\n+        promise_or_capability()->IsPromiseCapability());\n }\n \n void PromiseFulfillReactionJobTask::PromiseFulfillReactionJobTaskVerify() {\n@@ -1220,18 +1217,14 @@ void PromiseReaction::PromiseReactionVerify() {\n   VerifyPointer(next());\n   CHECK(next()->IsSmi() || next()->IsPromiseReaction());\n   VerifyHeapPointer(reject_handler());\n+  CHECK(reject_handler()->IsUndefined(isolate) ||\n+        reject_handler()->IsCallable());\n   VerifyHeapPointer(fulfill_handler());\n-  VerifyHeapPointer(payload());\n-  if (reject_handler()->IsCode()) {\n-    CHECK(fulfill_handler()->IsCode());\n-    CHECK(payload()->IsJSReceiver());\n-  } else {\n-    CHECK(reject_handler()->IsUndefined(isolate) ||\n-          reject_handler()->IsCallable());\n-    CHECK(fulfill_handler()->IsUndefined(isolate) ||\n-          fulfill_handler()->IsCallable());\n-    CHECK(payload()->IsJSPromise() || payload()->IsPromiseCapability());\n-  }\n+  CHECK(fulfill_handler()->IsUndefined(isolate) ||\n+        fulfill_handler()->IsCallable());\n+  VerifyHeapPointer(promise_or_capability());\n+  CHECK(promise_or_capability()->IsJSPromise() ||\n+        promise_or_capability()->IsPromiseCapability());\n }\n \n void JSPromise::JSPromiseVerify() {"
        },
        {
            "sha": "297e9fc836d49096f301f78692f94eef4788578d",
            "filename": "deps/v8/src/objects-inl.h",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects-inl.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -2278,7 +2278,7 @@ ACCESSORS(JSGlobalProxy, native_context, Object, kNativeContextOffset)\n ACCESSORS(AccessorInfo, name, Name, kNameOffset)\n SMI_ACCESSORS(AccessorInfo, flags, kFlagsOffset)\n ACCESSORS(AccessorInfo, expected_receiver_type, Object,\n-          kExpectedReceiverTypeOffset)\n+           kExpectedReceiverTypeOffset)\n \n ACCESSORS_CHECKED2(AccessorInfo, getter, Object, kGetterOffset, true,\n                    Foreign::IsNormalized(value))"
        },
        {
            "sha": "8d20279b2f1f20b7ecae982cdd8350d57219fd8a",
            "filename": "deps/v8/src/objects-printer.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects-printer.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects-printer.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects-printer.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -1441,7 +1441,7 @@ void PromiseFulfillReactionJobTask::PromiseFulfillReactionJobTaskPrint(\n   os << \"\\n - argument: \" << Brief(argument());\n   os << \"\\n - context: \" << Brief(context());\n   os << \"\\n - handler: \" << Brief(handler());\n-  os << \"\\n - payload: \" << Brief(payload());\n+  os << \"\\n - promise_or_capability: \" << Brief(promise_or_capability());\n   os << \"\\n\";\n }\n \n@@ -1451,7 +1451,7 @@ void PromiseRejectReactionJobTask::PromiseRejectReactionJobTaskPrint(\n   os << \"\\n - argument: \" << Brief(argument());\n   os << \"\\n - context: \" << Brief(context());\n   os << \"\\n - handler: \" << Brief(handler());\n-  os << \"\\n - payload: \" << Brief(payload());\n+  os << \"\\n - promise_or_capability: \" << Brief(promise_or_capability());\n   os << \"\\n\";\n }\n \n@@ -1478,7 +1478,7 @@ void PromiseReaction::PromiseReactionPrint(std::ostream& os) {  // NOLINT\n   os << \"\\n - next: \" << Brief(next());\n   os << \"\\n - reject_handler: \" << Brief(reject_handler());\n   os << \"\\n - fulfill_handler: \" << Brief(fulfill_handler());\n-  os << \"\\n - payload: \" << Brief(payload());\n+  os << \"\\n - promise_or_capability: \" << Brief(promise_or_capability());\n   os << \"\\n\";\n }\n "
        },
        {
            "sha": "6565910fd3faea87e41a9a3872771eb713a4e295",
            "filename": "deps/v8/src/objects.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 25,
            "changes": 29,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -16054,27 +16054,6 @@ MaybeHandle<Object> JSPromise::Resolve(Handle<JSPromise> promise,\n   return isolate->factory()->undefined_value();\n }\n \n-// static\n-MaybeHandle<JSPromise> JSPromise::From(Handle<HeapObject> object) {\n-  Isolate* const isolate = object->GetIsolate();\n-  if (object->IsJSPromise()) {\n-    return Handle<JSPromise>::cast(object);\n-  } else if (object->IsPromiseCapability()) {\n-    Handle<PromiseCapability> capability =\n-        Handle<PromiseCapability>::cast(object);\n-    if (capability->promise()->IsJSPromise()) {\n-      return handle(JSPromise::cast(capability->promise()), isolate);\n-    }\n-  } else if (object->IsJSGeneratorObject()) {\n-    Handle<JSGeneratorObject> generator =\n-        Handle<JSGeneratorObject>::cast(object);\n-    Handle<Object> handled_by = JSObject::GetDataProperty(\n-        generator, isolate->factory()->generator_outer_promise_symbol());\n-    if (handled_by->IsJSPromise()) return Handle<JSPromise>::cast(handled_by);\n-  }\n-  return MaybeHandle<JSPromise>();\n-}\n-\n // static\n Handle<Object> JSPromise::TriggerPromiseReactions(Isolate* isolate,\n                                                   Handle<Object> reactions,\n@@ -16114,8 +16093,8 @@ Handle<Object> JSPromise::TriggerPromiseReactions(Isolate* isolate,\n           *isolate->native_context());\n       STATIC_ASSERT(PromiseReaction::kFulfillHandlerOffset ==\n                     PromiseFulfillReactionJobTask::kHandlerOffset);\n-      STATIC_ASSERT(PromiseReaction::kPayloadOffset ==\n-                    PromiseFulfillReactionJobTask::kPayloadOffset);\n+      STATIC_ASSERT(PromiseReaction::kPromiseOrCapabilityOffset ==\n+                    PromiseFulfillReactionJobTask::kPromiseOrCapabilityOffset);\n     } else {\n       DisallowHeapAllocation no_gc;\n       HeapObject* handler = reaction->reject_handler();\n@@ -16125,8 +16104,8 @@ Handle<Object> JSPromise::TriggerPromiseReactions(Isolate* isolate,\n       Handle<PromiseRejectReactionJobTask>::cast(task)->set_context(\n           *isolate->native_context());\n       Handle<PromiseRejectReactionJobTask>::cast(task)->set_handler(handler);\n-      STATIC_ASSERT(PromiseReaction::kPayloadOffset ==\n-                    PromiseRejectReactionJobTask::kPayloadOffset);\n+      STATIC_ASSERT(PromiseReaction::kPromiseOrCapabilityOffset ==\n+                    PromiseRejectReactionJobTask::kPromiseOrCapabilityOffset);\n     }\n \n     isolate->EnqueueMicrotask(Handle<PromiseReactionJobTask>::cast(task));"
        },
        {
            "sha": "434bae893380d5e17aa90c5979e23908d00890b3",
            "filename": "deps/v8/src/objects/js-promise.h",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects%2Fjs-promise.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects%2Fjs-promise.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects%2Fjs-promise.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -59,12 +59,6 @@ class JSPromise : public JSObject {\n   V8_WARN_UNUSED_RESULT static MaybeHandle<Object> Resolve(\n       Handle<JSPromise> promise, Handle<Object> resolution);\n \n-  // This is a helper that extracts the JSPromise from the input\n-  // {object}, which is used as a payload for PromiseReaction and\n-  // PromiseReactionJobTask.\n-  V8_WARN_UNUSED_RESULT static MaybeHandle<JSPromise> From(\n-      Handle<HeapObject> object);\n-\n   DECL_CAST(JSPromise)\n \n   // Dispatched behavior."
        },
        {
            "sha": "f9fb6110f346c19161385a292e39d58b9d91985b",
            "filename": "deps/v8/src/objects/promise-inl.h",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects%2Fpromise-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects%2Fpromise-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects%2Fpromise-inl.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -23,7 +23,8 @@ CAST_ACCESSOR(PromiseResolveThenableJobTask)\n ACCESSORS(PromiseReaction, next, Object, kNextOffset)\n ACCESSORS(PromiseReaction, reject_handler, HeapObject, kRejectHandlerOffset)\n ACCESSORS(PromiseReaction, fulfill_handler, HeapObject, kFulfillHandlerOffset)\n-ACCESSORS(PromiseReaction, payload, HeapObject, kPayloadOffset)\n+ACCESSORS(PromiseReaction, promise_or_capability, HeapObject,\n+          kPromiseOrCapabilityOffset)\n \n ACCESSORS(PromiseResolveThenableJobTask, context, Context, kContextOffset)\n ACCESSORS(PromiseResolveThenableJobTask, promise_to_resolve, JSPromise,\n@@ -34,7 +35,8 @@ ACCESSORS(PromiseResolveThenableJobTask, thenable, JSReceiver, kThenableOffset)\n ACCESSORS(PromiseReactionJobTask, context, Context, kContextOffset)\n ACCESSORS(PromiseReactionJobTask, argument, Object, kArgumentOffset);\n ACCESSORS(PromiseReactionJobTask, handler, HeapObject, kHandlerOffset);\n-ACCESSORS(PromiseReactionJobTask, payload, HeapObject, kPayloadOffset);\n+ACCESSORS(PromiseReactionJobTask, promise_or_capability, HeapObject,\n+          kPromiseOrCapabilityOffset);\n \n ACCESSORS(PromiseCapability, promise, HeapObject, kPromiseOffset)\n ACCESSORS(PromiseCapability, resolve, Object, kResolveOffset)"
        },
        {
            "sha": "5ff5dac6f372eacc7fea577a3e0fd127052f5432",
            "filename": "deps/v8/src/objects/promise.h",
            "status": "modified",
            "additions": 11,
            "deletions": 15,
            "changes": 26,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects%2Fpromise.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fobjects%2Fpromise.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fobjects%2Fpromise.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -26,16 +26,15 @@ class PromiseReactionJobTask : public Microtask {\n  public:\n   DECL_ACCESSORS(argument, Object)\n   DECL_ACCESSORS(context, Context)\n-  // [handler]: This is either a Code object, a Callable or Undefined.\n   DECL_ACCESSORS(handler, HeapObject)\n-  // [payload]: Usually a JSPromise or a PromiseCapability.\n-  DECL_ACCESSORS(payload, HeapObject)\n+  // [promise_or_capability]: Either a JSPromise or a PromiseCapability.\n+  DECL_ACCESSORS(promise_or_capability, HeapObject)\n \n   static const int kArgumentOffset = Microtask::kHeaderSize;\n   static const int kContextOffset = kArgumentOffset + kPointerSize;\n   static const int kHandlerOffset = kContextOffset + kPointerSize;\n-  static const int kPayloadOffset = kHandlerOffset + kPointerSize;\n-  static const int kSize = kPayloadOffset + kPointerSize;\n+  static const int kPromiseOrCapabilityOffset = kHandlerOffset + kPointerSize;\n+  static const int kSize = kPromiseOrCapabilityOffset + kPointerSize;\n \n   // Dispatched behavior.\n   DECL_CAST(PromiseReactionJobTask)\n@@ -121,10 +120,9 @@ class PromiseCapability : public Struct {\n // of microtasks. So the size of PromiseReaction and the size of the\n // PromiseReactionJobTask has to be same for this to work.\n //\n-// The PromiseReaction::payload field usually holds a JSPromise\n-// instance (in the fast case of a native promise) or a PromiseCapability\n-// in case of a custom promise. For await we store the JSGeneratorObject\n-// here and use custom Code handlers.\n+// The PromiseReaction::promise_or_capability field can either hold a JSPromise\n+// instance (in the fast case of a native promise) or a PromiseCapability in\n+// case of a Promise subclass.\n //\n // We need to keep the context in the PromiseReaction so that we can run\n // the default handlers (in case they are undefined) in the proper context.\n@@ -138,18 +136,16 @@ class PromiseReaction : public Struct {\n   enum Type { kFulfill, kReject };\n \n   DECL_ACCESSORS(next, Object)\n-  // [reject_handler]: This is either a Code object, a Callable or Undefined.\n   DECL_ACCESSORS(reject_handler, HeapObject)\n-  // [fulfill_handler]: This is either a Code object, a Callable or Undefined.\n   DECL_ACCESSORS(fulfill_handler, HeapObject)\n-  // [payload]: Usually a JSPromise or a PromiseCapability.\n-  DECL_ACCESSORS(payload, HeapObject)\n+  DECL_ACCESSORS(promise_or_capability, HeapObject)\n \n   static const int kNextOffset = Struct::kHeaderSize;\n   static const int kRejectHandlerOffset = kNextOffset + kPointerSize;\n   static const int kFulfillHandlerOffset = kRejectHandlerOffset + kPointerSize;\n-  static const int kPayloadOffset = kFulfillHandlerOffset + kPointerSize;\n-  static const int kSize = kPayloadOffset + kPointerSize;\n+  static const int kPromiseOrCapabilityOffset =\n+      kFulfillHandlerOffset + kPointerSize;\n+  static const int kSize = kPromiseOrCapabilityOffset + kPointerSize;\n \n   // Dispatched behavior.\n   DECL_CAST(PromiseReaction)"
        },
        {
            "sha": "3c7c808c30b66a8939077ba8dd0dd8da469b4fbb",
            "filename": "deps/v8/src/runtime/runtime-generator.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime-generator.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime-generator.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime-generator.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -70,30 +70,6 @@ RUNTIME_FUNCTION(Runtime_GeneratorGetInputOrDebugPos) {\n   UNREACHABLE();\n }\n \n-RUNTIME_FUNCTION(Runtime_AsyncFunctionAwaitCaught) {\n-  // Runtime call is implemented in InterpreterIntrinsics and lowered in\n-  // JSIntrinsicLowering\n-  UNREACHABLE();\n-}\n-\n-RUNTIME_FUNCTION(Runtime_AsyncFunctionAwaitUncaught) {\n-  // Runtime call is implemented in InterpreterIntrinsics and lowered in\n-  // JSIntrinsicLowering\n-  UNREACHABLE();\n-}\n-\n-RUNTIME_FUNCTION(Runtime_AsyncGeneratorAwaitCaught) {\n-  // Runtime call is implemented in InterpreterIntrinsics and lowered in\n-  // JSIntrinsicLowering\n-  UNREACHABLE();\n-}\n-\n-RUNTIME_FUNCTION(Runtime_AsyncGeneratorAwaitUncaught) {\n-  // Runtime call is implemented in InterpreterIntrinsics and lowered in\n-  // JSIntrinsicLowering\n-  UNREACHABLE();\n-}\n-\n RUNTIME_FUNCTION(Runtime_AsyncGeneratorResolve) {\n   // Runtime call is implemented in InterpreterIntrinsics and lowered in\n   // JSIntrinsicLowering"
        },
        {
            "sha": "f5b9db3c028b0ead9d067712856d1acd18e0c664",
            "filename": "deps/v8/src/runtime/runtime-promise.cc",
            "status": "modified",
            "additions": 14,
            "deletions": 16,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime-promise.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime-promise.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime-promise.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -114,29 +114,27 @@ RUNTIME_FUNCTION(Runtime_PromiseHookInit) {\n RUNTIME_FUNCTION(Runtime_PromiseHookBefore) {\n   HandleScope scope(isolate);\n   DCHECK_EQ(1, args.length());\n-  CONVERT_ARG_HANDLE_CHECKED(HeapObject, payload, 0);\n-  Handle<JSPromise> promise;\n-  if (JSPromise::From(payload).ToHandle(&promise)) {\n-    if (isolate->debug()->is_active()) isolate->PushPromise(promise);\n-    if (promise->IsJSPromise()) {\n-      isolate->RunPromiseHook(PromiseHookType::kBefore, promise,\n-                              isolate->factory()->undefined_value());\n-    }\n+  CONVERT_ARG_HANDLE_CHECKED(JSReceiver, maybe_promise, 0);\n+  if (!maybe_promise->IsJSPromise()) return isolate->heap()->undefined_value();\n+  Handle<JSPromise> promise = Handle<JSPromise>::cast(maybe_promise);\n+  if (isolate->debug()->is_active()) isolate->PushPromise(promise);\n+  if (promise->IsJSPromise()) {\n+    isolate->RunPromiseHook(PromiseHookType::kBefore, promise,\n+                            isolate->factory()->undefined_value());\n   }\n   return isolate->heap()->undefined_value();\n }\n \n RUNTIME_FUNCTION(Runtime_PromiseHookAfter) {\n   HandleScope scope(isolate);\n   DCHECK_EQ(1, args.length());\n-  CONVERT_ARG_HANDLE_CHECKED(HeapObject, payload, 0);\n-  Handle<JSPromise> promise;\n-  if (JSPromise::From(payload).ToHandle(&promise)) {\n-    if (isolate->debug()->is_active()) isolate->PopPromise();\n-    if (promise->IsJSPromise()) {\n-      isolate->RunPromiseHook(PromiseHookType::kAfter, promise,\n-                              isolate->factory()->undefined_value());\n-    }\n+  CONVERT_ARG_HANDLE_CHECKED(JSReceiver, maybe_promise, 0);\n+  if (!maybe_promise->IsJSPromise()) return isolate->heap()->undefined_value();\n+  Handle<JSPromise> promise = Handle<JSPromise>::cast(maybe_promise);\n+  if (isolate->debug()->is_active()) isolate->PopPromise();\n+  if (promise->IsJSPromise()) {\n+    isolate->RunPromiseHook(PromiseHookType::kAfter, promise,\n+                            isolate->factory()->undefined_value());\n   }\n   return isolate->heap()->undefined_value();\n }"
        },
        {
            "sha": "37ce74e8250f2c34242591736a3586795a751eb9",
            "filename": "deps/v8/src/runtime/runtime.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime.h",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fruntime%2Fruntime.h?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -222,10 +222,6 @@ namespace internal {\n   F(SetNativeFlag, 1, 1)\n \n #define FOR_EACH_INTRINSIC_GENERATOR(F)       \\\n-  F(AsyncFunctionAwaitCaught, 3, 1)           \\\n-  F(AsyncFunctionAwaitUncaught, 3, 1)         \\\n-  F(AsyncGeneratorAwaitCaught, 2, 1)          \\\n-  F(AsyncGeneratorAwaitUncaught, 2, 1)        \\\n   F(AsyncGeneratorHasCatchHandlerForPC, 1, 1) \\\n   F(AsyncGeneratorReject, 2, 1)               \\\n   F(AsyncGeneratorResolve, 3, 1)              \\"
        },
        {
            "sha": "2b4eb6b2cc5674f66aee7eedd96a846c391da1f0",
            "filename": "deps/v8/test/cctest/interpreter/bytecode_expectations/AsyncGenerators.golden",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FAsyncGenerators.golden",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FAsyncGenerators.golden",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FAsyncGenerators.golden?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -39,7 +39,7 @@ bytecodes: [\n                 B(LdaUndefined),\n                 B(Star), R(6),\n                 B(Mov), R(0), R(5),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncGeneratorAwaitUncaught), R(5), U8(2),\n+                B(CallJSRuntime), U8(%async_generator_await_uncaught), R(5), U8(2),\n                 B(SuspendGenerator), R(0), R(0), U8(5), U8(1),\n                 B(ResumeGenerator), R(0), R(0), U8(5),\n                 B(Star), R(5),\n@@ -166,7 +166,7 @@ bytecodes: [\n                 B(LdaUndefined),\n                 B(Star), R(6),\n                 B(Mov), R(0), R(5),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncGeneratorAwaitUncaught), R(5), U8(2),\n+                B(CallJSRuntime), U8(%async_generator_await_uncaught), R(5), U8(2),\n                 B(SuspendGenerator), R(0), R(0), U8(5), U8(2),\n                 B(ResumeGenerator), R(0), R(0), U8(5),\n                 B(Star), R(5),\n@@ -404,7 +404,7 @@ bytecodes: [\n                 B(LdaUndefined),\n                 B(Star), R(16),\n                 B(Mov), R(2), R(15),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncGeneratorAwaitUncaught), R(15), U8(2),\n+                B(CallJSRuntime), U8(%async_generator_await_uncaught), R(15), U8(2),\n                 B(SuspendGenerator), R(2), R(0), U8(15), U8(2),\n                 B(ResumeGenerator), R(2), R(0), U8(15),\n                 B(Star), R(15),\n@@ -580,7 +580,7 @@ bytecodes: [\n                 B(Jump), U8(2),\n                 B(Star), R(13),\n                 B(Mov), R(0), R(12),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncGeneratorAwaitUncaught), R(12), U8(2),\n+                B(CallJSRuntime), U8(%async_generator_await_uncaught), R(12), U8(2),\n   /*   49 E> */ B(SuspendGenerator), R(0), R(0), U8(12), U8(1),\n                 B(ResumeGenerator), R(0), R(0), U8(12),\n                 B(Star), R(12),\n@@ -598,7 +598,7 @@ bytecodes: [\n                 B(CallRuntime), U16(Runtime::kThrowThrowMethodMissing), R(0), U8(0),\n                 B(Star), R(13),\n                 B(Mov), R(0), R(12),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncGeneratorAwaitUncaught), R(12), U8(2),\n+                B(CallJSRuntime), U8(%async_generator_await_uncaught), R(12), U8(2),\n   /*   49 E> */ B(SuspendGenerator), R(0), R(0), U8(12), U8(2),\n                 B(ResumeGenerator), R(0), R(0), U8(12),\n                 B(Star), R(12),\n@@ -639,7 +639,7 @@ bytecodes: [\n                 B(LdaUndefined),\n                 B(Star), R(6),\n                 B(Mov), R(0), R(5),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncGeneratorAwaitUncaught), R(5), U8(2),\n+                B(CallJSRuntime), U8(%async_generator_await_uncaught), R(5), U8(2),\n                 B(SuspendGenerator), R(0), R(0), U8(5), U8(4),\n                 B(ResumeGenerator), R(0), R(0), U8(5),\n                 B(Star), R(5),"
        },
        {
            "sha": "4d36315f0279882dbe0dbd8c5683b742e8be788d",
            "filename": "deps/v8/test/cctest/interpreter/bytecode_expectations/ForAwaitOf.golden",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FForAwaitOf.golden",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FForAwaitOf.golden",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FForAwaitOf.golden?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -53,7 +53,7 @@ bytecodes: [\n                 B(Star), R(21),\n                 B(Mov), R(2), R(20),\n                 B(Mov), R(11), R(22),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitUncaught), R(20), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_uncaught), R(20), U8(3),\n   /*   40 E> */ B(SuspendGenerator), R(2), R(0), U8(20), U8(0),\n                 B(ResumeGenerator), R(2), R(0), U8(20),\n                 B(Star), R(20),\n@@ -137,7 +137,7 @@ bytecodes: [\n                 B(Star), R(21),\n                 B(Mov), R(2), R(20),\n                 B(Mov), R(11), R(22),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitCaught), R(20), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_caught), R(20), U8(3),\n                 B(SuspendGenerator), R(2), R(0), U8(20), U8(1),\n                 B(ResumeGenerator), R(2), R(0), U8(20),\n                 B(Star), R(20),\n@@ -160,7 +160,7 @@ bytecodes: [\n                 B(Star), R(20),\n                 B(Mov), R(2), R(19),\n                 B(Mov), R(11), R(21),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitUncaught), R(19), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_uncaught), R(19), U8(3),\n                 B(SuspendGenerator), R(2), R(0), U8(19), U8(2),\n                 B(ResumeGenerator), R(2), R(0), U8(19),\n                 B(Star), R(19),\n@@ -306,7 +306,7 @@ bytecodes: [\n                 B(Star), R(21),\n                 B(Mov), R(2), R(20),\n                 B(Mov), R(11), R(22),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitUncaught), R(20), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_uncaught), R(20), U8(3),\n   /*   40 E> */ B(SuspendGenerator), R(2), R(0), U8(20), U8(0),\n                 B(ResumeGenerator), R(2), R(0), U8(20),\n                 B(Star), R(20),\n@@ -391,7 +391,7 @@ bytecodes: [\n                 B(Star), R(21),\n                 B(Mov), R(2), R(20),\n                 B(Mov), R(11), R(22),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitCaught), R(20), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_caught), R(20), U8(3),\n                 B(SuspendGenerator), R(2), R(0), U8(20), U8(1),\n                 B(ResumeGenerator), R(2), R(0), U8(20),\n                 B(Star), R(20),\n@@ -414,7 +414,7 @@ bytecodes: [\n                 B(Star), R(20),\n                 B(Mov), R(2), R(19),\n                 B(Mov), R(11), R(21),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitUncaught), R(19), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_uncaught), R(19), U8(3),\n                 B(SuspendGenerator), R(2), R(0), U8(19), U8(2),\n                 B(ResumeGenerator), R(2), R(0), U8(19),\n                 B(Star), R(19),\n@@ -575,7 +575,7 @@ bytecodes: [\n                 B(Star), R(21),\n                 B(Mov), R(2), R(20),\n                 B(Mov), R(11), R(22),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitUncaught), R(20), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_uncaught), R(20), U8(3),\n   /*   40 E> */ B(SuspendGenerator), R(2), R(0), U8(20), U8(0),\n                 B(ResumeGenerator), R(2), R(0), U8(20),\n                 B(Star), R(20),\n@@ -667,7 +667,7 @@ bytecodes: [\n                 B(Star), R(21),\n                 B(Mov), R(2), R(20),\n                 B(Mov), R(11), R(22),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitCaught), R(20), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_caught), R(20), U8(3),\n                 B(SuspendGenerator), R(2), R(0), U8(20), U8(1),\n                 B(ResumeGenerator), R(2), R(0), U8(20),\n                 B(Star), R(20),\n@@ -690,7 +690,7 @@ bytecodes: [\n                 B(Star), R(20),\n                 B(Mov), R(2), R(19),\n                 B(Mov), R(11), R(21),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitUncaught), R(19), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_uncaught), R(19), U8(3),\n                 B(SuspendGenerator), R(2), R(0), U8(19), U8(2),\n                 B(ResumeGenerator), R(2), R(0), U8(19),\n                 B(Star), R(19),"
        },
        {
            "sha": "f92076e6e65ebe79fe8cf148575a99a0887fe73a",
            "filename": "deps/v8/test/cctest/interpreter/bytecode_expectations/ForOfLoop.golden",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FForOfLoop.golden",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FForOfLoop.golden",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FForOfLoop.golden?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -1196,7 +1196,7 @@ bytecodes: [\n   /*   45 S> */ B(Mov), R(2), R(21),\n                 B(Mov), R(0), R(22),\n                 B(Mov), R(11), R(23),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitUncaught), R(21), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_uncaught), R(21), U8(3),\n   /*   45 E> */ B(SuspendGenerator), R(2), R(0), U8(21), U8(0),\n                 B(ResumeGenerator), R(2), R(0), U8(21),\n                 B(Star), R(21),"
        },
        {
            "sha": "7edf446ce33d53a87d38c9c0dcc1fe6310a598e2",
            "filename": "deps/v8/test/cctest/interpreter/bytecode_expectations/StandardForLoop.golden",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FStandardForLoop.golden",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FStandardForLoop.golden",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Finterpreter%2Fbytecode_expectations%2FStandardForLoop.golden?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -493,7 +493,7 @@ bytecodes: [\n   /*   52 S> */ B(Mov), R(1), R(7),\n                 B(Mov), R(0), R(8),\n                 B(Mov), R(2), R(9),\n-                B(InvokeIntrinsic), U8(Runtime::k_AsyncFunctionAwaitUncaught), R(7), U8(3),\n+                B(CallJSRuntime), U8(%async_function_await_uncaught), R(7), U8(3),\n   /*   52 E> */ B(SuspendGenerator), R(1), R(0), U8(7), U8(0),\n                 B(ResumeGenerator), R(1), R(0), U8(7),\n                 B(Star), R(7),"
        },
        {
            "sha": "8b93944d93363fc06823fec9b73bdd64eb86cc55",
            "filename": "deps/v8/test/cctest/test-api.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Ftest-api.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftest%2Fcctest%2Ftest-api.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftest%2Fcctest%2Ftest-api.cc?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -18358,12 +18358,6 @@ TEST(PromiseHook) {\n   CHECK_EQ(v8::Promise::kFulfilled, GetPromise(\"p\")->State());\n   CHECK_EQ(9, promise_hook_data->promise_hook_count);\n \n-  promise_hook_data->Reset();\n-  source = \"(async() => await p)();\\n\";\n-\n-  CompileRun(source);\n-  CHECK_EQ(11, promise_hook_data->promise_hook_count);\n-\n   delete promise_hook_data;\n   isolate->SetPromiseHook(nullptr);\n }"
        },
        {
            "sha": "e3b29f820423b0b58ea9dcb45aaea91edfff9113",
            "filename": "deps/v8/tools/v8heapconst.py",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftools%2Fv8heapconst.py",
            "raw_url": "https://github.com/nodejs/node/raw/f781758d41a2fe76d3c8060accea77917bc29812/deps%2Fv8%2Ftools%2Fv8heapconst.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Ftools%2Fv8heapconst.py?ref=f781758d41a2fe76d3c8060accea77917bc29812",
            "patch": "@@ -263,12 +263,12 @@\n   (\"MAP_SPACE\", 0x04511): (173, \"Tuple2Map\"),\n   (\"MAP_SPACE\", 0x04569): (171, \"ScriptMap\"),\n   (\"MAP_SPACE\", 0x045c1): (163, \"InterceptorInfoMap\"),\n-  (\"MAP_SPACE\", 0x04619): (154, \"AccessorInfoMap\"),\n-  (\"MAP_SPACE\", 0x04671): (153, \"AccessCheckInfoMap\"),\n-  (\"MAP_SPACE\", 0x046c9): (155, \"AccessorPairMap\"),\n-  (\"MAP_SPACE\", 0x04721): (156, \"AliasedArgumentsEntryMap\"),\n-  (\"MAP_SPACE\", 0x04779): (157, \"AllocationMementoMap\"),\n-  (\"MAP_SPACE\", 0x047d1): (158, \"AllocationSiteMap\"),\n+  (\"MAP_SPACE\", 0x04619): (158, \"AllocationSiteMap\"),\n+  (\"MAP_SPACE\", 0x04671): (154, \"AccessorInfoMap\"),\n+  (\"MAP_SPACE\", 0x046c9): (153, \"AccessCheckInfoMap\"),\n+  (\"MAP_SPACE\", 0x04721): (155, \"AccessorPairMap\"),\n+  (\"MAP_SPACE\", 0x04779): (156, \"AliasedArgumentsEntryMap\"),\n+  (\"MAP_SPACE\", 0x047d1): (157, \"AllocationMementoMap\"),\n   (\"MAP_SPACE\", 0x04829): (159, \"AsyncGeneratorRequestMap\"),\n   (\"MAP_SPACE\", 0x04881): (160, \"ContextExtensionMap\"),\n   (\"MAP_SPACE\", 0x048d9): (161, \"DebugInfoMap\"),\n@@ -366,4 +366,4 @@\n   \"NATIVE\",\n )\n \n-# This set of constants is generated from a shipping build.\n+# This set of constants is generated from a non-shipping build."
        }
    ],
    "stats": {
        "total": 1300,
        "additions": 688,
        "deletions": 612
    }
}