{
    "author": "joyeecheung",
    "message": "url: make the context non-enumerable\n\nAt the moment we expose the context as a normal property on the\nprototype chain of URL or take them from the base URL\nwhich makes them enumerable and considered\nby assert libraries even though the context carries path-dependent\ninformation that do not affect the equivalence of these objects.\nThis patch fixes it in a minimal manner by marking the context\nnon-enumerable as making it full private would require more\nrefactoring and can be done in a bigger patch later.\n\nPR-URL: https://github.com/nodejs/node/pull/24218\nRefs: https://github.com/nodejs/node/issues/24211\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Daijiro Wachi <daijiro.wachi@gmail.com>",
    "sha": "5e1bf058f4906c0a49c34c6a1353d0b34784c80a",
    "files": [
        {
            "sha": "693f082aed61370b92e42387847218187f602357",
            "filename": "lib/internal/url.js",
            "status": "modified",
            "additions": 13,
            "deletions": 2,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/5e1bf058f4906c0a49c34c6a1353d0b34784c80a/lib%2Finternal%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/5e1bf058f4906c0a49c34c6a1353d0b34784c80a/lib%2Finternal%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Furl.js?ref=5e1bf058f4906c0a49c34c6a1353d0b34784c80a",
            "patch": "@@ -245,7 +245,14 @@ function onParseError(flags, input) {\n // Reused by URL constructor and URL#href setter.\n function parse(url, input, base) {\n   const base_context = base ? base[context] : undefined;\n-  url[context] = new URLContext();\n+  // In the URL#href setter\n+  if (!url[context]) {\n+    Object.defineProperty(url, context, {\n+      enumerable: false,\n+      configurable: false,\n+      value: new URLContext()\n+    });\n+  }\n   _parse(input.trim(), -1, base_context, undefined,\n          onParseComplete.bind(url), onParseError);\n }\n@@ -1437,7 +1444,11 @@ function toPathIfFileURL(fileURLOrPath) {\n }\n \n function NativeURL(ctx) {\n-  this[context] = ctx;\n+  Object.defineProperty(this, context, {\n+    enumerable: false,\n+    configurable: false,\n+    value: ctx\n+  });\n }\n NativeURL.prototype = URL.prototype;\n "
        },
        {
            "sha": "f24a47b6d5c8f047c9f1f6e1fb5950dd295625d6",
            "filename": "test/parallel/test-whatwg-url-custom-no-enumerable-context.js",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/5e1bf058f4906c0a49c34c6a1353d0b34784c80a/test%2Fparallel%2Ftest-whatwg-url-custom-no-enumerable-context.js",
            "raw_url": "https://github.com/nodejs/node/raw/5e1bf058f4906c0a49c34c6a1353d0b34784c80a/test%2Fparallel%2Ftest-whatwg-url-custom-no-enumerable-context.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-url-custom-no-enumerable-context.js?ref=5e1bf058f4906c0a49c34c6a1353d0b34784c80a",
            "patch": "@@ -0,0 +1,14 @@\n+'use strict';\n+// This tests that the context of URL objects are not\n+// enumerable and thus considered by assert libraries.\n+// See https://github.com/nodejs/node/issues/24211\n+\n+// Tests below are not from WPT.\n+\n+require('../common');\n+const assert = require('assert');\n+\n+assert.deepStrictEqual(\n+  new URL('./foo', 'https://example.com/'),\n+  new URL('https://example.com/foo')\n+);"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 27,
        "deletions": 2
    }
}