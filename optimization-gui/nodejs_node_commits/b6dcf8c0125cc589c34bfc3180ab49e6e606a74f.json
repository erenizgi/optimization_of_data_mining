{
    "author": "jdalton",
    "message": "Revert \"module: fix inconsistency between load and _findPath\"\n\nThis reverts commit 1b92214\nfrom PR #22382.\n\nSee the discussion at\nhttps://github.com/nodejs/citgm/issues/604\n\nPR-URL: https://github.com/nodejs/node/pull/23228\nRefs: https://github.com/nodejs/node/pull/22382\nFixes: https://github.com/nodejs/node/issues/4778\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "b6dcf8c0125cc589c34bfc3180ab49e6e606a74f",
    "files": [
        {
            "sha": "2d5ed2189d467ca68761a9c920181f7205c670c8",
            "filename": "lib/internal/modules/cjs/loader.js",
            "status": "modified",
            "additions": 2,
            "deletions": 12,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/b6dcf8c0125cc589c34bfc3180ab49e6e606a74f/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "raw_url": "https://github.com/nodejs/node/raw/b6dcf8c0125cc589c34bfc3180ab49e6e606a74f/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmodules%2Fcjs%2Floader.js?ref=b6dcf8c0125cc589c34bfc3180ab49e6e606a74f",
            "patch": "@@ -218,16 +218,6 @@ function tryExtensions(p, exts, isMain) {\n   return false;\n }\n \n-function readExtensions() {\n-  const exts = Object.keys(Module._extensions);\n-  for (var i = 0, j = 0; i < exts.length; ++i) {\n-    if (path.extname(exts[i]) === '')\n-      exts[j++] = exts[i];\n-  }\n-  exts.length = j;\n-  return exts;\n-}\n-\n var warned = false;\n Module._findPath = function(request, paths, isMain) {\n   if (path.isAbsolute(request)) {\n@@ -284,15 +274,15 @@ Module._findPath = function(request, paths, isMain) {\n       if (!filename) {\n         // try it with each of the extensions\n         if (exts === undefined)\n-          exts = readExtensions();\n+          exts = Object.keys(Module._extensions);\n         filename = tryExtensions(basePath, exts, isMain);\n       }\n     }\n \n     if (!filename && rc === 1) {  // Directory.\n       // try it with each of the extensions at \"index\"\n       if (exts === undefined)\n-        exts = readExtensions();\n+        exts = Object.keys(Module._extensions);\n       filename = tryPackage(basePath, exts, isMain);\n       if (!filename) {\n         filename = tryExtensions(path.resolve(basePath, 'index'), exts, isMain);"
        },
        {
            "sha": "3a51e8725eec60ab196c43e8b94b8deaf4468156",
            "filename": "test/known_issues/test-module-deleted-extensions.js",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/b6dcf8c0125cc589c34bfc3180ab49e6e606a74f/test%2Fknown_issues%2Ftest-module-deleted-extensions.js",
            "raw_url": "https://github.com/nodejs/node/raw/b6dcf8c0125cc589c34bfc3180ab49e6e606a74f/test%2Fknown_issues%2Ftest-module-deleted-extensions.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fknown_issues%2Ftest-module-deleted-extensions.js?ref=b6dcf8c0125cc589c34bfc3180ab49e6e606a74f",
            "patch": "@@ -0,0 +1,18 @@\n+'use strict';\n+// Refs: https://github.com/nodejs/node/issues/4778\n+const common = require('../common');\n+const assert = require('assert');\n+const fs = require('fs');\n+const path = require('path');\n+const tmpdir = require('../common/tmpdir');\n+const file = path.join(tmpdir.path, 'test-extensions.foo.bar');\n+\n+tmpdir.refresh();\n+fs.writeFileSync(file, '', 'utf8');\n+require.extensions['.foo.bar'] = (module, path) => {};\n+delete require.extensions['.foo.bar'];\n+require.extensions['.bar'] = common.mustCall((module, path) => {\n+  assert.strictEqual(module.id, file);\n+  assert.strictEqual(path, file);\n+});\n+require(path.join(tmpdir.path, 'test-extensions'));"
        },
        {
            "sha": "f14da0a70f7656fa24708abc7178d4d2cd5b199a",
            "filename": "test/parallel/test-module-deleted-extensions.js",
            "status": "removed",
            "additions": 0,
            "deletions": 58,
            "changes": 58,
            "blob_url": "https://github.com/nodejs/node/blob/eb9748d222061381236f19cbe162cf9eb2e034ad/test%2Fparallel%2Ftest-module-deleted-extensions.js",
            "raw_url": "https://github.com/nodejs/node/raw/eb9748d222061381236f19cbe162cf9eb2e034ad/test%2Fparallel%2Ftest-module-deleted-extensions.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-module-deleted-extensions.js?ref=eb9748d222061381236f19cbe162cf9eb2e034ad",
            "patch": "@@ -1,58 +0,0 @@\n-'use strict';\n-\n-// Refs: https://github.com/nodejs/node/issues/4778\n-\n-const common = require('../common');\n-const assert = require('assert');\n-const fs = require('fs');\n-const path = require('path');\n-const tmpdir = require('../common/tmpdir');\n-const file = path.join(tmpdir.path, 'test-extensions.foo.bar');\n-\n-tmpdir.refresh();\n-fs.writeFileSync(file, '', 'utf8');\n-\n-{\n-  require.extensions['.bar'] = common.mustNotCall();\n-  require.extensions['.foo.bar'] = common.mustNotCall();\n-  const modulePath = path.join(tmpdir.path, 'test-extensions');\n-  assert.throws(\n-    () => require(modulePath),\n-    new Error(`Cannot find module '${modulePath}'`)\n-  );\n-}\n-\n-{\n-  delete require.extensions['.bar'];\n-  require.extensions['.foo.bar'] = common.mustNotCall();\n-  const modulePath = path.join(tmpdir.path, 'test-extensions');\n-  assert.throws(\n-    () => require(modulePath),\n-    new Error(`Cannot find module '${modulePath}'`)\n-  );\n-  assert.throws(\n-    () => require(modulePath + '.foo'),\n-    new Error(`Cannot find module '${modulePath}.foo'`)\n-  );\n-}\n-\n-{\n-  delete require.extensions['.bar'];\n-  delete require.extensions['.foo.bar'];\n-  const modulePath = path.join(tmpdir.path, 'test-extensions');\n-  assert.throws(\n-    () => require(modulePath),\n-    new Error(`Cannot find module '${modulePath}'`)\n-  );\n-}\n-\n-{\n-  delete require.extensions['.foo.bar'];\n-  require.extensions['.bar'] = common.mustCall((module, path) => {\n-    assert.strictEqual(module.id, file);\n-    assert.strictEqual(path, file);\n-  });\n-\n-  const modulePath = path.join(tmpdir.path, 'test-extensions.foo');\n-  require(modulePath);\n-}"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 20,
        "deletions": 70
    }
}