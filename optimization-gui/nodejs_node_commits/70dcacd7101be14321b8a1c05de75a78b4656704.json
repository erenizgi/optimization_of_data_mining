{
    "author": "BridgeAR",
    "message": "assert: deprecate assert.fail partially\n\nUsing `assert.fail()` with more than one argument is not intuitive\nto use and has no benefit over using a message on its own.\n\nTherefore this introduces a runtime deprecation in case it is used\nin that way.\n\nPR-URL: https://github.com/nodejs/node/pull/18418\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "70dcacd7101be14321b8a1c05de75a78b4656704",
    "files": [
        {
            "sha": "7bade14184c9425e8de50a4e86ad9e0e45a87380",
            "filename": "doc/api/assert.md",
            "status": "modified",
            "additions": 47,
            "deletions": 23,
            "changes": 70,
            "blob_url": "https://github.com/nodejs/node/blob/70dcacd7101be14321b8a1c05de75a78b4656704/doc%2Fapi%2Fassert.md",
            "raw_url": "https://github.com/nodejs/node/raw/70dcacd7101be14321b8a1c05de75a78b4656704/doc%2Fapi%2Fassert.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fassert.md?ref=70dcacd7101be14321b8a1c05de75a78b4656704",
            "patch": "@@ -415,30 +415,64 @@ parameter is an instance of an [`Error`][] then it will be thrown instead of the\n `AssertionError`.\n \n ## assert.fail([message])\n+<!-- YAML\n+added: v0.1.21\n+-->\n+* `message` {any} **Default:** `'Failed'`\n+\n+Throws an `AssertionError` with the provided error message or a default error\n+message. If the `message` parameter is an instance of an [`Error`][] then it\n+will be thrown instead of the `AssertionError`.\n+\n+```js\n+const assert = require('assert').strict;\n+\n+assert.fail();\n+// AssertionError [ERR_ASSERTION]: Failed\n+\n+assert.fail('boom');\n+// AssertionError [ERR_ASSERTION]: boom\n+\n+assert.fail(new TypeError('need array'));\n+// TypeError: need array\n+```\n+\n+Using `assert.fail()` with more than two arguments is possible but deprecated.\n+See below for further details.\n+\n ## assert.fail(actual, expected[, message[, operator[, stackStartFunction]]])\n <!-- YAML\n added: v0.1.21\n+changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/REPLACEME\n+    description: Calling `assert.fail` with more than one argument is deprecated\n+                 and emits a warning.\n -->\n * `actual` {any}\n * `expected` {any}\n-* `message` {any} **Default:** `'Failed'`\n+* `message` {any}\n * `operator` {string} **Default:** '!='\n * `stackStartFunction` {Function} **Default:** `assert.fail`\n \n-Throws an `AssertionError`. If `message` is falsy, the error message is set as\n-the values of `actual` and `expected` separated by the provided `operator`. If\n-the `message` parameter is an instance of an [`Error`][] then it will be thrown\n-instead of the `AssertionError`. If just the two `actual` and `expected`\n-arguments are provided, `operator` will default to `'!='`. If `message` is\n-provided only it will be used as the error message, the other arguments will be\n-stored as properties on the thrown object. If `stackStartFunction` is provided,\n-all stack frames above that function will be removed from stacktrace (see\n-[`Error.captureStackTrace`]). If no arguments are given, the default message\n-`Failed` will be used.\n+> Stability: 0 - Deprecated: Use `assert.fail([message])` or other assert\n+> functions instead.\n+\n+If `message` is falsy, the error message is set as the values of `actual` and\n+`expected` separated by the provided `operator`. If just the two `actual` and\n+`expected` arguments are provided, `operator` will default to `'!='`. If\n+`message` is provided as third argument it will be used as the error message and\n+the other arguments will be stored as properties on the thrown object. If\n+`stackStartFunction` is provided, all stack frames above that function will be\n+removed from stacktrace (see [`Error.captureStackTrace`]). If no arguments are\n+given, the default message `Failed` will be used.\n \n ```js\n const assert = require('assert').strict;\n \n+assert.fail('a', 'b');\n+// AssertionError [ERR_ASSERTION]: 'a' != 'b'\n+\n assert.fail(1, 2, undefined, '>');\n // AssertionError [ERR_ASSERTION]: 1 > 2\n \n@@ -452,21 +486,11 @@ assert.fail(1, 2, new TypeError('need array'));\n // TypeError: need array\n ```\n \n-*Note*: In the last two cases `actual`, `expected`, and `operator` have no\n+In the last three cases `actual`, `expected`, and `operator` have no\n influence on the error message.\n \n-```js\n-assert.fail();\n-// AssertionError [ERR_ASSERTION]: Failed\n-\n-assert.fail('boom');\n-// AssertionError [ERR_ASSERTION]: boom\n-\n-assert.fail('a', 'b');\n-// AssertionError [ERR_ASSERTION]: 'a' != 'b'\n-```\n-\n Example use of `stackStartFunction` for truncating the exception's stacktrace:\n+\n ```js\n function suppressFrame() {\n   assert.fail('a', 'b', undefined, '!==', suppressFrame);"
        },
        {
            "sha": "84531ea80d128fa0f2e1892594796a606ff1c3ce",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/70dcacd7101be14321b8a1c05de75a78b4656704/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/70dcacd7101be14321b8a1c05de75a78b4656704/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=70dcacd7101be14321b8a1c05de75a78b4656704",
            "patch": "@@ -847,6 +847,15 @@ Type: Documentation-only\n The [`crypto.fips`][] property is deprecated. Please use `crypto.setFips()`\n and `crypto.getFips()` instead.\n \n+<a id=\"DEP0XX\"></a>\n+### DEP0XXX: Using `assert.fail()` with more than one argument.\n+\n+Type: Runtime\n+\n+Using `assert.fail()` with more than one argument has no benefit over writing an\n+individual error message. Either use `assert.fail()` with one argument or switch\n+to one of the other assert methods.\n+\n [`--pending-deprecation`]: cli.html#cli_pending_deprecation\n [`Buffer.allocUnsafeSlow(size)`]: buffer.html#buffer_class_method_buffer_allocunsafeslow_size\n [`Buffer.from(array)`]: buffer.html#buffer_class_method_buffer_from_array"
        },
        {
            "sha": "75d2473c486261f6d989460b3684675e1625a87a",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/70dcacd7101be14321b8a1c05de75a78b4656704/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/70dcacd7101be14321b8a1c05de75a78b4656704/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=70dcacd7101be14321b8a1c05de75a78b4656704",
            "patch": "@@ -52,6 +52,8 @@ const ERR_DIFF_DEACTIVATED = 0;\n const ERR_DIFF_NOT_EQUAL = 1;\n const ERR_DIFF_EQUAL = 2;\n \n+let warned = false;\n+\n // The assert module provides functions that throw\n // AssertionError's when particular conditions are not met. The\n // assert module must conform to the following interface.\n@@ -80,8 +82,18 @@ function fail(actual, expected, message, operator, stackStartFn) {\n   } else if (argsLen === 1) {\n     message = actual;\n     actual = undefined;\n-  } else if (argsLen === 2) {\n-    operator = '!=';\n+  } else {\n+    if (warned === false) {\n+      warned = true;\n+      process.emitWarning(\n+        'assert.fail() with more than one argument is deprecated. ' +\n+          'Please use assert.strictEqual() instead or only pass a message.',\n+        'DeprecationWarning',\n+        'DEP00XXX'\n+      );\n+    }\n+    if (argsLen === 2)\n+      operator = '!=';\n   }\n \n   innerFail({"
        },
        {
            "sha": "9da26dab3fd17d9722a6410899717843d7f6a232",
            "filename": "test/parallel/test-assert-fail-deprecation.js",
            "status": "added",
            "additions": 64,
            "deletions": 0,
            "changes": 64,
            "blob_url": "https://github.com/nodejs/node/blob/70dcacd7101be14321b8a1c05de75a78b4656704/test%2Fparallel%2Ftest-assert-fail-deprecation.js",
            "raw_url": "https://github.com/nodejs/node/raw/70dcacd7101be14321b8a1c05de75a78b4656704/test%2Fparallel%2Ftest-assert-fail-deprecation.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert-fail-deprecation.js?ref=70dcacd7101be14321b8a1c05de75a78b4656704",
            "patch": "@@ -0,0 +1,64 @@\n+'use strict';\n+\n+const common = require('../common');\n+const assert = require('assert');\n+\n+common.expectWarning(\n+  'DeprecationWarning',\n+  'assert.fail() with more than one argument is deprecated. ' +\n+    'Please use assert.strictEqual() instead or only pass a message.'\n+);\n+\n+// Two args only, operator defaults to '!='\n+assert.throws(() => {\n+  assert.fail('first', 'second');\n+}, {\n+  code: 'ERR_ASSERTION',\n+  name: 'AssertionError [ERR_ASSERTION]',\n+  message: '\\'first\\' != \\'second\\'',\n+  operator: '!=',\n+  actual: 'first',\n+  expected: 'second'\n+});\n+\n+// Three args\n+assert.throws(() => {\n+  assert.fail('ignored', 'ignored', 'another custom message');\n+}, {\n+  code: 'ERR_ASSERTION',\n+  name: 'AssertionError [ERR_ASSERTION]',\n+  message: 'another custom message',\n+  operator: undefined,\n+  actual: 'ignored',\n+  expected: 'ignored'\n+});\n+\n+// Three args with custom Error\n+assert.throws(() => {\n+  assert.fail(typeof 1, 'object', new TypeError('another custom message'));\n+}, {\n+  name: 'TypeError',\n+  message: 'another custom message',\n+  operator: undefined,\n+  actual: undefined,\n+  expected: undefined,\n+  code: undefined\n+});\n+\n+// No third arg (but a fourth arg)\n+assert.throws(() => {\n+  assert.fail('first', 'second', undefined, 'operator');\n+}, {\n+  code: 'ERR_ASSERTION',\n+  name: 'AssertionError [ERR_ASSERTION]',\n+  message: '\\'first\\' operator \\'second\\'',\n+  operator: 'operator',\n+  actual: 'first',\n+  expected: 'second'\n+});\n+\n+// The stackFrameFunction should exclude the foo frame\n+assert.throws(\n+  function foo() { assert.fail('first', 'second', 'message', '!==', foo); },\n+  (err) => !/^\\s*at\\sfoo\\b/m.test(err.stack)\n+);"
        },
        {
            "sha": "fc2b6cc03c1d998b64b388b720f577266cafe4f2",
            "filename": "test/parallel/test-assert-fail.js",
            "status": "modified",
            "additions": 8,
            "deletions": 63,
            "changes": 71,
            "blob_url": "https://github.com/nodejs/node/blob/70dcacd7101be14321b8a1c05de75a78b4656704/test%2Fparallel%2Ftest-assert-fail.js",
            "raw_url": "https://github.com/nodejs/node/raw/70dcacd7101be14321b8a1c05de75a78b4656704/test%2Fparallel%2Ftest-assert-fail.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert-fail.js?ref=70dcacd7101be14321b8a1c05de75a78b4656704",
            "patch": "@@ -1,95 +1,40 @@\n 'use strict';\n \n-/* eslint-disable prefer-common-expectserror */\n-\n-const common = require('../common');\n+require('../common');\n const assert = require('assert');\n \n // No args\n assert.throws(\n   () => { assert.fail(); },\n-  common.expectsError({\n+  {\n     code: 'ERR_ASSERTION',\n-    type: assert.AssertionError,\n+    name: 'AssertionError [ERR_ASSERTION]',\n     message: 'Failed',\n     operator: undefined,\n     actual: undefined,\n     expected: undefined\n-  })\n+  }\n );\n \n // One arg = message\n-common.expectsError(() => {\n+assert.throws(() => {\n   assert.fail('custom message');\n }, {\n   code: 'ERR_ASSERTION',\n-  type: assert.AssertionError,\n+  name: 'AssertionError [ERR_ASSERTION]',\n   message: 'custom message',\n   operator: undefined,\n   actual: undefined,\n   expected: undefined\n });\n \n // One arg = Error\n-common.expectsError(() => {\n+assert.throws(() => {\n   assert.fail(new TypeError('custom message'));\n }, {\n-  type: TypeError,\n+  name: 'TypeError',\n   message: 'custom message',\n   operator: undefined,\n   actual: undefined,\n   expected: undefined\n });\n-\n-// Two args only, operator defaults to '!='\n-common.expectsError(() => {\n-  assert.fail('first', 'second');\n-}, {\n-  code: 'ERR_ASSERTION',\n-  type: assert.AssertionError,\n-  message: '\\'first\\' != \\'second\\'',\n-  operator: '!=',\n-  actual: 'first',\n-  expected: 'second'\n-});\n-\n-// Three args\n-common.expectsError(() => {\n-  assert.fail('ignored', 'ignored', 'another custom message');\n-}, {\n-  code: 'ERR_ASSERTION',\n-  type: assert.AssertionError,\n-  message: 'another custom message',\n-  operator: undefined,\n-  actual: 'ignored',\n-  expected: 'ignored'\n-});\n-\n-// Three args with custom Error\n-common.expectsError(() => {\n-  assert.fail(typeof 1, 'object', new TypeError('another custom message'));\n-}, {\n-  type: TypeError,\n-  message: 'another custom message',\n-  operator: undefined,\n-  actual: 'number',\n-  expected: 'object'\n-});\n-\n-// No third arg (but a fourth arg)\n-common.expectsError(() => {\n-  assert.fail('first', 'second', undefined, 'operator');\n-}, {\n-  code: 'ERR_ASSERTION',\n-  type: assert.AssertionError,\n-  message: '\\'first\\' operator \\'second\\'',\n-  operator: 'operator',\n-  actual: 'first',\n-  expected: 'second'\n-});\n-\n-// The stackFrameFunction should exclude the foo frame\n-assert.throws(\n-  function foo() { assert.fail('first', 'second', 'message', '!==', foo); },\n-  (err) => !/^\\s*at\\sfoo\\b/m.test(err.stack)\n-);"
        }
    ],
    "stats": {
        "total": 230,
        "additions": 142,
        "deletions": 88
    }
}