{
    "author": "joyeecheung",
    "message": "lib: use `internal/options` to query `--abort-on-uncaught-exception`\n\nInstead of using\n`internalBinding('config').shouldAbortOnUncaughtException`.\nAlso removes that property from the binding.\n\nPR-URL: https://github.com/nodejs/node/pull/25862\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "b44131ab927008edff85a9efb196e1e192d28a29",
    "files": [
        {
            "sha": "165d44b702228915fb577efb1016c5f231b58c96",
            "filename": "lib/internal/async_hooks.js",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/b44131ab927008edff85a9efb196e1e192d28a29/lib%2Finternal%2Fasync_hooks.js",
            "raw_url": "https://github.com/nodejs/node/raw/b44131ab927008edff85a9efb196e1e192d28a29/lib%2Finternal%2Fasync_hooks.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fasync_hooks.js?ref=b44131ab927008edff85a9efb196e1e192d28a29",
            "patch": "@@ -4,6 +4,11 @@ const {\n   ERR_ASYNC_TYPE,\n   ERR_INVALID_ASYNC_ID\n } = require('internal/errors').codes;\n+\n+const { getOptionValue } = require('internal/options');\n+const shouldAbortOnUncaughtException =\n+  getOptionValue('--abort-on-uncaught-exception');\n+\n const async_wrap = internalBinding('async_wrap');\n /* async_hook_fields is a Uint32Array wrapping the uint32_t array of\n  * Environment::AsyncHooks::fields_[]. Each index tracks the number of active\n@@ -107,7 +112,7 @@ function fatalError(e) {\n     Error.captureStackTrace(o, fatalError);\n     process._rawDebug(o.stack);\n   }\n-  if (internalBinding('config').shouldAbortOnUncaughtException) {\n+  if (shouldAbortOnUncaughtException) {\n     process.abort();\n   }\n   process.exit(1);"
        },
        {
            "sha": "6c777a7c78b9c62c769d3aa4138b9beb9d6bb2e6",
            "filename": "lib/internal/policy/manifest.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/b44131ab927008edff85a9efb196e1e192d28a29/lib%2Finternal%2Fpolicy%2Fmanifest.js",
            "raw_url": "https://github.com/nodejs/node/raw/b44131ab927008edff85a9efb196e1e192d28a29/lib%2Finternal%2Fpolicy%2Fmanifest.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fpolicy%2Fmanifest.js?ref=b44131ab927008edff85a9efb196e1e192d28a29",
            "patch": "@@ -25,7 +25,9 @@ const { entries } = Object;\n const kIntegrities = new SafeWeakMap();\n const kReactions = new SafeWeakMap();\n const kRelativeURLStringPattern = /^\\.{0,2}\\//;\n-const { shouldAbortOnUncaughtException } = internalBinding('config');\n+const { getOptionValue } = require('internal/options');\n+const shouldAbortOnUncaughtException =\n+  getOptionValue('--abort-on-uncaught-exception');\n const { abort, exit, _rawDebug } = process;\n \n function REACTION_THROW(error) {"
        },
        {
            "sha": "d9b2c8112eb68906ab92183866ccda8657dc4345",
            "filename": "src/node_config.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/b44131ab927008edff85a9efb196e1e192d28a29/src%2Fnode_config.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b44131ab927008edff85a9efb196e1e192d28a29/src%2Fnode_config.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_config.cc?ref=b44131ab927008edff85a9efb196e1e192d28a29",
            "patch": "@@ -69,9 +69,6 @@ static void Initialize(Local<Object> target,\n   READONLY_FALSE_PROPERTY(target, \"hasInspector\");\n #endif\n \n-  if (env->abort_on_uncaught_exception())\n-    READONLY_TRUE_PROPERTY(target, \"shouldAbortOnUncaughtException\");\n-\n   READONLY_PROPERTY(target,\n                     \"bits\",\n                     Number::New(env->isolate(), 8 * sizeof(intptr_t)));"
        },
        {
            "sha": "20caac5c3720d94cd2fcbb52b6f4e7f08282aace",
            "filename": "src/node_options.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/b44131ab927008edff85a9efb196e1e192d28a29/src%2Fnode_options.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b44131ab927008edff85a9efb196e1e192d28a29/src%2Fnode_options.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_options.cc?ref=b44131ab927008edff85a9efb196e1e192d28a29",
            "patch": "@@ -540,7 +540,14 @@ void GetOptions(const FunctionCallbackInfo<Value>& args) {\n     switch (option_info.type) {\n       case kNoOp:\n       case kV8Option:\n-        value = Undefined(isolate);\n+        // Special case for --abort-on-uncaught-exception which is also\n+        // respected by Node.js internals\n+        if (item.first == \"--abort-on-uncaught-exception\") {\n+          value = Boolean::New(\n+            isolate, original_per_env->abort_on_uncaught_exception);\n+        } else {\n+          value = Undefined(isolate);\n+        }\n         break;\n       case kBoolean:\n         value = Boolean::New(isolate, *parser.Lookup<bool>(field, opts));"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 17,
        "deletions": 6
    }
}