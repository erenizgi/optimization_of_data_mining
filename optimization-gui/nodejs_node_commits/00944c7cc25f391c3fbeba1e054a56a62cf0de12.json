{
    "author": "sam-github",
    "message": "src: use consistent names for JSStream\n\nIts confusing to call a js class with a handle a \"Wrap\", usually it's\nthe C++ handle that is called a Wrap (tcp_wrap, tls_wrap, ...). Its\nderived from Socket, and makes a JS stream look like a Socket, so call\nit that. Also, remove use of lib/_stream_wrap.js so it can be deprecated\nsome time.\n\nPR-URL: https://github.com/nodejs/node/pull/25153\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>",
    "sha": "00944c7cc25f391c3fbeba1e054a56a62cf0de12",
    "files": [
        {
            "sha": "5b5f476948b23af6ae25f39958c450944ffbdd6f",
            "filename": "lib/_stream_wrap.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/lib%2F_stream_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/lib%2F_stream_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_stream_wrap.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -1,3 +1,3 @@\n 'use strict';\n \n-module.exports = require('internal/wrap_js_stream');\n+module.exports = require('internal/js_stream_socket');"
        },
        {
            "sha": "a72091b22e97fbc8e985da65973f68bf3e3ad11c",
            "filename": "lib/_tls_wrap.js",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/lib%2F_tls_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/lib%2F_tls_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_wrap.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -29,7 +29,7 @@ const net = require('net');\n const tls = require('tls');\n const util = require('util');\n const common = require('_tls_common');\n-const { StreamWrap } = require('_stream_wrap');\n+const JSStreamSocket = require('internal/js_stream_socket');\n const { Buffer } = require('buffer');\n const debug = util.debuglog('tls');\n const { TCP, constants: TCPConstants } = internalBinding('tcp_wrap');\n@@ -310,12 +310,14 @@ function TLSSocket(socket, opts) {\n   this.authorizationError = null;\n   this[kRes] = null;\n \n-  // Wrap plain JS Stream into StreamWrap\n   var wrap;\n   if ((socket instanceof net.Socket && socket._handle) || !socket) {\n     wrap = socket;\n   } else {\n-    wrap = new StreamWrap(socket);\n+    // TLS expects to interact from C++ with a net.Socket that has a C++ stream\n+    // handle, but a JS stream doesn't have one. Wrap it up to make it look like\n+    // a socket.\n+    wrap = new JSStreamSocket(socket);\n     wrap.once('close', () => this.destroy());\n   }\n "
        },
        {
            "sha": "2bca31e24a54733d0b1ec1e1d7c25da8c837fe35",
            "filename": "lib/internal/http2/core.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/lib%2Finternal%2Fhttp2%2Fcore.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/lib%2Finternal%2Fhttp2%2Fcore.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fhttp2%2Fcore.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -22,7 +22,7 @@ const util = require('util');\n \n const { kIncomingMessage } = require('_http_common');\n const { kServerResponse } = require('_http_server');\n-const { StreamWrap } = require('_stream_wrap');\n+const JSStreamSocket = require('internal/js_stream_socket');\n \n const {\n   defaultTriggerAsyncIdScope,\n@@ -935,7 +935,7 @@ class Http2Session extends EventEmitter {\n     super();\n \n     if (!socket._handle || !socket._handle._externalStream) {\n-      socket = new StreamWrap(socket);\n+      socket = new JSStreamSocket(socket);\n     }\n \n     // No validation is performed on the input parameters because this"
        },
        {
            "sha": "8343b6c2645842900833c4d5af4ccd93b2b9e9c4",
            "filename": "lib/internal/js_stream_socket.js",
            "status": "renamed",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/lib%2Finternal%2Fjs_stream_socket.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/lib%2Finternal%2Fjs_stream_socket.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fjs_stream_socket.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -5,7 +5,7 @@ const util = require('util');\n const { Socket } = require('net');\n const { JSStream } = internalBinding('js_stream');\n const uv = internalBinding('uv');\n-const debug = util.debuglog('stream_wrap');\n+const debug = util.debuglog('stream_socket');\n const { owner_symbol } = require('internal/async_hooks').symbols;\n const { ERR_STREAM_WRAP } = require('internal/errors').codes;\n \n@@ -29,17 +29,17 @@ function onwrite(req, bufs) { return this[owner_symbol].doWrite(req, bufs); }\n  * can skip going through the JS layer and let TLS access the raw C++ handle\n  * of a net.Socket. The flipside of this is that, to maintain composability,\n  * we need a way to create \"fake\" net.Socket instances that call back into a\n- * \"real\" JavaScript stream. JSStreamWrap is exactly this.\n+ * \"real\" JavaScript stream. JSStreamSocket is exactly this.\n  */\n-class JSStreamWrap extends Socket {\n+class JSStreamSocket extends Socket {\n   constructor(stream) {\n     const handle = new JSStream();\n     handle.close = (cb) => {\n       debug('close');\n       this.doClose(cb);\n     };\n     // Inside of the following functions, `this` refers to the handle\n-    // and `this[owner_symbol]` refers to this JSStreamWrap instance.\n+    // and `this[owner_symbol]` refers to this JSStreamSocket instance.\n     handle.isClosing = isClosing;\n     handle.onreadstart = onreadstart;\n     handle.onreadstop = onreadstop;\n@@ -88,9 +88,10 @@ class JSStreamWrap extends Socket {\n     this.read(0);\n   }\n \n-  // Legacy\n+  // Allow legacy requires in the test suite to keep working:\n+  //   const { StreamWrap } = require('internal/js_stream_socket')\n   static get StreamWrap() {\n-    return JSStreamWrap;\n+    return JSStreamSocket;\n   }\n \n   isClosing() {\n@@ -223,4 +224,4 @@ class JSStreamWrap extends Socket {\n   }\n }\n \n-module.exports = JSStreamWrap;\n+module.exports = JSStreamSocket;",
            "previous_filename": "lib/internal/wrap_js_stream.js"
        },
        {
            "sha": "e36f9f26aa2f06d19c6784c3b37dfb9296e78c54",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -126,6 +126,7 @@\n       'lib/internal/fs/watchers.js',\n       'lib/internal/http.js',\n       'lib/internal/inspector_async_hook.js',\n+      'lib/internal/js_stream_socket.js',\n       'lib/internal/linkedlist.js',\n       'lib/internal/modules/cjs/helpers.js',\n       'lib/internal/modules/cjs/loader.js',\n@@ -188,7 +189,6 @@\n       'lib/internal/streams/state.js',\n       'lib/internal/streams/pipeline.js',\n       'lib/internal/streams/end-of-stream.js',\n-      'lib/internal/wrap_js_stream.js',\n       'deps/v8/tools/splaytree.js',\n       'deps/v8/tools/codemap.js',\n       'deps/v8/tools/consarray.js',"
        },
        {
            "sha": "77243399515730025020dd5c184dc5f91340ae3b",
            "filename": "test/parallel/test-stream-wrap-drain.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-stream-wrap-drain.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-stream-wrap-drain.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-wrap-drain.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -2,12 +2,12 @@\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n-const { StreamWrap } = require('_stream_wrap');\n+const { StreamWrap } = require('internal/js_stream_socket');\n const { Duplex } = require('stream');\n const { internalBinding } = require('internal/test/binding');\n const { ShutdownWrap } = internalBinding('stream_wrap');\n \n-// This test makes sure that when an instance of JSStreamWrap is waiting for\n+// This test makes sure that when a wrapped stream is waiting for\n // a \"drain\" event to `doShutdown`, the instance will work correctly when a\n // \"drain\" event emitted.\n {"
        },
        {
            "sha": "72804d77d6bde69a04fad8d93ecdf9817f1e4d23",
            "filename": "test/parallel/test-stream-wrap-encoding.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-stream-wrap-encoding.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-stream-wrap-encoding.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-wrap-encoding.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -1,7 +1,8 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n \n-const StreamWrap = require('_stream_wrap');\n+const StreamWrap = require('internal/js_stream_socket');\n const Duplex = require('stream').Duplex;\n \n {"
        },
        {
            "sha": "670c05fe3f0307e8cd085f4fc3a9fb1d2d2ceaa9",
            "filename": "test/parallel/test-stream-wrap.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-stream-wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-stream-wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-wrap.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -4,7 +4,7 @@ const common = require('../common');\n const assert = require('assert');\n \n const { internalBinding } = require('internal/test/binding');\n-const StreamWrap = require('_stream_wrap');\n+const StreamWrap = require('internal/js_stream_socket');\n const { Duplex } = require('stream');\n const { ShutdownWrap } = internalBinding('stream_wrap');\n "
        },
        {
            "sha": "5c1ed1e7e65d109a0634bc52fb46443456a17612",
            "filename": "test/parallel/test-wrap-js-stream-destroy.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-wrap-js-stream-destroy.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-wrap-js-stream-destroy.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-wrap-js-stream-destroy.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -1,7 +1,8 @@\n+// Flags: --expose-internals\n 'use strict';\n \n const common = require('../common');\n-const StreamWrap = require('_stream_wrap');\n+const StreamWrap = require('internal/js_stream_socket');\n const net = require('net');\n \n // This test ensures that when we directly call `socket.destroy()` without"
        },
        {
            "sha": "6a817c1054cf555ab3d78f23a5a5aa3a6a35872b",
            "filename": "test/parallel/test-wrap-js-stream-duplex.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-wrap-js-stream-duplex.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-wrap-js-stream-duplex.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-wrap-js-stream-duplex.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -1,7 +1,8 @@\n+// Flags: --expose-internals\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n-const StreamWrap = require('_stream_wrap');\n+const StreamWrap = require('internal/js_stream_socket');\n const { PassThrough } = require('stream');\n const { Socket } = require('net');\n "
        },
        {
            "sha": "cde7c178446a11f2a5a705aab26e144e60eec6a6",
            "filename": "test/parallel/test-wrap-js-stream-exceptions.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-wrap-js-stream-exceptions.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-wrap-js-stream-exceptions.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-wrap-js-stream-exceptions.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -2,7 +2,7 @@\n 'use strict';\n const common = require('../common');\n const assert = require('assert');\n-const JSStreamWrap = require('internal/wrap_js_stream');\n+const JSStreamWrap = require('internal/js_stream_socket');\n const { Duplex } = require('stream');\n \n process.once('uncaughtException', common.mustCall((err) => {"
        },
        {
            "sha": "6d86dc2c21a5197127f721e02c6175dbd09a4a7a",
            "filename": "test/parallel/test-wrap-js-stream-read-stop.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-wrap-js-stream-read-stop.js",
            "raw_url": "https://github.com/nodejs/node/raw/00944c7cc25f391c3fbeba1e054a56a62cf0de12/test%2Fparallel%2Ftest-wrap-js-stream-read-stop.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-wrap-js-stream-read-stop.js?ref=00944c7cc25f391c3fbeba1e054a56a62cf0de12",
            "patch": "@@ -3,7 +3,7 @@\n \n require('../common');\n const assert = require('assert');\n-const WrapStream = require('internal/wrap_js_stream');\n+const WrapStream = require('internal/js_stream_socket');\n const Stream = require('stream');\n \n class FakeStream extends Stream {"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 28,
        "deletions": 22
    }
}