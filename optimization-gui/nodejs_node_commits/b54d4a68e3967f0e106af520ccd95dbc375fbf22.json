{
    "author": "sam-github",
    "message": "test: merge test with unnecessary child process\n\nTest didn't require child process creation. While this test has not been\nunstable, child process creation is slower and can be flaky in ci, so\ntest directly for the segfault regression.\n\nPR-URL: https://github.com/nodejs/node/pull/25025\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "b54d4a68e3967f0e106af520ccd95dbc375fbf22",
    "files": [
        {
            "sha": "5cc622b48c76c421c7f31f2559697a413c22f590",
            "filename": "test/parallel/test-crypto-hash.js",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/b54d4a68e3967f0e106af520ccd95dbc375fbf22/test%2Fparallel%2Ftest-crypto-hash.js",
            "raw_url": "https://github.com/nodejs/node/raw/b54d4a68e3967f0e106af520ccd95dbc375fbf22/test%2Fparallel%2Ftest-crypto-hash.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-hash.js?ref=b54d4a68e3967f0e106af520ccd95dbc375fbf22",
            "patch": "@@ -111,6 +111,17 @@ assert.throws(function() {\n   crypto.createHash('xyzzy');\n }, /Digest method not supported/);\n \n+// Issue https://github.com/nodejs/node/issues/9819: throwing encoding used to\n+// segfault.\n+common.expectsError(\n+  () => crypto.createHash('sha256').digest({\n+    toString: () => { throw new Error('boom'); },\n+  }),\n+  {\n+    type: Error,\n+    message: 'boom'\n+  });\n+\n // Default UTF-8 encoding\n const hutf8 = crypto.createHash('sha512').update('УТФ-8 text').digest('hex');\n assert.strictEqual("
        },
        {
            "sha": "f21db29d36107fcc0b5560c6bb17c3af84af7538",
            "filename": "test/parallel/test-crypto-hmac.js",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/b54d4a68e3967f0e106af520ccd95dbc375fbf22/test%2Fparallel%2Ftest-crypto-hmac.js",
            "raw_url": "https://github.com/nodejs/node/raw/b54d4a68e3967f0e106af520ccd95dbc375fbf22/test%2Fparallel%2Ftest-crypto-hmac.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-hmac.js?ref=b54d4a68e3967f0e106af520ccd95dbc375fbf22",
            "patch": "@@ -21,6 +21,16 @@ common.expectsError(\n     message: 'The \"hmac\" argument must be of type string. Received type object'\n   });\n \n+// This used to segfault. See: https://github.com/nodejs/node/issues/9819\n+common.expectsError(\n+  () => crypto.createHmac('sha256', 'key').digest({\n+    toString: () => { throw new Error('boom'); },\n+  }),\n+  {\n+    type: Error,\n+    message: 'boom'\n+  });\n+\n common.expectsError(\n   () => crypto.createHmac('sha1', null),\n   {"
        },
        {
            "sha": "b2c95117d3b1f81066d4916ad0ac98677fb6425e",
            "filename": "test/parallel/test-crypto-tostring-segfault.js",
            "status": "removed",
            "additions": 0,
            "deletions": 27,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/3439c955abaeab503a4adf563ac5ed940665fe25/test%2Fparallel%2Ftest-crypto-tostring-segfault.js",
            "raw_url": "https://github.com/nodejs/node/raw/3439c955abaeab503a4adf563ac5ed940665fe25/test%2Fparallel%2Ftest-crypto-tostring-segfault.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-tostring-segfault.js?ref=3439c955abaeab503a4adf563ac5ed940665fe25",
            "patch": "@@ -1,27 +0,0 @@\n-'use strict';\n-const common = require('../common');\n-if (!common.hasCrypto)\n-  common.skip('missing crypto');\n-\n-// This test ensures that node doesn't SEGFAULT when either of\n-// `crypto.createHash` or `crypto.createHmac` are given an object that defines\n-// a throwing `toString`.\n-// https://github.com/nodejs/node/issues/9819\n-\n-const assert = require('assert');\n-const execFile = require('child_process').execFile;\n-\n-const setup = 'const enc = { toString: () => { throw new Error(\"xyz\"); } };';\n-\n-const scripts = [\n-  'crypto.createHash(\"sha256\").digest(enc)',\n-  'crypto.createHmac(\"sha256\", \"msg\").digest(enc)'\n-];\n-\n-scripts.forEach((script) => {\n-  const node = process.execPath;\n-  const code = `${setup};${script}`;\n-  execFile(node, [ '-e', code ], common.mustCall((err, stdout, stderr) => {\n-    assert(stderr.includes('Error: xyz'), 'digest crashes');\n-  }));\n-});"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 21,
        "deletions": 27
    }
}