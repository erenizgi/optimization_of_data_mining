{
    "author": "rpamely",
    "message": "test: dgram socket prints deprecation warnings\n\nAdds tests assert the deprecated properties\nand methods in the dgram socket warn. It\nruns each test in a separate child process\nsince each deprecation will only warn once.\n\nPR-URL: https://github.com/nodejs/node/pull/24177\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "368789fb20f8b6ee37ff86833dde6d32bce52750",
    "files": [
        {
            "sha": "89cde12fd37cf1967dba674625e8fcb926c72aa1",
            "filename": "test/parallel/test-dgram-deprecation-error.js",
            "status": "added",
            "additions": 84,
            "deletions": 0,
            "changes": 84,
            "blob_url": "https://github.com/nodejs/node/blob/368789fb20f8b6ee37ff86833dde6d32bce52750/test%2Fparallel%2Ftest-dgram-deprecation-error.js",
            "raw_url": "https://github.com/nodejs/node/raw/368789fb20f8b6ee37ff86833dde6d32bce52750/test%2Fparallel%2Ftest-dgram-deprecation-error.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-dgram-deprecation-error.js?ref=368789fb20f8b6ee37ff86833dde6d32bce52750",
            "patch": "@@ -0,0 +1,84 @@\n+'use strict';\n+\n+const assert = require('assert');\n+const common = require('../common');\n+const dgram = require('dgram');\n+const fork = require('child_process').fork;\n+\n+const sock = dgram.createSocket('udp4');\n+\n+const testNumber = parseInt(process.argv[2], 10);\n+\n+const propertiesToTest = [\n+  '_handle',\n+  '_receiving',\n+  '_bindState',\n+  '_queue',\n+  '_reuseAddr'\n+];\n+\n+const methodsToTest = [\n+  '_healthCheck',\n+  '_stopReceiving'\n+];\n+\n+const propertyCases = propertiesToTest.map((propName) => {\n+  return [\n+    () => {\n+      // Test property getter\n+      common.expectWarning(\n+        'DeprecationWarning',\n+        `Socket.prototype.${propName} is deprecated`,\n+        'DEP0112'\n+      );\n+      sock[propName];\n+    },\n+    () => {\n+      // Test property setter\n+      common.expectWarning(\n+        'DeprecationWarning',\n+        `Socket.prototype.${propName} is deprecated`,\n+        'DEP0112'\n+      );\n+      sock[propName] = null;\n+    }\n+  ];\n+});\n+\n+const methodCases = methodsToTest.map((propName) => {\n+  return () => {\n+    common.expectWarning(\n+      'DeprecationWarning',\n+      `Socket.prototype.${propName}() is deprecated`,\n+      'DEP0112'\n+    );\n+    sock[propName]();\n+  };\n+});\n+\n+const cases = [].concat(\n+  ...propertyCases,\n+  ...methodCases\n+);\n+\n+// If we weren't passed a test ID then we need to spawn all of the cases.\n+// We run the cases in child processes since deprecations print once.\n+if (Number.isNaN(testNumber)) {\n+  const children = cases.map((_case, i) =>\n+    fork(process.argv[1], [ String(i) ]));\n+\n+  children.forEach((child) => {\n+    child.on('close', (code) => {\n+      // Pass on child exit code\n+      if (code > 0) {\n+        process.exit(code);\n+      }\n+    });\n+  });\n+\n+  return;\n+}\n+\n+// We were passed a test ID - run the test case\n+assert.ok(cases[testNumber]);\n+cases[testNumber]();"
        }
    ],
    "stats": {
        "total": 84,
        "additions": 84,
        "deletions": 0
    }
}