{
    "author": "joyeecheung",
    "message": "errors: add useOriginalName to internal/errors\n\nThis allows us to tell the type of the errors without using\ninstanceof, which is necessary in WPT harness.\n\nPR-URL: https://github.com/nodejs/node/pull/22556\nReviewed-By: John-David Dalton <john.david.dalton@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "e692a098023a9966e8aa1fc6fda31fb3dee8373c",
    "files": [
        {
            "sha": "90bc54927f3de094dfb1cb8accade081b35f5642",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/e692a098023a9966e8aa1fc6fda31fb3dee8373c/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/e692a098023a9966e8aa1fc6fda31fb3dee8373c/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=e692a098023a9966e8aa1fc6fda31fb3dee8373c",
            "patch": "@@ -151,13 +151,18 @@ function makeSystemErrorWithCode(key) {\n   };\n }\n \n+let useOriginalName = false;\n+\n function makeNodeErrorWithCode(Base, key) {\n   return class NodeError extends Base {\n     constructor(...args) {\n       super(getMessage(key, args));\n     }\n \n     get name() {\n+      if (useOriginalName) {\n+        return super.name;\n+      }\n       return `${super.name} [${key}]`;\n     }\n \n@@ -437,7 +442,12 @@ module.exports = {\n   getMessage,\n   SystemError,\n   codes,\n-  E // This is exported only to facilitate testing.\n+  // This is exported only to facilitate testing.\n+  E,\n+  // This allows us to tell the type of the errors without using\n+  // instanceof, which is necessary in WPT harness.\n+  get useOriginalName() { return useOriginalName; },\n+  set useOriginalName(value) { useOriginalName = value; }\n };\n \n // To declare an error message, use the E(sym, val, def) function above. The sym"
        },
        {
            "sha": "195e39b199cd4cd8cdfb50d053e5db2332fcd752",
            "filename": "test/parallel/test-internal-error-original-names.js",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/e692a098023a9966e8aa1fc6fda31fb3dee8373c/test%2Fparallel%2Ftest-internal-error-original-names.js",
            "raw_url": "https://github.com/nodejs/node/raw/e692a098023a9966e8aa1fc6fda31fb3dee8373c/test%2Fparallel%2Ftest-internal-error-original-names.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-internal-error-original-names.js?ref=e692a098023a9966e8aa1fc6fda31fb3dee8373c",
            "patch": "@@ -0,0 +1,35 @@\n+// Flags: --expose-internals\n+\n+'use strict';\n+\n+// This tests `internal/errors.useOriginalName`\n+// This testing feature is needed to allows us to assert the types of\n+// errors without using instanceof, which is necessary in WPT harness.\n+// Refs: https://github.com/nodejs/node/pull/22556\n+\n+require('../common');\n+const assert = require('assert');\n+const errors = require('internal/errors');\n+\n+\n+errors.E('TEST_ERROR_1', 'Error for testing purposes: %s',\n+         Error);\n+{\n+  const err = new errors.codes.TEST_ERROR_1('test');\n+  assert(err instanceof Error);\n+  assert.strictEqual(err.name, 'Error [TEST_ERROR_1]');\n+}\n+\n+{\n+  errors.useOriginalName = true;\n+  const err = new errors.codes.TEST_ERROR_1('test');\n+  assert(err instanceof Error);\n+  assert.strictEqual(err.name, 'Error');\n+}\n+\n+{\n+  errors.useOriginalName = false;\n+  const err = new errors.codes.TEST_ERROR_1('test');\n+  assert(err instanceof Error);\n+  assert.strictEqual(err.name, 'Error [TEST_ERROR_1]');\n+}"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 46,
        "deletions": 1
    }
}