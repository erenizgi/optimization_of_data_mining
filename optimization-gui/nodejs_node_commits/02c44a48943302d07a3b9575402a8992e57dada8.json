{
    "author": "BridgeAR",
    "message": "assert: reduce diff noise\n\nAssertion errors that produce a diff show a diff for identical entries\nin case one side of the comparison has more object properties than the\nother one. Those lines are now taken into account and will not show up\nas diverging lines anymore.\n\nRefs: https://github.com/nodejs/node/issues/22763\n\nPR-URL: https://github.com/nodejs/node/pull/23048\nRefs: https://github.com/nodejs/node/issues/22763\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Shingo Inoue <leko.noor@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "02c44a48943302d07a3b9575402a8992e57dada8",
    "files": [
        {
            "sha": "d3155cf692eebe49b0a61eb28299d6b89a809669",
            "filename": "lib/internal/assert.js",
            "status": "modified",
            "additions": 34,
            "deletions": 21,
            "changes": 55,
            "blob_url": "https://github.com/nodejs/node/blob/02c44a48943302d07a3b9575402a8992e57dada8/lib%2Finternal%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/02c44a48943302d07a3b9575402a8992e57dada8/lib%2Finternal%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fassert.js?ref=02c44a48943302d07a3b9575402a8992e57dada8",
            "patch": "@@ -205,29 +205,42 @@ function createErrDiff(actual, expected, operator) {\n       res += `\\n${green}+${white} ${actualLines[i]}`;\n       printedLines++;\n     // Lines diverge\n-    } else if (actualLines[i] !== expectedLines[i]) {\n-      if (cur > 1 && i > 2) {\n-        if (cur > 4) {\n-          res += `\\n${blue}...${white}`;\n-          skipped = true;\n-        } else if (cur > 3) {\n-          res += `\\n  ${actualLines[i - 2]}`;\n+    } else {\n+      const expectedLine = expectedLines[i];\n+      let actualLine = actualLines[i];\n+      let divergingLines = actualLine !== expectedLine &&\n+                           (!actualLine.endsWith(',') ||\n+                            actualLine.slice(0, -1) !== expectedLine);\n+      if (divergingLines &&\n+          expectedLine.endsWith(',') &&\n+          expectedLine.slice(0, -1) === actualLine) {\n+        divergingLines = false;\n+        actualLine += ',';\n+      }\n+      if (divergingLines) {\n+        if (cur > 1 && i > 2) {\n+          if (cur > 4) {\n+            res += `\\n${blue}...${white}`;\n+            skipped = true;\n+          } else if (cur > 3) {\n+            res += `\\n  ${actualLines[i - 2]}`;\n+            printedLines++;\n+          }\n+          res += `\\n  ${actualLines[i - 1]}`;\n+          printedLines++;\n+        }\n+        lastPos = i;\n+        res += `\\n${green}+${white} ${actualLine}`;\n+        other += `\\n${red}-${white} ${expectedLine}`;\n+        printedLines += 2;\n+      // Lines are identical\n+      } else {\n+        res += other;\n+        other = '';\n+        if (cur === 1 || i === 0) {\n+          res += `\\n  ${actualLine}`;\n           printedLines++;\n         }\n-        res += `\\n  ${actualLines[i - 1]}`;\n-        printedLines++;\n-      }\n-      lastPos = i;\n-      res += `\\n${green}+${white} ${actualLines[i]}`;\n-      other += `\\n${red}-${white} ${expectedLines[i]}`;\n-      printedLines += 2;\n-    // Lines are identical\n-    } else {\n-      res += other;\n-      other = '';\n-      if (cur === 1 || i === 0) {\n-        res += `\\n  ${actualLines[i]}`;\n-        printedLines++;\n       }\n     }\n     // Inspected object to big (Show ~20 rows max)"
        },
        {
            "sha": "3a5fca74d4c2878330ccaa7a8cff283712dd7a17",
            "filename": "test/parallel/test-assert-deep.js",
            "status": "modified",
            "additions": 16,
            "deletions": 8,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/02c44a48943302d07a3b9575402a8992e57dada8/test%2Fparallel%2Ftest-assert-deep.js",
            "raw_url": "https://github.com/nodejs/node/raw/02c44a48943302d07a3b9575402a8992e57dada8/test%2Fparallel%2Ftest-assert-deep.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert-deep.js?ref=02c44a48943302d07a3b9575402a8992e57dada8",
            "patch": "@@ -65,9 +65,13 @@ assert.deepEqual(arr, buf);\n     () => assert.deepStrictEqual(buf2, buf),\n     {\n       code: 'ERR_ASSERTION',\n-      message: `${defaultMsgStartFull}\\n\\n` +\n-               '  Buffer [Uint8Array] [\\n    120,\\n    121,\\n    122,\\n' +\n-               '+   10,\\n+   prop: 1\\n-   10\\n  ]'\n+      message: `${defaultMsgStartFull} ... Lines skipped\\n\\n` +\n+               '  Buffer [Uint8Array] [\\n' +\n+               '    120,\\n' +\n+               '...\\n' +\n+               '    10,\\n' +\n+               '+   prop: 1\\n' +\n+               '  ]'\n     }\n   );\n   assert.deepEqual(buf2, buf);\n@@ -80,9 +84,13 @@ assert.deepEqual(arr, buf);\n     () => assert.deepStrictEqual(arr, arr2),\n     {\n       code: 'ERR_ASSERTION',\n-      message: `${defaultMsgStartFull}\\n\\n` +\n-               '  Uint8Array [\\n    120,\\n    121,\\n    122,\\n' +\n-               '+   10\\n-   10,\\n-   prop: 5\\n  ]'\n+      message: `${defaultMsgStartFull} ... Lines skipped\\n\\n` +\n+               '  Uint8Array [\\n' +\n+               '    120,\\n' +\n+               '...\\n' +\n+               '    10,\\n' +\n+               '-   prop: 5\\n' +\n+               '  ]'\n     }\n   );\n   assert.deepEqual(arr, arr2);\n@@ -822,7 +830,7 @@ assert.throws(\n     code: 'ERR_ASSERTION',\n     name: 'AssertionError [ERR_ASSERTION]',\n     message: `${defaultMsgStartFull}\\n\\n  ` +\n-             '{\\n+   a: 4\\n-   a: 4,\\n-   b: true\\n  }'\n+             '{\\n    a: 4,\\n-   b: true\\n  }'\n   });\n assert.throws(\n   () => assert.deepStrictEqual(['a'], { 0: 'a' }),\n@@ -891,7 +899,7 @@ assert.deepStrictEqual(obj1, obj2);\n   assert.throws(\n     () => assert.deepStrictEqual(arrProxy, [1, 2, 3]),\n     { message: `${defaultMsgStartFull}\\n\\n` +\n-               '  [\\n    1,\\n+   2\\n-   2,\\n-   3\\n  ]' }\n+               '  [\\n    1,\\n    2,\\n-   3\\n  ]' }\n   );\n   util.inspect.defaultOptions = tmp;\n "
        }
    ],
    "stats": {
        "total": 79,
        "additions": 50,
        "deletions": 29
    }
}