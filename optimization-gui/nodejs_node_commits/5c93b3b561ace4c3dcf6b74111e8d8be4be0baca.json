{
    "author": "hashseed",
    "message": "build: add option to build v8 with GN\n\nPR-URL: https://github.com/nodejs/node/pull/19201\nReviewed-By: Ali Ijaz Sheikh <ofrobots@google.com>\nReviewed-By: Myles Borins <myles.borins@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "5c93b3b561ace4c3dcf6b74111e8d8be4be0baca",
    "files": [
        {
            "sha": "480a36cc8a64461210f071599d63ede923f85b5f",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 12,
            "deletions": 3,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/5c93b3b561ace4c3dcf6b74111e8d8be4be0baca/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/5c93b3b561ace4c3dcf6b74111e8d8be4be0baca/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=5c93b3b561ace4c3dcf6b74111e8d8be4be0baca",
            "patch": "@@ -51,8 +51,8 @@\n         'obj_dir': '<(PRODUCT_DIR)/obj',\n         'v8_base': '<(PRODUCT_DIR)/obj/deps/v8/gypfiles/libv8_base.a',\n        }, {\n-         'obj_dir%': '<(PRODUCT_DIR)/obj.target',\n-         'v8_base%': '<(PRODUCT_DIR)/obj.target/deps/v8/gypfiles/libv8_base.a',\n+        'obj_dir%': '<(PRODUCT_DIR)/obj.target',\n+        'v8_base': '<(PRODUCT_DIR)/obj.target/deps/v8/gypfiles/libv8_base.a',\n       }],\n       ['OS == \"win\"', {\n         'os_posix': 0,\n@@ -63,10 +63,19 @@\n         'os_posix': 1,\n         'v8_postmortem_support%': 'true',\n       }],\n-      ['OS== \"mac\"', {\n+      ['OS == \"mac\"', {\n         'obj_dir%': '<(PRODUCT_DIR)/obj.target',\n         'v8_base': '<(PRODUCT_DIR)/libv8_base.a',\n       }],\n+      ['build_v8_with_gn == \"true\"', {\n+        'conditions': [\n+          ['GENERATOR == \"ninja\"', {\n+            'v8_base': '<(PRODUCT_DIR)/obj/deps/v8/gypfiles/v8_monolith.gen/gn/obj/libv8_monolith.a',\n+          }, {\n+            'v8_base': '<(PRODUCT_DIR)/obji.target/v8_monolith/geni/gn/obj/libv8_monolith.a',\n+          }],\n+        ],\n+      }],\n       ['openssl_fips != \"\"', {\n         'openssl_product': '<(STATIC_LIB_PREFIX)crypto<(STATIC_LIB_SUFFIX)',\n       }, {"
        },
        {
            "sha": "dbf1dfe3214ab5f99ddd3bcf0b99c3e723f1ff66",
            "filename": "configure",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/5c93b3b561ace4c3dcf6b74111e8d8be4be0baca/configure",
            "raw_url": "https://github.com/nodejs/node/raw/5c93b3b561ace4c3dcf6b74111e8d8be4be0baca/configure",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/configure?ref=5c93b3b561ace4c3dcf6b74111e8d8be4be0baca",
            "patch": "@@ -55,6 +55,10 @@ sys.path.insert(0, 'tools')\n import getmoduleversion\n from gyp_node import run_gyp\n \n+# imports in deps/v8/tools/node\n+sys.path.insert(0, os.path.join('deps', 'v8', 'tools', 'node'))\n+from fetch_deps import FetchDeps\n+\n # parse our options\n parser = optparse.OptionParser()\n \n@@ -548,6 +552,12 @@ parser.add_option('--without-bundled-v8',\n     help='do not use V8 includes from the bundled deps folder. ' +\n          '(This mode is not officially supported for regular applications)')\n \n+parser.add_option('--build-v8-with-gn',\n+    action='store_true',\n+    dest='build_v8_with_gn',\n+    default=False,\n+    help='build V8 using GN instead of gyp')\n+\n # Create compile_commands.json in out/Debug and out/Release.\n parser.add_option('-C',\n     action='store_true',\n@@ -1060,6 +1070,14 @@ def configure_v8(o):\n     o['variables']['test_isolation_mode'] = 'noop'  # Needed by d8.gyp.\n   if options.without_bundled_v8 and options.enable_d8:\n     raise Exception('--enable-d8 is incompatible with --without-bundled-v8.')\n+  if options.without_bundled_v8 and options.build_v8_with_gn:\n+    raise Exception(\n+        '--build-v8-with-gn is incompatible with --without-bundled-v8.')\n+  if options.build_v8_with_gn:\n+    v8_path = os.path.join('deps', 'v8')\n+    print('Fetching dependencies to build V8 with GN')\n+    options.build_v8_with_gn = FetchDeps(v8_path)\n+  o['variables']['build_v8_with_gn'] = b(options.build_v8_with_gn)\n \n \n def configure_openssl(o):"
        },
        {
            "sha": "e5417da015b6fcf50c463a298649c3bf60204cfd",
            "filename": "node.gypi",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/5c93b3b561ace4c3dcf6b74111e8d8be4be0baca/node.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/5c93b3b561ace4c3dcf6b74111e8d8be4be0baca/node.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gypi?ref=5c93b3b561ace4c3dcf6b74111e8d8be4be0baca",
            "patch": "@@ -59,9 +59,15 @@\n       'dependencies': [ 'deps/v8/gypfiles/d8.gyp:d8' ],\n     }],\n     [ 'node_use_bundled_v8==\"true\"', {\n-      'dependencies': [\n-        'deps/v8/gypfiles/v8.gyp:v8',\n-        'deps/v8/gypfiles/v8.gyp:v8_libplatform'\n+      'conditions': [\n+        [ 'build_v8_with_gn==\"true\"', {\n+          'dependencies': ['deps/v8/gypfiles/v8.gyp:v8_monolith'],\n+        }, {\n+          'dependencies': [\n+            'deps/v8/gypfiles/v8.gyp:v8',\n+            'deps/v8/gypfiles/v8.gyp:v8_libplatform',\n+          ],\n+        }],\n       ],\n     }],\n     [ 'node_use_v8_platform==\"true\"', {\n@@ -111,7 +117,6 @@\n       'defines': [ 'NODE_NO_BROWSER_GLOBALS' ],\n     } ],\n     [ 'node_use_bundled_v8==\"true\" and v8_postmortem_support==\"true\"', {\n-      'dependencies': [ 'deps/v8/gypfiles/v8.gyp:postmortem-metadata' ],\n       'conditions': [\n         # -force_load is not applicable for the static library\n         [ 'force_load==\"true\"', {\n@@ -121,6 +126,10 @@\n             ],\n           },\n         }],\n+        # when building with GN, the v8_monolith target already includes postmortem metadata\n+        [ 'build_v8_with_gn==\"false\"', {\n+          'dependencies': [ 'deps/v8/gypfiles/v8.gyp:postmortem-metadata' ],\n+        }],\n       ],\n     }],\n     [ 'node_shared_zlib==\"false\"', {"
        }
    ],
    "stats": {
        "total": 50,
        "additions": 43,
        "deletions": 7
    }
}