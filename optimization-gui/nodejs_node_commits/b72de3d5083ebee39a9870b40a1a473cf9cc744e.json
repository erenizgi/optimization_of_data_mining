{
    "author": "Trott",
    "message": "test: check that benchmark tests are minimal\n\nCheck that benchmark tests are not running longer than necessary by\nconfirming that they only produce one set of configs to report on per\nbenchmark file.\n\nPR-URL: https://github.com/nodejs/node/pull/21046\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "b72de3d5083ebee39a9870b40a1a473cf9cc744e",
    "files": [
        {
            "sha": "f8952a8b9ad647f3232186f5697be73ec0dd0b97",
            "filename": "test/common/benchmark.js",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/b72de3d5083ebee39a9870b40a1a473cf9cc744e/test%2Fcommon%2Fbenchmark.js",
            "raw_url": "https://github.com/nodejs/node/raw/b72de3d5083ebee39a9870b40a1a473cf9cc744e/test%2Fcommon%2Fbenchmark.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcommon%2Fbenchmark.js?ref=b72de3d5083ebee39a9870b40a1a473cf9cc744e",
            "patch": "@@ -20,10 +20,27 @@ function runBenchmark(name, args, env) {\n \n   const mergedEnv = Object.assign({}, process.env, env);\n \n-  const child = fork(runjs, argv, { env: mergedEnv });\n+  const child = fork(runjs, argv, { env: mergedEnv, stdio: 'pipe' });\n+  child.stdout.setEncoding('utf8');\n+\n+  let stdout = '';\n+  child.stdout.on('data', (line) => {\n+    stdout += line;\n+  });\n+\n   child.on('exit', (code, signal) => {\n     assert.strictEqual(code, 0);\n     assert.strictEqual(signal, null);\n+    // This bit makes sure that each benchmark file is being sent settings such\n+    // that the benchmark file runs just one set of options. This helps keep the\n+    // benchmark tests from taking a long time to run. Therefore, each benchmark\n+    // file should result in three lines of output: a blank line, a line with\n+    // the name of the benchmark file, and a line with the only results that we\n+    // get from testing the benchmark file.\n+    assert.ok(\n+      /^(?:\\n.+?\\n.+?\\n)+$/.test(stdout),\n+      `benchmark file not running exactly one configuration in test: ${stdout}`\n+    );\n   });\n }\n "
        }
    ],
    "stats": {
        "total": 19,
        "additions": 18,
        "deletions": 1
    }
}