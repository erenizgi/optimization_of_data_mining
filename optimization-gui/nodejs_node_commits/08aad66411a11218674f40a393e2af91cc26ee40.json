{
    "author": "targos",
    "message": "src,deps: add isolate parameter to String::Concat\n\nPartially backport an upstream commit that deprecates String::Concat\nwithout the isolate parameter. This overload has already been removed\nin V8 7.0.\n\nPR-URL: https://github.com/nodejs/node/pull/22521\nRefs: https://github.com/v8/v8/commit/8a011b57d8b26e9cfe1c20a2ef26adb14be6ecc2\nReviewed-By: Ujjwal Sharma <usharma1998@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "08aad66411a11218674f40a393e2af91cc26ee40",
    "files": [
        {
            "sha": "0316afe7048df0a094cb4fbcf5dc43cc068c8d1c",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/08aad66411a11218674f40a393e2af91cc26ee40/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/08aad66411a11218674f40a393e2af91cc26ee40/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=08aad66411a11218674f40a393e2af91cc26ee40",
            "patch": "@@ -29,7 +29,7 @@\n \n     # Reset this number to 0 on major V8 upgrades.\n     # Increment by one for each non-official patch applied to deps/v8.\n-    'v8_embedder_string': '-node.18',\n+    'v8_embedder_string': '-node.19',\n \n     # Enable disassembler for `--print-code` v8 options\n     'v8_enable_disassembler': 1,"
        },
        {
            "sha": "362bece11f65a2437a330878892977c5e28e5474",
            "filename": "deps/v8/include/v8.h",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/08aad66411a11218674f40a393e2af91cc26ee40/deps%2Fv8%2Finclude%2Fv8.h",
            "raw_url": "https://github.com/nodejs/node/raw/08aad66411a11218674f40a393e2af91cc26ee40/deps%2Fv8%2Finclude%2Fv8.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8.h?ref=08aad66411a11218674f40a393e2af91cc26ee40",
            "patch": "@@ -2901,7 +2901,11 @@ class V8_EXPORT String : public Name {\n    * Creates a new string by concatenating the left and the right strings\n    * passed in as parameters.\n    */\n-  static Local<String> Concat(Local<String> left, Local<String> right);\n+  static Local<String> Concat(Isolate* isolate, Local<String> left,\n+                              Local<String> right);\n+  static V8_DEPRECATE_SOON(\"Use Isolate* version\",\n+                           Local<String> Concat(Local<String> left,\n+                                                Local<String> right));\n \n   /**\n    * Creates a new external string using the data defined in the given"
        },
        {
            "sha": "5f8f3752008759558d8d633347515e4454934b75",
            "filename": "deps/v8/src/api.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/08aad66411a11218674f40a393e2af91cc26ee40/deps%2Fv8%2Fsrc%2Fapi.cc",
            "raw_url": "https://github.com/nodejs/node/raw/08aad66411a11218674f40a393e2af91cc26ee40/deps%2Fv8%2Fsrc%2Fapi.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fapi.cc?ref=08aad66411a11218674f40a393e2af91cc26ee40",
            "patch": "@@ -6646,10 +6646,10 @@ MaybeLocal<String> String::NewFromTwoByte(Isolate* isolate,\n   return result;\n }\n \n-\n-Local<String> v8::String::Concat(Local<String> left, Local<String> right) {\n+Local<String> v8::String::Concat(Isolate* v8_isolate, Local<String> left,\n+                                 Local<String> right) {\n+  i::Isolate* isolate = reinterpret_cast<i::Isolate*>(v8_isolate);\n   i::Handle<i::String> left_string = Utils::OpenHandle(*left);\n-  i::Isolate* isolate = left_string->GetIsolate();\n   ENTER_V8_NO_SCRIPT_NO_EXCEPTION(isolate);\n   LOG_API(isolate, String, Concat);\n   i::Handle<i::String> right_string = Utils::OpenHandle(*right);\n@@ -6663,6 +6663,11 @@ Local<String> v8::String::Concat(Local<String> left, Local<String> right) {\n   return Utils::ToLocal(result);\n }\n \n+Local<String> v8::String::Concat(Local<String> left, Local<String> right) {\n+  i::Handle<i::String> left_string = Utils::OpenHandle(*left);\n+  i::Isolate* isolate = left_string->GetIsolate();\n+  return Concat(reinterpret_cast<Isolate*>(isolate), left, right);\n+}\n \n MaybeLocal<String> v8::String::NewExternalTwoByte(\n     Isolate* isolate, v8::String::ExternalStringResource* resource) {"
        },
        {
            "sha": "d1c0794e82fde4fd45c71ddf51eafca5864d4787",
            "filename": "src/exceptions.cc",
            "status": "modified",
            "additions": 40,
            "deletions": 32,
            "changes": 72,
            "blob_url": "https://github.com/nodejs/node/blob/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fexceptions.cc",
            "raw_url": "https://github.com/nodejs/node/raw/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fexceptions.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fexceptions.cc?ref=08aad66411a11218674f40a393e2af91cc26ee40",
            "patch": "@@ -26,40 +26,40 @@ Local<Value> ErrnoException(Isolate* isolate,\n   Environment* env = Environment::GetCurrent(isolate);\n \n   Local<Value> e;\n-  Local<String> estring = OneByteString(env->isolate(), errno_string(errorno));\n+  Local<String> estring = OneByteString(isolate, errno_string(errorno));\n   if (msg == nullptr || msg[0] == '\\0') {\n     msg = strerror(errorno);\n   }\n-  Local<String> message = OneByteString(env->isolate(), msg);\n+  Local<String> message = OneByteString(isolate, msg);\n \n   Local<String> cons =\n-      String::Concat(estring, FIXED_ONE_BYTE_STRING(env->isolate(), \", \"));\n-  cons = String::Concat(cons, message);\n+      String::Concat(isolate, estring, FIXED_ONE_BYTE_STRING(isolate, \", \"));\n+  cons = String::Concat(isolate, cons, message);\n \n   Local<String> path_string;\n   if (path != nullptr) {\n     // FIXME(bnoordhuis) It's questionable to interpret the file path as UTF-8.\n-    path_string = String::NewFromUtf8(env->isolate(), path,\n-        v8::NewStringType::kNormal).ToLocalChecked();\n+    path_string = String::NewFromUtf8(isolate, path, v8::NewStringType::kNormal)\n+                      .ToLocalChecked();\n   }\n \n   if (path_string.IsEmpty() == false) {\n-    cons = String::Concat(cons, FIXED_ONE_BYTE_STRING(env->isolate(), \" '\"));\n-    cons = String::Concat(cons, path_string);\n-    cons = String::Concat(cons, FIXED_ONE_BYTE_STRING(env->isolate(), \"'\"));\n+    cons = String::Concat(isolate, cons, FIXED_ONE_BYTE_STRING(isolate, \" '\"));\n+    cons = String::Concat(isolate, cons, path_string);\n+    cons = String::Concat(isolate, cons, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n   }\n   e = Exception::Error(cons);\n \n   Local<Object> obj = e.As<Object>();\n-  obj->Set(env->errno_string(), Integer::New(env->isolate(), errorno));\n+  obj->Set(env->errno_string(), Integer::New(isolate, errorno));\n   obj->Set(env->code_string(), estring);\n \n   if (path_string.IsEmpty() == false) {\n     obj->Set(env->path_string(), path_string);\n   }\n \n   if (syscall != nullptr) {\n-    obj->Set(env->syscall_string(), OneByteString(env->isolate(), syscall));\n+    obj->Set(env->syscall_string(), OneByteString(isolate, syscall));\n   }\n \n   return e;\n@@ -68,10 +68,11 @@ Local<Value> ErrnoException(Isolate* isolate,\n static Local<String> StringFromPath(Isolate* isolate, const char* path) {\n #ifdef _WIN32\n   if (strncmp(path, \"\\\\\\\\?\\\\UNC\\\\\", 8) == 0) {\n-    return String::Concat(FIXED_ONE_BYTE_STRING(isolate, \"\\\\\\\\\"),\n-                          String::NewFromUtf8(isolate, path + 8,\n-                                              v8::NewStringType::kNormal)\n-                              .ToLocalChecked());\n+    return String::Concat(\n+        isolate,\n+        FIXED_ONE_BYTE_STRING(isolate, \"\\\\\\\\\"),\n+        String::NewFromUtf8(isolate, path + 8, v8::NewStringType::kNormal)\n+            .ToLocalChecked());\n   } else if (strncmp(path, \"\\\\\\\\?\\\\\", 4) == 0) {\n     return String::NewFromUtf8(isolate, path + 4, v8::NewStringType::kNormal)\n         .ToLocalChecked();\n@@ -109,25 +110,31 @@ Local<Value> UVException(Isolate* isolate,\n   Local<String> js_dest;\n \n   Local<String> js_msg = js_code;\n-  js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \": \"));\n-  js_msg = String::Concat(js_msg, OneByteString(isolate, msg));\n-  js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \", \"));\n-  js_msg = String::Concat(js_msg, js_syscall);\n+  js_msg =\n+      String::Concat(isolate, js_msg, FIXED_ONE_BYTE_STRING(isolate, \": \"));\n+  js_msg = String::Concat(isolate, js_msg, OneByteString(isolate, msg));\n+  js_msg =\n+      String::Concat(isolate, js_msg, FIXED_ONE_BYTE_STRING(isolate, \", \"));\n+  js_msg = String::Concat(isolate, js_msg, js_syscall);\n \n   if (path != nullptr) {\n     js_path = StringFromPath(isolate, path);\n \n-    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \" '\"));\n-    js_msg = String::Concat(js_msg, js_path);\n-    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n+    js_msg =\n+        String::Concat(isolate, js_msg, FIXED_ONE_BYTE_STRING(isolate, \" '\"));\n+    js_msg = String::Concat(isolate, js_msg, js_path);\n+    js_msg =\n+        String::Concat(isolate, js_msg, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n   }\n \n   if (dest != nullptr) {\n     js_dest = StringFromPath(isolate, dest);\n \n-    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \" -> '\"));\n-    js_msg = String::Concat(js_msg, js_dest);\n-    js_msg = String::Concat(js_msg, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n+    js_msg = String::Concat(\n+        isolate, js_msg, FIXED_ONE_BYTE_STRING(isolate, \" -> '\"));\n+    js_msg = String::Concat(isolate, js_msg, js_dest);\n+    js_msg =\n+        String::Concat(isolate, js_msg, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n   }\n \n   Local<Object> e = Exception::Error(js_msg)->ToObject(isolate);\n@@ -182,17 +189,18 @@ Local<Value> WinapiErrnoException(Isolate* isolate,\n   if (!msg || !msg[0]) {\n     msg = winapi_strerror(errorno, &must_free);\n   }\n-  Local<String> message = OneByteString(env->isolate(), msg);\n+  Local<String> message = OneByteString(isolate, msg);\n \n   if (path) {\n     Local<String> cons1 =\n-        String::Concat(message, FIXED_ONE_BYTE_STRING(isolate, \" '\"));\n-    Local<String> cons2 =\n-        String::Concat(cons1,\n-            String::NewFromUtf8(isolate, path, v8::NewStringType::kNormal)\n-                .ToLocalChecked());\n+        String::Concat(isolate, message, FIXED_ONE_BYTE_STRING(isolate, \" '\"));\n+    Local<String> cons2 = String::Concat(\n+        isolate,\n+        cons1,\n+        String::NewFromUtf8(isolate, path, v8::NewStringType::kNormal)\n+            .ToLocalChecked());\n     Local<String> cons3 =\n-        String::Concat(cons2, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n+        String::Concat(isolate, cons2, FIXED_ONE_BYTE_STRING(isolate, \"'\"));\n     e = Exception::Error(cons3);\n   } else {\n     e = Exception::Error(message);"
        },
        {
            "sha": "25dc8d2bbef6ee685aeb0b4843bac6055b454f17",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=08aad66411a11218674f40a393e2af91cc26ee40",
            "patch": "@@ -1380,8 +1380,8 @@ static void DLOpen(const FunctionCallbackInfo<Value>& args) {\n     dlib.Close();\n #ifdef _WIN32\n     // Windows needs to add the filename into the error message\n-    errmsg = String::Concat(errmsg,\n-                            args[1]->ToString(context).ToLocalChecked());\n+    errmsg = String::Concat(\n+        env->isolate(), errmsg, args[1]->ToString(context).ToLocalChecked());\n #endif  // _WIN32\n     env->isolate()->ThrowException(Exception::Error(errmsg));\n     return;"
        },
        {
            "sha": "d966e59691829123db1f058da57b67e29f88fbfa",
            "filename": "src/node_api.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fnode_api.cc",
            "raw_url": "https://github.com/nodejs/node/raw/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fnode_api.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_api.cc?ref=08aad66411a11218674f40a393e2af91cc26ee40",
            "patch": "@@ -1838,14 +1838,16 @@ static napi_status set_error_code(napi_env env,\n     if (!maybe_name.IsEmpty()) {\n       v8::Local<v8::Value> name = maybe_name.ToLocalChecked();\n       if (name->IsString()) {\n-        name_string = v8::String::Concat(name_string, name.As<v8::String>());\n+        name_string =\n+            v8::String::Concat(isolate, name_string, name.As<v8::String>());\n       }\n     }\n-    name_string = v8::String::Concat(name_string,\n-                                     FIXED_ONE_BYTE_STRING(isolate, \" [\"));\n-    name_string = v8::String::Concat(name_string, code_value.As<v8::String>());\n-    name_string = v8::String::Concat(name_string,\n-                                     FIXED_ONE_BYTE_STRING(isolate, \"]\"));\n+    name_string = v8::String::Concat(\n+        isolate, name_string, FIXED_ONE_BYTE_STRING(isolate, \" [\"));\n+    name_string =\n+        v8::String::Concat(isolate, name_string, code_value.As<v8::String>());\n+    name_string = v8::String::Concat(\n+        isolate, name_string, FIXED_ONE_BYTE_STRING(isolate, \"]\"));\n \n     set_maybe = err_object->Set(context, name_key, name_string);\n     RETURN_STATUS_IF_FALSE(env,"
        },
        {
            "sha": "ce9f5eb2f792e91ccc9fc31d77d04adb9b8e8399",
            "filename": "src/node_contextify.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fnode_contextify.cc",
            "raw_url": "https://github.com/nodejs/node/raw/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fnode_contextify.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_contextify.cc?ref=08aad66411a11218674f40a393e2af91cc26ee40",
            "patch": "@@ -898,8 +898,10 @@ class ContextifyScript : public BaseObject {\n     }\n \n     Local<String> decorated_stack = String::Concat(\n-        String::Concat(arrow.As<String>(),\n-          FIXED_ONE_BYTE_STRING(env->isolate(), \"\\n\")),\n+        env->isolate(),\n+        String::Concat(env->isolate(),\n+                       arrow.As<String>(),\n+                       FIXED_ONE_BYTE_STRING(env->isolate(), \"\\n\")),\n         stack.As<String>());\n     err_obj->Set(env->stack_string(), decorated_stack);\n     err_obj->SetPrivate("
        },
        {
            "sha": "b75169ff00cafb5352a85addc2ccf41b9db7a69a",
            "filename": "src/string_decoder.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fstring_decoder.cc",
            "raw_url": "https://github.com/nodejs/node/raw/08aad66411a11218674f40a393e2af91cc26ee40/src%2Fstring_decoder.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstring_decoder.cc?ref=08aad66411a11218674f40a393e2af91cc26ee40",
            "patch": "@@ -226,7 +226,7 @@ MaybeLocal<String> StringDecoder::DecodeData(Isolate* isolate,\n     if (prepend.IsEmpty()) {\n       return body;\n     } else {\n-      return String::Concat(prepend, body);\n+      return String::Concat(isolate, prepend, body);\n     }\n   } else {\n     CHECK(Encoding() == ASCII || Encoding() == HEX || Encoding() == LATIN1);"
        }
    ],
    "stats": {
        "total": 117,
        "additions": 69,
        "deletions": 48
    }
}