{
    "author": "addaleax",
    "message": "src: remove public API for option variables\n\nPR-URL: https://github.com/nodejs/node/pull/23069\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Shingo Inoue <leko.noor@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>",
    "sha": "cc31d8b2d4d439955ba25dfdc83c8445ce0c850d",
    "files": [
        {
            "sha": "b8da26fa73582537cdfe71d6e9c805c2d1ecbd2a",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 24,
            "changes": 26,
            "blob_url": "https://github.com/nodejs/node/blob/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=cc31d8b2d4d439955ba25dfdc83c8445ce0c850d",
            "patch": "@@ -610,7 +610,7 @@ bool SafeGetenv(const char* key, std::string* text) {\n \n \n void* ArrayBufferAllocator::Allocate(size_t size) {\n-  if (zero_fill_field_ || zero_fill_all_buffers)\n+  if (zero_fill_field_ || per_process_opts->zero_fill_all_buffers)\n     return UncheckedCalloc(size);\n   else\n     return UncheckedMalloc(size);\n@@ -1920,8 +1920,7 @@ void SetupProcessObject(Environment* env,\n   }\n \n   // --no-deprecation\n-  // TODO(addaleax): Uncomment the commented part.\n-  if (/*env->options()->*/no_deprecation) {\n+  if (env->options()->no_deprecation) {\n     READONLY_PROPERTY(process, \"noDeprecation\", True(env->isolate()));\n   }\n \n@@ -2442,16 +2441,6 @@ inline void PlatformInit() {\n #endif  // _WIN32\n }\n \n-// TODO(addaleax): Remove, both from the public API and in implementation.\n-bool no_deprecation = false;\n-#if HAVE_OPENSSL\n-bool ssl_openssl_cert_store = false;\n-#if NODE_FIPS_MODE\n-bool enable_fips_crypto = false;\n-bool force_fips_crypto = false;\n-#endif\n-#endif\n-\n void ProcessArgv(std::vector<std::string>* args,\n                  std::vector<std::string>* exec_args,\n                  bool is_env) {\n@@ -2535,17 +2524,6 @@ void ProcessArgv(std::vector<std::string>* args,\n   if (v8_args_as_char_ptr.size() > 1) {\n     exit(9);\n   }\n-\n-  // TODO(addaleax): Remove.\n-  zero_fill_all_buffers = per_process_opts->zero_fill_all_buffers;\n-  no_deprecation = per_process_opts->per_isolate->per_env->no_deprecation;\n-#if HAVE_OPENSSL\n-  ssl_openssl_cert_store = per_process_opts->ssl_openssl_cert_store;\n-#if NODE_FIPS_MODE\n-  enable_fips_crypto = per_process_opts->enable_fips_crypto;\n-  force_fips_crypto = per_process_opts->force_fips_crypto;\n-#endif\n-#endif\n }\n \n "
        },
        {
            "sha": "eceabdc4e3286aaa671a508c9952406f9557edd0",
            "filename": "src/node.h",
            "status": "modified",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode.h",
            "raw_url": "https://github.com/nodejs/node/raw/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.h?ref=cc31d8b2d4d439955ba25dfdc83c8445ce0c850d",
            "patch": "@@ -202,20 +202,6 @@ typedef intptr_t ssize_t;\n \n namespace node {\n \n-// TODO(addaleax): Remove all of these.\n-NODE_DEPRECATED(\"use command-line flags\",\n-                NODE_EXTERN extern bool no_deprecation);\n-#if HAVE_OPENSSL\n-NODE_DEPRECATED(\"use command-line flags\",\n-                NODE_EXTERN extern bool ssl_openssl_cert_store);\n-# if NODE_FIPS_MODE\n-NODE_DEPRECATED(\"use command-line flags\",\n-                NODE_EXTERN extern bool enable_fips_crypto);\n-NODE_DEPRECATED(\"user command-line flags\",\n-                NODE_EXTERN extern bool force_fips_crypto);\n-# endif\n-#endif\n-\n // TODO(addaleax): Officially deprecate this and replace it with something\n // better suited for a public embedder API.\n NODE_EXTERN int Start(int argc, char* argv[]);"
        },
        {
            "sha": "e3a1515d6a355023daca9b8fec327aabbb9c6c47",
            "filename": "src/node_buffer.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode_buffer.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode_buffer.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_buffer.cc?ref=cc31d8b2d4d439955ba25dfdc83c8445ce0c850d",
            "patch": "@@ -56,14 +56,12 @@\n \n namespace node {\n \n-// if true, all Buffer and SlowBuffer instances will automatically zero-fill\n-bool zero_fill_all_buffers = false;\n-\n namespace {\n \n inline void* BufferMalloc(size_t length) {\n-  return zero_fill_all_buffers ? node::UncheckedCalloc(length) :\n-                                 node::UncheckedMalloc(length);\n+  return per_process_opts->zero_fill_all_buffers ?\n+      node::UncheckedCalloc(length) :\n+      node::UncheckedMalloc(length);\n }\n \n }  // namespace"
        },
        {
            "sha": "122afc37709f73fb04fef5c1cb2fc6a4ef84a65d",
            "filename": "src/node_buffer.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode_buffer.h",
            "raw_url": "https://github.com/nodejs/node/raw/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode_buffer.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_buffer.h?ref=cc31d8b2d4d439955ba25dfdc83c8445ce0c850d",
            "patch": "@@ -27,10 +27,6 @@\n \n namespace node {\n \n-// TODO(addaleax): Remove this.\n-NODE_DEPRECATED(\"use command-line flags\",\n-                extern bool zero_fill_all_buffers);\n-\n namespace Buffer {\n \n static const unsigned int kMaxLength = v8::TypedArray::kMaxLength;"
        },
        {
            "sha": "c3592dc3e8803dd4d5d27615033186e0504654eb",
            "filename": "src/node_config.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode_config.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode_config.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_config.cc?ref=cc31d8b2d4d439955ba25dfdc83c8445ce0c850d",
            "patch": "@@ -56,7 +56,7 @@ static void Initialize(Local<Object> target,\n #ifdef NODE_FIPS_MODE\n   READONLY_BOOLEAN_PROPERTY(\"fipsMode\");\n   // TODO(addaleax): Use options parser variable instead.\n-  if (force_fips_crypto)\n+  if (per_process_opts->force_fips_crypto)\n     READONLY_BOOLEAN_PROPERTY(\"fipsForced\");\n #endif\n "
        },
        {
            "sha": "8b3aa470a48e273b1edf340d526d10416dec2ba0",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cc31d8b2d4d439955ba25dfdc83c8445ce0c850d/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=cc31d8b2d4d439955ba25dfdc83c8445ce0c850d",
            "patch": "@@ -751,9 +751,7 @@ static X509_STORE* NewRootCertStore() {\n   if (*system_cert_path != '\\0') {\n     X509_STORE_load_locations(store, system_cert_path, nullptr);\n   }\n-  // TODO(addaleax): Replace `ssl_openssl_cert_store` with\n-  // `per_process_opts->ssl_openssl_cert_store`.\n-  if (ssl_openssl_cert_store) {\n+  if (per_process_opts->ssl_openssl_cert_store) {\n     X509_STORE_set_default_paths(store);\n   } else {\n     for (X509* cert : root_certs_vector) {\n@@ -5585,10 +5583,8 @@ void InitCryptoOnce() {\n #ifdef NODE_FIPS_MODE\n   /* Override FIPS settings in cnf file, if needed. */\n   unsigned long err = 0;  // NOLINT(runtime/int)\n-  // TODO(addaleax): Use commented part instead.\n-  /*if (per_process_opts->enable_fips_crypto ||\n-      per_process_opts->force_fips_crypto) {*/\n-  if (enable_fips_crypto || force_fips_crypto) {\n+  if (per_process_opts->enable_fips_crypto ||\n+      per_process_opts->force_fips_crypto) {\n     if (0 == FIPS_mode() && !FIPS_mode_set(1)) {\n       err = ERR_get_error();\n     }\n@@ -5651,8 +5647,7 @@ void GetFipsCrypto(const FunctionCallbackInfo<Value>& args) {\n }\n \n void SetFipsCrypto(const FunctionCallbackInfo<Value>& args) {\n-  // TODO(addaleax): Use options parser variables instead.\n-  CHECK(!force_fips_crypto);\n+  CHECK(!per_process_opts->force_fips_crypto);\n   Environment* env = Environment::GetCurrent(args);\n   const bool enabled = FIPS_mode();\n   bool enable;"
        }
    ],
    "stats": {
        "total": 67,
        "additions": 10,
        "deletions": 57
    }
}