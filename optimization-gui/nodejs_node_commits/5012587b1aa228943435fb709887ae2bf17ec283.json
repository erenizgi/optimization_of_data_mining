{
    "author": "cjihrig",
    "message": "fs: fix promises reads with pos > 4GB\n\nPR-URL: https://github.com/nodejs/node/pull/21148\nFixes: https://github.com/nodejs/node/issues/21121\nRefs: https://github.com/nodejs/node/pull/21003\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Ujjwal Sharma <usharma1998@gmail.com>",
    "sha": "5012587b1aa228943435fb709887ae2bf17ec283",
    "files": [
        {
            "sha": "54a69aa02679e0e1b89381086fa8018e2121b448",
            "filename": "lib/internal/fs/promises.js",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/5012587b1aa228943435fb709887ae2bf17ec283/lib%2Finternal%2Ffs%2Fpromises.js",
            "raw_url": "https://github.com/nodejs/node/raw/5012587b1aa228943435fb709887ae2bf17ec283/lib%2Finternal%2Ffs%2Fpromises.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Fpromises.js?ref=5012587b1aa228943435fb709887ae2bf17ec283",
            "patch": "@@ -31,7 +31,6 @@ const {\n   validatePath\n } = require('internal/fs/utils');\n const {\n-  isUint32,\n   validateMode,\n   validateInteger,\n   validateUint32\n@@ -211,7 +210,7 @@ async function read(handle, buffer, offset, length, position) {\n \n   validateOffsetLengthRead(offset, length, buffer.length);\n \n-  if (!isUint32(position))\n+  if (!Number.isSafeInteger(position))\n     position = -1;\n \n   const bytesRead = (await binding.read(handle.fd, buffer, offset, length,"
        },
        {
            "sha": "621e63c075a2569d1bdaaa728d8f1ee95c2c8932",
            "filename": "test/parallel/test-fs-promises-file-handle-read.js",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/5012587b1aa228943435fb709887ae2bf17ec283/test%2Fparallel%2Ftest-fs-promises-file-handle-read.js",
            "raw_url": "https://github.com/nodejs/node/raw/5012587b1aa228943435fb709887ae2bf17ec283/test%2Fparallel%2Ftest-fs-promises-file-handle-read.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-promises-file-handle-read.js?ref=5012587b1aa228943435fb709887ae2bf17ec283",
            "patch": "@@ -8,6 +8,7 @@ const common = require('../common');\n const fs = require('fs');\n const { open } = fs.promises;\n const path = require('path');\n+const fixtures = require('../common/fixtures');\n const tmpdir = require('../common/tmpdir');\n const assert = require('assert');\n const tmpDir = tmpdir.path;\n@@ -40,6 +41,19 @@ async function validateEmptyRead() {\n   assert.deepStrictEqual(buffer.length, readAsyncHandle.bytesRead);\n }\n \n+async function validateLargeRead() {\n+  // Reading beyond file length (3 in this case) should return no data.\n+  // This is a test for a bug where reads > uint32 would return data\n+  // from the current position in the file.\n+  const filePath = fixtures.path('x.txt');\n+  const fileHandle = await open(filePath, 'r');\n+  const pos = 0xffffffff + 1; // max-uint32 + 1\n+  const readHandle = await fileHandle.read(Buffer.alloc(1), 0, 1, pos);\n+\n+  assert.strictEqual(readHandle.bytesRead, 0);\n+}\n+\n validateRead()\n   .then(validateEmptyRead)\n+  .then(validateLargeRead)\n   .then(common.mustCall());"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 15,
        "deletions": 2
    }
}