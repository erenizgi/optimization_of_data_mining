{
    "author": "srl295",
    "message": "tools, icu: actually failover if there are multiple URLs\n\nBuilding on #23269, if multiple ICU download URLs are present, try the\nnext one in case of error.\n\nPart of the ICU 63.1 bump, but independent code-wise.\nhttps://github.com/nodejs/node/issues/23244\n\nPR-URL: https://github.com/nodejs/node/pull/23715\nFixes: https://github.com/nodejs/node/issues/22344\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Michael Dawson <michael_dawson@ca.ibm.com>",
    "sha": "d8f2d2726143ecfbf99b90b7bbbc6f41b3cd95fc",
    "files": [
        {
            "sha": "5bc53630f3985bd908c1e4ea9d4a9ab47d35a582",
            "filename": "configure.py",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/d8f2d2726143ecfbf99b90b7bbbc6f41b3cd95fc/configure.py",
            "raw_url": "https://github.com/nodejs/node/raw/d8f2d2726143ecfbf99b90b7bbbc6f41b3cd95fc/configure.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/configure.py?ref=d8f2d2726143ecfbf99b90b7bbbc6f41b3cd95fc",
            "patch": "@@ -1287,8 +1287,8 @@ def icu_download(path):\n         if (md5 == gotmd5):\n           return targetfile\n         else:\n-          error('Expected: %s      *MISMATCH*' % md5)\n-          error('\\n ** Corrupted ZIP? Delete %s to retry download.\\n' % targetfile)\n+          warn('Expected: %s      *MISMATCH*' % md5)\n+          warn('\\n ** Corrupted ZIP? Delete %s to retry download.\\n' % targetfile)\n     return None\n   icu_config = {\n     'variables': {}\n@@ -1432,11 +1432,12 @@ def write_config(data, name):\n   # ICU source dir relative to tools/icu (for .gyp file)\n   o['variables']['icu_path'] = icu_full_path\n   if not os.path.isdir(icu_full_path):\n-    warn('* ECMA-402 (Intl) support didn\\'t find ICU in %s..' % icu_full_path)\n     # can we download (or find) a zipfile?\n     localzip = icu_download(icu_full_path)\n     if localzip:\n       nodedownload.unpack(localzip, icu_parent_path)\n+    else:\n+      warn('* ECMA-402 (Intl) support didn\\'t find ICU in %s..' % icu_full_path)\n   if not os.path.isdir(icu_full_path):\n     error('''Cannot build Intl without ICU in %s.\n        Fix, or disable with \"--with-intl=none\"''' % icu_full_path)"
        },
        {
            "sha": "e3fe2c517cc1bb275b1564f643d861ae3833b0a9",
            "filename": "tools/configure.d/nodedownload.py",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/d8f2d2726143ecfbf99b90b7bbbc6f41b3cd95fc/tools%2Fconfigure.d%2Fnodedownload.py",
            "raw_url": "https://github.com/nodejs/node/raw/d8f2d2726143ecfbf99b90b7bbbc6f41b3cd95fc/tools%2Fconfigure.d%2Fnodedownload.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fconfigure.d%2Fnodedownload.py?ref=d8f2d2726143ecfbf99b90b7bbbc6f41b3cd95fc",
            "patch": "@@ -1,6 +1,7 @@\n #!/usr/bin/env python\n # Moved some utilities here from ../../configure\n \n+from __future__ import print_function\n import urllib\n import hashlib\n import sys\n@@ -36,10 +37,13 @@ def retrievefile(url, targetfile):\n         sys.stdout.write(' <%s>\\nConnecting...\\r' % url)\n         sys.stdout.flush()\n         ConfigOpener().retrieve(url, targetfile, reporthook=reporthook)\n-        print ''  # clear the line\n+        print('')  # clear the line\n         return targetfile\n+    except IOError as err:\n+        print(' ** IOError %s\\n' % err)\n+        return None\n     except:\n-        print ' ** Error occurred while downloading\\n <%s>' % url\n+        print(' ** Error occurred while downloading\\n <%s>' % url)\n         raise\n \n def md5sum(targetfile):\n@@ -56,12 +60,12 @@ def unpack(packedfile, parent_path):\n     \"\"\"Unpacks packedfile into parent_path. Assumes .zip. Returns parent_path\"\"\"\n     if zipfile.is_zipfile(packedfile):\n         with contextlib.closing(zipfile.ZipFile(packedfile, 'r')) as icuzip:\n-            print ' Extracting zipfile: %s' % packedfile\n+            print(' Extracting zipfile: %s' % packedfile)\n             icuzip.extractall(parent_path)\n             return parent_path\n     elif tarfile.is_tarfile(packedfile):\n         with contextlib.closing(tarfile.TarFile.open(packedfile, 'r')) as icuzip:\n-            print ' Extracting tarfile: %s' % packedfile\n+            print(' Extracting tarfile: %s' % packedfile)\n             icuzip.extractall(parent_path)\n             return parent_path\n     else:\n@@ -112,7 +116,7 @@ def parse(opt):\n         theRet[anOpt] = True\n       else:\n         # future proof: ignore unknown types\n-        print 'Warning: ignoring unknown --download= type \"%s\"' % anOpt\n+        print('Warning: ignoring unknown --download= type \"%s\"' % anOpt)\n   # all done\n   return theRet\n \n@@ -122,6 +126,6 @@ def candownload(auto_downloads, package):\n   if auto_downloads[package]:\n     return True\n   else:\n-    print \"\"\"Warning: Not downloading package \"%s\". You could pass \"--download=all\"\n-    (Windows: \"download-all\") to try auto-downloading it.\"\"\" % package\n+    print(\"\"\"Warning: Not downloading package \"%s\". You could pass \"--download=all\"\n+    (Windows: \"download-all\") to try auto-downloading it.\"\"\" % package)\n     return False"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 15,
        "deletions": 10
    }
}