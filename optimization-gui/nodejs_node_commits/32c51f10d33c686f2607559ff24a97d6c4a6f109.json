{
    "author": "BridgeAR",
    "message": "stream: make the pipeline callback mandatory\n\nRight now when not adding a callback to the pipeline it could cause\nan uncaught exception if there is an error. Instead, just make the\ncallback mandatory as mostly done in all other Node.js callback APIs\nso users explicitly have to decide what to do in such situations.\n\nPR-URL: https://github.com/nodejs/node/pull/21054\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "32c51f10d33c686f2607559ff24a97d6c4a6f109",
    "files": [
        {
            "sha": "09ff2c02b1885badaeb595e04d4c5d2bdfe9ec2c",
            "filename": "doc/api/stream.md",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/32c51f10d33c686f2607559ff24a97d6c4a6f109/doc%2Fapi%2Fstream.md",
            "raw_url": "https://github.com/nodejs/node/raw/32c51f10d33c686f2607559ff24a97d6c4a6f109/doc%2Fapi%2Fstream.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fstream.md?ref=32c51f10d33c686f2607559ff24a97d6c4a6f109",
            "patch": "@@ -1340,14 +1340,14 @@ run().catch(console.error);\n rs.resume(); // drain the stream\n ```\n \n-### stream.pipeline(...streams[, callback])\n+### stream.pipeline(...streams, callback)\n <!-- YAML\n added: v10.0.0\n -->\n \n * `...streams` {Stream} Two or more streams to pipe between.\n-* `callback` {Function} A callback function that takes an optional error\n-  argument.\n+* `callback` {Function} Called when the pipeline is fully done.\n+  * `err` {Error}\n \n A module method to pipe between streams forwarding errors and properly cleaning\n up and provide a callback when the pipeline is complete."
        },
        {
            "sha": "caa4042339bd377471f2769c4778d4cacb614486",
            "filename": "lib/internal/streams/pipeline.js",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/32c51f10d33c686f2607559ff24a97d6c4a6f109/lib%2Finternal%2Fstreams%2Fpipeline.js",
            "raw_url": "https://github.com/nodejs/node/raw/32c51f10d33c686f2607559ff24a97d6c4a6f109/lib%2Finternal%2Fstreams%2Fpipeline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fstreams%2Fpipeline.js?ref=32c51f10d33c686f2607559ff24a97d6c4a6f109",
            "patch": "@@ -6,6 +6,7 @@\n let eos;\n \n const {\n+  ERR_INVALID_CALLBACK,\n   ERR_MISSING_ARGS,\n   ERR_STREAM_DESTROYED\n } = require('internal/errors').codes;\n@@ -19,11 +20,6 @@ function once(callback) {\n   };\n }\n \n-function noop(err) {\n-  // Rethrow the error if it exists to avoid swallowing it\n-  if (err) throw err;\n-}\n-\n function isRequest(stream) {\n   return stream.setHeader && typeof stream.abort === 'function';\n }\n@@ -66,8 +62,11 @@ function pipe(from, to) {\n }\n \n function popCallback(streams) {\n-  if (!streams.length) return noop;\n-  if (typeof streams[streams.length - 1] !== 'function') return noop;\n+  // Streams should never be an empty array. It should always contain at least\n+  // a single stream. Therefore optimize for the average case instead of\n+  // checking for length === 0 as well.\n+  if (typeof streams[streams.length - 1] !== 'function')\n+    throw new ERR_INVALID_CALLBACK();\n   return streams.pop();\n }\n "
        },
        {
            "sha": "f735054e88e9b84a4ec828b82d0ca31e728768c4",
            "filename": "test/parallel/test-stream-pipeline.js",
            "status": "modified",
            "additions": 5,
            "deletions": 14,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/32c51f10d33c686f2607559ff24a97d6c4a6f109/test%2Fparallel%2Ftest-stream-pipeline.js",
            "raw_url": "https://github.com/nodejs/node/raw/32c51f10d33c686f2607559ff24a97d6c4a6f109/test%2Fparallel%2Ftest-stream-pipeline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-pipeline.js?ref=32c51f10d33c686f2607559ff24a97d6c4a6f109",
            "patch": "@@ -60,7 +60,7 @@ common.crashOnUnhandledRejection();\n   }, /ERR_MISSING_ARGS/);\n   assert.throws(() => {\n     pipeline();\n-  }, /ERR_MISSING_ARGS/);\n+  }, /ERR_INVALID_CALLBACK/);\n }\n \n {\n@@ -493,17 +493,8 @@ common.crashOnUnhandledRejection();\n     }\n   });\n \n-  read.on('close', common.mustCall());\n-  transform.on('close', common.mustCall());\n-  write.on('close', common.mustCall());\n-\n-  process.on('uncaughtException', common.mustCall((err) => {\n-    assert.deepStrictEqual(err, new Error('kaboom'));\n-  }));\n-\n-  const dst = pipeline(read, transform, write);\n-\n-  assert.strictEqual(dst, write);\n-\n-  read.push('hello');\n+  assert.throws(\n+    () => pipeline(read, transform, write),\n+    { code: 'ERR_INVALID_CALLBACK' }\n+  );\n }"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 14,
        "deletions": 24
    }
}