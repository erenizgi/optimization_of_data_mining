{
    "author": "targos",
    "message": "tools: fix test-npm-package\n\nMigrate the script to the new common tmpDir API.\n\nPR-URL: https://github.com/nodejs/node/pull/19293\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Myles Borins <myles.borins@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Daijiro Wachi <daijiro.wachi@gmail.com>",
    "sha": "0acdd8402614ce39a95a798b7e2898972332c4c7",
    "files": [
        {
            "sha": "0cf9700ef96e8007f711651890714da8e1f369cc",
            "filename": "tools/test-npm-package.js",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/0acdd8402614ce39a95a798b7e2898972332c4c7/tools%2Ftest-npm-package.js",
            "raw_url": "https://github.com/nodejs/node/raw/0acdd8402614ce39a95a798b7e2898972332c4c7/tools%2Ftest-npm-package.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Ftest-npm-package.js?ref=0acdd8402614ce39a95a798b7e2898972332c4c7",
            "patch": "@@ -22,6 +22,7 @@ const { createWriteStream, mkdirSync, rmdirSync } = require('fs');\n const path = require('path');\n \n const common = require('../test/common');\n+const tmpDir = require('../test/common/tmpdir');\n \n const projectDir = path.resolve(__dirname, '..');\n const npmBin = path.join(projectDir, 'deps', 'npm', 'bin', 'npm-cli.js');\n@@ -39,15 +40,14 @@ function spawnCopyDeepSync(source, destination) {\n function runNPMPackageTests({ srcDir, install, rebuild, testArgs, logfile }) {\n   // Make sure we don't conflict with concurrent test runs\n   const srcHash = createHash('md5').update(srcDir).digest('hex');\n-  common.tmpDir = `${common.tmpDir}.npm.${srcHash}`;\n-  common.refreshTmpDir();\n+  tmpDir.path = `${tmpDir.path}.npm.${srcHash}`;\n+  tmpDir.refresh();\n \n-  const tmpDir = common.tmpDir;\n-  const npmCache = path.join(tmpDir, 'npm-cache');\n-  const npmPrefix = path.join(tmpDir, 'npm-prefix');\n-  const npmTmp = path.join(tmpDir, 'npm-tmp');\n-  const npmUserconfig = path.join(tmpDir, 'npm-userconfig');\n-  const pkgDir = path.join(tmpDir, 'pkg');\n+  const npmCache = path.join(tmpDir.path, 'npm-cache');\n+  const npmPrefix = path.join(tmpDir.path, 'npm-prefix');\n+  const npmTmp = path.join(tmpDir.path, 'npm-tmp');\n+  const npmUserconfig = path.join(tmpDir.path, 'npm-userconfig');\n+  const pkgDir = path.join(tmpDir.path, 'pkg');\n \n   spawnCopyDeepSync(srcDir, pkgDir);\n \n@@ -63,10 +63,10 @@ function runNPMPackageTests({ srcDir, install, rebuild, testArgs, logfile }) {\n   };\n \n   if (common.isWindows) {\n-    npmOptions.env.home = tmpDir;\n+    npmOptions.env.home = tmpDir.path;\n     npmOptions.env.Path = `${nodePath};${process.env.Path}`;\n   } else {\n-    npmOptions.env.HOME = tmpDir;\n+    npmOptions.env.HOME = tmpDir.path;\n     npmOptions.env.PATH = `${nodePath}:${process.env.PATH}`;\n   }\n \n@@ -102,8 +102,8 @@ function runNPMPackageTests({ srcDir, install, rebuild, testArgs, logfile }) {\n   }\n \n   testChild.on('exit', () => {\n-    common.refreshTmpDir();\n-    rmdirSync(tmpDir);\n+    tmpDir.refresh();\n+    rmdirSync(tmpDir.path);\n   });\n }\n "
        }
    ],
    "stats": {
        "total": 24,
        "additions": 12,
        "deletions": 12
    }
}