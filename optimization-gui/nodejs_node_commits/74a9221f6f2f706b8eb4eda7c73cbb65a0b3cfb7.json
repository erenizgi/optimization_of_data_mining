{
    "author": "joyeecheung",
    "message": "test: split test-whatwg-encoding-textdecoder.js\n\nSplit test-whatwg-encoding-textdecoder.js into:\n\n- `test-whatwg-encoding-custom-textdecoder.js` which tests\n  Node.js-specific behaviors\n- `test-whatwg-encoding-custom-textdecoder-api-invalid-label.js` which\n  is a customized version of the WPT counterpart\n- `test-whatwg-encoding-custom-api-basics.js` which is the part of\n  `test-whatwg-encoding-api-basics.js` that can be run without ICU\n- `test-whatwg-encoding-api-basics.js` which can be replaced with WPT\n  later.\n\nPR-URL: https://github.com/nodejs/node/pull/25155\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7",
    "files": [
        {
            "sha": "8abaee817156f4ca1582ad2adcfc6f5cd27de8e4",
            "filename": "test/parallel/test-whatwg-encoding-api-basics.js",
            "status": "added",
            "additions": 74,
            "deletions": 0,
            "changes": 74,
            "blob_url": "https://github.com/nodejs/node/blob/74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7/test%2Fparallel%2Ftest-whatwg-encoding-api-basics.js",
            "raw_url": "https://github.com/nodejs/node/raw/74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7/test%2Fparallel%2Ftest-whatwg-encoding-api-basics.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-api-basics.js?ref=74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7",
            "patch": "@@ -0,0 +1,74 @@\n+'use strict';\n+\n+// From: https://github.com/w3c/web-platform-tests/blob/master/encoding/api-basics.html\n+// TODO(joyeecheung): replace this with WPT\n+\n+const common = require('../common');\n+\n+if (!common.hasIntl)\n+  common.skip('missing Intl');\n+\n+const assert = require('assert');\n+\n+function testDecodeSample(encoding, string, bytes) {\n+  assert.strictEqual(\n+    new TextDecoder(encoding).decode(new Uint8Array(bytes)),\n+    string);\n+  assert.strictEqual(\n+    new TextDecoder(encoding).decode(new Uint8Array(bytes).buffer),\n+    string);\n+}\n+\n+// `z` (ASCII U+007A), cent (Latin-1 U+00A2), CJK water (BMP U+6C34),\n+// G-Clef (non-BMP U+1D11E), PUA (BMP U+F8FF), PUA (non-BMP U+10FFFD)\n+// byte-swapped BOM (non-character U+FFFE)\n+const sample = 'z\\xA2\\u6C34\\uD834\\uDD1E\\uF8FF\\uDBFF\\uDFFD\\uFFFE';\n+\n+{\n+  const encoding = 'utf-8';\n+  const string = sample;\n+  const bytes = [\n+    0x7A, 0xC2, 0xA2, 0xE6, 0xB0, 0xB4,\n+    0xF0, 0x9D, 0x84, 0x9E, 0xEF, 0xA3,\n+    0xBF, 0xF4, 0x8F, 0xBF, 0xBD, 0xEF,\n+    0xBF, 0xBE\n+  ];\n+  const encoded = new TextEncoder().encode(string);\n+  assert.deepStrictEqual([].slice.call(encoded), bytes);\n+  assert.strictEqual(\n+    new TextDecoder(encoding).decode(new Uint8Array(bytes)),\n+    string);\n+  assert.strictEqual(\n+    new TextDecoder(encoding).decode(new Uint8Array(bytes).buffer),\n+    string);\n+}\n+\n+testDecodeSample(\n+  'utf-16le',\n+  sample,\n+  [\n+    0x7A, 0x00, 0xA2, 0x00, 0x34, 0x6C,\n+    0x34, 0xD8, 0x1E, 0xDD, 0xFF, 0xF8,\n+    0xFF, 0xDB, 0xFD, 0xDF, 0xFE, 0xFF\n+  ]\n+);\n+\n+testDecodeSample(\n+  'utf-16be',\n+  sample,\n+  [\n+    0x00, 0x7A, 0x00, 0xA2, 0x6C, 0x34,\n+    0xD8, 0x34, 0xDD, 0x1E, 0xF8, 0xFF,\n+    0xDB, 0xFF, 0xDF, 0xFD, 0xFF, 0xFE\n+  ]\n+);\n+\n+testDecodeSample(\n+  'utf-16',\n+  sample,\n+  [\n+    0x7A, 0x00, 0xA2, 0x00, 0x34, 0x6C,\n+    0x34, 0xD8, 0x1E, 0xDD, 0xFF, 0xF8,\n+    0xFF, 0xDB, 0xFD, 0xDF, 0xFE, 0xFF\n+  ]\n+);"
        },
        {
            "sha": "c39bce5d74ee99611d6ef8cc7e7755b98f0c0622",
            "filename": "test/parallel/test-whatwg-encoding-custom-api-basics.js",
            "status": "added",
            "additions": 61,
            "deletions": 0,
            "changes": 61,
            "blob_url": "https://github.com/nodejs/node/blob/74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7/test%2Fparallel%2Ftest-whatwg-encoding-custom-api-basics.js",
            "raw_url": "https://github.com/nodejs/node/raw/74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7/test%2Fparallel%2Ftest-whatwg-encoding-custom-api-basics.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-custom-api-basics.js?ref=74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7",
            "patch": "@@ -0,0 +1,61 @@\n+'use strict';\n+\n+// From: https://github.com/w3c/web-platform-tests/blob/master/encoding/api-basics.html\n+// This is the part that can be run without ICU\n+\n+require('../common');\n+\n+const assert = require('assert');\n+\n+function testDecodeSample(encoding, string, bytes) {\n+  assert.strictEqual(\n+    new TextDecoder(encoding).decode(new Uint8Array(bytes)),\n+    string);\n+  assert.strictEqual(\n+    new TextDecoder(encoding).decode(new Uint8Array(bytes).buffer),\n+    string);\n+}\n+\n+// `z` (ASCII U+007A), cent (Latin-1 U+00A2), CJK water (BMP U+6C34),\n+// G-Clef (non-BMP U+1D11E), PUA (BMP U+F8FF), PUA (non-BMP U+10FFFD)\n+// byte-swapped BOM (non-character U+FFFE)\n+const sample = 'z\\xA2\\u6C34\\uD834\\uDD1E\\uF8FF\\uDBFF\\uDFFD\\uFFFE';\n+\n+{\n+  const encoding = 'utf-8';\n+  const string = sample;\n+  const bytes = [\n+    0x7A, 0xC2, 0xA2, 0xE6, 0xB0, 0xB4,\n+    0xF0, 0x9D, 0x84, 0x9E, 0xEF, 0xA3,\n+    0xBF, 0xF4, 0x8F, 0xBF, 0xBD, 0xEF,\n+    0xBF, 0xBE\n+  ];\n+  const encoded = new TextEncoder().encode(string);\n+  assert.deepStrictEqual([].slice.call(encoded), bytes);\n+  assert.strictEqual(\n+    new TextDecoder(encoding).decode(new Uint8Array(bytes)),\n+    string);\n+  assert.strictEqual(\n+    new TextDecoder(encoding).decode(new Uint8Array(bytes).buffer),\n+    string);\n+}\n+\n+testDecodeSample(\n+  'utf-16le',\n+  sample,\n+  [\n+    0x7A, 0x00, 0xA2, 0x00, 0x34, 0x6C,\n+    0x34, 0xD8, 0x1E, 0xDD, 0xFF, 0xF8,\n+    0xFF, 0xDB, 0xFD, 0xDF, 0xFE, 0xFF\n+  ]\n+);\n+\n+testDecodeSample(\n+  'utf-16',\n+  sample,\n+  [\n+    0x7A, 0x00, 0xA2, 0x00, 0x34, 0x6C,\n+    0x34, 0xD8, 0x1E, 0xDD, 0xFF, 0xF8,\n+    0xFF, 0xDB, 0xFD, 0xDF, 0xFE, 0xFF\n+  ]\n+);"
        },
        {
            "sha": "aabd3fe5c4de5d0e8f2fbd66c738a6fd32042291",
            "filename": "test/parallel/test-whatwg-encoding-custom-textdecoder-api-invalid-label.js",
            "status": "added",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/nodejs/node/blob/74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder-api-invalid-label.js",
            "raw_url": "https://github.com/nodejs/node/raw/74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder-api-invalid-label.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder-api-invalid-label.js?ref=74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7",
            "patch": "@@ -0,0 +1,40 @@\n+'use strict';\n+// From: https://github.com/w3c/web-platform-tests/blob/master/encoding/api-invalid-label.html\n+// With the twist that we specifically test for Node.js error codes\n+\n+const common = require('../common');\n+\n+[\n+  'utf-8',\n+  'unicode-1-1-utf-8',\n+  'utf8',\n+  'utf-16be',\n+  'utf-16le',\n+  'utf-16'\n+].forEach((i) => {\n+  ['\\u0000', '\\u000b', '\\u00a0', '\\u2028', '\\u2029'].forEach((ws) => {\n+    common.expectsError(\n+      () => new TextDecoder(`${ws}${i}`),\n+      {\n+        code: 'ERR_ENCODING_NOT_SUPPORTED',\n+        type: RangeError\n+      }\n+    );\n+\n+    common.expectsError(\n+      () => new TextDecoder(`${i}${ws}`),\n+      {\n+        code: 'ERR_ENCODING_NOT_SUPPORTED',\n+        type: RangeError\n+      }\n+    );\n+\n+    common.expectsError(\n+      () => new TextDecoder(`${ws}${i}${ws}`),\n+      {\n+        code: 'ERR_ENCODING_NOT_SUPPORTED',\n+        type: RangeError\n+      }\n+    );\n+  });\n+});"
        },
        {
            "sha": "ceee5b9cbbde30d752b18633d40c6e040216b7ad",
            "filename": "test/parallel/test-whatwg-encoding-custom-textdecoder.js",
            "status": "renamed",
            "additions": 3,
            "deletions": 102,
            "changes": 105,
            "blob_url": "https://github.com/nodejs/node/blob/74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder.js",
            "raw_url": "https://github.com/nodejs/node/raw/74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-whatwg-encoding-custom-textdecoder.js?ref=74a9221f6f2f706b8eb4eda7c73cbb65a0b3cfb7",
            "patch": "@@ -1,4 +1,7 @@\n // Flags: --expose-internals\n+\n+// This tests Node.js-specific behaviors of TextDecoder\n+\n 'use strict';\n \n const common = require('../common');\n@@ -167,72 +170,6 @@ if (common.hasIntl) {\n   });\n }\n \n-// From: https://github.com/w3c/web-platform-tests/blob/master/encoding/api-basics.html\n-function testDecodeSample(encoding, string, bytes) {\n-  assert.strictEqual(\n-    new TextDecoder(encoding).decode(new Uint8Array(bytes)),\n-    string);\n-  assert.strictEqual(\n-    new TextDecoder(encoding).decode(new Uint8Array(bytes).buffer),\n-    string);\n-}\n-\n-// `z` (ASCII U+007A), cent (Latin-1 U+00A2), CJK water (BMP U+6C34),\n-// G-Clef (non-BMP U+1D11E), PUA (BMP U+F8FF), PUA (non-BMP U+10FFFD)\n-// byte-swapped BOM (non-character U+FFFE)\n-const sample = 'z\\xA2\\u6C34\\uD834\\uDD1E\\uF8FF\\uDBFF\\uDFFD\\uFFFE';\n-\n-{\n-  const encoding = 'utf-8';\n-  const string = sample;\n-  const bytes = [\n-    0x7A, 0xC2, 0xA2, 0xE6, 0xB0, 0xB4,\n-    0xF0, 0x9D, 0x84, 0x9E, 0xEF, 0xA3,\n-    0xBF, 0xF4, 0x8F, 0xBF, 0xBD, 0xEF,\n-    0xBF, 0xBE\n-  ];\n-  const encoded = new TextEncoder().encode(string);\n-  assert.deepStrictEqual([].slice.call(encoded), bytes);\n-  assert.strictEqual(\n-    new TextDecoder(encoding).decode(new Uint8Array(bytes)),\n-    string);\n-  assert.strictEqual(\n-    new TextDecoder(encoding).decode(new Uint8Array(bytes).buffer),\n-    string);\n-}\n-\n-testDecodeSample(\n-  'utf-16le',\n-  sample,\n-  [\n-    0x7A, 0x00, 0xA2, 0x00, 0x34, 0x6C,\n-    0x34, 0xD8, 0x1E, 0xDD, 0xFF, 0xF8,\n-    0xFF, 0xDB, 0xFD, 0xDF, 0xFE, 0xFF\n-  ]\n-);\n-\n-if (common.hasIntl) {\n-  testDecodeSample(\n-    'utf-16be',\n-    sample,\n-    [\n-      0x00, 0x7A, 0x00, 0xA2, 0x6C, 0x34,\n-      0xD8, 0x34, 0xDD, 0x1E, 0xF8, 0xFF,\n-      0xDB, 0xFF, 0xDF, 0xFD, 0xFF, 0xFE\n-    ]\n-  );\n-}\n-\n-testDecodeSample(\n-  'utf-16',\n-  sample,\n-  [\n-    0x7A, 0x00, 0xA2, 0x00, 0x34, 0x6C,\n-    0x34, 0xD8, 0x1E, 0xDD, 0xFF, 0xF8,\n-    0xFF, 0xDB, 0xFD, 0xDF, 0xFE, 0xFF\n-  ]\n-);\n-\n {\n   common.expectsError(\n     () => new TextDecoder('utf-8', 1),\n@@ -242,39 +179,3 @@ testDecodeSample(\n     }\n   );\n }\n-\n-// From: https://github.com/w3c/web-platform-tests/blob/master/encoding/api-invalid-label.html\n-[\n-  'utf-8',\n-  'unicode-1-1-utf-8',\n-  'utf8',\n-  'utf-16be',\n-  'utf-16le',\n-  'utf-16'\n-].forEach((i) => {\n-  ['\\u0000', '\\u000b', '\\u00a0', '\\u2028', '\\u2029'].forEach((ws) => {\n-    common.expectsError(\n-      () => new TextDecoder(`${ws}${i}`),\n-      {\n-        code: 'ERR_ENCODING_NOT_SUPPORTED',\n-        type: RangeError\n-      }\n-    );\n-\n-    common.expectsError(\n-      () => new TextDecoder(`${i}${ws}`),\n-      {\n-        code: 'ERR_ENCODING_NOT_SUPPORTED',\n-        type: RangeError\n-      }\n-    );\n-\n-    common.expectsError(\n-      () => new TextDecoder(`${ws}${i}${ws}`),\n-      {\n-        code: 'ERR_ENCODING_NOT_SUPPORTED',\n-        type: RangeError\n-      }\n-    );\n-  });\n-});",
            "previous_filename": "test/parallel/test-whatwg-encoding-textdecoder.js"
        }
    ],
    "stats": {
        "total": 280,
        "additions": 178,
        "deletions": 102
    }
}