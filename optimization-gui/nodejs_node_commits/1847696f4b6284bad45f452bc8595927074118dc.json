{
    "author": "Trott",
    "message": "util: protect against monkeypatched Object prototype for inspect()\n\nPrevent affects of monkeypatching (for example) Object.keys() when\ncalling util.inspect().\n\nPR-URL: https://github.com/nodejs/node/pull/25953\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "1847696f4b6284bad45f452bc8595927074118dc",
    "files": [
        {
            "sha": "94d6ef8706f7f384423806f144a7a6ce997e1894",
            "filename": "lib/internal/util/inspect.js",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/1847696f4b6284bad45f452bc8595927074118dc/lib%2Finternal%2Futil%2Finspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/1847696f4b6284bad45f452bc8595927074118dc/lib%2Finternal%2Futil%2Finspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspect.js?ref=1847696f4b6284bad45f452bc8595927074118dc",
            "patch": "@@ -63,6 +63,11 @@ const {\n   isBigUint64Array\n } = require('internal/util/types');\n \n+const assert = require('internal/assert');\n+\n+// Avoid monkey-patched built-ins.\n+const { Object } = primordials;\n+\n const ReflectApply = Reflect.apply;\n \n // This function is borrowed from the function with the same name on V8 Extras'\n@@ -383,13 +388,9 @@ function getKeys(value, showHidden) {\n     try {\n       keys = Object.keys(value);\n     } catch (err) {\n-      if (isNativeError(err) &&\n-          err.name === 'ReferenceError' &&\n-          isModuleNamespaceObject(value)) {\n-        keys = Object.getOwnPropertyNames(value);\n-      } else {\n-        throw err;\n-      }\n+      assert(isNativeError(err) && err.name === 'ReferenceError' &&\n+             isModuleNamespaceObject(value));\n+      keys = Object.getOwnPropertyNames(value);\n     }\n     if (symbols.length !== 0) {\n       keys.push(...symbols.filter((key) => propertyIsEnumerable(value, key)));"
        },
        {
            "sha": "bf282a121228728204f66a733395e44b19133bc0",
            "filename": "test/parallel/test-util-primordial-monkeypatching.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/1847696f4b6284bad45f452bc8595927074118dc/test%2Fparallel%2Ftest-util-primordial-monkeypatching.js",
            "raw_url": "https://github.com/nodejs/node/raw/1847696f4b6284bad45f452bc8595927074118dc/test%2Fparallel%2Ftest-util-primordial-monkeypatching.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-primordial-monkeypatching.js?ref=1847696f4b6284bad45f452bc8595927074118dc",
            "patch": "@@ -0,0 +1,11 @@\n+'use strict';\n+\n+// Monkeypatch Object.keys() so that it throws an unexpected error. This tests\n+// that `util.inspect()` is unaffected by monkey-patching `Object`.\n+\n+require('../common');\n+const assert = require('assert');\n+const util = require('util');\n+\n+Object.keys = () => { throw new Error('fhqwhgads'); };\n+assert.strictEqual(util.inspect({}), '{}');"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 19,
        "deletions": 7
    }
}