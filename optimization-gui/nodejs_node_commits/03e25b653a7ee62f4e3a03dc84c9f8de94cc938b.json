{
    "author": "addaleax",
    "message": "src: remove SecureContext `_external` getter\n\nThis is unused inside Node core, so nothing good can\ncome from keeping it around.\n\nPR-URL: https://github.com/nodejs/node/pull/20237\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>",
    "sha": "03e25b653a7ee62f4e3a03dc84c9f8de94cc938b",
    "files": [
        {
            "sha": "3e23dec38f2ecc3b6d9232c1856730312099a262",
            "filename": "src/node_crypto.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/03e25b653a7ee62f4e3a03dc84c9f8de94cc938b/src%2Fnode_crypto.cc",
            "raw_url": "https://github.com/nodejs/node/raw/03e25b653a7ee62f4e3a03dc84c9f8de94cc938b/src%2Fnode_crypto.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.cc?ref=03e25b653a7ee62f4e3a03dc84c9f8de94cc938b",
            "patch": "@@ -340,19 +340,6 @@ void SecureContext::Initialize(Environment* env, Local<Object> target) {\n   t->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \"kTicketKeyIVIndex\"),\n          Integer::NewFromUnsigned(env->isolate(), kTicketKeyIVIndex));\n \n-  Local<FunctionTemplate> ctx_getter_templ =\n-      FunctionTemplate::New(env->isolate(),\n-                            CtxGetter,\n-                            env->as_external(),\n-                            Signature::New(env->isolate(), t));\n-\n-\n-  t->PrototypeTemplate()->SetAccessorProperty(\n-      FIXED_ONE_BYTE_STRING(env->isolate(), \"_external\"),\n-      ctx_getter_templ,\n-      Local<FunctionTemplate>(),\n-      static_cast<PropertyAttribute>(ReadOnly | DontDelete));\n-\n   target->Set(secureContextString, t->GetFunction());\n   env->set_secure_context_constructor_template(t);\n }\n@@ -1352,14 +1339,6 @@ int SecureContext::TicketCompatibilityCallback(SSL* ssl,\n }\n \n \n-void SecureContext::CtxGetter(const FunctionCallbackInfo<Value>& info) {\n-  SecureContext* sc;\n-  ASSIGN_OR_RETURN_UNWRAP(&sc, info.This());\n-  Local<External> ext = External::New(info.GetIsolate(), sc->ctx_);\n-  info.GetReturnValue().Set(ext);\n-}\n-\n-\n template <bool primary>\n void SecureContext::GetCertificate(const FunctionCallbackInfo<Value>& args) {\n   SecureContext* wrap;"
        },
        {
            "sha": "a8fe8b0d4ae7a4700d25b10a925f1d1affcc89a7",
            "filename": "src/node_crypto.h",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/03e25b653a7ee62f4e3a03dc84c9f8de94cc938b/src%2Fnode_crypto.h",
            "raw_url": "https://github.com/nodejs/node/raw/03e25b653a7ee62f4e3a03dc84c9f8de94cc938b/src%2Fnode_crypto.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_crypto.h?ref=03e25b653a7ee62f4e3a03dc84c9f8de94cc938b",
            "patch": "@@ -148,7 +148,6 @@ class SecureContext : public BaseObject {\n       const v8::FunctionCallbackInfo<v8::Value>& args);\n   static void EnableTicketKeyCallback(\n       const v8::FunctionCallbackInfo<v8::Value>& args);\n-  static void CtxGetter(const v8::FunctionCallbackInfo<v8::Value>& info);\n \n   template <bool primary>\n   static void GetCertificate(const v8::FunctionCallbackInfo<v8::Value>& args);"
        },
        {
            "sha": "064ef844c38e6c2624f8f0b0c5efd3012b3f0d21",
            "filename": "test/parallel/test-accessor-properties.js",
            "status": "modified",
            "additions": 1,
            "deletions": 16,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/03e25b653a7ee62f4e3a03dc84c9f8de94cc938b/test%2Fparallel%2Ftest-accessor-properties.js",
            "raw_url": "https://github.com/nodejs/node/raw/03e25b653a7ee62f4e3a03dc84c9f8de94cc938b/test%2Fparallel%2Ftest-accessor-properties.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-accessor-properties.js?ref=03e25b653a7ee62f4e3a03dc84c9f8de94cc938b",
            "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-const common = require('../common');\n+require('../common');\n \n // This tests that the accessor properties do not raise assertions\n // when called with incompatible receivers.\n@@ -50,19 +50,4 @@ const UDP = process.binding('udp_wrap').UDP;\n     typeof Object.getOwnPropertyDescriptor(UDP.prototype, 'fd'),\n     'object'\n   );\n-\n-  if (common.hasCrypto) { // eslint-disable-line node-core/crypto-check\n-    // There are accessor properties in crypto too\n-    const crypto = process.binding('crypto');\n-\n-    assert.throws(() => {\n-      crypto.SecureContext.prototype._external;\n-    }, TypeError);\n-\n-    assert.strictEqual(\n-      typeof Object.getOwnPropertyDescriptor(\n-        crypto.SecureContext.prototype, '_external'),\n-      'object'\n-    );\n-  }\n }"
        },
        {
            "sha": "33d371923a600c670424d95b2507e177d6d69073",
            "filename": "test/parallel/test-tls-external-accessor.js",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/124875cab2ab129b0e1689c7727d5eaeab4618c2/test%2Fparallel%2Ftest-tls-external-accessor.js",
            "raw_url": "https://github.com/nodejs/node/raw/124875cab2ab129b0e1689c7727d5eaeab4618c2/test%2Fparallel%2Ftest-tls-external-accessor.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-external-accessor.js?ref=124875cab2ab129b0e1689c7727d5eaeab4618c2",
            "patch": "@@ -1,22 +0,0 @@\n-'use strict';\n-\n-const common = require('../common');\n-if (!common.hasCrypto)\n-  common.skip('missing crypto');\n-\n-const assert = require('assert');\n-const tls = require('tls');\n-\n-// Ensure accessing ._external doesn't hit an assert in the accessor method.\n-{\n-  const pctx = tls.createSecureContext().context;\n-  const cctx = Object.create(pctx);\n-  assert.throws(() => cctx._external, TypeError);\n-  pctx._external;\n-}\n-{\n-  const pctx = tls.createSecurePair().credentials.context;\n-  const cctx = Object.create(pctx);\n-  assert.throws(() => cctx._external, TypeError);\n-  pctx._external;\n-}"
        }
    ],
    "stats": {
        "total": 61,
        "additions": 1,
        "deletions": 60
    }
}