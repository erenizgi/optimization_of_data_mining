{
    "author": "killagu",
    "message": "repl: fix tab-complete warning\n\nWhen create a nest repl, will register `Runtime.executionContextCreated`\nlistener to the inspector session.This patch will fix listener\nrepeatedly register.\n\nPR-URL: https://github.com/nodejs/node/pull/18881\nFixes: https://github.com/nodejs/node/issues/18284\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "26231548ad1dff971cdeaab3085b372a75ad1efb",
    "files": [
        {
            "sha": "8201630c3a6389909d2ab0123356121c037b44ce",
            "filename": "lib/repl.js",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/26231548ad1dff971cdeaab3085b372a75ad1efb/lib%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/26231548ad1dff971cdeaab3085b372a75ad1efb/lib%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Frepl.js?ref=26231548ad1dff971cdeaab3085b372a75ad1efb",
            "patch": "@@ -753,7 +753,7 @@ REPLServer.prototype.createContext = function() {\n   } else {\n     sendInspectorCommand((session) => {\n       session.post('Runtime.enable');\n-      session.on('Runtime.executionContextCreated', ({ params }) => {\n+      session.once('Runtime.executionContextCreated', ({ params }) => {\n         this[kContextId] = params.context.id;\n       });\n       context = vm.createContext();\n@@ -937,7 +937,6 @@ function complete(line, callback) {\n     var flat = new ArrayStream();         // make a new \"input\" stream\n     var magic = new REPLServer('', flat); // make a nested REPL\n     replMap.set(magic, replMap.get(this));\n-    magic.resetContext();\n     flat.run(tmp);                        // eval the flattened code\n     // all this is only profitable if the nested REPL\n     // does not have a bufferedCommand"
        },
        {
            "sha": "3379cec8453cba9b41b3bcc90b75412a9fd60879",
            "filename": "test/parallel/test-repl-tab-complete-no-warn.js",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/26231548ad1dff971cdeaab3085b372a75ad1efb/test%2Fparallel%2Ftest-repl-tab-complete-no-warn.js",
            "raw_url": "https://github.com/nodejs/node/raw/26231548ad1dff971cdeaab3085b372a75ad1efb/test%2Fparallel%2Ftest-repl-tab-complete-no-warn.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-repl-tab-complete-no-warn.js?ref=26231548ad1dff971cdeaab3085b372a75ad1efb",
            "patch": "@@ -0,0 +1,22 @@\n+'use strict';\n+\n+const common = require('../common');\n+const repl = require('repl');\n+const DEFAULT_MAX_LISTENERS = require('events').defaultMaxListeners;\n+\n+common.ArrayStream.prototype.write = () => {\n+};\n+\n+const putIn = new common.ArrayStream();\n+const testMe = repl.start('', putIn);\n+\n+// https://github.com/nodejs/node/issues/18284\n+// Tab-completion should not repeatedly add the\n+// `Runtime.executionContextCreated` listener\n+process.on('warning', common.mustNotCall());\n+\n+putIn.run(['.clear']);\n+putIn.run(['async function test() {']);\n+for (let i = 0; i < DEFAULT_MAX_LISTENERS; i++) {\n+  testMe.complete('await Promise.resolve()', () => {});\n+}"
        }
    ],
    "stats": {
        "total": 25,
        "additions": 23,
        "deletions": 2
    }
}