{
    "author": "joaocgreis",
    "message": "build,win,v8: allow precompiling objects-inl.h\n\nThis makes compiling v8_base much faster on Windows.\n\nSharding is disabled because the header would have to be precompiled\nfor each shard but is only once. The library is much smaller, so\nsharding is unnecessary.\n\nThis is enabled by default, but disabled for CI and releases.\n\nPR-URL: https://github.com/nodejs/node/pull/21772\nReviewed-By: Rich Trott <rtrott@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Refael Ackermann <refack@gmail.com>\nReviewed-By: Kyle Farnung <kfarnung@microsoft.com>\nReviewed-By: Bartosz Sosnowski <bartosz@janeasystems.com>",
    "sha": "48e5b350b3dd236353e3e8e1196a09f5c5bcda77",
    "files": [
        {
            "sha": "ef462da16117c3a7f2db49ec7bddd726dc87169a",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=48e5b350b3dd236353e3e8e1196a09f5c5bcda77",
            "patch": "@@ -17,6 +17,7 @@\n     'node_use_bundled_v8%': 'true',\n     'node_module_version%': '',\n     'node_with_ltcg%': '',\n+    'node_use_pch%': 'false',\n \n     'node_tag%': '',\n     'uv_library%': 'static_library',"
        },
        {
            "sha": "f89812cc94819df940f3890500197fb0f8fd8bfe",
            "filename": "configure",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/configure",
            "raw_url": "https://github.com/nodejs/node/raw/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/configure",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/configure?ref=48e5b350b3dd236353e3e8e1196a09f5c5bcda77",
            "patch": "@@ -438,6 +438,11 @@ parser.add_option('--with-ltcg',\n     dest='with_ltcg',\n     help='Use Link Time Code Generation. This feature is only available on Windows.')\n \n+parser.add_option('--with-pch',\n+    action='store_true',\n+    dest='with_pch',\n+    help='Use Precompiled Headers (only available on Windows).')\n+\n intl_optgroup.add_option('--download',\n     action='store',\n     dest='download_list',\n@@ -995,6 +1000,11 @@ def configure_node(o):\n   if flavor != 'win' and options.with_ltcg:\n     raise Exception('Link Time Code Generation is only supported on Windows.')\n \n+  if flavor == 'win':\n+    o['variables']['node_use_pch'] = b(options.with_pch)\n+  else:\n+    o['variables']['node_use_pch'] = 'false'\n+\n   if options.tag:\n     o['variables']['node_tag'] = '-' + options.tag\n   else:"
        },
        {
            "sha": "08abec1c3e5a35389010fac02a1a414da77a6c13",
            "filename": "deps/v8/gypfiles/v8.gyp",
            "status": "modified",
            "additions": 14,
            "deletions": 4,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/deps%2Fv8%2Fgypfiles%2Fv8.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/deps%2Fv8%2Fgypfiles%2Fv8.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fgypfiles%2Fv8.gyp?ref=48e5b350b3dd236353e3e8e1196a09f5c5bcda77",
            "patch": "@@ -1844,10 +1844,20 @@\n             'gyp_generators': '<!(echo $GYP_GENERATORS)',\n           },\n           'msvs_disabled_warnings': [4351, 4355, 4800],\n-          # When building Official, the .lib is too large and exceeds the 2G\n-          # limit. This breaks it into multiple pieces to avoid the limit.\n-          # See http://crbug.com/485155.\n-          'msvs_shard': 4,\n+          'conditions': [\n+            ['node_use_pch!=\"true\"', {\n+              # When building Official, the .lib is too large and exceeds the 2G\n+              # limit. This breaks it into multiple pieces to avoid the limit.\n+              # See http://crbug.com/485155.\n+              'msvs_shard': 4,\n+            }, {\n+              'msvs_precompiled_header': 'tools/msvs/pch/pch_v8_base.h',\n+              'msvs_precompiled_source': '../../../tools/msvs/pch/pch_v8_base.cc',\n+              'sources': [\n+                '../../../tools/msvs/pch/pch_v8_base.cc',\n+              ],\n+            }],\n+          ],\n           # This will prevent V8's .cc files conflicting with the inspector's\n           # .cpp files in the same shard.\n           'msvs_settings': {"
        },
        {
            "sha": "828977c03692d6646513f240e7ea86c20731b7b6",
            "filename": "tools/msvs/pch/pch_v8_base.cc",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/tools%2Fmsvs%2Fpch%2Fpch_v8_base.cc",
            "raw_url": "https://github.com/nodejs/node/raw/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/tools%2Fmsvs%2Fpch%2Fpch_v8_base.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmsvs%2Fpch%2Fpch_v8_base.cc?ref=48e5b350b3dd236353e3e8e1196a09f5c5bcda77",
            "patch": "@@ -0,0 +1 @@\n+#include \"tools/msvs/pch/pch_v8_base.h\""
        },
        {
            "sha": "ebac7914823ac537a1f96fe4690a3a8e378afdfd",
            "filename": "tools/msvs/pch/pch_v8_base.h",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/tools%2Fmsvs%2Fpch%2Fpch_v8_base.h",
            "raw_url": "https://github.com/nodejs/node/raw/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/tools%2Fmsvs%2Fpch%2Fpch_v8_base.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fmsvs%2Fpch%2Fpch_v8_base.h?ref=48e5b350b3dd236353e3e8e1196a09f5c5bcda77",
            "patch": "@@ -0,0 +1 @@\n+#include \"src/objects-inl.h\""
        },
        {
            "sha": "e8b02057fe5f1dd189bdd1e86ec375df8c77a84f",
            "filename": "vcbuild.bat",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/vcbuild.bat",
            "raw_url": "https://github.com/nodejs/node/raw/48e5b350b3dd236353e3e8e1196a09f5c5bcda77/vcbuild.bat",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/vcbuild.bat?ref=48e5b350b3dd236353e3e8e1196a09f5c5bcda77",
            "patch": "@@ -16,6 +16,7 @@ set config=Release\n set target=Build\n set target_arch=x64\n set ltcg=\n+set pch=1\n set target_env=\n set noprojgen=\n set projgen=\n@@ -62,7 +63,7 @@ set doc=\n :next-arg\n if \"%1\"==\"\" goto args-done\n if /i \"%1\"==\"debug\"         set config=Debug&goto arg-ok\n-if /i \"%1\"==\"release\"       set config=Release&set ltcg=1&goto arg-ok\n+if /i \"%1\"==\"release\"       set config=Release&set ltcg=1&set \"pch=\"&goto arg-ok\n if /i \"%1\"==\"clean\"         set target=Clean&goto arg-ok\n if /i \"%1\"==\"ia32\"          set target_arch=x86&goto arg-ok\n if /i \"%1\"==\"x86\"           set target_arch=x86&goto arg-ok\n@@ -77,6 +78,7 @@ if /i \"%1\"==\"nosnapshot\"    set nosnapshot=1&goto arg-ok\n if /i \"%1\"==\"noetw\"         set noetw=1&goto arg-ok\n if /i \"%1\"==\"noperfctr\"     set noperfctr=1&goto arg-ok\n if /i \"%1\"==\"ltcg\"          set ltcg=1&goto arg-ok\n+if /i \"%1\"==\"nopch\"         set \"pch=\"&goto arg-ok\n if /i \"%1\"==\"licensertf\"    set licensertf=1&goto arg-ok\n if /i \"%1\"==\"test\"          set test_args=%test_args% -J %common_test_suites%&set lint_cpp=1&set lint_js=1&set lint_md=1&goto arg-ok\n if /i \"%1\"==\"test-ci\"       set test_args=%test_args% %test_ci_args% -p tap --logfile test.tap %common_test_suites%&set cctest_args=%cctest_args% --gtest_output=tap:cctest.tap&goto arg-ok\n@@ -153,6 +155,7 @@ if defined build_release (\n   set i18n_arg=small-icu\n   set projgen=1\n   set ltcg=1\n+  set \"pch=\"\n )\n \n :: assign path to node_exe\n@@ -166,6 +169,7 @@ if defined nosnapshot       set configure_flags=%configure_flags% --without-snap\n if defined noetw            set configure_flags=%configure_flags% --without-etw& set noetw_msi_arg=/p:NoETW=1\n if defined noperfctr        set configure_flags=%configure_flags% --without-perfctr& set noperfctr_msi_arg=/p:NoPerfCtr=1\n if defined ltcg             set configure_flags=%configure_flags% --with-ltcg\n+if defined pch              set configure_flags=%configure_flags% --with-pch\n if defined release_urlbase  set configure_flags=%configure_flags% --release-urlbase=%release_urlbase%\n if defined download_arg     set configure_flags=%configure_flags% %download_arg%\n if defined enable_vtune_arg set configure_flags=%configure_flags% --enable-vtune-profiling\n@@ -668,7 +672,7 @@ del .used_configure_flags\n goto exit\n \n :help\n-echo vcbuild.bat [debug/release] [msi] [doc] [test/test-ci/test-all/test-addons/test-addons-napi/test-internet/test-pummel/test-simple/test-message/test-gc/test-tick-processor/test-known-issues/test-node-inspect/test-check-deopts/test-npm/test-async-hooks/test-v8/test-v8-intl/test-v8-benchmarks/test-v8-all] [ignore-flaky] [static/dll] [noprojgen] [projgen] [small-icu/full-icu/without-intl] [nobuild] [nosnapshot] [noetw] [noperfctr] [ltcg] [licensetf] [sign] [ia32/x86/x64] [vs2017] [download-all] [enable-vtune] [lint/lint-ci/lint-js/lint-js-ci/lint-md] [lint-md-build] [package] [build-release] [upload] [no-NODE-OPTIONS] [link-module path-to-module] [debug-http2] [debug-nghttp2] [clean] [no-cctest] [openssl-no-asm]\n+echo vcbuild.bat [debug/release] [msi] [doc] [test/test-ci/test-all/test-addons/test-addons-napi/test-internet/test-pummel/test-simple/test-message/test-gc/test-tick-processor/test-known-issues/test-node-inspect/test-check-deopts/test-npm/test-async-hooks/test-v8/test-v8-intl/test-v8-benchmarks/test-v8-all] [ignore-flaky] [static/dll] [noprojgen] [projgen] [small-icu/full-icu/without-intl] [nobuild] [nosnapshot] [noetw] [noperfctr] [ltcg] [nopch] [licensetf] [sign] [ia32/x86/x64] [vs2017] [download-all] [enable-vtune] [lint/lint-ci/lint-js/lint-js-ci/lint-md] [lint-md-build] [package] [build-release] [upload] [no-NODE-OPTIONS] [link-module path-to-module] [debug-http2] [debug-nghttp2] [clean] [no-cctest] [openssl-no-asm]\n echo Examples:\n echo   vcbuild.bat                          : builds release build\n echo   vcbuild.bat debug                    : builds debug build"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 33,
        "deletions": 6
    }
}