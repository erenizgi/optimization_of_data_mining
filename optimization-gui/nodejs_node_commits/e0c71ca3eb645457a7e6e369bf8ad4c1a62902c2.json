{
    "author": "BridgeAR",
    "message": "tools: stricter eslint rule for globals\n\nPR-URL: https://github.com/nodejs/node/pull/20567\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>",
    "sha": "e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2",
    "files": [
        {
            "sha": "e7cab0ad931b4d6ae3dcb88101104d87000ac9f5",
            "filename": "lib/.eslintrc.yaml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2/lib%2F.eslintrc.yaml",
            "raw_url": "https://github.com/nodejs/node/raw/e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2/lib%2F.eslintrc.yaml",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F.eslintrc.yaml?ref=e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2",
            "patch": "@@ -20,7 +20,7 @@ rules:\n     - selector: \"NewExpression[callee.name=/Error$/]:not([callee.name=/^(AssertionError|NghttpError)$/])\"\n       message: \"Use an error exported by the internal/errors module.\"\n   # Custom rules in tools/eslint-rules\n-  node-core/require-buffer: error\n+  node-core/require-globals: error\n   node-core/buffer-constructor: error\n   node-core/no-let-in-for-declaration: error\n   node-core/lowercase-name-for-primitive: error"
        },
        {
            "sha": "d928c435480e5e1f8be00d6e9c804aea67bcc7ce",
            "filename": "test/parallel/test-eslint-require-buffer.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2/test%2Fparallel%2Ftest-eslint-require-buffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2/test%2Fparallel%2Ftest-eslint-require-buffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-eslint-require-buffer.js?ref=e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2",
            "patch": "@@ -5,7 +5,7 @@ const common = require('../common');\n common.skipIfEslintMissing();\n \n const RuleTester = require('../../tools/node_modules/eslint').RuleTester;\n-const rule = require('../../tools/eslint-rules/require-buffer');\n+const rule = require('../../tools/eslint-rules/require-globals');\n const ruleTester = new RuleTester({\n   parserOptions: { ecmaVersion: 6 },\n   env: { node: true }\n@@ -18,7 +18,7 @@ const useStrict = '\\'use strict\\';\\n\\n';\n const bufferModule = 'const { Buffer } = require(\\'buffer\\');\\n';\n const mockComment = '// Some Comment\\n//\\n// Another Comment\\n\\n';\n const useBuffer = 'Buffer;';\n-ruleTester.run('require-buffer', rule, {\n+ruleTester.run('require-globals', rule, {\n   valid: [\n     'foo',\n     'const Buffer = require(\"Buffer\"); Buffer;',"
        },
        {
            "sha": "b12b9ce04e7cfcaf8223bddfde6d971b095eb478",
            "filename": "tools/eslint-rules/require-buffer.js",
            "status": "removed",
            "additions": 0,
            "deletions": 35,
            "changes": 35,
            "blob_url": "https://github.com/nodejs/node/blob/7afb73715f161ea14924eceb6f03b502f32ac8fd/tools%2Feslint-rules%2Frequire-buffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/7afb73715f161ea14924eceb6f03b502f32ac8fd/tools%2Feslint-rules%2Frequire-buffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Feslint-rules%2Frequire-buffer.js?ref=7afb73715f161ea14924eceb6f03b502f32ac8fd",
            "patch": "@@ -1,35 +0,0 @@\n-'use strict';\n-const BUFFER_REQUIRE = 'const { Buffer } = require(\\'buffer\\');';\n-\n-module.exports = function(context) {\n-\n-  function flagIt(reference) {\n-    const msg = `Use ${BUFFER_REQUIRE} at the beginning of this file`;\n-\n-    context.report({\n-      node: reference.identifier,\n-      message: msg,\n-      fix: (fixer) => {\n-        const sourceCode = context.getSourceCode();\n-\n-        const useStrict = /'use strict';\\n\\n?/g;\n-        const hasUseStrict = !!useStrict.exec(sourceCode.text);\n-        const firstLOC = sourceCode.ast.range[0];\n-        const rangeNeedle = hasUseStrict ? useStrict.lastIndex : firstLOC;\n-\n-        return fixer.insertTextBeforeRange([rangeNeedle],\n-                                           `${BUFFER_REQUIRE}\\n`);\n-      }\n-    });\n-  }\n-\n-  return {\n-    'Program:exit': function() {\n-      const globalScope = context.getScope();\n-      const variable = globalScope.set.get('Buffer');\n-      if (variable) {\n-        variable.references.forEach(flagIt);\n-      }\n-    }\n-  };\n-};"
        },
        {
            "sha": "bc49ff6c8746ed6154e78af06c05397444906038",
            "filename": "tools/eslint-rules/require-globals.js",
            "status": "added",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2/tools%2Feslint-rules%2Frequire-globals.js",
            "raw_url": "https://github.com/nodejs/node/raw/e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2/tools%2Feslint-rules%2Frequire-globals.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Feslint-rules%2Frequire-globals.js?ref=e0c71ca3eb645457a7e6e369bf8ad4c1a62902c2",
            "patch": "@@ -0,0 +1,50 @@\n+'use strict';\n+\n+// This rule makes sure that no Globals are going to be used in /lib.\n+// That could otherwise result in problems with the repl.\n+\n+module.exports = function(context) {\n+\n+  function flagIt(msg, fix) {\n+    return (reference) => {\n+      context.report({\n+        node: reference.identifier,\n+        message: msg,\n+        fix: (fixer) => {\n+          const sourceCode = context.getSourceCode();\n+\n+          const useStrict = /'use strict';\\n\\n?/g;\n+          const hasUseStrict = !!useStrict.exec(sourceCode.text);\n+          const firstLOC = sourceCode.ast.range[0];\n+          const rangeNeedle = hasUseStrict ? useStrict.lastIndex : firstLOC;\n+\n+          return fixer.insertTextBeforeRange([rangeNeedle], `${fix}\\n`);\n+        }\n+      });\n+    };\n+  }\n+\n+  return {\n+    'Program:exit': function() {\n+      const globalScope = context.getScope();\n+      let variable = globalScope.set.get('Buffer');\n+      if (variable) {\n+        const fix = \"const { Buffer } = require('buffer');\";\n+        const msg = `Use ${fix} at the beginning of this file`;\n+        variable.references.forEach(flagIt(msg, fix));\n+      }\n+      variable = globalScope.set.get('URL');\n+      if (variable) {\n+        const fix = \"const { URL } = require('url');\";\n+        const msg = `Use ${fix} at the beginning of this file`;\n+        variable.references.forEach(flagIt(msg, fix));\n+      }\n+      variable = globalScope.set.get('URLSearchParams');\n+      if (variable) {\n+        const fix = \"const { URLSearchParams } = require('url');\";\n+        const msg = `Use ${fix} at the beginning of this file`;\n+        variable.references.forEach(flagIt(msg, fix));\n+      }\n+    }\n+  };\n+};"
        }
    ],
    "stats": {
        "total": 91,
        "additions": 53,
        "deletions": 38
    }
}