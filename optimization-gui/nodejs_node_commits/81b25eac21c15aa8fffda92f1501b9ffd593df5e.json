{
    "author": "antsmartian",
    "message": "util: add null prototype support for date\n\nPR-URL: https://github.com/nodejs/node/pull/25144\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "81b25eac21c15aa8fffda92f1501b9ffd593df5e",
    "files": [
        {
            "sha": "3a41f781e0d3a00ddbf8d6d85f5603766df7f2a7",
            "filename": "lib/internal/util/inspect.js",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/81b25eac21c15aa8fffda92f1501b9ffd593df5e/lib%2Finternal%2Futil%2Finspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/81b25eac21c15aa8fffda92f1501b9ffd593df5e/lib%2Finternal%2Futil%2Finspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspect.js?ref=81b25eac21c15aa8fffda92f1501b9ffd593df5e",
            "patch": "@@ -77,6 +77,7 @@ function uncurryThis(func) {\n const propertyIsEnumerable = uncurryThis(Object.prototype.propertyIsEnumerable);\n const regExpToString = uncurryThis(RegExp.prototype.toString);\n const dateToISOString = uncurryThis(Date.prototype.toISOString);\n+const dateToString = uncurryThis(Date.prototype.toString);\n const errorToString = uncurryThis(Error.prototype.toString);\n \n const bigIntValueOf = uncurryThis(BigInt.prototype.valueOf);\n@@ -646,12 +647,15 @@ function formatRaw(ctx, value, recurseTimes, typedArray) {\n         return ctx.stylize(base, 'regexp');\n     } else if (isDate(value)) {\n       // Make dates with properties first say the date\n+      base = Number.isNaN(dateGetTime(value)) ?\n+        dateToString(value) :\n+        dateToISOString(value);\n+      const prefix = getPrefix(constructor, tag, 'Date');\n+      if (prefix !== 'Date ')\n+        base = `${prefix}${base}`;\n       if (keys.length === 0) {\n-        if (Number.isNaN(dateGetTime(value)))\n-          return ctx.stylize(String(value), 'date');\n-        return ctx.stylize(dateToISOString(value), 'date');\n+        return ctx.stylize(base, 'date');\n       }\n-      base = dateToISOString(value);\n     } else if (isError(value)) {\n       // Make error with message first say the error.\n       base = formatError(value);"
        },
        {
            "sha": "f495e51ef603dee87a8c9e02572b74a239bf398b",
            "filename": "test/parallel/test-assert-deep.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/81b25eac21c15aa8fffda92f1501b9ffd593df5e/test%2Fparallel%2Ftest-assert-deep.js",
            "raw_url": "https://github.com/nodejs/node/raw/81b25eac21c15aa8fffda92f1501b9ffd593df5e/test%2Fparallel%2Ftest-assert-deep.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert-deep.js?ref=81b25eac21c15aa8fffda92f1501b9ffd593df5e",
            "patch": "@@ -117,16 +117,16 @@ assert.throws(\n   {\n     code: 'ERR_ASSERTION',\n     message: `${defaultMsgStartFull}\\n\\n` +\n-             '+ 2016-01-01T00:00:00.000Z\\n- 2016-01-01T00:00:00.000Z {\\n' +\n-             \"-   '0': '1'\\n- }\"\n+             '+ 2016-01-01T00:00:00.000Z\\n- MyDate 2016-01-01T00:00:00.000Z' +\n+             \" {\\n-   '0': '1'\\n- }\"\n   }\n );\n assert.throws(\n   () => assert.deepStrictEqual(date2, date),\n   {\n     code: 'ERR_ASSERTION',\n     message: `${defaultMsgStartFull}\\n\\n` +\n-             '+ 2016-01-01T00:00:00.000Z {\\n' +\n+             '+ MyDate 2016-01-01T00:00:00.000Z {\\n' +\n              \"+   '0': '1'\\n+ }\\n- 2016-01-01T00:00:00.000Z\"\n   }\n );"
        },
        {
            "sha": "bd24efeecc82d3861f39d2438c8f65ddff97a0c1",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 47,
            "deletions": 1,
            "changes": 48,
            "blob_url": "https://github.com/nodejs/node/blob/81b25eac21c15aa8fffda92f1501b9ffd593df5e/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/81b25eac21c15aa8fffda92f1501b9ffd593df5e/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=81b25eac21c15aa8fffda92f1501b9ffd593df5e",
            "patch": "@@ -1663,7 +1663,9 @@ assert.strictEqual(util.inspect('\"\\'${a}'), \"'\\\"\\\\'${a}'\");\n      'byteOffset: undefined,\\n  buffer: undefined }'],\n   [new SharedArrayBuffer(2), '[SharedArrayBuffer: null prototype] ' +\n      '{ [Uint8Contents]: <00 00>, byteLength: undefined }'],\n-  [/foobar/, '[RegExp: null prototype] /foobar/']\n+  [/foobar/, '[RegExp: null prototype] /foobar/'],\n+  [new Date('Sun, 14 Feb 2010 11:48:40 GMT'),\n+   '[Date: null prototype] 2010-02-14T11:48:40.000Z']\n ].forEach(([value, expected]) => {\n   assert.strictEqual(\n     util.inspect(Object.setPrototypeOf(value, null)),\n@@ -1707,6 +1709,50 @@ assert.strictEqual(util.inspect('\"\\'${a}'), \"'\\\"\\\\'${a}'\");\n   assert(/\\[Symbol\\(foo\\)]: 'yeah'/.test(res), res);\n });\n \n+// Date null prototype checks\n+{\n+  class CustomDate extends Date {\n+  }\n+\n+  const date = new CustomDate('Sun, 14 Feb 2010 11:48:40 GMT');\n+  assert.strictEqual(util.inspect(date), 'CustomDate 2010-02-14T11:48:40.000Z');\n+\n+  // add properties\n+  date.foo = 'bar';\n+  assert.strictEqual(util.inspect(date),\n+                     '{ CustomDate 2010-02-14T11:48:40.000Z foo: \\'bar\\' }');\n+\n+  // check for null prototype\n+  Object.setPrototypeOf(date, null);\n+  assert.strictEqual(util.inspect(date),\n+                     '{ [Date: null prototype] 2010-02-14T11:48:40.000Z' +\n+                     ' foo: \\'bar\\' }');\n+\n+  const anotherDate = new CustomDate('Sun, 14 Feb 2010 11:48:40 GMT');\n+  Object.setPrototypeOf(anotherDate, null);\n+  assert.strictEqual(util.inspect(anotherDate),\n+                     '[Date: null prototype] 2010-02-14T11:48:40.000Z');\n+}\n+\n+// Check for invalid dates and null prototype\n+{\n+  class CustomDate extends Date {\n+  }\n+\n+  const date = new CustomDate('invalid_date');\n+  assert.strictEqual(util.inspect(date), 'CustomDate Invalid Date');\n+\n+  // add properties\n+  date.foo = 'bar';\n+  assert.strictEqual(util.inspect(date),\n+                     '{ CustomDate Invalid Date foo: \\'bar\\' }');\n+\n+  // check for null prototype\n+  Object.setPrototypeOf(date, null);\n+  assert.strictEqual(util.inspect(date),\n+                     '{ [Date: null prototype] Invalid Date foo: \\'bar\\' }');\n+}\n+\n assert.strictEqual(inspect(1n), '1n');\n assert.strictEqual(inspect(Object(-1n)), '[BigInt: -1n]');\n assert.strictEqual(inspect(Object(13n)), '[BigInt: 13n]');"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 58,
        "deletions": 8
    }
}