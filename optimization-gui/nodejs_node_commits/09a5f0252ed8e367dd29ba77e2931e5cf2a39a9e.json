{
    "author": "joyeecheung",
    "message": "process: move deprecation warning initialization into pre_execution.js\n\nSince this is only necessary when user code execution is expected.\n\nPR-URL: https://github.com/nodejs/node/pull/25825\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e",
    "files": [
        {
            "sha": "b4f2d4e838cd5de083f18ac4d0ad98c4eec6f8ff",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 2,
            "deletions": 23,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e",
            "patch": "@@ -226,29 +226,6 @@ Object.defineProperty(process, 'argv0', {\n });\n process.argv[0] = process.execPath;\n \n-const { deprecate } = NativeModule.require('internal/util');\n-{\n-  // Install legacy getters on the `util` binding for typechecking.\n-  // TODO(addaleax): Turn into a full runtime deprecation.\n-  const pendingDeprecation = getOptionValue('--pending-deprecation');\n-  const utilBinding = internalBinding('util');\n-  const types = NativeModule.require('internal/util/types');\n-  for (const name of [\n-    'isArrayBuffer', 'isArrayBufferView', 'isAsyncFunction',\n-    'isDataView', 'isDate', 'isExternal', 'isMap', 'isMapIterator',\n-    'isNativeError', 'isPromise', 'isRegExp', 'isSet', 'isSetIterator',\n-    'isTypedArray', 'isUint8Array', 'isAnyArrayBuffer'\n-  ]) {\n-    utilBinding[name] = pendingDeprecation ?\n-      deprecate(types[name],\n-                'Accessing native typechecking bindings of Node ' +\n-                'directly is deprecated. ' +\n-                `Please use \\`util.types.${name}\\` instead.`,\n-                'DEP0103') :\n-      types[name];\n-  }\n-}\n-\n // process.allowedNodeEnvironmentFlags\n Object.defineProperty(process, 'allowedNodeEnvironmentFlags', {\n   get() {\n@@ -269,6 +246,8 @@ Object.defineProperty(process, 'allowedNodeEnvironmentFlags', {\n   enumerable: true,\n   configurable: true\n });\n+\n+const { deprecate } = NativeModule.require('internal/util');\n // process.assert\n process.assert = deprecate(\n   perThreadSetup.assert,"
        },
        {
            "sha": "d09fdb131a2ca97f03d592deff02fed63e2027cf",
            "filename": "lib/internal/bootstrap/pre_execution.js",
            "status": "modified",
            "additions": 40,
            "deletions": 0,
            "changes": 40,
            "blob_url": "https://github.com/nodejs/node/blob/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fbootstrap%2Fpre_execution.js",
            "raw_url": "https://github.com/nodejs/node/raw/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fbootstrap%2Fpre_execution.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fpre_execution.js?ref=09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e",
            "patch": "@@ -2,6 +2,45 @@\n \n const { getOptionValue } = require('internal/options');\n \n+// In general deprecations are intialized wherever the APIs are implemented,\n+// this is used to deprecate APIs implemented in C++ where the deprecation\n+// utitlities are not easily accessible.\n+function initializeDeprecations() {\n+  const { deprecate } = require('internal/util');\n+  const pendingDeprecation = getOptionValue('--pending-deprecation');\n+\n+  // DEP0103: access to `process.binding('util').isX` type checkers\n+  // TODO(addaleax): Turn into a full runtime deprecation.\n+  const utilBinding = internalBinding('util');\n+  const types = require('internal/util/types');\n+  for (const name of [\n+    'isArrayBuffer',\n+    'isArrayBufferView',\n+    'isAsyncFunction',\n+    'isDataView',\n+    'isDate',\n+    'isExternal',\n+    'isMap',\n+    'isMapIterator',\n+    'isNativeError',\n+    'isPromise',\n+    'isRegExp',\n+    'isSet',\n+    'isSetIterator',\n+    'isTypedArray',\n+    'isUint8Array',\n+    'isAnyArrayBuffer'\n+  ]) {\n+    utilBinding[name] = pendingDeprecation ?\n+      deprecate(types[name],\n+                'Accessing native typechecking bindings of Node ' +\n+                'directly is deprecated. ' +\n+                `Please use \\`util.types.${name}\\` instead.`,\n+                'DEP0103') :\n+      types[name];\n+  }\n+}\n+\n function initializeClusterIPC() {\n   // If this is a worker in cluster mode, start up the communication\n   // channel. This needs to be done before any user code gets executed\n@@ -75,6 +114,7 @@ function loadPreloadModules() {\n }\n \n module.exports = {\n+  initializeDeprecations,\n   initializeClusterIPC,\n   initializePolicy,\n   initializeESMLoader,"
        },
        {
            "sha": "97584841b3a0c2dcfaee58b83f94f783850934b9",
            "filename": "lib/internal/main/check_syntax.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Fcheck_syntax.js",
            "raw_url": "https://github.com/nodejs/node/raw/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Fcheck_syntax.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmain%2Fcheck_syntax.js?ref=09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e",
            "patch": "@@ -4,6 +4,7 @@\n // instead of actually running the file.\n \n const {\n+  initializeDeprecations,\n   initializeClusterIPC,\n   initializePolicy,\n   initializeESMLoader,\n@@ -21,6 +22,7 @@ const {\n } = require('internal/modules/cjs/helpers');\n \n // TODO(joyeecheung): not every one of these are necessary\n+initializeDeprecations();\n initializeClusterIPC();\n initializePolicy();\n initializeESMLoader();"
        },
        {
            "sha": "f02d9ffa0cea03af200dacbeb8e28aeaf3ce08a8",
            "filename": "lib/internal/main/eval_stdin.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Feval_stdin.js",
            "raw_url": "https://github.com/nodejs/node/raw/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Feval_stdin.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmain%2Feval_stdin.js?ref=09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e",
            "patch": "@@ -3,6 +3,7 @@\n // Stdin is not a TTY, we will read it and execute it.\n \n const {\n+  initializeDeprecations,\n   initializeClusterIPC,\n   initializePolicy,\n   initializeESMLoader,\n@@ -14,6 +15,7 @@ const {\n   readStdin\n } = require('internal/process/execution');\n \n+initializeDeprecations();\n initializeClusterIPC();\n initializePolicy();\n initializeESMLoader();"
        },
        {
            "sha": "7f746a6b11a951c6e58055cafea58f840d67320a",
            "filename": "lib/internal/main/eval_string.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Feval_string.js",
            "raw_url": "https://github.com/nodejs/node/raw/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Feval_string.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmain%2Feval_string.js?ref=09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e",
            "patch": "@@ -4,6 +4,7 @@\n // `--interactive`.\n \n const {\n+  initializeDeprecations,\n   initializeClusterIPC,\n   initializePolicy,\n   initializeESMLoader,\n@@ -13,6 +14,7 @@ const { evalScript } = require('internal/process/execution');\n const { addBuiltinLibsToObject } = require('internal/modules/cjs/helpers');\n \n const source = require('internal/options').getOptionValue('--eval');\n+initializeDeprecations();\n initializeClusterIPC();\n initializePolicy();\n initializeESMLoader();"
        },
        {
            "sha": "e931444ef3250210f01f40c62b7461b22f3cf17c",
            "filename": "lib/internal/main/repl.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Frepl.js",
            "raw_url": "https://github.com/nodejs/node/raw/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Frepl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmain%2Frepl.js?ref=09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e",
            "patch": "@@ -4,6 +4,7 @@\n // the main module is not specified and stdin is a TTY.\n \n const {\n+  initializeDeprecations,\n   initializeClusterIPC,\n   initializePolicy,\n   initializeESMLoader,\n@@ -14,6 +15,7 @@ const {\n   evalScript\n } = require('internal/process/execution');\n \n+initializeDeprecations();\n initializeClusterIPC();\n initializePolicy();\n initializeESMLoader();"
        },
        {
            "sha": "abc41fc20220f0a9b04f423e322d7cc949c612ee",
            "filename": "lib/internal/main/run_main_module.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Frun_main_module.js",
            "raw_url": "https://github.com/nodejs/node/raw/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Frun_main_module.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmain%2Frun_main_module.js?ref=09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e",
            "patch": "@@ -1,12 +1,14 @@\n 'use strict';\n \n const {\n+  initializeDeprecations,\n   initializeClusterIPC,\n   initializePolicy,\n   initializeESMLoader,\n   loadPreloadModules\n } = require('internal/bootstrap/pre_execution');\n \n+initializeDeprecations();\n initializeClusterIPC();\n initializePolicy();\n initializeESMLoader();"
        },
        {
            "sha": "7e4466c24d0c310a219c30eff0af9f8614664d6d",
            "filename": "lib/internal/main/worker_thread.js",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Fworker_thread.js",
            "raw_url": "https://github.com/nodejs/node/raw/09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e/lib%2Finternal%2Fmain%2Fworker_thread.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fmain%2Fworker_thread.js?ref=09a5f0252ed8e367dd29ba77e2931e5cf2a39a9e",
            "patch": "@@ -4,6 +4,7 @@\n // message port.\n \n const {\n+  initializeDeprecations,\n   initializeClusterIPC,\n   initializeESMLoader,\n   loadPreloadModules\n@@ -55,6 +56,7 @@ port.on('message', (message) => {\n     if (manifestSrc) {\n       require('internal/process/policy').setup(manifestSrc, manifestURL);\n     }\n+    initializeDeprecations();\n     initializeClusterIPC();\n     initializeESMLoader();\n     loadPreloadModules();"
        }
    ],
    "stats": {
        "total": 77,
        "additions": 54,
        "deletions": 23
    }
}