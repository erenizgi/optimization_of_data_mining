{
    "author": "joyeecheung",
    "message": "fs: throw fs.chmodSync errors in JS land\n\nPR-URL: https://github.com/nodejs/node/pull/18871\nRefs: https://github.com/nodejs/node/issues/18106\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "437c75649335a0b412670b82d3dfc37be7b01d0b",
    "files": [
        {
            "sha": "0d8d8ec4dcc44aa064a49fc3d45537cf1477b6e7",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/437c75649335a0b412670b82d3dfc37be7b01d0b/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/437c75649335a0b412670b82d3dfc37be7b01d0b/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=437c75649335a0b412670b82d3dfc37be7b01d0b",
            "patch": "@@ -1054,7 +1054,9 @@ fs.chmodSync = function(path, mode) {\n   validatePath(path);\n   mode = modeNum(mode);\n   validateUint32(mode, 'mode');\n-  return binding.chmod(pathModule.toNamespacedPath(path), mode);\n+  const ctx = { path };\n+  binding.chmod(pathModule.toNamespacedPath(path), mode, undefined, ctx);\n+  handleErrorFromBinding(ctx);\n };\n \n if (constants.O_SYMLINK !== undefined) {"
        },
        {
            "sha": "4e99953b626a584da8ee2006542ef99e2de42196",
            "filename": "src/node_file.cc",
            "status": "modified",
            "additions": 10,
            "deletions": 6,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/437c75649335a0b412670b82d3dfc37be7b01d0b/src%2Fnode_file.cc",
            "raw_url": "https://github.com/nodejs/node/raw/437c75649335a0b412670b82d3dfc37be7b01d0b/src%2Fnode_file.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.cc?ref=437c75649335a0b412670b82d3dfc37be7b01d0b",
            "patch": "@@ -1458,20 +1458,24 @@ static void Read(const FunctionCallbackInfo<Value>& args) {\n static void Chmod(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n-  CHECK_GE(args.Length(), 2);\n-  CHECK(args[1]->IsInt32());\n+  const int argc = args.Length();\n+  CHECK_GE(argc, 2);\n \n   BufferValue path(env->isolate(), args[0]);\n   CHECK_NE(*path, nullptr);\n \n-  int mode = static_cast<int>(args[1]->Int32Value());\n+  CHECK(args[1]->IsInt32());\n+  int mode = args[1].As<Int32>()->Value();\n \n   FSReqBase* req_wrap = GetReqWrap(env, args[2]);\n-  if (req_wrap != nullptr) {\n+  if (req_wrap != nullptr) {  // chmod(path, mode, req)\n     AsyncCall(env, req_wrap, args, \"chmod\", UTF8, AfterNoArgs,\n               uv_fs_chmod, *path, mode);\n-  } else {\n-    SYNC_CALL(chmod, *path, *path, mode);\n+  } else {  // chmod(path, mode, undefined, ctx)\n+    CHECK_EQ(argc, 4);\n+    fs_req_wrap req_wrap;\n+    SyncCall(env, args[3], &req_wrap, \"chmod\",\n+             uv_fs_chmod, *path, mode);\n   }\n }\n "
        }
    ],
    "stats": {
        "total": 20,
        "additions": 13,
        "deletions": 7
    }
}