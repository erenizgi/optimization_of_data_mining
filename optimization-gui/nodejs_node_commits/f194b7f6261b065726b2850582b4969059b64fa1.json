{
    "author": "BridgeAR",
    "message": "util: add inspection getter option\n\nCurrently it is not possible to inspect getters. To prevent any side\neffects this should not become a default but under lots of\ncircumstances it would still be useful to inspect getters. This way\nit is possible to actively opt into inspecting those.\n\nPR-URL: https://github.com/nodejs/node/pull/24852\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "f194b7f6261b065726b2850582b4969059b64fa1",
    "files": [
        {
            "sha": "0b9e47739487e9c178c6f31657ac1fa70204a45f",
            "filename": "doc/api/util.md",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/f194b7f6261b065726b2850582b4969059b64fa1/doc%2Fapi%2Futil.md",
            "raw_url": "https://github.com/nodejs/node/raw/f194b7f6261b065726b2850582b4969059b64fa1/doc%2Fapi%2Futil.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Futil.md?ref=f194b7f6261b065726b2850582b4969059b64fa1",
            "patch": "@@ -389,6 +389,9 @@ stream.write('With ES6');\n <!-- YAML\n added: v0.3.0\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/24852\n+    description: The `getters` option is supported now.\n   - version: v11.4.0\n     pr-url: https://github.com/nodejs/node/pull/24326\n     description: The `depth` default changed back to `2`.\n@@ -468,6 +471,11 @@ changes:\n     of an object and Set and Map entries will be sorted in the returned string.\n     If set to `true` the [default sort][] is going to be used. If set to a\n     function, it is used as a [compare function][].\n+  * `getters` {boolean|string} If set to `true`, getters are going to be\n+    inspected as well. If set to `'get'` only getters without setter are going\n+    to be inspected. If set to `'set'` only getters having a corresponding\n+    setter are going to be inspected. This might cause side effects depending on\n+    the getter function. **Default:** `false`.\n * Returns: {string} The representation of passed object\n \n The `util.inspect()` method returns a string representation of `object` that is"
        },
        {
            "sha": "f7e5507882f679d4295140e862e1e85d3c2fd618",
            "filename": "lib/internal/util/inspect.js",
            "status": "modified",
            "additions": 27,
            "deletions": 5,
            "changes": 32,
            "blob_url": "https://github.com/nodejs/node/blob/f194b7f6261b065726b2850582b4969059b64fa1/lib%2Finternal%2Futil%2Finspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/f194b7f6261b065726b2850582b4969059b64fa1/lib%2Finternal%2Futil%2Finspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspect.js?ref=f194b7f6261b065726b2850582b4969059b64fa1",
            "patch": "@@ -99,7 +99,8 @@ const inspectDefaultOptions = Object.seal({\n   maxArrayLength: 100,\n   breakLength: 60,\n   compact: true,\n-  sorted: false\n+  sorted: false,\n+  getters: false\n });\n \n const kObjectType = 0;\n@@ -167,7 +168,8 @@ function inspect(value, opts) {\n     maxArrayLength: inspectDefaultOptions.maxArrayLength,\n     breakLength: inspectDefaultOptions.breakLength,\n     compact: inspectDefaultOptions.compact,\n-    sorted: inspectDefaultOptions.sorted\n+    sorted: inspectDefaultOptions.sorted,\n+    getters: inspectDefaultOptions.getters\n   };\n   if (arguments.length > 1) {\n     // Legacy...\n@@ -1131,10 +1133,30 @@ function formatProperty(ctx, value, recurseTimes, key, type) {\n     }\n     ctx.indentationLvl -= diff;\n   } else if (desc.get !== undefined) {\n-    if (desc.set !== undefined) {\n-      str = ctx.stylize('[Getter/Setter]', 'special');\n+    const label = desc.set !== undefined ? 'Getter/Setter' : 'Getter';\n+    const s = ctx.stylize;\n+    const sp = 'special';\n+    if (ctx.getters && (ctx.getters === true ||\n+          ctx.getters === 'get' && desc.set === undefined ||\n+          ctx.getters === 'set' && desc.set !== undefined)) {\n+      try {\n+        const tmp = value[key];\n+        ctx.indentationLvl += 2;\n+        if (tmp === null) {\n+          str = `${s(`[${label}:`, sp)} ${s('null', 'null')}${s(']', sp)}`;\n+        } else if (typeof tmp === 'object') {\n+          str = `${s(`[${label}]`, sp)} ${formatValue(ctx, tmp, recurseTimes)}`;\n+        } else {\n+          const primitive = formatPrimitive(s, tmp, ctx);\n+          str = `${s(`[${label}:`, sp)} ${primitive}${s(']', sp)}`;\n+        }\n+        ctx.indentationLvl -= 2;\n+      } catch (err) {\n+        const message = `<Inspection threw (${err.message})>`;\n+        str = `${s(`[${label}:`, sp)} ${message}${s(']', sp)}`;\n+      }\n     } else {\n-      str = ctx.stylize('[Getter]', 'special');\n+      str = ctx.stylize(`[${label}]`, sp);\n     }\n   } else if (desc.set !== undefined) {\n     str = ctx.stylize('[Setter]', 'special');"
        },
        {
            "sha": "20b03d2dd0297bdf59a707c6bea69191a84f70de",
            "filename": "test/parallel/test-util-inspect.js",
            "status": "modified",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/nodejs/node/blob/f194b7f6261b065726b2850582b4969059b64fa1/test%2Fparallel%2Ftest-util-inspect.js",
            "raw_url": "https://github.com/nodejs/node/raw/f194b7f6261b065726b2850582b4969059b64fa1/test%2Fparallel%2Ftest-util-inspect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-util-inspect.js?ref=f194b7f6261b065726b2850582b4969059b64fa1",
            "patch": "@@ -1764,3 +1764,36 @@ assert.strictEqual(\n   });\n   assert.strictEqual(util.inspect(obj), '[Set: null prototype] { 1, 2 }');\n }\n+\n+// Check the getter option.\n+{\n+  let foo = 1;\n+  const get = { get foo() { return foo; } };\n+  const getset = {\n+    get foo() { return foo; },\n+    set foo(val) { foo = val; },\n+    get inc() { return ++foo; }\n+  };\n+  const thrower = { get foo() { throw new Error('Oops'); } };\n+  assert.strictEqual(\n+    inspect(get, { getters: true, colors: true }),\n+    '{ foo: \\u001b[36m[Getter:\\u001b[39m ' +\n+      '\\u001b[33m1\\u001b[39m\\u001b[36m]\\u001b[39m }');\n+  assert.strictEqual(\n+    inspect(thrower, { getters: true }),\n+    '{ foo: [Getter: <Inspection threw (Oops)>] }');\n+  assert.strictEqual(\n+    inspect(getset, { getters: true }),\n+    '{ foo: [Getter/Setter: 1], inc: [Getter: 2] }');\n+  assert.strictEqual(\n+    inspect(getset, { getters: 'get' }),\n+    '{ foo: [Getter/Setter], inc: [Getter: 3] }');\n+  assert.strictEqual(\n+    inspect(getset, { getters: 'set' }),\n+    '{ foo: [Getter/Setter: 3], inc: [Getter] }');\n+  getset.foo = new Set([[{ a: true }, 2, {}], 'foobar', { x: 1 }]);\n+  assert.strictEqual(\n+    inspect(getset, { getters: true }),\n+    '{ foo: [Getter/Setter] Set { [ [Object], 2, {} ], ' +\n+      \"'foobar', { x: 1 } },\\n  inc: [Getter: NaN] }\");\n+}"
        }
    ],
    "stats": {
        "total": 73,
        "additions": 68,
        "deletions": 5
    }
}