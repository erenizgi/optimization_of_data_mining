{
    "author": "joyeecheung",
    "message": "src: remove `process.binding('config').debugOptions`\n\n`process.binding('config').debugOptions`, which contains the initial\nvalues of parsed debugger-related CLI options, has been used for\ninternal testing. This patch removes them and uses `internal/options`\nto query the values in the tests instead.\n\nPR-URL: https://github.com/nodejs/node/pull/25999\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "b200a46befd936cbf1b5356045d88ba9e8156e87",
    "files": [
        {
            "sha": "c051e1186afa913079f3ff48b2ec703bf6fe56d4",
            "filename": "src/node_config.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 15,
            "changes": 15,
            "blob_url": "https://github.com/nodejs/node/blob/b200a46befd936cbf1b5356045d88ba9e8156e87/src%2Fnode_config.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b200a46befd936cbf1b5356045d88ba9e8156e87/src%2Fnode_config.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_config.cc?ref=b200a46befd936cbf1b5356045d88ba9e8156e87",
            "patch": "@@ -6,9 +6,7 @@\n \n namespace node {\n \n-using v8::Boolean;\n using v8::Context;\n-using v8::Integer;\n using v8::Isolate;\n using v8::Local;\n using v8::Number;\n@@ -72,19 +70,6 @@ static void Initialize(Local<Object> target,\n   READONLY_PROPERTY(target,\n                     \"bits\",\n                     Number::New(env->isolate(), 8 * sizeof(intptr_t)));\n-\n-  Local<Object> debug_options_obj = Object::New(isolate);\n-  READONLY_PROPERTY(target, \"debugOptions\", debug_options_obj);\n-\n-  const DebugOptions& debug_options = env->options()->debug_options();\n-  READONLY_PROPERTY(debug_options_obj,\n-                    \"inspectorEnabled\",\n-                    Boolean::New(isolate, debug_options.inspector_enabled));\n-  READONLY_STRING_PROPERTY(\n-      debug_options_obj, \"host\", debug_options.host_port.host());\n-  READONLY_PROPERTY(debug_options_obj,\n-                    \"port\",\n-                    Integer::New(isolate, debug_options.host_port.port()));\n }  // InitConfig\n \n }  // namespace node"
        },
        {
            "sha": "7b541eb156e0cd6bc9571c60ac8a504586e933e1",
            "filename": "test/sequential/test-inspector-port-cluster.js",
            "status": "modified",
            "additions": 78,
            "deletions": 72,
            "changes": 150,
            "blob_url": "https://github.com/nodejs/node/blob/b200a46befd936cbf1b5356045d88ba9e8156e87/test%2Fsequential%2Ftest-inspector-port-cluster.js",
            "raw_url": "https://github.com/nodejs/node/raw/b200a46befd936cbf1b5356045d88ba9e8156e87/test%2Fsequential%2Ftest-inspector-port-cluster.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fsequential%2Ftest-inspector-port-cluster.js?ref=b200a46befd936cbf1b5356045d88ba9e8156e87",
            "patch": "@@ -1,5 +1,7 @@\n 'use strict';\n \n+// Flags: --expose-internals\n+\n const common = require('../common');\n \n common.skipIfInspectorDisabled();\n@@ -205,7 +207,7 @@ function testRunnerMain() {\n }\n function masterProcessMain() {\n   const workers = JSON.parse(process.env.workers);\n-  const clusterSettings = JSON.parse(process.env.clusterSettings);\n+  const clusterSettings = JSON.parse(process.env.clusterSettings) || {};\n   const badPortError = { type: RangeError, code: 'ERR_SOCKET_BAD_PORT' };\n   let debugPort = process.debugPort;\n \n@@ -224,85 +226,89 @@ function masterProcessMain() {\n       params.expectedHost = worker.expectedHost;\n     }\n \n-    if (clusterSettings) {\n-      if (clusterSettings.inspectPort === 'addTwo') {\n-        clusterSettings.inspectPort = common.mustCall(\n-          () => { return debugPort += 2; },\n-          workers.length\n-        );\n-      } else if (clusterSettings.inspectPort === 'string') {\n-        clusterSettings.inspectPort = 'string';\n-        cluster.setupMaster(clusterSettings);\n-\n-        common.expectsError(() => {\n-          cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n-        }, badPortError);\n-\n-        return;\n-      } else if (clusterSettings.inspectPort === 'null') {\n-        clusterSettings.inspectPort = null;\n-        cluster.setupMaster(clusterSettings);\n-\n-        common.expectsError(() => {\n-          cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n-        }, badPortError);\n-\n-        return;\n-      } else if (clusterSettings.inspectPort === 'bignumber') {\n-        clusterSettings.inspectPort = 1293812;\n-        cluster.setupMaster(clusterSettings);\n-\n-        common.expectsError(() => {\n-          cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n-        }, badPortError);\n-\n-        return;\n-      } else if (clusterSettings.inspectPort === 'negativenumber') {\n-        clusterSettings.inspectPort = -9776;\n-        cluster.setupMaster(clusterSettings);\n-\n-        common.expectsError(() => {\n-          cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n-        }, badPortError);\n-\n-        return;\n-      } else if (clusterSettings.inspectPort === 'bignumberfunc') {\n-        clusterSettings.inspectPort = common.mustCall(\n-          () => 123121,\n-          workers.length\n-        );\n-\n-        cluster.setupMaster(clusterSettings);\n-\n-        common.expectsError(() => {\n-          cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n-        }, badPortError);\n-\n-        return;\n-      } else if (clusterSettings.inspectPort === 'strfunc') {\n-        clusterSettings.inspectPort = common.mustCall(\n-          () => 'invalidPort',\n-          workers.length\n-        );\n-\n-        cluster.setupMaster(clusterSettings);\n-\n-        common.expectsError(() => {\n-          cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n-        }, badPortError);\n-\n-        return;\n-      }\n+    clusterSettings.execArgv = clusterSettings.execArgv ?\n+      clusterSettings.execArgv.concat(['--expose-internals']) :\n+      process.execArgv.concat(['--expose-internals']);\n+\n+    if (clusterSettings.inspectPort === 'addTwo') {\n+      clusterSettings.inspectPort = common.mustCall(\n+        () => { return debugPort += 2; },\n+        workers.length\n+      );\n+    } else if (clusterSettings.inspectPort === 'string') {\n+      clusterSettings.inspectPort = 'string';\n+      cluster.setupMaster(clusterSettings);\n+\n+      common.expectsError(() => {\n+        cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n+      }, badPortError);\n+\n+      return;\n+    } else if (clusterSettings.inspectPort === 'null') {\n+      clusterSettings.inspectPort = null;\n       cluster.setupMaster(clusterSettings);\n+\n+      common.expectsError(() => {\n+        cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n+      }, badPortError);\n+\n+      return;\n+    } else if (clusterSettings.inspectPort === 'bignumber') {\n+      clusterSettings.inspectPort = 1293812;\n+      cluster.setupMaster(clusterSettings);\n+\n+      common.expectsError(() => {\n+        cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n+      }, badPortError);\n+\n+      return;\n+    } else if (clusterSettings.inspectPort === 'negativenumber') {\n+      clusterSettings.inspectPort = -9776;\n+      cluster.setupMaster(clusterSettings);\n+\n+      common.expectsError(() => {\n+        cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n+      }, badPortError);\n+\n+      return;\n+    } else if (clusterSettings.inspectPort === 'bignumberfunc') {\n+      clusterSettings.inspectPort = common.mustCall(\n+        () => 123121,\n+        workers.length\n+      );\n+\n+      cluster.setupMaster(clusterSettings);\n+\n+      common.expectsError(() => {\n+        cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n+      }, badPortError);\n+\n+      return;\n+    } else if (clusterSettings.inspectPort === 'strfunc') {\n+      clusterSettings.inspectPort = common.mustCall(\n+        () => 'invalidPort',\n+        workers.length\n+      );\n+\n+      cluster.setupMaster(clusterSettings);\n+\n+      common.expectsError(() => {\n+        cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n+      }, badPortError);\n+\n+      return;\n     }\n \n+    cluster.setupMaster(clusterSettings);\n+\n     cluster.fork(params).on('exit', common.mustCall(checkExitCode));\n   }\n }\n \n function workerProcessMain() {\n   const { expectedPort, expectedInitialPort, expectedHost } = process.env;\n-  const debugOptions = process.binding('config').debugOptions;\n+  const debugOptions =\n+    require('internal/options').getOptionValue('--inspect-port');\n \n   if ('expectedPort' in process.env) {\n     assert.strictEqual(process.debugPort, +expectedPort);\n@@ -327,7 +333,7 @@ function spawnMaster({ execArgv, workers, clusterSettings = {} }) {\n         clusterSettings: JSON.stringify(clusterSettings),\n         testProcess: true\n       }),\n-      execArgv\n+      execArgv: execArgv.concat(['--expose-internals'])\n     }).on('exit', common.mustCall((code, signal) => {\n       checkExitCode(code, signal);\n       resolve();"
        }
    ],
    "stats": {
        "total": 165,
        "additions": 78,
        "deletions": 87
    }
}