{
    "author": "targos",
    "message": "deps: backport String::Write{OneByte,Utf8} with isolate\n\nThese overloads were added in V8 6.9 and the ones without the isolate\nparameter were removed in V8 7.0.\n\nRefs: https://github.com/v8/v8/commit/8a011b57d8b26e9cfe1c20a2ef26adb14be6ecc2\n\nPR-URL: https://github.com/nodejs/node/pull/22531\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "7c84489b8828797e77236da26594bd642d0120f9",
    "files": [
        {
            "sha": "ba4966e435171cf1d3425e46d3d13eaa3924b934",
            "filename": "common.gypi",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/7c84489b8828797e77236da26594bd642d0120f9/common.gypi",
            "raw_url": "https://github.com/nodejs/node/raw/7c84489b8828797e77236da26594bd642d0120f9/common.gypi",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/common.gypi?ref=7c84489b8828797e77236da26594bd642d0120f9",
            "patch": "@@ -29,7 +29,7 @@\n \n     # Reset this number to 0 on major V8 upgrades.\n     # Increment by one for each non-official patch applied to deps/v8.\n-    'v8_embedder_string': '-node.20',\n+    'v8_embedder_string': '-node.21',\n \n     # Enable disassembler for `--print-code` v8 options\n     'v8_enable_disassembler': 1,"
        },
        {
            "sha": "67c1e1065fefce8477fe361bc2a02a6d18ab4290",
            "filename": "deps/v8/include/v8.h",
            "status": "modified",
            "additions": 16,
            "deletions": 11,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/7c84489b8828797e77236da26594bd642d0120f9/deps%2Fv8%2Finclude%2Fv8.h",
            "raw_url": "https://github.com/nodejs/node/raw/7c84489b8828797e77236da26594bd642d0120f9/deps%2Fv8%2Finclude%2Fv8.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8.h?ref=7c84489b8828797e77236da26594bd642d0120f9",
            "patch": "@@ -2728,20 +2728,25 @@ class V8_EXPORT String : public Name {\n   };\n \n   // 16-bit character codes.\n-  int Write(uint16_t* buffer,\n-            int start = 0,\n-            int length = -1,\n+  int Write(Isolate* isolate, uint16_t* buffer, int start = 0, int length = -1,\n             int options = NO_OPTIONS) const;\n+  V8_DEPRECATE_SOON(\"Use Isolate* version\",\n+                    int Write(uint16_t* buffer, int start = 0, int length = -1,\n+                              int options = NO_OPTIONS) const);\n   // One byte characters.\n-  int WriteOneByte(uint8_t* buffer,\n-                   int start = 0,\n-                   int length = -1,\n-                   int options = NO_OPTIONS) const;\n+  int WriteOneByte(Isolate* isolate, uint8_t* buffer, int start = 0,\n+                   int length = -1, int options = NO_OPTIONS) const;\n+  V8_DEPRECATE_SOON(\"Use Isolate* version\",\n+                    int WriteOneByte(uint8_t* buffer, int start = 0,\n+                                     int length = -1, int options = NO_OPTIONS)\n+                        const);\n   // UTF-8 encoded characters.\n-  int WriteUtf8(char* buffer,\n-                int length = -1,\n-                int* nchars_ref = NULL,\n-                int options = NO_OPTIONS) const;\n+  int WriteUtf8(Isolate* isolate, char* buffer, int length = -1,\n+                int* nchars_ref = NULL, int options = NO_OPTIONS) const;\n+  V8_DEPRECATE_SOON(\"Use Isolate* version\",\n+                    int WriteUtf8(char* buffer, int length = -1,\n+                                  int* nchars_ref = NULL,\n+                                  int options = NO_OPTIONS) const);\n \n   /**\n    * A zero length string."
        },
        {
            "sha": "ffb685320667b20a1f6fd30ca47622b825b6fbe3",
            "filename": "deps/v8/src/api.cc",
            "status": "modified",
            "additions": 29,
            "deletions": 13,
            "changes": 42,
            "blob_url": "https://github.com/nodejs/node/blob/7c84489b8828797e77236da26594bd642d0120f9/deps%2Fv8%2Fsrc%2Fapi.cc",
            "raw_url": "https://github.com/nodejs/node/raw/7c84489b8828797e77236da26594bd642d0120f9/deps%2Fv8%2Fsrc%2Fapi.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fapi.cc?ref=7c84489b8828797e77236da26594bd642d0120f9",
            "patch": "@@ -5710,12 +5710,10 @@ static bool RecursivelySerializeToUtf8(i::String* current,\n }\n \n \n-int String::WriteUtf8(char* buffer,\n-                      int capacity,\n-                      int* nchars_ref,\n-                      int options) const {\n+int String::WriteUtf8(Isolate* v8_isolate, char* buffer, int capacity,\n+                      int* nchars_ref, int options) const {\n   i::Handle<i::String> str = Utils::OpenHandle(this);\n-  i::Isolate* isolate = str->GetIsolate();\n+  i::Isolate* isolate = reinterpret_cast<i::Isolate*>(v8_isolate);\n   LOG_API(isolate, String, WriteUtf8);\n   ENTER_V8_NO_SCRIPT_NO_EXCEPTION(isolate);\n   str = i::String::Flatten(str);  // Flatten the string for efficiency.\n@@ -5756,14 +5754,18 @@ int String::WriteUtf8(char* buffer,\n   return writer.CompleteWrite(write_null, nchars_ref);\n }\n \n+int String::WriteUtf8(char* buffer, int capacity, int* nchars_ref,\n+                      int options) const {\n+  i::Handle<i::String> str = Utils::OpenHandle(this);\n+  i::Isolate* isolate = str->GetIsolate();\n+  return WriteUtf8(reinterpret_cast<Isolate*>(isolate), buffer, capacity,\n+                   nchars_ref, options);\n+}\n \n-template<typename CharType>\n-static inline int WriteHelper(const String* string,\n-                              CharType* buffer,\n-                              int start,\n-                              int length,\n+template <typename CharType>\n+static inline int WriteHelper(i::Isolate* isolate, const String* string,\n+                              CharType* buffer, int start, int length,\n                               int options) {\n-  i::Isolate* isolate = Utils::OpenHandle(string)->GetIsolate();\n   LOG_API(isolate, String, Write);\n   ENTER_V8_NO_SCRIPT_NO_EXCEPTION(isolate);\n   DCHECK(start >= 0 && length >= -1);\n@@ -5786,15 +5788,29 @@ int String::WriteOneByte(uint8_t* buffer,\n                          int start,\n                          int length,\n                          int options) const {\n-  return WriteHelper(this, buffer, start, length, options);\n+  i::Isolate* isolate = Utils::OpenHandle(this)->GetIsolate();\n+  return WriteHelper(isolate, this, buffer, start, length, options);\n+}\n+\n+int String::WriteOneByte(Isolate* isolate, uint8_t* buffer, int start,\n+                         int length, int options) const {\n+  return WriteHelper(reinterpret_cast<i::Isolate*>(isolate), this, buffer,\n+                     start, length, options);\n }\n \n \n int String::Write(uint16_t* buffer,\n                   int start,\n                   int length,\n                   int options) const {\n-  return WriteHelper(this, buffer, start, length, options);\n+  i::Isolate* isolate = Utils::OpenHandle(this)->GetIsolate();\n+  return WriteHelper(isolate, this, buffer, start, length, options);\n+}\n+\n+int String::Write(Isolate* isolate, uint16_t* buffer, int start, int length,\n+                  int options) const {\n+  return WriteHelper(reinterpret_cast<i::Isolate*>(isolate), this, buffer,\n+                     start, length, options);\n }\n \n "
        }
    ],
    "stats": {
        "total": 71,
        "additions": 46,
        "deletions": 25
    }
}