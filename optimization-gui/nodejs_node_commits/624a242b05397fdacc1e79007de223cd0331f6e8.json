{
    "author": "sam-github",
    "message": "test: simplify regression test for SEGV\n\nTest was introduced in 08a5b442e4 as a regression test, and has evolved\nsince then. Simplify the test so that it doesn't rely on an undocumented\nargument to tls.createSecureCredentials().\n\nSee: https://github.com/nodejs/node-v0.x-archive/issues/6690\n\nConfirmation that this reworked test triggers the original bug:\n\n\t%) % node\n\t> process.version\n\t'v0.10.48'\n\t> credentials = crypto.createCredentials()\n\t{ context: {} }\n\t> context = credentials.context\n\t{}\n\t> notcontext = { setOptions: context.setOptions }\n\t{ setOptions: [Function: setOptions] }\n\t> notcontext.setOptions()\n\tnode: ../src/node_object_wrap.h:61: static T* node::ObjectWrap::Unwrap(v8::Handle<v8::Object>) [with T = node::crypto::SecureContext]: Assertion `handle->InternalFieldCount() > 0' failed.\n\tzsh: abort (core dumped)  node\n\nPR-URL: https://github.com/nodejs/node/pull/24241\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "624a242b05397fdacc1e79007de223cd0331f6e8",
    "files": [
        {
            "sha": "21e2cca5bd33296ae8e55069dee9519ce795c4af",
            "filename": "test/parallel/test-crypto.js",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/624a242b05397fdacc1e79007de223cd0331f6e8/test%2Fparallel%2Ftest-crypto.js",
            "raw_url": "https://github.com/nodejs/node/raw/624a242b05397fdacc1e79007de223cd0331f6e8/test%2Fparallel%2Ftest-crypto.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto.js?ref=624a242b05397fdacc1e79007de223cd0331f6e8",
            "patch": "@@ -38,19 +38,19 @@ const tls = require('tls');\n const fixtures = require('../common/fixtures');\n \n // Test Certificates\n-const caPem = fixtures.readSync('test_ca.pem', 'ascii');\n-const certPem = fixtures.readSync('test_cert.pem', 'ascii');\n const certPfx = fixtures.readSync('test_cert.pfx');\n-const keyPem = fixtures.readSync('test_key.pem', 'ascii');\n \n // 'this' safety\n // https://github.com/joyent/node/issues/6690\n assert.throws(function() {\n-  const options = { key: keyPem, cert: certPem, ca: caPem };\n-  const credentials = tls.createSecureContext(options);\n+  const credentials = tls.createSecureContext();\n   const context = credentials.context;\n-  const notcontext = { setOptions: context.setOptions, setKey: context.setKey };\n-  tls.createSecureContext({ secureOptions: 1 }, notcontext);\n+  const notcontext = { setOptions: context.setOptions };\n+\n+  // Methods of native objects should not segfault when reassigned to a new\n+  // object and called illegally. This core dumped in 0.10 and was fixed in\n+  // 0.11.\n+  notcontext.setOptions();\n }, (err) => {\n   // Throws TypeError, so there is no opensslErrorStack property.\n   if ((err instanceof Error) &&"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 7,
        "deletions": 7
    }
}