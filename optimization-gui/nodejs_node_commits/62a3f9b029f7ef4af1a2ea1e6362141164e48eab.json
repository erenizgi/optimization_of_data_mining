{
    "author": "refack",
    "message": "build: add `--verbose` to `./configure`\n\nPR-URL: https://github.com/nodejs/node/pull/22450\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>",
    "sha": "62a3f9b029f7ef4af1a2ea1e6362141164e48eab",
    "files": [
        {
            "sha": "da696a92b48c1a23c38979d260cbf1aff3c22d26",
            "filename": "configure.py",
            "status": "modified",
            "additions": 28,
            "deletions": 12,
            "changes": 40,
            "blob_url": "https://github.com/nodejs/node/blob/62a3f9b029f7ef4af1a2ea1e6362141164e48eab/configure.py",
            "raw_url": "https://github.com/nodejs/node/raw/62a3f9b029f7ef4af1a2ea1e6362141164e48eab/configure.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/configure.py?ref=62a3f9b029f7ef4af1a2ea1e6362141164e48eab",
            "patch": "@@ -559,6 +559,12 @@\n     default=False,\n     help='build V8 using GN instead of gyp')\n \n+parser.add_option('--verbose',\n+    action='store_true',\n+    dest='verbose',\n+    default=False,\n+    help='get more output from this script')\n+\n # Create compile_commands.json in out/Debug and out/Release.\n parser.add_option('-C',\n     action='store_true',\n@@ -587,6 +593,14 @@ def warn(msg):\n # track if warnings occurred\n warn.warned = False\n \n+def print_verbose(x):\n+  if not options.verbose:\n+    return\n+  if type(x) is str:\n+    print x\n+  else:\n+    pprint.pprint(x, indent=2)\n+\n def b(value):\n   \"\"\"Returns the string 'true' if value is truthy, 'false' otherwise.\"\"\"\n   if value:\n@@ -1199,7 +1213,7 @@ def without_ssl_error(option):\n def configure_static(o):\n   if options.fully_static or options.partly_static:\n     if flavor == 'mac':\n-      print(\"Generation of static executable will not work on OSX \"\n+      warn(\"Generation of static executable will not work on OSX \"\n             \"when using the default compilation environment\")\n       return\n \n@@ -1213,9 +1227,9 @@ def configure_static(o):\n \n def write(filename, data):\n   filename = filename\n-  print('creating %s' % filename)\n-  f = open(filename, 'w+')\n-  f.write(data)\n+  print_verbose('creating %s' % filename)\n+  with open(filename, 'w+') as f:\n+    f.write(data)\n \n do_not_edit = '# Do not edit. Generated by the configure script.\\n'\n \n@@ -1233,7 +1247,7 @@ def glob_to_var(dir_base, dir_sub, patch_dir):\n           patchfile = '%s/%s/%s' % (dir_base, patch_dir, file)\n           if os.path.isfile(patchfile):\n             srcfile = '%s/%s' % (patch_dir, file)\n-            print('Using version-specific floating patch %s' % patchfile)\n+            warn('Using floating patch \"%s\" from \"%s\"' % (patchfile, dir_base))\n         list.append(srcfile)\n     break\n   return list\n@@ -1267,8 +1281,8 @@ def icu_download(path):\n         if (md5 == gotmd5):\n           return targetfile\n         else:\n-          print('Expected: %s      *MISMATCH*' % md5)\n-          print('\\n ** Corrupted ZIP? Delete %s to retry download.\\n' % targetfile)\n+          error('Expected: %s      *MISMATCH*' % md5)\n+          error('\\n ** Corrupted ZIP? Delete %s to retry download.\\n' % targetfile)\n     return None\n   icu_config = {\n     'variables': {}\n@@ -1369,7 +1383,7 @@ def write_config(data, name):\n   # --with-icu-source processing\n   # now, check that they didn't pass --with-icu-source=deps/icu\n   elif with_icu_source and os.path.abspath(icu_full_path) == os.path.abspath(with_icu_source):\n-    print('Ignoring redundant --with-icu-source=%s' % with_icu_source)\n+    warn('Ignoring redundant --with-icu-source=%s' % with_icu_source)\n     with_icu_source = None\n   # if with_icu_source is still set, try to use it.\n   if with_icu_source:\n@@ -1412,7 +1426,7 @@ def write_config(data, name):\n   # ICU source dir relative to tools/icu (for .gyp file)\n   o['variables']['icu_path'] = icu_full_path\n   if not os.path.isdir(icu_full_path):\n-    print('* ECMA-402 (Intl) support didn\\'t find ICU in %s..' % icu_full_path)\n+    warn('* ECMA-402 (Intl) support didn\\'t find ICU in %s..' % icu_full_path)\n     # can we download (or find) a zipfile?\n     localzip = icu_download(icu_full_path)\n     if localzip:\n@@ -1421,7 +1435,7 @@ def write_config(data, name):\n     error('''Cannot build Intl without ICU in %s.\n        Fix, or disable with \"--with-intl=none\"''' % icu_full_path)\n   else:\n-    print('* Using ICU in %s' % icu_full_path)\n+    print_verbose('* Using ICU in %s' % icu_full_path)\n   # Now, what version of ICU is it? We just need the \"major\", such as 54.\n   # uvernum.h contains it as a #define.\n   uvernum_h = os.path.join(icu_full_path, 'source/common/unicode/uvernum.h')\n@@ -1584,7 +1598,7 @@ def make_bin_override():\n if make_global_settings:\n   output['make_global_settings'] = make_global_settings\n \n-pprint.pprint(output, indent=2)\n+print_verbose(output)\n \n write('config.gypi', do_not_edit +\n       pprint.pformat(output, indent=2) + '\\n')\n@@ -1623,9 +1637,11 @@ def make_bin_override():\n if options.compile_commands_json:\n   gyp_args += ['-f', 'compile_commands_json']\n \n+# pass the leftover positional arguments to GYP\n gyp_args += args\n \n-if warn.warned:\n+if warn.warned and not options.verbose:\n   warn('warnings were emitted in the configure phase')\n \n+print_verbose(\"running: \\n    \" + \" \".join(['python', 'tools/gyp_node.py'] + gyp_args))\n run_gyp(gyp_args)"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 28,
        "deletions": 12
    }
}