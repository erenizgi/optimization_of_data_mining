{
    "author": "BridgeAR",
    "message": "assert: improve the strict equal messages\n\nIn case reference (un)equal objects fail in assertion, it should be\nclear that it is about the reference equality and not about the\nobject properties. This is fixed by improving the message in such\ncases.\n\nRefs: https://github.com/nodejs/node/issues/22763\n\nPR-URL: https://github.com/nodejs/node/pull/23056\nRefs: https://github.com/nodejs/node/issues/22763\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Ujjwal Sharma <usharma1998@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>",
    "sha": "be26c761146db8357653df345e505a624b2153da",
    "files": [
        {
            "sha": "b6c1253ba9975174ea1799a22eebc72757a49bd1",
            "filename": "lib/internal/assert.js",
            "status": "modified",
            "additions": 26,
            "deletions": 5,
            "changes": 31,
            "blob_url": "https://github.com/nodejs/node/blob/be26c761146db8357653df345e505a624b2153da/lib%2Finternal%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/be26c761146db8357653df345e505a624b2153da/lib%2Finternal%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fassert.js?ref=be26c761146db8357653df345e505a624b2153da",
            "patch": "@@ -13,10 +13,13 @@ let white = '';\n const kReadableOperator = {\n   deepStrictEqual: 'Expected inputs to be strictly deep-equal:',\n   strictEqual: 'Expected inputs to be strictly equal:',\n+  strictEqualObject: 'Expected \"actual\" to be reference-equal to \"expected\":',\n   deepEqual: 'Expected inputs to be loosely deep-equal:',\n   equal: 'Expected inputs to be loosely equal:',\n   notDeepStrictEqual: 'Expected \"actual\" not to be strictly deep-equal to:',\n   notStrictEqual: 'Expected \"actual\" to be strictly unequal to:',\n+  // eslint-disable-next-line max-len\n+  notStrictEqualObject: 'Expected \"actual\" not to be reference-equal to \"expected\":',\n   notDeepEqual: 'Expected \"actual\" not to be loosely deep-equal to:',\n   notEqual: 'Expected \"actual\" to be loosely unequal to:',\n   notIdentical: 'Inputs identical but not reference equal:',\n@@ -67,13 +70,20 @@ function createErrDiff(actual, expected, operator) {\n   const actualInspected = inspectValue(actual);\n   const actualLines = actualInspected.split('\\n');\n   const expectedLines = inspectValue(expected).split('\\n');\n-  const msg = kReadableOperator[operator] +\n-        `\\n${green}+ actual${white} ${red}- expected${white}`;\n-  const skippedMsg = ` ${blue}...${white} Lines skipped`;\n \n   let i = 0;\n   let indicator = '';\n \n+  // In case both inputs are objects explicitly mark them as not reference equal\n+  // for the `strictEqual` operator.\n+  if (operator === 'strictEqual' &&\n+      typeof actual === 'object' &&\n+      typeof expected === 'object' &&\n+      actual !== null &&\n+      expected !== null) {\n+    operator = 'strictEqualObject';\n+  }\n+\n   // If \"actual\" and \"expected\" fit on a single line and they are not strictly\n   // equal, check further special handling.\n   if (actualLines.length === 1 && expectedLines.length === 1 &&\n@@ -89,7 +99,7 @@ function createErrDiff(actual, expected, operator) {\n         return `${kReadableOperator[operator]}\\n\\n` +\n             `${actualLines[0]} !== ${expectedLines[0]}\\n`;\n       }\n-    } else {\n+    } else if (operator !== 'strictEqualObject') {\n       // If the stderr is a tty and the input length is lower than the current\n       // columns per line, add a mismatch indicator below the output. If it is\n       // not a tty, use a default value of 80 characters.\n@@ -156,6 +166,10 @@ function createErrDiff(actual, expected, operator) {\n   }\n \n   let printedLines = 0;\n+  const msg = kReadableOperator[operator] +\n+        `\\n${green}+ actual${white} ${red}- expected${white}`;\n+  const skippedMsg = ` ${blue}...${white} Lines skipped`;\n+\n   for (i = 0; i < maxLines; i++) {\n     // Only extra expected lines exist\n     const cur = i - lastPos;\n@@ -274,8 +288,15 @@ class AssertionError extends Error {\n         operator === 'notStrictEqual') {\n         // In case the objects are equal but the operator requires unequal, show\n         // the first object and say A equals B\n+        let base = kReadableOperator[operator];\n         const res = inspectValue(actual).split('\\n');\n-        const base = kReadableOperator[operator];\n+\n+        // In case \"actual\" is an object, it should not be reference equal.\n+        if (operator === 'notStrictEqual' &&\n+            typeof actual === 'object' &&\n+            actual !== null) {\n+          base = kReadableOperator.notStrictEqualObject;\n+        }\n \n         // Only remove lines in case it makes sense to collapse those.\n         // TODO: Accept env to always show the full error."
        },
        {
            "sha": "883ebea1a2df768c501b6fb72730570677646ac0",
            "filename": "test/parallel/test-assert.js",
            "status": "modified",
            "additions": 44,
            "deletions": 3,
            "changes": 47,
            "blob_url": "https://github.com/nodejs/node/blob/be26c761146db8357653df345e505a624b2153da/test%2Fparallel%2Ftest-assert.js",
            "raw_url": "https://github.com/nodejs/node/raw/be26c761146db8357653df345e505a624b2153da/test%2Fparallel%2Ftest-assert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert.js?ref=be26c761146db8357653df345e505a624b2153da",
            "patch": "@@ -415,9 +415,9 @@ assert.throws(\n   {\n     code: 'ERR_ASSERTION',\n     name: 'AssertionError [ERR_ASSERTION]',\n-    message: strictEqualMessageStart +\n+    message: 'Expected \"actual\" to be reference-equal to \"expected\":\\n' +\n              '+ actual - expected\\n\\n' +\n-             '+ [Error: foo]\\n- [Error: foobar]\\n             ^'\n+             '+ [Error: foo]\\n- [Error: foobar]'\n   }\n );\n \n@@ -1022,7 +1022,8 @@ assert.throws(\n   assert.throws(\n     () => assert.strictEqual(args, { 0: 'a' }),\n     {\n-      message: `${strictEqualMessageStart}+ actual - expected\\n\\n` +\n+      message: 'Expected \"actual\" to be reference-equal to \"expected\":\\n' +\n+               '+ actual - expected\\n\\n' +\n                \"+ [Arguments] {\\n- {\\n    '0': 'a'\\n  }\"\n     }\n   );\n@@ -1091,3 +1092,43 @@ assert.throws(\n     }\n   );\n }\n+\n+// Indicate where the strings diverge.\n+assert.throws(\n+  () => assert.strictEqual('test test', 'test foobar'),\n+  {\n+    code: 'ERR_ASSERTION',\n+    name: 'AssertionError [ERR_ASSERTION]',\n+    message: strictEqualMessageStart +\n+             '+ actual - expected\\n\\n' +\n+             \"+ 'test test'\\n\" +\n+             \"- 'test foobar'\\n\" +\n+             '        ^'\n+  }\n+);\n+\n+// Check for reference equal objects in `notStrictEqual()`\n+assert.throws(\n+  () => {\n+    const obj = {};\n+    assert.notStrictEqual(obj, obj);\n+  },\n+  {\n+    code: 'ERR_ASSERTION',\n+    name: 'AssertionError [ERR_ASSERTION]',\n+    message: 'Expected \"actual\" not to be reference-equal to \"expected\": {}'\n+  }\n+);\n+\n+assert.throws(\n+  () => {\n+    const obj = { a: true };\n+    assert.notStrictEqual(obj, obj);\n+  },\n+  {\n+    code: 'ERR_ASSERTION',\n+    name: 'AssertionError [ERR_ASSERTION]',\n+    message: 'Expected \"actual\" not to be reference-equal to \"expected\":\\n\\n' +\n+             '{\\n  a: true\\n}\\n'\n+  }\n+);"
        }
    ],
    "stats": {
        "total": 78,
        "additions": 70,
        "deletions": 8
    }
}