{
    "author": "devsnek",
    "message": "process: add version constants and compare\n\nPR-URL: https://github.com/nodejs/node/pull/19587\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>",
    "sha": "91e0f8db118b125e805a77ce31dc21af57ee7abf",
    "files": [
        {
            "sha": "060d741804df541f4dbc8bfe60c8ec377955e74b",
            "filename": "doc/api/process.md",
            "status": "modified",
            "additions": 31,
            "deletions": 3,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/91e0f8db118b125e805a77ce31dc21af57ee7abf/doc%2Fapi%2Fprocess.md",
            "raw_url": "https://github.com/nodejs/node/raw/91e0f8db118b125e805a77ce31dc21af57ee7abf/doc%2Fapi%2Fprocess.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fprocess.md?ref=91e0f8db118b125e805a77ce31dc21af57ee7abf",
            "patch": "@@ -1482,6 +1482,9 @@ changes:\n   - version: v4.2.0\n     pr-url: https://github.com/nodejs/node/pull/3212\n     description: The `lts` property is now supported.\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/19587\n+    description: Add SemVer properties.\n -->\n \n * {Object}\n@@ -1510,6 +1513,10 @@ tarball.\n   - `'Argon'` for the 4.x LTS line beginning with 4.2.0.\n   - `'Boron'` for the 6.x LTS line beginning with 6.9.0.\n   - `'Carbon'` for the 8.x LTS line beginning with 8.9.1.\n+* `majorVersion` {number} The major version of this release.\n+* `minorVersion` {number} The minor version of this release.\n+* `patchVersion` {number} The patch version of this release.\n+* `prereleaseTag` {string} The SemVer pre-release tag for Node.js.\n \n <!-- eslint-skip -->\n ```js\n@@ -1518,13 +1525,34 @@ tarball.\n   lts: 'Argon',\n   sourceUrl: 'https://nodejs.org/download/release/v4.4.5/node-v4.4.5.tar.gz',\n   headersUrl: 'https://nodejs.org/download/release/v4.4.5/node-v4.4.5-headers.tar.gz',\n-  libUrl: 'https://nodejs.org/download/release/v4.4.5/win-x64/node.lib'\n+  libUrl: 'https://nodejs.org/download/release/v4.4.5/win-x64/node.lib',\n+  majorVersion: 4,\n+  minorVersion: 4,\n+  patchVersion: 5,\n+  prereleaseTag: '',\n+  compareVersion: [Function: compareVersion]\n }\n ```\n \n+\n In custom builds from non-release versions of the source tree, only the\n-`name` property may be present. The additional properties should not be\n-relied upon to exist.\n+`name` property and SemVer properties may be present. The additional properties\n+should not be relied upon to exist.\n+\n+## process.release.compareVersion(major, minor, patch[, tag])\n+<!-- YAML\n+added: REPLACEME\n+-->\n+\n+Perform a SemVer comparison to the release version.\n+\n+* `major` {number} The major version to compare.\n+* `minor` {number} The minor version to compare.\n+* `patch` {number} The patch version to compare.\n+* `tag` {string} The pre-release tag to compare.\n+* Returns: {number} `1` if the given version is lower than the current release\n+  version, `0` if the given version matches the process version, and `-1`\n+  if the given version is greater than the release version.\n \n ## process.send(message[, sendHandle[, options]][, callback])\n <!-- YAML"
        },
        {
            "sha": "b74c194d07bab59693371fa4ff6f37930ce5fd4e",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/91e0f8db118b125e805a77ce31dc21af57ee7abf/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/91e0f8db118b125e805a77ce31dc21af57ee7abf/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=91e0f8db118b125e805a77ce31dc21af57ee7abf",
            "patch": "@@ -35,6 +35,7 @@\n     setupGlobalVariables();\n \n     const _process = NativeModule.require('internal/process');\n+    _process.setupCompareVersion();\n     _process.setupConfig(NativeModule._source);\n     _process.setupSignalHandlers();\n     _process.setupUncaughtExceptionCapture(exceptionHandlerState);"
        },
        {
            "sha": "027657991a097b76a0044f9efbfdd7a7d42a1dc3",
            "filename": "lib/internal/process.js",
            "status": "modified",
            "additions": 43,
            "deletions": 1,
            "changes": 44,
            "blob_url": "https://github.com/nodejs/node/blob/91e0f8db118b125e805a77ce31dc21af57ee7abf/lib%2Finternal%2Fprocess.js",
            "raw_url": "https://github.com/nodejs/node/raw/91e0f8db118b125e805a77ce31dc21af57ee7abf/lib%2Finternal%2Fprocess.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess.js?ref=91e0f8db118b125e805a77ce31dc21af57ee7abf",
            "patch": "@@ -283,6 +283,47 @@ function setupUncaughtExceptionCapture(exceptionHandlerState) {\n   };\n }\n \n+function setupCompareVersion() {\n+  const {\n+    majorVersion,\n+    minorVersion,\n+    patchVersion,\n+    prereleaseTag,\n+  } = process.release;\n+\n+  process.release.compareVersion = (major, minor, patch, tag) => {\n+    if (typeof major !== 'number')\n+      throw new ERR_INVALID_ARG_TYPE('major', 'number', major);\n+    if (typeof minor !== 'number')\n+      throw new ERR_INVALID_ARG_TYPE('minor', 'number', minor);\n+    if (typeof patch !== 'number')\n+      throw new ERR_INVALID_ARG_TYPE('patch', 'number', patch);\n+    if (tag !== undefined && typeof tag !== 'string')\n+      throw new ERR_INVALID_ARG_TYPE('tag', 'string', tag);\n+\n+    if (major > majorVersion)\n+      return -1;\n+    if (major < majorVersion)\n+      return 1;\n+\n+    if (minor > minorVersion)\n+      return -1;\n+    if (minor < minorVersion)\n+      return 1;\n+\n+    if (patch > patchVersion)\n+      return -1;\n+    if (patch < patchVersion)\n+      return 1;\n+    if (prereleaseTag)\n+      return prereleaseTag === tag ? 0 : 1;\n+    if (tag)\n+      return -1;\n+\n+    return 0;\n+  };\n+}\n+\n module.exports = {\n   setup_performance,\n   setup_cpuUsage,\n@@ -293,5 +334,6 @@ module.exports = {\n   setupSignalHandlers,\n   setupChannel,\n   setupRawDebug,\n-  setupUncaughtExceptionCapture\n+  setupUncaughtExceptionCapture,\n+  setupCompareVersion,\n };"
        },
        {
            "sha": "6f946ab3ad1cc7217b8e748014a35697ff778679",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/91e0f8db118b125e805a77ce31dc21af57ee7abf/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/91e0f8db118b125e805a77ce31dc21af57ee7abf/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=91e0f8db118b125e805a77ce31dc21af57ee7abf",
            "patch": "@@ -3015,6 +3015,17 @@ void SetupProcessObject(Environment* env,\n   READONLY_PROPERTY(release, \"name\",\n                     OneByteString(env->isolate(), NODE_RELEASE));\n \n+  READONLY_PROPERTY(release, \"majorVersion\",\n+      Integer::New(env->isolate(), NODE_MAJOR_VERSION));\n+  READONLY_PROPERTY(release, \"minorVersion\",\n+      Integer::New(env->isolate(), NODE_MINOR_VERSION));\n+  READONLY_PROPERTY(release, \"patchVersion\",\n+      Integer::New(env->isolate(), NODE_PATCH_VERSION));\n+  std::string node_tag(NODE_TAG);\n+  READONLY_PROPERTY(release, \"prereleaseTag\",\n+      OneByteString(env->isolate(), node_tag.size() > 0 ?\n+          node_tag.substr(1).c_str() : \"\"));\n+\n #if NODE_VERSION_IS_LTS\n   READONLY_PROPERTY(release, \"lts\",\n                     OneByteString(env->isolate(), NODE_VERSION_LTS_CODENAME));"
        },
        {
            "sha": "a7c8e8fa09508f5257e703127606c2edda08d487",
            "filename": "test/parallel/test-process-release.js",
            "status": "modified",
            "additions": 38,
            "deletions": 1,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/91e0f8db118b125e805a77ce31dc21af57ee7abf/test%2Fparallel%2Ftest-process-release.js",
            "raw_url": "https://github.com/nodejs/node/raw/91e0f8db118b125e805a77ce31dc21af57ee7abf/test%2Fparallel%2Ftest-process-release.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-process-release.js?ref=91e0f8db118b125e805a77ce31dc21af57ee7abf",
            "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-require('../common');\n+const common = require('../common');\n \n const assert = require('assert');\n const versionParts = process.versions.node.split('.');\n@@ -18,3 +18,40 @@ if (versionParts[0] === '4' && versionParts[1] >= 2) {\n } else {\n   assert.strictEqual(process.release.lts, undefined);\n }\n+\n+const {\n+  majorVersion: major,\n+  minorVersion: minor,\n+  patchVersion: patch,\n+  prereleaseTag: tag,\n+  compareVersion,\n+} = process.release;\n+\n+assert.strictEqual(compareVersion(major, minor, patch, tag), 0);\n+\n+assert.strictEqual(compareVersion(major + 1, minor, patch, tag), -1);\n+assert.strictEqual(compareVersion(major - 1, minor, patch, tag), 1);\n+\n+assert.strictEqual(compareVersion(major, minor + 1, patch, tag), -1);\n+assert.strictEqual(compareVersion(major, minor - 1, patch, tag), 1);\n+\n+assert.strictEqual(compareVersion(major, minor, patch + 1, tag), -1);\n+assert.strictEqual(compareVersion(major, minor, patch - 1, tag), 1);\n+\n+if (tag)\n+  assert.strictEqual(compareVersion(major, minor, patch), 1);\n+else\n+  assert.strictEqual(compareVersion(major, minor, patch, 'notrealtag'), -1);\n+\n+for (const args of [\n+  ['', 0, 0, ''],\n+  [0, '', 0, ''],\n+  [0, 0, '', ''],\n+  [0, 0, 0, 0],\n+]) {\n+  common.expectsError(() => {\n+    compareVersion(...args);\n+  }, {\n+    code: 'ERR_INVALID_ARG_TYPE',\n+  });\n+}"
        }
    ],
    "stats": {
        "total": 129,
        "additions": 124,
        "deletions": 5
    }
}