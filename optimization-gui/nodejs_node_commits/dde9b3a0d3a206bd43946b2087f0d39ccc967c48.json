{
    "author": "alyssaq",
    "message": "test: check for invalid module type in vm.js\n\nPR-URL: https://github.com/nodejs/node/pull/24161\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "dde9b3a0d3a206bd43946b2087f0d39ccc967c48",
    "files": [
        {
            "sha": "600f455e93306e3e710fe375d2c17fd2c763a9f5",
            "filename": "test/parallel/test-vm-module-dynamic-import.js",
            "status": "modified",
            "additions": 24,
            "deletions": 6,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/dde9b3a0d3a206bd43946b2087f0d39ccc967c48/test%2Fparallel%2Ftest-vm-module-dynamic-import.js",
            "raw_url": "https://github.com/nodejs/node/raw/dde9b3a0d3a206bd43946b2087f0d39ccc967c48/test%2Fparallel%2Ftest-vm-module-dynamic-import.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-vm-module-dynamic-import.js?ref=dde9b3a0d3a206bd43946b2087f0d39ccc967c48",
            "patch": "@@ -68,16 +68,34 @@ async function testInvalid() {\n   await result.catch(common.mustCall((e) => {\n     assert.strictEqual(e.code, 'ERR_VM_MODULE_NOT_MODULE');\n   }));\n+\n+  const s = new Script('import(\"foo\")', {\n+    importModuleDynamically: common.mustCall((specifier, wrap) => {\n+      return undefined;\n+    }),\n+  });\n+  let threw = false;\n+  try {\n+    await s.runInThisContext();\n+  } catch (e) {\n+    threw = true;\n+    assert.strictEqual(e.code, 'ERR_VM_MODULE_NOT_MODULE');\n+  }\n+  assert(threw);\n+}\n+\n+async function testInvalidimportModuleDynamically() {\n+  assert.throws(\n+    () => new Script(\n+      'import(\"foo\")',\n+      { importModuleDynamically: false }),\n+    { code: 'ERR_INVALID_ARG_TYPE' }\n+  );\n }\n \n-const done = common.mustCallAtLeast(3);\n (async function() {\n   await testNoCallback();\n-  done();\n-\n   await test();\n-  done();\n-\n   await testInvalid();\n-  done();\n+  await testInvalidimportModuleDynamically();\n }()).then(common.mustCall());"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 24,
        "deletions": 6
    }
}