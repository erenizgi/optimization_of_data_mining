{
    "author": "cjihrig",
    "message": "cluster: use Map to track handles in cluster child\n\nPR-URL: https://github.com/nodejs/node/pull/23125\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Denys Otrishko <shishugi@gmail.com>",
    "sha": "5a50989f5bde1e7cd495922444a3ce5a4c680897",
    "files": [
        {
            "sha": "13a22b0186fc2824d51bb34569e3c4f2dc4799ee",
            "filename": "lib/internal/cluster/child.js",
            "status": "modified",
            "additions": 11,
            "deletions": 12,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/5a50989f5bde1e7cd495922444a3ce5a4c680897/lib%2Finternal%2Fcluster%2Fchild.js",
            "raw_url": "https://github.com/nodejs/node/raw/5a50989f5bde1e7cd495922444a3ce5a4c680897/lib%2Finternal%2Fcluster%2Fchild.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcluster%2Fchild.js?ref=5a50989f5bde1e7cd495922444a3ce5a4c680897",
            "patch": "@@ -7,7 +7,7 @@ const { owner_symbol } = require('internal/async_hooks').symbols;\n const Worker = require('internal/cluster/worker');\n const { internal, sendHelper } = require('internal/cluster/utils');\n const cluster = new EventEmitter();\n-const handles = {};\n+const handles = new Map();\n const indexes = new Map();\n const noop = () => {};\n \n@@ -111,12 +111,12 @@ function shared(message, handle, indexesKey, cb) {\n \n   handle.close = function() {\n     send({ act: 'close', key });\n-    delete handles[key];\n+    handles.delete(key);\n     indexes.delete(indexesKey);\n     return close.apply(this, arguments);\n   }.bind(handle);\n-  assert(handles[key] === undefined);\n-  handles[key] = handle;\n+  assert(handles.has(key) === false);\n+  handles.set(key, handle);\n   cb(message.errno, handle);\n }\n \n@@ -144,7 +144,7 @@ function rr(message, indexesKey, cb) {\n       return;\n \n     send({ act: 'close', key });\n-    delete handles[key];\n+    handles.delete(key);\n     indexes.delete(indexesKey);\n     key = undefined;\n   }\n@@ -166,15 +166,15 @@ function rr(message, indexesKey, cb) {\n     handle.getsockname = getsockname;  // TCP handles only.\n   }\n \n-  assert(handles[key] === undefined);\n-  handles[key] = handle;\n+  assert(handles.has(key) === false);\n+  handles.set(key, handle);\n   cb(0, handle);\n }\n \n // Round-robin connection.\n function onconnection(message, handle) {\n   const key = message.key;\n-  const server = handles[key];\n+  const server = handles.get(key);\n   const accepted = server !== undefined;\n \n   send({ ack: message.seq, accepted });\n@@ -207,17 +207,16 @@ function _disconnect(masterInitiated) {\n     }\n   }\n \n-  for (var key in handles) {\n-    const handle = handles[key];\n-    delete handles[key];\n+  handles.forEach((handle) => {\n     waitingCount++;\n \n     if (handle[owner_symbol])\n       handle[owner_symbol].close(checkWaitingCount);\n     else\n       handle.close(checkWaitingCount);\n-  }\n+  });\n \n+  handles.clear();\n   checkWaitingCount();\n }\n "
        }
    ],
    "stats": {
        "total": 23,
        "additions": 11,
        "deletions": 12
    }
}