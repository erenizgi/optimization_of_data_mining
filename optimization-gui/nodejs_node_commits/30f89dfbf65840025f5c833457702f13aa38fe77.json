{
    "author": "danbev",
    "message": "build: add node_lib_target_name to cctest deps\n\nCurrently the cctest target depend on the node_core_target_name\ntarget. But it is the node_lib_target_name target that compiles the\nsources now which means that if a source file in src is updated the\ncctest executable will not be re-linked against it, but will remain\nunchanged. The code will still be compiled, just not linked which\nmeans that if you are debugging you'll not see the changes and also a\nwarning will be displayed about this issue.\n\nThis commit changes the cctest target to depend on node_lib_target_name.\n\nPR-URL: https://github.com/nodejs/node/pull/18576\nReviewed-By: Matheus Marchini <matheus@sthima.com>\nReviewed-By: Yihong Wang <yh.wang@ibm.com>\nReviewed-By: Gibson Fahnestock <gibfahn@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>",
    "sha": "30f89dfbf65840025f5c833457702f13aa38fe77",
    "files": [
        {
            "sha": "44c46ad2bc8854f128a50097fb1aba52dde9e894",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 3,
            "deletions": 127,
            "changes": 130,
            "blob_url": "https://github.com/nodejs/node/blob/30f89dfbf65840025f5c833457702f13aa38fe77/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/30f89dfbf65840025f5c833457702f13aa38fe77/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=30f89dfbf65840025f5c833457702f13aa38fe77",
            "patch": "@@ -921,7 +921,7 @@\n       'type': 'executable',\n \n       'dependencies': [\n-        '<(node_core_target_name)',\n+        '<(node_lib_target_name)',\n         'rename_node_bin_win',\n         'deps/gtest/gtest.gyp:gtest',\n         'node_js2c#host',\n@@ -930,39 +930,6 @@\n         'node_dtrace_provider',\n       ],\n \n-      'variables': {\n-        'obj_path': '<(obj_dir)/<(node_lib_target_name)/src',\n-        'obj_gen_path': '<(obj_dir)/<(node_lib_target_name)/gen',\n-        'obj_tracing_path': '<(obj_dir)/<(node_lib_target_name)/src/tracing',\n-        'obj_suffix': 'o',\n-        'obj_separator': '/',\n-        'conditions': [\n-          ['OS==\"win\"', {\n-            'obj_suffix': 'obj',\n-          }],\n-          ['GENERATOR==\"ninja\"', {\n-            'obj_path': '<(obj_dir)/src',\n-            'obj_gen_path': '<(obj_dir)/gen',\n-            'obj_tracing_path': '<(obj_dir)/src/tracing',\n-            'obj_separator': '/<(node_lib_target_name).',\n-          }, {\n-            'conditions': [\n-              ['OS==\"win\"', {\n-                'obj_path': '<(obj_dir)/<(node_lib_target_name)',\n-                'obj_gen_path': '<(obj_dir)/<(node_lib_target_name)',\n-                'obj_tracing_path': '<(obj_dir)/<(node_lib_target_name)',\n-              }],\n-              ['OS==\"aix\"', {\n-                'obj_path': '<(obj_dir)/<(node_lib_target_name)/src',\n-                'obj_gen_path': '<(obj_dir)/<(node_lib_target_name)/gen',\n-                'obj_tracing_path':\n-                  '<(obj_dir)/<(node_lib_target_name)/src/tracing',\n-              }],\n-            ]}\n-          ]\n-        ],\n-       },\n-\n       'includes': [\n         'node.gypi'\n       ],\n@@ -979,7 +946,6 @@\n       'defines': [ 'NODE_WANT_INTERNALS=1' ],\n \n       'sources': [\n-        'test/cctest/node_module_reg.cc',\n         'test/cctest/node_test_fixture.cc',\n         'test/cctest/test_aliased_buffer.cc',\n         'test/cctest/test_base64.cc',\n@@ -989,120 +955,30 @@\n         'test/cctest/test_url.cc'\n       ],\n \n-      'libraries': [\n-        '<(obj_path)<(obj_separator)async_wrap.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)handle_wrap.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)env.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)node.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)node_buffer.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)node_debug_options.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)node_i18n.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)node_perf.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)node_platform.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)node_url.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)util.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)string_bytes.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)string_decoder.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)string_search.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)stream_base.<(obj_suffix)',\n-        '<(obj_path)<(obj_separator)node_constants.<(obj_suffix)',\n-        '<(obj_tracing_path)<(obj_separator)agent.<(obj_suffix)',\n-        '<(obj_tracing_path)<(obj_separator)node_trace_buffer.<(obj_suffix)',\n-        '<(obj_tracing_path)<(obj_separator)node_trace_writer.<(obj_suffix)',\n-        '<(obj_tracing_path)<(obj_separator)trace_event.<(obj_suffix)',\n-        '<(obj_gen_path)<(obj_separator)node_javascript.<(obj_suffix)',\n-      ],\n-\n       'conditions': [\n         [ 'node_use_openssl==\"true\"', {\n-          'conditions': [\n-            ['node_target_type!=\"static_library\"', {\n-              'libraries': [\n-                '<(obj_path)<(obj_separator)node_crypto.<(obj_suffix)',\n-                '<(obj_path)<(obj_separator)node_crypto_bio.<(obj_suffix)',\n-                '<(obj_path)<(obj_separator)node_crypto_clienthello.<(obj_suffix)',\n-                '<(obj_path)<(obj_separator)tls_wrap.<(obj_suffix)',\n-              ],\n-            }],\n-          ],\n           'defines': [\n             'HAVE_OPENSSL=1',\n           ],\n         }],\n         [ 'node_use_perfctr==\"true\"', {\n           'defines': [ 'HAVE_PERFCTR=1' ],\n-          'libraries': [\n-            '<(obj_path)<(obj_separator)node_counters.<(obj_suffix)',\n-            '<(obj_path)<(obj_separator)'\n-              'node_win32_perfctr_provider.<(obj_suffix)',\n-          ],\n         }],\n         ['v8_enable_inspector==1', {\n           'sources': [\n             'test/cctest/test_inspector_socket.cc',\n             'test/cctest/test_inspector_socket_server.cc'\n           ],\n-          'conditions': [\n-            ['node_target_type!=\"static_library\"', {\n-              'libraries': [\n-                '<(obj_path)<(obj_separator)inspector_agent.<(obj_suffix)',\n-                '<(obj_path)<(obj_separator)inspector_io.<(obj_suffix)',\n-                '<(obj_path)<(obj_separator)inspector_js_api.<(obj_suffix)',\n-                '<(obj_path)<(obj_separator)inspector_socket.<(obj_suffix)',\n-                '<(obj_path)<(obj_separator)inspector_socket_server.<(obj_suffix)',\n-              ],\n-            }],\n-          ],\n           'defines': [\n             'HAVE_INSPECTOR=1',\n           ],\n-        }],\n-        [ 'node_use_dtrace==\"true\" and node_target_type!=\"static_library\"', {\n-          'libraries': [\n-            '<(obj_path)<(obj_separator)node_dtrace.<(obj_suffix)',\n-          ],\n-          'conditions': [\n-            ['OS!=\"mac\" and OS!=\"linux\"', {\n-              'libraries': [\n-                '<(obj_path)<(obj_separator)node_dtrace_provider.<(obj_suffix)',\n-                '<(obj_path)<(obj_separator)node_dtrace_ustack.<(obj_suffix)',\n-              ]\n-            }],\n-            ['OS==\"linux\"', {\n-              'libraries': [\n-                '<(SHARED_INTERMEDIATE_DIR)<(obj_separator)'\n-                  'node_dtrace_provider.<(obj_suffix)',\n-              ]\n-            }],\n-          ],\n-        }, {\n-          'conditions': [\n-            [ 'node_use_etw==\"true\" and OS==\"win\"', {\n-              'libraries': [\n-                '<(obj_path)<(obj_separator)node_dtrace.<(obj_suffix)',\n-                '<(obj_path)<(obj_separator)'\n-                  'node_win32_etw_provider.<(obj_suffix)',\n-              ],\n-            }]\n-          ]\n-        }],\n-        [ 'OS==\"win\" and node_target_type!=\"static_library\"', {\n-          'libraries': [\n-            '<(obj_path)<(obj_separator)backtrace_win32.<(obj_suffix)',\n-          ],\n         }, {\n-          'conditions': [\n-            ['node_target_type!=\"static_library\"', {\n-              'libraries': [\n-                '<(obj_path)<(obj_separator)backtrace_posix.<(obj_suffix)',\n-              ],\n-            }],\n-          ],\n+          'defines': [ 'HAVE_INSPECTOR=0' ]\n         }],\n         ['OS==\"solaris\"', {\n           'ldflags': [ '-I<(SHARED_INTERMEDIATE_DIR)' ]\n         }],\n-      ]\n+      ],\n     }\n   ], # end targets\n "
        },
        {
            "sha": "bd4f20bc9f823d446d9450c4c90c6058ca39d0e9",
            "filename": "test/cctest/node_module_reg.cc",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/nodejs/node/blob/3d93f39190ec24284aee6acd0e0214862e651567/test%2Fcctest%2Fnode_module_reg.cc",
            "raw_url": "https://github.com/nodejs/node/raw/3d93f39190ec24284aee6acd0e0214862e651567/test%2Fcctest%2Fnode_module_reg.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcctest%2Fnode_module_reg.cc?ref=3d93f39190ec24284aee6acd0e0214862e651567",
            "patch": "@@ -1,30 +0,0 @@\n-// Need to create empty definition for these modules'\n-// registration function for cctest. Because when\n-// building cctest, the definitions for the following\n-// registration functions are not included.\n-void _register_cares_wrap() {}\n-void _register_config() {}\n-void _register_contextify() {}\n-void _register_domain() {}\n-void _register_fs() {}\n-void _register_fs_event_wrap() {}\n-void _register_http2() {}\n-void _register_http_parser() {}\n-void _register_js_stream() {}\n-void _register_module_wrap() {}\n-void _register_os() {}\n-void _register_pipe_wrap() {}\n-void _register_process_wrap() {}\n-void _register_serdes() {}\n-void _register_signal_wrap() {}\n-void _register_spawn_sync() {}\n-void _register_stream_wrap() {}\n-void _register_tcp_wrap() {}\n-void _register_timer_wrap() {}\n-void _register_trace_events() {}\n-void _register_tty_wrap() {}\n-void _register_udp_wrap() {}\n-void _register_util() {}\n-void _register_uv() {}\n-void _register_v8() {}\n-void _register_zlib() {}"
        },
        {
            "sha": "e901d97668f5ffa5089cee430a90eb73ab07dd39",
            "filename": "test/cctest/test_node_postmortem_metadata.cc",
            "status": "modified",
            "additions": 22,
            "deletions": 2,
            "changes": 24,
            "blob_url": "https://github.com/nodejs/node/blob/30f89dfbf65840025f5c833457702f13aa38fe77/test%2Fcctest%2Ftest_node_postmortem_metadata.cc",
            "raw_url": "https://github.com/nodejs/node/raw/30f89dfbf65840025f5c833457702f13aa38fe77/test%2Fcctest%2Ftest_node_postmortem_metadata.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fcctest%2Ftest_node_postmortem_metadata.cc?ref=30f89dfbf65840025f5c833457702f13aa38fe77",
            "patch": "@@ -1,12 +1,32 @@\n-#include \"node_postmortem_metadata.cc\"\n-\n #include \"gtest/gtest.h\"\n #include \"node.h\"\n #include \"node_internals.h\"\n #include \"node_test_fixture.h\"\n #include \"req_wrap-inl.h\"\n #include \"tracing/agent.h\"\n #include \"v8.h\"\n+#include \"v8abbr.h\"\n+\n+extern \"C\" {\n+extern uintptr_t\n+    nodedbg_offset_HandleWrap__handle_wrap_queue___ListNode_HandleWrap;\n+extern uintptr_t\n+    nodedbg_offset_Environment__handle_wrap_queue___Environment_HandleWrapQueue;\n+extern int debug_symbols_generated;\n+extern int nodedbg_const_Environment__kContextEmbedderDataIndex__int;\n+extern uintptr_t\n+    nodedbg_offset_Environment_HandleWrapQueue__head___ListNode_HandleWrap;\n+extern uintptr_t\n+    nodedbg_offset_Environment__req_wrap_queue___Environment_ReqWrapQueue;\n+extern uintptr_t nodedbg_offset_ExternalString__data__uintptr_t;\n+extern uintptr_t nodedbg_offset_ListNode_ReqWrap__next___uintptr_t;\n+extern uintptr_t nodedbg_offset_ReqWrap__req_wrap_queue___ListNode_ReqWrapQueue;\n+extern uintptr_t nodedbg_offset_ListNode_HandleWrap__next___uintptr_t;\n+extern uintptr_t\n+    nodedbg_offset_Environment_ReqWrapQueue__head___ListNode_ReqWrapQueue;\n+extern uintptr_t\n+    nodedbg_offset_BaseObject__persistent_handle___v8_Persistent_v8_Object;\n+}\n \n \n class DebugSymbolsTest : public EnvironmentTestFixture {};"
        }
    ],
    "stats": {
        "total": 184,
        "additions": 25,
        "deletions": 159
    }
}