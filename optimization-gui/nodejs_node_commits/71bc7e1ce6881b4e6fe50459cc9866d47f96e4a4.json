{
    "author": "kiyomizumia",
    "message": "src: add DCHECK macros\n\nThis adds check statements for debugging and refactors the code\naccordingly.\n\nPR-URL: https://github.com/nodejs/node/pull/24359\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4",
    "files": [
        {
            "sha": "cce872739381cfeb891e56c9744fd1aca5cfdbd3",
            "filename": "src/base_object-inl.h",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fbase_object-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fbase_object-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fbase_object-inl.h?ref=71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4",
            "patch": "@@ -67,10 +67,10 @@ v8::Local<v8::Object> BaseObject::object() const {\n \n v8::Local<v8::Object> BaseObject::object(v8::Isolate* isolate) const {\n   v8::Local<v8::Object> handle = object();\n-#ifdef DEBUG\n-  CHECK_EQ(handle->CreationContext()->GetIsolate(), isolate);\n-  CHECK_EQ(env_->isolate(), isolate);\n-#endif\n+\n+  DCHECK_EQ(handle->CreationContext()->GetIsolate(), isolate);\n+  DCHECK_EQ(env_->isolate(), isolate);\n+\n   return handle;\n }\n "
        },
        {
            "sha": "e323d8707e676f01f1c919842a6b5dbb3968c39f",
            "filename": "src/env-inl.h",
            "status": "modified",
            "additions": 4,
            "deletions": 8,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fenv-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fenv-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv-inl.h?ref=71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4",
            "patch": "@@ -559,20 +559,16 @@ inline void Environment::set_http2_state(\n }\n \n bool Environment::debug_enabled(DebugCategory category) const {\n-#ifdef DEBUG\n-  CHECK_GE(static_cast<int>(category), 0);\n-  CHECK_LT(static_cast<int>(category),\n+  DCHECK_GE(static_cast<int>(category), 0);\n+  DCHECK_LT(static_cast<int>(category),\n            static_cast<int>(DebugCategory::CATEGORY_COUNT));\n-#endif\n   return debug_enabled_[static_cast<int>(category)];\n }\n \n void Environment::set_debug_enabled(DebugCategory category, bool enabled) {\n-#ifdef DEBUG\n-  CHECK_GE(static_cast<int>(category), 0);\n-  CHECK_LT(static_cast<int>(category),\n+  DCHECK_GE(static_cast<int>(category), 0);\n+  DCHECK_LT(static_cast<int>(category),\n            static_cast<int>(DebugCategory::CATEGORY_COUNT));\n-#endif\n   debug_enabled_[static_cast<int>(category)] = enabled;\n }\n "
        },
        {
            "sha": "d8c4dce2058b03ef7d8d453b6ea790beba419028",
            "filename": "src/env.cc",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fenv.cc",
            "raw_url": "https://github.com/nodejs/node/raw/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.cc?ref=71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4",
            "patch": "@@ -622,9 +622,7 @@ void Environment::RunAndClearNativeImmediates() {\n     };\n     while (drain_list()) {}\n \n-#ifdef DEBUG\n-    CHECK_GE(immediate_info()->count(), count);\n-#endif\n+    DCHECK_GE(immediate_info()->count(), count);\n     immediate_info()->count_dec(count);\n     immediate_info()->ref_count_dec(ref_count);\n   }"
        },
        {
            "sha": "4588364ab1219621948ecc3c74aa4e8ccb777b35",
            "filename": "src/inspector/node_string.h",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Finspector%2Fnode_string.h",
            "raw_url": "https://github.com/nodejs/node/raw/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Finspector%2Fnode_string.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Finspector%2Fnode_string.h?ref=71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4",
            "patch": "@@ -73,7 +73,8 @@ extern size_t kNotFound;\n }  // namespace inspector\n }  // namespace node\n \n-#define DCHECK CHECK\n-#define DCHECK_LT CHECK_LT\n-\n+#ifndef DCHECK\n+  #define DCHECK CHECK\n+  #define DCHECK_LT CHECK_LT\n+#endif  // DCHECK\n #endif  // SRC_INSPECTOR_NODE_STRING_H_"
        },
        {
            "sha": "7e2bbaa1730f2e7111382ff9cd44e49b7f3d7b66",
            "filename": "src/stream_base-inl.h",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fstream_base-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fstream_base-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_base-inl.h?ref=71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4",
            "patch": "@@ -448,9 +448,8 @@ inline void StreamReq::Done(int status, const char* error_str) {\n }\n \n inline void StreamReq::ResetObject(v8::Local<v8::Object> obj) {\n-#ifdef DEBUG\n-  CHECK_GT(obj->InternalFieldCount(), StreamReq::kStreamReqField);\n-#endif\n+  DCHECK_GT(obj->InternalFieldCount(), StreamReq::kStreamReqField);\n+\n   obj->SetAlignedPointerInInternalField(0, nullptr);  // BaseObject field.\n   obj->SetAlignedPointerInInternalField(StreamReq::kStreamReqField, nullptr);\n }"
        },
        {
            "sha": "739964eb85a762bfe7d800ba4e19275335571fcb",
            "filename": "src/stream_base.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fstream_base.cc",
            "raw_url": "https://github.com/nodejs/node/raw/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Fstream_base.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fstream_base.cc?ref=71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4",
            "patch": "@@ -292,17 +292,16 @@ void StreamBase::CallJSOnreadMethod(ssize_t nread,\n                                     size_t offset) {\n   Environment* env = env_;\n \n-#ifdef DEBUG\n-  CHECK_EQ(static_cast<int32_t>(nread), nread);\n-  CHECK_LE(offset, INT32_MAX);\n+  DCHECK_EQ(static_cast<int32_t>(nread), nread);\n+  DCHECK_LE(offset, INT32_MAX);\n \n   if (ab.IsEmpty()) {\n-    CHECK_EQ(offset, 0);\n-    CHECK_LE(nread, 0);\n+    DCHECK_EQ(offset, 0);\n+    DCHECK_LE(nread, 0);\n   } else {\n-    CHECK_GE(nread, 0);\n+    DCHECK_GE(nread, 0);\n   }\n-#endif\n+\n   env->stream_base_state()[kReadBytesOrError] = nread;\n   env->stream_base_state()[kArrayBufferOffset] = offset;\n "
        },
        {
            "sha": "9a10904394de612102b6f344e636450fefdfeb1d",
            "filename": "src/util.h",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Futil.h",
            "raw_url": "https://github.com/nodejs/node/raw/71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4/src%2Futil.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Futil.h?ref=71bc7e1ce6881b4e6fe50459cc9866d47f96e4a4",
            "patch": "@@ -129,6 +129,29 @@ void DumpBacktrace(FILE* fp);\n #define CHECK_NOT_NULL(val) CHECK((val) != nullptr)\n #define CHECK_IMPLIES(a, b) CHECK(!(a) || (b))\n \n+#ifdef DEBUG\n+  #define DCHECK_EQ(a, b) CHECK((a) == (b))\n+  #define DCHECK_GE(a, b) CHECK((a) >= (b))\n+  #define DCHECK_GT(a, b) CHECK((a) > (b))\n+  #define DCHECK_LE(a, b) CHECK((a) <= (b))\n+  #define DCHECK_LT(a, b) CHECK((a) < (b))\n+  #define DCHECK_NE(a, b) CHECK((a) != (b))\n+  #define DCHECK_NULL(val) CHECK((val) == nullptr)\n+  #define DCHECK_NOT_NULL(val) CHECK((val) != nullptr)\n+  #define DCHECK_IMPLIES(a, b) CHECK(!(a) || (b))\n+#else\n+  #define DCHECK_EQ(a, b)\n+  #define DCHECK_GE(a, b)\n+  #define DCHECK_GT(a, b)\n+  #define DCHECK_LE(a, b)\n+  #define DCHECK_LT(a, b)\n+  #define DCHECK_NE(a, b)\n+  #define DCHECK_NULL(val)\n+  #define DCHECK_NOT_NULL(val)\n+  #define DCHECK_IMPLIES(a, b)\n+#endif\n+\n+\n #define UNREACHABLE() ABORT()\n \n // TAILQ-style intrusive list node."
        }
    ],
    "stats": {
        "total": 72,
        "additions": 44,
        "deletions": 28
    }
}