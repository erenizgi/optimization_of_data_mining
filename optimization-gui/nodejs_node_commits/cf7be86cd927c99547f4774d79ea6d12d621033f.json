{
    "author": "BridgeAR",
    "message": "assert: accept regular expressions to validate\n\nThis makes sure regular expressions on validation objects validate\nagainst strings when used with `assert.throws` and `assert.rejects`.\n\nPR-URL: https://github.com/nodejs/node/pull/20485\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>",
    "sha": "cf7be86cd927c99547f4774d79ea6d12d621033f",
    "files": [
        {
            "sha": "7f98e975f19c9bd68e631dba5c56ec59eeb91e97",
            "filename": "doc/api/assert.md",
            "status": "modified",
            "additions": 44,
            "deletions": 6,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/cf7be86cd927c99547f4774d79ea6d12d621033f/doc%2Fapi%2Fassert.md",
            "raw_url": "https://github.com/nodejs/node/raw/cf7be86cd927c99547f4774d79ea6d12d621033f/doc%2Fapi%2Fassert.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fassert.md?ref=cf7be86cd927c99547f4774d79ea6d12d621033f",
            "patch": "@@ -1070,27 +1070,65 @@ changes:\n Expects the function `block` to throw an error.\n \n If specified, `error` can be a [`Class`][], [`RegExp`][], a validation function,\n-an object where each property will be tested for, or an instance of error where\n-each property will be tested for including the non-enumerable `message` and\n-`name` properties.\n+a validation object where each property will be tested for strict deep equality,\n+or an instance of error where each property will be tested for strict deep\n+equality including the non-enumerable `message` and `name` properties. When\n+using an object, it is also possible to use a regular expression, when\n+validating against a string property. See below for examples.\n \n If specified, `message` will be the message provided by the `AssertionError` if\n the block fails to throw.\n \n-Custom error object / error instance:\n+Custom validation object / error instance:\n \n ```js\n const err = new TypeError('Wrong value');\n err.code = 404;\n+err.foo = 'bar';\n+err.info = {\n+  nested: true,\n+  baz: 'text'\n+};\n+err.reg = /abc/i;\n \n assert.throws(\n   () => {\n     throw err;\n   },\n   {\n     name: 'TypeError',\n-    message: 'Wrong value'\n-    // Note that only properties on the error object will be tested!\n+    message: 'Wrong value',\n+    info: {\n+      nested: true,\n+      baz: 'text'\n+    }\n+    // Note that only properties on the validation object will be tested for.\n+    // Using nested objects requires all properties to be present. Otherwise\n+    // the validation is going to fail.\n+  }\n+);\n+\n+// Using regular expressions to validate error properties:\n+assert.throws(\n+  () => {\n+    throw err;\n+  },\n+  {\n+    // The `name` and `message` properties are strings and using regular\n+    // expressions on those will match against the string. If they fail, an\n+    // error is thrown.\n+    name: /^TypeError$/,\n+    message: /Wrong/,\n+    foo: 'bar',\n+    info: {\n+      nested: true,\n+      // It is not possible to use regular expressions for nested properties!\n+      baz: 'text'\n+    },\n+    // The `reg` property contains a regular expression and only if the\n+    // validation object contains an identical regular expression, it is going\n+    // to pass.\n+    reg: /abc/i\n   }\n );\n "
        },
        {
            "sha": "ac9fd30793aaf78895e9dcc41bdb58007f762d0f",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 18,
            "deletions": 5,
            "changes": 23,
            "blob_url": "https://github.com/nodejs/node/blob/cf7be86cd927c99547f4774d79ea6d12d621033f/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/cf7be86cd927c99547f4774d79ea6d12d621033f/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=cf7be86cd927c99547f4774d79ea6d12d621033f",
            "patch": "@@ -35,7 +35,7 @@ const {\n   }\n } = require('internal/errors');\n const { openSync, closeSync, readSync } = require('fs');\n-const { inspect, types: { isPromise } } = require('util');\n+const { inspect, types: { isPromise, isRegExp } } = require('util');\n const { EOL } = require('os');\n const { NativeModule } = require('internal/bootstrap/loaders');\n \n@@ -362,10 +362,18 @@ assert.notStrictEqual = function notStrictEqual(actual, expected, message) {\n };\n \n class Comparison {\n-  constructor(obj, keys) {\n+  constructor(obj, keys, actual) {\n     for (const key of keys) {\n-      if (key in obj)\n-        this[key] = obj[key];\n+      if (key in obj) {\n+        if (actual !== undefined &&\n+            typeof actual[key] === 'string' &&\n+            isRegExp(obj[key]) &&\n+            obj[key].test(actual[key])) {\n+          this[key] = actual[key];\n+        } else {\n+          this[key] = obj[key];\n+        }\n+      }\n     }\n   }\n }\n@@ -375,7 +383,7 @@ function compareExceptionKey(actual, expected, key, message, keys) {\n     if (!message) {\n       // Create placeholder objects to create a nice output.\n       const a = new Comparison(actual, keys);\n-      const b = new Comparison(expected, keys);\n+      const b = new Comparison(expected, keys, actual);\n \n       const tmpLimit = Error.stackTraceLimit;\n       Error.stackTraceLimit = 0;\n@@ -415,6 +423,11 @@ function expectedException(actual, expected, msg) {\n       keys.push('name', 'message');\n     }\n     for (const key of keys) {\n+      if (typeof actual[key] === 'string' &&\n+          isRegExp(expected[key]) &&\n+          expected[key].test(actual[key])) {\n+        continue;\n+      }\n       compareExceptionKey(actual, expected, key, msg, keys);\n     }\n     return true;"
        },
        {
            "sha": "cbcda17ab7188dfb064d1120eeea2d31f53978a6",
            "filename": "test/parallel/test-assert.js",
            "status": "modified",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/nodejs/node/blob/cf7be86cd927c99547f4774d79ea6d12d621033f/test%2Fparallel%2Ftest-assert.js",
            "raw_url": "https://github.com/nodejs/node/raw/cf7be86cd927c99547f4774d79ea6d12d621033f/test%2Fparallel%2Ftest-assert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert.js?ref=cf7be86cd927c99547f4774d79ea6d12d621033f",
            "patch": "@@ -914,3 +914,29 @@ assert.throws(\n     }\n   );\n }\n+\n+assert.throws(\n+  () => { throw new TypeError('foobar'); },\n+  {\n+    message: /foo/,\n+    name: /^TypeError$/\n+  }\n+);\n+\n+assert.throws(\n+  () => assert.throws(\n+    () => { throw new TypeError('foobar'); },\n+    {\n+      message: /fooa/,\n+      name: /^TypeError$/\n+    }\n+  ),\n+  {\n+    message: `${start}\\n${actExp}\\n\\n` +\n+             '  Comparison {\\n' +\n+             \"-   message: 'foobar',\\n\" +\n+             '+   message: /fooa/,\\n' +\n+             \"    name: 'TypeError'\\n\" +\n+             '  }'\n+  }\n+);"
        }
    ],
    "stats": {
        "total": 99,
        "additions": 88,
        "deletions": 11
    }
}