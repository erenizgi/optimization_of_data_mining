{
    "author": "lpinca",
    "message": "test: refactor stream-*-constructor-set-methods\n\n- Use `common.mustCall()` to ensure that callbacks are called.\n- Remove no longer needed variables.\n- Remove unnecessary `process.on('exit')` usage.\n\nPR-URL: https://github.com/nodejs/node/pull/18817\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Jon Moss <me@jonathanmoss.me>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>",
    "sha": "33103e97587b3efa073d00752864210b43c5fc4a",
    "files": [
        {
            "sha": "14c173b4ccfec5711b5763700af40abe4c4ce878",
            "filename": "test/parallel/test-stream-transform-constructor-set-methods.js",
            "status": "modified",
            "additions": 13,
            "deletions": 15,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/33103e97587b3efa073d00752864210b43c5fc4a/test%2Fparallel%2Ftest-stream-transform-constructor-set-methods.js",
            "raw_url": "https://github.com/nodejs/node/raw/33103e97587b3efa073d00752864210b43c5fc4a/test%2Fparallel%2Ftest-stream-transform-constructor-set-methods.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-transform-constructor-set-methods.js?ref=33103e97587b3efa073d00752864210b43c5fc4a",
            "patch": "@@ -1,19 +1,19 @@\n 'use strict';\n const common = require('../common');\n-const assert = require('assert');\n \n-const Transform = require('stream').Transform;\n+const { strictEqual } = require('assert');\n+const { Transform } = require('stream');\n \n-const _transform = common.mustCall(function _transform(d, e, n) {\n-  n();\n+const _transform = common.mustCall((chunk, _, next) => {\n+  next();\n });\n \n-const _final = common.mustCall(function _final(n) {\n-  n();\n+const _final = common.mustCall((next) => {\n+  next();\n });\n \n-const _flush = common.mustCall(function _flush(n) {\n-  n();\n+const _flush = common.mustCall((next) => {\n+  next();\n });\n \n const t = new Transform({\n@@ -22,21 +22,19 @@ const t = new Transform({\n   final: _final\n });\n \n-const t2 = new Transform({});\n+strictEqual(t._transform, _transform);\n+strictEqual(t._flush, _flush);\n+strictEqual(t._final, _final);\n \n t.end(Buffer.from('blerg'));\n t.resume();\n \n+const t2 = new Transform({});\n+\n common.expectsError(() => {\n   t2.end(Buffer.from('blerg'));\n }, {\n   type: Error,\n   code: 'ERR_METHOD_NOT_IMPLEMENTED',\n   message: 'The _transform method is not implemented'\n });\n-\n-process.on('exit', () => {\n-  assert.strictEqual(t._transform, _transform);\n-  assert.strictEqual(t._flush, _flush);\n-  assert.strictEqual(t._final, _final);\n-});"
        },
        {
            "sha": "425cd88ed7a3366e85ccd23c3d2df7a562f73ac7",
            "filename": "test/parallel/test-stream-writable-constructor-set-methods.js",
            "status": "modified",
            "additions": 22,
            "deletions": 30,
            "changes": 52,
            "blob_url": "https://github.com/nodejs/node/blob/33103e97587b3efa073d00752864210b43c5fc4a/test%2Fparallel%2Ftest-stream-writable-constructor-set-methods.js",
            "raw_url": "https://github.com/nodejs/node/raw/33103e97587b3efa073d00752864210b43c5fc4a/test%2Fparallel%2Ftest-stream-writable-constructor-set-methods.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-writable-constructor-set-methods.js?ref=33103e97587b3efa073d00752864210b43c5fc4a",
            "patch": "@@ -1,45 +1,37 @@\n 'use strict';\n const common = require('../common');\n-const assert = require('assert');\n \n-const Writable = require('stream').Writable;\n+const { strictEqual } = require('assert');\n+const { Writable } = require('stream');\n \n-let _writeCalled = false;\n-function _write(d, e, n) {\n-  _writeCalled = true;\n-}\n+const _write = common.mustCall((chunk, _, next) => {\n+  next();\n+});\n+\n+const _writev = common.mustCall((chunks, next) => {\n+  strictEqual(chunks.length, 2);\n+  next();\n+});\n \n-const w = new Writable({ write: _write });\n-w.end(Buffer.from('blerg'));\n+const w = new Writable({ write: _write, writev: _writev });\n \n-let _writevCalled = false;\n-let dLength = 0;\n-function _writev(d, n) {\n-  dLength = d.length;\n-  _writevCalled = true;\n-}\n+strictEqual(w._write, _write);\n+strictEqual(w._writev, _writev);\n \n-const w2 = new Writable({ writev: _writev });\n-w2.cork();\n+w.write(Buffer.from('blerg'));\n \n-w2.write(Buffer.from('blerg'));\n-w2.write(Buffer.from('blerg'));\n-w2.end();\n+w.cork();\n+w.write(Buffer.from('blerg'));\n+w.write(Buffer.from('blerg'));\n \n-const w3 = new Writable();\n+w.end();\n \n-w3.on('error', common.expectsError({\n+const w2 = new Writable();\n+\n+w2.on('error', common.expectsError({\n   type: Error,\n   code: 'ERR_METHOD_NOT_IMPLEMENTED',\n   message: 'The _write method is not implemented'\n }));\n \n-w3.end(Buffer.from('blerg'));\n-\n-process.on('exit', function() {\n-  assert.strictEqual(w._write, _write);\n-  assert(_writeCalled);\n-  assert.strictEqual(w2._writev, _writev);\n-  assert.strictEqual(dLength, 2);\n-  assert(_writevCalled);\n-});\n+w2.end(Buffer.from('blerg'));"
        }
    ],
    "stats": {
        "total": 80,
        "additions": 35,
        "deletions": 45
    }
}