{
    "author": "sam-github",
    "message": "test: send a bad record only after connection done\n\nConnection is known to be completely setup only after data has\nexchanged, so wait unil data echo before sending a bad record.\nOtherwise, the bad record could interrupt completion of the server's\nhandshake, and whether the error is emitted on the connection or server\nis a matter of timing.\n\nAlso, assert that server errors do not occur. 'error' would crash node\nwith and unhandled event, but 'tlsClientError' is ignored by default.\n\nPR-URL: https://github.com/nodejs/node/pull/25508\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "1f4c5bdbcab0ec89cabdc3d598d6bf2ab4f1894c",
    "files": [
        {
            "sha": "63b845122fc1f06acb1ef78d2d90cfd0cdf8ad83",
            "filename": "test/parallel/test-tls-alert-handling.js",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/1f4c5bdbcab0ec89cabdc3d598d6bf2ab4f1894c/test%2Fparallel%2Ftest-tls-alert-handling.js",
            "raw_url": "https://github.com/nodejs/node/raw/1f4c5bdbcab0ec89cabdc3d598d6bf2ab4f1894c/test%2Fparallel%2Ftest-tls-alert-handling.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-alert-handling.js?ref=1f4c5bdbcab0ec89cabdc3d598d6bf2ab4f1894c",
            "patch": "@@ -48,6 +48,9 @@ server.listen(0, common.mustCall(function() {\n   sendClient();\n }));\n \n+server.on('tlsClientError', common.mustNotCall());\n+\n+server.on('error', common.mustNotCall());\n \n function sendClient() {\n   const client = tls.connect(server.address().port, {\n@@ -78,8 +81,10 @@ function sendBADTLSRecord() {\n     socket: socket,\n     rejectUnauthorized: false\n   }, common.mustCall(function() {\n-    socket.write(BAD_RECORD);\n-    socket.end();\n+    client.write('x');\n+    client.on('data', (data) => {\n+      socket.end(BAD_RECORD);\n+    });\n   }));\n   client.on('error', common.mustCall((err) => {\n     assert.strictEqual(err.code, 'ERR_SSL_TLSV1_ALERT_PROTOCOL_VERSION');"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 7,
        "deletions": 2
    }
}