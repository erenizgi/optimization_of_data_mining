{
    "author": "addaleax",
    "message": "benchmark: add bench for zlib gzip + gunzip cycle\n\nOriginally wrote this for some work that is going to take a while\nlonger before it’s ready to be PR’ed, so it seems fine to start\nwith this on its own.\n\nPR-URL: https://github.com/nodejs/node/pull/20034\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "e797d5babd119900034953a65efe90ed06ed97b9",
    "files": [
        {
            "sha": "9b05749bbb824df5d245cc76d016f6fd66f40566",
            "filename": "benchmark/zlib/pipe.js",
            "status": "added",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/nodejs/node/blob/e797d5babd119900034953a65efe90ed06ed97b9/benchmark%2Fzlib%2Fpipe.js",
            "raw_url": "https://github.com/nodejs/node/raw/e797d5babd119900034953a65efe90ed06ed97b9/benchmark%2Fzlib%2Fpipe.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/benchmark%2Fzlib%2Fpipe.js?ref=e797d5babd119900034953a65efe90ed06ed97b9",
            "patch": "@@ -0,0 +1,39 @@\n+'use strict';\n+const common = require('../common.js');\n+const fs = require('fs');\n+const zlib = require('zlib');\n+\n+const bench = common.createBenchmark(main, {\n+  inputLen: [1024],\n+  duration: [5],\n+  type: ['string', 'buffer']\n+});\n+\n+function main({ inputLen, duration, type }) {\n+  const buffer = Buffer.alloc(inputLen, fs.readFileSync(__filename));\n+  const chunk = type === 'buffer' ? buffer : buffer.toString('utf8');\n+\n+  const input = zlib.createGzip();\n+  const output = zlib.createGunzip();\n+\n+  let readFromOutput = 0;\n+  input.pipe(output);\n+  if (type === 'string')\n+    output.setEncoding('utf8');\n+  output.on('data', (chunk) => readFromOutput += chunk.length);\n+\n+  function write() {\n+    input.write(chunk, write);\n+  }\n+\n+  bench.start();\n+  write();\n+\n+  setTimeout(() => {\n+    // Give result in GBit/s, like the net benchmarks do\n+    bench.end(readFromOutput * 8 / (1024 ** 3));\n+\n+    // Cut off writing the easy way.\n+    input.write = () => {};\n+  }, duration * 1000);\n+}"
        },
        {
            "sha": "25b7d1a4d5f905d448d64f2417efbf902f962d93",
            "filename": "test/parallel/test-benchmark-zlib.js",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/e797d5babd119900034953a65efe90ed06ed97b9/test%2Fparallel%2Ftest-benchmark-zlib.js",
            "raw_url": "https://github.com/nodejs/node/raw/e797d5babd119900034953a65efe90ed06ed97b9/test%2Fparallel%2Ftest-benchmark-zlib.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-benchmark-zlib.js?ref=e797d5babd119900034953a65efe90ed06ed97b9",
            "patch": "@@ -9,5 +9,10 @@ runBenchmark('zlib',\n                'method=deflate',\n                'n=1',\n                'options=true',\n-               'type=Deflate'\n-             ]);\n+               'type=Deflate',\n+               'inputLen=1024',\n+               'duration=0.001'\n+             ],\n+             {\n+               'NODEJS_BENCHMARK_ZERO_ALLOWED': 1\n+             });"
        }
    ],
    "stats": {
        "total": 48,
        "additions": 46,
        "deletions": 2
    }
}