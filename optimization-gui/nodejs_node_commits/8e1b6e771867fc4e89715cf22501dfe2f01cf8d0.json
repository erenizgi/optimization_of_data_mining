{
    "author": "BridgeAR",
    "message": "fs: require callback in read\n\nCurrently the read operation did not require the callback and that\nwas an oversight when callbacks became mandatory.\n\nPR-URL: https://github.com/nodejs/node/pull/22146\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>",
    "sha": "8e1b6e771867fc4e89715cf22501dfe2f01cf8d0",
    "files": [
        {
            "sha": "7517f275c82ff3b00376be5df8d257786bd7ecc2",
            "filename": "lib/fs.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/8e1b6e771867fc4e89715cf22501dfe2f01cf8d0/lib%2Ffs.js",
            "raw_url": "https://github.com/nodejs/node/raw/8e1b6e771867fc4e89715cf22501dfe2f01cf8d0/lib%2Ffs.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ffs.js?ref=8e1b6e771867fc4e89715cf22501dfe2f01cf8d0",
            "patch": "@@ -445,13 +445,14 @@ function openSync(path, flags, mode) {\n function read(fd, buffer, offset, length, position, callback) {\n   validateUint32(fd, 'fd');\n   validateBuffer(buffer);\n+  callback = maybeCallback(callback);\n \n   offset |= 0;\n   length |= 0;\n \n   if (length === 0) {\n     return process.nextTick(function tick() {\n-      callback && callback(null, 0, buffer);\n+      callback(null, 0, buffer);\n     });\n   }\n \n@@ -467,7 +468,7 @@ function read(fd, buffer, offset, length, position, callback) {\n \n   function wrapper(err, bytesRead) {\n     // Retain a reference to buffer so that it can't be GC'ed too soon.\n-    callback && callback(err, bytesRead || 0, buffer);\n+    callback(err, bytesRead || 0, buffer);\n   }\n \n   const req = new FSReqCallback();"
        },
        {
            "sha": "5843cdc8365024ba73db74c5c9aa62be816e154a",
            "filename": "test/parallel/test-fs-read.js",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/8e1b6e771867fc4e89715cf22501dfe2f01cf8d0/test%2Fparallel%2Ftest-fs-read.js",
            "raw_url": "https://github.com/nodejs/node/raw/8e1b6e771867fc4e89715cf22501dfe2f01cf8d0/test%2Fparallel%2Ftest-fs-read.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-read.js?ref=8e1b6e771867fc4e89715cf22501dfe2f01cf8d0",
            "patch": "@@ -58,7 +58,6 @@ test(new Uint8Array(expected.length),\n   // Reading beyond file length (3 in this case) should return no data.\n   // This is a test for a bug where reads > uint32 would return data\n   // from the current position in the file.\n-  const fd = fs.openSync(filepath, 'r');\n   const pos = 0xffffffff + 1; // max-uint32 + 1\n   const nRead = fs.readSync(fd, Buffer.alloc(1), 0, 1, pos);\n   assert.strictEqual(nRead, 0);\n@@ -68,3 +67,11 @@ test(new Uint8Array(expected.length),\n     assert.strictEqual(nRead, 0);\n   }));\n }\n+\n+assert.throws(\n+  () => fs.read(fd, Buffer.alloc(1), 0, 1, 0),\n+  {\n+    message: 'Callback must be a function',\n+    code: 'ERR_INVALID_CALLBACK',\n+  }\n+);"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 11,
        "deletions": 3
    }
}