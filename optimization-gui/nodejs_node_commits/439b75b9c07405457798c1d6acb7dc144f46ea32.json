{
    "author": "calebsander",
    "message": "assert, util: *DeepEqual() handles ArrayBuffers\n\nPreviously, all ArrayBuffers were considered equal in assert.deepEqual()\nand assert.deepStrictEqual().\nNow, ArrayBuffers and SharedArrayBuffers must have the same byte lengths\nand contents to be considered equal.\nIn loose mode, an ArrayBuffer is considered equal to a SharedArrayBuffer\nif they have the same contents, whereas in strict mode, the buffers must\nbe both ArrayBuffers or both SharedArrayBuffers.\n\nPR-URL: https://github.com/nodejs/node/pull/22266\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "439b75b9c07405457798c1d6acb7dc144f46ea32",
    "files": [
        {
            "sha": "9844e9d59c0c5a8931f664d3e9aaa3b314147d07",
            "filename": "lib/internal/util/comparisons.js",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/439b75b9c07405457798c1d6acb7dc144f46ea32/lib%2Finternal%2Futil%2Fcomparisons.js",
            "raw_url": "https://github.com/nodejs/node/raw/439b75b9c07405457798c1d6acb7dc144f46ea32/lib%2Finternal%2Futil%2Fcomparisons.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Fcomparisons.js?ref=439b75b9c07405457798c1d6acb7dc144f46ea32",
            "patch": "@@ -3,7 +3,13 @@\n const { compare } = process.binding('buffer');\n const { isArrayBufferView } = require('internal/util/types');\n const { internalBinding } = require('internal/bootstrap/loaders');\n-const { isDate, isMap, isRegExp, isSet } = internalBinding('types');\n+const {\n+  isAnyArrayBuffer,\n+  isDate,\n+  isMap,\n+  isRegExp,\n+  isSet\n+} = internalBinding('types');\n const { getOwnNonIndexProperties } = process.binding('util');\n \n const ReflectApply = Reflect.apply;\n@@ -55,6 +61,11 @@ function areSimilarTypedArrays(a, b) {\n                  new Uint8Array(b.buffer, b.byteOffset, b.byteLength)) === 0;\n }\n \n+function areEqualArrayBuffers(buf1, buf2) {\n+  return buf1.byteLength === buf2.byteLength &&\n+    compare(new Uint8Array(buf1), new Uint8Array(buf2)) === 0;\n+}\n+\n function isFloatTypedArrayTag(tag) {\n   return tag === '[object Float32Array]' || tag === '[object Float64Array]';\n }\n@@ -154,6 +165,10 @@ function strictDeepEqual(val1, val2, memos) {\n       return false;\n     }\n     return keyCheck(val1, val2, kStrict, memos, kIsMap);\n+  } else if (isAnyArrayBuffer(val1)) {\n+    if (!areEqualArrayBuffers(val1, val2)) {\n+      return false;\n+    }\n   // TODO: Make the valueOf checks safe.\n   } else if (typeof val1.valueOf === 'function') {\n     const val1Value = val1.valueOf();\n@@ -217,6 +232,11 @@ function looseDeepEqual(val1, val2, memos) {\n   } else if (isSet(val2) || isMap(val2)) {\n     return false;\n   }\n+  if (isAnyArrayBuffer(val1) && isAnyArrayBuffer(val2)) {\n+    if (!areEqualArrayBuffers(val1, val2)) {\n+      return false;\n+    }\n+  }\n   return keyCheck(val1, val2, kLoose, memos, kNoIterator);\n }\n "
        },
        {
            "sha": "78394bb91facde46d5bef2d6e79bcca8ac5242ec",
            "filename": "test/parallel/test-assert-typedarray-deepequal.js",
            "status": "modified",
            "additions": 18,
            "deletions": 3,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/439b75b9c07405457798c1d6acb7dc144f46ea32/test%2Fparallel%2Ftest-assert-typedarray-deepequal.js",
            "raw_url": "https://github.com/nodejs/node/raw/439b75b9c07405457798c1d6acb7dc144f46ea32/test%2Fparallel%2Ftest-assert-typedarray-deepequal.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-assert-typedarray-deepequal.js?ref=439b75b9c07405457798c1d6acb7dc144f46ea32",
            "patch": "@@ -23,15 +23,18 @@ const equalArrayPairs = [\n   [new Float32Array([+0.0]), new Float32Array([+0.0])],\n   [new Uint8Array([1, 2, 3, 4]).subarray(1), new Uint8Array([2, 3, 4])],\n   [new Uint16Array([1, 2, 3, 4]).subarray(1), new Uint16Array([2, 3, 4])],\n-  [new Uint32Array([1, 2, 3, 4]).subarray(1, 3), new Uint32Array([2, 3])]\n+  [new Uint32Array([1, 2, 3, 4]).subarray(1, 3), new Uint32Array([2, 3])],\n+  [new ArrayBuffer(3), new ArrayBuffer(3)],\n+  [new SharedArrayBuffer(3), new SharedArrayBuffer(3)]\n ];\n \n const looseEqualArrayPairs = [\n   [new Float64Array([+0.0]), new Float32Array([-0.0])],\n   [new Int16Array(256), new Uint16Array(256)],\n   [new Int16Array([256]), new Uint16Array([256])],\n   [new Float32Array([+0.0]), new Float32Array([-0.0])],\n-  [new Float64Array([+0.0]), new Float64Array([-0.0])]\n+  [new Float64Array([+0.0]), new Float64Array([-0.0])],\n+  [new ArrayBuffer(3), new SharedArrayBuffer(3)]\n ];\n \n const notEqualArrayPairs = [\n@@ -44,7 +47,19 @@ const notEqualArrayPairs = [\n   [new Int16Array([-256]), new Uint16Array([0xff00])], // same bits\n   [new Int32Array([-256]), new Uint32Array([0xffffff00])], // ditto\n   [new Float32Array([0.1]), new Float32Array([0.0])],\n-  [new Float64Array([0.1]), new Float64Array([0.0])]\n+  [new Float64Array([0.1]), new Float64Array([0.0])],\n+  [new Uint8Array([1, 2, 3]).buffer, new Uint8Array([4, 5, 6]).buffer],\n+  [\n+    new Uint8Array(new SharedArrayBuffer(3)).fill(1).buffer,\n+    new Uint8Array(new SharedArrayBuffer(3)).fill(2).buffer\n+  ],\n+  [new ArrayBuffer(2), new ArrayBuffer(3)],\n+  [new SharedArrayBuffer(2), new SharedArrayBuffer(3)],\n+  [new ArrayBuffer(2), new SharedArrayBuffer(3)],\n+  [\n+    new Uint8Array(new ArrayBuffer(3)).fill(1).buffer,\n+    new Uint8Array(new SharedArrayBuffer(3)).fill(2).buffer\n+  ]\n ];\n \n equalArrayPairs.forEach((arrayPair) => {"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 39,
        "deletions": 4
    }
}