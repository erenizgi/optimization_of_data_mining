{
    "author": "daynin",
    "message": "url: replace \"magic\" numbers by constants\n\nPR-URL: https://github.com/nodejs/node/pull/19035\nReviewed-By: Myles Borins <myles.borins@gmail.com>\nReviewed-By: Daijiro Wachi <daijiro.wachi@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Khaidi Chu <i@2333.moe>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Tobias Nie√üen <tniessen@tnie.de>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>",
    "sha": "2f743261814d428b935136b64b416a2879c29364",
    "files": [
        {
            "sha": "6fc16e57d95f6583184ae1252d044ee8ae095e4a",
            "filename": "lib/internal/constants.js",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/2f743261814d428b935136b64b416a2879c29364/lib%2Finternal%2Fconstants.js",
            "raw_url": "https://github.com/nodejs/node/raw/2f743261814d428b935136b64b416a2879c29364/lib%2Finternal%2Fconstants.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fconstants.js?ref=2f743261814d428b935136b64b416a2879c29364",
            "patch": "@@ -11,13 +11,34 @@ module.exports = {\n   CHAR_DOT: 46, /* . */\n   CHAR_FORWARD_SLASH: 47, /* / */\n   CHAR_BACKWARD_SLASH: 92, /* \\ */\n+  CHAR_VERTICAL_LINE: 124, /* | */\n   CHAR_COLON: 58, /* : */\n   CHAR_QUESTION_MARK: 63, /* ? */\n   CHAR_UNDERSCORE: 95, /* _ */\n   CHAR_LINE_FEED: 10, /* \\n */\n   CHAR_CARRIAGE_RETURN: 13, /* \\r */\n+  CHAR_TAB: 9, /* \\t */\n+  CHAR_FORM_FEED: 12, /* \\f */\n   CHAR_EXCLAMATION_MARK: 33, /* ! */\n   CHAR_HASH: 35, /* # */\n+  CHAR_SPACE: 32, /*   */\n+  CHAR_NO_BREAK_SPACE: 160, /* \\u00A0 */\n+  CHAR_ZERO_WIDTH_NOBREAK_SPACE: 65279, /* \\uFEFF */\n+  CHAR_LEFT_SQUARE_BRACKET: 91, /* [ */\n+  CHAR_RIGHT_SQUARE_BRACKET: 93, /* ] */\n+  CHAR_LEFT_ANGLE_BRACKET: 60, /* < */\n+  CHAR_RIGHT_ANGLE_BRACKET: 62, /* > */\n+  CHAR_LEFT_CURLY_BRACKET: 123, /* { */\n+  CHAR_RIGHT_CURLY_BRACKET: 125, /* } */\n+  CHAR_HYPHEN_MINUS: 45, /* - */\n+  CHAR_PLUS: 43, /* + */\n+  CHAR_DOUBLE_QUOTE: 34, /* \" */\n+  CHAR_SINGLE_QUOTE: 39, /* ' */\n+  CHAR_PERCENT: 37, /* % */\n+  CHAR_SEMICOLON: 59, /* ; */\n+  CHAR_CIRCUMFLEX_ACCENT: 94, /* ^ */\n+  CHAR_GRAVE_ACCENT: 96, /* ` */\n+  CHAR_AT: 64, /* @ */\n \n   // Digits\n   CHAR_0: 48, /* 0 */"
        },
        {
            "sha": "61662b4a97abe1327606b348228a2d3cb922387d",
            "filename": "lib/url.js",
            "status": "modified",
            "additions": 88,
            "deletions": 49,
            "changes": 137,
            "blob_url": "https://github.com/nodejs/node/blob/2f743261814d428b935136b64b416a2879c29364/lib%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/2f743261814d428b935136b64b416a2879c29364/lib%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Furl.js?ref=2f743261814d428b935136b64b416a2879c29364",
            "patch": "@@ -94,6 +94,43 @@ const slashedProtocol = {\n   'file:': true\n };\n const querystring = require('querystring');\n+const {\n+  CHAR_SPACE,\n+  CHAR_TAB,\n+  CHAR_CARRIAGE_RETURN,\n+  CHAR_LINE_FEED,\n+  CHAR_FORM_FEED,\n+  CHAR_NO_BREAK_SPACE,\n+  CHAR_ZERO_WIDTH_NOBREAK_SPACE,\n+  CHAR_HASH,\n+  CHAR_FORWARD_SLASH,\n+  CHAR_LEFT_SQUARE_BRACKET,\n+  CHAR_RIGHT_SQUARE_BRACKET,\n+  CHAR_LEFT_ANGLE_BRACKET,\n+  CHAR_RIGHT_ANGLE_BRACKET,\n+  CHAR_LEFT_CURLY_BRACKET,\n+  CHAR_RIGHT_CURLY_BRACKET,\n+  CHAR_QUESTION_MARK,\n+  CHAR_LOWERCASE_A,\n+  CHAR_LOWERCASE_Z,\n+  CHAR_UPPERCASE_A,\n+  CHAR_UPPERCASE_Z,\n+  CHAR_DOT,\n+  CHAR_0,\n+  CHAR_9,\n+  CHAR_HYPHEN_MINUS,\n+  CHAR_PLUS,\n+  CHAR_UNDERSCORE,\n+  CHAR_DOUBLE_QUOTE,\n+  CHAR_SINGLE_QUOTE,\n+  CHAR_PERCENT,\n+  CHAR_SEMICOLON,\n+  CHAR_BACKWARD_SLASH,\n+  CHAR_CIRCUMFLEX_ACCENT,\n+  CHAR_GRAVE_ACCENT,\n+  CHAR_VERTICAL_LINE,\n+  CHAR_AT,\n+} = require('internal/constants');\n \n function urlParse(url, parseQueryString, slashesDenoteHost) {\n   if (url instanceof Url) return url;\n@@ -121,13 +158,13 @@ Url.prototype.parse = function parse(url, parseQueryString, slashesDenoteHost) {\n     const code = url.charCodeAt(i);\n \n     // Find first and last non-whitespace characters for trimming\n-    const isWs = code === 32/* */ ||\n-                 code === 9/*\\t*/ ||\n-                 code === 13/*\\r*/ ||\n-                 code === 10/*\\n*/ ||\n-                 code === 12/*\\f*/ ||\n-                 code === 160/*\\u00A0*/ ||\n-                 code === 65279/*\\uFEFF*/;\n+    const isWs = code === CHAR_SPACE ||\n+                 code === CHAR_TAB ||\n+                 code === CHAR_CARRIAGE_RETURN ||\n+                 code === CHAR_LINE_FEED ||\n+                 code === CHAR_FORM_FEED ||\n+                 code === CHAR_NO_BREAK_SPACE ||\n+                 code === CHAR_ZERO_WIDTH_NOBREAK_SPACE;\n     if (start === -1) {\n       if (isWs)\n         continue;\n@@ -145,20 +182,20 @@ Url.prototype.parse = function parse(url, parseQueryString, slashesDenoteHost) {\n     // Only convert backslashes while we haven't seen a split character\n     if (!split) {\n       switch (code) {\n-        case 35: // '#'\n+        case CHAR_HASH:\n           hasHash = true;\n         // Fall through\n-        case 63: // '?'\n+        case CHAR_QUESTION_MARK:\n           split = true;\n           break;\n-        case 92: // '\\\\'\n+        case CHAR_BACKWARD_SLASH:\n           if (i - lastPos > 0)\n             rest += url.slice(lastPos, i);\n           rest += '/';\n           lastPos = i + 1;\n           break;\n       }\n-    } else if (!hasHash && code === 35/*#*/) {\n+    } else if (!hasHash && code === CHAR_HASH) {\n       hasHash = true;\n     }\n   }\n@@ -220,8 +257,8 @@ Url.prototype.parse = function parse(url, parseQueryString, slashesDenoteHost) {\n   // resolution will treat //foo/bar as host=foo,path=bar because that's\n   // how the browser resolves relative URLs.\n   if (slashesDenoteHost || proto || hostPattern.test(rest)) {\n-    var slashes = rest.charCodeAt(0) === 47/*/*/ &&\n-                  rest.charCodeAt(1) === 47/*/*/;\n+    var slashes = rest.charCodeAt(0) === CHAR_FORWARD_SLASH &&\n+                  rest.charCodeAt(1) === CHAR_FORWARD_SLASH;\n     if (slashes && !(proto && hostlessProtocol[proto])) {\n       rest = rest.slice(2);\n       this.slashes = true;\n@@ -251,35 +288,35 @@ Url.prototype.parse = function parse(url, parseQueryString, slashesDenoteHost) {\n     var nonHost = -1;\n     for (i = 0; i < rest.length; ++i) {\n       switch (rest.charCodeAt(i)) {\n-        case 9:   // '\\t'\n-        case 10:  // '\\n'\n-        case 13:  // '\\r'\n-        case 32:  // ' '\n-        case 34:  // '\"'\n-        case 37:  // '%'\n-        case 39:  // '\\''\n-        case 59:  // ';'\n-        case 60:  // '<'\n-        case 62:  // '>'\n-        case 92:  // '\\\\'\n-        case 94:  // '^'\n-        case 96:  // '`'\n-        case 123: // '{'\n-        case 124: // '|'\n-        case 125: // '}'\n+        case CHAR_TAB:\n+        case CHAR_LINE_FEED:\n+        case CHAR_CARRIAGE_RETURN:\n+        case CHAR_SPACE:\n+        case CHAR_DOUBLE_QUOTE:\n+        case CHAR_PERCENT:\n+        case CHAR_SINGLE_QUOTE:\n+        case CHAR_SEMICOLON:\n+        case CHAR_LEFT_ANGLE_BRACKET:\n+        case CHAR_RIGHT_ANGLE_BRACKET:\n+        case CHAR_BACKWARD_SLASH:\n+        case CHAR_CIRCUMFLEX_ACCENT:\n+        case CHAR_GRAVE_ACCENT:\n+        case CHAR_LEFT_CURLY_BRACKET:\n+        case CHAR_VERTICAL_LINE:\n+        case CHAR_RIGHT_CURLY_BRACKET:\n           // Characters that are never ever allowed in a hostname from RFC 2396\n           if (nonHost === -1)\n             nonHost = i;\n           break;\n-        case 35: // '#'\n-        case 47: // '/'\n-        case 63: // '?'\n+        case CHAR_HASH:\n+        case CHAR_FORWARD_SLASH:\n+        case CHAR_QUESTION_MARK:\n           // Find the first instance of any host-ending characters\n           if (nonHost === -1)\n             nonHost = i;\n           hostEnd = i;\n           break;\n-        case 64: // '@'\n+        case CHAR_AT:\n           // At this point, either we have an explicit point where the\n           // auth portion cannot go past, or the last @ char is the decider.\n           atSign = i;\n@@ -314,8 +351,8 @@ Url.prototype.parse = function parse(url, parseQueryString, slashesDenoteHost) {\n \n     // if hostname begins with [ and ends with ]\n     // assume that it's an IPv6 address.\n-    var ipv6Hostname = hostname.charCodeAt(0) === 91/*[*/ &&\n-                       hostname.charCodeAt(hostname.length - 1) === 93/*]*/;\n+    var ipv6Hostname = hostname.charCodeAt(0) === CHAR_LEFT_SQUARE_BRACKET &&\n+      hostname.charCodeAt(hostname.length - 1) === CHAR_RIGHT_SQUARE_BRACKET;\n \n     // validate a little.\n     if (!ipv6Hostname) {\n@@ -369,11 +406,11 @@ Url.prototype.parse = function parse(url, parseQueryString, slashesDenoteHost) {\n   var hashIdx = -1;\n   for (i = 0; i < rest.length; ++i) {\n     const code = rest.charCodeAt(i);\n-    if (code === 35/*#*/) {\n+    if (code === CHAR_HASH) {\n       this.hash = rest.slice(i);\n       hashIdx = i;\n       break;\n-    } else if (code === 63/*?*/ && questionIdx === -1) {\n+    } else if (code === CHAR_QUESTION_MARK && questionIdx === -1) {\n       questionIdx = i;\n     }\n   }\n@@ -424,13 +461,13 @@ Url.prototype.parse = function parse(url, parseQueryString, slashesDenoteHost) {\n function validateHostname(self, rest, hostname) {\n   for (var i = 0; i < hostname.length; ++i) {\n     const code = hostname.charCodeAt(i);\n-    const isValid = (code >= 97/*a*/ && code <= 122/*z*/) ||\n-                    code === 46/*.*/ ||\n-                    (code >= 65/*A*/ && code <= 90/*Z*/) ||\n-                    (code >= 48/*0*/ && code <= 57/*9*/) ||\n-                    code === 45/*-*/ ||\n-                    code === 43/*+*/ ||\n-                    code === 95/*_*/ ||\n+    const isValid = (code >= CHAR_LOWERCASE_A && code <= CHAR_LOWERCASE_Z) ||\n+                    code === CHAR_DOT ||\n+                    (code >= CHAR_UPPERCASE_A && code <= CHAR_UPPERCASE_Z) ||\n+                    (code >= CHAR_0 && code <= CHAR_9) ||\n+                    code === CHAR_HYPHEN_MINUS ||\n+                    code === CHAR_PLUS ||\n+                    code === CHAR_UNDERSCORE ||\n                     code > 127;\n \n     // Invalid host character\n@@ -544,13 +581,13 @@ Url.prototype.format = function format() {\n   var lastPos = 0;\n   for (var i = 0; i < pathname.length; ++i) {\n     switch (pathname.charCodeAt(i)) {\n-      case 35: // '#'\n+      case CHAR_HASH:\n         if (i - lastPos > 0)\n           newPathname += pathname.slice(lastPos, i);\n         newPathname += '%23';\n         lastPos = i + 1;\n         break;\n-      case 63: // '?'\n+      case CHAR_QUESTION_MARK:\n         if (i - lastPos > 0)\n           newPathname += pathname.slice(lastPos, i);\n         newPathname += '%3F';\n@@ -569,7 +606,7 @@ Url.prototype.format = function format() {\n   // unless they had them to begin with.\n   if (this.slashes || slashedProtocol[protocol]) {\n     if (this.slashes || host) {\n-      if (pathname && pathname.charCodeAt(0) !== 47/*/*/)\n+      if (pathname && pathname.charCodeAt(0) !== CHAR_FORWARD_SLASH)\n         pathname = '/' + pathname;\n       host = '//' + host;\n     } else if (protocol.length >= 4 &&\n@@ -583,8 +620,10 @@ Url.prototype.format = function format() {\n \n   search = search.replace(/#/g, '%23');\n \n-  if (hash && hash.charCodeAt(0) !== 35/*#*/) hash = '#' + hash;\n-  if (search && search.charCodeAt(0) !== 63/*?*/) search = '?' + search;\n+  if (hash && hash.charCodeAt(0) !== CHAR_HASH)\n+    hash = '#' + hash;\n+  if (search && search.charCodeAt(0) !== CHAR_QUESTION_MARK)\n+    search = '?' + search;\n \n   return protocol + host + pathname + search + hash;\n };"
        }
    ],
    "stats": {
        "total": 158,
        "additions": 109,
        "deletions": 49
    }
}