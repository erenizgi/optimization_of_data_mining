{
    "author": "antsmartian",
    "message": "http2: add test case for goaway\n\nPR-URL: https://github.com/nodejs/node/pull/24054\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "7f913293c1ac50b01dfc775fe4861f362bcf624a",
    "files": [
        {
            "sha": "0a538e0f9e01e051771c644243df60c8f3d3eb3e",
            "filename": "test/parallel/test-http2-client-destroy.js",
            "status": "modified",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/nodejs/node/blob/7f913293c1ac50b01dfc775fe4861f362bcf624a/test%2Fparallel%2Ftest-http2-client-destroy.js",
            "raw_url": "https://github.com/nodejs/node/raw/7f913293c1ac50b01dfc775fe4861f362bcf624a/test%2Fparallel%2Ftest-http2-client-destroy.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-client-destroy.js?ref=7f913293c1ac50b01dfc775fe4861f362bcf624a",
            "patch": "@@ -137,3 +137,30 @@ const Countdown = require('../common/countdown');\n     req.destroy();\n   }));\n }\n+\n+// test close before connect\n+{\n+  const server = h2.createServer();\n+\n+  server.on('stream', common.mustNotCall());\n+  server.listen(0, common.mustCall(() => {\n+    const client = h2.connect(`http://localhost:${server.address().port}`);\n+    const socket = client[kSocket];\n+    socket.on('close', common.mustCall(() => {\n+      assert(socket.destroyed);\n+    }));\n+\n+    const req = client.request();\n+    // should throw goaway error\n+    req.on('error', common.expectsError({\n+      code: 'ERR_HTTP2_GOAWAY_SESSION',\n+      type: Error,\n+      message: 'New streams cannot be created after receiving a GOAWAY'\n+    }));\n+\n+    client.close();\n+    req.resume();\n+    req.on('end', common.mustCall());\n+    req.on('close', common.mustCall(() => server.close()));\n+  }));\n+}"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 27,
        "deletions": 0
    }
}