{
    "author": "richardlau",
    "message": "fs, src, lib: fix `blksize` & `blocks` on Windows\n\nlibuv returns values for `blksize` and `blocks` on stat calls so\ndo not coerce them into `undefined` on Windows.\n\nPR-URL: https://github.com/nodejs/node/pull/26056\nFixes: https://github.com/nodejs/node/issues/25913\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "51d20b6a8f695947a700e7fed8f0e5b33b79cefb",
    "files": [
        {
            "sha": "ea983a8c1c2afee0195c620a6a279e8919808e67",
            "filename": "doc/api/fs.md",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/doc%2Fapi%2Ffs.md",
            "raw_url": "https://github.com/nodejs/node/raw/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/doc%2Fapi%2Ffs.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ffs.md?ref=51d20b6a8f695947a700e7fed8f0e5b33b79cefb",
            "patch": "@@ -3427,8 +3427,7 @@ to compare `curr.mtime` and `prev.mtime`.\n \n When an `fs.watchFile` operation results in an `ENOENT` error, it\n will invoke the listener once, with all the fields zeroed (or, for dates, the\n-Unix Epoch). In Windows, `blksize` and `blocks` fields will be `undefined`,\n-instead of zero. If the file is created later on, the listener will be called\n+Unix Epoch). If the file is created later on, the listener will be called\n again, with the latest stat objects. This is a change in functionality since\n v0.10.\n "
        },
        {
            "sha": "fb36a173c3bff533949553151761914201fbead0",
            "filename": "lib/internal/fs/utils.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/lib%2Finternal%2Ffs%2Futils.js",
            "raw_url": "https://github.com/nodejs/node/raw/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/lib%2Finternal%2Ffs%2Futils.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ffs%2Futils.js?ref=51d20b6a8f695947a700e7fed8f0e5b33b79cefb",
            "patch": "@@ -315,9 +315,9 @@ Stats.prototype.isSocket = function() {\n function getStatsFromBinding(stats, offset = 0) {\n   return new Stats(stats[0 + offset], stats[1 + offset], stats[2 + offset],\n                    stats[3 + offset], stats[4 + offset], stats[5 + offset],\n-                   isWindows ? undefined : stats[6 + offset],  // blksize\n+                   stats[6 + offset],  // blksize\n                    stats[7 + offset], stats[8 + offset],\n-                   isWindows ? undefined : stats[9 + offset],  // blocks\n+                   stats[9 + offset],  // blocks\n                    stats[10 + offset], stats[11 + offset],\n                    stats[12 + offset], stats[13 + offset]);\n }"
        },
        {
            "sha": "034e3c0427da3d1ed12bbd71130670238bf25ca1",
            "filename": "src/node_file.h",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/src%2Fnode_file.h",
            "raw_url": "https://github.com/nodejs/node/raw/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/src%2Fnode_file.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_file.h?ref=51d20b6a8f695947a700e7fed8f0e5b33b79cefb",
            "patch": "@@ -199,18 +199,10 @@ constexpr void FillStatsArray(AliasedBuffer<NativeT, V8T>* fields,\n   fields->SetValue(offset + 3, s->st_uid);\n   fields->SetValue(offset + 4, s->st_gid);\n   fields->SetValue(offset + 5, s->st_rdev);\n-#if defined(__POSIX__)\n   fields->SetValue(offset + 6, s->st_blksize);\n-#else\n-  fields->SetValue(offset + 6, 0);\n-#endif\n   fields->SetValue(offset + 7, s->st_ino);\n   fields->SetValue(offset + 8, s->st_size);\n-#if defined(__POSIX__)\n   fields->SetValue(offset + 9, s->st_blocks);\n-#else\n-  fields->SetValue(offset + 9, 0);\n-#endif\n // Dates.\n   fields->SetValue(offset + 10, ToNative<NativeT>(s->st_atim));\n   fields->SetValue(offset + 11, ToNative<NativeT>(s->st_mtim));"
        },
        {
            "sha": "d00411268010f6efa8eb182a0408f69bd83fa463",
            "filename": "test/parallel/test-fs-stat-bigint.js",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/test%2Fparallel%2Ftest-fs-stat-bigint.js",
            "raw_url": "https://github.com/nodejs/node/raw/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/test%2Fparallel%2Ftest-fs-stat-bigint.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-stat-bigint.js?ref=51d20b6a8f695947a700e7fed8f0e5b33b79cefb",
            "patch": "@@ -59,9 +59,6 @@ function verifyStats(bigintStats, numStats) {\n         bigintStats.isSymbolicLink(),\n         numStats.isSymbolicLink()\n       );\n-    } else if (common.isWindows && (key === 'blksize' || key === 'blocks')) {\n-      assert.strictEqual(bigintStats[key], undefined);\n-      assert.strictEqual(numStats[key], undefined);\n     } else if (Number.isSafeInteger(val)) {\n       assert.strictEqual(\n         bigintStats[key], BigInt(val),"
        },
        {
            "sha": "a44e2ce3a75830ebc033b87b8b9f22f59812a31b",
            "filename": "test/parallel/test-fs-stat.js",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/test%2Fparallel%2Ftest-fs-stat.js",
            "raw_url": "https://github.com/nodejs/node/raw/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/test%2Fparallel%2Ftest-fs-stat.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-stat.js?ref=51d20b6a8f695947a700e7fed8f0e5b33b79cefb",
            "patch": "@@ -94,16 +94,13 @@ fs.stat(__filename, common.mustCall(function(err, s) {\n   assert.strictEqual(s.isSymbolicLink(), false);\n   const keys = [\n     'dev', 'mode', 'nlink', 'uid',\n-    'gid', 'rdev', 'ino', 'size',\n+    'gid', 'rdev', 'blksize', 'ino', 'size', 'blocks',\n     'atime', 'mtime', 'ctime', 'birthtime',\n     'atimeMs', 'mtimeMs', 'ctimeMs', 'birthtimeMs'\n   ];\n-  if (!common.isWindows) {\n-    keys.push('blocks', 'blksize');\n-  }\n   const numberFields = [\n-    'dev', 'mode', 'nlink', 'uid', 'gid', 'rdev', 'ino', 'size',\n-    'atimeMs', 'mtimeMs', 'ctimeMs', 'birthtimeMs'\n+    'dev', 'mode', 'nlink', 'uid', 'gid', 'rdev', 'blksize', 'ino', 'size',\n+    'blocks', 'atimeMs', 'mtimeMs', 'ctimeMs', 'birthtimeMs'\n   ];\n   const dateFields = ['atime', 'mtime', 'ctime', 'birthtime'];\n   keys.forEach(function(k) {"
        },
        {
            "sha": "76c619260e00d83741c0d951b300df268983e39d",
            "filename": "test/parallel/test-fs-watchfile-bigint.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/test%2Fparallel%2Ftest-fs-watchfile-bigint.js",
            "raw_url": "https://github.com/nodejs/node/raw/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/test%2Fparallel%2Ftest-fs-watchfile-bigint.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-watchfile-bigint.js?ref=51d20b6a8f695947a700e7fed8f0e5b33b79cefb",
            "patch": "@@ -15,10 +15,10 @@ const expectedStatObject = new fs.Stats(\n   0n,                                        // uid\n   0n,                                        // gid\n   0n,                                        // rdev\n-  common.isWindows ? undefined : 0n,         // blksize\n+  0n,                                        // blksize\n   0n,                                        // ino\n   0n,                                        // size\n-  common.isWindows ? undefined : 0n,         // blocks\n+  0n,                                        // blocks\n   0n,                                        // atim_msec\n   0n,                                        // mtim_msec\n   0n,                                        // ctim_msec"
        },
        {
            "sha": "b3618792cdc75687dbdbc409faaab24a252f8cd3",
            "filename": "test/parallel/test-fs-watchfile.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/test%2Fparallel%2Ftest-fs-watchfile.js",
            "raw_url": "https://github.com/nodejs/node/raw/51d20b6a8f695947a700e7fed8f0e5b33b79cefb/test%2Fparallel%2Ftest-fs-watchfile.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-fs-watchfile.js?ref=51d20b6a8f695947a700e7fed8f0e5b33b79cefb",
            "patch": "@@ -38,10 +38,10 @@ const expectedStatObject = new fs.Stats(\n   0,                                        // uid\n   0,                                        // gid\n   0,                                        // rdev\n-  common.isWindows ? undefined : 0,         // blksize\n+  0,                                        // blksize\n   0,                                        // ino\n   0,                                        // size\n-  common.isWindows ? undefined : 0,         // blocks\n+  0,                                        // blocks\n   Date.UTC(1970, 0, 1, 0, 0, 0),            // atime\n   Date.UTC(1970, 0, 1, 0, 0, 0),            // mtime\n   Date.UTC(1970, 0, 1, 0, 0, 0),            // ctime"
        }
    ],
    "stats": {
        "total": 35,
        "additions": 10,
        "deletions": 25
    }
}