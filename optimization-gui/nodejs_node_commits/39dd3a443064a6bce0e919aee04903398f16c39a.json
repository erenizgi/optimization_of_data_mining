{
    "author": "tniessen",
    "message": "crypto: deprecate useless crypto APIs\n\nThe APIs were probably exposed by accident. getAuthTag and setAuthTag\nare not a usual getter/setter pair: Getting the authentication tag\nonly makes sense in the context of encryption, setting it only makes\nsense in the context of decryption. Currently, both functions throw.\nNeither has been documented publicly.\n\nPR-URL: https://github.com/nodejs/node/pull/22126\nReviewed-By: Ujjwal Sharma <usharma1998@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "39dd3a443064a6bce0e919aee04903398f16c39a",
    "files": [
        {
            "sha": "56935574e6186c6cc8aec912b84c76303f3b5481",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/39dd3a443064a6bce0e919aee04903398f16c39a/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/39dd3a443064a6bce0e919aee04903398f16c39a/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=39dd3a443064a6bce0e919aee04903398f16c39a",
            "patch": "@@ -1021,6 +1021,16 @@ accessed outside of Node.js core: `Socket.prototype._handle`,\n `Socket.prototype._healthCheck()`, `Socket.prototype._stopReceiving()`, and\n `dgram._createSocketHandle()`.\n \n+<a id=\"DEP0113\"></a>\n+### DEP0113: Cipher.setAuthTag(), Decipher.getAuthTag()\n+\n+Type: Runtime\n+\n+With the current crypto API, having `Cipher.setAuthTag()` and\n+`Decipher.getAuthTag()` is not helpful and both functions will throw an error\n+when called. They have never been documented and will be removed in a future\n+release.\n+\n [`--pending-deprecation`]: cli.html#cli_pending_deprecation\n [`Buffer.allocUnsafeSlow(size)`]: buffer.html#buffer_class_method_buffer_allocunsafeslow_size\n [`Buffer.from(array)`]: buffer.html#buffer_class_method_buffer_from_array"
        },
        {
            "sha": "1828b69b140a1c8635ae931238b28727ce05d74f",
            "filename": "lib/internal/crypto/cipher.js",
            "status": "modified",
            "additions": 27,
            "deletions": 5,
            "changes": 32,
            "blob_url": "https://github.com/nodejs/node/blob/39dd3a443064a6bce0e919aee04903398f16c39a/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "raw_url": "https://github.com/nodejs/node/raw/39dd3a443064a6bce0e919aee04903398f16c39a/lib%2Finternal%2Fcrypto%2Fcipher.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fcrypto%2Fcipher.js?ref=39dd3a443064a6bce0e919aee04903398f16c39a",
            "patch": "@@ -31,7 +31,7 @@ const assert = require('assert');\n const LazyTransform = require('internal/streams/lazy_transform');\n \n const { inherits } = require('util');\n-const { normalizeEncoding } = require('internal/util');\n+const { deprecate, normalizeEncoding } = require('internal/util');\n \n // Lazy loaded for startup performance.\n let StringDecoder;\n@@ -194,7 +194,7 @@ Cipher.prototype.getAuthTag = function getAuthTag() {\n };\n \n \n-Cipher.prototype.setAuthTag = function setAuthTag(tagbuf) {\n+function setAuthTag(tagbuf) {\n   if (!isArrayBufferView(tagbuf)) {\n     throw new ERR_INVALID_ARG_TYPE('buffer',\n                                    ['Buffer', 'TypedArray', 'DataView'],\n@@ -203,7 +203,14 @@ Cipher.prototype.setAuthTag = function setAuthTag(tagbuf) {\n   if (!this._handle.setAuthTag(tagbuf))\n     throw new ERR_CRYPTO_INVALID_STATE('setAuthTag');\n   return this;\n-};\n+}\n+\n+Object.defineProperty(Cipher.prototype, 'setAuthTag', {\n+  get: deprecate(() => setAuthTag,\n+                 'Cipher.setAuthTag is deprecated and will be removed in a ' +\n+                 'future version of Node.js.',\n+                 'DEP0113')\n+});\n \n Cipher.prototype.setAAD = function setAAD(aadbuf, options) {\n   if (!isArrayBufferView(aadbuf)) {\n@@ -231,8 +238,23 @@ function addCipherPrototypeFunctions(constructor) {\n   constructor.prototype.update = Cipher.prototype.update;\n   constructor.prototype.final = Cipher.prototype.final;\n   constructor.prototype.setAutoPadding = Cipher.prototype.setAutoPadding;\n-  constructor.prototype.getAuthTag = Cipher.prototype.getAuthTag;\n-  constructor.prototype.setAuthTag = Cipher.prototype.setAuthTag;\n+  if (constructor === Cipheriv) {\n+    constructor.prototype.getAuthTag = Cipher.prototype.getAuthTag;\n+    Object.defineProperty(constructor.prototype, 'setAuthTag', {\n+      get: deprecate(() => setAuthTag,\n+                     'Cipher.setAuthTag is deprecated and will be removed in ' +\n+                     'a future version of Node.js.',\n+                     'DEP0113')\n+    });\n+  } else {\n+    constructor.prototype.setAuthTag = setAuthTag;\n+    Object.defineProperty(constructor.prototype, 'getAuthTag', {\n+      get: deprecate(() => constructor.prototype.getAuthTag,\n+                     'Decipher.getAuthTag is deprecated and will be removed ' +\n+                     'in a future version of Node.js.',\n+                     'DEP0113')\n+    });\n+  }\n   constructor.prototype.setAAD = Cipher.prototype.setAAD;\n }\n "
        },
        {
            "sha": "5c0fbb6a95fdedbee3f5c336b93556ad10a34fa6",
            "filename": "test/parallel/test-crypto-authenticated.js",
            "status": "modified",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/nodejs/node/blob/39dd3a443064a6bce0e919aee04903398f16c39a/test%2Fparallel%2Ftest-crypto-authenticated.js",
            "raw_url": "https://github.com/nodejs/node/raw/39dd3a443064a6bce0e919aee04903398f16c39a/test%2Fparallel%2Ftest-crypto-authenticated.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-crypto-authenticated.js?ref=39dd3a443064a6bce0e919aee04903398f16c39a",
            "patch": "@@ -207,27 +207,6 @@ for (const test of TEST_CASES) {\n     assert.throws(function() { encrypt.getAuthTag(); }, errMessages.state);\n   }\n \n-  {\n-    // trying to set tag on encryption object:\n-    const encrypt = crypto.createCipheriv(test.algo,\n-                                          Buffer.from(test.key, 'hex'),\n-                                          Buffer.from(test.iv, 'hex'),\n-                                          options);\n-    assert.throws(() => { encrypt.setAuthTag(Buffer.from(test.tag, 'hex')); },\n-                  errMessages.state);\n-  }\n-\n-  {\n-    if (!isCCM || !common.hasFipsCrypto) {\n-      // trying to read tag from decryption object:\n-      const decrypt = crypto.createDecipheriv(test.algo,\n-                                              Buffer.from(test.key, 'hex'),\n-                                              Buffer.from(test.iv, 'hex'),\n-                                              options);\n-      assert.throws(function() { decrypt.getAuthTag(); }, errMessages.state);\n-    }\n-  }\n-\n   {\n     // trying to create cipher with incorrect IV length\n     assert.throws(function() {"
        }
    ],
    "stats": {
        "total": 63,
        "additions": 37,
        "deletions": 26
    }
}