{
    "author": "unknown",
    "message": "tls: throw if protocol too long\n\nThe convertProtocols() function now throws a range error when the byte\nlength of a protocol is too long to fit in a Buffer.\n\nAlso added a test case in test/parallel/test-tls-basic-validations.js\nto cover this.\n\nPR-URL: https://github.com/nodejs/node/pull/23606\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>",
    "sha": "cdba3c1de0de37576426421128982a4022480381",
    "files": [
        {
            "sha": "044303be5a560d3a40935ffa2c532e5fb147ce09",
            "filename": "lib/internal/errors.js",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/cdba3c1de0de37576426421128982a4022480381/lib%2Finternal%2Ferrors.js",
            "raw_url": "https://github.com/nodejs/node/raw/cdba3c1de0de37576426421128982a4022480381/lib%2Finternal%2Ferrors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ferrors.js?ref=cdba3c1de0de37576426421128982a4022480381",
            "patch": "@@ -825,10 +825,11 @@ E('ERR_NO_ICU',\n   '%s is not supported on Node.js compiled without ICU', TypeError);\n E('ERR_NO_LONGER_SUPPORTED', '%s is no longer supported', Error);\n E('ERR_OUT_OF_RANGE',\n-  (name, range, value) => {\n-    let msg = `The value of \"${name}\" is out of range.`;\n+  (str, range, input, replaceDefaultBoolean = false) => {\n+    let msg = replaceDefaultBoolean ? str :\n+      `The value of \"${str}\" is out of range.`;\n     if (range !== undefined) msg += ` It must be ${range}.`;\n-    msg += ` Received ${value}`;\n+    msg += ` Received ${input}`;\n     return msg;\n   }, RangeError);\n E('ERR_REQUIRE_ESM', 'Must use import to load ES Module: %s', Error);"
        },
        {
            "sha": "d6b86a410374b756caf9c35e7bef8c9b94257297",
            "filename": "lib/tls.js",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/cdba3c1de0de37576426421128982a4022480381/lib%2Ftls.js",
            "raw_url": "https://github.com/nodejs/node/raw/cdba3c1de0de37576426421128982a4022480381/lib%2Ftls.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftls.js?ref=cdba3c1de0de37576426421128982a4022480381",
            "patch": "@@ -21,7 +21,10 @@\n \n 'use strict';\n \n-const { ERR_TLS_CERT_ALTNAME_INVALID } = require('internal/errors').codes;\n+const {\n+  ERR_TLS_CERT_ALTNAME_INVALID,\n+  ERR_OUT_OF_RANGE\n+} = require('internal/errors').codes;\n const internalUtil = require('internal/util');\n const internalTLS = require('internal/tls');\n internalUtil.assertCrypto();\n@@ -60,6 +63,10 @@ function convertProtocols(protocols) {\n   const lens = new Array(protocols.length);\n   const buff = Buffer.allocUnsafe(protocols.reduce((p, c, i) => {\n     var len = Buffer.byteLength(c);\n+    if (len > 255) {\n+      throw new ERR_OUT_OF_RANGE('The byte length of the protocol at index ' +\n+        `${i} exceeds the maximum length.`, '<= 255', len, true);\n+    }\n     lens[i] = len;\n     return p + 1 + len;\n   }, 0));"
        },
        {
            "sha": "8d39b8d45c9c652f8ff0bc19a0d59527022d42c1",
            "filename": "test/parallel/test-tls-basic-validations.js",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/cdba3c1de0de37576426421128982a4022480381/test%2Fparallel%2Ftest-tls-basic-validations.js",
            "raw_url": "https://github.com/nodejs/node/raw/cdba3c1de0de37576426421128982a4022480381/test%2Fparallel%2Ftest-tls-basic-validations.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-basic-validations.js?ref=cdba3c1de0de37576426421128982a4022480381",
            "patch": "@@ -102,3 +102,16 @@ common.expectsError(\n     assert(out.ALPNProtocols.equals(Buffer.from(expectView)));\n   }\n }\n+\n+{\n+  const protocols = [(new String('a')).repeat(500)];\n+  const out = {};\n+  common.expectsError(\n+    () => tls.convertALPNProtocols(protocols, out),\n+    {\n+      code: 'ERR_OUT_OF_RANGE',\n+      message: 'The byte length of the protocol at index 0 exceeds the ' +\n+        'maximum length. It must be <= 255. Received 500'\n+    }\n+  );\n+}"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 25,
        "deletions": 4
    }
}