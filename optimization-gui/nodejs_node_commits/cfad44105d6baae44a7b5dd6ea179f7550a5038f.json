{
    "author": "seishun",
    "message": "build,win: replace run-python subroutine with single find_python call\n\nA subroutine does not work as a replacement for the `python` command\nsince one cannot use a subroutine call in a `for /F` loop.\n\nPR-URL: https://github.com/nodejs/node/pull/18621\nReviewed-By: Bartosz Sosnowski <bartosz@janeasystems.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>",
    "sha": "cfad44105d6baae44a7b5dd6ea179f7550a5038f",
    "files": [
        {
            "sha": "a3d32055de49bda5eb25a157c098b03c25d0771b",
            "filename": "vcbuild.bat",
            "status": "modified",
            "additions": 12,
            "deletions": 16,
            "changes": 28,
            "blob_url": "https://github.com/nodejs/node/blob/cfad44105d6baae44a7b5dd6ea179f7550a5038f/vcbuild.bat",
            "raw_url": "https://github.com/nodejs/node/raw/cfad44105d6baae44a7b5dd6ea179f7550a5038f/vcbuild.bat",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/vcbuild.bat?ref=cfad44105d6baae44a7b5dd6ea179f7550a5038f",
            "patch": "@@ -165,6 +165,9 @@ if \"%target%\"==\"Clean\" echo deleting %~dp0deps\\icu\n if \"%target%\"==\"Clean\" rmdir /S /Q %~dp0deps\\icu\n :no-depsicu\n \n+call tools\\msvs\\find_python.cmd\n+if errorlevel 1 echo Could not find python2 & goto :exit\n+\n call :getnodeversion || exit /b 1\n \n if defined TAG set configure_flags=%configure_flags% --tag=%TAG%\n@@ -234,7 +237,8 @@ goto run\n if defined noprojgen goto msbuild\n \n @rem Generate the VS project.\n-call :run-python configure %configure_flags%\n+echo configure %configure_flags%\n+python configure %configure_flags%\n if errorlevel 1 goto create-msvs-files-failed\n if not exist node.sln goto create-msvs-files-failed\n echo Project files generated.\n@@ -426,7 +430,7 @@ if defined test_node_inspect goto node-test-inspect\n goto node-tests\n \n :node-check-deopts\n-call :run-python tools\\test.py --mode=release --check-deopts parallel sequential -J\n+python tools\\test.py --mode=release --check-deopts parallel sequential -J\n if defined test_node_inspect goto node-test-inspect\n goto node-tests\n \n@@ -450,7 +454,8 @@ if defined no_cctest echo Skipping cctest because no-cctest was specified && got\n echo running 'cctest %cctest_args%'\n \"%config%\\cctest\" %cctest_args%\n :run-test-py\n-call :run-python tools\\test.py %test_args%\n+echo running 'python tools\\test.py %test_args%'\n+python tools\\test.py %test_args%\n goto test-v8\n \n :test-v8\n@@ -462,7 +467,7 @@ goto lint-cpp\n :lint-cpp\n if not defined lint_cpp goto lint-js\n call :run-lint-cpp src\\*.c src\\*.cc src\\*.h test\\addons\\*.cc test\\addons\\*.h test\\addons-napi\\*.cc test\\addons-napi\\*.h test\\cctest\\*.cc test\\cctest\\*.h test\\gc\\binding.cc tools\\icu\\*.cc tools\\icu\\*.h\n-call :run-python tools/check-imports.py\n+python tools/check-imports.py\n goto lint-js\n \n :run-lint-cpp\n@@ -478,7 +483,7 @@ for /f \"tokens=*\" %%G in ('dir /b /s /a %*') do (\n ( endlocal\n   set cppfilelist=%localcppfilelist%\n )\n-call :run-python tools/cpplint.py %cppfilelist% > nul\n+python tools/cpplint.py %cppfilelist% > nul\n goto exit\n \n :add-to-list\n@@ -540,14 +545,6 @@ echo   vcbuild.bat lint                     : runs the C++ and JavaScript linter\n echo   vcbuild.bat no-cctest                : skip building cctest.exe\n goto exit\n \n-:run-python\n-call tools\\msvs\\find_python.cmd\n-if errorlevel 1 echo Could not find python2 & goto :exit\n-set cmd1=\"%VCBUILD_PYTHON_LOCATION%\" %*\n-echo %cmd1%\n-%cmd1%\n-exit /b %ERRORLEVEL%\n-\n :exit\n goto :EOF\n \n@@ -560,9 +557,8 @@ rem ***************\n set NODE_VERSION=\n set TAG=\n set FULLVERSION=\n-:: Call as subroutine for validation of python\n-call :run-python tools\\getnodeversion.py > nul\n-for /F \"tokens=*\" %%i in ('\"%VCBUILD_PYTHON_LOCATION%\" tools\\getnodeversion.py') do set NODE_VERSION=%%i\n+\n+for /F \"usebackq tokens=*\" %%i in (`python \"%~dp0tools\\getnodeversion.py\"`) do set NODE_VERSION=%%i\n if not defined NODE_VERSION (\n   echo Cannot determine current version of Node.js\n   exit /b 1"
        }
    ],
    "stats": {
        "total": 28,
        "additions": 12,
        "deletions": 16
    }
}