{
    "author": "addaleax",
    "message": "deps: cherry-pick ff0a9793334 from upstream V8\n\nOriginal commit message:\n\n    [api] Expose PreviewEntries as public API\n\n    Turn `debug::EntriesPreview` into a public API.\n    This is a straightforward approach to addressing\n    nodejs/node#20409\n    (not relying on functionality behind `--allow-natives-syntax`)\n    in Node.js.\n\nRefs: https://github.com/v8/v8/commit/ff0a979333408f544f081489411814b84df6e2d9\n\nPR-URL: https://github.com/nodejs/node/pull/20719\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "143a2f8d67a81154bdb2849999837fb0a5c13d8e",
    "files": [
        {
            "sha": "31407fa0839bb9a7f60e28d0761ecddf1308f61b",
            "filename": "deps/v8/include/v8.h",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/143a2f8d67a81154bdb2849999837fb0a5c13d8e/deps%2Fv8%2Finclude%2Fv8.h",
            "raw_url": "https://github.com/nodejs/node/raw/143a2f8d67a81154bdb2849999837fb0a5c13d8e/deps%2Fv8%2Finclude%2Fv8.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Finclude%2Fv8.h?ref=143a2f8d67a81154bdb2849999837fb0a5c13d8e",
            "patch": "@@ -3503,6 +3503,17 @@ class V8_EXPORT Object : public Value {\n    */\n   Isolate* GetIsolate();\n \n+  /**\n+   * If this object is a Set, Map, WeakSet or WeakMap, this returns a\n+   * representation of the elements of this object as an array.\n+   * If this object is a SetIterator or MapIterator, this returns all\n+   * elements of the underlying collection, starting at the iterator's current\n+   * position.\n+   * For other types, this will return an empty MaybeLocal<Array> (without\n+   * scheduling an exception).\n+   */\n+  MaybeLocal<Array> PreviewEntries(bool* is_key_value);\n+\n   static Local<Object> New(Isolate* isolate);\n \n   V8_INLINE static Object* Cast(Value* obj);"
        },
        {
            "sha": "f5be62058a0f9461d3024152c006fefd058b4476",
            "filename": "deps/v8/src/api.cc",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/143a2f8d67a81154bdb2849999837fb0a5c13d8e/deps%2Fv8%2Fsrc%2Fapi.cc",
            "raw_url": "https://github.com/nodejs/node/raw/143a2f8d67a81154bdb2849999837fb0a5c13d8e/deps%2Fv8%2Fsrc%2Fapi.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fapi.cc?ref=143a2f8d67a81154bdb2849999837fb0a5c13d8e",
            "patch": "@@ -9526,21 +9526,20 @@ int debug::EstimatedValueSize(Isolate* v8_isolate, v8::Local<v8::Value> value) {\n   return i::Handle<i::HeapObject>::cast(object)->Size();\n }\n \n-v8::MaybeLocal<v8::Array> debug::EntriesPreview(Isolate* v8_isolate,\n-                                                v8::Local<v8::Value> value,\n-                                                bool* is_key_value) {\n-  i::Isolate* isolate = reinterpret_cast<i::Isolate*>(v8_isolate);\n-  ENTER_V8_NO_SCRIPT_NO_EXCEPTION(isolate);\n-  if (value->IsMap()) {\n+v8::MaybeLocal<v8::Array> v8::Object::PreviewEntries(bool* is_key_value) {\n+  if (IsMap()) {\n     *is_key_value = true;\n-    return value.As<Map>()->AsArray();\n+    return Map::Cast(this)->AsArray();\n   }\n-  if (value->IsSet()) {\n+  if (IsSet()) {\n     *is_key_value = false;\n-    return value.As<Set>()->AsArray();\n+    return Set::Cast(this)->AsArray();\n   }\n \n-  i::Handle<i::Object> object = Utils::OpenHandle(*value);\n+  i::Handle<i::JSReceiver> object = Utils::OpenHandle(this);\n+  i::Isolate* isolate = object->GetIsolate();\n+  Isolate* v8_isolate = reinterpret_cast<Isolate*>(isolate);\n+  ENTER_V8_NO_SCRIPT_NO_EXCEPTION(isolate);\n   if (object->IsJSWeakCollection()) {\n     *is_key_value = object->IsJSWeakMap();\n     return Utils::ToLocal(i::JSWeakCollection::GetEntries("
        },
        {
            "sha": "6d50be6e0ea0c2d6c64a5083d036a20db526d670",
            "filename": "deps/v8/src/debug/debug-interface.h",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/143a2f8d67a81154bdb2849999837fb0a5c13d8e/deps%2Fv8%2Fsrc%2Fdebug%2Fdebug-interface.h",
            "raw_url": "https://github.com/nodejs/node/raw/143a2f8d67a81154bdb2849999837fb0a5c13d8e/deps%2Fv8%2Fsrc%2Fdebug%2Fdebug-interface.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Fdebug%2Fdebug-interface.h?ref=143a2f8d67a81154bdb2849999837fb0a5c13d8e",
            "patch": "@@ -204,10 +204,6 @@ void ResetBlackboxedStateCache(Isolate* isolate,\n \n int EstimatedValueSize(Isolate* isolate, v8::Local<v8::Value> value);\n \n-v8::MaybeLocal<v8::Array> EntriesPreview(Isolate* isolate,\n-                                         v8::Local<v8::Value> value,\n-                                         bool* is_key_value);\n-\n enum Builtin {\n   kObjectKeys,\n   kObjectGetPrototypeOf,"
        },
        {
            "sha": "0f3fd0377e9e948103f3836205689e7ff604586a",
            "filename": "deps/v8/src/inspector/v8-debugger.cc",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/143a2f8d67a81154bdb2849999837fb0a5c13d8e/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger.cc",
            "raw_url": "https://github.com/nodejs/node/raw/143a2f8d67a81154bdb2849999837fb0a5c13d8e/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/deps%2Fv8%2Fsrc%2Finspector%2Fv8-debugger.cc?ref=143a2f8d67a81154bdb2849999837fb0a5c13d8e",
            "patch": "@@ -29,8 +29,10 @@ v8::MaybeLocal<v8::Array> collectionsEntries(v8::Local<v8::Context> context,\n   v8::Isolate* isolate = context->GetIsolate();\n   v8::Local<v8::Array> entries;\n   bool isKeyValue = false;\n-  if (!v8::debug::EntriesPreview(isolate, value, &isKeyValue).ToLocal(&entries))\n+  if (!value->IsObject() ||\n+      !value.As<v8::Object>()->PreviewEntries(&isKeyValue).ToLocal(&entries)) {\n     return v8::MaybeLocal<v8::Array>();\n+  }\n \n   v8::Local<v8::Array> wrappedEntries = v8::Array::New(isolate);\n   CHECK(!isKeyValue || wrappedEntries->Length() % 2 == 0);"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 23,
        "deletions": 15
    }
}