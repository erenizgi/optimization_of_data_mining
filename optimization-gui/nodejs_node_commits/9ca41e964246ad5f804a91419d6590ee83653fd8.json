{
    "author": "danbev",
    "message": "src: introduce inspect-brk-node\n\nThis commit is a suggestion to add a new option to the node executable\nto allow for breaking in node's javascript bootstrapper code.\n\nPreviously I've been able to set breakpoints in node bootstrapper code\nand then restart the debugging session and those breakpoints would be\nhit, but I don't seem to be able to do so anymore. Having this option\nwould allow me to use this option and then step through or add more\nbreak points as needed.\n\nPR-URL: https://github.com/nodejs/node/pull/20819\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "9ca41e964246ad5f804a91419d6590ee83653fd8",
    "files": [
        {
            "sha": "de911eb841e7ed31b63a4752e107581cb440c43f",
            "filename": "lib/internal/bootstrap/loaders.js",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/9ca41e964246ad5f804a91419d6590ee83653fd8/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "raw_url": "https://github.com/nodejs/node/raw/9ca41e964246ad5f804a91419d6590ee83653fd8/lib%2Finternal%2Fbootstrap%2Floaders.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Floaders.js?ref=9ca41e964246ad5f804a91419d6590ee83653fd8",
            "patch": "@@ -40,7 +40,10 @@\n 'use strict';\n \n (function bootstrapInternalLoaders(process, getBinding, getLinkedBinding,\n-                                   getInternalBinding) {\n+                                   getInternalBinding, debugBreak) {\n+  if (debugBreak)\n+    debugger; // eslint-disable-line no-debugger\n+\n   const {\n     apply: ReflectApply,\n     deleteProperty: ReflectDeleteProperty,"
        },
        {
            "sha": "71af5b93f6632e9ede29456b761e24413310dded",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/9ca41e964246ad5f804a91419d6590ee83653fd8/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/9ca41e964246ad5f804a91419d6590ee83653fd8/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=9ca41e964246ad5f804a91419d6590ee83653fd8",
            "patch": "@@ -2190,6 +2190,11 @@ void SetupProcessObject(Environment* env,\n                                 \"_breakFirstLine\", True(env->isolate()));\n   }\n \n+  if (debug_options.break_node_first_line()) {\n+    READONLY_DONT_ENUM_PROPERTY(process,\n+                                \"_breakNodeFirstLine\", True(env->isolate()));\n+  }\n+\n   // --inspect --debug-brk\n   if (debug_options.deprecated_invocation()) {\n     READONLY_DONT_ENUM_PROPERTY(process,\n@@ -2401,7 +2406,8 @@ void LoadEnvironment(Environment* env) {\n     env->process_object(),\n     get_binding_fn,\n     get_linked_binding_fn,\n-    get_internal_binding_fn\n+    get_internal_binding_fn,\n+    Boolean::New(env->isolate(), debug_options.break_node_first_line())\n   };\n \n   // Bootstrap internal loaders"
        },
        {
            "sha": "5fc29059ddc84f3f37a8f4d7f0e6aef03b00ea30",
            "filename": "src/node_debug_options.cc",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/9ca41e964246ad5f804a91419d6590ee83653fd8/src%2Fnode_debug_options.cc",
            "raw_url": "https://github.com/nodejs/node/raw/9ca41e964246ad5f804a91419d6590ee83653fd8/src%2Fnode_debug_options.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_debug_options.cc?ref=9ca41e964246ad5f804a91419d6590ee83653fd8",
            "patch": "@@ -58,6 +58,7 @@ DebugOptions::DebugOptions() :\n                                inspector_enabled_(false),\n                                deprecated_debug_(false),\n                                break_first_line_(false),\n+                               break_node_first_line_(false),\n                                host_name_(\"127.0.0.1\"), port_(-1) { }\n \n bool DebugOptions::ParseOption(const char* argv0, const std::string& option) {\n@@ -90,6 +91,9 @@ bool DebugOptions::ParseOption(const char* argv0, const std::string& option) {\n   } else if (option_name == \"--inspect-brk\") {\n     inspector_enabled_ = true;\n     break_first_line_ = true;\n+  } else if (option_name == \"--inspect-brk-node\") {\n+    inspector_enabled_ = true;\n+    break_node_first_line_ = true;\n   } else if (option_name == \"--debug-brk\") {\n     break_first_line_ = true;\n     deprecated_debug_ = true;"
        },
        {
            "sha": "98922ab099ac775bc9c2ec910b03a777a33eba71",
            "filename": "src/node_debug_options.h",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/9ca41e964246ad5f804a91419d6590ee83653fd8/src%2Fnode_debug_options.h",
            "raw_url": "https://github.com/nodejs/node/raw/9ca41e964246ad5f804a91419d6590ee83653fd8/src%2Fnode_debug_options.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_debug_options.h?ref=9ca41e964246ad5f804a91419d6590ee83653fd8",
            "patch": "@@ -19,16 +19,20 @@ class DebugOptions {\n   bool invalid_invocation() const {\n     return deprecated_debug_ && !inspector_enabled_;\n   }\n-  bool wait_for_connect() const { return break_first_line_; }\n+  bool wait_for_connect() const {\n+    return break_first_line_ || break_node_first_line_;\n+  }\n   std::string host_name() const { return host_name_; }\n   void set_host_name(std::string host_name) { host_name_ = host_name; }\n   int port() const;\n   void set_port(int port) { port_ = port; }\n+  bool break_node_first_line() const { return break_node_first_line_; }\n \n  private:\n   bool inspector_enabled_;\n   bool deprecated_debug_;\n   bool break_first_line_;\n+  bool break_node_first_line_;\n   std::string host_name_;\n   int port_;\n };"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 20,
        "deletions": 3
    }
}