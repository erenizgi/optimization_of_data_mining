{
    "author": "peakji",
    "message": "url: fix WHATWG host formatting error\n\nThe current url.format implementation will return an invalid URL string\nwithout the host if there is a port and unicode: true.\n\nThis unexpected behavior is caused by domainToUnicode, which expects\na hostname instead of a host string according to node_url.cc.\n\nAdds both a fix and a test for the issue.\n\nPR-URL: https://github.com/nodejs/node/pull/20493\nReviewed-By: Michaël Zasso <targos@protonmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Trivikram Kamat <trivikr.dev@gmail.com>\nReviewed-By: Joyee Cheung <joyeec9h3@gmail.com>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Daijiro Wachi <daijiro.wachi@gmail.com>",
    "sha": "2a96ee284cc5aecec9b66d24bddb06acbcc72c98",
    "files": [
        {
            "sha": "d9daef1524787de7f94cf982133fb14bdb8ac13b",
            "filename": "lib/internal/url.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/2a96ee284cc5aecec9b66d24bddb06acbcc72c98/lib%2Finternal%2Furl.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a96ee284cc5aecec9b66d24bddb06acbcc72c98/lib%2Finternal%2Furl.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Furl.js?ref=2a96ee284cc5aecec9b66d24bddb06acbcc72c98",
            "patch": "@@ -400,7 +400,9 @@ Object.defineProperties(URL.prototype, {\n           ret += '@';\n         }\n         ret += options.unicode ?\n-          domainToUnicode(this.host) : this.host;\n+          domainToUnicode(this.hostname) : this.hostname;\n+        if (ctx.port !== null)\n+          ret += `:${ctx.port}`;\n       } else if (ctx.scheme === 'file:') {\n         ret += '//';\n       }"
        },
        {
            "sha": "e5c3e369e80390f8579cfe0a928f6179e841e15c",
            "filename": "test/parallel/test-url-format-whatwg.js",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/2a96ee284cc5aecec9b66d24bddb06acbcc72c98/test%2Fparallel%2Ftest-url-format-whatwg.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a96ee284cc5aecec9b66d24bddb06acbcc72c98/test%2Fparallel%2Ftest-url-format-whatwg.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-url-format-whatwg.js?ref=2a96ee284cc5aecec9b66d24bddb06acbcc72c98",
            "patch": "@@ -111,3 +111,8 @@ assert.strictEqual(\n   url.format(myURL, { unicode: 0 }),\n   'http://xn--lck1c3crb1723bpq4a.com/a?a=b#c'\n );\n+\n+assert.strictEqual(\n+  url.format(new URL('http://xn--0zwm56d.com:8080/path'), { unicode: true }),\n+  'http://测试.com:8080/path'\n+);"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 8,
        "deletions": 1
    }
}