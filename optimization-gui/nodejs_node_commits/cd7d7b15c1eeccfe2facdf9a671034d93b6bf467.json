{
    "author": "mhdawson",
    "message": "n-api: take n-api out of experimental\n\nTake n-api out of experimental as per:\nhttps://github.com/nodejs/TSC/issues/501\n\nPR-URL: https://github.com/nodejs/node/pull/19262\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: MichaÃ«l Zasso <targos@protonmail.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Franziska Hinkelmann <franziska.hinkelmann@gmail.com>",
    "sha": "cd7d7b15c1eeccfe2facdf9a671034d93b6bf467",
    "files": [
        {
            "sha": "5b36479caea15b791f67c77393500fe92f56aa8b",
            "filename": "doc/api/n-api.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/doc%2Fapi%2Fn-api.md",
            "raw_url": "https://github.com/nodejs/node/raw/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/doc%2Fapi%2Fn-api.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fn-api.md?ref=cd7d7b15c1eeccfe2facdf9a671034d93b6bf467",
            "patch": "@@ -2,7 +2,7 @@\n \n <!--introduced_in=v7.10.0-->\n \n-> Stability: 1 - Experimental\n+> Stability: 2 - Stable\n \n N-API (pronounced N as in the letter, followed by API)\n is an API for building native Addons. It is independent from"
        },
        {
            "sha": "36a3612a7807318a1384b12caac51f623610712e",
            "filename": "src/env.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fenv.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fenv.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.cc?ref=cd7d7b15c1eeccfe2facdf9a671034d93b6bf467",
            "patch": "@@ -95,7 +95,6 @@ Environment::Environment(IsolateData* isolate_data,\n       printed_error_(false),\n       trace_sync_io_(false),\n       abort_on_uncaught_exception_(false),\n-      emit_napi_warning_(true),\n       emit_env_nonstring_warning_(true),\n       makecallback_cntr_(0),\n       should_abort_on_uncaught_toggle_(isolate_, 1),\n@@ -350,12 +349,6 @@ bool Environment::RemovePromiseHook(promise_hook_func fn, void* arg) {\n   return true;\n }\n \n-bool Environment::EmitNapiWarning() {\n-  bool current_value = emit_napi_warning_;\n-  emit_napi_warning_ = false;\n-  return current_value;\n-}\n-\n void Environment::EnvPromiseHook(v8::PromiseHookType type,\n                                  v8::Local<v8::Promise> promise,\n                                  v8::Local<v8::Value> parent) {"
        },
        {
            "sha": "c778e7ba11234054972a64da25cc8612e9144e34",
            "filename": "src/env.h",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fenv.h",
            "raw_url": "https://github.com/nodejs/node/raw/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fenv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.h?ref=cd7d7b15c1eeccfe2facdf9a671034d93b6bf467",
            "patch": "@@ -725,7 +725,6 @@ class Environment {\n \n   void AddPromiseHook(promise_hook_func fn, void* arg);\n   bool RemovePromiseHook(promise_hook_func fn, void* arg);\n-  bool EmitNapiWarning();\n   inline bool EmitProcessEnvWarning() {\n     bool current_value = emit_env_nonstring_warning_;\n     emit_env_nonstring_warning_ = false;\n@@ -784,7 +783,6 @@ class Environment {\n   bool printed_error_;\n   bool trace_sync_io_;\n   bool abort_on_uncaught_exception_;\n-  bool emit_napi_warning_;\n   bool emit_env_nonstring_warning_;\n   size_t makecallback_cntr_;\n   std::vector<double> destroy_async_id_list_;"
        },
        {
            "sha": "ede831492425b78d51a21616d954ca6cfc64a693",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=cd7d7b15c1eeccfe2facdf9a671034d93b6bf467",
            "patch": "@@ -2286,15 +2286,8 @@ static void DLOpen(const FunctionCallbackInfo<Value>& args) {\n     return;\n   }\n \n-  if (mp->nm_version == -1) {\n-    if (env->EmitNapiWarning()) {\n-      if (ProcessEmitWarning(env, \"N-API is an experimental feature and could \"\n-                                  \"change at any time.\").IsNothing()) {\n-        dlib.Close();\n-        return;\n-      }\n-    }\n-  } else if (mp->nm_version != NODE_MODULE_VERSION) {\n+  // -1 is used for N-API modules\n+  if ((mp->nm_version != -1) && (mp->nm_version != NODE_MODULE_VERSION)) {\n     char errmsg[1024];\n     snprintf(errmsg,\n              sizeof(errmsg),"
        },
        {
            "sha": "bb027822f14db9768075292f0ec7e0ea56f78f7b",
            "filename": "src/node_api.cc",
            "status": "modified",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fnode_api.cc",
            "raw_url": "https://github.com/nodejs/node/raw/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fnode_api.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_api.cc?ref=cd7d7b15c1eeccfe2facdf9a671034d93b6bf467",
            "patch": "@@ -1,13 +1,3 @@\n-/******************************************************************************\n- * Experimental prototype for demonstrating VM agnostic and ABI stable API\n- * for native modules to use instead of using Nan and V8 APIs directly.\n- *\n- * The current status is \"Experimental\" and should not be used for\n- * production applications.  The API is still subject to change\n- * and as an experimental feature is NOT subject to semver.\n- *\n- ******************************************************************************/\n-\n #include <node_buffer.h>\n #include <node_object_wrap.h>\n #include <limits.h>  // INT_MAX"
        },
        {
            "sha": "791a8f8725d268ec2882ee9b8d763c3fe74ce4fb",
            "filename": "src/node_api.h",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fnode_api.h",
            "raw_url": "https://github.com/nodejs/node/raw/cd7d7b15c1eeccfe2facdf9a671034d93b6bf467/src%2Fnode_api.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_api.h?ref=cd7d7b15c1eeccfe2facdf9a671034d93b6bf467",
            "patch": "@@ -1,12 +1,3 @@\n-/******************************************************************************\n- * Experimental prototype for demonstrating VM agnostic and ABI stable API\n- * for native modules to use instead of using Nan and V8 APIs directly.\n- *\n- * The current status is \"Experimental\" and should not be used for\n- * production applications.  The API is still subject to change\n- * and as an experimental feature is NOT subject to semver.\n- *\n- ******************************************************************************/\n #ifndef SRC_NODE_API_H_\n #define SRC_NODE_API_H_\n "
        },
        {
            "sha": "a44593e2518c24d0c70125d6dd886972a2643b63",
            "filename": "test/addons-napi/test_warning/binding.gyp",
            "status": "removed",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/040dd244de14f51b4757c25311164e36f72238c3/test%2Faddons-napi%2Ftest_warning%2Fbinding.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/040dd244de14f51b4757c25311164e36f72238c3/test%2Faddons-napi%2Ftest_warning%2Fbinding.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons-napi%2Ftest_warning%2Fbinding.gyp?ref=040dd244de14f51b4757c25311164e36f72238c3",
            "patch": "@@ -1,12 +0,0 @@\n-{\n-  \"targets\": [\n-    {\n-      \"target_name\": \"test_warning\",\n-      \"sources\": [ \"test_warning.c\" ]\n-    },\n-    {\n-      \"target_name\": \"test_warning2\",\n-      \"sources\": [ \"test_warning2.c\" ]\n-    }\n-  ]\n-}"
        },
        {
            "sha": "c82008435fd8fdd07bfc1112ac3088319a76d99f",
            "filename": "test/addons-napi/test_warning/test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/040dd244de14f51b4757c25311164e36f72238c3/test%2Faddons-napi%2Ftest_warning%2Ftest.js",
            "raw_url": "https://github.com/nodejs/node/raw/040dd244de14f51b4757c25311164e36f72238c3/test%2Faddons-napi%2Ftest_warning%2Ftest.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons-napi%2Ftest_warning%2Ftest.js?ref=040dd244de14f51b4757c25311164e36f72238c3",
            "patch": "@@ -1,16 +0,0 @@\n-'use strict';\n-\n-if (process.argv[2] === 'child') {\n-  const common = require('../../common');\n-  console.log(require(`./build/${common.buildType}/test_warning`));\n-  console.log(require(`./build/${common.buildType}/test_warning2`));\n-} else {\n-  const run = require('child_process').spawnSync;\n-  const assert = require('assert');\n-  const warning = 'Warning: N-API is an experimental feature and could ' +\n-                  'change at any time.';\n-\n-  const result = run(process.execPath, [__filename, 'child']);\n-  assert.deepStrictEqual(result.stdout.toString().match(/\\S+/g), ['42', '1337']);\n-  assert.deepStrictEqual(result.stderr.toString().split(warning).length, 2);\n-}"
        },
        {
            "sha": "d0821be1f2268dd465e8856e1f08bcd4211c76fa",
            "filename": "test/addons-napi/test_warning/test_warning.c",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/040dd244de14f51b4757c25311164e36f72238c3/test%2Faddons-napi%2Ftest_warning%2Ftest_warning.c",
            "raw_url": "https://github.com/nodejs/node/raw/040dd244de14f51b4757c25311164e36f72238c3/test%2Faddons-napi%2Ftest_warning%2Ftest_warning.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons-napi%2Ftest_warning%2Ftest_warning.c?ref=040dd244de14f51b4757c25311164e36f72238c3",
            "patch": "@@ -1,11 +0,0 @@\n-#include <node_api.h>\n-#include \"../common.h\"\n-\n-napi_value Init(napi_env env, napi_value exports) {\n-  napi_value result;\n-  NAPI_CALL(env,\n-    napi_create_uint32(env, 42, &result));\n-  return result;\n-}\n-\n-NAPI_MODULE(NODE_GYP_MODULE_NAME, Init)"
        },
        {
            "sha": "3c8ee9db01390b37b7ed6923b9f13e2bc9059fd5",
            "filename": "test/addons-napi/test_warning/test_warning2.c",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/040dd244de14f51b4757c25311164e36f72238c3/test%2Faddons-napi%2Ftest_warning%2Ftest_warning2.c",
            "raw_url": "https://github.com/nodejs/node/raw/040dd244de14f51b4757c25311164e36f72238c3/test%2Faddons-napi%2Ftest_warning%2Ftest_warning2.c",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Faddons-napi%2Ftest_warning%2Ftest_warning2.c?ref=040dd244de14f51b4757c25311164e36f72238c3",
            "patch": "@@ -1,11 +0,0 @@\n-#include <node_api.h>\n-#include \"../common.h\"\n-\n-napi_value Init(napi_env env, napi_value exports) {\n-  napi_value result;\n-  NAPI_CALL(env,\n-    napi_create_uint32(env, 1337, &result));\n-  return result;\n-}\n-\n-NAPI_MODULE(NODE_GYP_MODULE_NAME, Init)"
        }
    ],
    "stats": {
        "total": 91,
        "additions": 3,
        "deletions": 88
    }
}