{
    "author": "addaleax",
    "message": "tools: implement update-authors in JS\n\nReplace the previous Perl script with a Node.js variant\nthat explicitly supports `Author:` and, in particular,\nGitHub’s standard `Co-authored-by:` metadata tags.\n\nPR-URL: https://github.com/nodejs/node/pull/22771\nReviewed-By: Michaël Zasso <targos@protonmail.com>\nReviewed-By: Daniel Bevenius <daniel.bevenius@gmail.com>\nReviewed-By: Tobias Nießen <tniessen@tnie.de>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Matheus Marchini <mat@mmarchini.me>\nReviewed-By: Richard Lau <riclau@uk.ibm.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "175a88f0949ac679d00612ec120ac61ba36276b8",
    "files": [
        {
            "sha": "1c48eaec85c8234907a920b08f977b2e51730afd",
            "filename": "tools/update-authors.js",
            "status": "added",
            "additions": 50,
            "deletions": 0,
            "changes": 50,
            "blob_url": "https://github.com/nodejs/node/blob/175a88f0949ac679d00612ec120ac61ba36276b8/tools%2Fupdate-authors.js",
            "raw_url": "https://github.com/nodejs/node/raw/175a88f0949ac679d00612ec120ac61ba36276b8/tools%2Fupdate-authors.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fupdate-authors.js?ref=175a88f0949ac679d00612ec120ac61ba36276b8",
            "patch": "@@ -0,0 +1,50 @@\n+#!/usr/bin/env node\n+// Usage: tools/update-author.js [--dry]\n+// Passing --dry will redirect output to stdout rather than write to 'AUTHORS'.\n+'use strict';\n+const { spawn } = require('child_process');\n+const fs = require('fs');\n+const readline = require('readline');\n+\n+const log = spawn(\n+  'git',\n+  // Inspect author name/email and body.\n+  ['log', '--reverse', '--format=Author: %aN <%aE>\\n%b'], {\n+    stdio: ['inherit', 'pipe', 'inherit']\n+  });\n+const rl = readline.createInterface({ input: log.stdout });\n+\n+let output;\n+if (process.argv.includes('--dry'))\n+  output = process.stdout;\n+else\n+  output = fs.createWriteStream('AUTHORS');\n+\n+output.write('# Authors ordered by first contribution.\\n\\n');\n+\n+const seen = new Set();\n+\n+// Support regular git author metadata, as well as `Author:` and\n+// `Co-authored-by:` in the message body. Both have been used in the past\n+// to indicate multiple authors per commit, with the latter standardized\n+// by GitHub now.\n+const authorRe =\n+  /(^Author:|^Co-authored-by:)\\s+(?<author>[^<]+)\\s+(?<email><[^>]+>)/i;\n+rl.on('line', (line) => {\n+  const match = line.match(authorRe);\n+  if (!match) return;\n+\n+  const { author, email } = match.groups;\n+  if (seen.has(email) ||\n+      /@chromium\\.org/.test(email) ||\n+      email === '<erik.corry@gmail.com>') {\n+    return;\n+  }\n+\n+  seen.add(email);\n+  output.write(`${author} ${email}\\n`);\n+});\n+\n+rl.on('close', () => {\n+  output.end('\\n# Generated by tools/update-authors.js\\n');\n+});"
        },
        {
            "sha": "d07d9c9ff73c43deca4c48824845c9dd60df6cbf",
            "filename": "tools/update-authors.sh",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/nodejs/node/blob/df7ebfab4e9575eeeb133826c54907053115a0b7/tools%2Fupdate-authors.sh",
            "raw_url": "https://github.com/nodejs/node/raw/df7ebfab4e9575eeeb133826c54907053115a0b7/tools%2Fupdate-authors.sh",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fupdate-authors.sh?ref=df7ebfab4e9575eeeb133826c54907053115a0b7",
            "patch": "@@ -1,22 +0,0 @@\n-#!/bin/sh\n-\n-git log --reverse --format='%aN <%aE>' | perl -we '\n-\n-BEGIN {\n-  %seen = (), @authors = ();\n-}\n-\n-while (<>) {\n-  next if $seen{$_};\n-  next if /\\@chromium.org/;\n-  next if /<erik.corry\\@gmail.com>/;\n-  $seen{$_} = push @authors, $_;\n-}\n-\n-END {\n-  print \"# Authors ordered by first contribution.\\n\";\n-  print \"\\n\", @authors, \"\\n\";\n-  print \"# Generated by tools/update-authors.sh\\n\";\n-}\n-\n-' > AUTHORS"
        }
    ],
    "stats": {
        "total": 72,
        "additions": 50,
        "deletions": 22
    }
}