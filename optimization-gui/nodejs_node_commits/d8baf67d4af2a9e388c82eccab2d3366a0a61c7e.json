{
    "author": "BridgeAR",
    "message": "timers: use custom inspection for linked lists\n\nInspecting linked lists is something that is not really useful.\nInstead, just use a custom inspection function and hide everything\nbesides the first level.\n\nPR-URL: https://github.com/nodejs/node/pull/23108\nReviewed-By: Jeremiah Senkpiel <fishrock123@rocketmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: Benjamin Gruenbaum <benjamingr@gmail.com>",
    "sha": "d8baf67d4af2a9e388c82eccab2d3366a0a61c7e",
    "files": [
        {
            "sha": "be86153d5df3971f61d082db72b2350aa0f73fe9",
            "filename": "lib/internal/timers.js",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/nodejs/node/blob/d8baf67d4af2a9e388c82eccab2d3366a0a61c7e/lib%2Finternal%2Ftimers.js",
            "raw_url": "https://github.com/nodejs/node/raw/d8baf67d4af2a9e388c82eccab2d3366a0a61c7e/lib%2Finternal%2Ftimers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ftimers.js?ref=d8baf67d4af2a9e388c82eccab2d3366a0a61c7e",
            "patch": "@@ -17,6 +17,8 @@ const {\n } = require('internal/errors').codes;\n const { validateNumber } = require('internal/validators');\n \n+const { inspect } = require('util');\n+\n // Timeout values > TIMEOUT_MAX are set to 1.\n const TIMEOUT_MAX = 2 ** 31 - 1;\n \n@@ -82,6 +84,17 @@ function Timeout(callback, after, args, isRepeat) {\n   initAsyncResource(this, 'Timeout');\n }\n \n+// Make sure the linked list only shows the minimal necessary information.\n+Timeout.prototype[inspect.custom] = function(_, options) {\n+  return inspect(this, {\n+    ...options,\n+    // Only inspect one level.\n+    depth: 0,\n+    // It should not recurse.\n+    customInspect: false\n+  });\n+};\n+\n Timeout.prototype.refresh = function() {\n   if (this[kRefed])\n     getTimers().active(this);"
        },
        {
            "sha": "0c5d7b07b2cca78610cde5a29a25d6bf34d22465",
            "filename": "lib/timers.js",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/nodejs/node/blob/d8baf67d4af2a9e388c82eccab2d3366a0a61c7e/lib%2Ftimers.js",
            "raw_url": "https://github.com/nodejs/node/raw/d8baf67d4af2a9e388c82eccab2d3366a0a61c7e/lib%2Ftimers.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Ftimers.js?ref=d8baf67d4af2a9e388c82eccab2d3366a0a61c7e",
            "patch": "@@ -239,6 +239,17 @@ function TimersList(expiry, msecs) {\n   this.priorityQueuePosition = null;\n }\n \n+// Make sure the linked list only shows the minimal necessary information.\n+TimersList.prototype[util.inspect.custom] = function(_, options) {\n+  return util.inspect(this, {\n+    ...options,\n+    // Only inspect one level.\n+    depth: 0,\n+    // It should not recurse.\n+    customInspect: false\n+  });\n+};\n+\n const { _tickCallback: runNextTicks } = process;\n function processTimers(now) {\n   debug('process timer lists %d', now);"
        },
        {
            "sha": "17f641835de6960625ea69358cac1c6d8daf54d3",
            "filename": "test/parallel/test-http2-socket-proxy.js",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/nodejs/node/blob/d8baf67d4af2a9e388c82eccab2d3366a0a61c7e/test%2Fparallel%2Ftest-http2-socket-proxy.js",
            "raw_url": "https://github.com/nodejs/node/raw/d8baf67d4af2a9e388c82eccab2d3366a0a61c7e/test%2Fparallel%2Ftest-http2-socket-proxy.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http2-socket-proxy.js?ref=d8baf67d4af2a9e388c82eccab2d3366a0a61c7e",
            "patch": "@@ -8,6 +8,7 @@ if (!common.hasCrypto)\n const assert = require('assert');\n const h2 = require('http2');\n const net = require('net');\n+const util = require('util');\n \n const { kTimeout } = require('internal/timers');\n \n@@ -35,6 +36,22 @@ server.on('stream', common.mustCall(function(stream, headers) {\n   socket.setTimeout(987);\n   assert.strictEqual(session[kTimeout]._idleTimeout, 987);\n \n+  // The indentation is corrected depending on the depth.\n+  let inspectedTimeout = util.inspect(session[kTimeout]);\n+  assert(inspectedTimeout.includes('  _idlePrev: [TimersList]'));\n+  assert(inspectedTimeout.includes('  _idleNext: [TimersList]'));\n+  assert(!inspectedTimeout.includes('   _idleNext: [TimersList]'));\n+\n+  inspectedTimeout = util.inspect([ session[kTimeout] ]);\n+  assert(inspectedTimeout.includes('    _idlePrev: [TimersList]'));\n+  assert(inspectedTimeout.includes('    _idleNext: [TimersList]'));\n+  assert(!inspectedTimeout.includes('     _idleNext: [TimersList]'));\n+\n+  const inspectedTimersList = util.inspect([[ session[kTimeout]._idlePrev ]]);\n+  assert(inspectedTimersList.includes('      _idlePrev: [Timeout]'));\n+  assert(inspectedTimersList.includes('      _idleNext: [Timeout]'));\n+  assert(!inspectedTimersList.includes('       _idleNext: [Timeout]'));\n+\n   common.expectsError(() => socket.destroy, errMsg);\n   common.expectsError(() => socket.emit, errMsg);\n   common.expectsError(() => socket.end, errMsg);"
        }
    ],
    "stats": {
        "total": 41,
        "additions": 41,
        "deletions": 0
    }
}