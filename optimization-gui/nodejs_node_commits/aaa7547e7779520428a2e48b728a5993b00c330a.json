{
    "author": "lpinca",
    "message": "tls: make tls.connect() accept a timeout option\n\nIf specified, and only when a socket is created internally, the option\nwill make `socket.setTimeout()` to be called on the created socket with\nthe given timeout.\n\nThis is consistent with the `timeout` option of `net.connect()` and\nprevents the `timeout` option of the `https.Agent` from being ignored\nwhen a socket is created.\n\nPR-URL: https://github.com/nodejs/node/pull/25517\nReviewed-By: Sam Roberts <vieuxtech@gmail.com>\nReviewed-By: Roman Reiss <me@silverwind.io>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "aaa7547e7779520428a2e48b728a5993b00c330a",
    "files": [
        {
            "sha": "bfa06925ef69279d109f5bb65f5069b2101bff24",
            "filename": "doc/api/tls.md",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/aaa7547e7779520428a2e48b728a5993b00c330a/doc%2Fapi%2Ftls.md",
            "raw_url": "https://github.com/nodejs/node/raw/aaa7547e7779520428a2e48b728a5993b00c330a/doc%2Fapi%2Ftls.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ftls.md?ref=aaa7547e7779520428a2e48b728a5993b00c330a",
            "patch": "@@ -1023,6 +1023,9 @@ being issued by trusted CA (`options.ca`).\n <!-- YAML\n added: v0.11.3\n changes:\n+  - version: REPLACEME\n+    pr-url: https://github.com/nodejs/node/pull/25517\n+    description: The `timeout` option is supported now.\n   - version: v8.0.0\n     pr-url: https://github.com/nodejs/node/pull/12839\n     description: The `lookup` option is supported now.\n@@ -1088,6 +1091,9 @@ changes:\n     `tls.createSecureContext()`.\n   * `lookup`: {Function} Custom lookup function. **Default:**\n     [`dns.lookup()`][].\n+  * `timeout`: {number} If set and if a socket is created internally, will call\n+    [`socket.setTimeout(timeout)`][] after the socket is created, but before it\n+    starts the connection.\n   * ...: [`tls.createSecureContext()`][] options that are used if the\n     `secureContext` option is missing, otherwise they are ignored.\n * `callback` {Function}\n@@ -1549,6 +1555,7 @@ where `secureSocket` has the same API as `pair.cleartext`.\n [`server.getTicketKeys()`]: #tls_server_getticketkeys\n [`server.listen()`]: net.html#net_server_listen\n [`server.setTicketKeys()`]: #tls_server_setticketkeys_keys\n+[`socket.setTimeout(timeout)`]: #net_socket_settimeout_timeout_callback\n [`tls.DEFAULT_ECDH_CURVE`]: #tls_tls_default_ecdh_curve\n [`tls.Server`]: #tls_class_tls_server\n [`tls.TLSSocket.getPeerCertificate()`]: #tls_tlssocket_getpeercertificate_detailed"
        },
        {
            "sha": "ef2e5e3a7bbba97275bede23f619cd6f56b91a98",
            "filename": "lib/_tls_wrap.js",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/aaa7547e7779520428a2e48b728a5993b00c330a/lib%2F_tls_wrap.js",
            "raw_url": "https://github.com/nodejs/node/raw/aaa7547e7779520428a2e48b728a5993b00c330a/lib%2F_tls_wrap.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_wrap.js?ref=aaa7547e7779520428a2e48b728a5993b00c330a",
            "patch": "@@ -1256,6 +1256,11 @@ exports.connect = function connect(...args) {\n       localAddress: options.localAddress,\n       lookup: options.lookup\n     };\n+\n+    if (options.timeout) {\n+      tlssock.setTimeout(options.timeout);\n+    }\n+\n     tlssock.connect(connectOpt, tlssock._start);\n   }\n "
        },
        {
            "sha": "4e4d4325906a9704e8bbc6f3491adfcaa08dba96",
            "filename": "test/parallel/test-tls-connect-timeout-option.js",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/nodejs/node/blob/aaa7547e7779520428a2e48b728a5993b00c330a/test%2Fparallel%2Ftest-tls-connect-timeout-option.js",
            "raw_url": "https://github.com/nodejs/node/raw/aaa7547e7779520428a2e48b728a5993b00c330a/test%2Fparallel%2Ftest-tls-connect-timeout-option.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-connect-timeout-option.js?ref=aaa7547e7779520428a2e48b728a5993b00c330a",
            "patch": "@@ -0,0 +1,19 @@\n+'use strict';\n+\n+const common = require('../common');\n+\n+// This test verifies that `tls.connect()` honors the `timeout` option when the\n+// socket is internally created.\n+\n+if (!common.hasCrypto)\n+  common.skip('missing crypto');\n+\n+const assert = require('assert');\n+const tls = require('tls');\n+\n+const socket = tls.connect({\n+  lookup: () => {},\n+  timeout: 1000\n+});\n+\n+assert.strictEqual(socket.timeout, 1000);"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 31,
        "deletions": 0
    }
}