{
    "author": "phated",
    "message": "stream: ensure Stream.pipeline re-throws errors without callback\n\nFixes an issue where Stream.pipeline wouldn't re-throw errors\non a stream if no callback was specified, thus swallowing\nsaid errors.\n\nFixes: https://github.com/nodejs/node/issues/20303\n\nPR-URL: https://github.com/nodejs/node/pull/20437\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Matteo Collina <matteo.collina@gmail.com>",
    "sha": "c1012b440203b2ab42b350b0300eb3bc8ec36381",
    "files": [
        {
            "sha": "849b3d39dbe25bf301144fabfc9b57add1f830d9",
            "filename": "lib/internal/streams/pipeline.js",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/c1012b440203b2ab42b350b0300eb3bc8ec36381/lib%2Finternal%2Fstreams%2Fpipeline.js",
            "raw_url": "https://github.com/nodejs/node/raw/c1012b440203b2ab42b350b0300eb3bc8ec36381/lib%2Finternal%2Fstreams%2Fpipeline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fstreams%2Fpipeline.js?ref=c1012b440203b2ab42b350b0300eb3bc8ec36381",
            "patch": "@@ -19,7 +19,10 @@ function once(callback) {\n   };\n }\n \n-function noop() {}\n+function noop(err) {\n+  // Rethrow the error if it exists to avoid swallowing it\n+  if (err) throw err;\n+}\n \n function isRequest(stream) {\n   return stream.setHeader && typeof stream.abort === 'function';"
        },
        {
            "sha": "b52d60529b0332cf72fd3d67260947b7245f6a4f",
            "filename": "test/parallel/test-stream-pipeline.js",
            "status": "modified",
            "additions": 35,
            "deletions": 3,
            "changes": 38,
            "blob_url": "https://github.com/nodejs/node/blob/c1012b440203b2ab42b350b0300eb3bc8ec36381/test%2Fparallel%2Ftest-stream-pipeline.js",
            "raw_url": "https://github.com/nodejs/node/raw/c1012b440203b2ab42b350b0300eb3bc8ec36381/test%2Fparallel%2Ftest-stream-pipeline.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-stream-pipeline.js?ref=c1012b440203b2ab42b350b0300eb3bc8ec36381",
            "patch": "@@ -142,7 +142,7 @@ common.crashOnUnhandledRejection();\n       }\n     });\n \n-    pipeline(rs, res);\n+    pipeline(rs, res, () => {});\n   });\n \n   server.listen(0, () => {\n@@ -177,7 +177,7 @@ common.crashOnUnhandledRejection();\n       })\n     });\n \n-    pipeline(rs, res);\n+    pipeline(rs, res, () => {});\n   });\n \n   server.listen(0, () => {\n@@ -206,7 +206,7 @@ common.crashOnUnhandledRejection();\n       })\n     });\n \n-    pipeline(rs, res);\n+    pipeline(rs, res, () => {});\n   });\n \n   let cnt = 10;\n@@ -481,3 +481,35 @@ common.crashOnUnhandledRejection();\n \n   run();\n }\n+\n+{\n+  const read = new Readable({\n+    read() {}\n+  });\n+\n+  const transform = new Transform({\n+    transform(data, enc, cb) {\n+      cb(new Error('kaboom'));\n+    }\n+  });\n+\n+  const write = new Writable({\n+    write(data, enc, cb) {\n+      cb();\n+    }\n+  });\n+\n+  read.on('close', common.mustCall());\n+  transform.on('close', common.mustCall());\n+  write.on('close', common.mustCall());\n+\n+  process.on('uncaughtException', common.mustCall((err) => {\n+    assert.deepStrictEqual(err, new Error('kaboom'));\n+  }));\n+\n+  const dst = pipeline(read, transform, write);\n+\n+  assert.strictEqual(dst, write);\n+\n+  read.push('hello');\n+}"
        }
    ],
    "stats": {
        "total": 43,
        "additions": 39,
        "deletions": 4
    }
}