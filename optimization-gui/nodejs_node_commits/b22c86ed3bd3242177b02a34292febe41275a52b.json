{
    "author": "joyeecheung",
    "message": "src: use `internalBinding('config').hasInspector` in JS land\n\nInstead of `process.config.variables.v8_enable_inspector`\nwhich depends on the variable name in gyp files, or detecting\n`internalBinding('inspector').Connection`.\n\nPR-URL: https://github.com/nodejs/node/pull/25291\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>",
    "sha": "b22c86ed3bd3242177b02a34292febe41275a52b",
    "files": [
        {
            "sha": "565b3aa972764447fcae6f73ccd6214fbcf69f66",
            "filename": "lib/inspector.js",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/nodejs/node/blob/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finspector.js",
            "raw_url": "https://github.com/nodejs/node/raw/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finspector.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finspector.js?ref=b22c86ed3bd3242177b02a34292febe41275a52b",
            "patch": "@@ -1,6 +1,5 @@\n 'use strict';\n \n-const EventEmitter = require('events');\n const {\n   ERR_INSPECTOR_ALREADY_CONNECTED,\n   ERR_INSPECTOR_CLOSED,\n@@ -9,13 +8,16 @@ const {\n   ERR_INVALID_ARG_TYPE,\n   ERR_INVALID_CALLBACK\n } = require('internal/errors').codes;\n+\n+const { hasInspector } = internalBinding('config');\n+if (!hasInspector)\n+  throw new ERR_INSPECTOR_NOT_AVAILABLE();\n+\n+const EventEmitter = require('events');\n const { validateString } = require('internal/validators');\n const util = require('util');\n const { Connection, open, url } = internalBinding('inspector');\n \n-if (!Connection)\n-  throw new ERR_INSPECTOR_NOT_AVAILABLE();\n-\n const connectionSymbol = Symbol('connectionProperty');\n const messageCallbacksSymbol = Symbol('messageCallbacks');\n const nextIdSymbol = Symbol('nextId');"
        },
        {
            "sha": "f69f1252ad8747f6c8634b7493f8623d76218576",
            "filename": "lib/internal/bootstrap/cache.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finternal%2Fbootstrap%2Fcache.js",
            "raw_url": "https://github.com/nodejs/node/raw/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finternal%2Fbootstrap%2Fcache.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fcache.js?ref=b22c86ed3bd3242177b02a34292febe41275a52b",
            "patch": "@@ -9,7 +9,7 @@ const { NativeModule } = require('internal/bootstrap/loaders');\n const {\n   source, getCodeCache, compileFunction\n } = internalBinding('native_module');\n-const { hasTracing } = process.binding('config');\n+const { hasTracing, hasInspector } = process.binding('config');\n \n const depsModule = Object.keys(source).filter(\n   (key) => NativeModule.isDepsModule(key) || key.startsWith('internal/deps')\n@@ -33,7 +33,7 @@ const cannotUseCache = [\n \n // Skip modules that cannot be required when they are not\n // built into the binary.\n-if (process.config.variables.v8_enable_inspector !== 1) {\n+if (!hasInspector) {\n   cannotUseCache.push(\n     'inspector',\n     'internal/util/inspector',"
        },
        {
            "sha": "089143e5d0111464f0846ca17912d9cd1fea28af",
            "filename": "lib/internal/bootstrap/node.js",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/nodejs/node/blob/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "raw_url": "https://github.com/nodejs/node/raw/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finternal%2Fbootstrap%2Fnode.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap%2Fnode.js?ref=b22c86ed3bd3242177b02a34292febe41275a52b",
            "patch": "@@ -19,6 +19,7 @@\n const { internalBinding, NativeModule } = loaderExports;\n \n const { getOptionValue } = NativeModule.require('internal/options');\n+const config = internalBinding('config');\n \n function startup() {\n   setupTraceCategoryState();\n@@ -164,7 +165,7 @@ function startup() {\n     NativeModule.require('internal/process/coverage').setupExitHooks();\n   }\n \n-  if (process.config.variables.v8_enable_inspector) {\n+  if (config.hasInspector) {\n     NativeModule.require('internal/inspector_async_hook').setup();\n   }\n \n@@ -280,7 +281,7 @@ function startup() {\n \n   // TODO(joyeecheung): this property has not been well-maintained, should we\n   // deprecate it in favor of a better API?\n-  const { isDebugBuild, hasOpenSSL } = internalBinding('config');\n+  const { isDebugBuild, hasOpenSSL } = config;\n   Object.defineProperty(process, 'features', {\n     enumerable: true,\n     writable: false,\n@@ -630,7 +631,7 @@ function setupGlobalConsole() {\n     writable: true\n   });\n   // TODO(joyeecheung): can we skip this if inspector is not active?\n-  if (process.config.variables.v8_enable_inspector) {\n+  if (config.hasInspector) {\n     const inspector =\n       NativeModule.require('internal/console/inspector');\n     inspector.addInspectorApis(consoleFromNode, consoleFromVM);"
        },
        {
            "sha": "95235c8ac913a7e4fb4cc95af3ea9ca8a7c786b9",
            "filename": "lib/internal/process/coverage.js",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/nodejs/node/blob/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finternal%2Fprocess%2Fcoverage.js",
            "raw_url": "https://github.com/nodejs/node/raw/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finternal%2Fprocess%2Fcoverage.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fcoverage.js?ref=b22c86ed3bd3242177b02a34292febe41275a52b",
            "patch": "@@ -51,12 +51,13 @@ function disableAllAsyncHooks() {\n exports.writeCoverage = writeCoverage;\n \n function setup() {\n-  const { Connection } = internalBinding('inspector');\n-  if (!Connection) {\n+  const { hasInspector } = internalBinding('config');\n+  if (!hasInspector) {\n     process._rawDebug('inspector not enabled');\n     return;\n   }\n \n+  const { Connection } = internalBinding('inspector');\n   coverageConnection = new Connection((res) => {\n     if (coverageConnection._coverageCallback) {\n       coverageConnection._coverageCallback(res);"
        },
        {
            "sha": "face748ab0df69fcde55048373e75941a5e030a7",
            "filename": "lib/internal/util/inspector.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finternal%2Futil%2Finspector.js",
            "raw_url": "https://github.com/nodejs/node/raw/b22c86ed3bd3242177b02a34292febe41275a52b/lib%2Finternal%2Futil%2Finspector.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Finspector.js?ref=b22c86ed3bd3242177b02a34292febe41275a52b",
            "patch": "@@ -1,6 +1,6 @@\n 'use strict';\n \n-const hasInspector = process.config.variables.v8_enable_inspector === 1;\n+const { hasInspector } = internalBinding('config');\n const inspector = hasInspector ? require('inspector') : undefined;\n \n let session;"
        },
        {
            "sha": "8756969cda2986310e862c3f04cd3fdd1e735a00",
            "filename": "src/node_config.cc",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/b22c86ed3bd3242177b02a34292febe41275a52b/src%2Fnode_config.cc",
            "raw_url": "https://github.com/nodejs/node/raw/b22c86ed3bd3242177b02a34292febe41275a52b/src%2Fnode_config.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_config.cc?ref=b22c86ed3bd3242177b02a34292febe41275a52b",
            "patch": "@@ -57,6 +57,12 @@ static void Initialize(Local<Object> target,\n   READONLY_TRUE_PROPERTY(target, \"hasTracing\");\n #endif\n \n+#if HAVE_INSPECTOR\n+  READONLY_TRUE_PROPERTY(target, \"hasInspector\");\n+#else\n+  READONLY_FALSE_PROPERTY(target, \"hasInspector\");\n+#endif\n+\n #if !defined(NODE_WITHOUT_NODE_OPTIONS)\n   READONLY_TRUE_PROPERTY(target, \"hasNodeOptions\");\n #endif"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 22,
        "deletions": 12
    }
}