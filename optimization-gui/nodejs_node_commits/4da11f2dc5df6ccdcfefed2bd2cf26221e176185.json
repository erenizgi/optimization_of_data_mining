{
    "author": "tniessen",
    "message": "tls: fix DEP0083 after upgrading to OpenSSL 1.1.0\n\nSetting ecdhCurve to false is already unsupported, so the deprecation\nshould already be EOL. The test was skipped ever since we upgraded to\nOpenSSL 1.1.0.\n\nPR-URL: https://github.com/nodejs/node/pull/22953\nRefs: https://github.com/nodejs/node/pull/16130\nReviewed-By: Luigi Pinca <luigipinca@gmail.com>\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "4da11f2dc5df6ccdcfefed2bd2cf26221e176185",
    "files": [
        {
            "sha": "9f1b3c0b70049196fc3576d51a041f79324a566e",
            "filename": "doc/api/deprecations.md",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/4da11f2dc5df6ccdcfefed2bd2cf26221e176185/doc%2Fapi%2Fdeprecations.md",
            "raw_url": "https://github.com/nodejs/node/raw/4da11f2dc5df6ccdcfefed2bd2cf26221e176185/doc%2Fapi%2Fdeprecations.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Fdeprecations.md?ref=4da11f2dc5df6ccdcfefed2bd2cf26221e176185",
            "patch": "@@ -1648,17 +1648,20 @@ the `REPLServer` itself. Do not use this function.\n ### DEP0083: Disabling ECDH by setting ecdhCurve to false\n <!-- YAML\n changes:\n+  - version: v10.0.0\n+    pr-url: https://github.com/nodejs/node/pull/19794\n+    description: End-of-Life.\n   - version: v9.2.0\n     pr-url: https://github.com/nodejs/node/pull/16130\n     description: Runtime deprecation.\n -->\n \n-Type: Runtime\n+Type: End-of-Life.\n \n The `ecdhCurve` option to `tls.createSecureContext()` and `tls.TLSSocket` could\n-be set to `false` to disable ECDH entirely on the server only. This mode is\n+be set to `false` to disable ECDH entirely on the server only. This mode was\n deprecated in preparation for migrating to OpenSSL 1.1.0 and consistency with\n-the client. Use the `ciphers` parameter instead.\n+the client and is now unsupported. Use the `ciphers` parameter instead.\n \n <a id=\"DEP0084\"></a>\n ### DEP0084: requiring bundled internal dependencies"
        },
        {
            "sha": "292b27ae05d9817b5843268ee6d4a567ef831159",
            "filename": "doc/api/tls.md",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/4da11f2dc5df6ccdcfefed2bd2cf26221e176185/doc%2Fapi%2Ftls.md",
            "raw_url": "https://github.com/nodejs/node/raw/4da11f2dc5df6ccdcfefed2bd2cf26221e176185/doc%2Fapi%2Ftls.md",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/doc%2Fapi%2Ftls.md?ref=4da11f2dc5df6ccdcfefed2bd2cf26221e176185",
            "patch": "@@ -1007,6 +1007,10 @@ argument.\n <!-- YAML\n added: v0.11.13\n changes:\n+  - version: v10.0.0\n+    pr-url: https://github.com/nodejs/node/pull/19794\n+    description: The `ecdhCurve` cannot be set to `false` anymore due to a\n+                 change in OpenSSL.\n   - version: v9.3.0\n     pr-url: https://github.com/nodejs/node/pull/14903\n     description: The `options` parameter can now include `clientCertEngine`.\n@@ -1062,7 +1066,7 @@ changes:\n     discarded and DHE ciphers will not be available.\n   * `ecdhCurve` {string} A string describing a named curve or a colon separated\n     list of curve NIDs or names, for example `P-521:P-384:P-256`, to use for\n-    ECDH key agreement, or `false` to disable ECDH. Set to `auto` to select the\n+    ECDH key agreement. Set to `auto` to select the\n     curve automatically. Use [`crypto.getCurves()`][] to obtain a list of\n     available curve names. On recent releases, `openssl ecparam -list_curves`\n     will also display the name and description of each available elliptic curve."
        },
        {
            "sha": "2401bd0b4b1fa5a94ad6818d8e6a6ff2acf61c6c",
            "filename": "lib/_tls_common.js",
            "status": "modified",
            "additions": 0,
            "deletions": 12,
            "changes": 12,
            "blob_url": "https://github.com/nodejs/node/blob/4da11f2dc5df6ccdcfefed2bd2cf26221e176185/lib%2F_tls_common.js",
            "raw_url": "https://github.com/nodejs/node/raw/4da11f2dc5df6ccdcfefed2bd2cf26221e176185/lib%2F_tls_common.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_tls_common.js?ref=4da11f2dc5df6ccdcfefed2bd2cf26221e176185",
            "patch": "@@ -69,16 +69,6 @@ function validateKeyCert(name, value) {\n exports.SecureContext = SecureContext;\n \n \n-function ecdhCurveWarning() {\n-  if (ecdhCurveWarning.emitted) return;\n-  process.emitWarning('{ ecdhCurve: false } is deprecated.',\n-                      'DeprecationWarning',\n-                      'DEP0083');\n-  ecdhCurveWarning.emitted = true;\n-}\n-ecdhCurveWarning.emitted = false;\n-\n-\n exports.createSecureContext = function createSecureContext(options, context) {\n   if (!options) options = {};\n \n@@ -154,8 +144,6 @@ exports.createSecureContext = function createSecureContext(options, context) {\n     c.context.setECDHCurve(tls.DEFAULT_ECDH_CURVE);\n   else if (options.ecdhCurve)\n     c.context.setECDHCurve(options.ecdhCurve);\n-  else\n-    ecdhCurveWarning();\n \n   if (options.dhparam) {\n     const warning = c.context.setDHParam(options.dhparam);"
        },
        {
            "sha": "f06063200c5f36de8c161f553d6fbbd7c80b9b64",
            "filename": "test/parallel/test-tls-ecdh-disable.js",
            "status": "removed",
            "additions": 0,
            "deletions": 66,
            "changes": 66,
            "blob_url": "https://github.com/nodejs/node/blob/2790db5e3d74c4f7521cc27a1115228700dd4049/test%2Fparallel%2Ftest-tls-ecdh-disable.js",
            "raw_url": "https://github.com/nodejs/node/raw/2790db5e3d74c4f7521cc27a1115228700dd4049/test%2Fparallel%2Ftest-tls-ecdh-disable.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-tls-ecdh-disable.js?ref=2790db5e3d74c4f7521cc27a1115228700dd4049",
            "patch": "@@ -1,66 +0,0 @@\n-// Copyright Joyent, Inc. and other Node contributors.\n-//\n-// Permission is hereby granted, free of charge, to any person obtaining a\n-// copy of this software and associated documentation files (the\n-// \"Software\"), to deal in the Software without restriction, including\n-// without limitation the rights to use, copy, modify, merge, publish,\n-// distribute, sublicense, and/or sell copies of the Software, and to permit\n-// persons to whom the Software is furnished to do so, subject to the\n-// following conditions:\n-//\n-// The above copyright notice and this permission notice shall be included\n-// in all copies or substantial portions of the Software.\n-//\n-// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n-// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n-// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n-// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n-// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n-// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n-// USE OR OTHER DEALINGS IN THE SOFTWARE.\n-\n-// Test that the usage of elliptic curves are not permitted if disabled during\n-// server initialization.\n-\n-'use strict';\n-const common = require('../common');\n-const { readKey } = require('../common/fixtures');\n-if (!common.hasCrypto)\n-  common.skip('missing crypto');\n-\n-if (!common.opensslCli)\n-  common.skip('missing openssl-cli');\n-\n-const OPENSSL_VERSION_NUMBER =\n-  require('crypto').constants.OPENSSL_VERSION_NUMBER;\n-if (OPENSSL_VERSION_NUMBER >= 0x10100000)\n-  common.skip('false ecdhCurve not supported in OpenSSL 1.1.0');\n-\n-const assert = require('assert');\n-const tls = require('tls');\n-const exec = require('child_process').exec;\n-\n-const options = {\n-  key: readKey('agent2-key.pem'),\n-  cert: readKey('agent2-cert.pem'),\n-  ciphers: 'ECDHE-RSA-AES128-SHA',\n-  ecdhCurve: false\n-};\n-\n-common.expectWarning('DeprecationWarning',\n-                     '{ ecdhCurve: false } is deprecated.',\n-                     'DEP0083');\n-\n-const server = tls.createServer(options, common.mustNotCall());\n-\n-server.listen(0, '127.0.0.1', common.mustCall(function() {\n-  const cmd = `\"${common.opensslCli}\" s_client -cipher ${\n-    options.ciphers} -connect 127.0.0.1:${this.address().port}`;\n-\n-  exec(cmd, common.mustCall(function(err, stdout, stderr) {\n-    // Old versions of openssl will still exit with 0 so we\n-    // can't just check if err is not null.\n-    assert(stderr.includes('handshake failure'));\n-    server.close();\n-  }));\n-}));"
        }
    ],
    "stats": {
        "total": 93,
        "additions": 11,
        "deletions": 82
    }
}