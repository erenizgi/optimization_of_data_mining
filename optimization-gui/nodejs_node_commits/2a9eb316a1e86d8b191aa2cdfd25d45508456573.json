{
    "author": "joyeecheung",
    "message": "src: move internal loaders out of bootstrap_node.js\n\n- Moves the creation of `process.binding()`, `process._linkedBinding()`\n  `internalBinding()` and `NativeModule` into a separate file\n  `lib/internal/bootstrap_loaders.js`, and documents them there.\n  This file will be compiled and run before `bootstrap_node.js`, which\n  means we now bootstrap the internal module & binding system before\n  actually bootstrapping Node.js.\n- Rename the special ID that can be used to require `NativeModule`\n  as `internal/bootstrap_loaders` since it is setup there. Also put\n  `internalBinding` in the object exported by `NativeModule.require`\n  instead of putting it inside the `NativeModule.wrapper`\n- Use the original `getBinding()` to get the source code of native\n  modules instead of getting it from `process.binding('native')`\n  so that users cannot fake native modules by modifying the binding\n  object.\n- Names the bootstrapping functions so their names show up\n  in the stack trace.\n\nPR-URL: https://github.com/nodejs/node/pull/19112\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Gus Caplan <me@gus.host>",
    "sha": "2a9eb316a1e86d8b191aa2cdfd25d45508456573",
    "files": [
        {
            "sha": "6a378f659c873d4c7f7f7d2f5bf4f848efde13fc",
            "filename": ".eslintrc.js",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/.eslintrc.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/.eslintrc.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/.eslintrc.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -244,7 +244,6 @@ module.exports = {\n     DTRACE_HTTP_SERVER_REQUEST: false,\n     DTRACE_HTTP_SERVER_RESPONSE: false,\n     DTRACE_NET_SERVER_CONNECTION: false,\n-    DTRACE_NET_STREAM_END: false,\n-    internalBinding: false,\n+    DTRACE_NET_STREAM_END: false\n   },\n };"
        },
        {
            "sha": "f8eeba7222ec6935ca49888cd32477185ec17f1d",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -36,7 +36,7 @@ const { openSync, closeSync, readSync } = require('fs');\n const { parseExpressionAt } = require('internal/deps/acorn/dist/acorn');\n const { inspect } = require('util');\n const { EOL } = require('os');\n-const nativeModule = require('native_module');\n+const { NativeModule } = require('internal/bootstrap_loaders');\n \n // Escape control characters but not \\n and \\t to keep the line breaks and\n // indentation intact.\n@@ -163,7 +163,7 @@ function getErrMessage(call) {\n   }\n \n   // Skip Node.js modules!\n-  if (filename.endsWith('.js') && nativeModule.exists(filename.slice(0, -3))) {\n+  if (filename.endsWith('.js') && NativeModule.exists(filename.slice(0, -3))) {\n     errorCache.set(identifier, undefined);\n     return;\n   }"
        },
        {
            "sha": "7703d2a129419f670a0864d4f75497d6f3c78747",
            "filename": "lib/buffer.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fbuffer.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fbuffer.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fbuffer.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -41,6 +41,7 @@ const {\n // that test/parallel/test-buffer-bindingobj-no-zerofill.js is written.\n let isAnyArrayBuffer;\n try {\n+  const { internalBinding } = require('internal/bootstrap_loaders');\n   isAnyArrayBuffer = internalBinding('types').isAnyArrayBuffer;\n } catch (e) {\n   isAnyArrayBuffer = require('util').types.isAnyArrayBuffer;"
        },
        {
            "sha": "e2cc38a1f9a1b477807cacf8447f02f4b16abe69",
            "filename": "lib/domain.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fdomain.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fdomain.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fdomain.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -34,6 +34,7 @@ const {\n   ERR_UNHANDLED_ERROR\n } = require('internal/errors').codes;\n const { createHook } = require('async_hooks');\n+const { internalBinding } = require('internal/bootstrap_loaders');\n \n // overwrite process.domain with a getter/setter that will allow for more\n // effective optimizations"
        },
        {
            "sha": "e409438dfcacfd13b78623c728d1e56d75943341",
            "filename": "lib/internal/bootstrap_loaders.js",
            "status": "added",
            "additions": 229,
            "deletions": 0,
            "changes": 229,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fbootstrap_loaders.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fbootstrap_loaders.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap_loaders.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -0,0 +1,229 @@\n+// This file creates the internal module & binding loaders used by built-in\n+// modules. In contrast, user land modules are loaded using\n+// lib/module.js (CommonJS Modules) or lib/internal/loader/* (ES Modules).\n+//\n+// This file is compiled and run by node.cc before bootstrap_node.js\n+// was called, therefore the loaders are bootstraped before we start to\n+// actually bootstrap Node.js. It creates the following objects:\n+//\n+// C++ binding loaders:\n+// - process.binding(): the legacy C++ binding loader, accessible from user land\n+//   because it is an object attached to the global process object.\n+//   These C++ bindings are created using NODE_BUILTIN_MODULE_CONTEXT_AWARE()\n+//   and have their nm_flags set to NM_F_BUILTIN. We do not make any guarantees\n+//   about the stability of these bindings, but still have to take care of\n+//   compatibility issues caused by them from time to time.\n+// - process._linkedBinding(): intended to be used by embedders to add\n+//   additional C++ bindings in their applications. These C++ bindings\n+//   can be created using NODE_MODULE_CONTEXT_AWARE_CPP() with the flag\n+//   NM_F_LINKED.\n+// - internalBinding(): the private internal C++ binding loader, inaccessible\n+//   from user land because they are only available from NativeModule.require()\n+//   These C++ bindings are created using NODE_MODULE_CONTEXT_AWARE_INTERNAL()\n+//   and have their nm_flags set to NM_F_INTERNAL.\n+//\n+// Internal JavaScript module loader:\n+// - NativeModule: a minimal module system used to load the JavaScript core\n+//   modules found in lib/**/*.js and deps/**/*.js. All core modules are\n+//   compiled into the node binary via node_javascript.cc generated by js2c.py,\n+//   so they can be loaded faster without the cost of I/O. This class makes the\n+//   lib/internal/*, deps/internal/* modules and internalBinding() available by\n+//   default to core modules, and lets the core modules require itself via\n+//   require('internal/bootstrap_loaders') even when this file is not written in\n+//   CommonJS style.\n+//\n+// Other objects:\n+// - process.moduleLoadList: an array recording the bindings and the modules\n+//   loaded in the process and the order in which they are loaded.\n+\n+'use strict';\n+\n+(function bootstrapInternalLoaders(process, getBinding, getLinkedBinding,\n+                                   getInternalBinding) {\n+\n+  // Set up process.moduleLoadList\n+  const moduleLoadList = [];\n+  Object.defineProperty(process, 'moduleLoadList', {\n+    value: moduleLoadList,\n+    configurable: true,\n+    enumerable: true,\n+    writable: false\n+  });\n+\n+  // Set up process.binding() and process._linkedBinding()\n+  {\n+    const bindingObj = Object.create(null);\n+\n+    process.binding = function binding(module) {\n+      module = String(module);\n+      let mod = bindingObj[module];\n+      if (typeof mod !== 'object') {\n+        mod = bindingObj[module] = getBinding(module);\n+        moduleLoadList.push(`Binding ${module}`);\n+      }\n+      return mod;\n+    };\n+\n+    process._linkedBinding = function _linkedBinding(module) {\n+      module = String(module);\n+      let mod = bindingObj[module];\n+      if (typeof mod !== 'object')\n+        mod = bindingObj[module] = getLinkedBinding(module);\n+      return mod;\n+    };\n+  }\n+\n+  // Set up internalBinding() in the closure\n+  let internalBinding;\n+  {\n+    const bindingObj = Object.create(null);\n+    internalBinding = function internalBinding(module) {\n+      let mod = bindingObj[module];\n+      if (typeof mod !== 'object') {\n+        mod = bindingObj[module] = getInternalBinding(module);\n+        moduleLoadList.push(`Internal Binding ${module}`);\n+      }\n+      return mod;\n+    };\n+  }\n+\n+  // Minimal sandbox helper\n+  const ContextifyScript = process.binding('contextify').ContextifyScript;\n+  function runInThisContext(code, options) {\n+    const script = new ContextifyScript(code, options);\n+    return script.runInThisContext();\n+  }\n+\n+  // Set up NativeModule\n+  function NativeModule(id) {\n+    this.filename = `${id}.js`;\n+    this.id = id;\n+    this.exports = {};\n+    this.loaded = false;\n+    this.loading = false;\n+  }\n+\n+  NativeModule._source = getBinding('natives');\n+  NativeModule._cache = {};\n+\n+  const config = getBinding('config');\n+\n+  // Think of this as module.exports in this file even though it is not\n+  // written in CommonJS style.\n+  const loaderExports = { internalBinding, NativeModule };\n+  const loaderId = 'internal/bootstrap_loaders';\n+  NativeModule.require = function(id) {\n+    if (id === loaderId) {\n+      return loaderExports;\n+    }\n+\n+    const cached = NativeModule.getCached(id);\n+    if (cached && (cached.loaded || cached.loading)) {\n+      return cached.exports;\n+    }\n+\n+    if (!NativeModule.exists(id)) {\n+      // Model the error off the internal/errors.js model, but\n+      // do not use that module given that it could actually be\n+      // the one causing the error if there's a bug in Node.js\n+      const err = new Error(`No such built-in module: ${id}`);\n+      err.code = 'ERR_UNKNOWN_BUILTIN_MODULE';\n+      err.name = 'Error [ERR_UNKNOWN_BUILTIN_MODULE]';\n+      throw err;\n+    }\n+\n+    moduleLoadList.push(`NativeModule ${id}`);\n+\n+    const nativeModule = new NativeModule(id);\n+\n+    nativeModule.cache();\n+    nativeModule.compile();\n+\n+    return nativeModule.exports;\n+  };\n+\n+  NativeModule.requireForDeps = function(id) {\n+    if (!NativeModule.exists(id) ||\n+        // TODO(TimothyGu): remove when DEP0084 reaches end of life.\n+        id.startsWith('node-inspect/') ||\n+        id.startsWith('v8/')) {\n+      id = `internal/deps/${id}`;\n+    }\n+    return NativeModule.require(id);\n+  };\n+\n+  NativeModule.getCached = function(id) {\n+    return NativeModule._cache[id];\n+  };\n+\n+  NativeModule.exists = function(id) {\n+    return NativeModule._source.hasOwnProperty(id);\n+  };\n+\n+  if (config.exposeInternals) {\n+    NativeModule.nonInternalExists = function(id) {\n+      // Do not expose this to user land even with --expose-internals\n+      if (id === loaderId) {\n+        return false;\n+      }\n+      return NativeModule.exists(id);\n+    };\n+\n+    NativeModule.isInternal = function(id) {\n+      // Do not expose this to user land even with --expose-internals\n+      return id === loaderId;\n+    };\n+  } else {\n+    NativeModule.nonInternalExists = function(id) {\n+      return NativeModule.exists(id) && !NativeModule.isInternal(id);\n+    };\n+\n+    NativeModule.isInternal = function(id) {\n+      return id.startsWith('internal/');\n+    };\n+  }\n+\n+  NativeModule.getSource = function(id) {\n+    return NativeModule._source[id];\n+  };\n+\n+  NativeModule.wrap = function(script) {\n+    return NativeModule.wrapper[0] + script + NativeModule.wrapper[1];\n+  };\n+\n+  NativeModule.wrapper = [\n+    '(function (exports, require, module, process) {',\n+    '\\n});'\n+  ];\n+\n+  NativeModule.prototype.compile = function() {\n+    let source = NativeModule.getSource(this.id);\n+    source = NativeModule.wrap(source);\n+\n+    this.loading = true;\n+\n+    try {\n+      const fn = runInThisContext(source, {\n+        filename: this.filename,\n+        lineOffset: 0,\n+        displayErrors: true\n+      });\n+      const requireFn = this.id.startsWith('internal/deps/') ?\n+        NativeModule.requireForDeps :\n+        NativeModule.require;\n+      fn(this.exports, requireFn, this, process);\n+\n+      this.loaded = true;\n+    } finally {\n+      this.loading = false;\n+    }\n+  };\n+\n+  NativeModule.prototype.cache = function() {\n+    NativeModule._cache[this.id] = this;\n+  };\n+\n+  // This will be passed to the bootstrapNodeJSCore function in\n+  // bootstrap_node.js.\n+  return loaderExports;\n+});"
        },
        {
            "sha": "6cdbebc0c125b50c32d3d327999171fe6b7caf2a",
            "filename": "lib/internal/bootstrap_node.js",
            "status": "modified",
            "additions": 7,
            "deletions": 178,
            "changes": 185,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fbootstrap_node.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fbootstrap_node.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fbootstrap_node.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -4,11 +4,16 @@\n // responsible for bootstrapping the node.js core. As special caution is given\n // to the performance of the startup process, many dependencies are invoked\n // lazily.\n+//\n+// Before this file is run, lib/internal/bootstrap_loaders.js gets run first\n+// to bootstrap the internal binding and module loaders, including\n+// process.binding(), process._linkedBinding(), internalBinding() and\n+// NativeModule. And then { internalBinding, NativeModule } will be passed\n+// into this bootstrapper to bootstrap Node.js core.\n \n 'use strict';\n \n-(function(process) {\n-  let internalBinding;\n+(function bootstrapNodeJSCore(process, { internalBinding, NativeModule }) {\n   const exceptionHandlerState = { captureFn: null };\n \n   function startup() {\n@@ -270,54 +275,6 @@\n     perf.markMilestone(NODE_PERFORMANCE_MILESTONE_BOOTSTRAP_COMPLETE);\n   }\n \n-  const moduleLoadList = [];\n-  Object.defineProperty(process, 'moduleLoadList', {\n-    value: moduleLoadList,\n-    configurable: true,\n-    enumerable: true,\n-    writable: false\n-  });\n-\n-  {\n-    const bindingObj = Object.create(null);\n-\n-    const getBinding = process.binding;\n-    process.binding = function binding(module) {\n-      module = String(module);\n-      let mod = bindingObj[module];\n-      if (typeof mod !== 'object') {\n-        mod = bindingObj[module] = getBinding(module);\n-        moduleLoadList.push(`Binding ${module}`);\n-      }\n-      return mod;\n-    };\n-\n-    const getLinkedBinding = process._linkedBinding;\n-    process._linkedBinding = function _linkedBinding(module) {\n-      module = String(module);\n-      let mod = bindingObj[module];\n-      if (typeof mod !== 'object')\n-        mod = bindingObj[module] = getLinkedBinding(module);\n-      return mod;\n-    };\n-  }\n-\n-  {\n-    const bindingObj = Object.create(null);\n-\n-    const getInternalBinding = process._internalBinding;\n-    delete process._internalBinding;\n-\n-    internalBinding = function internalBinding(module) {\n-      let mod = bindingObj[module];\n-      if (typeof mod !== 'object') {\n-        mod = bindingObj[module] = getInternalBinding(module);\n-        moduleLoadList.push(`Internal Binding ${module}`);\n-      }\n-      return mod;\n-    };\n-  }\n-\n   function setupProcessObject() {\n     process._setupProcessObject(pushValueToArray);\n \n@@ -602,133 +559,5 @@\n     new vm.Script(source, { displayErrors: true, filename });\n   }\n \n-  // Below you find a minimal module system, which is used to load the node\n-  // core modules found in lib/*.js. All core modules are compiled into the\n-  // node binary, so they can be loaded faster.\n-\n-  const ContextifyScript = process.binding('contextify').ContextifyScript;\n-  function runInThisContext(code, options) {\n-    const script = new ContextifyScript(code, options);\n-    return script.runInThisContext();\n-  }\n-\n-  function NativeModule(id) {\n-    this.filename = `${id}.js`;\n-    this.id = id;\n-    this.exports = {};\n-    this.loaded = false;\n-    this.loading = false;\n-  }\n-\n-  NativeModule._source = process.binding('natives');\n-  NativeModule._cache = {};\n-\n-  const config = process.binding('config');\n-\n-  NativeModule.require = function(id) {\n-    if (id === 'native_module') {\n-      return NativeModule;\n-    }\n-\n-    const cached = NativeModule.getCached(id);\n-    if (cached && (cached.loaded || cached.loading)) {\n-      return cached.exports;\n-    }\n-\n-    if (!NativeModule.exists(id)) {\n-      // Model the error off the internal/errors.js model, but\n-      // do not use that module given that it could actually be\n-      // the one causing the error if there's a bug in Node.js\n-      const err = new Error(`No such built-in module: ${id}`);\n-      err.code = 'ERR_UNKNOWN_BUILTIN_MODULE';\n-      err.name = 'Error [ERR_UNKNOWN_BUILTIN_MODULE]';\n-      throw err;\n-    }\n-\n-    moduleLoadList.push(`NativeModule ${id}`);\n-\n-    const nativeModule = new NativeModule(id);\n-\n-    nativeModule.cache();\n-    nativeModule.compile();\n-\n-    return nativeModule.exports;\n-  };\n-\n-  NativeModule.requireForDeps = function(id) {\n-    if (!NativeModule.exists(id) ||\n-        // TODO(TimothyGu): remove when DEP0084 reaches end of life.\n-        id.startsWith('node-inspect/') ||\n-        id.startsWith('v8/')) {\n-      id = `internal/deps/${id}`;\n-    }\n-    return NativeModule.require(id);\n-  };\n-\n-  NativeModule.getCached = function(id) {\n-    return NativeModule._cache[id];\n-  };\n-\n-  NativeModule.exists = function(id) {\n-    return NativeModule._source.hasOwnProperty(id);\n-  };\n-\n-  if (config.exposeInternals) {\n-    NativeModule.nonInternalExists = NativeModule.exists;\n-\n-    NativeModule.isInternal = function(id) {\n-      return false;\n-    };\n-  } else {\n-    NativeModule.nonInternalExists = function(id) {\n-      return NativeModule.exists(id) && !NativeModule.isInternal(id);\n-    };\n-\n-    NativeModule.isInternal = function(id) {\n-      return id.startsWith('internal/');\n-    };\n-  }\n-\n-\n-  NativeModule.getSource = function(id) {\n-    return NativeModule._source[id];\n-  };\n-\n-  NativeModule.wrap = function(script) {\n-    return NativeModule.wrapper[0] + script + NativeModule.wrapper[1];\n-  };\n-\n-  NativeModule.wrapper = [\n-    '(function (exports, require, module, internalBinding, process) {',\n-    '\\n});'\n-  ];\n-\n-  NativeModule.prototype.compile = function() {\n-    let source = NativeModule.getSource(this.id);\n-    source = NativeModule.wrap(source);\n-\n-    this.loading = true;\n-\n-    try {\n-      const fn = runInThisContext(source, {\n-        filename: this.filename,\n-        lineOffset: 0,\n-        displayErrors: true\n-      });\n-      const requireFn = this.id.startsWith('internal/deps/') ?\n-        NativeModule.requireForDeps :\n-        NativeModule.require;\n-      fn(this.exports, requireFn, this, internalBinding, process);\n-\n-      this.loaded = true;\n-    } finally {\n-      this.loading = false;\n-    }\n-  };\n-\n-  NativeModule.prototype.cache = function() {\n-    NativeModule._cache[this.id] = this;\n-  };\n-\n   startup();\n });"
        },
        {
            "sha": "fc8ac555fc616c53b73f9ac046f7b90f7b253122",
            "filename": "lib/internal/encoding.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fencoding.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fencoding.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fencoding.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -17,6 +17,7 @@ const {\n \n const { isArrayBufferView } = require('internal/util/types');\n \n+const { internalBinding } = require('internal/bootstrap_loaders');\n const {\n   isArrayBuffer\n } = internalBinding('types');"
        },
        {
            "sha": "8c289171386a0d9295be4726449a2425611af66a",
            "filename": "lib/internal/loader/CreateDynamicModule.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Floader%2FCreateDynamicModule.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Floader%2FCreateDynamicModule.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Floader%2FCreateDynamicModule.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -1,5 +1,6 @@\n 'use strict';\n \n+const { internalBinding } = require('internal/bootstrap_loaders');\n const { ModuleWrap } = internalBinding('module_wrap');\n const debug = require('util').debuglog('esm');\n const ArrayJoin = Function.call.bind(Array.prototype.join);"
        },
        {
            "sha": "e92f528721ba3a06faf4de0e9e5b9c7de1e1dfc2",
            "filename": "lib/internal/loader/DefaultResolve.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Floader%2FDefaultResolve.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Floader%2FDefaultResolve.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Floader%2FDefaultResolve.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -3,7 +3,7 @@\n const { URL } = require('url');\n const CJSmodule = require('module');\n const internalFS = require('internal/fs');\n-const NativeModule = require('native_module');\n+const { NativeModule, internalBinding } = require('internal/bootstrap_loaders');\n const { extname } = require('path');\n const { realpathSync } = require('fs');\n const preserveSymlinks = !!process.binding('config').preserveSymlinks;"
        },
        {
            "sha": "162b0504d3d313c02aa470038ffa58ebc0ff251d",
            "filename": "lib/internal/loader/ModuleJob.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Floader%2FModuleJob.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Floader%2FModuleJob.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Floader%2FModuleJob.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -1,5 +1,6 @@\n 'use strict';\n \n+const { internalBinding } = require('internal/bootstrap_loaders');\n const { ModuleWrap } = internalBinding('module_wrap');\n const { SafeSet, SafePromise } = require('internal/safe_globals');\n const { decorateErrorStack } = require('internal/util');"
        },
        {
            "sha": "74dd4358274d3b9c854dec494f93d98ace0bdf3c",
            "filename": "lib/internal/loader/Translators.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Floader%2FTranslators.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Floader%2FTranslators.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Floader%2FTranslators.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -1,7 +1,7 @@\n 'use strict';\n \n+const { NativeModule, internalBinding } = require('internal/bootstrap_loaders');\n const { ModuleWrap } = internalBinding('module_wrap');\n-const NativeModule = require('native_module');\n const internalCJSModule = require('internal/module');\n const CJSModule = require('module');\n const internalURLModule = require('internal/url');"
        },
        {
            "sha": "1592761f54df25b0cfdaf2150f8c40902dccf92b",
            "filename": "lib/internal/process/modules.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fprocess%2Fmodules.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fprocess%2Fmodules.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fprocess%2Fmodules.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -1,5 +1,6 @@\n 'use strict';\n \n+const { internalBinding } = require('internal/bootstrap_loaders');\n const {\n   setImportModuleDynamicallyCallback,\n   setInitializeImportMetaObjectCallback"
        },
        {
            "sha": "aae89ce7a0f5ea9e585bbd8328530f3ec31f884a",
            "filename": "lib/internal/test/binding.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Ftest%2Fbinding.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Ftest%2Fbinding.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Ftest%2Fbinding.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -8,6 +8,7 @@ process.emitWarning(\n // These exports should be scoped as specifically as possible\n // to avoid exposing APIs because even with that warning and\n // this file being internal people will still try to abuse it.\n+const { internalBinding } = require('internal/bootstrap_loaders');\n module.exports = {\n   ModuleWrap: internalBinding('module_wrap').ModuleWrap,\n };"
        },
        {
            "sha": "c1c4d7a712d2cc476643b40d5abaa9f08b16b53d",
            "filename": "lib/internal/util/comparisons.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Futil%2Fcomparisons.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Futil%2Fcomparisons.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Futil%2Fcomparisons.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -2,6 +2,7 @@\n \n const { compare } = process.binding('buffer');\n const { isArrayBufferView } = require('internal/util/types');\n+const { internalBinding } = require('internal/bootstrap_loaders');\n const { isDate, isMap, isRegExp, isSet } = internalBinding('types');\n \n function objectToString(o) {"
        },
        {
            "sha": "e954babf1df5af91401bc12fbe57048f99f5c003",
            "filename": "lib/internal/vm/Module.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fvm%2FModule.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Finternal%2Fvm%2FModule.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Finternal%2Fvm%2FModule.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -1,5 +1,6 @@\n 'use strict';\n \n+const { internalBinding } = require('internal/bootstrap_loaders');\n const { emitExperimentalWarning } = require('internal/util');\n const { URL } = require('internal/url');\n const { kParsingContext, isContext } = process.binding('contextify');"
        },
        {
            "sha": "468619f2bf2aad73f0704f827ffa921b2eaa69e2",
            "filename": "lib/module.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fmodule.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fmodule.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -21,7 +21,7 @@\n \n 'use strict';\n \n-const NativeModule = require('native_module');\n+const { NativeModule } = require('internal/bootstrap_loaders');\n const util = require('util');\n const { decorateErrorStack } = require('internal/util');\n const { getURLFromFilePath } = require('internal/url');"
        },
        {
            "sha": "4cb50ca97b7f2b14ec46a4f216e86ea913d77532",
            "filename": "lib/string_decoder.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fstring_decoder.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Fstring_decoder.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fstring_decoder.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -22,6 +22,7 @@\n 'use strict';\n \n const { Buffer } = require('buffer');\n+const { internalBinding } = require('internal/bootstrap_loaders');\n const {\n   kIncompleteCharactersStart,\n   kIncompleteCharactersEnd,"
        },
        {
            "sha": "95bf17519b174b4ce19967950b7910f05bfcb1ef",
            "filename": "lib/util.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Futil.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/lib%2Futil.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Futil.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -39,6 +39,7 @@ const {\n   kRejected,\n } = process.binding('util');\n \n+const { internalBinding } = require('internal/bootstrap_loaders');\n const types = internalBinding('types');\n Object.assign(types, require('internal/util/types'));\n const {"
        },
        {
            "sha": "3d5fd72958399ccdca137c205d1083d3d9fc2d94",
            "filename": "node.gyp",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/node.gyp",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/node.gyp",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/node.gyp?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -24,6 +24,7 @@\n     'node_lib_target_name%': 'node_lib',\n     'node_intermediate_lib_type%': 'static_library',\n     'library_files': [\n+      'lib/internal/bootstrap_loaders.js',\n       'lib/internal/bootstrap_node.js',\n       'lib/async_hooks.js',\n       'lib/assert.js',"
        },
        {
            "sha": "682052aadf1e4476cd1dc89485dc51d8c35091ea",
            "filename": "src/node.cc",
            "status": "modified",
            "additions": 94,
            "deletions": 35,
            "changes": 129,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/src%2Fnode.cc",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/src%2Fnode.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode.cc?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -2525,7 +2525,7 @@ static void ThrowIfNoSuchModule(Environment* env, const char* module_v) {\n   env->ThrowError(errmsg);\n }\n \n-static void Binding(const FunctionCallbackInfo<Value>& args) {\n+static void GetBinding(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n   CHECK(args[0]->IsString());\n@@ -2552,7 +2552,7 @@ static void Binding(const FunctionCallbackInfo<Value>& args) {\n   args.GetReturnValue().Set(exports);\n }\n \n-static void InternalBinding(const FunctionCallbackInfo<Value>& args) {\n+static void GetInternalBinding(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args);\n \n   CHECK(args[0]->IsString());\n@@ -2567,7 +2567,7 @@ static void InternalBinding(const FunctionCallbackInfo<Value>& args) {\n   args.GetReturnValue().Set(exports);\n }\n \n-static void LinkedBinding(const FunctionCallbackInfo<Value>& args) {\n+static void GetLinkedBinding(const FunctionCallbackInfo<Value>& args) {\n   Environment* env = Environment::GetCurrent(args.GetIsolate());\n \n   CHECK(args[0]->IsString());\n@@ -3265,10 +3265,6 @@ void SetupProcessObject(Environment* env,\n   env->SetMethod(process, \"uptime\", Uptime);\n   env->SetMethod(process, \"memoryUsage\", MemoryUsage);\n \n-  env->SetMethod(process, \"binding\", Binding);\n-  env->SetMethod(process, \"_linkedBinding\", LinkedBinding);\n-  env->SetMethod(process, \"_internalBinding\", InternalBinding);\n-\n   env->SetMethod(process, \"_setupProcessObject\", SetupProcessObject);\n   env->SetMethod(process, \"_setupNextTick\", SetupNextTick);\n   env->SetMethod(process, \"_setupPromises\", SetupPromises);\n@@ -3306,8 +3302,10 @@ static void RawDebug(const FunctionCallbackInfo<Value>& args) {\n   fflush(stderr);\n }\n \n-void LoadEnvironment(Environment* env) {\n-  HandleScope handle_scope(env->isolate());\n+\n+static Local<Function> GetBootstrapper(Environment* env, Local<String> source,\n+                                  Local<String> script_name) {\n+  EscapableHandleScope scope(env->isolate());\n \n   TryCatch try_catch(env->isolate());\n \n@@ -3316,20 +3314,59 @@ void LoadEnvironment(Environment* env) {\n   // are not safe to ignore.\n   try_catch.SetVerbose(false);\n \n-  // Execute the lib/internal/bootstrap_node.js file which was included as a\n-  // static C string in node_natives.h by node_js2c.\n-  // 'internal_bootstrap_node_native' is the string containing that source code.\n-  Local<String> script_name = FIXED_ONE_BYTE_STRING(env->isolate(),\n-                                                    \"bootstrap_node.js\");\n-  Local<Value> f_value = ExecuteString(env, MainSource(env), script_name);\n+  // Execute the factory javascript file\n+  Local<Value> factory_v = ExecuteString(env, source, script_name);\n   if (try_catch.HasCaught())  {\n     ReportException(env, try_catch);\n     exit(10);\n   }\n-  // The bootstrap_node.js file returns a function 'f'\n-  CHECK(f_value->IsFunction());\n \n-  Local<Function> f = Local<Function>::Cast(f_value);\n+  CHECK(factory_v->IsFunction());\n+  Local<Function> factory = Local<Function>::Cast(factory_v);\n+\n+  return scope.Escape(factory);\n+}\n+\n+static bool ExecuteBootstrapper(Environment* env, Local<Function> factory,\n+                                int argc, Local<Value> argv[],\n+                                Local<Value>* out) {\n+  bool ret = factory->Call(\n+      env->context(), Null(env->isolate()), argc, argv).ToLocal(out);\n+\n+  // If there was an error during bootstrap then it was either handled by the\n+  // FatalException handler or it's unrecoverable (e.g. max call stack\n+  // exceeded). Either way, clear the stack so that the AsyncCallbackScope\n+  // destructor doesn't fail on the id check.\n+  // There are only two ways to have a stack size > 1: 1) the user manually\n+  // called MakeCallback or 2) user awaited during bootstrap, which triggered\n+  // _tickCallback().\n+  if (!ret) {\n+    env->async_hooks()->clear_async_id_stack();\n+  }\n+\n+  return ret;\n+}\n+\n+\n+void LoadEnvironment(Environment* env) {\n+  HandleScope handle_scope(env->isolate());\n+\n+  TryCatch try_catch(env->isolate());\n+  // Disable verbose mode to stop FatalException() handler from trying\n+  // to handle the exception. Errors this early in the start-up phase\n+  // are not safe to ignore.\n+  try_catch.SetVerbose(false);\n+\n+  // The factory scripts are lib/internal/bootstrap_loaders.js and\n+  // lib/internal/bootstrap_node.js, each included as a static C string\n+  // defined in node_javascript.h, generated in node_javascript.cc by\n+  // node_js2c.\n+  Local<Function> loaders_bootstrapper =\n+      GetBootstrapper(env, LoadersBootstrapperSource(env),\n+                 FIXED_ONE_BYTE_STRING(env->isolate(), \"bootstrap_loaders.js\"));\n+  Local<Function> node_bootstrapper =\n+      GetBootstrapper(env, NodeBootstrapperSource(env),\n+                 FIXED_ONE_BYTE_STRING(env->isolate(), \"bootstrap_node.js\"));\n \n   // Add a reference to the global object\n   Local<Object> global = env->context()->Global();\n@@ -3356,25 +3393,47 @@ void LoadEnvironment(Environment* env) {\n   // (Allows you to set stuff on `global` from anywhere in JavaScript.)\n   global->Set(FIXED_ONE_BYTE_STRING(env->isolate(), \"global\"), global);\n \n-  // Now we call 'f' with the 'process' variable that we've built up with\n-  // all our bindings. Inside bootstrap_node.js and internal/process we'll\n-  // take care of assigning things to their places.\n+  // Create binding loaders\n+  v8::Local<v8::Function> get_binding_fn =\n+      env->NewFunctionTemplate(GetBinding)->GetFunction(env->context())\n+          .ToLocalChecked();\n \n-  // We start the process this way in order to be more modular. Developers\n-  // who do not like how bootstrap_node.js sets up the module system but do\n-  // like Node's I/O bindings may want to replace 'f' with their own function.\n-  Local<Value> arg = env->process_object();\n+  v8::Local<v8::Function> get_linked_binding_fn =\n+      env->NewFunctionTemplate(GetLinkedBinding)->GetFunction(env->context())\n+          .ToLocalChecked();\n \n-  auto ret = f->Call(env->context(), Null(env->isolate()), 1, &arg);\n-  // If there was an error during bootstrap then it was either handled by the\n-  // FatalException handler or it's unrecoverable (e.g. max call stack\n-  // exceeded). Either way, clear the stack so that the AsyncCallbackScope\n-  // destructor doesn't fail on the id check.\n-  // There are only two ways to have a stack size > 1: 1) the user manually\n-  // called MakeCallback or 2) user awaited during bootstrap, which triggered\n-  // _tickCallback().\n-  if (ret.IsEmpty())\n-    env->async_hooks()->clear_async_id_stack();\n+  v8::Local<v8::Function> get_internal_binding_fn =\n+      env->NewFunctionTemplate(GetInternalBinding)->GetFunction(env->context())\n+          .ToLocalChecked();\n+\n+  Local<Value> loaders_bootstrapper_args[] = {\n+    env->process_object(),\n+    get_binding_fn,\n+    get_linked_binding_fn,\n+    get_internal_binding_fn\n+  };\n+\n+  // Bootstrap internal loaders\n+  Local<Value> bootstrapped_loaders;\n+  if (!ExecuteBootstrapper(env, loaders_bootstrapper,\n+                           arraysize(loaders_bootstrapper_args),\n+                           loaders_bootstrapper_args,\n+                           &bootstrapped_loaders)) {\n+    return;\n+  }\n+\n+  // Bootstrap Node.js\n+  Local<Value> bootstrapped_node;\n+  Local<Value> node_bootstrapper_args[] = {\n+    env->process_object(),\n+    bootstrapped_loaders\n+  };\n+  if (!ExecuteBootstrapper(env, node_bootstrapper,\n+                           arraysize(node_bootstrapper_args),\n+                           node_bootstrapper_args,\n+                           &bootstrapped_node)) {\n+    return;\n+  }\n }\n \n static void PrintHelp() {"
        },
        {
            "sha": "d1ad9a25745e9ba190142b35dedd0aca4109cf07",
            "filename": "src/node_javascript.h",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/src%2Fnode_javascript.h",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/src%2Fnode_javascript.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_javascript.h?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -29,7 +29,8 @@\n namespace node {\n \n void DefineJavaScript(Environment* env, v8::Local<v8::Object> target);\n-v8::Local<v8::String> MainSource(Environment* env);\n+v8::Local<v8::String> LoadersBootstrapperSource(Environment* env);\n+v8::Local<v8::String> NodeBootstrapperSource(Environment* env);\n \n }  // namespace node\n "
        },
        {
            "sha": "eab43959b6c8d8a9fa80a02c10614445c6032595",
            "filename": "test/message/error_exit.out",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Ferror_exit.out",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Ferror_exit.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Ferror_exit.out?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -12,4 +12,4 @@ AssertionError [ERR_ASSERTION]: 1 strictEqual 2\n     at Function.Module._load (module.js:*:*)\n     at Function.Module.runMain (module.js:*:*)\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)"
        },
        {
            "sha": "7dbf9e950c2c7111197ae6480341fa63b319bcc3",
            "filename": "test/message/eval_messages.out",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Feval_messages.out",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Feval_messages.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Feval_messages.out?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -10,7 +10,7 @@ SyntaxError: Strict mode code may not include a with statement\n     at Module._compile (module.js:*:*)\n     at evalScript (bootstrap_node.js:*:*)\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)\n 42\n 42\n [eval]:1\n@@ -25,7 +25,7 @@ Error: hello\n     at Module._compile (module.js:*:*)\n     at evalScript (bootstrap_node.js:*:*)\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)\n \n [eval]:1\n throw new Error(\"hello\")\n@@ -39,7 +39,7 @@ Error: hello\n     at Module._compile (module.js:*:*)\n     at evalScript (bootstrap_node.js:*:*)\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)\n 100\n [eval]:1\n var x = 100; y = x;\n@@ -53,7 +53,7 @@ ReferenceError: y is not defined\n     at Module._compile (module.js:*:*)\n     at evalScript (bootstrap_node.js:*:*)\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)\n \n [eval]:1\n var ______________________________________________; throw 10"
        },
        {
            "sha": "15355734705331ebd6f3fb9df4e06fc02f39f654",
            "filename": "test/message/events_unhandled_error_common_trace.out",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Fevents_unhandled_error_common_trace.out",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Fevents_unhandled_error_common_trace.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Fevents_unhandled_error_common_trace.out?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -19,4 +19,4 @@ Emitted 'error' event at:\n     at Module._compile (module.js:*:*)\n     [... lines matching original stack trace ...]\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)"
        },
        {
            "sha": "c578f55f90c45ae23336b7bd9aa1b8824cb63960",
            "filename": "test/message/events_unhandled_error_nexttick.out",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Fevents_unhandled_error_nexttick.out",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Fevents_unhandled_error_nexttick.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Fevents_unhandled_error_nexttick.out?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -11,10 +11,10 @@ Error\n     at Function.Module._load (module.js:*:*)\n     at Function.Module.runMain (module.js:*:*)\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)\n Emitted 'error' event at:\n     at process.nextTick (*events_unhandled_error_nexttick.js:*:*)\n     at process._tickCallback (internal/process/next_tick.js:*:*)\n     at Function.Module.runMain (module.js:*:*)\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)"
        },
        {
            "sha": "d8441c44d41fd579b1b1ba2c64c4977d711ef05f",
            "filename": "test/message/events_unhandled_error_sameline.out",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Fevents_unhandled_error_sameline.out",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Fevents_unhandled_error_sameline.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Fevents_unhandled_error_sameline.out?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -11,9 +11,9 @@ Error\n     at Function.Module._load (module.js:*:*)\n     at Function.Module.runMain (module.js:*:*)\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)\n Emitted 'error' event at:\n     at Object.<anonymous> (*events_unhandled_error_sameline.js:*:*)\n     at Module._compile (module.js:*:*)\n     [... lines matching original stack trace ...]\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)"
        },
        {
            "sha": "41412b95f6ae5a3eae6a69c6e956232ee508a3ad",
            "filename": "test/message/nexttick_throw.out",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Fnexttick_throw.out",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fmessage%2Fnexttick_throw.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Fnexttick_throw.out?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -7,4 +7,4 @@ ReferenceError: undefined_reference_error_maker is not defined\n     at process._tickCallback (internal/process/next_tick.js:*:*)\n     at Function.Module.runMain (module.js:*:*)\n     at startup (bootstrap_node.js:*:*)\n-    at bootstrap_node.js:*:*\n+    at bootstrapNodeJSCore (bootstrap_node.js:*:*)"
        },
        {
            "sha": "b3e6622c8c0c885f2704e08c5499d694114950ca",
            "filename": "test/parallel/test-loaders-hidden-from-users.js",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fparallel%2Ftest-loaders-hidden-from-users.js",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/test%2Fparallel%2Ftest-loaders-hidden-from-users.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-loaders-hidden-from-users.js?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -0,0 +1,25 @@\n+// Flags: --expose-internals\n+\n+'use strict';\n+\n+const common = require('../common');\n+\n+common.expectsError(\n+  () => {\n+    require('internal/bootstrap_loaders');\n+  }, {\n+    code: 'MODULE_NOT_FOUND',\n+    message: 'Cannot find module \\'internal/bootstrap_loaders\\''\n+  }\n+);\n+\n+common.expectsError(\n+  () => {\n+    const source = 'module.exports = require(\"internal/bootstrap_loaders\")';\n+    process.binding('natives').owo = source;\n+    require('owo');\n+  }, {\n+    code: 'MODULE_NOT_FOUND',\n+    message: 'Cannot find module \\'owo\\''\n+  }\n+);"
        },
        {
            "sha": "213a9fefdcafca6b6c26e7e313a1a1ef3f88d5b8",
            "filename": "tools/js2c.py",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/2a9eb316a1e86d8b191aa2cdfd25d45508456573/tools%2Fjs2c.py",
            "raw_url": "https://github.com/nodejs/node/raw/2a9eb316a1e86d8b191aa2cdfd25d45508456573/tools%2Fjs2c.py",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/tools%2Fjs2c.py?ref=2a9eb316a1e86d8b191aa2cdfd25d45508456573",
            "patch": "@@ -185,7 +185,11 @@ def ReadMacros(lines):\n \n {definitions}\n \n-v8::Local<v8::String> MainSource(Environment* env) {{\n+v8::Local<v8::String> LoadersBootstrapperSource(Environment* env) {{\n+  return internal_bootstrap_loaders_value.ToStringChecked(env->isolate());\n+}}\n+\n+v8::Local<v8::String> NodeBootstrapperSource(Environment* env) {{\n   return internal_bootstrap_node_value.ToStringChecked(env->isolate());\n }}\n "
        }
    ],
    "stats": {
        "total": 624,
        "additions": 391,
        "deletions": 233
    }
}