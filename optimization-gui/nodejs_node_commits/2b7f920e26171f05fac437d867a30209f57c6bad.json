{
    "author": "lpinca",
    "message": "http: remove default 'drain' listener on upgrade\n\nEnsure that the default `'drain'` listener is removed before the\n`'connect'` or `'upgrade'` event is emitted.\n\nPR-URL: https://github.com/nodejs/node/pull/18866\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>",
    "sha": "2b7f920e26171f05fac437d867a30209f57c6bad",
    "files": [
        {
            "sha": "311da63c5bfe9a834104372eb5aef1d6cf7d75ad",
            "filename": "lib/_http_client.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/nodejs/node/blob/2b7f920e26171f05fac437d867a30209f57c6bad/lib%2F_http_client.js",
            "raw_url": "https://github.com/nodejs/node/raw/2b7f920e26171f05fac437d867a30209f57c6bad/lib%2F_http_client.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2F_http_client.js?ref=2b7f920e26171f05fac437d867a30209f57c6bad",
            "patch": "@@ -37,7 +37,7 @@ const { OutgoingMessage } = require('_http_outgoing');\n const Agent = require('_http_agent');\n const { Buffer } = require('buffer');\n const { urlToOptions, searchParamsSymbol } = require('internal/url');\n-const { outHeadersKey } = require('internal/http');\n+const { outHeadersKey, ondrain } = require('internal/http');\n const { nextTick } = require('internal/process/next_tick');\n const errors = require('internal/errors');\n \n@@ -424,6 +424,7 @@ function socketOnData(d) {\n \n     socket.removeListener('data', socketOnData);\n     socket.removeListener('end', socketOnEnd);\n+    socket.removeListener('drain', ondrain);\n     parser.finish();\n     freeParser(parser, req, socket);\n "
        },
        {
            "sha": "f90d235521a6493f2dfa9301d1a6b16ec8cfcc45",
            "filename": "test/parallel/test-http-connect.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/nodejs/node/blob/2b7f920e26171f05fac437d867a30209f57c6bad/test%2Fparallel%2Ftest-http-connect.js",
            "raw_url": "https://github.com/nodejs/node/raw/2b7f920e26171f05fac437d867a30209f57c6bad/test%2Fparallel%2Ftest-http-connect.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-http-connect.js?ref=2b7f920e26171f05fac437d867a30209f57c6bad",
            "patch": "@@ -74,6 +74,7 @@ server.listen(0, common.mustCall(() => {\n     assert.strictEqual(socket._httpMessage, null);\n     assert.strictEqual(socket.listeners('connect').length, 0);\n     assert.strictEqual(socket.listeners('data').length, 0);\n+    assert.strictEqual(socket.listeners('drain').length, 0);\n \n     // the stream.Duplex onend listener\n     // allow 0 here, so that i can run the same test on streams1 impl"
        }
    ],
    "stats": {
        "total": 4,
        "additions": 3,
        "deletions": 1
    }
}