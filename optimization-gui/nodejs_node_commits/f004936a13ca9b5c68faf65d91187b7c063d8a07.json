{
    "author": "addaleax",
    "message": "src: use RAII cleanup in node_i18n.cc\n\nPR-URL: https://github.com/nodejs/node/pull/23021\nReviewed-By: Colin Ihrig <cjihrig@gmail.com>\nReviewed-By: Gireesh Punathil <gpunathi@in.ibm.com>\nReviewed-By: Gus Caplan <me@gus.host>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ruben Bridgewater <ruben@bridgewater.de>\nReviewed-By: Sakthipriyan Vairamani <thechargingvolcano@gmail.com>",
    "sha": "f004936a13ca9b5c68faf65d91187b7c063d8a07",
    "files": [
        {
            "sha": "e87f8f59550e19d301e1bf0a7d5b9125bb99f16d",
            "filename": "src/node_i18n.cc",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/nodejs/node/blob/f004936a13ca9b5c68faf65d91187b7c063d8a07/src%2Fnode_i18n.cc",
            "raw_url": "https://github.com/nodejs/node/raw/f004936a13ca9b5c68faf65d91187b7c063d8a07/src%2Fnode_i18n.cc",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fnode_i18n.cc?ref=f004936a13ca9b5c68faf65d91187b7c063d8a07",
            "patch": "@@ -215,6 +215,13 @@ class ConverterObject : public BaseObject, Converter {\n       result.AllocateSufficientStorage(limit);\n \n     UBool flush = (flags & CONVERTER_FLAGS_FLUSH) == CONVERTER_FLAGS_FLUSH;\n+    OnScopeLeave cleanup([&]() {\n+      if (flush) {\n+        // Reset the converter state.\n+        converter->bomSeen_ = false;\n+        ucnv_reset(converter->conv);\n+      }\n+    });\n \n     const char* source = input_obj_data;\n     size_t source_length = input_obj_length;\n@@ -238,17 +245,10 @@ class ConverterObject : public BaseObject, Converter {\n         result.SetLength(target - &result[0]);\n       ret = ToBufferEndian(env, &result);\n       args.GetReturnValue().Set(ret.ToLocalChecked());\n-      goto reset;\n+      return;\n     }\n \n     args.GetReturnValue().Set(status);\n-\n-   reset:\n-    if (flush) {\n-      // Reset the converter state\n-      converter->bomSeen_ = false;\n-      ucnv_reset(converter->conv);\n-    }\n   }\n \n   void MemoryInfo(MemoryTracker* tracker) const override {"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 8,
        "deletions": 8
    }
}