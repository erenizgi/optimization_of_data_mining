{
    "author": "brandontruggles",
    "message": "src: removed unnecessary prototypes from Environment::SetProtoMethod\n\nAdded an optional parameter of type v8::ConstructorBehavior to\nEnvironment::NewFunctionTemplate, defaulting to\nv8::ConstructorBehavior::kAllow. Also modified\nEnvironment::SetProtoMethod to pass\nv8::ConstructorBehavior::kThrow to its\ncall to Environment::NewFunctionTemplate.\n\nFixes: https://github.com/nodejs/node/issues/17668\nRefs: https://github.com/nodejs/node/pull/20321\nPR-URL: https://github.com/nodejs/node/pull/20321\nReviewed-By: Anna Henningsen <anna@addaleax.net>\nReviewed-By: Tiancheng \"Timothy\" Gu <timothygu99@gmail.com>\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Ben Noordhuis <info@bnoordhuis.nl>",
    "sha": "64348f5ea557d414b08d1b2602d794e48ac06bb2",
    "files": [
        {
            "sha": "1aa62fc18ded52d091fd3089efff6bc73fd96e05",
            "filename": "src/env-inl.h",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/nodejs/node/blob/64348f5ea557d414b08d1b2602d794e48ac06bb2/src%2Fenv-inl.h",
            "raw_url": "https://github.com/nodejs/node/raw/64348f5ea557d414b08d1b2602d794e48ac06bb2/src%2Fenv-inl.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv-inl.h?ref=64348f5ea557d414b08d1b2602d794e48ac06bb2",
            "patch": "@@ -583,9 +583,11 @@ inline void Environment::ThrowUVException(int errorno,\n \n inline v8::Local<v8::FunctionTemplate>\n     Environment::NewFunctionTemplate(v8::FunctionCallback callback,\n-                                     v8::Local<v8::Signature> signature) {\n+                                     v8::Local<v8::Signature> signature,\n+                                     v8::ConstructorBehavior behavior) {\n   v8::Local<v8::External> external = as_external();\n-  return v8::FunctionTemplate::New(isolate(), callback, external, signature);\n+  return v8::FunctionTemplate::New(isolate(), callback, external,\n+                                   signature, 0, behavior);\n }\n \n inline void Environment::SetMethod(v8::Local<v8::Object> that,\n@@ -605,7 +607,8 @@ inline void Environment::SetProtoMethod(v8::Local<v8::FunctionTemplate> that,\n                                         const char* name,\n                                         v8::FunctionCallback callback) {\n   v8::Local<v8::Signature> signature = v8::Signature::New(isolate(), that);\n-  v8::Local<v8::FunctionTemplate> t = NewFunctionTemplate(callback, signature);\n+  v8::Local<v8::FunctionTemplate> t =\n+      NewFunctionTemplate(callback, signature, v8::ConstructorBehavior::kThrow);\n   // kInternalized strings are created in the old space.\n   const v8::NewStringType type = v8::NewStringType::kInternalized;\n   v8::Local<v8::String> name_string ="
        },
        {
            "sha": "252151028164d291314fa241919df6362dec0f0e",
            "filename": "src/env.h",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/nodejs/node/blob/64348f5ea557d414b08d1b2602d794e48ac06bb2/src%2Fenv.h",
            "raw_url": "https://github.com/nodejs/node/raw/64348f5ea557d414b08d1b2602d794e48ac06bb2/src%2Fenv.h",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/src%2Fenv.h?ref=64348f5ea557d414b08d1b2602d794e48ac06bb2",
            "patch": "@@ -687,7 +687,9 @@ class Environment {\n   inline v8::Local<v8::FunctionTemplate>\n       NewFunctionTemplate(v8::FunctionCallback callback,\n                           v8::Local<v8::Signature> signature =\n-                              v8::Local<v8::Signature>());\n+                              v8::Local<v8::Signature>(),\n+                          v8::ConstructorBehavior behavior =\n+                              v8::ConstructorBehavior::kAllow);\n \n   // Convenience methods for NewFunctionTemplate().\n   inline void SetMethod(v8::Local<v8::Object> that,"
        },
        {
            "sha": "bcc522cd45ad505b29f509879e4fb61e40b1d5d7",
            "filename": "test/parallel/test-env-newprotomethod-remove-unnecessary-prototypes.js",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/nodejs/node/blob/64348f5ea557d414b08d1b2602d794e48ac06bb2/test%2Fparallel%2Ftest-env-newprotomethod-remove-unnecessary-prototypes.js",
            "raw_url": "https://github.com/nodejs/node/raw/64348f5ea557d414b08d1b2602d794e48ac06bb2/test%2Fparallel%2Ftest-env-newprotomethod-remove-unnecessary-prototypes.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fparallel%2Ftest-env-newprotomethod-remove-unnecessary-prototypes.js?ref=64348f5ea557d414b08d1b2602d794e48ac06bb2",
            "patch": "@@ -0,0 +1,18 @@\n+'use strict';\n+require('../common');\n+\n+// This test ensures that unnecessary prototypes are no longer\n+// being generated by Environment::NewFunctionTemplate.\n+\n+const assert = require('assert');\n+\n+[\n+  process.binding('udp_wrap').UDP.prototype.bind6,\n+  process.binding('tcp_wrap').TCP.prototype.bind6,\n+  process.binding('udp_wrap').UDP.prototype.send6,\n+  process.binding('tcp_wrap').TCP.prototype.bind,\n+  process.binding('udp_wrap').UDP.prototype.close,\n+  process.binding('tcp_wrap').TCP.prototype.open\n+].forEach((binding, i) => {\n+  assert.strictEqual('prototype' in binding, false, `Test ${i} failed`);\n+});"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 27,
        "deletions": 4
    }
}