{
    "author": "BridgeAR",
    "message": "assert: fix throws trace\n\nThe current stack trace thrown in case `assert.throws(fn, object)`\nis used did not filter the stack trace. This fixes it.\n\nPR-URL: https://github.com/nodejs/node/pull/18595\nReviewed-By: James M Snell <jasnell@gmail.com>\nReviewed-By: Anatoli Papirovski <apapirovski@mac.com>",
    "sha": "cccddc59e5058008464b359cb1fdceb98597a55a",
    "files": [
        {
            "sha": "67c658d9e68bb334775d0ed10d1356583f4da3b1",
            "filename": "lib/assert.js",
            "status": "modified",
            "additions": 15,
            "deletions": 19,
            "changes": 34,
            "blob_url": "https://github.com/nodejs/node/blob/cccddc59e5058008464b359cb1fdceb98597a55a/lib%2Fassert.js",
            "raw_url": "https://github.com/nodejs/node/raw/cccddc59e5058008464b359cb1fdceb98597a55a/lib%2Fassert.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/lib%2Fassert.js?ref=cccddc59e5058008464b359cb1fdceb98597a55a",
            "patch": "@@ -361,11 +361,17 @@ assert.notStrictEqual = function notStrictEqual(actual, expected, message) {\n   }\n };\n \n-function createMsg(msg, key, actual, expected) {\n-  if (msg)\n-    return msg;\n-  return `${key}: expected ${inspect(expected[key])}, ` +\n-    `not ${inspect(actual[key])}`;\n+function compareExceptionKey(actual, expected, key, msg) {\n+  if (!isDeepStrictEqual(actual[key], expected[key])) {\n+    innerFail({\n+      actual: actual[key],\n+      expected: expected[key],\n+      message: msg || `${key}: expected ${inspect(expected[key])}, ` +\n+                      `not ${inspect(actual[key])}`,\n+      operator: 'throws',\n+      stackStartFn: assert.throws\n+    });\n+  }\n }\n \n function expectedException(actual, expected, msg) {\n@@ -380,23 +386,13 @@ function expectedException(actual, expected, msg) {\n     // The name and message could be non enumerable. Therefore test them\n     // explicitly.\n     if ('name' in expected) {\n-      assert.strictEqual(\n-        actual.name,\n-        expected.name,\n-        createMsg(msg, 'name', actual, expected));\n+      compareExceptionKey(actual, expected, 'name', msg);\n     }\n     if ('message' in expected) {\n-      assert.strictEqual(\n-        actual.message,\n-        expected.message,\n-        createMsg(msg, 'message', actual, expected));\n+      compareExceptionKey(actual, expected, 'message', msg);\n     }\n-    const keys = Object.keys(expected);\n-    for (const key of keys) {\n-      assert.deepStrictEqual(\n-        actual[key],\n-        expected[key],\n-        createMsg(msg, key, actual, expected));\n+    for (const key of Object.keys(expected)) {\n+      compareExceptionKey(actual, expected, key, msg);\n     }\n     return true;\n   }"
        },
        {
            "sha": "36bc5734cae37f43a3fc74be751bf757fb7d3641",
            "filename": "test/message/assert_throws_stack.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/nodejs/node/blob/cccddc59e5058008464b359cb1fdceb98597a55a/test%2Fmessage%2Fassert_throws_stack.js",
            "raw_url": "https://github.com/nodejs/node/raw/cccddc59e5058008464b359cb1fdceb98597a55a/test%2Fmessage%2Fassert_throws_stack.js",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Fassert_throws_stack.js?ref=cccddc59e5058008464b359cb1fdceb98597a55a",
            "patch": "@@ -0,0 +1,6 @@\n+'use strict';\n+\n+require('../common');\n+const assert = require('assert').strict;\n+\n+assert.throws(() => { throw new Error('foo'); }, { bar: true });"
        },
        {
            "sha": "d34bdd2479819006173ac1ee65eb6383a5a3f6cc",
            "filename": "test/message/assert_throws_stack.out",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/nodejs/node/blob/cccddc59e5058008464b359cb1fdceb98597a55a/test%2Fmessage%2Fassert_throws_stack.out",
            "raw_url": "https://github.com/nodejs/node/raw/cccddc59e5058008464b359cb1fdceb98597a55a/test%2Fmessage%2Fassert_throws_stack.out",
            "contents_url": "https://api.github.com/repos/nodejs/node/contents/test%2Fmessage%2Fassert_throws_stack.out?ref=cccddc59e5058008464b359cb1fdceb98597a55a",
            "patch": "@@ -0,0 +1,14 @@\n+assert.js:*\n+  throw new AssertionError(obj);\n+  ^\n+\n+AssertionError [ERR_ASSERTION]: bar: expected true, not undefined\n+    at Object.<anonymous> (*assert_throws_stack.js:*:*)\n+    at *\n+    at *\n+    at *\n+    at *\n+    at *\n+    at *\n+    at *\n+    at *"
        }
    ],
    "stats": {
        "total": 54,
        "additions": 35,
        "deletions": 19
    }
}