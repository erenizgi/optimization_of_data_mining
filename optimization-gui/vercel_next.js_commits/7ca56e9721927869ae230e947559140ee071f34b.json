{
    "author": "mischnic",
    "message": "Turbopack: remove CSS comments when minifying (#77940)\n\nRemove these comments when minification is enabled (= production)\r\n```css\r\n/* [project]/test/integration/css-minify/styles/global.css [client] (css) */\r\n.a{--var-1:-50%;--var-2:-50%}.b{--var-1:0;--var-2:-50%}\r\n```",
    "sha": "7ca56e9721927869ae230e947559140ee071f34b",
    "files": [
        {
            "sha": "1cfd7e0b468c5481d9c0aa412b738816fbdbd388",
            "filename": "test/e2e/app-dir/scss/compilation-and-prefixing/compilation-and-prefixing.test.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 44,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/test%2Fe2e%2Fapp-dir%2Fscss%2Fcompilation-and-prefixing%2Fcompilation-and-prefixing.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/test%2Fe2e%2Fapp-dir%2Fscss%2Fcompilation-and-prefixing%2Fcompilation-and-prefixing.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fscss%2Fcompilation-and-prefixing%2Fcompilation-and-prefixing.test.ts?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -87,53 +87,25 @@ describe.each([\n         if (process.env.IS_TURBOPACK_TEST) {\n           if (dependencies.sass) {\n             expect(sourceMapContentParsed).toMatchInlineSnapshot(`\n-              {\n-                \"sections\": [\n-                  {\n-                    \"map\": {\n-                      \"mappings\": \"AAAA,iCAAiC\",\n-                      \"names\": [],\n-                      \"sources\": [\n-                        \"turbopack:///[project]/styles/global.scss.css\",\n-                      ],\n-                      \"sourcesContent\": [\n-                        \".redText ::placeholder{color:red}.flex-parsing{flex:0 0 calc(50% - var(--vertical-gutter))}\",\n-                      ],\n-                      \"version\": 3,\n-                    },\n-                    \"offset\": {\n-                      \"column\": 0,\n-                      \"line\": 1,\n-                    },\n-                  },\n-                ],\n-                \"version\": 3,\n-              }\n+             {\n+               \"mappings\": \"AAAA,iCAAiC\",\n+               \"names\": [],\n+               \"sourcesContent\": [\n+                 \".redText ::placeholder{color:red}.flex-parsing{flex:0 0 calc(50% - var(--vertical-gutter))}\",\n+               ],\n+               \"version\": 3,\n+             }\n             `)\n           } else {\n             expect(sourceMapContentParsed).toMatchInlineSnapshot(`\n-              {\n-                \"sections\": [\n-                  {\n-                    \"map\": {\n-                      \"mappings\": \"AAAA,iCAAiC\",\n-                      \"names\": [],\n-                      \"sources\": [\n-                        \"turbopack:///[project]/styles/global.scss.css\",\n-                      ],\n-                      \"sourcesContent\": [\n-                        \".redText ::placeholder{color:red}.flex-parsing{flex:0 0 calc(50% - var(--vertical-gutter))}\",\n-                      ],\n-                      \"version\": 3,\n-                    },\n-                    \"offset\": {\n-                      \"column\": 0,\n-                      \"line\": 1,\n-                    },\n-                  },\n-                ],\n-                \"version\": 3,\n-              }\n+             {\n+               \"mappings\": \"AAAA,iCAAiC\",\n+               \"names\": [],\n+               \"sourcesContent\": [\n+                 \".redText ::placeholder{color:red}.flex-parsing{flex:0 0 calc(50% - var(--vertical-gutter))}\",\n+               ],\n+               \"version\": 3,\n+             }\n             `)\n           }\n         } else {"
        },
        {
            "sha": "4086d232b442868ecb2dbf80e0651f51ffceb297",
            "filename": "test/integration/css-minify/test/index.test.js",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/test%2Fintegration%2Fcss-minify%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/test%2Fintegration%2Fcss-minify%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss-minify%2Ftest%2Findex.test.js?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -21,12 +21,9 @@ function runTests() {\n     const href = $('link').attr('href')\n     const css = await renderViaHTTP(appPort, href)\n     if (process.env.IS_TURBOPACK_TEST) {\n-      expect(css).toMatchInlineSnapshot(`\n-       \"/* [project]/test/integration/css-minify/styles/global.css [client] (css) */\n-       .a{--var-1:-50%;--var-2:-50%}.b{--var-1:0;--var-2:-50%}\n-\n-       /*# sourceMappingURL=5c046e82fcc94f24.css.map*/\"\n-      `)\n+      expect(css).toContain(\n+        '.a{--var-1:-50%;--var-2:-50%}.b{--var-1:0;--var-2:-50%}'\n+      )\n     } else {\n       expect(css).toMatchInlineSnapshot(\n         `\".a{--var-1:0;--var-2:0;--var-1:-50%;--var-2:-50%}.b{--var-1:0;--var-2:0;--var-2:-50%}\"`"
        },
        {
            "sha": "6aabce88ce9df38bde9c26870cec3a6b6f5c67ec",
            "filename": "test/integration/css-modules/test/index.test.js",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/test%2Fintegration%2Fcss-modules%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/test%2Fintegration%2Fcss-modules%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss-modules%2Ftest%2Findex.test.js?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -706,12 +706,11 @@ describe('Catch-all Route CSS Module Usage', () => {\n         )\n \n         if (process.env.IS_TURBOPACK_TEST) {\n-          expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim())\n+          expect(cssContent.replace(/\\/\\*.*?\\*\\/\\n?/g, '').trim())\n             .toMatchInlineSnapshot(`\n-            \".index-module___rV4CG__home{background:red}\n+           \".index-module___rV4CG__home{background:red}\n \n-\n-            .\\\\35 5css-module__qe774W__home{color:green}\"\n+           .\\\\35 5css-module__qe774W__home{color:green}\"\n           `)\n         } else {\n           expect("
        },
        {
            "sha": "6fb2a539206cee46520b9cd590c02760c37d25a7",
            "filename": "test/integration/css/test/basic-global-support.test.js",
            "status": "modified",
            "additions": 1,
            "deletions": 19,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/test%2Fintegration%2Fcss%2Ftest%2Fbasic-global-support.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/test%2Fintegration%2Fcss%2Ftest%2Fbasic-global-support.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss%2Ftest%2Fbasic-global-support.test.js?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -308,7 +308,6 @@ module.exports = {\n                \"/_next/static/chunks/HASH.css:\n              .red-text{color:red}\n \n-\n              .blue-text{color:#00f}\",\n              ]\n             `)\n@@ -318,7 +317,6 @@ module.exports = {\n                \"/_next/static/chunks/HASH.css:\n              .red-text{color:red}\n \n-\n              .blue-text{color:#00f}\",\n              ]\n             `)\n@@ -394,13 +392,10 @@ module.exports = {\n                \"/_next/static/chunks/HASH.css:\n              .red-text{color:purple;font-weight:bolder}\n \n-\n              .red-text{color:red}\n \n-\n              .blue-text{color:orange;font-weight:bolder}\n \n-\n              .blue-text{color:#00f}\",\n              ]\n             `)\n@@ -410,13 +405,10 @@ module.exports = {\n                \"/_next/static/chunks/HASH.css:\n              .red-text{color:purple;font-weight:bolder}\n \n-\n              .red-text{color:red}\n \n-\n              .blue-text{color:orange;font-weight:bolder}\n \n-\n              .blue-text{color:#00f}\",\n              ]\n             `)\n@@ -493,7 +485,6 @@ module.exports = {\n                \"/_next/static/chunks/HASH.css:\n              .blue-text{color:#00f}\n \n-\n              .red-text{color:red}\",\n              ]\n             `)\n@@ -503,7 +494,6 @@ module.exports = {\n                \"/_next/static/chunks/HASH.css:\n              .blue-text{color:#00f}\n \n-\n              .red-text{color:red}\",\n              ]\n             `)\n@@ -579,10 +569,8 @@ module.exports = {\n                \"/_next/static/chunks/HASH.css:\n              .red-text{color:red;background-image:url(../media/dark.993bedd3.svg),url(../media/dark2.993bedd3.svg)}\n \n-\n              .blue-text{color:orange;background-image:url(../media/light.180573e4.svg);font-weight:bolder}\n \n-\n              .blue-text{color:#00f}\",\n              ]\n             `)\n@@ -592,10 +580,8 @@ module.exports = {\n                \"/_next/static/chunks/HASH.css:\n              .red-text{color:red;background-image:url(../media/dark.993bedd3.svg),url(../media/dark2.993bedd3.svg)}\n \n-\n              .blue-text{color:orange;background-image:url(../media/light.180573e4.svg);font-weight:bolder}\n \n-\n              .blue-text{color:#00f}\",\n              ]\n             `)\n@@ -656,10 +642,8 @@ describe('CSS URL via `file-loader` and asset prefix (1)', () => {\n              \"/_next/static/chunks/HASH.css:\n            .red-text{color:red;background-image:url(../media/dark.993bedd3.svg) url(../media/dark2.993bedd3.svg)}\n \n-\n            .blue-text{color:orange;background-image:url(../media/light.180573e4.svg);font-weight:bolder}\n \n-\n            .blue-text{color:#00f}\",\n            ]\n           `)\n@@ -712,10 +696,8 @@ describe('CSS URL via `file-loader` and asset prefix (2)', () => {\n              \"/_next/static/chunks/HASH.css:\n            .red-text{color:red;background-image:url(../media/dark.993bedd3.svg) url(../media/dark2.993bedd3.svg)}\n \n-\n            .blue-text{color:orange;background-image:url(../media/light.180573e4.svg);font-weight:bolder}\n \n-\n            .blue-text{color:#00f}\",\n            ]\n           `)\n@@ -745,7 +727,7 @@ async function getStylesheetContents($, appPort, items) {\n       `${href.replace(\n         /[0-9a-f]{8,}/g,\n         'HASH'\n-      )}:\\n${text.replace(/\\/\\*.*?\\*\\//g, '').trim()}`\n+      )}:\\n${text.replace(/\\/\\*.*?\\*\\/\\n?/g, '').trim()}`\n     )\n   }\n   return results"
        },
        {
            "sha": "1aae6c33b67433b125b1765c2b67a995c78a3a20",
            "filename": "test/integration/css/test/css-compilation.test.js",
            "status": "modified",
            "additions": 58,
            "deletions": 88,
            "changes": 146,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/test%2Fintegration%2Fcss%2Ftest%2Fcss-compilation.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/test%2Fintegration%2Fcss%2Ftest%2Fcss-compilation.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss%2Ftest%2Fcss-compilation.test.js?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -74,7 +74,7 @@ module.exports = {\n               ).then((res) => res.text())\n \n               const cssContentWithoutSourceMap = cssContent\n-                .replace(/\\/\\*.*?\\*\\//g, '')\n+                .replace(/\\/\\*.*?\\*\\/\\n?/g, '')\n                 .trim()\n \n               if (process.env.IS_TURBOPACK_TEST && useLightningcss) {\n@@ -118,95 +118,67 @@ module.exports = {\n \n               if (process.env.IS_TURBOPACK_TEST && useLightningcss) {\n                 expect(sourceMapContentParsed).toMatchInlineSnapshot(`\n-                  {\n-                    \"sections\": [\n-                      {\n-                        \"map\": {\n-                          \"mappings\": \"AAAA,4BACE,2BAKF,0DAIA,kDAIA,uCAIA\",\n-                          \"names\": [],\n-                          \"sources\": [\n-                            \"turbopack:///[project]/test/integration/css-fixtures/compilation-and-prefixing/styles/global.css\",\n-                          ],\n-                          \"sourcesContent\": [\n-                            \"@media (480px <= width < 768px) {\n-                    ::placeholder {\n-                      color: green;\n-                    }\n-                  }\n+                 {\n+                   \"mappings\": \"AAAA,4BACE,2BAKF,0DAIA,kDAIA,uCAIA\",\n+                   \"names\": [],\n+                   \"sourcesContent\": [\n+                     \"@media (480px <= width < 768px) {\n+                   ::placeholder {\n+                     color: green;\n+                   }\n+                 }\n \n-                  .flex-parsing {\n-                    flex: 0 0 calc(50% - var(--vertical-gutter));\n-                  }\n+                 .flex-parsing {\n+                   flex: 0 0 calc(50% - var(--vertical-gutter));\n+                 }\n \n-                  .transform-parsing {\n-                    transform: translate3d(0px, 0px);\n-                  }\n+                 .transform-parsing {\n+                   transform: translate3d(0px, 0px);\n+                 }\n \n-                  .css-grid-shorthand {\n-                    grid-column: span 2;\n-                  }\n+                 .css-grid-shorthand {\n+                   grid-column: span 2;\n+                 }\n \n-                  .g-docs-sidenav .filter::-webkit-input-placeholder {\n-                    opacity: 80%;\n-                  }\n-                  \",\n-                          ],\n-                          \"version\": 3,\n-                        },\n-                        \"offset\": {\n-                          \"column\": 0,\n-                          \"line\": 1,\n-                        },\n-                      },\n-                    ],\n-                    \"version\": 3,\n-                  }\n+                 .g-docs-sidenav .filter::-webkit-input-placeholder {\n+                   opacity: 80%;\n+                 }\n+                 \",\n+                   ],\n+                   \"version\": 3,\n+                 }\n                 `)\n               } else if (process.env.IS_TURBOPACK_TEST && !useLightningcss) {\n                 expect(sourceMapContentParsed).toMatchInlineSnapshot(`\n-                  {\n-                    \"sections\": [\n-                      {\n-                        \"map\": {\n-                          \"mappings\": \"AAAA,4BACE,2BAKF,0DAIA,kDAIA,uCAIA\",\n-                          \"names\": [],\n-                          \"sources\": [\n-                            \"turbopack:///[project]/test/integration/css-fixtures/compilation-and-prefixing/styles/global.css\",\n-                          ],\n-                          \"sourcesContent\": [\n-                            \"@media (480px <= width < 768px) {\n-                    ::placeholder {\n-                      color: green;\n-                    }\n-                  }\n+                 {\n+                   \"mappings\": \"AAAA,4BACE,2BAKF,0DAIA,kDAIA,uCAIA\",\n+                   \"names\": [],\n+                   \"sourcesContent\": [\n+                     \"@media (480px <= width < 768px) {\n+                   ::placeholder {\n+                     color: green;\n+                   }\n+                 }\n \n-                  .flex-parsing {\n-                    flex: 0 0 calc(50% - var(--vertical-gutter));\n-                  }\n+                 .flex-parsing {\n+                   flex: 0 0 calc(50% - var(--vertical-gutter));\n+                 }\n \n-                  .transform-parsing {\n-                    transform: translate3d(0px, 0px);\n-                  }\n+                 .transform-parsing {\n+                   transform: translate3d(0px, 0px);\n+                 }\n \n-                  .css-grid-shorthand {\n-                    grid-column: span 2;\n-                  }\n+                 .css-grid-shorthand {\n+                   grid-column: span 2;\n+                 }\n \n-                  .g-docs-sidenav .filter::-webkit-input-placeholder {\n-                    opacity: 80%;\n-                  }\n-                  \",\n-                          ],\n-                          \"version\": 3,\n-                        },\n-                        \"offset\": {\n-                          \"column\": 0,\n-                          \"line\": 1,\n-                        },\n-                      },\n-                    ],\n-                    \"version\": 3,\n-                  }\n+                 .g-docs-sidenav .filter::-webkit-input-placeholder {\n+                   opacity: 80%;\n+                 }\n+                 \",\n+                   ],\n+                   \"version\": 3,\n+                 }\n                 `)\n               } else if (useLightningcss) {\n                 expect(sourceMapContentParsed).toMatchInlineSnapshot(`\n@@ -459,10 +431,10 @@ module.exports = {\n                   res.text()\n                 )\n               )\n-                .replace(/\\/\\*.*?\\*\\//g, '')\n+                .replace(/\\/\\*.*?\\*\\/\\n?/g, '')\n                 .trim()\n \n-              expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()).toMatch(\n+              expect(cssContent.replace(/\\/\\*.*?\\*\\/\\n?/g, '').trim()).toMatch(\n                 /nprogress/\n               )\n             })\n@@ -519,32 +491,30 @@ module.exports = {\n                   res.text()\n                 )\n               )\n-                .replace(/\\/\\*.*?\\*\\//g, '')\n+                .replace(/\\/\\*.*?\\*\\/\\n?/g, '')\n                 .trim()\n \n               if (process.env.IS_TURBOPACK_TEST && useLightningcss) {\n-                expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim())\n+                expect(cssContent.replace(/\\/\\*.*?\\*\\/\\n?/g, '').trim())\n                   .toMatchInlineSnapshot(`\n                  \".other{color:#00f}\n \n-\n                  .test{color:red}\"\n                 `)\n               } else if (process.env.IS_TURBOPACK_TEST && !useLightningcss) {\n-                expect(cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim())\n+                expect(cssContent.replace(/\\/\\*.*?\\*\\/\\n?/g, '').trim())\n                   .toMatchInlineSnapshot(`\n                  \".other{color:#00f}\n \n-\n                  .test{color:red}\"\n                 `)\n               } else if (useLightningcss) {\n                 expect(\n-                  cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n+                  cssContent.replace(/\\/\\*.*?\\*\\/\\n?/g, '').trim()\n                 ).toMatchInlineSnapshot(`\".other{color:#00f}.test{color:red}\"`)\n               } else {\n                 expect(\n-                  cssContent.replace(/\\/\\*.*?\\*\\//g, '').trim()\n+                  cssContent.replace(/\\/\\*.*?\\*\\/\\n?/g, '').trim()\n                 ).toMatchInlineSnapshot(`\".other{color:blue}.test{color:red}\"`)\n               }\n             })"
        },
        {
            "sha": "666922da4c16c2f51138d5d3ad342d1780bf2615",
            "filename": "turbopack/crates/turbopack-browser/src/chunking_context.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -281,7 +281,7 @@ impl BrowserChunkingContext {\n         *self.chunk_suffix_path\n     }\n \n-    /// Returns the minify type.\n+    /// Returns the source map type.\n     pub fn source_maps_type(&self) -> SourceMapsType {\n         self.source_maps_type\n     }\n@@ -510,6 +510,11 @@ impl ChunkingContext for BrowserChunkingContext {\n         Vc::cell(self.enable_tracing)\n     }\n \n+    #[turbo_tasks::function]\n+    pub fn minify_type(&self) -> Vc<MinifyType> {\n+        self.minify_type.cell()\n+    }\n+\n     #[turbo_tasks::function]\n     async fn chunk_group(\n         self: ResolvedVc<Self>,"
        },
        {
            "sha": "b403bd8a1c189fba45c5fd55d61c7b8223440fcc",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking_context.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 14,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -37,20 +37,8 @@ pub enum MangleType {\n     Deterministic,\n }\n \n-#[derive(\n-    Debug,\n-    TaskInput,\n-    Clone,\n-    Copy,\n-    PartialEq,\n-    Eq,\n-    Hash,\n-    Serialize,\n-    Deserialize,\n-    TraceRawVcs,\n-    DeterministicHash,\n-    NonLocalValue,\n-)]\n+#[turbo_tasks::value(shared)]\n+#[derive(Debug, TaskInput, Clone, Copy, Hash, DeterministicHash)]\n pub enum MinifyType {\n     // TODO instead of adding a new property here,\n     // refactor that to Minify(MinifyOptions) to allow defaults on MinifyOptions\n@@ -209,6 +197,10 @@ pub trait ChunkingContext {\n         Vc::cell(false)\n     }\n \n+    fn minify_type(self: Vc<Self>) -> Vc<MinifyType> {\n+        MinifyType::NoMinify.cell()\n+    }\n+\n     fn async_loader_chunk_item(\n         &self,\n         module: Vc<Box<dyn ChunkableModule>>,"
        },
        {
            "sha": "8cb44b3fc83f7c55860ab3c8a14f049983fc8fba",
            "filename": "turbopack/crates/turbopack-css/src/asset.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -337,9 +337,4 @@ impl CssChunkItem for CssModuleChunkItem {\n             .into())\n         }\n     }\n-\n-    #[turbo_tasks::function]\n-    fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *self.chunking_context\n-    }\n }"
        },
        {
            "sha": "9936a95a6e047f5b7242a55041e10864e83aa119",
            "filename": "turbopack/crates/turbopack-css/src/chunk/mod.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 31,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -18,8 +18,8 @@ use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{\n         round_chunk_item_size, AsyncModuleInfo, Chunk, ChunkItem, ChunkItemBatchGroup,\n-        ChunkItemOrBatchWithAsyncModuleInfo, ChunkItemWithAsyncModuleInfo, ChunkType,\n-        ChunkableModule, ChunkingContext, ModuleId, OutputChunk, OutputChunkRuntimeInfo,\n+        ChunkItemExt, ChunkItemOrBatchWithAsyncModuleInfo, ChunkItemWithAsyncModuleInfo, ChunkType,\n+        ChunkableModule, ChunkingContext, MinifyType, OutputChunk, OutputChunkRuntimeInfo,\n     },\n     code_builder::{Code, CodeBuilder},\n     ident::AssetIdent,\n@@ -78,16 +78,21 @@ impl CssChunk {\n         let mut body = CodeBuilder::new(source_maps);\n         let mut external_imports = FxIndexSet::default();\n         for css_item in &this.content.await?.chunk_items {\n-            let id = &*css_item.id().await?;\n-\n             let content = &css_item.content().await?;\n             for import in &content.imports {\n                 if let CssImport::External(external_import) = import {\n                     external_imports.insert((*external_import.await?).to_string());\n                 }\n             }\n \n-            writeln!(body, \"/* {} */\", id)?;\n+            if matches!(\n+                &*this.chunking_context.minify_type().await?,\n+                MinifyType::NoMinify\n+            ) {\n+                let id = &*css_item.id().await?;\n+                writeln!(body, \"/* {} */\", id)?;\n+            }\n+\n             let close = write_import_context(&mut body, content.import_context).await?;\n \n             let source_map = if *self\n@@ -254,7 +259,7 @@ impl OutputChunk for CssChunk {\n         let entries_chunk_items = &content.chunk_items;\n         let included_ids = entries_chunk_items\n             .iter()\n-            .map(|chunk_item| CssChunkItem::id(**chunk_item).to_resolved())\n+            .map(|chunk_item| chunk_item.id().to_resolved())\n             .try_join()\n             .await?;\n         let imports_chunk_items: Vec<_> = entries_chunk_items\n@@ -382,27 +387,6 @@ impl GenerateSourceMap for CssChunk {\n     }\n }\n \n-#[turbo_tasks::value]\n-pub struct CssChunkContext {\n-    chunking_context: ResolvedVc<Box<dyn ChunkingContext>>,\n-}\n-\n-#[turbo_tasks::value_impl]\n-impl CssChunkContext {\n-    #[turbo_tasks::function]\n-    pub fn of(chunking_context: ResolvedVc<Box<dyn ChunkingContext>>) -> Vc<CssChunkContext> {\n-        CssChunkContext { chunking_context }.cell()\n-    }\n-\n-    #[turbo_tasks::function]\n-    pub async fn chunk_item_id(\n-        self: Vc<Self>,\n-        chunk_item: Vc<Box<dyn CssChunkItem>>,\n-    ) -> Result<Vc<ModuleId>> {\n-        Ok(ModuleId::String(chunk_item.asset_ident().to_string().owned().await?).cell())\n-    }\n-}\n-\n // TODO: remove\n #[turbo_tasks::value_trait]\n pub trait CssChunkPlaceable: ChunkableModule + Module + Asset {}\n@@ -430,10 +414,6 @@ pub struct CssChunkItemContent {\n #[turbo_tasks::value_trait]\n pub trait CssChunkItem: ChunkItem {\n     fn content(self: Vc<Self>) -> Vc<CssChunkItemContent>;\n-    fn chunking_context(self: Vc<Self>) -> Vc<Box<dyn ChunkingContext>>;\n-    fn id(self: Vc<Self>) -> Vc<ModuleId> {\n-        CssChunkContext::of(CssChunkItem::chunking_context(self)).chunk_item_id(self)\n-    }\n }\n \n #[turbo_tasks::function]"
        },
        {
            "sha": "c0b47ba5902cc123b8aa9c75f3539145dd56cc36",
            "filename": "turbopack/crates/turbopack-css/src/chunk/single_item_chunk/chunk.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -6,7 +6,7 @@ use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::{rope::RopeBuilder, File, FileSystemPath};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n-    chunk::{Chunk, ChunkItem, ChunkingContext},\n+    chunk::{Chunk, ChunkItem, ChunkItemExt, ChunkingContext, MinifyType},\n     code_builder::{Code, CodeBuilder},\n     ident::AssetIdent,\n     introspect::Introspectable,\n@@ -55,9 +55,13 @@ impl SingleItemCssChunk {\n             .await?;\n         let mut code = CodeBuilder::new(source_maps);\n \n-        let id = &*this.item.id().await?;\n-\n-        writeln!(code, \"/* {} */\", id)?;\n+        if matches!(\n+            &*this.chunking_context.minify_type().await?,\n+            MinifyType::NoMinify\n+        ) {\n+            let id = this.item.id().await?;\n+            writeln!(code, \"/* {} */\", id)?;\n+        }\n         let content = this.item.content().await?;\n         let close = write_import_context(&mut code, content.import_context).await?;\n "
        },
        {
            "sha": "876df2d66d6780908994f1996cca72404da38c23",
            "filename": "turbopack/crates/turbopack-nodejs/src/chunking_context.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/7ca56e9721927869ae230e947559140ee071f34b/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs?ref=7ca56e9721927869ae230e947559140ee071f34b",
            "patch": "@@ -248,6 +248,11 @@ impl ChunkingContext for NodeJsChunkingContext {\n         Vc::cell(self.enable_file_tracing)\n     }\n \n+    #[turbo_tasks::function]\n+    pub fn minify_type(&self) -> Vc<MinifyType> {\n+        self.minify_type.cell()\n+    }\n+\n     #[turbo_tasks::function]\n     async fn asset_url(&self, ident: Vc<FileSystemPath>) -> Result<Vc<RcStr>> {\n         let asset_path = ident.await?.to_string();"
        }
    ],
    "stats": {
        "total": 333,
        "additions": 117,
        "deletions": 216
    }
}