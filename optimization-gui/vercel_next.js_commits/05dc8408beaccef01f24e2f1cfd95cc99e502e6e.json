{
    "author": "unstubbable",
    "message": "Unflake `Undefined default export` test (#79632)\n\n[flakiness\nmetric](https://app.datadoghq.com/ci/test/runs?query=test_level%3Atest%20env%3Aci%20%40git.repository.id%3Agithub.com%2Fvercel%2Fnext.js%20%40test.service%3Anextjs%20%40test.status%3Afail%20%40test.name%3A%22Undefined%20default%20export%20should%20error%20when%20page%20component%20export%20is%20not%20valid%22%20%40git.branch%3Acanary&agg_m=count&agg_m_source=base&agg_t=count&currentTab=overview&eventStack=&fromUser=false&index=citest&start=1746962081472&end=1748258081472&paused=false)\n\nThe test's flakiness started to increase significantly on 5/21.\n\n<img width=\"414\" alt=\"Screenshot 2025-05-26 at 13 18 29\"\nsrc=\"https://github.com/user-attachments/assets/3996cbd1-4a54-412d-9578-317f967030fd\"\n/>\n\nUsing\n[these](https://github.com/vercel/next.js/actions/runs/15249566684/job/42888664439?pr=79565)\n[two](https://github.com/vercel/next.js/actions/runs/15251316578/job/42888825737?pr=79629)\ntest runs as examples, we can see that the `/_error` page takes quite a\nlong time to compile, which then leads to a timeout while waiting for\nthe `#__next` element on the error page to be present in the DOM.\n\nLooking at the [canary release from this\nday](https://github.com/vercel/next.js/releases/tag/v15.4.0-canary.45),\nit might be related to #79260.\n\nIn fact, running the test before and after this PR uncovers a\nsignificant increase in dev compilation times for the `/_error` page,\nwhich is a pages router page.\n\n<img width=\"230\" alt=\"Screenshot 2025-05-26 at 13 27 23\"\nsrc=\"https://github.com/user-attachments/assets/00381ab1-3a75-4306-b184-8a14b906d1ff\"\n/>\n\nWe'll address this regression in a follow-up.",
    "sha": "05dc8408beaccef01f24e2f1cfd95cc99e502e6e",
    "files": [
        {
            "sha": "5b8b273fbb88e8b90a206fc0b4c83b1f05eaded2",
            "filename": "test/development/acceptance-app/undefined-default-export.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/05dc8408beaccef01f24e2f1cfd95cc99e502e6e/test%2Fdevelopment%2Facceptance-app%2Fundefined-default-export.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/05dc8408beaccef01f24e2f1cfd95cc99e502e6e/test%2Fdevelopment%2Facceptance-app%2Fundefined-default-export.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fundefined-default-export.test.ts?ref=05dc8408beaccef01f24e2f1cfd95cc99e502e6e",
            "patch": "@@ -1,11 +1,11 @@\n import path from 'path'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n import { createSandbox } from 'development-sandbox'\n+import { retry } from 'next-test-utils'\n \n describe('Undefined default export', () => {\n   const { next } = nextTestSetup({\n     files: new FileRef(path.join(__dirname, 'fixtures', 'default-template')),\n-    patchFileDelay: 250,\n   })\n \n   it('should error if page component does not have default export', async () => {\n@@ -85,12 +85,17 @@ describe('Undefined default export', () => {\n   it('should error when page component export is not valid', async () => {\n     await using sandbox = await createSandbox(next, undefined, '/')\n     const { browser } = sandbox\n+    const cliOutputLength = next.cliOutput.length\n \n     await next.patchFile('app/page.js', 'const a = 123')\n \n     // The page will fail build and navigate to /_error route of pages router.\n-    // Wait for the DOM node #__next to be present\n-    await browser.waitForElementByCss('#__next')\n+    // We wait for the error page to be compiled before asserting the redbox.\n+    await retry(async () => {\n+      expect(next.cliOutput.slice(cliOutputLength)).toContain(\n+        'âœ“ Compiled /_error'\n+      )\n+    }, 10_000)\n \n     await expect(browser).toDisplayRedbox(`\n      {"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 8,
        "deletions": 3
    }
}