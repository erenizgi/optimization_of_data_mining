{
    "author": "ztanner",
    "message": "[ci]: fix build-output-prerender to support segment cache env (#84467)\n\nThese tests were only failing with segment cache because I added an env variable to test `clientSegmentCache` independently. This updates the snapshots.",
    "sha": "b28eb8e075a5436bd85e612d996332ecec062a86",
    "files": [
        {
            "sha": "7bc2c7f4b5ce72e2c8cf62b9be792a20b16581ac",
            "filename": "test/client-segment-cache-tests-manifest.json",
            "status": "modified",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/b28eb8e075a5436bd85e612d996332ecec062a86/test%2Fclient-segment-cache-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/b28eb8e075a5436bd85e612d996332ecec062a86/test%2Fclient-segment-cache-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fclient-segment-cache-tests-manifest.json?ref=b28eb8e075a5436bd85e612d996332ecec062a86",
            "patch": "@@ -86,14 +86,6 @@\n       \"failed\": [\n         \"app dir - form prefetching should prefetch a loading state for the form's target\"\n       ]\n-    },\n-    \"test/production/app-dir/build-output-prerender/build-output-prerender.test.ts\": {\n-      \"failed\": [\n-        \"build-output-prerender with a next config file with --debug-prerender prints a warning and the customized experimental flags\",\n-        \"build-output-prerender with a next config file without --debug-prerender prints only the user-selected experimental flags (and the ones enabled via env variable)\",\n-        \"build-output-prerender without a next config file with --debug-prerender prints a warning and the customized experimental flags\",\n-        \"build-output-prerender without a next config file without --debug-prerender prints no experimental flags (unless enabled via env variable)\"\n-      ]\n     }\n   },\n   \"rules\": {"
        },
        {
            "sha": "3b5b28347a2afc8be8940f2ff749d513774eb663",
            "filename": "test/production/app-dir/build-output-prerender/build-output-prerender.test.ts",
            "status": "modified",
            "additions": 93,
            "deletions": 0,
            "changes": 93,
            "blob_url": "https://github.com/vercel/next.js/blob/b28eb8e075a5436bd85e612d996332ecec062a86/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b28eb8e075a5436bd85e612d996332ecec062a86/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts?ref=b28eb8e075a5436bd85e612d996332ecec062a86",
            "patch": "@@ -7,6 +7,9 @@ const cacheComponentsEnabled =\n \n const pprEnabled = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n \n+const clientSegmentCacheEnabled =\n+  process.env.__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE === 'true'\n+\n const isRspack = !!process.env.NEXT_RSPACK\n \n describe('build-output-prerender', () => {\n@@ -68,6 +71,28 @@ describe('build-output-prerender', () => {\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n             `)\n           }\n+        } else if (clientSegmentCacheEnabled) {\n+          if (isTurbopack) {\n+            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n+             \"▲ Next.js x.y.z (Turbopack)\n+                - Experiments (use with caution):\n+                  ✓ cacheComponents\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n+                  ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n+            `)\n+          } else {\n+            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n+             \"▲ Next.js x.y.z (webpack)\n+                - Experiments (use with caution):\n+                  ✓ cacheComponents\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n+                  ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n+            `)\n+          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -206,6 +231,36 @@ describe('build-output-prerender', () => {\n                   ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n             `)\n           }\n+        } else if (clientSegmentCacheEnabled) {\n+          if (isTurbopack) {\n+            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n+             \"⚠ Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n+                ▲ Next.js x.y.z (Turbopack)\n+                - Experiments (use with caution):\n+                  ✓ cacheComponents\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n+                  ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n+                  ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n+                  ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n+                  ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\n+                  ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\n+                  ⨯ turbopackMinify (disabled by \\`--debug-prerender\\`)\"\n+            `)\n+          } else {\n+            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n+             \"⚠ Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n+                ▲ Next.js x.y.z (webpack)\n+                - Experiments (use with caution):\n+                  ✓ cacheComponents\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n+                  ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n+                  ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n+                  ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n+                  ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\n+                  ⨯ serverMinification (disabled by \\`--debug-prerender\\`)\n+                  ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n+            `)\n+          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -335,6 +390,20 @@ describe('build-output-prerender', () => {\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n             `)\n           }\n+        } else if (clientSegmentCacheEnabled) {\n+          if (isTurbopack) {\n+            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n+             \"▲ Next.js x.y.z (Turbopack)\n+                - Experiments (use with caution):\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\"\n+            `)\n+          } else {\n+            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n+             \"▲ Next.js x.y.z (webpack)\n+                - Experiments (use with caution):\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\"\n+            `)\n+          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(\n@@ -425,6 +494,30 @@ describe('build-output-prerender', () => {\n                   ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n             `)\n           }\n+        } else if (clientSegmentCacheEnabled) {\n+          if (isTurbopack) {\n+            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n+             \"⚠ Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n+                ▲ Next.js x.y.z (Turbopack)\n+                - Experiments (use with caution):\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n+                  ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n+                  ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n+                  ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\n+                  ⨯ turbopackMinify (disabled by \\`--debug-prerender\\`)\"\n+            `)\n+          } else {\n+            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n+             \"⚠ Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n+                ▲ Next.js x.y.z (webpack)\n+                - Experiments (use with caution):\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n+                  ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n+                  ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n+                  ⨯ serverMinification (disabled by \\`--debug-prerender\\`)\n+                  ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n+            `)\n+          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`"
        }
    ],
    "stats": {
        "total": 101,
        "additions": 93,
        "deletions": 8
    }
}