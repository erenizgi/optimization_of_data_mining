{
    "author": "sokra",
    "message": "[Turbopack] fix hanging and flaky issues (#76032)\n\n### What?\n\n* fix active counting when balancing edges\n* release lock correctly to avoid a deadlock",
    "sha": "f9fcae172cc0f75f2c1969250e8f8144950cc2aa",
    "files": [
        {
            "sha": "361ba806544e2878286f537b65199925c8fd16d9",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/f9fcae172cc0f75f2c1969250e8f8144950cc2aa/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f9fcae172cc0f75f2c1969250e8f8144950cc2aa/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs?ref=f9fcae172cc0f75f2c1969250e8f8144950cc2aa",
            "patch": "@@ -1414,6 +1414,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n             task.add_new(CachedDataItem::InProgress {\n                 value: InProgressState::Scheduled { done_event },\n             });\n+            drop(task);\n \n             // All `new_children` are currently hold active with an active count and we need to undo\n             // that. (We already filtered out the old children from that list)"
        },
        {
            "sha": "83d3a0214c79b55e0d09747a07961e26765e882f",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/operation/aggregation_update.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f9fcae172cc0f75f2c1969250e8f8144950cc2aa/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Faggregation_update.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f9fcae172cc0f75f2c1969250e8f8144950cc2aa/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Faggregation_update.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Faggregation_update.rs?ref=f9fcae172cc0f75f2c1969250e8f8144950cc2aa",
            "patch": "@@ -1114,7 +1114,7 @@ impl AggregationUpdateQueue {\n                         if ctx.should_track_activeness() {\n                             // update active count\n                             let has_active_count =\n-                                get!(task, Activeness).is_some_and(|a| a.active_counter > 0);\n+                                get!(upper, Activeness).is_some_and(|a| a.active_counter > 0);\n                             if has_active_count {\n                                 self.push(AggregationUpdateJob::IncreaseActiveCount {\n                                     task: task_id,"
        }
    ],
    "stats": {
        "total": 3,
        "additions": 2,
        "deletions": 1
    }
}