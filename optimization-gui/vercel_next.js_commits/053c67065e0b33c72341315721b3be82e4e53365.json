{
    "author": "mischnic",
    "message": "Turbopack: get rid of some manual self.await-s (#88236)\n\nRefactoring/cleanup, no behavioral changes",
    "sha": "053c67065e0b33c72341315721b3be82e4e53365",
    "files": [
        {
            "sha": "481e319702af7e563174f4044dc6ff49c1301363",
            "filename": "turbopack/crates/turbo-tasks-env/src/dotenv.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fdotenv.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fdotenv.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fdotenv.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -32,11 +32,10 @@ impl DotenvProcessEnv {\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn read_all_with_prior(self: Vc<Self>, prior: Vc<EnvMap>) -> Result<Vc<EnvMap>> {\n-        let this = self.await?;\n+    pub async fn read_all_with_prior(&self, prior: Vc<EnvMap>) -> Result<Vc<EnvMap>> {\n         let prior = prior.await?;\n \n-        let file = this.path.read().await?;\n+        let file = self.path.read().await?;\n         if let FileContent::Content(f) = &*file {\n             let res;\n             let vars;\n@@ -62,7 +61,7 @@ impl DotenvProcessEnv {\n             if let Err(e) = res {\n                 return Err(e).context(anyhow!(\n                     \"unable to read {} for env vars\",\n-                    this.path.value_to_string().await?\n+                    self.path.value_to_string().await?\n                 ));\n             }\n "
        },
        {
            "sha": "6070913782376675d4731aea517a9aaab387252f",
            "filename": "turbopack/crates/turbo-tasks-fetch/src/response.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Fsrc%2Fresponse.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Fsrc%2Fresponse.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Fsrc%2Fresponse.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -21,8 +21,7 @@ pub struct HttpResponseBody(pub Vec<u8>);\n #[turbo_tasks::value_impl]\n impl HttpResponseBody {\n     #[turbo_tasks::function]\n-    pub async fn to_string(self: Vc<Self>) -> Result<Vc<RcStr>> {\n-        let this = &*self.await?;\n-        Ok(Vc::cell(std::str::from_utf8(&this.0)?.into()))\n+    pub fn to_string(&self) -> Result<Vc<RcStr>> {\n+        Ok(Vc::cell(std::str::from_utf8(&self.0)?.into()))\n     }\n }"
        },
        {
            "sha": "2968506d29174d1d08993d86b9a5c94c134838be",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -2296,21 +2296,18 @@ impl FileContent {\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn parse_json_with_comments(self: Vc<Self>) -> Result<Vc<FileJsonContent>> {\n-        let this = self.await?;\n-        Ok(this.parse_json_with_comments_ref().cell())\n+    pub fn parse_json_with_comments(&self) -> Vc<FileJsonContent> {\n+        self.parse_json_with_comments_ref().cell()\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn parse_json5(self: Vc<Self>) -> Result<Vc<FileJsonContent>> {\n-        let this = self.await?;\n-        Ok(this.parse_json5_ref().cell())\n+    pub fn parse_json5(&self) -> Vc<FileJsonContent> {\n+        self.parse_json5_ref().cell()\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn lines(self: Vc<Self>) -> Result<Vc<FileLinesContent>> {\n-        let this = self.await?;\n-        Ok(this.lines_ref().cell())\n+    pub fn lines(&self) -> Vc<FileLinesContent> {\n+        self.lines_ref().cell()\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "99b8688bfe290f80b612d8c11dd77622ef933019",
            "filename": "turbopack/crates/turbopack-browser/src/chunking_context.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -875,10 +875,10 @@ impl ChunkingContext for BrowserChunkingContext {\n \n     #[turbo_tasks::function]\n     async fn module_export_usage(\n-        self: Vc<Self>,\n+        &self,\n         module: ResolvedVc<Box<dyn Module>>,\n     ) -> Result<Vc<ModuleExportUsage>> {\n-        if let Some(export_usage) = self.await?.export_usage {\n+        if let Some(export_usage) = self.export_usage {\n             Ok(export_usage.await?.used_exports(module).await?)\n         } else {\n             Ok(ModuleExportUsage::all())\n@@ -887,10 +887,10 @@ impl ChunkingContext for BrowserChunkingContext {\n \n     #[turbo_tasks::function]\n     async fn is_reference_unused(\n-        self: Vc<Self>,\n+        &self,\n         reference: ResolvedVc<Box<dyn ModuleReference>>,\n     ) -> Result<Vc<bool>> {\n-        if let Some(unused_references) = self.await?.unused_references {\n+        if let Some(unused_references) = self.unused_references {\n             Ok(Vc::cell(\n                 unused_references.await?.is_reference_unused(&reference),\n             ))"
        },
        {
            "sha": "af86d3bb138aabdb7f5c4e6d5e5de277c1e23e70",
            "filename": "turbopack/crates/turbopack-core/src/asset.rs",
            "status": "modified",
            "additions": 26,
            "deletions": 34,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fasset.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -40,60 +40,52 @@ impl AssetContent {\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn parse_json(self: Vc<Self>) -> Result<Vc<FileJsonContent>> {\n-        let this = self.await?;\n-        match &*this {\n-            AssetContent::File(content) => Ok(content.parse_json()),\n-            AssetContent::Redirect { .. } => Ok(FileJsonContent::unparsable(rcstr!(\n-                \"a redirect can't be parsed as json\"\n-            ))\n-            .cell()),\n+    pub fn parse_json(&self) -> Vc<FileJsonContent> {\n+        match self {\n+            AssetContent::File(content) => content.parse_json(),\n+            AssetContent::Redirect { .. } => {\n+                FileJsonContent::unparsable(rcstr!(\"a redirect can't be parsed as json\")).cell()\n+            }\n         }\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn file_content(self: Vc<Self>) -> Result<Vc<FileContent>> {\n-        let this = self.await?;\n-        match &*this {\n-            AssetContent::File(content) => Ok(**content),\n-            AssetContent::Redirect { .. } => Ok(FileContent::NotFound.cell()),\n+    pub fn file_content(&self) -> Vc<FileContent> {\n+        match self {\n+            AssetContent::File(content) => **content,\n+            AssetContent::Redirect { .. } => FileContent::NotFound.cell(),\n         }\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn lines(self: Vc<Self>) -> Result<Vc<FileLinesContent>> {\n-        let this = self.await?;\n-        match &*this {\n-            AssetContent::File(content) => Ok(content.lines()),\n-            AssetContent::Redirect { .. } => Ok(FileLinesContent::Unparsable.cell()),\n+    pub fn lines(&self) -> Vc<FileLinesContent> {\n+        match self {\n+            AssetContent::File(content) => content.lines(),\n+            AssetContent::Redirect { .. } => FileLinesContent::Unparsable.cell(),\n         }\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn len(self: Vc<Self>) -> Result<Vc<Option<u64>>> {\n-        let this = self.await?;\n-        match &*this {\n-            AssetContent::File(content) => Ok(content.len()),\n-            AssetContent::Redirect { .. } => Ok(Vc::cell(None)),\n+    pub fn len(&self) -> Vc<Option<u64>> {\n+        match self {\n+            AssetContent::File(content) => content.len(),\n+            AssetContent::Redirect { .. } => Vc::cell(None),\n         }\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn parse_json_with_comments(self: Vc<Self>) -> Result<Vc<FileJsonContent>> {\n-        let this = self.await?;\n-        match &*this {\n-            AssetContent::File(content) => Ok(content.parse_json_with_comments()),\n-            AssetContent::Redirect { .. } => Ok(FileJsonContent::unparsable(rcstr!(\n-                \"a redirect can't be parsed as json\"\n-            ))\n-            .cell()),\n+    pub fn parse_json_with_comments(&self) -> Vc<FileJsonContent> {\n+        match self {\n+            AssetContent::File(content) => content.parse_json_with_comments(),\n+            AssetContent::Redirect { .. } => {\n+                FileJsonContent::unparsable(rcstr!(\"a redirect can't be parsed as json\")).cell()\n+            }\n         }\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn write(self: Vc<Self>, path: FileSystemPath) -> Result<()> {\n-        let this = self.await?;\n-        match &*this {\n+    pub async fn write(&self, path: FileSystemPath) -> Result<()> {\n+        match self {\n             AssetContent::File(file) => {\n                 path.write(**file).as_side_effect().await?;\n             }"
        },
        {
            "sha": "045789cc5f10d9dc05bb5979ef6d378a0806159d",
            "filename": "turbopack/crates/turbopack-core/src/reference_type.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 9,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference_type.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference_type.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference_type.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -119,16 +119,14 @@ impl ImportContext {\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn add_attributes(\n-        self: Vc<Self>,\n+    pub fn add_attributes(\n+        &self,\n         attr_layer: Option<RcStr>,\n         attr_media: Option<RcStr>,\n         attr_supports: Option<RcStr>,\n-    ) -> Result<Vc<Self>> {\n-        let this = &*self.await?;\n-\n+    ) -> Vc<Self> {\n         let layers = {\n-            let mut layers = this.layers.clone();\n+            let mut layers = self.layers.clone();\n             if let Some(attr_layer) = attr_layer\n                 && !layers.contains(&attr_layer)\n             {\n@@ -138,7 +136,7 @@ impl ImportContext {\n         };\n \n         let media = {\n-            let mut media = this.media.clone();\n+            let mut media = self.media.clone();\n             if let Some(attr_media) = attr_media\n                 && !media.contains(&attr_media)\n             {\n@@ -148,7 +146,7 @@ impl ImportContext {\n         };\n \n         let supports = {\n-            let mut supports = this.supports.clone();\n+            let mut supports = self.supports.clone();\n             if let Some(attr_supports) = attr_supports\n                 && !supports.contains(&attr_supports)\n             {\n@@ -157,7 +155,7 @@ impl ImportContext {\n             supports\n         };\n \n-        Ok(ImportContext::new(layers, media, supports))\n+        ImportContext::new(layers, media, supports)\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "8c6ec8849fc52dce8c201ee58abd9e641ebfb141",
            "filename": "turbopack/crates/turbopack-css/src/chunk/single_item_chunk/chunk.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -187,13 +187,12 @@ impl Introspectable for SingleItemCssChunk {\n     }\n \n     #[turbo_tasks::function]\n-    async fn details(self: Vc<Self>) -> Result<Vc<RcStr>> {\n-        let this = self.await?;\n+    async fn details(&self) -> Result<Vc<RcStr>> {\n         let mut details = String::new();\n         write!(\n             details,\n             \"Chunk item: {}\",\n-            this.item.asset_ident().to_string().await?\n+            self.item.asset_ident().to_string().await?\n         )?;\n         Ok(Vc::cell(details.into()))\n     }"
        },
        {
            "sha": "43ba82e94a025b383183491e18d15a2fad997f80",
            "filename": "turbopack/crates/turbopack-css/src/references/import.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fimport.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fimport.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fimport.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -155,16 +155,15 @@ impl ValueToString for ImportAssetReference {\n impl CodeGenerateable for ImportAssetReference {\n     #[turbo_tasks::function]\n     async fn code_generation(\n-        self: Vc<Self>,\n+        &self,\n         _context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<Vc<CodeGeneration>> {\n-        let this = &*self.await?;\n         let mut imports = vec![];\n         if let Request::Uri {\n             protocol,\n             remainder,\n             ..\n-        } = &*this.request.await?\n+        } = &*self.request.await?\n         {\n             imports.push(CssImport::External(ResolvedVc::cell(\n                 format!(\"{protocol}{remainder}\").into(),"
        },
        {
            "sha": "24732968d97ef121a9b733e655db99b0d446f12f",
            "filename": "turbopack/crates/turbopack-dev-server/src/source/route_tree.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Froute_tree.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Froute_tree.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Froute_tree.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -51,8 +51,8 @@ pub struct RouteTrees(Vec<ResolvedVc<RouteTree>>);\n impl RouteTrees {\n     /// Merges the list of RouteTrees into one RouteTree.\n     #[turbo_tasks::function]\n-    pub async fn merge(self: Vc<Self>) -> Result<Vc<RouteTree>> {\n-        let trees = &*self.await?;\n+    pub async fn merge(&self) -> Result<Vc<RouteTree>> {\n+        let trees = &self.0;\n         if trees.is_empty() {\n             return Ok(RouteTree::default().cell());\n         }"
        },
        {
            "sha": "490c77b6a5761db24f2c59da72d58265c1d6f87c",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -206,11 +206,10 @@ impl Introspectable for EcmascriptChunk {\n     }\n \n     #[turbo_tasks::function]\n-    async fn details(self: Vc<Self>) -> Result<Vc<RcStr>> {\n+    async fn details(&self) -> Result<Vc<RcStr>> {\n         let mut details = String::new();\n-        let this = self.await?;\n         details += \"Chunk items:\\n\\n\";\n-        for chunk_item in this.content.included_chunk_items().await? {\n+        for chunk_item in self.content.included_chunk_items().await? {\n             writeln!(details, \"- {}\", chunk_item.asset_ident().to_string().await?)?;\n         }\n         Ok(Vc::cell(details.into()))"
        },
        {
            "sha": "74c6d409a0f3d43d5479f1346a0eada96d628564",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -500,17 +500,16 @@ impl ModuleTypeResult {\n #[turbo_tasks::value_impl]\n impl EcmascriptParsable for EcmascriptModuleAsset {\n     #[turbo_tasks::function]\n-    async fn failsafe_parse(self: Vc<Self>) -> Result<Vc<ParseResult>> {\n-        let this = self.await?;\n-        let real_result = this.parse().await?;\n-        if this.options.await?.keep_last_successful_parse {\n+    async fn failsafe_parse(&self) -> Result<Vc<ParseResult>> {\n+        let real_result = self.parse().await?;\n+        if self.options.await?.keep_last_successful_parse {\n             let real_result_value = real_result.await?;\n             let result_value = if matches!(*real_result_value, ParseResult::Ok { .. }) {\n-                this.last_successful_parse\n+                self.last_successful_parse\n                     .set_unconditionally(real_result_value.clone());\n                 real_result_value\n             } else {\n-                let state_ref = this.last_successful_parse.get();\n+                let state_ref = self.last_successful_parse.get();\n                 state_ref.as_ref().unwrap_or(&real_result_value).clone()\n             };\n             Ok(ReadRef::cell(result_value))"
        },
        {
            "sha": "761188e1d582216e3f12e571e29b170b093bb069",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/async_module.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fasync_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fasync_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fasync_module.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -66,15 +66,15 @@ impl OptionAsyncModule {\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn module_options(\n-        self: Vc<Self>,\n+    pub fn module_options(\n+        &self,\n         async_module_info: Option<Vc<AsyncModuleInfo>>,\n-    ) -> Result<Vc<OptionAsyncModuleOptions>> {\n-        if let Some(async_module) = &*self.await? {\n-            return Ok(async_module.module_options(async_module_info));\n+    ) -> Vc<OptionAsyncModuleOptions> {\n+        if let Some(async_module) = &self.0 {\n+            return async_module.module_options(async_module_info);\n         }\n \n-        Ok(OptionAsyncModuleOptions::none())\n+        OptionAsyncModuleOptions::none()\n     }\n }\n "
        },
        {
            "sha": "557bef18c02545c1acbe2b965edf705b7c138e01",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/facade/module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -158,8 +158,8 @@ impl Module for EcmascriptModuleFacadeModule {\n     }\n \n     #[turbo_tasks::function]\n-    async fn references(self: Vc<Self>) -> Result<Vc<ModuleReferences>> {\n-        let (part_references, esm_references) = self.await?.specific_references().await?;\n+    async fn references(&self) -> Result<Vc<ModuleReferences>> {\n+        let (part_references, esm_references) = self.specific_references().await?;\n         let references = part_references\n             .iter()\n             .map(|r| ResolvedVc::upcast(*r))"
        },
        {
            "sha": "7b3e2b928e9a4af60964c1f8f4dedab8780a17b7",
            "filename": "turbopack/crates/turbopack-node/src/transforms/webpack.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -216,16 +216,15 @@ async fn webpack_loaders_executor(\n #[turbo_tasks::value_impl]\n impl WebpackLoadersProcessedAsset {\n     #[turbo_tasks::function]\n-    async fn process(self: Vc<Self>) -> Result<Vc<ProcessWebpackLoadersResult>> {\n-        let this = self.await?;\n-        let transform = this.transform.await?;\n+    async fn process(&self) -> Result<Vc<ProcessWebpackLoadersResult>> {\n+        let transform = self.transform.await?;\n \n         let ExecutionContext {\n             project_path,\n             chunking_context,\n             env,\n         } = &*transform.execution_context.await?;\n-        let source_content = this.source.content();\n+        let source_content = self.source.content();\n         let AssetContent::File(file) = *source_content.await? else {\n             bail!(\"Webpack Loaders transform only support transforming files\");\n         };\n@@ -262,7 +261,7 @@ impl WebpackLoadersProcessedAsset {\n             .to_resolved()\n             .await?;\n \n-        let resource_fs_path = this.source.ident().path().await?;\n+        let resource_fs_path = self.source.ident().path().await?;\n         let Some(resource_path) = project_path.get_relative_path_to(&resource_fs_path) else {\n             bail!(format!(\n                 \"Resource path \\\"{}\\\" need to be on project filesystem \\\"{}\\\"\",\n@@ -274,15 +273,15 @@ impl WebpackLoadersProcessedAsset {\n             entries,\n             cwd: project_path.clone(),\n             env: *env,\n-            context_source_for_issue: this.source,\n+            context_source_for_issue: self.source,\n             chunking_context: *chunking_context,\n             module_graph,\n             resolve_options_context: Some(transform.resolve_options_context),\n             args: vec![\n                 ResolvedVc::cell(content),\n                 // We need to pass the query string to the loader\n                 ResolvedVc::cell(resource_path.to_string().into()),\n-                ResolvedVc::cell(this.source.ident().await?.query.to_string().into()),\n+                ResolvedVc::cell(self.source.ident().await?.query.to_string().into()),\n                 ResolvedVc::cell(json!(*loaders)),\n                 ResolvedVc::cell(transform.source_maps.into()),\n             ],"
        },
        {
            "sha": "5590626d9f1272623f976d1903e62e8cb5629de1",
            "filename": "turbopack/crates/turbopack-nodejs/src/chunking_context.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -622,10 +622,10 @@ impl ChunkingContext for NodeJsChunkingContext {\n \n     #[turbo_tasks::function]\n     async fn module_export_usage(\n-        self: Vc<Self>,\n+        &self,\n         module: ResolvedVc<Box<dyn Module>>,\n     ) -> Result<Vc<ModuleExportUsage>> {\n-        if let Some(export_usage) = self.await?.export_usage {\n+        if let Some(export_usage) = self.export_usage {\n             Ok(export_usage.await?.used_exports(module).await?)\n         } else {\n             Ok(ModuleExportUsage::all())\n@@ -634,10 +634,10 @@ impl ChunkingContext for NodeJsChunkingContext {\n \n     #[turbo_tasks::function]\n     async fn is_reference_unused(\n-        self: Vc<Self>,\n+        &self,\n         reference: ResolvedVc<Box<dyn ModuleReference>>,\n     ) -> Result<Vc<bool>> {\n-        if let Some(unused_references) = self.await?.unused_references {\n+        if let Some(unused_references) = self.unused_references {\n             Ok(Vc::cell(\n                 unused_references.await?.is_reference_unused(&reference),\n             ))"
        },
        {
            "sha": "db21a292213eb60fd1aec47ff0a5970f8daee80e",
            "filename": "turbopack/crates/turbopack-nodejs/src/ecmascript/node/content.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fcontent.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fcontent.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fcontent.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -44,19 +44,18 @@ impl EcmascriptBuildNodeChunkContent {\n #[turbo_tasks::value_impl]\n impl EcmascriptBuildNodeChunkContent {\n     #[turbo_tasks::function]\n-    async fn code(self: Vc<Self>) -> Result<Vc<Code>> {\n+    async fn code(&self) -> Result<Vc<Code>> {\n         use std::io::Write;\n-        let this = self.await?;\n-        let source_maps = *this\n+        let source_maps = *self\n             .chunking_context\n-            .reference_chunk_source_maps(*ResolvedVc::upcast(this.chunk))\n+            .reference_chunk_source_maps(*ResolvedVc::upcast(self.chunk))\n             .await?;\n \n-        let mut code = CodeBuilder::new(true, *this.chunking_context.debug_ids_enabled().await?);\n+        let mut code = CodeBuilder::new(true, *self.chunking_context.debug_ids_enabled().await?);\n \n         write!(code, \"module.exports = [\")?;\n \n-        let content = this.content.await?;\n+        let content = self.content.await?;\n         let chunk_items = content.chunk_item_code_and_ids().await?;\n         for item in chunk_items {\n             for (id, item_code) in item {\n@@ -70,7 +69,7 @@ impl EcmascriptBuildNodeChunkContent {\n \n         let mut code = code.build();\n \n-        if let MinifyType::Minify { mangle } = *this.chunking_context.minify_type().await? {\n+        if let MinifyType::Minify { mangle } = *self.chunking_context.minify_type().await? {\n             code = minify(code, source_maps, mangle)?;\n         }\n "
        },
        {
            "sha": "db923935d765879c6566b2bce53344530bb96c8f",
            "filename": "turbopack/crates/turbopack-wasm/src/module_asset.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/053c67065e0b33c72341315721b3be82e4e53365/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs?ref=053c67065e0b33c72341315721b3be82e4e53365",
            "patch": "@@ -61,20 +61,19 @@ impl WebAssemblyModuleAsset {\n     }\n \n     #[turbo_tasks::function]\n-    async fn loader_as_module(self: Vc<Self>) -> Result<Vc<Box<dyn Module>>> {\n-        let this = self.await?;\n-        let query = &this.source.ident().await?.query;\n+    async fn loader_as_module(&self) -> Result<Vc<Box<dyn Module>>> {\n+        let query = &self.source.ident().await?.query;\n \n         let loader_source = if query == \"?module\" {\n-            compiling_loader_source(*this.source)\n+            compiling_loader_source(*self.source)\n         } else {\n-            instantiating_loader_source(*this.source)\n+            instantiating_loader_source(*self.source)\n         };\n \n-        let module = this.asset_context.process(\n+        let module = self.asset_context.process(\n             loader_source,\n             ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n-                rcstr!(\"WASM_PATH\") => ResolvedVc::upcast(RawWebAssemblyModuleAsset::new(*this.source, *this.asset_context).to_resolved().await?),\n+                rcstr!(\"WASM_PATH\") => ResolvedVc::upcast(RawWebAssemblyModuleAsset::new(*self.source, *self.asset_context).to_resolved().await?),\n             })),\n         ).module();\n "
        }
    ],
    "stats": {
        "total": 204,
        "additions": 91,
        "deletions": 113
    }
}