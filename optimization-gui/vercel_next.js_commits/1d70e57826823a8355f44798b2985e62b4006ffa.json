{
    "author": "lukesandberg",
    "message": "[turbopack] Remove uses of `Value<..>` instead make the payloads impl Taskinput\n (#80142)\n\nRemove uses of `Value<..>` instead make the payloads impl Taskinput\n\n### Why?\nThe Value<> type is confusing and error prone, lets destroy it!\n\nAs discussed over slack, turbo_tasks::Value type always implements is_resolved as true and is_transient as false which is incorrect and can enable smuggling transient vcs into turbo tasks.\n\n• https://vercel.slack.com/archives/C03EWR7LGEN/p1743456121241529\n• https://vercel.slack.com/archives/C04NGV98TPS/p1743455453764879",
    "sha": "1d70e57826823a8355f44798b2985e62b4006ffa",
    "files": [
        {
            "sha": "5230f0f00c65fb1a6fd1484112847714bf2ef895",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/evaluate/chunk.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -228,7 +228,7 @@ impl EcmascriptBrowserEvaluateChunk {\n                 .await?,\n         );\n \n-        Ok(AssetIdent::new(Value::new(ident)))\n+        Ok(AssetIdent::new(ident))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "16679dd7fcd02087951d1d0949df5085bab7e3c9",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/list/asset.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fasset.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -87,7 +87,7 @@ impl OutputAsset for EcmascriptDevChunkList {\n         // ident, because it must remain stable whenever a chunk is added or\n         // removed from the list.\n \n-        let ident = AssetIdent::new(Value::new(ident));\n+        let ident = AssetIdent::new(ident);\n         Ok(this\n             .chunking_context\n             .chunk_path(Some(Vc::upcast(self)), ident, rcstr!(\".js\")))"
        },
        {
            "sha": "add08eb1936217c91acb28528c4e91fa975c95b0",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking_context.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -109,7 +109,17 @@ pub struct EntryChunkGroupResult {\n }\n \n #[derive(\n-    Default, Debug, Clone, PartialEq, Eq, Hash, Serialize, Deserialize, TraceRawVcs, NonLocalValue,\n+    Default,\n+    Debug,\n+    Clone,\n+    PartialEq,\n+    Eq,\n+    Hash,\n+    Serialize,\n+    Deserialize,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    TaskInput,\n )]\n pub struct ChunkingConfig {\n     /// Try to avoid creating more than 1 chunk smaller than this size."
        },
        {
            "sha": "3758bdc56f24cb2a22f6b9d2267eec90a5328353",
            "filename": "turbopack/crates/turbopack-core/src/ident.rs",
            "status": "modified",
            "additions": 16,
            "deletions": 16,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fident.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fident.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fident.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -4,14 +4,14 @@ use anyhow::Result;\n use once_cell::sync::Lazy;\n use regex::Regex;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, TaskInput, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbo_tasks_hash::{DeterministicHash, Xxh3Hash64Hasher, encode_hex, hash_xxh3_hash64};\n \n use crate::resolve::ModulePart;\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Clone, Debug, Hash)]\n+#[turbo_tasks::value]\n+#[derive(Clone, Debug, Hash, TaskInput)]\n pub struct AssetIdent {\n     /// The primary path of the asset\n     pub path: ResolvedVc<FileSystemPath>,\n@@ -119,7 +119,7 @@ impl ValueToString for AssetIdent {\n #[turbo_tasks::value_impl]\n impl AssetIdent {\n     #[turbo_tasks::function]\n-    pub async fn new(ident: Value<AssetIdent>) -> Result<Vc<Self>> {\n+    pub fn new(ident: AssetIdent) -> Vc<Self> {\n         debug_assert!(\n             ident.query.is_empty() || ident.query.starts_with(\"?\"),\n             \"query should be empty or start with a `?`\"\n@@ -128,13 +128,13 @@ impl AssetIdent {\n             ident.fragment.is_empty() || ident.fragment.starts_with(\"#\"),\n             \"query should be empty or start with a `?`\"\n         );\n-        Ok(ident.into_value().cell())\n+        ident.cell()\n     }\n \n     /// Creates an [AssetIdent] from a [Vc<FileSystemPath>]\n     #[turbo_tasks::function]\n     pub fn from_path(path: ResolvedVc<FileSystemPath>) -> Vc<Self> {\n-        Self::new(Value::new(AssetIdent {\n+        Self::new(AssetIdent {\n             path,\n             query: RcStr::default(),\n             fragment: RcStr::default(),\n@@ -143,71 +143,71 @@ impl AssetIdent {\n             parts: Vec::new(),\n             layer: None,\n             content_type: None,\n-        }))\n+        })\n     }\n \n     #[turbo_tasks::function]\n     pub fn with_query(&self, query: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n         this.query = query;\n-        Self::new(Value::new(this))\n+        Self::new(this)\n     }\n \n     #[turbo_tasks::function]\n     pub fn with_fragment(&self, fragment: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n         this.fragment = fragment;\n-        Self::new(Value::new(this))\n+        Self::new(this)\n     }\n \n     #[turbo_tasks::function]\n     pub fn with_modifier(&self, modifier: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n         this.add_modifier(modifier);\n-        Self::new(Value::new(this))\n+        Self::new(this)\n     }\n \n     #[turbo_tasks::function]\n     pub fn with_part(&self, part: ModulePart) -> Vc<Self> {\n         let mut this = self.clone();\n         this.parts.push(part);\n-        Self::new(Value::new(this))\n+        Self::new(this)\n     }\n \n     #[turbo_tasks::function]\n     pub fn with_path(&self, path: ResolvedVc<FileSystemPath>) -> Vc<Self> {\n         let mut this = self.clone();\n         this.path = path;\n-        Self::new(Value::new(this))\n+        Self::new(this)\n     }\n \n     #[turbo_tasks::function]\n     pub fn with_layer(&self, layer: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n         debug_assert!(!layer.is_empty(), \"cannot set empty layers names\");\n         this.layer = Some(layer);\n-        Self::new(Value::new(this))\n+        Self::new(this)\n     }\n \n     #[turbo_tasks::function]\n     pub fn with_content_type(&self, content_type: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n         this.content_type = Some(content_type);\n-        Self::new(Value::new(this))\n+        Self::new(this)\n     }\n \n     #[turbo_tasks::function]\n     pub fn with_asset(&self, key: RcStr, asset: ResolvedVc<AssetIdent>) -> Vc<Self> {\n         let mut this = self.clone();\n         this.add_asset(key, asset);\n-        Self::new(Value::new(this))\n+        Self::new(this)\n     }\n \n     #[turbo_tasks::function]\n     pub async fn rename_as(&self, pattern: RcStr) -> Result<Vc<Self>> {\n         let mut this = self.clone();\n         this.rename_as_ref(&pattern).await?;\n-        Ok(Self::new(Value::new(this)))\n+        Ok(Self::new(this))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "9038df7a1104850db1914c7e0da249b344460c83",
            "filename": "turbopack/crates/turbopack-core/src/resolve/mod.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 10,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -13,7 +13,7 @@ use tracing::{Instrument, Level};\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     FxIndexMap, FxIndexSet, NonLocalValue, ReadRef, ResolvedVc, SliceMap, TaskInput,\n-    TryJoinIterExt, Value, ValueToString, Vc, trace::TraceRawVcs,\n+    TryJoinIterExt, ValueToString, Vc, trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{\n     FileSystemEntryType, FileSystemPath, RealPathResult, util::normalize_request,\n@@ -482,8 +482,8 @@ pub enum ResolveResultItem {\n /// A primary factor is the actual request string, but there are\n /// other factors like exports conditions that can affect resolting and become\n /// part of the key (assuming the condition is unknown at compile time)\n-#[derive(Clone, Debug, Default, Hash)]\n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n+#[derive(Clone, Debug, Default, Hash, TaskInput)]\n+#[turbo_tasks::value]\n pub struct RequestKey {\n     pub request: Option<RcStr>,\n     pub conditions: BTreeMap<String, bool>,\n@@ -1016,9 +1016,8 @@ impl ResolveResult {\n     pub fn with_replaced_request_key(\n         &self,\n         old_request_key: RcStr,\n-        request_key: Value<RequestKey>,\n+        request_key: RequestKey,\n     ) -> Result<Vc<Self>> {\n-        let request_key = request_key.into_value();\n         let new_primary = self\n             .primary\n             .iter()\n@@ -1323,13 +1322,13 @@ pub async fn find_context_file(\n pub async fn find_context_file_or_package_key(\n     lookup_path: Vc<FileSystemPath>,\n     names: Vc<Vec<RcStr>>,\n-    package_key: Value<RcStr>,\n+    package_key: RcStr,\n ) -> Result<Vc<FindContextFileResult>> {\n     let mut refs = Vec::new();\n     let package_json_path = lookup_path.join(rcstr!(\"package.json\"));\n     if let Some(package_json_path) = exists(package_json_path, &mut refs).await?\n         && let Some(json) = &*read_package_json(*package_json_path).await?\n-        && json.get(&**package_key).is_some()\n+        && json.get(&*package_key).is_some()\n     {\n         return Ok(FindContextFileResult::Found(package_json_path, refs).into());\n     }\n@@ -2440,7 +2439,7 @@ async fn apply_in_package(\n                         .with_fragment(fragment.clone()),\n                     options,\n                 )\n-                .with_replaced_request_key(value.into(), Value::new(request_key))\n+                .with_replaced_request_key(value.into(), request_key)\n                 .with_affecting_sources(refs.into_iter().map(|src| *src).collect()),\n             ));\n         }\n@@ -2597,7 +2596,7 @@ async fn resolve_module_request(\n \n     let module_result =\n         merge_results_with_affecting_sources(results, result.affecting_sources.clone())\n-            .with_replaced_request_key(rcstr!(\".\"), Value::new(RequestKey::new(module.into())));\n+            .with_replaced_request_key(rcstr!(\".\"), RequestKey::new(module.into()));\n \n     if options_value.prefer_relative {\n         let module_prefix: RcStr = format!(\"./{module}\").into();\n@@ -2612,7 +2611,7 @@ async fn resolve_module_request(\n         let relative_result =\n             Box::pin(resolve_internal_inline(lookup_path, *relative, options)).await?;\n         let relative_result = relative_result\n-            .with_replaced_request_key(module_prefix, Value::new(RequestKey::new(module.into())));\n+            .with_replaced_request_key(module_prefix, RequestKey::new(module.into()));\n \n         Ok(merge_results(vec![relative_result, module_result]))\n     } else {"
        },
        {
            "sha": "876e0d98e34a325aa9f6fd301e080baf3ce21ea8",
            "filename": "turbopack/crates/turbopack-css/src/chunk/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -7,8 +7,7 @@ use anyhow::{Result, bail};\n use swc_core::common::pass::Either;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    FxIndexSet, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Value, ValueDefault, ValueToString,\n-    Vc,\n+    FxIndexSet, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, ValueDefault, ValueToString, Vc,\n };\n use turbo_tasks_fs::{\n     File, FileSystem, FileSystemPath,\n@@ -201,7 +200,7 @@ impl CssChunk {\n             content_type: None,\n         };\n \n-        Ok(AssetIdent::new(Value::new(ident)))\n+        Ok(AssetIdent::new(ident))\n     }\n }\n "
        },
        {
            "sha": "ccd7d3a415a2cdc06a96148a7f9eaf69f753d2c0",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/src/runtime_type.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fruntime_type.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fruntime_type.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fruntime_type.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -1,8 +1,18 @@\n use serde::{Deserialize, Serialize};\n-use turbo_tasks::{NonLocalValue, trace::TraceRawVcs};\n+use turbo_tasks::{NonLocalValue, TaskInput, trace::TraceRawVcs};\n \n #[derive(\n-    Serialize, Deserialize, Debug, Clone, Copy, Hash, PartialEq, Eq, TraceRawVcs, NonLocalValue,\n+    Serialize,\n+    Deserialize,\n+    Debug,\n+    Clone,\n+    Copy,\n+    Hash,\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    TaskInput,\n )]\n pub enum RuntimeType {\n     Development,"
        },
        {
            "sha": "3c1ced331496e822417c70be7bddbeffd79952f9",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -10,7 +10,7 @@ use std::fmt::Write;\n \n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, ValueToString, Vc};\n use turbo_tasks_fs::FileSystem;\n use turbopack_core::{\n     chunk::{Chunk, ChunkItem, ChunkItems, ChunkingContext, ModuleIds},\n@@ -120,7 +120,7 @@ impl Chunk for EcmascriptChunk {\n             content_type: None,\n         };\n \n-        Ok(AssetIdent::new(Value::new(ident)))\n+        Ok(AssetIdent::new(ident))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "1990beaa85af7fe3bbb55c987104a4317155a799",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -613,7 +613,7 @@ impl Module for EcmascriptModuleAsset {\n         }\n         ident.add_modifier(rcstr!(\"ecmascript\"));\n         ident.layer = Some(self.asset_context.layer().owned().await?);\n-        Ok(AssetIdent::new(Value::new(ident)))\n+        Ok(AssetIdent::new(ident))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "33a4a97c56a0a61c447419bef45d039002de7604",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/facade/module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -146,10 +146,8 @@ impl EcmascriptModuleFacadeModule {\n #[turbo_tasks::value_impl]\n impl Module for EcmascriptModuleFacadeModule {\n     #[turbo_tasks::function]\n-    async fn ident(&self) -> Result<Vc<AssetIdent>> {\n-        let inner = self.module.ident();\n-\n-        Ok(inner.with_part(self.ty.clone()))\n+    fn ident(&self) -> Vc<AssetIdent> {\n+        self.module.ident().with_part(self.ty.clone())\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "f7d1c358b86c59137994c5c1700119374d02c09d",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/locals/module.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fmodule.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -44,9 +44,7 @@ impl EcmascriptModuleLocalsModule {\n impl Module for EcmascriptModuleLocalsModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        let inner = self.module.ident();\n-\n-        inner.with_part(ModulePart::locals())\n+        self.module.ident().with_part(ModulePart::locals())\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "106b9510196087e0bbd8501c89ba2d8699023448",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/side_effect_module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fside_effect_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fside_effect_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fside_effect_module.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc};\n use turbo_tasks_fs::glob::Glob;\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -70,7 +70,7 @@ impl Module for SideEffectsModule {\n             );\n         }\n \n-        Ok(AssetIdent::new(Value::new(ident)))\n+        Ok(AssetIdent::new(ident))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "efa82d790c82966e43221ee2713b6ff640f62916",
            "filename": "turbopack/crates/turbopack-node/src/transforms/postcss.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 8,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -3,7 +3,7 @@ use indoc::formatdoc;\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    Completion, Completions, NonLocalValue, ResolvedVc, TaskInput, TryFlatJoinIterExt, Value, Vc,\n+    Completion, Completions, NonLocalValue, ResolvedVc, TaskInput, TryFlatJoinIterExt, Vc,\n     fxindexmap, trace::TraceRawVcs,\n };\n use turbo_tasks_bytes::stream::SingleValue;\n@@ -420,12 +420,9 @@ async fn find_config_in_location(\n     location: PostCssConfigLocation,\n     source: Vc<Box<dyn Source>>,\n ) -> Result<Option<Vc<FileSystemPath>>> {\n-    if let FindContextFileResult::Found(config_path, _) = *find_context_file_or_package_key(\n-        project_path,\n-        postcss_configs(),\n-        Value::new(rcstr!(\"postcss\")),\n-    )\n-    .await?\n+    if let FindContextFileResult::Found(config_path, _) =\n+        *find_context_file_or_package_key(project_path, postcss_configs(), rcstr!(\"postcss\"))\n+            .await?\n     {\n         return Ok(Some(*config_path));\n     }\n@@ -434,7 +431,7 @@ async fn find_config_in_location(\n         && let FindContextFileResult::Found(config_path, _) = *find_context_file_or_package_key(\n             source.ident().path().parent(),\n             postcss_configs(),\n-            Value::new(rcstr!(\"postcss\")),\n+            rcstr!(\"postcss\"),\n         )\n         .await?\n     {"
        },
        {
            "sha": "2834c6c7ccd958a5e2a9f62e5871351c0393dd36",
            "filename": "turbopack/crates/turbopack-nodejs/src/chunking_context.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1d70e57826823a8355f44798b2985e62b4006ffa/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs?ref=1d70e57826823a8355f44798b2985e62b4006ffa",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::{Context, Result, bail};\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Upcast, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, TaskInput, TryJoinIterExt, Upcast, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     asset::Asset,\n@@ -91,13 +91,13 @@ impl NodeJsChunkingContextBuilder {\n \n     /// Builds the chunking context.\n     pub fn build(self) -> Vc<NodeJsChunkingContext> {\n-        NodeJsChunkingContext::new(Value::new(self.chunking_context))\n+        NodeJsChunkingContext::new(self.chunking_context)\n     }\n }\n \n /// A chunking context for build mode.\n #[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Clone, Hash)]\n+#[derive(Debug, Clone, Hash, TaskInput)]\n pub struct NodeJsChunkingContext {\n     /// The root path of the project\n     root_path: ResolvedVc<FileSystemPath>,\n@@ -192,8 +192,8 @@ impl NodeJsChunkingContext {\n #[turbo_tasks::value_impl]\n impl NodeJsChunkingContext {\n     #[turbo_tasks::function]\n-    fn new(this: Value<NodeJsChunkingContext>) -> Vc<Self> {\n-        this.into_value().cell()\n+    fn new(this: NodeJsChunkingContext) -> Vc<Self> {\n+        this.cell()\n     }\n \n     #[turbo_tasks::function]"
        }
    ],
    "stats": {
        "total": 129,
        "additions": 70,
        "deletions": 59
    }
}