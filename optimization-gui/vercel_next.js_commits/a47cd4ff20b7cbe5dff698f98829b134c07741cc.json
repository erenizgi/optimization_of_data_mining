{
    "author": "huozhi",
    "message": "[devtool] handle click outscope child element (#81296)\n\nImprove the DX of close by clicking outside of the of the UI, if it's children it also shouldn't close it.\r\nSince devtool is under the shadow dom, we need to attach the listeners onto `ownerDocument` rather than the `document` itself\r\n\r\n### Diff\r\n\r\n| After | Before |\r\n|:--|:--|\r\n| <video src=\"https://github.com/user-attachments/assets/617d79f8-f093-4c17-9588-633331a416bc\"> | <video src=\"https://github.com/user-attachments/assets/94626f7e-6f2f-450a-aa73-f9cb5548820d\"> |\r\n\r\n<!-- https://github.com/user-attachments/assets/617d79f8-f093-4c17-9588-633331a416bc -->\r\n<!-- https://github.com/user-attachments/assets/94626f7e-6f2f-450a-aa73-f9cb5548820d -->",
    "sha": "a47cd4ff20b7cbe5dff698f98829b134c07741cc",
    "files": [
        {
            "sha": "0dceb4a1cfa35c2920a9a478b14676ab2891d8a1",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/utils.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/a47cd4ff20b7cbe5dff698f98829b134c07741cc/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a47cd4ff20b7cbe5dff698f98829b134c07741cc/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Futils.ts?ref=a47cd4ff20b7cbe5dff698f98829b134c07741cc",
            "patch": "@@ -91,7 +91,14 @@ export function useClickOutside(\n       return\n     }\n \n+    const ownerDocument = rootRef.current?.ownerDocument\n+\n     function handleClickOutside(event: MouseEvent) {\n+      const target = event.target as HTMLElement\n+      if (rootRef.current && rootRef.current.contains(target)) {\n+        return\n+      }\n+\n       if (\n         !(rootRef.current?.getBoundingClientRect()\n           ? event.clientX >= rootRef.current.getBoundingClientRect()!.left &&\n@@ -117,12 +124,12 @@ export function useClickOutside(\n       }\n     }\n \n-    document.addEventListener('mousedown', handleClickOutside)\n-    document.addEventListener('keydown', handleKeyDown)\n+    ownerDocument?.addEventListener('mousedown', handleClickOutside)\n+    ownerDocument?.addEventListener('keydown', handleKeyDown)\n \n     return () => {\n-      document.removeEventListener('mousedown', handleClickOutside)\n-      document.removeEventListener('keydown', handleKeyDown)\n+      ownerDocument?.removeEventListener('mousedown', handleClickOutside)\n+      ownerDocument?.removeEventListener('keydown', handleKeyDown)\n     }\n     // eslint-disable-next-line react-hooks/exhaustive-deps\n   }, [active])"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 11,
        "deletions": 4
    }
}