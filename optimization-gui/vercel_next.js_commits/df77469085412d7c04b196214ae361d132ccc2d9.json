{
    "author": "eps1lon",
    "message": "[test] Use new Redbox matchers in server-navigation-error (#76787)",
    "sha": "df77469085412d7c04b196214ae361d132ccc2d9",
    "files": [
        {
            "sha": "8da4d901a76ff6b97f8d0fad90b770fa931a3883",
            "filename": "test/development/app-dir/server-navigation-error/server-navigation-error.test.ts",
            "status": "modified",
            "additions": 109,
            "deletions": 99,
            "changes": 208,
            "blob_url": "https://github.com/vercel/next.js/blob/df77469085412d7c04b196214ae361d132ccc2d9/test%2Fdevelopment%2Fapp-dir%2Fserver-navigation-error%2Fserver-navigation-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/df77469085412d7c04b196214ae361d132ccc2d9/test%2Fdevelopment%2Fapp-dir%2Fserver-navigation-error%2Fserver-navigation-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fserver-navigation-error%2Fserver-navigation-error.test.ts?ref=df77469085412d7c04b196214ae361d132ccc2d9",
            "patch": "@@ -1,9 +1,4 @@\n import { nextTestSetup } from 'e2e-utils'\n-import {\n-  assertHasRedbox,\n-  getRedboxDescription,\n-  getRedboxSource,\n-} from 'next-test-utils'\n \n describe('server-navigation-error', () => {\n   const { isTurbopack, next } = nextTestSetup({\n@@ -13,64 +8,74 @@ describe('server-navigation-error', () => {\n   describe('pages router', () => {\n     it('should error on navigation API redirect', async () => {\n       const browser = await next.browser('/pages/redirect')\n-      await assertHasRedbox(browser)\n-      expect(await getRedboxDescription(browser)).toMatch(\n-        `Next.js navigation API is not allowed to be used in Pages Router.`\n-      )\n-      const source = await getRedboxSource(browser)\n-      if (isTurbopack) {\n-        expect(source).toMatchInlineSnapshot(`\n-          \"pages/pages/redirect.tsx (4:10) @ Page\n \n-            2 |\n-            3 | export default function Page() {\n-          > 4 |   redirect('/')\n-              |          ^\n-            5 | }\n-            6 |\"\n+      // TODO(veil): investigate the column number is off by 1 between turbo and webpack\n+      if (isTurbopack) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: Next.js navigation API is not allowed to be used in Pages Router.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"pages/pages/redirect.tsx (4:10) @ Page\n+         > 4 |   redirect('/')\n+             |          ^\",\n+           \"stack\": [\n+             \"Page pages/pages/redirect.tsx (4:10)\",\n+           ],\n+         }\n         `)\n       } else {\n-        expect(source).toMatchInlineSnapshot(`\n-          \"pages/pages/redirect.tsx (4:11) @ Page\n-\n-            2 |\n-            3 | export default function Page() {\n-          > 4 |   redirect('/')\n-              |           ^\n-            5 | }\n-            6 |\"\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: Next.js navigation API is not allowed to be used in Pages Router.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"pages/pages/redirect.tsx (4:11) @ Page\n+         > 4 |   redirect('/')\n+             |           ^\",\n+           \"stack\": [\n+             \"Page pages/pages/redirect.tsx (4:11)\",\n+           ],\n+         }\n         `)\n       }\n     })\n \n     it('should error on navigation API notFound', async () => {\n       const browser = await next.browser('/pages/not-found')\n-      await assertHasRedbox(browser)\n-      expect(await getRedboxDescription(browser)).toMatch(\n-        `Next.js navigation API is not allowed to be used in Pages Router.`\n-      )\n-      const source = await getRedboxSource(browser)\n-      if (isTurbopack) {\n-        expect(source).toMatchInlineSnapshot(`\n-          \"pages/pages/not-found.tsx (4:10) @ Page\n \n-            2 |\n-            3 | export default function Page() {\n-          > 4 |   notFound()\n-              |          ^\n-            5 | }\n-            6 |\"\n+      // TODO(veil): investigate the column number is off by 1 between turbo and webpack\n+      if (isTurbopack) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: Next.js navigation API is not allowed to be used in Pages Router.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"pages/pages/not-found.tsx (4:10) @ Page\n+         > 4 |   notFound()\n+             |          ^\",\n+           \"stack\": [\n+             \"Page pages/pages/not-found.tsx (4:10)\",\n+           ],\n+         }\n         `)\n       } else {\n-        expect(source).toMatchInlineSnapshot(`\n-         \"pages/pages/not-found.tsx (4:11) @ Page\n-\n-           2 |\n-           3 | export default function Page() {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: Next.js navigation API is not allowed to be used in Pages Router.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"pages/pages/not-found.tsx (4:11) @ Page\n          > 4 |   notFound()\n-             |           ^\n-           5 | }\n-           6 |\"\n+             |           ^\",\n+           \"stack\": [\n+             \"Page pages/pages/not-found.tsx (4:11)\",\n+           ],\n+         }\n         `)\n       }\n     })\n@@ -81,69 +86,74 @@ describe('server-navigation-error', () => {\n       const browser = await next.browser('/middleware/redirect')\n       // FIXME: the first request to middleware error load didn't show the redbox, need one more reload\n       await browser.refresh()\n-      await assertHasRedbox(browser)\n-      expect(await getRedboxDescription(browser)).toMatch(\n-        `Next.js navigation API is not allowed to be used in Middleware.`\n-      )\n-      const source = await getRedboxSource(browser)\n-      if (isTurbopack) {\n-        expect(source).toMatchInlineSnapshot(`\n-          \"middleware.ts (8:12) @ middleware\n \n-             6 |     notFound()\n-             7 |   } else if (req.nextUrl.pathname === '/middleware/redirect') {\n-          >  8 |     redirect('/')\n-               |            ^\n-             9 |   }\n-            10 | }\n-            11 |\"\n+      // TODO(veil): investigate the column number is off by 1 between turbo and webpack\n+      if (isTurbopack) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: Next.js navigation API is not allowed to be used in Middleware.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"middleware.ts (8:12) @ middleware\n+         >  8 |     redirect('/')\n+              |            ^\",\n+           \"stack\": [\n+             \"middleware middleware.ts (8:12)\",\n+           ],\n+         }\n         `)\n       } else {\n-        expect(source).toMatchInlineSnapshot(`\n-          \"middleware.ts (8:13) @ middleware\n-\n-             6 |     notFound()\n-             7 |   } else if (req.nextUrl.pathname === '/middleware/redirect') {\n-          >  8 |     redirect('/')\n-               |             ^\n-             9 |   }\n-            10 | }\n-            11 |\"\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: Next.js navigation API is not allowed to be used in Middleware.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"middleware.ts (8:13) @ middleware\n+         >  8 |     redirect('/')\n+              |             ^\",\n+           \"stack\": [\n+             \"middleware middleware.ts (8:13)\",\n+           ],\n+         }\n         `)\n       }\n     })\n \n     it('should error on navigation API not-found', async () => {\n       const browser = await next.browser('/middleware/not-found')\n-      await assertHasRedbox(browser)\n-      expect(await getRedboxDescription(browser)).toMatch(\n-        `Next.js navigation API is not allowed to be used in Middleware.`\n-      )\n-      const source = await getRedboxSource(browser)\n \n+      // TODO(veil): investigate the column number is off by 1 between turbo and webpack\n       if (isTurbopack) {\n-        expect(source).toMatchInlineSnapshot(`\n-          \"middleware.ts (6:12) @ middleware\n-\n-            4 | export default function middleware(req: NextRequest) {\n-            5 |   if (req.nextUrl.pathname === '/middleware/not-found') {\n-          > 6 |     notFound()\n-              |            ^\n-            7 |   } else if (req.nextUrl.pathname === '/middleware/redirect') {\n-            8 |     redirect('/')\n-            9 |   }\"\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: Next.js navigation API is not allowed to be used in Middleware.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"middleware.ts (6:12) @ middleware\n+         > 6 |     notFound()\n+             |            ^\",\n+           \"stack\": [\n+             \"middleware middleware.ts (6:12)\",\n+           ],\n+         }\n         `)\n       } else {\n-        expect(source).toMatchInlineSnapshot(`\n-         \"middleware.ts (6:13) @ middleware\n-\n-           4 | export default function middleware(req: NextRequest) {\n-           5 |   if (req.nextUrl.pathname === '/middleware/not-found') {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: Next.js navigation API is not allowed to be used in Middleware.\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"middleware.ts (6:13) @ middleware\n          > 6 |     notFound()\n-             |             ^\n-           7 |   } else if (req.nextUrl.pathname === '/middleware/redirect') {\n-           8 |     redirect('/')\n-           9 |   }\"\n+             |             ^\",\n+           \"stack\": [\n+             \"middleware middleware.ts (6:13)\",\n+           ],\n+         }\n         `)\n       }\n     })"
        }
    ],
    "stats": {
        "total": 208,
        "additions": 109,
        "deletions": 99
    }
}