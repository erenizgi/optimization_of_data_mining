{
    "author": "timneutkens",
    "message": "Development: Don't load Babel when it's not used (#83619)\n\n## What?\n\nCurrently Babel always gets loaded in order to check for a babel config.\nThis event is no longer that useful to track so removing it in favor of\nperformance.",
    "sha": "a20bcfbb46de47405fc3fd587901d244cb2b0779",
    "files": [
        {
            "sha": "fab1bccb6e6c572654746d05644a78b1bb280b49",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a20bcfbb46de47405fc3fd587901d244cb2b0779/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a20bcfbb46de47405fc3fd587901d244cb2b0779/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=a20bcfbb46de47405fc3fd587901d244cb2b0779",
            "patch": "@@ -1051,7 +1051,7 @@ export default async function build(\n       const hasPublicDir = existsSync(publicDir)\n \n       telemetry.record(\n-        eventCliSession(dir, config, {\n+        eventCliSession(config, {\n           webpackVersion: 5,\n           cliCommand: 'build',\n           isSrcDir,"
        },
        {
            "sha": "d3a2b5aaec025d2a7481ce480dbe7d21eba263f9",
            "filename": "packages/next/src/export/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a20bcfbb46de47405fc3fd587901d244cb2b0779/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a20bcfbb46de47405fc3fd587901d244cb2b0779/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts?ref=a20bcfbb46de47405fc3fd587901d244cb2b0779",
            "patch": "@@ -100,7 +100,7 @@ async function exportAppImpl(\n \n   if (telemetry) {\n     telemetry.record(\n-      eventCliSession(distDir, nextConfig, {\n+      eventCliSession(nextConfig, {\n         webpackVersion: null,\n         cliCommand: 'export',\n         isSrcDir: null,"
        },
        {
            "sha": "b8b9cf61c334d523e2d3ec1c3fbbe4abb7ebdd76",
            "filename": "packages/next/src/server/lib/router-utils/setup-dev-bundler.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 14,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/a20bcfbb46de47405fc3fd587901d244cb2b0779/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a20bcfbb46de47405fc3fd587901d244cb2b0779/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts?ref=a20bcfbb46de47405fc3fd587901d244cb2b0779",
            "patch": "@@ -1193,20 +1193,16 @@ export async function setupDevBundler(opts: SetupOpts) {\n   })\n \n   opts.telemetry.record(\n-    eventCliSession(\n-      path.join(opts.dir, opts.nextConfig.distDir),\n-      opts.nextConfig,\n-      {\n-        webpackVersion: 5,\n-        isSrcDir,\n-        turboFlag: !!opts.turbo,\n-        cliCommand: 'dev',\n-        appDir: !!opts.appDir,\n-        pagesDir: !!opts.pagesDir,\n-        isCustomServer: !!opts.isCustomServer,\n-        hasNowJson: !!(await findUp('now.json', { cwd: opts.dir })),\n-      }\n-    )\n+    eventCliSession(opts.nextConfig, {\n+      webpackVersion: 5,\n+      isSrcDir,\n+      turboFlag: !!opts.turbo,\n+      cliCommand: 'dev',\n+      appDir: !!opts.appDir,\n+      pagesDir: !!opts.pagesDir,\n+      isCustomServer: !!opts.isCustomServer,\n+      hasNowJson: !!(await findUp('now.json', { cwd: opts.dir })),\n+    })\n   )\n \n   // Track build features for dev server here:"
        },
        {
            "sha": "9efe0e885b45da27adad11b1e1cf05db5a2bf96d",
            "filename": "packages/next/src/telemetry/events/version.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 23,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/a20bcfbb46de47405fc3fd587901d244cb2b0779/packages%2Fnext%2Fsrc%2Ftelemetry%2Fevents%2Fversion.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a20bcfbb46de47405fc3fd587901d244cb2b0779/packages%2Fnext%2Fsrc%2Ftelemetry%2Fevents%2Fversion.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Ftelemetry%2Fevents%2Fversion.ts?ref=a20bcfbb46de47405fc3fd587901d244cb2b0779",
            "patch": "@@ -1,5 +1,4 @@\n import type { NextConfigComplete } from '../../server/config-shared'\n-import path from 'path'\n \n const EVENT_VERSION = 'NEXT_CLI_SESSION_STARTED'\n \n@@ -43,28 +42,7 @@ type EventCliSessionStarted = {\n   reactCompilerPanicThreshold: string | null\n }\n \n-function hasBabelConfig(dir: string): boolean {\n-  try {\n-    const noopFile = path.join(dir, 'noop.js')\n-    const res = (\n-      require('next/dist/compiled/babel/core') as typeof import('next/dist/compiled/babel/core')\n-    ).loadPartialConfig({\n-      cwd: dir,\n-      filename: noopFile,\n-      sourceFileName: noopFile,\n-    }) as any\n-    const isForTooling =\n-      res.options?.presets?.every(\n-        (e: any) => e?.file?.request === 'next/babel'\n-      ) && res.options?.plugins?.length === 0\n-    return res.hasFilesystemConfig() && !isForTooling\n-  } catch {\n-    return false\n-  }\n-}\n-\n export function eventCliSession(\n-  dir: string,\n   nextConfig: NextConfigComplete,\n   event: Omit<\n     EventCliSessionStarted,\n@@ -116,7 +94,7 @@ export function eventCliSession(\n     hasNextConfig: nextConfig.configOrigin !== 'default',\n     buildTarget: 'default',\n     hasWebpackConfig: typeof nextConfig?.webpack === 'function',\n-    hasBabelConfig: hasBabelConfig(dir),\n+    hasBabelConfig: false,\n     imageEnabled: !!images,\n     imageFutureEnabled: !!images,\n     basePathEnabled: !!nextConfig?.basePath,"
        },
        {
            "sha": "b306e8327ba503ad49b8f5107b39449e9966695b",
            "filename": "test/integration/telemetry/test/index.test.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/a20bcfbb46de47405fc3fd587901d244cb2b0779/test%2Fintegration%2Ftelemetry%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/a20bcfbb46de47405fc3fd587901d244cb2b0779/test%2Fintegration%2Ftelemetry%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Ftelemetry%2Ftest%2Findex.test.js?ref=a20bcfbb46de47405fc3fd587901d244cb2b0779",
            "patch": "@@ -236,7 +236,7 @@ describe('Telemetry CLI', () => {\n         expect(event).toMatch(/\"hasNextConfig\": false/)\n         expect(event).toMatch(/\"buildTarget\": \"default\"/)\n         expect(event).toMatch(/\"hasWebpackConfig\": false/)\n-        expect(event).toMatch(/\"hasBabelConfig\": true/)\n+        expect(event).toMatch(/\"hasBabelConfig\": false/)\n       })\n \n       it('cli session: package.json custom babel config (plugin)', async () => {\n@@ -262,7 +262,7 @@ describe('Telemetry CLI', () => {\n         expect(event).toMatch(/\"hasNextConfig\": false/)\n         expect(event).toMatch(/\"buildTarget\": \"default\"/)\n         expect(event).toMatch(/\"hasWebpackConfig\": false/)\n-        expect(event).toMatch(/\"hasBabelConfig\": true/)\n+        expect(event).toMatch(/\"hasBabelConfig\": false/)\n       })\n \n       it('cli session: custom babel config (preset)', async () => {\n@@ -288,7 +288,7 @@ describe('Telemetry CLI', () => {\n         expect(event).toMatch(/\"hasNextConfig\": false/)\n         expect(event).toMatch(/\"buildTarget\": \"default\"/)\n         expect(event).toMatch(/\"hasWebpackConfig\": false/)\n-        expect(event).toMatch(/\"hasBabelConfig\": true/)\n+        expect(event).toMatch(/\"hasBabelConfig\": false/)\n       })\n \n       it('cli session: next config with webpack', async () => {"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 16,
        "deletions": 42
    }
}