{
    "author": "huozhi",
    "message": "[error overlay] fix infinite loop when frames are failed to fetch (#75988)",
    "sha": "3434df935703c8bccfba34b8c7471005600fe75a",
    "files": [
        {
            "sha": "6d1f86d22734c88aaf176ba133047ee37496a99d",
            "filename": "packages/next/src/client/components/react-dev-overlay/internal/helpers/stack-frame.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 15,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/3434df935703c8bccfba34b8c7471005600fe75a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Finternal%2Fhelpers%2Fstack-frame.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3434df935703c8bccfba34b8c7471005600fe75a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Finternal%2Fhelpers%2Fstack-frame.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Finternal%2Fhelpers%2Fstack-frame.ts?ref=3434df935703c8bccfba34b8c7471005600fe75a",
            "patch": "@@ -77,29 +77,37 @@ export async function getOriginalStackFrames(\n     isAppDirectory: isAppDir,\n   }\n \n-  const res = await fetch('/__nextjs_original-stack-frames', {\n-    method: 'POST',\n-    body: JSON.stringify(req),\n-  })\n+  let res: Response | undefined = undefined\n+  let reason: string | undefined = undefined\n+  try {\n+    res = await fetch('/__nextjs_original-stack-frames', {\n+      method: 'POST',\n+      body: JSON.stringify(req),\n+    })\n+  } catch (e) {\n+    reason = e + ''\n+  }\n \n   // When fails to fetch the original stack frames, we reject here to be\n   // caught at `_getOriginalStackFrame()` and return the stack frames so\n   // that the error overlay can render.\n-  if (!res.ok || res.status === 204) {\n-    const reason = await res.text()\n+  if (res && res.ok && res.status !== 204) {\n+    const data = await res.json()\n     return Promise.all(\n-      frames.map((frame) =>\n-        getOriginalStackFrame(frame, {\n-          status: 'rejected',\n-          reason: `Failed to fetch the original stack frames: ${reason}`,\n-        })\n-      )\n+      frames.map((frame, index) => getOriginalStackFrame(frame, data[index]))\n     )\n+  } else {\n+    if (res) {\n+      reason = await res.text()\n+    }\n   }\n-\n-  const data = await res.json()\n   return Promise.all(\n-    frames.map((frame, index) => getOriginalStackFrame(frame, data[index]))\n+    frames.map((frame) =>\n+      getOriginalStackFrame(frame, {\n+        status: 'rejected',\n+        reason: `Failed to fetch the original stack frames ${reason ? `: ${reason}` : ''}`,\n+      })\n+    )\n   )\n }\n "
        }
    ],
    "stats": {
        "total": 38,
        "additions": 23,
        "deletions": 15
    }
}