{
    "author": "bgw",
    "message": "Turbopack: Remove some dead (or useless) code from `next-core/src/next_client_reference/visit_client_reference.rs` (#85843)\n\n![](https://media1.giphy.com/media/v1.Y2lkPWM5NDg3NzQzNW5iazVteTUxejQzYnNnbjhvNjY4eGxpZDBsMmRmMDF5aHg3eWs0NSZlcD12MV9naWZzX3NlYXJjaCZjdD1n/qH7J4EXzSCmBy/giphy.gif)",
    "sha": "bfe26808bed729c494c8fa180ff0022b4dcf35f9",
    "files": [
        {
            "sha": "9f101a03057455a839d057db82d72a50eb9c7707",
            "filename": "crates/next-core/src/next_app/app_client_references_chunks.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/bfe26808bed729c494c8fa180ff0022b4dcf35f9/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_references_chunks.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bfe26808bed729c494c8fa180ff0022b4dcf35f9/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_references_chunks.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_references_chunks.rs?ref=bfe26808bed729c494c8fa180ff0022b4dcf35f9",
            "patch": "@@ -50,10 +50,9 @@ pub async fn get_app_client_references_chunks(\n             //     .client_references\n             //     .iter()\n             //     .map(|client_reference| async move {\n-            //         let client_reference_ty = client_reference.ty();\n             //         Ok((\n-            //             client_reference_ty,\n-            //             match client_reference_ty {\n+            //             client_reference.ty,\n+            //             match client_reference.ty {\n             //                 ClientReferenceType::EcmascriptClientReference(\n             //                     ecmascript_client_reference,\n             //                 ) => {\n@@ -141,13 +140,13 @@ pub async fn get_app_client_references_chunks(\n                     .or_default();\n             }\n             for client_reference in app_client_references.client_references.iter() {\n-                if let Some(server_component) = client_reference.server_component() {\n+                if let Some(server_component) = client_reference.server_component {\n                     client_references_by_server_component\n                         .entry(server_component)\n                         .or_default()\n-                        .push(client_reference.ty());\n+                        .push(client_reference.ty);\n                 } else {\n-                    framework_reference_types.push(client_reference.ty());\n+                    framework_reference_types.push(client_reference.ty);\n                 }\n             }\n             // Framework components need to go into first layout segment"
        },
        {
            "sha": "c93332d8f0bfceb4bc2eb711b149cbad827b7c25",
            "filename": "crates/next-core/src/next_client_reference/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/bfe26808bed729c494c8fa180ff0022b4dcf35f9/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bfe26808bed729c494c8fa180ff0022b4dcf35f9/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fmod.rs?ref=bfe26808bed729c494c8fa180ff0022b4dcf35f9",
            "patch": "@@ -11,6 +11,6 @@ pub use ecmascript_client_reference::{\n     ecmascript_client_reference_transition::NextEcmascriptClientReferenceTransition,\n };\n pub use visit_client_reference::{\n-    ClientReference, ClientReferenceGraphResult, ClientReferenceType, ClientReferenceTypes,\n-    ServerEntries, VisitedClientReferenceGraphNodes, find_server_entries,\n+    ClientReference, ClientReferenceGraphResult, ClientReferenceType, ServerEntries,\n+    find_server_entries,\n };"
        },
        {
            "sha": "5d11617b600c1de7244c41f6b6f166023931ed22",
            "filename": "crates/next-core/src/next_client_reference/visit_client_reference.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 42,
            "changes": 43,
            "blob_url": "https://github.com/vercel/next.js/blob/bfe26808bed729c494c8fa180ff0022b4dcf35f9/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fvisit_client_reference.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bfe26808bed729c494c8fa180ff0022b4dcf35f9/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fvisit_client_reference.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fvisit_client_reference.rs?ref=bfe26808bed729c494c8fa180ff0022b4dcf35f9",
            "patch": "@@ -1,12 +1,11 @@\n use std::future::Future;\n \n use anyhow::Result;\n-use rustc_hash::FxHashSet;\n use serde::{Deserialize, Serialize};\n use tracing::{Instrument, Level, Span};\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n-    FxIndexSet, NonLocalValue, ReadRef, ResolvedVc, TryJoinIterExt, Vc,\n+    NonLocalValue, ReadRef, ResolvedVc, TryJoinIterExt, Vc,\n     debug::ValueDebugFormat,\n     graph::{AdjacencyMap, GraphTraversal, Visit, VisitControlFlow},\n     trace::TraceRawVcs,\n@@ -43,19 +42,6 @@ pub struct ClientReference {\n     pub ty: ClientReferenceType,\n }\n \n-impl ClientReference {\n-    pub fn server_component(&self) -> Option<ResolvedVc<NextServerComponentModule>> {\n-        self.server_component\n-    }\n-\n-    pub fn ty(&self) -> ClientReferenceType {\n-        self.ty\n-    }\n-}\n-\n-#[turbo_tasks::value(transparent)]\n-pub struct ClientReferences(Vec<ClientReference>);\n-\n #[derive(\n     Copy,\n     Clone,\n@@ -82,33 +68,6 @@ pub struct ClientReferenceGraphResult {\n     pub server_utils: Vec<ResolvedVc<NextServerUtilityModule>>,\n }\n \n-#[turbo_tasks::value(shared)]\n-pub struct VisitedClientReferenceGraphNodes(FxHashSet<FindServerEntriesNode>);\n-\n-#[turbo_tasks::value_impl]\n-impl VisitedClientReferenceGraphNodes {\n-    #[turbo_tasks::function]\n-    pub fn empty() -> Vc<Self> {\n-        VisitedClientReferenceGraphNodes(Default::default()).cell()\n-    }\n-}\n-\n-#[turbo_tasks::value(transparent)]\n-pub struct ClientReferenceTypes(FxIndexSet<ClientReferenceType>);\n-\n-#[turbo_tasks::value_impl]\n-impl ClientReferenceGraphResult {\n-    #[turbo_tasks::function]\n-    pub fn types(&self) -> Vc<ClientReferenceTypes> {\n-        Vc::cell(\n-            self.client_references\n-                .iter()\n-                .map(|r| r.ty())\n-                .collect::<FxIndexSet<_>>(),\n-        )\n-    }\n-}\n-\n #[turbo_tasks::value(shared)]\n #[derive(Clone, Debug)]\n pub struct ServerEntries {"
        },
        {
            "sha": "795000025ec991fea099da55dc8ad1455d989a0f",
            "filename": "crates/next-core/src/next_manifests/client_reference_manifest.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bfe26808bed729c494c8fa180ff0022b4dcf35f9/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fclient_reference_manifest.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bfe26808bed729c494c8fa180ff0022b4dcf35f9/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fclient_reference_manifest.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fclient_reference_manifest.rs?ref=bfe26808bed729c494c8fa180ff0022b4dcf35f9",
            "patch": "@@ -185,7 +185,7 @@ async fn build_manifest(\n             .client_references\n             .iter()\n             .map(async |r| {\n-                Ok(match r.ty() {\n+                Ok(match r.ty {\n                     ClientReferenceType::EcmascriptClientReference(r) => Some((r, r.await?)),\n                     ClientReferenceType::CssClientReference(_) => None,\n                 })"
        }
    ],
    "stats": {
        "total": 60,
        "additions": 9,
        "deletions": 51
    }
}