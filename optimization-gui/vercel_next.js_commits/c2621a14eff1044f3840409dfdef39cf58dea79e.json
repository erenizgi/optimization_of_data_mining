{
    "author": "huozhi",
    "message": "[devtool] style the segment explorer as nested view (#80212)",
    "sha": "c2621a14eff1044f3840409dfdef39cf58dea79e",
    "files": [
        {
            "sha": "d3b8de1cd8815fc3565b90054cbb44734de707e1",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/overview/segment-explorer.tsx",
            "status": "modified",
            "additions": 35,
            "deletions": 12,
            "changes": 47,
            "blob_url": "https://github.com/vercel/next.js/blob/c2621a14eff1044f3840409dfdef39cf58dea79e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c2621a14eff1044f3840409dfdef39cf58dea79e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Foverview%2Fsegment-explorer.tsx?ref=c2621a14eff1044f3840409dfdef39cf58dea79e",
            "patch": "@@ -76,13 +76,33 @@ function PageSegmentTreeLayerPresentation({\n   node: TrieNode<SegmentNode>\n   level: number\n }) {\n-  const segments = node.value?.pagePath?.split('/') || []\n-  const fileName = segments[segments.length - 1] || ''\n+  const pagePath = node.value?.pagePath || ''\n   const nodeName = node.value?.type\n-  const pagePathPrefix = segments.slice(0, -1).join('/')\n+\n+  const segments = pagePath.split('/') || []\n+  const fileName = segments.pop() || ''\n+  const segmentPath = segments.join('/')\n+\n+  let pagePathPrefix = segmentPath\n+\n+  const childrenKeys = Object.keys(node.children).sort((a, b) => {\n+    // Prioritize if it's a file convention like layout or page,\n+    // then the rest parallel routes.\n+    const aHasExt = a.includes('.')\n+    const bHasExt = b.includes('.')\n+    if (aHasExt && !bHasExt) return -1\n+    if (!aHasExt && bHasExt) return 1\n+    // Otherwise sort alphabetically\n+    return a.localeCompare(b)\n+  })\n \n   return (\n-    <div className=\"segment-explorer-item\">\n+    <div\n+      className={cx(\n+        'segment-explorer-item',\n+        level > 1 && 'segment-explorer-item--nested'\n+      )}\n+    >\n       {!fileName || level === 0 ? null : (\n         <div className=\"segment-explorer-item-row\">\n           <div className=\"segment-explorer-line\">\n@@ -103,17 +123,19 @@ function PageSegmentTreeLayerPresentation({\n       )}\n \n       <div className=\"tree-node-expanded-rendered-children\">\n-        {Object.entries(node.children).map(\n-          ([key, child]) =>\n+        {childrenKeys.map((segment) => {\n+          const child = node.children[segment]\n+          return (\n             child && (\n               <PageSegmentTreeLayerPresentation\n-                key={key}\n+                key={segment}\n                 tree={tree}\n                 node={child}\n                 level={level + 1}\n               />\n             )\n-        )}\n+          )\n+        })}\n       </div>\n     </div>\n   )\n@@ -141,6 +163,10 @@ export const DEV_TOOLS_INFO_RENDER_FILES_STYLES = css`\n     font-size: var(--size-14);\n   }\n \n+  .segment-explorer-item--nested {\n+    padding-left: 20px;\n+  }\n+\n   .segment-explorer-item-row {\n     display: flex;\n     align-items: center;\n@@ -168,12 +194,9 @@ export const DEV_TOOLS_INFO_RENDER_FILES_STYLES = css`\n   .segment-explorer-line-icon-page {\n     color: inherit;\n   }\n-  .segment-explorer-line-icon-layout {\n-    color: var(--color-gray-1-00);\n-  }\n \n   .segment-explorer-line-text-page {\n-    color: var(--color-blue-900);\n+    color: var(--color-gray-1000);\n     font-weight: 500;\n   }\n `"
        },
        {
            "sha": "b54d903670fe8ca2e2ed11a25c68839aa96a2939",
            "filename": "test/development/app-dir/segment-explorer/segment-explorer.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/c2621a14eff1044f3840409dfdef39cf58dea79e/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c2621a14eff1044f3840409dfdef39cf58dea79e/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts?ref=c2621a14eff1044f3840409dfdef39cf58dea79e",
            "patch": "@@ -22,13 +22,13 @@ describe('segment-explorer', () => {\n       '[data-nextjs-devtool-segment-explorer]'\n     )\n     expect(await content.text()).toMatchInlineSnapshot(`\n-     \"app/parallel-routes/page.tsx\n-     app/parallel-routes/@foo/page.tsx\n-     app/parallel-routes/@foo/layout.tsx\n-     app/parallel-routes/@bar/page.tsx\n-     app/parallel-routes/@bar/layout.tsx\n+     \"app/layout.tsx\n      app/parallel-routes/layout.tsx\n-     app/layout.tsx\"\n+     app/parallel-routes/page.tsx\n+     app/parallel-routes/@bar/layout.tsx\n+     app/parallel-routes/@bar/page.tsx\n+     app/parallel-routes/@foo/layout.tsx\n+     app/parallel-routes/@foo/page.tsx\"\n     `)\n   })\n })"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 41,
        "deletions": 18
    }
}