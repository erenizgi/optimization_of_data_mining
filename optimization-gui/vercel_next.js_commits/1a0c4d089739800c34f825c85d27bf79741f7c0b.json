{
    "author": "SyMind",
    "message": "perf: memorize exclude function in webpack config (#81525)\n\nDuring JavaScript profiling, I identified repeated calls to the exclude\nfunction in the webpack configuration and implemented caching to\noptimize it.\n\n<img width=\"2248\" height=\"772\" alt=\"image\"\nsrc=\"https://github.com/user-attachments/assets/1fdb03f3-2904-4195-a538-7b1f4646f0f2\"\n/>\n\nI tested the performance using the\n[chakra-ui-docs](https://github.com/SyMind/chakra-ui-docs) repository\nwith the following steps:\n  1. Execute `pnpm run dev`\n  2. Wait for the server to be ready (indicated by the 'Ready' message)\n  3. Run `curl` on the root endpoint (`/`)\n\n| | Webpack | Rspack |\n|-|-|-|\n|After| Compiled / in 8.3s (2682 modules) | Compiled / in 2.3s (2650\nmodules) |\n|Before| Compiled / in 7.8s (2682 modules) | Compiled / in 1983ms (2650\nmodules) |\n\n---------\n\nCo-authored-by: Benjamin Woodruff <github@benjam.info>",
    "sha": "1a0c4d089739800c34f825c85d27bf79741f7c0b",
    "files": [
        {
            "sha": "b5ca72029b7ab20b0a2281b870ec815f5fc7ec94",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 13,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/1a0c4d089739800c34f825c85d27bf79741f7c0b/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1a0c4d089739800c34f825c85d27bf79741f7c0b/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=1a0c4d089739800c34f825c85d27bf79741f7c0b",
            "patch": "@@ -445,6 +445,22 @@ export default async function getBaseWebpackConfig(\n     loggedIgnoredCompilerOptions = true\n   }\n \n+  const excludeCache: Record<string, boolean> = {}\n+  function exclude(excludePath: string): boolean {\n+    const cached = excludeCache[excludePath]\n+    if (cached !== undefined) {\n+      return cached\n+    }\n+\n+    const shouldExclude =\n+      excludePath.includes('node_modules') &&\n+      !babelIncludeRegexes.some((r) => r.test(excludePath)) &&\n+      !isResourceInPackages(excludePath, finalTranspilePackages)\n+\n+    excludeCache[excludePath] = shouldExclude\n+    return shouldExclude\n+  }\n+\n   const shouldIncludeExternalDirs =\n     config.experimental.externalDir || !!config.transpilePackages\n   const codeCondition = {\n@@ -453,19 +469,7 @@ export default async function getBaseWebpackConfig(\n       ? // Allowing importing TS/TSX files from outside of the root dir.\n         {}\n       : { include: [dir, ...babelIncludeRegexes] }),\n-    exclude: (excludePath: string) => {\n-      if (babelIncludeRegexes.some((r) => r.test(excludePath))) {\n-        return false\n-      }\n-\n-      const shouldBeBundled = isResourceInPackages(\n-        excludePath,\n-        finalTranspilePackages\n-      )\n-      if (shouldBeBundled) return false\n-\n-      return excludePath.includes('node_modules')\n-    },\n+    exclude,\n   }\n \n   const babelLoader = getBabelLoader("
        }
    ],
    "stats": {
        "total": 30,
        "additions": 17,
        "deletions": 13
    }
}