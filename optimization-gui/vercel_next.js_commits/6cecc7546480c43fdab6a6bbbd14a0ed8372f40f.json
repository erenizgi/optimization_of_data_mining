{
    "author": "wyattjoh",
    "message": "Fix dynamic catchall parameter interpolation in parallel routes (#84279)\n\n### Fixing a bug\n\n- Tests added with comprehensive e2e test suite for parallel route\nnavigations\n- Error handling improved with clearer error messages for missing\ndynamic parameters\n\n### What?\n\nFixes incorrect parameter interpolation where catchall parameters in\nparallel routes included unintended prefix segments.\n\n### Why?\n\nIn parallel routes with dynamic catchall parameters, the parameter\ninterpolation was incorrectly including prefix segments from the route\npath. For example, with a route structure like\n`/[teamSlug]/@slot/[...catchAll]`, a request to `/vercel/test/path`\nwould incorrectly set `catchAll = [\"vercel\", \"test\", \"path\"]` instead of\nthe correct `catchAll = [\"test\", \"path\"]`.\n\nThis bug affected the accuracy of dynamic parameter values in parallel\nroutes, leading to incorrect behavior in applications relying on these\nparameters for routing logic.\n\n### How?\n\n- Introduced `interpolateParallelRouteParams()` function that properly\nhandles path depth traversal for complex route structures\n- Refactored parameter interpolation to occur earlier in the render\nprocess, ensuring consistency across both postponed and regular\nrendering scenarios\n- Updated the `getDynamicParam()` function to use pre-interpolated\nparameters instead of performing inline path parsing\n- Added comprehensive e2e tests to cover various parallel route\nnavigation scenarios and parameter interpolation edge cases\n- Improved error handling with more descriptive error messages for\nmissing dynamic parameters\n\nThe fix ensures that dynamic parameters are correctly extracted based on\ntheir position in the route hierarchy, respecting the boundaries defined\nby parallel route slots.\n\nNAR-335",
    "sha": "6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
    "files": [
        {
            "sha": "ff1a6703f20ab0530f62d04f86969e37b0847793",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -861,5 +861,6 @@\n   \"860\": \"Client Max Body Size must be a valid number (bytes) or filesize format string (e.g., \\\"5mb\\\")\",\n   \"861\": \"Client Max Body Size must be larger than 0 bytes\",\n   \"862\": \"Request body exceeded %s\",\n-  \"863\": \"\\\\`<Link legacyBehavior>\\\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\\\`<a>\\\\` tag.\"\n+  \"863\": \"\\\\`<Link legacyBehavior>\\\\` received a direct child that is either a Server Component, or JSX that was loaded with React.lazy(). This is not supported. Either remove legacyBehavior, or make the direct child a Client Component that renders the Link's \\\\`<a>\\\\` tag.\",\n+  \"864\": \"Missing value for segment key: \\\"%s\\\" with dynamic param type: %s\"\n }"
        },
        {
            "sha": "d66a65660ba63f387c1834628c7d190de02e5ecb",
            "filename": "packages/next/src/build/segment-config/app/app-segments.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fbuild%2Fsegment-config%2Fapp%2Fapp-segments.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fbuild%2Fsegment-config%2Fapp%2Fapp-segments.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fsegment-config%2Fapp%2Fapp-segments.ts?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -12,7 +12,7 @@ import {\n   isAppPageRouteModule,\n } from '../../../server/route-modules/checks'\n import { isClientReference } from '../../../lib/client-and-server-references'\n-import { getSegmentParam } from '../../../server/app-render/get-segment-param'\n+import { getSegmentParam } from '../../../shared/lib/router/utils/get-segment-param'\n import {\n   getLayoutOrPageModule,\n   type LoaderTree,"
        },
        {
            "sha": "e3539ca52182ff1278c308c3e42d6e1e8587e0dd",
            "filename": "packages/next/src/build/segment-config/app/collect-root-param-keys.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fbuild%2Fsegment-config%2Fapp%2Fcollect-root-param-keys.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fbuild%2Fsegment-config%2Fapp%2Fcollect-root-param-keys.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fsegment-config%2Fapp%2Fcollect-root-param-keys.ts?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -1,4 +1,4 @@\n-import { getSegmentParam } from '../../../server/app-render/get-segment-param'\n+import { getSegmentParam } from '../../../shared/lib/router/utils/get-segment-param'\n import type AppPageRouteModule from '../../../server/route-modules/app-page/module'\n import {\n   isAppPageRouteModule,"
        },
        {
            "sha": "c5aa71bd31f6e5c742875760afb862f4f8de5743",
            "filename": "packages/next/src/build/webpack/loaders/next-root-params-loader.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-root-params-loader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-root-params-loader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-root-params-loader.ts?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -3,7 +3,7 @@ import * as path from 'node:path'\n import * as fs from 'node:fs/promises'\n import { normalizeAppPath } from '../../../shared/lib/router/utils/app-paths'\n import { ensureLeadingSlash } from '../../../shared/lib/page-path/ensure-leading-slash'\n-import { getSegmentParam } from '../../../server/app-render/get-segment-param'\n+import { getSegmentParam } from '../../../shared/lib/router/utils/get-segment-param'\n \n export type RootParamsLoaderOpts = {\n   appDir: string"
        },
        {
            "sha": "4ea3849578dd4c9725129eea3ed7dc8ba194c3ca",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 26,
            "deletions": 15,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -86,7 +86,7 @@ import {\n   getDigestForWellKnownError,\n } from './create-error-handler'\n import { dynamicParamTypes } from './get-short-dynamic-param-type'\n-import { getSegmentParam } from './get-segment-param'\n+import { getSegmentParam } from '../../shared/lib/router/utils/get-segment-param'\n import { getScriptNonceFromHeader } from './get-script-nonce-from-header'\n import { parseAndValidateFlightRouterState } from './parse-and-validate-flight-router-state'\n import { createFlightRouterStateFromLoaderTree } from './create-flight-router-state-from-loader-tree'\n@@ -181,7 +181,7 @@ import { InvariantError } from '../../shared/lib/invariant-error'\n \n import { HTML_CONTENT_TYPE_HEADER, INFINITE_CACHE } from '../../lib/constants'\n import { createComponentStylesAndScripts } from './create-component-styles-and-scripts'\n-import { parseLoaderTree } from './parse-loader-tree'\n+import { parseLoaderTree } from '../../shared/lib/router/utils/parse-loader-tree'\n import {\n   createPrerenderResumeDataCache,\n   createRenderResumeDataCache,\n@@ -202,7 +202,10 @@ import { isReactLargeShellError } from './react-large-shell-error'\n import type { GlobalErrorComponent } from '../../client/components/builtin/global-error'\n import { normalizeConventionFilePath } from './segment-explorer-path'\n import { getRequestMeta } from '../request-meta'\n-import { getDynamicParam } from '../../shared/lib/router/utils/get-dynamic-param'\n+import {\n+  getDynamicParam,\n+  interpolateParallelRouteParams,\n+} from '../../shared/lib/router/utils/get-dynamic-param'\n import type { ExperimentalConfig } from '../config-shared'\n import type { Params } from '../request/params'\n import { createPromiseWithResolvers } from '../../shared/lib/promise-with-resolvers'\n@@ -394,8 +397,7 @@ function createNotFoundLoaderTree(loaderTree: LoaderTree): LoaderTree {\n  * Returns a function that parses the dynamic segment and return the associated value.\n  */\n function makeGetDynamicParamFromSegment(\n-  params: { [key: string]: any },\n-  pagePath: string,\n+  interpolatedParams: Params,\n   fallbackRouteParams: OpaqueFallbackRouteParams | null\n ): GetDynamicParamFromSegment {\n   return function getDynamicParamFromSegment(\n@@ -409,10 +411,9 @@ function makeGetDynamicParamFromSegment(\n     const segmentKey = segmentParam.param\n     const dynamicParamType = dynamicParamTypes[segmentParam.type]\n     return getDynamicParam(\n-      params,\n+      interpolatedParams,\n       segmentKey,\n       dynamicParamType,\n-      pagePath,\n       fallbackRouteParams\n     )\n   }\n@@ -1481,6 +1482,7 @@ async function renderToHTMLOrFlightImpl(\n   postponedState: PostponedState | null,\n   serverComponentsHmrCache: ServerComponentsHmrCache | undefined,\n   sharedContext: AppSharedContext,\n+  interpolatedParams: Params,\n   fallbackRouteParams: OpaqueFallbackRouteParams | null\n ) {\n   const isNotFoundPath = pagePath === '/404'\n@@ -1695,14 +1697,8 @@ async function renderToHTMLOrFlightImpl(\n   // HTML request ID.\n   htmlRequestId = parsedRequestHeaders.htmlRequestId || requestId\n \n-  /**\n-   * Dynamic parameters. E.g. when you visit `/dashboard/vercel` which is rendered by `/dashboard/[slug]` the value will be {\"slug\": \"vercel\"}.\n-   */\n-  const params = renderOpts.params ?? {}\n-\n   const getDynamicParamFromSegment = makeGetDynamicParamFromSegment(\n-    params,\n-    pagePath,\n+    interpolatedParams,\n     fallbackRouteParams\n   )\n \n@@ -2032,6 +2028,7 @@ export const renderToHTMLOrFlight: AppPageRender = (\n   const { isPrefetchRequest, previouslyRevalidatedTags, nonce } =\n     parsedRequestHeaders\n \n+  let interpolatedParams: Params\n   let postponedState: PostponedState | null = null\n \n   // If provided, the postpone state should be parsed so it can be provided to\n@@ -2043,10 +2040,23 @@ export const renderToHTMLOrFlight: AppPageRender = (\n       )\n     }\n \n+    interpolatedParams = interpolateParallelRouteParams(\n+      renderOpts.ComponentMod.routeModule.userland.loaderTree,\n+      renderOpts.params ?? {},\n+      pagePath,\n+      fallbackRouteParams\n+    )\n+\n     postponedState = parsePostponedState(\n       renderOpts.postponed,\n+      interpolatedParams\n+    )\n+  } else {\n+    interpolatedParams = interpolateParallelRouteParams(\n+      renderOpts.ComponentMod.routeModule.userland.loaderTree,\n+      renderOpts.params ?? {},\n       pagePath,\n-      renderOpts.params\n+      fallbackRouteParams\n     )\n   }\n \n@@ -2085,6 +2095,7 @@ export const renderToHTMLOrFlight: AppPageRender = (\n     postponedState,\n     serverComponentsHmrCache,\n     sharedContext,\n+    interpolatedParams,\n     fallbackRouteParams\n   )\n }"
        },
        {
            "sha": "4ee89d7e57f8904d63e391d9cecb35b187fa3eb5",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -11,7 +11,7 @@ import {\n import { getLayoutOrPageModule } from '../lib/app-dir-module'\n import type { LoaderTree } from '../lib/app-dir-module'\n import { interopDefault } from './interop-default'\n-import { parseLoaderTree } from './parse-loader-tree'\n+import { parseLoaderTree } from '../../shared/lib/router/utils/parse-loader-tree'\n import type { AppRenderContext, GetDynamicParamFromSegment } from './app-render'\n import { createComponentStylesAndScripts } from './create-component-styles-and-scripts'\n import { getLayerAssets } from './get-layer-assets'"
        },
        {
            "sha": "8436088a6de70103b7dbc97df72a02d7dfff4f62",
            "filename": "packages/next/src/server/app-render/postponed-state.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fpostponed-state.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fpostponed-state.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fpostponed-state.test.ts?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -52,7 +52,7 @@ describe('getDynamicHTMLPostponedState', () => {\n       isCacheComponentsEnabled\n     )\n \n-    const parsed = parsePostponedState(state, '/blog/[slug]', { slug: '123' })\n+    const parsed = parsePostponedState(state, { slug: '123' })\n \n     expect(parsed).toMatchInlineSnapshot(`\n      {\n@@ -110,7 +110,7 @@ describe('getDynamicHTMLPostponedState', () => {\n \n     const value = 'hello'\n     const params = { slug: value }\n-    const parsed = parsePostponedState(state, '/blog/[slug]', params)\n+    const parsed = parsePostponedState(state, params)\n     expect(parsed).toEqual({\n       type: DynamicState.HTML,\n       data: [1, { [value]: value }],\n@@ -138,7 +138,7 @@ describe('parsePostponedState', () => {\n     const params = {\n       slug: Math.random().toString(16).slice(3),\n     }\n-    const parsed = parsePostponedState(state, '/blog/[slug]', params)\n+    const parsed = parsePostponedState(state, params)\n \n     // Ensure that it parsed it correctly.\n     expect(parsed).toEqual({\n@@ -154,7 +154,7 @@ describe('parsePostponedState', () => {\n   it('parses a HTML postponed state without fallback params', () => {\n     const state = `2:{}null`\n     const params = {}\n-    const parsed = parsePostponedState(state, '/blog', params)\n+    const parsed = parsePostponedState(state, params)\n \n     // Ensure that it parsed it correctly.\n     expect(parsed).toEqual({\n@@ -166,7 +166,7 @@ describe('parsePostponedState', () => {\n \n   it('parses a data postponed state', () => {\n     const state = '4:nullnull'\n-    const parsed = parsePostponedState(state, '/blog', undefined)\n+    const parsed = parsePostponedState(state, {})\n \n     // Ensure that it parsed it correctly.\n     expect(parsed).toEqual({"
        },
        {
            "sha": "703183f878e7a66571f95915a0907c35ba9a6ef3",
            "filename": "packages/next/src/server/app-render/postponed-state.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 6,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fpostponed-state.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fpostponed-state.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fpostponed-state.ts?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -116,8 +116,7 @@ export async function getDynamicDataPostponedState(\n \n export function parsePostponedState(\n   state: string,\n-  pagePath: string,\n-  params: Params | undefined\n+  interpolatedParams: Params\n ): PostponedState {\n   try {\n     const postponedStringLengthMatch = state.match(/^([0-9]*):/)?.[1]\n@@ -162,7 +161,10 @@ export function parsePostponedState(\n         ) as OpaqueFallbackRouteParamEntries\n \n         let postponed = postponedString.slice(match.length + length)\n-        for (const [key, [searchValue, dynamicParamType]] of replacements) {\n+        for (const [\n+          segmentKey,\n+          [searchValue, dynamicParamType],\n+        ] of replacements) {\n           const {\n             treeSegment: [\n               ,\n@@ -172,10 +174,9 @@ export function parsePostponedState(\n               value,\n             ],\n           } = getDynamicParam(\n-            params ?? {},\n-            key,\n+            interpolatedParams,\n+            segmentKey,\n             dynamicParamType,\n-            pagePath,\n             null\n           )\n "
        },
        {
            "sha": "336ab006874fa9e75417782961d597070419e6f6",
            "filename": "packages/next/src/server/app-render/walk-tree-with-flight-router-state.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fwalk-tree-with-flight-router-state.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fwalk-tree-with-flight-router-state.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fwalk-tree-with-flight-router-state.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -18,7 +18,7 @@ import type { AppRenderContext } from './app-render'\n import { hasLoadingComponentInTree } from './has-loading-component-in-tree'\n import { addSearchParamsIfPageSegment } from '../../shared/lib/segment'\n import { createComponentTree } from './create-component-tree'\n-import { getSegmentParam } from './get-segment-param'\n+import { getSegmentParam } from '../../shared/lib/router/utils/get-segment-param'\n \n /**\n  * Use router state to decide at what common layout to render the page."
        },
        {
            "sha": "139c497052861ad0a399867591504f8215ab3b14",
            "filename": "packages/next/src/shared/lib/router/utils/get-dynamic-param.test.ts",
            "status": "modified",
            "additions": 92,
            "deletions": 362,
            "changes": 454,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-dynamic-param.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-dynamic-param.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-dynamic-param.test.ts?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -2,16 +2,18 @@ import {\n   getDynamicParam,\n   parseParameter,\n   parseMatchedParameter,\n+  interpolateParallelRouteParams,\n } from './get-dynamic-param'\n import type { Params } from '../../../../server/request/params'\n import { InvariantError } from '../../invariant-error'\n import { createMockOpaqueFallbackRouteParams } from '../../../../server/app-render/postponed-state.test'\n+import type { LoaderTree } from '../../../../server/lib/app-dir-module'\n \n describe('getDynamicParam', () => {\n   describe('basic dynamic parameters (d, di)', () => {\n     it('should handle simple string parameter', () => {\n       const params: Params = { slug: 'hello-world' }\n-      const result = getDynamicParam(params, 'slug', 'd', '/blog/[slug]', null)\n+      const result = getDynamicParam(params, 'slug', 'd', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -23,7 +25,7 @@ describe('getDynamicParam', () => {\n \n     it('should encode special characters in string parameters', () => {\n       const params: Params = { slug: 'hello world & stuff' }\n-      const result = getDynamicParam(params, 'slug', 'd', '/blog/[slug]', null)\n+      const result = getDynamicParam(params, 'slug', 'd', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -35,7 +37,7 @@ describe('getDynamicParam', () => {\n \n     it('should handle unicode characters', () => {\n       const params: Params = { slug: 'caf�-na�ve' }\n-      const result = getDynamicParam(params, 'slug', 'd', '/blog/[slug]', null)\n+      const result = getDynamicParam(params, 'slug', 'd', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -49,35 +51,33 @@ describe('getDynamicParam', () => {\n       const params: Params = {}\n \n       expect(() => {\n-        getDynamicParam(params, 'slug', 'd', '/blog/[slug]', null)\n+        getDynamicParam(params, 'slug', 'd', null)\n       }).toThrow(InvariantError)\n       expect(() => {\n-        getDynamicParam(params, 'slug', 'd', '/blog/[slug]', null)\n-      }).toThrow('Unexpected dynamic param type: d')\n+        getDynamicParam(params, 'slug', 'd', null)\n+      }).toThrow(\n+        `Invariant: Missing value for segment key: \"slug\" with dynamic param type: d. This is a bug in Next.js.`\n+      )\n     })\n \n     it('should throw InvariantError for dynamic intercepted parameter without value', () => {\n       const params: Params = {}\n \n       expect(() => {\n-        getDynamicParam(params, 'slug', 'di', '/blog/[slug]', null)\n+        getDynamicParam(params, 'slug', 'di', null)\n       }).toThrow(InvariantError)\n       expect(() => {\n-        getDynamicParam(params, 'slug', 'di', '/blog/[slug]', null)\n-      }).toThrow('Unexpected dynamic param type: di')\n+        getDynamicParam(params, 'slug', 'di', null)\n+      }).toThrow(\n+        'Invariant: Missing value for segment key: \"slug\" with dynamic param type: di. This is a bug in Next.js.'\n+      )\n     })\n   })\n \n   describe('catchall parameters (c, ci)', () => {\n     it('should handle array of values for catchall', () => {\n       const params: Params = { slug: ['docs', 'getting-started'] }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/docs/[...slug]',\n-        null\n-      )\n+      const result = getDynamicParam(params, 'slug', 'c', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -89,13 +89,7 @@ describe('getDynamicParam', () => {\n \n     it('should encode array values for catchall', () => {\n       const params: Params = { slug: ['docs & guides', 'getting started'] }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/docs/[...slug]',\n-        null\n-      )\n+      const result = getDynamicParam(params, 'slug', 'c', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -107,13 +101,7 @@ describe('getDynamicParam', () => {\n \n     it('should handle single string value for catchall', () => {\n       const params: Params = { slug: 'single-page' }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/docs/[...slug]',\n-        null\n-      )\n+      const result = getDynamicParam(params, 'slug', 'c', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -123,33 +111,9 @@ describe('getDynamicParam', () => {\n       })\n     })\n \n-    it('should use pagePath fallback when catchall has no value', () => {\n-      const params: Params = {}\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/dashboard/analytics/reports',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: ['dashboard', 'analytics', 'reports'],\n-        type: 'c',\n-        treeSegment: ['slug', 'dashboard/analytics/reports', 'c'],\n-      })\n-    })\n-\n     it('should handle catchall intercepted (ci) with array values', () => {\n       const params: Params = { path: ['photo', '123'] }\n-      const result = getDynamicParam(\n-        params,\n-        'path',\n-        'ci',\n-        '/(.)photo/[...path]',\n-        null\n-      )\n+      const result = getDynamicParam(params, 'path', 'ci', null)\n \n       expect(result).toEqual({\n         param: 'path',\n@@ -159,104 +123,12 @@ describe('getDynamicParam', () => {\n       })\n     })\n \n-    it('should parse pagePath with dynamic segments for catchall fallback', () => {\n-      const params: Params = { category: 'electronics' }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/shop/[category]/products',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: ['shop', 'electronics', 'products'],\n-        type: 'c',\n-        treeSegment: ['slug', 'shop/electronics/products', 'c'],\n-      })\n-    })\n-\n-    it('should handle pagePath with parallel routes for catchall', () => {\n-      const params: Params = { category: 'books' }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/shop/[category]/@modal/product-details',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: ['shop', 'books', '@modal', 'product-details'],\n-        type: 'c',\n-        treeSegment: ['slug', 'shop/books/@modal/product-details', 'c'],\n-      })\n-    })\n-\n-    it('should handle pagePath with multiple parallel routes for catchall', () => {\n-      const params: Params = {\n-        category: 'electronics',\n-        brand: 'apple',\n-      }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/shop/[category]/[brand]/@sidebar/@modal/details',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: [\n-          'shop',\n-          'electronics',\n-          'apple',\n-          '@sidebar',\n-          '@modal',\n-          'details',\n-        ],\n-        type: 'c',\n-        treeSegment: [\n-          'slug',\n-          'shop/electronics/apple/@sidebar/@modal/details',\n-          'c',\n-        ],\n-      })\n-    })\n-\n-    it('should handle pagePath with parallel routes and static segments for optional catchall when param missing', () => {\n-      const params: Params = { userId: '123' }\n-      const result = getDynamicParam(\n-        params,\n-        'path',\n-        'oc',\n-        '/dashboard/[userId]/@analytics/reports/monthly',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'path',\n-        value: null,\n-        type: 'oc',\n-        treeSegment: ['path', '', 'oc'],\n-      })\n-    })\n-\n     it('should handle parallel routes with fallback params for catchall', () => {\n       const params: Params = { category: 'electronics' }\n       const fallbackParams = createMockOpaqueFallbackRouteParams({\n         slug: ['%%drp:slug:parallel123%%', 'd'],\n       })\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'd',\n-        '/shop/[category]/@modal/@sidebar/product',\n-        fallbackParams\n-      )\n+      const result = getDynamicParam(params, 'slug', 'd', fallbackParams)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -265,133 +137,12 @@ describe('getDynamicParam', () => {\n         treeSegment: ['slug', '%%drp:slug:parallel123%%', 'd'],\n       })\n     })\n-\n-    it('should handle parallel routes with catchall parameters in the parallel segment', () => {\n-      const params: Params = {\n-        category: 'books',\n-        modalPath: ['details', 'reviews', 'summary'],\n-      }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/shop/[category]/@modal/[...modalPath]/content',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: [\n-          'shop',\n-          'books',\n-          '@modal',\n-          'details',\n-          'reviews',\n-          'summary',\n-          'content',\n-        ],\n-        type: 'c',\n-        treeSegment: [\n-          'slug',\n-          'shop/books/@modal/details/reviews/summary/content',\n-          'c',\n-        ],\n-      })\n-    })\n-\n-    it('should handle parallel routes with optional catchall in parallel segment', () => {\n-      const params: Params = {\n-        userId: '456',\n-        tabPath: ['settings', 'profile'],\n-      }\n-      const result = getDynamicParam(\n-        params,\n-        'content',\n-        'c',\n-        '/dashboard/[userId]/@tabs/[[...tabPath]]/layout',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'content',\n-        value: ['dashboard', '456', '@tabs', 'settings', 'profile', 'layout'],\n-        type: 'c',\n-        treeSegment: [\n-          'content',\n-          'dashboard/456/@tabs/settings/profile/layout',\n-          'c',\n-        ],\n-      })\n-    })\n-\n-    it('should handle multiple parallel routes each with catchall segments', () => {\n-      const params: Params = {\n-        category: 'electronics',\n-        modalPath: ['photo', 'gallery'],\n-        sidebarPath: ['filters', 'brands'],\n-      }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/shop/[category]/@modal/[...modalPath]/@sidebar/[...sidebarPath]/page',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: [\n-          'shop',\n-          'electronics',\n-          '@modal',\n-          'photo',\n-          'gallery',\n-          '@sidebar',\n-          'filters',\n-          'brands',\n-          'page',\n-        ],\n-        type: 'c',\n-        treeSegment: [\n-          'slug',\n-          'shop/electronics/@modal/photo/gallery/@sidebar/filters/brands/page',\n-          'c',\n-        ],\n-      })\n-    })\n-\n-    it('should handle parallel routes with missing catchall in parallel segment', () => {\n-      const params: Params = {\n-        category: 'electronics',\n-        // modalPath is missing\n-      }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/shop/[category]/@modal/[...modalPath]/content',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: ['shop', 'electronics', '@modal', 'modalPath', 'content'],\n-        type: 'c',\n-        treeSegment: ['slug', 'shop/electronics/@modal/modalPath/content', 'c'],\n-      })\n-    })\n   })\n \n   describe('optional catchall parameters (oc)', () => {\n     it('should handle array of values for optional catchall', () => {\n       const params: Params = { slug: ['api', 'users', 'create'] }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'oc',\n-        '/api/[[...slug]]',\n-        null\n-      )\n+      const result = getDynamicParam(params, 'slug', 'oc', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -403,13 +154,7 @@ describe('getDynamicParam', () => {\n \n     it('should return null value for optional catchall without value', () => {\n       const params: Params = {}\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'oc',\n-        '/api/[[...slug]]',\n-        null\n-      )\n+      const result = getDynamicParam(params, 'slug', 'oc', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -421,13 +166,7 @@ describe('getDynamicParam', () => {\n \n     it('should encode array values for optional catchall', () => {\n       const params: Params = { slug: ['hello world', 'caf�'] }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'oc',\n-        '/api/[[...slug]]',\n-        null\n-      )\n+      const result = getDynamicParam(params, 'slug', 'oc', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -439,13 +178,7 @@ describe('getDynamicParam', () => {\n \n     it('should handle single string value for optional catchall', () => {\n       const params: Params = { slug: 'documentation' }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'oc',\n-        '/docs/[[...slug]]',\n-        null\n-      )\n+      const result = getDynamicParam(params, 'slug', 'oc', null)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -467,7 +200,7 @@ describe('getDynamicParam', () => {\n         params,\n         'slug',\n         'd',\n-        '/blog/[slug]',\n+\n         fallbackParams\n       )\n \n@@ -489,7 +222,7 @@ describe('getDynamicParam', () => {\n         params,\n         'slug',\n         'd',\n-        '/blog/[slug]',\n+\n         fallbackParams\n       )\n \n@@ -502,13 +235,7 @@ describe('getDynamicParam', () => {\n         slug: ['%%drp:slug:def456%%', 'c'],\n       })\n \n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/docs/[...slug]',\n-        fallbackParams\n-      )\n+      const result = getDynamicParam(params, 'slug', 'c', fallbackParams)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -524,13 +251,7 @@ describe('getDynamicParam', () => {\n         slug: ['%%drp:slug:ghi789%%', 'oc'],\n       })\n \n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'oc',\n-        '/api/[[...slug]]',\n-        fallbackParams\n-      )\n+      const result = getDynamicParam(params, 'slug', 'oc', fallbackParams)\n \n       expect(result).toEqual({\n         param: 'slug',\n@@ -550,7 +271,7 @@ describe('getDynamicParam', () => {\n         params,\n         'slug',\n         'd',\n-        '/blog/[slug]',\n+\n         fallbackParams\n       )\n \n@@ -563,69 +284,20 @@ describe('getDynamicParam', () => {\n       const params: Params = { slug: '' }\n \n       expect(() => {\n-        getDynamicParam(params, 'slug', 'd', '/blog/[slug]', null)\n+        getDynamicParam(params, 'slug', 'd', null)\n       }).toThrow(InvariantError)\n       expect(() => {\n-        getDynamicParam(params, 'slug', 'd', '/blog/[slug]', null)\n-      }).toThrow('Unexpected dynamic param type: d')\n-    })\n-\n-    it('should handle empty array for catchall', () => {\n-      const params: Params = { slug: [] }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/docs/guide/tutorial',\n-        null\n+        getDynamicParam(params, 'slug', 'd', null)\n+      }).toThrow(\n+        `Invariant: Missing value for segment key: \"slug\" with dynamic param type: d. This is a bug in Next.js.`\n       )\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: [],\n-        type: 'c',\n-        treeSegment: ['slug', '', 'c'],\n-      })\n-    })\n-\n-    it('should handle complex pagePath parsing for catchall', () => {\n-      const params: Params = {\n-        category: 'electronics',\n-        brand: 'apple',\n-      }\n-      const result = getDynamicParam(\n-        params,\n-        'slug',\n-        'c',\n-        '/shop/[category]/[brand]/products/featured',\n-        null\n-      )\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: ['shop', 'electronics', 'apple', 'products', 'featured'],\n-        type: 'c',\n-        treeSegment: ['slug', 'shop/electronics/apple/products/featured', 'c'],\n-      })\n-    })\n-\n-    it('should handle root path for catchall without value', () => {\n-      const params: Params = {}\n-      const result = getDynamicParam(params, 'slug', 'c', '/', null)\n-\n-      expect(result).toEqual({\n-        param: 'slug',\n-        value: [''],\n-        type: 'c',\n-        treeSegment: ['slug', '', 'c'],\n-      })\n     })\n \n     it('should handle undefined param values', () => {\n       const params: Params = { slug: undefined }\n \n       expect(() => {\n-        getDynamicParam(params, 'slug', 'd', '/blog/[slug]', null)\n+        getDynamicParam(params, 'slug', 'd', null)\n       }).toThrow(InvariantError)\n     })\n   })\n@@ -730,3 +402,61 @@ describe('parseMatchedParameter', () => {\n     })\n   })\n })\n+\n+describe('interpolateParallelRouteParams', () => {\n+  it('should interpolate parallel route params', () => {\n+    const loaderTree = [\n+      '',\n+      {\n+        children: [\n+          'optional-catch-all',\n+          {\n+            children: [\n+              '[[...path]]',\n+              {\n+                children: [\n+                  '__PAGE__',\n+                  {},\n+                  {\n+                    page: [\n+                      null,\n+                      '/private/var/folders/xy/84vxj27s21x2brb851sdl_5c0000gn/T/next-install-1265b780415069863d37bb613af21623e2ce3eecc0c3a770cbbc66e0a4cf18aa/app/optional-catch-all/[[...path]]/page.tsx',\n+                    ],\n+                  },\n+                ],\n+              },\n+              {\n+                layout: [\n+                  null,\n+                  '/private/var/folders/xy/84vxj27s21x2brb851sdl_5c0000gn/T/next-install-1265b780415069863d37bb613af21623e2ce3eecc0c3a770cbbc66e0a4cf18aa/app/optional-catch-all/[[...path]]/layout.tsx',\n+                ],\n+              },\n+            ],\n+          },\n+          {},\n+        ],\n+      },\n+      {\n+        'global-error': [\n+          null,\n+          'next/dist/client/components/builtin/global-error.js',\n+        ],\n+        'not-found': [null, 'next/dist/client/components/builtin/not-found.js'],\n+        forbidden: [null, 'next/dist/client/components/builtin/forbidden.js'],\n+        unauthorized: [\n+          null,\n+          'next/dist/client/components/builtin/unauthorized.js',\n+        ],\n+      },\n+    ] as unknown as LoaderTree\n+\n+    expect(\n+      interpolateParallelRouteParams(\n+        loaderTree,\n+        {},\n+        '/optional-catch-all/[[...path]]',\n+        null\n+      )\n+    ).toEqual({})\n+  })\n+})"
        },
        {
            "sha": "093c4a97d0377a938c19d5b083467e0c1a972595",
            "filename": "packages/next/src/shared/lib/router/utils/get-dynamic-param.ts",
            "status": "modified",
            "additions": 105,
            "deletions": 54,
            "changes": 159,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-dynamic-param.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-dynamic-param.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-dynamic-param.ts?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -1,27 +1,30 @@\n import type { DynamicParam } from '../../../../server/app-render/app-render'\n+import type { LoaderTree } from '../../../../server/lib/app-dir-module'\n import type { OpaqueFallbackRouteParams } from '../../../../server/request/fallback-params'\n import type { Params } from '../../../../server/request/params'\n import type { DynamicParamTypesShort } from '../../app-router-types'\n import { InvariantError } from '../../invariant-error'\n+import { parseLoaderTree } from './parse-loader-tree'\n+import { getSegmentParam } from './get-segment-param'\n \n /**\n  * Gets the value of a param from the params object. This correctly handles the\n  * case where the param is a fallback route param and encodes the resulting\n  * value.\n  *\n- * @param params - The params object.\n+ * @param interpolatedParams - The params object.\n  * @param segmentKey - The key of the segment.\n  * @param fallbackRouteParams - The fallback route params.\n  * @returns The value of the param.\n  */\n function getParamValue(\n-  params: Params,\n+  interpolatedParams: Params,\n   segmentKey: string,\n   fallbackRouteParams: OpaqueFallbackRouteParams | null\n ) {\n-  let value = params[segmentKey]\n+  let value = interpolatedParams[segmentKey]\n \n-  if (fallbackRouteParams && fallbackRouteParams.has(segmentKey)) {\n+  if (fallbackRouteParams?.has(segmentKey)) {\n     // We know that the fallback route params has the segment key because we\n     // checked that above.\n     const [searchValue] = fallbackRouteParams.get(segmentKey)!\n@@ -35,6 +38,92 @@ function getParamValue(\n   return value\n }\n \n+export function interpolateParallelRouteParams(\n+  loaderTree: LoaderTree,\n+  params: Params,\n+  pagePath: string,\n+  fallbackRouteParams: OpaqueFallbackRouteParams | null\n+) {\n+  const interpolated = structuredClone(params)\n+\n+  // Stack-based traversal with depth tracking\n+  const stack: Array<{ tree: LoaderTree; depth: number }> = [\n+    { tree: loaderTree, depth: 0 },\n+  ]\n+\n+  // Derive value from pagePath based on depth and parameter type\n+  const pathSegments = pagePath.split('/').slice(1) // Remove first empty string\n+\n+  while (stack.length > 0) {\n+    const { tree, depth } = stack.pop()!\n+    const { segment, parallelRoutes } = parseLoaderTree(tree)\n+\n+    // Check if current segment contains a parameter\n+    const segmentParam = getSegmentParam(segment)\n+    if (\n+      segmentParam &&\n+      !interpolated.hasOwnProperty(segmentParam.param) &&\n+      // If the param is in the fallback route params, we don't need to\n+      // interpolate it because it's already marked as being unknown.\n+      !fallbackRouteParams?.has(segmentParam.param)\n+    ) {\n+      switch (segmentParam.type) {\n+        case 'catchall':\n+        case 'optional-catchall':\n+        case 'catchall-intercepted':\n+          // For catchall parameters, take all remaining segments from this depth\n+          const remainingSegments = pathSegments.slice(depth)\n+\n+          // Process each segment to handle any dynamic params\n+          const processedSegments = remainingSegments\n+            .flatMap((pathSegment) => {\n+              const param = getSegmentParam(pathSegment)\n+              // If the segment matches a param, return the param value otherwise,\n+              // it's a static segment, so just return that. We don't use the\n+              // `getParamValue` function here because we don't want the values to\n+              // be encoded, that's handled on get by the `getDynamicParam`\n+              // function.\n+              return param ? interpolated[param.param] : pathSegment\n+            })\n+            .filter((s) => s !== undefined)\n+\n+          if (processedSegments.length > 0) {\n+            interpolated[segmentParam.param] = processedSegments\n+          }\n+          break\n+        case 'dynamic':\n+        case 'dynamic-intercepted':\n+          // For regular dynamic parameters, take the segment at this depth\n+          if (depth < pathSegments.length) {\n+            const pathSegment = pathSegments[depth]\n+            const param = getSegmentParam(pathSegment)\n+\n+            interpolated[segmentParam.param] = param\n+              ? interpolated[param.param]\n+              : pathSegment\n+          }\n+          break\n+        default:\n+          segmentParam.type satisfies never\n+      }\n+    }\n+\n+    // Calculate next depth - increment if this is not a route group and not empty\n+    let nextDepth = depth\n+    const isRouteGroup = segment.startsWith('(') && segment.endsWith(')')\n+    if (!isRouteGroup && segment !== '') {\n+      nextDepth++\n+    }\n+\n+    // Add all parallel routes to the stack for processing\n+    for (const route of Object.values(parallelRoutes)) {\n+      stack.push({ tree: route, depth: nextDepth })\n+    }\n+  }\n+\n+  return interpolated\n+}\n+\n /**\n  *\n  * Shared logic on client and server for creating a dynamic param value.\n@@ -47,70 +136,32 @@ function getParamValue(\n  * and optional is, alas, unfortunate.\n  */\n export function getDynamicParam(\n-  params: Params,\n+  interpolatedParams: Params,\n   segmentKey: string,\n   dynamicParamType: DynamicParamTypesShort,\n-  pagePath: string,\n   fallbackRouteParams: OpaqueFallbackRouteParams | null\n ): DynamicParam {\n   let value: string | string[] | undefined = getParamValue(\n-    params,\n+    interpolatedParams,\n     segmentKey,\n     fallbackRouteParams\n   )\n \n-  if (!value) {\n-    const isCatchall = dynamicParamType === 'c'\n-    const isOptionalCatchall = dynamicParamType === 'oc'\n-\n-    if (isCatchall || isOptionalCatchall) {\n-      // handle the case where an optional catchall does not have a value,\n-      // e.g. `/dashboard/[[...slug]]` when requesting `/dashboard`\n-      if (isOptionalCatchall) {\n-        return {\n-          param: segmentKey,\n-          value: null,\n-          type: dynamicParamType,\n-          treeSegment: [segmentKey, '', dynamicParamType],\n-        }\n-      }\n-\n-      // handle the case where a catchall or optional catchall does not have a value,\n-      // e.g. `/foo/bar/hello` and `@slot/[...catchall]` or `@slot/[[...catchall]]` is matched\n-      // FIXME: (NAR-335) this should handle prefixed segments\n-      value = pagePath\n-        .split('/')\n-        // remove the first empty string\n-        .slice(1)\n-        // replace any dynamic params with the actual values\n-        .flatMap((pathSegment) => {\n-          const param = parseParameter(pathSegment)\n-\n-          // if the segment matches a param, return the param value\n-          // otherwise, it's a static segment, so just return that\n-          return (\n-            getParamValue(params, param.key, fallbackRouteParams) ?? param.key\n-          )\n-        })\n-\n-      if (!value) {\n-        throw new InvariantError(\n-          `No value found for segment key: \"${segmentKey}\"`\n-        )\n-      }\n-\n+  // handle the case where an optional catchall does not have a value,\n+  // e.g. `/dashboard/[[...slug]]` when requesting `/dashboard`\n+  if (!value || value.length === 0) {\n+    if (dynamicParamType === 'oc') {\n       return {\n         param: segmentKey,\n-        value,\n+        value: null,\n         type: dynamicParamType,\n-        // This value always has to be a string.\n-        treeSegment: [segmentKey, value.join('/'), dynamicParamType],\n+        treeSegment: [segmentKey, '', dynamicParamType],\n       }\n-    } else {\n-      throw new InvariantError(\n-        `Unexpected dynamic param type: ${dynamicParamType}`\n-      )\n     }\n+\n+    throw new InvariantError(\n+      `Missing value for segment key: \"${segmentKey}\" with dynamic param type: ${dynamicParamType}`\n+    )\n   }\n \n   return {"
        },
        {
            "sha": "abd5877a8c58ee0b6c7a2d63d372fa9d38a6de0e",
            "filename": "packages/next/src/shared/lib/router/utils/get-segment-param.tsx",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-segment-param.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-segment-param.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fget-segment-param.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -1,5 +1,5 @@\n-import { INTERCEPTION_ROUTE_MARKERS } from '../../shared/lib/router/utils/interception-routes'\n-import type { DynamicParamTypes } from '../../shared/lib/app-router-types'\n+import { INTERCEPTION_ROUTE_MARKERS } from './interception-routes'\n+import type { DynamicParamTypes } from '../../app-router-types'\n \n /**\n  * Parse dynamic route segment to type of parameter",
            "previous_filename": "packages/next/src/server/app-render/get-segment-param.tsx"
        },
        {
            "sha": "27280fee4895970b1e40bbadc019576adfbb6721",
            "filename": "packages/next/src/shared/lib/router/utils/parse-loader-tree.ts",
            "status": "renamed",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fparse-loader-tree.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fparse-loader-tree.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fparse-loader-tree.ts?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -1,5 +1,5 @@\n-import { DEFAULT_SEGMENT_KEY } from '../../shared/lib/segment'\n-import type { LoaderTree } from '../lib/app-dir-module'\n+import { DEFAULT_SEGMENT_KEY } from '../../segment'\n+import type { LoaderTree } from '../../../../server/lib/app-dir-module'\n \n export function parseLoaderTree(tree: LoaderTree) {\n   const [segment, parallelRoutes, modules] = tree",
            "previous_filename": "packages/next/src/server/app-render/parse-loader-tree.ts"
        },
        {
            "sha": "b2aaa2a6d9c1f71afe1aec4a23ea8a154f49de25",
            "filename": "test/e2e/app-dir/parallel-route-navigations/app/[teamID]/@slot/[...catchAll]/page.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2F%40slot%2F%5B...catchAll%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2F%40slot%2F%5B...catchAll%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2F%40slot%2F%5B...catchAll%5D%2Fpage.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,12 @@\n+import Component from '../../../component'\n+\n+export default async function Page(props: {\n+  params: Promise<Record<string, string | string[]>>\n+}) {\n+  return (\n+    <Component\n+      file=\"/[teamID]/@slot/[...catchAll]/page.tsx\"\n+      params={props.params}\n+    />\n+  )\n+}"
        },
        {
            "sha": "bcc9478d0f40407e846b0648c02de11b22fdaa87",
            "filename": "test/e2e/app-dir/parallel-route-navigations/app/[teamID]/layout.tsx",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2Flayout.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,21 @@\n+import Link from 'next/link'\n+\n+export default function Layout(props: {\n+  slot: React.ReactNode\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <div>\n+      <ul>\n+        <li>\n+          <Link href=\"/vercel/sub/folder\">/vercel/sub/folder</Link>\n+        </li>\n+        <li>\n+          <Link href=\"/vercel/sub/other-folder\">/vercel/sub/other-folder</Link>\n+        </li>\n+      </ul>\n+      <div data-slot>{props.slot}</div>\n+      <div data-children>{props.children}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "76a2a245cc9c1b703c4316f753ac218176d1cced",
            "filename": "test/e2e/app-dir/parallel-route-navigations/app/[teamID]/sub/folder/page.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2Fsub%2Ffolder%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2Fsub%2Ffolder%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2Fsub%2Ffolder%2Fpage.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,9 @@\n+import Component from '../../../component'\n+\n+export default async function Page(props: {\n+  params: Promise<Record<string, string | string[]>>\n+}) {\n+  return (\n+    <Component file=\"/[teamID]/sub/folder/page.tsx\" params={props.params} />\n+  )\n+}"
        },
        {
            "sha": "39336ba09238177c37ae13bd752e9f2f445b0343",
            "filename": "test/e2e/app-dir/parallel-route-navigations/app/[teamID]/sub/other-folder/page.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2Fsub%2Fother-folder%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2Fsub%2Fother-folder%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2F%5BteamID%5D%2Fsub%2Fother-folder%2Fpage.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,12 @@\n+import Component from '../../../component'\n+\n+export default async function Page(props: {\n+  params: Promise<Record<string, string | string[]>>\n+}) {\n+  return (\n+    <Component\n+      file=\"/[teamID]/sub/other-folder/page.tsx\"\n+      params={props.params}\n+    />\n+  )\n+}"
        },
        {
            "sha": "3ae255e60841dc239476374bb33ffbf0b2d66190",
            "filename": "test/e2e/app-dir/parallel-route-navigations/app/component.client.tsx",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Fcomponent.client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Fcomponent.client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Fcomponent.client.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,15 @@\n+'use client'\n+\n+import { useParams } from 'next/navigation'\n+\n+export default function ComponentClient(props: { file: string }) {\n+  const params = useParams()\n+  return (\n+    <code\n+      data-client-file={props.file}\n+      data-client-params={JSON.stringify(params)}\n+    >\n+      {JSON.stringify(params)}\n+    </code>\n+  )\n+}"
        },
        {
            "sha": "886ddbd742d1f62c1fa8df3fa9180f753b6b7212",
            "filename": "test/e2e/app-dir/parallel-route-navigations/app/component.tsx",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Fcomponent.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Fcomponent.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Fcomponent.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,34 @@\n+import { Suspense } from 'react'\n+import ComponentClient from './component.client'\n+\n+type Props = {\n+  file: string\n+  params: Promise<Record<string, string | string[]>>\n+}\n+\n+async function ComponentServer(props: Props) {\n+  const params = await props.params\n+  return (\n+    <code\n+      data-server-file={props.file}\n+      data-server-params={JSON.stringify(params)}\n+    >\n+      {JSON.stringify(params)}\n+    </code>\n+  )\n+}\n+\n+export default function Component(props: Props) {\n+  return (\n+    <div data-file={props.file}>\n+      <div>File: {props.file}</div>\n+\n+      <Suspense fallback={<div data-loading>Loading Server...</div>}>\n+        <ComponentServer {...props} />\n+      </Suspense>\n+      <Suspense fallback={<div data-loading>Loading Client...</div>}>\n+        <ComponentClient file={props.file} />\n+      </Suspense>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "52a5c250544749bad51b4b897ba450af61ebabca",
            "filename": "test/e2e/app-dir/parallel-route-navigations/app/layout.css",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Flayout.css",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Flayout.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Flayout.css?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,10 @@\n+[data-loading] {\n+  background-color: red;\n+}\n+\n+[data-file] {\n+  font-family: monospace;\n+  padding: 10px;\n+  background-color: blue;\n+  color: white;\n+}"
        },
        {
            "sha": "a81bd1e76bd944e559a5f309c6f2045201ce1060",
            "filename": "test/e2e/app-dir/parallel-route-navigations/app/layout.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fapp%2Flayout.tsx?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,9 @@\n+import './layout.css'\n+\n+export default function Layout(props: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>{props.children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/e2e/app-dir/parallel-route-navigations/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fnext.config.js?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "4aa54e7a70987feb8476f11cf7a92dba5da0bf13",
            "filename": "test/e2e/app-dir/parallel-route-navigations/parallel-route-navigations.test.ts",
            "status": "added",
            "additions": 140,
            "deletions": 0,
            "changes": 140,
            "blob_url": "https://github.com/vercel/next.js/blob/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fparallel-route-navigations.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6cecc7546480c43fdab6a6bbbd14a0ed8372f40f/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fparallel-route-navigations.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-route-navigations%2Fparallel-route-navigations.test.ts?ref=6cecc7546480c43fdab6a6bbbd14a0ed8372f40f",
            "patch": "@@ -0,0 +1,140 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { retry } from 'next-test-utils'\n+import { setTimeout } from 'node:timers/promises'\n+\n+async function stable(action: () => Promise<void>, stableForMS: number = 1000) {\n+  // Wait for it to reach the initial state.\n+  await retry(async () => {\n+    await action()\n+  })\n+\n+  // Wait for the stableForMS to ensure that it doesn't change.\n+  for (let i = 0; i < 10; i++) {\n+    await action()\n+    await setTimeout(stableForMS / 10)\n+  }\n+}\n+\n+describe('parallel-route-navigations', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  // We're skipping this in development because there's no prefetching\n+  // during development.\n+  if (isNextDev) {\n+    it.skip('skipping in dev', async () => {\n+      await Promise.resolve()\n+    })\n+    return\n+  }\n+\n+  it('should render the right parameters on the server', async () => {\n+    const $ = await next.render$('/vercel/sub/folder')\n+\n+    expect({\n+      client: $(\n+        '[data-client-file=\"/[teamID]/@slot/[...catchAll]/page.tsx\"][data-client-params]'\n+      ).data('client-params'),\n+      server: $(\n+        '[data-server-file=\"/[teamID]/@slot/[...catchAll]/page.tsx\"][data-server-params]'\n+      ).data('server-params'),\n+    }).toEqual({\n+      client: {\n+        teamID: 'vercel',\n+        catchAll: ['sub', 'folder'],\n+      },\n+      server: {\n+        teamID: 'vercel',\n+        catchAll: ['sub', 'folder'],\n+      },\n+    })\n+  })\n+\n+  it('should render the right parameters on client navigations', async () => {\n+    let hadLocked = 0\n+    let lock: Promise<void> | false = false\n+\n+    const browser = await next.browser('/vercel/sub/folder', {\n+      beforePageLoad(page) {\n+        page.route('**/*', async (route, request) => {\n+          if (lock) {\n+            hadLocked++\n+            await lock\n+          }\n+\n+          await route.continue()\n+        })\n+      },\n+    })\n+\n+    // Wait for the network idle state, then pause the network requests to the\n+    // other folder. This will let us inspect the pre-dynamic render navigation\n+    // state.\n+    await browser.waitForIdleNetwork()\n+\n+    let unlock: () => void\n+    lock = new Promise((resolve) => {\n+      unlock = resolve\n+    })\n+\n+    // Click the navigation link, and wait for the new page component to load.\n+    await browser.elementByCss('a[href=\"/vercel/sub/other-folder\"]').click()\n+\n+    // If it's PPR or Cache Components, we'll see an immediate transition for\n+    // the client component.\n+    if (\n+      process.env.__NEXT_EXPERIMENTAL_PPR === 'true' ||\n+      process.env.__NEXT_EXPERIMENTAL_CACHE_COMPONENTS === 'true'\n+    ) {\n+      await browser.waitForElementByCss(\n+        '[data-file=\"/[teamID]/sub/other-folder/page.tsx\"]'\n+      )\n+\n+      // Now we should look at the dom and see what the parameters are set to.\n+      const client = await browser\n+        .elementByCss(\n+          '[data-client-file=\"/[teamID]/@slot/[...catchAll]/page.tsx\"][data-client-params]'\n+        )\n+        .getAttribute('data-client-params')\n+\n+      expect(JSON.parse(client)).toEqual({\n+        teamID: 'vercel',\n+        catchAll: ['sub', 'other-folder'],\n+      })\n+    }\n+\n+    // Wait for the dynamic RSC request to lock, then unlock that request.\n+    await stable(async () => {\n+      if (\n+        process.env.__NEXT_EXPERIMENTAL_PPR === 'true' ||\n+        process.env.__NEXT_EXPERIMENTAL_CACHE_COMPONENTS === 'true' ||\n+        process.env.__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE === 'true'\n+      ) {\n+        // When we're in PPR or Cache Components, we'll see one dynamic\n+        // request.\n+        expect(hadLocked).toBe(1)\n+      } else {\n+        // When we're not in PPR or Cache Components, we'll see two dynamic\n+        // requests. One made to refetch each of the slots.\n+        expect(hadLocked).toBe(2)\n+      }\n+    })\n+    unlock()\n+\n+    // Now we should look at the dom and see what the parameters are set to and\n+    // that they remain the same.\n+    await stable(async () => {\n+      const client = await browser\n+        .elementByCss(\n+          '[data-client-file=\"/[teamID]/@slot/[...catchAll]/page.tsx\"][data-client-params]'\n+        )\n+        .getAttribute('data-client-params')\n+\n+      expect(JSON.parse(client)).toEqual({\n+        teamID: 'vercel',\n+        catchAll: ['sub', 'other-folder'],\n+      })\n+    })\n+  })\n+})"
        }
    ],
    "stats": {
        "total": 966,
        "additions": 514,
        "deletions": 452
    }
}