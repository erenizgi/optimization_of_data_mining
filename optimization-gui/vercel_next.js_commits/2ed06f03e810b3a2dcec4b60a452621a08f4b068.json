{
    "author": "lubieowoce",
    "message": "label as Prefetch/Prefetchable depending on prefetch config (#85076)\n\nTweaks the environment label logic to only use label things as\n`Prefetch` if there's a runtime prefetch config. If there's none, we\nlabel it as `Prefetchable` instead.\n\n---------\n\nCo-authored-by: Josh Story <story@hey.com>",
    "sha": "2ed06f03e810b3a2dcec4b60a452621a08f4b068",
    "files": [
        {
            "sha": "ac30834f215f934ab2649fc4bda4a2d4592aef21",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 15,
            "deletions": 3,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -212,6 +212,7 @@ import { createPromiseWithResolvers } from '../../shared/lib/promise-with-resolv\n import { ImageConfigContext } from '../../shared/lib/image-config-context.shared-runtime'\n import { imageConfigDefault } from '../../shared/lib/image-config'\n import { RenderStage, StagedRenderingController } from './staged-rendering'\n+import { anySegmentHasRuntimePrefetchEnabled } from './staged-validation'\n \n export type GetDynamicParamFromSegment = (\n   // [slug] / [[slug]] / [...slug]\n@@ -2767,7 +2768,16 @@ async function renderWithRestartOnCacheMissInDev(\n   getPayload: (requestStore: RequestStore) => Promise<RSCPayload>,\n   onError: (error: unknown) => void\n ) {\n-  const { htmlRequestId, renderOpts, requestId } = ctx\n+  const {\n+    htmlRequestId,\n+    renderOpts,\n+    requestId,\n+    componentMod: {\n+      routeModule: {\n+        userland: { loaderTree },\n+      },\n+    },\n+  } = ctx\n   const {\n     clientReferenceManifest,\n     ComponentMod,\n@@ -2776,6 +2786,9 @@ async function renderWithRestartOnCacheMissInDev(\n   } = renderOpts\n   assertClientReferenceManifest(clientReferenceManifest)\n \n+  const hasRuntimePrefetch =\n+    await anySegmentHasRuntimePrefetchEnabled(loaderTree)\n+\n   // If the render is restarted, we'll recreate a fresh request store\n   let requestStore: RequestStore = initialRequestStore\n \n@@ -2785,8 +2798,7 @@ async function renderWithRestartOnCacheMissInDev(\n       case RenderStage.Static:\n         return 'Prerender'\n       case RenderStage.Runtime:\n-        // TODO: only label as \"Prefetch\" if the page has a `prefetch` config.\n-        return 'Prefetch'\n+        return hasRuntimePrefetch ? 'Prefetch' : 'Prefetchable'\n       case RenderStage.Dynamic:\n         return 'Server'\n       default:"
        },
        {
            "sha": "6e71905c17305bd46fb27565c20a04f58de82e21",
            "filename": "packages/next/src/server/app-render/staged-validation.tsx",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fstaged-validation.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fstaged-validation.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fstaged-validation.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,32 @@\n+import { getLayoutOrPageModule } from '../lib/app-dir-module'\n+import type { LoaderTree } from '../lib/app-dir-module'\n+import { parseLoaderTree } from '../../shared/lib/router/utils/parse-loader-tree'\n+import type { AppSegmentConfig } from '../../build/segment-config/app/app-segment-config'\n+\n+export async function anySegmentHasRuntimePrefetchEnabled(\n+  tree: LoaderTree\n+): Promise<boolean> {\n+  const { mod: layoutOrPageMod } = await getLayoutOrPageModule(tree)\n+\n+  // TODO(restart-on-cache-miss): Does this work correctly for client page/layout modules?\n+  const prefetchConfig = layoutOrPageMod\n+    ? (layoutOrPageMod as AppSegmentConfig).unstable_prefetch\n+    : undefined\n+  /** Whether this segment should use a runtime prefetch instead of a static prefetch. */\n+  const hasRuntimePrefetch = prefetchConfig?.mode === 'runtime'\n+  if (hasRuntimePrefetch) {\n+    return true\n+  }\n+\n+  const { parallelRoutes } = parseLoaderTree(tree)\n+  for (const parallelRouteKey in parallelRoutes) {\n+    const parallelRoute = parallelRoutes[parallelRouteKey]\n+    const hasChildRuntimePrefetch =\n+      await anySegmentHasRuntimePrefetchEnabled(parallelRoute)\n+    if (hasChildRuntimePrefetch) {\n+      return true\n+    }\n+  }\n+\n+  return false\n+}"
        },
        {
            "sha": "6f28637cfacdb6935c37affd125b1140803ac54c",
            "filename": "test/development/app-dir/cache-components-dev-warmup/cache-components.dev-warmup.test.ts",
            "status": "modified",
            "additions": 271,
            "deletions": 223,
            "changes": 494,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Fcache-components.dev-warmup.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Fcache-components.dev-warmup.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Fcache-components.dev-warmup.test.ts?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -1,234 +1,305 @@\n import { nextTestSetup } from 'e2e-utils'\n import { retry } from 'next-test-utils'\n+import * as nodePath from 'node:path'\n import type { Playwright } from '../../../lib/next-webdriver'\n \n-describe('cache-components-dev-warmup', () => {\n-  const { next, isTurbopack } = nextTestSetup({\n-    files: __dirname,\n-  })\n-\n-  // Restart the dev server for each test to clear the in-memory cache.\n-  // We're testing cache-warming behavior here, so we don't want tests to interfere with each other.\n-  let isFirstTest = true\n-  beforeEach(async () => {\n-    if (isFirstTest) {\n-      // There's no point restarting if this is the first test.\n-      isFirstTest = false\n-      return\n-    }\n+describe.each([\n+  {\n+    description: 'without runtime prefetch configs',\n+    hasRuntimePrefetch: false,\n+    fixturePath: 'fixtures/without-prefetch-config',\n+  },\n+  {\n+    description: 'with runtime prefetch configs',\n+    hasRuntimePrefetch: true,\n+    fixturePath: 'fixtures/with-prefetch-config',\n+  },\n+])(\n+  'cache-components-dev-warmup - $description',\n+  ({ fixturePath, hasRuntimePrefetch }) => {\n+    const { next, isTurbopack } = nextTestSetup({\n+      files: nodePath.join(__dirname, fixturePath),\n+    })\n \n-    await next.stop()\n-    await next.clean()\n-    await next.start()\n-  })\n-\n-  function assertLog(\n-    logs: Array<{ source: string; message: string }>,\n-    message: string,\n-    expectedEnvironment: string\n-  ) {\n-    // Match logs that contain the message, with any environment.\n-    const logPattern = new RegExp(\n-      `^(?=.*\\\\b${message}\\\\b)(?=.*\\\\b(Cache|Prerender|Prefetch|Server)\\\\b).*`\n-    )\n-    const logMessages = logs.map((log) => log.message)\n-    const messages = logMessages.filter((message) => logPattern.test(message))\n-\n-    // If there's zero or more than one logs that match, the test is not set up correctly.\n-    if (messages.length === 0) {\n-      throw new Error(\n-        `Found no logs matching '${message}':\\n\\n${logMessages.map((s, i) => `${i}. ${s}`).join('\\n')}}`\n-      )\n-    }\n-    if (messages.length > 1) {\n-      throw new Error(\n-        `Found multiple logs matching '${message}':\\n\\n${messages.map((s, i) => `${i}. ${s}`).join('\\n')}`\n+    // Restart the dev server for each test to clear the in-memory cache.\n+    // We're testing cache-warming behavior here, so we don't want tests to interfere with each other.\n+    let isFirstTest = true\n+    beforeEach(async () => {\n+      if (isFirstTest) {\n+        // There's no point restarting if this is the first test.\n+        isFirstTest = false\n+        return\n+      }\n+\n+      await next.stop()\n+      await next.clean()\n+      await next.start()\n+    })\n+\n+    function assertLog(\n+      logs: Array<{ source: string; message: string }>,\n+      message: string,\n+      expectedEnvironment: string\n+    ) {\n+      // Match logs that contain the message, with any environment.\n+      const logPattern = new RegExp(\n+        `^(?=.*\\\\b${message}\\\\b)(?=.*\\\\b(Cache|Prerender|Prefetch|Prefetchable|Server)\\\\b).*`\n       )\n+      const logMessages = logs.map((log) => log.message)\n+      const messages = logMessages.filter((message) => logPattern.test(message))\n+\n+      // If there's zero or more than one logs that match, the test is not set up correctly.\n+      if (messages.length === 0) {\n+        throw new Error(\n+          `Found no logs matching '${message}':\\n\\n${logMessages.map((s, i) => `${i}. ${s}`).join('\\n')}}`\n+        )\n+      }\n+      if (messages.length > 1) {\n+        throw new Error(\n+          `Found multiple logs matching '${message}':\\n\\n${messages.map((s, i) => `${i}. ${s}`).join('\\n')}`\n+        )\n+      }\n+\n+      // The message should have the expected environment.\n+      const actualMessageText = messages[0]\n+      const [, actualEnvironment] = actualMessageText.match(logPattern)!\n+      expect([actualEnvironment, actualMessageText]).toEqual([\n+        expectedEnvironment,\n+        expect.stringContaining(message),\n+      ])\n     }\n \n-    // The message should have the expected environment.\n-    const actualMessageText = messages[0]\n-    const [, actualEnvironment] = actualMessageText.match(logPattern)!\n-    expect([actualEnvironment, actualMessageText]).toEqual([\n-      expectedEnvironment,\n-      expect.stringContaining(message),\n-    ])\n-  }\n+    async function testInitialLoad(\n+      path: string,\n+      assertLogs: (browser: Playwright) => Promise<void>\n+    ) {\n+      const browser = await next.browser(path)\n \n-  async function testInitialLoad(\n-    path: string,\n-    assertLogs: (browser: Playwright) => Promise<void>\n-  ) {\n-    const browser = await next.browser(path)\n-\n-    // Initial load.\n-    await retry(() => assertLogs(browser))\n-\n-    // After another load (with warm caches) the logs should be the same.\n-    await browser.loadPage(next.url + path) // clears old logs\n-    await retry(() => assertLogs(browser))\n-\n-    if (isTurbopack) {\n-      // FIXME:\n-      // In Turbopack, requests to the /revalidate route seem to occasionally crash\n-      // due to some HMR or compilation issue. `revalidatePath` throws this error:\n-      //\n-      //   Invariant: static generation store missing in revalidatePath <path>\n-      //\n-      // This is unrelated to the logic being tested here, so for now, we skip the assertions\n-      // that require us to revalidate.\n-      console.log('WARNING: skipping revalidation assertions in turbopack')\n-      return\n-    }\n+      // Initial load.\n+      await retry(() => assertLogs(browser))\n \n-    // After a revalidation the subsequent warmup render must discard stale\n-    // cache entries.\n-    // This should not affect the environment labels.\n-    await revalidatePath(path)\n+      // We should not see any errors related to the aborted render.\n+      expect(next.cliOutput).not.toContain(\n+        'AbortError: This operation was aborted'\n+      )\n \n-    await browser.loadPage(next.url + path) // clears old logs\n-    await retry(() => assertLogs(browser))\n-  }\n+      // After another load (with warm caches) the logs should be the same.\n+      await browser.loadPage(next.url + path) // clears old logs\n+      await retry(() => assertLogs(browser))\n \n-  async function testNavigation(\n-    path: string,\n-    assertLogs: (browser: Playwright) => Promise<void>\n-  ) {\n-    const browser = await next.browser('/')\n-\n-    // Initial nav (first time loading the page)\n-    await browser.elementByCss(`a[href=\"${path}\"]`).click()\n-    await retry(() => assertLogs(browser))\n-\n-    // Reload, and perform another nav (with warm caches). the logs should be the same.\n-    await browser.loadPage(next.url + '/') // clears old logs\n-    await browser.elementByCss(`a[href=\"${path}\"]`).click()\n-    await retry(() => assertLogs(browser))\n-\n-    if (isTurbopack) {\n-      // FIXME:\n-      // In Turbopack, requests to the /revalidate route seem to occasionally crash\n-      // due to some HMR or compilation issue. `revalidatePath` throws this error:\n-      //\n-      //   Invariant: static generation store missing in revalidatePath <path>\n-      //\n-      // This is unrelated to the logic being tested here, so for now, we skip the assertions\n-      // that require us to revalidate.\n-      console.log('WARNING: skipping revalidation assertions in turbopack')\n-      return\n-    }\n+      expect(next.cliOutput).not.toContain(\n+        'AbortError: This operation was aborted'\n+      )\n+\n+      if (isTurbopack) {\n+        // FIXME:\n+        // In Turbopack, requests to the /revalidate route seem to occasionally crash\n+        // due to some HMR or compilation issue. `revalidatePath` throws this error:\n+        //\n+        //   Invariant: static generation store missing in revalidatePath <path>\n+        //\n+        // This is unrelated to the logic being tested here, so for now, we skip the assertions\n+        // that require us to revalidate.\n+        console.log('WARNING: skipping revalidation assertions in turbopack')\n+        return\n+      }\n \n-    // After a revalidation the subsequent warmup render must discard stale\n-    // cache entries.\n-    // This should not affect the environment labels.\n-    await revalidatePath(path)\n+      // After a revalidation the subsequent warmup render must discard stale\n+      // cache entries.\n+      // This should not affect the environment labels.\n+      await revalidatePath(path)\n \n-    await browser.loadPage(next.url + '/') // clears old logs\n-    await browser.elementByCss(`a[href=\"${path}\"]`).click()\n-    await retry(() => assertLogs(browser))\n-  }\n+      await browser.loadPage(next.url + path) // clears old logs\n+      await retry(() => assertLogs(browser))\n \n-  async function revalidatePath(path: string) {\n-    const response = await next.fetch(\n-      `/revalidate?path=${encodeURIComponent(path)}`\n-    )\n-    if (!response.ok) {\n-      throw new Error(\n-        `Failed to revalidate path: '${path}' - server responded with status ${response.status}`\n+      // We should not see any errors related to the aborted render.\n+      expect(next.cliOutput).not.toContain(\n+        'AbortError: This operation was aborted'\n       )\n     }\n-  }\n \n-  describe.each([\n-    { description: 'initial load', isInitialLoad: true },\n-    { description: 'navigation', isInitialLoad: false },\n-  ])('$description', ({ isInitialLoad }) => {\n-    describe('cached data resolves in the correct phase', () => {\n-      it('cached data + cached fetch', async () => {\n-        const path = '/simple'\n-        const assertLogs = async (browser: Playwright) => {\n-          const logs = await browser.log()\n-          assertLog(logs, 'after cache read - layout', 'Prerender')\n-          assertLog(logs, 'after cache read - page', 'Prerender')\n-          assertLog(logs, 'after successive cache reads - page', 'Prerender')\n-          assertLog(logs, 'after cached fetch - layout', 'Prerender')\n-          assertLog(logs, 'after cached fetch - page', 'Prerender')\n-\n-          assertLog(logs, 'after uncached fetch - layout', 'Server')\n-          assertLog(logs, 'after uncached fetch - page', 'Server')\n-        }\n+    async function testNavigation(\n+      path: string,\n+      assertLogs: (browser: Playwright) => Promise<void>\n+    ) {\n+      const browser = await next.browser('/')\n \n-        if (isInitialLoad) {\n-          await testInitialLoad(path, assertLogs)\n-        } else {\n-          await testNavigation(path, assertLogs)\n-        }\n-      })\n+      // Initial nav (first time loading the page)\n+      await browser.elementByCss(`a[href=\"${path}\"]`).click()\n+      await retry(() => assertLogs(browser))\n \n-      it('cached data + private cache', async () => {\n-        const path = '/private-cache'\n+      // We should not see any errors related to the aborted render.\n+      expect(next.cliOutput).not.toContain(\n+        'AbortError: This operation was aborted'\n+      )\n \n-        const assertLogs = async (browser: Playwright) => {\n-          const logs = await browser.log()\n-          assertLog(logs, 'after cache read - layout', 'Prerender')\n-          assertLog(logs, 'after cache read - page', 'Prerender')\n+      // Reload, and perform another nav (with warm caches). the logs should be the same.\n+      await browser.loadPage(next.url + '/') // clears old logs\n+      await browser.elementByCss(`a[href=\"${path}\"]`).click()\n+      await retry(() => assertLogs(browser))\n \n-          // Private caches are dynamic holes in static prerenders,\n-          // so they shouldn't resolve in the static stage.\n-          assertLog(logs, 'after private cache read - page', 'Prefetch')\n-          assertLog(logs, 'after private cache read - layout', 'Prefetch')\n-          assertLog(\n-            logs,\n-            'after successive private cache reads - page',\n-            'Prefetch'\n-          )\n-\n-          assertLog(logs, 'after uncached fetch - layout', 'Server')\n-          assertLog(logs, 'after uncached fetch - page', 'Server')\n-        }\n+      expect(next.cliOutput).not.toContain(\n+        'AbortError: This operation was aborted'\n+      )\n \n-        if (isInitialLoad) {\n-          await testInitialLoad(path, assertLogs)\n-        } else {\n-          await testNavigation(path, assertLogs)\n-        }\n-      })\n+      if (isTurbopack) {\n+        // FIXME:\n+        // In Turbopack, requests to the /revalidate route seem to occasionally crash\n+        // due to some HMR or compilation issue. `revalidatePath` throws this error:\n+        //\n+        //   Invariant: static generation store missing in revalidatePath <path>\n+        //\n+        // This is unrelated to the logic being tested here, so for now, we skip the assertions\n+        // that require us to revalidate.\n+        console.log('WARNING: skipping revalidation assertions in turbopack')\n+        return\n+      }\n \n-      it('cached data + short-lived cached data', async () => {\n-        const path = '/short-lived-cache'\n+      // After a revalidation the subsequent warmup render must discard stale\n+      // cache entries.\n+      // This should not affect the environment labels.\n+      await revalidatePath(path)\n \n-        const assertLogs = async (browser: Playwright) => {\n-          const logs = await browser.log()\n-          assertLog(logs, 'after cache read - layout', 'Prerender')\n-          assertLog(logs, 'after cache read - page', 'Prerender')\n+      await browser.loadPage(next.url + '/') // clears old logs\n+      await browser.elementByCss(`a[href=\"${path}\"]`).click()\n+      await retry(() => assertLogs(browser))\n \n-          // Short lived caches are dynamic holes in static prerenders,\n-          // so they shouldn't resolve in the static stage.\n-          assertLog(logs, 'after short-lived cache read - page', 'Prefetch')\n-          assertLog(logs, 'after short-lived cache read - layout', 'Prefetch')\n+      expect(next.cliOutput).not.toContain(\n+        'AbortError: This operation was aborted'\n+      )\n+    }\n \n-          assertLog(logs, 'after uncached fetch - layout', 'Server')\n-          assertLog(logs, 'after uncached fetch - page', 'Server')\n-        }\n+    async function revalidatePath(path: string) {\n+      const response = await next.fetch(\n+        `/revalidate?path=${encodeURIComponent(path)}`\n+      )\n+      if (!response.ok) {\n+        throw new Error(\n+          `Failed to revalidate path: '${path}' - server responded with status ${response.status}`\n+        )\n+      }\n+    }\n \n-        if (isInitialLoad) {\n-          await testInitialLoad(path, assertLogs)\n-        } else {\n-          await testNavigation(path, assertLogs)\n-        }\n+    const RUNTIME_ENV = hasRuntimePrefetch ? 'Prefetch' : 'Prefetchable'\n+\n+    describe.each([\n+      { description: 'initial load', isInitialLoad: true },\n+      { description: 'navigation', isInitialLoad: false },\n+    ])('$description', ({ isInitialLoad }) => {\n+      describe('cached data resolves in the correct phase', () => {\n+        it('cached data + cached fetch', async () => {\n+          const path = '/simple'\n+          const assertLogs = async (browser: Playwright) => {\n+            const logs = await browser.log()\n+            assertLog(logs, 'after cache read - layout', 'Prerender')\n+            assertLog(logs, 'after cache read - page', 'Prerender')\n+            assertLog(logs, 'after successive cache reads - page', 'Prerender')\n+            assertLog(logs, 'after cached fetch - layout', 'Prerender')\n+            assertLog(logs, 'after cached fetch - page', 'Prerender')\n+\n+            assertLog(logs, 'after uncached fetch - layout', 'Server')\n+            assertLog(logs, 'after uncached fetch - page', 'Server')\n+          }\n+\n+          if (isInitialLoad) {\n+            await testInitialLoad(path, assertLogs)\n+          } else {\n+            await testNavigation(path, assertLogs)\n+          }\n+        })\n+\n+        it('cached data + private cache', async () => {\n+          const path = '/private-cache'\n+\n+          const assertLogs = async (browser: Playwright) => {\n+            const logs = await browser.log()\n+            assertLog(logs, 'after cache read - layout', 'Prerender')\n+            assertLog(logs, 'after cache read - page', 'Prerender')\n+\n+            // Private caches are dynamic holes in static prerenders,\n+            // so they shouldn't resolve in the static stage.\n+            assertLog(logs, 'after private cache read - page', RUNTIME_ENV)\n+            assertLog(logs, 'after private cache read - layout', RUNTIME_ENV)\n+            assertLog(\n+              logs,\n+              'after successive private cache reads - page',\n+              RUNTIME_ENV\n+            )\n+\n+            assertLog(logs, 'after uncached fetch - layout', 'Server')\n+            assertLog(logs, 'after uncached fetch - page', 'Server')\n+          }\n+\n+          if (isInitialLoad) {\n+            await testInitialLoad(path, assertLogs)\n+          } else {\n+            await testNavigation(path, assertLogs)\n+          }\n+        })\n+\n+        it('cached data + short-lived cached data', async () => {\n+          const path = '/short-lived-cache'\n+\n+          const assertLogs = async (browser: Playwright) => {\n+            const logs = await browser.log()\n+            assertLog(logs, 'after cache read - layout', 'Prerender')\n+            assertLog(logs, 'after cache read - page', 'Prerender')\n+\n+            // Short lived caches are dynamic holes in static prerenders,\n+            // so they shouldn't resolve in the static stage.\n+            assertLog(logs, 'after short-lived cache read - page', RUNTIME_ENV)\n+            assertLog(\n+              logs,\n+              'after short-lived cache read - layout',\n+              RUNTIME_ENV\n+            )\n+\n+            assertLog(logs, 'after uncached fetch - layout', 'Server')\n+            assertLog(logs, 'after uncached fetch - page', 'Server')\n+          }\n+\n+          if (isInitialLoad) {\n+            await testInitialLoad(path, assertLogs)\n+          } else {\n+            await testNavigation(path, assertLogs)\n+          }\n+        })\n+\n+        it('cache reads that reveal more components with more caches', async () => {\n+          const path = '/successive-caches'\n+\n+          const assertLogs = async (browser: Playwright) => {\n+            const logs = await browser.log()\n+            // No matter how deeply we nest the component tree,\n+            // if all the IO is cached, it should be labeled as Prerender.\n+            assertLog(logs, 'after cache 1', 'Prerender')\n+            assertLog(logs, 'after cache 2', 'Prerender')\n+            assertLog(logs, 'after caches 1 and 2', 'Prerender')\n+            assertLog(logs, 'after cache 3', 'Prerender')\n+          }\n+\n+          if (isInitialLoad) {\n+            await testInitialLoad(path, assertLogs)\n+          } else {\n+            await testNavigation(path, assertLogs)\n+          }\n+        })\n       })\n \n-      it('cache reads that reveal more components with more caches', async () => {\n-        const path = '/successive-caches'\n+      it('request APIs resolve in the correct phase', async () => {\n+        const path = '/apis/123'\n \n         const assertLogs = async (browser: Playwright) => {\n           const logs = await browser.log()\n-          // No matter how deeply we nest the component tree,\n-          // if all the IO is cached, it should be labeled as Prerender.\n-          assertLog(logs, 'after cache 1', 'Prerender')\n-          assertLog(logs, 'after cache 2', 'Prerender')\n-          assertLog(logs, 'after caches 1 and 2', 'Prerender')\n-          assertLog(logs, 'after cache 3', 'Prerender')\n+          assertLog(logs, 'after cache read - page', 'Prerender')\n+\n+          // TODO: we should only label this as \"Prefetch\" if there's a prefetch config.\n+          assertLog(logs, `after cookies`, RUNTIME_ENV)\n+          assertLog(logs, `after headers`, RUNTIME_ENV)\n+          assertLog(logs, `after params`, RUNTIME_ENV)\n+          assertLog(logs, `after searchParams`, RUNTIME_ENV)\n+\n+          assertLog(logs, 'after connection', 'Server')\n         }\n \n         if (isInitialLoad) {\n@@ -238,28 +309,5 @@ describe('cache-components-dev-warmup', () => {\n         }\n       })\n     })\n-\n-    it('request APIs resolve in the correct phase', async () => {\n-      const path = '/apis/123'\n-\n-      const assertLogs = async (browser: Playwright) => {\n-        const logs = await browser.log()\n-        assertLog(logs, 'after cache read - page', 'Prerender')\n-\n-        // TODO: we should only label this as \"Prefetch\" if there's a prefetch config.\n-        assertLog(logs, `after cookies`, 'Prefetch')\n-        assertLog(logs, `after headers`, 'Prefetch')\n-        assertLog(logs, `after params`, 'Prefetch')\n-        assertLog(logs, `after searchParams`, 'Prefetch')\n-\n-        assertLog(logs, 'after connection', 'Server')\n-      }\n-\n-      if (isInitialLoad) {\n-        await testInitialLoad(path, assertLogs)\n-      } else {\n-        await testNavigation(path, assertLogs)\n-      }\n-    })\n-  })\n-})\n+  }\n+)"
        },
        {
            "sha": "75fa21cd0000036fc28b0c4bbbd4e9172cbc9a4e",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/apis/[param]/page.tsx",
            "status": "added",
            "additions": 49,
            "deletions": 0,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fapis%2F%5Bparam%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fapis%2F%5Bparam%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fapis%2F%5Bparam%5D%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,49 @@\n+import { cookies, headers } from 'next/headers'\n+import { CachedData } from '../../data-fetching'\n+import { connection } from 'next/server'\n+import { Suspense } from 'react'\n+\n+export const unstable_prefetch = { mode: 'runtime', samples: [{}] }\n+\n+const CACHE_KEY = __dirname + '/__PAGE__'\n+\n+export default function Page({ params, searchParams }) {\n+  return (\n+    <main>\n+      <p>\n+        This page checks whether runtime/dynamic APIs resolve in the correct\n+        stage (regardless of whether we had a cache miss or not)\n+      </p>\n+      <CachedData cacheKey={CACHE_KEY} label=\"page\" />\n+      <LogAfter label=\"--- dynamic stage ---\" api={() => connection()} />\n+\n+      {/* Runtime */}\n+      <LogAfter label=\"cookies\" api={() => cookies()} />\n+      <LogAfter label=\"headers\" api={() => headers()} />\n+      <LogAfter label=\"params\" api={() => params} />\n+      <LogAfter label=\"searchParams\" api={() => searchParams} />\n+      {/* Dynamic */}\n+      <LogAfter label=\"connection\" api={() => connection()} />\n+    </main>\n+  )\n+}\n+\n+function LogAfter({ label, api }: { label: string; api: () => Promise<any> }) {\n+  return (\n+    <Suspense fallback={<div>Waiting for {label}...</div>}>\n+      <LogAfterInner label={label} api={api} />\n+    </Suspense>\n+  )\n+}\n+\n+async function LogAfterInner({\n+  label,\n+  api,\n+}: {\n+  label: string\n+  api: () => Promise<any>\n+}) {\n+  await api()\n+  console.log(`after ${label}`)\n+  return <div>Finished {label}</div>\n+}"
        },
        {
            "sha": "d12d987dc1aba7535d8a14479d2dae2f2d058f14",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/data-fetching.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fdata-fetching.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fdata-fetching.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fdata-fetching.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/data-fetching.tsx"
        },
        {
            "sha": "e7077399c03ce1479a655dc647c0545b64531628",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/layout.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Flayout.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/layout.tsx"
        },
        {
            "sha": "7e0011ce547ac7b0fc5c3f3ef3de31ce397d7a9e",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/page.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/page.tsx"
        },
        {
            "sha": "61a8c92ed02d364e6daaf2b258e032282e8967ac",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/private-cache/data-fetching.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fprivate-cache%2Fdata-fetching.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fprivate-cache%2Fdata-fetching.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fprivate-cache%2Fdata-fetching.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/private-cache/data-fetching.tsx"
        },
        {
            "sha": "e0129cb9cd28077ad680c33ee956da143c9bc116",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/private-cache/layout.tsx",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fprivate-cache%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fprivate-cache%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fprivate-cache%2Flayout.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,29 @@\n+import { Suspense } from 'react'\n+import { UncachedFetch, CachedData } from '../data-fetching'\n+import { PrivateCachedData } from './data-fetching'\n+\n+export const unstable_prefetch = { mode: 'runtime', samples: [{}] }\n+\n+const CACHE_KEY = '/private-cache/__LAYOUT__'\n+\n+export default function Layout({ children }: { children: React.ReactNode }) {\n+  return (\n+    <>\n+      {children}\n+      <section>\n+        <h1>Layout</h1>\n+        <p>This data is from a layout</p>\n+\n+        <CachedData label=\"layout\" cacheKey={CACHE_KEY} />\n+\n+        <Suspense fallback=\"Loading private cache...\">\n+          <PrivateCachedData label=\"layout\" cacheKey={CACHE_KEY} />\n+        </Suspense>\n+\n+        <Suspense fallback=\"Loading uncached fetch...\">\n+          <UncachedFetch label=\"layout\" cacheKey={CACHE_KEY} />\n+        </Suspense>\n+      </section>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "1f586f5025b45a59e86395200993f2beebd861b3",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/private-cache/page.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fprivate-cache%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fprivate-cache%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fprivate-cache%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/private-cache/page.tsx"
        },
        {
            "sha": "d246995676e4b5addb3021282b0aa293c3f6a9a0",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/revalidate/route.ts",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Frevalidate%2Froute.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Frevalidate%2Froute.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Frevalidate%2Froute.ts?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/revalidate/route.ts"
        },
        {
            "sha": "5fd697350a929eac5e6953f261413bfa4a4badf1",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/short-lived-cache/data-fetching.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fshort-lived-cache%2Fdata-fetching.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fshort-lived-cache%2Fdata-fetching.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fshort-lived-cache%2Fdata-fetching.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/short-lived-cache/data-fetching.tsx"
        },
        {
            "sha": "8007d5b2bb2dfd2819ef0e82c4cc7565b8e224b6",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/short-lived-cache/layout.tsx",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fshort-lived-cache%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fshort-lived-cache%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fshort-lived-cache%2Flayout.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,29 @@\n+import { Suspense } from 'react'\n+import { UncachedFetch, CachedData } from '../data-fetching'\n+import { ShortLivedCache } from './data-fetching'\n+\n+export const unstable_prefetch = { mode: 'runtime', samples: [{}] }\n+\n+const CACHE_KEY = __dirname + '/__LAYOUT__'\n+\n+export default function Layout({ children }: { children: React.ReactNode }) {\n+  return (\n+    <>\n+      {children}\n+      <section>\n+        <h1>Layout</h1>\n+        <p>This data is from a layout</p>\n+\n+        <CachedData label=\"layout\" cacheKey={CACHE_KEY} />\n+\n+        <Suspense fallback=\"Loading short-lived cache...\">\n+          <ShortLivedCache label=\"layout\" cacheKey={CACHE_KEY} />\n+        </Suspense>\n+\n+        <Suspense fallback=\"Loading uncached fetch...\">\n+          <UncachedFetch label=\"layout\" cacheKey={CACHE_KEY} />\n+        </Suspense>\n+      </section>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "3f1569860d92476039b39a85af05dc0879cdc64e",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/short-lived-cache/page.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fshort-lived-cache%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fshort-lived-cache%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fshort-lived-cache%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/short-lived-cache/page.tsx"
        },
        {
            "sha": "3aa99c3dc40c3865d584f46a46bdbf5d9ff26d6b",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/simple/layout.tsx",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsimple%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsimple%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsimple%2Flayout.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,26 @@\n+import { Suspense } from 'react'\n+import { UncachedFetch, CachedFetch, CachedData } from '../data-fetching'\n+\n+export const unstable_prefetch = { mode: 'runtime', samples: [{}] }\n+\n+const CACHE_KEY = __dirname + '/__LAYOUT__'\n+\n+export default function Layout({ children }: { children: React.ReactNode }) {\n+  return (\n+    <>\n+      {children}\n+      <section>\n+        <h1>Layout</h1>\n+        <p>This data is from a layout</p>\n+\n+        <CachedData label=\"layout\" cacheKey={CACHE_KEY} />\n+\n+        <CachedFetch label=\"layout\" cacheKey={CACHE_KEY} />\n+\n+        <Suspense fallback=\"Loading uncached fetch...\">\n+          <UncachedFetch label=\"layout\" cacheKey={CACHE_KEY} />\n+        </Suspense>\n+      </section>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "7711287aaa5044552429f48438178ae84e0bba64",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/simple/loading.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsimple%2Floading.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsimple%2Floading.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsimple%2Floading.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/simple/loading.tsx"
        },
        {
            "sha": "47b574f89dd25413cc2f62ce894377d083637d1d",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/simple/page.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsimple%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsimple%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsimple%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/simple/page.tsx"
        },
        {
            "sha": "e50993a0bcc0b94eb909030b20a2f41df34091dd",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/app/successive-caches/page.tsx",
            "status": "added",
            "additions": 46,
            "deletions": 0,
            "changes": 46,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsuccessive-caches%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsuccessive-caches%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fapp%2Fsuccessive-caches%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,46 @@\n+export const unstable_prefetch = { mode: 'runtime', samples: [{}] }\n+\n+export default async function Page() {\n+  return (\n+    <main>\n+      <h1>Warmup Dev Renders - deep successive cache reads</h1>\n+      <One />\n+    </main>\n+  )\n+}\n+\n+async function One() {\n+  const cache1 = await fastCache()\n+  console.log('after cache 1')\n+  return <Two cache1={cache1} />\n+}\n+\n+async function Two({ cache1 }) {\n+  const cache2 = await slowCache(1)\n+  console.log('after cache 2')\n+  return <Three cache1={cache1} cache2={cache2} />\n+}\n+\n+async function Three({ cache1, cache2 }) {\n+  console.log('after caches 1 and 2')\n+  const cache3 = await slowCache(2)\n+  console.log('after cache 3')\n+  return (\n+    <div>\n+      <div>Cache 1: {cache1}</div>\n+      <div>Cache 2: {cache2}</div>\n+      <div>Cache 3: {cache3}</div>\n+    </div>\n+  )\n+}\n+\n+async function fastCache() {\n+  'use cache'\n+  return Math.random()\n+}\n+\n+async function slowCache(_key: number) {\n+  'use cache'\n+  await new Promise((resolve) => setTimeout(resolve))\n+  return Math.random()\n+}"
        },
        {
            "sha": "fa33c7c54f24cc9c85addd95f17ab7b6ebc6d751",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/with-prefetch-config/next.config.ts",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwith-prefetch-config%2Fnext.config.ts?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/next.config.ts"
        },
        {
            "sha": "117533ce2e7ae9e78c9a40e37f4af0a6888a5f62",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/apis/[param]/page.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fapis%2F%5Bparam%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fapis%2F%5Bparam%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fapis%2F%5Bparam%5D%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/apis/[param]/page.tsx"
        },
        {
            "sha": "d12d987dc1aba7535d8a14479d2dae2f2d058f14",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/data-fetching.tsx",
            "status": "added",
            "additions": 103,
            "deletions": 0,
            "changes": 103,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fdata-fetching.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fdata-fetching.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fdata-fetching.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,103 @@\n+export async function fetchCachedRandom(cacheKey: string) {\n+  return fetchCached(\n+    `https://next-data-api-endpoint.vercel.app/api/random?key=${encodeURIComponent('cached-' + cacheKey)}`\n+  )\n+}\n+\n+export async function fetchCached(url: string) {\n+  const response = await fetch(url, { cache: 'force-cache' })\n+  return response.text()\n+}\n+\n+export async function getCachedData(_key: string) {\n+  'use cache'\n+  await new Promise((r) => setTimeout(r))\n+  return Math.random()\n+}\n+\n+export async function CachedData({\n+  label,\n+  cacheKey,\n+}: {\n+  label: string\n+  cacheKey: string\n+}) {\n+  const data = await getCachedData(cacheKey)\n+  console.log(`after cache read - ${label}`)\n+  return (\n+    <dl>\n+      <dt>Cached Data</dt>\n+      <dd>{data}</dd>\n+    </dl>\n+  )\n+}\n+\n+export async function SuccessiveCachedData({\n+  label,\n+  cacheKey,\n+}: {\n+  label: string\n+  cacheKey: string\n+}) {\n+  // This components tests if we correctly handle the case where resolving a cache\n+  // reveals another cache in the children. When we're filling caches, we should fill both.\n+  const data1 = await getCachedData(`${cacheKey}-successive-1`)\n+  return (\n+    <dl>\n+      <dt>Cached Data (successive reads)</dt>\n+      <dd>{data1}</dd>\n+      <dd>\n+        <SuccessiveCachedDataChild label={label} cacheKey={cacheKey} />\n+      </dd>\n+    </dl>\n+  )\n+}\n+\n+async function SuccessiveCachedDataChild({\n+  label,\n+  cacheKey,\n+}: {\n+  label: string\n+  cacheKey: string\n+}) {\n+  const data2 = await getCachedData(`${cacheKey}-successive-2`)\n+  console.log(`after successive cache reads - ${label}`)\n+  return <>{data2}</>\n+}\n+\n+export async function CachedFetch({\n+  label,\n+  cacheKey,\n+}: {\n+  label: string\n+  cacheKey: string\n+}) {\n+  const data = await fetchCachedRandom(cacheKey)\n+  console.log(`after cached fetch - ${label}`)\n+  return (\n+    <dl>\n+      <dt>Cached Fetch</dt>\n+      <dd>{data}</dd>\n+    </dl>\n+  )\n+}\n+\n+export async function UncachedFetch({\n+  label,\n+  cacheKey,\n+}: {\n+  label: string\n+  cacheKey: string\n+}) {\n+  const response = await fetch(\n+    `https://next-data-api-endpoint.vercel.app/api/random?key=${encodeURIComponent('uncached-' + cacheKey)}`\n+  )\n+  console.log(`after uncached fetch - ${label}`)\n+  const data = await response.text()\n+  return (\n+    <dl>\n+      <dt>Uncached Fetch</dt>\n+      <dd>{data}</dd>\n+    </dl>\n+  )\n+}"
        },
        {
            "sha": "e7077399c03ce1479a655dc647c0545b64531628",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/layout.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Flayout.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,7 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "7e0011ce547ac7b0fc5c3f3ef3de31ce397d7a9e",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/page.tsx",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,26 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  // NOTE: these links must be kept in sync with `path` variables used in the test\n+  return (\n+    <main>\n+      <ul>\n+        <li>\n+          <Link href=\"/simple\">/simple</Link>\n+        </li>\n+        <li>\n+          <Link href=\"/private-cache\">/private-cache</Link>\n+        </li>\n+        <li>\n+          <Link href=\"/short-lived-cache\">/short-lived-cache</Link>\n+        </li>\n+        <li>\n+          <Link href=\"/successive-caches\">/successive-caches</Link>\n+        </li>\n+        <li>\n+          <Link href=\"/apis/123\">/apis/123</Link>\n+        </li>\n+      </ul>\n+    </main>\n+  )\n+}"
        },
        {
            "sha": "61a8c92ed02d364e6daaf2b258e032282e8967ac",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/private-cache/data-fetching.tsx",
            "status": "added",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fprivate-cache%2Fdata-fetching.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fprivate-cache%2Fdata-fetching.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fprivate-cache%2Fdata-fetching.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,55 @@\n+export async function PrivateCachedData({\n+  label,\n+  cacheKey,\n+}: {\n+  label: string\n+  cacheKey: string\n+}) {\n+  const data = await getPrivateCachedData(cacheKey)\n+  console.log(`after private cache read - ${label}`)\n+  return (\n+    <dl>\n+      <dt>Private Cached Data (Page)</dt>\n+      <dd>{data}</dd>\n+    </dl>\n+  )\n+}\n+\n+export async function SuccessivePrivateCachedData({\n+  label,\n+  cacheKey,\n+}: {\n+  label: string\n+  cacheKey: string\n+}) {\n+  // This components tests if we correctly handle the case where resolving a cache\n+  // reveals another cache in the children. When we're filling caches, we should fill both.\n+  const data1 = await getPrivateCachedData(`${cacheKey}-successive-1`)\n+  return (\n+    <dl>\n+      <dt>Private Cached Data (successive reads)</dt>\n+      <dd>{data1}</dd>\n+      <dd>\n+        <SuccessivePrivateCachedDataChild label={label} cacheKey={cacheKey} />\n+      </dd>\n+    </dl>\n+  )\n+}\n+\n+async function SuccessivePrivateCachedDataChild({\n+  label,\n+  cacheKey,\n+}: {\n+  label: string\n+  cacheKey: string\n+}) {\n+  const data2 = await getPrivateCachedData(`${cacheKey}-successive-2`)\n+  console.log(`after successive private cache reads - ${label}`)\n+  return <>{data2}</>\n+}\n+\n+async function getPrivateCachedData(_key: string) {\n+  'use cache: private'\n+  await new Promise((r) => setTimeout(r))\n+  return Math.random()\n+}"
        },
        {
            "sha": "5257575cd3245bef4113d497e9e0cb63929c91d6",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/private-cache/layout.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fprivate-cache%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fprivate-cache%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fprivate-cache%2Flayout.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/private-cache/layout.tsx"
        },
        {
            "sha": "1f586f5025b45a59e86395200993f2beebd861b3",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/private-cache/page.tsx",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fprivate-cache%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fprivate-cache%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fprivate-cache%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,27 @@\n+import { Suspense } from 'react'\n+import { CachedData, UncachedFetch } from '../data-fetching'\n+import { PrivateCachedData, SuccessivePrivateCachedData } from './data-fetching'\n+\n+const CACHE_KEY = '/private-cache/__PAGE__'\n+\n+export default async function Page() {\n+  return (\n+    <main>\n+      <h1>Warmup Dev Renders - private cache</h1>\n+\n+      <CachedData label=\"page\" cacheKey={CACHE_KEY} />\n+\n+      <Suspense fallback=\"Loading private cache...\">\n+        <PrivateCachedData label=\"page\" cacheKey={CACHE_KEY} />\n+      </Suspense>\n+\n+      <Suspense fallback=\"Loading two successive private caches...\">\n+        <SuccessivePrivateCachedData label=\"page\" cacheKey={CACHE_KEY} />\n+      </Suspense>\n+\n+      <Suspense fallback=\"Loading uncached fetch...\">\n+        <UncachedFetch label=\"page\" cacheKey={CACHE_KEY} />\n+      </Suspense>\n+    </main>\n+  )\n+}"
        },
        {
            "sha": "d246995676e4b5addb3021282b0aa293c3f6a9a0",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/revalidate/route.ts",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Frevalidate%2Froute.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Frevalidate%2Froute.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Frevalidate%2Froute.ts?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,8 @@\n+import { revalidatePath } from 'next/cache'\n+\n+export async function GET(request: Request) {\n+  const path = new URL(request.url).searchParams.get('path')!\n+  revalidatePath(path)\n+\n+  return Response.json({ revalidated: true })\n+}"
        },
        {
            "sha": "5fd697350a929eac5e6953f261413bfa4a4badf1",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/short-lived-cache/data-fetching.tsx",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fshort-lived-cache%2Fdata-fetching.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fshort-lived-cache%2Fdata-fetching.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fshort-lived-cache%2Fdata-fetching.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,25 @@\n+import { cacheLife } from 'next/cache'\n+\n+export async function ShortLivedCache({\n+  label,\n+  cacheKey,\n+}: {\n+  label: string\n+  cacheKey: string\n+}) {\n+  const data = await getShortLivedCachedData(cacheKey)\n+  console.log(`after short-lived cache read - ${label}`)\n+  return (\n+    <dl>\n+      <dt>Short-lived Cached Data (Page)</dt>\n+      <dd>{data}</dd>\n+    </dl>\n+  )\n+}\n+\n+async function getShortLivedCachedData(_key: string) {\n+  'use cache'\n+  cacheLife('seconds')\n+  await new Promise((r) => setTimeout(r))\n+  return Math.random()\n+}"
        },
        {
            "sha": "1735609220862d1773927408044a5ad6b74a5693",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/short-lived-cache/layout.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fshort-lived-cache%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fshort-lived-cache%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fshort-lived-cache%2Flayout.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/short-lived-cache/layout.tsx"
        },
        {
            "sha": "3f1569860d92476039b39a85af05dc0879cdc64e",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/short-lived-cache/page.tsx",
            "status": "added",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fshort-lived-cache%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fshort-lived-cache%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fshort-lived-cache%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,23 @@\n+import { Suspense } from 'react'\n+import { CachedData, UncachedFetch } from '../data-fetching'\n+import { ShortLivedCache } from './data-fetching'\n+\n+const CACHE_KEY = __dirname + '/__PAGE__'\n+\n+export default async function Page() {\n+  return (\n+    <main>\n+      <h1>Warmup Dev Renders - short lived cache</h1>\n+\n+      <CachedData label=\"page\" cacheKey={CACHE_KEY} />\n+\n+      <Suspense fallback=\"Loading short-lived cache...\">\n+        <ShortLivedCache label=\"page\" cacheKey={CACHE_KEY} />\n+      </Suspense>\n+\n+      <Suspense fallback=\"Loading uncached fetch...\">\n+        <UncachedFetch label=\"page\" cacheKey={CACHE_KEY} />\n+      </Suspense>\n+    </main>\n+  )\n+}"
        },
        {
            "sha": "12095116bed8029fa68157750948df1b5498d505",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/simple/layout.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsimple%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsimple%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsimple%2Flayout.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/simple/layout.tsx"
        },
        {
            "sha": "7711287aaa5044552429f48438178ae84e0bba64",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/simple/loading.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsimple%2Floading.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsimple%2Floading.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsimple%2Floading.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,10 @@\n+import { fetchCachedRandom, getCachedData } from '../data-fetching'\n+\n+// Deliberately using the same cache keys as the page.\n+const CACHE_KEY = __dirname + '/__PAGE__'\n+\n+export default async function Loading() {\n+  await fetchCachedRandom(CACHE_KEY) // Mirrors `CachedFetchingComponent`\n+  await getCachedData(CACHE_KEY) // Mirrors `CachedDataComponent`\n+  return <main>loading...</main>\n+}"
        },
        {
            "sha": "47b574f89dd25413cc2f62ce894377d083637d1d",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/simple/page.tsx",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsimple%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsimple%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsimple%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,26 @@\n+import { Suspense } from 'react'\n+import {\n+  CachedData,\n+  CachedFetch,\n+  SuccessiveCachedData,\n+  UncachedFetch,\n+} from '../data-fetching'\n+\n+const CACHE_KEY = __dirname + '/__PAGE__'\n+\n+export default async function Page() {\n+  return (\n+    <main>\n+      <h1>Warmup Dev Renders</h1>\n+\n+      <CachedData label=\"page\" cacheKey={CACHE_KEY} />\n+      <SuccessiveCachedData label=\"page\" cacheKey={CACHE_KEY} />\n+\n+      <CachedFetch label=\"page\" cacheKey={CACHE_KEY} />\n+\n+      <Suspense fallback=\"Loading uncached fetch...\">\n+        <UncachedFetch label=\"page\" cacheKey={CACHE_KEY} />\n+      </Suspense>\n+    </main>\n+  )\n+}"
        },
        {
            "sha": "b6bd8e1c2295a5c5f8344391cd8a27d776062369",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/app/successive-caches/page.tsx",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsuccessive-caches%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsuccessive-caches%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fapp%2Fsuccessive-caches%2Fpage.tsx?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "previous_filename": "test/development/app-dir/cache-components-dev-warmup/app/successive-caches/page.tsx"
        },
        {
            "sha": "3970d95d89d9c2353a7b5ca275f2d2e52915a15e",
            "filename": "test/development/app-dir/cache-components-dev-warmup/fixtures/without-prefetch-config/next.config.ts",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcache-components-dev-warmup%2Ffixtures%2Fwithout-prefetch-config%2Fnext.config.ts?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -0,0 +1,9 @@\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  experimental: {\n+    cacheComponents: true,\n+  },\n+}\n+\n+export default nextConfig"
        },
        {
            "sha": "14cd3782097b891c0b8b871bf0135e8a7ebe245a",
            "filename": "test/e2e/app-dir/server-source-maps/server-source-maps.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2ed06f03e810b3a2dcec4b60a452621a08f4b068/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts?ref=2ed06f03e810b3a2dcec4b60a452621a08f4b068",
            "patch": "@@ -480,8 +480,6 @@ describe('app-dir - server source maps', () => {\n              \"{module evaluation} app/module-evaluation/module.js (1:22)\",\n              \"{module evaluation} app/module-evaluation/page.js (1:1)\",\n              \"{module evaluation} app/module-evaluation/page.js (6:1)\",\n-             \"Array.map <anonymous>\",\n-             \"Function.all <anonymous>\",\n              \"Page <anonymous>\",\n            ],\n          }\n@@ -522,8 +520,6 @@ describe('app-dir - server source maps', () => {\n              \"<FIXME-file-protocol>\",\n              \"eval about:/Prerender/webpack-internal:///(rsc)/app/module-evaluation/page.js (5:65)\",\n              \"<FIXME-file-protocol>\",\n-             \"Function.all <anonymous>\",\n-             \"Function.all <anonymous>\",\n              \"Page <anonymous>\",\n            ],\n          }"
        }
    ],
    "stats": {
        "total": 1046,
        "additions": 816,
        "deletions": 230
    }
}