{
    "author": "wbinnssmith",
    "message": "Update rust toolchain to 2025-03-12 (#77054)\n\n- Removed `#![feature(extract_if)]`\n- Removed `#![feature(hash_extract_if)]`\n- Removed no-op `#[must_use]`\n- Addressed new clippy violations",
    "sha": "d6dbb70e32b90d5e544e9e1588c78efd845b0400",
    "files": [
        {
            "sha": "caffe7bf7b757d5e846554d391de048dc571af18",
            "filename": "rust-toolchain.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/rust-toolchain.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/rust-toolchain.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/rust-toolchain.toml?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -1,4 +1,4 @@\n [toolchain]\n-channel = \"nightly-2025-02-12\"\n+channel = \"nightly-2025-03-12\"\n components = [\"rustfmt\", \"clippy\", \"rust-analyzer\"]\n profile = \"minimal\""
        },
        {
            "sha": "17361c57a72c80434cbac5709176d1dbb15a35f5",
            "filename": "turbopack/crates/turbo-tasks-auto-hash-map/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Flib.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -1,5 +1,4 @@\n #![feature(hash_raw_entry)]\n-#![feature(hash_extract_if)]\n \n pub mod map;\n pub mod set;"
        },
        {
            "sha": "3ad70e55728d8a2e9d6366605ed041736705ff7b",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/operation/mod.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fmod.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -455,7 +455,6 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         self.task_id\n     }\n \n-    #[must_use]\n     fn add(&mut self, item: CachedDataItem) -> bool {\n         self.check_access(item.category());\n         if !self.backend.should_persist() || self.task_id.is_transient() || !item.is_persistent() {"
        },
        {
            "sha": "20f8395e8b2f092b57c8ffe35ba6c13299ef8c2c",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -1,6 +1,5 @@\n #![allow(clippy::needless_return)] // tokio macro-generated code doesn't respect this\n #![feature(trivial_bounds)]\n-#![feature(hash_extract_if)]\n #![feature(min_specialization)]\n #![feature(iter_advance_by)]\n #![feature(io_error_more)]"
        },
        {
            "sha": "0a167e2e1632d2019ee6b7b365fc360e1487ee12",
            "filename": "turbopack/crates/turbo-tasks-macros-tests/tests/function/fail_operation_method_self_type.stderr",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_operation_method_self_type.stderr",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_operation_method_self_type.stderr",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_operation_method_self_type.stderr?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -4,6 +4,15 @@ error: methods taking `self` are not supported with `operation`\n 13 |     fn arbitrary_self_type(self: OperationVc<Self>) -> Vc<()> {\n    |                            ^^^^^^^^^^^^^^^^^^^^^^^\n \n+error[E0307]: invalid `self` parameter type: `OperationVc<Foobar>`\n+  --> tests/function/fail_operation_method_self_type.rs:13:34\n+   |\n+13 |     fn arbitrary_self_type(self: OperationVc<Self>) -> Vc<()> {\n+   |                                  ^^^^^^^^^^^^^^^^^\n+   |\n+   = note: type of `self` must be `Self` or some type implementing `Receiver`\n+   = help: consider changing to `self`, `&self`, `&mut self`, or a type implementing `Receiver` such as `self: Box<Self>`, `self: Rc<Self>`, or `self: Arc<Self>`\n+\n error[E0277]: the trait bound `fn(...) -> ... {...::arbitrary_self_type_turbo_tasks_function_inline}: IntoTaskFnWithThis<_, _, _>` is not satisfied\n   --> tests/function/fail_operation_method_self_type.rs:10:1\n    |\n@@ -22,12 +31,3 @@ note: required by a bound in `NativeFunction::new_method`\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `NativeFunction::new_method`\n    = note: consider using `--verbose` to print the full type name to the console\n    = note: this error originates in the attribute macro `turbo_tasks::value_impl` (in Nightly builds, run with -Z macro-backtrace for more info)\n-\n-error[E0307]: invalid `self` parameter type: `OperationVc<Foobar>`\n-  --> tests/function/fail_operation_method_self_type.rs:13:34\n-   |\n-13 |     fn arbitrary_self_type(self: OperationVc<Self>) -> Vc<()> {\n-   |                                  ^^^^^^^^^^^^^^^^^\n-   |\n-   = note: type of `self` must be `Self` or some type implementing `Receiver`\n-   = help: consider changing to `self`, `&self`, `&mut self`, or a type implementing `Receiver` such as `self: Box<Self>`, `self: Rc<Self>`, or `self: Arc<Self>`"
        },
        {
            "sha": "bd2a5476b5b402ff1c8290feab73fa29f948b3f5",
            "filename": "turbopack/crates/turbo-tasks-memory/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Flib.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -1,4 +1,3 @@\n-#![feature(hash_extract_if)]\n #![feature(type_alias_impl_trait)]\n #![feature(box_patterns)]\n #![feature(int_roundings)]"
        },
        {
            "sha": "c76166d663222dc21e610739496917ac1346ab54",
            "filename": "turbopack/crates/turbo-tasks/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -29,7 +29,6 @@\n #![feature(trivial_bounds)]\n #![feature(min_specialization)]\n #![feature(try_trait_v2)]\n-#![feature(hash_extract_if)]\n #![deny(unsafe_op_in_unsafe_fn)]\n #![feature(result_flattening)]\n #![feature(error_generic_member_access)]"
        },
        {
            "sha": "d889c4e3a02766ce824dd6ede1cb1b124c167d64",
            "filename": "turbopack/crates/turbopack-css/src/process.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fprocess.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fprocess.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fprocess.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -113,6 +113,7 @@ impl StyleSheetLike<'_, '_> {\n pub struct UnresolvedUrlReferences(pub Vec<(String, ResolvedVc<UrlAssetReference>)>);\n \n #[turbo_tasks::value(shared, serialization = \"none\", eq = \"manual\", cell = \"new\")]\n+#[allow(clippy::large_enum_variant)] // This is a turbo-tasks value\n pub enum ParseCssResult {\n     Ok {\n         code: ResolvedVc<FileContent>,"
        },
        {
            "sha": "c4f5cb4348ff9027662e28df05386071a5835e50",
            "filename": "turbopack/crates/turbopack-dev-server/src/http.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhttp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhttp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhttp.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -1,4 +1,4 @@\n-use std::io::{Error, ErrorKind};\n+use std::io::Error;\n \n use anyhow::{anyhow, Result};\n use auto_hash_map::AutoSet;\n@@ -177,10 +177,7 @@ pub async fn process_request_with_content_source(\n                     header_map.insert(CONTENT_ENCODING, HeaderValue::from_static(\"gzip\"));\n \n                     // Grab ropereader stream, coerce anyhow::Error to std::io::Error\n-                    let stream_ext = content\n-                        .read()\n-                        .into_stream()\n-                        .map_err(|err| Error::new(ErrorKind::Other, err));\n+                    let stream_ext = content.read().into_stream().map_err(Error::other);\n \n                     let gzipped_stream =\n                         ReaderStream::new(async_compression::tokio::bufread::GzipEncoder::new("
        },
        {
            "sha": "f8824eaaaecfa920e6f84d51140235aee6531979",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/graph.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -1509,10 +1509,9 @@ impl VisitAstPath for Analyzer<'_> {\n         decl: &'ast FnDecl,\n         ast_path: &mut AstNodePath<AstParentNodeRef<'r>>,\n     ) {\n-        let old = replace(\n-            &mut self.cur_fn_return_values,\n-            Some(get_fn_init_return_vals(decl.function.body.as_ref())),\n-        );\n+        let old = self\n+            .cur_fn_return_values\n+            .replace(get_fn_init_return_vals(decl.function.body.as_ref()));\n         let old_ident = self.cur_fn_ident;\n         self.cur_fn_ident = decl.function.span.lo.0;\n         decl.visit_children_with_ast_path(self, ast_path);\n@@ -1533,10 +1532,9 @@ impl VisitAstPath for Analyzer<'_> {\n         expr: &'ast FnExpr,\n         ast_path: &mut AstNodePath<AstParentNodeRef<'r>>,\n     ) {\n-        let old = replace(\n-            &mut self.cur_fn_return_values,\n-            Some(get_fn_init_return_vals(expr.function.body.as_ref())),\n-        );\n+        let old = self\n+            .cur_fn_return_values\n+            .replace(get_fn_init_return_vals(expr.function.body.as_ref()));\n         let old_ident = self.cur_fn_ident;\n         self.cur_fn_ident = expr.function.span.lo.0;\n         expr.visit_children_with_ast_path(self, ast_path);"
        },
        {
            "sha": "e42c497047d9084820520051b175efe6e6cb2919",
            "filename": "turbopack/crates/turbopack-ecmascript/src/swc_comments.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fswc_comments.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fswc_comments.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fswc_comments.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -191,8 +191,8 @@ impl Comments for ImmutableComments {\n }\n \n pub struct CowComments<'a> {\n-    leading: RefCell<FxHashMap<BytePos, Cow<'a, Vec<Comment>>>>,\n-    trailing: RefCell<FxHashMap<BytePos, Cow<'a, Vec<Comment>>>>,\n+    leading: RefCell<FxHashMap<BytePos, Cow<'a, [Comment]>>>,\n+    trailing: RefCell<FxHashMap<BytePos, Cow<'a, [Comment]>>>,\n }\n \n impl<'a> CowComments<'a> {\n@@ -202,14 +202,14 @@ impl<'a> CowComments<'a> {\n                 comments\n                     .leading\n                     .iter()\n-                    .map(|(&key, value)| (key, Cow::Borrowed(value)))\n+                    .map(|(&key, value)| (key, Cow::Borrowed(&value[..])))\n                     .collect(),\n             ),\n             trailing: RefCell::new(\n                 comments\n                     .trailing\n                     .iter()\n-                    .map(|(&key, value)| (key, Cow::Borrowed(value)))\n+                    .map(|(&key, value)| (key, Cow::Borrowed(&value[..])))\n                     .collect(),\n             ),\n         }\n@@ -274,7 +274,7 @@ impl Comments for CowComments<'_> {\n         &self,\n         pos: swc_core::common::BytePos,\n     ) -> Option<Vec<swc_core::common::comments::Comment>> {\n-        self.leading.borrow().get(&pos).map(|v| (**v).clone())\n+        self.leading.borrow().get(&pos).map(|v| (**v).to_vec())\n     }\n \n     fn add_trailing(\n@@ -315,7 +315,7 @@ impl Comments for CowComments<'_> {\n         &self,\n         pos: swc_core::common::BytePos,\n     ) -> Option<Vec<swc_core::common::comments::Comment>> {\n-        self.trailing.borrow().get(&pos).map(|v| (**v).clone())\n+        self.trailing.borrow().get(&pos).map(|v| (**v).to_vec())\n     }\n \n     fn add_pure_comment(&self, _pos: swc_core::common::BytePos) {"
        },
        {
            "sha": "2e83eb5a654ddcc0605c263b6f0365534abdf1ec",
            "filename": "turbopack/crates/turbopack-ecmascript/src/utils.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Futils.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Futils.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Futils.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -114,11 +114,8 @@ where\n         impl std::io::Write for DisplayWriter<'_, '_> {\n             fn write(&mut self, bytes: &[u8]) -> std::result::Result<usize, std::io::Error> {\n                 self.f\n-                    .write_str(\n-                        std::str::from_utf8(bytes)\n-                            .map_err(|err| std::io::Error::new(std::io::ErrorKind::Other, err))?,\n-                    )\n-                    .map_err(|err| std::io::Error::new(std::io::ErrorKind::Other, err))?;\n+                    .write_str(std::str::from_utf8(bytes).map_err(std::io::Error::other)?)\n+                    .map_err(std::io::Error::other)?;\n                 Ok(bytes.len())\n             }\n "
        },
        {
            "sha": "ab382e9c14465addd10be0ef2c7560d31e887c8e",
            "filename": "turbopack/crates/turbopack-node/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Flib.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -1,7 +1,6 @@\n #![feature(min_specialization)]\n #![feature(arbitrary_self_types)]\n #![feature(arbitrary_self_types_pointers)]\n-#![feature(extract_if)]\n \n use std::{iter::once, thread::available_parallelism};\n "
        },
        {
            "sha": "4d795d796e7e8810cc07f8d6b7d24c8d1fbc49ad",
            "filename": "turbopack/crates/turbopack-trace-server/src/store.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fstore.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d6dbb70e32b90d5e544e9e1588c78efd845b0400/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fstore.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-trace-server%2Fsrc%2Fstore.rs?ref=d6dbb70e32b90d5e544e9e1588c78efd845b0400",
            "patch": "@@ -1,7 +1,6 @@\n use std::{\n     cmp::{max, min},\n     env,\n-    mem::replace,\n     num::NonZeroUsize,\n     sync::{atomic::AtomicU64, OnceLock},\n };\n@@ -266,9 +265,9 @@ impl Store {\n         outdated_spans.insert(span_index);\n         let span = &mut self.spans[span_index.get()];\n \n-        let old_parent = replace(&mut span.parent, Some(parent));\n+        let old_parent = &mut span.parent.replace(parent);\n         let old_parent = if let Some(parent) = old_parent {\n-            outdated_spans.insert(parent);\n+            outdated_spans.insert(*parent);\n             &mut self.spans[parent.get()]\n         } else {\n             &mut self.spans[0]"
        }
    ],
    "stats": {
        "total": 72,
        "additions": 29,
        "deletions": 43
    }
}