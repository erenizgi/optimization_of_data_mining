{
    "author": "kdy1",
    "message": "perf(turbopack): Mark async fns without `await` as non-async (#80628)\n\n### What?\n\n\nMark async turbo tasks functions that does not use `await` in the body\nas synchronous functions.\n\n\n### Why?\n\nWe now have immutable task optimization, so marking more functions as\n`sync` helps improve performance.",
    "sha": "f31b032751cb5091d62253f1b07f02e7a1a99735",
    "files": [
        {
            "sha": "80c1ebb9653d9182206518693961f272bcff39c8",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -521,7 +521,7 @@ impl DiskFileSystem {\n     ///   be a full path, since it is possible that root & project dir is different and requires to\n     ///   ignore specific subpaths from each.\n     #[turbo_tasks::function]\n-    pub async fn new(name: RcStr, root: RcStr, ignored_subpaths: Vec<RcStr>) -> Result<Vc<Self>> {\n+    pub fn new(name: RcStr, root: RcStr, ignored_subpaths: Vec<RcStr>) -> Result<Vc<Self>> {\n         mark_stateful();\n \n         let instance = DiskFileSystem {"
        },
        {
            "sha": "a1d7fc90350315f023c14dae160b205cce364173",
            "filename": "turbopack/crates/turbopack-ecmascript/src/async_chunk/module.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fmodule.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -73,7 +73,7 @@ impl Asset for AsyncLoaderModule {\n #[turbo_tasks::value_impl]\n impl ChunkableModule for AsyncLoaderModule {\n     #[turbo_tasks::function]\n-    async fn as_chunk_item(\n+    fn as_chunk_item(\n         self: ResolvedVc<Self>,\n         module_graph: ResolvedVc<ModuleGraph>,\n         chunking_context: ResolvedVc<Box<dyn ChunkingContext>>,"
        },
        {
            "sha": "60d0a5320013d0bb902fb8932c72c7db42800229",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -142,7 +142,7 @@ impl Chunk for EcmascriptChunk {\n     }\n \n     #[turbo_tasks::function]\n-    async fn chunk_items(&self) -> Vc<ChunkItems> {\n+    fn chunk_items(&self) -> Vc<ChunkItems> {\n         self.content.included_chunk_items()\n     }\n }"
        },
        {
            "sha": "17d950a0b3eca9a2d69af1a13c5efcadb67bc17a",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -330,7 +330,7 @@ pub trait EcmascriptAnalyzable: Module + Asset {\n     ) -> Result<Vc<EcmascriptModuleContentOptions>>;\n \n     #[turbo_tasks::function]\n-    async fn module_content(\n+    fn module_content(\n         self: Vc<Self>,\n         module_graph: Vc<ModuleGraph>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n@@ -650,7 +650,7 @@ impl Module for EcmascriptModuleAsset {\n     }\n \n     #[turbo_tasks::function]\n-    async fn references(self: Vc<Self>) -> Result<Vc<ModuleReferences>> {\n+    fn references(self: Vc<Self>) -> Result<Vc<ModuleReferences>> {\n         Ok(self.analyze().references())\n     }\n "
        },
        {
            "sha": "026b1daf17d825e4d6e75f0bf77a85419d4b2f56",
            "filename": "turbopack/crates/turbopack-ecmascript/src/manifest/chunk_asset.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_asset.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -40,7 +40,7 @@ pub struct ManifestAsyncModule {\n #[turbo_tasks::value_impl]\n impl ManifestAsyncModule {\n     #[turbo_tasks::function]\n-    pub async fn new(\n+    pub fn new(\n         module: ResolvedVc<Box<dyn ChunkableModule>>,\n         module_graph: ResolvedVc<ModuleGraph>,\n         chunking_context: ResolvedVc<Box<dyn ChunkingContext>>,\n@@ -153,7 +153,7 @@ impl Asset for ManifestAsyncModule {\n #[turbo_tasks::value_impl]\n impl ChunkableModule for ManifestAsyncModule {\n     #[turbo_tasks::function]\n-    async fn as_chunk_item(\n+    fn as_chunk_item(\n         self: ResolvedVc<Self>,\n         _module_graph: Vc<ModuleGraph>,\n         chunking_context: ResolvedVc<Box<dyn ChunkingContext>>,"
        },
        {
            "sha": "02b15f59c2aa415437f18120e1a2ef4769e24abb",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/cjs.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -40,7 +40,7 @@ pub struct CjsAssetReference {\n #[turbo_tasks::value_impl]\n impl CjsAssetReference {\n     #[turbo_tasks::function]\n-    pub async fn new(\n+    pub fn new(\n         origin: ResolvedVc<Box<dyn ResolveOrigin>>,\n         request: ResolvedVc<Request>,\n         issue_source: IssueSource,"
        },
        {
            "sha": "71a2f45134e6f503a4351a23bed9f78c34f9b79b",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/external_module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -127,12 +127,12 @@ impl Module for CachedExternalModule {\n     }\n \n     #[turbo_tasks::function]\n-    async fn references(&self) -> Result<Vc<ModuleReferences>> {\n+    fn references(&self) -> Result<Vc<ModuleReferences>> {\n         Ok(Vc::cell(self.additional_references.clone()))\n     }\n \n     #[turbo_tasks::function]\n-    async fn is_self_async(&self) -> Result<Vc<bool>> {\n+    fn is_self_async(&self) -> Result<Vc<bool>> {\n         Ok(Vc::cell(\n             self.external_type == CachedExternalType::EcmaScriptViaImport,\n         ))"
        },
        {
            "sha": "51da0c2327aa851c40542ef27db63c784c1ef0ce",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/facade/chunk_item.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fchunk_item.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -32,7 +32,7 @@ impl EcmascriptChunkItem for EcmascriptModuleFacadeChunkItem {\n     }\n \n     #[turbo_tasks::function]\n-    async fn content_with_async_module_info(\n+    fn content_with_async_module_info(\n         &self,\n         async_module_info: Option<Vc<AsyncModuleInfo>>,\n     ) -> Result<Vc<EcmascriptChunkItemContent>> {"
        },
        {
            "sha": "e03de7114311c30438c8ffe8d3088b0f60fa036e",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/facade/module.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fmodule.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -432,7 +432,7 @@ impl EcmascriptChunkPlaceable for EcmascriptModuleFacadeModule {\n #[turbo_tasks::value_impl]\n impl ChunkableModule for EcmascriptModuleFacadeModule {\n     #[turbo_tasks::function]\n-    async fn as_chunk_item(\n+    fn as_chunk_item(\n         self: ResolvedVc<Self>,\n         module_graph: ResolvedVc<ModuleGraph>,\n         chunking_context: ResolvedVc<Box<dyn ChunkingContext>>,"
        },
        {
            "sha": "a821fcc697526b0f12b7c3e0f94bdcf791b8162c",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/locals/module.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fmodule.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -49,7 +49,7 @@ impl Module for EcmascriptModuleLocalsModule {\n     }\n \n     #[turbo_tasks::function]\n-    async fn references(&self) -> Result<Vc<ModuleReferences>> {\n+    fn references(&self) -> Result<Vc<ModuleReferences>> {\n         let result = self.module.analyze();\n         Ok(result.local_references())\n     }"
        },
        {
            "sha": "f3ee2ce32db5f86ed465d649c94e8aefe20d8d62",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/reference.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -74,7 +74,7 @@ impl EcmascriptModulePartReference {\n #[turbo_tasks::value_impl]\n impl ValueToString for EcmascriptModulePartReference {\n     #[turbo_tasks::function]\n-    async fn to_string(&self) -> Vc<RcStr> {\n+    fn to_string(&self) -> Vc<RcStr> {\n         Vc::cell(self.part.to_string().into())\n     }\n }"
        },
        {
            "sha": "6c04051856e84fb180437277e770ab87ac474478",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/asset.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fasset.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -43,7 +43,7 @@ pub struct EcmascriptModulePartAsset {\n #[turbo_tasks::value_impl]\n impl EcmascriptParsable for EcmascriptModulePartAsset {\n     #[turbo_tasks::function]\n-    async fn failsafe_parse(&self) -> Result<Vc<ParseResult>> {\n+    fn failsafe_parse(&self) -> Result<Vc<ParseResult>> {\n         let parsed = self.full_module.failsafe_parse();\n         let split_data = split(self.full_module.ident(), self.full_module.source(), parsed);\n         Ok(part_of_module(split_data, self.part.clone()))"
        },
        {
            "sha": "6fa329248d83b50473328a7eba6b184cf708921d",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fmod.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -469,7 +469,7 @@ impl PartialEq for SplitResult {\n }\n \n #[turbo_tasks::function]\n-pub(super) async fn split_module(asset: Vc<EcmascriptModuleAsset>) -> Result<Vc<SplitResult>> {\n+pub(super) fn split_module(asset: Vc<EcmascriptModuleAsset>) -> Result<Vc<SplitResult>> {\n     Ok(split(asset.source().ident(), asset.source(), asset.parse()))\n }\n "
        },
        {
            "sha": "a5e6a638849b0003abdeca9d6cf0fb336cb8bd6e",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/side_effect_module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fside_effect_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f31b032751cb5091d62253f1b07f02e7a1a99735/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fside_effect_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fside_effect_module.rs?ref=f31b032751cb5091d62253f1b07f02e7a1a99735",
            "patch": "@@ -120,12 +120,12 @@ impl Asset for SideEffectsModule {\n #[turbo_tasks::value_impl]\n impl EcmascriptChunkPlaceable for SideEffectsModule {\n     #[turbo_tasks::function]\n-    async fn get_exports(&self) -> Vc<EcmascriptExports> {\n+    fn get_exports(&self) -> Vc<EcmascriptExports> {\n         self.resolved_as.get_exports()\n     }\n \n     #[turbo_tasks::function]\n-    async fn is_marked_as_side_effect_free(self: Vc<Self>, _: Vc<Glob>) -> Vc<bool> {\n+    fn is_marked_as_side_effect_free(self: Vc<Self>, _: Vc<Glob>) -> Vc<bool> {\n         Vc::cell(true)\n     }\n }"
        }
    ],
    "stats": {
        "total": 36,
        "additions": 18,
        "deletions": 18
    }
}