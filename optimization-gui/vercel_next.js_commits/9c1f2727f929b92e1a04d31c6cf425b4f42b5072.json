{
    "author": "kdy1",
    "message": "Revert \"refactor(turbopack): Make invalidator flag explicit\" (#80466)\n\nReverts vercel/next.js#80414\n\nit turns out that we were not running debug assertions from CI.\n\n\nx-ref: https://vercel.slack.com/archives/C03EWR7LGEN/p1749765841011769",
    "sha": "9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
    "files": [
        {
            "sha": "5630e075bb7c857b5ded432ea7e783f7d3f5f0d3",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -423,7 +423,7 @@ impl ProjectContainer {\n \n #[turbo_tasks::value_impl]\n impl ProjectContainer {\n-    #[turbo_tasks::function(invalidator)]\n+    #[turbo_tasks::function]\n     pub async fn project(&self) -> Result<Vc<Project>> {\n         let env_map: Vc<EnvMap>;\n         let next_config;"
        },
        {
            "sha": "f08a9e2e09fc0c3dd1687ead8dd31186aefec964",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -551,7 +551,7 @@ impl Debug for DiskFileSystem {\n \n #[turbo_tasks::value_impl]\n impl FileSystem for DiskFileSystem {\n-    #[turbo_tasks::function(fs, invalidator)]\n+    #[turbo_tasks::function(fs)]\n     async fn read(&self, fs_path: Vc<FileSystemPath>) -> Result<Vc<FileContent>> {\n         mark_session_dependent();\n         let full_path = self.to_sys_path(fs_path).await?;\n@@ -577,7 +577,7 @@ impl FileSystem for DiskFileSystem {\n         Ok(content.cell())\n     }\n \n-    #[turbo_tasks::function(fs, invalidator)]\n+    #[turbo_tasks::function(fs)]\n     async fn raw_read_dir(&self, fs_path: Vc<FileSystemPath>) -> Result<Vc<RawDirectoryContent>> {\n         mark_session_dependent();\n         let full_path = self.to_sys_path(fs_path).await?;\n@@ -632,7 +632,7 @@ impl FileSystem for DiskFileSystem {\n         Ok(RawDirectoryContent::new(entries))\n     }\n \n-    #[turbo_tasks::function(fs, invalidator)]\n+    #[turbo_tasks::function(fs)]\n     async fn read_link(&self, fs_path: Vc<FileSystemPath>) -> Result<Vc<LinkContent>> {\n         mark_session_dependent();\n         let full_path = self.to_sys_path(fs_path).await?;\n@@ -718,7 +718,7 @@ impl FileSystem for DiskFileSystem {\n         .cell())\n     }\n \n-    #[turbo_tasks::function(fs, invalidator)]\n+    #[turbo_tasks::function(fs)]\n     async fn write(&self, fs_path: Vc<FileSystemPath>, content: Vc<FileContent>) -> Result<()> {\n         mark_session_dependent();\n         let full_path = self.to_sys_path(fs_path).await?;\n@@ -843,7 +843,7 @@ impl FileSystem for DiskFileSystem {\n         Ok(())\n     }\n \n-    #[turbo_tasks::function(fs, invalidator)]\n+    #[turbo_tasks::function(fs)]\n     async fn write_link(&self, fs_path: Vc<FileSystemPath>, target: Vc<LinkContent>) -> Result<()> {\n         mark_session_dependent();\n         let full_path = self.to_sys_path(fs_path).await?;\n@@ -962,7 +962,7 @@ impl FileSystem for DiskFileSystem {\n         Ok(())\n     }\n \n-    #[turbo_tasks::function(fs, invalidator)]\n+    #[turbo_tasks::function(fs)]\n     async fn metadata(&self, fs_path: Vc<FileSystemPath>) -> Result<Vc<FileMeta>> {\n         mark_session_dependent();\n         let full_path = self.to_sys_path(fs_path).await?;"
        },
        {
            "sha": "04266ef3404c84885574b525078d8f8421c71f7b",
            "filename": "turbopack/crates/turbo-tasks-macros-tests/tests/function/fail_attribute_invalid_args.stderr",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_attribute_invalid_args.stderr",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_attribute_invalid_args.stderr",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_attribute_invalid_args.stderr?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -1,4 +1,4 @@\n-error: unexpected token, expected one of: \"fs\", \"network\", \"operation\", \"local\", \"invalidator\"\n+error: unexpected token, expected one of: \"fs\", \"network\", \"operation\", \"local\"\n  --> tests/function/fail_attribute_invalid_args.rs:9:25\n   |\n 9 | #[turbo_tasks::function(invalid_argument)]"
        },
        {
            "sha": "1522fe8676a2681c35d223e65e075691efd6096f",
            "filename": "turbopack/crates/turbo-tasks-macros-tests/tests/function/fail_attribute_invalid_args_inherent_impl.stderr",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_attribute_invalid_args_inherent_impl.stderr",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_attribute_invalid_args_inherent_impl.stderr",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_attribute_invalid_args_inherent_impl.stderr?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -1,4 +1,4 @@\n-error: unexpected token, expected one of: \"fs\", \"network\", \"operation\", \"local\", \"invalidator\"\n+error: unexpected token, expected one of: \"fs\", \"network\", \"operation\", \"local\"\n   --> tests/function/fail_attribute_invalid_args_inherent_impl.rs:14:29\n    |\n 14 |     #[turbo_tasks::function(invalid_argument)]"
        },
        {
            "sha": "e6e5edb68aca3102919a29c38beee0d3659262cc",
            "filename": "turbopack/crates/turbo-tasks-macros/src/func.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 12,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Ffunc.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Ffunc.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Ffunc.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -733,9 +733,6 @@ pub struct FunctionArguments {\n     /// task-local state. The function call itself will not be cached, but cells will be created on\n     /// the parent task.\n     pub local: Option<Span>,\n-    /// If true, the function will be allowed to call `get_invalidator` . If this is false, the\n-    /// `get_invalidator` function will panic on calls.\n-    pub invalidator: Option<Span>,\n }\n \n impl Parse for FunctionArguments {\n@@ -763,14 +760,11 @@ impl Parse for FunctionArguments {\n                 (\"local\", Meta::Path(_)) => {\n                     parsed_args.local = Some(meta.span());\n                 }\n-                (\"invalidator\", Meta::Path(_)) => {\n-                    parsed_args.invalidator = Some(meta.span());\n-                }\n                 (_, meta) => {\n                     return Err(syn::Error::new_spanned(\n                         meta,\n                         \"unexpected token, expected one of: \\\"fs\\\", \\\"network\\\", \\\"operation\\\", \\\n-                         \\\"local\\\", \\\"invalidator\\\"\",\n+                         \\\"local\\\"\",\n                     ));\n                 }\n             }\n@@ -1098,7 +1092,6 @@ pub struct NativeFn {\n     pub is_self_used: bool,\n     pub filter_trait_call_args: Option<FilterTraitCallArgsTokens>,\n     pub local: bool,\n-    pub invalidator: bool,\n }\n \n impl NativeFn {\n@@ -1114,7 +1107,6 @@ impl NativeFn {\n             is_self_used,\n             filter_trait_call_args,\n             local,\n-            invalidator,\n         } = self;\n \n         if *is_method {\n@@ -1141,7 +1133,6 @@ impl NativeFn {\n                             #function_path_string.to_owned(),\n                             turbo_tasks::macro_helpers::FunctionMeta {\n                                 local: #local,\n-                                invalidator: #invalidator,\n                             },\n                             #arg_filter,\n                             #function_path,\n@@ -1156,7 +1147,6 @@ impl NativeFn {\n                             #function_path_string.to_owned(),\n                             turbo_tasks::macro_helpers::FunctionMeta {\n                                 local: #local,\n-                                invalidator: #invalidator,\n                             },\n                             #arg_filter,\n                             #function_path,\n@@ -1172,7 +1162,6 @@ impl NativeFn {\n                         #function_path_string.to_owned(),\n                         turbo_tasks::macro_helpers::FunctionMeta {\n                             local: #local,\n-                            invalidator: #invalidator,\n                         },\n                         #function_path,\n                     )"
        },
        {
            "sha": "8709dbecd261bc2f5243205421fef5211f5146c6",
            "filename": "turbopack/crates/turbo-tasks-macros/src/function_macro.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Ffunction_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Ffunction_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Ffunction_macro.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -42,7 +42,6 @@ pub fn function(args: TokenStream, input: TokenStream) -> TokenStream {\n         .inspect_err(|err| errors.push(err.to_compile_error()))\n         .unwrap_or_default();\n     let local = args.local.is_some();\n-    let invalidator = args.invalidator.is_some();\n     let is_self_used = args.operation.is_some() || is_self_used(&block);\n \n     let Some(turbo_fn) = TurboFn::new(&sig, DefinitionContext::NakedFn, args) else {\n@@ -66,7 +65,6 @@ pub fn function(args: TokenStream, input: TokenStream) -> TokenStream {\n         is_self_used,\n         filter_trait_call_args: None, // not a trait method\n         local,\n-        invalidator,\n     };\n     let native_function_ident = get_native_function_ident(ident);\n     let native_function_ty = native_fn.ty();"
        },
        {
            "sha": "a4742ca42db2b853c3a4ee6d87c88efa776a9264",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_impl_macro.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -84,7 +84,6 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n                     continue;\n                 };\n                 let local = func_args.local.is_some();\n-                let invalidator = func_args.invalidator.is_some();\n                 let is_self_used = func_args.operation.is_some() || is_self_used(block);\n \n                 let Some(turbo_fn) =\n@@ -107,7 +106,6 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n                     is_self_used,\n                     filter_trait_call_args: None, // not a trait method\n                     local,\n-                    invalidator,\n                 };\n \n                 let native_function_ident = get_inherent_impl_function_ident(ty_ident, ident);\n@@ -193,7 +191,6 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n                 };\n \n                 let local = func_args.local.is_some();\n-                let invalidator = func_args.invalidator.is_some();\n                 let is_self_used = func_args.operation.is_some() || is_self_used(block);\n \n                 let Some(turbo_fn) =\n@@ -226,7 +223,6 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n                     is_self_used,\n                     filter_trait_call_args: turbo_fn.filter_trait_call_args(),\n                     local,\n-                    invalidator,\n                 };\n \n                 let native_function_ident ="
        },
        {
            "sha": "589800b4ef1c51f2c88ab469f75490c6b3bc3434",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_trait_macro.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -139,7 +139,6 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n                 //   argument. (This could be fixed)\n                 // - This only makes sense when a default implementation is present.\n                 local: false,\n-                invalidator: func_args.invalidator.is_some(),\n             };\n \n             let native_function_ident = get_trait_default_impl_function_ident(trait_ident, ident);"
        },
        {
            "sha": "7949c493f52618306b20119078a9e62e49ff54d1",
            "filename": "turbopack/crates/turbo-tasks-testing/tests/read_ref_cell.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fread_ref_cell.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fread_ref_cell.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fread_ref_cell.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -70,7 +70,7 @@ impl Counter {\n \n #[turbo_tasks::value_impl]\n impl Counter {\n-    #[turbo_tasks::function(invalidator)]\n+    #[turbo_tasks::function]\n     async fn get_value(&self) -> Result<Vc<CounterValue>> {\n         let mut lock = self.value.lock().unwrap();\n         lock.1 = Some(get_invalidator());"
        },
        {
            "sha": "d06727332a8072d09fbec9157c63bb604d6c0b62",
            "filename": "turbopack/crates/turbo-tasks-testing/tests/trait_ref_cell.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Ftrait_ref_cell.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Ftrait_ref_cell.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Ftrait_ref_cell.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -85,7 +85,7 @@ trait CounterTrait {\n \n #[turbo_tasks::value_impl]\n impl CounterTrait for Counter {\n-    #[turbo_tasks::function(invalidator)]\n+    #[turbo_tasks::function]\n     async fn get_value(&self) -> Result<Vc<CounterValue>> {\n         let mut lock = self.value.lock().unwrap();\n         lock.1 = Some(get_invalidator());"
        },
        {
            "sha": "f547f19d59a7b95530227b7b0cc1fece10757554",
            "filename": "turbopack/crates/turbo-tasks/src/invalidation.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 19,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Finvalidation.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Finvalidation.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Finvalidation.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -9,7 +9,7 @@ use std::{\n use anyhow::Result;\n use indexmap::map::Entry;\n use serde::{Deserialize, Serialize, de::Visitor};\n-use tokio::{runtime::Handle, task_local};\n+use tokio::runtime::Handle;\n \n use crate::{\n     FxIndexMap, FxIndexSet, TaskId, TurboTasksApi,\n@@ -19,27 +19,9 @@ use crate::{\n     util::StaticOrArc,\n };\n \n-#[cfg(debug_assertions)]\n-task_local! {\n-    static ALLOW_INVALIDATOR: ();\n-}\n-\n-#[cfg(debug_assertions)]\n-pub fn allow_invalidator<R>(f: impl Future<Output = R>) -> impl Future<Output = R> {\n-    ALLOW_INVALIDATOR.scope((), f)\n-}\n-\n /// Get an [`Invalidator`] that can be used to invalidate the current task\n /// based on external events.\n pub fn get_invalidator() -> Invalidator {\n-    #[cfg(debug_assertions)]\n-    if ALLOW_INVALIDATOR.try_with(|_| {}).is_err() {\n-        panic!(\n-            \"Invalidator can only be used in the turbo-tasks function that has \\\n-             #[turbo_tasks::function(invalidator)] attribute\"\n-        );\n-    }\n-\n     let handle = Handle::current();\n     Invalidator {\n         task: current_task(\"turbo_tasks::get_invalidator()\"),"
        },
        {
            "sha": "e6c443a03a499707ada32dbdd0970ab6d58b584c",
            "filename": "turbopack/crates/turbo-tasks/src/native_function.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 12,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fnative_function.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9c1f2727f929b92e1a04d31c6cf425b4f42b5072/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fnative_function.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fnative_function.rs?ref=9c1f2727f929b92e1a04d31c6cf425b4f42b5072",
            "patch": "@@ -144,10 +144,6 @@ pub struct FunctionMeta {\n     /// task-local state. The function call itself will not be cached, but cells will be created on\n     /// the parent task.\n     pub local: bool,\n-\n-    /// If true, the function will be allowed to call `get_invalidator` . If this is false, the\n-    /// `get_invalidator` function will panic on calls.\n-    pub invalidator: bool,\n }\n \n /// A native (rust) turbo-tasks function. It's used internally by\n@@ -239,14 +235,7 @@ impl NativeFunction {\n     /// Executed the function\n     pub fn execute(&'static self, this: Option<RawVc>, arg: &dyn MagicAny) -> NativeTaskFuture {\n         match (self.implementation).functor(this, arg) {\n-            Ok(functor) => {\n-                #[cfg(debug_assertions)]\n-                if self.function_meta.invalidator {\n-                    return Box::pin(crate::invalidation::allow_invalidator(functor));\n-                }\n-\n-                functor\n-            }\n+            Ok(functor) => functor,\n             Err(err) => Box::pin(async { Err(err) }),\n         }\n     }"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 14,
        "deletions": 61
    }
}