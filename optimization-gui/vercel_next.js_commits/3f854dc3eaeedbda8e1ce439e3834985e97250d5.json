{
    "author": "devjiwonchoi",
    "message": "[codemod] fix: next-lint-to-eslint-cli did not handle `'next'` plugin (#85749)\n\nCodemod `next-lint-to-eslint-cli` did not handle `extends: ['next']` in\nlegacy ESLint config.\n\nx-ref:\nhttps://github.com/vercel/next.js/issues/85244#issuecomment-3482558412\n\nFixes #85244",
    "sha": "3f854dc3eaeedbda8e1ce439e3834985e97250d5",
    "files": [
        {
            "sha": "872147a7942961571b6c210a299ac7aeb3ae0695",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/legacy-config/.eslintrc.json",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/3f854dc3eaeedbda8e1ce439e3834985e97250d5/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2F.eslintrc.json",
            "raw_url": "https://github.com/vercel/next.js/raw/3f854dc3eaeedbda8e1ce439e3834985e97250d5/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2F.eslintrc.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2F.eslintrc.json?ref=3f854dc3eaeedbda8e1ce439e3834985e97250d5",
            "patch": "@@ -3,6 +3,8 @@\n   \"root\": true,\n   \"extends\": [\n     \"next/core-web-vitals\",\n+    \"next\",\n+    \"next/typescript\",\n     \"turbo\",\n     \"prettier\",\n     \"plugin:tailwindcss/recommended\""
        },
        {
            "sha": "9349d262bc7ed0ce240d685061ef5f74feeba880",
            "filename": "packages/next-codemod/transforms/__tests__/next-lint-to-eslint-cli.test.js",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/3f854dc3eaeedbda8e1ce439e3834985e97250d5/packages%2Fnext-codemod%2Ftransforms%2F__tests__%2Fnext-lint-to-eslint-cli.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/3f854dc3eaeedbda8e1ce439e3834985e97250d5/packages%2Fnext-codemod%2Ftransforms%2F__tests__%2Fnext-lint-to-eslint-cli.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__tests__%2Fnext-lint-to-eslint-cli.test.js?ref=3f854dc3eaeedbda8e1ce439e3834985e97250d5",
            "patch": "@@ -110,13 +110,14 @@ describe('next-lint-to-eslint-cli', () => {\n         'utf8'\n       )\n       expect(actualConfig).toMatchInlineSnapshot(`\n-       \"import nextCoreWebVitals from \"eslint-config-next/core-web-vitals\";\n+       \"import next from \"eslint-config-next\";\n+       import nextCoreWebVitals from \"eslint-config-next/core-web-vitals\";\n        import nextTypescript from \"eslint-config-next/typescript\";\n        import { defineConfig } from 'eslint/config'\n        import foo from 'foo'\n        import bar from 'bar'\n \n-       const eslintConfig = defineConfig([...nextCoreWebVitals, ...nextTypescript, foo, bar, {\n+       const eslintConfig = defineConfig([...next, ...nextCoreWebVitals, ...nextTypescript, foo, bar, {\n          ignores: [\n            'node_modules/**',\n            '.next/**',\n@@ -309,7 +310,10 @@ describe('next-lint-to-eslint-cli', () => {\n \n   describe('flat-config-flat-compat-with-other-compat', () => {\n     it('should replace FlatCompat config with direct imports while preserving other configs', () => {\n-      const testDir = path.join(fixturesDir, 'flat-config-flat-compat-with-other-compat')\n+      const testDir = path.join(\n+        fixturesDir,\n+        'flat-config-flat-compat-with-other-compat'\n+      )\n       // Check BEFORE state\n       const beforeConfig = fs.readFileSync(\n         path.join(testDir, 'eslint.config.mjs'),\n@@ -413,6 +417,8 @@ describe('next-lint-to-eslint-cli', () => {\n          \"root\": true,\n          \"extends\": [\n            \"next/core-web-vitals\",\n+           \"next\",\n+           \"next/typescript\",\n            \"turbo\",\n            \"prettier\",\n            \"plugin:tailwindcss/recommended\"\n@@ -491,7 +497,9 @@ describe('next-lint-to-eslint-cli', () => {\n       )\n       expect(actualConfig).toMatchInlineSnapshot(`\n        \"import { defineConfig, globalIgnores } from \"eslint/config\";\n+       import next from \"eslint-config-next\";\n        import nextCoreWebVitals from \"eslint-config-next/core-web-vitals\";\n+       import nextTypescript from \"eslint-config-next/typescript\";\n        import tailwindcss from \"eslint-plugin-tailwindcss\";\n        import tsParser from \"@typescript-eslint/parser\";\n        import path from \"node:path\";\n@@ -518,6 +526,8 @@ describe('next-lint-to-eslint-cli', () => {\n        ]), {\n            extends: [\n                ...nextCoreWebVitals,\n+               ...next,\n+               ...nextTypescript,\n                ...compat.extends(\"turbo\"),\n                ...compat.extends(\"prettier\"),\n                ...compat.extends(\"plugin:tailwindcss/recommended\")"
        },
        {
            "sha": "8951cb27f3ff9108e965d064864b13dc444912cf",
            "filename": "packages/next-codemod/transforms/next-lint-to-eslint-cli.ts",
            "status": "modified",
            "additions": 46,
            "deletions": 8,
            "changes": 54,
            "blob_url": "https://github.com/vercel/next.js/blob/3f854dc3eaeedbda8e1ce439e3834985e97250d5/packages%2Fnext-codemod%2Ftransforms%2Fnext-lint-to-eslint-cli.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3f854dc3eaeedbda8e1ce439e3834985e97250d5/packages%2Fnext-codemod%2Ftransforms%2Fnext-lint-to-eslint-cli.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2Fnext-lint-to-eslint-cli.ts?ref=3f854dc3eaeedbda8e1ce439e3834985e97250d5",
            "patch": "@@ -129,6 +129,7 @@ function replaceFlatCompatInConfig(configPath: string): boolean {\n   const root = j(configContent)\n \n   // Track if we need to add imports and preserve other configs\n+  let needsNext = false\n   let needsNextVitals = false\n   let needsNextTs = false\n   let otherConfigs: string[] = []\n@@ -148,7 +149,9 @@ function replaceFlatCompatInConfig(configPath: string): boolean {\n       // Check arguments for all configs\n       node.arguments.forEach((arg: any) => {\n         if (arg.type === 'Literal' || arg.type === 'StringLiteral') {\n-          if (arg.value === 'next/core-web-vitals') {\n+          if (arg.value === 'next') {\n+            needsNext = true\n+          } else if (arg.value === 'next/core-web-vitals') {\n             needsNextVitals = true\n           } else if (arg.value === 'next/typescript') {\n             needsNextTs = true\n@@ -184,7 +187,9 @@ function replaceFlatCompatInConfig(configPath: string): boolean {\n                   element.type === 'Literal' ||\n                   element.type === 'StringLiteral'\n                 ) {\n-                  if (element.value === 'next/core-web-vitals') {\n+                  if (element.value === 'next') {\n+                    needsNext = true\n+                  } else if (element.value === 'next/core-web-vitals') {\n                     needsNextVitals = true\n                   } else if (element.value === 'next/typescript') {\n                     needsNextTs = true\n@@ -201,15 +206,20 @@ function replaceFlatCompatInConfig(configPath: string): boolean {\n     }\n   })\n \n-  if (!needsNextVitals && !needsNextTs && otherConfigs.length === 0) {\n+  if (\n+    !needsNext &&\n+    !needsNextVitals &&\n+    !needsNextTs &&\n+    otherConfigs.length === 0\n+  ) {\n     console.warn(\n       prefixes.warn,\n       '   No ESLint configs found in FlatCompat usage'\n     )\n     return false\n   }\n \n-  if (!needsNextVitals && !needsNextTs) {\n+  if (!needsNext && !needsNextVitals && !needsNextTs) {\n     console.log('   No Next.js configs found, but preserving other configs')\n   }\n \n@@ -256,7 +266,16 @@ function replaceFlatCompatInConfig(configPath: string): boolean {\n   // Add new imports after the eslint/config import\n   const imports = []\n \n-  // Add imports in correct order: core-web-vitals first, then typescript\n+  // Add imports in correct order: next first, then core-web-vitals, then typescript\n+  if (needsNext) {\n+    imports.push(\n+      j.importDeclaration(\n+        [j.importDefaultSpecifier(j.identifier('next'))],\n+        j.literal('eslint-config-next')\n+      )\n+    )\n+  }\n+\n   if (needsNextVitals) {\n     imports.push(\n       j.importDeclaration(\n@@ -314,7 +333,9 @@ function replaceFlatCompatInConfig(configPath: string): boolean {\n       const replacements = []\n       node.argument.arguments.forEach((arg: any) => {\n         if (arg.type === 'Literal' || arg.type === 'StringLiteral') {\n-          if (arg.value === 'next/core-web-vitals') {\n+          if (arg.value === 'next') {\n+            replacements.push(j.spreadElement(j.identifier('next')))\n+          } else if (arg.value === 'next/core-web-vitals') {\n             replacements.push(\n               j.spreadElement(j.identifier('nextCoreWebVitals'))\n             )\n@@ -381,7 +402,9 @@ function replaceFlatCompatInConfig(configPath: string): boolean {\n                   element.type === 'Literal' ||\n                   element.type === 'StringLiteral'\n                 ) {\n-                  if (element.value === 'next/core-web-vitals') {\n+                  if (element.value === 'next') {\n+                    replacements.push(j.spreadElement(j.identifier('next')))\n+                  } else if (element.value === 'next/core-web-vitals') {\n                     replacements.push(\n                       j.spreadElement(j.identifier('nextCoreWebVitals'))\n                     )\n@@ -464,7 +487,9 @@ function replaceFlatCompatInConfig(configPath: string): boolean {\n         const replacements = []\n         prop.value.arguments.forEach((arg: any) => {\n           if (arg.type === 'Literal' || arg.type === 'StringLiteral') {\n-            if (arg.value === 'next/core-web-vitals') {\n+            if (arg.value === 'next') {\n+              replacements.push(j.spreadElement(j.identifier('next')))\n+            } else if (arg.value === 'next/core-web-vitals') {\n               replacements.push(\n                 j.spreadElement(j.identifier('nextCoreWebVitals'))\n               )\n@@ -570,6 +595,7 @@ function updateExistingFlatConfig(\n   }\n \n   // Check if Next.js configs are already imported directly\n+  const hasNext = configContent.includes('eslint-config-next')\n   const hasNextVitals = configContent.includes(\n     'eslint-config-next/core-web-vitals'\n   )\n@@ -646,6 +672,15 @@ function updateExistingFlatConfig(\n   const program = root.find(j.Program)\n   const imports = []\n \n+  if (!hasNext) {\n+    imports.push(\n+      j.importDeclaration(\n+        [j.importDefaultSpecifier(j.identifier('next'))],\n+        j.literal('eslint-config-next')\n+      )\n+    )\n+  }\n+\n   if (!hasNextVitals) {\n     imports.push(\n       j.importDeclaration(\n@@ -675,6 +710,9 @@ function updateExistingFlatConfig(\n   }\n \n   const spreadsToAdd = []\n+  if (!hasNext) {\n+    spreadsToAdd.push(j.spreadElement(j.identifier('next')))\n+  }\n   if (!hasNextVitals) {\n     spreadsToAdd.push(j.spreadElement(j.identifier('nextCoreWebVitals')))\n   }"
        }
    ],
    "stats": {
        "total": 72,
        "additions": 61,
        "deletions": 11
    }
}