{
    "author": "raunofreiberg",
    "message": "[dev-tools] Fix `width` transition logic (#78635)",
    "sha": "8385a5cb808f449573c3d3dbc41c8090c977980e",
    "files": [
        {
            "sha": "86d16faa6f41bbcd87365ed16bf566afb937a4d3",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/next-logo.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 28,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/8385a5cb808f449573c3d3dbc41c8090c977980e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fnext-logo.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/8385a5cb808f449573c3d3dbc41c8090c977980e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fnext-logo.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fnext-logo.tsx?ref=8385a5cb808f449573c3d3dbc41c8090c977980e",
            "patch": "@@ -1,4 +1,4 @@\n-import { forwardRef, useEffect, useMemo, useRef, useState } from 'react'\n+import { forwardRef, useEffect, useRef, useState } from 'react'\n import { css } from '../../../../utils/css'\n import mergeRefs from '../../../utils/merge-refs'\n import { useMinimumLoadingTimeMultiple } from './use-minimum-loading-time-multiple'\n@@ -39,22 +39,13 @@ export const NextLogo = forwardRef(function NextLogo(\n \n   const triggerRef = useRef<HTMLButtonElement | null>(null)\n   const ref = useRef<HTMLDivElement | null>(null)\n-  const [measuredWidth, pristine] = useMeasureWidth(ref)\n+  const measuredWidth = useMeasureWidth(ref)\n \n   const isLoading = useMinimumLoadingTimeMultiple(\n     isDevBuilding || isDevRendering\n   )\n   const isExpanded = isErrorExpanded || disabled\n-\n-  const style = useMemo(() => {\n-    let width: number | string = SIZE\n-    // Animates the badge, if expanded\n-    if (measuredWidth > SIZE) width = measuredWidth\n-    // No animations on page load, assume the intrinsic width immediately\n-    if (pristine && hasError) width = 'auto'\n-    // Default state, collapsed\n-    return { width }\n-  }, [measuredWidth, pristine, hasError, SIZE])\n+  const width = measuredWidth === 0 ? 'auto' : measuredWidth\n \n   useEffect(() => {\n     setIsErrorExpanded(hasError)\n@@ -200,7 +191,7 @@ export const NextLogo = forwardRef(function NextLogo(\n             padding-left: 8px;\n             padding-right: 8px;\n             height: var(--size-32);\n-            margin: 0 2px;\n+            margin-right: 2px;\n             border-radius: var(--rounded-full);\n             transition: background var(--duration-short) ease;\n \n@@ -256,7 +247,7 @@ export const NextLogo = forwardRef(function NextLogo(\n           [data-next-mark] {\n             width: var(--mark-size);\n             height: var(--mark-size);\n-            margin-left: 2px;\n+            margin: 0 2px;\n             display: flex;\n             align-items: center;\n             border-radius: var(--rounded-full);\n@@ -400,7 +391,7 @@ export const NextLogo = forwardRef(function NextLogo(\n         data-error={hasError}\n         data-error-expanded={isExpanded}\n         data-animate={newErrorDetected}\n-        style={style}\n+        style={{ width }}\n       >\n         <div ref={ref}>\n           {/* Children */}\n@@ -496,11 +487,8 @@ function AnimateCount({\n   )\n }\n \n-function useMeasureWidth(\n-  ref: React.RefObject<HTMLDivElement | null>\n-): [number, boolean] {\n+function useMeasureWidth(ref: React.RefObject<HTMLDivElement | null>): number {\n   const [width, setWidth] = useState<number>(0)\n-  const [pristine, setPristine] = useState(true)\n \n   useEffect(() => {\n     const el = ref.current\n@@ -509,21 +497,15 @@ function useMeasureWidth(\n       return\n     }\n \n-    const observer = new ResizeObserver(() => {\n-      const { width: w } = el.getBoundingClientRect()\n-      setWidth((prevWidth) => {\n-        if (prevWidth !== 0) {\n-          setPristine(false)\n-        }\n-        return w\n-      })\n+    const observer = new ResizeObserver(([{ contentRect }]) => {\n+      setWidth(contentRect.width)\n     })\n \n     observer.observe(el)\n     return () => observer.disconnect()\n   }, [ref])\n \n-  return [width, pristine]\n+  return width\n }\n \n function useUpdateAnimation(issueCount: number, animationDurationMs = 0) {"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 10,
        "deletions": 28
    }
}