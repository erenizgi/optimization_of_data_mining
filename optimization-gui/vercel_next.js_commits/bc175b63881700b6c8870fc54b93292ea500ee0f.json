{
    "author": "sokra",
    "message": "Turbopack: use match consistently in macro (#86767)\n\n### What?\n\nCleanup for consistency",
    "sha": "bc175b63881700b6c8870fc54b93292ea500ee0f",
    "files": [
        {
            "sha": "38f57ae6fac22b73f5ce16c36cdee68ecbf1ae61",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/storage.rs",
            "status": "modified",
            "additions": 33,
            "deletions": 26,
            "changes": 59,
            "blob_url": "https://github.com/vercel/next.js/blob/bc175b63881700b6c8870fc54b93292ea500ee0f/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fstorage.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bc175b63881700b6c8870fc54b93292ea500ee0f/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fstorage.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fstorage.rs?ref=bc175b63881700b6c8870fc54b93292ea500ee0f",
            "patch": "@@ -1055,22 +1055,25 @@ macro_rules! update {\n }\n \n macro_rules! update_count {\n-    ($task:ident, $key:ident $input:tt, -$update:expr) => {{\n-        let update = $update;\n-        let mut state_change = false;\n-        $crate::backend::storage::update!($task, $key $input, |old: Option<_>| {\n-            #[allow(unused_comparisons, reason = \"type of update might be unsigned, where update < 0 is always false\")]\n-            if let Some(old) = old {\n-                let new = old - update;\n-                state_change = old <= 0 && new > 0 || old > 0 && new <= 0;\n-                (new != 0).then_some(new)\n-            } else {\n-                state_change = update < 0;\n-                (update != 0).then_some(-update)\n+    ($task:ident, $key:ident $input:tt, -$update:expr) => {\n+        match $update {\n+            update => {\n+                let mut state_change = false;\n+                $crate::backend::storage::update!($task, $key $input, |old: Option<_>| {\n+                    #[allow(unused_comparisons, reason = \"type of update might be unsigned, where update < 0 is always false\")]\n+                    if let Some(old) = old {\n+                        let new = old - update;\n+                        state_change = old <= 0 && new > 0 || old > 0 && new <= 0;\n+                        (new != 0).then_some(new)\n+                    } else {\n+                        state_change = update < 0;\n+                        (update != 0).then_some(-update)\n+                    }\n+                });\n+                state_change\n             }\n-        });\n-        state_change\n-    }};\n+        }\n+    };\n     ($task:ident, $key:ident $input:tt, $update:expr) => {\n         match $update {\n             update => {\n@@ -1091,22 +1094,26 @@ macro_rules! update_count {\n     };\n     ($task:ident, $key:ident, -$update:expr) => {\n         $crate::backend::storage::update_count!($task, $key {}, -$update)\n-    };    ($task:ident, $key:ident, $update:expr) => {\n+    };\n+    ($task:ident, $key:ident, $update:expr) => {\n         $crate::backend::storage::update_count!($task, $key {}, $update)\n     };\n }\n \n macro_rules! update_count_and_get {\n-    ($task:ident, $key:ident $input:tt, -$update:expr) => {{\n-        let update = $update;\n-        let mut new = 0;\n-        $crate::backend::storage::update!($task, $key $input, |old: Option<_>| {\n-            let old = old.unwrap_or(0);\n-            new = old - update;\n-            (new != 0).then_some(new)\n-        });\n-        new\n-    }};\n+    ($task:ident, $key:ident $input:tt, -$update:expr) => {\n+        match $update {\n+            update => {\n+                let mut new = 0;\n+                $crate::backend::storage::update!($task, $key $input, |old: Option<_>| {\n+                    let old = old.unwrap_or(0);\n+                    new = old - update;\n+                    (new != 0).then_some(new)\n+                });\n+                new\n+            }\n+        }\n+    };\n     ($task:ident, $key:ident $input:tt, $update:expr) => {\n         match $update {\n             update => {"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 33,
        "deletions": 26
    }
}