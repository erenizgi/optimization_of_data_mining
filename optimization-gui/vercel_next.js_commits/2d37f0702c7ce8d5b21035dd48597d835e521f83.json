{
    "author": "lukesandberg",
    "message": "[turbopack] Simplify up and dowcasts (#83456)\n\n## What \nCasting `ResolvedVc<Box<dyn Module>>` to `ResolvedVc<Box<dyn Module>>` is confusing, so we should reject it.\n\nDitto for no op `upcast`s.\n\nThis PR makes such calls illegal and eliminates them from the codebase.\n\n## How\n\nIntroduce a new trait `UpcastStrict` that is only implemented for types that extend or implement different traits.  This way we can say it is only valid to try to downcast if the target type is `UpcastStrict`.  \n\nThen modify the type constraints on our casting utilties to require `UpcastStrict` instead of `Upcast`\n\nIn the case of `Vc::upcast` i also introduced a `Vc::upcast_non_strict` to help with writing generic code or extension traits.\n\n## Why?\n\nI got very confused by some `try_downcast` calls that turned out to be no-ops.\n\nOf course this might make some type theorists unhappy, and I don't disagree.  Downcasting X->X is a legitimate operation.   The ideal solution here would be a linter rule, but there doesn't appear to be any way to implement that.",
    "sha": "2d37f0702c7ce8d5b21035dd48597d835e521f83",
    "files": [
        {
            "sha": "3daf5859fa70d45b68fd3bc1c7a68e5ee8c3ae28",
            "filename": "crates/napi/src/next_api/project.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2Fsrc%2Fnext_api%2Fproject.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -525,8 +525,7 @@ async fn benchmark_file_io(\n     directory: FileSystemPath,\n ) -> Result<Vc<Completion>> {\n     // try to get the real file path on disk so that we can use it with tokio\n-    let fs = Vc::try_resolve_downcast_type::<DiskFileSystem>(directory.fs())\n-        .await?\n+    let fs = ResolvedVc::try_downcast_type::<DiskFileSystem>(directory.fs)\n         .context(anyhow!(\n             \"expected node_root to be a DiskFileSystem, cannot benchmark\"\n         ))?"
        },
        {
            "sha": "234c409a796b18647d27b66238cf21da7b0e279f",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 21,
            "deletions": 24,
            "changes": 45,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -383,7 +383,7 @@ impl AppProject {\n                         )),\n                         module_styles_rule_condition(),\n                     ]),\n-                    ResolvedVc::upcast(self.css_client_reference_transition().to_resolved().await?),\n+                    self.css_client_reference_transition().to_resolved().await?,\n                 ),\n                 // Don't wrap in marker module but change context, this is used to determine\n                 // the list of CSS module classes.\n@@ -399,7 +399,7 @@ impl AppProject {\n                 // Mark as client reference all regular CSS imports\n                 TransitionRule::new(\n                     styles_rule_condition(),\n-                    ResolvedVc::upcast(self.css_client_reference_transition().to_resolved().await?),\n+                    self.css_client_reference_transition().to_resolved().await?,\n                 ),\n             ],\n             ..Default::default()\n@@ -413,7 +413,7 @@ impl AppProject {\n             self.get_rsc_transitions(\n                 self.ecmascript_client_reference_transition(),\n                 Vc::upcast(self.ssr_transition()),\n-                Vc::upcast(self.shared_transition()),\n+                self.shared_transition(),\n             ),\n             self.project().server_compile_time_info(),\n             self.rsc_module_options_context(),\n@@ -428,7 +428,7 @@ impl AppProject {\n             self.get_rsc_transitions(\n                 self.edge_ecmascript_client_reference_transition(),\n                 Vc::upcast(self.edge_ssr_transition()),\n-                Vc::upcast(self.edge_shared_transition()),\n+                self.edge_shared_transition(),\n             ),\n             self.project().edge_compile_time_info(),\n             self.edge_rsc_module_options_context(),\n@@ -467,7 +467,7 @@ impl AppProject {\n             ),\n             (\n                 rcstr!(\"next-shared\"),\n-                ResolvedVc::upcast(self.shared_transition().to_resolved().await?),\n+                self.shared_transition().to_resolved().await?,\n             ),\n             (\n                 rcstr!(\"next-server-utility\"),\n@@ -518,7 +518,7 @@ impl AppProject {\n             ),\n             (\n                 rcstr!(\"next-shared\"),\n-                ResolvedVc::upcast(self.edge_shared_transition().to_resolved().await?),\n+                self.edge_shared_transition().to_resolved().await?,\n             ),\n             (\n                 rcstr!(\"next-server-utility\"),\n@@ -640,7 +640,7 @@ impl AppProject {\n             ),\n             (\n                 rcstr!(\"next-shared\"),\n-                ResolvedVc::upcast(self.shared_transition().to_resolved().await?),\n+                self.shared_transition().to_resolved().await?,\n             ),\n         ]\n         .into_iter()\n@@ -712,7 +712,7 @@ impl AppProject {\n             ),\n             (\n                 rcstr!(\"next-shared\"),\n-                ResolvedVc::upcast(self.edge_shared_transition().to_resolved().await?),\n+                self.edge_shared_transition().to_resolved().await?,\n             ),\n         ]\n         .into_iter()\n@@ -877,8 +877,7 @@ impl AppProject {\n             // Implements layout segment optimization to compute a graph \"chain\" for each layout\n             // segment\n             async move {\n-                let rsc_entry_chunk_group =\n-                    ChunkGroupEntry::Entry(vec![ResolvedVc::upcast(rsc_entry)]);\n+                let rsc_entry_chunk_group = ChunkGroupEntry::Entry(vec![rsc_entry]);\n \n                 let mut graphs = vec![];\n                 let mut visited_modules = if has_layout_segments {\n@@ -1389,18 +1388,16 @@ impl AppEndpoint {\n                 polyfill_files: vec![polyfill_output_asset],\n                 ..Default::default()\n             };\n-            let build_manifest_output = ResolvedVc::upcast(\n-                build_manifest\n-                    .build_output(\n-                        node_root.join(&format!(\n-                            \"server/app{manifest_path_prefix}/build-manifest.json\",\n-                        ))?,\n-                        client_relative_path.clone(),\n-                    )\n-                    .await?\n-                    .to_resolved()\n-                    .await?,\n-            );\n+            let build_manifest_output = build_manifest\n+                .build_output(\n+                    node_root.join(&format!(\n+                        \"server/app{manifest_path_prefix}/build-manifest.json\",\n+                    ))?,\n+                    client_relative_path.clone(),\n+                )\n+                .await?\n+                .to_resolved()\n+                .await?;\n             server_assets.insert(build_manifest_output);\n         }\n \n@@ -1548,7 +1545,7 @@ impl AppEndpoint {\n                 if emit_manifests == EmitManifests::Full {\n                     let dynamic_import_entries = collect_next_dynamic_chunks(\n                         *module_graphs.full,\n-                        *ResolvedVc::upcast(client_chunking_context),\n+                        *client_chunking_context,\n                         next_dynamic_imports,\n                         NextDynamicChunkAvailability::ClientReferences(\n                             &*(client_references_chunks.await?),\n@@ -1663,7 +1660,7 @@ impl AppEndpoint {\n                     // create react-loadable-manifest for next/dynamic\n                     let dynamic_import_entries = collect_next_dynamic_chunks(\n                         *module_graphs.full,\n-                        *ResolvedVc::upcast(client_chunking_context),\n+                        *client_chunking_context,\n                         next_dynamic_imports,\n                         NextDynamicChunkAvailability::ClientReferences(\n                             &*(client_references_chunks.await?),"
        },
        {
            "sha": "03ccd5a3586efa10a57fc7c69510024cab297a7b",
            "filename": "crates/next-api/src/dynamic_imports.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -80,7 +80,7 @@ pub(crate) async fn collect_next_dynamic_chunks(\n             let async_chunk_group = async_loader.references().to_resolved().await?;\n \n             let module_id = dynamic_entry\n-                .chunk_item_id(Vc::upcast(chunking_context))\n+                .chunk_item_id(chunking_context)\n                 .to_resolved()\n                 .await?;\n "
        },
        {
            "sha": "2da605c805a98b3a7f7fc4cf6286e6662c1184b9",
            "filename": "crates/next-api/src/nft_json.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fnft_json.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fnft_json.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fnft_json.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -398,7 +398,7 @@ pub async fn all_assets_from_entries_filtered(\n                     .iter()\n                     .map(async |asset| {\n                         Ok((\n-                            ResolvedVc::upcast(*asset),\n+                            *asset,\n                             if emit_spans {\n                                 Some(asset.path().to_string().await?)\n                             } else {"
        },
        {
            "sha": "0ac5a509bf0b7e5c1ced101e05a0530fee7a8788",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 13,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -322,7 +322,7 @@ impl PagesProject {\n                 (\n                     rcstr!(\"next-dynamic-client\"),\n                     ResolvedVc::upcast(\n-                        NextDynamicTransition::new_client(Vc::upcast(self.client_transition()))\n+                        NextDynamicTransition::new_client(self.client_transition())\n                             .to_resolved()\n                             .await?,\n                     ),\n@@ -1073,7 +1073,7 @@ impl PageEndpoint {\n             {\n                 collect_next_dynamic_chunks(\n                     self.client_module_graph(),\n-                    Vc::upcast(project.client_chunking_context()),\n+                    project.client_chunking_context(),\n                     next_dynamic_imports,\n                     NextDynamicChunkAvailability::AvailabilityInfo(client_availability_info),\n                 )\n@@ -1084,7 +1084,7 @@ impl PageEndpoint {\n \n             let chunking_context: Vc<Box<dyn ChunkingContext>> = match runtime {\n                 NextRuntime::NodeJs => Vc::upcast(node_chunking_context),\n-                NextRuntime::Edge => Vc::upcast(edge_chunking_context),\n+                NextRuntime::Edge => edge_chunking_context,\n             };\n \n             let mut current_chunks = OutputAssets::empty();\n@@ -1342,16 +1342,14 @@ impl PageEndpoint {\n             ..Default::default()\n         };\n         let manifest_path_prefix = get_asset_prefix_from_pathname(&self.pathname);\n-        Ok(Vc::upcast(\n-            build_manifest\n-                .build_output(\n-                    node_root.join(&format!(\n-                        \"server/pages{manifest_path_prefix}/build-manifest.json\",\n-                    ))?,\n-                    client_relative_path,\n-                )\n-                .await?,\n-        ))\n+        build_manifest\n+            .build_output(\n+                node_root.join(&format!(\n+                    \"server/pages{manifest_path_prefix}/build-manifest.json\",\n+                ))?,\n+                client_relative_path,\n+            )\n+            .await\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "87a433ae13e170a657ac9fbf911b120fb7ff5e2d",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -1380,7 +1380,7 @@ impl Project {\n \n         let middleware = self.find_middleware();\n         let FindContextFileResult::Found(fs_path, _) = &*middleware.await? else {\n-            return Ok(Vc::upcast(edge_module_context));\n+            return Ok(edge_module_context);\n         };\n         let source = Vc::upcast(FileSource::new(fs_path.clone()));\n "
        },
        {
            "sha": "d177dc7c667b1cd9a044a7806bdd1e9640bda6e7",
            "filename": "crates/next-api/src/server_actions.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fserver_actions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-api%2Fsrc%2Fserver_actions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fserver_actions.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -77,7 +77,7 @@ pub(crate) async fn create_server_actions_manifest(\n         .to_resolved()\n         .await?;\n \n-    let chunk_item = loader.as_chunk_item(module_graph, Vc::upcast(chunking_context));\n+    let chunk_item = loader.as_chunk_item(module_graph, chunking_context);\n     let manifest = build_manifest(\n         node_root,\n         page_name,\n@@ -275,14 +275,13 @@ pub fn parse_server_actions(\n /// If found, we return the mapping of every action's hashed id to the name of\n /// the exported action function. If not, we return a None.\n #[turbo_tasks::function]\n-async fn parse_actions(module: Vc<Box<dyn Module>>) -> Result<Vc<OptionActionMap>> {\n-    let Some(ecmascript_asset) =\n-        Vc::try_resolve_sidecast::<Box<dyn EcmascriptParsable>>(module).await?\n+async fn parse_actions(module: ResolvedVc<Box<dyn Module>>) -> Result<Vc<OptionActionMap>> {\n+    let Some(ecmascript_asset) = ResolvedVc::try_sidecast::<Box<dyn EcmascriptParsable>>(module)\n     else {\n         return Ok(Vc::cell(None));\n     };\n \n-    if let Some(module) = Vc::try_resolve_downcast_type::<EcmascriptModulePartAsset>(module).await?\n+    if let Some(module) = ResolvedVc::try_downcast_type::<EcmascriptModulePartAsset>(module)\n         && matches!(\n             module.await?.part,\n             ModulePart::Evaluation | ModulePart::Facade"
        },
        {
            "sha": "d6b5ec3c23831845fb85f4bb259c1c8c865ffa41",
            "filename": "crates/next-core/src/app_page_loader_tree.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fapp_page_loader_tree.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fapp_page_loader_tree.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fapp_page_loader_tree.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -4,7 +4,7 @@ use std::{\n };\n \n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexMap, ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{ModuleAssetContext, transition::Transition};\n@@ -219,10 +219,10 @@ impl AppPageLoaderTreeBuilder {\n \n         let identifier = magic_identifier::mangle(&format!(\"{name} #{i}\"));\n         let inner_module_id = format!(\"METADATA_{i}\");\n-        let helper_import: RcStr = \"import { fillMetadataSegment } from \\\n-                                    'next/dist/lib/metadata/get-metadata-route' with { \\\n-                                    'turbopack-transition': 'next-server-utility' }\"\n-            .into();\n+        let helper_import = rcstr!(\n+            \"import { fillMetadataSegment } from 'next/dist/lib/metadata/get-metadata-route' with \\\n+             { 'turbopack-transition': 'next-server-utility' }\"\n+        );\n \n         if !self.base.imports.contains(&helper_import) {\n             self.base.imports.push(helper_import);\n@@ -231,11 +231,11 @@ impl AppPageLoaderTreeBuilder {\n         self.base\n             .imports\n             .push(format!(\"import {identifier} from \\\"{inner_module_id}\\\";\").into());\n-        let module = Vc::upcast(StructuredImageModuleType::create_module(\n+        let module = StructuredImageModuleType::create_module(\n             Vc::upcast(FileSource::new(path.clone())),\n             BlurPlaceholderMode::None,\n             *self.base.module_asset_context,\n-        ));\n+        );\n         let module = self.base.process_module(module).to_resolved().await?;\n         self.base\n             .inner_assets"
        },
        {
            "sha": "9945013ee57aeb02dfec0b8650ef6198d295995c",
            "filename": "crates/next-core/src/emit.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Femit.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Femit.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Femit.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -159,7 +159,7 @@ pub async fn all_assets_from_entries(entries: Vc<OutputAssets>) -> Result<Vc<Out\n                     .iter()\n                     .map(async |asset| {\n                         Ok((\n-                            ResolvedVc::upcast(*asset),\n+                            *asset,\n                             if emit_spans {\n                                 Some(asset.path().to_string().await?)\n                             } else {"
        },
        {
            "sha": "1db81a811a911baac535acf2759553b4b9295b7a",
            "filename": "crates/next-core/src/hmr_entry.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -158,7 +158,7 @@ struct HmrEntryChunkItem {\n impl ChunkItem for HmrEntryChunkItem {\n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        Vc::upcast(*self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "cf0de7746e95f2f9760fed0d0ec71b00c6e88f31",
            "filename": "crates/next-core/src/next_app/app_page_entry.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -166,7 +166,7 @@ async fn wrap_edge_page(\n \n     let wrapped = asset_context\n         .process(\n-            Vc::upcast(source),\n+            source,\n             ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();"
        },
        {
            "sha": "b8e6aeec242dea4842f1ff738202da631467d72a",
            "filename": "crates/next-core/src/next_app/app_route_entry.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_route_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_route_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_route_entry.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -102,7 +102,7 @@ pub async fn get_app_route_entry(\n \n     let mut rsc_entry = module_asset_context\n         .process(\n-            Vc::upcast(virtual_source),\n+            virtual_source,\n             ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();\n@@ -153,7 +153,7 @@ async fn wrap_edge_route(\n \n     let wrapped = asset_context\n         .process(\n-            Vc::upcast(source),\n+            source,\n             ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();"
        },
        {
            "sha": "93a0290afe05be1cfa7d0059458c0579a2ea386a",
            "filename": "crates/next-core/src/next_client_reference/ecmascript_client_reference/ecmascript_client_reference_module.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -300,7 +300,7 @@ impl ChunkItem for EcmascriptClientReferenceProxyChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        Vc::upcast(*self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "1727d1f50f0890079cc331651a4c7cef90fccbd0",
            "filename": "crates/next-core/src/next_dynamic/dynamic_module.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_module.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -137,10 +137,7 @@ impl EcmascriptChunkItem for NextDynamicEntryChunkItem {\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let inner = self.inner.await?;\n \n-        let module_id = inner\n-            .module\n-            .chunk_item_id(Vc::upcast(*self.chunking_context))\n-            .await?;\n+        let module_id = inner.module.chunk_item_id(*self.chunking_context).await?;\n         Ok(EcmascriptChunkItemContent {\n             inner_code: formatdoc!(\n                 r#\""
        },
        {
            "sha": "8b5d992aeb2a1dfa820094c501d301b93a13ccaa",
            "filename": "crates/next-core/src/next_manifests/client_reference_manifest.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fclient_reference_manifest.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fclient_reference_manifest.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_manifests%2Fclient_reference_manifest.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -169,7 +169,7 @@ impl ClientReferenceManifest {\n                 let server_path = client_reference_module_ref.server_ident.to_string().await?;\n                 let client_module = client_reference_module_ref.client_module;\n                 let client_chunk_item_id = client_module\n-                    .chunk_item_id(*ResolvedVc::upcast(client_chunking_context))\n+                    .chunk_item_id(*client_chunking_context)\n                     .await?;\n \n                 let (client_chunks_paths, client_is_async) =\n@@ -213,12 +213,10 @@ impl ClientReferenceManifest {\n \n                 if let Some(ssr_chunking_context) = ssr_chunking_context {\n                     let ssr_module = client_reference_module_ref.ssr_module;\n-                    let ssr_chunk_item_id = ssr_module\n-                        .chunk_item_id(*ResolvedVc::upcast(ssr_chunking_context))\n-                        .await?;\n+                    let ssr_chunk_item_id = ssr_module.chunk_item_id(*ssr_chunking_context).await?;\n \n                     let rsc_chunk_item_id = client_reference_module\n-                        .chunk_item_id(*ResolvedVc::upcast(ssr_chunking_context))\n+                        .chunk_item_id(*ssr_chunking_context)\n                         .await?;\n \n                     let (ssr_chunks_paths, ssr_is_async) = if runtime == NextRuntime::Edge {"
        },
        {
            "sha": "c8e4bdd1a24a2966b22c96f0069feba442e2c031",
            "filename": "crates/next-core/src/next_pages/page_entry.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_pages%2Fpage_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_pages%2Fpage_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_pages%2Fpage_entry.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -279,7 +279,7 @@ async fn wrap_edge_page(\n \n     let wrapped = asset_context\n         .process(\n-            Vc::upcast(source),\n+            source,\n             ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();"
        },
        {
            "sha": "e4b1217ab303988d87d8244bc99c35d0c1910d09",
            "filename": "crates/next-core/src/next_server_component/server_component_module.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_module.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -130,10 +130,7 @@ impl EcmascriptChunkItem for NextServerComponentChunkItem {\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let inner = self.inner.await?;\n \n-        let module_id = inner\n-            .module\n-            .chunk_item_id(Vc::upcast(*self.chunking_context))\n-            .await?;\n+        let module_id = inner.module.chunk_item_id(*self.chunking_context).await?;\n         Ok(EcmascriptChunkItemContent {\n             inner_code: formatdoc!(\n                 r#\""
        },
        {
            "sha": "efd94bab925546969b3383954e5bc9f955535202",
            "filename": "crates/next-core/src/next_server_utility/server_utility_module.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_module.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -130,10 +130,7 @@ impl EcmascriptChunkItem for NextServerComponentChunkItem {\n     async fn content(&self) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let inner = self.inner.await?;\n \n-        let module_id = inner\n-            .module\n-            .chunk_item_id(Vc::upcast(*self.chunking_context))\n-            .await?;\n+        let module_id = inner.module.chunk_item_id(*self.chunking_context).await?;\n         Ok(EcmascriptChunkItemContent {\n             inner_code: formatdoc!(\n                 \"{TURBOPACK_EXPORT_NAMESPACE}({TURBOPACK_IMPORT}({}));\","
        },
        {
            "sha": "6300c2aee31f24d5f57dddd9da90d2f7afdf6abe",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/all_in_one.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fall_in_one.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fall_in_one.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Fall_in_one.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -182,8 +182,8 @@ struct Number(u32);\n #[turbo_tasks::value_impl]\n impl Add for Number {\n     #[turbo_tasks::function]\n-    async fn add(self: Vc<Self>, other: Vc<Box<dyn Add>>) -> Result<Vc<Self>> {\n-        let Some(other) = Vc::try_resolve_downcast_type::<Number>(other).await? else {\n+    async fn add(self: Vc<Self>, other: ResolvedVc<Box<dyn Add>>) -> Result<Vc<Self>> {\n+        let Some(other) = ResolvedVc::try_downcast_type::<Number>(other) else {\n             bail!(\"Expected Number\");\n         };\n         Ok(Vc::cell(*self.await? + *other.await?))\n@@ -196,8 +196,8 @@ struct NumberB(u32);\n #[turbo_tasks::value_impl]\n impl Add for NumberB {\n     #[turbo_tasks::function]\n-    async fn add(self: Vc<Self>, other: Vc<Box<dyn Add>>) -> Result<Vc<Self>> {\n-        let Some(other) = Vc::try_resolve_downcast_type::<NumberB>(other).await? else {\n+    async fn add(self: Vc<Self>, other: ResolvedVc<Box<dyn Add>>) -> Result<Vc<Self>> {\n+        let Some(other) = ResolvedVc::try_downcast_type::<NumberB>(other) else {\n             bail!(\"Expected NumberB\");\n         };\n         Ok(Vc::cell(*self.await? + *other.await?))"
        },
        {
            "sha": "9cadeafe53d9ed298b83454f0e81b5460a97288d",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/trait_ref_cell_mode.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrait_ref_cell_mode.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrait_ref_cell_mode.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftrait_ref_cell_mode.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -125,7 +125,7 @@ where\n     // contain the same value\n     let mut upcast_vcs = Vec::new();\n     for _idx in 0..2 {\n-        upcast_vcs.push(Vc::upcast((cell_fn)(input.value)));\n+        upcast_vcs.push(Vc::upcast_non_strict((cell_fn)(input.value)));\n     }\n \n     // pick a different cell idx upon each invalidation/execution"
        },
        {
            "sha": "3902aa1d43ac48d10852f823416572ba76962610",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -2298,12 +2298,12 @@ impl ValueToString for NullFileSystem {\n \n pub async fn to_sys_path(mut path: FileSystemPath) -> Result<Option<PathBuf>> {\n     loop {\n-        if let Some(fs) = Vc::try_resolve_downcast_type::<AttachedFileSystem>(path.fs()).await? {\n+        if let Some(fs) = ResolvedVc::try_downcast_type::<AttachedFileSystem>(path.fs) {\n             path = fs.get_inner_fs_path(path).owned().await?;\n             continue;\n         }\n \n-        if let Some(fs) = Vc::try_resolve_downcast_type::<DiskFileSystem>(path.fs()).await? {\n+        if let Some(fs) = ResolvedVc::try_downcast_type::<DiskFileSystem>(path.fs) {\n             let sys_path = fs.await?.to_sys_path(path)?;\n             return Ok(Some(sys_path));\n         }"
        },
        {
            "sha": "2fc342cb54b2c027341366efaedd30654fe00aa9",
            "filename": "turbopack/crates/turbo-tasks-fs/src/util.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Futil.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -4,7 +4,7 @@ use std::{\n };\n \n use anyhow::{Context, Result, anyhow};\n-use turbo_tasks::Vc;\n+use turbo_tasks::ResolvedVc;\n \n use crate::{DiskFileSystem, FileSystemPath};\n \n@@ -23,9 +23,8 @@ pub fn extract_disk_access<T>(value: io::Result<T>, path: &Path) -> Result<Optio\n pub async fn uri_from_file(root: FileSystemPath, path: Option<&str>) -> Result<String> {\n     use turbo_unix_path::sys_to_unix;\n \n-    let root_fs = root.fs();\n-    let root_fs = &*Vc::try_resolve_downcast_type::<DiskFileSystem>(root_fs)\n-        .await?\n+    let root_fs = root.fs;\n+    let root_fs = &*ResolvedVc::try_downcast_type::<DiskFileSystem>(root_fs)\n         .context(\"Expected root to have a DiskFileSystem\")?\n         .await?;\n \n@@ -48,9 +47,8 @@ pub async fn uri_from_file(root: FileSystemPath, path: Option<&str>) -> Result<S\n \n #[cfg(target_os = \"windows\")]\n pub async fn uri_from_file(root: FileSystemPath, path: Option<&str>) -> Result<String> {\n-    let root_fs = root.fs();\n-    let root_fs = &*Vc::try_resolve_downcast_type::<DiskFileSystem>(root_fs)\n-        .await?\n+    let root_fs = root.fs;\n+    let root_fs = &*ResolvedVc::try_downcast_type::<DiskFileSystem>(root_fs)\n         .context(\"Expected root to have a DiskFileSystem\")?\n         .await?;\n "
        },
        {
            "sha": "59ad70230aeddacf4969679cd1a6785c6df30975",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_impl_macro.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -329,6 +329,7 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n             // rustc complains: error[E0210]: type parameter `T` must be covered by another type when it appears before\n             // the first local type (`dyn Trait`).\n             unsafe impl #impl_generics turbo_tasks::Upcast<::std::boxed::Box<dyn #trait_path>> for #ty #where_clause {}\n+            unsafe impl #impl_generics turbo_tasks::UpcastStrict<::std::boxed::Box<dyn #trait_path>> for #ty #where_clause {}\n \n             impl #impl_generics #trait_path for #ty #where_clause {\n                 #(#trait_items)*"
        },
        {
            "sha": "78a870cceb934c4fb75da7558eafdd7d0ade61eb",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_trait_macro.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -250,6 +250,7 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n         quote! {\n             unsafe impl turbo_tasks::Dynamic<Box<dyn turbo_tasks::debug::ValueDebug>> for Box<dyn #trait_ident> {}\n             unsafe impl turbo_tasks::Upcast<Box<dyn turbo_tasks::debug::ValueDebug>> for Box<dyn #trait_ident> {}\n+            unsafe impl turbo_tasks::UpcastStrict<Box<dyn turbo_tasks::debug::ValueDebug>> for Box<dyn #trait_ident> {}\n         }\n     } else {\n         quote! {}\n@@ -314,8 +315,6 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n         }\n \n         unsafe impl turbo_tasks::Dynamic<Box<dyn #trait_ident>> for Box<dyn #trait_ident> {}\n-        // TODO(alexkirsz) It would be great to have the following identity. However, I run into an ICE when I attempt this,\n-        // so tabling it for now.\n         unsafe impl turbo_tasks::Upcast<Box<dyn #trait_ident>> for Box<dyn #trait_ident> {}\n \n         impl<T> #trait_ident for T\n@@ -328,6 +327,8 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n         #(\n             unsafe impl turbo_tasks::Dynamic<Box<dyn #supertraits>> for Box<dyn #trait_ident> {}\n             unsafe impl turbo_tasks::Upcast<Box<dyn #supertraits>> for Box<dyn #trait_ident> {}\n+            unsafe impl turbo_tasks::UpcastStrict<Box<dyn #supertraits>> for Box<dyn #trait_ident> {\n+            }\n         )*\n \n         #value_debug_impl"
        },
        {
            "sha": "ff121c46ee56a9965154bc29dd671f109f195aab",
            "filename": "turbopack/crates/turbo-tasks/src/lib.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -132,8 +132,8 @@ pub use value::{TransientInstance, TransientValue};\n pub use value_type::{TraitMethod, TraitType, ValueType};\n pub use vc::{\n     Dynamic, NonLocalValue, OperationValue, OperationVc, OptionVcExt, ReadVcFuture, ResolvedVc,\n-    Upcast, ValueDefault, Vc, VcCast, VcCellNewMode, VcCellSharedMode, VcDefaultRead, VcRead,\n-    VcTransparentRead, VcValueTrait, VcValueTraitCast, VcValueType, VcValueTypeCast,\n+    Upcast, UpcastStrict, ValueDefault, Vc, VcCast, VcCellNewMode, VcCellSharedMode, VcDefaultRead,\n+    VcRead, VcTransparentRead, VcValueTrait, VcValueTraitCast, VcValueType, VcValueTypeCast,\n };\n \n pub type SliceMap<K, V> = Box<[(K, V)]>;"
        },
        {
            "sha": "74f6eb743e64e3be393a192ab82778203891d1fa",
            "filename": "turbopack/crates/turbo-tasks/src/vc/mod.rs",
            "status": "modified",
            "additions": 38,
            "deletions": 13,
            "changes": 51,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -28,7 +28,7 @@ pub use self::{\n     operation::{OperationValue, OperationVc},\n     read::{ReadOwnedVcFuture, ReadVcFuture, VcDefaultRead, VcRead, VcTransparentRead},\n     resolved::ResolvedVc,\n-    traits::{Dynamic, Upcast, VcValueTrait, VcValueType},\n+    traits::{Dynamic, Upcast, UpcastStrict, VcValueTrait, VcValueType},\n };\n use crate::{\n     CellId, RawVc, ResolveTypeError,\n@@ -411,6 +411,33 @@ where\n     /// This is also available as an `Into`/`From` conversion.\n     #[inline(always)]\n     pub fn upcast<K>(vc: Self) -> Vc<K>\n+    where\n+        T: UpcastStrict<K>,\n+        K: VcValueTrait + ?Sized,\n+    {\n+        Self::upcast_non_strict(vc)\n+    }\n+\n+    /// Upcasts the given `Vc<T>` to a `Vc<Box<dyn K>>`\n+    ///\n+    /// This has a loose type constraint which would allow upcasting to the same type, prefer using\n+    /// [`Vc::upcast`] when possible.  This is useful for extension traits and other more generic\n+    /// usecases.\n+    ///\n+    /// # Example\n+    /// ```rust\n+    /// // In generic code where T might be the same as K\n+    /// fn process_foo(vc: ResolvedVc<impl Upcast<Box<dyn MyTrait>>>) -> Vc<Foo> {\n+    ///    let my_trait: ResolvedVc<Box<dyn MyTrait>> = Vc::upcast_non_strict(vc);\n+    ///    my_trait.do_something()\n+    /// }\n+    /// ```\n+    /// Using generics you could allow users to pass any compatible type, but if you specified\n+    /// `UpcastStrict<...>` instead of `Upcast<...>` you would disallow calling this function if you\n+    /// already had a `ResolvedVc<Box<dyn MyTrait>>.  So this function has a looser type constraint\n+    /// to make these functions easier to write and use.\n+    #[inline(always)]\n+    pub fn upcast_non_strict<K>(vc: Self) -> Vc<K>\n     where\n         T: Upcast<K>,\n         K: VcValueTrait + ?Sized,\n@@ -420,7 +447,6 @@ where\n             _t: PhantomData,\n         }\n     }\n-\n     /// Runs the operation, but ignores the returned Vc. Use that when only interested in running\n     /// the task for side effects.\n     pub async fn as_side_effect(self) -> Result<()> {\n@@ -493,6 +519,12 @@ where\n     where\n         K: VcValueTrait + ?Sized,\n     {\n+        debug_assert!(\n+            <K as VcValueTrait>::get_trait_type_id() != <T as VcValueTrait>::get_trait_type_id(),\n+            \"Attempted to cast a type {} to itself, which is pointless. Use the value directly \\\n+             instead.\",\n+            crate::registry::get_trait(<T as VcValueTrait>::get_trait_type_id()).global_name\n+        );\n         let raw_vc: RawVc = vc.node;\n         let raw_vc = raw_vc\n             .resolve_trait(<K as VcValueTrait>::get_trait_type_id())\n@@ -510,16 +542,9 @@ where\n     /// Returns `None` if the underlying value type is not a `K`.\n     pub async fn try_resolve_downcast<K>(vc: Self) -> Result<Option<Vc<K>>, ResolveTypeError>\n     where\n-        K: Upcast<T> + VcValueTrait + ?Sized,\n+        K: UpcastStrict<T> + VcValueTrait + ?Sized,\n     {\n-        let raw_vc: RawVc = vc.node;\n-        let raw_vc = raw_vc\n-            .resolve_trait(<K as VcValueTrait>::get_trait_type_id())\n-            .await?;\n-        Ok(raw_vc.map(|raw_vc| Vc {\n-            node: raw_vc,\n-            _t: PhantomData,\n-        }))\n+        Self::try_resolve_sidecast(vc).await\n     }\n \n     /// Attempts to downcast the given `Vc<Box<dyn T>>` to a `Vc<K>`, where `K`\n@@ -529,7 +554,7 @@ where\n     /// Returns `None` if the underlying value type is not a `K`.\n     pub async fn try_resolve_downcast_type<K>(vc: Self) -> Result<Option<Vc<K>>, ResolveTypeError>\n     where\n-        K: Upcast<T> + VcValueType,\n+        K: UpcastStrict<T> + VcValueType,\n     {\n         let raw_vc: RawVc = vc.node;\n         let raw_vc = raw_vc\n@@ -565,7 +590,7 @@ where\n \n impl<T> ValueDebugFormat for Vc<T>\n where\n-    T: Upcast<Box<dyn ValueDebug>> + Send + Sync + ?Sized,\n+    T: UpcastStrict<Box<dyn ValueDebug>> + Send + Sync + ?Sized,\n {\n     fn value_debug_format(&self, depth: usize) -> ValueDebugFormatString<'_> {\n         ValueDebugFormatString::Async(Box::pin(async move {"
        },
        {
            "sha": "0fe4a66cad5abaac0532f0ea73da7516fc30bf79",
            "filename": "turbopack/crates/turbo-tasks/src/vc/operation.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Foperation.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Foperation.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Foperation.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -6,7 +6,7 @@ use serde::{Deserialize, Serialize};\n pub use turbo_tasks_macros::OperationValue;\n \n use crate::{\n-    CollectiblesSource, RawVc, ReadVcFuture, ResolvedVc, TaskInput, Upcast, Vc, VcValueTrait,\n+    CollectiblesSource, RawVc, ReadVcFuture, ResolvedVc, TaskInput, UpcastStrict, Vc, VcValueTrait,\n     VcValueType, marker_trait::impl_auto_marker_trait, trace::TraceRawVcs,\n };\n \n@@ -94,7 +94,7 @@ impl<T: ?Sized> OperationVc<T> {\n     #[inline(always)]\n     pub fn upcast<K>(vc: Self) -> OperationVc<K>\n     where\n-        T: Upcast<K>,\n+        T: UpcastStrict<K>,\n         K: VcValueTrait + ?Sized,\n     {\n         OperationVc {"
        },
        {
            "sha": "01c6ce1abd8bc3408dd3b0aea7333a6fa25be246",
            "filename": "turbopack/crates/turbo-tasks/src/vc/resolved.rs",
            "status": "modified",
            "additions": 28,
            "deletions": 5,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fresolved.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fresolved.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Fresolved.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -12,7 +12,7 @@ use anyhow::Result;\n use serde::{Deserialize, Serialize};\n \n use crate::{\n-    RawVc, Upcast, VcRead, VcTransparentRead, VcValueTrait, VcValueType,\n+    RawVc, Upcast, UpcastStrict, VcRead, VcTransparentRead, VcValueTrait, VcValueType,\n     debug::{ValueDebug, ValueDebugFormat, ValueDebugFormatString},\n     trace::{TraceRawVcs, TraceRawVcsContext},\n     vc::Vc,\n@@ -198,12 +198,26 @@ where\n     /// See also: [`Vc::upcast`].\n     #[inline(always)]\n     pub fn upcast<K>(this: Self) -> ResolvedVc<K>\n+    where\n+        T: UpcastStrict<K>,\n+        K: VcValueTrait + ?Sized,\n+    {\n+        Self::upcast_non_strict(this)\n+    }\n+\n+    /// Upcasts the given `ResolvedVc<T>` to a `ResolvedVc<Box<dyn K>>`.\n+    ///\n+    /// This has a loose type constraint which would allow upcasting to the same type, prefer using\n+    /// [`ResolvedVc::upcast`] when possible. See also: [`Vc::upcast_non_strict`].  This is\n+    /// useful for extension traits and other more generic usecases.\n+    #[inline(always)]\n+    pub fn upcast_non_strict<K>(this: Self) -> ResolvedVc<K>\n     where\n         T: Upcast<K>,\n         K: VcValueTrait + ?Sized,\n     {\n         ResolvedVc {\n-            node: Vc::upcast(this.node),\n+            node: Vc::upcast_non_strict(this.node),\n         }\n     }\n \n@@ -236,6 +250,15 @@ where\n     where\n         K: VcValueTrait + ?Sized,\n     {\n+        // Runtime assertion to catch K == T cases with a clear error message\n+        // This will be optimized away in release builds but helps during development\n+        // We use trait type IDs since T and K might be trait objects (?Sized)\n+        debug_assert!(\n+            <K as VcValueTrait>::get_trait_type_id() != <T as VcValueTrait>::get_trait_type_id(),\n+            \"Attempted to cast a type {} to itself, which is pointless. Use the value directly \\\n+             instead.\",\n+            crate::registry::get_trait(<T as VcValueTrait>::get_trait_type_id()).global_name\n+        );\n         // `RawVc::TaskCell` already contains all the type information needed to check this\n         // sidecast, so we don't need to read the underlying cell!\n         let raw_vc = this.node.node;\n@@ -257,7 +280,7 @@ where\n     /// See also: [`Vc::try_resolve_downcast`].\n     pub fn try_downcast<K>(this: Self) -> Option<ResolvedVc<K>>\n     where\n-        K: Upcast<T> + VcValueTrait + ?Sized,\n+        K: UpcastStrict<T> + VcValueTrait + ?Sized,\n     {\n         // this is just a more type-safe version of a sidecast\n         Self::try_sidecast(this)\n@@ -270,7 +293,7 @@ where\n     /// See also: [`Vc::try_resolve_downcast_type`].\n     pub fn try_downcast_type<K>(this: Self) -> Option<ResolvedVc<K>>\n     where\n-        K: Upcast<T> + VcValueType,\n+        K: UpcastStrict<T> + VcValueType,\n     {\n         let raw_vc = this.node.node;\n         raw_vc\n@@ -310,7 +333,7 @@ where\n \n impl<T> ValueDebugFormat for ResolvedVc<T>\n where\n-    T: Upcast<Box<dyn ValueDebug>> + Send + Sync + ?Sized,\n+    T: UpcastStrict<Box<dyn ValueDebug>> + Send + Sync + ?Sized,\n {\n     fn value_debug_format(&self, depth: usize) -> ValueDebugFormatString<'_> {\n         self.node.value_debug_format(depth)"
        },
        {
            "sha": "247336a12f2c386c64fab4fdde5993bb4100e7d1",
            "filename": "turbopack/crates/turbo-tasks/src/vc/traits.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Ftraits.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Ftraits.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvc%2Ftraits.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -51,6 +51,18 @@ where\n {\n }\n \n+/// A speialization of [`Upcast`] that ensures that the upcast is strict meaning that T !== Self\n+///\n+/// # Safety\n+///\n+/// The implementor of this trait must ensure that `Self` implements the\n+/// trait `T` and that `Self` is not equal to `T`.\n+pub unsafe trait UpcastStrict<T>: Upcast<T>\n+where\n+    T: VcValueTrait + ?Sized,\n+{\n+}\n+\n /// Marker trait that indicates that a [`Vc<Self>`][crate::Vc] can accept all\n /// methods declared on a [`Vc<T>`][crate::Vc].\n ///"
        },
        {
            "sha": "514477f4c84a3471a5c1e1f933e83f32fdc99793",
            "filename": "turbopack/crates/turbopack-browser/src/chunking_context.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -174,7 +174,7 @@ impl BrowserChunkingContextBuilder {\n     {\n         self.chunking_context\n             .chunking_configs\n-            .push((ResolvedVc::upcast(ty), chunking_config));\n+            .push((ResolvedVc::upcast_non_strict(ty), chunking_config));\n         self\n     }\n \n@@ -334,17 +334,16 @@ impl BrowserChunkingContext {\n     #[turbo_tasks::function]\n     async fn generate_chunk(\n         self: Vc<Self>,\n-        chunk: Vc<Box<dyn Chunk>>,\n+        chunk: ResolvedVc<Box<dyn Chunk>>,\n     ) -> Result<Vc<Box<dyn OutputAsset>>> {\n         Ok(\n-            if let Some(ecmascript_chunk) =\n-                Vc::try_resolve_downcast_type::<EcmascriptChunk>(chunk).await?\n+            if let Some(ecmascript_chunk) = ResolvedVc::try_downcast_type::<EcmascriptChunk>(chunk)\n             {\n-                Vc::upcast(EcmascriptBrowserChunk::new(self, ecmascript_chunk))\n+                Vc::upcast(EcmascriptBrowserChunk::new(self, *ecmascript_chunk))\n             } else if let Some(output_asset) =\n-                Vc::try_resolve_sidecast::<Box<dyn OutputAsset>>(chunk).await?\n+                ResolvedVc::try_sidecast::<Box<dyn OutputAsset>>(chunk)\n             {\n-                output_asset\n+                *output_asset\n             } else {\n                 bail!(\"Unable to generate output asset for chunk\");\n             },\n@@ -736,7 +735,7 @@ impl ChunkingContext for BrowserChunkingContext {\n             ))\n         } else {\n             let module = AsyncLoaderModule::new(module, Vc::upcast(self), availability_info);\n-            Vc::upcast(module.as_chunk_item(module_graph, Vc::upcast(self)))\n+            module.as_chunk_item(module_graph, Vc::upcast(self))\n         })\n     }\n "
        },
        {
            "sha": "26d617c4175fa27a38ceebd1339e10dd33dc2f19",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/list/update.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fupdate.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fupdate.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fupdate.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -50,11 +50,11 @@ impl ChunkListUpdate<'_> {\n #[turbo_tasks::function]\n pub(super) async fn update_chunk_list(\n     content: Vc<EcmascriptDevChunkListContent>,\n-    from_version: Vc<Box<dyn Version>>,\n+    from_version: ResolvedVc<Box<dyn Version>>,\n ) -> Result<Vc<Update>> {\n     let to_version = content.version();\n     let from_version = if let Some(from) =\n-        Vc::try_resolve_downcast_type::<EcmascriptDevChunkListVersion>(from_version).await?\n+        ResolvedVc::try_downcast_type::<EcmascriptDevChunkListVersion>(from_version)\n     {\n         from\n     } else {"
        },
        {
            "sha": "13e51f3fdfcfc8c5729ed70b2b22c497b7439e0f",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/merged/content.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fmerged%2Fcontent.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fmerged%2Fcontent.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fmerged%2Fcontent.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -49,7 +49,10 @@ impl VersionedContent for EcmascriptBrowserMergedChunkContent {\n     }\n \n     #[turbo_tasks::function]\n-    async fn update(self: Vc<Self>, from_version: Vc<Box<dyn Version>>) -> Result<Vc<Update>> {\n+    async fn update(\n+        self: Vc<Self>,\n+        from_version: ResolvedVc<Box<dyn Version>>,\n+    ) -> Result<Vc<Update>> {\n         Ok(update_ecmascript_merged_chunk(self, from_version)\n             .await?\n             .cell())"
        },
        {
            "sha": "4d1b1ee880e560b7b85a0072e06b66c4b928d1ed",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/merged/update.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fmerged%2Fupdate.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fmerged%2Fupdate.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fmerged%2Fupdate.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -2,7 +2,7 @@ use std::sync::Arc;\n \n use anyhow::Result;\n use serde::Serialize;\n-use turbo_tasks::{FxIndexMap, FxIndexSet, IntoTraitRef, ReadRef, TryJoinIterExt, Vc};\n+use turbo_tasks::{FxIndexMap, FxIndexSet, IntoTraitRef, ReadRef, ResolvedVc, TryJoinIterExt, Vc};\n use turbo_tasks_fs::rope::Rope;\n use turbopack_core::{\n     chunk::{ChunkingContext, ModuleId},\n@@ -131,11 +131,11 @@ impl MergedModuleMap {\n \n pub(super) async fn update_ecmascript_merged_chunk(\n     content: Vc<EcmascriptBrowserMergedChunkContent>,\n-    from_version: Vc<Box<dyn Version>>,\n+    from_version: ResolvedVc<Box<dyn Version>>,\n ) -> Result<Update> {\n     let to_merged_version = content.version();\n     let from_merged_version = if let Some(from) =\n-        Vc::try_resolve_downcast_type::<EcmascriptBrowserMergedChunkVersion>(from_version).await?\n+        ResolvedVc::try_downcast_type::<EcmascriptBrowserMergedChunkVersion>(from_version)\n     {\n         from\n     } else {"
        },
        {
            "sha": "a2462b8bc5761391ff8f4da5b01c5cf6202746c1",
            "filename": "turbopack/crates/turbopack-cli/src/build/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -479,7 +479,7 @@ async fn build_internal(\n                                                     .unwrap(),\n                                             )?\n                                             .with_extension(\"entry.js\"),\n-                                        EvaluatableAssets::one(*ResolvedVc::upcast(ecmascript)),\n+                                        EvaluatableAssets::one(*ecmascript),\n                                         module_graph,\n                                         OutputAssets::empty(),\n                                         AvailabilityInfo::Root,"
        },
        {
            "sha": "450f4d50483654db424e93e1721c96b5badf41e5",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking_context.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 5,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -385,7 +385,12 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n     ) -> Vc<OutputAssets> {\n-        root_chunk_group_assets(Vc::upcast(self), ident, chunk_group, module_graph)\n+        root_chunk_group_assets(\n+            Vc::upcast_non_strict(self),\n+            ident,\n+            chunk_group,\n+            module_graph,\n+        )\n     }\n \n     fn evaluated_chunk_group_assets(\n@@ -396,7 +401,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n         availability_info: AvailabilityInfo,\n     ) -> Vc<OutputAssets> {\n         evaluated_chunk_group_assets(\n-            Vc::upcast(self),\n+            Vc::upcast_non_strict(self),\n             ident,\n             chunk_group,\n             module_graph,\n@@ -413,7 +418,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n         availability_info: AvailabilityInfo,\n     ) -> Vc<Box<dyn OutputAsset>> {\n         entry_chunk_group_asset(\n-            Vc::upcast(self),\n+            Vc::upcast_non_strict(self),\n             path,\n             evaluatable_assets,\n             module_graph,\n@@ -446,7 +451,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n         extra_chunks: Vc<OutputAssets>,\n     ) -> Vc<Box<dyn OutputAsset>> {\n         entry_chunk_group_asset(\n-            Vc::upcast(self),\n+            Vc::upcast_non_strict(self),\n             path,\n             evaluatable_assets,\n             module_graph,\n@@ -463,7 +468,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n         availability_info: AvailabilityInfo,\n     ) -> Vc<OutputAssets> {\n         chunk_group_assets(\n-            Vc::upcast(self),\n+            Vc::upcast_non_strict(self),\n             ident,\n             chunk_group,\n             module_graph,"
        },
        {
            "sha": "c20aa32da3244b9a9ad125d0262adedccda0748f",
            "filename": "turbopack/crates/turbopack-core/src/chunk/evaluate.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fevaluate.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fevaluate.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fevaluate.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -32,7 +32,7 @@ where\n         self: Vc<Self>,\n         asset_context: Vc<Box<dyn AssetContext>>,\n     ) -> Vc<Box<dyn EvaluatableAsset>> {\n-        to_evaluatable(Vc::upcast(self), asset_context)\n+        to_evaluatable(Vc::upcast_non_strict(self), asset_context)\n     }\n }\n "
        },
        {
            "sha": "1d1bcfe73247de8b9497d45c611911913bb1dbfb",
            "filename": "turbopack/crates/turbopack-core/src/chunk/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -540,7 +540,7 @@ where\n {\n     /// Returns the module id of this chunk item.\n     fn id(self: Vc<Self>) -> Vc<ModuleId> {\n-        let chunk_item = Vc::upcast(self);\n+        let chunk_item = Vc::upcast_non_strict(self);\n         chunk_item.chunking_context().chunk_item_id(chunk_item)\n     }\n }\n@@ -560,7 +560,7 @@ where\n         self: Vc<Self>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Vc<ModuleId> {\n-        chunking_context.chunk_item_id_from_module(Vc::upcast(self))\n+        chunking_context.chunk_item_id_from_module(Vc::upcast_non_strict(self))\n     }\n }\n "
        },
        {
            "sha": "5a65c3c4634e2ae267749619598d83452d4852f2",
            "filename": "turbopack/crates/turbopack-core/src/diagnostics/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fdiagnostics%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fdiagnostics%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fdiagnostics%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -86,7 +86,7 @@ where\n     T: Upcast<Box<dyn Diagnostic>>,\n {\n     fn emit(self) {\n-        let diagnostic = ResolvedVc::upcast::<Box<dyn Diagnostic>>(self);\n+        let diagnostic = ResolvedVc::upcast_non_strict::<Box<dyn Diagnostic>>(self);\n         emit(diagnostic);\n     }\n }"
        },
        {
            "sha": "08e9fc200cc09056f88995ff98e11f44d5ead92d",
            "filename": "turbopack/crates/turbopack-core/src/introspect/utils.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fintrospect%2Futils.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fintrospect%2Futils.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fintrospect%2Futils.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -129,7 +129,7 @@ pub async fn children_from_output_assets(\n     for &reference in &*references {\n         children.insert((\n             key.clone(),\n-            IntrospectableOutputAsset::new(*ResolvedVc::upcast(reference))\n+            IntrospectableOutputAsset::new(*reference)\n                 .to_resolved()\n                 .await?,\n         ));"
        },
        {
            "sha": "b0fa495a74fad9c0b53968782a93d0c1ea976dce",
            "filename": "turbopack/crates/turbopack-core/src/issue/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fissue%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -353,7 +353,7 @@ where\n     T: Upcast<Box<dyn Issue>>,\n {\n     fn emit(self) {\n-        let issue = ResolvedVc::upcast::<Box<dyn Issue>>(self);\n+        let issue = ResolvedVc::upcast_non_strict::<Box<dyn Issue>>(self);\n         emit(issue);\n         emit(ResolvedVc::upcast::<Box<dyn IssueProcessingPath>>(\n             RootIssueProcessingPath::resolved_cell(RootIssueProcessingPath(issue)),"
        },
        {
            "sha": "09931e78de82df3955167f6d8345b2e853098ccd",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/module_batches.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 28,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batches.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batches.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batches.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -286,7 +286,7 @@ impl PreBatches {\n         let mut visited = FxHashSet::default();\n         module_graph\n             .traverse_edges_from_entries_dfs(\n-                std::iter::once(ResolvedVc::upcast(entry)),\n+                std::iter::once(entry),\n                 &mut state,\n                 |parent_info, node, state| {\n                     let ty = parent_info.map_or(\n@@ -412,15 +412,7 @@ pub async fn compute_module_batches(\n         // Start with the entries\n         for chunk_group in &chunk_group_info.chunk_groups {\n             for entry in chunk_group.entries() {\n-                if let Some(chunkable_module) = ResolvedVc::try_downcast(entry) {\n-                    pre_batches.ensure_pre_batch_for_module(\n-                        chunkable_module,\n-                        &chunk_group_info,\n-                        &mut queue,\n-                    )?;\n-                } else {\n-                    pre_batches.single_module_entries.insert(entry);\n-                }\n+                pre_batches.ensure_pre_batch_for_module(entry, &chunk_group_info, &mut queue)?;\n             }\n             if let Some(parent) = chunk_group.get_merged_parent() {\n                 chunk_group_indices_with_merged_children.insert(parent);\n@@ -459,13 +451,9 @@ pub async fn compute_module_batches(\n                     || Either::Left(chunk_group.entries()),\n                     |v| Either::Right(v.iter().copied()),\n                 )\n-                .filter_map(|module| {\n-                    if let Some(chunkable_module) = ResolvedVc::try_downcast(module) {\n-                        let idx = *pre_batches.entries.get(&chunkable_module).unwrap();\n-                        Some((idx, 0))\n-                    } else {\n-                        None\n-                    }\n+                .map(|module| {\n+                    let idx = *pre_batches.entries.get(&module).unwrap();\n+                    (idx, 0)\n                 })\n                 .collect::<Vec<_>>();\n             stack.reverse();\n@@ -537,11 +525,7 @@ pub async fn compute_module_batches(\n                             .push(idx);\n                     }\n                     PreBatchItem::NonParallelEdge(_, module) => {\n-                        if let Some(chunkable_module) = ResolvedVc::try_downcast(*module) {\n-                            if !pre_batches.entries.contains_key(&chunkable_module) {\n-                                pre_batches.single_module_entries.insert(*module);\n-                            }\n-                        } else {\n+                        if !pre_batches.entries.contains_key(module) {\n                             pre_batches.single_module_entries.insert(*module);\n                         }\n                     }\n@@ -858,9 +842,7 @@ pub async fn compute_module_batches(\n                         );\n                     }\n                     PreBatchItem::NonParallelEdge(ty, module) => {\n-                        if let Some(chunkable_module) = ResolvedVc::try_downcast(module)\n-                            && let Some(batch) = pre_batches.entries.get(&chunkable_module).copied()\n-                        {\n+                        if let Some(batch) = pre_batches.entries.get(&module).copied() {\n                             graph.add_edge(\n                                 index,\n                                 batch_indices[batch],\n@@ -897,9 +879,7 @@ pub async fn compute_module_batches(\n         let mut entries = FxHashMap::default();\n         for chunk_group in &chunk_group_info.chunk_groups {\n             for module in chunk_group.entries() {\n-                if let Some(chunkable_module) = ResolvedVc::try_downcast(module)\n-                    && let Some(batch) = pre_batches.entries.get(&chunkable_module).copied()\n-                {\n+                if let Some(batch) = pre_batches.entries.get(&module).copied() {\n                     entries.insert(module, batch_indices[batch]);\n                     continue;\n                 }"
        },
        {
            "sha": "a1267e8138f73e1147a1b0a345ec5dd55e3dec80",
            "filename": "turbopack/crates/turbopack-core/src/reference/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -335,10 +335,7 @@ pub async fn all_assets_from_entries(entries: Vc<OutputAssets>) -> Result<Vc<Out\n     Ok(Vc::cell(\n         AdjacencyMap::new()\n             .skip_duplicates()\n-            .visit(\n-                entries.await?.iter().copied().map(ResolvedVc::upcast),\n-                get_referenced_assets,\n-            )\n+            .visit(entries.await?.iter().copied(), get_referenced_assets)\n             .await\n             .completed()?\n             .into_inner()"
        },
        {
            "sha": "bcf68b5e8d7d740a8bf5881d05418937ed0d67b5",
            "filename": "turbopack/crates/turbopack-core/src/resolve/origin.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Forigin.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Forigin.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Forigin.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -66,7 +66,12 @@ where\n         options: Vc<ResolveOptions>,\n         reference_type: ReferenceType,\n     ) -> impl Future<Output = Result<Vc<ModuleResolveResult>>> + Send {\n-        resolve_asset(Vc::upcast(self), request, options, reference_type)\n+        resolve_asset(\n+            Vc::upcast_non_strict(self),\n+            request,\n+            options,\n+            reference_type,\n+        )\n     }\n \n     async fn resolve_options(\n@@ -81,7 +86,7 @@ where\n     fn with_transition(self: ResolvedVc<Self>, transition: RcStr) -> Vc<Box<dyn ResolveOrigin>> {\n         Vc::upcast(\n             ResolveOriginWithTransition {\n-                previous: ResolvedVc::upcast(self),\n+                previous: ResolvedVc::upcast_non_strict(self),\n                 transition,\n             }\n             .cell(),"
        },
        {
            "sha": "86015d2c193e1c1726faa2232c2f61a443ec155e",
            "filename": "turbopack/crates/turbopack-core/src/source_map/utils.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Futils.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Futils.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Futils.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -5,7 +5,7 @@ use const_format::concatcp;\n use once_cell::sync::Lazy;\n use regex::Regex;\n use serde::{Deserialize, Serialize};\n-use turbo_tasks::Vc;\n+use turbo_tasks::ResolvedVc;\n use turbo_tasks_fs::{\n     DiskFileSystem, FileContent, FileSystemPath, rope::Rope, util::uri_from_file,\n };\n@@ -174,9 +174,8 @@ pub async fn fileify_source_map(\n         return Ok(None);\n     };\n \n-    let context_fs = context_path.fs();\n-    let context_fs = &*Vc::try_resolve_downcast_type::<DiskFileSystem>(context_fs)\n-        .await?\n+    let context_fs = context_path.fs;\n+    let context_fs = &*ResolvedVc::try_downcast_type::<DiskFileSystem>(context_fs)\n         .context(\"Expected the chunking context to have a DiskFileSystem\")?\n         .await?;\n     let prefix = format!(\"{}///[{}]/\", SOURCE_URL_PROTOCOL, context_fs.name());"
        },
        {
            "sha": "55fcfe9b7af04acf1e1599c27ae9303d0ee5c9ee",
            "filename": "turbopack/crates/turbopack-css/src/asset.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -215,7 +215,7 @@ impl ChunkItem for CssModuleChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        Vc::upcast(*self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "4d3e6eae881918ecbc929a3adf379e12155e4140",
            "filename": "turbopack/crates/turbopack-css/src/chunk/mod.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 10,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -273,11 +273,7 @@ impl OutputChunk for CssChunk {\n             .await?;\n         let imports_chunk_items: Vec<_> = entries_chunk_items\n             .iter()\n-            .map(|&chunk_item| async move {\n-                let Some(css_item) = ResolvedVc::try_downcast::<Box<dyn CssChunkItem>>(chunk_item)\n-                else {\n-                    return Ok(vec![]);\n-                };\n+            .map(|&css_item| async move {\n                 Ok(css_item\n                     .content()\n                     .await?\n@@ -290,7 +286,7 @@ impl OutputChunk for CssChunk {\n                             None\n                         }\n                     })\n-                    .collect())\n+                    .collect::<Vec<_>>())\n             })\n             .try_join()\n             .await?\n@@ -544,12 +540,10 @@ impl ChunkType for CssChunkType {\n     async fn chunk_item_size(\n         &self,\n         _chunking_context: Vc<Box<dyn ChunkingContext>>,\n-        chunk_item: Vc<Box<dyn ChunkItem>>,\n+        chunk_item: ResolvedVc<Box<dyn ChunkItem>>,\n         _async_module_info: Option<Vc<AsyncModuleInfo>>,\n     ) -> Result<Vc<usize>> {\n-        let Some(chunk_item) =\n-            Vc::try_resolve_downcast::<Box<dyn CssChunkItem>>(chunk_item).await?\n-        else {\n+        let Some(chunk_item) = ResolvedVc::try_downcast::<Box<dyn CssChunkItem>>(chunk_item) else {\n             bail!(\"Chunk item is not an css chunk item but reporting chunk type css\");\n         };\n         Ok(Vc::cell(chunk_item.content().await.map_or(0, |content| {"
        },
        {
            "sha": "31ae843b64231aa09f83d02ff644f2ae1590fc03",
            "filename": "turbopack/crates/turbopack-css/src/module_asset.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -296,7 +296,7 @@ impl ChunkItem for ModuleChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        Vc::upcast(*self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]\n@@ -368,9 +368,7 @@ impl EcmascriptChunkItem for ModuleChunkItem {\n                         let placeable: ResolvedVc<Box<dyn EcmascriptChunkPlaceable>> =\n                             ResolvedVc::upcast(css_module);\n \n-                        let module_id = placeable\n-                            .chunk_item_id(Vc::upcast(*self.chunking_context))\n-                            .await?;\n+                        let module_id = placeable.chunk_item_id(*self.chunking_context).await?;\n                         let module_id = StringifyJs(&*module_id);\n                         let original_name = StringifyJs(&original_name);\n                         exported_class_names"
        },
        {
            "sha": "bb0d84cb88866d673c4ca16c42b9c29b3cc213b2",
            "filename": "turbopack/crates/turbopack-css/src/references/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -106,7 +106,7 @@ impl Visitor<'_> for ModuleReferencesVisitor<'_> {\n                     ImportAttributes::new_from_lightningcss(&i.clone().into_owned()).into(),\n                     self.import_context.map(|ctx| *ctx),\n                     IssueSource::from_line_col(\n-                        ResolvedVc::upcast(self.source),\n+                        self.source,\n                         SourcePos {\n                             line: issue_span.line as _,\n                             column: issue_span.column as _,\n@@ -141,7 +141,7 @@ impl Visitor<'_> for ModuleReferencesVisitor<'_> {\n                 *self.origin,\n                 Request::parse(RcStr::from(src).into()),\n                 IssueSource::from_line_col(\n-                    ResolvedVc::upcast(self.source),\n+                    self.source,\n                     SourcePos {\n                         line: issue_span.line as _,\n                         column: issue_span.column as _,"
        },
        {
            "sha": "3aa6a37a831e7fac69e906b2d410eab27b5d4730",
            "filename": "turbopack/crates/turbopack-css/src/references/url.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Furl.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Furl.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Furl.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -55,7 +55,7 @@ impl UrlAssetReference {\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<Vc<ReferencedAsset>> {\n         if let Some(module) = *self.resolve_reference().first_module().await?\n-            && let Some(embeddable) = Vc::try_resolve_downcast::<Box<dyn CssEmbed>>(*module).await?\n+            && let Some(embeddable) = ResolvedVc::try_downcast::<Box<dyn CssEmbed>>(module)\n         {\n             return Ok(ReferencedAsset::Some(\n                 embeddable"
        },
        {
            "sha": "dfa3e2b0e89447b5348c5eb7d5d4bba5fc80fe9b",
            "filename": "turbopack/crates/turbopack-dev-server/src/source/asset_graph.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Fasset_graph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Fasset_graph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Fasset_graph.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -323,9 +323,7 @@ impl Introspectable for AssetGraphContentSource {\n             .map(|&asset| async move {\n                 Ok((\n                     rcstr!(\"root\"),\n-                    IntrospectableOutputAsset::new(*ResolvedVc::upcast(asset))\n-                        .to_resolved()\n-                        .await?,\n+                    IntrospectableOutputAsset::new(*asset).to_resolved().await?,\n                 ))\n             })\n             .try_join()\n@@ -338,9 +336,7 @@ impl Introspectable for AssetGraphContentSource {\n             .map(|&asset| async move {\n                 Ok((\n                     rcstr!(\"inner\"),\n-                    IntrospectableOutputAsset::new(*ResolvedVc::upcast(asset))\n-                        .to_resolved()\n-                        .await?,\n+                    IntrospectableOutputAsset::new(*asset).to_resolved().await?,\n                 ))\n             })\n             .try_join()"
        },
        {
            "sha": "9ee7972e67f0c6e467b47903237c560ac7f3cd47",
            "filename": "turbopack/crates/turbopack-dev-server/src/source/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -450,7 +450,7 @@ where\n         Vc::upcast(IssueFilePathContentSource::new_file_path(\n             file_path,\n             description,\n-            Vc::upcast(self),\n+            Vc::upcast_non_strict(self),\n         ))\n     }\n }"
        },
        {
            "sha": "d55cce69596f60a2f59b83204fc260ca0931ce10",
            "filename": "turbopack/crates/turbopack-dev-server/src/source/static_assets.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Fstatic_assets.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Fstatic_assets.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fsource%2Fstatic_assets.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -126,13 +126,9 @@ impl Introspectable for StaticAssetsContentSource {\n                 async move {\n                     let child = match entry {\n                         DirectoryEntry::File(path) | DirectoryEntry::Symlink(path) => {\n-                            ResolvedVc::upcast(\n-                                IntrospectableSource::new(Vc::upcast(FileSource::new(\n-                                    path.clone(),\n-                                )))\n+                            IntrospectableSource::new(Vc::upcast(FileSource::new(path.clone())))\n                                 .to_resolved()\n-                                .await?,\n-                            )\n+                                .await?\n                         }\n                         DirectoryEntry::Directory(path) => ResolvedVc::upcast(\n                             StaticAssetsContentSource::with_prefix("
        },
        {
            "sha": "38fd2ccc1b34f5feee00f0811e9a8973bf2681d2",
            "filename": "turbopack/crates/turbopack-ecmascript/src/async_chunk/chunk_item.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -76,13 +76,9 @@ impl EcmascriptChunkItem for AsyncLoaderChunkItem {\n         let module = this.module.await?;\n \n         let id = if let Some(placeable) =\n-            Vc::try_resolve_downcast::<Box<dyn EcmascriptChunkPlaceable>>(*module.inner).await?\n+            ResolvedVc::try_downcast::<Box<dyn EcmascriptChunkPlaceable>>(module.inner)\n         {\n-            Some(\n-                placeable\n-                    .chunk_item_id(*ResolvedVc::upcast(this.chunking_context))\n-                    .await?,\n-            )\n+            Some(placeable.chunk_item_id(*this.chunking_context).await?)\n         } else {\n             None\n         };\n@@ -171,7 +167,7 @@ impl ChunkItem for AsyncLoaderChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "db18d68b2a682d2f5be248f6c5ed1ba71e125c8b",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/chunk_type.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fchunk_type.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fchunk_type.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fchunk_type.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -39,12 +39,6 @@ impl ChunkType for EcmascriptChunkType {\n         batch_groups: Vec<ResolvedVc<ChunkItemBatchGroup>>,\n         referenced_output_assets: Vc<OutputAssets>,\n     ) -> Result<Vc<Box<dyn Chunk>>> {\n-        let Some(chunking_context) =\n-            Vc::try_resolve_downcast::<Box<dyn ChunkingContext>>(chunking_context).await?\n-        else {\n-            bail!(\"Ecmascript chunking context not found\");\n-        };\n-\n         let content = EcmascriptChunkContent {\n             chunk_items: chunk_items\n                 .iter()\n@@ -69,11 +63,10 @@ impl ChunkType for EcmascriptChunkType {\n     async fn chunk_item_size(\n         &self,\n         _chunking_context: Vc<Box<dyn ChunkingContext>>,\n-        chunk_item: Vc<Box<dyn ChunkItem>>,\n+        chunk_item: ResolvedVc<Box<dyn ChunkItem>>,\n         async_module_info: Option<Vc<AsyncModuleInfo>>,\n     ) -> Result<Vc<usize>> {\n-        let Some(chunk_item) =\n-            Vc::try_resolve_downcast::<Box<dyn EcmascriptChunkItem>>(chunk_item).await?\n+        let Some(chunk_item) = ResolvedVc::try_downcast::<Box<dyn EcmascriptChunkItem>>(chunk_item)\n         else {\n             bail!(\"Chunk item is not an ecmascript chunk item but reporting chunk type ecmascript\");\n         };"
        },
        {
            "sha": "cfbf09be16f780b23bdeee6ace0eb1a1b695169f",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/item.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -212,7 +212,7 @@ where\n {\n     /// Generates the module factory for this chunk item.\n     fn code(self: Vc<Self>, async_module_info: Option<Vc<AsyncModuleInfo>>) -> Vc<Code> {\n-        module_factory_with_code_generation_issue(Vc::upcast(self), async_module_info)\n+        module_factory_with_code_generation_issue(Vc::upcast_non_strict(self), async_module_info)\n     }\n }\n "
        },
        {
            "sha": "8ea03a6fd6ea9d1d14faa01b363932b065ff6900",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -124,7 +124,7 @@ impl Chunk for EcmascriptChunk {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "ed804f18e43257ad8ae364c2ebc8cbf7324d6e65",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -782,7 +782,7 @@ impl ChunkItem for ModuleChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "8fdf081e0c2cda673ed94fa1911a4296d215a632",
            "filename": "turbopack/crates/turbopack-ecmascript/src/manifest/chunk_item.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_item.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -88,7 +88,7 @@ impl ChunkItem for ManifestChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "e25241b34d12213d22743f700c638494590419ce",
            "filename": "turbopack/crates/turbopack-ecmascript/src/manifest/loader_item.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Floader_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Floader_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Floader_item.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -105,7 +105,7 @@ impl ChunkItem for ManifestLoaderChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]\n@@ -140,17 +140,15 @@ impl EcmascriptChunkItem for ManifestLoaderChunkItem {\n         // exports a promise for all of the necessary chunk loads.\n         let item_id = &*this\n             .manifest\n-            .chunk_item_id(*ResolvedVc::upcast(manifest.chunking_context))\n+            .chunk_item_id(*manifest.chunking_context)\n             .await?;\n \n         // Finally, we need the id of the module that we're actually trying to\n         // dynamically import.\n         let placeable =\n             ResolvedVc::try_downcast::<Box<dyn EcmascriptChunkPlaceable>>(manifest.inner)\n                 .ok_or_else(|| anyhow!(\"asset is not placeable in ecmascript chunk\"))?;\n-        let dynamic_id = &*placeable\n-            .chunk_item_id(*ResolvedVc::upcast(manifest.chunking_context))\n-            .await?;\n+        let dynamic_id = &*placeable.chunk_item_id(*manifest.chunking_context).await?;\n \n         // This is the code that will be executed when the dynamic import is reached.\n         // It will load the manifest chunk, which will load all the chunks needed by"
        },
        {
            "sha": "ff8b268e3f41bb5ff76e3bee303ab790b5811d10",
            "filename": "turbopack/crates/turbopack-ecmascript/src/merged_module.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 8,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmerged_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmerged_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmerged_module.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -120,7 +120,7 @@ impl ChunkItem for MergedEcmascriptModuleChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]\n@@ -153,13 +153,8 @@ impl EcmascriptChunkItem for MergedEcmascriptModuleChunkItem {\n         let entry_points = &module.entry_points;\n         let options = modules\n             .iter()\n-            .map(|(m, _)| {\n-                let Some(m) = ResolvedVc::try_downcast::<Box<dyn EcmascriptAnalyzable>>(*m) else {\n-                    anyhow::bail!(\"Expected EcmascriptAnalyzable in scope hoisting group\");\n-                };\n-                Ok(m.module_content_options(*self.chunking_context, async_module_info))\n-            })\n-            .collect::<Result<Vec<_>>>()?;\n+            .map(|(m, _)| m.module_content_options(*self.chunking_context, async_module_info))\n+            .collect::<Vec<_>>();\n \n         let content = EcmascriptModuleContent::new_merged(\n             modules.clone(),"
        },
        {
            "sha": "b6de7493329e5950ec0d34add2f81a8264ce8f93",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/amd.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Famd.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Famd.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Famd.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -174,7 +174,7 @@ impl AmdDefineWithDependenciesCodeGen {\n                         pattern_mapping: PatternMapping::resolve_request(\n                             **request,\n                             *self.origin,\n-                            Vc::upcast(chunking_context),\n+                            chunking_context,\n                             cjs_resolve(\n                                 *self.origin,\n                                 **request,"
        },
        {
            "sha": "8056f8cd8c605bf398aaf2101587be2c423ce8ef",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/async_module.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fasync_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fasync_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fasync_module.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -86,9 +86,9 @@ impl OptionAsyncModule {\n struct AsyncModuleIdents(FxIndexSet<(String, AstSyntaxContext)>);\n \n async fn get_inherit_async_referenced_asset(\n-    r: Vc<Box<dyn ModuleReference>>,\n+    r: ResolvedVc<Box<dyn ModuleReference>>,\n ) -> Result<Option<ReadRef<ReferencedAsset>>> {\n-    let Some(r) = Vc::try_resolve_downcast::<Box<dyn ChunkableModuleReference>>(r).await? else {\n+    let Some(r) = ResolvedVc::try_downcast::<Box<dyn ChunkableModuleReference>>(r) else {\n         return Ok(None);\n     };\n     let Some(ty) = &*r.chunking_type().await? else {\n@@ -123,7 +123,7 @@ impl AsyncModule {\n             .await?\n             .iter()\n             .map(|r| async {\n-                let Some(referenced_asset) = get_inherit_async_referenced_asset(**r).await? else {\n+                let Some(referenced_asset) = get_inherit_async_referenced_asset(*r).await? else {\n                     return Ok(None);\n                 };\n                 Ok(match &*referenced_asset {\n@@ -174,8 +174,7 @@ impl AsyncModule {\n                     .await?\n                     .iter()\n                     .map(|r| async {\n-                        let Some(referenced_asset) =\n-                            get_inherit_async_referenced_asset(**r).await?\n+                        let Some(referenced_asset) = get_inherit_async_referenced_asset(*r).await?\n                         else {\n                             return Ok(false);\n                         };"
        },
        {
            "sha": "7fad3d71e262de055f4c77b5f0fa79e1db415dc4",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/cjs.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -166,7 +166,7 @@ impl CjsRequireAssetReferenceCodeGen {\n         let pm = PatternMapping::resolve_request(\n             *reference.request,\n             *reference.origin,\n-            Vc::upcast(chunking_context),\n+            chunking_context,\n             self.reference.resolve_reference(),\n             ResolveType::ChunkItem,\n         )\n@@ -290,7 +290,7 @@ impl CjsRequireResolveAssetReferenceCodeGen {\n         let pm = PatternMapping::resolve_request(\n             *reference.request,\n             *reference.origin,\n-            Vc::upcast(chunking_context),\n+            chunking_context,\n             self.reference.resolve_reference(),\n             ResolveType::ChunkItem,\n         )"
        },
        {
            "sha": "8a86c2e9443a3479bf634480ba4632749b49a5af",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/base.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -171,8 +171,7 @@ impl ReferencedAsset {\n     ) -> Result<Option<ReferencedAssetIdent>> {\n         Ok(match self {\n             ReferencedAsset::Some(asset) => {\n-                if let Some(ctxt) =\n-                    scope_hoisting_context.get_module_syntax_context(ResolvedVc::upcast(*asset))\n+                if let Some(ctxt) = scope_hoisting_context.get_module_syntax_context(*asset)\n                     && let Some(export) = &export\n                     && let EcmascriptExports::EsmExports(exports) = *asset.get_exports().await?\n                 {\n@@ -271,7 +270,7 @@ impl ReferencedAsset {\n         asset: &Vc<Box<dyn EcmascriptChunkPlaceable>>,\n         chunking_context: Vc<Box<dyn ChunkingContext>>,\n     ) -> Result<String> {\n-        let id = asset.chunk_item_id(Vc::upcast(chunking_context)).await?;\n+        let id = asset.chunk_item_id(chunking_context).await?;\n         Ok(magic_identifier::mangle(&format!(\"imported module {id}\")))\n     }\n }\n@@ -604,9 +603,7 @@ impl EsmAssetReference {\n                                         unreachable!();\n                                     }\n                                     ReferencedAsset::Some(asset) => {\n-                                        let id = asset\n-                                            .chunk_item_id(Vc::upcast(chunking_context))\n-                                            .await?;\n+                                        let id = asset.chunk_item_id(chunking_context).await?;\n                                         let (sym, ctxt) =\n                                             ident.into_module_namespace_ident().unwrap();\n                                         let name = Ident::new("
        },
        {
            "sha": "b77e5a82d06badfe0d90848d68bb7eefe41bc608",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/dynamic.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fdynamic.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fdynamic.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fdynamic.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -137,7 +137,7 @@ impl EsmAsyncAssetReferenceCodeGen {\n         let pm = PatternMapping::resolve_request(\n             *reference.request,\n             *reference.origin,\n-            Vc::upcast(chunking_context),\n+            chunking_context,\n             self.reference.resolve_reference(),\n             if matches!(\n                 *chunking_context.environment().chunk_loading().await?,"
        },
        {
            "sha": "47fb15bcbe10a3c26a46670835e524274d492d3b",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/export.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 13,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -297,8 +297,7 @@ async fn find_export_from_reexports(\n     export_name: RcStr,\n ) -> Result<Vc<FindExportFromReexportsResult>> {\n     // TODO why do we need a special case for this?\n-    if let Some(module) =\n-        Vc::try_resolve_downcast_type::<EcmascriptModulePartAsset>(*module).await?\n+    if let Some(module) = ResolvedVc::try_downcast_type::<EcmascriptModulePartAsset>(module)\n         && matches!(module.await?.part, ModulePart::Exports)\n     {\n         let module_part = EcmascriptModulePartAsset::select_part(\n@@ -309,10 +308,7 @@ async fn find_export_from_reexports(\n         // If we apply this logic to EcmascriptModuleAsset, we will resolve everything in the\n         // target module.\n         if (Vc::try_resolve_downcast_type::<EcmascriptModuleAsset>(module_part).await?).is_none() {\n-            return Ok(find_export_from_reexports(\n-                Vc::upcast(module_part),\n-                export_name,\n-            ));\n+            return Ok(find_export_from_reexports(module_part, export_name));\n         }\n     }\n \n@@ -547,11 +543,7 @@ impl EsmExports {\n                 if !exports.contains_key(export) {\n                     exports.insert(\n                         export.clone(),\n-                        EsmExport::ImportedBinding(\n-                            ResolvedVc::upcast(esm_ref),\n-                            export.clone(),\n-                            false,\n-                        ),\n+                        EsmExport::ImportedBinding(esm_ref, export.clone(), false),\n                     );\n                 }\n             }\n@@ -596,7 +588,7 @@ impl EsmExports {\n             let id = if let Some(module) = scope_hoisting_context.module()\n                 && !expanded.dynamic_exports.is_empty()\n             {\n-                Some(module.chunk_item_id(Vc::upcast(chunking_context)).await?)\n+                Some(module.chunk_item_id(chunking_context).await?)\n             } else {\n                 None\n             };\n@@ -814,7 +806,7 @@ impl EsmExports {\n         let esm_exports = vec![CodeGenerationHoistedStmt::new(\n             rcstr!(\"__turbopack_esm__\"),\n             if let Some(module) = scope_hoisting_context.module() {\n-                let id = module.chunk_item_id(Vc::upcast(chunking_context)).await?;\n+                let id = module.chunk_item_id(chunking_context).await?;\n                 quote!(\"$turbopack_esm($getters, $id);\" as Stmt,\n                     turbopack_esm: Expr = TURBOPACK_ESM.into(),\n                     getters: Expr = getters,"
        },
        {
            "sha": "4e112856cbeb93ade6d6fd6c3af4b671707a5eaf",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/module_id.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fmodule_id.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fmodule_id.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fmodule_id.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -89,7 +89,7 @@ impl EsmModuleIdAssetReferenceCodeGen {\n         if let ReferencedAsset::Some(asset) =\n             &*self.reference.await?.inner.get_referenced_asset().await?\n         {\n-            let id = asset.chunk_item_id(Vc::upcast(chunking_context)).await?;\n+            let id = asset.chunk_item_id(chunking_context).await?;\n             let id = module_id_to_lit(&id);\n             visitors.push(create_visitor!(\n                 self.path,"
        },
        {
            "sha": "8149229bff154bcc87713967dab46c62558f122b",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/url.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Furl.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Furl.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Furl.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -192,7 +192,7 @@ impl UrlAssetReferenceCodeGen {\n                     ReferencedAsset::Some(asset) => {\n                         // We rewrite the first `new URL()` arguments to be a require() of the chunk\n                         // item, which exports the static asset path to the linked file.\n-                        let id = asset.chunk_item_id(Vc::upcast(chunking_context)).await?;\n+                        let id = asset.chunk_item_id(chunking_context).await?;\n \n                         visitors.push(create_visitor!(self.path, visit_mut_expr, |new_expr: &mut Expr| {\n                             let should_rewrite_to_relative = if let Expr::New(NewExpr { args: Some(args), .. }) = new_expr {\n@@ -257,7 +257,7 @@ impl UrlAssetReferenceCodeGen {\n                     ReferencedAsset::Some(asset) => {\n                         // We rewrite the first `new URL()` arguments to be a require() of the\n                         // chunk item, which returns the asset path as its exports.\n-                        let id = asset.chunk_item_id(Vc::upcast(chunking_context)).await?;\n+                        let id = asset.chunk_item_id(chunking_context).await?;\n \n                         // If there's a rewrite to the base url, then the current rendering\n                         // environment should able to resolve the asset path"
        },
        {
            "sha": "8a3f3b6fe3dec798b4f1479e44039be51852d0c4",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/mod.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -61,8 +61,8 @@ use swc_core::{\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    FxIndexMap, FxIndexSet, NonLocalValue, ReadRef, ResolvedVc, TaskInput, TryJoinIterExt, Upcast,\n-    ValueToString, Vc, trace::TraceRawVcs,\n+    FxIndexMap, FxIndexSet, NonLocalValue, ReadRef, ResolvedVc, TaskInput, TryJoinIterExt,\n+    UpcastStrict, ValueToString, Vc, trace::TraceRawVcs,\n };\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -255,15 +255,18 @@ impl AnalyzeEcmascriptModuleResultBuilder {\n     }\n \n     /// Adds an asset reference to the analysis result.\n-    pub fn add_reference(&mut self, reference: ResolvedVc<impl Upcast<Box<dyn ModuleReference>>>) {\n+    pub fn add_reference(\n+        &mut self,\n+        reference: ResolvedVc<impl UpcastStrict<Box<dyn ModuleReference>>>,\n+    ) {\n         let r = ResolvedVc::upcast(reference);\n         self.references.insert(r);\n     }\n \n     /// Adds an asset reference with codegen to the analysis result.\n     pub fn add_reference_code_gen<R: IntoCodeGenReference>(&mut self, reference: R, path: AstPath) {\n         let (reference, code_gen) = reference.into_code_gen_reference(path);\n-        self.add_reference(reference);\n+        self.references.insert(reference);\n         self.add_code_gen(code_gen);\n     }\n "
        },
        {
            "sha": "d34218b657e822b6cfdfc763aa4f2907abf94bad",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/require_context.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -331,7 +331,7 @@ impl RequireContextAssetReferenceCodeGen {\n             .reference\n             .await?\n             .inner\n-            .chunk_item_id(Vc::upcast(chunking_context))\n+            .chunk_item_id(chunking_context)\n             .await?;\n \n         let mut visitors = Vec::new();\n@@ -485,7 +485,7 @@ impl EcmascriptChunkItem for RequireContextChunkItem {\n             let pm = PatternMapping::resolve_request(\n                 *entry.request,\n                 *self.origin,\n-                *ResolvedVc::upcast(self.chunking_context),\n+                *self.chunking_context,\n                 *entry.result,\n                 ResolveType::ChunkItem,\n             )\n@@ -563,7 +563,7 @@ impl ChunkItem for RequireContextChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "bea5458ea04578f1827a9e9dc4a60eacd6983a0c",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/facade/chunk_item.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Ffacade%2Fchunk_item.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -62,7 +62,7 @@ impl ChunkItem for EcmascriptModuleFacadeChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "7cd747260707626c38a2182a4d2ae01817e0c088",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/locals/chunk_item.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fchunk_item.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -62,7 +62,7 @@ impl ChunkItem for EcmascriptModuleLocalsChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "b0f0004cbfa0800f55d54c24a8e9792975260dd0",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/reference.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -204,7 +204,7 @@ impl EcmascriptModulePartReference {\n                     let key = sym.as_str().into();\n                     let name = Ident::new(sym.into(), DUMMY_SP, ctxt.unwrap_or_default());\n \n-                    let id = module.chunk_item_id(Vc::upcast(chunking_context)).await?;\n+                    let id = module.chunk_item_id(chunking_context).await?;\n \n                     result.push(CodeGenerationHoistedStmt::new(\n                         key,"
        },
        {
            "sha": "09cb6204ec78a17004e020a337bd5f396faeab7d",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/asset.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fasset.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -216,7 +216,7 @@ impl EcmascriptModulePartAsset {\n                     )\n                 };\n                 if side_effects.is_empty() {\n-                    return Ok(*ResolvedVc::upcast(final_module));\n+                    return Ok(*final_module);\n                 }\n                 let side_effects_module = SideEffectsModule::new(\n                     module,\n@@ -419,13 +419,13 @@ impl EvaluatableAsset for EcmascriptModulePartAsset {}\n \n #[turbo_tasks::function]\n async fn only_effects(\n-    module: Vc<Box<dyn EcmascriptChunkPlaceable>>,\n+    module: ResolvedVc<Box<dyn EcmascriptChunkPlaceable>>,\n ) -> Result<Vc<Box<dyn EcmascriptChunkPlaceable>>> {\n-    if let Some(module) = Vc::try_resolve_downcast_type::<EcmascriptModuleAsset>(module).await? {\n+    if let Some(module) = ResolvedVc::try_downcast_type::<EcmascriptModuleAsset>(module) {\n         let module =\n-            EcmascriptModulePartAsset::new_with_resolved_part(module, ModulePart::evaluation());\n+            EcmascriptModulePartAsset::new_with_resolved_part(*module, ModulePart::evaluation());\n         return Ok(Vc::upcast(module));\n     }\n \n-    Ok(module)\n+    Ok(*module)\n }"
        },
        {
            "sha": "97624fa9d2772893a3172a3a8e6b8bbf6bb54098",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/chunk_item.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fchunk_item.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -68,7 +68,7 @@ impl ChunkItem for EcmascriptModulePartChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "f61d7eb3d4e45a6f4f144a9e36d218d844758931",
            "filename": "turbopack/crates/turbopack-ecmascript/src/typescript/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -244,9 +244,7 @@ impl ModuleReference for TsExtendsReference {\n     #[turbo_tasks::function]\n     async fn resolve_reference(&self) -> Result<Vc<ModuleResolveResult>> {\n         Ok(*ModuleResolveResult::module(ResolvedVc::upcast(\n-            RawModule::new(*ResolvedVc::upcast(self.config))\n-                .to_resolved()\n-                .await?,\n+            RawModule::new(*self.config).to_resolved().await?,\n         )))\n     }\n }"
        },
        {
            "sha": "23f00eed26aa76668ed2cea4e4caeb49dc6ca462",
            "filename": "turbopack/crates/turbopack-ecmascript/src/worker_chunk/chunk_item.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -99,7 +99,7 @@ impl ChunkItem for WorkerLoaderChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "0f1e5ab51dd7aad34b407e60dd69b16d8caa948b",
            "filename": "turbopack/crates/turbopack-json/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-json%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-json%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-json%2Fsrc%2Flib.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -103,7 +103,7 @@ impl ChunkItem for JsonChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        Vc::upcast(*self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "cd8949782b30489fd90caf47f8b2a0a496458702",
            "filename": "turbopack/crates/turbopack-node/src/lib.rs",
            "status": "modified",
            "additions": 18,
            "deletions": 20,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Flib.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -261,27 +261,25 @@ pub async fn get_intermediate_asset(\n     main_entry: ResolvedVc<Box<dyn EvaluatableAsset>>,\n     other_entries: Vc<EvaluatableAssets>,\n ) -> Result<Vc<Box<dyn OutputAsset>>> {\n-    Ok(Vc::upcast(\n-        chunking_context.root_entry_chunk_group_asset(\n-            chunking_context\n-                .chunk_path(None, main_entry.ident(), None, rcstr!(\".js\"))\n-                .owned()\n-                .await?,\n-            other_entries.with_entry(*main_entry),\n-            ModuleGraph::from_modules(\n-                Vc::cell(vec![ChunkGroupEntry::Entry(\n-                    other_entries\n-                        .await?\n-                        .into_iter()\n-                        .copied()\n-                        .chain(std::iter::once(main_entry))\n-                        .map(ResolvedVc::upcast)\n-                        .collect(),\n-                )]),\n-                false,\n-            ),\n-            OutputAssets::empty(),\n+    Ok(chunking_context.root_entry_chunk_group_asset(\n+        chunking_context\n+            .chunk_path(None, main_entry.ident(), None, rcstr!(\".js\"))\n+            .owned()\n+            .await?,\n+        other_entries.with_entry(*main_entry),\n+        ModuleGraph::from_modules(\n+            Vc::cell(vec![ChunkGroupEntry::Entry(\n+                other_entries\n+                    .await?\n+                    .into_iter()\n+                    .copied()\n+                    .chain(std::iter::once(main_entry))\n+                    .map(ResolvedVc::upcast)\n+                    .collect(),\n+            )]),\n+            false,\n         ),\n+        OutputAssets::empty(),\n     ))\n }\n "
        },
        {
            "sha": "e20125c7f86fe13a10520d1b19f32755ab6c8991",
            "filename": "turbopack/crates/turbopack-nodejs/src/chunking_context.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -108,7 +108,7 @@ impl NodeJsChunkingContextBuilder {\n     {\n         self.chunking_context\n             .chunking_configs\n-            .push((ResolvedVc::upcast(ty), chunking_config));\n+            .push((ResolvedVc::upcast_non_strict(ty), chunking_config));\n         self\n     }\n \n@@ -205,17 +205,16 @@ impl NodeJsChunkingContext {\n     #[turbo_tasks::function]\n     async fn generate_chunk(\n         self: Vc<Self>,\n-        chunk: Vc<Box<dyn Chunk>>,\n+        chunk: ResolvedVc<Box<dyn Chunk>>,\n     ) -> Result<Vc<Box<dyn OutputAsset>>> {\n         Ok(\n-            if let Some(ecmascript_chunk) =\n-                Vc::try_resolve_downcast_type::<EcmascriptChunk>(chunk).await?\n+            if let Some(ecmascript_chunk) = ResolvedVc::try_downcast_type::<EcmascriptChunk>(chunk)\n             {\n-                Vc::upcast(EcmascriptBuildNodeChunk::new(self, ecmascript_chunk))\n+                Vc::upcast(EcmascriptBuildNodeChunk::new(self, *ecmascript_chunk))\n             } else if let Some(output_asset) =\n-                Vc::try_resolve_sidecast::<Box<dyn OutputAsset>>(chunk).await?\n+                ResolvedVc::try_sidecast::<Box<dyn OutputAsset>>(chunk)\n             {\n-                output_asset\n+                *output_asset\n             } else {\n                 bail!(\"Unable to generate output asset for chunk\");\n             },\n@@ -509,7 +508,7 @@ impl ChunkingContext for NodeJsChunkingContext {\n             ))\n         } else {\n             let module = AsyncLoaderModule::new(module, Vc::upcast(self), availability_info);\n-            Vc::upcast(module.as_chunk_item(module_graph, Vc::upcast(self)))\n+            module.as_chunk_item(module_graph, Vc::upcast(self))\n         })\n     }\n "
        },
        {
            "sha": "5bc5f8c3aafd2dfc2bbfe2c6995dad37886b28e9",
            "filename": "turbopack/crates/turbopack-nodejs/src/ecmascript/node/entry/chunk.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fchunk.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -189,9 +189,7 @@ impl OutputAsset for EcmascriptBuildNodeEntryChunk {\n         }\n \n         let other_chunks = this.other_chunks.await?;\n-        for &other_chunk in &*other_chunks {\n-            references.push(ResolvedVc::upcast(other_chunk));\n-        }\n+        references.extend(other_chunks.iter().copied());\n \n         Ok(Vc::cell(references))\n     }"
        },
        {
            "sha": "e901981595e674a6d5e242de60b46d502fd5fe4c",
            "filename": "turbopack/crates/turbopack-static/src/ecma.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Fecma.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Fecma.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Fecma.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -74,7 +74,7 @@ impl ChunkableModule for StaticUrlJsModule {\n                 module: self,\n                 chunking_context,\n                 static_asset: self\n-                    .static_output_asset(*ResolvedVc::upcast(chunking_context))\n+                    .static_output_asset(*chunking_context)\n                     .to_resolved()\n                     .await?,\n             },\n@@ -111,7 +111,7 @@ impl ChunkItem for StaticUrlJsChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        *ResolvedVc::upcast(self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "939fbe45bda05a7327d20b7b54223c91761e6392",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -404,7 +404,7 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n     {\n         let evaluatable_assets = runtime_entries\n             .unwrap_or_else(EvaluatableAssets::empty)\n-            .with_entry(Vc::upcast(ecmascript));\n+            .with_entry(ecmascript);\n         (\n             evaluatable_assets,\n             evaluatable_assets"
        },
        {
            "sha": "d40aa1b56eed0f875502bde3d89b0479add6888b",
            "filename": "turbopack/crates/turbopack-wasm/src/module_asset.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -221,7 +221,7 @@ impl ChunkItem for ModuleChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        Vc::upcast(*self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]\n@@ -250,8 +250,7 @@ impl EcmascriptChunkItem for ModuleChunkItem {\n         async_module_info: Option<Vc<AsyncModuleInfo>>,\n     ) -> Result<Vc<EcmascriptChunkItemContent>> {\n         let loader_asset = self.module.loader();\n-        let item =\n-            loader_asset.as_chunk_item(*self.module_graph, Vc::upcast(*self.chunking_context));\n+        let item = loader_asset.as_chunk_item(*self.module_graph, *self.chunking_context);\n \n         let ecmascript_item = Vc::try_resolve_downcast::<Box<dyn EcmascriptChunkItem>>(item)\n             .await?"
        },
        {
            "sha": "093430c981972e174fbe780289b605becca2970d",
            "filename": "turbopack/crates/turbopack-wasm/src/raw.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fraw.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fraw.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fraw.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -117,7 +117,7 @@ impl ChunkItem for RawModuleChunkItem {\n \n     #[turbo_tasks::function]\n     fn chunking_context(&self) -> Vc<Box<dyn ChunkingContext>> {\n-        Vc::upcast(*self.chunking_context)\n+        *self.chunking_context\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "62396852788023f1fd41ce723388304f42fa1d32",
            "filename": "turbopack/crates/turbopack/benches/node_file_trace.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -119,7 +119,7 @@ fn bench_emit(b: &mut Bencher, bench_input: &BenchInput) {\n                 let module = module_asset_context\n                     .process(Vc::upcast(source), ReferenceType::Undefined)\n                     .module();\n-                let rebased = RebasedAsset::new(Vc::upcast(module), input_dir, output_dir.clone())\n+                let rebased = RebasedAsset::new(module, input_dir, output_dir.clone())\n                     .to_resolved()\n                     .await?;\n "
        },
        {
            "sha": "40338b1f93aac2945ac7abd14ec370dfd4a5655f",
            "filename": "turbopack/crates/turbopack/tests/node-file-trace.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2d37f0702c7ce8d5b21035dd48597d835e521f83/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs?ref=2d37f0702c7ce8d5b21035dd48597d835e521f83",
            "patch": "@@ -385,7 +385,7 @@ async fn node_file_trace_operation(\n         .process(Vc::upcast(source), ReferenceType::Undefined)\n         .module();\n \n-    let rebased = RebasedAsset::new(Vc::upcast(module), input_dir.clone(), output_dir.clone())\n+    let rebased = RebasedAsset::new(module, input_dir.clone(), output_dir.clone())\n         .to_resolved()\n         .await?;\n "
        }
    ],
    "stats": {
        "total": 651,
        "additions": 315,
        "deletions": 336
    }
}