{
    "author": "eps1lon",
    "message": "[codemod] Only change files when `new-link` transform makes changes (#83112)",
    "sha": "070ae8a76562dd0ff85e33012ef3b4090a598b14",
    "files": [
        {
            "sha": "3bfe69ae526db13520653e55be09048173c601d1",
            "filename": "packages/next-codemod/transforms/new-link.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 16,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/070ae8a76562dd0ff85e33012ef3b4090a598b14/packages%2Fnext-codemod%2Ftransforms%2Fnew-link.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/070ae8a76562dd0ff85e33012ef3b4090a598b14/packages%2Fnext-codemod%2Ftransforms%2Fnew-link.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2Fnew-link.ts?ref=070ae8a76562dd0ff85e33012ef3b4090a598b14",
            "patch": "@@ -9,10 +9,10 @@ export default function transformer(file: FileInfo, _api: API) {\n   const j = createParserFromPath(file.path)\n \n   const $j = j(file.source)\n+  let hasChanges = false\n \n-  return $j\n-    .find(j.ImportDeclaration, { source: { value: 'next/link' } })\n-    .forEach((path) => {\n+  $j.find(j.ImportDeclaration, { source: { value: 'next/link' } }).forEach(\n+    (path) => {\n       const defaultImport = j(path).find(j.ImportDefaultSpecifier)\n       if (defaultImport.size() === 0) {\n         return\n@@ -35,17 +35,17 @@ export default function transformer(file: FileInfo, _api: API) {\n           return\n         }\n \n-        const $legacyBehaviorProp = $link\n-          .find(j.JSXAttribute, {\n-            name: { type: 'JSXIdentifier', name: 'legacyBehavior' },\n-          })\n-          .remove()\n+        const $legacyBehaviorProps = $link.find(j.JSXAttribute, {\n+          name: { type: 'JSXIdentifier', name: 'legacyBehavior' },\n+        })\n+        $legacyBehaviorProps.remove()\n+        hasChanges ||= $legacyBehaviorProps.size() > 0\n \n-        $link\n-          .find(j.JSXAttribute, {\n-            name: { type: 'JSXIdentifier', name: 'passHref' },\n-          })\n-          .remove()\n+        const $passHrefProps = $link.find(j.JSXAttribute, {\n+          name: { type: 'JSXIdentifier', name: 'passHref' },\n+        })\n+        $passHrefProps.remove()\n+        hasChanges ||= $passHrefProps.size() > 0\n \n         const linkChildrenNodes = $link.get('children')\n \n@@ -69,7 +69,7 @@ export default function transformer(file: FileInfo, _api: API) {\n         })\n \n         if ($childrenWithA.length === 0) {\n-          if ($legacyBehaviorProp.length > 0) {\n+          if ($legacyBehaviorProps.length > 0) {\n             linkPath.node.children.unshift(\n               j.jsxText('\\n'),\n               j.jsxExpressionContainer.from({\n@@ -82,6 +82,7 @@ export default function transformer(file: FileInfo, _api: API) {\n                 }),\n               })\n             )\n+            hasChanges = true\n           }\n         } else {\n           const props = $childrenWithA.get('attributes').value\n@@ -104,12 +105,19 @@ export default function transformer(file: FileInfo, _api: API) {\n \n             // Remove props from <a>\n             props.length = 0\n+            hasChanges = true\n           }\n \n           const childrenProps = $childrenWithA.get('children')\n           $childrenWithA.replaceWith(childrenProps.value)\n+          hasChanges = true\n         }\n       })\n-    })\n-    .toSource()\n+    }\n+  )\n+\n+  if (hasChanges) {\n+    return $j.toSource()\n+  }\n+  return file.source\n }"
        }
    ],
    "stats": {
        "total": 40,
        "additions": 24,
        "deletions": 16
    }
}