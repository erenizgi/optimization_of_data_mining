{
    "author": "huozhi",
    "message": "[metadata] update metadat docs for streaming metadata (#76282)",
    "sha": "165f9be7824cd599a19e990b74f16a11cf603b4e",
    "files": [
        {
            "sha": "92cd35bb69ebe4f0a33ea9a477955274df767fb4",
            "filename": "docs/01-app/04-api-reference/04-functions/generate-metadata.mdx",
            "status": "modified",
            "additions": 19,
            "deletions": 1,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/165f9be7824cd599a19e990b74f16a11cf603b4e/docs%2F01-app%2F04-api-reference%2F04-functions%2Fgenerate-metadata.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/165f9be7824cd599a19e990b74f16a11cf603b4e/docs%2F01-app%2F04-api-reference%2F04-functions%2Fgenerate-metadata.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F04-api-reference%2F04-functions%2Fgenerate-metadata.mdx?ref=165f9be7824cd599a19e990b74f16a11cf603b4e",
            "patch": "@@ -46,7 +46,6 @@ export async function generateMetadata({ params }) {\n >\n > - The `metadata` object and `generateMetadata` function exports are **only supported in Server Components**.\n > - You cannot export both the `metadata` object and `generateMetadata` function from the same route segment.\n-> - On the initial load, streaming is blocked until `generateMetadata` has fully resolved, including any content from `loading.js`.\n \n ## The `metadata` object\n \n@@ -1198,9 +1197,28 @@ export const metadata = {\n }\n ```\n \n+#### Streaming Metadata\n+\n+Starting from v15.2, metadata returned by `generateMetadata` will be streamed to the client. This allows Next.js to inject metadata into the HTML as soon as it's resolved.\n+\n+Since page metadata often primarily targets bots & crawlers, Next.js will continue to block the render until the metadata is resolved for **HTML-limited bots**.\n+\n+Some bots, like `Googlebot`, can execute JavaScript and are able to inspect the full page DOM, meaning they **don't** require blocking metadata. However, bots like `Twitterbot` **cannot** execute JavaScript while crawling a pageâ€”they fall into the **HTML-limited** category.\n+\n+Next.js automatically detects the user agent of incoming requests to determine whether to serve streaming metadata or fallback to blocking metadata.\n+\n+If you need to customize this list, you can define them manually using the `htmlLimitedBots` option in `next.config.js`. Next.js will ensure user agents matching this regex receive blocking metadata when requesting your web page.\n+\n+```js filename=\"next.config.js\"\n+module.exports = {\n+  htmlLimitedBots: 'MySpecialBot|MyAnotherSpecialBot|SimpleCrawler',\n+}\n+```\n+\n ## Version History\n \n | Version   | Changes                                                                                                                                                 |\n | --------- | ------------------------------------------------------------------------------------------------------------------------------------------------------- |\n+| `v15.2.0` | introduced streaming support to `generateMetadata`.                                                                                                     |\n | `v13.2.0` | `viewport`, `themeColor`, and `colorScheme` deprecated in favor of the [`viewport` configuration](/docs/app/api-reference/functions/generate-viewport). |\n | `v13.2.0` | `metadata` and `generateMetadata` introduced.                                                                                                           |"
        },
        {
            "sha": "3d3e0563b85cec1e2cbc02a53b9ee9a79a42fbd0",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/165f9be7824cd599a19e990b74f16a11cf603b4e/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/165f9be7824cd599a19e990b74f16a11cf603b4e/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=165f9be7824cd599a19e990b74f16a11cf603b4e",
            "patch": "@@ -1069,8 +1069,8 @@ export interface NextConfig extends Record<string, any> {\n   }\n \n   /**\n-   * User agent of bots that should opt-out streaming metadata.\n-   * User agents that pass this regex will block rendering until metadata has resolved, to ensure it's available in the `head` of the document.\n+   * User Agent of bots that can handle streaming metadata.\n+   * Besides the default behavior, Next.js act differently on serving metadata to bots based on their capability.\n    */\n   htmlLimitedBots?: RegExp\n }"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 21,
        "deletions": 3
    }
}