{
    "author": "bgw",
    "message": "Turbopack: Remove unused proxy option in turbo-tasks-fetch, lightly document HTTP_PROXY/HTTPS_PROXY environment variables (#81905)\n\nWe had this proxy option on `turbo-tasks-fetch`, but it was never passed anywhere.\n\nI don't think the option is very useful, because `reqwest` already respects the conventional `HTTP_PROXY`/`HTTPS_PROXY` environment variables by default: https://docs.rs/reqwest/latest/reqwest/#proxies\n\nIt could make sense alongside the new experimental `turbopackUseSystemTlsCerts` option, but `turbopackUseSystemTlsCerts` is a simple boolean, and there's not a lot of harm in setting it to `true`, even if some of your users don't use system TLS certs. In contrast, HTTP proxies are very system-specific, and IMO make a lot more sense as an environment variable, often set in the user's `.profile` or in `/etc/environment`.\n\nSee the manual test plan on #81905 for how to set an HTTP/HTTPS proxy.",
    "sha": "b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b",
    "files": [
        {
            "sha": "08626ad108bf61d19440467ab1c76a5031cd4b83",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b",
            "patch": "@@ -1743,7 +1743,6 @@ impl NextConfig {\n             .or(self.experimental.turbopack_use_system_tls_certs)\n             .unwrap_or(false);\n         Ok(ReqwestClientConfig {\n-            proxy: None,\n             tls_built_in_webpki_certs: !use_system_tls_certs,\n             tls_built_in_native_certs: use_system_tls_certs,\n         }"
        },
        {
            "sha": "6a559c2f41b40e38f8f18bd1cf295c2c7085d4cc",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b",
            "patch": "@@ -480,6 +480,10 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n          *\n          * This option is ignored on Windows on ARM, where the native TLS implementation is always\n          * used.\n+         *\n+         * If you need to set a proxy, Turbopack [respects the common `HTTP_PROXY` and `HTTPS_PROXY`\n+         * environment variable convention](https://docs.rs/reqwest/latest/reqwest/#proxies). HTTP\n+         * proxies are supported, SOCKS proxies are not currently supported.\n          */\n         turbopackUseSystemTlsCerts: z.boolean().optional(),\n         optimizePackageImports: z.array(z.string()).optional(),"
        },
        {
            "sha": "af39f3acdd76e6164ff00d33253d739825b9ce22",
            "filename": "turbopack/crates/turbo-tasks-fetch/src/reqwest_client_cache.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 12,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Fsrc%2Freqwest_client_cache.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Fsrc%2Freqwest_client_cache.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fetch%2Fsrc%2Freqwest_client_cache.rs?ref=b8f43dd7ab625e8185f3c9b7219edcfe143fcf2b",
            "patch": "@@ -25,7 +25,6 @@ pub enum ProxyConfig {\n #[turbo_tasks::value(shared)]\n #[derive(Hash)]\n pub struct ReqwestClientConfig {\n-    pub proxy: Option<ProxyConfig>,\n     /// Whether to load embedded webpki root certs with rustls. Default is true.\n     ///\n     /// Ignored for:\n@@ -44,7 +43,6 @@ pub struct ReqwestClientConfig {\n impl Default for ReqwestClientConfig {\n     fn default() -> Self {\n         Self {\n-            proxy: None,\n             tls_built_in_webpki_certs: true,\n             tls_built_in_native_certs: false,\n         }\n@@ -53,16 +51,7 @@ impl Default for ReqwestClientConfig {\n \n impl ReqwestClientConfig {\n     fn try_build(&self) -> reqwest::Result<reqwest::Client> {\n-        let mut client_builder = reqwest::Client::builder();\n-        match &self.proxy {\n-            Some(ProxyConfig::Http(proxy)) => {\n-                client_builder = client_builder.proxy(reqwest::Proxy::http(proxy.as_str())?)\n-            }\n-            Some(ProxyConfig::Https(proxy)) => {\n-                client_builder = client_builder.proxy(reqwest::Proxy::https(proxy.as_str())?)\n-            }\n-            None => {}\n-        };\n+        let client_builder = reqwest::Client::builder();\n \n         // make sure this cfg matches the one in `Cargo.toml`!\n         #[cfg(not(any("
        }
    ],
    "stats": {
        "total": 18,
        "additions": 5,
        "deletions": 13
    }
}