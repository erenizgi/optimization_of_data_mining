{
    "author": "SyMind",
    "message": "fix(Rspack): use loaderContext.utils.contextify to replace ModuleFilenameHelpers.createFilename (#82104)\n\nCo-authored-by: Sebastian Sebbie Silbermann <sebastian.silbermann@vercel.com>",
    "sha": "29ae22be86bfb2a13bc5c3f5a3d0348398615657",
    "files": [
        {
            "sha": "0cf1ac6d525b70e72c5c75150358091da67e51a0",
            "filename": "packages/next/src/build/webpack/loaders/next-flight-loader/index.ts",
            "status": "modified",
            "additions": 36,
            "deletions": 32,
            "changes": 68,
            "blob_url": "https://github.com/vercel/next.js/blob/29ae22be86bfb2a13bc5c3f5a3d0348398615657/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-flight-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/29ae22be86bfb2a13bc5c3f5a3d0348398615657/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-flight-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-flight-loader%2Findex.ts?ref=29ae22be86bfb2a13bc5c3f5a3d0348398615657",
            "patch": "@@ -1,8 +1,9 @@\n-import type {\n-  javascript,\n-  LoaderContext,\n-  NormalModule,\n-  webpack,\n+import {\n+  ModuleFilenameHelpers,\n+  type javascript,\n+  type LoaderContext,\n+  type NormalModule,\n+  type webpack,\n } from 'next/dist/compiled/webpack/webpack'\n import { RSC_MOD_REF_PROXY_ALIAS } from '../../../../lib/constants'\n import {\n@@ -13,7 +14,6 @@ import { warnOnce } from '../../../../shared/lib/utils/warn-once'\n import { getRSCModuleInformation } from '../../../analysis/get-page-static-info'\n import { formatBarrelOptimizedResource } from '../../utils'\n import { getModuleBuildInfo } from '../get-module-build-info'\n-import { ModuleFilenameHelpers } from 'next/dist/compiled/webpack/webpack'\n \n type SourceType = javascript.JavascriptParser['sourceType'] | 'commonjs'\n \n@@ -148,19 +148,21 @@ ${JSON.stringify(ref)},\n       }\n \n       const compilation = this._compilation!\n-      const originalSourceURL = ModuleFilenameHelpers.createFilename(\n-        module,\n-        {\n-          moduleFilenameTemplate:\n-            'webpack://[namespace]/[resource-path]/__nextjs-internal-proxy.mjs',\n-          namespace: '_N_E',\n-        },\n-        {\n-          requestShortener: compilation.requestShortener,\n-          chunkGraph: compilation.chunkGraph,\n-          hashFunction: compilation.outputOptions.hashFunction,\n-        }\n-      )\n+      const originalSourceURL = process.env.NEXT_RSPACK\n+        ? `webpack://_N_E/${this.utils.contextify(this.context || this.rootContext, this.resourcePath)}/__nextjs-internal-proxy.mjs`\n+        : ModuleFilenameHelpers.createFilename(\n+            module,\n+            {\n+              moduleFilenameTemplate:\n+                'webpack://[namespace]/[resource-path]/__nextjs-internal-proxy.mjs',\n+              namespace: '_N_E',\n+            },\n+            {\n+              requestShortener: compilation.requestShortener,\n+              chunkGraph: compilation.chunkGraph,\n+              hashFunction: compilation.outputOptions.hashFunction,\n+            }\n+          )\n \n       return this.callback(null, esmSource, {\n         version: 3,\n@@ -179,19 +181,21 @@ module.exports = createProxy(${stringifiedResourceKey})\n `\n \n       const compilation = this._compilation!\n-      const originalSourceURL = ModuleFilenameHelpers.createFilename(\n-        module,\n-        {\n-          moduleFilenameTemplate:\n-            'webpack://[namespace]/[resource-path]/__nextjs-internal-proxy.cjs',\n-          namespace: '_N_E',\n-        },\n-        {\n-          requestShortener: compilation.requestShortener,\n-          chunkGraph: compilation.chunkGraph,\n-          hashFunction: compilation.outputOptions.hashFunction,\n-        }\n-      )\n+      const originalSourceURL = process.env.NEXT_RSPACK\n+        ? `webpack://_N_E/${this.utils.contextify(this.context || this.rootContext, this.resourcePath)}/__nextjs-internal-proxy.cjs`\n+        : ModuleFilenameHelpers.createFilename(\n+            module,\n+            {\n+              moduleFilenameTemplate:\n+                'webpack://[namespace]/[resource-path]/__nextjs-internal-proxy.cjs',\n+              namespace: '_N_E',\n+            },\n+            {\n+              requestShortener: compilation.requestShortener,\n+              chunkGraph: compilation.chunkGraph,\n+              hashFunction: compilation.outputOptions.hashFunction,\n+            }\n+          )\n \n       return this.callback(null, cjsSource, {\n         version: 3,"
        },
        {
            "sha": "f9c415181b9d1d89d016641b5404f81d281d3ded",
            "filename": "test/rspack-dev-tests-manifest.json",
            "status": "modified",
            "additions": 1110,
            "deletions": 1158,
            "changes": 2268,
            "blob_url": "https://github.com/vercel/next.js/blob/29ae22be86bfb2a13bc5c3f5a3d0348398615657/test%2Frspack-dev-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/29ae22be86bfb2a13bc5c3f5a3d0348398615657/test%2Frspack-dev-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Frspack-dev-tests-manifest.json?ref=29ae22be86bfb2a13bc5c3f5a3d0348398615657"
        }
    ],
    "stats": {
        "total": 2336,
        "additions": 1146,
        "deletions": 1190
    }
}