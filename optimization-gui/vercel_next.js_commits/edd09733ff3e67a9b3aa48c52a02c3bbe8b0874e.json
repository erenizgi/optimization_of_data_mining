{
    "author": "kdy1",
    "message": "chore(turbopack): Cleanup benchmark code (#79943)\n\n### What?\n\nCleanup code for benchmarking\n\n### Why?\n\n\nhttps://github.com/vercel/next.js/pull/79796#pullrequestreview-2879675461\n\n---------\n\nCo-authored-by: Luke Sandberg <lukesandberg@users.noreply.github.com>",
    "sha": "edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e",
    "files": [
        {
            "sha": "d9ed3e8c52fd39b85b0c78556008ce9a3fdc7bc4",
            "filename": "turbopack/crates/turbopack-cli/benches/small_apps.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e/turbopack%2Fcrates%2Fturbopack-cli%2Fbenches%2Fsmall_apps.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e/turbopack%2Fcrates%2Fturbopack-cli%2Fbenches%2Fsmall_apps.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fbenches%2Fsmall_apps.rs?ref=edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e",
            "patch": "@@ -29,7 +29,7 @@ fn list_apps() -> (PathBuf, Vec<PathBuf>) {\n         let path = entry.path();\n         if path.is_dir() {\n             // Exclude node_modules\n-            if path.file_name().unwrap().to_string_lossy() == \"node_modules\" {\n+            if path.file_name().unwrap_or_default() == \"node_modules\" {\n                 continue;\n             }\n \n@@ -68,7 +68,6 @@ fn bench_small_apps(c: &mut Criterion) {\n                     let app_name = app.file_name().unwrap().to_string_lossy().to_string();\n \n                     rt.block_on(async move {\n-                        //\n                         turbopack_cli::build::build(&BuildArguments {\n                             common: CommonArguments {\n                                 entries: Some(vec![format!(\"{app_name}/index.tsx\")]),"
        },
        {
            "sha": "005d00f979c13d6008838cecb36f8d1a249cc6ad",
            "filename": "turbopack/crates/turbopack-cli/src/build/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs?ref=edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e",
            "patch": "@@ -199,7 +199,7 @@ async fn build_internal(\n     target: Target,\n ) -> Result<Vc<()>> {\n     let output_fs = output_fs(project_dir.clone());\n-    let project_fs = project_fs(root_dir.clone());\n+    let project_fs = project_fs(root_dir.clone(), /* watch= */ false);\n     let project_relative = project_dir.strip_prefix(&*root_dir).unwrap();\n     let project_relative: RcStr = project_relative\n         .strip_prefix(MAIN_SEPARATOR)"
        },
        {
            "sha": "41b5301a3135dc1e9c67b9b085101d0be257c5ba",
            "filename": "turbopack/crates/turbopack-cli/src/dev/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fmod.rs?ref=edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e",
            "patch": "@@ -264,7 +264,7 @@ async fn source(\n         .into();\n \n     let output_fs = output_fs(project_dir);\n-    let fs: Vc<Box<dyn FileSystem>> = project_fs(root_dir);\n+    let fs: Vc<Box<dyn FileSystem>> = project_fs(root_dir, /* watch= */ true);\n     let root_path = fs.root().to_resolved().await?;\n     let project_path = root_path.join(project_relative).to_resolved().await?;\n "
        },
        {
            "sha": "eeca44e5f4e02d37c0d4e02ea4d8b4f3ede9c899",
            "filename": "turbopack/crates/turbopack-cli/src/util.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Futil.rs?ref=edd09733ff3e67a9b3aa48c52a02c3bbe8b0874e",
            "patch": "@@ -60,9 +60,9 @@ pub fn normalize_entries(entries: &Option<Vec<String>>) -> Vec<RcStr> {\n }\n \n #[turbo_tasks::function]\n-pub async fn project_fs(project_dir: RcStr) -> Result<Vc<Box<dyn FileSystem>>> {\n+pub async fn project_fs(project_dir: RcStr, watch: bool) -> Result<Vc<Box<dyn FileSystem>>> {\n     let disk_fs = DiskFileSystem::new(\"project\".into(), project_dir, vec![]);\n-    if cfg!(not(codspeed)) {\n+    if watch {\n         disk_fs.await?.start_watching(None).await?;\n     }\n     Ok(Vc::upcast(disk_fs))"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 5,
        "deletions": 6
    }
}