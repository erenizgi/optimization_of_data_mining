{
    "author": "lukesandberg",
    "message": "[turbopack] Set `liveness` of exports based on assignment analysis (#82802)\n\nUse the analysis added in #82763 to annotate exports as 'live' or 'const' \n\nThis triggers previously implemented support to then bind the resulting values as 'readonly values' instead of getter functions.  This helps with both code size and execution time since parsing/allocating even these tiny getter functions is not free.",
    "sha": "ba227046ef42a8080b1fbe274fe842c0c7067bff",
    "files": [
        {
            "sha": "bcf2709469e9dad6e00fed4d92e8f954fe2f425f",
            "filename": "test/e2e/app-dir/cache-components-errors/cache-components-errors.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -664,7 +664,7 @@ describe('Cache Components Errors', () => {\n             } else {\n               expect(output).toMatchInlineSnapshot(`\n                \"Error: Route \"/dynamic-root\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\n-                   at a (bundler:///app/dynamic-root/indirection.tsx:7:34)\n+                   at <unknown> (bundler:///app/dynamic-root/indirection.tsx:7:34)\n                    at main (<anonymous>)\n                    at body (<anonymous>)\n                    at html (<anonymous>)\n@@ -2080,7 +2080,7 @@ describe('Cache Components Errors', () => {\n               } else {\n                 expect(output).toMatchInlineSnapshot(`\n                  \"Error: Route \"/sync-attribution/guarded-async-unguarded-clientsync\" used \\`new Date()\\` inside a Client Component without a Suspense boundary above it. See more info here: https://nextjs.org/docs/messages/next-prerender-current-time-client\n-                     at a (bundler:///app/sync-attribution/guarded-async-unguarded-clientsync/client.tsx:5:16)\n+                     at <unknown> (bundler:///app/sync-attribution/guarded-async-unguarded-clientsync/client.tsx:5:16)\n                    3 | export function SyncIO() {\n                    4 |   // This is a sync IO access that should not cause an error\n                  > 5 |   const data = new Date().toISOString()\n@@ -2210,12 +2210,9 @@ describe('Cache Components Errors', () => {\n                  \"Error: Route \"/sync-attribution/unguarded-async-guarded-clientsync\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\n                      at a (<anonymous>)\n                      at main (<anonymous>)\n-                     at b (<anonymous>)\n                      at main (<anonymous>)\n                      at body (<anonymous>)\n                      at html (<anonymous>)\n-                     at c (<anonymous>)\n-                     at d (<anonymous>)\n                  To get a more detailed stack trace and pinpoint the issue, try one of the following:\n                    - Start the app in development mode by running \\`next dev\\`, then open \"/sync-attribution/unguarded-async-guarded-clientsync\" in your browser to investigate the error.\n                    - Rerun the production build with \\`next build --debug-prerender\\` to generate better stack traces.\n@@ -2389,7 +2386,7 @@ describe('Cache Components Errors', () => {\n               } else {\n                 expect(output).toMatchInlineSnapshot(`\n                  \"Error: Route \"/sync-attribution/unguarded-async-unguarded-clientsync\" used \\`new Date()\\` inside a Client Component without a Suspense boundary above it. See more info here: https://nextjs.org/docs/messages/next-prerender-current-time-client\n-                     at a (bundler:///app/sync-attribution/unguarded-async-unguarded-clientsync/client.tsx:5:16)\n+                     at <unknown> (bundler:///app/sync-attribution/unguarded-async-unguarded-clientsync/client.tsx:5:16)\n                    3 | export function SyncIO() {\n                    4 |   // This is a sync IO access that should not cause an error\n                  > 5 |   const data = new Date().toISOString()"
        },
        {
            "sha": "ef7fde1ae2743f353e2d2b202e925b440a25a4cd",
            "filename": "test/production/app-dir/build-output-prerender/build-output-prerender.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -105,7 +105,7 @@ describe('build-output-prerender', () => {\n           // TODO(veil): Why is the location incomplete unless we enable --no-mangling?\n           expect(getPrerenderOutput(next.cliOutput)).toMatchInlineSnapshot(`\n            \"Error: Route \"/client\" used \\`new Date()\\` inside a Client Component without a Suspense boundary above it. See more info here: https://nextjs.org/docs/messages/next-prerender-current-time-client\n-               at c (bundler:///app/client/page.tsx:4:28)\n+               at <unknown> (bundler:///app/client/page.tsx:4:28)\n              2 |\n              3 | export default function Page() {\n            > 4 |   return <p>Current time: {new Date().toISOString()}</p>"
        },
        {
            "sha": "6f1b346fc778c83c241844a3365d2da0d9951455",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/export.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -402,7 +402,7 @@ pub async fn expand_star_exports(\n                     if key == \"default\" {\n                         continue;\n                     }\n-                    esm_exports.entry(key.clone()).or_insert_with(|| asset);\n+                    esm_exports.entry(key.clone()).or_insert(asset);\n                 }\n                 for esm_ref in exports.star_exports.iter() {\n                     if let ReferencedAsset::Some(asset) ="
        },
        {
            "sha": "7b6d600f724f50b55eec4ba3d58a2d07e23b2763",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/mod.rs",
            "status": "modified",
            "additions": 67,
            "deletions": 33,
            "changes": 100,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -755,6 +755,7 @@ pub async fn analyse_ecmascript_module_internal(\n                     &import_references,\n                     &mut analysis,\n                     is_tracing,\n+                    &var_graph,\n                 );\n                 // ModuleReferencesVisitor has already called analysis.add_esm_reexport_reference\n                 // for any references in esm_exports\n@@ -3210,6 +3211,7 @@ struct ModuleReferencesVisitor<'a> {\n     webpack_runtime: Option<(RcStr, Span)>,\n     webpack_entry: bool,\n     webpack_chunks: Vec<Lit>,\n+    var_graph: &'a VarGraph,\n }\n \n impl<'a> ModuleReferencesVisitor<'a> {\n@@ -3218,6 +3220,7 @@ impl<'a> ModuleReferencesVisitor<'a> {\n         import_references: &'a [ResolvedVc<EsmAssetReference>],\n         analysis: &'a mut AnalyzeEcmascriptModuleResultBuilder,\n         is_tracing: bool,\n+        var_graph: &'a VarGraph,\n     ) -> Self {\n         Self {\n             is_tracing,\n@@ -3229,6 +3232,28 @@ impl<'a> ModuleReferencesVisitor<'a> {\n             webpack_runtime: None,\n             webpack_entry: false,\n             webpack_chunks: Vec::new(),\n+            var_graph,\n+        }\n+    }\n+}\n+\n+impl<'a> ModuleReferencesVisitor<'a> {\n+    /// Returns true if the given export identifier is considered \"live\".  This means it might\n+    /// change values after module evaluation.\n+    fn is_export_ident_live(&self, id: &Ident) -> bool {\n+        if let Some(crate::analyzer::graph::VarMeta {\n+            value: _,\n+            assignment_scopes: assignment_kinds,\n+        }) = self.var_graph.values.get(&id.to_id())\n+        {\n+            // If all assignments are in module scope, the export is not live.\n+            *assignment_kinds != crate::analyzer::graph::AssignmentScopes::AllInModuleEvalScope\n+        } else {\n+            // If we haven't computed a value for it, that means it might be\n+            // A free variable\n+            // an imported variable\n+            // In those cases, we just assume that the value is live since we don't know anything\n+            true\n         }\n     }\n }\n@@ -3237,10 +3262,10 @@ fn as_parent_path(ast_path: &AstNodePath<AstParentNodeRef<'_>>) -> Vec<AstParent\n     ast_path.iter().map(|n| n.kind()).collect()\n }\n \n-fn for_each_ident_in_pat(pat: &Pat, f: &mut impl FnMut(RcStr)) {\n+fn for_each_ident_in_pat(pat: &Pat, f: &mut impl FnMut(&Ident)) {\n     match pat {\n         Pat::Ident(BindingIdent { id, .. }) => {\n-            f(id.sym.as_str().into());\n+            f(id);\n         }\n         Pat::Array(ArrayPat { elems, .. }) => elems.iter().for_each(|e| {\n             if let Some(e) = e {\n@@ -3256,7 +3281,7 @@ fn for_each_ident_in_pat(pat: &Pat, f: &mut impl FnMut(RcStr)) {\n                     for_each_ident_in_pat(value, f);\n                 }\n                 ObjectPatProp::Assign(AssignPatProp { key, .. }) => {\n-                    f(key.sym.as_str().into());\n+                    f(key);\n                 }\n                 ObjectPatProp::Rest(RestPat { arg, .. }) => {\n                     for_each_ident_in_pat(arg, f);\n@@ -3297,6 +3322,7 @@ impl VisitAstPath for ModuleReferencesVisitor<'_> {\n             .map(find_turbopack_part_id_in_asserts)\n             .is_some();\n \n+        // This is for a statement like `export {a, b as c}` with no `from` clause.\n         if export.src.is_none() {\n             for spec in export.specifiers.iter() {\n                 fn to_rcstr(name: &ModuleExportName) -> RcStr {\n@@ -3337,14 +3363,24 @@ impl VisitAstPath for ModuleReferencesVisitor<'_> {\n                                     EsmExport::ImportedNamespace(ResolvedVc::upcast(esm_ref))\n                                 }\n                             } else {\n+                                let liveness = match orig {\n+                                    ModuleExportName::Ident(ident) => {\n+                                        if self.is_export_ident_live(ident) {\n+                                            Liveness::Live\n+                                        } else {\n+                                            Liveness::Constant\n+                                        }\n+                                    }\n+                                    ModuleExportName::Str(_) => Liveness::Constant,\n+                                };\n+\n                                 EsmExport::LocalBinding(\n                                     binding_name,\n                                     if is_fake_esm {\n+                                        // it is likely that these are not always actually mutable.\n                                         Liveness::Mutable\n                                     } else {\n-                                        // If this is `export {foo} from 'mod'` and `foo` is a const\n-                                        // in mod then we could export as Const here.\n-                                        Liveness::Live\n+                                        liveness\n                                     },\n                                 )\n                             }\n@@ -3369,30 +3405,27 @@ impl VisitAstPath for ModuleReferencesVisitor<'_> {\n     ) {\n         {\n             let decl: &Decl = &export.decl;\n-            let insert_export_binding = &mut |name: RcStr, liveness: Liveness| {\n+            let insert_export_binding = &mut |id: &Ident| {\n+                let liveness = if self.is_export_ident_live(id) {\n+                    Liveness::Live\n+                } else {\n+                    Liveness::Constant\n+                };\n+                let name: RcStr = id.sym.as_str().into();\n                 self.esm_exports\n                     .insert(name.clone(), EsmExport::LocalBinding(name, liveness));\n             };\n             match decl {\n                 Decl::Class(ClassDecl { ident, .. }) | Decl::Fn(FnDecl { ident, .. }) => {\n-                    // TODO: examine whether the value is ever mutated rather than just checking\n-                    // 'const'\n-                    insert_export_binding(ident.sym.as_str().into(), Liveness::Live);\n+                    insert_export_binding(ident);\n                 }\n                 Decl::Var(var_decl) => {\n-                    // TODO: examine whether the value is ever mutated rather than just checking\n-                    // 'const'\n-                    let liveness = match var_decl.kind {\n-                        VarDeclKind::Var => Liveness::Live,\n-                        VarDeclKind::Let => Liveness::Live,\n-                        VarDeclKind::Const => Liveness::Constant,\n-                    };\n-                    let decls = &*var_decl.decls;\n-                    decls.iter().for_each(|VarDeclarator { name, .. }| {\n-                        for_each_ident_in_pat(name, &mut |name| {\n-                            insert_export_binding(name, liveness)\n-                        })\n-                    });\n+                    var_decl\n+                        .decls\n+                        .iter()\n+                        .for_each(|VarDeclarator { name, .. }| {\n+                            for_each_ident_in_pat(name, insert_export_binding);\n+                        });\n                 }\n                 Decl::Using(_) => {\n                     // See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/export#:~:text=You%20cannot%20use%20export%20on%20a%20using%20or%20await%20using%20declaration\n@@ -3440,21 +3473,22 @@ impl VisitAstPath for ModuleReferencesVisitor<'_> {\n     ) {\n         match &export.decl {\n             DefaultDecl::Class(ClassExpr { ident, .. }) | DefaultDecl::Fn(FnExpr { ident, .. }) => {\n-                self.esm_exports.insert(\n-                    rcstr!(\"default\"),\n-                    EsmExport::LocalBinding(\n-                        ident\n-                            .as_ref()\n-                            .map(|i| i.sym.as_str().into())\n-                            .unwrap_or_else(|| magic_identifier::mangle(\"default export\").into()),\n-                        // Default export declarations can only be mutated if they have a name.\n-                        if ident.is_some() {\n+                let export = match ident {\n+                    Some(ident) => EsmExport::LocalBinding(\n+                        ident.sym.as_str().into(),\n+                        if self.is_export_ident_live(ident) {\n                             Liveness::Live\n                         } else {\n                             Liveness::Constant\n                         },\n                     ),\n-                );\n+                    // If there is no name, like `export default function(){}` then it is not live.\n+                    None => EsmExport::LocalBinding(\n+                        magic_identifier::mangle(\"default export\").into(),\n+                        Liveness::Constant,\n+                    ),\n+                };\n+                self.esm_exports.insert(rcstr!(\"default\"), export);\n             }\n             DefaultDecl::TsInterfaceDecl(..) => {\n                 // ignore"
        },
        {
            "sha": "141253f99aa59d480bf17deb85348c60d174fb69",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/locals/module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Flocals%2Fmodule.rs?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -144,10 +144,10 @@ impl EcmascriptChunkPlaceable for EcmascriptModuleLocalsModule {\n                 EsmExport::ImportedBinding(..) | EsmExport::ImportedNamespace(..) => {\n                     // not included in locals module\n                 }\n-                EsmExport::LocalBinding(local_name, mutable) => {\n+                EsmExport::LocalBinding(local_name, liveness) => {\n                     exports.insert(\n                         name.clone(),\n-                        EsmExport::LocalBinding(local_name.clone(), *mutable),\n+                        EsmExport::LocalBinding(local_name.clone(), *liveness),\n                     );\n                 }\n                 EsmExport::Error => {"
        },
        {
            "sha": "68634e55ed9fa266d8ea6eff99c176fd7714f47c",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/exports/live/input/index.js",
            "status": "modified",
            "additions": 26,
            "deletions": 11,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fexports%2Flive%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fexports%2Flive%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fexports%2Flive%2Finput%2Findex.js?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -1,8 +1,5 @@\n+import * as liveDefaultClass from './live_default_class.js'\n import * as liveExports from './live_exports.js'\n-import {\n-  default as liveDefaultClass,\n-  setDefaultClass,\n-} from './live_default_class.js'\n import * as constDefaultExportFunction from './const_default_export_function.js'\n \n it('hoisted declarations are live', () => {\n@@ -12,15 +9,15 @@ it('hoisted declarations are live', () => {\n })\n \n it('default class export declarations are live', () => {\n-  expect(liveDefaultClass.default()).toBe('defaultClass')\n-  setDefaultClass(\n+  expect(liveDefaultClass.default.default()).toBe('defaultClass')\n+  liveDefaultClass.setDefaultClass(\n     class {\n       static default() {\n         return 'patched'\n       }\n     }\n   )\n-  expect(liveDefaultClass.default()).toBe('patched')\n+  expect(liveDefaultClass.default.default()).toBe('patched')\n })\n \n it('default function export declarations are live', () => {\n@@ -36,10 +33,28 @@ it('exported lets are live', () => {\n })\n \n it('exported bindings that are not mutated are not live', () => {\n-  // These should be bound to values, but we don't have the analysis yet\n-  expectGetter(liveExports, 'obviouslyneverMutated')\n-  expectGetter(liveExports, 'neverMutated')\n-  expectGetter(constDefaultExportFunction, 'default')\n+  expect(\n+    Object.getOwnPropertyDescriptor(liveExports, 'obviouslyneverMutated')\n+  ).toEqual({\n+    configurable: false,\n+    enumerable: true,\n+    value: 'obviouslyneverMutated',\n+    writable: false,\n+  })\n+  expect(Object.getOwnPropertyDescriptor(liveExports, 'neverMutated')).toEqual({\n+    configurable: false,\n+    enumerable: true,\n+    value: 'neverMutated',\n+    writable: false,\n+  })\n+  expect(\n+    Object.getOwnPropertyDescriptor(constDefaultExportFunction, 'default')\n+  ).toEqual({\n+    configurable: false,\n+    enumerable: true,\n+    value: constDefaultExportFunction.default,\n+    writable: false,\n+  })\n })\n \n it('exported bindings that are free vars are live', () => {"
        },
        {
            "sha": "038a58cc16e337503f5220ab8705bd5116284bc2",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/index.js",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Finput%2Findex.js?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -1,3 +1,6 @@\n-import { local } from 'lib'\n+import { local, namedFunction, default as defaultFunction } from 'lib'\n \n local()\n+namedFunction()\n+\n+defaultFunction()"
        },
        {
            "sha": "a1d5e7c1761f9e5f7219e6b2e1e00bc09a3eb7dc",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/node_modules/lib/index.js",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Finput%2Fnode_modules%2Flib%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Finput%2Fnode_modules%2Flib%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Finput%2Fnode_modules%2Flib%2Findex.js?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -9,3 +9,7 @@ function localUnused() {\n }\n \n export { local, localUnused }\n+\n+export function namedFunction() {}\n+\n+export default function defaultFunction() {}"
        },
        {
            "sha": "7475c357ad9131344788a6c02e304e63ef2681ec",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/output/bf321_tests_snapshot_intermediate-tree-shake_reexport-with-locals_input_328b13f8._.js",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Foutput%2Fbf321_tests_snapshot_intermediate-tree-shake_reexport-with-locals_input_328b13f8._.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Foutput%2Fbf321_tests_snapshot_intermediate-tree-shake_reexport-with-locals_input_328b13f8._.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Foutput%2Fbf321_tests_snapshot_intermediate-tree-shake_reexport-with-locals_input_328b13f8._.js?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -5,6 +5,8 @@\n var __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$intermediate$2d$tree$2d$shake$2f$reexport$2d$with$2d$locals$2f$input$2f$node_modules$2f$lib$2f$index$2e$js__$5b$test$5d$__$28$ecmascript$29$__$3c$locals$3e$__ = __turbopack_context__.i(\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/node_modules/lib/index.js [test] (ecmascript) <locals>\");\n ;\n (0, __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$intermediate$2d$tree$2d$shake$2f$reexport$2d$with$2d$locals$2f$input$2f$node_modules$2f$lib$2f$index$2e$js__$5b$test$5d$__$28$ecmascript$29$__$3c$locals$3e$__[\"local\"])();\n+(0, __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$intermediate$2d$tree$2d$shake$2f$reexport$2d$with$2d$locals$2f$input$2f$node_modules$2f$lib$2f$index$2e$js__$5b$test$5d$__$28$ecmascript$29$__$3c$locals$3e$__[\"namedFunction\"])();\n+(0, __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$intermediate$2d$tree$2d$shake$2f$reexport$2d$with$2d$locals$2f$input$2f$node_modules$2f$lib$2f$index$2e$js__$5b$test$5d$__$28$ecmascript$29$__$3c$locals$3e$__[\"default\"])();\n __turbopack_context__.s([]);\n }),\n \"[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/node_modules/lib/unused.js [test] (ecmascript)\", ((__turbopack_context__) => {\n@@ -33,9 +35,18 @@ function localUnused() {\n     console.log('This is a local unused function');\n }\n ;\n+function namedFunction() {}\n+function defaultFunction() {}\n __turbopack_context__.s([\n+    \"default\",\n+    0,\n+    defaultFunction,\n     \"local\",\n-    ()=>local\n+    0,\n+    local,\n+    \"namedFunction\",\n+    0,\n+    namedFunction\n ]);\n }),\n ]);"
        },
        {
            "sha": "862cb64332175435ecddd5d09d5af8835a804f0d",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/output/bf321_tests_snapshot_intermediate-tree-shake_reexport-with-locals_input_328b13f8._.js.map",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Foutput%2Fbf321_tests_snapshot_intermediate-tree-shake_reexport-with-locals_input_328b13f8._.js.map",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Foutput%2Fbf321_tests_snapshot_intermediate-tree-shake_reexport-with-locals_input_328b13f8._.js.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Freexport-with-locals%2Foutput%2Fbf321_tests_snapshot_intermediate-tree-shake_reexport-with-locals_input_328b13f8._.js.map?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -2,8 +2,8 @@\n   \"version\": 3,\n   \"sources\": [],\n   \"sections\": [\n-    {\"offset\": {\"line\": 4, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/index.js\"],\"sourcesContent\":[\"import { local } from 'lib'\\n\\nlocal()\\n\"],\"names\":[],\"mappings\":\"AAAA;;AAEA,IAAA,yRAAK\"}},\n-    {\"offset\": {\"line\": 12, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/node_modules/lib/unused.js\"],\"sourcesContent\":[\"export function unusedStar() {}\\n\"],\"names\":[],\"mappings\":\"AAAO,SAAS,cAAc\",\"ignoreList\":[0]}},\n-    {\"offset\": {\"line\": 18, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/node_modules/lib/unused-star.js\"],\"sourcesContent\":[\"export function unused() {}\\n\"],\"names\":[],\"mappings\":\"AAAO,SAAS,UAAU\",\"ignoreList\":[0]}},\n-    {\"offset\": {\"line\": 24, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/node_modules/lib/index.js\"],\"sourcesContent\":[\"export { unused } from './unused.js'\\nexport * from './unused-star.js'\\n\\nfunction local() {\\n  console.log('This is a local function')\\n}\\nfunction localUnused() {\\n  console.log('This is a local unused function')\\n}\\n\\nexport { local, localUnused }\\n\"],\"names\":[],\"mappings\":\"AAAA;AACA;;;AAEA,SAAS;IACP,QAAQ,GAAG,CAAC;AACd;AACA,SAAS;IACP,QAAQ,GAAG,CAAC;AACd\",\"ignoreList\":[0]}}]\n+    {\"offset\": {\"line\": 4, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/index.js\"],\"sourcesContent\":[\"import { local, namedFunction, default as defaultFunction } from 'lib'\\n\\nlocal()\\nnamedFunction()\\n\\ndefaultFunction()\\n\"],\"names\":[],\"mappings\":\"AAAA;;AAEA,IAAA,yRAAK;AACL,IAAA,iSAAa;AAEb,IAAA,2RAAe\"}},\n+    {\"offset\": {\"line\": 14, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/node_modules/lib/unused.js\"],\"sourcesContent\":[\"export function unusedStar() {}\\n\"],\"names\":[],\"mappings\":\"AAAO,SAAS,cAAc\",\"ignoreList\":[0]}},\n+    {\"offset\": {\"line\": 20, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/node_modules/lib/unused-star.js\"],\"sourcesContent\":[\"export function unused() {}\\n\"],\"names\":[],\"mappings\":\"AAAO,SAAS,UAAU\",\"ignoreList\":[0]}},\n+    {\"offset\": {\"line\": 26, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/reexport-with-locals/input/node_modules/lib/index.js\"],\"sourcesContent\":[\"export { unused } from './unused.js'\\nexport * from './unused-star.js'\\n\\nfunction local() {\\n  console.log('This is a local function')\\n}\\nfunction localUnused() {\\n  console.log('This is a local unused function')\\n}\\n\\nexport { local, localUnused }\\n\\nexport function namedFunction() {}\\n\\nexport default function defaultFunction() {}\\n\"],\"names\":[],\"mappings\":\"AAAA;AACA;;;AAEA,SAAS;IACP,QAAQ,GAAG,CAAC;AACd;AACA,SAAS;IACP,QAAQ,GAAG,CAAC;AACd;;AAIO,SAAS,iBAAiB;AAElB,SAAS,mBAAmB\",\"ignoreList\":[0]}}]\n }\n\\ No newline at end of file"
        },
        {
            "sha": "57beb46ea9db0aa04e7d9fd39246b03649fb3e46",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/intermediate-tree-shake/tree-shake-test-1/output/bf321_tests_snapshot_intermediate-tree-shake_tree-shake-test-1_input_c88ec7da._.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Ftree-shake-test-1%2Foutput%2Fbf321_tests_snapshot_intermediate-tree-shake_tree-shake-test-1_input_c88ec7da._.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ba227046ef42a8080b1fbe274fe842c0c7067bff/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Ftree-shake-test-1%2Foutput%2Fbf321_tests_snapshot_intermediate-tree-shake_tree-shake-test-1_input_c88ec7da._.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fintermediate-tree-shake%2Ftree-shake-test-1%2Foutput%2Fbf321_tests_snapshot_intermediate-tree-shake_tree-shake-test-1_input_c88ec7da._.js?ref=ba227046ef42a8080b1fbe274fe842c0c7067bff",
            "patch": "@@ -23,7 +23,8 @@ function getDog() {\n }\n __turbopack_context__.s([\n     \"getCat\",\n-    ()=>getCat\n+    0,\n+    getCat\n ]);\n }),\n ]);"
        }
    ],
    "stats": {
        "total": 187,
        "additions": 126,
        "deletions": 61
    }
}