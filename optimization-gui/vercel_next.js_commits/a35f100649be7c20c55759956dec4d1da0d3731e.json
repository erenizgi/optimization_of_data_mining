{
    "author": "mischnic",
    "message": "Add `run-turbopack-compiler` trace span (#81917)\n\nAdd a span to `.next/trace` for Turbopack just as there is for Webpack\n\nThis span is consistently ~400ms longer than the `Compiled successfully in X ms` message though, due to the worker startup. With the worker disabled, it's accurate within 10ms.\n\n<img width=\"2560\" height=\"349\" alt=\"Bildschirmfoto 2025-07-22 um 11 27 52\" src=\"https://github.com/user-attachments/assets/4c12198c-02dd-4075-97a9-13342976ac41\" />",
    "sha": "a35f100649be7c20c55759956dec4d1da0d3731e",
    "files": [
        {
            "sha": "312544f55e30f4b154ff0c96bea7616bc8f3dd47",
            "filename": "packages/next/src/build/turbopack-build/index.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 6,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/a35f100649be7c20c55759956dec4d1da0d3731e/packages%2Fnext%2Fsrc%2Fbuild%2Fturbopack-build%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a35f100649be7c20c55759956dec4d1da0d3731e/packages%2Fnext%2Fsrc%2Fbuild%2Fturbopack-build%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fturbopack-build%2Findex.ts?ref=a35f100649be7c20c55759956dec4d1da0d3731e",
            "patch": "@@ -51,10 +51,16 @@ async function turbopackBuildWithWorker() {\n export function turbopackBuild(\n   withWorker: boolean\n ): ReturnType<typeof import('./impl').turbopackBuild> {\n-  if (withWorker) {\n-    return turbopackBuildWithWorker()\n-  } else {\n-    const build = (require('./impl') as typeof import('./impl')).turbopackBuild\n-    return build()\n-  }\n+  const nextBuildSpan = NextBuildContext.nextBuildSpan!\n+  return nextBuildSpan\n+    .traceChild('run-turbopack-compiler')\n+    .traceAsyncFn(async () => {\n+      if (withWorker) {\n+        return await turbopackBuildWithWorker()\n+      } else {\n+        const build = (require('./impl') as typeof import('./impl'))\n+          .turbopackBuild\n+        return await build()\n+      }\n+    })\n }"
        },
        {
            "sha": "c2602a0b4700825f96d06bb8c10de979295d6ca2",
            "filename": "packages/next/src/trace/trace-uploader.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a35f100649be7c20c55759956dec4d1da0d3731e/packages%2Fnext%2Fsrc%2Ftrace%2Ftrace-uploader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a35f100649be7c20c55759956dec4d1da0d3731e/packages%2Fnext%2Fsrc%2Ftrace%2Ftrace-uploader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Ftrace%2Ftrace-uploader.ts?ref=a35f100649be7c20c55759956dec4d1da0d3731e",
            "patch": "@@ -28,6 +28,7 @@ const DEV_ALLOWED_EVENTS = new Set([\n const BUILD_ALLOWED_EVENTS = new Set([\n   ...COMMON_ALLOWED_EVENTS,\n   'next-build',\n+  'run-turbopack-compiler',\n   'webpack-compilation',\n   'run-webpack-compiler',\n   'create-entrypoints',"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 13,
        "deletions": 6
    }
}