{
    "author": "wbinnssmith",
    "message": "Update test snapshots for alternative bundler [4/n] (#76578)\n\nTest Plan: `pnpm test-dev-rspack\ntest/development/acceptance/server-component-compiler-errors-in-pages.test.ts`\npasses",
    "sha": "d26716bb80909a502f5cfb00021c735b177b3fd0",
    "files": [
        {
            "sha": "d7c62bbb293b862d90e8229c1b08e11fb3d9df3c",
            "filename": "test/development/acceptance/server-component-compiler-errors-in-pages.test.ts",
            "status": "modified",
            "additions": 111,
            "deletions": 46,
            "changes": 157,
            "blob_url": "https://github.com/vercel/next.js/blob/d26716bb80909a502f5cfb00021c735b177b3fd0/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d26716bb80909a502f5cfb00021c735b177b3fd0/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts?ref=d26716bb80909a502f5cfb00021c735b177b3fd0",
            "patch": "@@ -3,6 +3,8 @@ import { nextTestSetup } from 'e2e-utils'\n import { createSandbox } from 'development-sandbox'\n import { outdent } from 'outdent'\n \n+const isRspack = process.env.NEXT_RSPACK !== undefined\n+\n const initialFiles = new Map([\n   ['app/_.js', ''], // app dir need to exists, otherwise the SWC RSC checks will not run\n   [\n@@ -62,25 +64,46 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n \n        You're importing a component that needs \"next/headers\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n       `)\n+    } else if (isRspack) {\n+      expect(\n+        takeUpToString(\n+          next.normalizeTestDirContent(await session.getRedboxSource()),\n+          '----'\n+        )\n+      ).toMatchInlineSnapshot(`\n+       \"./components/Comp.js\n+         × Module build failed:\n+         ╰─▶   × Error:   x You're importing a component that needs \"next/headers\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-\n+               │   | your-application/rendering/server-components\n+               │   |\n+               │   |\n+               │    ,-[1:1]\n+               │  1 | import { cookies } from 'next/headers'\n+               │    : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+               │  2 |\n+               │  3 | export default function Page() {\n+               │  4 |   return <p>hello world</p>\n+               │    \\`----\"\n+      `)\n     } else {\n       expect(next.normalizeTestDirContent(await session.getRedboxSource()))\n         .toMatchInlineSnapshot(`\n-        \"./components/Comp.js\n-        Error:   x You're importing a component that needs \"next/headers\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-\n-          | your-application/rendering/server-components\n-          | \n-          | \n-           ,-[1:1]\n-         1 | import { cookies } from 'next/headers'\n-           : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-         2 | \n-         3 | export default function Page() {\n-         4 |   return <p>hello world</p>\n-           \\`----\n-\n-        Import trace for requested module:\n-        ./components/Comp.js\n-        ./pages/index.js\"\n+       \"./components/Comp.js\n+       Error:   x You're importing a component that needs \"next/headers\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-\n+         | your-application/rendering/server-components\n+         | \n+         | \n+          ,-[1:1]\n+        1 | import { cookies } from 'next/headers'\n+          : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+        2 | \n+        3 | export default function Page() {\n+        4 |   return <p>hello world</p>\n+          \\`----\n+\n+       Import trace for requested module:\n+       ./components/Comp.js\n+       ./pages/index.js\"\n       `)\n     }\n   })\n@@ -118,28 +141,49 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n \n        You're importing a component that needs \"server-only\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n       `)\n+    } else if (isRspack) {\n+      expect(\n+        takeUpToString(\n+          next.normalizeTestDirContent(await session.getRedboxSource()),\n+          '----'\n+        )\n+      ).toMatchInlineSnapshot(`\n+       \"./components/Comp.js\n+         × Module build failed:\n+         ╰─▶   × Error:   x You're importing a component that needs \"server-only\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-\n+               │   | application/rendering/server-components\n+               │   |\n+               │   |\n+               │    ,-[1:1]\n+               │  1 | import 'server-only'\n+               │    : ^^^^^^^^^^^^^^^^^^^^\n+               │  2 |\n+               │  3 | export default function Page() {\n+               │  4 |   return 'hello world'\n+               │    \\`----\"\n+      `)\n     } else {\n       expect(\n         takeUpToString(\n           next.normalizeTestDirContent(await session.getRedboxSource()),\n           'Import trace for requested module:'\n         )\n       ).toMatchInlineSnapshot(`\n-        \"./components/Comp.js\n-        Error:   x You're importing a component that needs \"server-only\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-\n-          | application/rendering/server-components\n-          | \n-          | \n-           ,-[1:1]\n-         1 | import 'server-only'\n-           : ^^^^^^^^^^^^^^^^^^^^\n-         2 | \n-         3 | export default function Page() {\n-         4 |   return 'hello world'\n-           \\`----\n-\n-        Import trace for requested module:\"\n-        `)\n+       \"./components/Comp.js\n+       Error:   x You're importing a component that needs \"server-only\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-\n+         | application/rendering/server-components\n+         | \n+         | \n+          ,-[1:1]\n+        1 | import 'server-only'\n+          : ^^^^^^^^^^^^^^^^^^^^\n+        2 | \n+        3 | export default function Page() {\n+        4 |   return 'hello world'\n+          \\`----\n+\n+       Import trace for requested module:\"\n+      `)\n     }\n   })\n \n@@ -176,27 +220,48 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n \n        You're importing a component that needs \"after\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\"\n       `)\n+    } else if (isRspack) {\n+      expect(\n+        takeUpToString(\n+          next.normalizeTestDirContent(await session.getRedboxSource()),\n+          '----'\n+        )\n+      ).toMatchInlineSnapshot(`\n+       \"./components/Comp.js\n+         × Module build failed:\n+         ╰─▶   × Error:   x You're importing a component that needs \"after\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-\n+               │   | application/rendering/server-components\n+               │   |\n+               │   |\n+               │    ,-[1:1]\n+               │  1 | import { after } from 'next/server'\n+               │    :          ^^^^^\n+               │  2 |\n+               │  3 | export default function Page() {\n+               │  4 |   return 'hello world'\n+               │    \\`----\"\n+      `)\n     } else {\n       expect(\n         takeUpToString(\n           next.normalizeTestDirContent(await session.getRedboxSource()),\n           'Import trace for requested module:'\n         )\n       ).toMatchInlineSnapshot(`\n-        \"./components/Comp.js\n-        Error:   x You're importing a component that needs \"after\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-\n-          | application/rendering/server-components\n-          | \n-          | \n-           ,-[1:1]\n-         1 | import { after } from 'next/server'\n-           :          ^^^^^\n-         2 | \n-         3 | export default function Page() {\n-         4 |   return 'hello world'\n-           \\`----\n-\n-        Import trace for requested module:\"\n+       \"./components/Comp.js\n+       Error:   x You're importing a component that needs \"after\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-\n+         | application/rendering/server-components\n+         | \n+         | \n+          ,-[1:1]\n+        1 | import { after } from 'next/server'\n+          :          ^^^^^\n+        2 | \n+        3 | export default function Page() {\n+        4 |   return 'hello world'\n+          \\`----\n+\n+       Import trace for requested module:\"\n       `)\n     }\n   })\n@@ -241,7 +306,7 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n         'components/Comp.js',\n         outdent`\n           import { ${api} } from 'next/cache'\n-  \n+\n           export default function Page() {\n             return 'hello world'\n           }"
        }
    ],
    "stats": {
        "total": 157,
        "additions": 111,
        "deletions": 46
    }
}