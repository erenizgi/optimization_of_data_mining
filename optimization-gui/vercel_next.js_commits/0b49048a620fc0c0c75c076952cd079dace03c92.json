{
    "author": "eps1lon",
    "message": "[test] Use new Redbox matchers in pages/ ReactRefreshLogBox-builtins (#76392)",
    "sha": "0b49048a620fc0c0c75c076952cd079dace03c92",
    "files": [
        {
            "sha": "988cada83d5405198ffc6884983d400ce181cc0b",
            "filename": "test/development/acceptance/ReactRefreshLogBox-builtins.test.ts",
            "status": "modified",
            "additions": 92,
            "deletions": 88,
            "changes": 180,
            "blob_url": "https://github.com/vercel/next.js/blob/0b49048a620fc0c0c75c076952cd079dace03c92/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox-builtins.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0b49048a620fc0c0c75c076952cd079dace03c92/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox-builtins.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox-builtins.test.ts?ref=0b49048a620fc0c0c75c076952cd079dace03c92",
            "patch": "@@ -1,11 +1,10 @@\n import { createSandbox } from 'development-sandbox'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n-import { describeVariants as describe } from 'next-test-utils'\n import { outdent } from 'outdent'\n import path from 'path'\n \n-describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n-  const { next } = nextTestSetup({\n+describe('ReactRefreshLogBox', () => {\n+  const { isTurbopack, next } = nextTestSetup({\n     files: new FileRef(path.join(__dirname, 'fixtures', 'default-template')),\n     skipStart: true,\n   })\n@@ -33,7 +32,7 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n         ],\n       ])\n     )\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n     await session.patch(\n       'index.js',\n       outdent`\n@@ -44,37 +43,41 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n         }\n       `\n     )\n-    await session.assertHasRedbox()\n-    if (process.env.TURBOPACK) {\n-      expect(await session.getRedboxSource()).toMatchInlineSnapshot(`\n-       \"./node_modules/my-package/index.js (1:13)\n+\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Module not found: Can't resolve 'dns'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./node_modules/my-package/index.js (1:13)\n        Module not found: Can't resolve 'dns'\n        > 1 | const dns = require('dns')\n-           |             ^^^^^^^^^^^^^^\n-         2 | module.exports = dns\n-\n-       https://nextjs.org/docs/messages/module-not-found\"\n+           |             ^^^^^^^^^^^^^^\",\n+         \"stack\": [],\n+       }\n       `)\n     } else {\n-      expect(await session.getRedboxSource()).toMatchInlineSnapshot(`\n-       \"./node_modules/my-package/index.js (1:1)\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Module not found: Can't resolve 'dns'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./node_modules/my-package/index.js (1:1)\n        Module not found: Can't resolve 'dns'\n        > 1 | const dns = require('dns')\n-           | ^\n-         2 | module.exports = dns\n-\n-       https://nextjs.org/docs/messages/module-not-found\n-\n-       Import trace for requested module:\n-       ./index.js\n-       ./pages/index.js\"\n+           | ^\",\n+         \"stack\": [],\n+       }\n       `)\n     }\n   })\n \n   test('Module not found', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     await session.patch(\n       'index.js',\n@@ -91,42 +94,40 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n       `\n     )\n \n-    await session.assertHasRedbox()\n-\n-    const source = await session.getRedboxSource()\n-    if (process.env.TURBOPACK) {\n-      expect(source).toMatchInlineSnapshot(`\n-       \"./index.js (1:1)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Module not found: Can't resolve 'b'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js (1:1)\n        Module not found: Can't resolve 'b'\n        > 1 | import Comp from 'b'\n-           | ^^^^^^^^^^^^^^^^^^^^\n-         2 |\n-         3 | export default function Oops() {\n-         4 |   return (\n-\n-       https://nextjs.org/docs/messages/module-not-found\"\n+           | ^^^^^^^^^^^^^^^^^^^^\",\n+         \"stack\": [],\n+       }\n       `)\n     } else {\n-      expect(source).toMatchInlineSnapshot(`\n-       \"./index.js (1:1)\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Module not found: Can't resolve 'b'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js (1:1)\n        Module not found: Can't resolve 'b'\n        > 1 | import Comp from 'b'\n-           | ^\n-         2 |\n-         3 | export default function Oops() {\n-         4 |   return (\n-\n-       https://nextjs.org/docs/messages/module-not-found\n-\n-       Import trace for requested module:\n-       ./pages/index.js\"\n+           | ^\",\n+         \"stack\": [],\n+       }\n       `)\n     }\n   })\n \n   test('Module not found (empty import trace)', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     await session.patch(\n       'pages/index.js',\n@@ -143,32 +144,33 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n       `\n     )\n \n-    await session.assertHasRedbox()\n-\n-    const source = await session.getRedboxSource()\n-    if (process.env.TURBOPACK) {\n-      expect(source).toMatchInlineSnapshot(`\n-       \"./pages/index.js (1:1)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Module not found: Can't resolve 'b'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./pages/index.js (1:1)\n        Module not found: Can't resolve 'b'\n        > 1 | import Comp from 'b'\n-           | ^^^^^^^^^^^^^^^^^^^^\n-         2 |\n-         3 | export default function Oops() {\n-         4 |   return (\n-\n-       https://nextjs.org/docs/messages/module-not-found\"\n+           | ^^^^^^^^^^^^^^^^^^^^\",\n+         \"stack\": [],\n+       }\n       `)\n     } else {\n-      expect(source).toMatchInlineSnapshot(`\n-       \"./pages/index.js (1:1)\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Module not found: Can't resolve 'b'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./pages/index.js (1:1)\n        Module not found: Can't resolve 'b'\n        > 1 | import Comp from 'b'\n-           | ^\n-         2 |\n-         3 | export default function Oops() {\n-         4 |   return (\n-\n-       https://nextjs.org/docs/messages/module-not-found\"\n+           | ^\",\n+         \"stack\": [],\n+       }\n       `)\n     }\n   })\n@@ -197,33 +199,35 @@ describe.each(['default', 'turbo'])('ReactRefreshLogBox %s', () => {\n         ],\n       ])\n     )\n-    const { session } = sandbox\n-    await session.assertHasRedbox()\n-\n-    const source = await session.getRedboxSource()\n-    if (process.env.TURBOPACK) {\n-      expect(source).toMatchInlineSnapshot(`\n-       \"./pages/_app.js (1:1)\n+    const { browser, session } = sandbox\n+\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Module not found: Can't resolve './non-existent.css'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./pages/_app.js (1:1)\n        Module not found: Can't resolve './non-existent.css'\n        > 1 | import './non-existent.css'\n-           | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\n-         2 |\n-         3 | export default function App({ Component, pageProps }) {\n-         4 |   return <Component {...pageProps} />\n-\n-       https://nextjs.org/docs/messages/module-not-found\"\n+           | ^^^^^^^^^^^^^^^^^^^^^^^^^^^\",\n+         \"stack\": [],\n+       }\n       `)\n     } else {\n-      expect(source).toMatchInlineSnapshot(`\n-       \"./pages/_app.js (1:1)\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Module not found: Can't resolve './non-existent.css'\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./pages/_app.js (1:1)\n        Module not found: Can't resolve './non-existent.css'\n        > 1 | import './non-existent.css'\n-           | ^\n-         2 |\n-         3 | export default function App({ Component, pageProps }) {\n-         4 |   return <Component {...pageProps} />\n-\n-       https://nextjs.org/docs/messages/module-not-found\"\n+           | ^\",\n+         \"stack\": [],\n+       }\n       `)\n     }\n "
        }
    ],
    "stats": {
        "total": 180,
        "additions": 92,
        "deletions": 88
    }
}