{
    "author": "ijjk",
    "message": "Avoid bundling dev overlay in page template (#79641)\n\nAs noticed in https://github.com/vercel/next.js/pull/79632 we increased\ncompile times for pages routes in development which is due to us\nincluding the dev-overlay component in the page bundle itself instead of\njust in the server runtime.\n\nx-ref: https://github.com/vercel/next.js/pull/79632/files\n\n<details>\n\n<summary>Before</summary>\n\n```sh\n✓ Compiled /_error in 1238ms (1385 modules)\n✓ Compiled /_error in 1245ms (1386 modules)\n✓ Compiled /_error in 1225ms (1394 modules)\n✓ Compiled /_error in 944ms (1385 modules)\n✓ Compiled /_error in 1232ms (1385 modules)\n```\n\n</details>\n\n<details>\n\n<summary>After</summary>\n\n```sh\n ✓ Compiled /_error in 927ms (1009 modules)\n ✓ Compiled /_error in 922ms (1010 modules)\n ✓ Compiled /_error in 935ms (1018 modules)\n ✓ Compiled /_error in 626ms (1009 modules)\n ✓ Compiled /_error in 916ms (1009 modules)\n```\n\n</details>",
    "sha": "97c9fc485a03bd0067c13683bb8e8bc4d7a3be81",
    "files": [
        {
            "sha": "9c8d28bb41f24a567a75383b3facff7c90c08fca",
            "filename": "packages/next/src/build/templates/pages.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 11,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/97c9fc485a03bd0067c13683bb8e8bc4d7a3be81/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fpages.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/97c9fc485a03bd0067c13683bb8e8bc4d7a3be81/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fpages.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fpages.ts?ref=97c9fc485a03bd0067c13683bb8e8bc4d7a3be81",
            "patch": "@@ -161,16 +161,6 @@ export async function handler(\n     const publicRuntimeConfig: Record<string, string> =\n       routerServerContext?.publicRuntimeConfig || nextConfig.publicRuntimeConfig\n \n-    let ErrorDebug: any\n-\n-    if (process.env.NODE_ENV === 'development') {\n-      ErrorDebug = (props: any) => {\n-        const ReactDevOverlayImpl =\n-          require('next/dist/client/components/react-dev-overlay/pages/pages-dev-overlay').PagesDevOverlay\n-        return ReactDevOverlayImpl(props)\n-      }\n-    }\n-\n     const invokeRouteModule = async (span?: Span) =>\n       routeModule\n         .render(req, res, {\n@@ -277,7 +267,7 @@ export async function handler(\n \n             isOnDemandRevalidate,\n \n-            ErrorDebug,\n+            ErrorDebug: getRequestMeta(req, 'PagesErrorDebug'),\n             err: getRequestMeta(req, 'invokeError'),\n             dev: routeModule.isDev,\n "
        },
        {
            "sha": "94b6043d8825a398edeec7eec8020f3a119db966",
            "filename": "packages/next/src/server/dev/next-dev-server.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/97c9fc485a03bd0067c13683bb8e8bc4d7a3be81/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/97c9fc485a03bd0067c13683bb8e8bc4d7a3be81/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fnext-dev-server.ts?ref=97c9fc485a03bd0067c13683bb8e8bc4d7a3be81",
            "patch": "@@ -9,6 +9,7 @@ import type { MiddlewareRoutingItem } from '../base-server'\n import type { RouteDefinition } from '../route-definitions/route-definition'\n import type { RouteMatcherManager } from '../route-matcher-managers/route-matcher-manager'\n import {\n+  addRequestMeta,\n   getRequestMeta,\n   type NextParsedUrlQuery,\n   type NextUrlWithParsedQuery,\n@@ -542,6 +543,7 @@ export default class DevServer extends Server {\n     const span = trace('handle-request', undefined, { url: req.url })\n     const result = await span.traceAsyncFn(async () => {\n       await this.ready?.promise\n+      addRequestMeta(req, 'PagesErrorDebug', this.renderOpts.ErrorDebug)\n       return await super.handleRequest(req, res, parsedUrl)\n     })\n     const memoryUsage = process.memoryUsage()"
        },
        {
            "sha": "bb0138cf73557b28d6fd8bd25c22591c163edb08",
            "filename": "packages/next/src/server/request-meta.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/97c9fc485a03bd0067c13683bb8e8bc4d7a3be81/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/97c9fc485a03bd0067c13683bb8e8bc4d7a3be81/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest-meta.ts?ref=97c9fc485a03bd0067c13683bb8e8bc4d7a3be81",
            "patch": "@@ -7,6 +7,7 @@ import type { CloneableBody } from './body-streams'\n import type { RouteMatch } from './route-matches/route-match'\n import type { NEXT_RSC_UNION_QUERY } from '../client/components/app-router-headers'\n import type { ServerComponentsHmrCache } from './response-cache'\n+import type { PagesDevOverlayType } from '../client/components/react-dev-overlay/pages/pages-dev-overlay'\n \n // FIXME: (wyattjoh) this is a temporary solution to allow us to pass data between bundled modules\n export const NEXT_REQUEST_META = Symbol.for('NextInternalRequestMeta')\n@@ -208,6 +209,11 @@ export interface RequestMeta {\n    * The AMP validator to use in development\n    */\n   ampValidator?: (html: string, pathname: string) => Promise<void>\n+\n+  /**\n+   * ErrorOverlay component to use in development for pages router\n+   */\n+  PagesErrorDebug?: PagesDevOverlayType\n }\n \n /**"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 9,
        "deletions": 11
    }
}