{
    "author": "wbinnssmith",
    "message": "Turbopack: Make `turbo-rcstr` crate Rust 2024 (#79124)\n\nThis required explicitly wrapping certain calls in `unsafe` blocks. The\ncalling functions were already marked `unsafe`.",
    "sha": "9156b3b25bcdd74b4dee58eede731ba895c9e0d9",
    "files": [
        {
            "sha": "aa634a48d83d461d71eb91118159451101c25883",
            "filename": "turbopack/crates/turbo-rcstr/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-rcstr%2FCargo.toml?ref=9156b3b25bcdd74b4dee58eede731ba895c9e0d9",
            "patch": "@@ -1,7 +1,7 @@\n [package]\n name = \"turbo-rcstr\"\n version = \"0.1.0\"\n-edition = \"2021\"\n+edition = \"2024\"\n license = \"MIT\"\n \n [features]"
        },
        {
            "sha": "9aef9512d813ebd8ff1e963ad23d1246d52813e3",
            "filename": "turbopack/crates/turbo-rcstr/benches/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2Fbenches%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2Fbenches%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-rcstr%2Fbenches%2Fmod.rs?ref=9156b3b25bcdd74b4dee58eede731ba895c9e0d9",
            "patch": "@@ -1,4 +1,4 @@\n-use criterion::{criterion_group, criterion_main, BatchSize, BenchmarkId, Criterion};\n+use criterion::{BatchSize, BenchmarkId, Criterion, criterion_group, criterion_main};\n use turbo_rcstr::RcStr;\n \n // map has a fast-path if the Arc is uniquely owned"
        },
        {
            "sha": "9b9d9ba4f93584a06511a003e686743daf9878cb",
            "filename": "turbopack/crates/turbo-rcstr/src/dynamic.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Fdynamic.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Fdynamic.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Fdynamic.rs?ref=9156b3b25bcdd74b4dee58eede731ba895c9e0d9",
            "patch": "@@ -3,22 +3,22 @@ use std::ptr::NonNull;\n use triomphe::Arc;\n \n use crate::{\n-    tagged_value::{TaggedValue, MAX_INLINE_LEN},\n-    RcStr, INLINE_TAG_INIT, LEN_OFFSET, TAG_MASK,\n+    INLINE_TAG_INIT, LEN_OFFSET, RcStr, TAG_MASK,\n+    tagged_value::{MAX_INLINE_LEN, TaggedValue},\n };\n \n pub unsafe fn cast(ptr: TaggedValue) -> *const String {\n     ptr.get_ptr().cast()\n }\n \n pub unsafe fn deref_from<'i>(ptr: TaggedValue) -> &'i String {\n-    &*cast(ptr)\n+    unsafe { &*cast(ptr) }\n }\n \n /// Caller should call `forget` (or `clone`) on the returned `Arc`\n pub unsafe fn restore_arc(v: TaggedValue) -> Arc<String> {\n     let ptr = v.get_ptr() as *const String;\n-    Arc::from_raw(ptr)\n+    unsafe { Arc::from_raw(ptr) }\n }\n \n /// This can create any kind of [Atom], although this lives in the `dynamic`"
        },
        {
            "sha": "3a438d230bf5c47043eb93d00da8554cf3f68595",
            "filename": "turbopack/crates/turbo-rcstr/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Flib.rs?ref=9156b3b25bcdd74b4dee58eede731ba895c9e0d9",
            "patch": "@@ -3,7 +3,7 @@ use std::{\n     ffi::OsStr,\n     fmt::{Debug, Display},\n     hash::{Hash, Hasher},\n-    mem::{forget, ManuallyDrop},\n+    mem::{ManuallyDrop, forget},\n     num::NonZeroU8,\n     ops::Deref,\n     path::{Path, PathBuf},"
        },
        {
            "sha": "35ee9edee677aeccc87d6f678cea5a76d8de4da5",
            "filename": "turbopack/crates/turbo-rcstr/src/tagged_value.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Ftagged_value.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/9156b3b25bcdd74b4dee58eede731ba895c9e0d9/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Ftagged_value.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Ftagged_value.rs?ref=9156b3b25bcdd74b4dee58eede731ba895c9e0d9",
            "patch": "@@ -135,9 +135,9 @@ impl TaggedValue {\n         // All except the lowest byte, which is first in little-endian, last in\n         // big-endian.\n         if cfg!(target_endian = \"little\") {\n-            data = data.offset(1);\n+            data = unsafe { data.offset(1) };\n         }\n         let len = std::mem::size_of::<TaggedValue>() - 1;\n-        slice::from_raw_parts_mut(data, len)\n+        unsafe { slice::from_raw_parts_mut(data, len) }\n     }\n }"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 9,
        "deletions": 9
    }
}