{
    "author": "eps1lon",
    "message": "Report tests to Datadog from Job that executed them (#73180)",
    "sha": "f984d1f6812345e9f079f5a37aae6239bc5aa338",
    "files": [
        {
            "sha": "8662bab3495a6b2f334e659ee3f985d936d434ef",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 41,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/f984d1f6812345e9f079f5a37aae6239bc5aa338/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/f984d1f6812345e9f079f5a37aae6239bc5aa338/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=f984d1f6812345e9f079f5a37aae6239bc5aa338",
            "patch": "@@ -615,47 +615,6 @@ jobs:\n       stepName: 'test-ppr-prod-${{ matrix.group }}'\n     secrets: inherit\n \n-  report-test-results-to-datadog:\n-    needs:\n-      [\n-        'changes',\n-        'test-unit',\n-        'test-dev',\n-        'test-prod',\n-        'test-integration',\n-        'test-ppr-dev',\n-        'test-ppr-prod',\n-        'test-ppr-integration',\n-        'test-turbopack-dev',\n-        'test-turbopack-integration',\n-        'test-turbopack-production',\n-        'test-turbopack-production-integration',\n-      ]\n-    if: ${{ always() && needs.changes.outputs.docs-only == 'false' && !github.event.pull_request.head.repo.fork }}\n-\n-    runs-on: ubuntu-latest\n-    name: report test results to datadog\n-    steps:\n-      - name: Download test report artifacts\n-        id: download-test-reports\n-        uses: actions/download-artifact@v4\n-        with:\n-          pattern: test-reports-*\n-          path: test\n-          merge-multiple: true\n-\n-      - name: Upload test report to datadog\n-        run: |\n-          if [ -d ./test/test-junit-report ]; then\n-            # Add a `test.type` tag to distinguish between turbopack and next.js runs\n-            DD_ENV=ci npx @datadog/datadog-ci@2.23.1 junit upload --tags test.type:nextjs --service nextjs ./test/test-junit-report\n-          fi\n-\n-          if [ -d ./test/turbopack-test-junit-report ]; then\n-            # Add a `test.type` tag to distinguish between turbopack and next.js runs\n-            DD_ENV=ci npx @datadog/datadog-ci@2.23.1 junit upload --tags test.type:turbopack --service nextjs ./test/turbopack-test-junit-report\n-          fi\n-\n   tests-pass:\n     needs:\n       ["
        },
        {
            "sha": "6a17ca1aef4288050e833926a80581ccb314ebcd",
            "filename": ".github/workflows/build_reusable.yml",
            "status": "modified",
            "additions": 19,
            "deletions": 11,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/f984d1f6812345e9f079f5a37aae6239bc5aa338/.github%2Fworkflows%2Fbuild_reusable.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/f984d1f6812345e9f079f5a37aae6239bc5aa338/.github%2Fworkflows%2Fbuild_reusable.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_reusable.yml?ref=f984d1f6812345e9f079f5a37aae6239bc5aa338",
            "patch": "@@ -243,19 +243,27 @@ jobs:\n           name: webpack bundle analysis stats-${{ steps.var.outputs.input_step_key }}\n           path: packages/next/dist/compiled/next-server/report.*.html\n \n-      - name: Upload test report artifacts\n-        uses: actions/upload-artifact@v4\n+      - name: Upload test report to datadog\n         if: ${{ inputs.afterBuild && always() }}\n-        with:\n-          name: test-reports-${{ steps.var.outputs.input_step_key }}\n-          path: |\n-            test/test-junit-report\n-            test/turbopack-test-junit-report\n-            test/rspack-test-junit-report\n-          if-no-files-found: ignore\n+        run: |\n+          # Add a `test.type` tag to distinguish between turbopack and next.js runs\n+          # Add a `nextjs.test_session.name` tag to help identify the job\n+          if [ -d ./test/test-junit-report ]; then\n+            npx @datadog/datadog-ci@2.45.1 junit upload \\\n+              --service nextjs \\\n+              --tags test.type:nextjs \\\n+              --tags test_session.name:\"${{ inputs.stepName }}\" \\\n+              ./test/test-junit-report\n+          fi\n+          if [ -d ./test/turbopack-test-junit-report ]; then\n+            npx @datadog/datadog-ci@2.45.1 junit upload \\\n+              --service nextjs \\\n+              --tags test.type:turbopack \\\n+              --tags test_session.name:\"${{ inputs.stepName }}\" \\\n+              ./test/turbopack-test-junit-report\n+          fi\n \n-      # upload playwright snapshots from failed tests\n-      - name: Upload test report artifacts\n+      - name: Upload Playwright Snapshots\n         uses: actions/upload-artifact@v4\n         if: ${{ inputs.afterBuild && always() }}\n         with:"
        }
    ],
    "stats": {
        "total": 71,
        "additions": 19,
        "deletions": 52
    }
}