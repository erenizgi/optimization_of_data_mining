{
    "author": "huozhi",
    "message": "[mcp] expose logging (#84226)",
    "sha": "79ae926dedc5004faff002d38bc10f2c631cbe22",
    "files": [
        {
            "sha": "172a18d09d4ab2958c63df564bf829a3fa825049",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -751,6 +751,7 @@ export async function createHotReloaderTurbopack(\n       ? [\n           getMcpMiddleware(\n             projectPath,\n+            distDir,\n             (message) => hotReloader.send(message),\n             () => clients.size\n           ),"
        },
        {
            "sha": "46d88761bbd0c62637a4def0bce27928dc64b03b",
            "filename": "packages/next/src/server/dev/hot-reloader-webpack.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -1647,6 +1647,7 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n         ? [\n             getMcpMiddleware(\n               this.dir,\n+              this.distDir,\n               (message) => this.send(message),\n               () => this.webpackHotMiddleware?.getClientCount() ?? 0\n             ),"
        },
        {
            "sha": "2e15c24e22e97973637fdb249e8e14eca633ffb4",
            "filename": "packages/next/src/server/mcp/get-mcp-middleware.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Fget-mcp-middleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Fget-mcp-middleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Fget-mcp-middleware.ts?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -6,6 +6,7 @@ import type { HmrMessageSentToBrowser } from '../dev/hot-reloader-types'\n \n export function getMcpMiddleware(\n   projectPath: string,\n+  distDir: string,\n   sendHmrMessage: (message: HmrMessageSentToBrowser) => void,\n   getActiveConnectionCount: () => number\n ) {\n@@ -20,6 +21,7 @@ export function getMcpMiddleware(\n     }\n     const mcpServer = getOrCreateMcpServer(\n       projectPath,\n+      distDir,\n       sendHmrMessage,\n       getActiveConnectionCount\n     )"
        },
        {
            "sha": "3836e9f4755c4d99b7f460a50af16a046b0bdddb",
            "filename": "packages/next/src/server/mcp/get-or-create-mcp-server.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Fget-or-create-mcp-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Fget-or-create-mcp-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Fget-or-create-mcp-server.ts?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -2,12 +2,14 @@ import { McpServer } from 'next/dist/compiled/@modelcontextprotocol/sdk/server/m\n import { registerGetProjectPathTool } from './tools/get-project-path'\n import { registerGetErrorsTool } from './tools/get-errors'\n import { registerGetPageMetadataTool } from './tools/get-page-metadata'\n+import { registerGetLogsTool } from './tools/get-logs'\n import type { HmrMessageSentToBrowser } from '../dev/hot-reloader-types'\n \n let mcpServer: McpServer | undefined\n \n export const getOrCreateMcpServer = (\n   projectPath: string,\n+  distDir: string,\n   sendHmrMessage: (message: HmrMessageSentToBrowser) => void,\n   getActiveConnectionCount: () => number\n ) => {\n@@ -27,6 +29,7 @@ export const getOrCreateMcpServer = (\n     sendHmrMessage,\n     getActiveConnectionCount\n   )\n+  registerGetLogsTool(mcpServer, distDir)\n \n   return mcpServer\n }"
        },
        {
            "sha": "263f350ad355c758e36eaadc4ab9e8d81b6a2153",
            "filename": "packages/next/src/server/mcp/tools/get-logs.ts",
            "status": "added",
            "additions": 56,
            "deletions": 0,
            "changes": 56,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Ftools%2Fget-logs.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Ftools%2Fget-logs.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Ftools%2Fget-logs.ts?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -0,0 +1,56 @@\n+/**\n+ * MCP tool for getting the path to the Next.js development log file.\n+ *\n+ * This tool returns the path to the {nextConfig.distDir}/logs/next-development.log file\n+ * that contains browser console logs and other development information.\n+ */\n+import type { McpServer } from 'next/dist/compiled/@modelcontextprotocol/sdk/server/mcp'\n+import { stat } from 'fs/promises'\n+import { join } from 'path'\n+\n+export function registerGetLogsTool(server: McpServer, distDir: string) {\n+  server.registerTool(\n+    'get_logs',\n+    {\n+      description:\n+        'Get the path to the Next.js development log file. Returns the file path so the agent can read the logs directly.',\n+    },\n+    async () => {\n+      try {\n+        const logFilePath = join(distDir, 'logs', 'next-development.log')\n+\n+        // Check if the log file exists\n+        try {\n+          await stat(logFilePath)\n+        } catch (error) {\n+          return {\n+            content: [\n+              {\n+                type: 'text',\n+                text: `Log file not found at ${logFilePath}.`,\n+              },\n+            ],\n+          }\n+        }\n+\n+        return {\n+          content: [\n+            {\n+              type: 'text',\n+              text: `Next.js log file path: ${logFilePath}`,\n+            },\n+          ],\n+        }\n+      } catch (error) {\n+        return {\n+          content: [\n+            {\n+              type: 'text',\n+              text: `Error getting log file path: ${error instanceof Error ? error.message : String(error)}`,\n+            },\n+          ],\n+        }\n+      }\n+    }\n+  )\n+}"
        },
        {
            "sha": "ca3f2dbd5e047e55cc406d013cd54407d7a8c3ea",
            "filename": "test/development/mcp-server/fixtures/log-file-app/.gitignore",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2F.gitignore",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2F.gitignore",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2F.gitignore?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -0,0 +1 @@\n+!tsconfig.json"
        },
        {
            "sha": "ca2414d7b1bf974c4f6455906012b66ccbd86885",
            "filename": "test/development/mcp-server/fixtures/log-file-app/app/client/page.tsx",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fapp%2Fclient%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fapp%2Fclient%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fapp%2Fclient%2Fpage.tsx?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -0,0 +1,30 @@\n+'use client'\n+\n+import { useEffect } from 'react'\n+\n+export default function ClientPage() {\n+  useEffect(() => {\n+    // Logging in client component useEffect\n+    // Test complex partial circular object\n+    const circularObj: any = {\n+      name: 'test',\n+      data: {\n+        nested: {\n+          value: 42,\n+          items: [1, 2, 3],\n+        },\n+      },\n+      metadata: {\n+        name: 'safe stringify',\n+        version: '1.0.0',\n+      },\n+    }\n+    // Create partial circular reference\n+    circularObj.data.parent = circularObj\n+    console.log('Client: Complex circular object:', circularObj)\n+    console.error('Client: This is an error message from client component')\n+    console.warn('Client: This is a warning message from client component')\n+  }, [])\n+\n+  return <p>client page with logging</p>\n+}"
        },
        {
            "sha": "888614deda3ba5d744d1a7e5dac131038dba2b12",
            "filename": "test/development/mcp-server/fixtures/log-file-app/app/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fapp%2Flayout.tsx?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -0,0 +1,8 @@\n+import { ReactNode } from 'react'\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "38fb7f09cc11b3d8fdb7bf88f081381e1cdc3a53",
            "filename": "test/development/mcp-server/fixtures/log-file-app/app/server/page.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fapp%2Fserver%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fapp%2Fserver%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fapp%2Fserver%2Fpage.tsx?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -0,0 +1,8 @@\n+export default async function Page() {\n+  // Logging in RSC render\n+  console.log('RSC: This is a log message from server component')\n+  console.error('RSC: This is an error message from server component')\n+  console.warn('RSC: This is a warning message from server component')\n+\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "6c3d49f3b48679325b7d6379936d4ad2c6375e21",
            "filename": "test/development/mcp-server/fixtures/log-file-app/next.config.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fnext.config.js?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -0,0 +1,10 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    mcpServer: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "465c59aa8197fab3b32e56c09ff6a152b5457578",
            "filename": "test/development/mcp-server/fixtures/log-file-app/pages/pages-router-page.tsx",
            "status": "added",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fpages%2Fpages-router-page.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fpages%2Fpages-router-page.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Fpages%2Fpages-router-page.tsx?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -0,0 +1,31 @@\n+import { GetServerSideProps } from 'next'\n+\n+interface Props {\n+  message: string\n+}\n+\n+export default function Page({ message }: Props) {\n+  console.log('Pages Router isomorphic: This is a log message from render')\n+  return (\n+    <div>\n+      <h1>Pages Router Server-Side Props Test</h1>\n+      <p>{message}</p>\n+    </div>\n+  )\n+}\n+\n+export const getServerSideProps: GetServerSideProps<Props> = async () => {\n+  console.log('Pages Router SSR: This is a log message from getServerSideProps')\n+  console.error(\n+    'Pages Router SSR: This is an error message from getServerSideProps'\n+  )\n+  console.warn(\n+    'Pages Router SSR: This is a warning message from getServerSideProps'\n+  )\n+\n+  return {\n+    props: {\n+      message: 'Server-side props executed successfully',\n+    },\n+  }\n+}"
        },
        {
            "sha": "03599f888d539f051033a8e21f9e47f7e96f31b1",
            "filename": "test/development/mcp-server/fixtures/log-file-app/tsconfig.json",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Flog-file-app%2Ftsconfig.json?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -0,0 +1,33 @@\n+{\n+  \"compilerOptions\": {\n+    \"target\": \"ES2017\",\n+    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n+    \"allowJs\": true,\n+    \"skipLibCheck\": true,\n+    \"strict\": true,\n+    \"noEmit\": true,\n+    \"esModuleInterop\": true,\n+    \"module\": \"esnext\",\n+    \"moduleResolution\": \"bundler\",\n+    \"resolveJsonModule\": true,\n+    \"isolatedModules\": true,\n+    \"jsx\": \"react-jsx\",\n+    \"incremental\": true,\n+    \"plugins\": [\n+      {\n+        \"name\": \"next\"\n+      }\n+    ],\n+    \"paths\": {\n+      \"@/*\": [\"./*\"]\n+    }\n+  },\n+  \"include\": [\n+    \"next-env.d.ts\",\n+    \"**/*.ts\",\n+    \"**/*.tsx\",\n+    \".next/types/**/*.ts\",\n+    \"**/*.mts\"\n+  ],\n+  \"exclude\": [\"node_modules\", \"**/*.test.ts\", \"**/*.test.tsx\"]\n+}"
        },
        {
            "sha": "828357b7ca414b1883e525be31060d50ea27ee6f",
            "filename": "test/development/mcp-server/mcp-server-get-logs.test.ts",
            "status": "added",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Fmcp-server-get-logs.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/79ae926dedc5004faff002d38bc10f2c631cbe22/test%2Fdevelopment%2Fmcp-server%2Fmcp-server-get-logs.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Fmcp-server-get-logs.test.ts?ref=79ae926dedc5004faff002d38bc10f2c631cbe22",
            "patch": "@@ -0,0 +1,52 @@\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+import { retry } from 'next-test-utils'\n+\n+describe('get-logs MCP tool', () => {\n+  const { next, skipped } = nextTestSetup({\n+    files: path.join(__dirname, 'fixtures', 'log-file-app'),\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  async function callGetLogs(id: string): Promise<string> {\n+    const response = await fetch(`${next.url}/_next/mcp`, {\n+      method: 'POST',\n+      headers: {\n+        'Content-Type': 'application/json',\n+        Accept: 'application/json, text/event-stream',\n+      },\n+      body: JSON.stringify({\n+        jsonrpc: '2.0',\n+        id,\n+        method: 'tools/call',\n+        params: { name: 'get_logs', arguments: {} },\n+      }),\n+    })\n+\n+    const text = await response.text()\n+    const match = text.match(/data: ({.*})/s)\n+    const result = JSON.parse(match![1])\n+    return result.result?.content?.[0]?.text\n+  }\n+\n+  it('should return log file path via MCP get_logs tool', async () => {\n+    // Generate some logs by visiting pages that create log entries\n+    await next.browser('/server')\n+    await next.browser('/client')\n+    await next.browser('/pages-router-page')\n+\n+    await retry(async () => {\n+      const sessionId = 'test-mcp-logs-' + Date.now()\n+      const response = await callGetLogs(sessionId)\n+\n+      // Should return the log file path\n+      expect(response).toContain('Next.js log file path:')\n+      expect(response).toContain('logs/next-development.log')\n+      expect(response).not.toContain('Log file not found at')\n+    })\n+  })\n+})"
        }
    ],
    "stats": {
        "total": 236,
        "additions": 236,
        "deletions": 0
    }
}