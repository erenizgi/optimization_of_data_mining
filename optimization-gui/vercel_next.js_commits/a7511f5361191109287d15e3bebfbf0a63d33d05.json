{
    "author": "devjiwonchoi",
    "message": "[dev-overlay] add false option to disable dev indicator (#76079)\n\n### Why?\r\n\r\nSince the dev indicator is visible by default, there could be a case where a user might want to disable it.\r\nHowever, the indicator needs to be brought back if there is an error since it's tied to the error overlay.\r\n\r\n### What?\r\n\r\nAdded an option `devIndicators: false` to disable the dev indicator.\r\n\r\n### Success Criteria\r\n\r\n- [x] Does it hide the indicator when there is no error?\r\n- [x] Does it show the indicator when there is an error?\r\n- [x] Does it show the error overlay when there is an error?\r\n\r\nCloses NDX-840",
    "sha": "a7511f5361191109287d15e3bebfbf0a63d33d05",
    "files": [
        {
            "sha": "da7d9808bb51f6c52ae1fb0ca20aabdeb565bcb9",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/a7511f5361191109287d15e3bebfbf0a63d33d05/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a7511f5361191109287d15e3bebfbf0a63d33d05/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=a7511f5361191109287d15e3bebfbf0a63d33d05",
            "patch": "@@ -212,12 +212,21 @@ pub enum BuildActivityPositions {\n     OperationValue,\n )]\n #[serde(rename_all = \"camelCase\")]\n-pub struct DevIndicatorsConfig {\n+pub struct DevIndicatorsOptions {\n     pub build_activity: Option<bool>,\n     pub build_activity_position: Option<BuildActivityPositions>,\n     pub position: Option<BuildActivityPositions>,\n }\n \n+#[derive(\n+    Clone, Debug, PartialEq, Serialize, Deserialize, TraceRawVcs, NonLocalValue, OperationValue,\n+)]\n+#[serde(untagged)]\n+pub enum DevIndicatorsConfig {\n+    WithOptions(DevIndicatorsOptions),\n+    Boolean(bool),\n+}\n+\n #[derive(\n     Clone,\n     Debug,"
        },
        {
            "sha": "f6e411eddc6434d6572b9f043fc612d326c8869b",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=a7511f5361191109287d15e3bebfbf0a63d33d05",
            "patch": "@@ -2130,8 +2130,14 @@ export default async function getBaseWebpackConfig(\n     crossOrigin: config.crossOrigin,\n     pageExtensions: pageExtensions,\n     trailingSlash: config.trailingSlash,\n-    buildActivity: config.devIndicators.buildActivity,\n-    buildActivityPosition: config.devIndicators.position,\n+    buildActivity:\n+      config.devIndicators === false\n+        ? false\n+        : config.devIndicators.buildActivity,\n+    buildActivityPosition:\n+      config.devIndicators === false\n+        ? undefined\n+        : config.devIndicators.position,\n     productionBrowserSourceMaps: !!config.productionBrowserSourceMaps,\n     reactStrictMode: config.reactStrictMode,\n     optimizeCss: config.experimental.optimizeCss,"
        },
        {
            "sha": "ce88849abe7866289d3d66c033a3f892e92502f3",
            "filename": "packages/next/src/build/webpack/plugins/define-env-plugin.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts?ref=a7511f5361191109287d15e3bebfbf0a63d33d05",
            "patch": "@@ -186,7 +186,7 @@ export function getDefineEnv({\n       config.experimental.appNavFailHandling\n     ),\n     'process.env.__NEXT_APP_ISR_INDICATOR': Boolean(\n-      config.devIndicators.appIsrStatus\n+      config.devIndicators === false ? false : config.devIndicators.appIsrStatus\n     ),\n     'process.env.__NEXT_PPR': isPPREnabled,\n     'process.env.__NEXT_DYNAMIC_IO': isDynamicIOEnabled,\n@@ -238,9 +238,14 @@ export function getDefineEnv({\n       : {}),\n     'process.env.__NEXT_TRAILING_SLASH': config.trailingSlash,\n     'process.env.__NEXT_BUILD_INDICATOR':\n-      config.devIndicators.buildActivity ?? true,\n+      config.devIndicators === false\n+        ? false\n+        : config.devIndicators.buildActivity ?? true,\n+    'process.env.__NEXT_DEV_INDICATOR': config.devIndicators !== false,\n     'process.env.__NEXT_DEV_INDICATOR_POSITION':\n-      config.devIndicators.position ?? 'bottom-left',\n+      config.devIndicators === false\n+        ? 'bottom-left' // This will not be used as the indicator is disabled.\n+        : config.devIndicators.position ?? 'bottom-left',\n     'process.env.__NEXT_STRICT_MODE':\n       config.reactStrictMode === null ? false : config.reactStrictMode,\n     'process.env.__NEXT_STRICT_MODE_APP':"
        },
        {
            "sha": "178bfd390fd7da411682b38b428474ec4ebe7a89",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/container/runtime-error/render-error.tsx",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcontainer%2Fruntime-error%2Frender-error.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcontainer%2Fruntime-error%2Frender-error.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcontainer%2Fruntime-error%2Frender-error.tsx?ref=a7511f5361191109287d15e3bebfbf0a63d33d05",
            "patch": "@@ -109,7 +109,18 @@ const RenderRuntimeError = ({ children, state, isAppDir }: Props) => {\n     }\n   }, [nextError, isAppDir])\n \n-  return children({ readyErrors, totalErrorCount: readyErrors.length })\n+  // Stringify since __NEXT_DEV_INDICATOR can be set to boolean false.\n+  const hasDisabledDevIndicator =\n+    process.env.__NEXT_DEV_INDICATOR?.toString() === 'false'\n+  const totalErrorCount = readyErrors.length\n+\n+  // Even if the dev indicator is disabled, we should show it\n+  // along with the error overlay when there are errors.\n+  if (hasDisabledDevIndicator && !totalErrorCount) {\n+    return null\n+  }\n+\n+  return children({ readyErrors, totalErrorCount })\n }\n \n const RenderBuildError = ({ children }: Props) => {"
        },
        {
            "sha": "2c7311900bf47a708c7b47499abd170ec7ae5d47",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 20,
            "changes": 43,
            "blob_url": "https://github.com/vercel/next.js/blob/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=a7511f5361191109287d15e3bebfbf0a63d33d05",
            "patch": "@@ -228,26 +228,29 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n       .optional(),\n     deploymentId: z.string().optional(),\n     devIndicators: z\n-      .object({\n-        appIsrStatus: z.boolean().optional(),\n-        buildActivity: z.boolean().optional(),\n-        buildActivityPosition: z\n-          .union([\n-            z.literal('bottom-left'),\n-            z.literal('bottom-right'),\n-            z.literal('top-left'),\n-            z.literal('top-right'),\n-          ])\n-          .optional(),\n-        position: z\n-          .union([\n-            z.literal('bottom-left'),\n-            z.literal('bottom-right'),\n-            z.literal('top-left'),\n-            z.literal('top-right'),\n-          ])\n-          .optional(),\n-      })\n+      .union([\n+        z.object({\n+          appIsrStatus: z.boolean().optional(),\n+          buildActivity: z.boolean().optional(),\n+          buildActivityPosition: z\n+            .union([\n+              z.literal('bottom-left'),\n+              z.literal('bottom-right'),\n+              z.literal('top-left'),\n+              z.literal('top-right'),\n+            ])\n+            .optional(),\n+          position: z\n+            .union([\n+              z.literal('bottom-left'),\n+              z.literal('bottom-right'),\n+              z.literal('top-left'),\n+              z.literal('top-right'),\n+            ])\n+            .optional(),\n+        }),\n+        z.literal(false),\n+      ])\n       .optional(),\n     distDir: z.string().min(1).optional(),\n     env: z.record(z.string(), z.union([z.string(), z.undefined()])).optional(),"
        },
        {
            "sha": "f7b765ace7ca5b598e49379d33a0dfeeb6e34d04",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 31,
            "deletions": 29,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=a7511f5361191109287d15e3bebfbf0a63d33d05",
            "patch": "@@ -836,35 +836,37 @@ export interface NextConfig extends Record<string, any> {\n   images?: ImageConfig\n \n   /** Configure indicators in development environment */\n-  devIndicators?: {\n-    /**\n-     * @deprecated The dev tools indicator has it enabled by default.\n-     * */\n-    appIsrStatus?: boolean\n-\n-    /**\n-     * Show \"building...\" indicator in development\n-     * @deprecated The dev tools indicator has it enabled by default.\n-     */\n-    buildActivity?: boolean\n-\n-    /**\n-     * Position of \"building...\" indicator in browser\n-     * @default \"bottom-right\"\n-     * @deprecated Renamed as `position`.\n-     */\n-    buildActivityPosition?:\n-      | 'top-left'\n-      | 'top-right'\n-      | 'bottom-left'\n-      | 'bottom-right'\n-\n-    /**\n-     * Position of the development tools indicator in the browser window.\n-     * @default \"bottom-left\"\n-     * */\n-    position?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n-  }\n+  devIndicators?:\n+    | false\n+    | {\n+        /**\n+         * @deprecated The dev tools indicator has it enabled by default.\n+         * */\n+        appIsrStatus?: boolean\n+\n+        /**\n+         * Show \"building...\" indicator in development\n+         * @deprecated The dev tools indicator has it enabled by default.\n+         */\n+        buildActivity?: boolean\n+\n+        /**\n+         * Position of \"building...\" indicator in browser\n+         * @default \"bottom-right\"\n+         * @deprecated Renamed as `position`.\n+         */\n+        buildActivityPosition?:\n+          | 'top-left'\n+          | 'top-right'\n+          | 'bottom-left'\n+          | 'bottom-right'\n+\n+        /**\n+         * Position of the development tools indicator in the browser window.\n+         * @default \"bottom-left\"\n+         * */\n+        position?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n+      }\n \n   /**\n    * Next.js exposes some options that give you some control over how the server will dispose or keep in memory built pages in development."
        },
        {
            "sha": "64868e490974cace4151483b50a5478249ad4f63",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a7511f5361191109287d15e3bebfbf0a63d33d05/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=a7511f5361191109287d15e3bebfbf0a63d33d05",
            "patch": "@@ -488,6 +488,7 @@ function assignDefaults(\n   )\n   if (\n     hasWarnedBuildActivityPosition &&\n+    result.devIndicators !== false &&\n     result.devIndicators?.buildActivityPosition &&\n     result.devIndicators.buildActivityPosition !== result.devIndicators.position\n   ) {\n@@ -835,7 +836,7 @@ function assignDefaults(\n     }\n   }\n \n-  if (result.devIndicators?.position) {\n+  if (result.devIndicators !== false && result.devIndicators?.position) {\n     const { position } = result.devIndicators\n     const allowedValues = [\n       'top-left',\n@@ -962,8 +963,14 @@ function assignDefaults(\n   if (result.experimental.newDevOverlay !== true) {\n     result.devIndicators = {\n       ...result.devIndicators,\n-      appIsrStatus: result.devIndicators?.appIsrStatus ?? true,\n-      buildActivity: result.devIndicators?.buildActivity ?? true,\n+      appIsrStatus:\n+        result.devIndicators === false\n+          ? false\n+          : result.devIndicators?.appIsrStatus ?? true,\n+      buildActivity:\n+        result.devIndicators === false\n+          ? false\n+          : result.devIndicators?.buildActivity ?? true,\n     }\n \n     // If the user didn't explicitly set `position` or `buildActivityPosition` option,"
        }
    ],
    "stats": {
        "total": 161,
        "additions": 102,
        "deletions": 59
    }
}