{
    "author": "icyJoseph",
    "message": "Docs: scrub html in `ld+json` script (#79627)\n\nCloses:\nhttps://linear.app/vercel/issue/DOC-4708/json-ld-security-w-jsonstringify\nFixes: https://github.com/vercel/next.js/issues/79593",
    "sha": "fc17ba97100db45bb986654c95e15e34fa5f38b6",
    "files": [
        {
            "sha": "3ce1eb01dd91ec0e308d7474269b6cf9cd4f8838",
            "filename": "docs/01-app/02-guides/json-ld.mdx",
            "status": "modified",
            "additions": 11,
            "deletions": 3,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/fc17ba97100db45bb986654c95e15e34fa5f38b6/docs%2F01-app%2F02-guides%2Fjson-ld.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/fc17ba97100db45bb986654c95e15e34fa5f38b6/docs%2F01-app%2F02-guides%2Fjson-ld.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F02-guides%2Fjson-ld.mdx?ref=fc17ba97100db45bb986654c95e15e34fa5f38b6",
            "patch": "@@ -6,7 +6,11 @@ description: Learn how to add JSON-LD to your Next.js application to describe yo\n \n [JSON-LD](https://json-ld.org/) is a format for structured data that can be used by search engines and AI to to help them understand the structure of the page beyond pure content. For example, you can use it to describe a person, an event, an organization, a movie, a book, a recipe, and many other types of entities.\n \n-Our current recommendation for JSON-LD is to render structured data as a `<script>` tag in your `layout.js` or `page.js` components. For example:\n+Our current recommendation for JSON-LD is to render structured data as a `<script>` tag in your `layout.js` or `page.js` components.\n+\n+The following snippet uses `JSON.stringify`, which does not sanitize malicious strings used in XSS injection. To prevent this type of vulnerability, you can scrub `HTML` tags from the `JSON-LD` payload, for example, by replacing the character, `<`, with its unicode equivalent, `\\u003c`.\n+\n+Review your organization's recommended approach to sanitize potentially dangerous strings, or use community maintained alternatives for `JSON.stringify` such as, [serialize-javascript](https://www.npmjs.com/package/serialize-javascript).\n \n ```tsx filename=\"app/products/[id]/page.tsx\" switcher\n export default async function Page({ params }) {\n@@ -26,7 +30,9 @@ export default async function Page({ params }) {\n       {/* Add JSON-LD to your page */}\n       <script\n         type=\"application/ld+json\"\n-        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}\n+        dangerouslySetInnerHTML={{\n+          __html: JSON.stringify(jsonLd).replace(/</g, '\\\\u003c'),\n+        }}\n       />\n       {/* ... */}\n     </section>\n@@ -52,7 +58,9 @@ export default async function Page({ params }) {\n       {/* Add JSON-LD to your page */}\n       <script\n         type=\"application/ld+json\"\n-        dangerouslySetInnerHTML={{ __html: JSON.stringify(jsonLd) }}\n+        dangerouslySetInnerHTML={{\n+          __html: JSON.stringify(jsonLd).replace(/</g, '\\\\u003c'),\n+        }}\n       />\n       {/* ... */}\n     </section>"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 11,
        "deletions": 3
    }
}