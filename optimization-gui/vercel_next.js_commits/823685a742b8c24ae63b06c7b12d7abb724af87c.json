{
    "author": "sokra",
    "message": "Turbopack: fix race condition in unit test (#84085)\n\n### What?\n\nTurbo Task functions are executed when they are called. Not awaiting them will still execute them, but makes it a race condition if the stats or the execution is faster.",
    "sha": "823685a742b8c24ae63b06c7b12d7abb724af87c",
    "files": [
        {
            "sha": "c87901978ffb52f319ff8048735d2d22b9d62dc0",
            "filename": "turbopack/crates/turbo-tasks-backend/tests/task_statistics.rs",
            "status": "modified",
            "additions": 23,
            "deletions": 4,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/823685a742b8c24ae63b06c7b12d7abb724af87c/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftask_statistics.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/823685a742b8c24ae63b06c7b12d7abb724af87c/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftask_statistics.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Ftests%2Ftask_statistics.rs?ref=823685a742b8c24ae63b06c7b12d7abb724af87c",
            "patch": "@@ -178,14 +178,33 @@ async fn test_dyn_trait_methods() -> Result<()> {\n async fn test_no_execution() -> Result<()> {\n     run_without_cache_check(&REGISTRATION, async move {\n         enable_stats();\n-        // don't await this!\n-        let _ = wrap_vc(double_vc(double(123))).double().double_vc();\n+        wrap_vc(double_vc(double(123)))\n+            .double()\n+            .double_vc()\n+            .as_side_effect()\n+            .await?;\n         assert_eq!(\n             stats_json(),\n             json!({\n-                \"double\": {\n-                    \"cache_miss\": 1,\n+                \"WrappedU64::Doublable::double\": {\n+                    \"cache_hit\": 0,\n+                    \"cache_miss\": 1\n+                },\n+                \"WrappedU64::Doublable::double_vc\":  {\n+                    \"cache_hit\": 0,\n+                    \"cache_miss\": 1\n+                },\n+                \"double\":  {\n+                    \"cache_hit\": 0,\n+                    \"cache_miss\": 1\n+                },\n+                \"double_vc\":  {\n+                    \"cache_hit\": 0,\n+                    \"cache_miss\": 1\n+                },\n+                \"wrap_vc\": {\n                     \"cache_hit\": 0,\n+                    \"cache_miss\": 1\n                 },\n             })\n         );"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 23,
        "deletions": 4
    }
}