{
    "author": "eps1lon",
    "message": "[dev-overlay] Move Redbox open/close into dispatcher (#79698)",
    "sha": "4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
    "files": [
        {
            "sha": "bb1b74b51ea4600bf9a8c090d2a52ef6f52bea13",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 10,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -1,7 +1,11 @@\n-import type { OverlayState } from '../shared'\n+import {\n+  ACTION_ERROR_OVERLAY_OPEN,\n+  type OverlayDispatch,\n+  type OverlayState,\n+} from '../shared'\n import type { GlobalErrorComponent } from '../../global-error'\n \n-import { useCallback, useEffect, useState } from 'react'\n+import { useCallback, useEffect } from 'react'\n import { AppDevOverlayErrorBoundary } from './app-dev-overlay-error-boundary'\n import { FontStyles } from '../font/font-styles'\n import { DevOverlay } from '../ui/dev-overlay'\n@@ -70,17 +74,18 @@ function ReplaySsrOnlyErrors({\n \n export function AppDevOverlay({\n   state,\n+  dispatch,\n   globalError,\n   children,\n }: {\n   state: OverlayState\n+  dispatch: OverlayDispatch\n   globalError: [GlobalErrorComponent, React.ReactNode]\n   children: React.ReactNode\n }) {\n-  const [isErrorOverlayOpen, setIsErrorOverlayOpen] = useState(false)\n   const openOverlay = useCallback(() => {\n-    setIsErrorOverlayOpen(true)\n-  }, [])\n+    dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n+  }, [dispatch])\n \n   return (\n     <>\n@@ -94,11 +99,7 @@ export function AppDevOverlay({\n       <>\n         {/* Fonts can only be loaded outside the Shadow DOM. */}\n         <FontStyles />\n-        <DevOverlay\n-          state={state}\n-          isErrorOverlayOpen={isErrorOverlayOpen}\n-          setIsErrorOverlayOpen={setIsErrorOverlayOpen}\n-        />\n+        <DevOverlay state={state} dispatch={dispatch} />\n       </>\n     </>\n   )"
        },
        {
            "sha": "304cf4fab6a00e1d057c59d14bb4149c2676403e",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/hot-reloader-client.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -624,7 +624,7 @@ export default function HotReload({\n   ])\n \n   return (\n-    <AppDevOverlay state={state} globalError={globalError}>\n+    <AppDevOverlay state={state} dispatch={dispatch} globalError={globalError}>\n       {children}\n     </AppDevOverlay>\n   )"
        },
        {
            "sha": "1633c4e45e9545cca914526a758be80bd3239653",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/hooks.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhooks.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhooks.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhooks.ts?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -30,5 +30,6 @@ export const usePagesDevOverlay = () => {\n   return {\n     state,\n     onComponentError,\n+    dispatch,\n   }\n }"
        },
        {
            "sha": "f27060928a7d56f440223fc47bfb65c4834a8dd3",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/pages-dev-overlay.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -1,4 +1,3 @@\n-import { useState } from 'react'\n import { PagesDevOverlayErrorBoundary } from './pages-dev-overlay-error-boundary'\n import { usePagesDevOverlay } from './hooks'\n import { FontStyles } from '../font/font-styles'\n@@ -13,9 +12,7 @@ interface PagesDevOverlayProps {\n }\n \n export function PagesDevOverlay({ children }: PagesDevOverlayProps) {\n-  const { state, onComponentError } = usePagesDevOverlay()\n-\n-  const [isErrorOverlayOpen, setIsErrorOverlayOpen] = useState(true)\n+  const { state, dispatch, onComponentError } = usePagesDevOverlay()\n \n   return (\n     <>\n@@ -25,11 +22,7 @@ export function PagesDevOverlay({ children }: PagesDevOverlayProps) {\n \n       {/* Fonts can only be loaded outside the Shadow DOM. */}\n       <FontStyles />\n-      <DevOverlay\n-        state={state}\n-        isErrorOverlayOpen={isErrorOverlayOpen}\n-        setIsErrorOverlayOpen={setIsErrorOverlayOpen}\n-      />\n+      <DevOverlay state={state} dispatch={dispatch} />\n     </>\n   )\n }"
        },
        {
            "sha": "f40f96ce57b1891eb48ca9ca132f6d5227860801",
            "filename": "packages/next/src/client/components/react-dev-overlay/shared.ts",
            "status": "modified",
            "additions": 35,
            "deletions": 1,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -27,7 +27,9 @@ export interface OverlayState {\n   disableDevIndicator: boolean\n   debugInfo: DebugInfo\n   routerType: 'pages' | 'app'\n+  isErrorOverlayOpen: boolean\n }\n+export type OverlayDispatch = React.Dispatch<BusEvent>\n \n export const ACTION_STATIC_INDICATOR = 'static-indicator'\n export const ACTION_BUILD_OK = 'build-ok'\n@@ -39,6 +41,9 @@ export const ACTION_UNHANDLED_ERROR = 'unhandled-error'\n export const ACTION_UNHANDLED_REJECTION = 'unhandled-rejection'\n export const ACTION_DEBUG_INFO = 'debug-info'\n export const ACTION_DEV_INDICATOR = 'dev-indicator'\n+export const ACTION_ERROR_OVERLAY_OPEN = 'error-overlay-open'\n+export const ACTION_ERROR_OVERLAY_CLOSE = 'error-overlay-close'\n+export const ACTION_ERROR_OVERLAY_TOGGLE = 'error-overlay-toggle'\n \n export const STORAGE_KEY_THEME = '__nextjs-dev-tools-theme'\n export const STORAGE_KEY_POSITION = '__nextjs-dev-tools-position'\n@@ -90,6 +95,16 @@ interface DevIndicatorAction {\n   devIndicator: DevIndicatorServerState\n }\n \n+export interface ErrorOverlayOpenAction {\n+  type: typeof ACTION_ERROR_OVERLAY_OPEN\n+}\n+export interface ErrorOverlayCloseAction {\n+  type: typeof ACTION_ERROR_OVERLAY_CLOSE\n+}\n+export interface ErrorOverlayToggleAction {\n+  type: typeof ACTION_ERROR_OVERLAY_TOGGLE\n+}\n+\n export type BusEvent =\n   | BuildOkAction\n   | BuildErrorAction\n@@ -101,6 +116,9 @@ export type BusEvent =\n   | StaticIndicatorAction\n   | DebugInfoAction\n   | DevIndicatorAction\n+  | ErrorOverlayOpenAction\n+  | ErrorOverlayCloseAction\n+  | ErrorOverlayToggleAction\n \n const REACT_ERROR_STACK_BOTTOM_FRAME_REGEX =\n   // 1st group: v8\n@@ -136,7 +154,10 @@ function pushErrorFilterDuplicates(\n const shouldDisableDevIndicator =\n   process.env.__NEXT_DEV_INDICATOR?.toString() === 'false'\n \n-export const INITIAL_OVERLAY_STATE: Omit<OverlayState, 'routerType'> = {\n+export const INITIAL_OVERLAY_STATE: Omit<\n+  OverlayState,\n+  'isErrorOverlayOpen' | 'routerType'\n+> = {\n   nextId: 1,\n   buildError: null,\n   errors: [],\n@@ -159,6 +180,10 @@ function getInitialState(\n ): OverlayState & { routerType: 'pages' | 'app' } {\n   return {\n     ...INITIAL_OVERLAY_STATE,\n+    // Pages Router only listenes to thrown errors which\n+    // always open the overlay.\n+    // TODO: Should be the same default as App Router once we surface console.error in Pages Router.\n+    isErrorOverlayOpen: routerType === 'pages',\n     routerType,\n   }\n }\n@@ -239,6 +264,15 @@ export function useErrorOverlayReducer(routerType: 'pages' | 'app') {\n             shouldDisableDevIndicator || !!action.devIndicator.disabledUntil,\n         }\n       }\n+      case ACTION_ERROR_OVERLAY_OPEN: {\n+        return { ...state, isErrorOverlayOpen: true }\n+      }\n+      case ACTION_ERROR_OVERLAY_CLOSE: {\n+        return { ...state, isErrorOverlayOpen: false }\n+      }\n+      case ACTION_ERROR_OVERLAY_TOGGLE: {\n+        return { ...state, isErrorOverlayOpen: !state.isErrorOverlayOpen }\n+      }\n       default: {\n         return state\n       }"
        },
        {
            "sha": "68ed370f0b8e007c28567c4dc93a830387354c2e",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/dev-tools-indicator.stories.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -56,13 +56,14 @@ const state: OverlayState = {\n   notFound: false,\n   staticIndicator: true,\n   debugInfo: { devtoolsFrontendUrl: undefined },\n+  isErrorOverlayOpen: false,\n }\n \n export const StaticRoute: Story = {\n   args: {\n     errorCount: 0,\n     state,\n-    setIsErrorOverlayOpen: () => {},\n+    dispatch: () => {},\n   },\n }\n \n@@ -73,22 +74,22 @@ export const DynamicRoute: Story = {\n       ...state,\n       staticIndicator: false,\n     },\n-    setIsErrorOverlayOpen: () => {},\n+    dispatch: () => {},\n   },\n }\n \n export const SingleError: Story = {\n   args: {\n     errorCount: 1,\n     state,\n-    setIsErrorOverlayOpen: () => {},\n+    dispatch: () => {},\n   },\n }\n \n export const MultipleErrors: Story = {\n   args: {\n     errorCount: 3,\n     state,\n-    setIsErrorOverlayOpen: () => {},\n+    dispatch: () => {},\n   },\n }"
        },
        {
            "sha": "e739c473548e631b2be9696f766ea56b57acf202",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 12,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -1,5 +1,11 @@\n import type { CSSProperties, Dispatch, SetStateAction } from 'react'\n-import { STORAGE_KEY_POSITION, type OverlayState } from '../../../../shared'\n+import {\n+  ACTION_ERROR_OVERLAY_OPEN,\n+  ACTION_ERROR_OVERLAY_TOGGLE,\n+  STORAGE_KEY_POSITION,\n+  type OverlayDispatch,\n+  type OverlayState,\n+} from '../../../../shared'\n \n import { useState, useEffect, useRef, createContext, useContext } from 'react'\n import { Toast } from '../../toast'\n@@ -30,15 +36,13 @@ export function DevToolsIndicator({\n   state,\n   errorCount,\n   isBuildError,\n-  setIsErrorOverlayOpen,\n   ...props\n }: {\n   state: OverlayState\n+  dispatch: OverlayDispatch\n   errorCount: number\n   isBuildError: boolean\n-  setIsErrorOverlayOpen: (\n-    isErrorOverlayOpen: boolean | ((prev: boolean) => boolean)\n-  ) => void\n+\n   scale: DevToolsScale\n   setScale: (value: DevToolsScale) => void\n }) {\n@@ -57,7 +61,6 @@ export function DevToolsIndicator({\n           method: 'POST',\n         })\n       }}\n-      setIsErrorOverlayOpen={setIsErrorOverlayOpen}\n       isTurbopack={!!process.env.TURBOPACK}\n       disabled={state.disableDevIndicator || !isDevToolsIndicatorVisible}\n       isBuildError={isBuildError}\n@@ -96,7 +99,7 @@ function DevToolsPopover({\n   isTurbopack,\n   isBuildError,\n   hide,\n-  setIsErrorOverlayOpen,\n+  dispatch,\n   scale,\n   setScale,\n }: {\n@@ -108,9 +111,7 @@ function DevToolsPopover({\n   isTurbopack: boolean\n   isBuildError: boolean\n   hide: () => void\n-  setIsErrorOverlayOpen: (\n-    isOverlayOpen: boolean | ((prev: boolean) => boolean)\n-  ) => void\n+  dispatch: OverlayDispatch\n   scale: DevToolsScale\n   setScale: (value: DevToolsScale) => void\n }) {\n@@ -210,12 +211,12 @@ function DevToolsPopover({\n   function openErrorOverlay() {\n     setOpen(null)\n     if (issueCount > 0) {\n-      setIsErrorOverlayOpen(true)\n+      dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n     }\n   }\n \n   function toggleErrorOverlay() {\n-    setIsErrorOverlayOpen((prev) => !prev)\n+    dispatch({ type: ACTION_ERROR_OVERLAY_TOGGLE })\n   }\n \n   function openRootMenu() {"
        },
        {
            "sha": "150fc2820569d20e3a5813bb847a9c035f0c8031",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay/error-overlay.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -1,4 +1,8 @@\n-import type { OverlayState } from '../../../../shared'\n+import {\n+  ACTION_ERROR_OVERLAY_CLOSE,\n+  type OverlayDispatch,\n+  type OverlayState,\n+} from '../../../../shared'\n \n import { Suspense } from 'react'\n import { BuildError } from '../../../container/build-error'\n@@ -18,21 +22,19 @@ export interface ErrorBaseProps {\n \n export function ErrorOverlay({\n   state,\n+  dispatch,\n   runtimeErrors,\n-  isErrorOverlayOpen,\n-  setIsErrorOverlayOpen,\n   errorCount,\n }: {\n   state: OverlayState\n+  dispatch: OverlayDispatch\n   runtimeErrors: ReadyRuntimeError[]\n-  isErrorOverlayOpen: boolean\n-  setIsErrorOverlayOpen: (value: boolean) => void\n   errorCount: number\n }) {\n   const isTurbopack = !!process.env.TURBOPACK\n \n   // This hook lets us do an exit animation before unmounting the component\n-  const { mounted, rendered } = useDelayedRender(isErrorOverlayOpen, {\n+  const { mounted, rendered } = useDelayedRender(state.isErrorOverlayOpen, {\n     exitDelay: transitionDurationMs,\n   })\n \n@@ -74,7 +76,7 @@ export function ErrorOverlay({\n       debugInfo={state.debugInfo}\n       runtimeErrors={runtimeErrors}\n       onClose={() => {\n-        setIsErrorOverlayOpen(false)\n+        dispatch({ type: ACTION_ERROR_OVERLAY_CLOSE })\n       }}\n     />\n   )"
        },
        {
            "sha": "934eff9b2775f232acdec4bd7307b425b68dc27e",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 32,
            "deletions": 10,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -1,12 +1,17 @@\n import type { Meta, StoryObj } from '@storybook/react'\n-import type { OverlayState } from '../shared'\n+import type { BusEvent, OverlayState } from '../shared'\n \n // @ts-expect-error\n import imgApp from './app.png'\n \n-import { useState } from 'react'\n+import { useReducer } from 'react'\n import { DevOverlay } from './dev-overlay'\n-import { ACTION_UNHANDLED_ERROR } from '../shared'\n+import {\n+  ACTION_ERROR_OVERLAY_CLOSE,\n+  ACTION_ERROR_OVERLAY_OPEN,\n+  ACTION_ERROR_OVERLAY_TOGGLE,\n+  ACTION_UNHANDLED_ERROR,\n+} from '../shared'\n \n const meta: Meta<typeof DevOverlay> = {\n   component: DevOverlay,\n@@ -18,7 +23,7 @@ const meta: Meta<typeof DevOverlay> = {\n export default meta\n type Story = StoryObj<typeof DevOverlay>\n \n-const state: OverlayState = {\n+const initialState: OverlayState = {\n   nextId: 0,\n   routerType: 'app',\n   buildError: null,\n@@ -81,11 +86,32 @@ const state: OverlayState = {\n     installed: '15.2.0',\n     staleness: 'fresh',\n   },\n+  isErrorOverlayOpen: true,\n+}\n+\n+function useOverlayReducer() {\n+  return useReducer<OverlayState, [BusEvent]>((state, action): OverlayState => {\n+    switch (action.type) {\n+      case ACTION_ERROR_OVERLAY_CLOSE: {\n+        return { ...state, isErrorOverlayOpen: false }\n+      }\n+      case ACTION_ERROR_OVERLAY_OPEN: {\n+        return { ...state, isErrorOverlayOpen: true }\n+      }\n+      case ACTION_ERROR_OVERLAY_TOGGLE: {\n+        return { ...state, isErrorOverlayOpen: !state.isErrorOverlayOpen }\n+      }\n+      default: {\n+        return state\n+      }\n+    }\n+    return state\n+  }, initialState)\n }\n \n export const Default: Story = {\n   render: function DevOverlayStory() {\n-    const [isErrorOverlayOpen, setIsErrorOverlayOpen] = useState(true)\n+    const [state, dispatch] = useOverlayReducer()\n     return (\n       <>\n         <img\n@@ -96,11 +122,7 @@ export const Default: Story = {\n             objectFit: 'contain',\n           }}\n         />\n-        <DevOverlay\n-          state={state}\n-          isErrorOverlayOpen={isErrorOverlayOpen}\n-          setIsErrorOverlayOpen={setIsErrorOverlayOpen}\n-        />\n+        <DevOverlay state={state} dispatch={dispatch} />\n       </>\n     )\n   },"
        },
        {
            "sha": "1bde4b5e491c6323f39b22bc8d9705c7904fb0cb",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 10,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.tsx?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -1,4 +1,4 @@\n-import type { OverlayState } from '../shared'\n+import type { OverlayDispatch, OverlayState } from '../shared'\n \n import { ShadowPortal } from './components/shadow-portal'\n import { Base } from './styles/base'\n@@ -13,14 +13,10 @@ import { useDevToolsScale } from './components/errors/dev-tools-indicator/dev-to\n \n export function DevOverlay({\n   state,\n-  isErrorOverlayOpen,\n-  setIsErrorOverlayOpen,\n+  dispatch,\n }: {\n   state: OverlayState\n-  isErrorOverlayOpen: boolean\n-  setIsErrorOverlayOpen: (\n-    isErrorOverlayOpen: boolean | ((prev: boolean) => boolean)\n-  ) => void\n+  dispatch: OverlayDispatch\n }) {\n   const [scale, setScale] = useDevToolsScale()\n   return (\n@@ -41,18 +37,17 @@ export function DevOverlay({\n                   scale={scale}\n                   setScale={setScale}\n                   state={state}\n+                  dispatch={dispatch}\n                   errorCount={totalErrorCount}\n                   isBuildError={isBuildError}\n-                  setIsErrorOverlayOpen={setIsErrorOverlayOpen}\n                 />\n               )}\n \n               <ErrorOverlay\n                 state={state}\n+                dispatch={dispatch}\n                 runtimeErrors={runtimeErrors}\n                 errorCount={totalErrorCount}\n-                isErrorOverlayOpen={isErrorOverlayOpen}\n-                setIsErrorOverlayOpen={setIsErrorOverlayOpen}\n               />\n             </>\n           )"
        },
        {
            "sha": "43574f8770d530e1ea2d79d5eea3e57a0dabb384",
            "filename": "test/development/acceptance-app/hydration-error.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts?ref=4ab6eba5c035736fc6dbe92a4ccbdf0fbbc04eeb",
            "patch": "@@ -209,7 +209,7 @@ describe('Error overlay for hydration errors in App router', () => {\n        {\n          \"componentStack\": \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n-             <AppDevOverlay state={{nextId:1, ...}} globalError={[...]}>\n+             <AppDevOverlay state={{nextId:1, ...}} dispatch={function bound dispatchReducerAction} globalError={[...]}>\n                <AppDevOverlayErrorBoundary globalError={[...]} onError={function}>\n                  <ReplaySsrOnlyErrors>\n                  <DevRootHTTPAccessFallbackBoundary>\n@@ -245,7 +245,7 @@ describe('Error overlay for hydration errors in App router', () => {\n        {\n          \"componentStack\": \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n-             <AppDevOverlay state={{nextId:1, ...}} globalError={[...]}>\n+             <AppDevOverlay state={{nextId:1, ...}} dispatch={function bound dispatchReducerAction} globalError={[...]}>\n                <AppDevOverlayErrorBoundary globalError={[...]} onError={function}>\n                  <ReplaySsrOnlyErrors>\n                  <DevRootHTTPAccessFallbackBoundary>\n@@ -1045,7 +1045,7 @@ describe('Error overlay for hydration errors in App router', () => {\n        {\n          \"componentStack\": \"...\n          <HotReload assetPrefix=\"\" globalError={[...]}>\n-           <AppDevOverlay state={{nextId:1, ...}} globalError={[...]}>\n+           <AppDevOverlay state={{nextId:1, ...}} dispatch={function bound dispatchReducerAction} globalError={[...]}>\n              <AppDevOverlayErrorBoundary globalError={[...]} onError={function}>\n                <ReplaySsrOnlyErrors>\n                <DevRootHTTPAccessFallbackBoundary>"
        }
    ],
    "stats": {
        "total": 184,
        "additions": 117,
        "deletions": 67
    }
}