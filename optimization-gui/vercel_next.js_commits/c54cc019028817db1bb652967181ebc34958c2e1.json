{
    "author": "huozhi",
    "message": "[segment explorer] display default page in segment explorer (#80716)",
    "sha": "c54cc019028817db1bb652967181ebc34958c2e1",
    "files": [
        {
            "sha": "38e9fd2ce44cc45b98a1fb08c49ef10d4e3339fc",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -242,7 +242,8 @@ export const DEV_TOOLS_INFO_RENDER_FILES_STYLES = css`\n     user-select: none;\n   }\n   .segment-explorer-file-label--layout,\n-  .segment-explorer-file-label--template {\n+  .segment-explorer-file-label--template,\n+  .segment-explorer-file-label--default {\n     background-color: var(--color-gray-300);\n     color: var(--color-gray-1000);\n   }"
        },
        {
            "sha": "29edfa288f90e5081d74f478d1f55bffd845511b",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 5,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -25,6 +25,7 @@ import type {\n   UseCacheLayoutComponentProps,\n   UseCachePageComponentProps,\n } from '../use-cache/use-cache-wrapper'\n+import { DEFAULT_SEGMENT_KEY } from '../../shared/lib/segment'\n \n /**\n  * Use the provided loader tree to create the React Component tree.\n@@ -431,8 +432,6 @@ async function createComponentTreeInternal({\n     tree,\n   })\n \n-  const nodeName = modType ?? 'page'\n-\n   // TODO: Combine this `map` traversal with the loop below that turns the array\n   // into an object.\n   const parallelRouteMap = await Promise.all(\n@@ -743,10 +742,16 @@ async function createComponentTreeInternal({\n       }\n     }\n \n-    const pageFilePath = getConventionPathByType(tree, dir, 'page')\n+    const isDefaultSegment = segment === DEFAULT_SEGMENT_KEY\n+    const pageFilePath =\n+      getConventionPathByType(tree, dir, 'page') ??\n+      getConventionPathByType(tree, dir, 'defaultPage')\n     const wrappedPageElement =\n       isSegmentViewEnabled && pageFilePath ? (\n-        <SegmentViewNode type={nodeName} pagePath={pageFilePath}>\n+        <SegmentViewNode\n+          type={isDefaultSegment ? 'default' : 'page'}\n+          pagePath={pageFilePath}\n+        >\n           {pageElement}\n         </SegmentViewNode>\n       ) : (\n@@ -931,7 +936,7 @@ async function createComponentTreeInternal({\n     const layoutFilePath = getConventionPathByType(tree, dir, 'layout')\n     const wrappedSegmentNode =\n       isSegmentViewEnabled && layoutFilePath ? (\n-        <SegmentViewNode type={nodeName} pagePath={layoutFilePath}>\n+        <SegmentViewNode type=\"layout\" pagePath={layoutFilePath}>\n           {segmentNode}\n         </SegmentViewNode>\n       ) : (\n@@ -1136,6 +1141,7 @@ function getConventionPathByType(\n     | 'loading'\n     | 'forbidden'\n     | 'unauthorized'\n+    | 'defaultPage'\n ) {\n   const modules = tree[2]\n   const conventionPath = modules[conventionType]"
        },
        {
            "sha": "cfabfcc499b4c294e7787ae7fc3daa2660092a1a",
            "filename": "test/development/app-dir/segment-explorer/app/page.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fpage.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -5,6 +5,8 @@ const hrefs = [\n   '/blog/~/grid',\n   '/soft-navigation/a',\n   '/file-segments',\n+  '/parallel-default',\n+  '/parallel-default/subroute',\n ]\n \n export default function Page() {"
        },
        {
            "sha": "ceaa4105ad9e0aa5a39795419d93292b2bbc232a",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/@bar/default.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Fdefault.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Default() {\n+  return '@bar default'\n+}"
        },
        {
            "sha": "2e09ca74cc17dd8e25b6552e7bd4140830fea40f",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/@bar/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Flayout.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Layout({ children }) {\n+  return (\n+    <div>\n+      <h1>@bar Layout</h1>\n+      <div id=\"bar-children\">{children}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "86d9ad310e688f37bd3feb97aed9e1d8dbf966be",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/@bar/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Fpage.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <div>Bar Slot</div>\n+}"
        },
        {
            "sha": "83be0d5a350c7fbb60ab290c702e50b7c7907cdc",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/@bar/subroute/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Fsubroute%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Fsubroute%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40bar%2Fsubroute%2Fpage.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <div>Subroute</div>\n+}"
        },
        {
            "sha": "9b071d1c39e10de7630683693836cf85883fc601",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/@foo/default.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40foo%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40foo%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40foo%2Fdefault.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Default() {\n+  return '@foo default'\n+}"
        },
        {
            "sha": "ab0a56dffff47aaeadeada66550149434b40275c",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/@foo/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40foo%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40foo%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40foo%2Flayout.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Layout({ children }) {\n+  return (\n+    <div>\n+      <h1>@foo Layout</h1>\n+      <div id=\"foo-children\">{children}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "0b03547a745eb5f1385d40f83a38dbd2b5384237",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/@foo/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40foo%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40foo%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2F%40foo%2Fpage.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <div>Foo Slot</div>\n+}"
        },
        {
            "sha": "0d8777ed565be657b489623b5bfc7a41e167e58b",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/default.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2Fdefault.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'default page'\n+}"
        },
        {
            "sha": "f03299713c30a8d082c083015f837213ea66bae4",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/layout.tsx",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2Flayout.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,24 @@\n+import Link from 'next/link'\n+\n+export default function Layout({ children, bar, foo }) {\n+  return (\n+    <div>\n+      <h1>Nested Layout</h1>\n+      <div>\n+        <div>\n+          <Link href=\"/parallel-default/subroute\">\n+            <div id=\"subroute-link\">Go to /parallel-default/subroute</div>\n+          </Link>\n+        </div>\n+        <div>\n+          <Link href=\"/parallel-default\">\n+            <div id=\"grid-link\">Go to /parallel-default</div>\n+          </Link>\n+        </div>\n+      </div>\n+      <div id=\"nested-children\">{children}</div>\n+      <div id=\"foo-slot\">{foo}</div>\n+      <div id=\"bar-slot\">{bar}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "10ff51e2d6aea105993813bf86ed83dd97fe52c7",
            "filename": "test/development/app-dir/segment-explorer/app/parallel-default/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fapp%2Fparallel-default%2Fpage.tsx?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <div>Hello from Nested</div>\n+}"
        },
        {
            "sha": "d12820f9408fdf63386192f8bc90410ef0bd15fd",
            "filename": "test/development/app-dir/segment-explorer/segment-explorer.test.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c54cc019028817db1bb652967181ebc34958c2e1/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts?ref=c54cc019028817db1bb652967181ebc34958c2e1",
            "patch": "@@ -189,4 +189,21 @@ describe('segment-explorer', () => {\n      error.tsx\"\n     `)\n   })\n+\n+  it('should display parallel routes default page when present', async () => {\n+    const browser = await next.browser('/parallel-default/subroute')\n+    expect(await getSegmentExplorerContent(browser)).toMatchInlineSnapshot(`\n+     \"app/\n+     layout.tsx\n+     parallel-default/\n+     layout.tsx\n+     default.tsx\n+     @bar/\n+     layout.tsx\n+     subroute/\n+     page.tsx\n+     @foo/\n+     default.tsx\"\n+    `)\n+  })\n })"
        }
    ],
    "stats": {
        "total": 99,
        "additions": 93,
        "deletions": 6
    }
}