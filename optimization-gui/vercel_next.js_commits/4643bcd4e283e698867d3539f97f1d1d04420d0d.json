{
    "author": "gaojude",
    "message": "doc: onNavigate (#77647)\n\n<!-- Thanks for opening a PR! Your contribution is much appreciated.\nTo make sure your PR is handled as smoothly as possible we request that\nyou follow the checklist sections below.\nChoose the right checklist for the change(s) that you're making:\n\n## For Contributors\n\n### Improving Documentation\n\n- Run `pnpm prettier-fix` to fix formatting issues before opening the\nPR.\n- Read the Docs Contribution Guide to ensure your contribution follows\nthe docs guidelines:\nhttps://nextjs.org/docs/community/contribution-guide\n\n### Adding or Updating Examples\n\n- The \"examples guidelines\" are followed from our contributing doc\nhttps://github.com/vercel/next.js/blob/canary/contributing/examples/adding-examples.md\n- Make sure the linting passes by running `pnpm build && pnpm lint`. See\nhttps://github.com/vercel/next.js/blob/canary/contributing/repository/linting.md\n\n### Fixing a bug\n\n- Related issues linked using `fixes #number`\n- Tests added. See:\nhttps://github.com/vercel/next.js/blob/canary/contributing/core/testing.md#writing-tests-for-nextjs\n- Errors have a helpful link attached, see\nhttps://github.com/vercel/next.js/blob/canary/contributing.md\n\n### Adding a feature\n\n- Implements an existing feature request or RFC. Make sure the feature\nrequest has been accepted for implementation before opening a PR. (A\ndiscussion must be opened, see\nhttps://github.com/vercel/next.js/discussions/new?category=ideas)\n- Related issues/discussions are linked using `fixes #number`\n- e2e tests added\n(https://github.com/vercel/next.js/blob/canary/contributing/core/testing.md#writing-tests-for-nextjs)\n- Documentation added\n- Telemetry added. In case of a feature if it's used or not.\n- Errors have a helpful link attached, see\nhttps://github.com/vercel/next.js/blob/canary/contributing.md\n\n\n## For Maintainers\n\n- Minimal description (aim for explaining to someone not on the team to\nunderstand the PR)\n- When linking to a Slack thread, you might want to share details of the\nconclusion\n- Link both the Linear (Fixes NEXT-xxx) and the GitHub issues\n- Add review comments if necessary to explain to the reviewer the logic\nbehind a change\n\n### What?\n\n### Why?\n\n### How?\n\nCloses NEXT-\nFixes #\n\n-->\n\n---------\n\nCo-authored-by: Lee Robinson <lee@leerob.com>\nCo-authored-by: Delba de Oliveira <32464864+delbaoliveira@users.noreply.github.com>",
    "sha": "4643bcd4e283e698867d3539f97f1d1d04420d0d",
    "files": [
        {
            "sha": "af0bb06ac2a673c17b9565d783781a5b3de0dbd5",
            "filename": "docs/01-app/04-api-reference/02-components/link.mdx",
            "status": "modified",
            "additions": 347,
            "deletions": 16,
            "changes": 363,
            "blob_url": "https://github.com/vercel/next.js/blob/4643bcd4e283e698867d3539f97f1d1d04420d0d/docs%2F01-app%2F04-api-reference%2F02-components%2Flink.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/4643bcd4e283e698867d3539f97f1d1d04420d0d/docs%2F01-app%2F04-api-reference%2F02-components%2Flink.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F04-api-reference%2F02-components%2Flink.mdx?ref=4643bcd4e283e698867d3539f97f1d1d04420d0d",
            "patch": "@@ -55,27 +55,29 @@ The following props can be passed to the `<Link>` component:\n \n <PagesOnly>\n \n-| Prop                                | Example                 | Type              | Required |\n-| ----------------------------------- | ----------------------- | ----------------- | -------- |\n-| [`href`](#href-required)            | `href=\"/dashboard\"`     | String or Object  | Yes      |\n-| [`replace`](#replace)               | `replace={false}`       | Boolean           | -        |\n-| [`scroll`](#scroll)                 | `scroll={false}`        | Boolean           | -        |\n-| [`prefetch`](#prefetch)             | `prefetch={false}`      | Boolean           | -        |\n-| [`legacyBehavior`](#legacybehavior) | `legacyBehavior={true}` | Boolean           | -        |\n-| [`passHref`](#passhref)             | `passHref={true}`       | Boolean           | -        |\n-| [`shallow`](#shallow)               | `shallow={false}`       | Boolean           | -        |\n-| [`locale`](#locale)                 | `locale=\"fr\"`           | String or Boolean | -        |\n+| Prop                                | Example                  | Type              | Required |\n+| ----------------------------------- | ------------------------ | ----------------- | -------- |\n+| [`href`](#href-required)            | `href=\"/dashboard\"`      | String or Object  | Yes      |\n+| [`replace`](#replace)               | `replace={false}`        | Boolean           | -        |\n+| [`scroll`](#scroll)                 | `scroll={false}`         | Boolean           | -        |\n+| [`prefetch`](#prefetch)             | `prefetch={false}`       | Boolean           | -        |\n+| [`legacyBehavior`](#legacybehavior) | `legacyBehavior={true}`  | Boolean           | -        |\n+| [`passHref`](#passhref)             | `passHref={true}`        | Boolean           | -        |\n+| [`shallow`](#shallow)               | `shallow={false}`        | Boolean           | -        |\n+| [`locale`](#locale)                 | `locale=\"fr\"`            | String or Boolean | -        |\n+| [`onNavigate`](#onnavigate)         | `onNavigate={(e) => {}}` | Function          | -        |\n \n </PagesOnly>\n \n <AppOnly>\n \n-| Prop                     | Example             | Type             | Required |\n-| ------------------------ | ------------------- | ---------------- | -------- |\n-| [`href`](#href-required) | `href=\"/dashboard\"` | String or Object | Yes      |\n-| [`replace`](#replace)    | `replace={false}`   | Boolean          | -        |\n-| [`scroll`](#scroll)      | `scroll={false}`    | Boolean          | -        |\n-| [`prefetch`](#prefetch)  | `prefetch={false}`  | Boolean or null  | -        |\n+| Prop                        | Example                  | Type             | Required |\n+| --------------------------- | ------------------------ | ---------------- | -------- |\n+| [`href`](#href-required)    | `href=\"/dashboard\"`      | String or Object | Yes      |\n+| [`replace`](#replace)       | `replace={false}`        | Boolean          | -        |\n+| [`scroll`](#scroll)         | `scroll={false}`         | Boolean          | -        |\n+| [`prefetch`](#prefetch)     | `prefetch={false}`       | Boolean or null  | -        |\n+| [`onNavigate`](#onnavigate) | `onNavigate={(e) => {}}` | Function         | -        |\n \n </AppOnly>\n \n@@ -450,6 +452,58 @@ export default function Home() {\n \n </PagesOnly>\n \n+### `onNavigate`\n+\n+An event handler called during client-side navigation. The handler receives an event object that includes a `preventDefault()` method, allowing you to cancel the navigation if needed.\n+\n+```tsx filename=\"app/page.tsx\" switcher\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <Link\n+      href=\"/dashboard\"\n+      onNavigate={(e) => {\n+        // Only executes during SPA navigation\n+        console.log('Navigating...')\n+\n+        // Optionally prevent navigation\n+        // e.preventDefault()\n+      }}\n+    >\n+      Dashboard\n+    </Link>\n+  )\n+}\n+```\n+\n+```jsx filename=\"app/page.js\" switcher\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <Link\n+      href=\"/dashboard\"\n+      onNavigate={(e) => {\n+        // Only executes during SPA navigation\n+        console.log('Navigating...')\n+\n+        // Optionally prevent navigation\n+        // e.preventDefault()\n+      }}\n+    >\n+      Dashboard\n+    </Link>\n+  )\n+}\n+```\n+\n+> **Good to know**: While `onClick` and `onNavigate` may seem similar, they serve different purposes. `onClick` executes for all click events, while `onNavigate` only runs during client-side navigation. Some key differences:\n+>\n+> - When using modifier keys (`Ctrl`/`Cmd` + Click), `onClick` executes but `onNavigate` doesn't since Next.js prevents default navigation for new tabs.\n+> - External URLs won't trigger `onNavigate` since it's only for client-side and same-origin navigations.\n+> - Links with the `download` attribute will work with `onClick` but not `onNavigate` since the browser will treat the linked URL as a download.\n+\n ## Examples\n \n The following examples demonstrate how to use the `<Link>` component in different scenarios.\n@@ -1178,10 +1232,287 @@ export default function Home() {\n \n </PagesOnly>\n \n+### Blocking navigation\n+\n+You can use the `onNavigate` prop to block navigation when certain conditions are met, such as when a form has unsaved changes. When you need to block navigation across multiple components in your app (like preventing navigation from any link while a form is being edited), React Context provides a clean way to share this blocking state. First, create a context to track the navigation blocking state:\n+\n+```tsx filename=\"app/contexts/navigation-blocker.tsx\" switcher\n+'use client'\n+\n+import { createContext, useState, useContext } from 'react'\n+\n+interface NavigationBlockerContextType {\n+  isBlocked: boolean\n+  setIsBlocked: (isBlocked: boolean) => void\n+}\n+\n+export const NavigationBlockerContext =\n+  createContext<NavigationBlockerContextType>({\n+    isBlocked: false,\n+    setIsBlocked: () => {},\n+  })\n+\n+export function NavigationBlockerProvider({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  const [isBlocked, setIsBlocked] = useState(false)\n+\n+  return (\n+    <NavigationBlockerContext.Provider value={{ isBlocked, setIsBlocked }}>\n+      {children}\n+    </NavigationBlockerContext.Provider>\n+  )\n+}\n+\n+export function useNavigationBlocker() {\n+  return useContext(NavigationBlockerContext)\n+}\n+```\n+\n+```jsx filename=\"app/contexts/navigation-blocker.js\" switcher\n+'use client'\n+\n+import { createContext, useState, useContext } from 'react'\n+\n+export const NavigationBlockerContext = createContext({\n+  isBlocked: false,\n+  setIsBlocked: () => {},\n+})\n+\n+export function NavigationBlockerProvider({ children }) {\n+  const [isBlocked, setIsBlocked] = useState(false)\n+\n+  return (\n+    <NavigationBlockerContext.Provider value={{ isBlocked, setIsBlocked }}>\n+      {children}\n+    </NavigationBlockerContext.Provider>\n+  )\n+}\n+\n+export function useNavigationBlocker() {\n+  return useContext(NavigationBlockerContext)\n+}\n+```\n+\n+Create a form component that uses the context:\n+\n+```tsx filename=\"app/components/form.tsx\" switcher\n+'use client'\n+\n+import { useNavigationBlocker } from '../contexts/navigation-blocker'\n+\n+export default function Form() {\n+  const { setIsBlocked } = useNavigationBlocker()\n+\n+  return (\n+    <form\n+      onSubmit={(e) => {\n+        e.preventDefault()\n+        setIsBlocked(false)\n+      }}\n+      onChange={() => setIsBlocked(true)}\n+    >\n+      <input type=\"text\" name=\"name\" />\n+      <button type=\"submit\">Save</button>\n+    </form>\n+  )\n+}\n+```\n+\n+```jsx filename=\"app/components/form.js\" switcher\n+'use client'\n+\n+import { useNavigationBlocker } from '../contexts/navigation-blocker'\n+\n+export default function Form() {\n+  const { setIsBlocked } = useNavigationBlocker()\n+\n+  return (\n+    <form\n+      onSubmit={(e) => {\n+        e.preventDefault()\n+        setIsBlocked(false)\n+      }}\n+      onChange={() => setIsBlocked(true)}\n+    >\n+      <input type=\"text\" name=\"name\" />\n+      <button type=\"submit\">Save</button>\n+    </form>\n+  )\n+}\n+```\n+\n+Create a custom Link component that blocks navigation:\n+\n+```tsx filename=\"app/components/custom-link.tsx\" switcher\n+'use client'\n+\n+import Link from 'next/link'\n+import { useNavigationBlocker } from '../contexts/navigation-blocker'\n+\n+interface CustomLinkProps extends React.ComponentProps<typeof Link> {\n+  children: React.ReactNode\n+}\n+\n+export function CustomLink({ children, ...props }: CustomLinkProps) {\n+  const { isBlocked } = useNavigationBlocker()\n+\n+  return (\n+    <Link\n+      onNavigate={(e) => {\n+        if (isBlocked) {\n+          e.preventDefault()\n+          if (!window.confirm('You have unsaved changes. Leave anyway?')) {\n+            e.preventDefault()\n+          }\n+        }\n+      }}\n+      {...props}\n+    >\n+      {children}\n+    </Link>\n+  )\n+}\n+```\n+\n+```jsx filename=\"app/components/custom-link.js\" switcher\n+'use client'\n+\n+import Link from 'next/link'\n+import { useNavigationBlocker } from '../contexts/navigation-blocker'\n+\n+export function CustomLink({ children, ...props }) {\n+  const { isBlocked } = useNavigationBlocker()\n+\n+  return (\n+    <Link\n+      onNavigate={(e) => {\n+        if (isBlocked) {\n+          e.preventDefault()\n+          if (!window.confirm('You have unsaved changes. Leave anyway?')) {\n+            e.preventDefault()\n+          }\n+        }\n+      }}\n+      {...props}\n+    >\n+      {children}\n+    </Link>\n+  )\n+}\n+```\n+\n+Create a navigation component:\n+\n+```tsx filename=\"app/components/nav.tsx\" switcher\n+'use client'\n+\n+import { CustomLink as Link } from './custom-link'\n+\n+export default function Nav() {\n+  return (\n+    <nav>\n+      <Link href=\"/\">Home</Link>\n+      <Link href=\"/about\">About</Link>\n+    </nav>\n+  )\n+}\n+```\n+\n+```jsx filename=\"app/components/nav.js\" switcher\n+'use client'\n+\n+import { CustomLink as Link } from './custom-link'\n+\n+export default function Nav() {\n+  return (\n+    <nav>\n+      <Link href=\"/\">Home</Link>\n+      <Link href=\"/about\">About</Link>\n+    </nav>\n+  )\n+}\n+```\n+\n+Finally, wrap your app with the `NavigationBlockerProvider` in the root layout and use the components in your page:\n+\n+```tsx filename=\"app/layout.tsx\" switcher\n+import { NavigationBlockerProvider } from './contexts/navigation-blocker'\n+\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html lang=\"en\">\n+      <body>\n+        <NavigationBlockerProvider>{children}</NavigationBlockerProvider>\n+      </body>\n+    </html>\n+  )\n+}\n+```\n+\n+```jsx filename=\"app/layout.js\" switcher\n+import { NavigationBlockerProvider } from './contexts/navigation-blocker'\n+\n+export default function RootLayout({ children }) {\n+  return (\n+    <html lang=\"en\">\n+      <body>\n+        <NavigationBlockerProvider>{children}</NavigationBlockerProvider>\n+      </body>\n+    </html>\n+  )\n+}\n+```\n+\n+Then, use the `Nav` and `Form` components in your page:\n+\n+```tsx filename=\"app/page.tsx\" switcher\n+import Nav from './components/nav'\n+import Form from './components/form'\n+\n+export default function Page() {\n+  return (\n+    <div>\n+      <Nav />\n+      <main>\n+        <h1>Welcome to the Dashboard</h1>\n+        <Form />\n+      </main>\n+    </div>\n+  )\n+}\n+```\n+\n+```jsx filename=\"app/page.js\" switcher\n+import Nav from './components/nav'\n+import Form from './components/form'\n+\n+export default function Page() {\n+  return (\n+    <div>\n+      <Nav />\n+      <main>\n+        <h1>Welcome to the Dashboard</h1>\n+        <Form />\n+      </main>\n+    </div>\n+  )\n+}\n+```\n+\n+When a user tries to navigate away using `CustomLink` while the form has unsaved changes, they'll be prompted to confirm before leaving.\n+\n ## Version history\n \n | Version   | Changes                                                                                                                                                                                         |\n | --------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |\n+| `v15.3.0` | Add `onNavigate` API                                                                                                                                                                            |\n | `v13.0.0` | No longer requires a child `<a>` tag. A [codemod](/docs/app/building-your-application/upgrading/codemods#remove-a-tags-from-link-components) is provided to automatically update your codebase. |\n | `v10.0.0` | `href` props pointing to a dynamic route are automatically resolved and no longer require an `as` prop.                                                                                         |\n | `v8.0.0`  | Improved prefetching performance.                                                                                                                                                               |"
        }
    ],
    "stats": {
        "total": 363,
        "additions": 347,
        "deletions": 16
    }
}