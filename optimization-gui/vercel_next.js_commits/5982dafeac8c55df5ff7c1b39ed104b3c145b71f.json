{
    "author": "devjiwonchoi",
    "message": "[ts-next-plugin] fix: properly exit when failed to initialize (#77842)\n\n### Why?\n\nThe plugin false-negatively logged that the initialization failed. Also,\nit didn't properly exit when it failed.",
    "sha": "5982dafeac8c55df5ff7c1b39ed104b3c145b71f",
    "files": [
        {
            "sha": "ad6823d2c01b9aa875a14615b16f0024b6e3770d",
            "filename": "packages/next/src/server/typescript/index.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/5982dafeac8c55df5ff7c1b39ed104b3c145b71f/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5982dafeac8c55df5ff7c1b39ed104b3c145b71f/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Findex.ts?ref=5982dafeac8c55df5ff7c1b39ed104b3c145b71f",
            "patch": "@@ -39,7 +39,12 @@ export const createTSPlugin: tsModule.server.PluginModuleFactory = ({\n     // The default user config is { \"name\": \"next\" }\n     const isPluginEnabled = info.config.enabled ?? true\n \n-    if (!isPluginEnabled) {\n+    const isPluginInitialized = init({\n+      ts,\n+      info,\n+    })\n+\n+    if (!isPluginEnabled || !isPluginInitialized) {\n       return info.languageService\n     }\n \n@@ -51,11 +56,6 @@ export const createTSPlugin: tsModule.server.PluginModuleFactory = ({\n       proxy[k] = (...args: Array<{}>) => x.apply(info.languageService, args)\n     }\n \n-    init({\n-      ts,\n-      info,\n-    })\n-\n     // Auto completion\n     proxy.getCompletionsAtPosition = (\n       fileName: string,"
        },
        {
            "sha": "c272809b7f82c857c21250612ace0233cd12726f",
            "filename": "packages/next/src/server/typescript/utils.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/5982dafeac8c55df5ff7c1b39ed104b3c145b71f/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5982dafeac8c55df5ff7c1b39ed104b3c145b71f/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Futils.ts?ref=5982dafeac8c55df5ff7c1b39ed104b3c145b71f",
            "patch": "@@ -23,7 +23,7 @@ export function log(message: string) {\n export function init(opts: {\n   ts: TypeScript\n   info: tsModule.server.PluginCreateInfo\n-}) {\n+}): boolean {\n   const projectDir = opts.info.project.getCurrentDirectory()\n   ts = opts.ts\n   info = opts.info\n@@ -48,14 +48,15 @@ export function init(opts: {\n     compilerOptions\n   )\n \n-  if (virtualTsEnv) {\n+  if (!virtualTsEnv) {\n     log(\n       'Failed to create virtual TypeScript environment. This is a bug in Next.js TypeScript plugin. Please report it by opening an issue at https://github.com/vercel/next.js/issues.'\n     )\n-    return\n+    return false\n   }\n \n   log('Successfully initialized Next.js TypeScript plugin!')\n+  return true\n }\n \n export function getTs() {"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 10,
        "deletions": 9
    }
}