{
    "author": "eps1lon",
    "message": "[dev-overlay] Inject `get*Stack` implementation (#79789)\n\nThe stitched-errors module will live in a different layer than the dev-overlay.\r\nIn that future we need to pass the `get*Stack` implementations to the dev-overlay.\r\n\r\nRight now it's not meaningful but makes future diffs smaller.",
    "sha": "6d8bcd6255e805baf534c08f4f026879d82dd9fe",
    "files": [
        {
            "sha": "c86f5b64a3d66b82d1fc6d57dee90fdb53faafed",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/hot-reloader-client.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/6d8bcd6255e805baf534c08f4f026879d82dd9fe/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/6d8bcd6255e805baf534c08f4f026879d82dd9fe/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx?ref=6d8bcd6255e805baf534c08f4f026879d82dd9fe",
            "patch": "@@ -44,6 +44,7 @@ import type { DevIndicatorServerState } from '../../../../server/dev/dev-indicat\n import reportHmrLatency from '../utils/report-hmr-latency'\n import { TurbopackHmr } from '../utils/turbopack-hot-reloader-common'\n import { NEXT_HMR_REFRESH_HASH_COOKIE } from '../../app-router-headers'\n+import { getComponentStack, getOwnerStack } from '../../errors/stitched-error'\n \n export interface Dispatcher {\n   onBuildOk(): void\n@@ -479,7 +480,11 @@ export default function HotReload({\n   children: ReactNode\n   globalError: [GlobalErrorComponent, React.ReactNode]\n }) {\n-  const [state, dispatch] = useErrorOverlayReducer('app')\n+  const [state, dispatch] = useErrorOverlayReducer(\n+    'app',\n+    getComponentStack,\n+    getOwnerStack\n+  )\n \n   const dispatcher = useMemo<Dispatcher>(() => {\n     return {"
        },
        {
            "sha": "d2fdc8f6f64697ae94b174e25c674638da64106a",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/hooks.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/6d8bcd6255e805baf534c08f4f026879d82dd9fe/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhooks.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6d8bcd6255e805baf534c08f4f026879d82dd9fe/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhooks.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhooks.ts?ref=6d8bcd6255e805baf534c08f4f026879d82dd9fe",
            "patch": "@@ -2,9 +2,14 @@ import React from 'react'\n import * as Bus from './bus'\n import { useErrorOverlayReducer } from '../shared'\n import { Router } from '../../../router'\n+import { getComponentStack, getOwnerStack } from '../../errors/stitched-error'\n \n export const usePagesDevOverlay = () => {\n-  const [state, dispatch] = useErrorOverlayReducer('pages')\n+  const [state, dispatch] = useErrorOverlayReducer(\n+    'pages',\n+    getComponentStack,\n+    getOwnerStack\n+  )\n \n   React.useEffect(() => {\n     Bus.on(dispatch)"
        },
        {
            "sha": "77b3beed0785a657628522b15e3ef94d4412806a",
            "filename": "packages/next/src/client/components/react-dev-overlay/shared.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 34,
            "changes": 71,
            "blob_url": "https://github.com/vercel/next.js/blob/6d8bcd6255e805baf534c08f4f026879d82dd9fe/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6d8bcd6255e805baf534c08f4f026879d82dd9fe/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts?ref=6d8bcd6255e805baf534c08f4f026879d82dd9fe",
            "patch": "@@ -7,7 +7,6 @@ import type { DebugInfo } from './types'\n import type { DevIndicatorServerState } from '../../../server/dev/dev-indicator-server-state'\n import type { HMR_ACTION_TYPES } from '../../../server/dev/hot-reloader-types'\n import { parseStack } from './utils/parse-stack'\n-import { getComponentStack, getOwnerStack } from '../errors/stitched-error'\n \n type FastRefreshState =\n   /** No refresh in progress. */\n@@ -130,38 +129,6 @@ function getStackIgnoringStrictMode(stack: string | undefined) {\n   return stack?.split(REACT_ERROR_STACK_BOTTOM_FRAME_REGEX)[0]\n }\n \n-function pushErrorFilterDuplicates(\n-  events: SupportedErrorEvent[],\n-  id: number,\n-  error: Error\n-): SupportedErrorEvent[] {\n-  const componentStack = getComponentStack(error)\n-  const componentStackFrames =\n-    componentStack === undefined\n-      ? undefined\n-      : parseComponentStack(componentStack)\n-  const ownerStack = getOwnerStack(error)\n-  const frames = parseStack((error.stack || '') + (ownerStack || ''))\n-  const pendingEvent: SupportedErrorEvent = {\n-    id,\n-    error,\n-    frames,\n-    componentStackFrames,\n-  }\n-  const pendingEvents = events.filter((event) => {\n-    // Filter out duplicate errors\n-    return (\n-      (event.error.stack !== pendingEvent.error.stack &&\n-        // TODO: Let ReactDevTools control deduping instead?\n-        getStackIgnoringStrictMode(event.error.stack) !==\n-          getStackIgnoringStrictMode(pendingEvent.error.stack)) ||\n-      getOwnerStack(event.error) !== getOwnerStack(pendingEvent.error)\n-    )\n-  })\n-  pendingEvents.push(pendingEvent)\n-  return pendingEvents\n-}\n-\n const shouldDisableDevIndicator =\n   process.env.__NEXT_DEV_INDICATOR?.toString() === 'false'\n \n@@ -199,7 +166,43 @@ function getInitialState(\n   }\n }\n \n-export function useErrorOverlayReducer(routerType: 'pages' | 'app') {\n+export function useErrorOverlayReducer(\n+  routerType: 'pages' | 'app',\n+  getComponentStack: (error: Error) => string | undefined,\n+  getOwnerStack: (error: Error) => string | null | undefined\n+) {\n+  function pushErrorFilterDuplicates(\n+    events: SupportedErrorEvent[],\n+    id: number,\n+    error: Error\n+  ): SupportedErrorEvent[] {\n+    const componentStack = getComponentStack(error)\n+    const componentStackFrames =\n+      componentStack === undefined\n+        ? undefined\n+        : parseComponentStack(componentStack)\n+    const ownerStack = getOwnerStack(error)\n+    const frames = parseStack((error.stack || '') + (ownerStack || ''))\n+    const pendingEvent: SupportedErrorEvent = {\n+      id,\n+      error,\n+      frames,\n+      componentStackFrames,\n+    }\n+    const pendingEvents = events.filter((event) => {\n+      // Filter out duplicate errors\n+      return (\n+        (event.error.stack !== pendingEvent.error.stack &&\n+          // TODO: Let ReactDevTools control deduping instead?\n+          getStackIgnoringStrictMode(event.error.stack) !==\n+            getStackIgnoringStrictMode(pendingEvent.error.stack)) ||\n+        getOwnerStack(event.error) !== getOwnerStack(pendingEvent.error)\n+      )\n+    })\n+    pendingEvents.push(pendingEvent)\n+    return pendingEvents\n+  }\n+\n   return useReducer((state: OverlayState, action: BusEvent): OverlayState => {\n     switch (action.type) {\n       case ACTION_DEBUG_INFO: {"
        }
    ],
    "stats": {
        "total": 85,
        "additions": 49,
        "deletions": 36
    }
}