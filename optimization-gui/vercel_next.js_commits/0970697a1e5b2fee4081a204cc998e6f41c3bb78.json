{
    "author": "huozhi",
    "message": "test: migrate streaming edge runtime tests to e2e test (#76176)",
    "sha": "0970697a1e5b2fee4081a204cc998e6f41c3bb78",
    "files": [
        {
            "sha": "97cd1c985e192d6ab87bc54744a6483426a837ca",
            "filename": "test/e2e/streaming-ssr-edge/components/bar.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fcomponents%2Fbar.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fcomponents%2Fbar.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fcomponents%2Fbar.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "previous_filename": "test/integration/react-streaming/app/components/bar.js"
        },
        {
            "sha": "66d4ff2dabfa421ed334c1b4225b94f5a30d15da",
            "filename": "test/e2e/streaming-ssr-edge/components/foo.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fcomponents%2Ffoo.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fcomponents%2Ffoo.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fcomponents%2Ffoo.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "previous_filename": "test/integration/react-streaming/app/components/foo.js"
        },
        {
            "sha": "9b643c13f00b9d74021249e54cd4bebc59c6f6e0",
            "filename": "test/e2e/streaming-ssr-edge/pages/404.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2F404.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2F404.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2F404.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "previous_filename": "test/integration/react-streaming/app/pages/404.js"
        },
        {
            "sha": "2e6a4c7bc95353eeab09566d528183d77142d345",
            "filename": "test/e2e/streaming-ssr-edge/pages/500.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2F500.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2F500.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2F500.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page500() {\n+  return 'custom-500-page'\n+}"
        },
        {
            "sha": "81db3d3cbe800c8a44ca0f724dd8ebf5ec7670bf",
            "filename": "test/e2e/streaming-ssr-edge/pages/dynamic-imports.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Fdynamic-imports.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Fdynamic-imports.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Fdynamic-imports.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "previous_filename": "test/integration/react-streaming/app/pages/dynamic-imports.js"
        },
        {
            "sha": "99b82754213fe48175e76826e460ff49f6a57b1f",
            "filename": "test/e2e/streaming-ssr-edge/pages/err/index.js",
            "status": "renamed",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Ferr%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Ferr%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Ferr%2Findex.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "patch": "@@ -1,5 +1,5 @@\n const page = () => 'page with err'\n page.getInitialProps = () => {\n-  throw new Error('oops')\n+  throw new Error('gip-oops')\n }\n export default page",
            "previous_filename": "test/integration/react-streaming/app/pages/err/index.js"
        },
        {
            "sha": "a5bc872d778fe67fdca1b09baeba34752db4d63a",
            "filename": "test/e2e/streaming-ssr-edge/pages/err/render.js",
            "status": "renamed",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Ferr%2Frender.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Ferr%2Frender.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Ferr%2Frender.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "patch": "@@ -1,7 +1,5 @@\n-let did = false\n export default function MyError() {\n-  if (!did && typeof window === 'undefined') {\n-    did = true\n+  if (typeof window === 'undefined') {\n     throw new Error('oops')\n   }\n }",
            "previous_filename": "test/integration/react-streaming/app/pages/err/render.js"
        },
        {
            "sha": "32bb9bca6a6c056abbbdee11f3a92ab79d344a2b",
            "filename": "test/e2e/streaming-ssr-edge/pages/err/suspense.js",
            "status": "renamed",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Ferr%2Fsuspense.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Ferr%2Fsuspense.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Ferr%2Fsuspense.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "patch": "@@ -1,9 +1,7 @@\n import { Suspense } from 'react'\n \n-let did = false\n function MyError() {\n-  if (!did && typeof window === 'undefined') {\n-    did = true\n+  if (typeof window === 'undefined') {\n     throw new Error('oops')\n   }\n }",
            "previous_filename": "test/integration/react-streaming/app/pages/err/suspense.js"
        },
        {
            "sha": "d2e1b2d426df71abe51c81a30b37aa37a6ebd564",
            "filename": "test/e2e/streaming-ssr-edge/pages/streaming-single-export.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Fstreaming-single-export.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Fstreaming-single-export.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Fstreaming-single-export.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "previous_filename": "test/integration/react-streaming/app/pages/streaming-single-export.js"
        },
        {
            "sha": "71c3f071de1b78ef6de4e7767ac47f988f266b8a",
            "filename": "test/e2e/streaming-ssr-edge/pages/streaming.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Fstreaming.js",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Fstreaming.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fpages%2Fstreaming.js?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "previous_filename": "test/integration/react-streaming/app/pages/streaming.js"
        },
        {
            "sha": "12a240403b81779edc080c04884f40c9e8ca989d",
            "filename": "test/e2e/streaming-ssr-edge/streaming-ssr-edge.test.ts",
            "status": "added",
            "additions": 110,
            "deletions": 0,
            "changes": 110,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fstreaming-ssr-edge.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fe2e%2Fstreaming-ssr-edge%2Fstreaming-ssr-edge.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fstreaming-ssr-edge%2Fstreaming-ssr-edge.test.ts?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "patch": "@@ -0,0 +1,110 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import cheerio from 'cheerio'\n+\n+function getNodeBySelector(html, selector) {\n+  const $ = cheerio.load(html)\n+  return $(selector)\n+}\n+\n+async function resolveStreamResponse(response, onData) {\n+  let result = ''\n+  onData = onData || (() => {})\n+  await new Promise((resolve) => {\n+    response.body.on('data', (chunk) => {\n+      result += chunk.toString()\n+      onData(chunk.toString(), result)\n+    })\n+\n+    response.body.on('end', resolve)\n+  })\n+  return result\n+}\n+\n+describe('streaming-ssr-edge', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should support streaming for fizz response', async () => {\n+    async function testStreamingResponse(pathname) {\n+      await next.fetch(pathname).then(async (response) => {\n+        let gotFallback = false\n+        let gotData = false\n+\n+        await resolveStreamResponse(response, (_, result) => {\n+          gotData = result.includes('next_streaming_data')\n+          if (!gotFallback) {\n+            gotFallback = result.includes('next_streaming_fallback')\n+            if (gotFallback) {\n+              expect(gotData).toBe(false)\n+            }\n+          }\n+        })\n+\n+        // Streaming is disabled for pages, no fallback should be rendered.\n+        expect(gotFallback).toBe(false)\n+        expect(gotData).toBe(true)\n+      })\n+\n+      // Should end up with \"next_streaming_data\".\n+      const browser = await next.browser(pathname)\n+      const content = await browser.eval(`window.document.body.innerText`)\n+      expect(content).toMatchInlineSnapshot('\"next_streaming_data\"')\n+    }\n+\n+    await testStreamingResponse('/streaming')\n+    await testStreamingResponse('/streaming-single-export')\n+  })\n+\n+  it('should not stream to crawlers or google pagerender bot', async () => {\n+    const res1 = await next.fetch('/streaming', {\n+      headers: {\n+        'user-agent': 'Googlebot',\n+      },\n+    })\n+\n+    const res2 = await next.fetch('/streaming', {\n+      headers: {\n+        'user-agent':\n+          'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36 Google-PageRenderer Google (+https://developers.google.com/+/web/snippet/)',\n+      },\n+    })\n+    let flushCount = 0\n+    await resolveStreamResponse(res2, () => {\n+      flushCount++\n+    })\n+    expect(flushCount).toBe(1)\n+    const html = await res1.text()\n+    const body = await getNodeBySelector(html, '#__next')\n+    // Resolve data instead of fallback\n+    expect(body.text()).toBe('next_streaming_data')\n+\n+    expect(res1.headers.get('etag')).toBeDefined()\n+    expect(res2.headers.get('etag')).toBeDefined()\n+  })\n+\n+  it('should render 500 error from gIP correctly', async () => {\n+    const html = await next.render('/err')\n+    if (isNextDev) {\n+      // In development mode it should show the error popup.\n+      expect(html).toContain('Error: gip-oops')\n+    } else {\n+      expect(html).toContain('custom-500-page')\n+    }\n+  })\n+\n+  it('should render 500 error from render function correctly', async () => {\n+    const html = await next.render('/err/render')\n+    if (isNextDev) {\n+      // In development mode it should show the error popup.\n+      expect(html).toContain('Error: oops')\n+    } else {\n+      expect(html).toContain('custom-500-page')\n+    }\n+  })\n+\n+  it('should render fallback if error raised from suspense during streaming', async () => {\n+    const html = await next.render('/err/suspense')\n+    expect(html).toContain('error-fallback')\n+  })\n+})"
        },
        {
            "sha": "afb1f219ebcf73b336f589de2a3f9d687fb54da2",
            "filename": "test/integration/react-streaming/app/.env",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Fapp%2F.env",
            "raw_url": "https://github.com/vercel/next.js/raw/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Fapp%2F.env",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-streaming%2Fapp%2F.env?ref=1b845bd997fc3ff374ee6909a24a40fd889a0f22",
            "patch": "@@ -1 +0,0 @@\n-ENV_VAR_TEST=\"env_var_test\"\n\\ No newline at end of file"
        },
        {
            "sha": "299559b3bd6230479d659edc798477e4297b67e6",
            "filename": "test/integration/react-streaming/app/package.json",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Fapp%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Fapp%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-streaming%2Fapp%2Fpackage.json?ref=1b845bd997fc3ff374ee6909a24a40fd889a0f22",
            "patch": "@@ -1,11 +0,0 @@\n-{\n-  \"private\": true,\n-  \"scripts\": {\n-    \"dev\": \"next dev\",\n-    \"build\": \"next build\",\n-    \"start\": \"next start\"\n-  },\n-  \"dependencies\": {\n-    \"moment\": \"*\"\n-  }\n-}"
        },
        {
            "sha": "33ebbce0db69a89068129718d65595ad7785dd92",
            "filename": "test/integration/react-streaming/app/styles.css",
            "status": "removed",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Fapp%2Fstyles.css",
            "raw_url": "https://github.com/vercel/next.js/raw/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Fapp%2Fstyles.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-streaming%2Fapp%2Fstyles.css?ref=1b845bd997fc3ff374ee6909a24a40fd889a0f22",
            "patch": "@@ -1,3 +0,0 @@\n-#red {\n-  color: red;\n-}"
        },
        {
            "sha": "3d7146c5589fd0bbfc4d03737f75cce18d08cc93",
            "filename": "test/integration/react-streaming/test/index.test.js",
            "status": "removed",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-streaming%2Ftest%2Findex.test.js?ref=1b845bd997fc3ff374ee6909a24a40fd889a0f22",
            "patch": "@@ -1,30 +0,0 @@\n-/* eslint-env jest */\n-\n-import { join } from 'path'\n-import { File, runDevSuite, runProdSuite } from 'next-test-utils'\n-import streaming from './streaming'\n-\n-const page500 = `\n-export default function Page500() {\n-  return 'custom-500-page'\n-}\n-`\n-\n-const appDir = join(__dirname, '../app')\n-const error500Page = new File(join(appDir, 'pages/500.js'))\n-\n-const testSuite = {\n-  runTests: (context, env) => {\n-    const options = { env }\n-    streaming(context, options)\n-  },\n-  beforeAll: () => {\n-    error500Page.write(page500)\n-  },\n-  afterAll: () => {\n-    error500Page.delete()\n-  },\n-}\n-\n-runDevSuite('streaming dev', appDir, testSuite)\n-runProdSuite('streaming prod', appDir, testSuite)"
        },
        {
            "sha": "db0f826b28549abdfba8c40286db4a947f124c35",
            "filename": "test/integration/react-streaming/test/streaming.js",
            "status": "removed",
            "additions": 0,
            "deletions": 114,
            "changes": 114,
            "blob_url": "https://github.com/vercel/next.js/blob/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Ftest%2Fstreaming.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Ftest%2Fstreaming.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-streaming%2Ftest%2Fstreaming.js?ref=1b845bd997fc3ff374ee6909a24a40fd889a0f22",
            "patch": "@@ -1,114 +0,0 @@\n-/* eslint-env jest */\n-import webdriver from 'next-webdriver'\n-import cheerio from 'cheerio'\n-import { fetchViaHTTP, renderViaHTTP } from 'next-test-utils'\n-\n-function getNodeBySelector(html, selector) {\n-  const $ = cheerio.load(html)\n-  return $(selector)\n-}\n-\n-async function resolveStreamResponse(response, onData) {\n-  let result = ''\n-  onData = onData || (() => {})\n-  await new Promise((resolve) => {\n-    response.body.on('data', (chunk) => {\n-      result += chunk.toString()\n-      onData(chunk.toString(), result)\n-    })\n-\n-    response.body.on('end', resolve)\n-  })\n-  return result\n-}\n-\n-export default function (context, { env }) {\n-  it('should support streaming for fizz response', async () => {\n-    async function testStreamingResponse(pathname) {\n-      await fetchViaHTTP(context.appPort, pathname, null, {}).then(\n-        async (response) => {\n-          let gotFallback = false\n-          let gotData = false\n-\n-          await resolveStreamResponse(response, (_, result) => {\n-            gotData = result.includes('next_streaming_data')\n-            if (!gotFallback) {\n-              gotFallback = result.includes('next_streaming_fallback')\n-              if (gotFallback) {\n-                expect(gotData).toBe(false)\n-              }\n-            }\n-          })\n-\n-          // Streaming is disabled for pages, no fallback should be rendered.\n-          expect(gotFallback).toBe(false)\n-          expect(gotData).toBe(true)\n-        }\n-      )\n-\n-      // Should end up with \"next_streaming_data\".\n-      const browser = await webdriver(context.appPort, pathname)\n-      const content = await browser.eval(`window.document.body.innerText`)\n-      expect(content).toMatchInlineSnapshot('\"next_streaming_data\"')\n-    }\n-\n-    await testStreamingResponse('/streaming')\n-    await testStreamingResponse('/streaming-single-export')\n-  })\n-\n-  it('should not stream to crawlers or google pagerender bot', async () => {\n-    const res1 = await fetchViaHTTP(\n-      context.appPort,\n-      '/streaming',\n-      {},\n-      {\n-        headers: {\n-          'user-agent': 'Googlebot',\n-        },\n-      }\n-    )\n-\n-    const res2 = await fetchViaHTTP(\n-      context.appPort,\n-      '/streaming',\n-      {},\n-      {\n-        headers: {\n-          'user-agent':\n-            'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/56.0.2924.87 Safari/537.36 Google-PageRenderer Google (+https://developers.google.com/+/web/snippet/)',\n-        },\n-      }\n-    )\n-    let flushCount = 0\n-    await resolveStreamResponse(res2, () => {\n-      flushCount++\n-    })\n-    expect(flushCount).toBe(1)\n-    const html = await res1.text()\n-    const body = await getNodeBySelector(html, '#__next')\n-    // Resolve data instead of fallback\n-    expect(body.text()).toBe('next_streaming_data')\n-\n-    expect(res1.headers.get('etag')).toBeDefined()\n-    expect(res2.headers.get('etag')).toBeDefined()\n-  })\n-\n-  it('should render 500 error correctly', async () => {\n-    const errPaths = ['/err', '/err/render']\n-    const promises = errPaths.map(async (pagePath) => {\n-      const html = await renderViaHTTP(context.appPort, pagePath)\n-      if (env === 'dev') {\n-        // In development mode it should show the error popup.\n-        expect(html).toContain('Error: oops')\n-      } else {\n-        expect(html).toContain('custom-500-page')\n-      }\n-    })\n-    await Promise.all(promises)\n-  })\n-\n-  it('should render fallback if error raised from suspense during streaming', async () => {\n-    const html = await renderViaHTTP(context.appPort, '/err/suspense')\n-    expect(html).toContain('error-fallback')\n-  })\n-}"
        },
        {
            "sha": "4ba52ba2c8df6758685c8f65f490306b5c44eb76",
            "filename": "test/integration/react-streaming/unsupported-native-module/next.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Funsupported-native-module%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Funsupported-native-module%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-streaming%2Funsupported-native-module%2Fnext.config.js?ref=1b845bd997fc3ff374ee6909a24a40fd889a0f22",
            "patch": "@@ -1 +0,0 @@\n-module.exports = {}"
        },
        {
            "sha": "97bbd1d711f4876df57149442904f8613658deaa",
            "filename": "test/integration/react-streaming/unsupported-native-module/package.json",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Funsupported-native-module%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Funsupported-native-module%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-streaming%2Funsupported-native-module%2Fpackage.json?ref=1b845bd997fc3ff374ee6909a24a40fd889a0f22",
            "patch": "@@ -1,8 +0,0 @@\n-{\n-  \"private\": true,\n-  \"scripts\": {\n-    \"dev\": \"next dev\",\n-    \"build\": \"next build\",\n-    \"start\": \"next start\"\n-  }\n-}"
        },
        {
            "sha": "b63a4cd5fc73592869463a25705c2a1cac233a08",
            "filename": "test/integration/react-streaming/unsupported-native-module/pages/index.js",
            "status": "removed",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Funsupported-native-module%2Fpages%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1b845bd997fc3ff374ee6909a24a40fd889a0f22/test%2Fintegration%2Freact-streaming%2Funsupported-native-module%2Fpages%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-streaming%2Funsupported-native-module%2Fpages%2Findex.js?ref=1b845bd997fc3ff374ee6909a24a40fd889a0f22",
            "patch": "@@ -1,14 +0,0 @@\n-let EOF\n-\n-if (typeof window === 'undefined') {\n-  EOF = require('dns').EOF\n-}\n-\n-export default function Index() {\n-  console.log(EOF)\n-  return 'Access Node.js native module dns'\n-}\n-\n-export const config = {\n-  runtime: 'experimental-edge',\n-}"
        },
        {
            "sha": "496d7fd0a88f582cdd55d04844ecb32c560109ec",
            "filename": "test/turbopack-build-tests-manifest.json",
            "status": "modified",
            "additions": 14,
            "deletions": 17,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fturbopack-build-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/0970697a1e5b2fee4081a204cc998e6f41c3bb78/test%2Fturbopack-build-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-build-tests-manifest.json?ref=0970697a1e5b2fee4081a204cc998e6f41c3bb78",
            "patch": "@@ -6279,6 +6279,20 @@\n       \"flakey\": [],\n       \"runtimeError\": false\n     },\n+    \"test/e2e/streaming-ssr-edge/streaming-ssr-edge.test.ts\": {\n+      \"passed\": [\n+        \"streaming-ssr-edge should support streaming for fizz response\",\n+        \"streaming-ssr-edge should not stream to crawlers or google pagerender bot\",\n+        \"streaming-ssr-edge should render 500 error from gIP correctly\",\n+        \"streaming-ssr-edge should render fallback if error raised from suspense during streaming\"\n+      ],\n+      \"failed\": [\n+        \"streaming-ssr-edge should render 500 error from render function correctly\"\n+      ],\n+      \"pending\": [],\n+      \"flakey\": [],\n+      \"runtimeError\": false\n+    },\n     \"test/e2e/styled-jsx/index.test.ts\": {\n       \"passed\": [\n         \"styled-jsx should contain styled-jsx styles during SSR\",\n@@ -14309,23 +14323,6 @@\n       \"flakey\": [],\n       \"runtimeError\": false\n     },\n-    \"test/integration/react-streaming/test/index.test.js\": {\n-      \"passed\": [\n-        \"production mode streaming prod prod should not stream to crawlers or google pagerender bot\",\n-        \"production mode streaming prod prod should render fallback if error raised from suspense during streaming\",\n-        \"production mode streaming prod prod should support streaming for fizz response\",\n-        \"streaming dev dev should not stream to crawlers or google pagerender bot\",\n-        \"streaming dev dev should render 500 error correctly\",\n-        \"streaming dev dev should render fallback if error raised from suspense during streaming\",\n-        \"streaming dev dev should support streaming for fizz response\"\n-      ],\n-      \"failed\": [\n-        \"production mode streaming prod prod should render 500 error correctly\"\n-      ],\n-      \"pending\": [],\n-      \"flakey\": [],\n-      \"runtimeError\": false\n-    },\n     \"test/integration/read-only-source-hmr/test/index.test.js\": {\n       \"passed\": [\n         \"Read-only source HMR should detect a new page\","
        }
    ],
    "stats": {
        "total": 336,
        "additions": 130,
        "deletions": 206
    }
}