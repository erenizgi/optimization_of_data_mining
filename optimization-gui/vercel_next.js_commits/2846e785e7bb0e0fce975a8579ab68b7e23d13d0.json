{
    "author": "mischnic",
    "message": "Use retry in tests instead of requesting page (#86535)\n\nA suggestion from @eps1lon in https://github.com/vercel/next.js/pull/86512",
    "sha": "2846e785e7bb0e0fce975a8579ab68b7e23d13d0",
    "files": [
        {
            "sha": "229c8febe72752ad027eb402ee19c6e3b81c6d9c",
            "filename": "test/e2e/app-dir/typed-routes/typed-links.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 11,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/2846e785e7bb0e0fce975a8579ab68b7e23d13d0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-links.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2846e785e7bb0e0fce975a8579ab68b7e23d13d0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-links.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-links.test.ts?ref=2846e785e7bb0e0fce975a8579ab68b7e23d13d0",
            "patch": "@@ -1,4 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n+import { retry } from 'next-test-utils'\n \n describe('typed-links', () => {\n   const { next, isNextStart, skipped } = nextTestSetup({\n@@ -11,20 +12,18 @@ describe('typed-links', () => {\n   }\n \n   it('should generate types for next/link', async () => {\n-    // To wait for the (dev) server to have started up.\n-    await next.render('/')\n-\n-    const dts = await next.readFile(`${next.distDir}/types/link.d.ts`)\n-    expect(dts).toContain(`declare module 'next/link'`)\n+    await retry(async () => {\n+      const dts = await next.readFile(`${next.distDir}/types/link.d.ts`)\n+      expect(dts).toContain(`declare module 'next/link'`)\n+    })\n   })\n \n   it('should include handler route from app/api-test/route.ts in generated link route definitions', async () => {\n-    // To wait for the (dev) server to have started up.\n-    await next.render('/')\n-\n-    const dts = await next.readFile(`${next.distDir}/types/link.d.ts`)\n-    // Ensure the app route handler at app/api-test/route.ts (\"/api-test\") is present\n-    expect(dts).toContain('`/api-test`')\n+    await retry(async () => {\n+      const dts = await next.readFile(`${next.distDir}/types/link.d.ts`)\n+      // Ensure the app route handler at app/api-test/route.ts (\"/api-test\") is present\n+      expect(dts).toContain('`/api-test`')\n+    })\n   })\n \n   if (isNextStart) {"
        },
        {
            "sha": "1ea4e2f846916f1977111e00fbdc65d2ccfcc7e2",
            "filename": "test/e2e/app-dir/typed-routes/typed-routes.test.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 24,
            "changes": 45,
            "blob_url": "https://github.com/vercel/next.js/blob/2846e785e7bb0e0fce975a8579ab68b7e23d13d0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-routes.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2846e785e7bb0e0fce975a8579ab68b7e23d13d0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-routes.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-routes.test.ts?ref=2846e785e7bb0e0fce975a8579ab68b7e23d13d0",
            "patch": "@@ -22,28 +22,26 @@ describe('typed-routes', () => {\n   }\n \n   it('should generate route types correctly', async () => {\n-    // To wait for the (dev) server to have started up.\n-    await next.render('/')\n-\n-    const dts = await next.readFile(`${next.distDir}/types/routes.d.ts`)\n-    expect(dts).toContain(expectedDts)\n+    await retry(async () => {\n+      const dts = await next.readFile(`${next.distDir}/types/routes.d.ts`)\n+      expect(dts).toContain(expectedDts)\n+    })\n   })\n \n   it('should correctly convert custom route patterns from path-to-regexp to bracket syntax', async () => {\n-    // To wait for the (dev) server to have started up.\n-    await next.render('/')\n-\n-    const dts = await next.readFile(`${next.distDir}/types/routes.d.ts`)\n+    await retry(async () => {\n+      const dts = await next.readFile(`${next.distDir}/types/routes.d.ts`)\n \n-    // Test standard dynamic segment: :slug -> [slug]\n-    expect(dts).toContain('\"/project/[slug]\"')\n+      // Test standard dynamic segment: :slug -> [slug]\n+      expect(dts).toContain('\"/project/[slug]\"')\n \n-    // Test catch-all one-or-more: :path+ -> [...path]\n-    expect(dts).toContain('\"/docs-old/[...path]\"')\n+      // Test catch-all one-or-more: :path+ -> [...path]\n+      expect(dts).toContain('\"/docs-old/[...path]\"')\n \n-    // Test catch-all zero-or-more: :slug* -> [[...slug]]\n-    expect(dts).toContain('\"/blog/[category]/[[...slug]]\"')\n-    expect(dts).toContain('\"/api-legacy/[version]/[[...endpoint]]\"')\n+      // Test catch-all zero-or-more: :slug* -> [[...slug]]\n+      expect(dts).toContain('\"/blog/[category]/[[...slug]]\"')\n+      expect(dts).toContain('\"/api-legacy/[version]/[[...endpoint]]\"')\n+    })\n   })\n \n   if (isNextDev) {\n@@ -71,14 +69,13 @@ describe('typed-routes', () => {\n   }\n \n   it('should generate RouteContext type for route handlers', async () => {\n-    // To wait for the (dev) server to have started up.\n-    await next.render('/')\n-\n-    const dts = await next.readFile(`${next.distDir}/types/routes.d.ts`)\n-    expect(dts).toContain(\n-      'interface RouteContext<AppRouteHandlerRoute extends AppRouteHandlerRoutes>'\n-    )\n-    expect(dts).toContain('params: Promise<ParamMap[AppRouteHandlerRoute]>')\n+    await retry(async () => {\n+      const dts = await next.readFile(`${next.distDir}/types/routes.d.ts`)\n+      expect(dts).toContain(\n+        'interface RouteContext<AppRouteHandlerRoute extends AppRouteHandlerRoutes>'\n+      )\n+      expect(dts).toContain('params: Promise<ParamMap[AppRouteHandlerRoute]>')\n+    })\n   })\n \n   if (isNextStart) {"
        }
    ],
    "stats": {
        "total": 66,
        "additions": 31,
        "deletions": 35
    }
}