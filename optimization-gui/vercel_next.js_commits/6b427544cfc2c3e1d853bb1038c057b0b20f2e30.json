{
    "author": "bgw",
    "message": "test: Use nextTestSetup in scss tests (#84501)\n\nThis ensures the tests have some coverage for `next dev`, and ensures proper test isolation. Previously they were just using `__dirname`, which is wrong.",
    "sha": "6b427544cfc2c3e1d853bb1038c057b0b20f2e30",
    "files": [
        {
            "sha": "37c866554b327789d3cbc921c1b635481293b073",
            "filename": "test/e2e/app-dir/scss/invalid-global-with-app/invalid-global-with-app.test.ts",
            "status": "modified",
            "additions": 56,
            "deletions": 21,
            "changes": 77,
            "blob_url": "https://github.com/vercel/next.js/blob/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-global-with-app%2Finvalid-global-with-app.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-global-with-app%2Finvalid-global-with-app.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-global-with-app%2Finvalid-global-with-app.test.ts?ref=6b427544cfc2c3e1d853bb1038c057b0b20f2e30",
            "patch": "@@ -1,29 +1,64 @@\n /* eslint-env jest */\n \n-import { remove } from 'fs-extra'\n-import { nextBuild } from 'next-test-utils'\n-import { join } from 'path'\n+import { isNextStart, nextTestSetup } from 'e2e-utils'\n+import { assertHasRedbox, getRedboxSource } from 'next-test-utils'\n \n describe('Invalid Global CSS with Custom App', () => {\n-  const appDir = __dirname\n-\n-  beforeAll(async () => {\n-    await remove(join(appDir, '.next'))\n+  const { next, skipped, isTurbopack, isRspack } = nextTestSetup({\n+    files: __dirname,\n+    skipStart: isNextStart,\n+    skipDeployment: true,\n+    dependencies: { sass: '1.54.0' },\n   })\n \n-  it('should fail to build', async () => {\n-    const { code, stderr } = await nextBuild(appDir, [], {\n-      stderr: true,\n+  if (skipped) {\n+    return\n+  }\n+\n+  if (isNextStart) {\n+    it('should fail to build', async () => {\n+      const { exitCode, cliOutput } = await next.build()\n+      expect(exitCode).not.toBe(0)\n+      expect(cliOutput).toContain('Failed to compile')\n+      expect(cliOutput).toContain('styles/global.scss')\n+      expect(cliOutput).toMatch(\n+        /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n+      )\n+      // Skip: Rspack loaders cannot access module issuer info for location details\n+      if (!process.env.NEXT_RSPACK) {\n+        expect(cliOutput).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n+      }\n     })\n-    expect(code).not.toBe(0)\n-    expect(stderr).toContain('Failed to compile')\n-    expect(stderr).toContain('styles/global.scss')\n-    expect(stderr).toMatch(\n-      /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n-    )\n-    // Skip: Rspack loaders cannot access module issuer info for location details\n-    if (!process.env.NEXT_RSPACK) {\n-      expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n-    }\n-  })\n+  } else {\n+    it('should show a build error', async () => {\n+      const browser = await next.browser('/')\n+\n+      await assertHasRedbox(browser)\n+      const errorSource = await getRedboxSource(browser)\n+\n+      if (isTurbopack) {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./pages/index.js\n+         Failed to compile\n+             Global CSS cannot be imported from files other than your Custom <App>. Due to the Global nature of stylesheets, and to avoid conflicts, Please move all first-party global CSS imports to pages/_app.js. Or convert the import to Component-Level CSS (CSS Modules).\n+             Read more: https://nextjs.org/docs/messages/css-global\n+         Location: pages/index.js\n+         Import path: ../styles/global.scss\"\n+        `)\n+      } else if (isRspack) {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./styles/global.scss\n+           │ Global CSS cannot be imported from files other than your Custom <App>. Due to the Global nature of stylesheets, and to avoid conflicts, Please move all first-party global CSS imports to pages/_app.js. Or convert the import to Component-Level CSS (CSS Modules).\n+           │ Read more: https://nextjs.org/docs/messages/css-global\"\n+        `)\n+      } else {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./styles/global.scss\n+         Global CSS cannot be imported from files other than your Custom <App>. Due to the Global nature of stylesheets, and to avoid conflicts, Please move all first-party global CSS imports to pages/_app.js. Or convert the import to Component-Level CSS (CSS Modules).\n+         Read more: https://nextjs.org/docs/messages/css-global\n+         Location: pages/index.js\"\n+        `)\n+      }\n+    })\n+  }\n })"
        },
        {
            "sha": "65840a44230f99e21ac5bfd0251e111474e7e93c",
            "filename": "test/e2e/app-dir/scss/invalid-global/invalid-global.test.ts",
            "status": "modified",
            "additions": 56,
            "deletions": 21,
            "changes": 77,
            "blob_url": "https://github.com/vercel/next.js/blob/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-global%2Finvalid-global.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-global%2Finvalid-global.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-global%2Finvalid-global.test.ts?ref=6b427544cfc2c3e1d853bb1038c057b0b20f2e30",
            "patch": "@@ -1,29 +1,64 @@\n /* eslint-env jest */\n \n-import { remove } from 'fs-extra'\n-import { nextBuild } from 'next-test-utils'\n-import { join } from 'path'\n+import { isNextStart, nextTestSetup } from 'e2e-utils'\n+import { assertHasRedbox, getRedboxSource } from 'next-test-utils'\n \n describe('Invalid Global CSS', () => {\n-  const appDir = __dirname\n-\n-  beforeAll(async () => {\n-    await remove(join(appDir, '.next'))\n+  const { next, skipped, isTurbopack, isRspack } = nextTestSetup({\n+    files: __dirname,\n+    skipStart: isNextStart,\n+    skipDeployment: true,\n+    dependencies: { sass: '1.54.0' },\n   })\n \n-  it('should fail to build', async () => {\n-    const { code, stderr } = await nextBuild(appDir, [], {\n-      stderr: true,\n+  if (skipped) {\n+    return\n+  }\n+\n+  if (isNextStart) {\n+    it('should fail to build', async () => {\n+      const { exitCode, cliOutput } = await next.build()\n+      expect(exitCode).not.toBe(0)\n+      expect(cliOutput).toContain('Failed to compile')\n+      expect(cliOutput).toContain('styles/global.scss')\n+      expect(cliOutput).toMatch(\n+        /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n+      )\n+      // Skip: Rspack loaders cannot access module issuer info for location details\n+      if (!process.env.NEXT_RSPACK) {\n+        expect(cliOutput).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n+      }\n     })\n-    expect(code).not.toBe(0)\n-    expect(stderr).toContain('Failed to compile')\n-    expect(stderr).toContain('styles/global.scss')\n-    expect(stderr).toMatch(\n-      /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n-    )\n-    // Skip: Rspack loaders cannot access module issuer info for location details\n-    if (!process.env.NEXT_RSPACK) {\n-      expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n-    }\n-  })\n+  } else {\n+    it('should show a build error', async () => {\n+      const browser = await next.browser('/')\n+\n+      await assertHasRedbox(browser)\n+      const errorSource = await getRedboxSource(browser)\n+\n+      if (isTurbopack) {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./pages/index.js\n+         Failed to compile\n+             Global CSS cannot be imported from files other than your Custom <App>. Due to the Global nature of stylesheets, and to avoid conflicts, Please move all first-party global CSS imports to pages/_app.js. Or convert the import to Component-Level CSS (CSS Modules).\n+             Read more: https://nextjs.org/docs/messages/css-global\n+         Location: pages/index.js\n+         Import path: ../styles/global.scss\"\n+        `)\n+      } else if (isRspack) {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./styles/global.scss\n+           │ Global CSS cannot be imported from files other than your Custom <App>. Due to the Global nature of stylesheets, and to avoid conflicts, Please move all first-party global CSS imports to pages/_app.js. Or convert the import to Component-Level CSS (CSS Modules).\n+           │ Read more: https://nextjs.org/docs/messages/css-global\"\n+        `)\n+      } else {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./styles/global.scss\n+         Global CSS cannot be imported from files other than your Custom <App>. Due to the Global nature of stylesheets, and to avoid conflicts, Please move all first-party global CSS imports to pages/_app.js. Or convert the import to Component-Level CSS (CSS Modules).\n+         Read more: https://nextjs.org/docs/messages/css-global\n+         Location: pages/index.js\"\n+        `)\n+      }\n+    })\n+  }\n })"
        },
        {
            "sha": "3aceaa70d3a3e62506f6a94756ed05c9b4269448",
            "filename": "test/e2e/app-dir/scss/invalid-module-document/invalid-module-document.test.ts",
            "status": "modified",
            "additions": 46,
            "deletions": 29,
            "changes": 75,
            "blob_url": "https://github.com/vercel/next.js/blob/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-module-document%2Finvalid-module-document.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-module-document%2Finvalid-module-document.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-module-document%2Finvalid-module-document.test.ts?ref=6b427544cfc2c3e1d853bb1038c057b0b20f2e30",
            "patch": "@@ -1,40 +1,57 @@\n /* eslint-env jest */\n \n-import { remove } from 'fs-extra'\n-import { nextBuild } from 'next-test-utils'\n-import { join } from 'path'\n-// In order for the global isNextStart to be set\n-import 'e2e-utils'\n+import { isNextStart, nextTestSetup } from 'e2e-utils'\n+import { assertHasRedbox, getRedboxSource } from 'next-test-utils'\n \n // Importing module CSS in _document is allowed in Turbopack\n ;(process.env.IS_TURBOPACK_TEST ? describe.skip : describe)(\n   'Invalid SCSS in _document',\n   () => {\n-    ;(Boolean((global as any).isNextStart) ? describe : describe.skip)(\n-      'production only',\n-      () => {\n-        const appDir = __dirname\n+    const { next, skipped, isRspack } = nextTestSetup({\n+      files: __dirname,\n+      skipStart: isNextStart,\n+      skipDeployment: true,\n+      dependencies: { sass: '1.54.0' },\n+    })\n \n-        beforeAll(async () => {\n-          await remove(join(appDir, '.next'))\n-        })\n+    if (skipped) {\n+      return\n+    }\n \n-        it('should fail to build', async () => {\n-          const { code, stderr } = await nextBuild(appDir, [], {\n-            stderr: true,\n-          })\n-          expect(code).not.toBe(0)\n-          expect(stderr).toContain('Failed to compile')\n-          expect(stderr).toContain('styles.module.scss')\n-          expect(stderr).toMatch(\n-            /CSS.*cannot.*be imported within.*pages[\\\\/]_document\\.js/\n-          )\n-          // Skip: Rspack loaders cannot access module issuer info for location details\n-          if (!process.env.NEXT_RSPACK) {\n-            expect(stderr).toMatch(/Location:.*pages[\\\\/]_document\\.js/)\n-          }\n-        })\n-      }\n-    )\n+    if (isNextStart) {\n+      it('should fail to build', async () => {\n+        const { exitCode, cliOutput } = await next.build()\n+        expect(exitCode).not.toBe(0)\n+        expect(cliOutput).toContain('Failed to compile')\n+        expect(cliOutput).toContain('styles.module.scss')\n+        expect(cliOutput).toMatch(\n+          /CSS.*cannot.*be imported within.*pages[\\\\/]_document\\.js/\n+        )\n+        // Skip: Rspack loaders cannot access module issuer info for location details\n+        if (!process.env.NEXT_RSPACK) {\n+          expect(cliOutput).toMatch(/Location:.*pages[\\\\/]_document\\.js/)\n+        }\n+      })\n+    } else {\n+      it('should show a build error', async () => {\n+        const browser = await next.browser('/')\n+\n+        await assertHasRedbox(browser)\n+        const errorSource = await getRedboxSource(browser)\n+\n+        if (isRspack) {\n+          expect(errorSource).toMatchInlineSnapshot(`\n+           \"./styles.module.scss\n+             │ CSS cannot be imported within pages/_document.js. Please move global styles to pages/_app.js.\"\n+          `)\n+        } else {\n+          expect(errorSource).toMatchInlineSnapshot(`\n+           \"./styles.module.scss\n+           CSS cannot be imported within pages/_document.js. Please move global styles to pages/_app.js.\n+           Location: pages/_document.js\"\n+          `)\n+        }\n+      })\n+    }\n   }\n )"
        },
        {
            "sha": "427f2650777c306d5b8b0c48696ad370de963d5a",
            "filename": "test/e2e/app-dir/scss/npm-import-bad/npm-import-bad.test.ts",
            "status": "modified",
            "additions": 68,
            "deletions": 25,
            "changes": 93,
            "blob_url": "https://github.com/vercel/next.js/blob/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Fnpm-import-bad%2Fnpm-import-bad.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Fnpm-import-bad%2Fnpm-import-bad.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fscss%2Fnpm-import-bad%2Fnpm-import-bad.test.ts?ref=6b427544cfc2c3e1d853bb1038c057b0b20f2e30",
            "patch": "@@ -1,30 +1,73 @@\n /* eslint-env jest */\n \n-import { remove } from 'fs-extra'\n-import { nextBuild } from 'next-test-utils'\n-import { join } from 'path'\n-// In order for the global isNextStart to be set\n-import 'e2e-utils'\n-\n-console.log({ global })\n+import { isNextStart, nextTestSetup } from 'e2e-utils'\n+import { assertHasRedbox, getRedboxSource } from 'next-test-utils'\n \n describe('CSS Import from node_modules', () => {\n-  ;(Boolean((global as any).isNextStart) ? describe : describe.skip)(\n-    'production only',\n-    () => {\n-      const appDir = __dirname\n-\n-      beforeAll(async () => {\n-        await remove(join(appDir, '.next'))\n-      })\n-\n-      it('should fail the build', async () => {\n-        const { code, stderr } = await nextBuild(appDir, [], { stderr: true })\n-\n-        expect(code).toBe(0)\n-        expect(stderr).not.toMatch(/Can't resolve '[^']*?nprogress[^']*?'/)\n-        expect(stderr).not.toMatch(/Build error occurred/)\n-      })\n-    }\n-  )\n+  const { next, skipped, isTurbopack, isRspack } = nextTestSetup({\n+    files: __dirname,\n+    skipStart: isNextStart,\n+    skipDeployment: true,\n+    dependencies: { sass: '1.54.0' },\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  if (isNextStart) {\n+    it('should fail the build', async () => {\n+      const { exitCode, cliOutput } = await next.build()\n+      expect(exitCode).not.toBe(0)\n+      if (isRspack) {\n+        expect(cliOutput).toMatch(\n+          /RspackResolver\\(NotFound\\(\\\\?\"nprogress\\/nprogress.css\\\\?\"\\)\\)/\n+        )\n+      } else {\n+        expect(cliOutput).toMatch(/Can't resolve '[^']*?nprogress[^']*?'/)\n+      }\n+      expect(cliOutput).toMatch(/Build failed|Build error occurred/)\n+    })\n+  } else {\n+    it('should show a build error', async () => {\n+      const browser = await next.browser('/')\n+\n+      await assertHasRedbox(browser)\n+      const errorSource = await getRedboxSource(browser)\n+\n+      if (isTurbopack) {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./styles/global.scss.css (1:9)\n+         Module not found: Can't resolve 'nprogress/nprogress.css'\n+         > 1 | @import 'nprogress/nprogress.css';\n+             |         ^\n+           2 |\n+\n+         Import trace:\n+           Browser:\n+             ./styles/global.scss.css\n+             ./pages/_app.js\n+\n+         https://nextjs.org/docs/messages/module-not-found\"\n+        `)\n+      } else if (isRspack) {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./node_modules/.pnpm/next@file+..+next-repo-9363c99f3d71d8f039ab2f44b0982247ca3f251f6a3cb48f6f97e14bd6290b68_3cf165911481a65b93532bfb8e2c9025/node_modules/next/dist/build/webpack/loaders/css-loader/src/index.js??ruleSet[1].rules[8].oneOf[14].use[1]!./node_modules/.pnpm/next@file+..+next-repo-9363c99f3d71d8f039ab2f44b0982247ca3f251f6a3cb48f6f97e14bd6290b68_3cf165911481a65b93532bfb8e2c9025/node_modules/next/dist/build/webpack/loaders/postcss-loader/src/index.js??ruleSet[1].rules[8].oneOf[14].use[2]!./node_modules/.pnpm/next@file+..+next-repo-9363c99f3d71d8f039ab2f44b0982247ca3f251f6a3cb48f6f97e14bd6290b68_3cf165911481a65b93532bfb8e2c9025/node_modules/next/dist/build/webpack/loaders/resolve-url-loader/index.js??ruleSet[1].rules[8].oneOf[14].use[3]!./node_modules/.pnpm/next@file+..+next-repo-9363c99f3d71d8f039ab2f44b0982247ca3f251f6a3cb48f6f97e14bd6290b68_3cf165911481a65b93532bfb8e2c9025/node_modules/next/dist/compiled/sass-loader/cjs.js??ruleSet[1].rules[8].oneOf[14].use[4]!./styles/global.scss\n+           × Module build failed:\n+           ╰─▶   × Error: RspackResolver(NotFound(\"nprogress/nprogress.css\"))\"\n+        `)\n+      } else {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./styles/global.scss\n+         Module not found: Can't resolve 'nprogress/nprogress.css'\n+\n+         https://nextjs.org/docs/messages/module-not-found\n+\n+         Import trace for requested module:\n+         ./styles/global.scss\n+         ./pages/_app.js\"\n+        `)\n+      }\n+    })\n+  }\n })"
        },
        {
            "sha": "418b583fe5e8a81ed1c031dbdea65955af957f62",
            "filename": "test/e2e/app-dir/scss/valid-and-invalid-global/valid-and-invalid-global.test.ts",
            "status": "modified",
            "additions": 56,
            "deletions": 19,
            "changes": 75,
            "blob_url": "https://github.com/vercel/next.js/blob/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Fvalid-and-invalid-global%2Fvalid-and-invalid-global.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Fe2e%2Fapp-dir%2Fscss%2Fvalid-and-invalid-global%2Fvalid-and-invalid-global.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fscss%2Fvalid-and-invalid-global%2Fvalid-and-invalid-global.test.ts?ref=6b427544cfc2c3e1d853bb1038c057b0b20f2e30",
            "patch": "@@ -1,27 +1,64 @@\n /* eslint-env jest */\n \n-import { remove } from 'fs-extra'\n-import { nextBuild } from 'next-test-utils'\n-import { join } from 'path'\n+import { isNextStart, nextTestSetup } from 'e2e-utils'\n+import { assertHasRedbox, getRedboxSource } from 'next-test-utils'\n \n describe('Valid and Invalid Global CSS with Custom App', () => {\n-  const appDir = __dirname\n-\n-  beforeAll(async () => {\n-    await remove(join(appDir, '.next'))\n+  const { next, skipped, isTurbopack, isRspack } = nextTestSetup({\n+    files: __dirname,\n+    skipStart: isNextStart,\n+    skipDeployment: true,\n+    dependencies: { sass: '1.54.0' },\n   })\n \n-  it('should fail to build', async () => {\n-    const { code, stderr } = await nextBuild(appDir, [], {\n-      stderr: true,\n+  if (skipped) {\n+    return\n+  }\n+\n+  if (isNextStart) {\n+    it('should fail to build', async () => {\n+      const { exitCode, cliOutput } = await next.build()\n+      expect(exitCode).not.toBe(0)\n+      expect(cliOutput).toContain('Failed to compile')\n+      expect(cliOutput).toContain('styles/global.scss')\n+      expect(cliOutput).toContain(\n+        'Please move all first-party global CSS imports'\n+      )\n+      // Skip: Rspack loaders cannot access module issuer info for location details\n+      if (!process.env.NEXT_RSPACK) {\n+        expect(cliOutput).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n+      }\n     })\n-    expect(code).not.toBe(0)\n-    expect(stderr).toContain('Failed to compile')\n-    expect(stderr).toContain('styles/global.scss')\n-    expect(stderr).toContain('Please move all first-party global CSS imports')\n-    // Skip: Rspack loaders cannot access module issuer info for location details\n-    if (!process.env.NEXT_RSPACK) {\n-      expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n-    }\n-  })\n+  } else {\n+    it('should show a build error', async () => {\n+      const browser = await next.browser('/')\n+\n+      await assertHasRedbox(browser)\n+      const errorSource = await getRedboxSource(browser)\n+\n+      if (isTurbopack) {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./pages/index.js\n+         Failed to compile\n+             Global CSS cannot be imported from files other than your Custom <App>. Due to the Global nature of stylesheets, and to avoid conflicts, Please move all first-party global CSS imports to pages/_app.js. Or convert the import to Component-Level CSS (CSS Modules).\n+             Read more: https://nextjs.org/docs/messages/css-global\n+         Location: pages/index.js\n+         Import path: ../styles/global.scss\"\n+        `)\n+      } else if (isRspack) {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./styles/global.scss\n+           │ Global CSS cannot be imported from files other than your Custom <App>. Due to the Global nature of stylesheets, and to avoid conflicts, Please move all first-party global CSS imports to pages/_app.js. Or convert the import to Component-Level CSS (CSS Modules).\n+           │ Read more: https://nextjs.org/docs/messages/css-global\"\n+        `)\n+      } else {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./styles/global.scss\n+         Global CSS cannot be imported from files other than your Custom <App>. Due to the Global nature of stylesheets, and to avoid conflicts, Please move all first-party global CSS imports to pages/_app.js. Or convert the import to Component-Level CSS (CSS Modules).\n+         Read more: https://nextjs.org/docs/messages/css-global\n+         Location: pages/index.js\"\n+        `)\n+      }\n+    })\n+  }\n })"
        },
        {
            "sha": "8ba6c87b74d224c6b8220776e5a1bf91dea103ef",
            "filename": "test/lib/e2e-utils/index.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 6,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Flib%2Fe2e-utils%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6b427544cfc2c3e1d853bb1038c057b0b20f2e30/test%2Flib%2Fe2e-utils%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fe2e-utils%2Findex.ts?ref=6b427544cfc2c3e1d853bb1038c057b0b20f2e30",
            "patch": "@@ -104,6 +104,8 @@ export const isNextDeploy = testMode === 'deploy'\n  */\n export const isNextStart = !isNextDev && !isNextDeploy\n \n+export const isRspack = !!process.env.NEXT_RSPACK\n+\n if (!testMode) {\n   throw new Error(\n     `No 'NEXT_TEST_MODE' set in environment, this is required for e2e-utils`\n@@ -234,6 +236,7 @@ export function nextTestSetup(\n   isNextDeploy: boolean\n   isNextStart: boolean\n   isTurbopack: boolean\n+  isRspack: boolean\n   next: NextInstance\n   skipped: boolean\n } {\n@@ -287,18 +290,20 @@ export function nextTestSetup(\n     get isNextDev() {\n       return isNextDev\n     },\n-    get isTurbopack(): boolean {\n-      return Boolean(\n-        !process.env.NEXT_TEST_WASM && (options.turbo ?? shouldUseTurbopack())\n-      )\n-    },\n-\n     get isNextDeploy() {\n       return isNextDeploy\n     },\n     get isNextStart() {\n       return isNextStart\n     },\n+    get isTurbopack() {\n+      return Boolean(\n+        !process.env.NEXT_TEST_WASM && (options.turbo ?? shouldUseTurbopack())\n+      )\n+    },\n+    get isRspack() {\n+      return isRspack\n+    },\n     get next() {\n       return nextProxy\n     },"
        }
    ],
    "stats": {
        "total": 414,
        "additions": 293,
        "deletions": 121
    }
}