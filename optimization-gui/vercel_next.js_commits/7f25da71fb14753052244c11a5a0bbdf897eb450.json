{
    "author": "icyJoseph",
    "message": "docs: simplify streaming metadata (#84253)\n\nCo-authored-by: vercel[bot] <35613825+vercel[bot]@users.noreply.github.com>",
    "sha": "7f25da71fb14753052244c11a5a0bbdf897eb450",
    "files": [
        {
            "sha": "ac42a528f288d281a7dbb89ff765d4e748385da9",
            "filename": "docs/01-app/01-getting-started/14-metadata-and-og-images.mdx",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/7f25da71fb14753052244c11a5a0bbdf897eb450/docs%2F01-app%2F01-getting-started%2F14-metadata-and-og-images.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/7f25da71fb14753052244c11a5a0bbdf897eb450/docs%2F01-app%2F01-getting-started%2F14-metadata-and-og-images.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F01-getting-started%2F14-metadata-and-og-images.mdx?ref=7f25da71fb14753052244c11a5a0bbdf897eb450",
            "patch": "@@ -13,6 +13,7 @@ related:\n     - app/api-reference/file-conventions/metadata/opengraph-image\n     - app/api-reference/file-conventions/metadata/robots\n     - app/api-reference/file-conventions/metadata/sitemap\n+    - app/api-reference/config/next-config-js/htmlLimitedBots\n ---\n \n The Metadata APIs can be used to define your application metadata for improved SEO and web shareability and include:\n@@ -117,9 +118,15 @@ export default function Page({ params, searchParams }) {}\n \n ### Streaming metadata\n \n-For dynamically rendered pages, if resolving `generateMetadata` might block rendering, Next.js streams the resolved metadata separately and injects it into the HTML as soon as it's ready.\n+For dynamically rendered pages, Next.js streams metadata separately, injecting it into the HTML once `generateMetadata` resolves, without blocking UI rendering.\n \n-Statically rendered pages don’t use this behavior since metadata is resolved at build time.\n+Streaming metadata improves perceived performance by allowing visual content to stream first.\n+\n+Streaming metadata is **disabled for bots and crawlers** that expect metadata to be in the `<head>` tag (e.g. `Twitterbot`, `Slackbot`, `Bingbot`). These are detected by using the User Agent header from the incoming request.\n+\n+You can customize or **disable** streaming metadata completely, with the [`htmlLimitedBots`](/docs/app/api-reference/config/next-config-js/htmlLimitedBots#disabling) option in your Next.js config file.\n+\n+Statically rendered pages don’t use streaming since metadata is resolved at build time.\n \n Learn more about [streaming metadata](/docs/app/api-reference/functions/generate-metadata#streaming-metadata).\n "
        },
        {
            "sha": "04e318b176c7e97db5f8be4edb6ff53ebc636a82",
            "filename": "docs/01-app/03-api-reference/04-functions/generate-metadata.mdx",
            "status": "modified",
            "additions": 12,
            "deletions": 10,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/7f25da71fb14753052244c11a5a0bbdf897eb450/docs%2F01-app%2F03-api-reference%2F04-functions%2Fgenerate-metadata.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/7f25da71fb14753052244c11a5a0bbdf897eb450/docs%2F01-app%2F03-api-reference%2F04-functions%2Fgenerate-metadata.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F04-functions%2Fgenerate-metadata.mdx?ref=7f25da71fb14753052244c11a5a0bbdf897eb450",
            "patch": "@@ -41,6 +41,10 @@ export default function Page() {}\n \n Dynamic metadata depends on **dynamic information**, such as the current route parameters, external data, or `metadata` in parent segments, can be set by exporting a `generateMetadata` function that returns a [`Metadata` object](#metadata-fields).\n \n+Resolving `generateMetadata` is part of rendering the page. If the page can be pre-rendered and `generateMetadata` doesn't introduce dynamic behavior, the resulting metadata is included in the page’s initial HTML.\n+\n+Otherwise the metadata resolved from `generateMetadata` [can be streamed](/docs/app/api-reference/functions/generate-metadata#streaming-metadata) after sending the initial UI.\n+\n ```tsx filename=\"app/products/[id]/page.tsx\" switcher\n import type { Metadata, ResolvingMetadata } from 'next'\n \n@@ -104,8 +108,6 @@ For type completion of `params` and `searchParams`, you can type the first argum\n > - The `metadata` object and `generateMetadata` function exports are **only supported in Server Components**.\n > - You cannot export both the `metadata` object and `generateMetadata` function from the same route segment.\n > - `fetch` requests inside `generateMetadata` are automatically [memoized](/docs/app/guides/caching#request-memoization) for the same data across `generateMetadata`, `generateStaticParams`, Layouts, Pages, and Server Components.\n-> - Resolving `generateMetadata` is part of rendering the page. If the page can be pre-rendered and `generateMetadata` doesn't introduce dynamic behavior, its result is included in the page’s initial HTML.\n-> - `generateMetadata` [can stream results](/docs/app/api-reference/functions/generate-metadata#streaming-metadata) to improve page load performance.\n > - React [`cache` can be used](/docs/app/guides/caching#react-cache-function) if `fetch` is unavailable.\n > - [File-based metadata](/docs/app/api-reference/file-conventions/metadata) has the higher priority and will override the `metadata` object and `generateMetadata` function.\n \n@@ -1170,33 +1172,33 @@ There are two default `meta` tags that are always added even if a route doesn't\n \n ### Streaming metadata\n \n-Metadata returned by `generateMetadata` is streamed to the client. This allows Next.js to inject metadata into the HTML as soon as it's resolved.\n+Streaming metadata allows Next.js to render and send the initial UI to the browser, without waiting for `generateMetadata` to complete.\n \n-Streamed metadata is appended to the `<body>` tag. Since metadata mainly targets bots and crawlers, Next.js streams metadata for bots that can execute JavaScript and inspect the full DOM (e.g. `Googlebot`). We have verified that these bots interpret the metadata correctly.\n+When `generateMetadata` resolves, the resulting metadata tags are appended to the `<body>` tag. We have verified that metadata is interpreted correctly by bots that execute JavaScript and inspect the full DOM (e.g. `Googlebot`).\n \n-For **HTML-limited** bots that can’t run JavaScript (e.g. `Twitterbot`), metadata continues to block page rendering and is placed in the `<head>` tag.\n+For **HTML-limited bots** that can’t execute JavaScript (e.g. `facebookexternalhit`), metadata continues to block page rendering. The resulting metadata will be available in the `<head>` tag.\n \n-Next.js automatically detects the user agent of incoming requests to determine whether to serve streaming metadata or fallback to blocking metadata.\n+Next.js automatically detects **HTML-limited bots** by looking at the User Agent header. You can use the [`htmlLimitedBots`](/docs/app/api-reference/config/next-config-js/htmlLimitedBots) option in your Next.js config file to override the default [User Agent list](https://github.com/vercel/next.js/blob/canary/packages/next/src/shared/lib/router/utils/html-bots.ts).\n \n-If you need to customize this list, you can define them manually using the `htmlLimitedBots` option in `next.config.js`. Next.js will ensure user agents matching this regex receive blocking metadata when requesting your web page.\n+To fully disable streaming metadata:\n \n ```ts filename=\"next.config.ts\" switcher\n import type { NextConfig } from 'next'\n \n const config: NextConfig = {\n-  htmlLimitedBots: /MySpecialBot|MyAnotherSpecialBot|SimpleCrawler/,\n+  htmlLimitedBots: /.*/,\n }\n \n export default config\n ```\n \n ```js filename=\"next.config.js\" switcher\n module.exports = {\n-  htmlLimitedBots: /MySpecialBot|MyAnotherSpecialBot|SimpleCrawler/,\n+  htmlLimitedBots: /.*/,\n }\n ```\n \n-Specifying a `htmlLimitedBots` config will override the Next.js' default list, allowing you full control over what user agents should opt into this behavior.\n+Streaming metadata improves perceived performance by reducing [TTFB](https://developer.mozilla.org/docs/Glossary/Time_to_first_byte) and can help lowering [LCP](https://developer.mozilla.org/docs/Glossary/Largest_contentful_paint) time.\n \n Overriding `htmlLimitedBots` could lead to longer response times. Streaming metadata is an advanced feature, and the default should be sufficient for most cases.\n "
        },
        {
            "sha": "e8746f5773bb94e3be594fbddce3a718a193fc21",
            "filename": "docs/01-app/03-api-reference/05-config/01-next-config-js/htmlLimitedBots.mdx",
            "status": "modified",
            "additions": 43,
            "deletions": 2,
            "changes": 45,
            "blob_url": "https://github.com/vercel/next.js/blob/7f25da71fb14753052244c11a5a0bbdf897eb450/docs%2F01-app%2F03-api-reference%2F05-config%2F01-next-config-js%2FhtmlLimitedBots.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/7f25da71fb14753052244c11a5a0bbdf897eb450/docs%2F01-app%2F03-api-reference%2F05-config%2F01-next-config-js%2FhtmlLimitedBots.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F05-config%2F01-next-config-js%2FhtmlLimitedBots.mdx?ref=7f25da71fb14753052244c11a5a0bbdf897eb450",
            "patch": "@@ -23,9 +23,50 @@ module.exports = {\n \n ## Default list\n \n-Next.js includes [a default list of HTML limited bots](https://github.com/vercel/next.js/blob/canary/packages/next/src/shared/lib/router/utils/html-bots.ts).\n+Next.js includes a default list of HTML limited bots, including:\n \n-Specifying a `htmlLimitedBots` config will override the Next.js' default list, allowing you full control over what user agents should opt into this behavior. However, this is advanced behavior, and the default should be sufficient for most cases.\n+- Google crawlers (e.g. Mediapartners-Google, AdsBot-Google, Google-PageRenderer)\n+- Bingbot\n+- Twitterbot\n+- Slackbot\n+\n+See the full list [here](https://github.com/vercel/next.js/blob/canary/packages/next/src/shared/lib/router/utils/html-bots.ts).\n+\n+Specifying a `htmlLimitedBots` config will override the Next.js' default list. However, this is advanced behavior, and the default should be sufficient for most cases.\n+\n+```ts filename=\"next.config.ts\" switcher\n+const config: NextConfig = {\n+  htmlLimitedBots: /MySpecialBot|MyAnotherSpecialBot|SimpleCrawler/,\n+}\n+\n+export default config\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+module.exports = {\n+  htmlLimitedBots: /MySpecialBot|MyAnotherSpecialBot|SimpleCrawler/,\n+}\n+```\n+\n+## Disabling\n+\n+To fully disable streaming metadata:\n+\n+```ts filename=\"next.config.ts\"\n+import type { NextConfig } from 'next'\n+\n+const config: NextConfig = {\n+  htmlLimitedBots: /.*/,\n+}\n+\n+export default config\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+module.exports = {\n+  htmlLimitedBots: /.*/,\n+}\n+```\n \n ## Version History\n "
        }
    ],
    "stats": {
        "total": 78,
        "additions": 64,
        "deletions": 14
    }
}