{
    "author": "bgw",
    "message": "chore(CI): Break pages-dir client-navigation dev tests into smaller parallelizable files/suites (#78787)\n\nJest can run different suites in parallel, but tests within the same suite must run sequentially in the same worker.\n\nYou don't want suites that are too small, because each suite requires relatively expensive repository setup, but you also don't want suites that are too large because it inhibits parallelism.\n\nThis is a big problem for arewerspackyet, where many of these test cases are currently failing. Each test can take up to 4 minutes to time out, so we easily time out the entire 90 minute long test runner job.\n\n## Test plan\n\nTested by running all these tests in parallel with:\n\n```\nNEXT_TEST_MODE=dev HEADLESS=true node_modules/.bin/jest test/development/pages-dir/client-navigation\n```\n\nIt completes in about 2m40s minutes on my machine.",
    "sha": "837e0864796ba37bf4c6cd3777d5837cd311880c",
    "files": [
        {
            "sha": "a779497513ea0f2ca49b9c80ee6732669f169d4f",
            "filename": "test/development/pages-dir/client-navigation/anchor-in-link.test.ts",
            "status": "added",
            "additions": 106,
            "deletions": 0,
            "changes": 106,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fanchor-in-link.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fanchor-in-link.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fanchor-in-link.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,106 @@\n+/* eslint-env jest */\n+\n+import { waitFor } from 'next-test-utils'\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Client Navigation', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  describe('with <a/> tag inside the <Link />', () => {\n+    it('should navigate the page', async () => {\n+      const browser = await next.browser('/nav/about')\n+      const text = await browser\n+        .elementByCss('#home-link')\n+        .click()\n+        .waitForElementByCss('.nav-home')\n+        .elementByCss('p')\n+        .text()\n+\n+      expect(text).toBe('This is the home.')\n+      await browser.close()\n+    })\n+\n+    it('should not navigate if the <a/> tag has a target', async () => {\n+      const browser = await next.browser('/nav')\n+\n+      await browser\n+        .elementByCss('#increase')\n+        .click()\n+        .elementByCss('#target-link')\n+        .click()\n+\n+      await waitFor(1000)\n+\n+      const counterText = await browser.elementByCss('#counter').text()\n+\n+      expect(counterText).toBe('Counter: 1')\n+      await browser.close()\n+    })\n+\n+    it('should not navigate if the click-event is modified', async () => {\n+      const browser = await next.browser('/nav')\n+\n+      await browser.elementByCss('#increase').click()\n+\n+      const key = process.platform === 'darwin' ? 'Meta' : 'Control'\n+\n+      await browser.keydown(key)\n+\n+      await browser.elementByCss('#in-svg-link').click()\n+\n+      await browser.keyup(key)\n+      await waitFor(1000)\n+\n+      const counterText = await browser.elementByCss('#counter').text()\n+\n+      expect(counterText).toBe('Counter: 1')\n+      await browser.close()\n+    })\n+\n+    it('should not reload when link in svg is clicked', async () => {\n+      const browser = await next.browser('/nav')\n+      await browser.eval('window.hello = true')\n+      await browser\n+        .elementByCss('#in-svg-link')\n+        .click()\n+        .waitForElementByCss('.nav-about')\n+\n+      expect(await browser.eval('window.hello')).toBe(true)\n+      await browser.close()\n+    })\n+  })\n+\n+  describe('with unexpected <a/> nested tag', () => {\n+    it('should not redirect if passHref prop is not defined in Link', async () => {\n+      const browser = await next.browser('/nav/pass-href-prop')\n+      const text = await browser\n+        .elementByCss('#without-href')\n+        .click()\n+        .waitForElementByCss('.nav-pass-href-prop')\n+        .elementByCss('p')\n+        .text()\n+\n+      expect(text).toBe('This is the passHref prop page.')\n+      await browser.close()\n+    })\n+\n+    it('should redirect if passHref prop is defined in Link', async () => {\n+      const browser = await next.browser('/nav/pass-href-prop')\n+      const text = await browser\n+        .elementByCss('#with-href')\n+        .click()\n+        .waitForElementByCss('.nav-home')\n+        .elementByCss('p')\n+        .text()\n+\n+      expect(text).toBe('This is the home.')\n+      await browser.close()\n+    })\n+  })\n+})"
        },
        {
            "sha": "56ba75f633e92a91bd7d1c8d26ebf9099e37963d",
            "filename": "test/development/pages-dir/client-navigation/as-path.test.ts",
            "status": "added",
            "additions": 163,
            "deletions": 0,
            "changes": 163,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fas-path.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fas-path.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fas-path.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,163 @@\n+/* eslint-env jest */\n+\n+import { check } from 'next-test-utils'\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Client navigation with asPath', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  describe('inside getInitialProps', () => {\n+    it('should show the correct asPath with a Link with as prop', async () => {\n+      const browser = await next.browser('/nav')\n+      const asPath = await browser\n+        .elementByCss('#as-path-link')\n+        .click()\n+        .waitForElementByCss('.as-path-content')\n+        .elementByCss('.as-path-content')\n+        .text()\n+\n+      expect(asPath).toBe('/as/path')\n+      await browser.close()\n+    })\n+\n+    it('should show the correct asPath with a Link without the as prop', async () => {\n+      const browser = await next.browser('/nav')\n+      const asPath = await browser\n+        .elementByCss('#as-path-link-no-as')\n+        .click()\n+        .waitForElementByCss('.as-path-content')\n+        .elementByCss('.as-path-content')\n+        .text()\n+\n+      expect(asPath).toBe('/nav/as-path')\n+      await browser.close()\n+    })\n+  })\n+\n+  describe('with next/router', () => {\n+    it('should show the correct asPath', async () => {\n+      const browser = await next.browser('/nav')\n+      const asPath = await browser\n+        .elementByCss('#as-path-using-router-link')\n+        .click()\n+        .waitForElementByCss('.as-path-content')\n+        .elementByCss('.as-path-content')\n+        .text()\n+\n+      expect(asPath).toBe('/nav/as-path-using-router')\n+      await browser.close()\n+    })\n+\n+    it('should navigate an absolute url on push', async () => {\n+      const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n+      await browser.waitForElementByCss('#router-push').click()\n+      await check(\n+        () => browser.eval(() => window.location.origin),\n+        'https://vercel.com'\n+      )\n+    })\n+\n+    it('should navigate an absolute url on replace', async () => {\n+      const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n+      await browser.waitForElementByCss('#router-replace').click()\n+      await check(\n+        () => browser.eval(() => window.location.origin),\n+        'https://vercel.com'\n+      )\n+    })\n+\n+    it('should navigate an absolute local url on push', async () => {\n+      const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n+      // @ts-expect-error _didNotNavigate is set intentionally\n+      await browser.eval(() => (window._didNotNavigate = true))\n+      await browser.waitForElementByCss('#router-local-push').click()\n+      const text = await browser\n+        .waitForElementByCss('.nav-about')\n+        .elementByCss('p')\n+        .text()\n+      expect(text).toBe('This is the about page.')\n+      // @ts-expect-error _didNotNavigate is set intentionally\n+      expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n+    })\n+\n+    it('should navigate an absolute local url on replace', async () => {\n+      const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n+      // @ts-expect-error _didNotNavigate is set intentionally\n+      await browser.eval(() => (window._didNotNavigate = true))\n+      await browser.waitForElementByCss('#router-local-replace').click()\n+      const text = await browser\n+        .waitForElementByCss('.nav-about')\n+        .elementByCss('p')\n+        .text()\n+      expect(text).toBe('This is the about page.')\n+      // @ts-expect-error _didNotNavigate is set intentionally\n+      expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n+    })\n+  })\n+\n+  describe('with next/link', () => {\n+    it('should use pushState with same href and different asPath', async () => {\n+      const browser = await next.browser('/nav/as-path-pushstate')\n+      await browser\n+        .elementByCss('#hello')\n+        .click()\n+        .waitForElementByCss('#something-hello')\n+      const queryOne = JSON.parse(\n+        await browser.elementByCss('#router-query').text()\n+      )\n+      expect(queryOne.something).toBe('hello')\n+      await browser\n+        .elementByCss('#same-query')\n+        .click()\n+        .waitForElementByCss('#something-same-query')\n+      const queryTwo = JSON.parse(\n+        await browser.elementByCss('#router-query').text()\n+      )\n+      expect(queryTwo.something).toBe('hello')\n+      await browser.back().waitForElementByCss('#something-hello')\n+      const queryThree = JSON.parse(\n+        await browser.elementByCss('#router-query').text()\n+      )\n+      expect(queryThree.something).toBe('hello')\n+      await browser\n+        .elementByCss('#else')\n+        .click()\n+        .waitForElementByCss('#something-else')\n+      await browser\n+        .elementByCss('#hello2')\n+        .click()\n+        .waitForElementByCss('#nav-as-path-pushstate')\n+      await browser.back().waitForElementByCss('#something-else')\n+      const queryFour = JSON.parse(\n+        await browser.elementByCss('#router-query').text()\n+      )\n+      expect(queryFour.something).toBe(undefined)\n+    })\n+\n+    it('should detect asPath query changes correctly', async () => {\n+      const browser = await next.browser('/nav/as-path-query')\n+      await browser\n+        .elementByCss('#hello')\n+        .click()\n+        .waitForElementByCss('#something-hello-something-hello')\n+      const queryOne = JSON.parse(\n+        await browser.elementByCss('#router-query').text()\n+      )\n+      expect(queryOne.something).toBe('hello')\n+      await browser\n+        .elementByCss('#hello2')\n+        .click()\n+        .waitForElementByCss('#something-hello-something-else')\n+      const queryTwo = JSON.parse(\n+        await browser.elementByCss('#router-query').text()\n+      )\n+      expect(queryTwo.something).toBe('else')\n+    })\n+  })\n+})"
        },
        {
            "sha": "63f00149899ff4673eeaf82a64da82a40b1bf05f",
            "filename": "test/development/pages-dir/client-navigation/error-pages.test.ts",
            "status": "added",
            "additions": 85,
            "deletions": 0,
            "changes": 85,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Ferror-pages.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Ferror-pages.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Ferror-pages.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,85 @@\n+/* eslint-env jest */\n+\n+import { fetchViaHTTP, waitFor } from 'next-test-utils'\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Client navigation on error pages', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  it('should not reload when visiting /_error directly', async () => {\n+    const { status } = await fetchViaHTTP(next.appPort, '/_error')\n+    const browser = await next.browser('/_error')\n+\n+    await browser.eval('window.hello = true')\n+\n+    // wait on-demand-entries timeout since it can trigger\n+    // reloading non-stop\n+    for (let i = 0; i < 15; i++) {\n+      expect(await browser.eval('window.hello')).toBe(true)\n+      await waitFor(1000)\n+    }\n+    const html = await browser.eval('document.documentElement.innerHTML')\n+\n+    expect(status).toBe(404)\n+    expect(html).toContain('This page could not be found')\n+    expect(html).toContain('404')\n+  })\n+\n+  describe('with 404 pages', () => {\n+    it('should 404 on not existent page', async () => {\n+      const browser = await next.browser('/non-existent')\n+      expect(await browser.elementByCss('h1').text()).toBe('404')\n+      expect(await browser.elementByCss('h2').text()).toBe(\n+        'This page could not be found.'\n+      )\n+      await browser.close()\n+    })\n+\n+    it('should 404 on wrong casing', async () => {\n+      const browser = await next.browser('/nAv/AbOuT')\n+      expect(await browser.elementByCss('h1').text()).toBe('404')\n+      expect(await browser.elementByCss('h2').text()).toBe(\n+        'This page could not be found.'\n+      )\n+      await browser.close()\n+    })\n+\n+    it('should get url dynamic param', async () => {\n+      const browser = await next.browser('/dynamic/dynamic-part/route')\n+      expect(await browser.elementByCss('p').text()).toBe('dynamic-part')\n+      await browser.close()\n+    })\n+\n+    it('should 404 on wrong casing of url dynamic param', async () => {\n+      const browser = await next.browser('/dynamic/dynamic-part/RoUtE')\n+      expect(await browser.elementByCss('h1').text()).toBe('404')\n+      expect(await browser.elementByCss('h2').text()).toBe(\n+        'This page could not be found.'\n+      )\n+      await browser.close()\n+    })\n+\n+    it('should not 404 for <page>/', async () => {\n+      const browser = await next.browser('/nav/about/')\n+      const text = await browser.elementByCss('p').text()\n+      expect(text).toBe('This is the about page.')\n+      await browser.close()\n+    })\n+\n+    it('should should not contain a page script in a 404 page', async () => {\n+      const browser = await next.browser('/non-existent')\n+      const scripts = await browser.elementsByCss('script[src]')\n+      for (const script of scripts) {\n+        const src = await script.getAttribute('src')\n+        expect(src.includes('/non-existent')).toBeFalsy()\n+      }\n+      await browser.close()\n+    })\n+  })\n+})"
        },
        {
            "sha": "ad09e4ffa9838c0acaebabe6249d3b35adbf5bc0",
            "filename": "test/development/pages-dir/client-navigation/foreign-history-manipulation.test.ts",
            "status": "added",
            "additions": 51,
            "deletions": 0,
            "changes": 51,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fforeign-history-manipulation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fforeign-history-manipulation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fforeign-history-manipulation.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,51 @@\n+/* eslint-env jest */\n+\n+import { assertNoRedbox, waitFor } from 'next-test-utils'\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Client navigation with foreign history manipulation', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  it('should ignore history state without options', async () => {\n+    const browser = await next.browser('/nav')\n+    // push history object without options\n+    await browser.eval(\n+      'window.history.pushState({ url: \"/whatever\" }, \"\", \"/whatever\")'\n+    )\n+    await browser.elementByCss('#about-link').click()\n+    await browser.waitForElementByCss('.nav-about')\n+    await browser.back()\n+    await waitFor(1000)\n+    await assertNoRedbox(browser)\n+  })\n+\n+  it('should ignore history state with an invalid url', async () => {\n+    const browser = await next.browser('/nav')\n+    // push history object wit invalid url (not relative)\n+    await browser.eval(\n+      'window.history.pushState({ url: \"http://google.com\" }, \"\", \"/whatever\")'\n+    )\n+    await browser.elementByCss('#about-link').click()\n+    await browser.waitForElementByCss('.nav-about')\n+    await browser.back()\n+    await waitFor(1000)\n+    await assertNoRedbox(browser)\n+  })\n+\n+  it('should ignore foreign history state with missing properties', async () => {\n+    const browser = await next.browser('/nav')\n+    // push empty history state\n+    await browser.eval('window.history.pushState({}, \"\", \"/whatever\")')\n+    await browser.elementByCss('#about-link').click()\n+    await browser.waitForElementByCss('.nav-about')\n+    await browser.back()\n+    await waitFor(1000)\n+    await assertNoRedbox(browser)\n+  })\n+})"
        },
        {
            "sha": "9cd4b33509426f7a6360006ae73cc69d8a272afa",
            "filename": "test/development/pages-dir/client-navigation/head.test.ts",
            "status": "added",
            "additions": 205,
            "deletions": 0,
            "changes": 205,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fhead.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fhead.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fhead.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,205 @@\n+/* eslint-env jest */\n+\n+import { waitFor } from 'next-test-utils'\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n+\n+describe.each([[false], [true]])(\n+  'updating <Head /> with strictNextHead=%s while client routing',\n+  (strictNextHead) => {\n+    const { next } = nextTestSetup({\n+      files: path.join(__dirname, 'fixture'),\n+      env: {\n+        TEST_STRICT_NEXT_HEAD: String(strictNextHead),\n+      },\n+    })\n+\n+    it.each([true, false])(\n+      'should handle boolean async prop in next/head client-side: %s',\n+      async (bool) => {\n+        const browser = await next.browser('/head')\n+        const value = await browser.eval(\n+          `document.querySelector('script[src=\"/test-async-${JSON.stringify(\n+            bool\n+          )}.js\"]').async`\n+        )\n+\n+        expect(value).toBe(bool)\n+      }\n+    )\n+\n+    it('should only execute async and defer scripts once', async () => {\n+      const browser = await next.browser('/head')\n+\n+      await browser.waitForElementByCss('h1')\n+      await waitFor(2000)\n+      expect(Number(await browser.eval('window.__test_async_executions'))).toBe(\n+        strictNextHead || isReact18\n+          ? 1\n+          : // <meta name=\"next-head-count\" /> is floated before <script />.\n+            // head-manager thinks it needs to add these again resulting in another execution.\n+            2\n+      )\n+      expect(Number(await browser.eval('window.__test_defer_executions'))).toBe(\n+        strictNextHead || isReact18\n+          ? 1\n+          : // <meta name=\"next-head-count\" /> is floated before <script defer />.\n+            // head-manager thinks it needs to add these again resulting in another execution.\n+            2\n+      )\n+\n+      await browser.elementByCss('#reverseScriptOrder').click()\n+      await waitFor(2000)\n+\n+      expect(Number(await browser.eval('window.__test_async_executions'))).toBe(\n+        strictNextHead || isReact18 ? 1 : 2\n+      )\n+      expect(Number(await browser.eval('window.__test_defer_executions'))).toBe(\n+        strictNextHead || isReact18 ? 1 : 2\n+      )\n+\n+      await browser.elementByCss('#toggleScript').click()\n+      await waitFor(2000)\n+\n+      expect(Number(await browser.eval('window.__test_async_executions'))).toBe(\n+        strictNextHead || isReact18 ? 1 : 2\n+      )\n+      expect(Number(await browser.eval('window.__test_defer_executions'))).toBe(\n+        strictNextHead || isReact18 ? 1 : 2\n+      )\n+    })\n+\n+    it('should warn when stylesheets or scripts are in head', async () => {\n+      const browser = await next.browser('/head')\n+\n+      await browser.waitForElementByCss('h1')\n+      await waitFor(1000)\n+      const browserLogs = await browser.log()\n+      let foundStyles = false\n+      let foundScripts = false\n+      const logs = []\n+      browserLogs.forEach(({ message }) => {\n+        if (message.includes('Do not add stylesheets using next/head')) {\n+          foundStyles = true\n+          logs.push(message)\n+        }\n+        if (message.includes('Do not add <script> tags using next/head')) {\n+          foundScripts = true\n+          logs.push(message)\n+        }\n+      })\n+\n+      expect(foundStyles).toEqual(true)\n+      expect(foundScripts).toEqual(true)\n+\n+      // Warnings are unique\n+      expect(logs.length).toEqual(new Set(logs).size)\n+    })\n+\n+    it('should warn when scripts are in head', async () => {\n+      const browser = await next.browser('/head')\n+      await browser.waitForElementByCss('h1')\n+      await waitFor(1000)\n+      const browserLogs = await browser.log()\n+      let found = false\n+      browserLogs.forEach((log) => {\n+        if (log.message.includes('Use next/script instead')) {\n+          found = true\n+        }\n+      })\n+      expect(found).toEqual(true)\n+    })\n+\n+    it('should not warn when application/ld+json scripts are in head', async () => {\n+      const browser = await next.browser('/head-with-json-ld-snippet')\n+      await browser.waitForElementByCss('h1')\n+      await waitFor(1000)\n+      const browserLogs = await browser.log()\n+      let found = false\n+      browserLogs.forEach((log) => {\n+        if (log.message.includes('Use next/script instead')) {\n+          found = true\n+        }\n+      })\n+      expect(found).toEqual(false)\n+    })\n+\n+    it('should update head during client routing', async () => {\n+      const browser = await next.browser('/nav/head-1')\n+      expect(\n+        await browser\n+          .elementByCss('meta[name=\"description\"]')\n+          .getAttribute('content')\n+      ).toBe('Head One')\n+\n+      await browser\n+        .elementByCss('#to-head-2')\n+        .click()\n+        .waitForElementByCss('#head-2', 3000)\n+      expect(\n+        await browser\n+          .elementByCss('meta[name=\"description\"]')\n+          .getAttribute('content')\n+      ).toBe('Head Two')\n+\n+      await browser\n+        .elementByCss('#to-head-1')\n+        .click()\n+        .waitForElementByCss('#head-1', 3000)\n+      expect(\n+        await browser\n+          .elementByCss('meta[name=\"description\"]')\n+          .getAttribute('content')\n+      ).toBe('Head One')\n+\n+      await browser\n+        .elementByCss('#to-head-3')\n+        .click()\n+        .waitForElementByCss('#head-3', 3000)\n+      expect(\n+        await browser\n+          .elementByCss('meta[name=\"description\"]')\n+          .getAttribute('content')\n+      ).toBe('Head Three')\n+      expect(await browser.eval('document.title')).toBe('')\n+\n+      await browser\n+        .elementByCss('#to-head-1')\n+        .click()\n+        .waitForElementByCss('#head-1', 3000)\n+      expect(\n+        await browser\n+          .elementByCss('meta[name=\"description\"]')\n+          .getAttribute('content')\n+      ).toBe('Head One')\n+    })\n+\n+    it('should update title during client routing', async () => {\n+      const browser = await next.browser('/nav/head-1')\n+      expect(await browser.eval('document.title')).toBe('this is head-1')\n+\n+      await browser\n+        .elementByCss('#to-head-2')\n+        .click()\n+        .waitForElementByCss('#head-2', 3000)\n+      expect(await browser.eval('document.title')).toBe('this is head-2')\n+\n+      await browser\n+        .elementByCss('#to-head-1')\n+        .click()\n+        .waitForElementByCss('#head-1', 3000)\n+      expect(await browser.eval('document.title')).toBe('this is head-1')\n+    })\n+\n+    it('should update head when unmounting component', async () => {\n+      const browser = await next.browser('/head-dynamic')\n+      expect(await browser.eval('document.title')).toBe('B')\n+      await browser.elementByCss('button').click()\n+      expect(await browser.eval('document.title')).toBe('A')\n+      await browser.elementByCss('button').click()\n+      expect(await browser.eval('document.title')).toBe('B')\n+    })\n+  }\n+)"
        },
        {
            "sha": "3eb8df6e5efae322d4308c105a8d2ea76e9751eb",
            "filename": "test/development/pages-dir/client-navigation/index.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1271,
            "changes": 1271,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -1,8 +1,6 @@\n /* eslint-env jest */\n \n import {\n-  assertNoRedbox,\n-  fetchViaHTTP,\n   waitFor,\n   check,\n   retry,\n@@ -11,8 +9,6 @@ import {\n import path from 'path'\n import { nextTestSetup } from 'e2e-utils'\n \n-const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n-\n describe('Client Navigation', () => {\n   const { isTurbopack, next } = nextTestSetup({\n     files: path.join(__dirname, 'fixture'),\n@@ -21,239 +17,6 @@ describe('Client Navigation', () => {\n     },\n   })\n \n-  it('should not reload when visiting /_error directly', async () => {\n-    const { status } = await fetchViaHTTP(next.appPort, '/_error')\n-    const browser = await next.browser('/_error')\n-\n-    await browser.eval('window.hello = true')\n-\n-    // wait on-demand-entries timeout since it can trigger\n-    // reloading non-stop\n-    for (let i = 0; i < 15; i++) {\n-      expect(await browser.eval('window.hello')).toBe(true)\n-      await waitFor(1000)\n-    }\n-    const html = await browser.eval('document.documentElement.innerHTML')\n-\n-    expect(status).toBe(404)\n-    expect(html).toContain('This page could not be found')\n-    expect(html).toContain('404')\n-  })\n-\n-  describe('with <Link/>', () => {\n-    it('should navigate the page', async () => {\n-      const browser = await next.browser('/nav')\n-      const text = await browser\n-        .elementByCss('#about-link')\n-        .click()\n-        .waitForElementByCss('.nav-about')\n-        .elementByCss('p')\n-        .text()\n-\n-      expect(text).toBe('This is the about page.')\n-      await browser.close()\n-    })\n-\n-    it('should not throw error when one number type child is provided', async () => {\n-      const browser = await next.browser('/link-number-child')\n-      await assertNoRedbox(browser)\n-      if (browser) await browser.close()\n-    })\n-\n-    it('should navigate back after reload', async () => {\n-      const browser = await next.browser('/nav')\n-      await browser.elementByCss('#about-link').click()\n-      await browser.waitForElementByCss('.nav-about')\n-      await browser.refresh()\n-      await waitFor(3000)\n-      await browser.back()\n-      await waitFor(3000)\n-      const text = await browser.elementByCss('#about-link').text()\n-      if (browser) await browser.close()\n-      expect(text).toMatch(/About/)\n-    })\n-\n-    it('should navigate forwards after reload', async () => {\n-      const browser = await next.browser('/nav')\n-      await browser.elementByCss('#about-link').click()\n-      await browser.waitForElementByCss('.nav-about')\n-      await browser.back()\n-      await browser.refresh()\n-      await waitFor(3000)\n-      await browser.forward()\n-      await waitFor(3000)\n-      const text = await browser.elementByCss('p').text()\n-      if (browser) await browser.close()\n-      expect(text).toMatch(/this is the about page/i)\n-    })\n-\n-    it('should error when calling onClick without event', async () => {\n-      const browser = await next.browser('/link-invalid-onclick')\n-      expect(await browser.elementByCss('#errors').text()).toBe('0')\n-      await browser.elementByCss('#custom-button').click()\n-      expect(await browser.elementByCss('#errors').text()).toBe('1')\n-    })\n-\n-    it('should navigate via the client side', async () => {\n-      const browser = await next.browser('/nav')\n-\n-      const counterText = await browser\n-        .elementByCss('#increase')\n-        .click()\n-        .elementByCss('#about-link')\n-        .click()\n-        .waitForElementByCss('.nav-about')\n-        .elementByCss('#home-link')\n-        .click()\n-        .waitForElementByCss('.nav-home')\n-        .elementByCss('#counter')\n-        .text()\n-\n-      expect(counterText).toBe('Counter: 1')\n-      await browser.close()\n-    })\n-\n-    it('should navigate an absolute url', async () => {\n-      const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n-      await browser.waitForElementByCss('#absolute-link').click()\n-      await check(\n-        () => browser.eval(() => window.location.origin),\n-        'https://vercel.com'\n-      )\n-    })\n-\n-    it('should call mouse handlers with an absolute url', async () => {\n-      const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n-\n-      await browser.elementByCss('#absolute-link-mouse-events').moveTo()\n-\n-      expect(\n-        await browser\n-          .waitForElementByCss('#absolute-link-mouse-events')\n-          .getAttribute('data-hover')\n-      ).toBe('true')\n-    })\n-\n-    it('should navigate an absolute local url', async () => {\n-      const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n-      // @ts-expect-error _didNotNavigate is set intentionally\n-      await browser.eval(() => (window._didNotNavigate = true))\n-      await browser.waitForElementByCss('#absolute-local-link').click()\n-      const text = await browser\n-        .waitForElementByCss('.nav-about')\n-        .elementByCss('p')\n-        .text()\n-\n-      expect(text).toBe('This is the about page.')\n-      // @ts-expect-error _didNotNavigate is set intentionally\n-      expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n-    })\n-\n-    it('should navigate an absolute local url with as', async () => {\n-      const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n-      // @ts-expect-error _didNotNavigate is set intentionally\n-      await browser.eval(() => (window._didNotNavigate = true))\n-      await browser.waitForElementByCss('#absolute-local-dynamic-link').click()\n-      expect(await browser.waitForElementByCss('#dynamic-page').text()).toBe(\n-        'hello'\n-      )\n-      // @ts-expect-error _didNotNavigate is set intentionally\n-      expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n-    })\n-  })\n-\n-  describe('with <a/> tag inside the <Link />', () => {\n-    it('should navigate the page', async () => {\n-      const browser = await next.browser('/nav/about')\n-      const text = await browser\n-        .elementByCss('#home-link')\n-        .click()\n-        .waitForElementByCss('.nav-home')\n-        .elementByCss('p')\n-        .text()\n-\n-      expect(text).toBe('This is the home.')\n-      await browser.close()\n-    })\n-\n-    it('should not navigate if the <a/> tag has a target', async () => {\n-      const browser = await next.browser('/nav')\n-\n-      await browser\n-        .elementByCss('#increase')\n-        .click()\n-        .elementByCss('#target-link')\n-        .click()\n-\n-      await waitFor(1000)\n-\n-      const counterText = await browser.elementByCss('#counter').text()\n-\n-      expect(counterText).toBe('Counter: 1')\n-      await browser.close()\n-    })\n-\n-    it('should not navigate if the click-event is modified', async () => {\n-      const browser = await next.browser('/nav')\n-\n-      await browser.elementByCss('#increase').click()\n-\n-      const key = process.platform === 'darwin' ? 'Meta' : 'Control'\n-\n-      await browser.keydown(key)\n-\n-      await browser.elementByCss('#in-svg-link').click()\n-\n-      await browser.keyup(key)\n-      await waitFor(1000)\n-\n-      const counterText = await browser.elementByCss('#counter').text()\n-\n-      expect(counterText).toBe('Counter: 1')\n-      await browser.close()\n-    })\n-\n-    it('should not reload when link in svg is clicked', async () => {\n-      const browser = await next.browser('/nav')\n-      await browser.eval('window.hello = true')\n-      await browser\n-        .elementByCss('#in-svg-link')\n-        .click()\n-        .waitForElementByCss('.nav-about')\n-\n-      expect(await browser.eval('window.hello')).toBe(true)\n-      await browser.close()\n-    })\n-  })\n-\n-  describe('with unexpected <a/> nested tag', () => {\n-    it('should not redirect if passHref prop is not defined in Link', async () => {\n-      const browser = await next.browser('/nav/pass-href-prop')\n-      const text = await browser\n-        .elementByCss('#without-href')\n-        .click()\n-        .waitForElementByCss('.nav-pass-href-prop')\n-        .elementByCss('p')\n-        .text()\n-\n-      expect(text).toBe('This is the passHref prop page.')\n-      await browser.close()\n-    })\n-\n-    it('should redirect if passHref prop is defined in Link', async () => {\n-      const browser = await next.browser('/nav/pass-href-prop')\n-      const text = await browser\n-        .elementByCss('#with-href')\n-        .click()\n-        .waitForElementByCss('.nav-home')\n-        .elementByCss('p')\n-        .text()\n-\n-      expect(text).toBe('This is the home.')\n-      await browser.close()\n-    })\n-  })\n-\n   describe('with empty getInitialProps()', () => {\n     it('should render a redbox', async () => {\n       const pageErrors: unknown[] = []\n@@ -283,34 +46,6 @@ describe('Client Navigation', () => {\n     })\n   })\n \n-  describe('with the same page but different querystring', () => {\n-    it('should navigate the page', async () => {\n-      const browser = await next.browser('/nav/querystring?id=1')\n-      const text = await browser\n-        .elementByCss('#next-id-link')\n-        .click()\n-        .waitForElementByCss('.nav-id-2')\n-        .elementByCss('p')\n-        .text()\n-\n-      expect(text).toBe('2')\n-      await browser.close()\n-    })\n-\n-    it('should remove querystring', async () => {\n-      const browser = await next.browser('/nav/querystring?id=1')\n-      const text = await browser\n-        .elementByCss('#main-page')\n-        .click()\n-        .waitForElementByCss('.nav-id-0')\n-        .elementByCss('p')\n-        .text()\n-\n-      expect(text).toBe('0')\n-      await browser.close()\n-    })\n-  })\n-\n   describe('with the current url', () => {\n     it('should reload the page', async () => {\n       const browser = await next.browser('/nav/self-reload')\n@@ -349,537 +84,6 @@ describe('Client Navigation', () => {\n     })\n   })\n \n-  describe('with onClick action', () => {\n-    it('should reload the page and perform additional action', async () => {\n-      const browser = await next.browser('/nav/on-click')\n-      const defaultCountQuery = await browser\n-        .elementByCss('#query-count')\n-        .text()\n-      const defaultCountState = await browser\n-        .elementByCss('#state-count')\n-        .text()\n-      expect(defaultCountQuery).toBe('QUERY COUNT: 0')\n-      expect(defaultCountState).toBe('STATE COUNT: 0')\n-\n-      await browser.elementByCss('#on-click-link').click()\n-\n-      const countQueryAfterClicked = await browser\n-        .elementByCss('#query-count')\n-        .text()\n-      const countStateAfterClicked = await browser\n-        .elementByCss('#state-count')\n-        .text()\n-      expect(countQueryAfterClicked).toBe('QUERY COUNT: 1')\n-      expect(countStateAfterClicked).toBe('STATE COUNT: 1')\n-    })\n-\n-    it('should not reload if default was prevented', async () => {\n-      const browser = await next.browser('/nav/on-click')\n-      const defaultCountQuery = await browser\n-        .elementByCss('#query-count')\n-        .text()\n-      const defaultCountState = await browser\n-        .elementByCss('#state-count')\n-        .text()\n-      expect(defaultCountQuery).toBe('QUERY COUNT: 0')\n-      expect(defaultCountState).toBe('STATE COUNT: 0')\n-\n-      await browser.elementByCss('#on-click-link-prevent-default').click()\n-\n-      const countQueryAfterClicked = await browser\n-        .elementByCss('#query-count')\n-        .text()\n-      const countStateAfterClicked = await browser\n-        .elementByCss('#state-count')\n-        .text()\n-      expect(countQueryAfterClicked).toBe('QUERY COUNT: 0')\n-      expect(countStateAfterClicked).toBe('STATE COUNT: 1')\n-\n-      await browser.elementByCss('#on-click-link').click()\n-\n-      const countQueryAfterClickedAgain = await browser\n-        .elementByCss('#query-count')\n-        .text()\n-      const countStateAfterClickedAgain = await browser\n-        .elementByCss('#state-count')\n-        .text()\n-      expect(countQueryAfterClickedAgain).toBe('QUERY COUNT: 1')\n-      expect(countStateAfterClickedAgain).toBe('STATE COUNT: 2')\n-    })\n-\n-    it('should always replace the state and perform additional action', async () => {\n-      const browser = await next.browser('/nav')\n-\n-      await browser\n-        .elementByCss('#on-click-link')\n-        .click()\n-        .waitForElementByCss('#on-click-page')\n-\n-      const defaultCountQuery = await browser\n-        .elementByCss('#query-count')\n-        .text()\n-      expect(defaultCountQuery).toBe('QUERY COUNT: 1')\n-\n-      await browser.elementByCss('#on-click-link').click()\n-      const countQueryAfterClicked = await browser\n-        .elementByCss('#query-count')\n-        .text()\n-      const countStateAfterClicked = await browser\n-        .elementByCss('#state-count')\n-        .text()\n-      expect(countQueryAfterClicked).toBe('QUERY COUNT: 2')\n-      expect(countStateAfterClicked).toBe('STATE COUNT: 1')\n-\n-      // Since we replace the state, back button would simply go us back to /nav\n-      await browser.back().waitForElementByCss('.nav-home')\n-    })\n-  })\n-  describe('resets scroll at the correct time', () => {\n-    it('should reset scroll before the new page runs its lifecycles (<Link />)', async () => {\n-      const browser = await next.browser('/nav/long-page-to-snap-scroll')\n-\n-      // Scrolls to item 400 on the page\n-      await browser\n-        .waitForElementByCss('#long-page-to-snap-scroll')\n-        .elementByCss('#scroll-to-item-400')\n-        .click()\n-\n-      const scrollPosition = await browser.eval('window.pageYOffset')\n-      expect(scrollPosition).toBe(7208)\n-\n-      // Go to snap scroll page\n-      await browser\n-        .elementByCss('#goto-snap-scroll-position')\n-        .click()\n-        .waitForElementByCss('#scroll-pos-y')\n-\n-      const snappedScrollPosition = await browser.eval(\n-        'document.getElementById(\"scroll-pos-y\").innerText'\n-      )\n-      expect(snappedScrollPosition).toBe('0')\n-    })\n-\n-    it('should reset scroll before the new page runs its lifecycles (Router#push)', async () => {\n-      const browser = await next.browser('/nav/long-page-to-snap-scroll')\n-\n-      // Scrolls to item 400 on the page\n-      await browser\n-        .waitForElementByCss('#long-page-to-snap-scroll')\n-        .elementByCss('#scroll-to-item-400')\n-        .click()\n-\n-      const scrollPosition = await browser.eval('window.pageYOffset')\n-      expect(scrollPosition).toBe(7208)\n-\n-      // Go to snap scroll page\n-      await browser\n-        .elementByCss('#goto-snap-scroll-position-imperative')\n-        .click()\n-        .waitForElementByCss('#scroll-pos-y')\n-\n-      const snappedScrollPosition = await browser.eval(\n-        'document.getElementById(\"scroll-pos-y\").innerText'\n-      )\n-      expect(snappedScrollPosition).toBe('0')\n-    })\n-\n-    it('should intentionally not reset scroll before the new page runs its lifecycles (Router#push)', async () => {\n-      const browser = await next.browser('/nav/long-page-to-snap-scroll')\n-\n-      // Scrolls to item 400 on the page\n-      await browser\n-        .waitForElementByCss('#long-page-to-snap-scroll')\n-        .elementByCss('#scroll-to-item-400')\n-        .click()\n-\n-      const scrollPosition = await browser.eval('window.pageYOffset')\n-      expect(scrollPosition).toBe(7208)\n-\n-      // Go to snap scroll page\n-      await browser\n-        .elementByCss('#goto-snap-scroll-position-imperative-noscroll')\n-        .click()\n-        .waitForElementByCss('#scroll-pos-y')\n-\n-      const snappedScrollPosition = await browser.eval(\n-        'document.getElementById(\"scroll-pos-y\").innerText'\n-      )\n-      expect(snappedScrollPosition).not.toBe('0')\n-      expect(Number(snappedScrollPosition)).toBeGreaterThanOrEqual(7208)\n-    })\n-  })\n-\n-  describe('with hash changes', () => {\n-    describe('check hydration mis-match', () => {\n-      it('should not have hydration mis-match for hash link', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-        const browserLogs = await browser.log()\n-        let found = false\n-        browserLogs.forEach((log) => {\n-          console.log('log.message', log.message)\n-          if (log.message.includes('Warning: Prop')) {\n-            found = true\n-          }\n-        })\n-        expect(found).toEqual(false)\n-      })\n-    })\n-\n-    describe('when hash change via Link', () => {\n-      it('should not run getInitialProps', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-\n-        const counter = await browser\n-          .elementByCss('#via-link')\n-          .click()\n-          .elementByCss('p')\n-          .text()\n-\n-        expect(counter).toBe('COUNT: 0')\n-\n-        await browser.close()\n-      })\n-\n-      it('should scroll to the specified position on the same page', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-\n-        // Scrolls to item 400 on the page\n-        await browser.elementByCss('#scroll-to-item-400').click()\n-\n-        const scrollPositionBeforeEmptyHash =\n-          await browser.eval('window.pageYOffset')\n-\n-        expect(scrollPositionBeforeEmptyHash).toBe(7258)\n-\n-        // Scrolls back to top when scrolling to `#` with no value.\n-        await browser.elementByCss('#via-empty-hash').click()\n-\n-        const scrollPositionAfterEmptyHash =\n-          await browser.eval('window.pageYOffset')\n-\n-        expect(scrollPositionAfterEmptyHash).toBe(0)\n-\n-        // Scrolls to item 400 on the page\n-        await browser.elementByCss('#scroll-to-item-400').click()\n-\n-        const scrollPositionBeforeTopHash =\n-          await browser.eval('window.pageYOffset')\n-\n-        expect(scrollPositionBeforeTopHash).toBe(7258)\n-\n-        // Scrolls back to top when clicking link with href `#top`.\n-        await browser.elementByCss('#via-top-hash').click()\n-\n-        const scrollPositionAfterTopHash =\n-          await browser.eval('window.pageYOffset')\n-\n-        expect(scrollPositionAfterTopHash).toBe(0)\n-\n-        // Scrolls to cjk anchor on the page\n-        await browser.elementByCss('#scroll-to-cjk-anchor').click()\n-\n-        const scrollPositionCJKHash = await browser.eval('window.pageYOffset')\n-\n-        expect(scrollPositionCJKHash).toBe(17436)\n-      })\n-\n-      it('should not scroll to hash when scroll={false} is set', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-        const curScroll = await browser.eval(\n-          'document.documentElement.scrollTop'\n-        )\n-        await browser.elementByCss('#scroll-to-name-item-400-no-scroll').click()\n-        expect(curScroll).toBe(\n-          await browser.eval('document.documentElement.scrollTop')\n-        )\n-      })\n-\n-      it('should scroll to the specified position on the same page with a name property', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-\n-        // Scrolls to item 400 with name=\"name-item-400\" on the page\n-        await browser.elementByCss('#scroll-to-name-item-400').click()\n-\n-        const scrollPosition = await browser.eval('window.pageYOffset')\n-\n-        expect(scrollPosition).toBe(16258)\n-\n-        // Scrolls back to top when scrolling to `#` with no value.\n-        await browser.elementByCss('#via-empty-hash').click()\n-\n-        const scrollPositionAfterEmptyHash =\n-          await browser.eval('window.pageYOffset')\n-\n-        expect(scrollPositionAfterEmptyHash).toBe(0)\n-      })\n-\n-      it('should scroll to the specified position to a new page', async () => {\n-        const browser = await next.browser('/nav')\n-\n-        // Scrolls to item 400 on the page\n-        await browser\n-          .elementByCss('#scroll-to-hash')\n-          .click()\n-          .waitForElementByCss('#hash-changes-page')\n-\n-        const scrollPosition = await browser.eval('window.pageYOffset')\n-        expect(scrollPosition).toBe(7258)\n-      })\n-\n-      it('should scroll to the specified CJK position to a new page', async () => {\n-        const browser = await next.browser('/nav')\n-\n-        // Scrolls to CJK anchor on the page\n-        await browser\n-          .elementByCss('#scroll-to-cjk-hash')\n-          .click()\n-          .waitForElementByCss('#hash-changes-page')\n-\n-        const scrollPosition = await browser.eval('window.pageYOffset')\n-        expect(scrollPosition).toBe(17436)\n-      })\n-\n-      it('Should update asPath', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-\n-        await browser.elementByCss('#via-link').click()\n-\n-        const asPath = await browser.elementByCss('div#asPath').text()\n-        expect(asPath).toBe('ASPATH: /nav/hash-changes#via-link')\n-      })\n-    })\n-\n-    describe('when hash change via A tag', () => {\n-      it('should not run getInitialProps', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-\n-        const counter = await browser\n-          .elementByCss('#via-a')\n-          .click()\n-          .elementByCss('p')\n-          .text()\n-\n-        expect(counter).toBe('COUNT: 0')\n-\n-        await browser.close()\n-      })\n-    })\n-\n-    describe('when hash get removed', () => {\n-      it('should not run getInitialProps', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-\n-        const counter = await browser\n-          .elementByCss('#via-a')\n-          .click()\n-          .elementByCss('#page-url')\n-          .click()\n-          .elementByCss('p')\n-          .text()\n-\n-        expect(counter).toBe('COUNT: 1')\n-\n-        await browser.close()\n-      })\n-\n-      it('should not run getInitialProps when removing via back', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-\n-        const counter = await browser\n-          .elementByCss('#scroll-to-item-400')\n-          .click()\n-          .back()\n-          .elementByCss('p')\n-          .text()\n-\n-        expect(counter).toBe('COUNT: 0')\n-        await browser.close()\n-      })\n-    })\n-\n-    describe('when hash set to empty', () => {\n-      it('should not run getInitialProps', async () => {\n-        const browser = await next.browser('/nav/hash-changes')\n-\n-        const counter = await browser\n-          .elementByCss('#via-a')\n-          .click()\n-          .elementByCss('#via-empty-hash')\n-          .click()\n-          .elementByCss('p')\n-          .text()\n-\n-        expect(counter).toBe('COUNT: 0')\n-\n-        await browser.close()\n-      })\n-    })\n-  })\n-\n-  describe('with hash changes with state', () => {\n-    describe('when passing state via hash change', () => {\n-      it('should increment the history state counter', async () => {\n-        const browser = await next.browser('/nav/hash-changes-with-state#')\n-\n-        const historyCount = await browser\n-          .elementByCss('#increment-history-count')\n-          .click()\n-          .elementByCss('#increment-history-count')\n-          .click()\n-          .elementByCss('div#history-count')\n-          .text()\n-\n-        expect(historyCount).toBe('HISTORY COUNT: 2')\n-\n-        const counter = await browser.elementByCss('p').text()\n-\n-        // getInitialProps should not be called with only hash changes\n-        expect(counter).toBe('COUNT: 0')\n-\n-        await browser.close()\n-      })\n-\n-      it('should increment the shallow history state counter', async () => {\n-        const browser = await next.browser('/nav/hash-changes-with-state#')\n-\n-        const historyCount = await browser\n-          .elementByCss('#increment-shallow-history-count')\n-          .click()\n-          .elementByCss('#increment-shallow-history-count')\n-          .click()\n-          .elementByCss('div#shallow-history-count')\n-          .text()\n-\n-        expect(historyCount).toBe('SHALLOW HISTORY COUNT: 2')\n-\n-        const counter = await browser.elementByCss('p').text()\n-\n-        expect(counter).toBe('COUNT: 0')\n-\n-        await browser.close()\n-      })\n-    })\n-  })\n-\n-  describe('with shallow routing', () => {\n-    it('should update the url without running getInitialProps', async () => {\n-      const browser = await next.browser('/nav/shallow-routing')\n-      const counter = await browser\n-        .elementByCss('#increase')\n-        .click()\n-        .elementByCss('#increase')\n-        .click()\n-        .elementByCss('#counter')\n-        .text()\n-      expect(counter).toBe('Counter: 2')\n-\n-      const getInitialPropsRunCount = await browser\n-        .elementByCss('#get-initial-props-run-count')\n-        .text()\n-      expect(getInitialPropsRunCount).toBe('getInitialProps run count: 1')\n-\n-      await browser.close()\n-    })\n-\n-    it('should handle the back button and should not run getInitialProps', async () => {\n-      const browser = await next.browser('/nav/shallow-routing')\n-      let counter = await browser\n-        .elementByCss('#increase')\n-        .click()\n-        .elementByCss('#increase')\n-        .click()\n-        .elementByCss('#counter')\n-        .text()\n-      expect(counter).toBe('Counter: 2')\n-\n-      counter = await browser.back().elementByCss('#counter').text()\n-      expect(counter).toBe('Counter: 1')\n-\n-      const getInitialPropsRunCount = await browser\n-        .elementByCss('#get-initial-props-run-count')\n-        .text()\n-      expect(getInitialPropsRunCount).toBe('getInitialProps run count: 1')\n-\n-      await browser.close()\n-    })\n-\n-    it('should run getInitialProps always when rending the page to the screen', async () => {\n-      const browser = await next.browser('/nav/shallow-routing')\n-\n-      const counter = await browser\n-        .elementByCss('#increase')\n-        .click()\n-        .elementByCss('#increase')\n-        .click()\n-        .elementByCss('#home-link')\n-        .click()\n-        .waitForElementByCss('.nav-home')\n-        .back()\n-        .waitForElementByCss('.shallow-routing')\n-        .elementByCss('#counter')\n-        .text()\n-      expect(counter).toBe('Counter: 2')\n-\n-      const getInitialPropsRunCount = await browser\n-        .elementByCss('#get-initial-props-run-count')\n-        .text()\n-      expect(getInitialPropsRunCount).toBe('getInitialProps run count: 2')\n-\n-      await browser.close()\n-    })\n-\n-    it('should keep the scroll position on shallow routing', async () => {\n-      const browser = await next.browser('/nav/shallow-routing')\n-      await browser.eval(() =>\n-        document.querySelector('#increase').scrollIntoView()\n-      )\n-      const scrollPosition = await browser.eval('window.pageYOffset')\n-\n-      expect(scrollPosition).toBeGreaterThan(3000)\n-\n-      await browser.elementByCss('#increase').click()\n-      await waitFor(500)\n-      const newScrollPosition = await browser.eval('window.pageYOffset')\n-\n-      expect(newScrollPosition).toBe(scrollPosition)\n-\n-      await browser.elementByCss('#increase2').click()\n-      await waitFor(500)\n-      const newScrollPosition2 = await browser.eval('window.pageYOffset')\n-\n-      expect(newScrollPosition2).toBe(0)\n-\n-      await browser.eval(() =>\n-        document.querySelector('#invalidShallow').scrollIntoView()\n-      )\n-      const scrollPositionDown = await browser.eval('window.pageYOffset')\n-\n-      expect(scrollPositionDown).toBeGreaterThan(3000)\n-\n-      await browser.elementByCss('#invalidShallow').click()\n-      await waitFor(500)\n-      const newScrollPosition3 = await browser.eval('window.pageYOffset')\n-\n-      expect(newScrollPosition3).toBe(0)\n-    })\n-  })\n-\n-  it('should scroll to top when the scroll option is set to true', async () => {\n-    const browser = await next.browser('/nav/shallow-routing')\n-    await browser.eval(() =>\n-      document.querySelector('#increaseWithScroll').scrollIntoView()\n-    )\n-    const scrollPosition = await browser.eval('window.pageYOffset')\n-\n-    expect(scrollPosition).toBeGreaterThan(3000)\n-\n-    await browser.elementByCss('#increaseWithScroll').click()\n-    await check(async () => {\n-      const newScrollPosition = await browser.eval('window.pageYOffset')\n-      return newScrollPosition === 0 ? 'success' : 'fail'\n-    }, 'success')\n-  })\n-\n   describe('with URL objects', () => {\n     it('should work with <Link/>', async () => {\n       const browser = await next.browser('/nav')\n@@ -968,41 +172,6 @@ describe('Client Navigation', () => {\n     })\n   })\n \n-  describe('with querystring relative urls', () => {\n-    it('should work with Link', async () => {\n-      const browser = await next.browser('/nav/query-only')\n-      await browser.elementByCss('#link').click()\n-\n-      await check(() => browser.waitForElementByCss('#prop').text(), 'foo')\n-    })\n-\n-    it('should work with router.push', async () => {\n-      const browser = await next.browser('/nav/query-only')\n-      await browser.elementByCss('#router-push').click()\n-\n-      await check(() => browser.waitForElementByCss('#prop').text(), 'bar')\n-    })\n-\n-    it('should work with router.replace', async () => {\n-      const browser = await next.browser('/nav/query-only')\n-      await browser.elementByCss('#router-replace').click()\n-\n-      await check(() => browser.waitForElementByCss('#prop').text(), 'baz')\n-    })\n-\n-    it('router.replace with shallow=true shall not throw route cancelled errors', async () => {\n-      const browser = await next.browser('/nav/query-only-shallow')\n-      await browser.elementByCss('#router-replace').click()\n-      // the error occurs on every replace() after the first one\n-      await browser.elementByCss('#router-replace').click()\n-\n-      await check(\n-        () => browser.waitForElementByCss('#routeState').text(),\n-        '{\"completed\":2,\"errors\":0}'\n-      )\n-    })\n-  })\n-\n   describe('with getInitialProp redirect', () => {\n     it('should redirect the page via client side', async () => {\n       const browser = await next.browser('/nav')\n@@ -1086,157 +255,6 @@ describe('Client Navigation', () => {\n     })\n   })\n \n-  describe('with asPath', () => {\n-    describe('inside getInitialProps', () => {\n-      it('should show the correct asPath with a Link with as prop', async () => {\n-        const browser = await next.browser('/nav')\n-        const asPath = await browser\n-          .elementByCss('#as-path-link')\n-          .click()\n-          .waitForElementByCss('.as-path-content')\n-          .elementByCss('.as-path-content')\n-          .text()\n-\n-        expect(asPath).toBe('/as/path')\n-        await browser.close()\n-      })\n-\n-      it('should show the correct asPath with a Link without the as prop', async () => {\n-        const browser = await next.browser('/nav')\n-        const asPath = await browser\n-          .elementByCss('#as-path-link-no-as')\n-          .click()\n-          .waitForElementByCss('.as-path-content')\n-          .elementByCss('.as-path-content')\n-          .text()\n-\n-        expect(asPath).toBe('/nav/as-path')\n-        await browser.close()\n-      })\n-    })\n-\n-    describe('with next/router', () => {\n-      it('should show the correct asPath', async () => {\n-        const browser = await next.browser('/nav')\n-        const asPath = await browser\n-          .elementByCss('#as-path-using-router-link')\n-          .click()\n-          .waitForElementByCss('.as-path-content')\n-          .elementByCss('.as-path-content')\n-          .text()\n-\n-        expect(asPath).toBe('/nav/as-path-using-router')\n-        await browser.close()\n-      })\n-\n-      it('should navigate an absolute url on push', async () => {\n-        const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n-        await browser.waitForElementByCss('#router-push').click()\n-        await check(\n-          () => browser.eval(() => window.location.origin),\n-          'https://vercel.com'\n-        )\n-      })\n-\n-      it('should navigate an absolute url on replace', async () => {\n-        const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n-        await browser.waitForElementByCss('#router-replace').click()\n-        await check(\n-          () => browser.eval(() => window.location.origin),\n-          'https://vercel.com'\n-        )\n-      })\n-\n-      it('should navigate an absolute local url on push', async () => {\n-        const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n-        // @ts-expect-error _didNotNavigate is set intentionally\n-        await browser.eval(() => (window._didNotNavigate = true))\n-        await browser.waitForElementByCss('#router-local-push').click()\n-        const text = await browser\n-          .waitForElementByCss('.nav-about')\n-          .elementByCss('p')\n-          .text()\n-        expect(text).toBe('This is the about page.')\n-        // @ts-expect-error _didNotNavigate is set intentionally\n-        expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n-      })\n-\n-      it('should navigate an absolute local url on replace', async () => {\n-        const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n-        // @ts-expect-error _didNotNavigate is set intentionally\n-        await browser.eval(() => (window._didNotNavigate = true))\n-        await browser.waitForElementByCss('#router-local-replace').click()\n-        const text = await browser\n-          .waitForElementByCss('.nav-about')\n-          .elementByCss('p')\n-          .text()\n-        expect(text).toBe('This is the about page.')\n-        // @ts-expect-error _didNotNavigate is set intentionally\n-        expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n-      })\n-    })\n-\n-    describe('with next/link', () => {\n-      it('should use pushState with same href and different asPath', async () => {\n-        const browser = await next.browser('/nav/as-path-pushstate')\n-        await browser\n-          .elementByCss('#hello')\n-          .click()\n-          .waitForElementByCss('#something-hello')\n-        const queryOne = JSON.parse(\n-          await browser.elementByCss('#router-query').text()\n-        )\n-        expect(queryOne.something).toBe('hello')\n-        await browser\n-          .elementByCss('#same-query')\n-          .click()\n-          .waitForElementByCss('#something-same-query')\n-        const queryTwo = JSON.parse(\n-          await browser.elementByCss('#router-query').text()\n-        )\n-        expect(queryTwo.something).toBe('hello')\n-        await browser.back().waitForElementByCss('#something-hello')\n-        const queryThree = JSON.parse(\n-          await browser.elementByCss('#router-query').text()\n-        )\n-        expect(queryThree.something).toBe('hello')\n-        await browser\n-          .elementByCss('#else')\n-          .click()\n-          .waitForElementByCss('#something-else')\n-        await browser\n-          .elementByCss('#hello2')\n-          .click()\n-          .waitForElementByCss('#nav-as-path-pushstate')\n-        await browser.back().waitForElementByCss('#something-else')\n-        const queryFour = JSON.parse(\n-          await browser.elementByCss('#router-query').text()\n-        )\n-        expect(queryFour.something).toBe(undefined)\n-      })\n-\n-      it('should detect asPath query changes correctly', async () => {\n-        const browser = await next.browser('/nav/as-path-query')\n-        await browser\n-          .elementByCss('#hello')\n-          .click()\n-          .waitForElementByCss('#something-hello-something-hello')\n-        const queryOne = JSON.parse(\n-          await browser.elementByCss('#router-query').text()\n-        )\n-        expect(queryOne.something).toBe('hello')\n-        await browser\n-          .elementByCss('#hello2')\n-          .click()\n-          .waitForElementByCss('#something-hello-something-else')\n-        const queryTwo = JSON.parse(\n-          await browser.elementByCss('#router-query').text()\n-        )\n-        expect(queryTwo.something).toBe('else')\n-      })\n-    })\n-  })\n-\n   describe('runtime errors', () => {\n     it('should show redbox when a client side error is thrown inside a component', async () => {\n       const isReact18 = process.env.NEXT_TEST_REACT_VERSION?.startsWith('18')\n@@ -1368,97 +386,6 @@ describe('Client Navigation', () => {\n     })\n   })\n \n-  describe('with 404 pages', () => {\n-    it('should 404 on not existent page', async () => {\n-      const browser = await next.browser('/non-existent')\n-      expect(await browser.elementByCss('h1').text()).toBe('404')\n-      expect(await browser.elementByCss('h2').text()).toBe(\n-        'This page could not be found.'\n-      )\n-      await browser.close()\n-    })\n-\n-    it('should 404 on wrong casing', async () => {\n-      const browser = await next.browser('/nAv/AbOuT')\n-      expect(await browser.elementByCss('h1').text()).toBe('404')\n-      expect(await browser.elementByCss('h2').text()).toBe(\n-        'This page could not be found.'\n-      )\n-      await browser.close()\n-    })\n-\n-    it('should get url dynamic param', async () => {\n-      const browser = await next.browser('/dynamic/dynamic-part/route')\n-      expect(await browser.elementByCss('p').text()).toBe('dynamic-part')\n-      await browser.close()\n-    })\n-\n-    it('should 404 on wrong casing of url dynamic param', async () => {\n-      const browser = await next.browser('/dynamic/dynamic-part/RoUtE')\n-      expect(await browser.elementByCss('h1').text()).toBe('404')\n-      expect(await browser.elementByCss('h2').text()).toBe(\n-        'This page could not be found.'\n-      )\n-      await browser.close()\n-    })\n-\n-    it('should not 404 for <page>/', async () => {\n-      const browser = await next.browser('/nav/about/')\n-      const text = await browser.elementByCss('p').text()\n-      expect(text).toBe('This is the about page.')\n-      await browser.close()\n-    })\n-\n-    it('should should not contain a page script in a 404 page', async () => {\n-      const browser = await next.browser('/non-existent')\n-      const scripts = await browser.elementsByCss('script[src]')\n-      for (const script of scripts) {\n-        const src = await script.getAttribute('src')\n-        expect(src.includes('/non-existent')).toBeFalsy()\n-      }\n-      await browser.close()\n-    })\n-  })\n-\n-  describe('foreign history manipulation', () => {\n-    it('should ignore history state without options', async () => {\n-      const browser = await next.browser('/nav')\n-      // push history object without options\n-      await browser.eval(\n-        'window.history.pushState({ url: \"/whatever\" }, \"\", \"/whatever\")'\n-      )\n-      await browser.elementByCss('#about-link').click()\n-      await browser.waitForElementByCss('.nav-about')\n-      await browser.back()\n-      await waitFor(1000)\n-      await assertNoRedbox(browser)\n-    })\n-\n-    it('should ignore history state with an invalid url', async () => {\n-      const browser = await next.browser('/nav')\n-      // push history object wit invalid url (not relative)\n-      await browser.eval(\n-        'window.history.pushState({ url: \"http://google.com\" }, \"\", \"/whatever\")'\n-      )\n-      await browser.elementByCss('#about-link').click()\n-      await browser.waitForElementByCss('.nav-about')\n-      await browser.back()\n-      await waitFor(1000)\n-      await assertNoRedbox(browser)\n-    })\n-\n-    it('should ignore foreign history state with missing properties', async () => {\n-      const browser = await next.browser('/nav')\n-      // push empty history state\n-      await browser.eval('window.history.pushState({}, \"\", \"/whatever\")')\n-      await browser.elementByCss('#about-link').click()\n-      await browser.waitForElementByCss('.nav-about')\n-      await browser.back()\n-      await waitFor(1000)\n-      await assertNoRedbox(browser)\n-    })\n-  })\n-\n   it('should not error on module.exports + polyfills', async () => {\n     const browser = await next.browser('/read-only-object-error')\n     expect(await browser.elementByCss('body').text()).toBe(\n@@ -1549,201 +476,3 @@ describe('Client Navigation', () => {\n     await browser.close()\n   })\n })\n-\n-describe.each([[false], [true]])(\n-  'updating <Head /> with strictNextHead=%s while client routing',\n-  (strictNextHead) => {\n-    const { next } = nextTestSetup({\n-      files: path.join(__dirname, 'fixture'),\n-      env: {\n-        TEST_STRICT_NEXT_HEAD: String(strictNextHead),\n-      },\n-    })\n-\n-    it.each([true, false])(\n-      'should handle boolean async prop in next/head client-side: %s',\n-      async (bool) => {\n-        const browser = await next.browser('/head')\n-        const value = await browser.eval(\n-          `document.querySelector('script[src=\"/test-async-${JSON.stringify(\n-            bool\n-          )}.js\"]').async`\n-        )\n-\n-        expect(value).toBe(bool)\n-      }\n-    )\n-\n-    it('should only execute async and defer scripts once', async () => {\n-      const browser = await next.browser('/head')\n-\n-      await browser.waitForElementByCss('h1')\n-      await waitFor(2000)\n-      expect(Number(await browser.eval('window.__test_async_executions'))).toBe(\n-        strictNextHead || isReact18\n-          ? 1\n-          : // <meta name=\"next-head-count\" /> is floated before <script />.\n-            // head-manager thinks it needs to add these again resulting in another execution.\n-            2\n-      )\n-      expect(Number(await browser.eval('window.__test_defer_executions'))).toBe(\n-        strictNextHead || isReact18\n-          ? 1\n-          : // <meta name=\"next-head-count\" /> is floated before <script defer />.\n-            // head-manager thinks it needs to add these again resulting in another execution.\n-            2\n-      )\n-\n-      await browser.elementByCss('#reverseScriptOrder').click()\n-      await waitFor(2000)\n-\n-      expect(Number(await browser.eval('window.__test_async_executions'))).toBe(\n-        strictNextHead || isReact18 ? 1 : 2\n-      )\n-      expect(Number(await browser.eval('window.__test_defer_executions'))).toBe(\n-        strictNextHead || isReact18 ? 1 : 2\n-      )\n-\n-      await browser.elementByCss('#toggleScript').click()\n-      await waitFor(2000)\n-\n-      expect(Number(await browser.eval('window.__test_async_executions'))).toBe(\n-        strictNextHead || isReact18 ? 1 : 2\n-      )\n-      expect(Number(await browser.eval('window.__test_defer_executions'))).toBe(\n-        strictNextHead || isReact18 ? 1 : 2\n-      )\n-    })\n-\n-    it('should warn when stylesheets or scripts are in head', async () => {\n-      const browser = await next.browser('/head')\n-\n-      await browser.waitForElementByCss('h1')\n-      await waitFor(1000)\n-      const browserLogs = await browser.log()\n-      let foundStyles = false\n-      let foundScripts = false\n-      const logs = []\n-      browserLogs.forEach(({ message }) => {\n-        if (message.includes('Do not add stylesheets using next/head')) {\n-          foundStyles = true\n-          logs.push(message)\n-        }\n-        if (message.includes('Do not add <script> tags using next/head')) {\n-          foundScripts = true\n-          logs.push(message)\n-        }\n-      })\n-\n-      expect(foundStyles).toEqual(true)\n-      expect(foundScripts).toEqual(true)\n-\n-      // Warnings are unique\n-      expect(logs.length).toEqual(new Set(logs).size)\n-    })\n-\n-    it('should warn when scripts are in head', async () => {\n-      const browser = await next.browser('/head')\n-      await browser.waitForElementByCss('h1')\n-      await waitFor(1000)\n-      const browserLogs = await browser.log()\n-      let found = false\n-      browserLogs.forEach((log) => {\n-        if (log.message.includes('Use next/script instead')) {\n-          found = true\n-        }\n-      })\n-      expect(found).toEqual(true)\n-    })\n-\n-    it('should not warn when application/ld+json scripts are in head', async () => {\n-      const browser = await next.browser('/head-with-json-ld-snippet')\n-      await browser.waitForElementByCss('h1')\n-      await waitFor(1000)\n-      const browserLogs = await browser.log()\n-      let found = false\n-      browserLogs.forEach((log) => {\n-        if (log.message.includes('Use next/script instead')) {\n-          found = true\n-        }\n-      })\n-      expect(found).toEqual(false)\n-    })\n-\n-    it('should update head during client routing', async () => {\n-      const browser = await next.browser('/nav/head-1')\n-      expect(\n-        await browser\n-          .elementByCss('meta[name=\"description\"]')\n-          .getAttribute('content')\n-      ).toBe('Head One')\n-\n-      await browser\n-        .elementByCss('#to-head-2')\n-        .click()\n-        .waitForElementByCss('#head-2', 3000)\n-      expect(\n-        await browser\n-          .elementByCss('meta[name=\"description\"]')\n-          .getAttribute('content')\n-      ).toBe('Head Two')\n-\n-      await browser\n-        .elementByCss('#to-head-1')\n-        .click()\n-        .waitForElementByCss('#head-1', 3000)\n-      expect(\n-        await browser\n-          .elementByCss('meta[name=\"description\"]')\n-          .getAttribute('content')\n-      ).toBe('Head One')\n-\n-      await browser\n-        .elementByCss('#to-head-3')\n-        .click()\n-        .waitForElementByCss('#head-3', 3000)\n-      expect(\n-        await browser\n-          .elementByCss('meta[name=\"description\"]')\n-          .getAttribute('content')\n-      ).toBe('Head Three')\n-      expect(await browser.eval('document.title')).toBe('')\n-\n-      await browser\n-        .elementByCss('#to-head-1')\n-        .click()\n-        .waitForElementByCss('#head-1', 3000)\n-      expect(\n-        await browser\n-          .elementByCss('meta[name=\"description\"]')\n-          .getAttribute('content')\n-      ).toBe('Head One')\n-    })\n-\n-    it('should update title during client routing', async () => {\n-      const browser = await next.browser('/nav/head-1')\n-      expect(await browser.eval('document.title')).toBe('this is head-1')\n-\n-      await browser\n-        .elementByCss('#to-head-2')\n-        .click()\n-        .waitForElementByCss('#head-2', 3000)\n-      expect(await browser.eval('document.title')).toBe('this is head-2')\n-\n-      await browser\n-        .elementByCss('#to-head-1')\n-        .click()\n-        .waitForElementByCss('#head-1', 3000)\n-      expect(await browser.eval('document.title')).toBe('this is head-1')\n-    })\n-\n-    it('should update head when unmounting component', async () => {\n-      const browser = await next.browser('/head-dynamic')\n-      expect(await browser.eval('document.title')).toBe('B')\n-      await browser.elementByCss('button').click()\n-      expect(await browser.eval('document.title')).toBe('A')\n-      await browser.elementByCss('button').click()\n-      expect(await browser.eval('document.title')).toBe('B')\n-    })\n-  }\n-)"
        },
        {
            "sha": "bf2a4bb85b33f65c85b66b6d07c08130e60a5b49",
            "filename": "test/development/pages-dir/client-navigation/link.test.ts",
            "status": "added",
            "additions": 134,
            "deletions": 0,
            "changes": 134,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Flink.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Flink.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Flink.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,134 @@\n+/* eslint-env jest */\n+\n+import { assertNoRedbox, waitFor, check } from 'next-test-utils'\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Client Navigation with <Link/>', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  it('should navigate the page', async () => {\n+    const browser = await next.browser('/nav')\n+    const text = await browser\n+      .elementByCss('#about-link')\n+      .click()\n+      .waitForElementByCss('.nav-about')\n+      .elementByCss('p')\n+      .text()\n+\n+    expect(text).toBe('This is the about page.')\n+    await browser.close()\n+  })\n+\n+  it('should not throw error when one number type child is provided', async () => {\n+    const browser = await next.browser('/link-number-child')\n+    await assertNoRedbox(browser)\n+    if (browser) await browser.close()\n+  })\n+\n+  it('should navigate back after reload', async () => {\n+    const browser = await next.browser('/nav')\n+    await browser.elementByCss('#about-link').click()\n+    await browser.waitForElementByCss('.nav-about')\n+    await browser.refresh()\n+    await waitFor(3000)\n+    await browser.back()\n+    await waitFor(3000)\n+    const text = await browser.elementByCss('#about-link').text()\n+    if (browser) await browser.close()\n+    expect(text).toMatch(/About/)\n+  })\n+\n+  it('should navigate forwards after reload', async () => {\n+    const browser = await next.browser('/nav')\n+    await browser.elementByCss('#about-link').click()\n+    await browser.waitForElementByCss('.nav-about')\n+    await browser.back()\n+    await browser.refresh()\n+    await waitFor(3000)\n+    await browser.forward()\n+    await waitFor(3000)\n+    const text = await browser.elementByCss('p').text()\n+    if (browser) await browser.close()\n+    expect(text).toMatch(/this is the about page/i)\n+  })\n+\n+  it('should error when calling onClick without event', async () => {\n+    const browser = await next.browser('/link-invalid-onclick')\n+    expect(await browser.elementByCss('#errors').text()).toBe('0')\n+    await browser.elementByCss('#custom-button').click()\n+    expect(await browser.elementByCss('#errors').text()).toBe('1')\n+  })\n+\n+  it('should navigate via the client side', async () => {\n+    const browser = await next.browser('/nav')\n+\n+    const counterText = await browser\n+      .elementByCss('#increase')\n+      .click()\n+      .elementByCss('#about-link')\n+      .click()\n+      .waitForElementByCss('.nav-about')\n+      .elementByCss('#home-link')\n+      .click()\n+      .waitForElementByCss('.nav-home')\n+      .elementByCss('#counter')\n+      .text()\n+\n+    expect(counterText).toBe('Counter: 1')\n+    await browser.close()\n+  })\n+\n+  it('should navigate an absolute url', async () => {\n+    const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n+    await browser.waitForElementByCss('#absolute-link').click()\n+    await check(\n+      () => browser.eval(() => window.location.origin),\n+      'https://vercel.com'\n+    )\n+  })\n+\n+  it('should call mouse handlers with an absolute url', async () => {\n+    const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n+\n+    await browser.elementByCss('#absolute-link-mouse-events').moveTo()\n+\n+    expect(\n+      await browser\n+        .waitForElementByCss('#absolute-link-mouse-events')\n+        .getAttribute('data-hover')\n+    ).toBe('true')\n+  })\n+\n+  it('should navigate an absolute local url', async () => {\n+    const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n+    // @ts-expect-error _didNotNavigate is set intentionally\n+    await browser.eval(() => (window._didNotNavigate = true))\n+    await browser.waitForElementByCss('#absolute-local-link').click()\n+    const text = await browser\n+      .waitForElementByCss('.nav-about')\n+      .elementByCss('p')\n+      .text()\n+\n+    expect(text).toBe('This is the about page.')\n+    // @ts-expect-error _didNotNavigate is set intentionally\n+    expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n+  })\n+\n+  it('should navigate an absolute local url with as', async () => {\n+    const browser = await next.browser(`/absolute-url?port=${next.appPort}`)\n+    // @ts-expect-error _didNotNavigate is set intentionally\n+    await browser.eval(() => (window._didNotNavigate = true))\n+    await browser.waitForElementByCss('#absolute-local-dynamic-link').click()\n+    expect(await browser.waitForElementByCss('#dynamic-page').text()).toBe(\n+      'hello'\n+    )\n+    // @ts-expect-error _didNotNavigate is set intentionally\n+    expect(await browser.eval(() => window._didNotNavigate)).toBe(true)\n+  })\n+})"
        },
        {
            "sha": "5142576e2f503cfae00b1b7270b6e10ff370fedd",
            "filename": "test/development/pages-dir/client-navigation/on-click.test.ts",
            "status": "added",
            "additions": 98,
            "deletions": 0,
            "changes": 98,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fon-click.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fon-click.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fon-click.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,98 @@\n+/* eslint-env jest */\n+\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+import { retry } from 'next-test-utils'\n+\n+describe('Client navigation with onClick action', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  it('should reload the page and perform additional action', async () => {\n+    const browser = await next.browser('/nav/on-click')\n+    const defaultCountQuery = await browser.elementByCss('#query-count').text()\n+    const defaultCountState = await browser.elementByCss('#state-count').text()\n+    expect(defaultCountQuery).toBe('QUERY COUNT: 0')\n+    expect(defaultCountState).toBe('STATE COUNT: 0')\n+\n+    await browser.elementByCss('#on-click-link').click()\n+\n+    await retry(async () => {\n+      const countQueryAfterClicked = await browser\n+        .elementByCss('#query-count')\n+        .text()\n+      const countStateAfterClicked = await browser\n+        .elementByCss('#state-count')\n+        .text()\n+      expect(countQueryAfterClicked).toBe('QUERY COUNT: 1')\n+      expect(countStateAfterClicked).toBe('STATE COUNT: 1')\n+    })\n+  })\n+\n+  it('should not reload if default was prevented', async () => {\n+    const browser = await next.browser('/nav/on-click')\n+    const defaultCountQuery = await browser.elementByCss('#query-count').text()\n+    const defaultCountState = await browser.elementByCss('#state-count').text()\n+    expect(defaultCountQuery).toBe('QUERY COUNT: 0')\n+    expect(defaultCountState).toBe('STATE COUNT: 0')\n+\n+    await browser.elementByCss('#on-click-link-prevent-default').click()\n+\n+    await retry(async () => {\n+      const countQueryAfterClicked = await browser\n+        .elementByCss('#query-count')\n+        .text()\n+      const countStateAfterClicked = await browser\n+        .elementByCss('#state-count')\n+        .text()\n+      expect(countQueryAfterClicked).toBe('QUERY COUNT: 0')\n+      expect(countStateAfterClicked).toBe('STATE COUNT: 1')\n+    })\n+\n+    await browser.elementByCss('#on-click-link').click()\n+\n+    await retry(async () => {\n+      const countQueryAfterClickedAgain = await browser\n+        .elementByCss('#query-count')\n+        .text()\n+      const countStateAfterClickedAgain = await browser\n+        .elementByCss('#state-count')\n+        .text()\n+      expect(countQueryAfterClickedAgain).toBe('QUERY COUNT: 1')\n+      expect(countStateAfterClickedAgain).toBe('STATE COUNT: 2')\n+    })\n+  })\n+\n+  it('should always replace the state and perform additional action', async () => {\n+    const browser = await next.browser('/nav')\n+\n+    await browser.elementByCss('#on-click-link').click()\n+\n+    await retry(async () => {\n+      const defaultCountQuery = await browser\n+        .elementByCss('#query-count')\n+        .text()\n+      expect(defaultCountQuery).toBe('QUERY COUNT: 1')\n+    })\n+\n+    await browser.elementByCss('#on-click-link').click()\n+\n+    await retry(async () => {\n+      const countQueryAfterClicked = await browser\n+        .elementByCss('#query-count')\n+        .text()\n+      const countStateAfterClicked = await browser\n+        .elementByCss('#state-count')\n+        .text()\n+      expect(countQueryAfterClicked).toBe('QUERY COUNT: 2')\n+      expect(countStateAfterClicked).toBe('STATE COUNT: 1')\n+    })\n+\n+    // Since we replace the state, back button would simply go us back to /nav\n+    await browser.back().waitForElementByCss('.nav-home')\n+  })\n+})"
        },
        {
            "sha": "a3fec273ae057f4519eab1be405ea5edea2ff61f",
            "filename": "test/development/pages-dir/client-navigation/querystring.test.ts",
            "status": "added",
            "additions": 77,
            "deletions": 0,
            "changes": 77,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fquerystring.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fquerystring.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fquerystring.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,77 @@\n+/* eslint-env jest */\n+\n+import { check } from 'next-test-utils'\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Client navigation querystring', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  describe('with the same page but different querystring', () => {\n+    it('should navigate the page', async () => {\n+      const browser = await next.browser('/nav/querystring?id=1')\n+      const text = await browser\n+        .elementByCss('#next-id-link')\n+        .click()\n+        .waitForElementByCss('.nav-id-2')\n+        .elementByCss('p')\n+        .text()\n+\n+      expect(text).toBe('2')\n+      await browser.close()\n+    })\n+\n+    it('should remove querystring', async () => {\n+      const browser = await next.browser('/nav/querystring?id=1')\n+      const text = await browser\n+        .elementByCss('#main-page')\n+        .click()\n+        .waitForElementByCss('.nav-id-0')\n+        .elementByCss('p')\n+        .text()\n+\n+      expect(text).toBe('0')\n+      await browser.close()\n+    })\n+  })\n+\n+  describe('with querystring relative urls', () => {\n+    it('should work with Link', async () => {\n+      const browser = await next.browser('/nav/query-only')\n+      await browser.elementByCss('#link').click()\n+\n+      await check(() => browser.waitForElementByCss('#prop').text(), 'foo')\n+    })\n+\n+    it('should work with router.push', async () => {\n+      const browser = await next.browser('/nav/query-only')\n+      await browser.elementByCss('#router-push').click()\n+\n+      await check(() => browser.waitForElementByCss('#prop').text(), 'bar')\n+    })\n+\n+    it('should work with router.replace', async () => {\n+      const browser = await next.browser('/nav/query-only')\n+      await browser.elementByCss('#router-replace').click()\n+\n+      await check(() => browser.waitForElementByCss('#prop').text(), 'baz')\n+    })\n+\n+    it('router.replace with shallow=true shall not throw route cancelled errors', async () => {\n+      const browser = await next.browser('/nav/query-only-shallow')\n+      await browser.elementByCss('#router-replace').click()\n+      // the error occurs on every replace() after the first one\n+      await browser.elementByCss('#router-replace').click()\n+\n+      await check(\n+        () => browser.waitForElementByCss('#routeState').text(),\n+        '{\"completed\":2,\"errors\":0}'\n+      )\n+    })\n+  })\n+})"
        },
        {
            "sha": "769b1d7ea258d405bf003f21b818ab28ed34a194",
            "filename": "test/development/pages-dir/client-navigation/rendering-head.test.ts",
            "status": "added",
            "additions": 309,
            "deletions": 0,
            "changes": 309,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Frendering-head.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Frendering-head.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Frendering-head.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,309 @@\n+/* eslint-env jest */\n+\n+import cheerio from 'cheerio'\n+import { nextTestSetup } from 'e2e-utils'\n+import { renderViaHTTP } from 'next-test-utils'\n+import path from 'path'\n+\n+const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n+\n+describe('Client Navigation rendering <Head />', () => {\n+  describe.each([[false], [true]])(\n+    'with strictNextHead=%s',\n+    (strictNextHead) => {\n+      const { next } = nextTestSetup({\n+        files: path.join(__dirname, 'fixture'),\n+        env: {\n+          TEST_STRICT_NEXT_HEAD: String(strictNextHead),\n+        },\n+      })\n+\n+      function render(\n+        pathname: Parameters<typeof renderViaHTTP>[1],\n+        query?: Parameters<typeof renderViaHTTP>[2]\n+      ) {\n+        return renderViaHTTP(next.appPort, pathname, query)\n+      }\n+\n+      it('should handle undefined prop in head server-side', async () => {\n+        const html = await render('/head')\n+        const $ = cheerio.load(html)\n+        const value = 'content' in $('meta[name=\"empty-content\"]').attr()\n+\n+        expect(value).toBe(false)\n+      })\n+\n+      // default-head contains an empty <Head />.\n+      test('header renders default charset', async () => {\n+        const html = await render('/default-head')\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta charSet=\"utf-8\" data-next-head=\"\"/>'\n+            : '<meta charSet=\"utf-8\"/>'\n+        )\n+        expect(html).toContain('next-head, but only once.')\n+      })\n+\n+      test('header renders default viewport', async () => {\n+        const html = await render('/default-head')\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta name=\"viewport\" content=\"width=device-width\" data-next-head=\"\"/>'\n+            : '<meta name=\"viewport\" content=\"width=device-width\"/>'\n+        )\n+      })\n+\n+      test('header helper renders header information', async () => {\n+        const html = await render('/head')\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta charSet=\"iso-8859-5\" data-next-head=\"\"/>'\n+            : '<meta charSet=\"iso-8859-5\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta content=\"my meta\" data-next-head=\"\"/>'\n+            : '<meta content=\"my meta\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" data-next-head=\"\"/>'\n+            : '<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/>'\n+        )\n+        expect(html).toContain('I can have meta tags')\n+      })\n+\n+      test('header helper dedupes tags', async () => {\n+        const html = await render('/head')\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta charSet=\"iso-8859-5\" data-next-head=\"\"/>'\n+            : '<meta charSet=\"iso-8859-5\"/>'\n+        )\n+        expect(html).not.toContain(\n+          strictNextHead\n+            ? '<meta charSet=\"utf-8\" data-next-head=\"\"/>'\n+            : '<meta charSet=\"utf-8\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" data-next-head=\"\"/>'\n+            : '<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/>'\n+        )\n+        // Should contain only one viewport\n+        expect(html.match(/<meta name=\"viewport\" /g).length).toBe(1)\n+        expect(html).not.toContain(\n+          '<meta name=\"viewport\" content=\"width=device-width\"'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta content=\"my meta\" data-next-head=\"\"/>'\n+            : '<meta content=\"my meta\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<link rel=\"stylesheet\" href=\"/dup-style.css\" data-next-head=\"\"/><link rel=\"stylesheet\" href=\"/dup-style.css\" data-next-head=\"\"/>'\n+            : '<link rel=\"stylesheet\" href=\"/dup-style.css\"/><link rel=\"stylesheet\" href=\"/dup-style.css\"/>'\n+        )\n+        const dedupeLink = strictNextHead\n+          ? '<link rel=\"stylesheet\" href=\"dedupe-style.css\" data-next-head=\"\"/>'\n+          : '<link rel=\"stylesheet\" href=\"dedupe-style.css\"/>'\n+        expect(html).toContain(dedupeLink)\n+        expect(\n+          html.substring(html.indexOf(dedupeLink) + dedupeLink.length)\n+        ).not.toContain('<link rel=\"stylesheet\" href=\"dedupe-style.css\"')\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<link rel=\"alternate\" hrefLang=\"en\" href=\"/last/en\" data-next-head=\"\"/>'\n+            : '<link rel=\"alternate\" hrefLang=\"en\" href=\"/last/en\"/>'\n+        )\n+        expect(html).not.toContain(\n+          '<link rel=\"alternate\" hrefLang=\"en\" href=\"/first/en\"'\n+        )\n+      })\n+\n+      test('header helper dedupes tags with the same key as the default', async () => {\n+        const html = await render('/head-duplicate-default-keys')\n+        // Expect exactly one `charSet`\n+        expect((html.match(/charSet=/g) || []).length).toBe(1)\n+        // Expect exactly one `viewport`\n+        expect((html.match(/name=\"viewport\"/g) || []).length).toBe(1)\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta charSet=\"iso-8859-1\" data-next-head=\"\"/>'\n+            : '<meta charSet=\"iso-8859-1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta name=\"viewport\" content=\"width=500\" data-next-head=\"\"/>'\n+            : '<meta name=\"viewport\" content=\"width=500\"/>'\n+        )\n+      })\n+\n+      test('header helper avoids dedupe of specific tags', async () => {\n+        const html = await render('/head')\n+        console.log(html)\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"article:tag\" content=\"tag1\" data-next-head=\"\"/>'\n+            : '<meta property=\"article:tag\" content=\"tag1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"article:tag\" content=\"tag2\" data-next-head=\"\"/>'\n+            : '<meta property=\"article:tag\" content=\"tag2\"/>'\n+        )\n+        expect(html).not.toContain('<meta property=\"dedupe:tag\" content=\"tag3\"')\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"dedupe:tag\" content=\"tag4\" data-next-head=\"\"/>'\n+            : '<meta property=\"dedupe:tag\" content=\"tag4\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image\" content=\"ogImageTag1\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image\" content=\"ogImageTag1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image\" content=\"ogImageTag2\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image\" content=\"ogImageTag2\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:alt\" content=\"ogImageAltTag1\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:alt\" content=\"ogImageAltTag1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:alt\" content=\"ogImageAltTag2\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:alt\" content=\"ogImageAltTag2\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:width\" content=\"ogImageWidthTag1\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:width\" content=\"ogImageWidthTag1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:width\" content=\"ogImageWidthTag2\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:width\" content=\"ogImageWidthTag2\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:height\" content=\"ogImageHeightTag1\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:height\" content=\"ogImageHeightTag1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:height\" content=\"ogImageHeightTag2\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:height\" content=\"ogImageHeightTag2\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:type\" content=\"ogImageTypeTag1\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:type\" content=\"ogImageTypeTag1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:type\" content=\"ogImageTypeTag2\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:type\" content=\"ogImageTypeTag2\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:secure_url\" content=\"ogImageSecureUrlTag1\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:secure_url\" content=\"ogImageSecureUrlTag1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:secure_url\" content=\"ogImageSecureUrlTag2\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:secure_url\" content=\"ogImageSecureUrlTag2\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:url\" content=\"ogImageUrlTag1\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:url\" content=\"ogImageUrlTag1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"og:image:url\" content=\"ogImageUrlTag2\" data-next-head=\"\"/>'\n+            : '<meta property=\"og:image:url\" content=\"ogImageUrlTag2\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"fb:pages\" content=\"fbpages1\" data-next-head=\"\"/>'\n+            : '<meta property=\"fb:pages\" content=\"fbpages1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta property=\"fb:pages\" content=\"fbpages2\" data-next-head=\"\"/>'\n+            : '<meta property=\"fb:pages\" content=\"fbpages2\"/>'\n+        )\n+      })\n+\n+      test('header helper avoids dedupe of meta tags with the same name if they use unique keys', async () => {\n+        const html = await render('/head')\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta name=\"citation_author\" content=\"authorName1\" data-next-head=\"\"/>'\n+            : '<meta name=\"citation_author\" content=\"authorName1\"/>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta name=\"citation_author\" content=\"authorName2\" data-next-head=\"\"/>'\n+            : '<meta name=\"citation_author\" content=\"authorName2\"/>'\n+        )\n+      })\n+\n+      test('header helper renders Fragment children', async () => {\n+        const html = await render('/head')\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<title data-next-head=\"\">Fragment title</title>'\n+            : '<title>Fragment title</title>'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<meta content=\"meta fragment\" data-next-head=\"\"/>'\n+            : '<meta content=\"meta fragment\"/>'\n+        )\n+      })\n+\n+      test('header helper renders boolean attributes correctly children', async () => {\n+        const html = await render('/head')\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<script src=\"/test-async-false.js\" data-next-head=\"\">'\n+            : '<script src=\"/test-async-false.js\">'\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<script src=\"/test-async-true.js\" async=\"\" data-next-head=\"\">'\n+            : ''\n+        )\n+        expect(html).toContain(\n+          strictNextHead\n+            ? '<script src=\"/test-defer.js\" defer=\"\" data-next-head=\"\">'\n+            : ''\n+        )\n+      })\n+\n+      it('should place charset element at the top of <head>', async () => {\n+        const html = await render('/head-priority')\n+        const nextHeadElement = strictNextHead\n+          ? '<meta charSet=\"iso-8859-5\" data-next-head=\"\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" data-next-head=\"\"/><meta name=\"title\" content=\"head title\" data-next-head=\"\"/>'\n+          : '<meta charSet=\"iso-8859-5\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/><meta name=\"title\" content=\"head title\"/><meta name=\"next-head-count\" content=\"3\"/>'\n+        const documentHeadElement =\n+          '<meta name=\"keywords\" content=\"document head test\"/>'\n+\n+        expect(html).toContain(\n+          isReact18\n+            ? // charset is not actually at the top.\n+              // data-next-hide-fouc comes first\n+              `</style></noscript>${nextHeadElement}${documentHeadElement}`\n+            : `<head>${nextHeadElement}${documentHeadElement}`\n+        )\n+      })\n+    }\n+  )\n+})"
        },
        {
            "sha": "e3ccbb7816e2a80140bc95badef0c3e613effac3",
            "filename": "test/development/pages-dir/client-navigation/rendering.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 299,
            "changes": 299,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Frendering.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Frendering.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Frendering.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -423,302 +423,3 @@ describe('Client Navigation rendering', () => {\n     })\n   })\n })\n-\n-describe.each([[false], [true]])(\n-  'Client Navigation rendering <Head /> with strictNextHead=%s',\n-  (strictNextHead) => {\n-    const { next } = nextTestSetup({\n-      files: path.join(__dirname, 'fixture'),\n-      env: {\n-        TEST_STRICT_NEXT_HEAD: String(strictNextHead),\n-      },\n-    })\n-\n-    function render(\n-      pathname: Parameters<typeof renderViaHTTP>[1],\n-      query?: Parameters<typeof renderViaHTTP>[2]\n-    ) {\n-      return renderViaHTTP(next.appPort, pathname, query)\n-    }\n-\n-    it('should handle undefined prop in head server-side', async () => {\n-      const html = await render('/head')\n-      const $ = cheerio.load(html)\n-      const value = 'content' in $('meta[name=\"empty-content\"]').attr()\n-\n-      expect(value).toBe(false)\n-    })\n-\n-    // default-head contains an empty <Head />.\n-    test('header renders default charset', async () => {\n-      const html = await render('/default-head')\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta charSet=\"utf-8\" data-next-head=\"\"/>'\n-          : '<meta charSet=\"utf-8\"/>'\n-      )\n-      expect(html).toContain('next-head, but only once.')\n-    })\n-\n-    test('header renders default viewport', async () => {\n-      const html = await render('/default-head')\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta name=\"viewport\" content=\"width=device-width\" data-next-head=\"\"/>'\n-          : '<meta name=\"viewport\" content=\"width=device-width\"/>'\n-      )\n-    })\n-\n-    test('header helper renders header information', async () => {\n-      const html = await render('/head')\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta charSet=\"iso-8859-5\" data-next-head=\"\"/>'\n-          : '<meta charSet=\"iso-8859-5\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta content=\"my meta\" data-next-head=\"\"/>'\n-          : '<meta content=\"my meta\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" data-next-head=\"\"/>'\n-          : '<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/>'\n-      )\n-      expect(html).toContain('I can have meta tags')\n-    })\n-\n-    test('header helper dedupes tags', async () => {\n-      const html = await render('/head')\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta charSet=\"iso-8859-5\" data-next-head=\"\"/>'\n-          : '<meta charSet=\"iso-8859-5\"/>'\n-      )\n-      expect(html).not.toContain(\n-        strictNextHead\n-          ? '<meta charSet=\"utf-8\" data-next-head=\"\"/>'\n-          : '<meta charSet=\"utf-8\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" data-next-head=\"\"/>'\n-          : '<meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/>'\n-      )\n-      // Should contain only one viewport\n-      expect(html.match(/<meta name=\"viewport\" /g).length).toBe(1)\n-      expect(html).not.toContain(\n-        '<meta name=\"viewport\" content=\"width=device-width\"'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta content=\"my meta\" data-next-head=\"\"/>'\n-          : '<meta content=\"my meta\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<link rel=\"stylesheet\" href=\"/dup-style.css\" data-next-head=\"\"/><link rel=\"stylesheet\" href=\"/dup-style.css\" data-next-head=\"\"/>'\n-          : '<link rel=\"stylesheet\" href=\"/dup-style.css\"/><link rel=\"stylesheet\" href=\"/dup-style.css\"/>'\n-      )\n-      const dedupeLink = strictNextHead\n-        ? '<link rel=\"stylesheet\" href=\"dedupe-style.css\" data-next-head=\"\"/>'\n-        : '<link rel=\"stylesheet\" href=\"dedupe-style.css\"/>'\n-      expect(html).toContain(dedupeLink)\n-      expect(\n-        html.substring(html.indexOf(dedupeLink) + dedupeLink.length)\n-      ).not.toContain('<link rel=\"stylesheet\" href=\"dedupe-style.css\"')\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<link rel=\"alternate\" hrefLang=\"en\" href=\"/last/en\" data-next-head=\"\"/>'\n-          : '<link rel=\"alternate\" hrefLang=\"en\" href=\"/last/en\"/>'\n-      )\n-      expect(html).not.toContain(\n-        '<link rel=\"alternate\" hrefLang=\"en\" href=\"/first/en\"'\n-      )\n-    })\n-\n-    test('header helper dedupes tags with the same key as the default', async () => {\n-      const html = await render('/head-duplicate-default-keys')\n-      // Expect exactly one `charSet`\n-      expect((html.match(/charSet=/g) || []).length).toBe(1)\n-      // Expect exactly one `viewport`\n-      expect((html.match(/name=\"viewport\"/g) || []).length).toBe(1)\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta charSet=\"iso-8859-1\" data-next-head=\"\"/>'\n-          : '<meta charSet=\"iso-8859-1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta name=\"viewport\" content=\"width=500\" data-next-head=\"\"/>'\n-          : '<meta name=\"viewport\" content=\"width=500\"/>'\n-      )\n-    })\n-\n-    test('header helper avoids dedupe of specific tags', async () => {\n-      const html = await render('/head')\n-      console.log(html)\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"article:tag\" content=\"tag1\" data-next-head=\"\"/>'\n-          : '<meta property=\"article:tag\" content=\"tag1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"article:tag\" content=\"tag2\" data-next-head=\"\"/>'\n-          : '<meta property=\"article:tag\" content=\"tag2\"/>'\n-      )\n-      expect(html).not.toContain('<meta property=\"dedupe:tag\" content=\"tag3\"')\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"dedupe:tag\" content=\"tag4\" data-next-head=\"\"/>'\n-          : '<meta property=\"dedupe:tag\" content=\"tag4\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image\" content=\"ogImageTag1\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image\" content=\"ogImageTag1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image\" content=\"ogImageTag2\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image\" content=\"ogImageTag2\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:alt\" content=\"ogImageAltTag1\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:alt\" content=\"ogImageAltTag1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:alt\" content=\"ogImageAltTag2\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:alt\" content=\"ogImageAltTag2\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:width\" content=\"ogImageWidthTag1\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:width\" content=\"ogImageWidthTag1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:width\" content=\"ogImageWidthTag2\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:width\" content=\"ogImageWidthTag2\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:height\" content=\"ogImageHeightTag1\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:height\" content=\"ogImageHeightTag1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:height\" content=\"ogImageHeightTag2\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:height\" content=\"ogImageHeightTag2\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:type\" content=\"ogImageTypeTag1\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:type\" content=\"ogImageTypeTag1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:type\" content=\"ogImageTypeTag2\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:type\" content=\"ogImageTypeTag2\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:secure_url\" content=\"ogImageSecureUrlTag1\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:secure_url\" content=\"ogImageSecureUrlTag1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:secure_url\" content=\"ogImageSecureUrlTag2\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:secure_url\" content=\"ogImageSecureUrlTag2\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:url\" content=\"ogImageUrlTag1\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:url\" content=\"ogImageUrlTag1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"og:image:url\" content=\"ogImageUrlTag2\" data-next-head=\"\"/>'\n-          : '<meta property=\"og:image:url\" content=\"ogImageUrlTag2\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"fb:pages\" content=\"fbpages1\" data-next-head=\"\"/>'\n-          : '<meta property=\"fb:pages\" content=\"fbpages1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta property=\"fb:pages\" content=\"fbpages2\" data-next-head=\"\"/>'\n-          : '<meta property=\"fb:pages\" content=\"fbpages2\"/>'\n-      )\n-    })\n-\n-    test('header helper avoids dedupe of meta tags with the same name if they use unique keys', async () => {\n-      const html = await render('/head')\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta name=\"citation_author\" content=\"authorName1\" data-next-head=\"\"/>'\n-          : '<meta name=\"citation_author\" content=\"authorName1\"/>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta name=\"citation_author\" content=\"authorName2\" data-next-head=\"\"/>'\n-          : '<meta name=\"citation_author\" content=\"authorName2\"/>'\n-      )\n-    })\n-\n-    test('header helper renders Fragment children', async () => {\n-      const html = await render('/head')\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<title data-next-head=\"\">Fragment title</title>'\n-          : '<title>Fragment title</title>'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<meta content=\"meta fragment\" data-next-head=\"\"/>'\n-          : '<meta content=\"meta fragment\"/>'\n-      )\n-    })\n-\n-    test('header helper renders boolean attributes correctly children', async () => {\n-      const html = await render('/head')\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<script src=\"/test-async-false.js\" data-next-head=\"\">'\n-          : '<script src=\"/test-async-false.js\">'\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<script src=\"/test-async-true.js\" async=\"\" data-next-head=\"\">'\n-          : ''\n-      )\n-      expect(html).toContain(\n-        strictNextHead\n-          ? '<script src=\"/test-defer.js\" defer=\"\" data-next-head=\"\">'\n-          : ''\n-      )\n-    })\n-\n-    it('should place charset element at the top of <head>', async () => {\n-      const html = await render('/head-priority')\n-      const nextHeadElement = strictNextHead\n-        ? '<meta charSet=\"iso-8859-5\" data-next-head=\"\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\" data-next-head=\"\"/><meta name=\"title\" content=\"head title\" data-next-head=\"\"/>'\n-        : '<meta charSet=\"iso-8859-5\"/><meta name=\"viewport\" content=\"width=device-width,initial-scale=1\"/><meta name=\"title\" content=\"head title\"/><meta name=\"next-head-count\" content=\"3\"/>'\n-      const documentHeadElement =\n-        '<meta name=\"keywords\" content=\"document head test\"/>'\n-\n-      expect(html).toContain(\n-        isReact18\n-          ? // charset is not actually at the top.\n-            // data-next-hide-fouc comes first\n-            `</style></noscript>${nextHeadElement}${documentHeadElement}`\n-          : `<head>${nextHeadElement}${documentHeadElement}`\n-      )\n-    })\n-  }\n-)"
        },
        {
            "sha": "cccd7e3e6e71cf92fdfcc13b4f73f41e33b4a072",
            "filename": "test/development/pages-dir/client-navigation/scroll.test.ts",
            "status": "added",
            "additions": 105,
            "deletions": 0,
            "changes": 105,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fscroll.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fscroll.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fscroll.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,105 @@\n+/* eslint-env jest */\n+\n+import { check } from 'next-test-utils'\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Client navigation scroll', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  describe('resets scroll at the correct time', () => {\n+    it('should reset scroll before the new page runs its lifecycles (<Link />)', async () => {\n+      const browser = await next.browser('/nav/long-page-to-snap-scroll')\n+\n+      // Scrolls to item 400 on the page\n+      await browser\n+        .waitForElementByCss('#long-page-to-snap-scroll')\n+        .elementByCss('#scroll-to-item-400')\n+        .click()\n+\n+      const scrollPosition = await browser.eval('window.pageYOffset')\n+      expect(scrollPosition).toBe(7208)\n+\n+      // Go to snap scroll page\n+      await browser\n+        .elementByCss('#goto-snap-scroll-position')\n+        .click()\n+        .waitForElementByCss('#scroll-pos-y')\n+\n+      const snappedScrollPosition = await browser.eval(\n+        'document.getElementById(\"scroll-pos-y\").innerText'\n+      )\n+      expect(snappedScrollPosition).toBe('0')\n+    })\n+\n+    it('should reset scroll before the new page runs its lifecycles (Router#push)', async () => {\n+      const browser = await next.browser('/nav/long-page-to-snap-scroll')\n+\n+      // Scrolls to item 400 on the page\n+      await browser\n+        .waitForElementByCss('#long-page-to-snap-scroll')\n+        .elementByCss('#scroll-to-item-400')\n+        .click()\n+\n+      const scrollPosition = await browser.eval('window.pageYOffset')\n+      expect(scrollPosition).toBe(7208)\n+\n+      // Go to snap scroll page\n+      await browser\n+        .elementByCss('#goto-snap-scroll-position-imperative')\n+        .click()\n+        .waitForElementByCss('#scroll-pos-y')\n+\n+      const snappedScrollPosition = await browser.eval(\n+        'document.getElementById(\"scroll-pos-y\").innerText'\n+      )\n+      expect(snappedScrollPosition).toBe('0')\n+    })\n+\n+    it('should intentionally not reset scroll before the new page runs its lifecycles (Router#push)', async () => {\n+      const browser = await next.browser('/nav/long-page-to-snap-scroll')\n+\n+      // Scrolls to item 400 on the page\n+      await browser\n+        .waitForElementByCss('#long-page-to-snap-scroll')\n+        .elementByCss('#scroll-to-item-400')\n+        .click()\n+\n+      const scrollPosition = await browser.eval('window.pageYOffset')\n+      expect(scrollPosition).toBe(7208)\n+\n+      // Go to snap scroll page\n+      await browser\n+        .elementByCss('#goto-snap-scroll-position-imperative-noscroll')\n+        .click()\n+        .waitForElementByCss('#scroll-pos-y')\n+\n+      const snappedScrollPosition = await browser.eval(\n+        'document.getElementById(\"scroll-pos-y\").innerText'\n+      )\n+      expect(snappedScrollPosition).not.toBe('0')\n+      expect(Number(snappedScrollPosition)).toBeGreaterThanOrEqual(7208)\n+    })\n+  })\n+\n+  it('should scroll to top when the scroll option is set to true', async () => {\n+    const browser = await next.browser('/nav/shallow-routing')\n+    await browser.eval(() =>\n+      document.querySelector('#increaseWithScroll').scrollIntoView()\n+    )\n+    const scrollPosition = await browser.eval('window.pageYOffset')\n+\n+    expect(scrollPosition).toBeGreaterThan(3000)\n+\n+    await browser.elementByCss('#increaseWithScroll').click()\n+    await check(async () => {\n+      const newScrollPosition = await browser.eval('window.pageYOffset')\n+      return newScrollPosition === 0 ? 'success' : 'fail'\n+    }, 'success')\n+  })\n+})"
        },
        {
            "sha": "9eb91595d75f22b78771a5bf95324db5c8fc7fd5",
            "filename": "test/development/pages-dir/client-navigation/shallow-routing.test.ts",
            "status": "added",
            "additions": 115,
            "deletions": 0,
            "changes": 115,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fshallow-routing.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fshallow-routing.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Fshallow-routing.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,115 @@\n+/* eslint-env jest */\n+\n+import { waitFor } from 'next-test-utils'\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Client navigation with shallow routing', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  it('should update the url without running getInitialProps', async () => {\n+    const browser = await next.browser('/nav/shallow-routing')\n+    const counter = await browser\n+      .elementByCss('#increase')\n+      .click()\n+      .elementByCss('#increase')\n+      .click()\n+      .elementByCss('#counter')\n+      .text()\n+    expect(counter).toBe('Counter: 2')\n+\n+    const getInitialPropsRunCount = await browser\n+      .elementByCss('#get-initial-props-run-count')\n+      .text()\n+    expect(getInitialPropsRunCount).toBe('getInitialProps run count: 1')\n+\n+    await browser.close()\n+  })\n+\n+  it('should handle the back button and should not run getInitialProps', async () => {\n+    const browser = await next.browser('/nav/shallow-routing')\n+    let counter = await browser\n+      .elementByCss('#increase')\n+      .click()\n+      .elementByCss('#increase')\n+      .click()\n+      .elementByCss('#counter')\n+      .text()\n+    expect(counter).toBe('Counter: 2')\n+\n+    counter = await browser.back().elementByCss('#counter').text()\n+    expect(counter).toBe('Counter: 1')\n+\n+    const getInitialPropsRunCount = await browser\n+      .elementByCss('#get-initial-props-run-count')\n+      .text()\n+    expect(getInitialPropsRunCount).toBe('getInitialProps run count: 1')\n+\n+    await browser.close()\n+  })\n+\n+  it('should run getInitialProps always when rending the page to the screen', async () => {\n+    const browser = await next.browser('/nav/shallow-routing')\n+\n+    const counter = await browser\n+      .elementByCss('#increase')\n+      .click()\n+      .elementByCss('#increase')\n+      .click()\n+      .elementByCss('#home-link')\n+      .click()\n+      .waitForElementByCss('.nav-home')\n+      .back()\n+      .waitForElementByCss('.shallow-routing')\n+      .elementByCss('#counter')\n+      .text()\n+    expect(counter).toBe('Counter: 2')\n+\n+    const getInitialPropsRunCount = await browser\n+      .elementByCss('#get-initial-props-run-count')\n+      .text()\n+    expect(getInitialPropsRunCount).toBe('getInitialProps run count: 2')\n+\n+    await browser.close()\n+  })\n+\n+  it('should keep the scroll position on shallow routing', async () => {\n+    const browser = await next.browser('/nav/shallow-routing')\n+    await browser.eval(() =>\n+      document.querySelector('#increase').scrollIntoView()\n+    )\n+    const scrollPosition = await browser.eval('window.pageYOffset')\n+\n+    expect(scrollPosition).toBeGreaterThan(3000)\n+\n+    await browser.elementByCss('#increase').click()\n+    await waitFor(500)\n+    const newScrollPosition = await browser.eval('window.pageYOffset')\n+\n+    expect(newScrollPosition).toBe(scrollPosition)\n+\n+    await browser.elementByCss('#increase2').click()\n+    await waitFor(500)\n+    const newScrollPosition2 = await browser.eval('window.pageYOffset')\n+\n+    expect(newScrollPosition2).toBe(0)\n+\n+    await browser.eval(() =>\n+      document.querySelector('#invalidShallow').scrollIntoView()\n+    )\n+    const scrollPositionDown = await browser.eval('window.pageYOffset')\n+\n+    expect(scrollPositionDown).toBeGreaterThan(3000)\n+\n+    await browser.elementByCss('#invalidShallow').click()\n+    await waitFor(500)\n+    const newScrollPosition3 = await browser.eval('window.pageYOffset')\n+\n+    expect(newScrollPosition3).toBe(0)\n+  })\n+})"
        },
        {
            "sha": "c821aa555ff1f27ede0f311d7548f948a2d29363",
            "filename": "test/development/pages-dir/client-navigation/url-hash.test.ts",
            "status": "added",
            "additions": 265,
            "deletions": 0,
            "changes": 265,
            "blob_url": "https://github.com/vercel/next.js/blob/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Furl-hash.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/837e0864796ba37bf4c6cd3777d5837cd311880c/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Furl-hash.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Furl-hash.test.ts?ref=837e0864796ba37bf4c6cd3777d5837cd311880c",
            "patch": "@@ -0,0 +1,265 @@\n+/* eslint-env jest */\n+\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Client navigation with URL hash', () => {\n+  const { next } = nextTestSetup({\n+    files: path.join(__dirname, 'fixture'),\n+    env: {\n+      TEST_STRICT_NEXT_HEAD: String(true),\n+    },\n+  })\n+\n+  describe('when hash changes', () => {\n+    describe('check hydration mis-match', () => {\n+      it('should not have hydration mis-match for hash link', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+        const browserLogs = await browser.log()\n+        let found = false\n+        browserLogs.forEach((log) => {\n+          console.log('log.message', log.message)\n+          if (log.message.includes('Warning: Prop')) {\n+            found = true\n+          }\n+        })\n+        expect(found).toEqual(false)\n+      })\n+    })\n+\n+    describe('when hash change via Link', () => {\n+      it('should not run getInitialProps', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+\n+        const counter = await browser\n+          .elementByCss('#via-link')\n+          .click()\n+          .elementByCss('p')\n+          .text()\n+\n+        expect(counter).toBe('COUNT: 0')\n+\n+        await browser.close()\n+      })\n+\n+      it('should scroll to the specified position on the same page', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+\n+        // Scrolls to item 400 on the page\n+        await browser.elementByCss('#scroll-to-item-400').click()\n+\n+        const scrollPositionBeforeEmptyHash =\n+          await browser.eval('window.pageYOffset')\n+\n+        expect(scrollPositionBeforeEmptyHash).toBe(7258)\n+\n+        // Scrolls back to top when scrolling to `#` with no value.\n+        await browser.elementByCss('#via-empty-hash').click()\n+\n+        const scrollPositionAfterEmptyHash =\n+          await browser.eval('window.pageYOffset')\n+\n+        expect(scrollPositionAfterEmptyHash).toBe(0)\n+\n+        // Scrolls to item 400 on the page\n+        await browser.elementByCss('#scroll-to-item-400').click()\n+\n+        const scrollPositionBeforeTopHash =\n+          await browser.eval('window.pageYOffset')\n+\n+        expect(scrollPositionBeforeTopHash).toBe(7258)\n+\n+        // Scrolls back to top when clicking link with href `#top`.\n+        await browser.elementByCss('#via-top-hash').click()\n+\n+        const scrollPositionAfterTopHash =\n+          await browser.eval('window.pageYOffset')\n+\n+        expect(scrollPositionAfterTopHash).toBe(0)\n+\n+        // Scrolls to cjk anchor on the page\n+        await browser.elementByCss('#scroll-to-cjk-anchor').click()\n+\n+        const scrollPositionCJKHash = await browser.eval('window.pageYOffset')\n+\n+        expect(scrollPositionCJKHash).toBe(17436)\n+      })\n+\n+      it('should not scroll to hash when scroll={false} is set', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+        const curScroll = await browser.eval(\n+          'document.documentElement.scrollTop'\n+        )\n+        await browser.elementByCss('#scroll-to-name-item-400-no-scroll').click()\n+        expect(curScroll).toBe(\n+          await browser.eval('document.documentElement.scrollTop')\n+        )\n+      })\n+\n+      it('should scroll to the specified position on the same page with a name property', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+\n+        // Scrolls to item 400 with name=\"name-item-400\" on the page\n+        await browser.elementByCss('#scroll-to-name-item-400').click()\n+\n+        const scrollPosition = await browser.eval('window.pageYOffset')\n+\n+        expect(scrollPosition).toBe(16258)\n+\n+        // Scrolls back to top when scrolling to `#` with no value.\n+        await browser.elementByCss('#via-empty-hash').click()\n+\n+        const scrollPositionAfterEmptyHash =\n+          await browser.eval('window.pageYOffset')\n+\n+        expect(scrollPositionAfterEmptyHash).toBe(0)\n+      })\n+\n+      it('should scroll to the specified position to a new page', async () => {\n+        const browser = await next.browser('/nav')\n+\n+        // Scrolls to item 400 on the page\n+        await browser\n+          .elementByCss('#scroll-to-hash')\n+          .click()\n+          .waitForElementByCss('#hash-changes-page')\n+\n+        const scrollPosition = await browser.eval('window.pageYOffset')\n+        expect(scrollPosition).toBe(7258)\n+      })\n+\n+      it('should scroll to the specified CJK position to a new page', async () => {\n+        const browser = await next.browser('/nav')\n+\n+        // Scrolls to CJK anchor on the page\n+        await browser\n+          .elementByCss('#scroll-to-cjk-hash')\n+          .click()\n+          .waitForElementByCss('#hash-changes-page')\n+\n+        const scrollPosition = await browser.eval('window.pageYOffset')\n+        expect(scrollPosition).toBe(17436)\n+      })\n+\n+      it('Should update asPath', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+\n+        await browser.elementByCss('#via-link').click()\n+\n+        const asPath = await browser.elementByCss('div#asPath').text()\n+        expect(asPath).toBe('ASPATH: /nav/hash-changes#via-link')\n+      })\n+    })\n+\n+    describe('when hash change via A tag', () => {\n+      it('should not run getInitialProps', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+\n+        const counter = await browser\n+          .elementByCss('#via-a')\n+          .click()\n+          .elementByCss('p')\n+          .text()\n+\n+        expect(counter).toBe('COUNT: 0')\n+\n+        await browser.close()\n+      })\n+    })\n+\n+    describe('when hash get removed', () => {\n+      it('should not run getInitialProps', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+\n+        const counter = await browser\n+          .elementByCss('#via-a')\n+          .click()\n+          .elementByCss('#page-url')\n+          .click()\n+          .elementByCss('p')\n+          .text()\n+\n+        expect(counter).toBe('COUNT: 1')\n+\n+        await browser.close()\n+      })\n+\n+      it('should not run getInitialProps when removing via back', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+\n+        const counter = await browser\n+          .elementByCss('#scroll-to-item-400')\n+          .click()\n+          .back()\n+          .elementByCss('p')\n+          .text()\n+\n+        expect(counter).toBe('COUNT: 0')\n+        await browser.close()\n+      })\n+    })\n+\n+    describe('when hash set to empty', () => {\n+      it('should not run getInitialProps', async () => {\n+        const browser = await next.browser('/nav/hash-changes')\n+\n+        const counter = await browser\n+          .elementByCss('#via-a')\n+          .click()\n+          .elementByCss('#via-empty-hash')\n+          .click()\n+          .elementByCss('p')\n+          .text()\n+\n+        expect(counter).toBe('COUNT: 0')\n+\n+        await browser.close()\n+      })\n+    })\n+  })\n+\n+  describe('when hash changes with state', () => {\n+    describe('when passing state via hash change', () => {\n+      it('should increment the history state counter', async () => {\n+        const browser = await next.browser('/nav/hash-changes-with-state#')\n+\n+        const historyCount = await browser\n+          .elementByCss('#increment-history-count')\n+          .click()\n+          .elementByCss('#increment-history-count')\n+          .click()\n+          .elementByCss('div#history-count')\n+          .text()\n+\n+        expect(historyCount).toBe('HISTORY COUNT: 2')\n+\n+        const counter = await browser.elementByCss('p').text()\n+\n+        // getInitialProps should not be called with only hash changes\n+        expect(counter).toBe('COUNT: 0')\n+\n+        await browser.close()\n+      })\n+\n+      it('should increment the shallow history state counter', async () => {\n+        const browser = await next.browser('/nav/hash-changes-with-state#')\n+\n+        const historyCount = await browser\n+          .elementByCss('#increment-shallow-history-count')\n+          .click()\n+          .elementByCss('#increment-shallow-history-count')\n+          .click()\n+          .elementByCss('div#shallow-history-count')\n+          .text()\n+\n+        expect(historyCount).toBe('SHALLOW HISTORY COUNT: 2')\n+\n+        const counter = await browser.elementByCss('p').text()\n+\n+        expect(counter).toBe('COUNT: 0')\n+\n+        await browser.close()\n+      })\n+    })\n+  })\n+})"
        }
    ],
    "stats": {
        "total": 3283,
        "additions": 1713,
        "deletions": 1570
    }
}