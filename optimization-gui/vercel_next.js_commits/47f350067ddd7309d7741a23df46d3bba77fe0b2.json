{
    "author": "unstubbable",
    "message": "Unflake `ppr-full` tests (#76271)\n\n[flakiness metric](https://app.datadoghq.com/ci/test/runs?query=test_level%3Atest%20env%3Aci%20%40git.repository.id%3Agithub.com%2Fvercel%2Fnext.js%20%40test.service%3Anextjs%20%40test.status%3Afail%20%40test.name%3A%2Appr-full%2A%20%28-%40git.branch%3A%2A%3F%2A%20OR%20%40git.branch%3Acanary%29&agg_m=count&agg_m_source=base&agg_t=count&citest_explorer_sort=timestamp%2Casc&cols=%40test.status%2Ctimestamp%2C%40test.suite%3A83%2C%40test.name%3A607%2C%40git.branch&currentTab=overview&eventStack=&fromUser=false&graphType=flamegraph&index=citest&start=1737457116609&end=1740049116609&paused=false)\r\n\r\nThis attempts to fix the flakiness of two things in the `ppr-full` test suite (there might be more):\r\n\r\n- Omit tests that rely on a route shell being cached from deploy tests, similar to #72428.\r\n- Increase revalidate times from 60 to 120 to avoid the headers tests from receiving a `STALE` response instead of the expected `HIT` response.",
    "sha": "47f350067ddd7309d7741a23df46d3bba77fe0b2",
    "files": [
        {
            "sha": "2d2091a0c2d57d8ba145780f461a126a0fd2b2b5",
            "filename": "test/e2e/app-dir/ppr-full/app/dynamic-data/force-static/page.jsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fdynamic-data%2Fforce-static%2Fpage.jsx",
            "raw_url": "https://github.com/vercel/next.js/raw/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fdynamic-data%2Fforce-static%2Fpage.jsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fdynamic-data%2Fforce-static%2Fpage.jsx?ref=47f350067ddd7309d7741a23df46d3bba77fe0b2",
            "patch": "@@ -3,7 +3,7 @@ import { Optimistic } from '../../../components/optimistic'\n import { ServerHtml } from '../../../components/server-html'\n \n export const dynamic = 'force-static'\n-export const revalidate = 60\n+export const revalidate = 120\n \n export default async (props) => {\n   const searchParams = await props.searchParams"
        },
        {
            "sha": "4d19c7ed57b0793c920e8202fb298e0844345442",
            "filename": "test/e2e/app-dir/ppr-full/app/dynamic/force-static/page.jsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fdynamic%2Fforce-static%2Fpage.jsx",
            "raw_url": "https://github.com/vercel/next.js/raw/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fdynamic%2Fforce-static%2Fpage.jsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fdynamic%2Fforce-static%2Fpage.jsx?ref=47f350067ddd7309d7741a23df46d3bba77fe0b2",
            "patch": "@@ -2,7 +2,7 @@ import React, { Suspense } from 'react'\n import { Dynamic } from '../../../components/dynamic'\n \n export const dynamic = 'force-static'\n-export const revalidate = 60\n+export const revalidate = 120\n \n export default () => {\n   return ("
        },
        {
            "sha": "5273a33a709453446444a77558d8a8cf969955be",
            "filename": "test/e2e/app-dir/ppr-full/app/loading/[slug]/page.jsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Floading%2F%5Bslug%5D%2Fpage.jsx",
            "raw_url": "https://github.com/vercel/next.js/raw/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Floading%2F%5Bslug%5D%2Fpage.jsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Floading%2F%5Bslug%5D%2Fpage.jsx?ref=47f350067ddd7309d7741a23df46d3bba77fe0b2",
            "patch": "@@ -1,7 +1,7 @@\n import React, { Suspense } from 'react'\n import { Dynamic } from '../../../components/dynamic'\n \n-export const revalidate = 60\n+export const revalidate = 120\n \n export default async (props) => {\n   const params = await props.params"
        },
        {
            "sha": "48f52f899918c4b6b707c8a5b3cce156598081b3",
            "filename": "test/e2e/app-dir/ppr-full/app/metadata/page.jsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fmetadata%2Fpage.jsx",
            "raw_url": "https://github.com/vercel/next.js/raw/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fmetadata%2Fpage.jsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fmetadata%2Fpage.jsx?ref=47f350067ddd7309d7741a23df46d3bba77fe0b2",
            "patch": "@@ -2,7 +2,7 @@ import { Suspense } from 'react'\n import { Dynamic } from '../../components/dynamic'\n import { unstable_noStore } from 'next/cache'\n \n-export const revalidate = 60\n+export const revalidate = 120\n \n export async function generateMetadata() {\n   unstable_noStore()"
        },
        {
            "sha": "50e3cc84cbe44cfd1f11de1da03b490465ebf118",
            "filename": "test/e2e/app-dir/ppr-full/app/nested/[slug]/page.jsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fnested%2F%5Bslug%5D%2Fpage.jsx",
            "raw_url": "https://github.com/vercel/next.js/raw/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fnested%2F%5Bslug%5D%2Fpage.jsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fapp%2Fnested%2F%5Bslug%5D%2Fpage.jsx?ref=47f350067ddd7309d7741a23df46d3bba77fe0b2",
            "patch": "@@ -1,7 +1,7 @@\n import React, { Suspense } from 'react'\n import { Dynamic } from '../../../components/dynamic'\n \n-export const revalidate = 60\n+export const revalidate = 120\n \n export default async (props) => {\n   const params = await props.params"
        },
        {
            "sha": "3b9aeb9b919807deaa83a25c62ce095e51fe8365",
            "filename": "test/e2e/app-dir/ppr-full/ppr-full.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 10,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fppr-full.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/47f350067ddd7309d7741a23df46d3bba77fe0b2/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fppr-full.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fppr-full.test.ts?ref=47f350067ddd7309d7741a23df46d3bba77fe0b2",
            "patch": "@@ -20,16 +20,16 @@ type Page = {\n \n const pages: Page[] = [\n   { pathname: '/', dynamic: true },\n-  { pathname: '/nested/a', dynamic: true, revalidate: 60 },\n-  { pathname: '/nested/b', dynamic: true, revalidate: 60 },\n-  { pathname: '/nested/c', dynamic: true, revalidate: 60 },\n-  { pathname: '/metadata', dynamic: true, revalidate: 60 },\n+  { pathname: '/nested/a', dynamic: true, revalidate: 120 },\n+  { pathname: '/nested/b', dynamic: true, revalidate: 120 },\n+  { pathname: '/nested/c', dynamic: true, revalidate: 120 },\n+  { pathname: '/metadata', dynamic: true, revalidate: 120 },\n   { pathname: '/on-demand/a', dynamic: true },\n   { pathname: '/on-demand/b', dynamic: true },\n   { pathname: '/on-demand/c', dynamic: true },\n-  { pathname: '/loading/a', dynamic: true, revalidate: 60 },\n-  { pathname: '/loading/b', dynamic: true, revalidate: 60 },\n-  { pathname: '/loading/c', dynamic: true, revalidate: 60 },\n+  { pathname: '/loading/a', dynamic: true, revalidate: 120 },\n+  { pathname: '/loading/b', dynamic: true, revalidate: 120 },\n+  { pathname: '/loading/c', dynamic: true, revalidate: 120 },\n   { pathname: '/static', dynamic: false },\n   { pathname: '/no-suspense', dynamic: true, emptyStaticPart: true },\n   { pathname: '/no-suspense/nested/a', dynamic: true, emptyStaticPart: true },\n@@ -42,7 +42,7 @@ const pages: Page[] = [\n   {\n     pathname: '/dynamic/force-static',\n     dynamic: 'force-static',\n-    revalidate: 60,\n+    revalidate: 120,\n   },\n ]\n \n@@ -154,7 +154,7 @@ describe('ppr-full', () => {\n           }\n         })\n \n-        if (dynamic === true && !isNextDev) {\n+        if (dynamic === true && !isNextDev && !isNextDeploy) {\n           it('should cache the static part', async () => {\n             const delay = 500\n \n@@ -618,7 +618,7 @@ describe('ppr-full', () => {\n           }\n         })\n \n-        if (pathname.endsWith('/dynamic')) {\n+        if (pathname.endsWith('/dynamic') && !isNextDeploy) {\n           it('should cache the static part', async () => {\n             const {\n               timings: { streamFirstChunk, streamEnd, start },"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 15,
        "deletions": 15
    }
}