{
    "author": "bgw",
    "message": "Turbopack: Update notify-rs crate, remove workaround for fixed bug (#81909)\n\n8.0.0 had a bug that was fixed in 8.1.0 that required a workaround for error codes: https://github.com/notify-rs/notify/issues/685\n\nTested on Linux with\n\n```\nrm -rf /tmp/fuzz && RUST_BACKTRACE=1 cargo run --release -p turbo-tasks-fuzz -- fs-watcher --fs-root /tmp/fuzz --directory-modifications 0\n```",
    "sha": "22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09",
    "files": [
        {
            "sha": "3f253e9aec3547db27eaabb6e2efaa94b7a5a981",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 79,
            "deletions": 7,
            "changes": 86,
            "blob_url": "https://github.com/vercel/next.js/blob/22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09",
            "patch": "@@ -3454,9 +3454,9 @@ dependencies = [\n \n [[package]]\n name = \"kqueue\"\n-version = \"1.0.8\"\n+version = \"1.1.1\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"7447f1ca1b7b563588a205fe93dea8df60fd981423a768bc1c0ded35ed147d0c\"\n+checksum = \"eac30106d7dce88daf4a3fcb4879ea939476d5074a9b7ddd0fb97fa4bed5596a\"\n dependencies = [\n  \"kqueue-sys\",\n  \"libc\",\n@@ -4519,12 +4519,11 @@ dependencies = [\n \n [[package]]\n name = \"notify\"\n-version = \"8.0.0\"\n+version = \"8.1.0\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"2fee8403b3d66ac7b26aee6e40a897d85dc5ce26f44da36b8b73e987cc52e943\"\n+checksum = \"3163f59cd3fa0e9ef8c32f242966a7b9994fd7378366099593e0e73077cd8c97\"\n dependencies = [\n  \"bitflags 2.9.1\",\n- \"filetime\",\n  \"fsevent-sys\",\n  \"inotify\",\n  \"kqueue\",\n@@ -4533,7 +4532,7 @@ dependencies = [\n  \"mio 1.0.3\",\n  \"notify-types\",\n  \"walkdir\",\n- \"windows-sys 0.59.0\",\n+ \"windows-sys 0.60.2\",\n ]\n \n [[package]]\n@@ -11269,6 +11268,15 @@ dependencies = [\n  \"windows-targets 0.52.6\",\n ]\n \n+[[package]]\n+name = \"windows-sys\"\n+version = \"0.60.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"f2f500e4d28234f72040990ec9d39e3a6b950f9f22d3dba18416c35882612bcb\"\n+dependencies = [\n+ \"windows-targets 0.53.2\",\n+]\n+\n [[package]]\n name = \"windows-targets\"\n version = \"0.42.2\"\n@@ -11308,13 +11316,29 @@ dependencies = [\n  \"windows_aarch64_gnullvm 0.52.6\",\n  \"windows_aarch64_msvc 0.52.6\",\n  \"windows_i686_gnu 0.52.6\",\n- \"windows_i686_gnullvm\",\n+ \"windows_i686_gnullvm 0.52.6\",\n  \"windows_i686_msvc 0.52.6\",\n  \"windows_x86_64_gnu 0.52.6\",\n  \"windows_x86_64_gnullvm 0.52.6\",\n  \"windows_x86_64_msvc 0.52.6\",\n ]\n \n+[[package]]\n+name = \"windows-targets\"\n+version = \"0.53.2\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"c66f69fcc9ce11da9966ddb31a40968cad001c5bedeb5c2b82ede4253ab48aef\"\n+dependencies = [\n+ \"windows_aarch64_gnullvm 0.53.0\",\n+ \"windows_aarch64_msvc 0.53.0\",\n+ \"windows_i686_gnu 0.53.0\",\n+ \"windows_i686_gnullvm 0.53.0\",\n+ \"windows_i686_msvc 0.53.0\",\n+ \"windows_x86_64_gnu 0.53.0\",\n+ \"windows_x86_64_gnullvm 0.53.0\",\n+ \"windows_x86_64_msvc 0.53.0\",\n+]\n+\n [[package]]\n name = \"windows_aarch64_gnullvm\"\n version = \"0.42.2\"\n@@ -11333,6 +11357,12 @@ version = \"0.52.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"32a4622180e7a0ec044bb555404c800bc9fd9ec262ec147edd5989ccd0c02cd3\"\n \n+[[package]]\n+name = \"windows_aarch64_gnullvm\"\n+version = \"0.53.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"86b8d5f90ddd19cb4a147a5fa63ca848db3df085e25fee3cc10b39b6eebae764\"\n+\n [[package]]\n name = \"windows_aarch64_msvc\"\n version = \"0.42.2\"\n@@ -11351,6 +11381,12 @@ version = \"0.52.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"09ec2a7bb152e2252b53fa7803150007879548bc709c039df7627cabbd05d469\"\n \n+[[package]]\n+name = \"windows_aarch64_msvc\"\n+version = \"0.53.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"c7651a1f62a11b8cbd5e0d42526e55f2c99886c77e007179efff86c2b137e66c\"\n+\n [[package]]\n name = \"windows_i686_gnu\"\n version = \"0.42.2\"\n@@ -11369,12 +11405,24 @@ version = \"0.52.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"8e9b5ad5ab802e97eb8e295ac6720e509ee4c243f69d781394014ebfe8bbfa0b\"\n \n+[[package]]\n+name = \"windows_i686_gnu\"\n+version = \"0.53.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"c1dc67659d35f387f5f6c479dc4e28f1d4bb90ddd1a5d3da2e5d97b42d6272c3\"\n+\n [[package]]\n name = \"windows_i686_gnullvm\"\n version = \"0.52.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"0eee52d38c090b3caa76c563b86c3a4bd71ef1a819287c19d586d7334ae8ed66\"\n \n+[[package]]\n+name = \"windows_i686_gnullvm\"\n+version = \"0.53.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"9ce6ccbdedbf6d6354471319e781c0dfef054c81fbc7cf83f338a4296c0cae11\"\n+\n [[package]]\n name = \"windows_i686_msvc\"\n version = \"0.42.2\"\n@@ -11393,6 +11441,12 @@ version = \"0.52.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"240948bc05c5e7c6dabba28bf89d89ffce3e303022809e73deaefe4f6ec56c66\"\n \n+[[package]]\n+name = \"windows_i686_msvc\"\n+version = \"0.53.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"581fee95406bb13382d2f65cd4a908ca7b1e4c2f1917f143ba16efe98a589b5d\"\n+\n [[package]]\n name = \"windows_x86_64_gnu\"\n version = \"0.42.2\"\n@@ -11411,6 +11465,12 @@ version = \"0.52.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"147a5c80aabfbf0c7d901cb5895d1de30ef2907eb21fbbab29ca94c5b08b1a78\"\n \n+[[package]]\n+name = \"windows_x86_64_gnu\"\n+version = \"0.53.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"2e55b5ac9ea33f2fc1716d1742db15574fd6fc8dadc51caab1c16a3d3b4190ba\"\n+\n [[package]]\n name = \"windows_x86_64_gnullvm\"\n version = \"0.42.2\"\n@@ -11429,6 +11489,12 @@ version = \"0.52.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"24d5b23dc417412679681396f2b49f3de8c1473deb516bd34410872eff51ed0d\"\n \n+[[package]]\n+name = \"windows_x86_64_gnullvm\"\n+version = \"0.53.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"0a6e035dd0599267ce1ee132e51c27dd29437f63325753051e71dd9e42406c57\"\n+\n [[package]]\n name = \"windows_x86_64_msvc\"\n version = \"0.42.2\"\n@@ -11447,6 +11513,12 @@ version = \"0.52.6\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n checksum = \"589f6da84c646204747d1270a2a5661ea66ed1cced2631d546fdfb155959f9ec\"\n \n+[[package]]\n+name = \"windows_x86_64_msvc\"\n+version = \"0.53.0\"\n+source = \"registry+https://github.com/rust-lang/crates.io-index\"\n+checksum = \"271414315aff87387382ec3d271b52d7ae78726f5d44ac98b4f4030c91880486\"\n+\n [[package]]\n name = \"winnow\"\n version = \"0.5.15\""
        },
        {
            "sha": "ee27eb2b8d11adbf296db02f873351430b26bcd7",
            "filename": "Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09/Cargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09/Cargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.toml?ref=22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09",
            "patch": "@@ -379,7 +379,7 @@ napi = { version = \"2\", default-features = false, features = [\n     \"napi5\",\n     \"compat-mode\"\n ] }\n-notify = \"8.0.0\"\n+notify = \"8.1.0\"\n once_cell = \"1.17.1\"\n owo-colors = \"3.5.0\"\n parcel_selectors = \"0.28.2\""
        },
        {
            "sha": "1ae0e440ff03b91018dbeca729a777d65614b3f4",
            "filename": "turbopack/crates/turbo-tasks-fs/src/watcher.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 19,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Fwatcher.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Fwatcher.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Fwatcher.rs?ref=22d0b54d4cc6b7ec0fd5e9f785049d5c32431d09",
            "patch": "@@ -10,7 +10,7 @@ use std::{\n     time::Duration,\n };\n \n-use anyhow::Result;\n+use anyhow::{Context, Result};\n use notify::{\n     Config, EventKind, PollWatcher, RecommendedWatcher, RecursiveMode, Watcher,\n     event::{MetadataKind, ModifyKind, RenameMode},\n@@ -113,20 +113,6 @@ impl DiskWatcher {\n         dir_path: &Path,\n         root_path: &Path,\n     ) -> Result<()> {\n-        use anyhow::Context;\n-        // HACK: Rewrite NotFound io errors to PathNotFound\n-        // This shouldn't ever happen (notify should transform this for us), but even after\n-        // https://github.com/notify-rs/notify/pull/611, it seems like there's still some case where\n-        // it can occur with inotify on Linux.\n-        fn map_notify_err(mut err: notify::Error) -> notify::Error {\n-            if let notify::ErrorKind::Io(io_err) = &err.kind\n-                && io_err.kind() == std::io::ErrorKind::NotFound\n-            {\n-                err.kind = notify::ErrorKind::PathNotFound;\n-            }\n-            err\n-        }\n-\n         if let Some(watcher) = watcher.as_mut() {\n             let mut path = dir_path;\n             let err_with_context = |err| {\n@@ -136,10 +122,7 @@ impl DiskWatcher {\n                     path.display()\n                 ));\n             };\n-            while let Err(err) = watcher\n-                .watch(path, RecursiveMode::NonRecursive)\n-                .map_err(map_notify_err)\n-            {\n+            while let Err(err) = watcher.watch(path, RecursiveMode::NonRecursive) {\n                 match err {\n                     notify::Error {\n                         kind: notify::ErrorKind::PathNotFound,"
        }
    ],
    "stats": {
        "total": 109,
        "additions": 82,
        "deletions": 27
    }
}