{
    "author": "eps1lon",
    "message": "[test] Remove `describeVariants` helper (#76631)",
    "sha": "dbb19c551478330fad5418703aec5e0e706fcb8a",
    "files": [
        {
            "sha": "d7a47aa7a39bd9f6b90715413453e78b5b726260",
            "filename": "test/development/app-dir/basic/basic.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/dbb19c551478330fad5418703aec5e0e706fcb8a/test%2Fdevelopment%2Fapp-dir%2Fbasic%2Fbasic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/dbb19c551478330fad5418703aec5e0e706fcb8a/test%2Fdevelopment%2Fapp-dir%2Fbasic%2Fbasic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fbasic%2Fbasic.test.ts?ref=dbb19c551478330fad5418703aec5e0e706fcb8a",
            "patch": "@@ -1,8 +1,8 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { describeVariants as describe, waitFor } from 'next-test-utils'\n+import { waitFor } from 'next-test-utils'\n import { createSandbox, waitForHydration } from 'development-sandbox'\n \n-describe.each(['default', 'turbo'])('basic app-dir tests', () => {\n+describe('basic app-dir tests', () => {\n   const { next } = nextTestSetup({\n     files: __dirname,\n   })"
        },
        {
            "sha": "c22cb2ae6bdbd8fa5626872cedcdf89a0e8c1e98",
            "filename": "test/development/app-dir/experimental-lightningcss/experimental-lightningcss.test.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 44,
            "changes": 74,
            "blob_url": "https://github.com/vercel/next.js/blob/dbb19c551478330fad5418703aec5e0e706fcb8a/test%2Fdevelopment%2Fapp-dir%2Fexperimental-lightningcss%2Fexperimental-lightningcss.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/dbb19c551478330fad5418703aec5e0e706fcb8a/test%2Fdevelopment%2Fapp-dir%2Fexperimental-lightningcss%2Fexperimental-lightningcss.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fexperimental-lightningcss%2Fexperimental-lightningcss.test.ts?ref=dbb19c551478330fad5418703aec5e0e706fcb8a",
            "patch": "@@ -1,53 +1,39 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { describeVariants } from 'next-test-utils'\n \n-describeVariants.each(['turbo'])('experimental-lightningcss', () => {\n-  const { next } = nextTestSetup({\n-    files: __dirname,\n-  })\n-\n-  it('should support css modules', async () => {\n-    // Recommended for tests that check HTML. Cheerio is a HTML parser that has a jQuery like API.\n-    const $ = await next.render$('/')\n-    expect($('p').text()).toBe('hello world')\n-    // swc_css does not include `-module` in the class name, while lightningcss does.\n-    expect($('p').attr('class')).toBe(\n-      'search-keyword style-module__hlQ3RG__blue'\n-    )\n-  })\n-})\n+describe('experimental-lightningcss with default mode', () => {\n+  describe('in dev server', () => {\n+    const { isTurbopack, next } = nextTestSetup({\n+      files: __dirname,\n+      dependencies: { lightningcss: '^1.23.0' },\n+      packageJson: {\n+        browserslist: ['chrome 100'],\n+      },\n+    })\n \n-// lightningcss produces different class names in turbo mode\n-describeVariants.each(['default'])(\n-  'experimental-lightningcss with default mode',\n-  () => {\n-    describe('in dev server', () => {\n-      const { next } = nextTestSetup({\n-        files: __dirname,\n-        dependencies: { lightningcss: '^1.23.0' },\n-        packageJson: {\n-          browserslist: ['chrome 100'],\n-        },\n-      })\n+    it('should support css modules', async () => {\n+      // Recommended for tests that check HTML. Cheerio is a HTML parser that has a jQuery like API.\n+      const $ = await next.render$('/')\n+      expect($('p').text()).toBe('hello world')\n \n-      it('should support css modules', async () => {\n-        // Recommended for tests that check HTML. Cheerio is a HTML parser that has a jQuery like API.\n-        const $ = await next.render$('/')\n-        expect($('p').text()).toBe('hello world')\n+      // lightningcss produces different class names in turbo mode\n+      if (isTurbopack) {\n+        // swc_css does not include `-module` in the class name, while lightningcss does.\n+        expect($('p').attr('class')).toBe(\n+          'search-keyword style-module__hlQ3RG__blue'\n+        )\n+      } else {\n         // We remove hash from the class name in test mode using env var because it is not deterministic.\n         expect($('p').attr('class')).toBe('search-keyword style-module__blue')\n-      })\n+      }\n+    })\n \n-      it('should support browserslist', async () => {\n-        const $ = await next.browser('/')\n+    it('should support browserslist', async () => {\n+      const $ = await next.browser('/')\n \n-        expect(await $.elementByCss('.nested').text()).toBe(\n-          'Red due to nesting'\n-        )\n-        expect(await $.elementByCss('.nested').getComputedCss('color')).toBe(\n-          'rgb(255, 0, 0)'\n-        )\n-      })\n+      expect(await $.elementByCss('.nested').text()).toBe('Red due to nesting')\n+      expect(await $.elementByCss('.nested').getComputedCss('color')).toBe(\n+        'rgb(255, 0, 0)'\n+      )\n     })\n-  }\n-)\n+  })\n+})"
        },
        {
            "sha": "74b279ae9d2be4c43ea6b3e4128df86a405447d3",
            "filename": "test/lib/next-test-utils.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/dbb19c551478330fad5418703aec5e0e706fcb8a/test%2Flib%2Fnext-test-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/dbb19c551478330fad5418703aec5e0e706fcb8a/test%2Flib%2Fnext-test-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-test-utils.ts?ref=dbb19c551478330fad5418703aec5e0e706fcb8a",
            "patch": "@@ -1520,28 +1520,6 @@ export function getUrlFromBackgroundImage(backgroundImage: string) {\n   return matches\n }\n \n-/**\n- * For better editor support, pass in the variants this should run on (`default` and/or `turbo`) as cases.\n- *\n- * This is necessary if separate snapshots are needed for next.js with webpack vs turbopack.\n- */\n-export const describeVariants = {\n-  each(variants: TestVariants[]) {\n-    return (name: string, fn: (variants: TestVariants) => any) => {\n-      if (\n-        !Array.isArray(variants) ||\n-        !variants.every((val) => typeof val === 'string')\n-      ) {\n-        throw new Error('variants need to be an array of strings')\n-      }\n-\n-      for (const variant of variants) {\n-        getSnapshotTestDescribe(variant).each([variant])(name, fn)\n-      }\n-    }\n-  },\n-}\n-\n export const getTitle = (browser: BrowserInterface) =>\n   browser.elementByCss('title').text()\n "
        }
    ],
    "stats": {
        "total": 100,
        "additions": 32,
        "deletions": 68
    }
}