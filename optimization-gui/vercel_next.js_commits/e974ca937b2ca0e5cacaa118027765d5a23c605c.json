{
    "author": "unstubbable",
    "message": "[test] Enable `reactDebugChannel` for experimental test shards (#84533)\n\nThe experimental flag `reactDebugChannel` is currently off by default.\nTo avoid regressions in the debug channel integration, we enable the\nflag for the experimental test shards.",
    "sha": "e974ca937b2ca0e5cacaa118027765d5a23c605c",
    "files": [
        {
            "sha": "5e094bb5215062a89474f528c2e7ac77ab54b7b1",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/e974ca937b2ca0e5cacaa118027765d5a23c605c/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/e974ca937b2ca0e5cacaa118027765d5a23c605c/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=e974ca937b2ca0e5cacaa118027765d5a23c605c",
            "patch": "@@ -702,6 +702,7 @@ jobs:\n       afterBuild: |\n         export __NEXT_EXPERIMENTAL_PPR=true # for compatibility with the existing tests\n         export __NEXT_EXPERIMENTAL_CACHE_COMPONENTS=true\n+        export __NEXT_EXPERIMENTAL_DEBUG_CHANNEL=true\n         export NEXT_EXTERNAL_TESTS_FILTERS=\"test/experimental-tests-manifest.json\"\n         export NEXT_E2E_TEST_TIMEOUT=240000\n         export GH_PR_NUMBER=${{ github.event.pull_request && github.event.pull_request.number || '' }}\n@@ -932,6 +933,7 @@ jobs:\n       afterBuild: |\n         export __NEXT_EXPERIMENTAL_PPR=true # for compatibility with the existing tests\n         export __NEXT_EXPERIMENTAL_CACHE_COMPONENTS=true\n+        export __NEXT_EXPERIMENTAL_DEBUG_CHANNEL=true\n         export NEXT_EXTERNAL_TESTS_FILTERS=\"test/experimental-tests-manifest.json\"\n         export IS_WEBPACK_TEST=1\n \n@@ -955,6 +957,7 @@ jobs:\n       afterBuild: |\n         export __NEXT_EXPERIMENTAL_PPR=true # for compatibility with the existing tests\n         export __NEXT_EXPERIMENTAL_CACHE_COMPONENTS=true\n+        export __NEXT_EXPERIMENTAL_DEBUG_CHANNEL=true\n         export NEXT_EXTERNAL_TESTS_FILTERS=\"test/experimental-tests-manifest.json\"\n         export NEXT_TEST_MODE=dev\n         export __NEXT_EXPERIMENTAL_ISOLATED_DEV_BUILD=true\n@@ -981,6 +984,7 @@ jobs:\n       afterBuild: |\n         export __NEXT_EXPERIMENTAL_PPR=true # for compatibility with the existing tests\n         export __NEXT_EXPERIMENTAL_CACHE_COMPONENTS=true\n+        export __NEXT_EXPERIMENTAL_DEBUG_CHANNEL=true\n         export NEXT_EXTERNAL_TESTS_FILTERS=\"test/experimental-tests-manifest.json\"\n         export NEXT_TEST_MODE=start\n         export IS_WEBPACK_TEST=1"
        },
        {
            "sha": "b744a81ffc071b68498714a5aef45d69acfcd79a",
            "filename": "package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/e974ca937b2ca0e5cacaa118027765d5a23c605c/package.json",
            "raw_url": "https://github.com/vercel/next.js/raw/e974ca937b2ca0e5cacaa118027765d5a23c605c/package.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/package.json?ref=e974ca937b2ca0e5cacaa118027765d5a23c605c",
            "patch": "@@ -110,7 +110,7 @@\n     \"test-storybook\": \"turbo run test-storybook\",\n     \"with-rspack\": \"cross-env NEXT_RSPACK=1 NEXT_TEST_USE_RSPACK=1\",\n     \"with-webpack\": \"cross-env IS_WEBPACK_TEST=1\",\n-    \"with-experimental\": \"cross-env __NEXT_EXPERIMENTAL_CACHE_COMPONENTS=true __NEXT_EXPERIMENTAL_PPR=true\"\n+    \"with-experimental\": \"cross-env __NEXT_EXPERIMENTAL_CACHE_COMPONENTS=true __NEXT_EXPERIMENTAL_PPR=true __NEXT_EXPERIMENTAL_DEBUG_CHANNEL=true\"\n   },\n   \"devDependencies\": {\n     \"@actions/core\": \"1.10.1\","
        },
        {
            "sha": "a528b85b94ffc9840b6748070fae90b1df563dff",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/e974ca937b2ca0e5cacaa118027765d5a23c605c/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e974ca937b2ca0e5cacaa118027765d5a23c605c/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=e974ca937b2ca0e5cacaa118027765d5a23c605c",
            "patch": "@@ -1792,6 +1792,25 @@ function enforceExperimentalFeatures(\n     }\n   }\n \n+  // TODO: Remove this once using the debug channel is the default.\n+  if (\n+    process.env.__NEXT_EXPERIMENTAL_DEBUG_CHANNEL === 'true' &&\n+    // We do respect an explicit value in the user config.\n+    (config.experimental.reactDebugChannel === undefined ||\n+      (isDefaultConfig && !config.experimental.reactDebugChannel))\n+  ) {\n+    config.experimental.reactDebugChannel = true\n+\n+    if (configuredExperimentalFeatures) {\n+      addConfiguredExperimentalFeature(\n+        configuredExperimentalFeatures,\n+        'reactDebugChannel',\n+        true,\n+        'enabled by `__NEXT_EXPERIMENTAL_DEBUG_CHANNEL`'\n+      )\n+    }\n+  }\n+\n   // TODO: Remove this once we've made RDC for Navigations the default for PPR.\n   if (\n     process.env.__NEXT_EXPERIMENTAL_PPR === 'true' &&"
        },
        {
            "sha": "14ba265be08b7b06d375f9e79cfc2d8d69b96252",
            "filename": "test/production/app-dir/build-output-prerender/build-output-prerender.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/e974ca937b2ca0e5cacaa118027765d5a23c605c/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e974ca937b2ca0e5cacaa118027765d5a23c605c/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts?ref=e974ca937b2ca0e5cacaa118027765d5a23c605c",
            "patch": "@@ -33,7 +33,8 @@ describe('build-output-prerender', () => {\n                   ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n+                  ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n+                  ✓ reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\"\n             `)\n           } else {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -44,7 +45,8 @@ describe('build-output-prerender', () => {\n                   ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n+                  ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n+                  ✓ reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\"\n             `)\n           }\n         } else if (pprEnabled) {\n@@ -180,6 +182,7 @@ describe('build-output-prerender', () => {\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n+                  ✓ reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\n                   ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ⨯ turbopackMinify (disabled by \\`--debug-prerender\\`)\"\n             `)\n@@ -195,6 +198,7 @@ describe('build-output-prerender', () => {\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n+                  ✓ reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\n                   ⨯ serverMinification (disabled by \\`--debug-prerender\\`)\n                   ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n             `)\n@@ -356,7 +360,8 @@ describe('build-output-prerender', () => {\n                   ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n+                  ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n+                  ✓ reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\"\n             `)\n           } else {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -367,7 +372,8 @@ describe('build-output-prerender', () => {\n                   ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n+                  ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n+                  ✓ reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\"\n             `)\n           }\n         } else if (pprEnabled) {\n@@ -445,6 +451,7 @@ describe('build-output-prerender', () => {\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n+                  ✓ reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\n                   ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ⨯ turbopackMinify (disabled by \\`--debug-prerender\\`)\"\n             `)\n@@ -460,6 +467,7 @@ describe('build-output-prerender', () => {\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n+                  ✓ reactDebugChannel (enabled by \\`__NEXT_EXPERIMENTAL_DEBUG_CHANNEL\\`)\n                   ⨯ serverMinification (disabled by \\`--debug-prerender\\`)\n                   ✓ serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n             `)"
        }
    ],
    "stats": {
        "total": 41,
        "additions": 36,
        "deletions": 5
    }
}