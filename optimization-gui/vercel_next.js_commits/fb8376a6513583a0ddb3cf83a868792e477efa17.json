{
    "author": "razzeee",
    "message": "Allow URL schemes that include `+`, `-` or `.` (#77932)\n\nCo-authored-by: Sebastian Sebbie Silbermann <sebastian.silbermann@vercel.com>",
    "sha": "fb8376a6513583a0ddb3cf83a868792e477efa17",
    "files": [
        {
            "sha": "505fd10f1b6ed735dd440a4eb4666fc513e3aeec",
            "filename": "packages/next/src/client/resolve-href.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/fb8376a6513583a0ddb3cf83a868792e477efa17/packages%2Fnext%2Fsrc%2Fclient%2Fresolve-href.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/fb8376a6513583a0ddb3cf83a868792e477efa17/packages%2Fnext%2Fsrc%2Fclient%2Fresolve-href.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fresolve-href.ts?ref=fb8376a6513583a0ddb3cf83a868792e477efa17",
            "patch": "@@ -34,7 +34,8 @@ export function resolveHref(\n \n   // repeated slashes and backslashes in the URL are considered\n   // invalid and will never match a Next.js page/file\n-  const urlProtoMatch = urlAsString.match(/^[a-zA-Z]{1,}:\\/\\//)\n+  // https://www.rfc-editor.org/rfc/rfc3986.html#section-3.1\n+  const urlProtoMatch = urlAsString.match(/^[a-z][a-z0-9+.-]*:\\/\\//i)\n   const urlAsStringNoProto = urlProtoMatch\n     ? urlAsString.slice(urlProtoMatch[0].length)\n     : urlAsString"
        },
        {
            "sha": "9f71dc8d780981a2929b6fce54a4c57e7d9e5d76",
            "filename": "test/integration/invalid-href/pages/exotic-href.js",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/fb8376a6513583a0ddb3cf83a868792e477efa17/test%2Fintegration%2Finvalid-href%2Fpages%2Fexotic-href.js",
            "raw_url": "https://github.com/vercel/next.js/raw/fb8376a6513583a0ddb3cf83a868792e477efa17/test%2Fintegration%2Finvalid-href%2Fpages%2Fexotic-href.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Finvalid-href%2Fpages%2Fexotic-href.js?ref=fb8376a6513583a0ddb3cf83a868792e477efa17",
            "patch": "@@ -0,0 +1,14 @@\n+import Link from 'next/link'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Link href=\"HTTPs://google.com\">HTTPs</Link>\n+      <Link href=\"flatpak+https://dl.flathub.org/repo/appstream/net.krafting.Playlifin.flatpakref\">\n+        flatpak+https\n+      </Link>\n+      <Link href=\"com.apple.tv://\">com.apple.tv</Link>\n+      <Link href=\"itms-apps://\">itms-apps</Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "058acfb82c108bf606771cbf6ef116042109bc05",
            "filename": "test/integration/invalid-href/pages/second.js",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/fb8376a6513583a0ddb3cf83a868792e477efa17/test%2Fintegration%2Finvalid-href%2Fpages%2Fsecond.js",
            "raw_url": "https://github.com/vercel/next.js/raw/fb8376a6513583a0ddb3cf83a868792e477efa17/test%2Fintegration%2Finvalid-href%2Fpages%2Fsecond.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Finvalid-href%2Fpages%2Fsecond.js?ref=fb8376a6513583a0ddb3cf83a868792e477efa17",
            "patch": "@@ -12,16 +12,16 @@ export default function Page() {\n       id=\"click-me\"\n       onClick={(e) => {\n         e.preventDefault()\n+        // this should throw an error on load since prefetch\n+        // receives the invalid href\n         router[method](invalidLink)\n       }}\n     >\n       invalid link :o\n     </a>\n   ) : (\n-    // this should throw an error on load since prefetch\n-    // receives the invalid href\n     <Link href={invalidLink} id=\"click-me\">\n-      invalid link :o\n+      valid link :o\n     </Link>\n   )\n }"
        },
        {
            "sha": "0ec9bc411ee8aa29c7823dbed9968682dc5b223a",
            "filename": "test/integration/invalid-href/test/index.test.ts",
            "status": "renamed",
            "additions": 20,
            "deletions": 4,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/fb8376a6513583a0ddb3cf83a868792e477efa17/test%2Fintegration%2Finvalid-href%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/fb8376a6513583a0ddb3cf83a868792e477efa17/test%2Fintegration%2Finvalid-href%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Finvalid-href%2Ftest%2Findex.test.ts?ref=fb8376a6513583a0ddb3cf83a868792e477efa17",
            "patch": "@@ -16,8 +16,8 @@ import cheerio from 'cheerio'\n import webdriver from 'next-webdriver'\n import { join } from 'path'\n \n-let app\n-let appPort\n+let app: Awaited<ReturnType<typeof nextStart>>\n+let appPort: number\n const appDir = join(__dirname, '..')\n \n // This test doesn't seem to benefit from retries, let's disable them until the test gets fixed\n@@ -98,10 +98,18 @@ describe('Invalid hrefs', () => {\n         await noError('/first')\n       })\n \n-      it('does not show error in production when https://google.com is used as href on Link', async () => {\n+      it('does not show error in production when https:// is used in href on Link', async () => {\n         await noError('/second')\n       })\n \n+      it('does not show error in production when exotic protocols are used in href in Link', async () => {\n+        const browser = await webdriver(appPort, '/exotic-href')\n+\n+        expect(\n+          (await browser.log()).filter((x) => x.source === 'error')\n+        ).toEqual([])\n+      })\n+\n       it('does not show error when internal href is used with external as', async () => {\n         await noError('/invalid-relative', true)\n       })\n@@ -160,10 +168,18 @@ describe('Invalid hrefs', () => {\n         await noError('/first')\n       })\n \n-      it('does not show error when https://google.com is used as href on Link', async () => {\n+      it('does not show error when https:// is used as href in Link', async () => {\n         await noError('/second')\n       })\n \n+      it('does not show error when exotic protocols are used in href in Link', async () => {\n+        const browser = await webdriver(appPort, '/exotic-href')\n+\n+        expect(\n+          (await browser.log()).filter((x) => x.source === 'error')\n+        ).toEqual([])\n+      })\n+\n       // eslint-disable-next-line jest/no-identical-title\n       it('shows error when dynamic route mismatch is used on Link', async () => {\n         await showsError(",
            "previous_filename": "test/integration/invalid-href/test/index.test.js"
        }
    ],
    "stats": {
        "total": 47,
        "additions": 39,
        "deletions": 8
    }
}