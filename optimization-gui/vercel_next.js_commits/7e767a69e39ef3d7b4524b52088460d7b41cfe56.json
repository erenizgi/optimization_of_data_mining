{
    "author": "acdlite",
    "message": "Add Activity name to route layouts and pages (#85011)\n\nThis is the name that will be displayed in the Suspense DevTools.\n\nA name is given to any boundary that corresponds to a user-defined\nlayout or page. It omits \"virtual\" segments that are inserted\nautomatically by the router.",
    "sha": "7e767a69e39ef3d7b4524b52088460d7b41cfe56",
    "files": [
        {
            "sha": "9f20d53ecaef1fe4e2336625d4c453c919303b32",
            "filename": "packages/next/src/client/components/layout-router.tsx",
            "status": "modified",
            "additions": 51,
            "deletions": 0,
            "changes": 51,
            "blob_url": "https://github.com/vercel/next.js/blob/7e767a69e39ef3d7b4524b52088460d7b41cfe56/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flayout-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7e767a69e39ef3d7b4524b52088460d7b41cfe56/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flayout-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Flayout-router.tsx?ref=7e767a69e39ef3d7b4524b52088460d7b41cfe56",
            "patch": "@@ -42,6 +42,7 @@ import { hasInterceptionRouteInCurrentTree } from './router-reducer/reducers/has\n import { dispatchAppRouterAction } from './use-action-queue'\n import { useRouterBFCache, type RouterBFCacheEntry } from './bfcache'\n import { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\n+import { PAGE_SEGMENT_KEY } from '../../shared/lib/segment'\n \n /**\n  * Add refetch marker to router state at the point of the current layout segment.\n@@ -476,6 +477,7 @@ function LoadingBoundary({\n     const loadingScripts = loadingModuleData[2]\n     return (\n       <Suspense\n+        name=\"loading.tsx\"\n         fallback={\n           <>\n             {loadingStyles}\n@@ -688,8 +690,10 @@ export default function OuterLayoutRouter({\n     }\n \n     if (process.env.__NEXT_ROUTER_BF_CACHE) {\n+      const boundaryName = getBoundaryNameForSuspenseDevTools(tree)\n       child = (\n         <Activity\n+          name={boundaryName}\n           key={stateKey}\n           mode={stateKey === activeStateKey ? 'visible' : 'hidden'}\n         >\n@@ -705,3 +709,50 @@ export default function OuterLayoutRouter({\n \n   return children\n }\n+\n+function getBoundaryNameForSuspenseDevTools(\n+  subtree: FlightRouterState\n+): string | undefined {\n+  const segment = subtree[0]\n+\n+  if (typeof segment === 'string') {\n+    const children = subtree[1]\n+    const isPage = Object.keys(children).length === 0\n+    if (isPage) {\n+      // Page segment\n+      return '/'\n+    }\n+\n+    // Layout segment\n+\n+    // Skip over \"virtual\" layouts that don't correspond to app-\n+    // defined components.\n+    if (\n+      segment === '' ||\n+      // For some reason, the loader tree sometimes includes extra __PAGE__\n+      // \"layouts\" when part of a parallel route. But it's not a leaf node.\n+      // Otherwise, we wouldn't need this special case because pages are\n+      // always leaf nodes.\n+      // TODO: Investigate why the loader produces these fake page segments.\n+      segment.startsWith(PAGE_SEGMENT_KEY) ||\n+      // This is inserted by the loader. We should consider encoding these\n+      // in a more special way instead of checking the name, to distinguish them\n+      // from app-defined groups.\n+      segment[0] === '(virtual)'\n+    ) {\n+      return undefined\n+    }\n+\n+    if (segment === '/_not-found') {\n+      // Special case. For some reason, the name itself already has a\n+      // leading slash.\n+      return '/_not-found/'\n+    }\n+\n+    return `/${segment}/`\n+  }\n+\n+  // Parameterized segments are always layouts\n+  const paramCacheKey = segment[1]\n+  return `/${paramCacheKey}/`\n+}"
        }
    ],
    "stats": {
        "total": 51,
        "additions": 51,
        "deletions": 0
    }
}