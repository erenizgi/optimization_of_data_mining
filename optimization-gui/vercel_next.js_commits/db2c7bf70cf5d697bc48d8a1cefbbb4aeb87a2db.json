{
    "author": "mischnic",
    "message": "Enable more tests for Turbopack (#83589)",
    "sha": "db2c7bf70cf5d697bc48d8a1cefbbb4aeb87a2db",
    "files": [
        {
            "sha": "23adf01892e077704f896eea59da3fc266892936",
            "filename": "test/e2e/app-dir/scss/invalid-module-document/invalid-module-document.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/db2c7bf70cf5d697bc48d8a1cefbbb4aeb87a2db/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-module-document%2Finvalid-module-document.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/db2c7bf70cf5d697bc48d8a1cefbbb4aeb87a2db/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-module-document%2Finvalid-module-document.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fscss%2Finvalid-module-document%2Finvalid-module-document.test.ts?ref=db2c7bf70cf5d697bc48d8a1cefbbb4aeb87a2db",
            "patch": "@@ -6,7 +6,7 @@ import { join } from 'path'\n // In order for the global isNextStart to be set\n import 'e2e-utils'\n \n-// TODO: Implement warning for Turbopack\n+// Importing module CSS in _document is allowed in Turbopack\n ;(process.env.IS_TURBOPACK_TEST ? describe.skip : describe)(\n   'Invalid SCSS in _document',\n   () => {"
        },
        {
            "sha": "958578cf0093b55e5490d7fe46c9406ee2164198",
            "filename": "test/integration/css/test/valid-invalid-css.test.js",
            "status": "modified",
            "additions": 81,
            "deletions": 95,
            "changes": 176,
            "blob_url": "https://github.com/vercel/next.js/blob/db2c7bf70cf5d697bc48d8a1cefbbb4aeb87a2db/test%2Fintegration%2Fcss%2Ftest%2Fvalid-invalid-css.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/db2c7bf70cf5d697bc48d8a1cefbbb4aeb87a2db/test%2Fintegration%2Fcss%2Ftest%2Fvalid-invalid-css.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss%2Ftest%2Fvalid-invalid-css.test.js?ref=db2c7bf70cf5d697bc48d8a1cefbbb4aeb87a2db",
            "patch": "@@ -13,7 +13,7 @@ import { join } from 'path'\n \n const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n \n-// TODO: Implement warning for Turbopack\n+// Importing module CSS in _document is allowed in Turbopack\n ;(process.env.IS_TURBOPACK_TEST ? describe.skip : describe)(\n   'Invalid CSS in _document',\n   () => {\n@@ -45,38 +45,36 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n     )\n   }\n )\n-;(process.env.IS_TURBOPACK_TEST ? describe.skip : describe)(\n-  'Invalid Global CSS',\n-  () => {\n-    ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n-      'production mode',\n-      () => {\n-        const appDir = join(fixturesDir, 'invalid-global')\n \n-        beforeAll(async () => {\n-          await remove(join(appDir, '.next'))\n-        })\n+describe('Invalid Global CSS', () => {\n+  ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n+    'production mode',\n+    () => {\n+      const appDir = join(fixturesDir, 'invalid-global')\n \n-        // eslint-disable-next-line jest/no-identical-title\n-        it('should fail to build', async () => {\n-          const { code, stderr } = await nextBuild(appDir, [], {\n-            stderr: true,\n-          })\n-          expect(code).not.toBe(0)\n-          expect(stderr).toContain('Failed to compile')\n-          expect(stderr).toContain('styles/global.css')\n-          expect(stderr).toMatch(\n-            /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n-          )\n-          // Skip: Rspack loaders cannot access module issuer info for location details\n-          if (!process.env.NEXT_RSPACK) {\n-            expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n-          }\n+      beforeAll(async () => {\n+        await remove(join(appDir, '.next'))\n+      })\n+\n+      // eslint-disable-next-line jest/no-identical-title\n+      it('should fail to build', async () => {\n+        const { code, stderr } = await nextBuild(appDir, [], {\n+          stderr: true,\n         })\n-      }\n-    )\n-  }\n-)\n+        expect(code).not.toBe(0)\n+        expect(stderr).toContain('Failed to compile')\n+        expect(stderr).toContain('styles/global.css')\n+        expect(stderr).toMatch(\n+          /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n+        )\n+        // Skip: Rspack loaders cannot access module issuer info for location details\n+        if (!process.env.NEXT_RSPACK) {\n+          expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n+        }\n+      })\n+    }\n+  )\n+})\n \n describe('Valid Global CSS from npm', () => {\n   ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n@@ -114,80 +112,68 @@ describe('Valid Global CSS from npm', () => {\n           .replace(/\\/\\*.*?\\*\\//g, '')\n           .trim()\n \n-        if (process.env.IS_TURBOPACK_TEST) {\n-          expect(cssContent).toMatchInlineSnapshot(`\".red-text{color:\"red\"}\"`)\n-        } else {\n-          expect(cssContent).toMatchInlineSnapshot(`\".red-text{color:\"red\"}\"`)\n-        }\n+        expect(cssContent).toMatchInlineSnapshot(`\".red-text{color:\"red\"}\"`)\n       })\n     }\n   )\n })\n \n-// TODO: Implement warning for Turbopack\n-;(process.env.IS_TURBOPACK_TEST ? describe.skip : describe)(\n-  'Invalid Global CSS with Custom App',\n-  () => {\n-    ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n-      'production mode',\n-      () => {\n-        const appDir = join(fixturesDir, 'invalid-global-with-app')\n+describe('Invalid Global CSS with Custom App', () => {\n+  ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n+    'production mode',\n+    () => {\n+      const appDir = join(fixturesDir, 'invalid-global-with-app')\n \n-        beforeAll(async () => {\n-          await remove(join(appDir, '.next'))\n-        })\n+      beforeAll(async () => {\n+        await remove(join(appDir, '.next'))\n+      })\n \n-        // eslint-disable-next-line jest/no-identical-title\n-        it('should fail to build', async () => {\n-          const { code, stderr } = await nextBuild(appDir, [], {\n-            stderr: true,\n-          })\n-          expect(code).not.toBe(0)\n-          expect(stderr).toContain('Failed to compile')\n-          expect(stderr).toContain('styles/global.css')\n-          expect(stderr).toMatch(\n-            /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n-          )\n-          // Skip: Rspack loaders cannot access module issuer info for location details\n-          if (!process.env.NEXT_RSPACK) {\n-            expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n-          }\n+      // eslint-disable-next-line jest/no-identical-title\n+      it('should fail to build', async () => {\n+        const { code, stderr } = await nextBuild(appDir, [], {\n+          stderr: true,\n         })\n-      }\n-    )\n-  }\n-)\n+        expect(code).not.toBe(0)\n+        expect(stderr).toContain('Failed to compile')\n+        expect(stderr).toContain('styles/global.css')\n+        expect(stderr).toMatch(\n+          /Please move all first-party global CSS imports.*?pages(\\/|\\\\)_app/\n+        )\n+        // Skip: Rspack loaders cannot access module issuer info for location details\n+        if (!process.env.NEXT_RSPACK) {\n+          expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n+        }\n+      })\n+    }\n+  )\n+})\n \n-// TODO: Implement warning for Turbopack\n-;(process.env.IS_TURBOPACK_TEST ? describe.skip : describe)(\n-  'Valid and Invalid Global CSS with Custom App',\n-  () => {\n-    ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n-      'production mode',\n-      () => {\n-        const appDir = join(fixturesDir, 'valid-and-invalid-global')\n+describe('Valid and Invalid Global CSS with Custom App', () => {\n+  ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n+    'production mode',\n+    () => {\n+      const appDir = join(fixturesDir, 'valid-and-invalid-global')\n \n-        beforeAll(async () => {\n-          await remove(join(appDir, '.next'))\n-        })\n+      beforeAll(async () => {\n+        await remove(join(appDir, '.next'))\n+      })\n \n-        // eslint-disable-next-line jest/no-identical-title\n-        it('should fail to build', async () => {\n-          const { code, stderr } = await nextBuild(appDir, [], {\n-            stderr: true,\n-          })\n-          expect(code).not.toBe(0)\n-          expect(stderr).toContain('Failed to compile')\n-          expect(stderr).toContain('styles/global.css')\n-          expect(stderr).toContain(\n-            'Please move all first-party global CSS imports'\n-          )\n-          // Skip: Rspack loaders cannot access module issuer info for location details\n-          if (!process.env.NEXT_RSPACK) {\n-            expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n-          }\n+      // eslint-disable-next-line jest/no-identical-title\n+      it('should fail to build', async () => {\n+        const { code, stderr } = await nextBuild(appDir, [], {\n+          stderr: true,\n         })\n-      }\n-    )\n-  }\n-)\n+        expect(code).not.toBe(0)\n+        expect(stderr).toContain('Failed to compile')\n+        expect(stderr).toContain('styles/global.css')\n+        expect(stderr).toContain(\n+          'Please move all first-party global CSS imports'\n+        )\n+        // Skip: Rspack loaders cannot access module issuer info for location details\n+        if (!process.env.NEXT_RSPACK) {\n+          expect(stderr).toMatch(/Location:.*pages[\\\\/]index\\.js/)\n+        }\n+      })\n+    }\n+  )\n+})"
        }
    ],
    "stats": {
        "total": 178,
        "additions": 82,
        "deletions": 96
    }
}