{
    "author": "eps1lon",
    "message": "[dev-overlay] Show error overlay on any thrown value in /app (#79658)\n\nMay have been a leftover from earlier. \r\n\r\nWe always consider any throw. Even without a sync stack, we might still have an async stack to show. And even if we have no stack at all, the message is still relevant. Basically, never hide errors.",
    "sha": "c51300807ea7e0590104343b8616572503f0b78d",
    "files": [
        {
            "sha": "2a2ea3b1c03552f40ebb54ab1f54fcd35adafd5a",
            "filename": ".changeset/smooth-bears-run.md",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c51300807ea7e0590104343b8616572503f0b78d/.changeset%2Fsmooth-bears-run.md",
            "raw_url": "https://github.com/vercel/next.js/raw/c51300807ea7e0590104343b8616572503f0b78d/.changeset%2Fsmooth-bears-run.md",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.changeset%2Fsmooth-bears-run.md?ref=c51300807ea7e0590104343b8616572503f0b78d",
            "patch": "@@ -0,0 +1,8 @@\n+---\n+'next': patch\n+---\n+\n+[dev-overlay] Show error overlay on any thrown value\n+\n+We used to only show the error overlay on thrown values with a stack property.\n+On other thrown values we kept the overlay collapsed."
        },
        {
            "sha": "ce005e6a226217b7a1ab1dfebfe2e51709c9a580",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay-error-boundary.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 11,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/c51300807ea7e0590104343b8616572503f0b78d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c51300807ea7e0590104343b8616572503f0b78d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay-error-boundary.tsx?ref=c51300807ea7e0590104343b8616572503f0b78d",
            "patch": "@@ -8,11 +8,10 @@ import DefaultGlobalError, {\n type AppDevOverlayErrorBoundaryProps = {\n   children: React.ReactNode\n   globalError: [GlobalErrorComponent, React.ReactNode]\n-  onError: (value: boolean) => void\n+  onError: () => void\n }\n \n type AppDevOverlayErrorBoundaryState = {\n-  isReactError: boolean\n   reactError: unknown\n }\n \n@@ -43,33 +42,28 @@ export class AppDevOverlayErrorBoundary extends PureComponent<\n   AppDevOverlayErrorBoundaryProps,\n   AppDevOverlayErrorBoundaryState\n > {\n-  state = { isReactError: false, reactError: null }\n+  state = { reactError: null }\n \n   static getDerivedStateFromError(error: Error) {\n-    if (!error.stack) {\n-      return { isReactError: false, reactError: null }\n-    }\n-\n     RuntimeErrorHandler.hadRuntimeError = true\n \n     return {\n-      isReactError: true,\n       reactError: error,\n     }\n   }\n \n   componentDidCatch() {\n-    this.props.onError(this.state.isReactError)\n+    this.props.onError()\n   }\n \n   render() {\n     const { children, globalError } = this.props\n-    const { isReactError, reactError } = this.state\n+    const { reactError } = this.state\n \n     const fallback = (\n       <ErroredHtml globalError={globalError} error={reactError} />\n     )\n \n-    return isReactError ? fallback : children\n+    return reactError !== null ? fallback : children\n   }\n }"
        },
        {
            "sha": "46d256572ae24206f22e31bc735d7bd5abc8c63b",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/c51300807ea7e0590104343b8616572503f0b78d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c51300807ea7e0590104343b8616572503f0b78d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx?ref=c51300807ea7e0590104343b8616572503f0b78d",
            "patch": "@@ -86,7 +86,7 @@ export function AppDevOverlay({\n     <>\n       <AppDevOverlayErrorBoundary\n         globalError={globalError}\n-        onError={setIsErrorOverlayOpen}\n+        onError={openOverlay}\n       >\n         <ReplaySsrOnlyErrors onBlockingError={openOverlay} />\n         {children}"
        },
        {
            "sha": "d26e9c790f18b3efd337c01f93cdd7351864bd5c",
            "filename": "test/development/acceptance-app/hydration-error.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/c51300807ea7e0590104343b8616572503f0b78d/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c51300807ea7e0590104343b8616572503f0b78d/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts?ref=c51300807ea7e0590104343b8616572503f0b78d",
            "patch": "@@ -210,7 +210,7 @@ describe('Error overlay for hydration errors in App router', () => {\n          \"componentStack\": \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n              <AppDevOverlay state={{nextId:1, ...}} globalError={[...]}>\n-               <AppDevOverlayErrorBoundary globalError={[...]} onError={function bound dispatchSetState}>\n+               <AppDevOverlayErrorBoundary globalError={[...]} onError={function}>\n                  <ReplaySsrOnlyErrors>\n                  <DevRootHTTPAccessFallbackBoundary>\n                    <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n@@ -246,7 +246,7 @@ describe('Error overlay for hydration errors in App router', () => {\n          \"componentStack\": \"...\n            <HotReload assetPrefix=\"\" globalError={[...]}>\n              <AppDevOverlay state={{nextId:1, ...}} globalError={[...]}>\n-               <AppDevOverlayErrorBoundary globalError={[...]} onError={function bound dispatchSetState}>\n+               <AppDevOverlayErrorBoundary globalError={[...]} onError={function}>\n                  <ReplaySsrOnlyErrors>\n                  <DevRootHTTPAccessFallbackBoundary>\n                    <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>\n@@ -1046,7 +1046,7 @@ describe('Error overlay for hydration errors in App router', () => {\n          \"componentStack\": \"...\n          <HotReload assetPrefix=\"\" globalError={[...]}>\n            <AppDevOverlay state={{nextId:1, ...}} globalError={[...]}>\n-             <AppDevOverlayErrorBoundary globalError={[...]} onError={function bound dispatchSetState}>\n+             <AppDevOverlayErrorBoundary globalError={[...]} onError={function}>\n                <ReplaySsrOnlyErrors>\n                <DevRootHTTPAccessFallbackBoundary>\n                  <HTTPAccessFallbackBoundary notFound={<NotAllowedRootHTTPFallbackError>}>"
        },
        {
            "sha": "26cfcfbf9341cb7de1865b8f35b65d6b524f6169",
            "filename": "test/development/app-dir/serialize-circular-error/serialize-circular-error.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/c51300807ea7e0590104343b8616572503f0b78d/test%2Fdevelopment%2Fapp-dir%2Fserialize-circular-error%2Fserialize-circular-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c51300807ea7e0590104343b8616572503f0b78d/test%2Fdevelopment%2Fapp-dir%2Fserialize-circular-error%2Fserialize-circular-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fserialize-circular-error%2Fserialize-circular-error.test.ts?ref=c51300807ea7e0590104343b8616572503f0b78d",
            "patch": "@@ -1,5 +1,4 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { assertNoRedbox } from 'next-test-utils'\n \n describe('serialize-circular-error', () => {\n   const { next } = nextTestSetup({\n@@ -27,9 +26,16 @@ describe('serialize-circular-error', () => {\n   it('should serialize the object from client component in console correctly', async () => {\n     const browser = await next.browser('/client')\n \n-    // It's not a valid error object, it will display the global-error instead of the error overlay\n-    // TODO: handle the error object in the client-side\n-    await assertNoRedbox(browser)\n+    // TODO: Format arbitrary messages in Redbox\n+    await expect(browser).toDisplayRedbox(`\n+     {\n+       \"description\": \"[object Object]\",\n+       \"environmentLabel\": null,\n+       \"label\": \"Runtime Error\",\n+       \"source\": null,\n+       \"stack\": [],\n+     }\n+    `)\n \n     const bodyText = await browser.elementByCss('body').text()\n     expect(bodyText).toContain("
        }
    ],
    "stats": {
        "total": 46,
        "additions": 27,
        "deletions": 19
    }
}