{
    "author": "bgw",
    "message": "Devcontainer: Replace Dockerfile with prebuilt image+features (#82450)\n\nDevcontainers support custom `Dockerfile`s, but it seems like it's more recommended to use a base image with \"features\" on top: https://containers.dev/implementors/features/\n\nFeatures get applied after the `Dockerfile`, so e.g. if we're installing `rust` with a feature, then we can't install things that depend on `rust` (e.g. `cargo-nextest`: https://nexte.st/) in the `Dockerfile`. So you're forced to do things with features instead, which can specify dependencies and ordering requirements.\n\nI removed a bunch of comments that were left over from the template. People wishing to update this file should refer to the https://aka.ms/devcontainer.json link at the top of the file.\n\nAlso added a lockfile for the features, generated with:\n\n```\ndevcontainer upgrade --workspace-folder=.\n```\n\n**Note:** The `base.Dockerfile` here was entirely unused.\n\n\n### Testing\n\n```\npodman stop --all && podman rm --all  # replace podman with docker if you're using docker\ndevcontainer up --workspace-folder=.\ndevcontainer exec --workspace-folder=. zsh\n```",
    "sha": "3e750d104f0718c233bb8a003aa716e7f27f052a",
    "files": [
        {
            "sha": "9db6f2118da64ebc5603c6c6edc3b6543bcdc6fa",
            "filename": ".devcontainer/Dockerfile",
            "status": "removed",
            "additions": 0,
            "deletions": 31,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/6797a087e54184b4cbe1b0ce18d3fe64d89e40eb/.devcontainer%2FDockerfile",
            "raw_url": "https://github.com/vercel/next.js/raw/6797a087e54184b4cbe1b0ce18d3fe64d89e40eb/.devcontainer%2FDockerfile",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2FDockerfile?ref=6797a087e54184b4cbe1b0ce18d3fe64d89e40eb",
            "patch": "@@ -1,31 +0,0 @@\n-# syntax=docker.io/docker/dockerfile:1\n-\n-# [Choice] Node.js version (use -bullseye variants on local arm64/Apple Silicon): 18, 16, 14, 18-bullseye, 16-bullseye, 14-bullseye, 18-buster, 16-buster, 14-buster\n-ARG VARIANT=20-bullseye\n-FROM mcr.microsoft.com/vscode/devcontainers/javascript-node:0-${VARIANT}\n-\n-# [Optional] Uncomment this section to install additional OS packages.\n-# These are required to run playwright properly\n-RUN apt-get update && export DEBIAN_FRONTEND=noninteractive \\\n-    && apt-get -y install --no-install-recommends \\\n-    gconf-service libxext6 libxfixes3 libxi6 libxrandr2 \\\n-    libxrender1 libcairo2 libcups2 libdbus-1-3 libexpat1 \\\n-    libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 \\\n-    libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 \\\n-    libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 \\\n-    libxdamage1 libxss1 libxtst6 libappindicator1 libnss3 libasound2 \\\n-    libatk1.0-0 libc6 libdrm-dev libgbm-dev ca-certificates fonts-liberation lsb-release xdg-utils wget \\\n-    # Chromium for running Turbopack benchmarks\n-    chromium \\\n-    # Used for plotters graph visualizations in turbopack benchmarks\n-    libfontconfig1-dev\n-\n-# [Optional] Uncomment if you want to install an additional version of node using nvm\n-# ARG EXTRA_NODE_VERSION=10\n-# RUN su node -c \"source /usr/local/share/nvm/nvm.sh && nvm install ${EXTRA_NODE_VERSION}\"\n-\n-# [Optional] Uncomment if you want to install more global node modules\n-# RUN su node -c \"npm install -g <your-package-list-here>\"\n-\n-# Enable pnpm\n-RUN corepack enable pnpm\n\\ No newline at end of file"
        },
        {
            "sha": "a861eaa0b7061e726c3f513833c1965ed8ee2109",
            "filename": ".devcontainer/base.Dockerfile",
            "status": "removed",
            "additions": 0,
            "deletions": 57,
            "changes": 57,
            "blob_url": "https://github.com/vercel/next.js/blob/6797a087e54184b4cbe1b0ce18d3fe64d89e40eb/.devcontainer%2Fbase.Dockerfile",
            "raw_url": "https://github.com/vercel/next.js/raw/6797a087e54184b4cbe1b0ce18d3fe64d89e40eb/.devcontainer%2Fbase.Dockerfile",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2Fbase.Dockerfile?ref=6797a087e54184b4cbe1b0ce18d3fe64d89e40eb",
            "patch": "@@ -1,57 +0,0 @@\n-# syntax=docker.io/docker/dockerfile:1\n-\n-# [Choice] Node.js version (use -bullseye variants on local arm64/Apple Silicon): 18-bullseye, 16-bullseye, 14-bullseye, 18-buster, 16-buster, 14-buster\n-ARG VARIANT=20-bullseye\n-FROM node:${VARIANT}\n-\n-# [Option] Install zsh\n-ARG INSTALL_ZSH=\"true\"\n-# [Option] Upgrade OS packages to their latest versions\n-ARG UPGRADE_PACKAGES=\"true\"\n-\n-# Install needed packages, yarn, nvm and setup non-root user. Use a separate RUN statement to add your own dependencies.\n-ARG USERNAME=node\n-ARG USER_UID=1000\n-ARG USER_GID=$USER_UID\n-ARG NPM_GLOBAL=/usr/local/share/npm-global\n-ENV NVM_DIR=/usr/local/share/nvm\n-ENV NVM_SYMLINK_CURRENT=true \\ \n-    PATH=${NPM_GLOBAL}/bin:${NVM_DIR}/current/bin:${PATH}\n-COPY library-scripts/*.sh library-scripts/*.env /tmp/library-scripts/\n-RUN apt-get update && export DEBIAN_FRONTEND=noninteractive  \\\n-    # Remove imagemagick due to https://security-tracker.debian.org/tracker/CVE-2019-10131\n-    && apt-get purge -y imagemagick imagemagick-6-common \\\n-    # Install common packages, non-root user, update yarn and install nvm\n-    && bash /tmp/library-scripts/common-debian.sh \"${INSTALL_ZSH}\" \"${USERNAME}\" \"${USER_UID}\" \"${USER_GID}\" \"${UPGRADE_PACKAGES}\" \"true\" \"true\" \\\n-    # Install yarn, nvm\n-    && rm -rf /opt/yarn-* /usr/local/bin/yarn /usr/local/bin/yarnpkg \\\n-    && bash /tmp/library-scripts/node-debian.sh \"${NVM_DIR}\" \"none\" \"${USERNAME}\" \\\n-    # Configure global npm install location, use group to adapt to UID/GID changes\n-    && if ! cat /etc/group | grep -e \"^npm:\" > /dev/null 2>&1; then groupadd -r npm; fi \\\n-    && usermod -a -G npm ${USERNAME} \\\n-    && umask 0002 \\\n-    && mkdir -p ${NPM_GLOBAL} \\\n-    && touch /usr/local/etc/npmrc \\\n-    && chown ${USERNAME}:npm ${NPM_GLOBAL} /usr/local/etc/npmrc \\\n-    && chmod g+s ${NPM_GLOBAL} \\\n-    && npm config -g set prefix ${NPM_GLOBAL} \\\n-    && sudo -u ${USERNAME} npm config -g set prefix ${NPM_GLOBAL} \\\n-    # Install eslint\n-    && su ${USERNAME} -c \"umask 0002 && npm install -g eslint\" \\\n-    && npm cache clean --force > /dev/null 2>&1 \\\n-    # Install python-is-python3 on bullseye to prevent node-gyp regressions\n-    && . /etc/os-release \\\n-    && if [ \"${VERSION_CODENAME}\" = \"bullseye\" ]; then apt-get -y install --no-install-recommends python-is-python3; fi \\\n-    # Clean up\n-    && apt-get autoremove -y && apt-get clean -y && rm -rf /var/lib/apt/lists/* /root/.gnupg /tmp/library-scripts\n-\n-# [Optional] Uncomment this section to install additional OS packages.\n-# RUN apt-get update && export DEBIAN_FRONTEND=noninteractive \\\n-#     && apt-get -y install --no-install-recommends <your-package-list-here>\n-\n-# [Optional] Uncomment if you want to install an additional version of node using nvm\n-# ARG EXTRA_NODE_VERSION=10\n-# RUN su node -c \"source /usr/local/share/nvm/nvm.sh && nvm install ${EXTRA_NODE_VERSION}\"\n-\n-# [Optional] Uncomment if you want to install more global node modules\n-# RUN su node -c \"npm install -g <your-package-list-here>\"\"\n\\ No newline at end of file"
        },
        {
            "sha": "2c3914101a043f57a25aa4d73926797c869d634e",
            "filename": ".devcontainer/devcontainer-lock.json",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fdevcontainer-lock.json",
            "raw_url": "https://github.com/vercel/next.js/raw/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fdevcontainer-lock.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2Fdevcontainer-lock.json?ref=3e750d104f0718c233bb8a003aa716e7f27f052a",
            "patch": "@@ -0,0 +1,19 @@\n+{\n+  \"features\": {\n+    \"ghcr.io/devcontainers/features/git:1\": {\n+      \"version\": \"1.3.4\",\n+      \"resolved\": \"ghcr.io/devcontainers/features/git@sha256:f24645e64ad39a596131a50ec96f7d5cf7a2a87544cce772dd4b7182a233e98a\",\n+      \"integrity\": \"sha256:f24645e64ad39a596131a50ec96f7d5cf7a2a87544cce772dd4b7182a233e98a\"\n+    },\n+    \"ghcr.io/devcontainers/features/github-cli:1\": {\n+      \"version\": \"1.0.14\",\n+      \"resolved\": \"ghcr.io/devcontainers/features/github-cli@sha256:ca677566507c4118e4368cd76a4800807e911e5e350cc3525fb67ebc9132dfa1\",\n+      \"integrity\": \"sha256:ca677566507c4118e4368cd76a4800807e911e5e350cc3525fb67ebc9132dfa1\"\n+    },\n+    \"ghcr.io/devcontainers/features/rust:1\": {\n+      \"version\": \"1.5.0\",\n+      \"resolved\": \"ghcr.io/devcontainers/features/rust@sha256:0c55e65f2e3df736e478f26ee4d5ed41bae6b54dac1318c443e31444c8ed283c\",\n+      \"integrity\": \"sha256:0c55e65f2e3df736e478f26ee4d5ed41bae6b54dac1318c443e31444c8ed283c\"\n+    }\n+  }\n+}"
        },
        {
            "sha": "02f72363aea3c80416fec42a26eef7eb7a9093ba",
            "filename": ".devcontainer/devcontainer.json",
            "status": "modified",
            "additions": 6,
            "deletions": 22,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fdevcontainer.json",
            "raw_url": "https://github.com/vercel/next.js/raw/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fdevcontainer.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2Fdevcontainer.json?ref=3e750d104f0718c233bb8a003aa716e7f27f052a",
            "patch": "@@ -2,35 +2,19 @@\n // https://github.com/microsoft/vscode-dev-containers/tree/v0.245.0/containers/javascript-node\n {\n   \"name\": \"Next.js Dev Container\",\n-  \"build\": {\n-    \"dockerfile\": \"Dockerfile\",\n-    // Update 'VARIANT' to pick a Node version: 18, 16, 14.\n-    // Append -bullseye or -buster to pin to an OS version.\n-    // Use -bullseye variants on local arm64/Apple Silicon.\n-    \"args\": {\n-      \"VARIANT\": \"20-bullseye\"\n-    }\n-  },\n-  // Configure tool-specific properties.\n+  \"image\": \"mcr.microsoft.com/devcontainers/javascript-node:1-20-bookworm\",\n   \"customizations\": {\n-    // Configure properties specific to VS Code.\n     \"vscode\": {\n-      // Add the IDs of extensions you want installed when the container is created.\n       \"extensions\": [\"dbaeumer.vscode-eslint\"]\n     }\n   },\n-  // Use 'forwardPorts' to make a list of ports inside the container available locally.\n-  // \"forwardPorts\": [],\n-  // Use 'postCreateCommand' to run commands after the container is created.\n-  // \"postCreateCommand\": \"yarn install\",\n-  // Comment out to connect as root instead. More info: https://aka.ms/vscode-remote/containers/non-root.\n   \"remoteUser\": \"node\",\n   \"features\": {\n-    // For some reason \"git\" or \"rust\" doesn't work\n-    \"ghcr.io/devcontainers/features/git:1\": \"os-provided\",\n-    \"ghcr.io/devcontainers/features/rust:1\": \"latest\"\n-    // Github latest can't be installed due to GPG issues: https://github.com/cli/cli/discussions/6222\n-    // \"github-cli\": \"latest\",\n+    \"ghcr.io/devcontainers/features/git:1\": {},\n+    \"ghcr.io/devcontainers/features/github-cli:1\": {},\n+    \"./rust\": {},\n+    \"./headless-browser\": {},\n+    \"./node-extras\": {}\n   },\n   \"remoteEnv\": {\n     \"DISPLAY\": \":0\""
        },
        {
            "sha": "725a4fdbecf633abd218b7ff378f69a20d20149c",
            "filename": ".devcontainer/headless-browser/devcontainer-feature.json",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fheadless-browser%2Fdevcontainer-feature.json",
            "raw_url": "https://github.com/vercel/next.js/raw/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fheadless-browser%2Fdevcontainer-feature.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2Fheadless-browser%2Fdevcontainer-feature.json?ref=3e750d104f0718c233bb8a003aa716e7f27f052a",
            "patch": "@@ -0,0 +1,6 @@\n+{\n+  \"id\": \"playwright\",\n+  \"name\": \"next.js-playwright\",\n+  \"version\": \"0.0.0\",\n+  \"dependsOn\": {}\n+}"
        },
        {
            "sha": "2bcc1df3a5a8073bb0243a8d5eca2872cac4c06e",
            "filename": ".devcontainer/headless-browser/install.sh",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fheadless-browser%2Finstall.sh",
            "raw_url": "https://github.com/vercel/next.js/raw/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fheadless-browser%2Finstall.sh",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2Fheadless-browser%2Finstall.sh?ref=3e750d104f0718c233bb8a003aa716e7f27f052a",
            "patch": "@@ -0,0 +1,17 @@\n+#!/bin/bash\n+set -euxo pipefail\n+export DEBIAN_FRONTEND=noninteractive\n+\n+apt-get update\n+# These are required to run playwright properly\n+apt-get -y install --no-install-recommends \\\n+    gconf-service libxext6 libxfixes3 libxi6 libxrandr2 \\\n+    libxrender1 libcairo2 libcups2 libdbus-1-3 libexpat1 \\\n+    libfontconfig1 libgcc1 libgconf-2-4 libgdk-pixbuf2.0-0 \\\n+    libglib2.0-0 libgtk-3-0 libnspr4 libpango-1.0-0 libpangocairo-1.0-0 \\\n+    libstdc++6 libx11-6 libx11-xcb1 libxcb1 libxcomposite1 libxcursor1 \\\n+    libxdamage1 libxss1 libxtst6 libappindicator1 libnss3 libasound2 \\\n+    libatk1.0-0 libc6 libdrm-dev libgbm-dev ca-certificates fonts-liberation lsb-release xdg-utils wget \\\n+\n+# Chromium is needed for Turbopack benchmarks\n+apt-get -y install --no-install-recommends chromium"
        },
        {
            "sha": "631a87962a8a187d3a324f84812f3f31689c680c",
            "filename": ".devcontainer/node-extras/devcontainer-feature.json",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fnode-extras%2Fdevcontainer-feature.json",
            "raw_url": "https://github.com/vercel/next.js/raw/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fnode-extras%2Fdevcontainer-feature.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2Fnode-extras%2Fdevcontainer-feature.json?ref=3e750d104f0718c233bb8a003aa716e7f27f052a",
            "patch": "@@ -0,0 +1,6 @@\n+{\n+  \"id\": \"node-extras\",\n+  \"name\": \"next.js-node-extras\",\n+  \"version\": \"0.0.0\",\n+  \"dependsOn\": {}\n+}"
        },
        {
            "sha": "e93e3ff1c5abf3f6f799114b29eca4fbe4d9c523",
            "filename": ".devcontainer/node-extras/install.sh",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fnode-extras%2Finstall.sh",
            "raw_url": "https://github.com/vercel/next.js/raw/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Fnode-extras%2Finstall.sh",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2Fnode-extras%2Finstall.sh?ref=3e750d104f0718c233bb8a003aa716e7f27f052a",
            "patch": "@@ -0,0 +1,4 @@\n+#!/bin/bash\n+set -euxo pipefail\n+\n+corepack enable pnpm"
        },
        {
            "sha": "55b260ec5f1d801c5ed9b181639cf5be56477a67",
            "filename": ".devcontainer/rust/devcontainer-feature.json",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Frust%2Fdevcontainer-feature.json",
            "raw_url": "https://github.com/vercel/next.js/raw/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Frust%2Fdevcontainer-feature.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2Frust%2Fdevcontainer-feature.json?ref=3e750d104f0718c233bb8a003aa716e7f27f052a",
            "patch": "@@ -0,0 +1,13 @@\n+{\n+  \"id\": \"rust\",\n+  \"name\": \"next.js-rust\",\n+  \"version\": \"0.0.0\",\n+  \"dependsOn\": {\n+    \"ghcr.io/devcontainers/features/rust:1\": {\n+      // this should match the `rust-toolchain.toml`\n+      \"version\": \"nightly-2025-06-04\",\n+      \"profile\": \"minimal\",\n+      \"components\": \"rustfmt,clippy,rust-analyzer\"\n+    }\n+  }\n+}"
        },
        {
            "sha": "89f6e208cc7b9d29e0d6a51191ceb606d19c3b97",
            "filename": ".devcontainer/rust/install.sh",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Frust%2Finstall.sh",
            "raw_url": "https://github.com/vercel/next.js/raw/3e750d104f0718c233bb8a003aa716e7f27f052a/.devcontainer%2Frust%2Finstall.sh",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.devcontainer%2Frust%2Finstall.sh?ref=3e750d104f0718c233bb8a003aa716e7f27f052a",
            "patch": "@@ -0,0 +1,11 @@\n+#!/bin/bash\n+set -euxo pipefail\n+export DEBIAN_FRONTEND=noninteractive\n+\n+curl -L --proto '=https' --tlsv1.2 -sSf \\\n+  https://raw.githubusercontent.com/cargo-bins/cargo-binstall/main/install-from-binstall-release.sh \\\n+  | bash\n+cargo binstall cargo-nextest --secure\n+\n+apt-get update\n+apt-get -y install --no-install-recommends libfontconfig1-dev"
        },
        {
            "sha": "c0534e23dd6e8bf9fc7260e1c029c6ff4de58197",
            "filename": "rust-toolchain.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/3e750d104f0718c233bb8a003aa716e7f27f052a/rust-toolchain.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/3e750d104f0718c233bb8a003aa716e7f27f052a/rust-toolchain.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/rust-toolchain.toml?ref=3e750d104f0718c233bb8a003aa716e7f27f052a",
            "patch": "@@ -1,3 +1,4 @@\n+# if you update this, also update `.devcontainer/rust/devcontainer-feature.json`\n [toolchain]\n channel = \"nightly-2025-06-04\"\n components = [\"rustfmt\", \"clippy\", \"rust-analyzer\"]"
        }
    ],
    "stats": {
        "total": 193,
        "additions": 83,
        "deletions": 110
    }
}