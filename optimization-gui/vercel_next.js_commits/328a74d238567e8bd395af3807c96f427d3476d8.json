{
    "author": "sokra",
    "message": "Turbopack: write tasks doesn't need to be session dependent, as effects will restore (#78727)\n\n### What?\n\nFilesystem write task don't need to be session dependent. We don't need to reexecute them for that reason. We already emit an \"effect\" and that is still emitted after restoring from cache.\n\nNot making them session dependent avoids dirty updates and also tracking the task as dirty in the aggregated graph. \n\nBut the \"effect\" is not-serializeable, so the write task will be recomputed to recompute the value of the effect, when trying to apply the effect.",
    "sha": "328a74d238567e8bd395af3807c96f427d3476d8",
    "files": [
        {
            "sha": "7d58c64af14654ec8dc18ea90a81c150b3865a86",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 2,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/328a74d238567e8bd395af3807c96f427d3476d8/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/328a74d238567e8bd395af3807c96f427d3476d8/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=328a74d238567e8bd395af3807c96f427d3476d8",
            "patch": "@@ -717,7 +717,10 @@ impl FileSystem for DiskFileSystem {\n \n     #[turbo_tasks::function(fs)]\n     async fn write(&self, fs_path: FileSystemPath, content: Vc<FileContent>) -> Result<()> {\n-        mark_session_dependent();\n+        // You might be tempted to use `mark_session_dependent` here, but\n+        // `write` purely declares a side effect and does not need to be reexecuted in the next\n+        // session. All side effects are reexecuted in general.\n+\n         let full_path = self.to_sys_path(fs_path).await?;\n         let content = content.await?;\n         let inner = self.inner.clone();\n@@ -848,7 +851,10 @@ impl FileSystem for DiskFileSystem {\n \n     #[turbo_tasks::function(fs)]\n     async fn write_link(&self, fs_path: FileSystemPath, target: Vc<LinkContent>) -> Result<()> {\n-        mark_session_dependent();\n+        // You might be tempted to use `mark_session_dependent` here, but\n+        // `write_link` purely declares a side effect and does not need to be reexecuted in the next\n+        // session. All side effects are reexecuted in general.\n+\n         let full_path = self.to_sys_path(fs_path).await?;\n         let content = target.await?;\n         let inner = self.inner.clone();"
        }
    ],
    "stats": {
        "total": 10,
        "additions": 8,
        "deletions": 2
    }
}