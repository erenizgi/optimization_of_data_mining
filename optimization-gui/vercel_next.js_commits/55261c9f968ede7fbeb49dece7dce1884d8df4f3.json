{
    "author": "devjiwonchoi",
    "message": "[devtools] fork devtools-indicator (#80456)\n\nUnlike the menu popover (legacy), the panel UI can be decoupled from the\nindicator and communicate with the dispatcher. We don't need those refs,\nanimation, etc. anymore, so removed them as well.\n\nAlso, it feels good to move out of the `errors/` directory as it's no\nlonger confined to the error overlay.",
    "sha": "55261c9f968ede7fbeb49dece7dce1884d8df4f3",
    "files": [
        {
            "sha": "4d957bad50df9221a94728a1ff54a59b922f9b79",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.stories.tsx",
            "status": "added",
            "additions": 69,
            "deletions": 0,
            "changes": 69,
            "blob_url": "https://github.com/vercel/next.js/blob/55261c9f968ede7fbeb49dece7dce1884d8df4f3/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/55261c9f968ede7fbeb49dece7dce1884d8df4f3/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.stories.tsx?ref=55261c9f968ede7fbeb49dece7dce1884d8df4f3",
            "patch": "@@ -0,0 +1,69 @@\n+import type { Meta, StoryObj } from '@storybook/react'\n+import type { OverlayState } from '../../shared'\n+\n+import { DevToolsIndicator } from './devtools-indicator'\n+import { INITIAL_OVERLAY_STATE } from '../../shared'\n+import { withShadowPortal } from '../../storybook/with-shadow-portal'\n+\n+const meta: Meta<typeof DevToolsIndicator> = {\n+  component: DevToolsIndicator,\n+  parameters: {\n+    layout: 'centered',\n+  },\n+  argTypes: {},\n+  decorators: [\n+    withShadowPortal,\n+    // Test for high z-index\n+    (Story) => (\n+      <div\n+        style={{\n+          position: 'fixed',\n+          top: 0,\n+          left: 0,\n+          width: '100%',\n+          height: '100%',\n+          zIndex: 9999,\n+          display: 'flex',\n+          alignItems: 'center',\n+          justifyContent: 'center',\n+          background:\n+            'linear-gradient(135deg, rgba(230,240,255,0.8) 0%, rgba(200,220,255,0.6) 100%)',\n+        }}\n+      >\n+        <Story />\n+      </div>\n+    ),\n+  ],\n+}\n+\n+export default meta\n+type Story = StoryObj<typeof DevToolsIndicator>\n+\n+const state: OverlayState = {\n+  ...INITIAL_OVERLAY_STATE,\n+  routerType: 'app',\n+  isErrorOverlayOpen: false,\n+}\n+\n+export const Default: Story = {\n+  args: {\n+    state,\n+    dispatch: () => {},\n+  },\n+}\n+\n+export const SingleError: Story = {\n+  args: {\n+    errorCount: 1,\n+    state,\n+    dispatch: () => {},\n+  },\n+}\n+\n+export const MultipleErrors: Story = {\n+  args: {\n+    errorCount: 3,\n+    state,\n+    dispatch: () => {},\n+  },\n+}"
        },
        {
            "sha": "a6932f7ab1dc3ef3d8e16daf1ee3dee5529bce6f",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.tsx",
            "status": "added",
            "additions": 87,
            "deletions": 0,
            "changes": 87,
            "blob_url": "https://github.com/vercel/next.js/blob/55261c9f968ede7fbeb49dece7dce1884d8df4f3/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/55261c9f968ede7fbeb49dece7dce1884d8df4f3/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx?ref=55261c9f968ede7fbeb49dece7dce1884d8df4f3",
            "patch": "@@ -0,0 +1,87 @@\n+import type { CSSProperties } from 'react'\n+import type { OverlayState, OverlayDispatch } from '../../shared'\n+import type { DevToolsScale } from '../errors/dev-tools-indicator/dev-tools-info/preferences'\n+\n+import { useState, useRef } from 'react'\n+import { Toast } from '../toast'\n+import { NextLogo } from '../errors/dev-tools-indicator/next-logo'\n+import {\n+  MENU_CURVE,\n+  MENU_DURATION_MS,\n+} from '../errors/dev-tools-indicator/utils'\n+import { ACTION_ERROR_OVERLAY_TOGGLE, STORAGE_KEY_POSITION } from '../../shared'\n+import { getInitialPosition } from '../errors/dev-tools-indicator/dev-tools-info/preferences'\n+import { Draggable } from '../errors/dev-tools-indicator/draggable'\n+\n+const INDICATOR_PADDING = 20\n+\n+export function DevToolsIndicator({\n+  state,\n+  dispatch,\n+  errorCount,\n+  isBuildError,\n+  scale,\n+}: {\n+  state: OverlayState\n+  dispatch: OverlayDispatch\n+  errorCount: number\n+  isBuildError: boolean\n+  scale: DevToolsScale\n+}) {\n+  const [open, setOpen] = useState(false)\n+  const [position, setPosition] = useState(getInitialPosition())\n+\n+  const triggerRef = useRef<HTMLButtonElement | null>(null)\n+\n+  const [vertical, horizontal] = position.split('-', 2)\n+\n+  const toggleErrorOverlay = () => {\n+    dispatch({ type: ACTION_ERROR_OVERLAY_TOGGLE })\n+  }\n+\n+  const onTriggerClick = () => {}\n+\n+  return (\n+    <Toast\n+      data-nextjs-toast\n+      style={\n+        {\n+          '--animate-out-duration-ms': `${MENU_DURATION_MS}ms`,\n+          '--animate-out-timing-function': MENU_CURVE,\n+          boxShadow: 'none',\n+          zIndex: 2147483647,\n+          [vertical]: `${INDICATOR_PADDING}px`,\n+          [horizontal]: `${INDICATOR_PADDING}px`,\n+        } as CSSProperties\n+      }\n+    >\n+      <Draggable\n+        padding={INDICATOR_PADDING}\n+        onDragStart={() => setOpen(false)}\n+        position={position}\n+        setPosition={(p) => {\n+          localStorage.setItem(STORAGE_KEY_POSITION, p)\n+          setPosition(p)\n+        }}\n+      >\n+        {/* Trigger */}\n+        <NextLogo\n+          ref={triggerRef}\n+          aria-haspopup=\"menu\"\n+          aria-expanded={open}\n+          aria-controls=\"nextjs-dev-tools-menu\"\n+          aria-label={`${open ? 'Close' : 'Open'} Next.js Dev Tools`}\n+          data-nextjs-dev-tools-button\n+          disabled={state.disableDevIndicator}\n+          issueCount={errorCount}\n+          onTriggerClick={onTriggerClick}\n+          toggleErrorOverlay={toggleErrorOverlay}\n+          isDevBuilding={state.buildingIndicator}\n+          isDevRendering={state.renderingIndicator}\n+          isBuildError={isBuildError}\n+          scale={scale}\n+        />\n+      </Draggable>\n+    </Toast>\n+  )\n+}"
        },
        {
            "sha": "d25cb65fd79ab106321c90f5f7c119818da0ff54",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.tsx",
            "status": "modified",
            "additions": 20,
            "deletions": 10,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/55261c9f968ede7fbeb49dece7dce1884d8df4f3/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/55261c9f968ede7fbeb49dece7dce1884d8df4f3/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx?ref=55261c9f968ede7fbeb49dece7dce1884d8df4f3",
            "patch": "@@ -11,6 +11,7 @@ import { RenderError } from './container/runtime-error/render-error'\n import { DarkTheme } from './styles/dark-theme'\n import { useDevToolsScale } from './components/errors/dev-tools-indicator/dev-tools-info/preferences'\n import type { HydrationErrorState } from '../shared/hydration-error'\n+import { DevToolsIndicator as DevToolsIndicatorNew } from './components/devtools-indicator/devtools-indicator'\n \n export function DevOverlay({\n   state,\n@@ -35,16 +36,25 @@ export function DevOverlay({\n           const isBuildError = state.buildError !== null\n           return (\n             <>\n-              {state.showIndicator && (\n-                <DevToolsIndicator\n-                  scale={scale}\n-                  setScale={setScale}\n-                  state={state}\n-                  dispatch={dispatch}\n-                  errorCount={totalErrorCount}\n-                  isBuildError={isBuildError}\n-                />\n-              )}\n+              {state.showIndicator &&\n+                (process.env.__NEXT_DEVTOOL_NEW_PANEL_UI ? (\n+                  <DevToolsIndicatorNew\n+                    scale={scale}\n+                    state={state}\n+                    dispatch={dispatch}\n+                    errorCount={totalErrorCount}\n+                    isBuildError={isBuildError}\n+                  />\n+                ) : (\n+                  <DevToolsIndicator\n+                    scale={scale}\n+                    setScale={setScale}\n+                    state={state}\n+                    dispatch={dispatch}\n+                    errorCount={totalErrorCount}\n+                    isBuildError={isBuildError}\n+                  />\n+                ))}\n \n               <ErrorOverlay\n                 state={state}"
        }
    ],
    "stats": {
        "total": 186,
        "additions": 176,
        "deletions": 10
    }
}