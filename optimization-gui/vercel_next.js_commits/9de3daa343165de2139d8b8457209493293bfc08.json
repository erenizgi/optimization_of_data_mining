{
    "author": "bgub",
    "message": "fix: remove `satisfies` keyword from type validation to preserve old TS compatibility (#83239)",
    "sha": "9de3daa343165de2139d8b8457209493293bfc08",
    "files": [
        {
            "sha": "a2bb64379743e11f4f5275f20604153a29e8093c",
            "filename": "packages/next/src/server/lib/router-utils/typegen.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/9de3daa343165de2139d8b8457209493293bfc08/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9de3daa343165de2139d8b8457209493293bfc08/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts?ref=9de3daa343165de2139d8b8457209493293bfc08",
            "patch": "@@ -446,12 +446,19 @@ export function generateValidatorFile(\n             type === 'RouteHandlerConfig')\n             ? `${type}<${JSON.stringify(route)}>`\n             : type\n+\n+        // NOTE: we previously used `satisfies` here, but it's not supported by TypeScript 4.8 and below.\n+        // If we ever raise the TS minimum version, we can switch back.\n+\n         return `// Validate ${filePath}\n {\n+  type __IsExpected<Specific extends ${typeWithRoute}> = Specific\n   const handler = {} as typeof import(${JSON.stringify(\n     importPath.replace(/\\.tsx?$/, '.js')\n   )})\n-  handler satisfies ${typeWithRoute}\n+  type __Check = __IsExpected<typeof handler>\n+  // @ts-ignore\n+  type __Unused = __Check\n }`\n       })\n       .join('\\n\\n')"
        },
        {
            "sha": "01a00d8f032c2e3a68d4cc5765baba7d9e0ce6eb",
            "filename": "test/e2e/app-dir/typed-routes-validator/typed-routes-validator.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/9de3daa343165de2139d8b8457209493293bfc08/test%2Fe2e%2Fapp-dir%2Ftyped-routes-validator%2Ftyped-routes-validator.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9de3daa343165de2139d8b8457209493293bfc08/test%2Fe2e%2Fapp-dir%2Ftyped-routes-validator%2Ftyped-routes-validator.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes-validator%2Ftyped-routes-validator.test.ts?ref=9de3daa343165de2139d8b8457209493293bfc08",
            "patch": "@@ -13,7 +13,7 @@ describe('typed-routes-validator', () => {\n   it('should generate route validation correctly', async () => {\n     const dts = await next.readFile('.next/types/validator.ts')\n     // sanity check that dev generation is working\n-    expect(dts).toContain('handler satisfies AppPageConfig')\n+    expect(dts).toContain('const handler = {} as typeof import(')\n   })\n \n   if (isNextStart) {\n@@ -51,7 +51,7 @@ describe('typed-routes-validator', () => {\n \n       expect(exitCode).toBe(1)\n       expect(cliOutput).toMatch(\n-        /Type error: Type 'typeof import\\(.*\\)' does not satisfy the expected type 'AppPageConfig<\"\\/invalid\">'/\n+        /Type error: Type 'typeof import\\(.*' does not satisfy the constraint 'AppPageConfig</\n       )\n     })\n \n@@ -111,7 +111,7 @@ describe('typed-routes-validator', () => {\n \n       expect(exitCode).toBe(1)\n       expect(cliOutput).toMatch(\n-        /Type error: Type 'typeof import.*does not satisfy the expected type 'RouteHandlerConfig<\"\\/invalid\">'/\n+        /Type error: Type 'typeof import\\(.*' does not satisfy the constraint 'RouteHandlerConfig</\n       )\n     })\n \n@@ -132,7 +132,9 @@ describe('typed-routes-validator', () => {\n       await next.deleteFile('app/invalid-2/route.ts')\n \n       expect(exitCode).toBe(1)\n-      expect(cliOutput).toContain(`Types of property 'POST' are incompatible.`)\n+      expect(cliOutput).toMatch(\n+        /Type error: Type 'typeof import\\(.*' does not satisfy the constraint 'RouteHandlerConfig</\n+      )\n     })\n \n     it('should pass type checking with valid layout exports', async () => {\n@@ -174,7 +176,7 @@ describe('typed-routes-validator', () => {\n \n       expect(exitCode).toBe(1)\n       expect(cliOutput).toMatch(\n-        /Type error: Type 'typeof import\\(.*does not satisfy the expected type 'LayoutConfig<\"\\/invalid\">'/\n+        /Type error: Type 'typeof import\\(.*' does not satisfy the constraint 'LayoutConfig</\n       )\n     })\n \n@@ -220,7 +222,7 @@ describe('typed-routes-validator', () => {\n \n       expect(exitCode).toBe(1)\n       expect(cliOutput).toMatch(\n-        /Type error: Type 'typeof import\\(.*does not satisfy the expected type 'ApiRouteConfig'/\n+        /Type error: Type 'typeof import\\(.*' does not satisfy the constraint 'ApiRouteConfig'/\n       )\n     })\n   }"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 16,
        "deletions": 7
    }
}