{
    "author": "RobPruzan",
    "message": "feat: forward browser errors/logs to terminal (#80909)\n\nCloses NEXT-4534\n\nThis PR introduces the ability for next.js to forward logs, errors, and\nunhandled rejections from the browser to the terminal the dev server is\nrunning in (behind an experimental flag)\n\n# Explanation\n\nThe 2 main components of this pr are the client side error accumulation\nlogic, and the ingest handling on the other side of the hmr socket.\n\nWe listen on the existing hmr socket to send batched logs, errors, and\nuncaught rejections the frame after they were captured. All forwarded\ndata is sent with metadata so we can have reconstruct the log with an\nequivalent level of information to the browser- since we expect AI\nagents that can't access the browsers to be consumers of this feature\n(and it's generally useful).\n\nAll foreign data created by the user in the browser is serialized using\n`safe-stable-serializer`, a popular serializer [used by other logging\nlibraries](https://www.npmjs.com/browse/depended/safe-stable-stringify),\nlike\n[pino](https://github.com/search?q=repo%3Apinojs%2Fpino+safe-stable&type=code)\n(safety, determinism, fast). We also have a light shim on top of json\nserialization to handle displaying custom data representations that\neither wouldn't survive serialization (undefined) or we want to present\nto users in a custom format (throwing proxies, promises, ...)\n\nOn the dev server server, we (bespoke) deserialize, source map, format,\nand log. I tried to share as much logic as I could with error dev\noverlay to avoid feature drift since they are very similar\nimplementations other than the render target\n\n\n# Explicitly covered cases\n\n- console table\n  - shows as `[browser]\\n<table>\\n(<source location>)`\n- console trace\n- shows as `[browser] arg1 arg2 ...\\n<stack trace>\\n([source mapped\nlocation of log]`)`\n  - trace is source mapped\n- ignored frames are shown, incase people explicitly want the full trace\n- console dir\n  - shows as `[browser] arg1 arg2 ([source mapped location of log])`\n- we need to explicitly capture stdout and rewrite it when we call nodes\n`console.dir` to prefix and postfix with [browser] and and (`<source\nmapped location of log>`) without adding newlines (we could do this for\nconsole.table but it makes sense to keep the prefix and postfix on new\nlines)\n\n- console error\n- `[browser] arg1 arg2 \\n codeblock + source mapped stack of\nconsole.error ([source mapped location of console.error])`\n- if there are any `Error` values present we wont show the stack and\ncode block of console.error since it's overwhelming (this is fine since\nwe still tell the user where the `console.error` is with the appended\nlocation)\n- rejected promises that have `Error`'s\n- behave identical to console.error, but is prepended with `тип\nunhandledRejection`\n\t- the `Error`'s render with their source mapped stack + ignored frames\n- no error stack can be automatically appended where the promise\nrejected\n- rejected promises that have non `Error` values\n- prepended with `тип unhandledRejection: ${error.name}: ${error.message}`\n\t- everything is logged in red\n- no error stack can be automatically appended where the promise\nrejected\n- on caught error\n\t- prepended with `Uncaught ${errorName}: ${errorMessage}`\n- stack attached to error is source mapped + ignored frames are not\nshown\n- everything is logged in red but the code block of where the error\norginated from\n- all other console cases\n  - shows as `[browser] arg1 arg2 ([source mapped location of log])`\n- if an error is passed, we show the error name, message, source mapped\nstack (colored white, ignored frames not shown), and code block if\navailable (syntax highlighted)\n  - we apply util.format to handle formatted strings\n- logs captured during RSC rendering\n  - not piped to server, ignored on client\n\n\nCloses NEXT-4534",
    "sha": "94f8aecf2622d778b097780eec0992104f709528",
    "files": [
        {
            "sha": "993b7e9d7e6bceb5e1e1f2da634ba6b576b82c68",
            "filename": "packages/next/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fpackage.json?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -309,6 +309,7 @@\n     \"react-refresh\": \"0.12.0\",\n     \"recast\": \"0.23.11\",\n     \"regenerator-runtime\": \"0.13.4\",\n+    \"safe-stable-stringify\": \"2.5.0\",\n     \"sass-loader\": \"15.0.0\",\n     \"schema-utils2\": \"npm:schema-utils@2.7.1\",\n     \"schema-utils3\": \"npm:schema-utils@3.0.0\","
        },
        {
            "sha": "651adc14c96265f3c8ca0fba610dead73e30cb25",
            "filename": "packages/next/src/build/define-env.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fdefine-env.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -321,6 +321,10 @@ export function getDefineEnv({\n       isDevToolPanelUIEnabled || !!config.experimental.devtoolSegmentExplorer,\n     'process.env.__NEXT_DEVTOOL_NEW_PANEL_UI': isDevToolPanelUIEnabled,\n \n+    'process.env.__NEXT_BROWSER_DEBUG_INFO_IN_TERMINAL': JSON.stringify(\n+      config.experimental.browserDebugInfoInTerminal || false\n+    ),\n+\n     // The devtools need to know whether or not to show an option to clear the\n     // bundler cache. This option may be removed later once Turbopack's\n     // persistent cache feature is more stable."
        },
        {
            "sha": "bb5b3fe0618df64b4fc2d10ac05dca88a3994f8c",
            "filename": "packages/next/src/client/dev/hot-reloader/app/hot-reloader-app.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -31,6 +31,7 @@ import reportHmrLatency from '../../report-hmr-latency'\n import { TurbopackHmr } from '../turbopack-hot-reloader-common'\n import { NEXT_HMR_REFRESH_HASH_COOKIE } from '../../../components/app-router-headers'\n import type { GlobalErrorState } from '../../../components/app-router-instance'\n+import { useForwardConsoleLog } from '../../../../next-devtools/userspace/app/errors/use-forward-console-log'\n \n let mostRecentCompilationHash: any = null\n let __nextDevClientId = Math.round(Math.random() * 100 + Date.now())\n@@ -456,8 +457,10 @@ export default function HotReload({\n   useErrorHandler(dispatcher.onUnhandledError, dispatcher.onUnhandledRejection)\n \n   const webSocketRef = useWebsocket(assetPrefix)\n+\n   useWebsocketPing(webSocketRef)\n   const sendMessage = useSendMessage(webSocketRef)\n+  useForwardConsoleLog(webSocketRef)\n   const processTurbopackMessage = useTurbopack(sendMessage, (err) =>\n     performFullReload(err, sendMessage)\n   )\n@@ -533,7 +536,6 @@ export default function HotReload({\n     processTurbopackMessage,\n     appIsrManifestRef,\n   ])\n-\n   return (\n     <AppDevOverlayErrorBoundary globalError={globalError}>\n       <ReplaySsrOnlyErrors onBlockingError={dispatcher.openErrorOverlay} />"
        },
        {
            "sha": "1fbd0a4c1cebbbf1cfa912a299f7658c76c0c08d",
            "filename": "packages/next/src/client/dev/hot-reloader/pages/websocket.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fwebsocket.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fwebsocket.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fwebsocket.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -1,3 +1,7 @@\n+import {\n+  isTerminalLoggingEnabled,\n+  logQueue,\n+} from '../../../../next-devtools/userspace/app/forward-logs'\n import {\n   HMR_ACTIONS_SENT_TO_BROWSER,\n   type HMR_ACTION_TYPES,\n@@ -28,6 +32,9 @@ export function connectHMR(options: { path: string; assetPrefix: string }) {\n     if (source) source.close()\n \n     function handleOnline() {\n+      if (isTerminalLoggingEnabled) {\n+        logQueue.onSocketReady(source)\n+      }\n       reconnections = 0\n       window.console.log('[HMR] connected')\n     }"
        },
        {
            "sha": "99c65e2c7d52714c3d43be93e684f1bbc9d13ac2",
            "filename": "packages/next/src/compiled/safe-stable-stringify/LICENSE",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fcompiled%2Fsafe-stable-stringify%2FLICENSE",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fcompiled%2Fsafe-stable-stringify%2FLICENSE",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcompiled%2Fsafe-stable-stringify%2FLICENSE?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,21 @@\n+The MIT License (MIT)\n+\n+Copyright (c) Ruben Bridgewater\n+\n+Permission is hereby granted, free of charge, to any person obtaining a copy\n+of this software and associated documentation files (the \"Software\"), to deal\n+in the Software without restriction, including without limitation the rights\n+to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n+copies of the Software, and to permit persons to whom the Software is\n+furnished to do so, subject to the following conditions:\n+\n+The above copyright notice and this permission notice shall be included in all\n+copies or substantial portions of the Software.\n+\n+THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n+IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n+FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n+AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n+LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n+OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n+SOFTWARE."
        },
        {
            "sha": "1bdd42c4ca4a19693d639aeaadc1dbf8ef26fcde",
            "filename": "packages/next/src/compiled/safe-stable-stringify/index.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fcompiled%2Fsafe-stable-stringify%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fcompiled%2Fsafe-stable-stringify%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcompiled%2Fsafe-stable-stringify%2Findex.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1 @@\n+(function(){\"use strict\";var e={879:function(e,t){const{hasOwnProperty:n}=Object.prototype;const r=configure();r.configure=configure;r.stringify=r;r.default=r;t.stringify=r;t.configure=configure;e.exports=r;const i=/[\\u0000-\\u001f\\u0022\\u005c\\ud800-\\udfff]/;function strEscape(e){if(e.length<5e3&&!i.test(e)){return`\"${e}\"`}return JSON.stringify(e)}function sort(e,t){if(e.length>200||t){return e.sort(t)}for(let t=1;t<e.length;t++){const n=e[t];let r=t;while(r!==0&&e[r-1]>n){e[r]=e[r-1];r--}e[r]=n}return e}const f=Object.getOwnPropertyDescriptor(Object.getPrototypeOf(Object.getPrototypeOf(new Int8Array)),Symbol.toStringTag).get;function isTypedArrayWithEntries(e){return f.call(e)!==undefined&&e.length!==0}function stringifyTypedArray(e,t,n){if(e.length<n){n=e.length}const r=t===\",\"?\"\":\" \";let i=`\"0\":${r}${e[0]}`;for(let f=1;f<n;f++){i+=`${t}\"${f}\":${r}${e[f]}`}return i}function getCircularValueOption(e){if(n.call(e,\"circularValue\")){const t=e.circularValue;if(typeof t===\"string\"){return`\"${t}\"`}if(t==null){return t}if(t===Error||t===TypeError){return{toString(){throw new TypeError(\"Converting circular structure to JSON\")}}}throw new TypeError('The \"circularValue\" argument must be of type string or the value null or undefined')}return'\"[Circular]\"'}function getDeterministicOption(e){let t;if(n.call(e,\"deterministic\")){t=e.deterministic;if(typeof t!==\"boolean\"&&typeof t!==\"function\"){throw new TypeError('The \"deterministic\" argument must be of type boolean or comparator function')}}return t===undefined?true:t}function getBooleanOption(e,t){let r;if(n.call(e,t)){r=e[t];if(typeof r!==\"boolean\"){throw new TypeError(`The \"${t}\" argument must be of type boolean`)}}return r===undefined?true:r}function getPositiveIntegerOption(e,t){let r;if(n.call(e,t)){r=e[t];if(typeof r!==\"number\"){throw new TypeError(`The \"${t}\" argument must be of type number`)}if(!Number.isInteger(r)){throw new TypeError(`The \"${t}\" argument must be an integer`)}if(r<1){throw new RangeError(`The \"${t}\" argument must be >= 1`)}}return r===undefined?Infinity:r}function getItemCount(e){if(e===1){return\"1 item\"}return`${e} items`}function getUniqueReplacerSet(e){const t=new Set;for(const n of e){if(typeof n===\"string\"||typeof n===\"number\"){t.add(String(n))}}return t}function getStrictOption(e){if(n.call(e,\"strict\")){const t=e.strict;if(typeof t!==\"boolean\"){throw new TypeError('The \"strict\" argument must be of type boolean')}if(t){return e=>{let t=`Object can not safely be stringified. Received type ${typeof e}`;if(typeof e!==\"function\")t+=` (${e.toString()})`;throw new Error(t)}}}}function configure(e){e={...e};const t=getStrictOption(e);if(t){if(e.bigint===undefined){e.bigint=false}if(!(\"circularValue\"in e)){e.circularValue=Error}}const n=getCircularValueOption(e);const r=getBooleanOption(e,\"bigint\");const i=getDeterministicOption(e);const f=typeof i===\"function\"?i:undefined;const u=getPositiveIntegerOption(e,\"maximumDepth\");const o=getPositiveIntegerOption(e,\"maximumBreadth\");function stringifyFnReplacer(e,s,l,c,a,g){let p=s[e];if(typeof p===\"object\"&&p!==null&&typeof p.toJSON===\"function\"){p=p.toJSON(e)}p=c.call(s,e,p);switch(typeof p){case\"string\":return strEscape(p);case\"object\":{if(p===null){return\"null\"}if(l.indexOf(p)!==-1){return n}let e=\"\";let t=\",\";const r=g;if(Array.isArray(p)){if(p.length===0){return\"[]\"}if(u<l.length+1){return'\"[Array]\"'}l.push(p);if(a!==\"\"){g+=a;e+=`\\n${g}`;t=`,\\n${g}`}const n=Math.min(p.length,o);let i=0;for(;i<n-1;i++){const n=stringifyFnReplacer(String(i),p,l,c,a,g);e+=n!==undefined?n:\"null\";e+=t}const f=stringifyFnReplacer(String(i),p,l,c,a,g);e+=f!==undefined?f:\"null\";if(p.length-1>o){const n=p.length-o-1;e+=`${t}\"... ${getItemCount(n)} not stringified\"`}if(a!==\"\"){e+=`\\n${r}`}l.pop();return`[${e}]`}let s=Object.keys(p);const y=s.length;if(y===0){return\"{}\"}if(u<l.length+1){return'\"[Object]\"'}let d=\"\";let h=\"\";if(a!==\"\"){g+=a;t=`,\\n${g}`;d=\" \"}const $=Math.min(y,o);if(i&&!isTypedArrayWithEntries(p)){s=sort(s,f)}l.push(p);for(let n=0;n<$;n++){const r=s[n];const i=stringifyFnReplacer(r,p,l,c,a,g);if(i!==undefined){e+=`${h}${strEscape(r)}:${d}${i}`;h=t}}if(y>o){const n=y-o;e+=`${h}\"...\":${d}\"${getItemCount(n)} not stringified\"`;h=t}if(a!==\"\"&&h.length>1){e=`\\n${g}${e}\\n${r}`}l.pop();return`{${e}}`}case\"number\":return isFinite(p)?String(p):t?t(p):\"null\";case\"boolean\":return p===true?\"true\":\"false\";case\"undefined\":return undefined;case\"bigint\":if(r){return String(p)}default:return t?t(p):undefined}}function stringifyArrayReplacer(e,i,f,s,l,c){if(typeof i===\"object\"&&i!==null&&typeof i.toJSON===\"function\"){i=i.toJSON(e)}switch(typeof i){case\"string\":return strEscape(i);case\"object\":{if(i===null){return\"null\"}if(f.indexOf(i)!==-1){return n}const e=c;let t=\"\";let r=\",\";if(Array.isArray(i)){if(i.length===0){return\"[]\"}if(u<f.length+1){return'\"[Array]\"'}f.push(i);if(l!==\"\"){c+=l;t+=`\\n${c}`;r=`,\\n${c}`}const n=Math.min(i.length,o);let a=0;for(;a<n-1;a++){const e=stringifyArrayReplacer(String(a),i[a],f,s,l,c);t+=e!==undefined?e:\"null\";t+=r}const g=stringifyArrayReplacer(String(a),i[a],f,s,l,c);t+=g!==undefined?g:\"null\";if(i.length-1>o){const e=i.length-o-1;t+=`${r}\"... ${getItemCount(e)} not stringified\"`}if(l!==\"\"){t+=`\\n${e}`}f.pop();return`[${t}]`}f.push(i);let a=\"\";if(l!==\"\"){c+=l;r=`,\\n${c}`;a=\" \"}let g=\"\";for(const e of s){const n=stringifyArrayReplacer(e,i[e],f,s,l,c);if(n!==undefined){t+=`${g}${strEscape(e)}:${a}${n}`;g=r}}if(l!==\"\"&&g.length>1){t=`\\n${c}${t}\\n${e}`}f.pop();return`{${t}}`}case\"number\":return isFinite(i)?String(i):t?t(i):\"null\";case\"boolean\":return i===true?\"true\":\"false\";case\"undefined\":return undefined;case\"bigint\":if(r){return String(i)}default:return t?t(i):undefined}}function stringifyIndent(e,s,l,c,a){switch(typeof s){case\"string\":return strEscape(s);case\"object\":{if(s===null){return\"null\"}if(typeof s.toJSON===\"function\"){s=s.toJSON(e);if(typeof s!==\"object\"){return stringifyIndent(e,s,l,c,a)}if(s===null){return\"null\"}}if(l.indexOf(s)!==-1){return n}const t=a;if(Array.isArray(s)){if(s.length===0){return\"[]\"}if(u<l.length+1){return'\"[Array]\"'}l.push(s);a+=c;let e=`\\n${a}`;const n=`,\\n${a}`;const r=Math.min(s.length,o);let i=0;for(;i<r-1;i++){const t=stringifyIndent(String(i),s[i],l,c,a);e+=t!==undefined?t:\"null\";e+=n}const f=stringifyIndent(String(i),s[i],l,c,a);e+=f!==undefined?f:\"null\";if(s.length-1>o){const t=s.length-o-1;e+=`${n}\"... ${getItemCount(t)} not stringified\"`}e+=`\\n${t}`;l.pop();return`[${e}]`}let r=Object.keys(s);const g=r.length;if(g===0){return\"{}\"}if(u<l.length+1){return'\"[Object]\"'}a+=c;const p=`,\\n${a}`;let y=\"\";let d=\"\";let h=Math.min(g,o);if(isTypedArrayWithEntries(s)){y+=stringifyTypedArray(s,p,o);r=r.slice(s.length);h-=s.length;d=p}if(i){r=sort(r,f)}l.push(s);for(let e=0;e<h;e++){const t=r[e];const n=stringifyIndent(t,s[t],l,c,a);if(n!==undefined){y+=`${d}${strEscape(t)}: ${n}`;d=p}}if(g>o){const e=g-o;y+=`${d}\"...\": \"${getItemCount(e)} not stringified\"`;d=p}if(d!==\"\"){y=`\\n${a}${y}\\n${t}`}l.pop();return`{${y}}`}case\"number\":return isFinite(s)?String(s):t?t(s):\"null\";case\"boolean\":return s===true?\"true\":\"false\";case\"undefined\":return undefined;case\"bigint\":if(r){return String(s)}default:return t?t(s):undefined}}function stringifySimple(e,s,l){switch(typeof s){case\"string\":return strEscape(s);case\"object\":{if(s===null){return\"null\"}if(typeof s.toJSON===\"function\"){s=s.toJSON(e);if(typeof s!==\"object\"){return stringifySimple(e,s,l)}if(s===null){return\"null\"}}if(l.indexOf(s)!==-1){return n}let t=\"\";const r=s.length!==undefined;if(r&&Array.isArray(s)){if(s.length===0){return\"[]\"}if(u<l.length+1){return'\"[Array]\"'}l.push(s);const e=Math.min(s.length,o);let n=0;for(;n<e-1;n++){const e=stringifySimple(String(n),s[n],l);t+=e!==undefined?e:\"null\";t+=\",\"}const r=stringifySimple(String(n),s[n],l);t+=r!==undefined?r:\"null\";if(s.length-1>o){const e=s.length-o-1;t+=`,\"... ${getItemCount(e)} not stringified\"`}l.pop();return`[${t}]`}let c=Object.keys(s);const a=c.length;if(a===0){return\"{}\"}if(u<l.length+1){return'\"[Object]\"'}let g=\"\";let p=Math.min(a,o);if(r&&isTypedArrayWithEntries(s)){t+=stringifyTypedArray(s,\",\",o);c=c.slice(s.length);p-=s.length;g=\",\"}if(i){c=sort(c,f)}l.push(s);for(let e=0;e<p;e++){const n=c[e];const r=stringifySimple(n,s[n],l);if(r!==undefined){t+=`${g}${strEscape(n)}:${r}`;g=\",\"}}if(a>o){const e=a-o;t+=`${g}\"...\":\"${getItemCount(e)} not stringified\"`}l.pop();return`{${t}}`}case\"number\":return isFinite(s)?String(s):t?t(s):\"null\";case\"boolean\":return s===true?\"true\":\"false\";case\"undefined\":return undefined;case\"bigint\":if(r){return String(s)}default:return t?t(s):undefined}}function stringify(e,t,n){if(arguments.length>1){let r=\"\";if(typeof n===\"number\"){r=\" \".repeat(Math.min(n,10))}else if(typeof n===\"string\"){r=n.slice(0,10)}if(t!=null){if(typeof t===\"function\"){return stringifyFnReplacer(\"\",{\"\":e},[],t,r,\"\")}if(Array.isArray(t)){return stringifyArrayReplacer(\"\",e,[],getUniqueReplacerSet(t),r,\"\")}}if(r.length!==0){return stringifyIndent(\"\",e,[],r,\"\")}}return stringifySimple(\"\",e,[])}return stringify}}};var t={};function __nccwpck_require__(n){var r=t[n];if(r!==undefined){return r.exports}var i=t[n]={exports:{}};var f=true;try{e[n](i,i.exports,__nccwpck_require__);f=false}finally{if(f)delete t[n]}return i.exports}if(typeof __nccwpck_require__!==\"undefined\")__nccwpck_require__.ab=__dirname+\"/\";var n=__nccwpck_require__(879);module.exports=n})();\n\\ No newline at end of file"
        },
        {
            "sha": "ea5b015f6610c57fe9ad33b7a6e9191198b3e28d",
            "filename": "packages/next/src/compiled/safe-stable-stringify/package.json",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fcompiled%2Fsafe-stable-stringify%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fcompiled%2Fsafe-stable-stringify%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcompiled%2Fsafe-stable-stringify%2Fpackage.json?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1 @@\n+{\"name\":\"safe-stable-stringify\",\"main\":\"index.js\",\"author\":\"Ruben Bridgewater\",\"license\":\"MIT\"}"
        },
        {
            "sha": "c4acf9b0601fdc6bc255f162bdc0e9864f5eeff5",
            "filename": "packages/next/src/next-devtools/shared/forward-logs-shared.ts",
            "status": "added",
            "additions": 114,
            "deletions": 0,
            "changes": 114,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fshared%2Fforward-logs-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fshared%2Fforward-logs-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fshared%2Fforward-logs-shared.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,114 @@\n+export type LogMethod =\n+  | 'log'\n+  | 'info'\n+  | 'debug'\n+  | 'table'\n+  | 'error'\n+  | 'assert'\n+  | 'dir'\n+  | 'dirxml'\n+  | 'group'\n+  | 'groupCollapsed'\n+  | 'groupEnd'\n+  | 'trace'\n+  | 'warn'\n+\n+export type ConsoleEntry<T> = {\n+  kind: 'console'\n+  method: LogMethod\n+  consoleMethodStack: string | null\n+  args: Array<\n+    | {\n+        kind: 'arg'\n+        data: T\n+      }\n+    | {\n+        kind: 'formatted-error-arg'\n+        prefix: string\n+        stack: string\n+      }\n+  >\n+}\n+\n+export type ConsoleErrorEntry<T> = {\n+  kind: 'any-logged-error'\n+  method: 'error'\n+  consoleErrorStack: string\n+  args: Array<\n+    | {\n+        kind: 'arg'\n+        data: T\n+        isRejectionMessage?: boolean\n+      }\n+    | {\n+        kind: 'formatted-error-arg'\n+        prefix: string\n+        stack: string | null\n+      }\n+  >\n+}\n+\n+export type FormattedErrorEntry = {\n+  kind: 'formatted-error'\n+  prefix: string\n+  stack: string\n+  method: 'error'\n+}\n+\n+export type ClientLogEntry =\n+  | ConsoleEntry<unknown>\n+  | ConsoleErrorEntry<unknown>\n+  | FormattedErrorEntry\n+export type ServerLogEntry =\n+  | ConsoleEntry<string>\n+  | ConsoleErrorEntry<string>\n+  | FormattedErrorEntry\n+\n+export const UNDEFINED_MARKER = '__next_tagged_undefined'\n+\n+// Based on https://github.com/facebook/react/blob/28dc0776be2e1370fe217549d32aee2519f0cf05/packages/react-server/src/ReactFlightServer.js#L248\n+export function patchConsoleMethod<T extends keyof Console>(\n+  methodName: T,\n+  wrapper: (\n+    methodName: T,\n+    ...args: Console[T] extends (...args: infer P) => any ? P : never[]\n+  ) => void\n+): () => void {\n+  const descriptor = Object.getOwnPropertyDescriptor(console, methodName)\n+  if (\n+    descriptor &&\n+    (descriptor.configurable || descriptor.writable) &&\n+    typeof descriptor.value === 'function'\n+  ) {\n+    const originalMethod = descriptor.value as Console[T] extends (\n+      ...args: any[]\n+    ) => any\n+      ? Console[T]\n+      : never\n+    const originalName = Object.getOwnPropertyDescriptor(originalMethod, 'name')\n+    const wrapperMethod = function (\n+      this: typeof console,\n+      ...args: Console[T] extends (...args: infer P) => any ? P : never[]\n+    ) {\n+      wrapper(methodName, ...args)\n+\n+      originalMethod.apply(this, args)\n+    }\n+    if (originalName) {\n+      Object.defineProperty(wrapperMethod, 'name', originalName)\n+    }\n+    Object.defineProperty(console, methodName, {\n+      value: wrapperMethod,\n+    })\n+\n+    return () => {\n+      Object.defineProperty(console, methodName, {\n+        value: originalMethod,\n+        writable: descriptor.writable,\n+        configurable: descriptor.configurable,\n+      })\n+    }\n+  }\n+\n+  return () => {}\n+}"
        },
        {
            "sha": "bad6ec6bb35b40128a7db381abf1207e7dffeced",
            "filename": "packages/next/src/next-devtools/userspace/app/app-dev-overlay-setup.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fapp-dev-overlay-setup.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fapp-dev-overlay-setup.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fapp-dev-overlay-setup.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -1,5 +1,13 @@\n import { patchConsoleError } from './errors/intercept-console-error'\n import { handleGlobalErrors } from './errors/use-error-handler'\n+import {\n+  initializeDebugLogForwarding,\n+  isTerminalLoggingEnabled,\n+} from './forward-logs'\n \n handleGlobalErrors()\n patchConsoleError()\n+\n+if (isTerminalLoggingEnabled) {\n+  initializeDebugLogForwarding('app')\n+}"
        },
        {
            "sha": "b4177c56b55498bc9909fb5ac90597265c15dd7b",
            "filename": "packages/next/src/next-devtools/userspace/app/errors/intercept-console-error.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fintercept-console-error.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fintercept-console-error.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fintercept-console-error.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -2,6 +2,7 @@ import isError from '../../../../lib/is-error'\n import { isNextRouterError } from '../../../../client/components/is-next-router-error'\n import { handleConsoleError } from './use-error-handler'\n import { parseConsoleArgs } from '../../../../client/lib/console'\n+import { forwardErrorLog, isTerminalLoggingEnabled } from '../forward-logs'\n \n export const originConsoleError = globalThis.console.error\n \n@@ -36,6 +37,9 @@ export function patchConsoleError() {\n           args\n         )\n       }\n+      if (isTerminalLoggingEnabled) {\n+        forwardErrorLog(args)\n+      }\n \n       originConsoleError.apply(window.console, args)\n     }"
        },
        {
            "sha": "aab7e6bfc4fecff1e149c5d9b422201cd450e933",
            "filename": "packages/next/src/next-devtools/userspace/app/errors/use-error-handler.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fuse-error-handler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fuse-error-handler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fuse-error-handler.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -7,6 +7,11 @@ import {\n import isError from '../../../../lib/is-error'\n import { createConsoleError } from '../../../shared/console-error'\n import { coerceError, setOwnerStackIfAvailable } from './stitched-error'\n+import {\n+  forwardUnhandledError,\n+  isTerminalLoggingEnabled,\n+  logUnhandledRejection,\n+} from '../forward-logs'\n \n const queueMicroTask =\n   globalThis.queueMicrotask || ((cb: () => void) => Promise.resolve().then(cb))\n@@ -94,8 +99,10 @@ function onUnhandledError(event: WindowEventMap['error']): void | boolean {\n   if (thrownValue) {\n     const error = coerceError(thrownValue)\n     setOwnerStackIfAvailable(error)\n-\n     handleClientError(error)\n+    if (isTerminalLoggingEnabled) {\n+      forwardUnhandledError(error)\n+    }\n   }\n }\n \n@@ -113,6 +120,10 @@ function onUnhandledRejection(ev: WindowEventMap['unhandledrejection']): void {\n   for (const handler of rejectionHandlers) {\n     handler(error)\n   }\n+\n+  if (isTerminalLoggingEnabled) {\n+    logUnhandledRejection(reason)\n+  }\n }\n \n export function handleGlobalErrors() {"
        },
        {
            "sha": "29e44f8e6a703995694e90804553dbfa5574d9ae",
            "filename": "packages/next/src/next-devtools/userspace/app/errors/use-forward-console-log.ts",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fuse-forward-console-log.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fuse-forward-console-log.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fuse-forward-console-log.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,26 @@\n+import { useEffect } from 'react'\n+import { isTerminalLoggingEnabled, logQueue } from '../forward-logs'\n+import type { useWebsocket } from '../../../../client/dev/hot-reloader/app/use-websocket'\n+\n+export const useForwardConsoleLog = (\n+  socketRef: ReturnType<typeof useWebsocket>\n+) => {\n+  useEffect(() => {\n+    if (!isTerminalLoggingEnabled) {\n+      return\n+    }\n+    const socket = socketRef.current\n+    if (!socket) {\n+      return\n+    }\n+\n+    const onOpen = () => {\n+      logQueue.onSocketReady(socket)\n+    }\n+    socket.addEventListener('open', onOpen)\n+\n+    return () => {\n+      socket.removeEventListener('open', onOpen)\n+    }\n+  }, [socketRef])\n+}"
        },
        {
            "sha": "7e5d53a3c490e291df046cf458e2e6071714fd14",
            "filename": "packages/next/src/next-devtools/userspace/app/forward-logs.test.ts",
            "status": "added",
            "additions": 114,
            "deletions": 0,
            "changes": 114,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.test.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,114 @@\n+import { UNDEFINED_MARKER } from '../../shared/forward-logs-shared'\n+import {\n+  preLogSerializationClone,\n+  PROMISE_MARKER,\n+  UNAVAILABLE_MARKER,\n+  logStringify,\n+} from './forward-logs'\n+\n+const safeStringify = (data: unknown) =>\n+  logStringify(preLogSerializationClone(data))\n+\n+describe('forward-logs serialization', () => {\n+  describe('safeClone', () => {\n+    it('should handle primitive values and null', () => {\n+      expect(preLogSerializationClone(42)).toBe(42)\n+      expect(preLogSerializationClone('hello')).toBe('hello')\n+      expect(preLogSerializationClone(true)).toBe(true)\n+      expect(preLogSerializationClone(null)).toBe(null)\n+      expect(preLogSerializationClone(undefined)).toBe(UNDEFINED_MARKER)\n+    })\n+\n+    it('should handle circular references', () => {\n+      const obj: any = { a: 1 }\n+      obj.self = obj\n+      const cloned = preLogSerializationClone(obj)\n+      expect(cloned.a).toBe(1)\n+      expect(cloned.self).toBe(cloned)\n+    })\n+\n+    it('should handle promises', () => {\n+      const promise = Promise.resolve(42)\n+      expect(preLogSerializationClone(promise)).toBe(PROMISE_MARKER)\n+    })\n+\n+    it('should handle arrays', () => {\n+      const arr = [1, 'test', undefined, null]\n+      const cloned = preLogSerializationClone(arr)\n+      expect(cloned).toEqual([1, 'test', UNDEFINED_MARKER, null])\n+    })\n+\n+    it('should handle plain objects', () => {\n+      const obj = { a: 1, b: undefined, c: 'test' }\n+      const cloned = preLogSerializationClone(obj)\n+      expect(cloned).toEqual({ a: 1, b: UNDEFINED_MARKER, c: 'test' })\n+    })\n+\n+    it('should handle objects with getters that throw', () => {\n+      const obj = {\n+        normalProp: 'works',\n+        get throwingGetter() {\n+          throw new Error('Getter throws')\n+        },\n+      }\n+\n+      const cloned = preLogSerializationClone(obj)\n+      expect(cloned.normalProp).toBe('works')\n+      expect(cloned.throwingGetter).toBe(UNAVAILABLE_MARKER)\n+    })\n+\n+    it('should handle non-plain objects as toString', () => {\n+      const date = new Date('2023-01-01')\n+      const regex = /test/gi\n+      const error = new Error('Test error')\n+\n+      expect(preLogSerializationClone(date)).toBe('[object Date]')\n+      expect(preLogSerializationClone(regex)).toBe('[object RegExp]')\n+      expect(preLogSerializationClone(error)).toBe('[object Error]')\n+    })\n+\n+    it('should handle array items that throw', () => {\n+      const throwingProxy = new Proxy(\n+        {},\n+        {\n+          get() {\n+            throw new Error('Proxy throws')\n+          },\n+        }\n+      )\n+\n+      const arr = [1, throwingProxy, 'normal']\n+      const cloned = preLogSerializationClone(arr)\n+\n+      expect(cloned).toEqual([1, UNAVAILABLE_MARKER, 'normal'])\n+    })\n+  })\n+\n+  describe('logStringify', () => {\n+    it('should stringify safe cloned data', () => {\n+      expect(safeStringify(42)).toBe('42')\n+      expect(safeStringify('hello')).toBe('\"hello\"')\n+      expect(safeStringify(null)).toBe('null')\n+      expect(safeStringify(undefined)).toBe(`\"${UNDEFINED_MARKER}\"`)\n+    })\n+\n+    it('should handle objects with circular references', () => {\n+      const obj: any = { a: 1 }\n+      obj.self = obj\n+      const result = safeStringify(obj)\n+      expect(typeof result).toBe('string')\n+      expect(result).toContain('\"a\":1')\n+    })\n+\n+    it('should return UNAVAILABLE_MARKER on stringify failure', () => {\n+      const problematicData = {\n+        toJSON() {\n+          throw new Error('toJSON throws')\n+        },\n+      }\n+\n+      const result = safeStringify(problematicData)\n+      expect(result).toBe(`\"${UNAVAILABLE_MARKER}\"`)\n+    })\n+  })\n+})"
        },
        {
            "sha": "bf55f678524dc0e758a6cc910fa206b91f8e5b5c",
            "filename": "packages/next/src/next-devtools/userspace/app/forward-logs.ts",
            "status": "added",
            "additions": 462,
            "deletions": 0,
            "changes": 462,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,462 @@\n+import { configure } from 'next/dist/compiled/safe-stable-stringify'\n+import {\n+  getOwnerStack,\n+  setOwnerStackIfAvailable,\n+} from './errors/stitched-error'\n+import { getErrorSource } from '../../../shared/lib/error-source'\n+import {\n+  getTerminalLoggingConfig,\n+  getIsTerminalLoggingEnabled,\n+} from './terminal-logging-config'\n+import {\n+  type ConsoleEntry,\n+  type ConsoleErrorEntry,\n+  type FormattedErrorEntry,\n+  type ClientLogEntry,\n+  type LogMethod,\n+  patchConsoleMethod,\n+  UNDEFINED_MARKER,\n+} from '../../shared/forward-logs-shared'\n+\n+const terminalLoggingConfig = getTerminalLoggingConfig()\n+export const PROMISE_MARKER = 'Promise {}'\n+export const UNAVAILABLE_MARKER = '[Unable to view]'\n+\n+const maximumDepth =\n+  typeof terminalLoggingConfig === 'object' && terminalLoggingConfig.depthLimit\n+    ? terminalLoggingConfig.depthLimit\n+    : 5\n+const maximumBreadth =\n+  typeof terminalLoggingConfig === 'object' && terminalLoggingConfig.edgeLimit\n+    ? terminalLoggingConfig.edgeLimit\n+    : 100\n+\n+const stringify = configure({\n+  maximumDepth,\n+  maximumBreadth,\n+})\n+\n+export const isTerminalLoggingEnabled = getIsTerminalLoggingEnabled()\n+\n+const methods: Array<LogMethod> = [\n+  'log',\n+  'info',\n+  'warn',\n+  'debug',\n+  'table',\n+  'assert',\n+  'dir',\n+  'dirxml',\n+  'group',\n+  'groupCollapsed',\n+  'groupEnd',\n+  'trace',\n+]\n+/**\n+ * allows us to:\n+ * - revive the undefined log in the server as it would look in the browser\n+ * - not read/attempt to serialize promises (next will console error if you do that, and will cause this program to infinitely recurse)\n+ * - if we read a proxy that throws (no way to detect if something is a proxy), explain to the user we can't read this data\n+ */\n+export function preLogSerializationClone<T>(\n+  value: T,\n+  seen = new WeakMap()\n+): any {\n+  if (value === undefined) return UNDEFINED_MARKER\n+  if (value === null || typeof value !== 'object') return value\n+  if (seen.has(value as object)) return seen.get(value as object)\n+\n+  try {\n+    Object.keys(value as object)\n+  } catch {\n+    return UNAVAILABLE_MARKER\n+  }\n+\n+  try {\n+    if (typeof (value as any).then === 'function') return PROMISE_MARKER\n+  } catch {\n+    return UNAVAILABLE_MARKER\n+  }\n+\n+  if (Array.isArray(value)) {\n+    const out: any[] = []\n+    seen.set(value, out)\n+    for (const item of value) {\n+      try {\n+        out.push(preLogSerializationClone(item, seen))\n+      } catch {\n+        out.push(UNAVAILABLE_MARKER)\n+      }\n+    }\n+    return out\n+  }\n+\n+  const proto = Object.getPrototypeOf(value)\n+  if (proto === Object.prototype || proto === null) {\n+    const out: Record<string, unknown> = {}\n+    seen.set(value as object, out)\n+    for (const key of Object.keys(value as object)) {\n+      try {\n+        out[key] = preLogSerializationClone((value as any)[key], seen)\n+      } catch {\n+        out[key] = UNAVAILABLE_MARKER\n+      }\n+    }\n+    return out\n+  }\n+\n+  return Object.prototype.toString.call(value)\n+}\n+\n+// only safe if passed safeClone data\n+export const logStringify = (data: unknown): string => {\n+  try {\n+    const result = stringify(data)\n+    return result ?? `\"${UNAVAILABLE_MARKER}\"`\n+  } catch {\n+    return `\"${UNAVAILABLE_MARKER}\"`\n+  }\n+}\n+\n+const afterThisFrame = (cb: () => void) => {\n+  let timeout: ReturnType<typeof setTimeout> | undefined\n+\n+  const rafId = requestAnimationFrame(() => {\n+    timeout = setTimeout(() => {\n+      cb()\n+    })\n+  })\n+\n+  return () => {\n+    cancelAnimationFrame(rafId)\n+    clearTimeout(timeout)\n+  }\n+}\n+\n+let isPatched = false\n+\n+const serializeEntries = (entries: Array<ClientLogEntry>) =>\n+  entries.map((clientEntry) => {\n+    switch (clientEntry.kind) {\n+      case 'any-logged-error':\n+      case 'console': {\n+        return {\n+          ...clientEntry,\n+          args: clientEntry.args.map(stringifyUserArg),\n+        }\n+      }\n+      case 'formatted-error': {\n+        return clientEntry\n+      }\n+      default: {\n+        return null!\n+      }\n+    }\n+  })\n+\n+export const logQueue: {\n+  entries: Array<ClientLogEntry>\n+  onSocketReady: (socket: WebSocket) => void\n+  flushScheduled: boolean\n+  socket: WebSocket | null\n+  cancelFlush: (() => void) | null\n+  sourceType?: 'server' | 'edge-server'\n+  router: 'app' | 'pages' | null\n+  scheduleLogSend: (entry: ClientLogEntry) => void\n+} = {\n+  entries: [],\n+  flushScheduled: false,\n+  cancelFlush: null,\n+  socket: null,\n+  sourceType: undefined,\n+  router: null,\n+  scheduleLogSend: (entry: ClientLogEntry) => {\n+    logQueue.entries.push(entry)\n+    if (logQueue.flushScheduled) {\n+      return\n+    }\n+    // safe to deref and use in setTimeout closure since we cancel on new socket\n+    const socket = logQueue.socket\n+    if (!socket) {\n+      return\n+    }\n+\n+    // we probably dont need this\n+    logQueue.flushScheduled = true\n+\n+    // non blocking log flush, runs at most once per frame\n+    logQueue.cancelFlush = afterThisFrame(() => {\n+      logQueue.flushScheduled = false\n+\n+      // just incase\n+      try {\n+        const payload = JSON.stringify({\n+          event: 'browser-logs',\n+          entries: serializeEntries(logQueue.entries),\n+          router: logQueue.router,\n+          // needed for source mapping, we just assign the sourceType from the last error for the whole batch\n+          sourceType: logQueue.sourceType,\n+        })\n+\n+        socket.send(payload)\n+        logQueue.entries = []\n+        logQueue.sourceType = undefined\n+      } catch {\n+        // error (make sure u don't infinite loop)\n+        /* noop */\n+      }\n+    })\n+  },\n+  onSocketReady: (socket: WebSocket) => {\n+    if (socket.readyState !== WebSocket.OPEN) {\n+      // invariant\n+      return\n+    }\n+\n+    // incase an existing timeout was going to run with a stale socket\n+    logQueue.cancelFlush?.()\n+    logQueue.socket = socket\n+    try {\n+      const payload = JSON.stringify({\n+        event: 'browser-logs',\n+        entries: serializeEntries(logQueue.entries),\n+        router: logQueue.router,\n+        sourceType: logQueue.sourceType,\n+      })\n+\n+      socket.send(payload)\n+      logQueue.entries = []\n+      logQueue.sourceType = undefined\n+    } catch {\n+      /** noop just incase */\n+    }\n+  },\n+}\n+\n+const stringifyUserArg = (\n+  arg:\n+    | {\n+        kind: 'arg'\n+        data: unknown\n+      }\n+    | {\n+        kind: 'formatted-error-arg'\n+      }\n+) => {\n+  if (arg.kind !== 'arg') {\n+    return arg\n+  }\n+  return {\n+    ...arg,\n+    data: logStringify(arg.data),\n+  }\n+}\n+\n+const createErrorArg = (error: Error) => {\n+  const stack = stackWithOwners(error)\n+  return {\n+    kind: 'formatted-error-arg' as const,\n+    prefix: error.message ? `${error.name}: ${error.message}` : `${error.name}`,\n+    stack,\n+  }\n+}\n+\n+const createLogEntry = (level: LogMethod, args: any[]) => {\n+  // do not abstract this, it implicitly relies on which functions call it. forcing the inlined implementation makes you think about callers\n+  // error capture stack trace maybe\n+  const stack = stackWithOwners(new Error())\n+  const stackLines = stack?.split('\\n')\n+  const cleanStack = stackLines?.slice(3).join('\\n') // this is probably ignored anyways\n+  const entry: ConsoleEntry<unknown> = {\n+    kind: 'console',\n+    consoleMethodStack: cleanStack ?? null, // depending on browser we might not have stack\n+    method: level,\n+    args: args.map((arg) => {\n+      if (arg instanceof Error) {\n+        return createErrorArg(arg)\n+      }\n+      return {\n+        kind: 'arg',\n+        data: preLogSerializationClone(arg),\n+      }\n+    }),\n+  }\n+\n+  logQueue.scheduleLogSend(entry)\n+}\n+\n+export const forwardErrorLog = (args: any[]) => {\n+  const errorObjects = args.filter((arg) => arg instanceof Error)\n+  const first = errorObjects.at(0)\n+  if (first) {\n+    const source = getErrorSource(first)\n+    if (source) {\n+      logQueue.sourceType = source\n+    }\n+  }\n+  /**\n+   * browser shows stack regardless of type of data passed to console.error, so we should do the same\n+   *\n+   * do not abstract this, it implicitly relies on which functions call it. forcing the inlined implementation makes you think about callers\n+   */\n+  const stack = stackWithOwners(new Error())\n+  const stackLines = stack?.split('\\n')\n+  const cleanStack = stackLines?.slice(3).join('\\n')\n+\n+  const entry: ConsoleErrorEntry<unknown> = {\n+    kind: 'any-logged-error',\n+    method: 'error',\n+    consoleErrorStack: cleanStack ?? '',\n+    args: args.map((arg) => {\n+      if (arg instanceof Error) {\n+        return createErrorArg(arg)\n+      }\n+      return {\n+        kind: 'arg',\n+        data: preLogSerializationClone(arg),\n+      }\n+    }),\n+  }\n+\n+  logQueue.scheduleLogSend(entry)\n+}\n+\n+const createUncaughtErrorEntry = (\n+  errorName: string,\n+  errorMessage: string,\n+  fullStack: string\n+) => {\n+  const entry: FormattedErrorEntry = {\n+    kind: 'formatted-error',\n+    prefix: `Uncaught ${errorName}: ${errorMessage}`,\n+    stack: fullStack,\n+    method: 'error',\n+  }\n+\n+  logQueue.scheduleLogSend(entry)\n+}\n+\n+const stackWithOwners = (error: Error) => {\n+  let ownerStack = ''\n+  setOwnerStackIfAvailable(error)\n+  ownerStack = getOwnerStack(error) || ''\n+  const stack = (error.stack || '') + ownerStack\n+  return stack\n+}\n+\n+export function logUnhandledRejection(reason: unknown) {\n+  if (reason instanceof Error) {\n+    createUnhandledRejectionErrorEntry(reason, stackWithOwners(reason))\n+    return\n+  }\n+  createUnhandledRejectionNonErrorEntry(reason)\n+}\n+\n+const createUnhandledRejectionErrorEntry = (\n+  error: Error,\n+  fullStack: string\n+) => {\n+  const source = getErrorSource(error)\n+  if (source) {\n+    logQueue.sourceType = source\n+  }\n+\n+  const entry: ClientLogEntry = {\n+    kind: 'formatted-error',\n+    prefix: `тип unhandledRejection: ${error.name}: ${error.message}`,\n+    stack: fullStack,\n+    method: 'error',\n+  }\n+\n+  logQueue.scheduleLogSend(entry)\n+}\n+\n+const createUnhandledRejectionNonErrorEntry = (reason: unknown) => {\n+  const entry: ClientLogEntry = {\n+    kind: 'any-logged-error',\n+    // we can't access the stack since the event is dispatched async and creating an inline error would be meaningless\n+    consoleErrorStack: '',\n+    method: 'error',\n+    args: [\n+      {\n+        kind: 'arg',\n+        data: `тип unhandledRejection:`,\n+        isRejectionMessage: true,\n+      },\n+      {\n+        kind: 'arg',\n+        data: preLogSerializationClone(reason),\n+      },\n+    ],\n+  }\n+\n+  logQueue.scheduleLogSend(entry)\n+}\n+\n+const isHMR = (args: any[]) => {\n+  const firstArg = args[0]\n+  if (typeof firstArg !== 'string') {\n+    return false\n+  }\n+  if (firstArg.startsWith('[Fast Refresh]')) {\n+    return true\n+  }\n+\n+  if (firstArg.startsWith('[HMR]')) {\n+    return true\n+  }\n+\n+  return false\n+}\n+\n+const isIgnoredLog = (args: any[]) => {\n+  if (args.length < 3) {\n+    return false\n+  }\n+\n+  const [format, styles, label] = args\n+\n+  if (\n+    typeof format !== 'string' ||\n+    typeof styles !== 'string' ||\n+    typeof label !== 'string'\n+  ) {\n+    return false\n+  }\n+\n+  // kinda hacky, we should define a common format for these strings so we can safely ignore\n+  return format.startsWith('%c%s%c') && styles.includes('background:')\n+}\n+\n+export function forwardUnhandledError(error: Error) {\n+  createUncaughtErrorEntry(error.name, error.message, stackWithOwners(error))\n+}\n+\n+// TODO: this router check is brittle, we need to update based on the current router the user is using\n+export const initializeDebugLogForwarding = (router: 'app' | 'pages'): void => {\n+  // probably don't need this\n+  if (isPatched) {\n+    return\n+  }\n+  // TODO(rob): why does this break rendering on server, important to know incase the same bug appears in browser\n+  if (typeof window === 'undefined') {\n+    return\n+  }\n+\n+  // better to be safe than sorry\n+  try {\n+    methods.forEach((method) =>\n+      patchConsoleMethod(method, (_, ...args) => {\n+        if (isHMR(args)) {\n+          return\n+        }\n+        if (isIgnoredLog(args)) {\n+          return\n+        }\n+        createLogEntry(method, args)\n+      })\n+    )\n+  } catch {}\n+  logQueue.router = router\n+  isPatched = true\n+}"
        },
        {
            "sha": "52d48906e9443ac997204efe1279ab7e8ba6daa5",
            "filename": "packages/next/src/next-devtools/userspace/app/terminal-logging-config.ts",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fterminal-logging-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fterminal-logging-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fterminal-logging-config.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,21 @@\n+export function getTerminalLoggingConfig():\n+  | false\n+  | boolean\n+  | {\n+      depthLimit?: number\n+      edgeLimit?: number\n+      showSourceLocation?: boolean\n+    } {\n+  try {\n+    return JSON.parse(\n+      process.env.__NEXT_BROWSER_DEBUG_INFO_IN_TERMINAL || 'false'\n+    )\n+  } catch {\n+    return false\n+  }\n+}\n+\n+export function getIsTerminalLoggingEnabled(): boolean {\n+  const config = getTerminalLoggingConfig()\n+  return Boolean(config)\n+}"
        },
        {
            "sha": "74311766bd01a0685f616a17319076e59e7cc6af",
            "filename": "packages/next/src/next-devtools/userspace/pages/pages-dev-overlay-setup.tsx",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fpages%2Fpages-dev-overlay-setup.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fpages%2Fpages-dev-overlay-setup.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fpages%2Fpages-dev-overlay-setup.tsx?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -10,6 +10,13 @@ import { getComponentStack, getOwnerStack } from '../app/errors/stitched-error'\n import { isRecoverableError } from '../../../client/react-client-callbacks/on-recoverable-error'\n import { getSquashedHydrationErrorDetails } from './hydration-error-state'\n import { PagesDevOverlayErrorBoundary } from './pages-dev-overlay-error-boundary'\n+import {\n+  initializeDebugLogForwarding,\n+  forwardUnhandledError,\n+  logUnhandledRejection,\n+  forwardErrorLog,\n+  isTerminalLoggingEnabled,\n+} from '../app/forward-logs'\n \n const usePagesDevOverlayBridge = () => {\n   React.useInsertionEffect(() => {\n@@ -76,12 +83,19 @@ function nextJsHandleConsoleError(...args: any[]) {\n   storeHydrationErrorStateFromConsoleArgs(...args)\n   // TODO: Surfaces non-errors logged via `console.error`.\n   handleError(maybeError)\n+  if (isTerminalLoggingEnabled) {\n+    forwardErrorLog(args)\n+  }\n   origConsoleError.apply(window.console, args)\n }\n \n function onUnhandledError(event: ErrorEvent) {\n   const error = event?.error\n   handleError(error)\n+\n+  if (error && isTerminalLoggingEnabled) {\n+    forwardUnhandledError(error as Error)\n+  }\n }\n \n function onUnhandledRejection(ev: PromiseRejectionEvent) {\n@@ -96,6 +110,9 @@ function onUnhandledRejection(ev: PromiseRejectionEvent) {\n   }\n \n   dispatcher.onUnhandledRejection(reason)\n+  if (isTerminalLoggingEnabled) {\n+    logUnhandledRejection(reason)\n+  }\n }\n \n export function register() {\n@@ -108,6 +125,9 @@ export function register() {\n     Error.stackTraceLimit = 50\n   } catch {}\n \n+  if (isTerminalLoggingEnabled) {\n+    initializeDebugLogForwarding('pages')\n+  }\n   window.addEventListener('error', onUnhandledError)\n   window.addEventListener('unhandledrejection', onUnhandledRejection)\n   window.console.error = nextJsHandleConsoleError"
        },
        {
            "sha": "ed6d8748585f67c1a14557902e8c53f196bbc7fc",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -502,6 +502,16 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n         globalNotFound: z.boolean().optional(),\n         devtoolSegmentExplorer: z.boolean().optional(),\n         devtoolNewPanelUI: z.boolean().optional(),\n+        browserDebugInfoInTerminal: z\n+          .union([\n+            z.boolean(),\n+            z.object({\n+              depthLimit: z.number().int().positive().optional(),\n+              edgeLimit: z.number().int().positive().optional(),\n+              showSourceLocation: z.boolean().optional(),\n+            }),\n+          ])\n+          .optional(),\n       })\n       .optional(),\n     exportPathMap: z"
        },
        {
            "sha": "556379bec05ee42c08008fb9d4cdc82350dca825",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -745,6 +745,29 @@ export interface ExperimentalConfig {\n    * Enable new panel UI for the Next.js DevTools.\n    */\n   devtoolNewPanelUI?: boolean\n+\n+  /**\n+   * Enable debug information to be forwarded from browser to dev server stdout/stderr\n+   */\n+  browserDebugInfoInTerminal?:\n+    | boolean\n+    | {\n+        /**\n+         * Option to limit stringification at a specific nesting depth when logging circular objects.\n+         * @default 5\n+         */\n+        depthLimit?: number\n+\n+        /**\n+         * Maximum number of properties/elements to stringify when logging objects/arrays with circular references.\n+         * @default 100\n+         */\n+        edgeLimit?: number\n+        /**\n+         * Whether to include source location information in debug output when available\n+         */\n+        showSourceLocation?: boolean\n+      }\n }\n \n export type ExportPathMap = {\n@@ -1457,6 +1480,7 @@ export const defaultConfig = {\n     globalNotFound: false,\n     devtoolNewPanelUI: process.env.__NEXT_DEVTOOL_NEW_PANEL_UI === 'true',\n     devtoolSegmentExplorer: process.env.__NEXT_DEVTOOL_NEW_PANEL_UI === 'true',\n+    browserDebugInfoInTerminal: false,\n   },\n   htmlLimitedBots: undefined,\n   bundlePagesRouterDependencies: false,"
        },
        {
            "sha": "0c94e5db6346fcb10d2eed817ba6e38658f0acac",
            "filename": "packages/next/src/server/dev/browser-logs/receive-logs.test.ts",
            "status": "added",
            "additions": 74,
            "deletions": 0,
            "changes": 74,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fbrowser-logs%2Freceive-logs.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fbrowser-logs%2Freceive-logs.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fbrowser-logs%2Freceive-logs.test.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,74 @@\n+import { stripFormatSpecifiers } from './receive-logs'\n+\n+describe('stripFormatSpecifiers', () => {\n+  it('should only process when first arg is string containing %', () => {\n+    expect(stripFormatSpecifiers([])).toEqual([])\n+    expect(stripFormatSpecifiers([123])).toEqual([123])\n+    expect(stripFormatSpecifiers(['no percent'])).toEqual(['no percent'])\n+  })\n+\n+  it('should replace format specifiers with their arguments', () => {\n+    expect(stripFormatSpecifiers(['%s', 'string'])).toEqual(['string'])\n+    expect(stripFormatSpecifiers(['Hello %s', 'world'])).toEqual([\n+      'Hello world',\n+    ])\n+\n+    expect(stripFormatSpecifiers(['%d', 42])).toEqual(['42'])\n+    expect(stripFormatSpecifiers(['%i', 123])).toEqual(['123'])\n+    expect(stripFormatSpecifiers(['%f', 3.14])).toEqual(['3.14'])\n+\n+    expect(stripFormatSpecifiers(['%o', { a: 1 }])).toEqual(['{ a: 1 }'])\n+    expect(stripFormatSpecifiers(['%O', { a: 1 }])).toEqual(['{ a: 1 }'])\n+    expect(stripFormatSpecifiers(['%j', { a: 1 }])).toEqual(['{ a: 1 }'])\n+  })\n+\n+  it('should strip CSS styling from %c format specifier', () => {\n+    expect(stripFormatSpecifiers(['%c', 'css'])).toEqual([''])\n+    expect(stripFormatSpecifiers(['%cStyled text', 'color: red'])).toEqual([\n+      'Styled text',\n+    ])\n+    expect(\n+      stripFormatSpecifiers(['%cError: %s', 'color: red', 'Something failed'])\n+    ).toEqual(['Error: Something failed'])\n+\n+    expect(\n+      stripFormatSpecifiers(['%cRed %cBlue', 'color: red', 'color: blue'])\n+    ).toEqual(['Red Blue'])\n+\n+    expect(\n+      stripFormatSpecifiers([\n+        '%cDownload the React DevTools for a better development experience: https://react.dev/link/react-devtools',\n+        'font-weight:bold',\n+      ])\n+    ).toEqual([\n+      'Download the React DevTools for a better development experience: https://react.dev/link/react-devtools',\n+    ])\n+\n+    expect(\n+      stripFormatSpecifiers([\n+        '%cStyled %s text %d',\n+        'color: red',\n+        'interpolated',\n+        42,\n+      ])\n+    ).toEqual(['Styled interpolated text 42'])\n+  })\n+\n+  it('should handle escaped percent signs', () => {\n+    expect(stripFormatSpecifiers(['%%'])).toEqual(['%'])\n+    expect(stripFormatSpecifiers(['100%%', 'unused'])).toEqual([\n+      '100%',\n+      'unused',\n+    ])\n+  })\n+\n+  it('should preserve excess arguments after all specifiers consumed', () => {\n+    expect(stripFormatSpecifiers(['%s', 'used', 'excess1', 'excess2'])).toEqual(\n+      ['used', 'excess1', 'excess2']\n+    )\n+  })\n+\n+  it('should handle % at end of string', () => {\n+    expect(stripFormatSpecifiers(['ends with %'])).toEqual(['ends with %'])\n+  })\n+})"
        },
        {
            "sha": "4b41c5632813d77e490d1dcfece087bd40324dbd",
            "filename": "packages/next/src/server/dev/browser-logs/receive-logs.ts",
            "status": "added",
            "additions": 572,
            "deletions": 0,
            "changes": 572,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fbrowser-logs%2Freceive-logs.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fbrowser-logs%2Freceive-logs.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fbrowser-logs%2Freceive-logs.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,572 @@\n+import { cyan, dim, red, yellow } from '../../../lib/picocolors'\n+import type { Project } from '../../../build/swc/types'\n+import util from 'util'\n+import {\n+  getConsoleLocation,\n+  getSourceMappedStackFrames,\n+  withLocation,\n+  type MappingContext,\n+} from './source-map'\n+import {\n+  type ServerLogEntry,\n+  type LogMethod,\n+  type ConsoleEntry,\n+  UNDEFINED_MARKER,\n+} from '../../../next-devtools/shared/forward-logs-shared'\n+\n+export function restoreUndefined(x: any): any {\n+  if (x === UNDEFINED_MARKER) return undefined\n+  if (Array.isArray(x)) return x.map(restoreUndefined)\n+  if (x && typeof x === 'object') {\n+    for (let k in x) {\n+      x[k] = restoreUndefined(x[k])\n+    }\n+  }\n+  return x\n+}\n+\n+const methods: Array<LogMethod> = [\n+  'log',\n+  'info',\n+  'warn',\n+  'debug',\n+  'table',\n+  'error',\n+  'assert',\n+  'dir',\n+  'dirxml',\n+  'group',\n+  'groupCollapsed',\n+  'groupEnd',\n+]\n+\n+const methodsToSkipInspect = new Set([\n+  'table',\n+  'dir',\n+  'dirxml',\n+  'group',\n+  'groupCollapsed',\n+  'groupEnd',\n+])\n+\n+// we aren't overriding console, we're just making a (slightly convoluted) helper for replaying user console methods\n+const forwardConsole: typeof console = {\n+  ...console,\n+  ...Object.fromEntries(\n+    methods.map((method) => [\n+      method,\n+      (...args: Array<any>) =>\n+        (console[method] as any)(\n+          ...args.map((arg) =>\n+            methodsToSkipInspect.has(method) ||\n+            typeof arg !== 'object' ||\n+            arg === null\n+              ? arg\n+              : // we hardcode depth:Infinity to allow the true depth to be configured by the serialization done in the browser (which is controlled by user)\n+                util.inspect(arg, { depth: Infinity, colors: true })\n+          )\n+        ),\n+    ])\n+  ),\n+}\n+\n+async function deserializeArgData(arg: any) {\n+  try {\n+    // we want undefined to be represented as it would be in the browser from the user's perspective (otherwise it would be stripped away/shown as null)\n+    if (arg === UNDEFINED_MARKER) {\n+      return restoreUndefined(arg)\n+    }\n+\n+    return restoreUndefined(JSON.parse(arg))\n+  } catch {\n+    return arg\n+  }\n+}\n+\n+const colorError = (\n+  mapped: Awaited<ReturnType<typeof getSourceMappedStackFrames>>,\n+  config?: {\n+    prefix?: string\n+    applyColor?: boolean\n+  }\n+) => {\n+  const colorFn =\n+    config?.applyColor === undefined || config.applyColor ? red : <T>(x: T) => x\n+  switch (mapped.kind) {\n+    case 'mapped-stack':\n+    case 'stack': {\n+      return (\n+        (config?.prefix ? colorFn(config?.prefix) : '') +\n+        `\\n${colorFn(mapped.stack)}`\n+      )\n+    }\n+    case 'with-frame-code': {\n+      return (\n+        (config?.prefix ? colorFn(config?.prefix) : '') +\n+        `\\n${colorFn(mapped.stack)}\\n${mapped.frameCode}`\n+      )\n+    }\n+    // a more sophisticated version of this allows the user to config if they want ignored frames (but we need to be sure to source map them)\n+    case 'all-ignored': {\n+      return config?.prefix ? colorFn(config?.prefix) : ''\n+    }\n+    default: {\n+    }\n+  }\n+  mapped satisfies never\n+}\n+\n+function processConsoleFormatStrings(args: any[]): any[] {\n+  /**\n+   * this handles the case formatting is applied to the console log\n+   * otherwise we will see the format specifier directly in the terminal output\n+   */\n+  if (args.length > 0 && typeof args[0] === 'string') {\n+    const formatString = args[0]\n+    if (\n+      formatString.includes('%s') ||\n+      formatString.includes('%d') ||\n+      formatString.includes('%i') ||\n+      formatString.includes('%f') ||\n+      formatString.includes('%o') ||\n+      formatString.includes('%O') ||\n+      formatString.includes('%c')\n+    ) {\n+      try {\n+        const formatted = util.format(...args)\n+        return [formatted]\n+      } catch {\n+        return args\n+      }\n+    }\n+  }\n+  return args\n+}\n+\n+// in the case of logging errors, we want to strip formatting\n+// modifiers since we apply our own custom coloring to error\n+// stacks and code blocks, and otherwise it would conflict\n+// and cause awful output\n+export function stripFormatSpecifiers(args: any[]): any[] {\n+  if (args.length === 0 || typeof args[0] !== 'string') return args\n+\n+  const fmtIn = String(args[0])\n+  const rest = args.slice(1)\n+\n+  if (!fmtIn.includes('%')) return args\n+\n+  let fmtOut = ''\n+  let argPtr = 0\n+\n+  for (let i = 0; i < fmtIn.length; i++) {\n+    if (fmtIn[i] !== '%') {\n+      fmtOut += fmtIn[i]\n+      continue\n+    }\n+\n+    if (fmtIn[i + 1] === '%') {\n+      fmtOut += '%'\n+      i++\n+      continue\n+    }\n+\n+    const token = fmtIn[++i]\n+\n+    if (!token) {\n+      fmtOut += '%'\n+      continue\n+    }\n+\n+    if ('csdifoOj'.includes(token) || token === 'O') {\n+      if (argPtr < rest.length) {\n+        if (token === 'c') {\n+          argPtr++\n+        } else if (token === 'o' || token === 'O' || token === 'j') {\n+          const obj = rest[argPtr++]\n+          fmtOut += util.inspect(obj, { depth: 2, colors: false })\n+        } else {\n+          // string(...) is safe for remaining specifiers\n+          fmtOut += String(rest[argPtr++])\n+        }\n+      }\n+      continue\n+    }\n+\n+    fmtOut += '%' + token\n+  }\n+\n+  const result = [fmtOut]\n+  if (argPtr < rest.length) {\n+    result.push(...rest.slice(argPtr))\n+  }\n+\n+  return result\n+}\n+\n+async function prepareFormattedErrorArgs(\n+  entry: Extract<ServerLogEntry, { kind: 'formatted-error' }>,\n+  ctx: MappingContext,\n+  distDir: string\n+) {\n+  const mapped = await getSourceMappedStackFrames(entry.stack, ctx, distDir)\n+  return [colorError(mapped, { prefix: entry.prefix })]\n+}\n+\n+async function prepareConsoleArgs(\n+  entry: Extract<ServerLogEntry, { kind: 'console' }>,\n+  ctx: MappingContext,\n+  distDir: string\n+) {\n+  const deserialized = await Promise.all(\n+    entry.args.map(async (arg) => {\n+      if (arg.kind === 'arg') {\n+        const data = await deserializeArgData(arg.data)\n+        if (entry.method === 'warn' && typeof data === 'string') {\n+          return yellow(data)\n+        }\n+        return data\n+      }\n+      if (!arg.stack) return red(arg.prefix)\n+      const mapped = await getSourceMappedStackFrames(arg.stack, ctx, distDir)\n+      return colorError(mapped, { prefix: arg.prefix, applyColor: false })\n+    })\n+  )\n+\n+  return processConsoleFormatStrings(deserialized)\n+}\n+\n+async function prepareConsoleErrorArgs(\n+  entry: Extract<ServerLogEntry, { kind: 'any-logged-error' }>,\n+  ctx: MappingContext,\n+  distDir: string\n+) {\n+  const deserialized = await Promise.all(\n+    entry.args.map(async (arg) => {\n+      if (arg.kind === 'arg') {\n+        if (arg.isRejectionMessage) return red(arg.data)\n+        return deserializeArgData(arg.data)\n+      }\n+      if (!arg.stack) return red(arg.prefix)\n+      const mapped = await getSourceMappedStackFrames(arg.stack, ctx, distDir)\n+      return colorError(mapped, { prefix: arg.prefix })\n+    })\n+  )\n+\n+  const mappedStack = await getSourceMappedStackFrames(\n+    entry.consoleErrorStack,\n+    ctx,\n+    distDir\n+  )\n+\n+  /**\n+   * don't show the stack + codeblock when there are errors present, since:\n+   * - it will look overwhelming to see 2 stacks and 2 code blocks\n+   * - the user already knows where the console.error is at because we append the location\n+   */\n+  const location = getConsoleLocation(mappedStack)\n+  if (entry.args.some((a) => a.kind === 'formatted-error-arg')) {\n+    const result = stripFormatSpecifiers(deserialized)\n+    if (location) {\n+      result.push(dim(`(${location})`))\n+    }\n+    return result\n+  }\n+  const result = [\n+    ...processConsoleFormatStrings(deserialized),\n+    colorError(mappedStack),\n+  ]\n+  if (location) {\n+    result.push(dim(`(${location})`))\n+  }\n+  return result\n+}\n+\n+async function handleTable(\n+  entry: ConsoleEntry<string>,\n+  browserPrefix: string,\n+  ctx: MappingContext,\n+  distDir: string\n+) {\n+  const deserializedArgs = await Promise.all(\n+    entry.args.map(async (arg: any) => {\n+      if (arg.kind === 'formatted-error-arg') {\n+        return { stack: arg.stack }\n+      }\n+      return deserializeArgData(arg.data)\n+    })\n+  )\n+\n+  const location = await (async () => {\n+    if (!entry.consoleMethodStack) {\n+      return\n+    }\n+    const frames = await getSourceMappedStackFrames(\n+      entry.consoleMethodStack,\n+      ctx,\n+      distDir\n+    )\n+    return getConsoleLocation(frames)\n+  })()\n+\n+  // we can't inline pass browser prefix, but it looks better multiline for table anyways\n+  forwardConsole.log(browserPrefix)\n+  forwardConsole.table(...deserializedArgs)\n+  if (location) {\n+    forwardConsole.log(dim(`(${location})`))\n+  }\n+}\n+\n+async function handleTrace(\n+  entry: ConsoleEntry<string>,\n+  browserPrefix: string,\n+  ctx: MappingContext,\n+  distDir: string\n+) {\n+  const deserializedArgs = await Promise.all(\n+    entry.args.map(async (arg: any) => {\n+      if (arg.kind === 'formatted-error-arg') {\n+        if (!arg.stack) return red(arg.prefix)\n+        const mapped = await getSourceMappedStackFrames(arg.stack, ctx, distDir)\n+        return colorError(mapped, { prefix: arg.prefix })\n+      }\n+      return deserializeArgData(arg.data)\n+    })\n+  )\n+\n+  if (!entry.consoleMethodStack) {\n+    forwardConsole.log(\n+      browserPrefix,\n+      ...deserializedArgs,\n+      '[Trace unavailable]'\n+    )\n+    return\n+  }\n+\n+  // TODO(rob): refactor so we can re-use result and not re-run the entire source map to avoid trivial post processing\n+  const [mapped, mappedIgnored] = await Promise.all([\n+    getSourceMappedStackFrames(entry.consoleMethodStack, ctx, distDir, false),\n+    getSourceMappedStackFrames(entry.consoleMethodStack, ctx, distDir),\n+  ])\n+\n+  const location = getConsoleLocation(mappedIgnored)\n+  forwardConsole.log(\n+    browserPrefix,\n+    ...deserializedArgs,\n+    `\\n${mapped.stack}`,\n+    ...(location ? [`\\n${dim(`(${location})`)}`] : [])\n+  )\n+}\n+\n+async function handleDir(\n+  entry: ConsoleEntry<string>,\n+  browserPrefix: string,\n+  ctx: MappingContext,\n+  distDir: string\n+) {\n+  const loggableEntry = await prepareConsoleArgs(entry, ctx, distDir)\n+  const consoleMethod =\n+    (forwardConsole as any)[entry.method] || forwardConsole.log\n+\n+  if (entry.consoleMethodStack) {\n+    const mapped = await getSourceMappedStackFrames(\n+      entry.consoleMethodStack,\n+      ctx,\n+      distDir\n+    )\n+    const location = dim(`(${getConsoleLocation(mapped)})`)\n+    const originalWrite = process.stdout.write.bind(process.stdout)\n+    let captured = ''\n+    process.stdout.write = (chunk) => {\n+      captured += chunk\n+      return true\n+    }\n+    try {\n+      consoleMethod(...loggableEntry)\n+    } finally {\n+      process.stdout.write = originalWrite\n+    }\n+    const preserved = captured.replace(/\\r?\\n$/, '')\n+    originalWrite(`${browserPrefix}${preserved} ${location}\\n`)\n+    return\n+  }\n+  consoleMethod(browserPrefix, ...loggableEntry)\n+}\n+\n+async function handleDefaultConsole(\n+  entry: ConsoleEntry<string>,\n+  browserPrefix: string,\n+  ctx: MappingContext,\n+  distDir: string,\n+  config: boolean | { logDepth?: number; showSourceLocation?: boolean }\n+) {\n+  const loggableEntry = await prepareConsoleArgs(entry, ctx, distDir)\n+  const withStackEntry = await withLocation(\n+    {\n+      original: loggableEntry,\n+      stack: (entry as any).consoleMethodStack || null,\n+    },\n+    ctx,\n+    distDir,\n+    config\n+  )\n+  const consoleMethod = forwardConsole[entry.method] || forwardConsole.log\n+  ;(consoleMethod as (...args: any[]) => void)(browserPrefix, ...withStackEntry)\n+}\n+\n+export async function handleLog(\n+  entries: ServerLogEntry[],\n+  ctx: MappingContext,\n+  distDir: string,\n+  config: boolean | { logDepth?: number; showSourceLocation?: boolean }\n+): Promise<void> {\n+  const browserPrefix = cyan('[browser]')\n+\n+  for (const entry of entries) {\n+    try {\n+      switch (entry.kind) {\n+        case 'console': {\n+          switch (entry.method) {\n+            case 'table': {\n+              // timeout based abort on source mapping result\n+              await handleTable(entry, browserPrefix, ctx, distDir)\n+              break\n+            }\n+            // ignore frames\n+            case 'trace': {\n+              await handleTrace(entry, browserPrefix, ctx, distDir)\n+              break\n+            }\n+            case 'dir': {\n+              await handleDir(entry, browserPrefix, ctx, distDir)\n+              break\n+            }\n+            // xml log thing maybe needs an impl\n+\n+            // [browser] undefined (app/page.tsx:8:11) console.group\n+            // check console assert\n+            default: {\n+              await handleDefaultConsole(\n+                entry,\n+                browserPrefix,\n+                ctx,\n+                distDir,\n+                config\n+              )\n+            }\n+          }\n+          break\n+        }\n+        // any logged errors are anything that are logged as \"red\" in the browser but aren't only an Error (console.error, Promise.reject(100))\n+        case 'any-logged-error': {\n+          const consoleArgs = await prepareConsoleErrorArgs(entry, ctx, distDir)\n+          forwardConsole.error(browserPrefix, ...consoleArgs)\n+          break\n+        }\n+        // formatted error is an explicit error event (rejections, uncaught errors)\n+        case 'formatted-error': {\n+          const formattedArgs = await prepareFormattedErrorArgs(\n+            entry,\n+            ctx,\n+            distDir\n+          )\n+          forwardConsole.error(browserPrefix, ...formattedArgs)\n+          break\n+        }\n+        default: {\n+        }\n+      }\n+    } catch {\n+      switch (entry.kind) {\n+        case 'any-logged-error': {\n+          const consoleArgs = await prepareConsoleErrorArgs(entry, ctx, distDir)\n+          forwardConsole.error(browserPrefix, ...consoleArgs)\n+          break\n+        }\n+        case 'console': {\n+          const consoleMethod =\n+            forwardConsole[entry.method] || forwardConsole.log\n+          const consoleArgs = await prepareConsoleArgs(entry, ctx, distDir)\n+          ;(consoleMethod as (...args: any[]) => void)(\n+            browserPrefix,\n+            ...consoleArgs\n+          )\n+          break\n+        }\n+        case 'formatted-error': {\n+          forwardConsole.error(browserPrefix, `${entry.prefix}\\n`, entry.stack)\n+          break\n+        }\n+        default: {\n+        }\n+      }\n+    }\n+  }\n+}\n+\n+// the data is used later when we need to get sourcemaps for error stacks\n+export async function receiveBrowserLogsWebpack(opts: {\n+  entries: ServerLogEntry[]\n+  router: 'app' | 'pages'\n+  sourceType?: 'server' | 'edge-server'\n+  clientStats: () => any\n+  serverStats: () => any\n+  edgeServerStats: () => any\n+  rootDirectory: string\n+  distDir: string\n+  config: boolean | { logDepth?: number; showSourceLocation?: boolean }\n+}): Promise<void> {\n+  const {\n+    entries,\n+    router,\n+    sourceType,\n+    clientStats,\n+    serverStats,\n+    edgeServerStats,\n+    rootDirectory,\n+    distDir,\n+  } = opts\n+\n+  const isAppDirectory = router === 'app'\n+  const isServer = sourceType === 'server'\n+  const isEdgeServer = sourceType === 'edge-server'\n+\n+  const ctx: MappingContext = {\n+    bundler: 'webpack',\n+    isServer,\n+    isEdgeServer,\n+    isAppDirectory,\n+    clientStats,\n+    serverStats,\n+    edgeServerStats,\n+    rootDirectory,\n+  }\n+\n+  await handleLog(entries, ctx, distDir, opts.config)\n+}\n+\n+export async function receiveBrowserLogsTurbopack(opts: {\n+  entries: ServerLogEntry[]\n+  router: 'app' | 'pages'\n+  sourceType?: 'server' | 'edge-server'\n+  project: Project\n+  projectPath: string\n+  distDir: string\n+  config: boolean | { logDepth?: number; showSourceLocation?: boolean }\n+}): Promise<void> {\n+  const { entries, router, sourceType, project, projectPath, distDir } = opts\n+\n+  const isAppDirectory = router === 'app'\n+  const isServer = sourceType === 'server'\n+  const isEdgeServer = sourceType === 'edge-server'\n+\n+  const ctx: MappingContext = {\n+    bundler: 'turbopack',\n+    project,\n+    projectPath,\n+    isServer,\n+    isEdgeServer,\n+    isAppDirectory,\n+  }\n+\n+  await handleLog(entries, ctx, distDir, opts.config)\n+}"
        },
        {
            "sha": "01e6c8f83fbdb0a3050e49da04122a80b36ed6ac",
            "filename": "packages/next/src/server/dev/browser-logs/source-map.ts",
            "status": "added",
            "additions": 301,
            "deletions": 0,
            "changes": 301,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fbrowser-logs%2Fsource-map.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fbrowser-logs%2Fsource-map.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fbrowser-logs%2Fsource-map.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,301 @@\n+import type { StackFrame } from 'stacktrace-parser'\n+import { getOriginalStackFrames as getOriginalStackFramesWebpack } from '../middleware-webpack'\n+import { getOriginalStackFrames as getOriginalStackFramesTurbopack } from '../middleware-turbopack'\n+import type { Project } from '../../../build/swc/types'\n+import { dim } from '../../../lib/picocolors'\n+import { parseStack } from '../../lib/parse-stack'\n+import path from 'path'\n+import { LRUCache } from '../../lib/lru-cache'\n+\n+type WebpackMappingContext = {\n+  bundler: 'webpack'\n+  isServer: boolean\n+  isEdgeServer: boolean\n+  isAppDirectory: boolean\n+  clientStats: () => any\n+  serverStats: () => any\n+  edgeServerStats: () => any\n+  rootDirectory: string\n+}\n+\n+type TurbopackMappingContext = {\n+  bundler: 'turbopack'\n+  isServer: boolean\n+  isEdgeServer: boolean\n+  isAppDirectory: boolean\n+  project: Project\n+  projectPath: string\n+}\n+\n+export type MappingContext = WebpackMappingContext | TurbopackMappingContext\n+\n+// TODO: handle server vs browser error source mapping correctly\n+export async function mapFramesUsingBundler(\n+  frames: StackFrame[],\n+  ctx: MappingContext\n+) {\n+  switch (ctx.bundler) {\n+    case 'webpack': {\n+      const {\n+        isServer,\n+        isEdgeServer,\n+        isAppDirectory,\n+        clientStats,\n+        serverStats,\n+        edgeServerStats,\n+        rootDirectory,\n+      } = ctx\n+      const res = await getOriginalStackFramesWebpack({\n+        isServer,\n+        isEdgeServer,\n+        isAppDirectory,\n+        frames,\n+        clientStats,\n+        serverStats,\n+        edgeServerStats,\n+        rootDirectory,\n+      })\n+      return res\n+    }\n+    case 'turbopack': {\n+      const { project, projectPath, isServer, isEdgeServer, isAppDirectory } =\n+        ctx\n+      const res = await getOriginalStackFramesTurbopack({\n+        project,\n+        projectPath,\n+        frames,\n+        isServer,\n+        isEdgeServer,\n+        isAppDirectory,\n+      })\n+\n+      return res\n+    }\n+    default: {\n+      return null!\n+    }\n+  }\n+}\n+\n+// converts _next/static/chunks/... to file:///.next/static/chunks/... for parseStack\n+// todo: where does next dev overlay handle this case and re-use that logic\n+function preprocessStackTrace(stackTrace: string, distDir?: string): string {\n+  return stackTrace\n+    .split('\\n')\n+    .map((line) => {\n+      const match = line.match(/^(\\s*at\\s+.*?)\\s+\\(([^)]+)\\)$/)\n+      if (match) {\n+        const [, prefix, location] = match\n+\n+        if (location.startsWith('_next/static/') && distDir) {\n+          const normalizedDistDir = distDir\n+            .replace(/\\\\/g, '/')\n+            .replace(/\\/$/, '')\n+\n+          const absolutePath =\n+            normalizedDistDir + '/' + location.slice('_next/'.length)\n+          const fileUrl = `file://${path.resolve(absolutePath)}`\n+\n+          return `${prefix} (${fileUrl})`\n+        }\n+      }\n+\n+      return line\n+    })\n+    .join('\\n')\n+}\n+\n+const cache = new LRUCache<\n+  Awaited<ReturnType<typeof getSourceMappedStackFramesInternal>>\n+>(25)\n+async function getSourceMappedStackFramesInternal(\n+  stackTrace: string,\n+  ctx: MappingContext,\n+  distDir: string,\n+  ignore = true\n+) {\n+  try {\n+    const normalizedStack = preprocessStackTrace(stackTrace, distDir)\n+    const frames = parseStack(normalizedStack, distDir)\n+\n+    if (frames.length === 0) {\n+      return {\n+        kind: 'stack' as const,\n+        stack: stackTrace,\n+      }\n+    }\n+\n+    const mappingResults = await mapFramesUsingBundler(frames, ctx)\n+\n+    const processedFrames = mappingResults\n+      .map((result, index) => ({\n+        result,\n+        originalFrame: frames[index],\n+      }))\n+      .map(({ result, originalFrame }) => {\n+        if (result.status === 'rejected') {\n+          return {\n+            kind: 'rejected' as const,\n+            frameText: formatStackFrame(originalFrame),\n+            codeFrame: null,\n+          }\n+        }\n+\n+        const { originalStackFrame, originalCodeFrame } = result.value\n+        if (originalStackFrame?.ignored && ignore) {\n+          return {\n+            kind: 'ignored' as const,\n+          }\n+        }\n+\n+        // should we apply this generally to dev overlay (dev overlay does not ignore chrome-extension://)\n+        if (originalStackFrame?.file?.startsWith('chrome-extension://')) {\n+          return {\n+            kind: 'ignored' as const,\n+          }\n+        }\n+\n+        return {\n+          kind: 'success' as const,\n+          // invariant: if result is not rejected and not ignored, then original stack frame exists\n+          // verifiable by tracing `getOriginalStackFrame`. The invariant exists because of bad types\n+          frameText: formatStackFrame(originalStackFrame!),\n+          codeFrame: originalCodeFrame,\n+        }\n+      })\n+\n+    const allIgnored = processedFrames.every(\n+      (frame) => frame.kind === 'ignored'\n+    )\n+\n+    // we want to handle **all** ignored vs all/some rejected differently\n+    // if all are ignored we should show no frames\n+    // if all are rejected, we want to fallback to showing original stack frames\n+    if (allIgnored) {\n+      return {\n+        kind: 'all-ignored' as const,\n+      }\n+    }\n+\n+    const filteredFrames = processedFrames.filter(\n+      (frame) => frame.kind !== 'ignored'\n+    )\n+\n+    if (filteredFrames.length === 0) {\n+      return {\n+        kind: 'stack' as const,\n+        stack: stackTrace,\n+      }\n+    }\n+\n+    const stackOutput = filteredFrames\n+      .map((frame) => frame.frameText)\n+      .join('\\n')\n+    const firstFrameCode = filteredFrames.find(\n+      (frame) => frame.codeFrame\n+    )?.codeFrame\n+\n+    if (firstFrameCode) {\n+      return {\n+        kind: 'with-frame-code' as const,\n+        frameCode: firstFrameCode,\n+        stack: stackOutput,\n+        frames: filteredFrames,\n+      }\n+    }\n+    // i don't think this a real case, but good for exhaustion\n+    return {\n+      kind: 'mapped-stack' as const,\n+      stack: stackOutput,\n+      frames: filteredFrames,\n+    }\n+  } catch (error) {\n+    return {\n+      kind: 'stack' as const,\n+      stack: stackTrace,\n+    }\n+  }\n+}\n+\n+// todo: cache the actual async call, not the wrapper with post processing\n+export async function getSourceMappedStackFrames(\n+  stackTrace: string,\n+  ctx: MappingContext,\n+  distDir: string,\n+  ignore = true\n+) {\n+  const cacheKey = `sm_${stackTrace}-${ctx.bundler}-${ctx.isAppDirectory}-${ctx.isEdgeServer}-${ctx.isServer}-${distDir}-${ignore}`\n+\n+  const cacheItem = cache.get(cacheKey)\n+  if (cacheItem) {\n+    return cacheItem\n+  }\n+\n+  const result = await getSourceMappedStackFramesInternal(\n+    stackTrace,\n+    ctx,\n+    distDir,\n+    ignore\n+  )\n+  cache.set(cacheKey, result)\n+  return result\n+}\n+\n+function formatStackFrame(frame: StackFrame): string {\n+  const functionName = frame.methodName || '<anonymous>'\n+  const location =\n+    frame.file && frame.lineNumber\n+      ? `${frame.file}:${frame.lineNumber}${frame.column ? `:${frame.column}` : ''}`\n+      : frame.file || '<unknown>'\n+\n+  return `    at ${functionName} (${location})`\n+}\n+\n+// appends the source mapped location of the console method\n+export const withLocation = async (\n+  {\n+    original,\n+    stack,\n+  }: {\n+    original: Array<any>\n+    stack: string | null\n+  },\n+  ctx: MappingContext,\n+  distDir: string,\n+  config: boolean | { logDepth?: number; showSourceLocation?: boolean }\n+) => {\n+  if (typeof config === 'object' && config.showSourceLocation === false) {\n+    return original\n+  }\n+  if (!stack) {\n+    return original\n+  }\n+\n+  const res = await getSourceMappedStackFrames(stack, ctx, distDir)\n+  const location = getConsoleLocation(res)\n+\n+  if (!location) {\n+    return original\n+  }\n+\n+  return [...original, dim(`(${location})`)]\n+}\n+\n+export const getConsoleLocation = (\n+  mapped: Awaited<ReturnType<typeof getSourceMappedStackFrames>>\n+) => {\n+  if (mapped.kind !== 'mapped-stack' && mapped.kind !== 'with-frame-code') {\n+    return null\n+  }\n+\n+  const first = mapped.frames.at(0)\n+\n+  if (!first) {\n+    return null\n+  }\n+\n+  // we don't want to show the name of parent function (at <fn> thing in stack), just source location for minimal noise\n+  const match = first.frameText.match(/\\(([^)]+)\\)/)\n+  const locationText = match ? match[1] : first.frameText\n+  return locationText\n+}"
        },
        {
            "sha": "9e123586c18f3468689b8b2af62611981591d380",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -98,6 +98,7 @@ import { getDisableDevIndicatorMiddleware } from '../../next-devtools/server/dev\n import { getRestartDevServerMiddleware } from '../../next-devtools/server/restart-dev-server-middleware'\n import { backgroundLogCompilationEvents } from '../../shared/lib/turbopack/compilation-events'\n import { getSupportedBrowsers } from '../../build/utils'\n+import { receiveBrowserLogsTurbopack } from './browser-logs/receive-logs'\n \n const wsServer = new ws.Server({ noServer: true })\n const isTestMode = !!(\n@@ -752,7 +753,7 @@ export async function createHotReloaderTurbopack(\n           clients.delete(client)\n         })\n \n-        client.addEventListener('message', ({ data }) => {\n+        client.addEventListener('message', async ({ data }) => {\n           const parsedData = JSON.parse(\n             typeof data !== 'string' ? data.toString() : data\n           )\n@@ -780,6 +781,7 @@ export async function createHotReloaderTurbopack(\n                 }\n               )\n               break\n+\n             case 'client-error': // { errorCount, clientId }\n             case 'client-warning': // { warningCount, clientId }\n             case 'client-success': // { clientId }\n@@ -806,6 +808,20 @@ export async function createHotReloaderTurbopack(\n             case 'client-added-page':\n               // TODO\n               break\n+            case 'browser-logs': {\n+              if (nextConfig.experimental.browserDebugInfoInTerminal) {\n+                await receiveBrowserLogsTurbopack({\n+                  entries: parsedData.entries,\n+                  router: parsedData.router,\n+                  sourceType: parsedData.sourceType,\n+                  project,\n+                  projectPath,\n+                  distDir,\n+                  config: nextConfig.experimental.browserDebugInfoInTerminal,\n+                })\n+              }\n+              break\n+            }\n \n             default:\n               // Might be a Turbopack message..."
        },
        {
            "sha": "418eb49049826bf0e5a105cc04f7d68e97661bf3",
            "filename": "packages/next/src/server/dev/hot-reloader-webpack.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -90,6 +90,7 @@ import { getDisableDevIndicatorMiddleware } from '../../next-devtools/server/dev\n import getWebpackBundler from '../../shared/lib/get-webpack-bundler'\n import { getRestartDevServerMiddleware } from '../../next-devtools/server/restart-dev-server-middleware'\n import { checkPersistentCacheInvalidationAndCleanup } from '../../build/webpack/cache-invalidation'\n+import { receiveBrowserLogsWebpack } from './browser-logs/receive-logs'\n \n const MILLISECONDS_IN_NANOSECOND = BigInt(1_000_000)\n \n@@ -437,7 +438,7 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n       this.onDemandEntries?.onHMR(client, () => this.hmrServerError)\n       callback(client)\n \n-      client.addEventListener('message', ({ data }) => {\n+      client.addEventListener('message', async ({ data }) => {\n         data = typeof data !== 'string' ? data.toString() : data\n \n         try {\n@@ -567,6 +568,22 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n               )\n               break\n             }\n+            case 'browser-logs': {\n+              if (this.config.experimental.browserDebugInfoInTerminal) {\n+                await receiveBrowserLogsWebpack({\n+                  entries: payload.entries,\n+                  router: payload.router,\n+                  sourceType: payload.sourceType,\n+                  clientStats: () => this.clientStats,\n+                  serverStats: () => this.serverStats,\n+                  edgeServerStats: () => this.edgeServerStats,\n+                  rootDirectory: this.dir,\n+                  distDir: this.distDir,\n+                  config: this.config.experimental.browserDebugInfoInTerminal,\n+                })\n+              }\n+              break\n+            }\n             default: {\n               break\n             }"
        },
        {
            "sha": "56cc14b3f745979aa4abcb41f891bcf1b9d7fbae",
            "filename": "packages/next/src/server/dev/middleware-turbopack.ts",
            "status": "modified",
            "additions": 55,
            "deletions": 24,
            "changes": 79,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmiddleware-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmiddleware-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmiddleware-turbopack.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -350,30 +350,14 @@ export function getOverlayMiddleware({\n       })\n \n       const request = JSON.parse(body) as OriginalStackFramesRequest\n-      const stackFrames = createStackFrames(request)\n-      const result: OriginalStackFramesResponse = await Promise.all(\n-        stackFrames.map(async (frame) => {\n-          try {\n-            const stackFrame = await createOriginalStackFrame(\n-              project,\n-              projectPath,\n-              frame\n-            )\n-            if (stackFrame === null) {\n-              return {\n-                status: 'rejected',\n-                reason: 'Failed to create original stack frame',\n-              }\n-            }\n-            return { status: 'fulfilled', value: stackFrame }\n-          } catch (error) {\n-            return {\n-              status: 'rejected',\n-              reason: inspect(error, { colors: false }),\n-            }\n-          }\n-        })\n-      )\n+      const result = await getOriginalStackFrames({\n+        project,\n+        projectPath,\n+        frames: request.frames,\n+        isServer: request.isServer,\n+        isEdgeServer: request.isEdgeServer,\n+        isAppDirectory: request.isAppDirectory,\n+      })\n \n       return middlewareResponse.json(res, result)\n     } else if (pathname === '/__nextjs_launch-editor') {\n@@ -473,3 +457,50 @@ export function getSourceMapMiddleware(project: Project) {\n     middlewareResponse.noContent(res)\n   }\n }\n+\n+export async function getOriginalStackFrames({\n+  project,\n+  projectPath,\n+  frames,\n+  isServer,\n+  isEdgeServer,\n+  isAppDirectory,\n+}: {\n+  project: Project\n+  projectPath: string\n+  frames: StackFrame[]\n+  isServer: boolean\n+  isEdgeServer: boolean\n+  isAppDirectory: boolean\n+}): Promise<OriginalStackFramesResponse> {\n+  const stackFrames = createStackFrames({\n+    frames,\n+    isServer,\n+    isEdgeServer,\n+    isAppDirectory,\n+  })\n+\n+  return Promise.all(\n+    stackFrames.map(async (frame) => {\n+      try {\n+        const stackFrame = await createOriginalStackFrame(\n+          project,\n+          projectPath,\n+          frame\n+        )\n+        if (stackFrame === null) {\n+          return {\n+            status: 'rejected',\n+            reason: 'Failed to create original stack frame',\n+          }\n+        }\n+        return { status: 'fulfilled', value: stackFrame }\n+      } catch (error) {\n+        return {\n+          status: 'rejected',\n+          reason: inspect(error, { colors: false }),\n+        }\n+      }\n+    })\n+  )\n+}"
        },
        {
            "sha": "7fef2f16a3774d0072a8fd174f81170f5a8fe8b1",
            "filename": "packages/next/src/server/dev/middleware-webpack.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 25,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmiddleware-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmiddleware-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmiddleware-webpack.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -377,7 +377,7 @@ async function getSource(\n   return undefined\n }\n \n-function getOriginalStackFrames({\n+export function getOriginalStackFrames({\n   isServer,\n   isEdgeServer,\n   isAppDirectory,\n@@ -397,31 +397,30 @@ function getOriginalStackFrames({\n   rootDirectory: string\n }): Promise<OriginalStackFramesResponse> {\n   return Promise.all(\n-    frames.map(\n-      (frame): Promise<OriginalStackFramesResponse[number]> =>\n-        getOriginalStackFrame({\n-          isServer,\n-          isEdgeServer,\n-          isAppDirectory,\n-          frame,\n-          clientStats,\n-          serverStats,\n-          edgeServerStats,\n-          rootDirectory,\n-        }).then(\n-          (value) => {\n-            return {\n-              status: 'fulfilled',\n-              value,\n-            }\n-          },\n-          (reason) => {\n-            return {\n-              status: 'rejected',\n-              reason: inspect(reason, { colors: false }),\n-            }\n+    frames.map((frame) =>\n+      getOriginalStackFrame({\n+        isServer,\n+        isEdgeServer,\n+        isAppDirectory,\n+        frame,\n+        clientStats,\n+        serverStats,\n+        edgeServerStats,\n+        rootDirectory,\n+      }).then(\n+        (value) => {\n+          return {\n+            status: 'fulfilled' as const,\n+            value,\n           }\n-        )\n+        },\n+        (reason) => {\n+          return {\n+            status: 'rejected' as const,\n+            reason: inspect(reason, { colors: false }),\n+          }\n+        }\n+      )\n     )\n   )\n }"
        },
        {
            "sha": "f60ba5d6116ad05ce7e64aa6892733900bf80ca1",
            "filename": "packages/next/src/server/lib/parse-stack.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fparse-stack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fparse-stack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fparse-stack.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -3,7 +3,10 @@ import type { StackFrame } from 'next/dist/compiled/stacktrace-parser'\n \n const regexNextStatic = /\\/_next(\\/static\\/.+)/\n \n-export function parseStack(stack: string): StackFrame[] {\n+export function parseStack(\n+  stack: string,\n+  distDir = process.env.__NEXT_DIST_DIR\n+): StackFrame[] {\n   if (!stack) return []\n \n   // throw away eval information that stacktrace-parser doesn't support\n@@ -28,11 +31,12 @@ export function parseStack(stack: string): StackFrame[] {\n       const url = new URL(frame.file!)\n       const res = regexNextStatic.exec(url.pathname)\n       if (res) {\n-        const distDir = process.env.__NEXT_DIST_DIR\n+        const effectiveDistDir = distDir\n           ?.replace(/\\\\/g, '/')\n           ?.replace(/\\/$/, '')\n-        if (distDir) {\n-          frame.file = 'file://' + distDir.concat(res.pop()!) + url.search\n+        if (effectiveDistDir) {\n+          frame.file =\n+            'file://' + effectiveDistDir.concat(res.pop()!) + url.search\n         }\n       }\n     } catch {}"
        },
        {
            "sha": "551a5512bf72a7911b5ad42c606ab0c2602a1b86",
            "filename": "packages/next/taskfile.js",
            "status": "modified",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Ftaskfile.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Ftaskfile.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftaskfile.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -2256,6 +2256,18 @@ export async function ncc_https_proxy_agent(task, opts) {\n     .target('src/compiled/https-proxy-agent')\n }\n \n+externals['safe-stable-stringify'] = 'next/dist/compiled/safe-stable-stringify'\n+export async function ncc_safe_stable_stringify(task, opts) {\n+  await task\n+    .source(relative(__dirname, require.resolve('safe-stable-stringify')))\n+    .ncc({\n+      packageName: 'safe-stable-stringify',\n+      externals,\n+      target: 'es5',\n+    })\n+    .target('src/compiled/safe-stable-stringify')\n+}\n+\n export async function precompile(task, opts) {\n   await task.parallel(\n     ['browser_polyfills', 'copy_ncced', 'copy_styled_jsx_assets'],\n@@ -2275,6 +2287,7 @@ export async function ncc(task, opts) {\n     .clear('src/compiled')\n     .parallel(\n       [\n+        'ncc_safe_stable_stringify',\n         'ncc_amp_optimizer',\n         'ncc_node_html_parser',\n         'ncc_napirs_triples',"
        },
        {
            "sha": "00322b0236ce6a4bb4df28e966aba1556b8df492",
            "filename": "packages/next/types/$$compiled.internal.d.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Ftypes%2F%24%24compiled.internal.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/packages%2Fnext%2Ftypes%2F%24%24compiled.internal.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftypes%2F%24%24compiled.internal.d.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -736,6 +736,11 @@ declare module 'next/dist/compiled/anser' {\n   export = m\n }\n \n+declare module 'next/dist/compiled/safe-stable-stringify' {\n+  import * as m from 'safe-stable-stringify'\n+  export = m\n+}\n+\n declare module 'next/dist/compiled/css.escape' {\n   export = CSS.escape\n }"
        },
        {
            "sha": "85b6b92f15828404d1e8a513fc922ee987b12a60",
            "filename": "pnpm-lock.yaml",
            "status": "modified",
            "additions": 76,
            "deletions": 68,
            "changes": 144,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/pnpm-lock.yaml",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/pnpm-lock.yaml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/pnpm-lock.yaml?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -516,7 +516,7 @@ importers:\n         version: react-server-dom-webpack@0.0.0-experimental-a7a11657-20250708(react-dom@19.2.0-canary-a7a11657-20250708(react@19.2.0-canary-a7a11657-20250708))(react@19.2.0-canary-a7a11657-20250708)(webpack@5.98.0(@swc/core@1.11.24(@swc/helpers@0.5.15)))\n       react-ssr-prepass:\n         specifier: 1.0.8\n-        version: 1.0.8(react-is@19.2.0-canary-fa3feba6-20250623)(react@19.2.0-canary-a7a11657-20250708)\n+        version: 1.0.8(react-is@19.2.0-canary-cee7939b-20250625)(react@19.2.0-canary-a7a11657-20250708)\n       react-virtualized:\n         specifier: 9.22.3\n         version: 9.22.3(react-dom@19.2.0-canary-a7a11657-20250708(react@19.2.0-canary-a7a11657-20250708))(react@19.2.0-canary-a7a11657-20250708)\n@@ -651,13 +651,13 @@ importers:\n     dependencies:\n       '@mantine/core':\n         specifier: ^7.10.1\n-        version: 7.10.1(@mantine/hooks@7.11.2(react@19.2.0-canary-fa3feba6-20250623))(@types/react@19.1.1)(react-dom@19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623))(react@19.2.0-canary-fa3feba6-20250623)\n+        version: 7.10.1(@mantine/hooks@7.11.2(react@19.2.0-canary-cee7939b-20250625))(@types/react@19.1.1)(react-dom@19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625))(react@19.2.0-canary-cee7939b-20250625)\n       lodash-es:\n         specifier: ^4.17.21\n         version: 4.17.21\n       lucide-react:\n         specifier: ^0.383.0\n-        version: 0.383.0(react@19.2.0-canary-fa3feba6-20250623)\n+        version: 0.383.0(react@19.2.0-canary-cee7939b-20250625)\n       mermaid:\n         specifier: ^10.9.1\n         version: 10.9.1\n@@ -1468,6 +1468,9 @@ importers:\n       regenerator-runtime:\n         specifier: 0.13.4\n         version: 0.13.4\n+      safe-stable-stringify:\n+        specifier: 2.5.0\n+        version: 2.5.0\n       sass-loader:\n         specifier: 15.0.0\n         version: 15.0.0(@rspack/core@1.4.5(@swc/helpers@0.5.15))(sass@1.77.8)(webpack@5.98.0(@swc/core@1.11.24(@swc/helpers@0.5.15))(esbuild@0.24.2))\n@@ -1669,7 +1672,7 @@ importers:\n         version: 2.2.1(webpack@5.98.0(@swc/core@1.11.24(@swc/helpers@0.5.15)))\n       '@mdx-js/react':\n         specifier: '>=0.15.0'\n-        version: 2.2.1(react@19.2.0-canary-fa3feba6-20250623)\n+        version: 2.2.1(react@19.2.0-canary-cee7939b-20250625)\n       source-map:\n         specifier: ^0.7.0\n         version: 0.7.3\n@@ -13928,7 +13931,6 @@ packages:\n     engines: {node: '>=0.6.0', teleport: '>=0.2.0'}\n     deprecated: |-\n       You or someone you depend on is using Q, the JavaScript Promise library that gave JavaScript developers strong feelings about promises. They can almost certainly migrate to the native JavaScript promise now. Thank you literally everyone for joining me in this bet against the odds. Be excellent to each other.\n-\n       (For a CapTP with native promises, see @endo/eventual-send and @endo/captp)\n \n   qs@6.11.0:\n@@ -14040,16 +14042,16 @@ packages:\n     peerDependencies:\n       react: 19.2.0-canary-a7a11657-20250708\n \n-  react-dom@19.2.0-canary-fa3feba6-20250623:\n-    resolution: {integrity: sha512-a/OyVKA4wJo1eBL82KJOBho8x2p2rZe/pubH94hGCBMfsty+x0xyB8KbE/YtNhXzMJaJ28PvvPceZ6WbqbDQlg==}\n+  react-dom@19.2.0-canary-cee7939b-20250625:\n+    resolution: {integrity: sha512-cKXbvGw8b+t+uxJZfNBK0oboEee5wYS3f8Yeu22PlW3eECtfDnM2pqSbcB6LvOVr3fyDMM4CIWesK01d9BXj7w==}\n     peerDependencies:\n       react: 19.2.0-canary-a7a11657-20250708\n \n   react-is@19.2.0-canary-a7a11657-20250708:\n     resolution: {integrity: sha512-19g7E/3eQbITMesIWYnBA3FX5hwCgqtbcsdOQ3k/NjmLK5HXFU3rSZV0Enil7bL2thu2pwYERXjQo+BmgZohZw==}\n \n-  react-is@19.2.0-canary-fa3feba6-20250623:\n-    resolution: {integrity: sha512-BktwFemMIkQdqE8Ijv9BzB7rx0yAk4xndThBAi8cLnkMOd6Imm+XBeTweHHuMhehtTK623DIsWT1roVRBUby8Q==}\n+  react-is@19.2.0-canary-cee7939b-20250625:\n+    resolution: {integrity: sha512-AsmZ5fWwYOQXykkjT/OBo2n30UH+014Jefhv9qiKxuw8AqD5QMi47Px3Fw86YLtZPOxWQOsvVMqHKwFvW35Q/w==}\n \n   react-lifecycles-compat@3.0.4:\n     resolution: {integrity: sha512-fBASbA6LnOU9dOU2eW7aQ8xmYBSXUIWr+UmF9b1efZBazGNO+rcXT/icdKnYm2pTwcRylVUYwW7H1PHfLekVzA==}\n@@ -14160,8 +14162,8 @@ packages:\n     resolution: {integrity: sha512-r/Da+Thg79ljp0aVkxvITXx2J1FfixiHLRMoGQeIaql7as56YfG7wkiagKy2RpPdX+X8AOgTS95bGMFg1jEJ5g==}\n     engines: {node: '>=0.10.0'}\n \n-  react@19.2.0-canary-fa3feba6-20250623:\n-    resolution: {integrity: sha512-85ryAyG3hpmDCR0PJy8D9PN10XyiBs0U948be5uGj8FqT48NGHujMlzEKrcBgzfYrsuom6lJVO7Ly2iag+Bj5g==}\n+  react@19.2.0-canary-cee7939b-20250625:\n+    resolution: {integrity: sha512-MDouKrROK4xfih07q2fuBiofvnV1oSPs5Bm/+vulj3XCTG1FiGaG45tmWV0re0w9sRj8wi84rEXMIw1Gw3/IVg==}\n     engines: {node: '>=0.10.0'}\n \n   read-cache@1.0.0:\n@@ -14665,6 +14667,10 @@ packages:\n     resolution: {integrity: sha512-CdASjNJPvRa7roO6Ra/gLYBTzYzzPyyBXxIMdGW3USQLyjWEls2RgW5UBTXaQVp+OrpeCK3bLem8smtmheoRuw==}\n     engines: {node: '>= 0.4'}\n \n+  safe-stable-stringify@2.5.0:\n+    resolution: {integrity: sha512-b3rppTKm9T+PsVCBEOUR46GWI7fdOs00VKZ1+9c1EWDaDMvjQc6tUwuFyIprgGgTcWoVHSKrU8H31ZHA2e0RHA==}\n+    engines: {node: '>=10'}\n+\n   safer-buffer@2.1.2:\n     resolution: {integrity: sha512-YZo3K82SD7Riyi0E1EQPojLz7kpepnSQI9IyPbHHg1XXXevb5dJI7tpyN2ADxGcQbHG7vcyRHk0cbwqcQriUtg==}\n \n@@ -15396,7 +15402,7 @@ packages:\n   superagent@3.8.3:\n     resolution: {integrity: sha512-GLQtLMCoEIK4eDv6OGtkOoSMt3D+oq0y3dsxMuYuDvaNUvuT8eFBuLmfR0iYYzHC1e8hpzC6ZsxbuP6DIalMFA==}\n     engines: {node: '>= 4.0'}\n-    deprecated: Please upgrade to v7.0.2+ of superagent.  We have fixed numerous issues with streams, form-data, attach(), filesystem errors not bubbling up (ENOENT on attach()), and all tests are now passing.  See the releases tab for more information at <https://github.com/visionmedia/superagent/releases>.\n+    deprecated: Please upgrade to v9.0.0+ as we have fixed a public vulnerability with formidable dependency. Note that v9.0.0+ requires Node.js v14.18.0+. See https://github.com/ladjs/superagent/pull/1800 for insight. This project is supported and maintained by the team at Forward Email @ https://forwardemail.net\n \n   superstruct@1.0.3:\n     resolution: {integrity: sha512-8iTn3oSS8nRGn+C2pgXSKPI3jmpm6FExNazNpjvqS6ZUJQCej3PUXEKM8NjHBOs54ExM+LPW/FBRhymrdcCiSg==}\n@@ -18867,24 +18873,24 @@ snapshots:\n       '@floating-ui/core': 1.7.2\n       '@floating-ui/utils': 0.2.10\n \n-  '@floating-ui/react-dom@2.1.0(react-dom@19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623))(react@19.2.0-canary-fa3feba6-20250623)':\n+  '@floating-ui/react-dom@2.1.0(react-dom@19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625))(react@19.2.0-canary-cee7939b-20250625)':\n     dependencies:\n       '@floating-ui/dom': 1.6.5\n-      react: 19.2.0-canary-fa3feba6-20250623\n-      react-dom: 19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623)\n+      react: 19.2.0-canary-cee7939b-20250625\n+      react-dom: 19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625)\n \n   '@floating-ui/react-dom@2.1.4(react-dom@19.2.0-canary-a7a11657-20250708(react@19.2.0-canary-a7a11657-20250708))(react@19.2.0-canary-a7a11657-20250708)':\n     dependencies:\n       '@floating-ui/dom': 1.7.2\n       react: 19.2.0-canary-a7a11657-20250708\n       react-dom: 19.2.0-canary-a7a11657-20250708(react@19.2.0-canary-a7a11657-20250708)\n \n-  '@floating-ui/react@0.26.16(react-dom@19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623))(react@19.2.0-canary-fa3feba6-20250623)':\n+  '@floating-ui/react@0.26.16(react-dom@19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625))(react@19.2.0-canary-cee7939b-20250625)':\n     dependencies:\n-      '@floating-ui/react-dom': 2.1.0(react-dom@19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623))(react@19.2.0-canary-fa3feba6-20250623)\n+      '@floating-ui/react-dom': 2.1.0(react-dom@19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625))(react@19.2.0-canary-cee7939b-20250625)\n       '@floating-ui/utils': 0.2.2\n-      react: 19.2.0-canary-fa3feba6-20250623\n-      react-dom: 19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623)\n+      react: 19.2.0-canary-cee7939b-20250625\n+      react-dom: 19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625)\n       tabbable: 6.2.0\n \n   '@floating-ui/utils@0.2.10': {}\n@@ -19943,23 +19949,23 @@ snapshots:\n     dependencies:\n       call-bind: 1.0.7\n \n-  '@mantine/core@7.10.1(@mantine/hooks@7.11.2(react@19.2.0-canary-fa3feba6-20250623))(@types/react@19.1.1)(react-dom@19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623))(react@19.2.0-canary-fa3feba6-20250623)':\n+  '@mantine/core@7.10.1(@mantine/hooks@7.11.2(react@19.2.0-canary-cee7939b-20250625))(@types/react@19.1.1)(react-dom@19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625))(react@19.2.0-canary-cee7939b-20250625)':\n     dependencies:\n-      '@floating-ui/react': 0.26.16(react-dom@19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623))(react@19.2.0-canary-fa3feba6-20250623)\n-      '@mantine/hooks': 7.11.2(react@19.2.0-canary-fa3feba6-20250623)\n+      '@floating-ui/react': 0.26.16(react-dom@19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625))(react@19.2.0-canary-cee7939b-20250625)\n+      '@mantine/hooks': 7.11.2(react@19.2.0-canary-cee7939b-20250625)\n       clsx: 2.1.1\n-      react: 19.2.0-canary-fa3feba6-20250623\n-      react-dom: 19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623)\n-      react-number-format: 5.4.0(react-dom@19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623))(react@19.2.0-canary-fa3feba6-20250623)\n-      react-remove-scroll: 2.5.10(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623)\n-      react-textarea-autosize: 8.5.3(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623)\n+      react: 19.2.0-canary-cee7939b-20250625\n+      react-dom: 19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625)\n+      react-number-format: 5.4.0(react-dom@19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625))(react@19.2.0-canary-cee7939b-20250625)\n+      react-remove-scroll: 2.5.10(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625)\n+      react-textarea-autosize: 8.5.3(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625)\n       type-fest: 4.18.3\n     transitivePeerDependencies:\n       - '@types/react'\n \n-  '@mantine/hooks@7.11.2(react@19.2.0-canary-fa3feba6-20250623)':\n+  '@mantine/hooks@7.11.2(react@19.2.0-canary-cee7939b-20250625)':\n     dependencies:\n-      react: 19.2.0-canary-fa3feba6-20250623\n+      react: 19.2.0-canary-cee7939b-20250625\n \n   '@manypkg/find-root@1.1.0':\n     dependencies:\n@@ -20028,11 +20034,11 @@ snapshots:\n       '@types/react': 19.1.1\n       react: 19.2.0-canary-a7a11657-20250708\n \n-  '@mdx-js/react@2.2.1(react@19.2.0-canary-fa3feba6-20250623)':\n+  '@mdx-js/react@2.2.1(react@19.2.0-canary-cee7939b-20250625)':\n     dependencies:\n       '@types/mdx': 2.0.3\n       '@types/react': 19.1.1\n-      react: 19.2.0-canary-fa3feba6-20250623\n+      react: 19.2.0-canary-cee7939b-20250625\n \n   '@mdx-js/react@3.1.0(@types/react@19.1.1)(react@19.2.0-canary-a7a11657-20250708)':\n     dependencies:\n@@ -29024,9 +29030,9 @@ snapshots:\n \n   lru-cache@7.18.3: {}\n \n-  lucide-react@0.383.0(react@19.2.0-canary-fa3feba6-20250623):\n+  lucide-react@0.383.0(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n-      react: 19.2.0-canary-fa3feba6-20250623\n+      react: 19.2.0-canary-cee7939b-20250625\n \n   lz-string@1.5.0: {}\n \n@@ -32237,41 +32243,41 @@ snapshots:\n       react: 19.2.0-canary-a7a11657-20250708\n       scheduler: 0.27.0-canary-a7a11657-20250708\n \n-  react-dom@19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623):\n+  react-dom@19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n-      react: 19.2.0-canary-fa3feba6-20250623\n+      react: 19.2.0-canary-cee7939b-20250625\n       scheduler: 0.27.0-canary-a7a11657-20250708\n \n   react-is@19.2.0-canary-a7a11657-20250708: {}\n \n-  react-is@19.2.0-canary-fa3feba6-20250623: {}\n+  react-is@19.2.0-canary-cee7939b-20250625: {}\n \n   react-lifecycles-compat@3.0.4: {}\n \n-  react-number-format@5.4.0(react-dom@19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623))(react@19.2.0-canary-fa3feba6-20250623):\n+  react-number-format@5.4.0(react-dom@19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625))(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n       prop-types: 15.8.1\n-      react: 19.2.0-canary-fa3feba6-20250623\n-      react-dom: 19.2.0-canary-fa3feba6-20250623(react@19.2.0-canary-fa3feba6-20250623)\n+      react: 19.2.0-canary-cee7939b-20250625\n+      react-dom: 19.2.0-canary-cee7939b-20250625(react@19.2.0-canary-cee7939b-20250625)\n \n   react-refresh@0.12.0: {}\n \n-  react-remove-scroll-bar@2.3.6(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623):\n+  react-remove-scroll-bar@2.3.6(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n-      react: 19.2.0-canary-fa3feba6-20250623\n-      react-style-singleton: 2.2.1(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623)\n+      react: 19.2.0-canary-cee7939b-20250625\n+      react-style-singleton: 2.2.1(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625)\n       tslib: 2.8.1\n     optionalDependencies:\n       '@types/react': 19.1.1\n \n-  react-remove-scroll@2.5.10(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623):\n+  react-remove-scroll@2.5.10(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n-      react: 19.2.0-canary-fa3feba6-20250623\n-      react-remove-scroll-bar: 2.3.6(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623)\n-      react-style-singleton: 2.2.1(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623)\n+      react: 19.2.0-canary-cee7939b-20250625\n+      react-remove-scroll-bar: 2.3.6(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625)\n+      react-style-singleton: 2.2.1(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625)\n       tslib: 2.8.1\n-      use-callback-ref: 1.3.2(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623)\n-      use-sidecar: 1.1.2(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623)\n+      use-callback-ref: 1.3.2(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625)\n+      use-sidecar: 1.1.2(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625)\n     optionalDependencies:\n       '@types/react': 19.1.1\n \n@@ -32313,17 +32319,17 @@ snapshots:\n       react: 19.2.0-canary-a7a11657-20250708\n       react-is: 19.2.0-canary-a7a11657-20250708\n \n-  react-ssr-prepass@1.0.8(react-is@19.2.0-canary-fa3feba6-20250623)(react@19.2.0-canary-a7a11657-20250708):\n+  react-ssr-prepass@1.0.8(react-is@19.2.0-canary-cee7939b-20250625)(react@19.2.0-canary-a7a11657-20250708):\n     dependencies:\n       object-is: 1.0.2\n       react: 19.2.0-canary-a7a11657-20250708\n-      react-is: 19.2.0-canary-fa3feba6-20250623\n+      react-is: 19.2.0-canary-cee7939b-20250625\n \n-  react-style-singleton@2.2.1(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623):\n+  react-style-singleton@2.2.1(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n       get-nonce: 1.0.1\n       invariant: 2.2.4\n-      react: 19.2.0-canary-fa3feba6-20250623\n+      react: 19.2.0-canary-cee7939b-20250625\n       tslib: 2.8.1\n     optionalDependencies:\n       '@types/react': 19.1.1\n@@ -32335,12 +32341,12 @@ snapshots:\n       react-shallow-renderer: 16.15.0(react@19.2.0-canary-a7a11657-20250708)\n       scheduler: 0.27.0-canary-a7a11657-20250708\n \n-  react-textarea-autosize@8.5.3(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623):\n+  react-textarea-autosize@8.5.3(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n       '@babel/runtime': 7.27.0\n-      react: 19.2.0-canary-fa3feba6-20250623\n-      use-composed-ref: 1.3.0(react@19.2.0-canary-fa3feba6-20250623)\n-      use-latest: 1.2.1(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623)\n+      react: 19.2.0-canary-cee7939b-20250625\n+      use-composed-ref: 1.3.0(react@19.2.0-canary-cee7939b-20250625)\n+      use-latest: 1.2.1(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625)\n     transitivePeerDependencies:\n       - '@types/react'\n \n@@ -32359,7 +32365,7 @@ snapshots:\n \n   react@19.2.0-canary-a7a11657-20250708: {}\n \n-  react@19.2.0-canary-fa3feba6-20250623: {}\n+  react@19.2.0-canary-cee7939b-20250625: {}\n \n   read-cache@1.0.0:\n     dependencies:\n@@ -33078,6 +33084,8 @@ snapshots:\n       es-errors: 1.3.0\n       is-regex: 1.1.4\n \n+  safe-stable-stringify@2.5.0: {}\n+\n   safer-buffer@2.1.2: {}\n \n   sass-loader@15.0.0(@rspack/core@1.4.5(@swc/helpers@0.5.15))(sass@1.77.8)(webpack@5.98.0(@swc/core@1.11.24(@swc/helpers@0.5.15))(esbuild@0.24.2)):\n@@ -34915,34 +34923,34 @@ snapshots:\n       punycode: 1.4.1\n       qs: 6.13.1\n \n-  use-callback-ref@1.3.2(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623):\n+  use-callback-ref@1.3.2(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n-      react: 19.2.0-canary-fa3feba6-20250623\n+      react: 19.2.0-canary-cee7939b-20250625\n       tslib: 2.8.1\n     optionalDependencies:\n       '@types/react': 19.1.1\n \n-  use-composed-ref@1.3.0(react@19.2.0-canary-fa3feba6-20250623):\n+  use-composed-ref@1.3.0(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n-      react: 19.2.0-canary-fa3feba6-20250623\n+      react: 19.2.0-canary-cee7939b-20250625\n \n-  use-isomorphic-layout-effect@1.1.2(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623):\n+  use-isomorphic-layout-effect@1.1.2(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n-      react: 19.2.0-canary-fa3feba6-20250623\n+      react: 19.2.0-canary-cee7939b-20250625\n     optionalDependencies:\n       '@types/react': 19.1.1\n \n-  use-latest@1.2.1(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623):\n+  use-latest@1.2.1(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n-      react: 19.2.0-canary-fa3feba6-20250623\n-      use-isomorphic-layout-effect: 1.1.2(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623)\n+      react: 19.2.0-canary-cee7939b-20250625\n+      use-isomorphic-layout-effect: 1.1.2(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625)\n     optionalDependencies:\n       '@types/react': 19.1.1\n \n-  use-sidecar@1.1.2(@types/react@19.1.1)(react@19.2.0-canary-fa3feba6-20250623):\n+  use-sidecar@1.1.2(@types/react@19.1.1)(react@19.2.0-canary-cee7939b-20250625):\n     dependencies:\n       detect-node-es: 1.1.0\n-      react: 19.2.0-canary-fa3feba6-20250623\n+      react: 19.2.0-canary-cee7939b-20250625\n       tslib: 2.8.1\n     optionalDependencies:\n       '@types/react': 19.1.1"
        },
        {
            "sha": "2784e650c922bd1aa0bc260d3063cf17db4b7af8",
            "filename": "test/development/browser-logs/browser-logs.test.ts",
            "status": "added",
            "additions": 387,
            "deletions": 0,
            "changes": 387,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Fbrowser-logs.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Fbrowser-logs.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Fbrowser-logs.test.ts?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,387 @@\n+import { createNext, FileRef } from 'e2e-utils'\n+import { NextInstance } from 'e2e-utils'\n+import webdriver from 'next-webdriver'\n+import { join } from 'path'\n+import stripAnsi from 'strip-ansi'\n+import { retry } from 'next-test-utils'\n+\n+const bundlerName = process.env.IS_TURBOPACK_TEST ? 'Turbopack' : 'Webpack'\n+\n+function setupLogCapture() {\n+  const logs: string[] = []\n+  const originalStdout = process.stdout.write\n+  const originalStderr = process.stderr.write\n+\n+  const capture = (chunk: any) => {\n+    logs.push(stripAnsi(chunk.toString()))\n+    return true\n+  }\n+\n+  process.stdout.write = function (chunk: any) {\n+    capture(chunk)\n+    return originalStdout.call(this, chunk)\n+  }\n+\n+  process.stderr.write = function (chunk: any) {\n+    capture(chunk)\n+    return originalStderr.call(this, chunk)\n+  }\n+\n+  const restore = () => {\n+    process.stdout.write = originalStdout\n+    process.stderr.write = originalStderr\n+  }\n+\n+  const clearLogs = () => {\n+    logs.length = 0\n+  }\n+\n+  return { logs, restore, clearLogs }\n+}\n+\n+describe(`Terminal Logging (${bundlerName})`, () => {\n+  describe('Pages Router', () => {\n+    let next: NextInstance\n+    let logs: string[] = []\n+    let logCapture: ReturnType<typeof setupLogCapture>\n+    let browser = null\n+\n+    beforeAll(async () => {\n+      logCapture = setupLogCapture()\n+      logs = logCapture.logs\n+\n+      next = await createNext({\n+        files: {\n+          pages: new FileRef(join(__dirname, 'fixtures/pages')),\n+          'next.config.js': `\n+            module.exports = {\n+              experimental: {\n+                browserDebugInfoInTerminal: true\n+              }\n+            }\n+          `,\n+        },\n+      })\n+    })\n+\n+    afterAll(async () => {\n+      logCapture.restore()\n+      await next.destroy()\n+    })\n+\n+    beforeEach(() => {\n+      logCapture.clearLogs()\n+    })\n+\n+    afterEach(async () => {\n+      if (browser) {\n+        await browser.close()\n+        browser = null\n+      }\n+    })\n+\n+    it('should forward client component logs', async () => {\n+      browser = await webdriver(next.url, '/pages-client-log')\n+      await browser.waitForElementByCss('#log-button')\n+      await browser.elementByCss('#log-button').click()\n+\n+      await retry(() => {\n+        const logOutput = logs.join('')\n+        expect(logOutput).toContain(\n+          '[browser] Log from pages router client component'\n+        )\n+      })\n+    })\n+\n+    it('should handle circular references safely', async () => {\n+      browser = await webdriver(next.url, '/circular-refs')\n+      await browser.waitForElementByCss('#circular-button')\n+      await browser.elementByCss('#circular-button').click()\n+\n+      await retry(() => {\n+        const logOutput = logs.join('\\n')\n+        expect(logOutput).toContain('[browser] Circular object:')\n+        expect(logOutput).toContain('[Circular]')\n+      })\n+    })\n+\n+    it('should respect default depth limit', async () => {\n+      browser = await webdriver(next.url, '/deep-objects')\n+      await browser.waitForElementByCss('#deep-button')\n+      await browser.elementByCss('#deep-button').click()\n+\n+      await retry(() => {\n+        const logOutput = logs.join('\\n')\n+        expect(logOutput).toContain('[browser] Deep object: {')\n+        expect(logOutput).toContain('level1: {')\n+        expect(logOutput).toContain('level2: { level3: { level4: { level5:')\n+        expect(logOutput).toContain(\"'[Object]'\")\n+      })\n+    })\n+\n+    it('should show source-mapped errors in pages router', async () => {\n+      browser = await webdriver(next.url, '/pages-client-error')\n+      await browser.waitForElementByCss('#error-button')\n+\n+      logCapture.clearLogs()\n+\n+      await browser.elementByCss('#error-button').click()\n+\n+      await retry(() => {\n+        const logOutput = logs.join('\\n')\n+        const browserErrorPattern =\n+          /\\[browser\\] Uncaught Error: Client error in pages router\\n\\s+at throwClientError \\(pages\\/pages-client-error\\.js:2:\\d+\\)\\n\\s+at callClientError \\(pages\\/pages-client-error\\.js:6:\\d+\\)/\n+        expect(logOutput).toMatch(browserErrorPattern)\n+      })\n+    })\n+\n+    it('should show source-mapped errors for server errors from pages router ', async () => {\n+      const outputIndex = logs.length\n+\n+      browser = await webdriver(next.url, '/pages-server-error')\n+\n+      await retry(() => {\n+        const newLogs = logs.slice(outputIndex).join('\\n')\n+\n+        const browserErrorPattern =\n+          /\\[browser\\] Uncaught Error: Server error in pages router\\n\\s+at throwPagesServerError \\(pages\\/pages-server-error\\.js:2:\\d+\\)\\n\\s+at callPagesServerError \\(pages\\/pages-server-error\\.js:6:\\d+\\)/\n+        expect(newLogs).toMatch(browserErrorPattern)\n+      })\n+    })\n+  })\n+\n+  describe('App Router - Server Components', () => {\n+    let next: NextInstance\n+    let logs: string[] = []\n+    let logCapture: ReturnType<typeof setupLogCapture>\n+\n+    beforeAll(async () => {\n+      logCapture = setupLogCapture()\n+      logs = logCapture.logs\n+\n+      next = await createNext({\n+        files: {\n+          app: new FileRef(join(__dirname, 'fixtures/app')),\n+          'next.config.js': `\n+            module.exports = {\n+              experimental: {\n+                browserDebugInfoInTerminal: true\n+              }\n+            }\n+          `,\n+        },\n+      })\n+    })\n+\n+    afterAll(async () => {\n+      logCapture.restore()\n+      await next.destroy()\n+    })\n+\n+    beforeEach(() => {\n+      logCapture.clearLogs()\n+    })\n+\n+    it('should not re-log server component logs', async () => {\n+      const outputIndex = logs.length\n+      await next.render('/server-log')\n+\n+      await retry(() => {\n+        const newLogs = logs.slice(outputIndex).join('')\n+        expect(newLogs).toContain('Server component console.log')\n+      }, 2000)\n+\n+      const newLogs = logs.slice(outputIndex).join('')\n+\n+      expect(newLogs).not.toContain('[browser] Server component console.log')\n+      expect(newLogs).not.toContain('[browser] Server component console.error')\n+    })\n+\n+    it('should show source-mapped errors for server components', async () => {\n+      const outputIndex = logs.length\n+\n+      const browser = await webdriver(next.url, '/server-error')\n+\n+      await retry(() => {\n+        const newLogs = logs.slice(outputIndex).join('\\n')\n+\n+        const browserErrorPattern =\n+          /\\[browser\\] Uncaught Error: Server component error in app router\\n\\s+at throwServerError \\(app\\/server-error\\/page\\.js:2:\\d+\\)\\n\\s+at callServerError \\(app\\/server-error\\/page\\.js:6:\\d+\\)\\n\\s+at ServerErrorPage \\(app\\/server-error\\/page\\.js:10:\\d+\\)/\n+        expect(newLogs).toMatch(browserErrorPattern)\n+      })\n+\n+      await browser.close()\n+    })\n+  })\n+\n+  describe('App Router - Client Components', () => {\n+    let next: NextInstance\n+    let logs: string[] = []\n+    let logCapture: ReturnType<typeof setupLogCapture>\n+\n+    beforeAll(async () => {\n+      logCapture = setupLogCapture()\n+      logs = logCapture.logs\n+\n+      next = await createNext({\n+        files: {\n+          app: new FileRef(join(__dirname, 'fixtures/app')),\n+          'next.config.js': `\n+            module.exports = {\n+              experimental: {\n+                browserDebugInfoInTerminal: true\n+              }\n+            }\n+          `,\n+        },\n+      })\n+    })\n+\n+    afterAll(async () => {\n+      logCapture.restore()\n+      await next.destroy()\n+    })\n+\n+    beforeEach(() => {\n+      logCapture.clearLogs()\n+    })\n+\n+    it('should forward client component logs in app router', async () => {\n+      const browser = await webdriver(next.url, '/client-log')\n+      await browser.waitForElementByCss('#log-button')\n+      await browser.elementByCss('#log-button').click()\n+\n+      await retry(() => {\n+        const logOutput = logs.join('')\n+        expect(logOutput).toContain(\n+          '[browser] Client component log from app router'\n+        )\n+      })\n+\n+      await browser.close()\n+    })\n+\n+    it('should show source-mapped errors for client components', async () => {\n+      const browser = await webdriver(next.url, '/client-error')\n+      await browser.waitForElementByCss('#error-button')\n+\n+      logCapture.clearLogs()\n+\n+      await browser.elementByCss('#error-button').click()\n+\n+      await retry(() => {\n+        const logOutput = logs.join('\\n')\n+        const browserErrorPattern =\n+          /\\[browser\\] Uncaught Error: Client component error in app router\\n\\s+at throwError \\(app\\/client-error\\/page\\.js:4:\\d+\\)\\n\\s+at callError \\(app\\/client-error\\/page\\.js:8:\\d+\\)/\n+        expect(logOutput).toMatch(browserErrorPattern)\n+      })\n+\n+      await browser.close()\n+    })\n+  })\n+\n+  describe('App Router - Edge Runtime', () => {\n+    let next: NextInstance\n+    let logs: string[] = []\n+    let logCapture: ReturnType<typeof setupLogCapture>\n+\n+    beforeAll(async () => {\n+      logCapture = setupLogCapture()\n+      logs = logCapture.logs\n+\n+      next = await createNext({\n+        files: {\n+          app: new FileRef(join(__dirname, 'fixtures/app')),\n+          'next.config.js': `\n+            module.exports = {\n+              experimental: {\n+                browserDebugInfoInTerminal: true\n+              }\n+            }\n+          `,\n+        },\n+      })\n+    })\n+\n+    afterAll(async () => {\n+      logCapture.restore()\n+      await next.destroy()\n+    })\n+\n+    beforeEach(() => {\n+      logCapture.clearLogs()\n+    })\n+\n+    it('should handle edge runtime errors with source mapping', async () => {\n+      const browser = await webdriver(next.url, '/edge-deep-stack')\n+\n+      await retry(() => {\n+        const logOutput = logs.join('\\n')\n+\n+        const browserErrorPattern =\n+          /\\[browser\\] Uncaught Error: Deep stack error during render\\n\\s+at functionA \\(app\\/edge-deep-stack\\/page\\.js:6:\\d+\\)\\n\\s+at functionB \\(app\\/edge-deep-stack\\/page\\.js:10:\\d+\\)\\n\\s+at functionC \\(app\\/edge-deep-stack\\/page\\.js:14:\\d+\\)\\n\\s+at EdgeDeepStackPage \\(app\\/edge-deep-stack\\/page\\.js:18:\\d+\\)/\n+        expect(logOutput).toMatch(browserErrorPattern)\n+      })\n+\n+      await browser.close()\n+    })\n+  })\n+\n+  describe('Configuration Options', () => {\n+    describe('showSourceLocation disabled', () => {\n+      let next: NextInstance\n+      let logs: string[] = []\n+      let logCapture: ReturnType<typeof setupLogCapture>\n+      let browser = null\n+\n+      beforeAll(async () => {\n+        logCapture = setupLogCapture()\n+        logs = logCapture.logs\n+\n+        next = await createNext({\n+          files: {\n+            pages: new FileRef(join(__dirname, 'fixtures/pages')),\n+            'next.config.js': `\n+              module.exports = {\n+                experimental: {\n+                  browserDebugInfoInTerminal: {\n+                    showSourceLocation: false\n+                  }\n+                }\n+              }\n+            `,\n+          },\n+        })\n+      })\n+\n+      afterAll(async () => {\n+        logCapture.restore()\n+        await next.destroy()\n+      })\n+\n+      beforeEach(() => {\n+        logCapture.clearLogs()\n+      })\n+\n+      afterEach(async () => {\n+        if (browser) {\n+          await browser.close()\n+          browser = null\n+        }\n+      })\n+\n+      it('should omit source location when disabled', async () => {\n+        browser = await webdriver(next.url, '/basic-logs')\n+\n+        await browser.waitForElementByCss('#log-button')\n+        await browser.elementByCss('#log-button').click()\n+\n+        await retry(() => {\n+          const logOutput = logs.join('')\n+          expect(logOutput).toContain('[browser] Hello from browser')\n+          expect(logOutput).not.toMatch(/\\([^)]+basic-logs\\.[jt]sx?:\\d+:\\d+\\)/)\n+        })\n+      })\n+    })\n+  })\n+})"
        },
        {
            "sha": "d6a0cadf7e96484ac38a057c93e925712ff30696",
            "filename": "test/development/browser-logs/fixtures/app/client-error/page.js",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fclient-error%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fclient-error%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fclient-error%2Fpage.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,24 @@\n+'use client'\n+\n+function throwError() {\n+  throw new Error('Client component error in app router')\n+}\n+\n+function callError() {\n+  throwError()\n+}\n+\n+export default function ClientErrorPage() {\n+  return (\n+    <div>\n+      <button\n+        id=\"error-button\"\n+        onClick={() => {\n+          callError()\n+        }}\n+      >\n+        Throw Error\n+      </button>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "d25bb42bdf94cdae156c873ed913ba7ce93be475",
            "filename": "test/development/browser-logs/fixtures/app/client-log/page.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fclient-log%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fclient-log%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fclient-log%2Fpage.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,16 @@\n+'use client'\n+\n+export default function ClientLogPage() {\n+  return (\n+    <div>\n+      <button\n+        id=\"log-button\"\n+        onClick={() => {\n+          console.log('Client component log from app router')\n+        }}\n+      >\n+        test button\n+      </button>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "008dcee2ddc15fccf610a4687835002ef6a1752e",
            "filename": "test/development/browser-logs/fixtures/app/edge-deep-stack/page.js",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fedge-deep-stack%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fedge-deep-stack%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fedge-deep-stack%2Fpage.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,21 @@\n+'use client'\n+\n+export const runtime = 'edge'\n+\n+function functionA() {\n+  throw new Error('Deep stack error during render')\n+}\n+\n+function functionB() {\n+  functionA()\n+}\n+\n+function functionC() {\n+  functionB()\n+}\n+\n+export default function EdgeDeepStackPage() {\n+  functionC()\n+\n+  return <div></div>\n+}"
        },
        {
            "sha": "4ee00a218505ac95ed8f4b2cb12779643277286d",
            "filename": "test/development/browser-logs/fixtures/app/layout.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Flayout.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Flayout.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Flayout.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,7 @@\n+export default function RootLayout({ children }) {\n+  return (\n+    <html lang=\"en\">\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "0421db5586f10c14e631cd91eb7d492af4877825",
            "filename": "test/development/browser-logs/fixtures/app/server-error/page.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fserver-error%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fserver-error%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fserver-error%2Fpage.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,13 @@\n+function throwServerError() {\n+  throw new Error('Server component error in app router')\n+}\n+\n+function callServerError() {\n+  throwServerError()\n+}\n+\n+export default function ServerErrorPage() {\n+  callServerError()\n+\n+  return <div></div>\n+}"
        },
        {
            "sha": "0d54ff70864d38059512f2c414a18eafbf14a0e2",
            "filename": "test/development/browser-logs/fixtures/app/server-log/page.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fserver-log%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fserver-log%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fapp%2Fserver-log%2Fpage.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,6 @@\n+export default function ServerLogPage() {\n+  console.log('Server component console.log')\n+  console.error('Server component console.error')\n+\n+  return <div></div>\n+}"
        },
        {
            "sha": "49fb86d89283ae030ce8304d1c4d379a4474097c",
            "filename": "test/development/browser-logs/fixtures/pages/basic-logs.js",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fbasic-logs.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fbasic-logs.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fbasic-logs.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,30 @@\n+export default function BasicLogsPage() {\n+  return (\n+    <div>\n+      <button\n+        id=\"log-button\"\n+        onClick={() => {\n+          console.log('Hello from browser')\n+        }}\n+      >\n+        Log Message\n+      </button>\n+      <button\n+        id=\"error-button\"\n+        onClick={() => {\n+          console.error('Error from browser')\n+        }}\n+      >\n+        Log Error\n+      </button>\n+      <button\n+        id=\"warn-button\"\n+        onClick={() => {\n+          console.warn('Warning message')\n+        }}\n+      >\n+        Log Warning\n+      </button>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "780be4b0b6ae9ba6767d7dd279581e70d88c24b3",
            "filename": "test/development/browser-logs/fixtures/pages/circular-refs.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fcircular-refs.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fcircular-refs.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fcircular-refs.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,16 @@\n+export default function CircularRefsPage() {\n+  return (\n+    <div>\n+      <button\n+        id=\"circular-button\"\n+        onClick={() => {\n+          const obj = { name: 'test' }\n+          obj.self = obj\n+          console.log('Circular object:', obj)\n+        }}\n+      >\n+        Log Circular Object\n+      </button>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "99f8d6366e19dcc97db5ff7ca62bbb6dca97e1ff",
            "filename": "test/development/browser-logs/fixtures/pages/deep-objects.js",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fdeep-objects.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fdeep-objects.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fdeep-objects.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,29 @@\n+export default function DeepObjectsPage() {\n+  return (\n+    <div>\n+      <button\n+        id=\"deep-button\"\n+        onClick={() => {\n+          const deepObj = {\n+            level1: {\n+              level2: {\n+                level3: {\n+                  level4: {\n+                    level5: {\n+                      level6: {\n+                        level7: 'this should be cut off',\n+                      },\n+                    },\n+                  },\n+                },\n+              },\n+            },\n+          }\n+          console.log('Deep object:', deepObj)\n+        }}\n+      >\n+        Log Deep Object\n+      </button>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "811c8915442da72dfd0f429d9a94e65454e2a9c7",
            "filename": "test/development/browser-logs/fixtures/pages/pages-client-error.js",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fpages-client-error.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fpages-client-error.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fpages-client-error.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,20 @@\n+function throwClientError() {\n+  throw new Error('Client error in pages router')\n+}\n+\n+function callClientError() {\n+  throwClientError()\n+}\n+\n+export default function PagesClientError() {\n+  return (\n+    <div>\n+      <button\n+        id=\"error-button\"\n+        onClick={() => {\n+          callClientError()\n+        }}\n+      ></button>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "4d63ffcafbfe31b20874a6aa35eee6498ba9fa23",
            "filename": "test/development/browser-logs/fixtures/pages/pages-client-log.js",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fpages-client-log.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fpages-client-log.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fpages-client-log.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,22 @@\n+export default function PagesClientLog() {\n+  return (\n+    <div>\n+      <button\n+        id=\"log-button\"\n+        onClick={() => {\n+          console.log('Log from pages router client component')\n+        }}\n+      >\n+        Log Message\n+      </button>\n+      <button\n+        id=\"error-button\"\n+        onClick={() => {\n+          console.error('Error from pages router')\n+        }}\n+      >\n+        Log Error\n+      </button>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "49d627f744c47675853c535b0432e6585ad70328",
            "filename": "test/development/browser-logs/fixtures/pages/pages-server-error.js",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fpages-server-error.js",
            "raw_url": "https://github.com/vercel/next.js/raw/94f8aecf2622d778b097780eec0992104f709528/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fpages-server-error.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbrowser-logs%2Ffixtures%2Fpages%2Fpages-server-error.js?ref=94f8aecf2622d778b097780eec0992104f709528",
            "patch": "@@ -0,0 +1,19 @@\n+function throwPagesServerError() {\n+  throw new Error('Server error in pages router')\n+}\n+\n+function callPagesServerError() {\n+  throwPagesServerError()\n+}\n+\n+export async function getServerSideProps() {\n+  callPagesServerError()\n+\n+  return {\n+    props: {},\n+  }\n+}\n+\n+export default function PagesServerError() {\n+  return <div></div>\n+}"
        }
    ],
    "stats": {
        "total": 2751,
        "additions": 2626,
        "deletions": 125
    }
}