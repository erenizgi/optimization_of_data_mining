{
    "author": "mischnic",
    "message": "Turbopack: fix dynamic request lookup with only a single match (#77986)\n\nPreviously, if `require(\"./dynamic-files/\"+name)` had only a single match, it would always return that one, regardless of whether `name` was equal to the matches' filename or not.\n\nCloses https://github.com/vercel/next.js/issues/74664\nCloses PACK-4309",
    "sha": "773687df897fa116f95df646255f41c6ebb92fa1",
    "files": [
        {
            "sha": "b8d7b6671c3cb577a186be259669c715d603fee7",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/pattern_mapping.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/773687df897fa116f95df646255f41c6ebb92fa1/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fpattern_mapping.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/773687df897fa116f95df646255f41c6ebb92fa1/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fpattern_mapping.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fpattern_mapping.rs?ref=773687df897fa116f95df646255f41c6ebb92fa1",
            "patch": "@@ -410,7 +410,7 @@ impl PatternMapping {\n                 request_to_string(request).await?.to_string(),\n             ))\n             .cell()),\n-            1 => {\n+            1 if !request.request_pattern().await?.has_dynamic_parts() => {\n                 let resolve_item = &result.primary.first().unwrap().1;\n                 let single_pattern_mapping =\n                     to_single_pattern_mapping(origin, chunking_context, resolve_item, resolve_type)"
        },
        {
            "sha": "b8a2a4c390bb1b97eaeb0337ae980eec777daa3d",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/dynamic-requests/basic/input/index.js",
            "status": "modified",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/773687df897fa116f95df646255f41c6ebb92fa1/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdynamic-requests%2Fbasic%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/773687df897fa116f95df646255f41c6ebb92fa1/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdynamic-requests%2Fbasic%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fdynamic-requests%2Fbasic%2Finput%2Findex.js?ref=773687df897fa116f95df646255f41c6ebb92fa1",
            "patch": "@@ -11,6 +11,8 @@ const importAddSuffix = (key) => import(\"./dir/\" + key + \".js\");\n const importConcat = (key) => import(\"./dir/\".concat(key));\n const importConcatSuffix = (key) => import(\"./dir/\".concat(key, \".js\"));\n \n+const requireSingleSuffix = (key) => require(`./dir/${key}.ts`);\n+\n it(\"should support dynamic requests in require with template literals\", () => {\n   expect(requireTemplate(\"a.js\")).toBe(a);\n   expect(requireTemplate(\"b.ts\")).toBe(b);\n@@ -103,3 +105,8 @@ it(\"should not support dynamic requests with double extension\", async () => {\n   await expect(importConcatSuffix(\"a.js\")).rejects.toThrowError();\n   await expect(importConcatSuffix(\"d.js\")).rejects.toThrowError();\n });\n+\n+it(\"should still interpolate even with a single match\", async () => {\n+  expect(requireSingleSuffix(\"b\")).toBe(b)\n+  expect(() => requireSingleSuffix(\"non-existent\")).toThrowError()\n+});"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 8,
        "deletions": 1
    }
}