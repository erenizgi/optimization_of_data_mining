{
    "author": "sokra",
    "message": "Turbopack: avoid panic on updating output when a task was cancelled (#84214)\n\n### What?\n\nWhen a task was cancelled, updating the output should not lead to a panic.",
    "sha": "f9248ea5bf6ac66573a96f02d94bb335d4073a16",
    "files": [
        {
            "sha": "96adf4aea88ee6b30cc847c25437956b30fb883a",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/operation/update_output.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/f9248ea5bf6ac66573a96f02d94bb335d4073a16/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fupdate_output.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f9248ea5bf6ac66573a96f02d94bb335d4073a16/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fupdate_output.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fupdate_output.rs?ref=f9248ea5bf6ac66573a96f02d94bb335d4073a16",
            "patch": "@@ -54,11 +54,16 @@ impl UpdateOutputOperation {\n \n         'output: {\n             let mut task = ctx.task(task_id, TaskDataCategory::All);\n+            let in_progress_state = get!(task, InProgress);\n+            if matches!(in_progress_state, Some(InProgressState::Canceled)) {\n+                // Skip updating the output when the task was canceled\n+                break 'output;\n+            }\n             let Some(InProgressState::InProgress(box InProgressStateInner {\n                 stale,\n                 new_children,\n                 ..\n-            })) = get!(task, InProgress)\n+            })) = in_progress_state\n             else {\n                 panic!(\"Task is not in progress while updating the output\");\n             };"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 6,
        "deletions": 1
    }
}