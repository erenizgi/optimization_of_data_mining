{
    "author": "lukesandberg",
    "message": "[turbopack] Replace uses of `Value<ExecutionEnvironment>` with just `ExecutionEnvironment` (#80135)\n\nRemove Value<ExecutionEnvironment> instead just use ExecutionEnvironment\n\nWhy?\nThe Value<> type is confusing and error prone, lets destroy it!\n\nAs discussed over slack, turbo_tasks::Value type always implements is_resolved as true and is_transient as false which is incorrect and can enable smuggling transient vcs into turbo tasks.\n\n• https://vercel.slack.com/archives/C03EWR7LGEN/p1743456121241529\n• https://vercel.slack.com/archives/C04NGV98TPS/p1743455453764879",
    "sha": "660df3c9256bae23653963b6b69afc6621720277",
    "files": [
        {
            "sha": "127f4cb1535ff94075f64b2f57f7f995cf8f81fe",
            "filename": "crates/next-core/src/next_client/context.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -2,7 +2,7 @@ use std::iter::once;\n \n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, TaskInput, Value, Vc};\n+use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, TaskInput, Vc};\n use turbo_tasks_env::EnvMap;\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{\n@@ -121,15 +121,15 @@ pub async fn get_client_compile_time_info(\n     define_env: Vc<EnvMap>,\n ) -> Result<Vc<CompileTimeInfo>> {\n     CompileTimeInfo::builder(\n-        Environment::new(Value::new(ExecutionEnvironment::Browser(\n+        Environment::new(ExecutionEnvironment::Browser(\n             BrowserEnvironment {\n                 dom: true,\n                 web_worker: false,\n                 service_worker: false,\n                 browserslist_query: browserslist_query.to_owned(),\n             }\n             .resolved_cell(),\n-        )))\n+        ))\n         .to_resolved()\n         .await?,\n     )"
        },
        {
            "sha": "38dce7c33691c9595a3dc4a47ca7a1cf520b768e",
            "filename": "crates/next-core/src/next_edge/context.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, Value, Vc};\n+use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, Vc};\n use turbo_tasks_env::EnvMap;\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{css::chunk::CssChunkType, resolve_options_context::ResolveOptionsContext};\n@@ -85,9 +85,9 @@ pub async fn get_edge_compile_time_info(\n     define_env: Vc<EnvMap>,\n ) -> Result<Vc<CompileTimeInfo>> {\n     CompileTimeInfo::builder(\n-        Environment::new(Value::new(ExecutionEnvironment::EdgeWorker(\n+        Environment::new(ExecutionEnvironment::EdgeWorker(\n             EdgeWorkerEnvironment {}.resolved_cell(),\n-        )))\n+        ))\n         .to_resolved()\n         .await?,\n     )"
        },
        {
            "sha": "9de3377b90927a9fd4bc05de70b711b678a33f76",
            "filename": "crates/next-core/src/next_server/context.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -2,7 +2,7 @@ use std::iter::once;\n \n use anyhow::{Result, bail};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, TaskInput, Value, Vc};\n+use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, TaskInput, Vc};\n use turbo_tasks_env::{EnvMap, ProcessEnv};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{\n@@ -78,7 +78,7 @@ use crate::{\n     },\n };\n \n-#[turbo_tasks::value(shared, serialization = \"auto_for_input\")]\n+#[turbo_tasks::value(shared)]\n #[derive(Debug, Clone, Hash, TaskInput)]\n pub enum ServerContextType {\n     Pages {\n@@ -386,7 +386,7 @@ pub async fn get_server_compile_time_info(\n     cwd: RcStr,\n ) -> Result<Vc<CompileTimeInfo>> {\n     CompileTimeInfo::builder(\n-        Environment::new(Value::new(ExecutionEnvironment::NodeJsLambda(\n+        Environment::new(ExecutionEnvironment::NodeJsLambda(\n             NodeJsEnvironment {\n                 compile_target: CompileTarget::current().to_resolved().await?,\n                 node_version: NodeJsVersion::resolved_cell(NodeJsVersion::Current(\n@@ -395,7 +395,7 @@ pub async fn get_server_compile_time_info(\n                 cwd: ResolvedVc::cell(Some(cwd)),\n             }\n             .resolved_cell(),\n-        )))\n+        ))\n         .to_resolved()\n         .await?,\n     )"
        },
        {
            "sha": "b6edc8051067b4a9f0c869f5c0d2816910bdae70",
            "filename": "turbopack/crates/turbopack-cli/src/build/mod.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -10,8 +10,7 @@ use rustc_hash::FxHashSet;\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    ReadConsistency, ResolvedVc, TransientInstance, TryJoinIterExt, TurboTasks, Value, Vc,\n-    apply_effects,\n+    ReadConsistency, ResolvedVc, TransientInstance, TryJoinIterExt, TurboTasks, Vc, apply_effects,\n };\n use turbo_tasks_backend::{\n     BackendOptions, NoopBackingStorage, TurboTasksBackend, noop_backing_storage,\n@@ -234,9 +233,9 @@ async fn build_internal(\n                 build_output_root,\n                 build_output_root,\n                 build_output_root,\n-                Environment::new(Value::new(ExecutionEnvironment::NodeJsLambda(\n+                Environment::new(ExecutionEnvironment::NodeJsLambda(\n                     NodeJsEnvironment::default().resolved_cell(),\n-                )))\n+                ))\n                 .to_resolved()\n                 .await?,\n                 runtime_type,\n@@ -322,15 +321,15 @@ async fn build_internal(\n                 build_output_root,\n                 build_output_root,\n                 build_output_root,\n-                Environment::new(Value::new(ExecutionEnvironment::Browser(\n+                Environment::new(ExecutionEnvironment::Browser(\n                     BrowserEnvironment {\n                         dom: true,\n                         web_worker: false,\n                         service_worker: false,\n                         browserslist_query: browserslist_query.clone(),\n                     }\n                     .resolved_cell(),\n-                )))\n+                ))\n                 .to_resolved()\n                 .await?,\n                 runtime_type,\n@@ -373,9 +372,9 @@ async fn build_internal(\n                 build_output_root,\n                 build_output_root,\n                 build_output_root,\n-                Environment::new(Value::new(ExecutionEnvironment::NodeJsLambda(\n+                Environment::new(ExecutionEnvironment::NodeJsLambda(\n                     NodeJsEnvironment::default().resolved_cell(),\n-                )))\n+                ))\n                 .to_resolved()\n                 .await?,\n                 runtime_type,"
        },
        {
            "sha": "7bfde0cb4d3f2a8b39b53acbbbe3f891a4060809",
            "filename": "turbopack/crates/turbopack-cli/src/contexts.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fcontexts.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fcontexts.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fcontexts.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -2,7 +2,7 @@ use std::fmt;\n \n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{FileSystem, FileSystemPath};\n use turbopack::{\n     ModuleAssetContext,\n@@ -213,15 +213,15 @@ pub async fn get_client_compile_time_info(\n ) -> Result<Vc<CompileTimeInfo>> {\n     let node_env = node_env.await?;\n     CompileTimeInfo::builder(\n-        Environment::new(Value::new(ExecutionEnvironment::Browser(\n+        Environment::new(ExecutionEnvironment::Browser(\n             BrowserEnvironment {\n                 dom: true,\n                 web_worker: false,\n                 service_worker: false,\n                 browserslist_query,\n             }\n             .resolved_cell(),\n-        )))\n+        ))\n         .to_resolved()\n         .await?,\n     )"
        },
        {
            "sha": "eb5e23b63dc4540fabdb3a47eda164cf7a510c2e",
            "filename": "turbopack/crates/turbopack-core/src/environment.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fenvironment.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fenvironment.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fenvironment.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -6,7 +6,7 @@ use std::{\n use anyhow::{Context, Result, anyhow};\n use swc_core::ecma::preset_env::{Version, Versions};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, TaskInput, Value, Vc};\n+use turbo_tasks::{ResolvedVc, TaskInput, Vc};\n use turbo_tasks_env::ProcessEnv;\n \n use crate::target::CompileTarget;\n@@ -46,15 +46,13 @@ pub struct Environment {\n #[turbo_tasks::value_impl]\n impl Environment {\n     #[turbo_tasks::function]\n-    pub fn new(execution: Value<ExecutionEnvironment>) -> Vc<Self> {\n-        Self::cell(Environment {\n-            execution: execution.into_value(),\n-        })\n+    pub fn new(execution: ExecutionEnvironment) -> Vc<Self> {\n+        Self::cell(Environment { execution })\n     }\n }\n \n #[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Hash, Clone, Copy)]\n+#[derive(Debug, Hash, Clone, Copy, TaskInput)]\n pub enum ExecutionEnvironment {\n     NodeJsBuildTime(ResolvedVc<NodeJsEnvironment>),\n     NodeJsLambda(ResolvedVc<NodeJsEnvironment>),"
        },
        {
            "sha": "7ae3502142bf58cc37a69dc1f600f823aea3d30a",
            "filename": "turbopack/crates/turbopack-ecmascript/benches/analyzer.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fbenches%2Fanalyzer.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fbenches%2Fanalyzer.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fbenches%2Fanalyzer.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -10,7 +10,7 @@ use swc_core::{\n         visit::VisitMutWith,\n     },\n };\n-use turbo_tasks::{ResolvedVc, Value};\n+use turbo_tasks::ResolvedVc;\n use turbo_tasks_testing::VcStorage;\n use turbopack_core::{\n     compile_time_info::CompileTimeInfo,\n@@ -103,14 +103,14 @@ fn bench_link(b: &mut Bencher, input: &BenchInput) {\n         for val in input.var_graph.values.values() {\n             VcStorage::with(async {\n                 let compile_time_info = CompileTimeInfo::builder(\n-                    Environment::new(Value::new(ExecutionEnvironment::NodeJsLambda(\n+                    Environment::new(ExecutionEnvironment::NodeJsLambda(\n                         NodeJsEnvironment {\n                             compile_target: CompileTarget::unknown().to_resolved().await?,\n                             node_version: NodeJsVersion::default().resolved_cell(),\n                             cwd: ResolvedVc::cell(None),\n                         }\n                         .resolved_cell(),\n-                    )))\n+                    ))\n                     .to_resolved()\n                     .await?,\n                 )"
        },
        {
            "sha": "7b65264324cf894e79aaf8d2f7dc09117f469f85",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/mod.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -4015,7 +4015,7 @@ mod tests {\n         },\n         testing::{NormalizedOutput, fixture, run_test},\n     };\n-    use turbo_tasks::{ResolvedVc, Value, util::FormatDuration};\n+    use turbo_tasks::{ResolvedVc, util::FormatDuration};\n     use turbopack_core::{\n         compile_time_info::CompileTimeInfo,\n         environment::{Environment, ExecutionEnvironment, NodeJsEnvironment, NodeJsVersion},\n@@ -4416,7 +4416,7 @@ mod tests {\n     ) -> (JsValue, u32) {\n         turbo_tasks_testing::VcStorage::with(async {\n             let compile_time_info = CompileTimeInfo::builder(\n-                Environment::new(Value::new(ExecutionEnvironment::NodeJsLambda(\n+                Environment::new(ExecutionEnvironment::NodeJsLambda(\n                     NodeJsEnvironment {\n                         compile_target: CompileTarget {\n                             arch: Arch::X64,\n@@ -4429,7 +4429,7 @@ mod tests {\n                         cwd: ResolvedVc::cell(None),\n                     }\n                     .resolved_cell(),\n-                )))\n+                ))\n                 .to_resolved()\n                 .await?,\n             )"
        },
        {
            "sha": "ae94ce19b49a23ee4db96b4fe987b6194453b12e",
            "filename": "turbopack/crates/turbopack-tests/tests/execution.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -321,9 +321,9 @@ async fn run_test_operation(prepared_test: ResolvedVc<PreparedTest>) -> Result<V\n         .get_relative_path_to(&*project_root.await?)\n         .context(\"Project path is in root path\")?;\n \n-    let env = Environment::new(Value::new(ExecutionEnvironment::NodeJsBuildTime(\n+    let env = Environment::new(ExecutionEnvironment::NodeJsBuildTime(\n         NodeJsEnvironment::default().resolved_cell(),\n-    )))\n+    ))\n     .to_resolved()\n     .await?;\n "
        },
        {
            "sha": "4101d7020aa2e9217902fa6545fca92b430a868f",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -12,7 +12,7 @@ use serde::Deserialize;\n use serde_json::json;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    ReadConsistency, ReadRef, ResolvedVc, TryJoinIterExt, TurboTasks, Value, ValueToString, Vc,\n+    ReadConsistency, ReadRef, ResolvedVc, TryJoinIterExt, TurboTasks, ValueToString, Vc,\n     apply_effects,\n };\n use turbo_tasks_backend::{BackendOptions, TurboTasksBackend, noop_backing_storage};\n@@ -227,7 +227,7 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n \n     let entry_asset = project_path.join(options.entry.into());\n \n-    let env = Environment::new(Value::new(match options.environment {\n+    let env = Environment::new(match options.environment {\n         SnapshotEnvironment::Browser => {\n             ExecutionEnvironment::Browser(\n                 // TODO: load more from options.json\n@@ -246,7 +246,7 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n                 NodeJsEnvironment::default().resolved_cell(),\n             )\n         }\n-    }))\n+    })\n     .to_resolved()\n     .await?;\n "
        },
        {
            "sha": "014ccf67001afdbbc9ea833dacd6dcec7d11e153",
            "filename": "turbopack/crates/turbopack/benches/node_file_trace.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -3,7 +3,7 @@ use std::{fs, path::PathBuf};\n use criterion::{Bencher, BenchmarkId, Criterion};\n use regex::Regex;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ReadConsistency, ResolvedVc, TurboTasks, Value, Vc, apply_effects};\n+use turbo_tasks::{ReadConsistency, ResolvedVc, TurboTasks, Vc, apply_effects};\n use turbo_tasks_backend::{BackendOptions, TurboTasksBackend, noop_backing_storage};\n use turbo_tasks_fs::{DiskFileSystem, FileSystem, NullFileSystem};\n use turbopack::{\n@@ -87,9 +87,9 @@ fn bench_emit(b: &mut Bencher, bench_input: &BenchInput) {\n \n                 let source = FileSource::new(input);\n                 let compile_time_info = CompileTimeInfo::builder(\n-                    Environment::new(Value::new(ExecutionEnvironment::NodeJsLambda(\n+                    Environment::new(ExecutionEnvironment::NodeJsLambda(\n                         NodeJsEnvironment::default().resolved_cell(),\n-                    )))\n+                    ))\n                     .to_resolved()\n                     .await?,\n                 )"
        },
        {
            "sha": "087b5a1722cdd273a914828b71daf083ff68e72b",
            "filename": "turbopack/crates/turbopack/examples/turbopack.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 9,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Fexamples%2Fturbopack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Fexamples%2Fturbopack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fexamples%2Fturbopack.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -9,7 +9,7 @@ use std::{\n use anyhow::Result;\n use tokio::{spawn, time::sleep};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ReadConsistency, TurboTasks, UpdateInfo, Value, Vc, util::FormatDuration};\n+use turbo_tasks::{ReadConsistency, TurboTasks, UpdateInfo, Vc, util::FormatDuration};\n use turbo_tasks_backend::{BackendOptions, TurboTasksBackend, noop_backing_storage};\n use turbo_tasks_fs::{DiskFileSystem, FileSystem};\n use turbopack::{emit_with_completion, register};\n@@ -41,24 +41,22 @@ async fn main() -> Result<()> {\n \n             // Smart Pointer cast\n             let fs: Vc<Box<dyn FileSystem>> = Vc::upcast(disk_fs);\n-            let input = fs.root().join(\"demo\".into());\n-            let output = fs.root().join(\"out\".into());\n-            let entry = fs.root().join(\"demo/index.js\".into());\n+            let input = fs.root().join(rcstr!(\"demo\"));\n+            let output = fs.root().join(rcstr!(\"out\"));\n+            let entry = fs.root().join(rcstr!(\"demo/index.js\"));\n \n             let source = FileSource::new(entry);\n             let module_asset_context = turbopack::ModuleAssetContext::new(\n                 Default::default(),\n-                CompileTimeInfo::new(Environment::new(Value::new(\n-                    ExecutionEnvironment::NodeJsLambda(\n-                        NodeJsEnvironment::default().resolved_cell(),\n-                    ),\n+                CompileTimeInfo::new(Environment::new(ExecutionEnvironment::NodeJsLambda(\n+                    NodeJsEnvironment::default().resolved_cell(),\n                 ))),\n                 Default::default(),\n                 ResolveOptionsContext {\n                     enable_typescript: true,\n                     enable_react: true,\n                     enable_node_modules: Some(fs.root().to_resolved().await?),\n-                    custom_conditions: vec![\"development\".into()],\n+                    custom_conditions: vec![rcstr!(\"development\")],\n                     ..Default::default()\n                 }\n                 .cell(),"
        },
        {
            "sha": "685d6576f38e1ec2d9d7f5b679a3c6a27226d083",
            "filename": "turbopack/crates/turbopack/src/evaluate_context.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fevaluate_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fevaluate_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fevaluate_context.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{Value, Vc};\n+use turbo_tasks::Vc;\n use turbo_tasks_env::ProcessEnv;\n use turbo_tasks_fs::FileSystem;\n use turbopack_core::{\n@@ -23,9 +23,9 @@ use crate::{\n \n #[turbo_tasks::function]\n pub fn node_build_environment() -> Vc<Environment> {\n-    Environment::new(Value::new(ExecutionEnvironment::NodeJsBuildTime(\n+    Environment::new(ExecutionEnvironment::NodeJsBuildTime(\n         NodeJsEnvironment::default().resolved_cell(),\n-    )))\n+    ))\n }\n \n #[turbo_tasks::function]"
        },
        {
            "sha": "9cbba51284020477fb7a0cbe1bab7057cc07800a",
            "filename": "turbopack/crates/turbopack/src/lib.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -26,7 +26,7 @@ use graph::{AggregatedGraph, AggregatedGraphNodeContent, aggregate};\n use module_options::{ModuleOptions, ModuleOptionsContext, ModuleRuleEffect, ModuleType};\n use tracing::{Instrument, field::Empty};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexSet, ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{FxIndexSet, ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n pub use turbopack_core::condition;\n use turbopack_core::{\n@@ -646,9 +646,9 @@ async fn process_default_internal(\n \n #[turbo_tasks::function]\n async fn externals_tracing_module_context(ty: ExternalType) -> Result<Vc<ModuleAssetContext>> {\n-    let env = Environment::new(Value::new(ExecutionEnvironment::NodeJsLambda(\n+    let env = Environment::new(ExecutionEnvironment::NodeJsLambda(\n         NodeJsEnvironment::default().resolved_cell(),\n-    )))\n+    ))\n     .to_resolved()\n     .await?;\n "
        },
        {
            "sha": "7ac1ef46cb98e21e89dd64fa74f4c2abe50d50c6",
            "filename": "turbopack/crates/turbopack/tests/node-file-trace.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/660df3c9256bae23653963b6b69afc6621720277/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs?ref=660df3c9256bae23653963b6b69afc6621720277",
            "patch": "@@ -29,8 +29,7 @@ use serde::{Deserialize, Serialize};\n use tokio::{process::Command, time::timeout};\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    ResolvedVc, TurboTasks, Value, ValueToString, Vc, apply_effects, backend::Backend,\n-    trace::TraceRawVcs,\n+    ResolvedVc, TurboTasks, ValueToString, Vc, apply_effects, backend::Backend, trace::TraceRawVcs,\n };\n use turbo_tasks_backend::TurboTasksBackend;\n use turbo_tasks_fs::{DiskFileSystem, FileSystem};\n@@ -343,8 +342,8 @@ async fn node_file_trace_operation(\n         // TODO It's easy to make a mistake here as this should match the config in the\n         // binary. TODO These test cases should move into the\n         // `node-file-trace` crate and use the same config.\n-        CompileTimeInfo::new(Environment::new(Value::new(\n-            ExecutionEnvironment::NodeJsLambda(NodeJsEnvironment::default().resolved_cell()),\n+        CompileTimeInfo::new(Environment::new(ExecutionEnvironment::NodeJsLambda(\n+            NodeJsEnvironment::default().resolved_cell(),\n         ))),\n         ModuleOptionsContext {\n             ecmascript: EcmascriptOptionsContext {"
        }
    ],
    "stats": {
        "total": 114,
        "additions": 54,
        "deletions": 60
    }
}