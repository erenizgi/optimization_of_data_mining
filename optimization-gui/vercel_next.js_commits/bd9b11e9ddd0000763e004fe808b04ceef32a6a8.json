{
    "author": "unstubbable",
    "message": "Put flaky `use-cache-unknown-cache-kind` dev tests in sandboxes (#76171)\n\nApparently the HMR changes in the one dev test are affecting the others,\nor vice versa. So we put them in sandboxes to hopefully avoid the\nresulting flakiness.",
    "sha": "bd9b11e9ddd0000763e004fe808b04ceef32a6a8",
    "files": [
        {
            "sha": "bef356baa96a83d136d8b05757ba2bbdbfb690d5",
            "filename": "test/e2e/app-dir/use-cache-unknown-cache-kind/use-cache-unknown-cache-kind.test.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 10,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/bd9b11e9ddd0000763e004fe808b04ceef32a6a8/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bd9b11e9ddd0000763e004fe808b04ceef32a6a8/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts?ref=bd9b11e9ddd0000763e004fe808b04ceef32a6a8",
            "patch": "@@ -8,6 +8,7 @@ import {\n   retry,\n } from 'next-test-utils'\n import stripAnsi from 'strip-ansi'\n+import { createSandbox } from 'development-sandbox'\n \n const nextConfigWithCacheHandler: NextConfig = {\n   experimental: {\n@@ -88,12 +89,14 @@ describe('use-cache-unknown-cache-kind', () => {\n     })\n   } else {\n     it('should not show an error for default cache kinds', async () => {\n-      const browser = await next.browser('/remote')\n+      await using sandbox = await createSandbox(next, undefined, '/remote')\n+      const { browser } = sandbox\n       await assertNoRedbox(browser)\n     })\n \n     it('should show a build error', async () => {\n-      const browser = await next.browser('/')\n+      await using sandbox = await createSandbox(next, undefined, '/')\n+      const { browser } = sandbox\n \n       await assertHasRedbox(browser)\n \n@@ -161,19 +164,20 @@ describe('use-cache-unknown-cache-kind', () => {\n     })\n \n     it('should recover from the build error if the cache handler is defined', async () => {\n-      const browser = await next.browser('/')\n+      await using sandbox = await createSandbox(next, undefined, '/')\n+      const { browser, session } = sandbox\n \n       await assertHasRedbox(browser)\n \n-      await next.patchFile(\n+      await session.patch(\n         'next.config.js',\n-        `module.exports = ${JSON.stringify(nextConfigWithCacheHandler)}`,\n-        () =>\n-          retry(async () => {\n-            expect(await browser.elementByCss('p').text()).toBe('hello world')\n-            await assertNoRedbox(browser)\n-          })\n+        `module.exports = ${JSON.stringify(nextConfigWithCacheHandler)}`\n       )\n+\n+      await retry(async () => {\n+        expect(await browser.elementByCss('p').text()).toBe('hello world')\n+        await assertNoRedbox(browser)\n+      })\n     })\n   }\n })"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 14,
        "deletions": 10
    }
}