{
    "author": "ijjk",
    "message": "Always show warning if fetch cache limit hit (#79384)\n\nWe previously weren't showing any indication when we weren't setting to\nthe runtime cache in production due to the size limit being hit which\ncan make debugging cache misses very tricky so this ensures we always\nshow the warning not just in dev mode.\n\nx-ref: [slack\nthread](https://vercel.slack.com/archives/C02K2HCH5V4/p1747675632042719?thread_ts=1746633220.634939&cid=C02K2HCH5V4)",
    "sha": "685a68716f78d9720044d064e94a615eaa59acb2",
    "files": [
        {
            "sha": "870cc3f5a3f2a0558030e51f07724fd84bbb1141",
            "filename": "packages/next/src/server/lib/incremental-cache/index.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/685a68716f78d9720044d064e94a615eaa59acb2/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/685a68716f78d9720044d064e94a615eaa59acb2/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Findex.ts?ref=685a68716f78d9720044d064e94a615eaa59acb2",
            "patch": "@@ -571,11 +571,12 @@ export class IncrementalCache implements IncrementalCacheType {\n       !this.hasCustomCacheHandler &&\n       itemSize > 2 * 1024 * 1024\n     ) {\n+      const warningText = `Failed to set Next.js data cache for ${ctx.fetchUrl || pathname}, items over 2MB can not be cached (${itemSize} bytes)`\n+\n       if (this.dev) {\n-        throw new Error(\n-          `Failed to set Next.js data cache, items over 2MB can not be cached (${itemSize} bytes)`\n-        )\n+        throw new Error(warningText)\n       }\n+      console.warn(warningText)\n       return\n     }\n "
        },
        {
            "sha": "227c081ebfa3e893630682f501457dc463c185d9",
            "filename": "test/e2e/app-dir/app-static/app-static.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/685a68716f78d9720044d064e94a615eaa59acb2/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/685a68716f78d9720044d064e94a615eaa59acb2/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts?ref=685a68716f78d9720044d064e94a615eaa59acb2",
            "patch": "@@ -4346,8 +4346,8 @@ describe('app-dir static/dynamic handling', () => {\n           expect(\n             next.cliOutput.substring(cliOutputStart).match(/Load data/g).length\n           ).toBe(2)\n-          expect(next.cliOutput.substring(cliOutputStart)).toContain(\n-            'Error: Failed to set Next.js data cache, items over 2MB can not be cached'\n+          expect(stripAnsi(next.cliOutput.substring(cliOutputStart))).toMatch(\n+            /Failed to set Next.js data cache for http:\\/\\/localhost:.*?\\/api\\/large-data, items over 2MB can not be cached/\n           )\n           return 'success'\n         }, 'success')\n@@ -4376,8 +4376,8 @@ describe('app-dir static/dynamic handling', () => {\n           return 'success'\n         }, 'success')\n \n-        expect(next.cliOutput.substring(cliOutputStart)).not.toContain(\n-          'Error: Failed to set Next.js data cache, items over 2MB can not be cached'\n+        expect(next.cliOutput.substring(cliOutputStart)).not.toMatch(\n+          /Failed to set Next.js data cache for http:\\/\\/localhost:.*?\\/api\\/large-data, items over 2MB can not be cached/\n         )\n       })\n     }"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 8,
        "deletions": 7
    }
}