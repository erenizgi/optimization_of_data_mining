{
    "author": "RobPruzan",
    "message": "fix: update useEffect closure when menu is truly mounted (#81531)\n\nPreviously we mounted event handlers on the the menu's\n[`ownerDocument`](https://developer.mozilla.org/en-US/docs/Web/API/Node/ownerDocument)\nto listen for clicks outside the menu. This causes a bug where the ref\nthe useEffect captures is not set yet, and when it is set the effect\ndoes not try to run again. The fix is to derive active state from the\ntrue state tracking if the menu is mounted, not if the menu __will be\nopen__\n\n### Before\n\nhttps://github.com/user-attachments/assets/d88f9b46-2203-45f3-a184-46db39584679\n\n### After\n\n\nhttps://github.com/user-attachments/assets/57a0f68f-8d46-41ea-b761-222c82e4b6bc",
    "sha": "145d7613b621369afa7ddc0a05ed3ebecda4b624",
    "files": [
        {
            "sha": "743e774f7840554759a9e3125e6e3f991d693da5",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/145d7613b621369afa7ddc0a05ed3ebecda4b624/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/145d7613b621369afa7ddc0a05ed3ebecda4b624/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=145d7613b621369afa7ddc0a05ed3ebecda4b624",
            "patch": "@@ -163,8 +163,8 @@ function DevToolsPopover({\n   )\n \n   // Features to make the menu accessible\n-  useFocusTrap(menuRef, triggerRef, isMenuOpen)\n-  useClickOutside(menuRef, triggerRef, isMenuOpen, closeMenu)\n+  useFocusTrap(menuRef, triggerRef, menuMounted)\n+  useClickOutside(menuRef, triggerRef, menuMounted, closeMenu)\n   useShortcuts(hideShortcut ? { [hideShortcut]: hideDevTools } : {}, triggerRef)\n \n   useEffect(() => {"
        },
        {
            "sha": "083db3356b9bd93a2ae52e94dd3b9eabbe6ea2d2",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/dev-tools-info.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/145d7613b621369afa7ddc0a05ed3ebecda4b624/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-info.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/145d7613b621369afa7ddc0a05ed3ebecda4b624/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-info.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-info.tsx?ref=145d7613b621369afa7ddc0a05ed3ebecda4b624",
            "patch": "@@ -33,11 +33,11 @@ export function DevToolsInfo({\n     exitDelay: MENU_DURATION_MS,\n   })\n \n-  useFocusTrap(ref, triggerRef, isOpen, () => {\n+  useFocusTrap(ref, triggerRef, mounted, () => {\n     // Bring focus to close button, so the user can easily close the overlay\n     closeButtonRef.current?.focus()\n   })\n-  useClickOutside(ref, triggerRef, isOpen, close)\n+  useClickOutside(ref, triggerRef, mounted, close)\n \n   if (!mounted) {\n     return null"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 4,
        "deletions": 4
    }
}