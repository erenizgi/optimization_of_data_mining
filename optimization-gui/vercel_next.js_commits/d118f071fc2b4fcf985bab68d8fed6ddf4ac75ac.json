{
    "author": "RobPruzan",
    "message": "chore: align css loader in storybook (#81403)",
    "sha": "d118f071fc2b4fcf985bab68d8fed6ddf4ac75ac",
    "files": [
        {
            "sha": "2410da8b9fa2ca24bfab50aa3bfa85dc611dd349",
            "filename": "packages/next/.storybook/main.ts",
            "status": "modified",
            "additions": 45,
            "deletions": 1,
            "changes": 46,
            "blob_url": "https://github.com/vercel/next.js/blob/d118f071fc2b4fcf985bab68d8fed6ddf4ac75ac/packages%2Fnext%2F.storybook%2Fmain.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d118f071fc2b4fcf985bab68d8fed6ddf4ac75ac/packages%2Fnext%2F.storybook%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2F.storybook%2Fmain.ts?ref=d118f071fc2b4fcf985bab68d8fed6ddf4ac75ac",
            "patch": "@@ -1,12 +1,13 @@\n import type { StorybookConfig } from '@storybook/react-webpack5'\n-import { join, dirname } from 'path'\n+import { join, dirname, resolve } from 'path'\n /**\n  * This function is used to resolve the absolute path of a package.\n  * It is needed in projects that use Yarn PnP or are set up within a monorepo.\n  */\n function getAbsolutePath(value: string): any {\n   return dirname(require.resolve(join(value, 'package.json')))\n }\n+\n const config: StorybookConfig = {\n   stories: ['../src/next-devtools/**/*.stories.tsx'],\n   addons: [\n@@ -32,5 +33,48 @@ const config: StorybookConfig = {\n       },\n     },\n   }),\n+  webpackFinal: async (config) => {\n+    // Find and override CSS rule to use the devtool style injection\n+    const cssRule = config.module?.rules?.find((rule) => {\n+      if (typeof rule !== 'object' || !rule) return false\n+      if ('test' in rule && rule.test instanceof RegExp) {\n+        return rule.test.test('.css')\n+      }\n+      return false\n+    })\n+\n+    if (\n+      cssRule &&\n+      typeof cssRule === 'object' &&\n+      'use' in cssRule &&\n+      Array.isArray(cssRule.use)\n+    ) {\n+      // Find the style-loader in the use array\n+      const styleLoaderIndex = cssRule.use.findIndex((loader) => {\n+        if (typeof loader === 'string') return loader.includes('style-loader')\n+        if (typeof loader === 'object' && loader && 'loader' in loader) {\n+          return loader.loader?.includes('style-loader')\n+        }\n+        return false\n+      })\n+\n+      if (styleLoaderIndex !== -1) {\n+        // Replace with our custom configuration\n+        cssRule.use[styleLoaderIndex] = {\n+          loader: require.resolve('style-loader'),\n+          options: {\n+            injectType: 'styleTag',\n+            insert: resolve(\n+              __dirname,\n+              '../src/build/webpack/loaders/devtool/devtool-style-inject.js'\n+            ),\n+          },\n+        }\n+      }\n+    }\n+\n+    return config\n+  },\n }\n+\n export default config"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 45,
        "deletions": 1
    }
}