{
    "author": "eps1lon",
    "message": "Align Redbox test helpers (#76213)",
    "sha": "929e3060ab66da1a989c569e0b5f1c9304f2efe6",
    "files": [
        {
            "sha": "0188c536cb84b9c96ead42d50ba2689f3de1b8e3",
            "filename": "test/development/app-dir/hydration-error-count/hydration-error-count.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/929e3060ab66da1a989c569e0b5f1c9304f2efe6/test%2Fdevelopment%2Fapp-dir%2Fhydration-error-count%2Fhydration-error-count.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/929e3060ab66da1a989c569e0b5f1c9304f2efe6/test%2Fdevelopment%2Fapp-dir%2Fhydration-error-count%2Fhydration-error-count.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fhydration-error-count%2Fhydration-error-count.test.ts?ref=929e3060ab66da1a989c569e0b5f1c9304f2efe6",
            "patch": "@@ -83,7 +83,7 @@ describe('hydration-error-count', () => {\n            \">\",\n          ],\n        ],\n-       \"notes\": undefined,\n+       \"notes\": null,\n      }\n     `)\n "
        },
        {
            "sha": "6f28125cf2f613fb9804af79e9651aacc6bcf7c0",
            "filename": "test/e2e/conflicting-app-page-error/index.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/929e3060ab66da1a989c569e0b5f1c9304f2efe6/test%2Fe2e%2Fconflicting-app-page-error%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/929e3060ab66da1a989c569e0b5f1c9304f2efe6/test%2Fe2e%2Fconflicting-app-page-error%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fconflicting-app-page-error%2Findex.test.ts?ref=929e3060ab66da1a989c569e0b5f1c9304f2efe6",
            "patch": "@@ -105,12 +105,12 @@ describe('Conflict between app file and pages file', () => {\n     it('should not show error overlay for non conflict pages under app or pages dir', async () => {\n       const browser = await next.browser('/non-conflict')\n       await assertNoRedbox(browser)\n-      expect(await getRedboxHeader(browser)).toBeUndefined()\n+      expect(await getRedboxHeader(browser)).toEqual(null)\n       expect(await browser.elementByCss('p').text()).toBe('non-conflict app')\n \n       await browser.loadPage(next.url + '/non-conflict-pages')\n       await assertNoRedbox(browser)\n-      expect(await getRedboxHeader(browser)).toBeUndefined()\n+      expect(await getRedboxHeader(browser)).toEqual(null)\n       expect(await browser.elementByCss('h1').text()).toBe('non-conflict pages')\n     })\n "
        },
        {
            "sha": "693c7a6d697b650ed297e625914e904609d83ea2",
            "filename": "test/lib/next-test-utils.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 22,
            "changes": 50,
            "blob_url": "https://github.com/vercel/next.js/blob/929e3060ab66da1a989c569e0b5f1c9304f2efe6/test%2Flib%2Fnext-test-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/929e3060ab66da1a989c569e0b5f1c9304f2efe6/test%2Flib%2Fnext-test-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-test-utils.ts?ref=929e3060ab66da1a989c569e0b5f1c9304f2efe6",
            "patch": "@@ -998,13 +998,15 @@ export async function getRouteTypeFromDevToolsIndicator(\n   })\n }\n \n-export function getRedboxHeader(browser: BrowserInterface) {\n+export function getRedboxHeader(\n+  browser: BrowserInterface\n+): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n       .find((p) => p.shadowRoot.querySelector('[data-nextjs-dialog-header]'))\n     const root = portal?.shadowRoot\n-    return root?.querySelector('[data-nextjs-dialog-header]')?.innerText\n+    return root?.querySelector('[data-nextjs-dialog-header]')?.innerText ?? null\n   })\n }\n \n@@ -1027,7 +1029,7 @@ export async function getRedboxTotalErrorCount(\n \n export function getRedboxSource(\n   browser: BrowserInterface\n-): Promise<string | undefined> {\n+): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n@@ -1037,8 +1039,10 @@ export function getRedboxSource(\n         )\n       )\n     const root = portal.shadowRoot\n-    return root.querySelector('[data-nextjs-codeframe], [data-nextjs-terminal]')\n-      .innerText\n+    return (\n+      root.querySelector('[data-nextjs-codeframe], [data-nextjs-terminal]')\n+        ?.innerText ?? null\n+    )\n   })\n }\n \n@@ -1050,9 +1054,11 @@ export function getRedboxTitle(\n       .call(document.querySelectorAll('nextjs-portal'))\n       .find((p) => p.shadowRoot.querySelector('[data-nextjs-dialog-header]'))\n     const root = portal.shadowRoot\n-    return root.querySelector(\n-      '[data-nextjs-dialog-header] .nextjs__container_errors__error_title'\n-    ).innerText\n+    return (\n+      root.querySelector(\n+        '[data-nextjs-dialog-header] .nextjs__container_errors__error_title'\n+      )?.innerText ?? null\n+    )\n   })\n }\n \n@@ -1087,43 +1093,43 @@ export function getRedboxEnvironmentLabel(\n \n export function getRedboxDescription(\n   browser: BrowserInterface\n-): Promise<string> {\n+): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n       .find((p) => p.shadowRoot.querySelector('[data-nextjs-dialog-header]'))\n     const root = portal.shadowRoot\n-    const text = root.querySelector('#nextjs__container_errors_desc').innerText\n-    if (text === null) throw new Error('No redbox description found')\n-    return text\n+    return (\n+      root.querySelector('#nextjs__container_errors_desc')?.innerText ?? null\n+    )\n   })\n }\n \n-export function getRedboxDescriptionWarning(browser: BrowserInterface) {\n+export function getRedboxDescriptionWarning(\n+  browser: BrowserInterface\n+): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n       .find((p) => p.shadowRoot.querySelector('[data-nextjs-dialog-header]'))\n     const root = portal.shadowRoot\n-    const text = root.querySelector(\n-      '#nextjs__container_errors__notes'\n-    )?.innerText\n-    return text\n+    return (\n+      root.querySelector('#nextjs__container_errors__notes')?.innerText ?? null\n+    )\n   })\n }\n \n export function getRedboxErrorLink(\n   browser: BrowserInterface\n-): Promise<string | undefined> {\n+): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n       .find((p) => p.shadowRoot.querySelector('[data-nextjs-dialog-header]'))\n     const root = portal.shadowRoot\n-    const text = root.querySelector(\n-      '#nextjs__container_errors__link'\n-    )?.innerText\n-    return text\n+    return (\n+      root.querySelector('#nextjs__container_errors__link')?.innerText ?? null\n+    )\n   })\n }\n "
        }
    ],
    "stats": {
        "total": 56,
        "additions": 31,
        "deletions": 25
    }
}