{
    "author": "unstubbable",
    "message": "Propagate expire time to `cache-control` header and prerender manifest (#76207)\n\nFor the `stale-while-revalidate` value in the `cache-control` response header, Next.js currently uses the configured\r\n[`expireTime`](https://nextjs.org/docs/app/api-reference/config/next-config-js/expireTime), which applies to all routes, and defaults to one year.\r\n\r\nWith the introduction of `\"use cache\"` and granular [cache lifetimes](https://nextjs.org/docs/app/api-reference/functions/cacheLife), users can now set expire times per route â€” based on the minimum expire time of all cached functions used by that route.\r\n\r\nThis PR updates the `stale-while-revalidate` value to reflect the route's cache lifetime, using the difference between the minimum expire time and the minimum revalidate time. If no explicit expire time is defined in cache profiles, the globally configured `expireTime` is used.\r\n\r\nAdditionally, the collected expire time is added to the prerender manifest as `initialExpireSeconds` (and `fallbackExpire`), analogous to `initialRevalidateSeconds` (or `fallbackRevalidate`).\r\n\r\ncloses NAR-100",
    "sha": "3ae9d382474b6b9513876591e9d74c066d5d3229",
    "files": [
        {
            "sha": "9bc6f65a62ff3fa1d35381a39e88e9e695b08621",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -652,5 +652,10 @@\n   \"651\": \"Unexpected module type %s\",\n   \"652\": \"Expected cached value for cache key %s not to be a %s kind, got \\\"FETCH\\\" instead.\",\n   \"653\": \"Expected cached value for cache key %s to be a \\\"FETCH\\\" kind, got %s instead.\",\n-  \"654\": \"Segment Cache experiment is not enabled. This is a bug in Next.js.\"\n+  \"654\": \"Segment Cache experiment is not enabled. This is a bug in Next.js.\",\n+  \"655\": \"If providing both the stale and expire options, the expire option must be greater than the stale option. The expire option indicates how many seconds from the start until it can no longer be used.\",\n+  \"656\": \"If providing both the revalidate and expire options, the expire option must be greater than the revalidate option. The expire option indicates how many seconds from the start until it can no longer be used.\",\n+  \"657\": \"revalidate must be a number for image-cache\",\n+  \"658\": \"Pass `Infinity` instead of `false` if you want to cache on the server forever without checking with the origin.\",\n+  \"659\": \"SSG should not return an image cache value\"\n }"
        },
        {
            "sha": "5e218507825f315c7fe4b1c2a942a12bd00ea3ca",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 93,
            "deletions": 36,
            "changes": 129,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -3,7 +3,7 @@ import type { PagesManifest } from './webpack/plugins/pages-manifest-plugin'\n import type { ExportPathMap, NextConfigComplete } from '../server/config-shared'\n import type { MiddlewareManifest } from './webpack/plugins/middleware-plugin'\n import type { ActionManifest } from './webpack/plugins/flight-client-entry-plugin'\n-import type { Revalidate } from '../server/lib/revalidate'\n+import type { CacheControl, Revalidate } from '../server/lib/cache-control'\n \n import '../lib/setup-exception-listeners'\n \n@@ -209,7 +209,7 @@ import { turbopackBuild } from './turbopack-build'\n \n type Fallback = null | boolean | string\n \n-export interface SsgRoute {\n+export interface PrerenderManifestRoute {\n   dataRoute: string | null\n   experimentalBypassFor?: RouteHas[]\n \n@@ -224,10 +224,20 @@ export interface SsgRoute {\n   initialStatus?: number\n \n   /**\n-   * The revalidation configuration for this route.\n+   * The revalidate value for this route. This might be inferred from:\n+   * - route segment configs\n+   * - fetch calls\n+   * - unstable_cache\n+   * - \"use cache\"\n    */\n   initialRevalidateSeconds: Revalidate\n \n+  /**\n+   * The expire value for this route, which is inferred from the \"use cache\"\n+   * functions that are used by the route, or the expireTime config.\n+   */\n+  initialExpireSeconds: number | undefined\n+\n   /**\n    * The prefetch data route associated with this page. If not defined, this\n    * page does not support prefetching.\n@@ -258,7 +268,7 @@ export interface SsgRoute {\n   allowHeader: string[]\n }\n \n-export interface DynamicSsgRoute {\n+export interface DynamicPrerenderManifestRoute {\n   dataRoute: string | null\n   dataRouteRegex: string | null\n   experimentalBypassFor?: RouteHas[]\n@@ -270,6 +280,11 @@ export interface DynamicSsgRoute {\n    */\n   fallbackRevalidate: Revalidate | undefined\n \n+  /**\n+   * When defined, it describes the expire configuration for the fallback route.\n+   */\n+  fallbackExpire: number | undefined\n+\n   /**\n    * The headers that should used when serving the fallback.\n    */\n@@ -328,8 +343,8 @@ const ALLOWED_HEADERS: string[] = [\n \n export type PrerenderManifest = {\n   version: 4\n-  routes: { [route: string]: SsgRoute }\n-  dynamicRoutes: { [route: string]: DynamicSsgRoute }\n+  routes: { [route: string]: PrerenderManifestRoute }\n+  dynamicRoutes: { [route: string]: DynamicPrerenderManifestRoute }\n   notFoundRoutes: string[]\n   preview: __ApiPreviewProps\n }\n@@ -2128,7 +2143,7 @@ export default async function build(\n                   isRoutePPREnabled,\n                   isHybridAmp,\n                   ssgPageRoutes,\n-                  initialRevalidateSeconds: false,\n+                  initialCacheControl: undefined,\n                   runtime: pageRuntime,\n                   pageDuration: undefined,\n                   ssgPageDurations: undefined,\n@@ -2708,6 +2723,31 @@ export default async function build(\n           // If there was no result, there's nothing more to do.\n           if (!exportResult) return\n \n+          const getCacheControl = (\n+            exportPath: string,\n+            defaultRevalidate: Revalidate = false\n+          ): CacheControl => {\n+            const cacheControl =\n+              exportResult.byPath.get(exportPath)?.cacheControl\n+\n+            if (!cacheControl) {\n+              return { revalidate: defaultRevalidate, expire: undefined }\n+            }\n+\n+            if (\n+              cacheControl.revalidate !== false &&\n+              cacheControl.revalidate > 0 &&\n+              cacheControl.expire === undefined\n+            ) {\n+              return {\n+                revalidate: cacheControl.revalidate,\n+                expire: config.expireTime,\n+              }\n+            }\n+\n+            return cacheControl\n+          }\n+\n           if (debugOutput || process.env.NEXT_SSG_FETCH_METRICS === '1') {\n             recordFetchMetrics(exportResult)\n           }\n@@ -2739,7 +2779,7 @@ export default async function build(\n \n             let hasRevalidateZero =\n               appConfig.revalidate === 0 ||\n-              exportResult.byPath.get(page)?.revalidate === 0\n+              getCacheControl(page).revalidate === 0\n \n             if (hasRevalidateZero && pageInfos.get(page)?.isStatic) {\n               // if the page was marked as being static, but it contains dynamic data\n@@ -2855,26 +2895,40 @@ export default async function build(\n               if (route.pathname === UNDERSCORE_NOT_FOUND_ROUTE) continue\n \n               const {\n-                revalidate = appConfig.revalidate ?? false,\n                 metadata = {},\n                 hasEmptyPrelude,\n                 hasPostponed,\n               } = exportResult.byPath.get(route.pathname) ?? {}\n \n+              const cacheControl = getCacheControl(\n+                route.pathname,\n+                appConfig.revalidate\n+              )\n+\n               pageInfos.set(route.pathname, {\n                 ...(pageInfos.get(route.pathname) as PageInfo),\n                 hasPostponed,\n                 hasEmptyPrelude,\n+                // TODO: Enable the following line to show \"ISR\" status in build\n+                // output. Requires different presentation to also work for app\n+                // router routes.\n+                // See https://vercel.slack.com/archives/C02CDC2ALJH/p1739552318644119?thread_ts=1739550179.439319&cid=C02CDC2ALJH\n+                // initialCacheControl: cacheControl,\n               })\n \n               // update the page (eg /blog/[slug]) to also have the postpone metadata\n               pageInfos.set(page, {\n                 ...(pageInfos.get(page) as PageInfo),\n                 hasPostponed,\n                 hasEmptyPrelude,\n+                // TODO: Enable the following line to show \"ISR\" status in build\n+                // output. Requires different presentation to also work for app\n+                // router routes.\n+                // See https://vercel.slack.com/archives/C02CDC2ALJH/p1739552318644119?thread_ts=1739550179.439319&cid=C02CDC2ALJH\n+                // initialCacheControl: cacheControl,\n               })\n \n-              if (revalidate !== 0) {\n+              if (cacheControl.revalidate !== 0) {\n                 const normalizedRoute = normalizePagePath(route.pathname)\n \n                 let dataRoute: string | null\n@@ -2907,7 +2961,8 @@ export default async function build(\n                     : undefined,\n                   experimentalPPR: isRoutePPREnabled,\n                   experimentalBypassFor: bypassFor,\n-                  initialRevalidateSeconds: revalidate,\n+                  initialRevalidateSeconds: cacheControl.revalidate,\n+                  initialExpireSeconds: cacheControl.expire,\n                   srcRoute: page,\n                   dataRoute,\n                   prefetchDataRoute,\n@@ -2944,8 +2999,11 @@ export default async function build(\n               for (const route of dynamicRoutes) {\n                 const normalizedRoute = normalizePagePath(route.pathname)\n \n-                const { metadata, revalidate } =\n-                  exportResult.byPath.get(route.pathname) ?? {}\n+                const metadata = exportResult.byPath.get(\n+                  route.pathname\n+                )?.metadata\n+\n+                const cacheControl = getCacheControl(route.pathname)\n \n                 let dataRoute: string | null = null\n                 if (!isAppRouteHandler) {\n@@ -2988,12 +3046,13 @@ export default async function build(\n                 const fallbackMode =\n                   route.fallbackMode ?? FallbackMode.NOT_FOUND\n \n-                // When we're configured to serve a prerender, we should use the\n-                // fallback revalidate from the export result. If it can't be\n-                // found, mark that we should keep the shell forever (`false`).\n-                let fallbackRevalidate: Revalidate | undefined =\n+                // When the route is configured to serve a prerender, we should\n+                // use the cache control from the export result. If it can't be\n+                // found, mark that we should keep the shell forever\n+                // (revalidate: `false` via `getCacheControl()`).\n+                const fallbackCacheControl =\n                   isRoutePPREnabled && fallbackMode === FallbackMode.PRERENDER\n-                    ? revalidate ?? false\n+                    ? cacheControl\n                     : undefined\n \n                 const fallback: Fallback = fallbackModeToFallbackField(\n@@ -3023,7 +3082,8 @@ export default async function build(\n                   ),\n                   dataRoute,\n                   fallback,\n-                  fallbackRevalidate,\n+                  fallbackRevalidate: fallbackCacheControl?.revalidate,\n+                  fallbackExpire: fallbackCacheControl?.expire,\n                   fallbackStatus: meta.status,\n                   fallbackHeaders: meta.headers,\n                   fallbackRootParams: route.fallbackRootParams,\n@@ -3268,10 +3328,11 @@ export default async function build(\n                   for (const locale of i18n.locales) {\n                     const localePage = `/${locale}${page === '/' ? '' : page}`\n \n+                    const cacheControl = getCacheControl(localePage)\n+\n                     prerenderManifest.routes[localePage] = {\n-                      initialRevalidateSeconds:\n-                        exportResult.byPath.get(localePage)?.revalidate ??\n-                        false,\n+                      initialRevalidateSeconds: cacheControl.revalidate,\n+                      initialExpireSeconds: cacheControl.expire,\n                       experimentalPPR: undefined,\n                       renderingMode: undefined,\n                       srcRoute: null,\n@@ -3285,9 +3346,11 @@ export default async function build(\n                     }\n                   }\n                 } else {\n+                  const cacheControl = getCacheControl(page)\n+\n                   prerenderManifest.routes[page] = {\n-                    initialRevalidateSeconds:\n-                      exportResult.byPath.get(page)?.revalidate ?? false,\n+                    initialRevalidateSeconds: cacheControl.revalidate,\n+                    initialExpireSeconds: cacheControl.expire,\n                     experimentalPPR: undefined,\n                     renderingMode: undefined,\n                     srcRoute: null,\n@@ -3301,10 +3364,8 @@ export default async function build(\n                     allowHeader: ALLOWED_HEADERS,\n                   }\n                 }\n-                // Set Page Revalidation Interval\n                 if (pageInfo) {\n-                  pageInfo.initialRevalidateSeconds =\n-                    exportResult.byPath.get(page)?.revalidate ?? false\n+                  pageInfo.initialCacheControl = getCacheControl(page)\n                 }\n               } else {\n                 // For a dynamic SSG page, we did not copy its data exports and only\n@@ -3350,15 +3411,11 @@ export default async function build(\n                     )\n                   }\n \n-                  const initialRevalidateSeconds =\n-                    exportResult.byPath.get(route.pathname)?.revalidate ?? false\n-\n-                  if (typeof initialRevalidateSeconds === 'undefined') {\n-                    throw new Error(\"Invariant: page wasn't built\")\n-                  }\n+                  const cacheControl = getCacheControl(route.pathname)\n \n                   prerenderManifest.routes[route.pathname] = {\n-                    initialRevalidateSeconds,\n+                    initialRevalidateSeconds: cacheControl.revalidate,\n+                    initialExpireSeconds: cacheControl.expire,\n                     experimentalPPR: undefined,\n                     renderingMode: undefined,\n                     srcRoute: page,\n@@ -3372,9 +3429,8 @@ export default async function build(\n                     allowHeader: ALLOWED_HEADERS,\n                   }\n \n-                  // Set route Revalidation Interval\n                   if (pageInfo) {\n-                    pageInfo.initialRevalidateSeconds = initialRevalidateSeconds\n+                    pageInfo.initialCacheControl = cacheControl\n                   }\n                 }\n               }\n@@ -3476,6 +3532,7 @@ export default async function build(\n                 ? `${normalizedRoute}.html`\n                 : false,\n             fallbackRevalidate: undefined,\n+            fallbackExpire: undefined,\n             fallbackSourceRoute: undefined,\n             fallbackRootParams: undefined,\n             dataRouteRegex: normalizeRouteRegex("
        },
        {
            "sha": "36e6c25e8df851f20c04c713a30a6343c9553512",
            "filename": "packages/next/src/build/utils.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 4,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Futils.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -81,6 +81,7 @@ import { collectRootParamKeys } from './segment-config/app/collect-root-param-ke\n import { buildAppStaticPaths } from './static-paths/app'\n import { buildPagesStaticPaths } from './static-paths/pages'\n import type { PrerenderedRoute } from './static-paths/types'\n+import type { CacheControl } from '../server/lib/cache-control'\n \n export type ROUTER_TYPE = 'pages' | 'app'\n \n@@ -346,7 +347,8 @@ export interface PageInfo {\n    */\n   isRoutePPREnabled: boolean\n   ssgPageRoutes: string[] | null\n-  initialRevalidateSeconds: number | false\n+  // TODO: initialCacheControl should be set per prerendered route.\n+  initialCacheControl: CacheControl | undefined\n   pageDuration: number | undefined\n   ssgPageDurations: number[] | undefined\n   runtime: ServerRuntime\n@@ -520,12 +522,14 @@ export async function printTreeView(\n \n       usedSymbols.add(symbol)\n \n-      if (pageInfo?.initialRevalidateSeconds) usedSymbols.add('ISR')\n+      // TODO: Rework this to be usable for app router routes.\n+      // See https://vercel.slack.com/archives/C02CDC2ALJH/p1739552318644119?thread_ts=1739550179.439319&cid=C02CDC2ALJH\n+      if (pageInfo?.initialCacheControl?.revalidate) usedSymbols.add('ISR')\n \n       messages.push([\n         `${border} ${symbol} ${\n-          pageInfo?.initialRevalidateSeconds\n-            ? `${item} (ISR: ${pageInfo?.initialRevalidateSeconds} Seconds)`\n+          pageInfo?.initialCacheControl?.revalidate\n+            ? `${item} (ISR: ${pageInfo?.initialCacheControl.revalidate} Seconds)`\n             : item\n         }${\n           totalDuration > MIN_DURATION"
        },
        {
            "sha": "06088024258fe6fc9f390cc34af2e7ee91a14040",
            "filename": "packages/next/src/export/index.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Findex.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -646,8 +646,8 @@ async function exportAppImpl(\n     if (options.buildExport) {\n       // Update path info by path.\n       const info = collector.byPath.get(path) ?? {}\n-      if (typeof result.revalidate !== 'undefined') {\n-        info.revalidate = result.revalidate\n+      if (result.cacheControl) {\n+        info.cacheControl = result.cacheControl\n       }\n       if (typeof result.metadata !== 'undefined') {\n         info.metadata = result.metadata"
        },
        {
            "sha": "4bd0b3527a626fb7031e085c7b4f0457ff0a2d52",
            "filename": "packages/next/src/export/routes/app-page.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-page.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-page.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-page.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -139,7 +139,7 @@ export async function exportAppPage(\n     const { metadata } = result\n     const {\n       flightData,\n-      revalidate = false,\n+      cacheControl = { revalidate: false, expire: undefined },\n       postponed,\n       fetchTags,\n       fetchMetrics,\n@@ -151,23 +151,23 @@ export async function exportAppPage(\n       throw new Error('Invariant: page postponed without PPR being enabled')\n     }\n \n-    if (revalidate === 0) {\n+    if (cacheControl.revalidate === 0) {\n       if (isDynamicError) {\n         throw new Error(\n           `Page with dynamic = \"error\" encountered dynamic data method on ${path}.`\n         )\n       }\n       const { staticBailoutInfo = {} } = metadata\n \n-      if (revalidate === 0 && debugOutput && staticBailoutInfo?.description) {\n+      if (debugOutput && staticBailoutInfo?.description) {\n         logDynamicUsageWarning({\n           path,\n           description: staticBailoutInfo.description,\n           stack: staticBailoutInfo.stack,\n         })\n       }\n \n-      return { revalidate: 0, fetchMetrics }\n+      return { cacheControl, fetchMetrics }\n     }\n \n     // If page data isn't available, it means that the page couldn't be rendered\n@@ -270,7 +270,7 @@ export async function exportAppPage(\n       metadata: hasNextSupport ? meta : undefined,\n       hasEmptyPrelude: Boolean(postponed) && html === '',\n       hasPostponed: Boolean(postponed),\n-      revalidate,\n+      cacheControl,\n       fetchMetrics,\n     }\n   } catch (err) {\n@@ -298,7 +298,7 @@ export async function exportAppPage(\n       })\n     }\n \n-    return { revalidate: 0, fetchMetrics }\n+    return { cacheControl: { revalidate: 0, expire: undefined }, fetchMetrics }\n   }\n }\n "
        },
        {
            "sha": "b204e7b79ed629c3bbdfe252ecf795df197d2f21",
            "filename": "packages/next/src/export/routes/app-route.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-route.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-route.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-route.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -114,14 +114,14 @@ export async function exportAppRoute(\n       // unless specifically opted into\n       experimental.dynamicIO !== true\n     ) {\n-      return { revalidate: 0 }\n+      return { cacheControl: { revalidate: 0, expire: undefined } }\n     }\n \n     const response = await module.handle(request, context)\n \n     const isValidStatus = response.status < 400 || response.status === 404\n     if (!isValidStatus) {\n-      return { revalidate: 0 }\n+      return { cacheControl: { revalidate: 0, expire: undefined } }\n     }\n \n     const blob = await response.blob()\n@@ -136,6 +136,12 @@ export async function exportAppRoute(\n         ? false\n         : context.renderOpts.collectedRevalidate\n \n+    const expire =\n+      typeof context.renderOpts.collectedExpire === 'undefined' ||\n+      context.renderOpts.collectedExpire >= INFINITE_CACHE\n+        ? undefined\n+        : context.renderOpts.collectedExpire\n+\n     const headers = toNodeOutgoingHttpHeaders(response.headers)\n     const cacheTags = context.renderOpts.collectedTags\n \n@@ -159,14 +165,14 @@ export async function exportAppRoute(\n     )\n \n     return {\n-      revalidate: revalidate,\n+      cacheControl: { revalidate, expire },\n       metadata: meta,\n     }\n   } catch (err) {\n     if (!isDynamicUsageError(err)) {\n       throw err\n     }\n \n-    return { revalidate: 0 }\n+    return { cacheControl: { revalidate: 0, expire: undefined } }\n   }\n }"
        },
        {
            "sha": "a0f761e015bc526614eb641675eecc1548ce2f18",
            "filename": "packages/next/src/export/routes/pages.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fpages.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fpages.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fpages.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -219,7 +219,10 @@ export async function exportPagesPage(\n \n   return {\n     ampValidations,\n-    revalidate: metadata.revalidate ?? false,\n+    cacheControl: metadata.cacheControl ?? {\n+      revalidate: false,\n+      expire: undefined,\n+    },\n     ssgNotFound,\n   }\n }"
        },
        {
            "sha": "84d90274cd5aadd6b4df1781cf2804589f50d057",
            "filename": "packages/next/src/export/types.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Ftypes.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -4,7 +4,7 @@ import type { LoadComponentsReturnType } from '../server/load-components'\n import type { OutgoingHttpHeaders } from 'http'\n import type AmpHtmlValidator from 'next/dist/compiled/amphtml-validator'\n import type { ExportPathMap, NextConfigComplete } from '../server/config-shared'\n-import type { Revalidate } from '../server/lib/revalidate'\n+import type { CacheControl } from '../server/lib/cache-control'\n import type { NextEnabledDirectories } from '../server/base-server'\n import type {\n   SerializableTurborepoAccessTraceResult,\n@@ -68,7 +68,7 @@ export interface ExportPageInput {\n export type ExportRouteResult =\n   | {\n       ampValidations?: AmpValidation[]\n-      revalidate: Revalidate\n+      cacheControl: CacheControl\n       metadata?: Partial<RouteMetadata>\n       ssgNotFound?: boolean\n       hasEmptyPrelude?: boolean\n@@ -128,9 +128,9 @@ export type ExportAppResult = {\n     string,\n     {\n       /**\n-       * The revalidation time for the page in seconds.\n+       * The cache control for the page.\n        */\n-      revalidate?: Revalidate\n+      cacheControl?: CacheControl\n       /**\n        * The metadata for the page.\n        */"
        },
        {
            "sha": "8e28db7a4d635acb598cc58296255ef15e5d407a",
            "filename": "packages/next/src/export/worker.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Fworker.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fexport%2Fworker.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Fworker.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -595,7 +595,7 @@ async function exportPage(\n   return {\n     duration: Date.now() - start,\n     ampValidations: result.ampValidations,\n-    revalidate: result.revalidate,\n+    cacheControl: result.cacheControl,\n     metadata: result.metadata,\n     ssgNotFound: result.ssgNotFound,\n     hasEmptyPrelude: result.hasEmptyPrelude,"
        },
        {
            "sha": "9881709dc6a101fdc360f3a2ad63bfbf9203b093",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -1422,17 +1422,23 @@ async function renderToHTMLOrFlightImpl(\n     // If force static is specifically set to false, we should not revalidate\n     // the page.\n     if (workStore.forceStatic === false || response.collectedRevalidate === 0) {\n-      metadata.revalidate = 0\n+      metadata.cacheControl = { revalidate: 0, expire: undefined }\n     } else {\n-      // Copy the revalidation value onto the render result metadata.\n-      metadata.revalidate =\n-        response.collectedRevalidate >= INFINITE_CACHE\n-          ? false\n-          : response.collectedRevalidate\n+      // Copy the cache control value onto the render result metadata.\n+      metadata.cacheControl = {\n+        revalidate:\n+          response.collectedRevalidate >= INFINITE_CACHE\n+            ? false\n+            : response.collectedRevalidate,\n+        expire:\n+          response.collectedExpire >= INFINITE_CACHE\n+            ? undefined\n+            : response.collectedExpire,\n+      }\n     }\n \n     // provide bailout info for debugging\n-    if (metadata.revalidate === 0) {\n+    if (metadata.cacheControl?.revalidate === 0) {\n       metadata.staticBailoutInfo = {\n         description: workStore.dynamicUsageDescription,\n         stack: workStore.dynamicUsageStack,"
        },
        {
            "sha": "31dc45393ef50bb66e7ec2fc13e7da980e9715f1",
            "filename": "packages/next/src/server/app-render/types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -5,7 +5,6 @@ import type { ClientReferenceManifest } from '../../build/webpack/plugins/flight\n import type { NextFontManifest } from '../../build/webpack/plugins/next-font-manifest-plugin'\n import type { ParsedUrlQuery } from 'querystring'\n import type { AppPageModule } from '../route-modules/app-page/module'\n-import type { ExpireTime } from '../lib/revalidate'\n import type {\n   HeadData,\n   LoadingModuleData,\n@@ -212,7 +211,7 @@ export interface RenderOptsPartial {\n      * prerendering.\n      */\n     isRoutePPREnabled?: boolean\n-    expireTime: ExpireTime | undefined\n+    expireTime: number | undefined\n     clientTraceMetadata: string[] | undefined\n     dynamicIO: boolean\n     clientSegmentCache: boolean"
        },
        {
            "sha": "c87ecf85ca2546ba74b5fd9eb1ba43c57dc6be70",
            "filename": "packages/next/src/server/base-server.ts",
            "status": "modified",
            "additions": 91,
            "deletions": 87,
            "changes": 178,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -76,11 +76,7 @@ import {\n import { isDynamicRoute } from '../shared/lib/router/utils'\n import { checkIsOnDemandRevalidate } from './api-utils'\n import { setConfig } from '../shared/lib/runtime-config.external'\n-import {\n-  formatRevalidate,\n-  type Revalidate,\n-  type ExpireTime,\n-} from './lib/revalidate'\n+import { getCacheControlHeader, type CacheControl } from './lib/cache-control'\n import { execOnce } from '../shared/lib/utils'\n import { isBlockedPage } from './utils'\n import { getBotType, isBot } from '../shared/lib/router/utils/is-bot'\n@@ -181,6 +177,7 @@ import {\n   isHtmlBotRequest,\n } from './lib/streaming-metadata'\n import { getCacheHandlers } from './use-cache/handlers'\n+import { InvariantError } from '../shared/lib/invariant-error'\n \n export type FindComponentsResult = {\n   components: LoadComponentsReturnType\n@@ -327,7 +324,7 @@ export class WrappedBuildError extends Error {\n type ResponsePayload = {\n   type: 'html' | 'json' | 'rsc'\n   body: RenderResult\n-  revalidate?: Revalidate | undefined\n+  cacheControl?: CacheControl\n }\n \n export type NextEnabledDirectories = {\n@@ -405,8 +402,7 @@ export default abstract class Server<\n       type: 'html' | 'json' | 'rsc'\n       generateEtags: boolean\n       poweredByHeader: boolean\n-      revalidate: Revalidate | undefined\n-      expireTime: ExpireTime | undefined\n+      cacheControl: CacheControl | undefined\n     }\n   ): Promise<void>\n \n@@ -1783,23 +1779,26 @@ export default abstract class Server<\n     const { req, res } = ctx\n     const originalStatus = res.statusCode\n     const { body, type } = payload\n-    let { revalidate } = payload\n+    let { cacheControl } = payload\n     if (!res.sent) {\n       const { generateEtags, poweredByHeader, dev } = this.renderOpts\n \n       // In dev, we should not cache pages for any reason.\n       if (dev) {\n         res.setHeader('Cache-Control', 'no-store, must-revalidate')\n-        revalidate = undefined\n+        cacheControl = undefined\n+      }\n+\n+      if (cacheControl && cacheControl.expire === undefined) {\n+        cacheControl.expire = this.nextConfig.expireTime\n       }\n \n       await this.sendRenderResult(req, res, {\n         result: body,\n         type,\n         generateEtags,\n         poweredByHeader,\n-        revalidate,\n-        expireTime: this.nextConfig.expireTime,\n+        cacheControl,\n       })\n       res.statusCode = originalStatus\n     }\n@@ -2622,6 +2621,12 @@ export default abstract class Server<\n                   ? false\n                   : context.renderOpts.collectedRevalidate\n \n+              const expire =\n+                typeof context.renderOpts.collectedExpire === 'undefined' ||\n+                context.renderOpts.collectedExpire >= INFINITE_CACHE\n+                  ? undefined\n+                  : context.renderOpts.collectedExpire\n+\n               // Create the cache entry for the response.\n               const cacheEntry: ResponseCacheEntry = {\n                 value: {\n@@ -2630,7 +2635,7 @@ export default abstract class Server<\n                   body: Buffer.from(await blob.arrayBuffer()),\n                   headers,\n                 },\n-                revalidate,\n+                cacheControl: { revalidate, expire },\n                 isFallback: false,\n               }\n \n@@ -2788,6 +2793,7 @@ export default abstract class Server<\n       const { metadata } = result\n \n       const {\n+        cacheControl,\n         headers = {},\n         // Add any fetch tags that were on the page to the response headers.\n         fetchTags: cacheTags,\n@@ -2806,7 +2812,7 @@ export default abstract class Server<\n       if (\n         isAppPath &&\n         isSSG &&\n-        metadata.revalidate === 0 &&\n+        cacheControl?.revalidate === 0 &&\n         !this.renderOpts.dev &&\n         !isRoutePPREnabled\n       ) {\n@@ -2836,7 +2842,7 @@ export default abstract class Server<\n       if ('isNotFound' in metadata && metadata.isNotFound) {\n         return {\n           value: null,\n-          revalidate: metadata.revalidate,\n+          cacheControl,\n           isFallback: false,\n         } satisfies ResponseCacheEntry\n       }\n@@ -2848,7 +2854,7 @@ export default abstract class Server<\n             kind: CachedRouteKind.REDIRECT,\n             props: metadata.pageData ?? metadata.flightData,\n           } satisfies CachedRedirectValue,\n-          revalidate: metadata.revalidate,\n+          cacheControl,\n           isFallback: false,\n         } satisfies ResponseCacheEntry\n       }\n@@ -2870,7 +2876,7 @@ export default abstract class Server<\n             status: res.statusCode,\n             segmentData: metadata.segmentData,\n           } satisfies CachedAppPageValue,\n-          revalidate: metadata.revalidate,\n+          cacheControl,\n           isFallback: !!fallbackRouteParams,\n         } satisfies ResponseCacheEntry\n       }\n@@ -2883,7 +2889,7 @@ export default abstract class Server<\n           headers,\n           status: isAppPath ? res.statusCode : undefined,\n         } satisfies CachedPageValue,\n-        revalidate: metadata.revalidate,\n+        cacheControl,\n         isFallback: pagesFallback,\n       }\n     }\n@@ -3088,9 +3094,9 @@ export default abstract class Server<\n \n         // Otherwise, if we did get a fallback response, we should return it.\n         if (fallbackResponse) {\n-          // Remove the revalidate from the response to prevent it from being\n+          // Remove the cache control from the response to prevent it from being\n           // used in the surrounding cache.\n-          delete fallbackResponse.revalidate\n+          delete fallbackResponse.cacheControl\n \n           return fallbackResponse\n         }\n@@ -3110,7 +3116,7 @@ export default abstract class Server<\n         typeof postponed !== 'undefined'\n       ) {\n         return {\n-          revalidate: 1,\n+          cacheControl: { revalidate: 1, expire: undefined },\n           isFallback: false,\n           value: {\n             kind: CachedRouteKind.PAGES,\n@@ -3134,17 +3140,11 @@ export default abstract class Server<\n           : null\n \n       // Perform the render.\n-      const result = await doRender({\n+      return doRender({\n         postponed,\n         pagesFallback: undefined,\n         fallbackRouteParams,\n       })\n-      if (!result) return null\n-\n-      return {\n-        ...result,\n-        revalidate: result.revalidate,\n-      }\n     }\n \n     const cacheEntry = await this.responseCache.get(\n@@ -3278,9 +3278,9 @@ export default abstract class Server<\n         return {\n           type: 'rsc',\n           body: RenderResult.fromStatic(matchedSegment),\n-          // TODO: Eventually this should use revalidate time of the\n-          // individual segment, not the whole page.\n-          revalidate: cacheEntry.revalidate,\n+          // TODO: Eventually this should use cache control of the individual\n+          // segment, not the whole page.\n+          cacheControl: cacheEntry.cacheControl,\n         }\n       }\n \n@@ -3294,22 +3294,22 @@ export default abstract class Server<\n       return {\n         type: 'rsc',\n         body: RenderResult.fromStatic(''),\n-        revalidate: cacheEntry?.revalidate,\n+        cacheControl: cacheEntry?.cacheControl,\n       }\n     }\n \n     // If the cache value is an image, we should error early.\n     if (cachedData?.kind === CachedRouteKind.IMAGE) {\n-      throw new Error('invariant SSG should not return an image cache value')\n+      throw new InvariantError('SSG should not return an image cache value')\n     }\n \n-    // Coerce the revalidate parameter from the render.\n-    let revalidate: Revalidate | undefined\n+    // Coerce the cache control parameter from the render.\n+    let cacheControl: CacheControl | undefined\n \n     // If this is a resume request in minimal mode it is streamed with dynamic\n     // content and should not be cached.\n     if (minimalPostponed) {\n-      revalidate = 0\n+      cacheControl = { revalidate: 0, expire: undefined }\n     }\n \n     // If this is in minimal mode and this is a flight request that isn't a\n@@ -3321,18 +3321,18 @@ export default abstract class Server<\n       !isPrefetchRSCRequest &&\n       isRoutePPREnabled\n     ) {\n-      revalidate = 0\n+      cacheControl = { revalidate: 0, expire: undefined }\n     } else if (!this.renderOpts.dev || (hasServerProps && !isNextDataRequest)) {\n       // If this is a preview mode request, we shouldn't cache it\n       if (isPreviewMode) {\n-        revalidate = 0\n+        cacheControl = { revalidate: 0, expire: undefined }\n       }\n \n       // If this isn't SSG, then we should set change the header only if it is\n       // not set already.\n       else if (!isSSG) {\n         if (!res.getHeader('Cache-Control')) {\n-          revalidate = 0\n+          cacheControl = { revalidate: 0, expire: undefined }\n         }\n       }\n \n@@ -3344,30 +3344,39 @@ export default abstract class Server<\n       // period of 0 so that it doesn't get cached unexpectedly by a CDN\n       else if (is404Page) {\n         const notFoundRevalidate = getRequestMeta(req, 'notFoundRevalidate')\n-        revalidate =\n-          typeof notFoundRevalidate === 'undefined' ? 0 : notFoundRevalidate\n-      } else if (is500Page) {\n-        revalidate = 0\n-      }\n \n-      // If the cache entry has a revalidate value that's a number, use it.\n-      else if (typeof cacheEntry.revalidate === 'number') {\n-        if (cacheEntry.revalidate < 1) {\n-          throw new Error(\n-            `Invalid revalidate configuration provided: ${cacheEntry.revalidate} < 1`\n-          )\n+        cacheControl = {\n+          revalidate:\n+            typeof notFoundRevalidate === 'undefined' ? 0 : notFoundRevalidate,\n+          expire: undefined,\n         }\n+      } else if (is500Page) {\n+        cacheControl = { revalidate: 0, expire: undefined }\n+      } else if (cacheEntry.cacheControl) {\n+        // If the cache entry has a cache control with a revalidate value that's\n+        // a number, use it.\n+        if (typeof cacheEntry.cacheControl.revalidate === 'number') {\n+          if (cacheEntry.cacheControl.revalidate < 1) {\n+            throw new Error(\n+              `Invalid revalidate configuration provided: ${cacheEntry.cacheControl.revalidate} < 1`\n+            )\n+          }\n \n-        revalidate = cacheEntry.revalidate\n-      }\n-      // Otherwise if the revalidate value is false, then we should use the cache\n-      // time of one year.\n-      else if (cacheEntry.revalidate === false) {\n-        revalidate = CACHE_ONE_YEAR\n+          cacheControl = {\n+            revalidate: cacheEntry.cacheControl.revalidate,\n+            expire:\n+              cacheEntry.cacheControl?.expire ?? this.nextConfig.expireTime,\n+          }\n+        }\n+        // Otherwise if the revalidate value is false, then we should use the\n+        // cache time of one year.\n+        else {\n+          cacheControl = { revalidate: CACHE_ONE_YEAR, expire: undefined }\n+        }\n       }\n     }\n \n-    cacheEntry.revalidate = revalidate\n+    cacheEntry.cacheControl = cacheControl\n \n     // If there's a callback for `onCacheEntry`, call it with the cache entry\n     // and the revalidate options.\n@@ -3401,20 +3410,18 @@ export default abstract class Server<\n       // so that we can use this as source of truth for the\n       // cache-control header instead of what the 404 page returns\n       // for the revalidate value\n-      addRequestMeta(req, 'notFoundRevalidate', cacheEntry.revalidate)\n+      addRequestMeta(\n+        req,\n+        'notFoundRevalidate',\n+        cacheEntry.cacheControl?.revalidate\n+      )\n \n       // If cache control is already set on the response we don't\n       // override it to allow users to customize it via next.config\n-      if (\n-        typeof cacheEntry.revalidate !== 'undefined' &&\n-        !res.getHeader('Cache-Control')\n-      ) {\n+      if (cacheEntry.cacheControl && !res.getHeader('Cache-Control')) {\n         res.setHeader(\n           'Cache-Control',\n-          formatRevalidate({\n-            revalidate: cacheEntry.revalidate,\n-            expireTime: this.nextConfig.expireTime,\n-          })\n+          getCacheControlHeader(cacheEntry.cacheControl)\n         )\n       }\n       if (isNextDataRequest) {\n@@ -3431,16 +3438,10 @@ export default abstract class Server<\n     } else if (cachedData.kind === CachedRouteKind.REDIRECT) {\n       // If cache control is already set on the response we don't\n       // override it to allow users to customize it via next.config\n-      if (\n-        typeof cacheEntry.revalidate !== 'undefined' &&\n-        !res.getHeader('Cache-Control')\n-      ) {\n+      if (cacheEntry.cacheControl && !res.getHeader('Cache-Control')) {\n         res.setHeader(\n           'Cache-Control',\n-          formatRevalidate({\n-            revalidate: cacheEntry.revalidate,\n-            expireTime: this.nextConfig.expireTime,\n-          })\n+          getCacheControlHeader(cacheEntry.cacheControl)\n         )\n       }\n \n@@ -3451,7 +3452,7 @@ export default abstract class Server<\n             // @TODO: Handle flight data.\n             JSON.stringify(cachedData.props)\n           ),\n-          revalidate: cacheEntry.revalidate,\n+          cacheControl: cacheEntry.cacheControl,\n         }\n       } else {\n         await handleRedirect(cachedData.props)\n@@ -3467,16 +3468,13 @@ export default abstract class Server<\n       // If cache control is already set on the response we don't\n       // override it to allow users to customize it via next.config\n       if (\n-        typeof cacheEntry.revalidate !== 'undefined' &&\n+        cacheEntry.cacheControl &&\n         !res.getHeader('Cache-Control') &&\n         !headers.get('Cache-Control')\n       ) {\n         headers.set(\n           'Cache-Control',\n-          formatRevalidate({\n-            revalidate: cacheEntry.revalidate,\n-            expireTime: this.nextConfig.expireTime,\n-          })\n+          getCacheControlHeader(cacheEntry.cacheControl)\n         )\n       }\n \n@@ -3563,7 +3561,9 @@ export default abstract class Server<\n             // distinguishing between `force-static` and pages that have no\n             // postponed state.\n             // TODO: distinguish `force-static` from pages with no postponed state (static)\n-            revalidate: isDynamicRSCRequest ? 0 : cacheEntry.revalidate,\n+            cacheControl: isDynamicRSCRequest\n+              ? { revalidate: 0, expire: undefined }\n+              : cacheEntry.cacheControl,\n           }\n         }\n \n@@ -3572,7 +3572,7 @@ export default abstract class Server<\n         return {\n           type: 'rsc',\n           body: RenderResult.fromStatic(cachedData.rscData),\n-          revalidate: cacheEntry.revalidate,\n+          cacheControl: cacheEntry.cacheControl,\n         }\n       }\n \n@@ -3586,7 +3586,7 @@ export default abstract class Server<\n         return {\n           type: 'html',\n           body,\n-          revalidate: cacheEntry.revalidate,\n+          cacheControl: cacheEntry.cacheControl,\n         }\n       }\n \n@@ -3606,7 +3606,11 @@ export default abstract class Server<\n           })\n         )\n \n-        return { type: 'html', body, revalidate: 0 }\n+        return {\n+          type: 'html',\n+          body,\n+          cacheControl: { revalidate: 0, expire: undefined },\n+        }\n       }\n \n       // This request has postponed, so let's create a new transformer that the\n@@ -3653,19 +3657,19 @@ export default abstract class Server<\n         // We don't want to cache the response if it has postponed data because\n         // the response being sent to the client it's dynamic parts are streamed\n         // to the client on the same request.\n-        revalidate: 0,\n+        cacheControl: { revalidate: 0, expire: undefined },\n       }\n     } else if (isNextDataRequest) {\n       return {\n         type: 'json',\n         body: RenderResult.fromStatic(JSON.stringify(cachedData.pageData)),\n-        revalidate: cacheEntry.revalidate,\n+        cacheControl: cacheEntry.cacheControl,\n       }\n     } else {\n       return {\n         type: 'html',\n         body: cachedData.html,\n-        revalidate: cacheEntry.revalidate,\n+        cacheControl: cacheEntry.cacheControl,\n       }\n     }\n   }"
        },
        {
            "sha": "972b4707f029fcaa723020538b51ad733af39290",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 4,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -10,7 +10,6 @@ import type { SubresourceIntegrityAlgorithm } from '../build/webpack/plugins/sub\n import type { WEB_VITALS } from '../shared/lib/utils'\n import type { NextParsedUrlQuery } from './request-meta'\n import type { SizeLimit } from '../types'\n-import type { ExpireTime } from './lib/revalidate'\n import type { SupportedTestRunners } from '../cli/next-test'\n import type { ExperimentalPPRConfig } from './lib/experimental/ppr'\n import { INFINITE_CACHE } from '../lib/constants'\n@@ -316,7 +315,7 @@ export interface ExperimentalConfig {\n   /**\n    * @deprecated use config.expireTime instead\n    */\n-  expireTime?: ExpireTime\n+  expireTime?: number\n   middlewarePrefetch?: 'strict' | 'flexible'\n   manualClientBasePath?: boolean\n   /**\n@@ -1027,7 +1026,7 @@ export interface NextConfig extends Record<string, any> {\n   /**\n    * period (in seconds) where the server allow to serve stale cache\n    */\n-  expireTime?: ExpireTime\n+  expireTime?: number\n \n   /**\n    * Enable experimental features. Note that all experimental features are subject to breaking changes in the future.\n@@ -1127,7 +1126,9 @@ export const defaultConfig: NextConfig = {\n     keepAlive: true,\n   },\n   logging: {},\n-  expireTime: process.env.__NEXT_TEST_MODE ? undefined : 31536000,\n+  expireTime: process.env.NEXT_PRIVATE_CDN_CONSUMED_SWR_CACHE_CONTROL\n+    ? undefined\n+    : 31536000, // one year\n   staticPageGenerationTimeout: 60,\n   output: !!process.env.NEXT_PRIVATE_STANDALONE ? 'standalone' : undefined,\n   modularizeImports: undefined,"
        },
        {
            "sha": "7346301b47b37ba3c5d3e55c8a17eec1c9c64486",
            "filename": "packages/next/src/server/image-optimizer.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 5,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fimage-optimizer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fimage-optimizer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fimage-optimizer.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -27,6 +27,8 @@ import { getContentType, getExtension } from './serve-static'\n import * as Log from '../build/output/log'\n import isError from '../lib/is-error'\n import { parseUrl } from '../lib/url'\n+import type { CacheControl } from './lib/cache-control'\n+import { InvariantError } from '../shared/lib/invariant-error'\n \n type XCacheHeader = 'MISS' | 'HIT' | 'STALE'\n \n@@ -414,7 +416,7 @@ export class ImageOptimizerCache {\n           revalidateAfter:\n             Math.max(maxAge, this.nextConfig.images.minimumCacheTTL) * 1000 +\n             Date.now(),\n-          revalidate: maxAge,\n+          cacheControl: { revalidate: maxAge, expire: undefined },\n           isStale: now > expireAt,\n           isFallback: false,\n         }\n@@ -428,18 +430,21 @@ export class ImageOptimizerCache {\n     cacheKey: string,\n     value: IncrementalCacheValue | null,\n     {\n-      revalidate,\n+      cacheControl,\n     }: {\n-      revalidate?: number | false\n+      cacheControl?: CacheControl\n     }\n   ) {\n     if (value?.kind !== CachedRouteKind.IMAGE) {\n       throw new Error('invariant attempted to set non-image to image-cache')\n     }\n \n+    const revalidate = cacheControl?.revalidate\n+\n     if (typeof revalidate !== 'number') {\n-      throw new Error('invariant revalidate must be a number for image-cache')\n+      throw new InvariantError('revalidate must be a number for image-cache')\n     }\n+\n     const expireAt =\n       Math.max(revalidate, this.nextConfig.images.minimumCacheTTL) * 1000 +\n       Date.now()\n@@ -772,7 +777,7 @@ export async function imageOptimizer(\n     return {\n       buffer: previouslyCachedImage.buffer,\n       contentType,\n-      maxAge: opts?.previousCacheEntry?.revalidate || maxAge,\n+      maxAge: opts?.previousCacheEntry?.cacheControl?.revalidate || maxAge,\n       etag: previouslyCachedImage.etag,\n       upstreamEtag: previouslyCachedImage.upstreamEtag,\n     }"
        },
        {
            "sha": "93a8b087369099da67025afb4427e197a5d4dd13",
            "filename": "packages/next/src/server/lib/cache-control.ts",
            "status": "renamed",
            "additions": 15,
            "deletions": 14,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fcache-control.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fcache-control.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fcache-control.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -8,27 +8,28 @@ import { CACHE_ONE_YEAR } from '../../lib/constants'\n  * value for this option.\n  */\n export type Revalidate = number | false\n-export type ExpireTime = number\n \n-export function formatRevalidate({\n-  revalidate,\n-  expireTime,\n-}: {\n+export interface CacheControl {\n   revalidate: Revalidate\n-  expireTime?: ExpireTime\n-}): string {\n+  expire: number | undefined\n+}\n+\n+export function getCacheControlHeader({\n+  revalidate,\n+  expire,\n+}: CacheControl): string {\n   const swrHeader =\n-    typeof revalidate === 'number' && expireTime !== undefined\n-      ? revalidate >= expireTime\n-        ? ''\n-        : `stale-while-revalidate=${expireTime - revalidate}`\n-      : 'stale-while-revalidate'\n+    typeof revalidate === 'number' &&\n+    expire !== undefined &&\n+    revalidate < expire\n+      ? `, stale-while-revalidate=${expire - revalidate}`\n+      : ''\n \n   if (revalidate === 0) {\n     return 'private, no-cache, no-store, max-age=0, must-revalidate'\n   } else if (typeof revalidate === 'number') {\n-    return `s-maxage=${revalidate}, ${swrHeader}`\n+    return `s-maxage=${revalidate}${swrHeader}`\n   }\n \n-  return `s-maxage=${CACHE_ONE_YEAR}, ${swrHeader}`\n+  return `s-maxage=${CACHE_ONE_YEAR}${swrHeader}`\n }",
            "previous_filename": "packages/next/src/server/lib/revalidate.ts"
        },
        {
            "sha": "54e97349aba6d87ae1875e624ffb0cdf50f9604b",
            "filename": "packages/next/src/server/lib/incremental-cache/index.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 17,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Findex.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -14,7 +14,6 @@ import {\n   type SetIncrementalFetchCacheContext,\n   type SetIncrementalResponseCacheContext,\n } from '../../response-cache'\n-import type { Revalidate } from '../revalidate'\n import type { DeepReadonly } from '../../../shared/lib/deep-readonly'\n \n import FileSystemCache from './file-system-cache'\n@@ -27,14 +26,15 @@ import {\n   PRERENDER_REVALIDATE_HEADER,\n } from '../../../lib/constants'\n import { toRoute } from '../to-route'\n-import { SharedRevalidateTimings } from './shared-revalidate-timings'\n+import { SharedCacheControls } from './shared-cache-controls'\n import { workUnitAsyncStorageInstance } from '../../app-render/work-unit-async-storage-instance'\n import {\n   getPrerenderResumeDataCache,\n   getRenderResumeDataCache,\n } from '../../app-render/work-unit-async-storage.external'\n import { getCacheHandlers } from '../../use-cache/handlers'\n import { InvariantError } from '../../../shared/lib/invariant-error'\n+import type { Revalidate } from '../cache-control'\n \n export interface CacheHandlerContext {\n   fs?: CacheFs\n@@ -96,10 +96,10 @@ export class IncrementalCache implements IncrementalCacheType {\n   private readonly locks = new Map<string, Promise<void>>()\n \n   /**\n-   * The revalidate timings for routes. This will source the timings from the\n-   * prerender manifest until the in-memory cache is updated with new timings.\n+   * The cache controls for routes. This will source the values from the\n+   * prerender manifest until the in-memory cache is updated with new values.\n    */\n-  private readonly revalidateTimings: SharedRevalidateTimings\n+  private readonly cacheControls: SharedCacheControls\n \n   constructor({\n     fs,\n@@ -170,7 +170,7 @@ export class IncrementalCache implements IncrementalCacheType {\n     this.requestProtocol = requestProtocol\n     this.allowedRevalidateHeaderKeys = allowedRevalidateHeaderKeys\n     this.prerenderManifest = getPrerenderManifest()\n-    this.revalidateTimings = new SharedRevalidateTimings(this.prerenderManifest)\n+    this.cacheControls = new SharedCacheControls(this.prerenderManifest)\n     this.fetchCacheKeyPrefix = fetchCacheKeyPrefix\n     let revalidatedTags: string[] = []\n \n@@ -216,10 +216,15 @@ export class IncrementalCache implements IncrementalCacheType {\n     if (dev)\n       return Math.floor(performance.timeOrigin + performance.now() - 1000)\n \n+    const cacheControl = this.cacheControls.get(toRoute(pathname))\n+\n     // if an entry isn't present in routes we fallback to a default\n     // of revalidating after 1 second unless it's a fallback request.\n-    const initialRevalidateSeconds =\n-      this.revalidateTimings.get(toRoute(pathname)) ?? (isFallback ? false : 1)\n+    const initialRevalidateSeconds = cacheControl\n+      ? cacheControl.revalidate\n+      : isFallback\n+        ? false\n+        : 1\n \n     const revalidateAfter =\n       typeof initialRevalidateSeconds === 'number'\n@@ -488,8 +493,7 @@ export class IncrementalCache implements IncrementalCacheType {\n \n     let entry: IncrementalResponseCacheEntry | null = null\n     const { isFallback } = ctx\n-\n-    const revalidate = this.revalidateTimings.get(toRoute(cacheKey))\n+    const cacheControl = this.cacheControls.get(toRoute(cacheKey))\n \n     let isStale: boolean | -1 | undefined\n     let revalidateAfter: Revalidate\n@@ -514,7 +518,7 @@ export class IncrementalCache implements IncrementalCacheType {\n     if (cacheData) {\n       entry = {\n         isStale,\n-        revalidate,\n+        cacheControl,\n         revalidateAfter,\n         value: cacheData.value,\n         isFallback,\n@@ -533,11 +537,11 @@ export class IncrementalCache implements IncrementalCacheType {\n       entry = {\n         isStale,\n         value: null,\n-        revalidate,\n+        cacheControl,\n         revalidateAfter,\n         isFallback,\n       }\n-      this.set(cacheKey, entry.value, { ...ctx, revalidate })\n+      this.set(cacheKey, entry.value, { ...ctx, cacheControl })\n     }\n     return entry\n   }\n@@ -594,10 +598,8 @@ export class IncrementalCache implements IncrementalCacheType {\n     }\n \n     try {\n-      // Set the value for the revalidate seconds so if it changes we can\n-      // update the cache with the new value.\n-      if (!ctx.fetchCache && typeof ctx.revalidate !== 'undefined') {\n-        this.revalidateTimings.set(toRoute(pathname), ctx.revalidate)\n+      if (!ctx.fetchCache && ctx.cacheControl) {\n+        this.cacheControls.set(toRoute(pathname), ctx.cacheControl)\n       }\n \n       await this.cacheHandler?.set(pathname, data, ctx)"
        },
        {
            "sha": "e6935165c61c29cfa6a1fade02edc62d2222f7ed",
            "filename": "packages/next/src/server/lib/incremental-cache/shared-cache-controls.test.ts",
            "status": "added",
            "additions": 94,
            "deletions": 0,
            "changes": 94,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-cache-controls.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-cache-controls.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-cache-controls.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -0,0 +1,94 @@\n+import type {\n+  DynamicPrerenderManifestRoute,\n+  PrerenderManifestRoute,\n+} from '../../../build'\n+import { RenderingMode } from '../../../build/rendering-mode'\n+import { SharedCacheControls } from './shared-cache-controls'\n+\n+describe('SharedCacheControls', () => {\n+  let sharedCacheControls: SharedCacheControls\n+  let prerenderManifest\n+\n+  beforeEach(() => {\n+    prerenderManifest = {\n+      routes: {\n+        '/route1': {\n+          initialRevalidateSeconds: 10,\n+          initialExpireSeconds: undefined,\n+          dataRoute: null,\n+          srcRoute: null,\n+          prefetchDataRoute: null,\n+          experimentalPPR: undefined,\n+          renderingMode: RenderingMode.STATIC,\n+          allowHeader: [],\n+        } satisfies PrerenderManifestRoute,\n+        '/route2': {\n+          initialRevalidateSeconds: 20,\n+          initialExpireSeconds: 40,\n+          dataRoute: null,\n+          srcRoute: null,\n+          prefetchDataRoute: null,\n+          experimentalPPR: undefined,\n+          renderingMode: RenderingMode.STATIC,\n+          allowHeader: [],\n+        } satisfies PrerenderManifestRoute,\n+      },\n+      dynamicRoutes: {\n+        '/route4': {\n+          fallbackRevalidate: 30,\n+          fallbackExpire: 50,\n+          fallback: true,\n+          fallbackRootParams: undefined,\n+          fallbackSourceRoute: undefined,\n+          dataRoute: null,\n+          dataRouteRegex: null,\n+          prefetchDataRoute: null,\n+          prefetchDataRouteRegex: null,\n+          routeRegex: '',\n+          experimentalPPR: undefined,\n+          renderingMode: RenderingMode.PARTIALLY_STATIC,\n+          allowHeader: [],\n+        } satisfies DynamicPrerenderManifestRoute,\n+      },\n+    }\n+    sharedCacheControls = new SharedCacheControls(prerenderManifest)\n+  })\n+\n+  afterEach(() => {\n+    sharedCacheControls.clear()\n+  })\n+\n+  it('should get cache control from in-memory cache', () => {\n+    sharedCacheControls.set('/route1', { revalidate: 15, expire: undefined })\n+    const cacheControl = sharedCacheControls.get('/route1')\n+    expect(cacheControl).toEqual({ revalidate: 15 })\n+  })\n+\n+  it('should get cache control from prerender manifest if not in cache', () => {\n+    const cacheControl = sharedCacheControls.get('/route2')\n+    expect(cacheControl).toEqual({ revalidate: 20, expire: 40 })\n+  })\n+\n+  it('should return undefined if cache control not found', () => {\n+    const cacheControl = sharedCacheControls.get('/route3')\n+    expect(cacheControl).toBeUndefined()\n+  })\n+\n+  it('should set cache control in cache', () => {\n+    sharedCacheControls.set('/route3', { revalidate: 30, expire: undefined })\n+    const cacheControl = sharedCacheControls.get('/route3')\n+    expect(cacheControl).toEqual({ revalidate: 30 })\n+  })\n+\n+  it('should clear the in-memory cache', () => {\n+    sharedCacheControls.set('/route3', { revalidate: 30, expire: undefined })\n+    sharedCacheControls.clear()\n+    const cacheControl = sharedCacheControls.get('/route3')\n+    expect(cacheControl).toBeUndefined()\n+  })\n+\n+  it('should get cache control from prerender manifest for dynamic route with fallback', () => {\n+    const cacheControl = sharedCacheControls.get('/route4')\n+    expect(cacheControl).toEqual({ revalidate: 30, expire: 50 })\n+  })\n+})"
        },
        {
            "sha": "52394678c378b21a3ec3e233ee83a98853724e1a",
            "filename": "packages/next/src/server/lib/incremental-cache/shared-cache-controls.ts",
            "status": "added",
            "additions": 85,
            "deletions": 0,
            "changes": 85,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-cache-controls.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-cache-controls.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-cache-controls.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -0,0 +1,85 @@\n+import type { PrerenderManifest } from '../../../build'\n+import type { DeepReadonly } from '../../../shared/lib/deep-readonly'\n+import type { CacheControl } from '../cache-control'\n+\n+/**\n+ * A shared cache of cache controls for routes. This cache is used so we don't\n+ * have to modify the prerender manifest when we want to update the cache\n+ * control for a route.\n+ */\n+export class SharedCacheControls {\n+  /**\n+   * The in-memory cache of cache lives for routes. This cache is populated when\n+   * the cache is updated with new cache lives.\n+   */\n+  private static readonly cacheControls = new Map<string, CacheControl>()\n+\n+  constructor(\n+    /**\n+     * The prerender manifest that contains the initial cache controls for\n+     * routes.\n+     */\n+    private readonly prerenderManifest: DeepReadonly<\n+      Pick<PrerenderManifest, 'routes' | 'dynamicRoutes'>\n+    >\n+  ) {}\n+\n+  /**\n+   * Try to get the cache control value for a route. This will first try to get\n+   * the value from the in-memory cache. If the value is not present in the\n+   * in-memory cache, it will be sourced from the prerender manifest.\n+   *\n+   * @param route the route to get the cache control for\n+   * @returns the cache control for the route, or undefined if the values\n+   *          are not present in the in-memory cache or the prerender manifest\n+   */\n+  public get(route: string): CacheControl | undefined {\n+    // This is a copy on write cache that is updated when the cache is updated.\n+    // If the cache is never written to, then the values will be sourced from\n+    // the prerender manifest.\n+    let cacheControl = SharedCacheControls.cacheControls.get(route)\n+    if (cacheControl) return cacheControl\n+\n+    let prerenderData = this.prerenderManifest.routes[route]\n+\n+    if (prerenderData) {\n+      const { initialRevalidateSeconds, initialExpireSeconds } = prerenderData\n+\n+      if (typeof initialRevalidateSeconds !== 'undefined') {\n+        return {\n+          revalidate: initialRevalidateSeconds,\n+          expire: initialExpireSeconds,\n+        }\n+      }\n+    }\n+\n+    const dynamicPrerenderData = this.prerenderManifest.dynamicRoutes[route]\n+\n+    if (dynamicPrerenderData) {\n+      const { fallbackRevalidate, fallbackExpire } = dynamicPrerenderData\n+\n+      if (typeof fallbackRevalidate !== 'undefined') {\n+        return { revalidate: fallbackRevalidate, expire: fallbackExpire }\n+      }\n+    }\n+\n+    return undefined\n+  }\n+\n+  /**\n+   * Set the cache control for a route.\n+   *\n+   * @param route the route to set the cache control for\n+   * @param cacheControl the cache control for the route\n+   */\n+  public set(route: string, cacheControl: CacheControl) {\n+    SharedCacheControls.cacheControls.set(route, cacheControl)\n+  }\n+\n+  /**\n+   * Clear the in-memory cache of cache controls for routes.\n+   */\n+  public clear() {\n+    SharedCacheControls.cacheControls.clear()\n+  }\n+}"
        },
        {
            "sha": "eb6e0dbbc797b482b6684546ecca6367d60f08c4",
            "filename": "packages/next/src/server/lib/incremental-cache/shared-revalidate-timings.test.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 67,
            "changes": 67,
            "blob_url": "https://github.com/vercel/next.js/blob/9483a371f1ac3a87464b59c68aa990e9813f28f0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-revalidate-timings.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9483a371f1ac3a87464b59c68aa990e9813f28f0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-revalidate-timings.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-revalidate-timings.test.ts?ref=9483a371f1ac3a87464b59c68aa990e9813f28f0",
            "patch": "@@ -1,67 +0,0 @@\n-import { RenderingMode } from '../../../build/rendering-mode'\n-import { SharedRevalidateTimings } from './shared-revalidate-timings'\n-\n-describe('SharedRevalidateTimings', () => {\n-  let sharedRevalidateTimings: SharedRevalidateTimings\n-  let prerenderManifest\n-\n-  beforeEach(() => {\n-    prerenderManifest = {\n-      routes: {\n-        '/route1': {\n-          initialRevalidateSeconds: 10,\n-          dataRoute: null,\n-          srcRoute: null,\n-          prefetchDataRoute: null,\n-          experimentalPPR: undefined,\n-          renderingMode: RenderingMode.STATIC,\n-          allowHeader: [],\n-        },\n-        '/route2': {\n-          initialRevalidateSeconds: 20,\n-          dataRoute: null,\n-          srcRoute: null,\n-          prefetchDataRoute: null,\n-          experimentalPPR: undefined,\n-          renderingMode: RenderingMode.STATIC,\n-          allowHeader: [],\n-        },\n-      },\n-      dynamicRoutes: {},\n-    }\n-    sharedRevalidateTimings = new SharedRevalidateTimings(prerenderManifest)\n-  })\n-\n-  afterEach(() => {\n-    sharedRevalidateTimings.clear()\n-  })\n-\n-  it('should get revalidate timing from in-memory cache', () => {\n-    sharedRevalidateTimings.set('/route1', 15)\n-    const revalidate = sharedRevalidateTimings.get('/route1')\n-    expect(revalidate).toBe(15)\n-  })\n-\n-  it('should get revalidate timing from prerender manifest if not in cache', () => {\n-    const revalidate = sharedRevalidateTimings.get('/route2')\n-    expect(revalidate).toBe(20)\n-  })\n-\n-  it('should return undefined if revalidate timing not found', () => {\n-    const revalidate = sharedRevalidateTimings.get('/route3')\n-    expect(revalidate).toBeUndefined()\n-  })\n-\n-  it('should set revalidate timing in cache', () => {\n-    sharedRevalidateTimings.set('/route3', 30)\n-    const revalidate = sharedRevalidateTimings.get('/route3')\n-    expect(revalidate).toBe(30)\n-  })\n-\n-  it('should clear the in-memory cache', () => {\n-    sharedRevalidateTimings.set('/route3', 30)\n-    sharedRevalidateTimings.clear()\n-    const revalidate = sharedRevalidateTimings.get('/route3')\n-    expect(revalidate).toBeUndefined()\n-  })\n-})"
        },
        {
            "sha": "1a474f09311702d2b0a62867e5803595e6399413",
            "filename": "packages/next/src/server/lib/incremental-cache/shared-revalidate-timings.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 69,
            "changes": 69,
            "blob_url": "https://github.com/vercel/next.js/blob/9483a371f1ac3a87464b59c68aa990e9813f28f0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-revalidate-timings.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9483a371f1ac3a87464b59c68aa990e9813f28f0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-revalidate-timings.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Fshared-revalidate-timings.ts?ref=9483a371f1ac3a87464b59c68aa990e9813f28f0",
            "patch": "@@ -1,69 +0,0 @@\n-import type { PrerenderManifest } from '../../../build'\n-import type { DeepReadonly } from '../../../shared/lib/deep-readonly'\n-import type { Revalidate } from '../revalidate'\n-\n-/**\n- * A shared cache of revalidate timings for routes. This cache is used so we\n- * don't have to modify the prerender manifest when we want to update the\n- * revalidate timings for a route.\n- */\n-export class SharedRevalidateTimings {\n-  /**\n-   * The in-memory cache of revalidate timings for routes. This cache is\n-   * populated when the cache is updated with new timings.\n-   */\n-  private static readonly timings = new Map<string, Revalidate>()\n-\n-  constructor(\n-    /**\n-     * The prerender manifest that contains the initial revalidate timings for\n-     * routes.\n-     */\n-    private readonly prerenderManifest: DeepReadonly<\n-      Pick<PrerenderManifest, 'routes' | 'dynamicRoutes'>\n-    >\n-  ) {}\n-\n-  /**\n-   * Try to get the revalidate timings for a route. This will first try to get\n-   * the timings from the in-memory cache. If the timings are not present in the\n-   * in-memory cache, then the timings will be sourced from the prerender\n-   * manifest.\n-   *\n-   * @param route the route to get the revalidate timings for\n-   * @returns the revalidate timings for the route, or undefined if the timings\n-   *          are not present in the in-memory cache or the prerender manifest\n-   */\n-  public get(route: string): Revalidate | undefined {\n-    // This is a copy on write cache that is updated when the cache is updated.\n-    // If the cache is never written to, then the timings will be sourced from\n-    // the prerender manifest.\n-    let revalidate = SharedRevalidateTimings.timings.get(route)\n-    if (typeof revalidate !== 'undefined') return revalidate\n-\n-    revalidate = this.prerenderManifest.routes[route]?.initialRevalidateSeconds\n-    if (typeof revalidate !== 'undefined') return revalidate\n-\n-    revalidate = this.prerenderManifest.dynamicRoutes[route]?.fallbackRevalidate\n-    if (typeof revalidate !== 'undefined') return revalidate\n-\n-    return undefined\n-  }\n-\n-  /**\n-   * Set the revalidate timings for a route.\n-   *\n-   * @param route the route to set the revalidate timings for\n-   * @param revalidate the revalidate timings for the route\n-   */\n-  public set(route: string, revalidate: Revalidate) {\n-    SharedRevalidateTimings.timings.set(route, revalidate)\n-  }\n-\n-  /**\n-   * Clear the in-memory cache of revalidate timings for routes.\n-   */\n-  public clear() {\n-    SharedRevalidateTimings.timings.clear()\n-  }\n-}"
        },
        {
            "sha": "6a3bcad54a8086e8347d6b0db5cd17b3cc593ad1",
            "filename": "packages/next/src/server/next-server.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -22,7 +22,7 @@ import type { PagesAPIRouteModule } from './route-modules/pages-api/module'\n import type { UrlWithParsedQuery } from 'url'\n import type { ParsedUrlQuery } from 'querystring'\n import type { ParsedUrl } from '../shared/lib/router/utils/parse-url'\n-import type { Revalidate, ExpireTime } from './lib/revalidate'\n+import type { CacheControl } from './lib/cache-control'\n import type { WaitUntil } from './after/builtin-request-context'\n \n import fs from 'fs'\n@@ -520,8 +520,7 @@ export default class NextNodeServer extends BaseServer<\n       type: 'html' | 'json' | 'rsc'\n       generateEtags: boolean\n       poweredByHeader: boolean\n-      revalidate: Revalidate | undefined\n-      expireTime: ExpireTime | undefined\n+      cacheControl: CacheControl | undefined\n     }\n   ): Promise<void> {\n     return sendRenderResult({\n@@ -531,8 +530,7 @@ export default class NextNodeServer extends BaseServer<\n       type: options.type,\n       generateEtags: options.generateEtags,\n       poweredByHeader: options.poweredByHeader,\n-      revalidate: options.revalidate,\n-      expireTime: options.expireTime,\n+      cacheControl: options.cacheControl,\n     })\n   }\n \n@@ -959,7 +957,7 @@ export default class NextNodeServer extends BaseServer<\n                 upstreamEtag,\n               },\n               isFallback: false,\n-              revalidate: maxAge,\n+              cacheControl: { revalidate: maxAge, expire: undefined },\n             }\n           },\n           {\n@@ -985,7 +983,7 @@ export default class NextNodeServer extends BaseServer<\n           paramsResult.isStatic,\n           cacheEntry.isMiss ? 'MISS' : cacheEntry.isStale ? 'STALE' : 'HIT',\n           imagesConfig,\n-          cacheEntry.revalidate || 0,\n+          cacheEntry.cacheControl?.revalidate || 0,\n           Boolean(this.renderOpts.dev)\n         )\n         return true"
        },
        {
            "sha": "6c541f4cab24ea4b2f82e462e0274af0a2a912f5",
            "filename": "packages/next/src/server/render-result.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Frender-result.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Frender-result.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frender-result.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -1,5 +1,5 @@\n import type { OutgoingHttpHeaders, ServerResponse } from 'http'\n-import type { Revalidate } from './lib/revalidate'\n+import type { CacheControl } from './lib/cache-control'\n import type { FetchMetrics } from './base-http'\n \n import {\n@@ -16,7 +16,7 @@ type ContentTypeOption = string | undefined\n \n export type AppPageRenderResultMetadata = {\n   flightData?: Buffer\n-  revalidate?: Revalidate\n+  cacheControl?: CacheControl\n   staticBailoutInfo?: {\n     stack?: string\n     description?: string\n@@ -45,7 +45,7 @@ export type AppPageRenderResultMetadata = {\n \n export type PagesRenderResultMetadata = {\n   pageData?: any\n-  revalidate?: Revalidate\n+  cacheControl?: CacheControl\n   assetQueryString?: string\n   isNotFound?: boolean\n   isRedirect?: boolean"
        },
        {
            "sha": "bf642a7216d10c8033a7cfaaa0ad9132d99a05a1",
            "filename": "packages/next/src/server/render.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 10,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -36,7 +36,7 @@ import type { NextFontManifest } from '../build/webpack/plugins/next-font-manife\n import type { PagesModule } from './route-modules/pages/module'\n import type { ComponentsEnhancer } from '../shared/lib/utils'\n import type { NextParsedUrlQuery } from './request-meta'\n-import type { Revalidate, ExpireTime } from './lib/revalidate'\n+import type { Revalidate } from './lib/cache-control'\n import type { COMPILER_NAMES } from '../shared/lib/constants'\n \n import React, { type JSX } from 'react'\n@@ -100,7 +100,7 @@ import {\n import { getTracer } from './lib/trace/tracer'\n import { RenderSpan } from './lib/trace/constants'\n import { ReflectAdapter } from './web/spec-extension/adapters/reflect'\n-import { formatRevalidate } from './lib/revalidate'\n+import { getCacheControlHeader } from './lib/cache-control'\n import { getErrorSource } from '../shared/lib/error-source'\n import type { DeepReadonly } from '../shared/lib/deep-readonly'\n import type { PagesDevOverlayType } from '../client/components/react-dev-overlay/pages/pages-dev-overlay'\n@@ -283,7 +283,7 @@ export type RenderOptsPartial = {\n   isServerAction?: boolean\n   isExperimentalCompile?: boolean\n   isPrefetch?: boolean\n-  expireTime?: ExpireTime\n+  expireTime?: number\n   experimental: {\n     clientTraceMetadata?: string[]\n   }\n@@ -557,10 +557,7 @@ export async function renderToHTMLImpl(\n   if (isAutoExport && !dev && isExperimentalCompile) {\n     res.setHeader(\n       'Cache-Control',\n-      formatRevalidate({\n-        revalidate: false,\n-        expireTime,\n-      })\n+      getCacheControlHeader({ revalidate: false, expire: expireTime })\n     )\n     isAutoExport = false\n   }\n@@ -1052,8 +1049,8 @@ export async function renderToHTMLImpl(\n       'props' in data ? data.props : undefined\n     )\n \n-    // pass up revalidate and props for export\n-    metadata.revalidate = revalidate\n+    // pass up cache control and props for export\n+    metadata.cacheControl = { revalidate, expire: undefined }\n     metadata.pageData = props\n \n     // this must come after revalidate is added to renderResultMeta\n@@ -1126,7 +1123,7 @@ export async function renderToHTMLImpl(\n           })\n       )\n       canAccessRes = false\n-      metadata.revalidate = 0\n+      metadata.cacheControl = { revalidate: 0, expire: undefined }\n     } catch (serverSidePropsError: any) {\n       // remove not found error code to prevent triggering legacy\n       // 404 rendering"
        },
        {
            "sha": "7c48b0361ef66ec4b8dd71b0f054c9fc997ed085",
            "filename": "packages/next/src/server/response-cache/index.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 10,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Findex.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -142,9 +142,9 @@ export default class ResponseCache implements ResponseCacheBase {\n             resolved = true\n           }\n \n-          // We want to persist the result only if it has a revalidate value\n+          // We want to persist the result only if it has a cache control value\n           // defined.\n-          if (typeof resolveValue.revalidate !== 'undefined') {\n+          if (resolveValue.cacheControl) {\n             if (this.minimalMode) {\n               this.previousCacheItem = {\n                 key: cacheKey,\n@@ -153,7 +153,7 @@ export default class ResponseCache implements ResponseCacheBase {\n               }\n             } else {\n               await incrementalCache.set(key, resolveValue.value, {\n-                revalidate: resolveValue.revalidate,\n+                cacheControl: resolveValue.cacheControl,\n                 isRoutePPREnabled,\n                 isFallback,\n               })\n@@ -162,14 +162,24 @@ export default class ResponseCache implements ResponseCacheBase {\n \n           return resolveValue\n         } catch (err) {\n-          // When a getStaticProps path is erroring we automatically re-set the\n-          // existing cache under a new expiration to prevent non-stop retrying.\n-          if (cachedResponse) {\n+          // When a path is erroring we automatically re-set the existing cache\n+          // with new revalidate and expire times to prevent non-stop retrying.\n+          if (cachedResponse?.cacheControl) {\n+            const newRevalidate = Math.min(\n+              Math.max(cachedResponse.cacheControl.revalidate || 3, 3),\n+              30\n+            )\n+\n+            const newExpire =\n+              cachedResponse.cacheControl.expire === undefined\n+                ? undefined\n+                : Math.max(\n+                    newRevalidate + 3,\n+                    cachedResponse.cacheControl.expire\n+                  )\n+\n             await incrementalCache.set(key, cachedResponse.value, {\n-              revalidate: Math.min(\n-                Math.max(cachedResponse.revalidate || 3, 3),\n-                30\n-              ),\n+              cacheControl: { revalidate: newRevalidate, expire: newExpire },\n               isRoutePPREnabled,\n               isFallback,\n             })"
        },
        {
            "sha": "e0265eb710bee7c5b74ffd60feafeb9c2c73cdcf",
            "filename": "packages/next/src/server/response-cache/types.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 4,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Ftypes.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -1,6 +1,6 @@\n import type { OutgoingHttpHeaders } from 'http'\n import type RenderResult from '../render-result'\n-import type { Revalidate } from '../lib/revalidate'\n+import type { CacheControl, Revalidate } from '../lib/cache-control'\n import type { RouteKind } from '../route-kind'\n \n export interface ResponseCacheBase {\n@@ -132,7 +132,7 @@ export interface IncrementalCachedPageValue {\n }\n \n export interface IncrementalResponseCacheEntry {\n-  revalidate?: Revalidate\n+  cacheControl?: CacheControl\n   /**\n    * timestamp in milliseconds to revalidate after\n    */\n@@ -174,7 +174,7 @@ export type ResponseCacheValue =\n   | CachedRouteValue\n \n export type ResponseCacheEntry = {\n-  revalidate?: Revalidate\n+  cacheControl?: CacheControl\n   value: ResponseCacheValue | null\n   isStale?: boolean | -1\n   isMiss?: boolean\n@@ -210,6 +210,7 @@ export interface GetIncrementalFetchCacheContext {\n \n export interface GetIncrementalResponseCacheContext {\n   kind: Exclude<IncrementalCacheKind, IncrementalCacheKind.FETCH>\n+\n   /**\n    * True if the route is enabled for PPR.\n    */\n@@ -230,7 +231,8 @@ export interface SetIncrementalFetchCacheContext {\n \n export interface SetIncrementalResponseCacheContext {\n   fetchCache?: false\n-  revalidate?: Revalidate\n+  cacheControl?: CacheControl\n+\n   /**\n    * True if the route is enabled for PPR.\n    */"
        },
        {
            "sha": "1d19a08691c1a71a14a7fe24e0544080bc4b7588",
            "filename": "packages/next/src/server/response-cache/utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Futils.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -46,7 +46,7 @@ export async function toResponseCacheEntry(\n   return {\n     isMiss: response.isMiss,\n     isStale: response.isStale,\n-    revalidate: response.revalidate,\n+    cacheControl: response.cacheControl,\n     isFallback: response.isFallback,\n     value:\n       response.value?.kind === CachedRouteKind.PAGES"
        },
        {
            "sha": "c86b69811a7787bea51cb395590f61e7bb86bd27",
            "filename": "packages/next/src/server/response-cache/web.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Fweb.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Fweb.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fresponse-cache%2Fweb.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -98,7 +98,7 @@ export default class WebResponseCache {\n           resolve(resolveValue)\n         }\n \n-        if (key && cacheEntry && typeof cacheEntry.revalidate !== 'undefined') {\n+        if (key && cacheEntry && cacheEntry.cacheControl) {\n           this.previousCacheItem = {\n             key: pendingResponseKey || key,\n             entry: cacheEntry,"
        },
        {
            "sha": "17ee1aea354b14f4225fce6d52efa65f25786b3b",
            "filename": "packages/next/src/server/send-payload.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 14,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fsend-payload.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fsend-payload.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fsend-payload.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -1,11 +1,11 @@\n import type { IncomingMessage, ServerResponse } from 'http'\n import type RenderResult from './render-result'\n-import type { Revalidate, ExpireTime } from './lib/revalidate'\n+import type { CacheControl } from './lib/cache-control'\n \n import { isResSent } from '../shared/lib/utils'\n import { generateETag } from './lib/etag'\n import fresh from 'next/dist/compiled/fresh'\n-import { formatRevalidate } from './lib/revalidate'\n+import { getCacheControlHeader } from './lib/cache-control'\n import { RSC_CONTENT_TYPE_HEADER } from '../client/components/app-router-headers'\n \n export function sendEtagResponse(\n@@ -39,17 +39,15 @@ export async function sendRenderResult({\n   type,\n   generateEtags,\n   poweredByHeader,\n-  revalidate,\n-  expireTime,\n+  cacheControl,\n }: {\n   req: IncomingMessage\n   res: ServerResponse\n   result: RenderResult\n   type: 'html' | 'json' | 'rsc'\n   generateEtags: boolean\n   poweredByHeader: boolean\n-  revalidate: Revalidate | undefined\n-  expireTime: ExpireTime | undefined\n+  cacheControl: CacheControl | undefined\n }): Promise<void> {\n   if (isResSent(res)) {\n     return\n@@ -61,15 +59,10 @@ export async function sendRenderResult({\n \n   // If cache control is already set on the response we don't\n   // override it to allow users to customize it via next.config\n-  if (typeof revalidate !== 'undefined' && !res.getHeader('Cache-Control')) {\n-    res.setHeader(\n-      'Cache-Control',\n-      formatRevalidate({\n-        revalidate,\n-        expireTime,\n-      })\n-    )\n+  if (cacheControl && !res.getHeader('Cache-Control')) {\n+    res.setHeader('Cache-Control', getCacheControlHeader(cacheControl))\n   }\n+\n   const payload = result.isDynamic ? null : result.toUnchunkedString()\n \n   if (generateEtags && payload !== null) {"
        },
        {
            "sha": "ef1987f467358e662d512c0a05f9960acc6e0892",
            "filename": "packages/next/src/server/use-cache/cache-life.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fcache-life.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fcache-life.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fuse-cache%2Fcache-life.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -53,8 +53,8 @@ function validateCacheLife(profile: CacheLife) {\n   if (profile.expire !== undefined) {\n     if ((profile.expire as any) === false) {\n       throw new Error(\n-        'Pass `Infinity` instead of `false` if you want to cache on the client forever ' +\n-          'without checking with the server.'\n+        'Pass `Infinity` instead of `false` if you want to cache on the server forever ' +\n+          'without checking with the origin.'\n       )\n     } else if (typeof profile.expire !== 'number') {\n       throw new Error('The expire option must be a number of seconds.')\n@@ -65,7 +65,7 @@ function validateCacheLife(profile: CacheLife) {\n     if (profile.revalidate > profile.expire) {\n       throw new Error(\n         'If providing both the revalidate and expire options, ' +\n-          'the expire option must be greater than the revalidate option.' +\n+          'the expire option must be greater than the revalidate option. ' +\n           'The expire option indicates how many seconds from the start ' +\n           'until it can no longer be used.'\n       )\n@@ -76,7 +76,7 @@ function validateCacheLife(profile: CacheLife) {\n     if (profile.stale > profile.expire) {\n       throw new Error(\n         'If providing both the stale and expire options, ' +\n-          'the expire option must be greater than the stale option.' +\n+          'the expire option must be greater than the stale option. ' +\n           'The expire option indicates how many seconds from the start ' +\n           'until it can no longer be used.'\n       )"
        },
        {
            "sha": "a925d91675fedf77fe9d26bbba53db3459b56697",
            "filename": "packages/next/src/server/web-server.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fweb-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/packages%2Fnext%2Fsrc%2Fserver%2Fweb-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fweb-server.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -10,7 +10,7 @@ import type {\n   Options,\n   RouteHandler,\n } from './base-server'\n-import type { Revalidate, ExpireTime } from './lib/revalidate'\n+import type { CacheControl } from './lib/cache-control'\n \n import { byteLength } from './api-utils/web'\n import BaseServer, { NoFallbackError } from './base-server'\n@@ -261,8 +261,7 @@ export default class NextWebServer extends BaseServer<\n       type: 'html' | 'json'\n       generateEtags: boolean\n       poweredByHeader: boolean\n-      revalidate: Revalidate | undefined\n-      expireTime: ExpireTime | undefined\n+      cacheControl: CacheControl | undefined\n     }\n   ): Promise<void> {\n     res.setHeader('X-Edge-Runtime', '1')"
        },
        {
            "sha": "afadd42143fa3c3d6be0ebcbea92b1d4d7121a59",
            "filename": "test/e2e/app-dir/app-static/app-static.test.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -1018,6 +1018,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 1,\n            \"srcRoute\": \"/articles/[slug]\",\n          },\n@@ -1042,6 +1043,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n            \"srcRoute\": \"/blog/[author]\",\n          },\n@@ -1090,6 +1092,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n            \"srcRoute\": \"/blog/[author]\",\n          },\n@@ -1162,6 +1165,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n            \"srcRoute\": \"/blog/[author]\",\n          },\n@@ -1234,6 +1238,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n            \"srcRoute\": \"/force-cache\",\n          },\n@@ -1330,6 +1335,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n            \"srcRoute\": \"/gen-params-dynamic-revalidate/[slug]\",\n          },\n@@ -1426,6 +1432,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n            \"srcRoute\": \"/isr-error-handling\",\n          },\n@@ -1834,6 +1841,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n            \"srcRoute\": \"/prerendered-not-found/segment-revalidate\",\n          },\n@@ -1858,6 +1866,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialHeaders\": {\n              \"content-type\": \"application/json\",\n              \"x-next-cache-tags\": \"_N_T_/layout,_N_T_/route-handler/layout,_N_T_/route-handler/no-store-force-static/layout,_N_T_/route-handler/no-store-force-static/route,_N_T_/route-handler/no-store-force-static\",\n@@ -1886,6 +1895,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialHeaders\": {\n              \"content-type\": \"application/json\",\n              \"x-next-cache-tags\": \"_N_T_/layout,_N_T_/route-handler/layout,_N_T_/route-handler/revalidate-360-isr/layout,_N_T_/route-handler/revalidate-360-isr/route,_N_T_/route-handler/revalidate-360-isr,thankyounext\",\n@@ -2014,6 +2024,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 50,\n            \"srcRoute\": \"/strip-w3c-trace-context-headers\",\n          },\n@@ -2086,6 +2097,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n            \"srcRoute\": \"/variable-config-revalidate/revalidate-3\",\n          },\n@@ -2110,6 +2122,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n            \"srcRoute\": \"/variable-revalidate-stable/revalidate-3\",\n          },\n@@ -2134,6 +2147,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n            \"srcRoute\": \"/variable-revalidate/authorization\",\n          },\n@@ -2158,6 +2172,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n            \"srcRoute\": \"/variable-revalidate/cookie\",\n          },\n@@ -2182,6 +2197,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n            \"srcRoute\": \"/variable-revalidate/encoding\",\n          },\n@@ -2206,6 +2222,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n            \"srcRoute\": \"/variable-revalidate/headers-instance\",\n          },\n@@ -2230,6 +2247,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n            \"srcRoute\": \"/variable-revalidate/post-method\",\n          },\n@@ -2254,6 +2272,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n            \"srcRoute\": \"/variable-revalidate/revalidate-3\",\n          },\n@@ -2278,6 +2297,7 @@ describe('app-dir static/dynamic handling', () => {\n                \"value\": \"multipart/form-data;.*\",\n              },\n            ],\n+           \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n            \"srcRoute\": \"/variable-revalidate/revalidate-360-isr\",\n          },"
        },
        {
            "sha": "641e156b701a2f303f20018a82544f7983678823",
            "filename": "test/e2e/app-dir/custom-cache-control/custom-cache-control.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fcustom-cache-control%2Fcustom-cache-control.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fcustom-cache-control%2Fcustom-cache-control.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcustom-cache-control%2Fcustom-cache-control.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -33,7 +33,7 @@ describe('custom-cache-control', () => {\n       expect(res.headers.get('cache-control')).toBe(\n         isNextDev\n           ? 'no-store, must-revalidate'\n-          : 's-maxage=120, stale-while-revalidate'\n+          : 's-maxage=120, stale-while-revalidate=31535880'\n       )\n     }\n   )\n@@ -71,7 +71,7 @@ describe('custom-cache-control', () => {\n     expect(res.headers.get('cache-control')).toBe(\n       isNextDev\n         ? 'no-store, must-revalidate'\n-        : 's-maxage=120, stale-while-revalidate'\n+        : 's-maxage=120, stale-while-revalidate=31535880'\n     )\n   })\n "
        },
        {
            "sha": "701a1cd0bbbcd6c2ede31e51a76fdf02045f66f6",
            "filename": "test/e2e/app-dir/ppr-full/ppr-full.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fppr-full.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fppr-full.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-full%2Fppr-full.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -132,7 +132,9 @@ describe('ppr-full', () => {\n             expect(cacheControl).toEqual('no-store, must-revalidate')\n           } else if (dynamic === false || dynamic === 'force-static') {\n             expect(cacheControl).toEqual(\n-              `s-maxage=${revalidate || '31536000'}, stale-while-revalidate`\n+              revalidate === undefined\n+                ? `s-maxage=31536000`\n+                : `s-maxage=${revalidate}, stale-while-revalidate=${31536000 - revalidate}`\n             )\n           } else {\n             expect(cacheControl).toEqual(\n@@ -596,7 +598,7 @@ describe('ppr-full', () => {\n \n           if (isNextStart) {\n             expect(res.headers.get('cache-control')).toEqual(\n-              's-maxage=31536000, stale-while-revalidate'\n+              's-maxage=31536000'\n             )\n           }\n \n@@ -665,7 +667,9 @@ describe('ppr-full', () => {\n               )\n             } else {\n               expect(res.headers.get('cache-control')).toEqual(\n-                `s-maxage=${revalidate || '31536000'}, stale-while-revalidate`\n+                revalidate === undefined\n+                  ? `s-maxage=31536000`\n+                  : `s-maxage=${revalidate}, stale-while-revalidate=${31536000 - revalidate}`\n               )\n             }\n "
        },
        {
            "sha": "7ba0b38ddee35270d2ce0dceb8d9e80f267a4081",
            "filename": "test/e2e/app-dir/use-cache/app/[id]/page.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fapp%2F%5Bid%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fapp%2F%5Bid%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fapp%2F%5Bid%5D%2Fpage.tsx?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -1,5 +1,8 @@\n+import { unstable_cacheLife } from 'next/cache'\n+\n async function getCachedRandom(n: number) {\n   'use cache'\n+  unstable_cacheLife('weeks')\n   return String(Math.ceil(Math.random() * n))\n }\n \n@@ -11,5 +14,7 @@ export async function generateStaticParams() {\n }\n \n export default async function Page() {\n-  return 'hit'\n+  const value = getCachedRandom(1)\n+\n+  return <p>{value}</p>\n }"
        },
        {
            "sha": "fda5b419e8d43d99e72e9b44a12d337096415f22",
            "filename": "test/e2e/app-dir/use-cache/next.config.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fnext.config.js?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -9,6 +9,7 @@ const nextConfig = {\n       frequent: {\n         stale: 19,\n         revalidate: 100,\n+        expire: 250,\n       },\n     },\n     cacheHandlers: {"
        },
        {
            "sha": "95299bfae9239ea7913985852dc603ad9f40d5ca",
            "filename": "test/e2e/app-dir/use-cache/use-cache.test.ts",
            "status": "modified",
            "additions": 36,
            "deletions": 10,
            "changes": 46,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fuse-cache.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fuse-cache.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fuse-cache.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -7,6 +7,7 @@ import {\n   createRenderResumeDataCache,\n   RenderResumeDataCache,\n } from 'next/dist/server/resume-data-cache/resume-data-cache'\n+import { PrerenderManifest } from 'next/dist/build'\n \n const GENERIC_RSC_ERROR =\n   'An error occurred in the Server Components render. The specific message is omitted in production builds to avoid leaking sensitive details. A digest property is included on this error instance which may provide additional details about the nature of the error.'\n@@ -370,21 +371,29 @@ describe('use-cache', () => {\n       ])\n     })\n \n-    it('should match the expected revalidate config on the prerender manifest', async () => {\n-      const prerenderManifest = JSON.parse(\n+    it('should match the expected revalidate and expire configs on the prerender manifest', async () => {\n+      const { version, routes, dynamicRoutes } = JSON.parse(\n         await next.readFile('.next/prerender-manifest.json')\n-      )\n+      ) as PrerenderManifest\n+\n+      expect(version).toBe(4)\n+\n+      // custom cache life profile \"frequent\"\n+      expect(routes['/cache-life'].initialRevalidateSeconds).toBe(100)\n+      expect(routes['/cache-life'].initialExpireSeconds).toBe(250)\n \n-      expect(prerenderManifest.version).toBe(4)\n-      expect(\n-        prerenderManifest.routes['/cache-life'].initialRevalidateSeconds\n-      ).toBe(100)\n+      // default expireTime\n+      expect(routes['/cache-fetch'].initialExpireSeconds).toBe(31536000)\n \n       // The revalidate config from the fetch call should lower the revalidate\n       // config for the page.\n-      expect(\n-        prerenderManifest.routes['/cache-tag'].initialRevalidateSeconds\n-      ).toBe(42)\n+      expect(routes['/cache-tag'].initialRevalidateSeconds).toBe(42)\n+\n+      if (process.env.__NEXT_EXPERIMENTAL_PPR === 'true') {\n+        // cache life profile \"weeks\"\n+        expect(dynamicRoutes['/[id]'].fallbackRevalidate).toBe(604800)\n+        expect(dynamicRoutes['/[id]'].fallbackExpire).toBe(2592000)\n+      }\n     })\n \n     it('should match the expected stale config in the page header', async () => {\n@@ -394,6 +403,23 @@ describe('use-cache', () => {\n       expect(meta.headers['x-nextjs-stale-time']).toBe('19')\n     })\n \n+    it('should send an SWR cache-control header based on the revalidate and expire values', async () => {\n+      let response = await next.fetch('/cache-life')\n+\n+      expect(response.headers.get('cache-control')).toBe(\n+        // revalidate is set to 100, expire is set to 250 => SWR 150\n+        's-maxage=100, stale-while-revalidate=150'\n+      )\n+\n+      response = await next.fetch('/cache-fetch')\n+\n+      expect(response.headers.get('cache-control')).toBe(\n+        // revalidate is set to 900, expire is one year (31536000, default\n+        // expireTime) => SWR 31535100\n+        's-maxage=900, stale-while-revalidate=31535100'\n+      )\n+    })\n+\n     it('should propagate unstable_cache tags correctly', async () => {\n       const meta = JSON.parse(\n         await next.readFile('.next/server/app/cache-tag.meta')"
        },
        {
            "sha": "c53b91e7f637eaa6146eaa642a9f1f57e426ed66",
            "filename": "test/e2e/prerender.test.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 4,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fprerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fe2e%2Fprerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fprerender.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -106,84 +106,98 @@ describe('Prerender', () => {\n     '/': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/index.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 2,\n       srcRoute: null,\n     },\n     '/blog/[post3]': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blog/[post3].json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 10,\n       srcRoute: '/blog/[post]',\n     },\n     '/blog/post-1': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blog/post-1.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 10,\n       srcRoute: '/blog/[post]',\n     },\n     '/blog/post-2': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blog/post-2.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 10,\n       srcRoute: '/blog/[post]',\n     },\n     '/blog/post-4': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blog/post-4.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 10,\n       srcRoute: '/blog/[post]',\n     },\n     '/blog/post-1/comment-1': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blog/post-1/comment-1.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 2,\n       srcRoute: '/blog/[post]/[comment]',\n     },\n     '/blog/post-2/comment-2': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blog/post-2/comment-2.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 2,\n       srcRoute: '/blog/[post]/[comment]',\n     },\n     '/blog/post.1': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blog/post.1.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 10,\n       srcRoute: '/blog/[post]',\n     },\n     '/catchall-explicit/another/value': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall-explicit/another/value.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall-explicit/[...slug]',\n     },\n     '/catchall-explicit/first': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall-explicit/first.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall-explicit/[...slug]',\n     },\n     '/catchall-explicit/hello/another': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall-explicit/hello/another.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall-explicit/[...slug]',\n     },\n     '/catchall-explicit/second': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall-explicit/second.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall-explicit/[...slug]',\n     },\n     '/catchall-explicit/[first]/[second]': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall-explicit/[first]/[second].json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall-explicit/[...slug]',\n     },\n     '/catchall-explicit/[third]/[fourth]': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall-explicit/[third]/[fourth].json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall-explicit/[...slug]',\n     },\n@@ -208,6 +222,7 @@ describe('Prerender', () => {\n     '/another': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/another.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: null,\n     },\n@@ -232,12 +247,14 @@ describe('Prerender', () => {\n     '/blocking-fallback-some/a': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blocking-fallback-some/a.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/blocking-fallback-some/[slug]',\n     },\n     '/blocking-fallback-some/b': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blocking-fallback-some/b.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/blocking-fallback-some/[slug]',\n     },\n@@ -250,12 +267,14 @@ describe('Prerender', () => {\n     '/blocking-fallback/test-errors-1': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blocking-fallback/test-errors-1.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/blocking-fallback/[slug]',\n     },\n     '/blog': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/blog.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 10,\n       srcRoute: null,\n     },\n@@ -316,24 +335,28 @@ describe('Prerender', () => {\n     '/catchall/another/value': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall/another/value.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall/[...slug]',\n     },\n     '/catchall/first': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall/first.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall/[...slug]',\n     },\n     '/catchall/second': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall/second.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall/[...slug]',\n     },\n     '/catchall/hello/another': {\n       allowHeader,\n       dataRoute: `/_next/data/${next.buildId}/catchall/hello/another.json`,\n+      initialExpireSeconds: 31536000,\n       initialRevalidateSeconds: 1,\n       srcRoute: '/catchall/[...slug]',\n     },\n@@ -650,7 +673,7 @@ describe('Prerender', () => {\n         expect(initialRes.headers.get('cache-control')).toBe(\n           isDeploy\n             ? 'public, max-age=0, must-revalidate'\n-            : 's-maxage=2, stale-while-revalidate'\n+            : 's-maxage=2, stale-while-revalidate=31535998'\n         )\n       })\n     }\n@@ -1301,9 +1324,7 @@ describe('Prerender', () => {\n       it('should use correct caching headers for a no-revalidate page', async () => {\n         const initialRes = await fetchViaHTTP(next.url, '/something')\n         expect(initialRes.headers.get('cache-control')).toBe(\n-          isDeploy\n-            ? 'public, max-age=0, must-revalidate'\n-            : 's-maxage=31536000, stale-while-revalidate'\n+          isDeploy ? 'public, max-age=0, must-revalidate' : 's-maxage=31536000'\n         )\n         const initialHtml = await initialRes.text()\n         expect(initialHtml).toMatch(/hello.*?world/)"
        },
        {
            "sha": "57ddb31d205e454ca3dc147f1da001e654301295",
            "filename": "test/integration/not-found-revalidate/test/index.test.js",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fintegration%2Fnot-found-revalidate%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fintegration%2Fnot-found-revalidate%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnot-found-revalidate%2Ftest%2Findex.test.js?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -82,7 +82,7 @@ const runTests = () => {\n     let $ = cheerio.load(await res.text())\n \n     expect(res.headers.get('cache-control')).toBe(\n-      `s-maxage=1, stale-while-revalidate`\n+      `s-maxage=1, stale-while-revalidate=31535999`\n     )\n     expect(res.status).toBe(404)\n     expect(JSON.parse($('#props').text()).notFound).toBe(true)\n@@ -92,7 +92,7 @@ const runTests = () => {\n     $ = cheerio.load(await res.text())\n \n     expect(res.headers.get('cache-control')).toBe(\n-      `s-maxage=1, stale-while-revalidate`\n+      `s-maxage=1, stale-while-revalidate=31535999`\n     )\n     expect(res.status).toBe(404)\n     expect(JSON.parse($('#props').text()).notFound).toBe(true)\n@@ -103,7 +103,7 @@ const runTests = () => {\n \n     const props = JSON.parse($('#props').text())\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n     expect(res.status).toBe(200)\n     expect(props.found).toBe(true)\n@@ -116,7 +116,7 @@ const runTests = () => {\n \n     const props2 = JSON.parse($('#props').text())\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n     expect(res.status).toBe(200)\n     expect(props2.found).toBe(true)\n@@ -129,7 +129,7 @@ const runTests = () => {\n \n     const props3 = JSON.parse($('#props').text())\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n     expect(res.status).toBe(200)\n     expect(props3.found).toBe(true)\n@@ -148,7 +148,7 @@ const runTests = () => {\n     let $ = cheerio.load(await res.text())\n \n     expect(res.headers.get('cache-control')).toBe(\n-      `s-maxage=1, stale-while-revalidate`\n+      `s-maxage=1, stale-while-revalidate=31535999`\n     )\n     expect(res.status).toBe(404)\n     expect(JSON.parse($('#props').text()).notFound).toBe(true)\n@@ -159,7 +159,7 @@ const runTests = () => {\n \n     const props = JSON.parse($('#props').text())\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n     expect(res.status).toBe(200)\n     expect(props.found).toBe(true)\n@@ -172,7 +172,7 @@ const runTests = () => {\n \n     const props2 = JSON.parse($('#props').text())\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n     expect(res.status).toBe(200)\n     expect(props2.found).toBe(true)\n@@ -185,7 +185,7 @@ const runTests = () => {\n \n     const props3 = JSON.parse($('#props').text())\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n     expect(res.status).toBe(200)\n     expect(props3.found).toBe(true)"
        },
        {
            "sha": "0518d9b98b46b305f85b509d30566d5e65125b3c",
            "filename": "test/production/prerender-prefetch/index.test.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fprerender-prefetch%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fprerender-prefetch%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fprerender-prefetch%2Findex.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -300,6 +300,13 @@ describe('Prerender prefetch', () => {\n           pages: new FileRef(join(__dirname, 'app/pages')),\n         },\n         dependencies: {},\n+        env: {\n+          // Simulate that a CDN has consumed the SWR cache-control header,\n+          // otherwise the browser will cache responses and which messes with\n+          // the expectations in this test.\n+          // See https://github.com/vercel/next.js/pull/70674 for context.\n+          NEXT_PRIVATE_CDN_CONSUMED_SWR_CACHE_CONTROL: '1',\n+        },\n       })\n     })\n     afterAll(() => next.destroy())\n@@ -319,6 +326,13 @@ describe('Prerender prefetch', () => {\n           },\n         },\n         dependencies: {},\n+        env: {\n+          // Simulate that a CDN has consumed the SWR cache-control header,\n+          // otherwise the browser will cache responses and which messes with\n+          // the expectations in this test.\n+          // See https://github.com/vercel/next.js/pull/70674 for context.\n+          NEXT_PRIVATE_CDN_CONSUMED_SWR_CACHE_CONTROL: '1',\n+        },\n       })\n     })\n     afterAll(() => next.destroy())"
        },
        {
            "sha": "bd2019da5181b9e0a6def7766622cfa4d5df5e21",
            "filename": "test/production/standalone-mode/required-server-files/pages/gssp.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Fpages%2Fgssp.js",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Fpages%2Fgssp.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Fpages%2Fgssp.js?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -5,7 +5,7 @@ import next from 'next' // force a warning during `next build`\n import { useRouter } from 'next/router'\n \n export async function getServerSideProps({ res }) {\n-  res.setHeader('cache-control', 's-maxage=1, stale-while-revalidate')\n+  res.setHeader('cache-control', 's-maxage=1, stale-while-revalidate=31535999')\n \n   const data = await fs.promises.readFile(\n     path.join(process.cwd(), 'data.txt'),"
        },
        {
            "sha": "9dd142dcfc1ee0add542087e84c614b5e7f28c1a",
            "filename": "test/production/standalone-mode/required-server-files/required-server-files-app.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-app.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-app.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-app.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -114,9 +114,7 @@ describe('required server files app router', () => {\n       },\n     })\n     expect(res.status).toBe(200)\n-    expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=31536000, stale-while-revalidate'\n-    )\n+    expect(res.headers.get('cache-control')).toBe('s-maxage=31536000')\n   })\n \n   it('should handle optional catchall', async () => {\n@@ -176,7 +174,7 @@ describe('required server files app router', () => {\n     })\n     expect(res.status).toBe(200)\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=3600, stale-while-revalidate'\n+      's-maxage=3600, stale-while-revalidate=31532400'\n     )\n   })\n "
        },
        {
            "sha": "582b760a549d71518afe3936ad8cd6bc78b5fce8",
            "filename": "test/production/standalone-mode/required-server-files/required-server-files-i18n.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-i18n.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-i18n.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-i18n.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -178,7 +178,7 @@ describe('required server files i18n', () => {\n     })\n     expect(res.status).toBe(200)\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n \n     await waitFor(2000)\n@@ -189,7 +189,7 @@ describe('required server files i18n', () => {\n     })\n     expect(res2.status).toBe(404)\n     expect(res2.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n   })\n \n@@ -201,7 +201,7 @@ describe('required server files i18n', () => {\n     })\n     expect(res.status).toBe(200)\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n \n     await next.patchFile('standalone/data.txt', 'hide')\n@@ -213,7 +213,7 @@ describe('required server files i18n', () => {\n \n     expect(res2.status).toBe(404)\n     expect(res2.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n   })\n "
        },
        {
            "sha": "8d49d1dc91e049d259b030a6644f63fddc50ca85",
            "filename": "test/production/standalone-mode/required-server-files/required-server-files.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 14,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ae9d382474b6b9513876591e9d74c066d5d3229/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files.test.ts?ref=3ae9d382474b6b9513876591e9d74c066d5d3229",
            "patch": "@@ -218,13 +218,13 @@ describe('required server files', () => {\n       case: 'redirect no revalidate',\n       path: '/optional-ssg/redirect-1',\n       dest: '/somewhere',\n-      cacheControl: 's-maxage=31536000, stale-while-revalidate',\n+      cacheControl: 's-maxage=31536000',\n     },\n     {\n       case: 'redirect with revalidate',\n       path: '/optional-ssg/redirect-2',\n       dest: '/somewhere-else',\n-      cacheControl: 's-maxage=5, stale-while-revalidate',\n+      cacheControl: 's-maxage=5, stale-while-revalidate=31535995',\n     },\n   ])(\n     `should have correct cache-control for $case`,\n@@ -295,13 +295,13 @@ describe('required server files', () => {\n       case: 'notFound no revalidate',\n       path: '/optional-ssg/not-found-1',\n       dest: '/somewhere',\n-      cacheControl: 's-maxage=31536000, stale-while-revalidate',\n+      cacheControl: 's-maxage=31536000',\n     },\n     {\n       case: 'notFound with revalidate',\n       path: '/optional-ssg/not-found-2',\n       dest: '/somewhere-else',\n-      cacheControl: 's-maxage=5, stale-while-revalidate',\n+      cacheControl: 's-maxage=5, stale-while-revalidate=31535995',\n     },\n   ])(\n     `should have correct cache-control for $case`,\n@@ -327,9 +327,7 @@ describe('required server files', () => {\n   it('should have the correct cache-control for props with no revalidate', async () => {\n     const res = await fetchViaHTTP(appPort, '/optional-ssg/props-no-revalidate')\n     expect(res.status).toBe(200)\n-    expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=31536000, stale-while-revalidate'\n-    )\n+    expect(res.headers.get('cache-control')).toBe('s-maxage=31536000')\n     const $ = cheerio.load(await res.text())\n     expect(JSON.parse($('#props').text()).params).toEqual({\n       rest: ['props-no-revalidate'],\n@@ -341,9 +339,7 @@ describe('required server files', () => {\n       undefined\n     )\n     expect(dataRes.status).toBe(200)\n-    expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=31536000, stale-while-revalidate'\n-    )\n+    expect(res.headers.get('cache-control')).toBe('s-maxage=31536000')\n     expect((await dataRes.json()).pageProps.params).toEqual({\n       rest: ['props-no-revalidate'],\n     })\n@@ -525,7 +521,7 @@ describe('required server files', () => {\n     })\n     expect(res.status).toBe(200)\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n \n     await waitFor(2000)\n@@ -536,7 +532,7 @@ describe('required server files', () => {\n     })\n     expect(res2.status).toBe(404)\n     expect(res2.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n   })\n \n@@ -548,7 +544,7 @@ describe('required server files', () => {\n     })\n     expect(res.status).toBe(200)\n     expect(res.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n \n     await next.patchFile('standalone/data.txt', 'hide')\n@@ -560,7 +556,7 @@ describe('required server files', () => {\n \n     expect(res2.status).toBe(404)\n     expect(res2.headers.get('cache-control')).toBe(\n-      's-maxage=1, stale-while-revalidate'\n+      's-maxage=1, stale-while-revalidate=31535999'\n     )\n   })\n "
        }
    ],
    "stats": {
        "total": 1100,
        "additions": 660,
        "deletions": 440
    }
}