{
    "author": "eps1lon",
    "message": "[test] Exclude Next.js internal stack frames from cache-component-error CLI output assertions (#85421)",
    "sha": "0b6fe158c61fec5f30289856a3d1c078b0be7022",
    "files": [
        {
            "sha": "6a5feecdfd6c04265246bfd371449e9d2382417f",
            "filename": "test/e2e/app-dir/cache-components-errors/cache-components-errors.test.ts",
            "status": "modified",
            "additions": 66,
            "deletions": 215,
            "changes": 281,
            "blob_url": "https://github.com/vercel/next.js/blob/0b6fe158c61fec5f30289856a3d1c078b0be7022/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0b6fe158c61fec5f30289856a3d1c078b0be7022/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Fcache-components-errors.test.ts?ref=0b6fe158c61fec5f30289856a3d1c078b0be7022",
            "patch": "@@ -226,44 +226,15 @@ describe('Cache Components Errors', () => {\n             }\n           } else {\n             if (isDebugPrerender) {\n-              // expect(output).toMatchInlineSnapshot(`\n-              //  \"Error: Route \"/dynamic-metadata-error-route\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n-              //      at InnerLayoutRouter (bundler:///<next-src>)\n-              //      at RedirectErrorBoundary (bundler:///<next-src>)\n-              //      at RedirectBoundary (bundler:///<next-src>)\n-              //      at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-              //      at LoadingBoundary (bundler:///<next-src>)\n-              //      at ErrorBoundary (bundler:///<next-src>)\n-              //      at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at ScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at RenderFromTemplateContext (bundler:///<next-src>)\n-              //      at OuterLayoutRouter (bundler:///<next-src>)\n-              //      at main (<anonymous>)\n-              //      at body (<anonymous>)\n-              //      at html (<anonymous>)\n-              //      at InnerLayoutRouter (bundler:///<next-src>)\n-              //      at RedirectErrorBoundary (bundler:///<next-src>)\n-              //      at RedirectBoundary (bundler:///<next-src>)\n-              //      at HTTPAccessFallbackErrorBoundary (bundler:///<next-src>)\n-              //      at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-              //      at LoadingBoundary (bundler:///<next-src>)\n-              //      at ErrorBoundary (bundler:///<next-src>)\n-              //      at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at ScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at RenderFromTemplateContext (bundler:///<next-src>)\n-              //      at OuterLayoutRouter (bundler:///<next-src>)\n-              //    339 |  */\n-              //    340 | function InnerLayoutRouter({\n-              //  > 341 |   tree,\n-              //        |   ^\n-              //    342 |   segmentPath,\n-              //    343 |   debugNameContext,\n-              //    344 |   cacheNode,\n-              //  To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/dynamic-metadata-error-route\" in your browser to investigate the error.\n-              //  Error occurred prerendering page \"/dynamic-metadata-error-route\". Read more: https://nextjs.org/docs/messages/prerender-error\n-              //  > Export encountered errors on following paths:\n-              //  \t/dynamic-metadata-error-route/page: /dynamic-metadata-error-route\"\n-              // `)\n+              expect(output).toMatchInlineSnapshot(`\n+               \"Error: Route \"/dynamic-metadata-error-route\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n+                   at <FIXME-library-internal>\n+               To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/dynamic-metadata-error-route\" in your browser to investigate the error.\n+               Error occurred prerendering page \"/dynamic-metadata-error-route\". Read more: https://nextjs.org/docs/messages/prerender-error\n+\n+               > Export encountered errors on following paths:\n+               \t/dynamic-metadata-error-route/page: /dynamic-metadata-error-route\"\n+              `)\n             } else {\n               expect(output).toMatchInlineSnapshot(`\n                \"Error: Route \"/dynamic-metadata-error-route\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n@@ -754,78 +725,26 @@ describe('Cache Components Errors', () => {\n             }\n           } else {\n             if (isDebugPrerender) {\n-              // expect(output).toMatchInlineSnapshot(`\n-              //  \"Error: Route \"/dynamic-root\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n-              //      at IndirectionTwo (bundler:///app/dynamic-root/indirection.tsx:7:34)\n-              //      at InnerLayoutRouter (bundler:///<next-src>)\n-              //      at RedirectErrorBoundary (bundler:///<next-src>)\n-              //      at RedirectBoundary (bundler:///<next-src>)\n-              //      at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-              //      at LoadingBoundary (bundler:///<next-src>)\n-              //      at ErrorBoundary (bundler:///<next-src>)\n-              //      at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at ScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at RenderFromTemplateContext (bundler:///<next-src>)\n-              //      at OuterLayoutRouter (bundler:///<next-src>)\n-              //      at main (<anonymous>)\n-              //      at body (<anonymous>)\n-              //      at html (<anonymous>)\n-              //      at InnerLayoutRouter (bundler:///<next-src>)\n-              //      at RedirectErrorBoundary (bundler:///<next-src>)\n-              //      at RedirectBoundary (bundler:///<next-src>)\n-              //      at HTTPAccessFallbackErrorBoundary (bundler:///<next-src>)\n-              //      at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-              //      at LoadingBoundary (bundler:///<next-src>)\n-              //      at ErrorBoundary (bundler:///<next-src>)\n-              //      at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at ScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at RenderFromTemplateContext (bundler:///<next-src>)\n-              //      at OuterLayoutRouter (bundler:///<next-src>)\n-              //     5 | }\n-              //     6 |\n-              //  >  7 | export function IndirectionTwo({ children }) {\n-              //       |                                  ^\n-              //     8 |   return children\n-              //     9 | }\n-              //    10 |\n-              //  To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/dynamic-root\" in your browser to investigate the error.\n-              //  Error: Route \"/dynamic-root\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n-              //      at InnerLayoutRouter (bundler:///<next-src>)\n-              //      at RedirectErrorBoundary (bundler:///<next-src>)\n-              //      at RedirectBoundary (bundler:///<next-src>)\n-              //      at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-              //      at LoadingBoundary (bundler:///<next-src>)\n-              //      at ErrorBoundary (bundler:///<next-src>)\n-              //      at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at ScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at RenderFromTemplateContext (bundler:///<next-src>)\n-              //      at OuterLayoutRouter (bundler:///<next-src>)\n-              //      at main (<anonymous>)\n-              //      at body (<anonymous>)\n-              //      at html (<anonymous>)\n-              //      at InnerLayoutRouter (bundler:///<next-src>)\n-              //      at RedirectErrorBoundary (bundler:///<next-src>)\n-              //      at RedirectBoundary (bundler:///<next-src>)\n-              //      at HTTPAccessFallbackErrorBoundary (bundler:///<next-src>)\n-              //      at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-              //      at LoadingBoundary (bundler:///<next-src>)\n-              //      at ErrorBoundary (bundler:///<next-src>)\n-              //      at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at ScrollAndFocusHandler (bundler:///<next-src>)\n-              //      at RenderFromTemplateContext (bundler:///<next-src>)\n-              //      at OuterLayoutRouter (bundler:///<next-src>)\n-              //    339 |  */\n-              //    340 | function InnerLayoutRouter({\n-              //  > 341 |   tree,\n-              //        |   ^\n-              //    342 |   segmentPath,\n-              //    343 |   debugNameContext,\n-              //    344 |   cacheNode,\n-              //  To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/dynamic-root\" in your browser to investigate the error.\n-              //  Error occurred prerendering page \"/dynamic-root\". Read more: https://nextjs.org/docs/messages/prerender-error\n-              //  > Export encountered errors on following paths:\n-              //  \t/dynamic-root/page: /dynamic-root\"\n-              // `)\n+              expect(output).toMatchInlineSnapshot(`\n+               \"Error: Route \"/dynamic-root\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n+                   at IndirectionTwo (bundler:///app/dynamic-root/indirection.tsx:7:34)\n+                   at <FIXME-library-internal>\n+                  5 | }\n+                  6 |\n+               >  7 | export function IndirectionTwo({ children }) {\n+                    |                                  ^\n+                  8 |   return children\n+                  9 | }\n+                 10 |\n+               To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/dynamic-root\" in your browser to investigate the error.\n+               Error: Route \"/dynamic-root\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n+                   at <FIXME-library-internal>\n+               To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/dynamic-root\" in your browser to investigate the error.\n+               Error occurred prerendering page \"/dynamic-root\". Read more: https://nextjs.org/docs/messages/prerender-error\n+\n+               > Export encountered errors on following paths:\n+               \t/dynamic-root/page: /dynamic-root\"\n+              `)\n             } else {\n               expect(output).toMatchInlineSnapshot(`\n                \"Error: Route \"/dynamic-root\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n@@ -2199,56 +2118,17 @@ describe('Cache Components Errors', () => {\n               }\n             } else {\n               if (isDebugPrerender) {\n-                // expect(output).toMatchInlineSnapshot(`\n-                //  \"Error: Route \"/sync-attribution/unguarded-async-guarded-clientsync\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n-                //      at section (<anonymous>)\n-                //      at main (<anonymous>)\n-                //      at InnerLayoutRouter (bundler:///<next-src>)\n-                //      at RedirectErrorBoundary (bundler:///<next-src>)\n-                //      at RedirectBoundary (bundler:///<next-src>)\n-                //      at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-                //      at LoadingBoundary (bundler:///<next-src>)\n-                //      at ErrorBoundary (bundler:///<next-src>)\n-                //      at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-                //      at ScrollAndFocusHandler (bundler:///<next-src>)\n-                //      at RenderFromTemplateContext (<anonymous>)\n-                //      at OuterLayoutRouter (bundler:///<next-src>)\n-                //      at main (<anonymous>)\n-                //      at body (<anonymous>)\n-                //      at html (<anonymous>)\n-                //      at InnerLayoutRouter (bundler:///<next-src>)\n-                //      at RedirectErrorBoundary (bundler:///<next-src>)\n-                //      at RedirectBoundary (bundler:///<next-src>)\n-                //      at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-                //      at LoadingBoundary (bundler:///<next-src>)\n-                //      at ErrorBoundary (bundler:///<next-src>)\n-                //      at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-                //      at ScrollAndFocusHandler (bundler:///<next-src>)\n-                //      at RenderFromTemplateContext (<anonymous>)\n-                //      at OuterLayoutRouter (bundler:///<next-src>)\n-                //      at InnerLayoutRouter (bundler:///<next-src>)\n-                //      at RedirectErrorBoundary (bundler:///<next-src>)\n-                //      at RedirectBoundary (bundler:///<next-src>)\n-                //      at HTTPAccessFallbackErrorBoundary (bundler:///<next-src>)\n-                //      at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-                //      at LoadingBoundary (bundler:///<next-src>)\n-                //      at ErrorBoundary (bundler:///<next-src>)\n-                //      at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-                //      at ScrollAndFocusHandler (bundler:///<next-src>)\n-                //      at RenderFromTemplateContext (<anonymous>)\n-                //      at OuterLayoutRouter (bundler:///<next-src>)\n-                //    339 |  */\n-                //    340 | function InnerLayoutRouter({\n-                //  > 341 |   tree,\n-                //        |   ^\n-                //    342 |   segmentPath,\n-                //    343 |   debugNameContext,\n-                //    344 |   cacheNode,\n-                //  To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/sync-attribution/unguarded-async-guarded-clientsync\" in your browser to investigate the error.\n-                //  Error occurred prerendering page \"/sync-attribution/unguarded-async-guarded-clientsync\". Read more: https://nextjs.org/docs/messages/prerender-error\n-                //  > Export encountered errors on following paths:\n-                //  \t/sync-attribution/unguarded-async-guarded-clientsync/page: /sync-attribution/unguarded-async-guarded-clientsync\"\n-                // `)\n+                expect(output).toMatchInlineSnapshot(`\n+                 \"Error: Route \"/sync-attribution/unguarded-async-guarded-clientsync\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n+                     at section (<anonymous>)\n+                     at main (<anonymous>)\n+                     at <FIXME-library-internal>\n+                 To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/sync-attribution/unguarded-async-guarded-clientsync\" in your browser to investigate the error.\n+                 Error occurred prerendering page \"/sync-attribution/unguarded-async-guarded-clientsync\". Read more: https://nextjs.org/docs/messages/prerender-error\n+\n+                 > Export encountered errors on following paths:\n+                 \t/sync-attribution/unguarded-async-guarded-clientsync/page: /sync-attribution/unguarded-async-guarded-clientsync\"\n+                `)\n               } else {\n                 expect(output).toMatchInlineSnapshot(`\n                  \"Error: Route \"/sync-attribution/unguarded-async-guarded-clientsync\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n@@ -3123,30 +3003,31 @@ describe('Cache Components Errors', () => {\n               }\n             } else {\n               if (isDebugPrerender) {\n-                // expect(output).toMatchInlineSnapshot(`\n-                //  \"Error: \"use cache: private\" must not be used within \"use cache\". It can only be nested inside of another \"use cache: private\".\n-                //      at 0 (bundler:///app/use-cache-private-in-use-cache/page.tsx:15:1)\n-                //    13 | }\n-                //    14 |\n-                //  > 15 | async function Private() {\n-                //       | ^\n-                //    16 |   'use cache: private'\n-                //    17 |\n-                //    18 |   return <p>Private</p>\n-                //  Error: \"use cache: private\" must not be used within \"use cache\". It can only be nested inside of another \"use cache: private\".\n-                //      at 1 (bundler:///app/use-cache-private-in-use-cache/page.tsx:15:1)\n-                //    13 | }\n-                //    14 |\n-                //  > 15 | async function Private() {\n-                //       | ^\n-                //    16 |   'use cache: private'\n-                //    17 |\n-                //    18 |   return <p>Private</p>\n-                //  To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/use-cache-private-in-use-cache\" in your browser to investigate the error.\n-                //  Error occurred prerendering page \"/use-cache-private-in-use-cache\". Read more: https://nextjs.org/docs/messages/prerender-error\n-                //  > Export encountered errors on following paths:\n-                //  \t/use-cache-private-in-use-cache/page: /use-cache-private-in-use-cache\"\n-                // `)\n+                expect(output).toMatchInlineSnapshot(`\n+                 \"Error: \"use cache: private\" must not be used within \"use cache\". It can only be nested inside of another \"use cache: private\".\n+                     at 0 (bundler:///app/use-cache-private-in-use-cache/page.tsx:15:1)\n+                   13 | }\n+                   14 |\n+                 > 15 | async function Private() {\n+                      | ^\n+                   16 |   'use cache: private'\n+                   17 |\n+                   18 |   return <p>Private</p>\n+                 Error: \"use cache: private\" must not be used within \"use cache\". It can only be nested inside of another \"use cache: private\".\n+                     at 1 (bundler:///app/use-cache-private-in-use-cache/page.tsx:15:1)\n+                   13 | }\n+                   14 |\n+                 > 15 | async function Private() {\n+                      | ^\n+                   16 |   'use cache: private'\n+                   17 |\n+                   18 |   return <p>Private</p>\n+                 To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/use-cache-private-in-use-cache\" in your browser to investigate the error.\n+                 Error occurred prerendering page \"/use-cache-private-in-use-cache\". Read more: https://nextjs.org/docs/messages/prerender-error\n+\n+                 > Export encountered errors on following paths:\n+                 \t/use-cache-private-in-use-cache/page: /use-cache-private-in-use-cache\"\n+                `)\n               } else {\n                 expect(output).toMatchInlineSnapshot(`\n                  \"Error: \"use cache: private\" must not be used within \"use cache\". It can only be nested inside of another \"use cache: private\".\n@@ -3227,37 +3108,7 @@ describe('Cache Components Errors', () => {\n               if (isDebugPrerender) {\n                 expect(output).toMatchInlineSnapshot(`\n                  \"Error: Route \"/use-cache-private-without-suspense\": Uncached data was accessed outside of <Suspense>. This delays the entire page from rendering, resulting in a slow user experience. Learn more: https://nextjs.org/docs/messages/blocking-route\n-                     at InnerLayoutRouter (bundler:///<next-src>)\n-                     at RedirectErrorBoundary (bundler:///<next-src>)\n-                     at RedirectBoundary (bundler:///<next-src>)\n-                     at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-                     at LoadingBoundary (bundler:///<next-src>)\n-                     at ErrorBoundary (bundler:///<next-src>)\n-                     at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-                     at ScrollAndFocusHandler (bundler:///<next-src>)\n-                     at RenderFromTemplateContext (bundler:///<next-src>)\n-                     at OuterLayoutRouter (bundler:///<next-src>)\n-                     at main (<anonymous>)\n-                     at body (<anonymous>)\n-                     at html (<anonymous>)\n-                     at InnerLayoutRouter (bundler:///<next-src>)\n-                     at RedirectErrorBoundary (bundler:///<next-src>)\n-                     at RedirectBoundary (bundler:///<next-src>)\n-                     at HTTPAccessFallbackErrorBoundary (bundler:///<next-src>)\n-                     at HTTPAccessFallbackBoundary (bundler:///<next-src>)\n-                     at LoadingBoundary (bundler:///<next-src>)\n-                     at ErrorBoundary (bundler:///<next-src>)\n-                     at InnerScrollAndFocusHandler (bundler:///<next-src>)\n-                     at ScrollAndFocusHandler (bundler:///<next-src>)\n-                     at RenderFromTemplateContext (bundler:///<next-src>)\n-                     at OuterLayoutRouter (bundler:///<next-src>)\n-                   332 |  */\n-                   333 | function InnerLayoutRouter({\n-                 > 334 |   tree,\n-                       |   ^\n-                   335 |   segmentPath,\n-                   336 |   debugNameContext,\n-                   337 |   cacheNode,\n+                     at <FIXME-library-internal>\n                  To get a more detailed stack trace and pinpoint the issue, start the app in development mode by running \\`next dev\\`, then open \"/use-cache-private-without-suspense\" in your browser to investigate the error.\n                  Error occurred prerendering page \"/use-cache-private-without-suspense\". Read more: https://nextjs.org/docs/messages/prerender-error\n "
        },
        {
            "sha": "ac7de71eb16cc284e53067159c7bf68036705eee",
            "filename": "test/e2e/app-dir/cache-components-errors/utils.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/0b6fe158c61fec5f30289856a3d1c078b0be7022/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0b6fe158c61fec5f30289856a3d1c078b0be7022/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcache-components-errors%2Futils.ts?ref=0b6fe158c61fec5f30289856a3d1c078b0be7022",
            "patch": "@@ -33,6 +33,9 @@ export function getPrerenderOutput(\n   const replaceNextDistStackFrame = () =>\n     `at ${abc[a++ % abc.length]} (<next-dist-dir>)`\n \n+  const isLikelyLibraryInternalStackFrame = (line: string) => {\n+    return line.startsWith('    at InnerLayoutRouter (')\n+  }\n   const replaceAnonymousStackFrame = (_m, name) => {\n     const deterministicName = hostElementsUsedInFixtures.includes(name)\n       ? name\n@@ -44,7 +47,32 @@ export function getPrerenderOutput(\n   const replaceMinifiedName = () => `at ${abc[a++ % abc.length]} (`\n   const replaceNumericModuleId = () => `at ${n++} (`\n \n+  let isErrorWithStackTraceStartingInLibraryInternals = false\n   for (let line of cliOutput.split('\\n')) {\n+    if (\n+      !isErrorWithStackTraceStartingInLibraryInternals &&\n+      isLikelyLibraryInternalStackFrame(line)\n+    ) {\n+      isErrorWithStackTraceStartingInLibraryInternals = true\n+      lines.push('    at <FIXME-library-internal>')\n+      continue\n+    }\n+    if (isErrorWithStackTraceStartingInLibraryInternals) {\n+      if (\n+        // stackframe\n+        line.startsWith('    at ') ||\n+        // codeframe\n+        /^ {2}\\d+ \\|/.test(line) ||\n+        // codeframe cursor for callsite\n+        /^> \\d+ \\|/.test(line) ||\n+        /^\\s+\\|/.test(line)\n+      ) {\n+        // still an error with a stack trace starting in library internals\n+        continue\n+      } else {\n+        isErrorWithStackTraceStartingInLibraryInternals = false\n+      }\n+    }\n     if (line.includes('Collecting page data')) {\n       foundPrerenderingLine = true\n       continue"
        }
    ],
    "stats": {
        "total": 309,
        "additions": 94,
        "deletions": 215
    }
}