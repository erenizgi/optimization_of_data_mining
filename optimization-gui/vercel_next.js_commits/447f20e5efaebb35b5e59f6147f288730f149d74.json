{
    "author": "raunofreiberg",
    "message": "[dev-tools] Re-focus previous item after closing sub menu (#80099)\n\nThis PR fixes a small bug with the menu keyboard interactions. Namely,\nif you open a sub-menu and close it, visually the correct item is\nhighlighted but does not respond when pressing Enter.\n\n\nThe bug is visible here on this video:\n\n\nhttps://github.com/user-attachments/assets/368311eb-1400-4a76-b42b-b59676dedef2\n\n\nAfter this PR you can infinitely toggle between the menus:\n\n\n\nhttps://github.com/user-attachments/assets/9ff7f5cd-67cf-4db5-a12f-fd1bf8ebe96b",
    "sha": "447f20e5efaebb35b5e59f6147f288730f149d74",
    "files": [
        {
            "sha": "e5c57ad984ab218842057bdd224f6dfecf9ff2a4",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 10,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/447f20e5efaebb35b5e59f6147f288730f149d74/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/447f20e5efaebb35b5e59f6147f288730f149d74/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=447f20e5efaebb35b5e59f6147f288730f149d74",
            "patch": "@@ -219,18 +219,21 @@ function DevToolsPopover({\n     dispatch({ type: ACTION_ERROR_OVERLAY_TOGGLE })\n   }\n \n-  function openRootMenu() {\n-    setOpen((prevOpen) => {\n-      if (prevOpen === null) select('first')\n-      return OVERLAYS.Root\n-    })\n+  function closeToRootMenu() {\n+    setOpen(OVERLAYS.Root)\n+    // We wait for the menu animation to complete\n+    setTimeout(() => {\n+      // This places focus again on the selected item\n+      // so you can press Enter to trigger the selected item again\n+      select(selectedIndex)\n+    }, MENU_DURATION_MS)\n   }\n \n   function onTriggerClick() {\n     if (open === OVERLAYS.Root) {\n       setOpen(null)\n     } else {\n-      openRootMenu()\n+      setOpen(OVERLAYS.Root)\n       setTimeout(() => {\n         select('first')\n       })\n@@ -301,7 +304,7 @@ function DevToolsPopover({\n       {/* Route Info */}\n       <RouteInfo\n         isOpen={isRouteInfoOpen}\n-        close={openRootMenu}\n+        close={closeToRootMenu}\n         triggerRef={triggerRef}\n         style={popover}\n         routerType={routerType}\n@@ -311,15 +314,15 @@ function DevToolsPopover({\n       {/* Turbopack Info */}\n       <TurbopackInfo\n         isOpen={isTurbopackInfoOpen}\n-        close={openRootMenu}\n+        close={closeToRootMenu}\n         triggerRef={triggerRef}\n         style={popover}\n       />\n \n       {/* Preferences */}\n       <UserPreferences\n         isOpen={isPreferencesOpen}\n-        close={openRootMenu}\n+        close={closeToRootMenu}\n         triggerRef={triggerRef}\n         style={popover}\n         hide={handleHideDevtools}\n@@ -333,7 +336,7 @@ function DevToolsPopover({\n       {process.env.__NEXT_DEVTOOL_SEGMENT_EXPLORER ? (\n         <SegmentsExplorer\n           isOpen={isSegmentExplorerOpen}\n-          close={openRootMenu}\n+          close={closeToRootMenu}\n           triggerRef={triggerRef}\n           style={popover}\n         />"
        }
    ],
    "stats": {
        "total": 23,
        "additions": 13,
        "deletions": 10
    }
}