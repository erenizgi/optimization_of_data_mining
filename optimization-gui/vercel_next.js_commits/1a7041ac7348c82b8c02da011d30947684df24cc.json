{
    "author": "mischnic",
    "message": "Turbopack: only generate error string in error case (#83884)\n\nDon't create gigabytes of unused strings here.",
    "sha": "1a7041ac7348c82b8c02da011d30947684df24cc",
    "files": [
        {
            "sha": "efee5004f2c3886b30e103bb7ebab13c5c7999c8",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/merged_modules.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 3,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1a7041ac7348c82b8c02da011d30947684df24cc/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmerged_modules.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1a7041ac7348c82b8c02da011d30947684df24cc/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmerged_modules.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmerged_modules.rs?ref=1a7041ac7348c82b8c02da011d30947684df24cc",
            "patch": "@@ -492,9 +492,12 @@ pub async fn compute_merged_modules(module_graph: Vc<ModuleGraph>) -> Result<Vc<\n                     let after_index = lists.len();\n                     lists.push(after_list.clone());\n                     for (i, &m) in after_list.iter().enumerate() {\n-                        let occurrences = lists_reverse_indices\n-                            .get_mut(&m)\n-                            .context(format!(\"{:?}\", m.ident().to_string().await?))?;\n+                        let Some(occurrences) = lists_reverse_indices.get_mut(&m) else {\n+                            bail!(\n+                                \"Couldn't find module in list {:?}\",\n+                                m.ident().to_string().await?,\n+                            );\n+                        };\n \n                         let removed = occurrences.swap_remove(&ListOccurrence {\n                             list: common_occurrence.list,"
        },
        {
            "sha": "66592582c689e4f99c1aafce82ae3a1077196a15",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/module_batch.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/1a7041ac7348c82b8c02da011d30947684df24cc/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batch.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1a7041ac7348c82b8c02da011d30947684df24cc/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batch.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batch.rs?ref=1a7041ac7348c82b8c02da011d30947684df24cc",
            "patch": "@@ -31,6 +31,18 @@ pub enum ModuleOrBatch {\n     None(usize),\n }\n \n+impl ModuleOrBatch {\n+    pub async fn ident_strings(self) -> Result<IdentStrings> {\n+        Ok(match self {\n+            ModuleOrBatch::Module(module) => {\n+                IdentStrings::Single(module.ident().to_string().await?)\n+            }\n+            ModuleOrBatch::Batch(batch) => IdentStrings::Multiple(batch.ident_strings().await?),\n+            ModuleOrBatch::None(_) => IdentStrings::None,\n+        })\n+    }\n+}\n+\n #[derive(\n     Debug,\n     Copy,"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
    }
}