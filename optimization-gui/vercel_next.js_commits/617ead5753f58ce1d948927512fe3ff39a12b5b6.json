{
    "author": "wbinnssmith",
    "message": "Turbopack: Add bundle analyzer UI to next build --experimental-analyze (#85788)\n\nThis adds an interactive Treemap-style bundle analyzer app to the Next.js codebase and writes a copy to disk when `next build --experimental-analyze` is run.\n\n* It's a separate app in `apps/bundle-analyzer` as `@next/bundle-analyzer-ui` that uses `output: 'export'` to export a purely static Next.js app\n* These static resources are copied into Next.js's published `dist` directory in the `next` package itself. Users never depend on `@next/bundle-analyzer-ui`\n* When users run `next build --experimental-analyze`, these static resources are copied into the user's `.next/diagnostics/analyze` along with the data payloads needed to visualize the user's app\n\nIn an upcoming PR, we'll add `next experimental-analyze` that will create analysis files without build artifacts, as well as optionally start a static file server.\n\nTest Plan: Ran `next build --experimental-analyze` in a test app and ran a static file server to run it.",
    "sha": "617ead5753f58ce1d948927512fe3ff39a12b5b6",
    "files": [
        {
            "sha": "0a44d66a421cc048bff1532e4e4bf42cfd00f78b",
            "filename": "apps/bundle-analyzer/README.md",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2FREADME.md",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2FREADME.md",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2FREADME.md?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,14 @@\n+# Bundle Analyzer\n+\n+A Next.js application for visualizing bundle sizes and analyzing dependencies using interactive treemaps.\n+\n+This package is not published to npm. Instead it's built and vendored into the main `next` package during its build process.\n+\n+\n+## Features\n+\n+- üìä **Interactive Treemap**: Visualize bundle sizes with an interactive treemap interface\n+- üéØ **Route-based Analysis**: Analyze bundle data for specific routes in your application\n+- üîç **Dependency Tracking**: View import chains and dependency relationships\n+- üé® **Filter Controls**: Filter by environment (client/server) and file types (JS/CSS/JSON/Assets)\n+- üîé **Search Functionality**: Search through files in your bundle"
        },
        {
            "sha": "cc4f7fd3b600da3dc1592e30d7bbdd37708dd8cc",
            "filename": "apps/bundle-analyzer/app/globals.css",
            "status": "added",
            "additions": 110,
            "deletions": 0,
            "changes": 110,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fapp%2Fglobals.css",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fapp%2Fglobals.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fapp%2Fglobals.css?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,110 @@\n+@import 'tailwindcss';\n+@import 'tw-animate-css';\n+\n+@custom-variant dark (&:is(.dark *));\n+\n+:root {\n+  --background: oklch(1 0 0);\n+  --foreground: oklch(0.145 0 0);\n+  --card: oklch(1 0 0);\n+  --card-foreground: oklch(0.145 0 0);\n+  --popover: oklch(1 0 0);\n+  --popover-foreground: oklch(0.145 0 0);\n+  --primary: oklch(0.205 0 0);\n+  --primary-foreground: oklch(0.985 0 0);\n+  --secondary: oklch(0.97 0 0);\n+  --secondary-foreground: oklch(0.205 0 0);\n+  --muted: oklch(0.97 0 0);\n+  --muted-foreground: oklch(0.556 0 0);\n+  --accent: oklch(0.97 0 0);\n+  --accent-foreground: oklch(0.205 0 0);\n+  --destructive: oklch(0.577 0.245 27.325);\n+  --destructive-foreground: oklch(0.577 0.245 27.325);\n+  --border: oklch(0.922 0 0);\n+  --input: oklch(0.922 0 0);\n+  --ring: oklch(0.708 0 0);\n+  --radius: 0.625rem;\n+  --sidebar: oklch(0.985 0 0);\n+  --sidebar-foreground: oklch(0.145 0 0);\n+  --sidebar-primary: oklch(0.205 0 0);\n+  --sidebar-primary-foreground: oklch(0.985 0 0);\n+  --sidebar-accent: oklch(0.97 0 0);\n+  --sidebar-accent-foreground: oklch(0.205 0 0);\n+  --sidebar-border: oklch(0.922 0 0);\n+  --sidebar-ring: oklch(0.708 0 0);\n+}\n+\n+.dark {\n+  --background: oklch(0.145 0 0);\n+  --foreground: oklch(0.985 0 0);\n+  --card: oklch(0.145 0 0);\n+  --card-foreground: oklch(0.985 0 0);\n+  --popover: oklch(0.145 0 0);\n+  --popover-foreground: oklch(0.985 0 0);\n+  --primary: oklch(0.985 0 0);\n+  --primary-foreground: oklch(0.205 0 0);\n+  --secondary: oklch(0.269 0 0);\n+  --secondary-foreground: oklch(0.985 0 0);\n+  --muted: oklch(0.269 0 0);\n+  --muted-foreground: oklch(0.708 0 0);\n+  --accent: oklch(0.269 0 0);\n+  --accent-foreground: oklch(0.985 0 0);\n+  --destructive: oklch(0.396 0.141 25.723);\n+  --destructive-foreground: oklch(0.637 0.237 25.331);\n+  --border: oklch(0.269 0 0);\n+  --input: oklch(0.269 0 0);\n+  --ring: oklch(0.439 0 0);\n+  --sidebar: oklch(0.205 0 0);\n+  --sidebar-foreground: oklch(0.985 0 0);\n+  --sidebar-primary: oklch(0.488 0.243 264.376);\n+  --sidebar-primary-foreground: oklch(0.985 0 0);\n+  --sidebar-accent: oklch(0.269 0 0);\n+  --sidebar-accent-foreground: oklch(0.985 0 0);\n+  --sidebar-border: oklch(0.269 0 0);\n+  --sidebar-ring: oklch(0.439 0 0);\n+}\n+\n+@theme inline {\n+  --font-sans: 'Geist', 'Geist Fallback';\n+  --font-mono: 'Geist Mono', 'Geist Mono Fallback';\n+  --color-background: var(--background);\n+  --color-foreground: var(--foreground);\n+  --color-card: var(--card);\n+  --color-card-foreground: var(--card-foreground);\n+  --color-popover: var(--popover);\n+  --color-popover-foreground: var(--popover-foreground);\n+  --color-primary: var(--primary);\n+  --color-primary-foreground: var(--primary-foreground);\n+  --color-secondary: var(--secondary);\n+  --color-secondary-foreground: var(--secondary-foreground);\n+  --color-muted: var(--muted);\n+  --color-muted-foreground: var(--muted-foreground);\n+  --color-accent: var(--accent);\n+  --color-accent-foreground: var(--accent-foreground);\n+  --color-destructive: var(--destructive);\n+  --color-destructive-foreground: var(--destructive-foreground);\n+  --color-border: var(--border);\n+  --color-input: var(--input);\n+  --color-ring: var(--ring);\n+  --radius-sm: calc(var(--radius) - 4px);\n+  --radius-md: calc(var(--radius) - 2px);\n+  --radius-lg: var(--radius);\n+  --radius-xl: calc(var(--radius) + 4px);\n+  --color-sidebar: var(--sidebar);\n+  --color-sidebar-foreground: var(--sidebar-foreground);\n+  --color-sidebar-primary: var(--sidebar-primary);\n+  --color-sidebar-primary-foreground: var(--sidebar-primary-foreground);\n+  --color-sidebar-accent: var(--sidebar-accent);\n+  --color-sidebar-accent-foreground: var(--sidebar-accent-foreground);\n+  --color-sidebar-border: var(--sidebar-border);\n+  --color-sidebar-ring: var(--sidebar-ring);\n+}\n+\n+@layer base {\n+  * {\n+    @apply border-border outline-ring/50;\n+  }\n+  body {\n+    @apply bg-background text-foreground;\n+  }\n+}"
        },
        {
            "sha": "a545a717ae6e4b6efc1861f6ab8848fe1665753f",
            "filename": "apps/bundle-analyzer/app/layout.tsx",
            "status": "added",
            "additions": 49,
            "deletions": 0,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fapp%2Flayout.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,49 @@\n+import type { Metadata } from 'next'\n+import { Geist, Geist_Mono } from 'next/font/google'\n+import type React from 'react'\n+import './globals.css'\n+\n+// These get used as font-sans and font-mono\n+const _geist = Geist({ subsets: ['latin'] })\n+const _geistMono = Geist_Mono({ subsets: ['latin'] })\n+\n+export const metadata: Metadata = {\n+  title: 'Next.js Bundle Analyzer',\n+  description:\n+    'Visualize and analyze your Next.js bundle sizes with interactive treemap and dependency analysis',\n+}\n+\n+export default function RootLayout({\n+  children,\n+}: Readonly<{\n+  children: React.ReactNode\n+}>) {\n+  return (\n+    <html\n+      lang=\"en\"\n+      // Suppress hydration warnings here specifically because we'll modify the\n+      // classname for the theme before React hydates. This is to prevent a flash\n+      // of incorrect theme.\n+      suppressHydrationWarning\n+    >\n+      <head>\n+        <script\n+          // biome-ignore lint/security/noDangerouslySetInnerHtml: Needed to prevent flash of incorrect theme\n+          dangerouslySetInnerHTML={{\n+            __html: `\n+              (function() {\n+                const theme = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';\n+                document.documentElement.classList.toggle('dark', theme === 'dark');\n+\n+                window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {\n+                  document.documentElement.classList.toggle('dark', e.matches);\n+                });\n+              })();\n+            `,\n+          }}\n+        />\n+      </head>\n+      <body className=\"font-sans antialiased\">{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "cd4a5390d24182f48f62b351413e66d12a7bf799",
            "filename": "apps/bundle-analyzer/app/page.tsx",
            "status": "added",
            "additions": 391,
            "deletions": 0,
            "changes": 391,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fapp%2Fpage.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,391 @@\n+'use client'\n+\n+import type React from 'react'\n+import { useEffect, useMemo, useRef, useState } from 'react'\n+import useSWR from 'swr'\n+import { ImportChain } from '@/components/import-chain'\n+import {\n+  RouteTypeahead,\n+  type RouteTypeaheadRef,\n+} from '@/components/route-typeahead'\n+import { TreemapVisualizer } from '@/components/treemap-visualizer'\n+\n+import { Input } from '@/components/ui/input'\n+import { Skeleton, TreemapSkeleton } from '@/components/ui/skeleton'\n+import { ToggleGroup, ToggleGroupItem } from '@/components/ui/toggle-group'\n+import { AnalyzeData, ModulesData } from '@/lib/analyze-data'\n+\n+function formatBytes(bytes: number): string {\n+  if (bytes === 0) return '0 B'\n+  if (bytes < 1024) return `${bytes} B`\n+  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(2)} KB`\n+  if (bytes < 1024 * 1024 * 1024)\n+    return `${(bytes / (1024 * 1024)).toFixed(2)} MB`\n+  return `${(bytes / (1024 * 1024 * 1024)).toFixed(2)} GB`\n+}\n+\n+export default function Home() {\n+  const [selectedRoute, setSelectedRoute] = useState<string | null>(null)\n+  const [environmentFilter, setEnvironmentFilter] = useState<string>('client')\n+  const [typeFilter, setTypeFilter] = useState<string[]>(['js', 'css', 'json'])\n+  const [selectedSourceIndex, setSelectedSourceIndex] = useState<number | null>(\n+    null\n+  )\n+  const [focusedSourceIndex, setFocusedSourceIndex] = useState<number | null>(\n+    null\n+  )\n+\n+  const {\n+    data: modulesData,\n+    isLoading: isModulesLoading,\n+    error: modulesError,\n+  } = useSWR<ModulesData>('data/modules.data', fetchModulesData)\n+\n+  let analyzeDataPath\n+  if (selectedRoute && selectedRoute === '/') {\n+    analyzeDataPath = 'data/analyze.data'\n+  } else if (selectedRoute) {\n+    analyzeDataPath = `data/${selectedRoute.replace(/^\\//, '')}/analyze.data`\n+  } else {\n+    analyzeDataPath = null\n+  }\n+\n+  const {\n+    data: analyzeData,\n+    isLoading: isAnalyzeLoading,\n+    error: analyzeError,\n+  } = useSWR<AnalyzeData>(analyzeDataPath, fetchAnalyzeData, {\n+    onSuccess: (newData) => {\n+      const newRootSourceIndex = getRootSourceIndex(newData)\n+      setSelectedSourceIndex(newRootSourceIndex)\n+      setFocusedSourceIndex(newRootSourceIndex)\n+    },\n+  })\n+\n+  const [sidebarWidth, setSidebarWidth] = useState(20) // percentage\n+  const [isResizing, setIsResizing] = useState(false)\n+  const [isMouseInTreemap, setIsMouseInTreemap] = useState(false)\n+  const [hoveredNodeInfo, setHoveredNodeInfo] = useState<{\n+    name: string\n+    server?: boolean\n+    client?: boolean\n+  } | null>(null)\n+  const [searchQuery, setSearchQuery] = useState('')\n+  const [searchFocused, setSearchFocused] = useState(false)\n+\n+  const routeTypeaheadRef = useRef<RouteTypeaheadRef>(null)\n+  const searchInputRef = useRef<HTMLInputElement>(null)\n+\n+  useEffect(() => {\n+    const handleKeyDown = (e: KeyboardEvent) => {\n+      // Cmd+K or Ctrl+K to focus route filter\n+      if ((e.metaKey || e.ctrlKey) && e.key === 'k') {\n+        e.preventDefault()\n+        routeTypeaheadRef.current?.focus()\n+      }\n+      // / to focus search (only if not already in an input)\n+      else if (\n+        e.key === '/' &&\n+        !['INPUT', 'TEXTAREA'].includes((e.target as HTMLElement).tagName)\n+      ) {\n+        e.preventDefault()\n+        searchInputRef.current?.focus()\n+      }\n+    }\n+\n+    window.addEventListener('keydown', handleKeyDown)\n+    return () => window.removeEventListener('keydown', handleKeyDown)\n+  }, [])\n+\n+  const filterSource = useMemo(() => {\n+    if (!analyzeData) return undefined\n+\n+    return (sourceIndex: number) => {\n+      const flags = analyzeData.getSourceFlags(sourceIndex)\n+\n+      // Check environment filter\n+      const hasEnvironment =\n+        (environmentFilter === 'client' && flags.client) ||\n+        (environmentFilter === 'server' && flags.server)\n+\n+      // Check type filter\n+      const hasType =\n+        (typeFilter.includes('js') && flags.js) ||\n+        (typeFilter.includes('css') && flags.css) ||\n+        (typeFilter.includes('json') && flags.json) ||\n+        (typeFilter.includes('asset') && flags.asset)\n+\n+      return hasEnvironment && hasType\n+    }\n+  }, [analyzeData, environmentFilter, typeFilter])\n+\n+  const handleMouseDown = () => {\n+    setIsResizing(true)\n+  }\n+\n+  const handleMouseMove = (e: React.MouseEvent) => {\n+    if (!isResizing) return\n+    const newWidth = ((window.innerWidth - e.clientX) / window.innerWidth) * 100\n+    setSidebarWidth(Math.max(10, Math.min(50, newWidth))) // Clamp between 10% and 50%\n+  }\n+\n+  const handleMouseUp = () => {\n+    setIsResizing(false)\n+  }\n+\n+  const error = analyzeError || modulesError\n+  const isAnyLoading = isAnalyzeLoading || isModulesLoading\n+  const rootSourceIndex = getRootSourceIndex(analyzeData)\n+\n+  return (\n+    <main\n+      className=\"h-screen flex flex-col bg-background\"\n+      onMouseMove={handleMouseMove}\n+      onMouseUp={handleMouseUp}\n+    >\n+      <div className=\"flex-none px-4 py-2 border-b border-border flex items-center gap-4\">\n+        <div className=\"basis-1/3 flex\">\n+          <RouteTypeahead\n+            ref={routeTypeaheadRef}\n+            selectedRoute={selectedRoute}\n+            onRouteSelected={(route) => {\n+              setSelectedRoute(route)\n+              setSelectedSourceIndex(null)\n+              setFocusedSourceIndex(null)\n+            }}\n+          />\n+        </div>\n+\n+        <div className=\"basis-2/3 flex justify-end\">\n+          {error && (\n+            <div className=\"text-sm text-red-600 font-medium\">\n+              Error: {error?.message}\n+            </div>\n+          )}\n+\n+          {analyzeData && (\n+            <>\n+              <ToggleGroup\n+                type=\"single\"\n+                className=\"mr-4\"\n+                value={environmentFilter}\n+                onValueChange={(value) => {\n+                  if (value) setEnvironmentFilter(value)\n+                }}\n+                size=\"sm\"\n+              >\n+                <ToggleGroupItem value=\"client\">Client</ToggleGroupItem>\n+                <ToggleGroupItem value=\"server\">Server</ToggleGroupItem>\n+              </ToggleGroup>\n+\n+              <ToggleGroup\n+                type=\"multiple\"\n+                className=\"mr-4\"\n+                value={typeFilter}\n+                onValueChange={(value) => {\n+                  if (value.length > 0) setTypeFilter(value)\n+                }}\n+                size=\"sm\"\n+              >\n+                <ToggleGroupItem value=\"js\">JS</ToggleGroupItem>\n+                <ToggleGroupItem value=\"css\">CSS</ToggleGroupItem>\n+                <ToggleGroupItem value=\"json\">JSON</ToggleGroupItem>\n+                <ToggleGroupItem value=\"asset\">Asset</ToggleGroupItem>\n+              </ToggleGroup>\n+\n+              {!searchFocused && (\n+                <div className=\"flex items-center gap-4 text-xs\">\n+                  <p className=\"text-muted-foreground\">\n+                    {\n+                      analyzeData.source(focusedSourceIndex ?? rootSourceIndex)\n+                        ?.path\n+                    }\n+                  </p>\n+                </div>\n+              )}\n+\n+              <Input\n+                ref={searchInputRef}\n+                type=\"search\"\n+                value={searchQuery}\n+                onChange={(e) => setSearchQuery(e.target.value)}\n+                onFocus={() => setSearchFocused(true)}\n+                onBlur={() => setSearchFocused(false)}\n+                placeholder=\"Search files...\"\n+                className=\"w-48 focus:w-80 transition-all duration-200\"\n+              />\n+            </>\n+          )}\n+        </div>\n+      </div>\n+\n+      <div className=\"flex-1 flex min-h-0\">\n+        {isAnyLoading ? (\n+          <>\n+            <div className=\"flex-1 min-w-0 p-4 bg-background\">\n+              <TreemapSkeleton />\n+            </div>\n+\n+            <button\n+              type=\"button\"\n+              className=\"flex-none w-1 bg-border cursor-col-resize transition-colors\"\n+              disabled\n+              aria-label=\"Resize sidebar\"\n+            />\n+\n+            <div\n+              className=\"flex-none bg-muted border-l border-border overflow-y-auto\"\n+              style={{ width: `${sidebarWidth}%` }}\n+            >\n+              <div className=\"flex-1 p-3 space-y-4 overflow-y-auto\">\n+                <h2 className=\"text-xs font-semibold mb-2 text-foreground\">\n+                  Selected Source\n+                </h2>\n+                <Skeleton className=\"h-4 w-3/4\" />\n+                <Skeleton className=\"h-4 w-full\" />\n+                <Skeleton className=\"h-4 w-5/6\" />\n+                <div className=\"mt-4 space-y-2\">\n+                  <Skeleton className=\"h-3 w-full\" />\n+                  <Skeleton className=\"h-3 w-full\" />\n+                  <Skeleton className=\"h-3 w-4/5\" />\n+                </div>\n+              </div>\n+            </div>\n+          </>\n+        ) : analyzeData ? (\n+          <>\n+            <div className=\"flex-1 min-w-0\">\n+              <TreemapVisualizer\n+                analyzeData={analyzeData}\n+                sourceIndex={rootSourceIndex}\n+                selectedSourceIndex={selectedSourceIndex ?? rootSourceIndex}\n+                onSelectSourceIndex={setSelectedSourceIndex}\n+                focusedSourceIndex={focusedSourceIndex ?? rootSourceIndex}\n+                onFocusSourceIndex={setFocusedSourceIndex}\n+                isMouseInTreemap={isMouseInTreemap}\n+                onMouseInTreemapChange={setIsMouseInTreemap}\n+                onHoveredNodeChange={setHoveredNodeInfo}\n+                searchQuery={searchQuery}\n+                filterSource={filterSource}\n+              />\n+            </div>\n+\n+            <button\n+              type=\"button\"\n+              className=\"flex-none w-1 bg-border hover:bg-primary cursor-col-resize transition-colors\"\n+              onMouseDown={handleMouseDown}\n+              aria-label=\"Resize sidebar\"\n+            />\n+\n+            <div\n+              className=\"flex-none bg-muted border-l border-border overflow-y-auto\"\n+              style={{ width: `${sidebarWidth}%` }}\n+            >\n+              <div className=\"flex-1 p-3 space-y-4 overflow-y-auto\">\n+                <h2 className=\"text-xs font-semibold mb-2 text-foreground\">\n+                  Selected Source\n+                </h2>\n+\n+                {selectedSourceIndex != null &&\n+                  analyzeData.source(selectedSourceIndex) && (\n+                    <>\n+                      <p className=\"text-xs text-muted-foreground mt-2\">\n+                        Output Size:{' '}\n+                        {formatBytes(\n+                          analyzeData.getSourceOutputSize(selectedSourceIndex)\n+                        )}\n+                      </p>\n+                      {modulesData && (\n+                        <ImportChain\n+                          key={selectedSourceIndex}\n+                          startFileId={selectedSourceIndex}\n+                          analyzeData={analyzeData}\n+                          modulesData={modulesData}\n+                          filterSource={filterSource}\n+                        />\n+                      )}\n+                      {(() => {\n+                        const chunks =\n+                          analyzeData.sourceChunks(selectedSourceIndex)\n+                        if (chunks.length > 0) {\n+                          return (\n+                            <div className=\"mt-2\">\n+                              <p className=\"text-xs font-semibold text-foreground\">\n+                                Output Chunks:\n+                              </p>\n+                              <ul className=\"text-xs text-muted-foreground font-mono mt-1 space-y-1\">\n+                                {chunks.map((chunk) => (\n+                                  <li key={chunk} className=\"break-all\">\n+                                    {chunk}\n+                                  </li>\n+                                ))}\n+                              </ul>\n+                            </div>\n+                          )\n+                        }\n+                        return null\n+                      })()}\n+                    </>\n+                  )}\n+              </div>\n+            </div>\n+          </>\n+        ) : null}\n+      </div>\n+\n+      {analyzeData && (\n+        <div className=\"flex-none border-t border-border bg-background px-4 py-2 h-10\">\n+          <p className=\"text-sm text-muted-foreground\">\n+            {hoveredNodeInfo ? (\n+              <>\n+                <span className=\"font-medium text-foreground\">\n+                  {hoveredNodeInfo.name}\n+                </span>\n+                {(hoveredNodeInfo.server || hoveredNodeInfo.client) && (\n+                  <span className=\"ml-2 text-xs\">\n+                    {hoveredNodeInfo.client && (\n+                      <span className=\"text-primary\">[client]</span>\n+                    )}\n+                    {hoveredNodeInfo.server && hoveredNodeInfo.client && (\n+                      <span> </span>\n+                    )}\n+                    {hoveredNodeInfo.server && (\n+                      <span className=\"text-primary\">[server]</span>\n+                    )}\n+                  </span>\n+                )}\n+              </>\n+            ) : (\n+              'Hover over a file to see details'\n+            )}\n+          </p>\n+        </div>\n+      )}\n+    </main>\n+  )\n+}\n+\n+function getRootSourceIndex(analyzeData: AnalyzeData | undefined): number {\n+  if (!analyzeData) return 0\n+  const sourceRoots = analyzeData.sourceRoots()\n+  return sourceRoots.length > 0 ? sourceRoots[0] : 0\n+}\n+\n+async function fetchAnalyzeData(url: string): Promise<AnalyzeData> {\n+  const resp = await fetchStrict(url)\n+  return new AnalyzeData(await resp.arrayBuffer())\n+}\n+\n+async function fetchModulesData(url: string): Promise<ModulesData> {\n+  const resp = await fetchStrict(url)\n+  return new ModulesData(await resp.arrayBuffer())\n+}\n+\n+function fetchStrict(url: string): Promise<Response> {\n+  return fetch(url).then((res) => {\n+    if (!res.ok) {\n+      throw new Error(`Failed to fetch ${url}: ${res.status} ${res.statusText}`)\n+    }\n+    return res\n+  })\n+}"
        },
        {
            "sha": "4ee62ee10547066d7ee70f94d79c786226c3c12c",
            "filename": "apps/bundle-analyzer/components.json",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents.json",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents.json?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,21 @@\n+{\n+  \"$schema\": \"https://ui.shadcn.com/schema.json\",\n+  \"style\": \"new-york\",\n+  \"rsc\": true,\n+  \"tsx\": true,\n+  \"tailwind\": {\n+    \"config\": \"\",\n+    \"css\": \"app/globals.css\",\n+    \"baseColor\": \"neutral\",\n+    \"cssVariables\": true,\n+    \"prefix\": \"\"\n+  },\n+  \"aliases\": {\n+    \"components\": \"@/components\",\n+    \"utils\": \"@/lib/utils\",\n+    \"ui\": \"@/components/ui\",\n+    \"lib\": \"@/lib\",\n+    \"hooks\": \"@/hooks\"\n+  },\n+  \"iconLibrary\": \"lucide\"\n+}"
        },
        {
            "sha": "74129fe5958871d1e14d820b3f62708a30fd7f2a",
            "filename": "apps/bundle-analyzer/components/import-chain.tsx",
            "status": "added",
            "additions": 375,
            "deletions": 0,
            "changes": 375,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fimport-chain.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fimport-chain.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fimport-chain.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,375 @@\n+'use client'\n+\n+import {\n+  ArrowUp,\n+  ChevronLeft,\n+  ChevronRight,\n+  Monitor,\n+  Route,\n+  Server,\n+} from 'lucide-react'\n+import { useMemo, useState } from 'react'\n+import type { AnalyzeData, ModulesData } from '@/lib/analyze-data'\n+\n+interface ImportChainProps {\n+  startFileId: number\n+  analyzeData: AnalyzeData\n+  modulesData: ModulesData\n+  filterSource?: (sourceIndex: number) => boolean\n+}\n+\n+interface ChainLevel {\n+  fileId: number\n+  filePath: string\n+  fileDepth: number\n+  selectedIndex: number\n+  totalCount: number\n+  // Info about this level's relationship to parent (undefined for root)\n+  info?: DependentInfo\n+  // All available dependents at this level\n+  allDependents?: DependentInfo[]\n+}\n+\n+interface DependentInfo {\n+  moduleIndex: number\n+  sourceIndex: number | undefined\n+  isAsync: boolean\n+  depth: number\n+  flags:\n+    | {\n+        client: boolean\n+        server: boolean\n+        traced: boolean\n+        js: boolean\n+        css: boolean\n+        json: boolean\n+        asset: boolean\n+      }\n+    | undefined\n+}\n+\n+function getPathDifference(currentPath: string, previousPath: string | null) {\n+  if (!previousPath) {\n+    return { common: '', different: currentPath }\n+  }\n+\n+  const currentSegments = currentPath.split('/')\n+  const previousSegments = previousPath.split('/')\n+\n+  let commonCount = 0\n+  const minLength = Math.min(currentSegments.length, previousSegments.length)\n+\n+  for (let i = 0; i < minLength; i++) {\n+    if (currentSegments[i] === previousSegments[i]) {\n+      commonCount++\n+    } else {\n+      break\n+    }\n+  }\n+\n+  const commonSegments = currentSegments.slice(0, commonCount)\n+  const differentSegments = currentSegments.slice(commonCount)\n+\n+  return {\n+    common: commonSegments.length > 0 ? `${commonSegments.join('/')}/` : '',\n+    different: differentSegments.join('/'),\n+  }\n+}\n+\n+const insertLineBreaks = (path: string) => {\n+  const segments = path.split('/')\n+  return segments.map((segment, i) => (\n+    <span\n+      key={`${segment}-${i}`}\n+      className={segment.length > 20 ? 'break-all' : ''}\n+    >\n+      {segment}\n+      {i < segments.length - 1 && '/'}\n+      <wbr />\n+    </span>\n+  ))\n+}\n+\n+export function ImportChain({\n+  startFileId,\n+  analyzeData,\n+  modulesData,\n+}: ImportChainProps) {\n+  // Track which dependent is selected at each level\n+  const [selectedIndices, setSelectedIndices] = useState<number[]>([])\n+\n+  // Helper function to get module index from source path\n+  const getModuleIndexFromSourceIndex = (sourceIndex: number) => {\n+    const path = analyzeData.getFullSourcePath(sourceIndex)\n+    return modulesData.getModuleIndexFromPath(path)\n+  }\n+\n+  // Helper function to get source index from module path\n+  const getSourceIndexFromModuleIndex = (moduleIndex: number) => {\n+    const module = modulesData.module(moduleIndex)\n+    if (!module) return undefined\n+\n+    // Search through all sources to find one with matching path\n+    const modulePath = module.path\n+    for (let i = 0; i < analyzeData.sourceCount(); i++) {\n+      if (analyzeData.getFullSourcePath(i) === modulePath) {\n+        return i\n+      }\n+    }\n+    return undefined\n+  }\n+\n+  // Build the import chain based on current selections\n+  const chain = useMemo(() => {\n+    const result: ChainLevel[] = []\n+    const visitedModules = new Set<number>()\n+\n+    const startPath = analyzeData.getFullSourcePath(startFileId)\n+    if (!startPath) return result\n+\n+    // Get the module index for the starting source\n+    const startModuleIndex = getModuleIndexFromSourceIndex(startFileId)\n+    if (startModuleIndex === undefined) return result\n+\n+    result.push({\n+      fileId: startFileId,\n+      filePath: startPath,\n+      fileDepth: modulesData.module(startModuleIndex)?.depth ?? Infinity,\n+      selectedIndex: 0,\n+      totalCount: 1,\n+    })\n+\n+    visitedModules.add(startModuleIndex)\n+\n+    // Build chain by following selected dependents\n+    let levelIndex = 0\n+    let currentModuleIndex = startModuleIndex\n+\n+    while (true) {\n+      // Get dependents at the module level (sync and async)\n+      const dependentModuleIndices = [\n+        ...modulesData\n+          .moduleDependents(currentModuleIndex)\n+          .map((index: number) => ({ index, async: false })),\n+        ...modulesData\n+          .asyncModuleDependents(currentModuleIndex)\n+          .map((index: number) => ({ index, async: true })),\n+      ]\n+\n+      // Filter out dependents that would create a cycle\n+      const validDependents = dependentModuleIndices.filter(\n+        ({ index }) => !visitedModules.has(index)\n+      )\n+\n+      if (validDependents.length === 0) {\n+        // No more dependents or all would create cycles\n+        break\n+      }\n+\n+      // Build info for each dependent\n+      const dependentsInfo: DependentInfo[] = validDependents.map(\n+        ({ index: moduleIndex, async: isAsync }) => {\n+          const module = modulesData.module(moduleIndex)\n+          const sourceIndex = getSourceIndexFromModuleIndex(moduleIndex)\n+          const flags =\n+            sourceIndex !== undefined\n+              ? analyzeData.getSourceFlags(sourceIndex)\n+              : undefined\n+          return {\n+            moduleIndex,\n+            sourceIndex,\n+            isAsync,\n+            depth: module?.depth ?? Infinity,\n+            flags,\n+          }\n+        }\n+      )\n+\n+      // Sort: sync first, async second, then by source presence, then by depth\n+      dependentsInfo.sort((a, b) => {\n+        // First sort by async state (sync before async)\n+        if (a.isAsync !== b.isAsync) {\n+          return a.isAsync ? 1 : -1\n+        }\n+\n+        // Then sort by source presence (with source before without)\n+        const aHasSource = a.sourceIndex !== undefined\n+        const bHasSource = b.sourceIndex !== undefined\n+        if (aHasSource !== bHasSource) {\n+          return aHasSource ? -1 : 1\n+        }\n+\n+        // Finally sort by depth (smallest first)\n+        return a.depth - b.depth\n+      })\n+\n+      // Get the selected index for this level (default to 0)\n+      const selectedIdx = selectedIndices[levelIndex] ?? 0\n+      const actualIdx = Math.min(selectedIdx, dependentsInfo.length - 1)\n+\n+      const selectedDepInfo = dependentsInfo[actualIdx]\n+      const selectedDepModule = modulesData.module(selectedDepInfo.moduleIndex)\n+\n+      if (!selectedDepModule) break\n+\n+      result.push({\n+        fileId: selectedDepInfo.moduleIndex,\n+        filePath: selectedDepModule.path,\n+        fileDepth: selectedDepModule.depth,\n+        selectedIndex: actualIdx,\n+        totalCount: dependentsInfo.length,\n+        info: selectedDepInfo,\n+        allDependents: dependentsInfo,\n+      })\n+\n+      visitedModules.add(selectedDepInfo.moduleIndex)\n+      currentModuleIndex = selectedDepInfo.moduleIndex\n+      levelIndex++\n+\n+      // Safety check to prevent infinite loops\n+      if (levelIndex > 100) break\n+    }\n+\n+    return result\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, [startFileId, analyzeData, modulesData, selectedIndices])\n+\n+  const handlePrevious = (levelIndex: number) => {\n+    setSelectedIndices((prev) => {\n+      const newIndices = [...prev]\n+      const currentIdx = newIndices[levelIndex] ?? 0\n+      const level = chain[levelIndex + 1] // Fixed: use levelIndex + 1 to get the correct level\n+      newIndices[levelIndex] =\n+        currentIdx > 0 ? currentIdx - 1 : level.totalCount - 1\n+      return newIndices.slice(0, levelIndex + 1)\n+    })\n+  }\n+\n+  const handleNext = (levelIndex: number) => {\n+    setSelectedIndices((prev) => {\n+      const newIndices = [...prev]\n+      const currentIdx = newIndices[levelIndex] ?? 0\n+      const level = chain[levelIndex + 1] // Fixed: use levelIndex + 1 to get the correct level\n+      newIndices[levelIndex] =\n+        currentIdx < level.totalCount - 1 ? currentIdx + 1 : 0\n+      return newIndices.slice(0, levelIndex + 1)\n+    })\n+  }\n+\n+  const startPath = analyzeData.getFullSourcePath(startFileId)\n+  if (!startPath) return null\n+\n+  return (\n+    <div className=\"space-y-2\">\n+      <h3 className=\"text-xs font-semibold text-foreground\">Import chain</h3>\n+      <div className=\"space-y-0\">\n+        {chain.map((level, index) => {\n+          const previousPath = index > 0 ? chain[index - 1].filePath : null\n+          const { common, different } = getPathDifference(\n+            level.filePath,\n+            previousPath\n+          )\n+\n+          // Get the current item's info from the level itself\n+          const currentItemInfo = level.info\n+\n+          return (\n+            <div key={`${level.filePath}-${index}`}>\n+              <div className=\"flex items-center gap-2\">\n+                <div className=\"flex-1 border border-border rounded px-2 py-1 bg-background\">\n+                  <span\n+                    className=\"font-mono text-xs text-foreground text-center block break-words\"\n+                    title={level.filePath}\n+                  >\n+                    {index === 0 ? (\n+                      <span className=\"font-normal\">\n+                        {insertLineBreaks(level.filePath)}\n+                      </span>\n+                    ) : (\n+                      <>\n+                        {common && (\n+                          <span className=\"font-normal text-muted-foreground/60\">\n+                            {insertLineBreaks(common)}\n+                          </span>\n+                        )}\n+                        <span className=\"font-bold\">\n+                          {insertLineBreaks(different)}\n+                        </span>\n+                      </>\n+                    )}\n+                  </span>\n+                </div>\n+\n+                {/* Show icons for current item if we have flag info or no source */}\n+                {currentItemInfo && (\n+                  <div className=\"flex flex-col gap-1 items-center\">\n+                    {currentItemInfo.sourceIndex === undefined && (\n+                      <div title=\"Used only on different route\">\n+                        <Route className=\"w-3 h-3 text-amber-500\" />\n+                      </div>\n+                    )}\n+                    {currentItemInfo.flags?.client ? (\n+                      <div title=\"Client Component\">\n+                        <Monitor className=\"w-3 h-3 text-green-500\" />\n+                      </div>\n+                    ) : currentItemInfo.flags?.server ? (\n+                      <div title=\"Server Component\">\n+                        <Server className=\"w-3 h-3 text-blue-500\" />\n+                      </div>\n+                    ) : null}\n+                  </div>\n+                )}\n+              </div>\n+\n+              {index < chain.length - 1 &&\n+                (() => {\n+                  // Get the info for the next item (the one the arrow points to)\n+                  const nextItemInfo = chain[index + 1].info\n+\n+                  return (\n+                    <div className=\"flex items-center justify-center gap-2 py-1\">\n+                      <ArrowUp\n+                        className=\"w-4 h-4 text-muted-foreground\"\n+                        strokeDasharray={\n+                          nextItemInfo?.isAsync ? '4,4' : undefined\n+                        }\n+                      />\n+                      {chain[index + 1].totalCount > 1 && (\n+                        <div className=\"flex items-center gap-1 flex-none\">\n+                          <button\n+                            type=\"button\"\n+                            onClick={() => handlePrevious(index)}\n+                            className=\"p-0.5 hover:bg-accent rounded transition-colors cursor-pointer\"\n+                            title=\"Previous dependent\"\n+                          >\n+                            <ChevronLeft className=\"w-3 h-3\" />\n+                          </button>\n+                          <span className=\"text-muted-foreground text-xs min-w-[3ch] text-center\">\n+                            {chain[index + 1].selectedIndex + 1}/\n+                            {chain[index + 1].totalCount}\n+                          </span>\n+                          <button\n+                            type=\"button\"\n+                            onClick={() => handleNext(index)}\n+                            className=\"p-0.5 hover:bg-accent rounded transition-colors cursor-pointer\"\n+                            title=\"Next dependent\"\n+                          >\n+                            <ChevronRight className=\"w-3 h-3\" />\n+                          </button>\n+                        </div>\n+                      )}\n+                    </div>\n+                  )\n+                })()}\n+            </div>\n+          )\n+        })}\n+        {chain.length === 0 && (\n+          <p className=\"text-muted-foreground italic text-xs\">\n+            No dependents found\n+          </p>\n+        )}\n+      </div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "6e6be9a4f0c3cc5c97abce7488836682f3f286d9",
            "filename": "apps/bundle-analyzer/components/index.ts",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Findex.ts?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,3 @@\n+export { ImportChain } from './import-chain'\n+export { RouteTypeahead } from './route-typeahead'\n+export { TreemapVisualizer } from './treemap-visualizer'"
        },
        {
            "sha": "b832a0e7480e732029831018ab37bcb508e60ba9",
            "filename": "apps/bundle-analyzer/components/route-typeahead.tsx",
            "status": "added",
            "additions": 130,
            "deletions": 0,
            "changes": 130,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Froute-typeahead.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Froute-typeahead.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Froute-typeahead.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,130 @@\n+'use client'\n+\n+import useSWR from 'swr'\n+import { Check, ChevronsUpDown, Loader, Route } from 'lucide-react'\n+import { forwardRef, useImperativeHandle, useState } from 'react'\n+import { Button } from '@/components/ui/button'\n+import {\n+  Command,\n+  CommandEmpty,\n+  CommandGroup,\n+  CommandInput,\n+  CommandItem,\n+  CommandList,\n+} from '@/components/ui/command'\n+import {\n+  Popover,\n+  PopoverContent,\n+  PopoverTrigger,\n+} from '@/components/ui/popover'\n+import { cn, jsonFetcher } from '@/lib/utils'\n+\n+interface RouteTypeaheadProps {\n+  selectedRoute: string | null\n+  onRouteSelected: (routeName: string) => void\n+}\n+\n+export interface RouteTypeaheadRef {\n+  focus: () => void\n+}\n+\n+export const RouteTypeahead = forwardRef<\n+  RouteTypeaheadRef,\n+  RouteTypeaheadProps\n+>(function RouteTypeahead({ selectedRoute, onRouteSelected }, ref) {\n+  const [open, setOpen] = useState(false)\n+\n+  useImperativeHandle(ref, () => ({\n+    focus: () => {\n+      setOpen(true)\n+    },\n+  }))\n+\n+  const {\n+    data: routes,\n+    isLoading,\n+    error,\n+  } = useSWR<string[]>('data/routes.json', jsonFetcher, {\n+    onSuccess: (routeNames) => {\n+      // Auto-select first route if none is selected\n+      if (routeNames.length > 0 && selectedRoute == null) {\n+        onRouteSelected(routeNames[0])\n+      }\n+    },\n+  })\n+\n+  if (error) {\n+    return (\n+      <div className=\"flex max-w-full text-red-600\">\n+        Failed to load routes manifest: {error.message}\n+      </div>\n+    )\n+  }\n+\n+  let ctaText\n+  if (isLoading) {\n+    ctaText = 'Loading routes...'\n+  } else if (selectedRoute != null) {\n+    ctaText = selectedRoute\n+  } else {\n+    ctaText = 'Select route...'\n+  }\n+\n+  return (\n+    <div className=\"flex items-center gap-2 min-w-64 max-w-full\">\n+      <Popover open={open} onOpenChange={setOpen}>\n+        <PopoverTrigger asChild>\n+          <Button\n+            variant=\"outline\"\n+            role=\"combobox\"\n+            aria-expanded={open}\n+            disabled={isLoading}\n+            className=\"flex-grow-1 w-full justify-between font-mono text-sm\"\n+          >\n+            <div className=\"flex items-center\">\n+              {isLoading ? (\n+                <Loader className=\"mr-2 inline animate-spin\" />\n+              ) : (\n+                <Route className=\"inline mr-2\" />\n+              )}\n+\n+              {ctaText}\n+            </div>\n+            <ChevronsUpDown className=\"ml-2 h-4 w-4 shrink-0 opacity-50\" />\n+          </Button>\n+        </PopoverTrigger>\n+        <PopoverContent className=\"w-96 p-0\">\n+          <Command>\n+            <CommandInput placeholder=\"Search routes...\" className=\"h-9\" />\n+            <CommandList>\n+              <CommandEmpty>No route found.</CommandEmpty>\n+              <CommandGroup>\n+                {(routes || []).map((route) => {\n+                  return (\n+                    <CommandItem\n+                      key={route}\n+                      value={route}\n+                      onSelect={() => {\n+                        onRouteSelected(route)\n+                        setOpen(false)\n+                      }}\n+                      className=\"font-mono\"\n+                    >\n+                      <Check\n+                        className={cn(\n+                          'mr-2 h-4 w-4',\n+                          selectedRoute === route ? 'opacity-100' : 'opacity-0'\n+                        )}\n+                      />\n+                      {route}\n+                    </CommandItem>\n+                  )\n+                })}\n+              </CommandGroup>\n+            </CommandList>\n+          </Command>\n+        </PopoverContent>\n+      </Popover>\n+    </div>\n+  )\n+})"
        },
        {
            "sha": "72bdb47e43eb39d81cdfe952c8a21994a752db83",
            "filename": "apps/bundle-analyzer/components/theme-provider.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Ftheme-provider.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Ftheme-provider.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Ftheme-provider.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,10 @@\n+'use client'\n+\n+import {\n+  ThemeProvider as NextThemesProvider,\n+  type ThemeProviderProps,\n+} from 'next-themes'\n+\n+export function ThemeProvider({ children, ...props }: ThemeProviderProps) {\n+  return <NextThemesProvider {...props}>{children}</NextThemesProvider>\n+}"
        },
        {
            "sha": "7660b1f819434fb65db737156968465c0dc27ede",
            "filename": "apps/bundle-analyzer/components/treemap-visualizer.tsx",
            "status": "added",
            "additions": 885,
            "deletions": 0,
            "changes": 885,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Ftreemap-visualizer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Ftreemap-visualizer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Ftreemap-visualizer.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,885 @@\n+'use client'\n+\n+import { darken, lighten } from 'polished'\n+import type React from 'react'\n+import { useEffect, useMemo, useRef, useState } from 'react'\n+import type { AnalyzeData } from '@/lib/analyze-data'\n+import {\n+  computeTreemapLayoutFromAnalyze,\n+  type LayoutNode,\n+  type LayoutNodeInfo,\n+} from '@/lib/treemap-layout'\n+\n+interface TreemapVisualizerProps {\n+  analyzeData: AnalyzeData\n+  sourceIndex: number\n+  selectedSourceIndex?: number\n+  onSelectSourceIndex?: (index: number) => void\n+  focusedSourceIndex?: number\n+  onFocusSourceIndex?: (index: number) => void\n+  isMouseInTreemap?: boolean\n+  onMouseInTreemapChange?: (isInside: boolean) => void\n+  onHoveredNodeChange?: (nodeInfo: LayoutNodeInfo | null) => void\n+  onHoveredNodeChangeDelayed?: (nodeInfo: LayoutNodeInfo | null) => void\n+  searchQuery?: string\n+  filterSource?: (sourceIndex: number) => boolean\n+}\n+\n+function getFileColor(node: {\n+  js?: boolean\n+  css?: boolean\n+  json?: boolean\n+  asset?: boolean\n+  server?: boolean\n+  client?: boolean\n+  traced?: boolean\n+}): string {\n+  const { js, css, json, asset, client, traced } = node\n+\n+  let color = '#9ca3af' // gray-400 default\n+  if (js) color = '#0068d6'\n+  if (css) color = '#663399'\n+  if (json) color = '#297a3a'\n+  if (asset) color = '#da2f35'\n+\n+  if (!client) {\n+    // Make it darker for server (30% darker)\n+    color = darken(0.3, color)\n+\n+    if (traced) {\n+      // Make it slightly lighter (15% lighter than darkened)\n+      color = lighten(0.15, color)\n+    }\n+  }\n+  return color\n+}\n+\n+function findNodeAtPosition(\n+  node: LayoutNode,\n+  x: number,\n+  y: number\n+): LayoutNode | null {\n+  const { rect } = node\n+\n+  // Check if point is within this node's bounds\n+  if (\n+    x < rect.x ||\n+    x > rect.x + rect.width ||\n+    y < rect.y ||\n+    y > rect.y + rect.height\n+  ) {\n+    return null\n+  }\n+\n+  if (node.type === 'collapsed-directory') {\n+    return node\n+  }\n+\n+  // For regular directories, check if we're in the title bar first\n+  if (node.type === 'directory') {\n+    const titleBarHeight = node.titleBarHeight || 0\n+    if (y >= rect.y && y <= rect.y + titleBarHeight) {\n+      return node // Clicked on title bar\n+    }\n+  }\n+\n+  // Check children (if any)\n+  if (node.children) {\n+    for (const child of node.children) {\n+      const found = findNodeAtPosition(child, x, y)\n+      if (found) return found\n+    }\n+  }\n+\n+  return node\n+}\n+\n+// Helper function to check if node or descendants match search\n+function searchOriginalTreeForMatch(\n+  node: LayoutNode,\n+  currentPath: string[],\n+  searchQuery: string\n+): boolean {\n+  const path = [...currentPath, node.name]\n+  const fullPath = path.join('/').toLowerCase()\n+  const query = searchQuery.toLowerCase()\n+\n+  // Check if current node matches\n+  if (fullPath.includes(query)) {\n+    return true\n+  }\n+\n+  // Recursively check children\n+  if (node.children) {\n+    for (const child of node.children) {\n+      if (searchOriginalTreeForMatch(child, path, searchQuery)) {\n+        return true\n+      }\n+    }\n+  }\n+\n+  return false\n+}\n+\n+function nodeOrDescendantsMatchSearch(\n+  node: LayoutNode,\n+  currentPath: string[],\n+  searchQuery: string,\n+  originalData: LayoutNode\n+): boolean {\n+  const path = [...currentPath, node.name]\n+  const fullPath = path.join('/').toLowerCase()\n+  const query = searchQuery.toLowerCase()\n+\n+  // Check if current node matches\n+  if (fullPath.includes(query)) {\n+    return true\n+  }\n+\n+  // For collapsed directories, search the original tree data\n+  if (node.type === 'collapsed-directory') {\n+    // Find the original node in the tree data\n+    let originalNode = originalData\n+    for (let i = 1; i < path.length; i++) {\n+      if (!originalNode.children) return false\n+      const found = originalNode.children.find(\n+        (child) => child.name === path[i]\n+      )\n+      if (!found) return false\n+      originalNode = found\n+    }\n+\n+    // Search through the original node's children\n+    if (originalNode.children) {\n+      for (const child of originalNode.children) {\n+        if (searchOriginalTreeForMatch(child, path, searchQuery)) {\n+          return true\n+        }\n+      }\n+    }\n+    return false\n+  }\n+\n+  // Check if any descendants match (for regular directories)\n+  if (node.children) {\n+    for (const child of node.children) {\n+      if (\n+        nodeOrDescendantsMatchSearch(child, path, searchQuery, originalData)\n+      ) {\n+        return true\n+      }\n+    }\n+  }\n+\n+  return false\n+}\n+\n+function drawTreemap(\n+  ctx: CanvasRenderingContext2D,\n+  node: LayoutNode,\n+  hoveredAncestorChain: number[] | null,\n+  selectedAncestorChain: number[],\n+  useSelectionFade: boolean,\n+  focusedAncestorChain: number[],\n+  searchQuery: string,\n+  originalData: LayoutNode,\n+  immediateHoveredSourceIndex: number | undefined,\n+  currentPath: string[] = [],\n+  parentFadedOut = false,\n+  insideActiveSubtree = false\n+) {\n+  const { rect, name, type, titleBarHeight, children, sourceIndex } = node\n+  const path = [...currentPath, name]\n+\n+  // Check if this node is on the focused path\n+  // When we wrap the layout with ancestors, nodes on the focus path should be drawn\n+  // as title bars, and only the focused node's children should be drawn in full.\n+  const focusedSourceIndex =\n+    focusedAncestorChain[focusedAncestorChain.length - 1]\n+\n+  if (focusedAncestorChain.length > 1 && sourceIndex !== undefined) {\n+    const isOnFocusPath = focusedAncestorChain.includes(sourceIndex)\n+    const isFocusedNode = sourceIndex === focusedSourceIndex\n+\n+    // Draw ancestor title bars (nodes on path but before the focused node)\n+    if (isOnFocusPath && !isFocusedNode && type === 'directory') {\n+      const colors = getThemeColors()\n+\n+      if (titleBarHeight && rect.height > 20) {\n+        ctx.fillStyle = colors.dirTitleBg\n+        ctx.globalAlpha = 1.0\n+        ctx.fillRect(rect.x, rect.y, rect.width, titleBarHeight)\n+\n+        ctx.strokeStyle = colors.dirTitleBorder\n+        ctx.beginPath()\n+        ctx.moveTo(rect.x, rect.y + titleBarHeight)\n+        ctx.lineTo(rect.x + rect.width, rect.y + titleBarHeight)\n+        ctx.stroke()\n+\n+        const titleFontSize = Math.max(10, titleBarHeight * 0.5)\n+        ctx.fillStyle = colors.text\n+        ctx.font = `600 ${titleFontSize}px sans-serif`\n+        ctx.textAlign = 'left'\n+        ctx.textBaseline = 'middle'\n+        ctx.fillText(\n+          name,\n+          rect.x + 8,\n+          rect.y + titleBarHeight / 2,\n+          rect.width - 16\n+        )\n+      }\n+\n+      if (children) {\n+        for (const child of children) {\n+          drawTreemap(\n+            ctx,\n+            child,\n+            hoveredAncestorChain,\n+            selectedAncestorChain,\n+            useSelectionFade,\n+            focusedAncestorChain,\n+            searchQuery,\n+            originalData,\n+            immediateHoveredSourceIndex,\n+            path,\n+            parentFadedOut,\n+            insideActiveSubtree\n+          )\n+        }\n+      }\n+      return\n+    }\n+  }\n+\n+  // Determine if this node should be faded out\n+  let fadeOut = false\n+\n+  if (searchQuery && searchQuery.trim() !== '') {\n+    // Search mode: fade out nodes that don't match\n+    if (type === 'directory' || type === 'collapsed-directory') {\n+      if (\n+        !nodeOrDescendantsMatchSearch(\n+          node,\n+          currentPath,\n+          searchQuery,\n+          originalData\n+        )\n+      ) {\n+        fadeOut = true\n+      }\n+    } else {\n+      const fullPath = path.join('/').toLowerCase()\n+      const query = searchQuery.toLowerCase()\n+      if (!fullPath.includes(query)) {\n+        fadeOut = true\n+      }\n+    }\n+  } else if (sourceIndex !== undefined) {\n+    // Selection/hover mode: show active node + ancestors + descendants\n+    const activeAncestorChain =\n+      hoveredAncestorChain ?? (useSelectionFade ? selectedAncestorChain : [])\n+\n+    if (activeAncestorChain.length > 0) {\n+      const activeSourceIndex =\n+        activeAncestorChain[activeAncestorChain.length - 1]\n+      const isActiveNode = sourceIndex === activeSourceIndex\n+      const isAncestorOfActive = activeAncestorChain.includes(sourceIndex)\n+\n+      // Check if this node is a descendant of the active node\n+      // This is tracked via the insideActiveSubtree parameter\n+      const isDescendantOfActive = insideActiveSubtree\n+\n+      // Fade out if NOT related to active node\n+      if (!isAncestorOfActive && !isActiveNode && !isDescendantOfActive) {\n+        fadeOut = true\n+      }\n+    }\n+  }\n+\n+  const opacity = fadeOut ? 0.3 : 1.0\n+  const colors = getThemeColors()\n+\n+  // Check if this is the immediately hovered node for brightness boost\n+  const isImmediateHovered =\n+    sourceIndex !== undefined && sourceIndex === immediateHoveredSourceIndex\n+\n+  if (type === 'file') {\n+    let color = getFileColor(node)\n+\n+    // Apply brightness boost to immediately hovered node\n+    if (isImmediateHovered) {\n+      color = lighten(0.15, color)\n+    }\n+\n+    ctx.fillStyle = color\n+    ctx.globalAlpha = opacity\n+    ctx.fillRect(rect.x, rect.y, rect.width, rect.height)\n+\n+    ctx.strokeStyle = colors.border\n+    ctx.lineWidth = 1\n+    ctx.strokeRect(rect.x, rect.y, rect.width, rect.height)\n+\n+    if (rect.width > 60 && rect.height > 30) {\n+      ctx.fillStyle = colors.text\n+      ctx.font = '12px sans-serif'\n+      ctx.textAlign = 'center'\n+      ctx.textBaseline = 'middle'\n+\n+      const maxWidth = rect.width - 8\n+      let displayName = name\n+      const metrics = ctx.measureText(displayName)\n+\n+      if (metrics.width > maxWidth) {\n+        while (\n+          displayName.length > 0 &&\n+          ctx.measureText(`${displayName}...`).width > maxWidth\n+        ) {\n+          displayName = displayName.slice(0, -1)\n+        }\n+        displayName += '...'\n+      }\n+\n+      ctx.fillText(\n+        displayName,\n+        rect.x + rect.width / 2,\n+        rect.y + rect.height / 2\n+      )\n+    }\n+\n+    ctx.globalAlpha = 1.0\n+  } else if (type === 'collapsed-directory') {\n+    let bgColor = colors.collapsedBg\n+\n+    // Apply brightness boost to immediately hovered node\n+    if (isImmediateHovered) {\n+      bgColor = lighten(0.15, bgColor)\n+    }\n+\n+    ctx.fillStyle = bgColor\n+    ctx.globalAlpha = opacity\n+    ctx.fillRect(rect.x, rect.y, rect.width, rect.height)\n+\n+    ctx.strokeStyle = colors.dirBorder\n+    ctx.lineWidth = 1\n+    ctx.strokeRect(rect.x, rect.y, rect.width, rect.height)\n+\n+    if (titleBarHeight) {\n+      let titleBgColor = colors.dirTitleBg\n+\n+      // Apply brightness boost to title bar too\n+      if (isImmediateHovered) {\n+        titleBgColor = lighten(0.15, titleBgColor)\n+      }\n+\n+      ctx.fillStyle = titleBgColor\n+      ctx.fillRect(rect.x, rect.y, rect.width, titleBarHeight)\n+\n+      ctx.strokeStyle = colors.dirTitleBorder\n+      ctx.beginPath()\n+      ctx.moveTo(rect.x, rect.y + titleBarHeight)\n+      ctx.lineTo(rect.x + rect.width, rect.y + titleBarHeight)\n+      ctx.stroke()\n+\n+      const titleFontSize = Math.max(10, titleBarHeight * 0.5)\n+      ctx.fillStyle = colors.text\n+      ctx.font = `600 ${titleFontSize}px sans-serif`\n+      ctx.textAlign = 'left'\n+      ctx.textBaseline = 'middle'\n+      ctx.fillText(\n+        name,\n+        rect.x + 8,\n+        rect.y + titleBarHeight / 2,\n+        rect.width - 16\n+      )\n+    }\n+\n+    ctx.globalAlpha = 1.0\n+  } else {\n+    let dirBgColor = colors.dirBg\n+\n+    // Apply brightness boost to immediately hovered node\n+    if (isImmediateHovered) {\n+      dirBgColor = lighten(0.15, dirBgColor)\n+    }\n+\n+    ctx.fillStyle = dirBgColor\n+    ctx.globalAlpha = opacity\n+    ctx.fillRect(rect.x, rect.y, rect.width, rect.height)\n+\n+    ctx.strokeStyle = colors.dirBorder\n+    ctx.lineWidth = 1\n+    ctx.strokeRect(rect.x, rect.y, rect.width, rect.height)\n+\n+    if (titleBarHeight && rect.height > 20) {\n+      let dirTitleBgColor = colors.dirTitleBg\n+\n+      // Apply brightness boost to title bar too\n+      if (isImmediateHovered) {\n+        dirTitleBgColor = lighten(0.15, dirTitleBgColor)\n+      }\n+\n+      ctx.fillStyle = dirTitleBgColor\n+      ctx.fillRect(rect.x, rect.y, rect.width, titleBarHeight)\n+\n+      ctx.strokeStyle = colors.dirTitleBorder\n+      ctx.beginPath()\n+      ctx.moveTo(rect.x, rect.y + titleBarHeight)\n+      ctx.lineTo(rect.x + rect.width, rect.y + titleBarHeight)\n+      ctx.stroke()\n+\n+      const titleFontSize = Math.max(10, titleBarHeight * 0.5)\n+      ctx.fillStyle = colors.text\n+      ctx.font = `600 ${titleFontSize}px sans-serif`\n+      ctx.textAlign = 'left'\n+      ctx.textBaseline = 'middle'\n+      ctx.fillText(\n+        name,\n+        rect.x + 8,\n+        rect.y + titleBarHeight / 2,\n+        rect.width - 16\n+      )\n+    }\n+\n+    ctx.globalAlpha = 1.0\n+\n+    if (children) {\n+      for (const child of children) {\n+        const childFadeOut =\n+          searchQuery && searchQuery.trim() !== '' ? false : fadeOut\n+\n+        // Determine if children are inside active subtree\n+        // Children are inside if: this node is active OR we're already inside\n+        const activeAncestorChain =\n+          hoveredAncestorChain ??\n+          (useSelectionFade ? selectedAncestorChain : [])\n+        const activeSourceIndex =\n+          activeAncestorChain[activeAncestorChain.length - 1]\n+        const childInsideActiveSubtree =\n+          insideActiveSubtree || sourceIndex === activeSourceIndex\n+\n+        drawTreemap(\n+          ctx,\n+          child,\n+          hoveredAncestorChain,\n+          selectedAncestorChain,\n+          useSelectionFade,\n+          focusedAncestorChain,\n+          searchQuery,\n+          originalData,\n+          immediateHoveredSourceIndex,\n+          path,\n+          childFadeOut,\n+          childInsideActiveSubtree\n+        )\n+      }\n+    }\n+  }\n+}\n+\n+function wrapLayoutWithAncestorsUsingIndices(\n+  focusedLayout: LayoutNode,\n+  focusedAncestorChain: number[],\n+  analyzeData: AnalyzeData,\n+  fullWidth: number,\n+  fullHeight: number,\n+  minTitleBarHeight = 12\n+): LayoutNode {\n+  // If focusing on root, return as-is\n+  if (focusedAncestorChain.length <= 1) {\n+    return focusedLayout\n+  }\n+\n+  let currentNode = focusedLayout\n+  let cumulativeY = focusedLayout.rect.y // Start from where the focused node begins\n+\n+  // Work backwards from the parent of focused node to the child of root\n+  for (let i = focusedAncestorChain.length - 2; i >= 1; i--) {\n+    const ancestorIndex = focusedAncestorChain[i]\n+    const ancestorSource = analyzeData.source(ancestorIndex)\n+    if (!ancestorSource) continue\n+\n+    const titleBarHeight = minTitleBarHeight\n+\n+    // This ancestor starts at cumulativeY - titleBarHeight\n+    cumulativeY -= titleBarHeight\n+\n+    const ancestorNode: LayoutNode = {\n+      name: ancestorSource.path,\n+      type: 'directory',\n+      size: currentNode.size,\n+      rect: {\n+        x: 0,\n+        y: cumulativeY,\n+        width: fullWidth,\n+        height: fullHeight - cumulativeY,\n+      },\n+      titleBarHeight: titleBarHeight,\n+      children: [currentNode],\n+      sourceIndex: ancestorIndex,\n+    }\n+\n+    currentNode = ancestorNode\n+  }\n+\n+  cumulativeY -= minTitleBarHeight\n+\n+  const rootIndex = focusedAncestorChain[0]\n+  const rootSource = analyzeData.source(rootIndex)\n+\n+  const rootNode: LayoutNode = {\n+    name: rootSource?.path || '',\n+    type: 'directory',\n+    size: currentNode.size,\n+    rect: {\n+      x: 0,\n+      y: cumulativeY,\n+      width: fullWidth,\n+      height: fullHeight - cumulativeY,\n+    },\n+    titleBarHeight: minTitleBarHeight,\n+    children: [currentNode],\n+    sourceIndex: rootIndex,\n+  }\n+\n+  return rootNode\n+}\n+\n+export function TreemapVisualizer({\n+  analyzeData,\n+  sourceIndex,\n+  selectedSourceIndex = sourceIndex,\n+  onSelectSourceIndex = () => {},\n+  focusedSourceIndex = sourceIndex,\n+  onFocusSourceIndex = () => {},\n+  isMouseInTreemap = false,\n+  onHoveredNodeChange,\n+  onHoveredNodeChangeDelayed,\n+  searchQuery = '',\n+  filterSource,\n+}: TreemapVisualizerProps) {\n+  const canvasRef = useRef<HTMLCanvasElement>(null)\n+  const containerRef = useRef<HTMLDivElement>(null)\n+  const [hoveredNode, setHoveredNode] = useState<LayoutNode | null>(null)\n+  const [shouldDimOthers, setShouldDimOthers] = useState(false)\n+  const hoverTimeoutRef = useRef<NodeJS.Timeout | null>(null)\n+  const [cssDimensions, setCssDimensions] = useState({\n+    width: 1200,\n+    height: 800,\n+  })\n+  const [canvasDimensions, setCanvasDimensions] = useState({\n+    width: 1200,\n+    height: 800,\n+  })\n+  const [, _setTheme] = useState<'light' | 'dark'>('light')\n+\n+  // Build ancestor chain for focused source (list of source indices from root to focused)\n+  const focusedAncestorChain = useMemo(() => {\n+    const chain: number[] = []\n+    let currentIndex = focusedSourceIndex\n+\n+    while (currentIndex !== undefined && currentIndex !== null) {\n+      chain.unshift(currentIndex)\n+      const source = analyzeData.source(currentIndex)\n+      if (!source || source.parent_source_index === null) break\n+      currentIndex = source.parent_source_index\n+    }\n+\n+    return chain\n+  }, [analyzeData, focusedSourceIndex])\n+\n+  // Build ancestor chain for selected source\n+  const selectedAncestorChain = useMemo(() => {\n+    const chain: number[] = []\n+    let currentIndex = selectedSourceIndex\n+\n+    while (currentIndex !== undefined && currentIndex !== null) {\n+      chain.unshift(currentIndex)\n+      const source = analyzeData.source(currentIndex)\n+      if (!source || source.parent_source_index === null) break\n+      currentIndex = source.parent_source_index\n+    }\n+\n+    return chain\n+  }, [analyzeData, selectedSourceIndex])\n+\n+  // Build ancestor chain for hovered node (only used for dimming)\n+  const hoveredAncestorChain = useMemo(() => {\n+    if (\n+      !shouldDimOthers ||\n+      !hoveredNode ||\n+      hoveredNode.sourceIndex === undefined\n+    )\n+      return null\n+\n+    const chain: number[] = []\n+    let currentIndex = hoveredNode.sourceIndex\n+\n+    while (currentIndex !== undefined && currentIndex !== null) {\n+      chain.unshift(currentIndex)\n+      const source = analyzeData.source(currentIndex)\n+      if (!source || source.parent_source_index === null) break\n+      currentIndex = source.parent_source_index\n+    }\n+\n+    return chain\n+  }, [analyzeData, hoveredNode, shouldDimOthers])\n+\n+  useEffect(() => {\n+    const container = containerRef.current\n+    if (!container) return\n+\n+    const updateSize = () => {\n+      const rect = container.getBoundingClientRect()\n+      const dpr = window.devicePixelRatio || 1\n+      setCssDimensions({\n+        width: Math.floor(rect.width),\n+        height: Math.floor(rect.height),\n+      })\n+      setCanvasDimensions({\n+        width: Math.floor(rect.width * dpr),\n+        height: Math.floor(rect.height * dpr),\n+      })\n+    }\n+\n+    updateSize()\n+\n+    const resizeObserver = new ResizeObserver(updateSize)\n+    resizeObserver.observe(container)\n+\n+    return () => resizeObserver.disconnect()\n+  }, [])\n+\n+  const layout = useMemo(() => {\n+    // Compute layout using the focused source index\n+    const focusedLayout = computeTreemapLayoutFromAnalyze(\n+      analyzeData,\n+      focusedSourceIndex,\n+      {\n+        x: 0,\n+        y: 12 * focusedAncestorChain.length,\n+        width: cssDimensions.width,\n+        height: cssDimensions.height,\n+      },\n+      filterSource\n+    )\n+\n+    // If we're not at the root, wrap with ancestor title bars\n+    if (focusedAncestorChain.length > 1) {\n+      return wrapLayoutWithAncestorsUsingIndices(\n+        focusedLayout,\n+        focusedAncestorChain,\n+        analyzeData,\n+        cssDimensions.width,\n+        cssDimensions.height,\n+        12\n+      )\n+    }\n+\n+    return focusedLayout\n+  }, [\n+    analyzeData,\n+    focusedSourceIndex,\n+    focusedAncestorChain,\n+    cssDimensions.width,\n+    cssDimensions.height,\n+    filterSource,\n+  ])\n+\n+  useEffect(() => {\n+    const canvas = canvasRef.current\n+    if (!canvas) return\n+\n+    const ctx = canvas.getContext('2d')\n+    if (!ctx) return\n+\n+    const dpr = window.devicePixelRatio || 1\n+    ctx.setTransform(1, 0, 0, 1, 0, 0)\n+    ctx.scale(dpr, dpr)\n+\n+    ctx.clearRect(0, 0, cssDimensions.width, cssDimensions.height)\n+\n+    drawTreemap(\n+      ctx,\n+      layout,\n+      hoveredAncestorChain,\n+      selectedAncestorChain,\n+      !isMouseInTreemap,\n+      focusedAncestorChain,\n+      searchQuery,\n+      layout,\n+      hoveredNode?.sourceIndex\n+    )\n+  }, [\n+    layout,\n+    hoveredAncestorChain,\n+    selectedAncestorChain,\n+    cssDimensions.width,\n+    cssDimensions.height,\n+    isMouseInTreemap,\n+    focusedAncestorChain,\n+    searchQuery,\n+    hoveredNode,\n+  ])\n+\n+  const handleClick = (e: React.MouseEvent<HTMLCanvasElement>) => {\n+    const canvas = canvasRef.current\n+    if (!canvas) return\n+\n+    const rect = canvas.getBoundingClientRect()\n+    const x = e.clientX - rect.left\n+    const y = e.clientY - rect.top\n+\n+    const node = findNodeAtPosition(layout, x, y)\n+\n+    if (node && node.sourceIndex !== undefined) {\n+      // If this node is already, refocus the root node to undim others\n+      if (node.sourceIndex === selectedSourceIndex) {\n+        onSelectSourceIndex(sourceIndex)\n+      } else {\n+        onSelectSourceIndex(node.sourceIndex)\n+      }\n+    }\n+  }\n+\n+  const handleDoubleClick = (e: React.MouseEvent<HTMLCanvasElement>) => {\n+    const canvas = canvasRef.current\n+    if (!canvas) return\n+\n+    const rect = canvas.getBoundingClientRect()\n+    const x = e.clientX - rect.left\n+    const y = e.clientY - rect.top\n+\n+    const node = findNodeAtPosition(layout, x, y)\n+\n+    if (node && node.sourceIndex !== undefined) {\n+      // Navigate into directories on double-click\n+      if (node.type === 'directory' || node.type === 'collapsed-directory') {\n+        onFocusSourceIndex(node.sourceIndex)\n+        onSelectSourceIndex(node.sourceIndex)\n+      }\n+    }\n+  }\n+\n+  const handleMouseMove = (e: React.MouseEvent<HTMLCanvasElement>) => {\n+    const canvas = canvasRef.current\n+    if (!canvas) return\n+\n+    const rect = canvas.getBoundingClientRect()\n+    const x = e.clientX - rect.left\n+    const y = e.clientY - rect.top\n+\n+    const node = findNodeAtPosition(layout, x, y)\n+\n+    // Clear existing timeout\n+    if (hoverTimeoutRef.current) {\n+      clearTimeout(hoverTimeoutRef.current)\n+      hoverTimeoutRef.current = null\n+    }\n+\n+    if (node) {\n+      const nodeInfo = {\n+        name: node.name,\n+        server: node.server,\n+        client: node.client,\n+      }\n+\n+      if (node.type === 'directory') {\n+        const titleBarHeight = node.titleBarHeight || 0\n+        if (y >= node.rect.y && y <= node.rect.y + titleBarHeight) {\n+          canvas.style.cursor = 'pointer'\n+          // Immediately set for brightness increase and footer/tooltip updates\n+          setHoveredNode(node)\n+          setShouldDimOthers(false)\n+          onHoveredNodeChange?.(nodeInfo)\n+          // Delay dimming other nodes by 800ms\n+          hoverTimeoutRef.current = setTimeout(() => {\n+            setShouldDimOthers(true)\n+            onHoveredNodeChangeDelayed?.(nodeInfo)\n+          }, 1000)\n+          return\n+        }\n+      } else {\n+        canvas.style.cursor = 'pointer'\n+        // Immediately set for brightness increase and footer/tooltip updates\n+        setHoveredNode(node)\n+        setShouldDimOthers(false)\n+        onHoveredNodeChange?.(nodeInfo)\n+        // Delay dimming other nodes by 800ms\n+        hoverTimeoutRef.current = setTimeout(() => {\n+          setShouldDimOthers(true)\n+          onHoveredNodeChangeDelayed?.(nodeInfo)\n+        }, 1000)\n+        return\n+      }\n+    }\n+\n+    // Immediately clear hover when mouse leaves a node\n+    setHoveredNode(null)\n+    setShouldDimOthers(false)\n+    onHoveredNodeChange?.(null)\n+    onHoveredNodeChangeDelayed?.(null)\n+    if (canvasRef.current) {\n+      canvasRef.current.style.cursor = 'default'\n+    }\n+  }\n+\n+  const handleMouseLeave = () => {\n+    // Clear timeout when mouse leaves canvas\n+    if (hoverTimeoutRef.current) {\n+      clearTimeout(hoverTimeoutRef.current)\n+      hoverTimeoutRef.current = null\n+    }\n+\n+    setHoveredNode(null)\n+    setShouldDimOthers(false)\n+    onHoveredNodeChange?.(null)\n+    onHoveredNodeChangeDelayed?.(null)\n+    if (canvasRef.current) {\n+      canvasRef.current.style.cursor = 'default'\n+    }\n+  }\n+\n+  return (\n+    <div\n+      ref={containerRef}\n+      className=\"w-full h-full bg-background border border-border rounded-lg overflow-hidden\"\n+    >\n+      <canvas\n+        ref={canvasRef}\n+        width={canvasDimensions.width}\n+        height={canvasDimensions.height}\n+        onMouseMove={handleMouseMove}\n+        onMouseLeave={handleMouseLeave}\n+        onClick={handleClick}\n+        onDoubleClick={handleDoubleClick}\n+        className=\"block w-full h-full\"\n+      />\n+    </div>\n+  )\n+}\n+\n+function isDarkMode(): boolean {\n+  if (typeof window === 'undefined') return false\n+  return document.documentElement.classList.contains('dark')\n+}\n+\n+function getThemeColors() {\n+  const dark = isDarkMode()\n+  return {\n+    text: dark ? '#ffffff' : '#000000',\n+    textMuted: dark ? 'rgba(255, 255, 255, 0.6)' : 'rgba(0, 0, 0, 0.6)',\n+    border: dark ? 'rgba(255, 255, 255, 0.2)' : 'rgba(128, 128, 128, 0.2)',\n+    dirBg: dark ? 'rgba(255, 255, 255, 0.05)' : 'rgba(128, 128, 128, 0.1)',\n+    dirBorder: dark ? 'rgba(255, 255, 255, 0.2)' : 'rgba(128, 128, 128, 0.3)',\n+    dirTitleBg: dark ? 'rgba(255, 255, 255, 0.08)' : 'rgba(128, 128, 128, 0.1)',\n+    dirTitleBorder: dark\n+      ? 'rgba(255, 255, 255, 0.15)'\n+      : 'rgba(128, 128, 128, 0.2)',\n+    collapsedBg: dark\n+      ? 'rgba(128, 128, 128, 0.15)'\n+      : 'rgba(128, 128, 128, 0.2)',\n+    collapsedText: dark\n+      ? 'rgba(255, 255, 255, 0.5)'\n+      : 'rgba(128, 128, 128, 0.6)',\n+  }\n+}"
        },
        {
            "sha": "7336a33539e341c326da99a548029d35a0cf3c4f",
            "filename": "apps/bundle-analyzer/components/ui/button.tsx",
            "status": "added",
            "additions": 59,
            "deletions": 0,
            "changes": 59,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fbutton.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fbutton.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fbutton.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,59 @@\n+'use client'\n+\n+import { Slot } from '@radix-ui/react-slot'\n+import { cva, type VariantProps } from 'class-variance-authority'\n+import * as React from 'react'\n+\n+import { cn } from '@/lib/utils'\n+\n+const buttonVariants = cva(\n+  'inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium transition-colors focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0',\n+  {\n+    variants: {\n+      variant: {\n+        default:\n+          'bg-primary text-primary-foreground shadow hover:bg-primary/90',\n+        destructive:\n+          'bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90',\n+        outline:\n+          'border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground',\n+        secondary:\n+          'bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80',\n+        ghost: 'hover:bg-accent hover:text-accent-foreground',\n+        link: 'text-primary underline-offset-4 hover:underline',\n+      },\n+      size: {\n+        default: 'h-9 px-4 py-2',\n+        sm: 'h-8 rounded-md px-3 text-xs',\n+        lg: 'h-10 rounded-md px-8',\n+        icon: 'h-9 w-9',\n+      },\n+    },\n+    defaultVariants: {\n+      variant: 'default',\n+      size: 'default',\n+    },\n+  }\n+)\n+\n+export interface ButtonProps\n+  extends React.ButtonHTMLAttributes<HTMLButtonElement>,\n+    VariantProps<typeof buttonVariants> {\n+  asChild?: boolean\n+}\n+\n+const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(\n+  ({ className, variant, size, asChild = false, ...props }, ref) => {\n+    const Comp = asChild ? Slot : 'button'\n+    return (\n+      <Comp\n+        className={cn(buttonVariants({ variant, size, className }))}\n+        ref={ref}\n+        {...props}\n+      />\n+    )\n+  }\n+)\n+Button.displayName = 'Button'\n+\n+export { Button, buttonVariants }"
        },
        {
            "sha": "c6ef878a5299cc38082327205878ba495d6e8b2e",
            "filename": "apps/bundle-analyzer/components/ui/command.tsx",
            "status": "added",
            "additions": 184,
            "deletions": 0,
            "changes": 184,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fcommand.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fcommand.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fcommand.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,184 @@\n+'use client'\n+\n+import * as React from 'react'\n+import { Command as CommandPrimitive } from 'cmdk'\n+import { SearchIcon } from 'lucide-react'\n+\n+import { cn } from '@/lib/utils'\n+import {\n+  Dialog,\n+  DialogContent,\n+  DialogDescription,\n+  DialogHeader,\n+  DialogTitle,\n+} from '@/components/ui/dialog'\n+\n+function Command({\n+  className,\n+  ...props\n+}: React.ComponentProps<typeof CommandPrimitive>) {\n+  return (\n+    <CommandPrimitive\n+      data-slot=\"command\"\n+      className={cn(\n+        'bg-popover text-popover-foreground flex h-full w-full flex-col overflow-hidden rounded-md',\n+        className\n+      )}\n+      {...props}\n+    />\n+  )\n+}\n+\n+function CommandDialog({\n+  title = 'Command Palette',\n+  description = 'Search for a command to run...',\n+  children,\n+  className,\n+  showCloseButton = true,\n+  ...props\n+}: React.ComponentProps<typeof Dialog> & {\n+  title?: string\n+  description?: string\n+  className?: string\n+  showCloseButton?: boolean\n+}) {\n+  return (\n+    <Dialog {...props}>\n+      <DialogHeader className=\"sr-only\">\n+        <DialogTitle>{title}</DialogTitle>\n+        <DialogDescription>{description}</DialogDescription>\n+      </DialogHeader>\n+      <DialogContent\n+        className={cn('overflow-hidden p-0', className)}\n+        showCloseButton={showCloseButton}\n+      >\n+        <Command className=\"[&_[cmdk-group-heading]]:text-muted-foreground **:data-[slot=command-input-wrapper]:h-12 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:font-medium [&_[cmdk-group]]:px-2 [&_[cmdk-group]:not([hidden])_~[cmdk-group]]:pt-0 [&_[cmdk-input-wrapper]_svg]:h-5 [&_[cmdk-input-wrapper]_svg]:w-5 [&_[cmdk-input]]:h-12 [&_[cmdk-item]]:px-2 [&_[cmdk-item]]:py-3 [&_[cmdk-item]_svg]:h-5 [&_[cmdk-item]_svg]:w-5\">\n+          {children}\n+        </Command>\n+      </DialogContent>\n+    </Dialog>\n+  )\n+}\n+\n+function CommandInput({\n+  className,\n+  ...props\n+}: React.ComponentProps<typeof CommandPrimitive.Input>) {\n+  return (\n+    <div\n+      data-slot=\"command-input-wrapper\"\n+      className=\"flex h-9 items-center gap-2 border-b px-3\"\n+    >\n+      <SearchIcon className=\"size-4 shrink-0 opacity-50\" />\n+      <CommandPrimitive.Input\n+        data-slot=\"command-input\"\n+        className={cn(\n+          'placeholder:text-muted-foreground flex h-10 w-full rounded-md bg-transparent py-3 text-sm outline-hidden disabled:cursor-not-allowed disabled:opacity-50',\n+          className\n+        )}\n+        {...props}\n+      />\n+    </div>\n+  )\n+}\n+\n+function CommandList({\n+  className,\n+  ...props\n+}: React.ComponentProps<typeof CommandPrimitive.List>) {\n+  return (\n+    <CommandPrimitive.List\n+      data-slot=\"command-list\"\n+      className={cn(\n+        'max-h-[300px] scroll-py-1 overflow-x-hidden overflow-y-auto',\n+        className\n+      )}\n+      {...props}\n+    />\n+  )\n+}\n+\n+function CommandEmpty({\n+  ...props\n+}: React.ComponentProps<typeof CommandPrimitive.Empty>) {\n+  return (\n+    <CommandPrimitive.Empty\n+      data-slot=\"command-empty\"\n+      className=\"py-6 text-center text-sm\"\n+      {...props}\n+    />\n+  )\n+}\n+\n+function CommandGroup({\n+  className,\n+  ...props\n+}: React.ComponentProps<typeof CommandPrimitive.Group>) {\n+  return (\n+    <CommandPrimitive.Group\n+      data-slot=\"command-group\"\n+      className={cn(\n+        'text-foreground [&_[cmdk-group-heading]]:text-muted-foreground overflow-hidden p-1 [&_[cmdk-group-heading]]:px-2 [&_[cmdk-group-heading]]:py-1.5 [&_[cmdk-group-heading]]:text-xs [&_[cmdk-group-heading]]:font-medium',\n+        className\n+      )}\n+      {...props}\n+    />\n+  )\n+}\n+\n+function CommandSeparator({\n+  className,\n+  ...props\n+}: React.ComponentProps<typeof CommandPrimitive.Separator>) {\n+  return (\n+    <CommandPrimitive.Separator\n+      data-slot=\"command-separator\"\n+      className={cn('bg-border -mx-1 h-px', className)}\n+      {...props}\n+    />\n+  )\n+}\n+\n+function CommandItem({\n+  className,\n+  ...props\n+}: React.ComponentProps<typeof CommandPrimitive.Item>) {\n+  return (\n+    <CommandPrimitive.Item\n+      data-slot=\"command-item\"\n+      className={cn(\n+        \"data-[selected=true]:bg-accent data-[selected=true]:text-accent-foreground [&_svg:not([class*='text-'])]:text-muted-foreground relative flex cursor-default items-center gap-2 rounded-sm px-2 py-1.5 text-sm outline-hidden select-none data-[disabled=true]:pointer-events-none data-[disabled=true]:opacity-50 [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\",\n+        className\n+      )}\n+      {...props}\n+    />\n+  )\n+}\n+\n+function CommandShortcut({\n+  className,\n+  ...props\n+}: React.ComponentProps<'span'>) {\n+  return (\n+    <span\n+      data-slot=\"command-shortcut\"\n+      className={cn(\n+        'text-muted-foreground ml-auto text-xs tracking-widest',\n+        className\n+      )}\n+      {...props}\n+    />\n+  )\n+}\n+\n+export {\n+  Command,\n+  CommandDialog,\n+  CommandInput,\n+  CommandList,\n+  CommandEmpty,\n+  CommandGroup,\n+  CommandItem,\n+  CommandShortcut,\n+  CommandSeparator,\n+}"
        },
        {
            "sha": "c31efc3a8530addbd49a5269630f0211131ddacb",
            "filename": "apps/bundle-analyzer/components/ui/dialog.tsx",
            "status": "added",
            "additions": 143,
            "deletions": 0,
            "changes": 143,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fdialog.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fdialog.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fdialog.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,143 @@\n+'use client'\n+\n+import * as React from 'react'\n+import * as DialogPrimitive from '@radix-ui/react-dialog'\n+import { XIcon } from 'lucide-react'\n+\n+import { cn } from '@/lib/utils'\n+\n+function Dialog({\n+  ...props\n+}: React.ComponentProps<typeof DialogPrimitive.Root>) {\n+  return <DialogPrimitive.Root data-slot=\"dialog\" {...props} />\n+}\n+\n+function DialogTrigger({\n+  ...props\n+}: React.ComponentProps<typeof DialogPrimitive.Trigger>) {\n+  return <DialogPrimitive.Trigger data-slot=\"dialog-trigger\" {...props} />\n+}\n+\n+function DialogPortal({\n+  ...props\n+}: React.ComponentProps<typeof DialogPrimitive.Portal>) {\n+  return <DialogPrimitive.Portal data-slot=\"dialog-portal\" {...props} />\n+}\n+\n+function DialogClose({\n+  ...props\n+}: React.ComponentProps<typeof DialogPrimitive.Close>) {\n+  return <DialogPrimitive.Close data-slot=\"dialog-close\" {...props} />\n+}\n+\n+function DialogOverlay({\n+  className,\n+  ...props\n+}: React.ComponentProps<typeof DialogPrimitive.Overlay>) {\n+  return (\n+    <DialogPrimitive.Overlay\n+      data-slot=\"dialog-overlay\"\n+      className={cn(\n+        'data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50',\n+        className\n+      )}\n+      {...props}\n+    />\n+  )\n+}\n+\n+function DialogContent({\n+  className,\n+  children,\n+  showCloseButton = true,\n+  ...props\n+}: React.ComponentProps<typeof DialogPrimitive.Content> & {\n+  showCloseButton?: boolean\n+}) {\n+  return (\n+    <DialogPortal data-slot=\"dialog-portal\">\n+      <DialogOverlay />\n+      <DialogPrimitive.Content\n+        data-slot=\"dialog-content\"\n+        className={cn(\n+          'bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg',\n+          className\n+        )}\n+        {...props}\n+      >\n+        {children}\n+        {showCloseButton && (\n+          <DialogPrimitive.Close\n+            data-slot=\"dialog-close\"\n+            className=\"ring-offset-background focus:ring-ring data-[state=open]:bg-accent data-[state=open]:text-muted-foreground absolute top-4 right-4 rounded-xs opacity-70 transition-opacity hover:opacity-100 focus:ring-2 focus:ring-offset-2 focus:outline-hidden disabled:pointer-events-none [&_svg]:pointer-events-none [&_svg]:shrink-0 [&_svg:not([class*='size-'])]:size-4\"\n+          >\n+            <XIcon />\n+            <span className=\"sr-only\">Close</span>\n+          </DialogPrimitive.Close>\n+        )}\n+      </DialogPrimitive.Content>\n+    </DialogPortal>\n+  )\n+}\n+\n+function DialogHeader({ className, ...props }: React.ComponentProps<'div'>) {\n+  return (\n+    <div\n+      data-slot=\"dialog-header\"\n+      className={cn('flex flex-col gap-2 text-center sm:text-left', className)}\n+      {...props}\n+    />\n+  )\n+}\n+\n+function DialogFooter({ className, ...props }: React.ComponentProps<'div'>) {\n+  return (\n+    <div\n+      data-slot=\"dialog-footer\"\n+      className={cn(\n+        'flex flex-col-reverse gap-2 sm:flex-row sm:justify-end',\n+        className\n+      )}\n+      {...props}\n+    />\n+  )\n+}\n+\n+function DialogTitle({\n+  className,\n+  ...props\n+}: React.ComponentProps<typeof DialogPrimitive.Title>) {\n+  return (\n+    <DialogPrimitive.Title\n+      data-slot=\"dialog-title\"\n+      className={cn('text-lg leading-none font-semibold', className)}\n+      {...props}\n+    />\n+  )\n+}\n+\n+function DialogDescription({\n+  className,\n+  ...props\n+}: React.ComponentProps<typeof DialogPrimitive.Description>) {\n+  return (\n+    <DialogPrimitive.Description\n+      data-slot=\"dialog-description\"\n+      className={cn('text-muted-foreground text-sm', className)}\n+      {...props}\n+    />\n+  )\n+}\n+\n+export {\n+  Dialog,\n+  DialogClose,\n+  DialogContent,\n+  DialogDescription,\n+  DialogFooter,\n+  DialogHeader,\n+  DialogOverlay,\n+  DialogPortal,\n+  DialogTitle,\n+  DialogTrigger,\n+}"
        },
        {
            "sha": "0bab5d53d67700f04ca7b70f2e93258ce3270b0a",
            "filename": "apps/bundle-analyzer/components/ui/input.tsx",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Finput.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Finput.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Finput.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,25 @@\n+import * as React from 'react'\n+\n+import { cn } from '@/lib/utils'\n+\n+export interface InputProps\n+  extends React.InputHTMLAttributes<HTMLInputElement> {}\n+\n+const Input = React.forwardRef<HTMLInputElement, InputProps>(\n+  ({ className, type, ...props }, ref) => {\n+    return (\n+      <input\n+        type={type}\n+        className={cn(\n+          'flex h-9 w-full rounded-md border border-input bg-transparent px-3 py-1 text-sm shadow-sm transition-colors file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring disabled:cursor-not-allowed disabled:opacity-50',\n+          className\n+        )}\n+        ref={ref}\n+        {...props}\n+      />\n+    )\n+  }\n+)\n+Input.displayName = 'Input'\n+\n+export { Input }"
        },
        {
            "sha": "fe978ffec6f4a4a69b39774ad8b0c428134b65ac",
            "filename": "apps/bundle-analyzer/components/ui/popover.tsx",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fpopover.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fpopover.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fpopover.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,33 @@\n+'use client'\n+\n+import * as PopoverPrimitive from '@radix-ui/react-popover'\n+import * as React from 'react'\n+\n+import { cn } from '@/lib/utils'\n+\n+const Popover = PopoverPrimitive.Root\n+\n+const PopoverTrigger = PopoverPrimitive.Trigger\n+\n+const PopoverAnchor = PopoverPrimitive.Anchor\n+\n+const PopoverContent = React.forwardRef<\n+  React.ElementRef<typeof PopoverPrimitive.Content>,\n+  React.ComponentPropsWithoutRef<typeof PopoverPrimitive.Content>\n+>(({ className, align = 'center', sideOffset = 4, ...props }, ref) => (\n+  <PopoverPrimitive.Portal>\n+    <PopoverPrimitive.Content\n+      ref={ref}\n+      align={align}\n+      sideOffset={sideOffset}\n+      className={cn(\n+        'z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',\n+        className\n+      )}\n+      {...props}\n+    />\n+  </PopoverPrimitive.Portal>\n+))\n+PopoverContent.displayName = PopoverPrimitive.Content.displayName\n+\n+export { Popover, PopoverTrigger, PopoverContent, PopoverAnchor }"
        },
        {
            "sha": "1f57e7ec409594e857f001943e76d563e5694be9",
            "filename": "apps/bundle-analyzer/components/ui/skeleton.tsx",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fskeleton.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fskeleton.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Fskeleton.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,33 @@\n+import { cn } from '@/lib/utils'\n+\n+export function Skeleton({\n+  className,\n+  ...props\n+}: React.HTMLAttributes<HTMLDivElement>) {\n+  return (\n+    <div\n+      className={cn('animate-pulse rounded-md bg-muted', className)}\n+      {...props}\n+    />\n+  )\n+}\n+\n+export function TreemapSkeleton() {\n+  return (\n+    <div className=\"h-full w-full grid grid-cols-12 grid-rows-8 gap-2\">\n+      {/* Simulate treemap blocks with varying sizes */}\n+      <Skeleton className=\"col-span-5 row-span-4\" />\n+      <Skeleton className=\"col-span-4 row-span-3\" />\n+      <Skeleton className=\"col-span-3 row-span-3\" />\n+      <Skeleton className=\"col-span-4 row-span-1\" />\n+      <Skeleton className=\"col-span-3 row-span-2\" />\n+      <Skeleton className=\"col-span-3 row-span-4\" />\n+      <Skeleton className=\"col-span-2 row-span-2\" />\n+      <Skeleton className=\"col-span-2 row-span-2\" />\n+      <Skeleton className=\"col-span-3 row-span-2\" />\n+      <Skeleton className=\"col-span-4 row-span-2\" />\n+      <Skeleton className=\"col-span-2 row-span-2\" />\n+      <Skeleton className=\"col-span-3 row-span-2\" />\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "f92e8a531dd1ddd81b2ca08beeacbb71f030bb9b",
            "filename": "apps/bundle-analyzer/components/ui/toggle-group.tsx",
            "status": "added",
            "additions": 66,
            "deletions": 0,
            "changes": 66,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Ftoggle-group.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Ftoggle-group.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Ftoggle-group.tsx?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,66 @@\n+'use client'\n+\n+import * as ToggleGroupPrimitive from '@radix-ui/react-toggle-group'\n+import * as React from 'react'\n+\n+import { cn } from '@/lib/utils'\n+\n+const ToggleGroupContext = React.createContext<{\n+  size?: 'default' | 'sm' | 'lg'\n+  variant?: 'default' | 'outline'\n+}>({\n+  size: 'default',\n+  variant: 'default',\n+})\n+\n+const ToggleGroup = React.forwardRef<\n+  React.ElementRef<typeof ToggleGroupPrimitive.Root>,\n+  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Root> & {\n+    size?: 'default' | 'sm' | 'lg'\n+    variant?: 'default' | 'outline'\n+  }\n+>(\n+  (\n+    { className, variant = 'default', size = 'default', children, ...props },\n+    ref\n+  ) => (\n+    <ToggleGroupPrimitive.Root\n+      ref={ref}\n+      className={cn('flex items-center justify-center gap-1', className)}\n+      {...props}\n+    >\n+      <ToggleGroupContext.Provider value={{ variant, size }}>\n+        {children}\n+      </ToggleGroupContext.Provider>\n+    </ToggleGroupPrimitive.Root>\n+  )\n+)\n+\n+ToggleGroup.displayName = ToggleGroupPrimitive.Root.displayName\n+\n+const ToggleGroupItem = React.forwardRef<\n+  React.ElementRef<typeof ToggleGroupPrimitive.Item>,\n+  React.ComponentPropsWithoutRef<typeof ToggleGroupPrimitive.Item>\n+>(({ className, children, ...props }, ref) => {\n+  const context = React.useContext(ToggleGroupContext)\n+\n+  return (\n+    <ToggleGroupPrimitive.Item\n+      ref={ref}\n+      className={cn(\n+        'inline-flex items-center justify-center rounded-md text-sm font-medium ring-offset-background transition-colors hover:bg-muted hover:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=on]:bg-accent data-[state=on]:text-accent-foreground',\n+        context.size === 'default' && 'h-10 px-3',\n+        context.size === 'sm' && 'h-8 px-2 text-xs',\n+        context.size === 'lg' && 'h-11 px-5',\n+        className\n+      )}\n+      {...props}\n+    >\n+      {children}\n+    </ToggleGroupPrimitive.Item>\n+  )\n+})\n+\n+ToggleGroupItem.displayName = ToggleGroupPrimitive.Item.displayName\n+\n+export { ToggleGroup, ToggleGroupItem }"
        },
        {
            "sha": "17202049f73c61d9835b76155a919a3515f1a273",
            "filename": "apps/bundle-analyzer/lib/analyze-data.ts",
            "status": "added",
            "additions": 395,
            "deletions": 0,
            "changes": 395,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Fanalyze-data.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Fanalyze-data.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Flib%2Fanalyze-data.ts?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,395 @@\n+// Type definitions matching the Rust structures from analyze.rs\n+\n+export interface AnalyzeModule {\n+  path: string\n+  depth: number\n+}\n+\n+export interface AnalyzeSource {\n+  parent_source_index: number | null\n+  path: string\n+}\n+\n+export interface AnalyzeChunkPart {\n+  source_index: number\n+  output_file_index: number\n+  size: number\n+}\n+\n+export interface AnalyzeOutputFile {\n+  filename: string\n+}\n+\n+export interface AnalyzeLayer {\n+  name: string\n+}\n+\n+interface EdgesDataReference {\n+  offset: number\n+  length: number\n+}\n+\n+interface AnalyzeDataHeader {\n+  sources: AnalyzeSource[]\n+  chunk_parts: AnalyzeChunkPart[]\n+  output_files: AnalyzeOutputFile[]\n+  output_file_chunk_parts: EdgesDataReference\n+  source_chunk_parts: EdgesDataReference\n+  source_children: EdgesDataReference\n+  source_roots: number[]\n+}\n+\n+interface ModulesDataHeader {\n+  modules: AnalyzeModule[]\n+  module_dependents: EdgesDataReference\n+  async_module_dependents: EdgesDataReference\n+  module_dependencies: EdgesDataReference\n+  async_module_dependencies: EdgesDataReference\n+}\n+\n+/**\n+ * Represents the global modules data that is shared across all routes\n+ */\n+export class ModulesData {\n+  private modulesHeader: ModulesDataHeader\n+  private modulesBinaryData: DataView\n+  private pathToModuleIndex: Map<string, number>\n+\n+  constructor(modulesArrayBuffer: ArrayBuffer) {\n+    // Parse modules.data\n+    const modulesDataView = new DataView(modulesArrayBuffer)\n+    const modulesJsonLength = modulesDataView.getUint32(0, false)\n+    const modulesJsonBytes = new Uint8Array(\n+      modulesArrayBuffer,\n+      4,\n+      modulesJsonLength\n+    )\n+    const modulesJsonString = new TextDecoder('utf-8').decode(modulesJsonBytes)\n+    this.modulesHeader = JSON.parse(modulesJsonString) as ModulesDataHeader\n+    const modulesBinaryOffset = 4 + modulesJsonLength\n+    this.modulesBinaryData = new DataView(\n+      modulesArrayBuffer,\n+      modulesBinaryOffset\n+    )\n+\n+    // Build pathToModuleIndex map\n+    this.pathToModuleIndex = new Map()\n+    for (let i = 0; i < this.modulesHeader.modules.length; i++) {\n+      const module = this.modulesHeader.modules[i]\n+      this.pathToModuleIndex.set(module.path, i)\n+    }\n+  }\n+\n+  module(index: number): AnalyzeModule | undefined {\n+    return this.modulesHeader.modules[index]\n+  }\n+\n+  moduleCount(): number {\n+    return this.modulesHeader.modules.length\n+  }\n+\n+  getModuleIndexFromPath(path: string): number | undefined {\n+    return this.pathToModuleIndex.get(path)\n+  }\n+\n+  // Read edges data for a specific index only\n+  private readEdgesDataAtIndex(\n+    reference: EdgesDataReference,\n+    index: number\n+  ): number[] {\n+    const { offset, length } = reference\n+\n+    if (length === 0) {\n+      return []\n+    }\n+\n+    // Read the number of offset entries (first u32)\n+    const numOffsets = this.modulesBinaryData.getUint32(offset, false)\n+\n+    if (index < 0 || index >= numOffsets) {\n+      return []\n+    }\n+\n+    // Read only the two offsets we need\n+    const offsetsStart = offset + 4\n+    const prevOffset =\n+      index === 0\n+        ? 0\n+        : this.modulesBinaryData.getUint32(\n+            offsetsStart + (index - 1) * 4,\n+            false\n+          )\n+    const currentOffset = this.modulesBinaryData.getUint32(\n+      offsetsStart + index * 4,\n+      false\n+    )\n+\n+    const edgeCount = currentOffset - prevOffset\n+    if (edgeCount === 0) {\n+      return []\n+    }\n+\n+    // Read only the data for this index\n+    const dataStart = offset + 4 + numOffsets * 4\n+    const edges: number[] = []\n+    for (let j = 0; j < edgeCount; j++) {\n+      const edgeValue = this.modulesBinaryData.getUint32(\n+        dataStart + (prevOffset + j) * 4,\n+        false\n+      )\n+      edges.push(edgeValue)\n+    }\n+\n+    return edges\n+  }\n+\n+  moduleDependents(index: number): number[] {\n+    return this.readEdgesDataAtIndex(\n+      this.modulesHeader.module_dependents,\n+      index\n+    )\n+  }\n+\n+  asyncModuleDependents(index: number): number[] {\n+    return this.readEdgesDataAtIndex(\n+      this.modulesHeader.async_module_dependents,\n+      index\n+    )\n+  }\n+\n+  moduleDependencies(index: number): number[] {\n+    return this.readEdgesDataAtIndex(\n+      this.modulesHeader.module_dependencies,\n+      index\n+    )\n+  }\n+\n+  asyncModuleDependencies(index: number): number[] {\n+    return this.readEdgesDataAtIndex(\n+      this.modulesHeader.async_module_dependencies,\n+      index\n+    )\n+  }\n+\n+  getRawModulesHeader(): ModulesDataHeader {\n+    return this.modulesHeader\n+  }\n+}\n+\n+/**\n+ * Represents route-specific analyze data\n+ */\n+export class AnalyzeData {\n+  private analyzeHeader: AnalyzeDataHeader\n+  private analyzeBinaryData: DataView\n+\n+  constructor(analyzeArrayBuffer: ArrayBuffer) {\n+    // Parse analyze.data\n+    const analyzeDataView = new DataView(analyzeArrayBuffer)\n+    const analyzeJsonLength = analyzeDataView.getUint32(0, false)\n+    const analyzeJsonBytes = new Uint8Array(\n+      analyzeArrayBuffer,\n+      4,\n+      analyzeJsonLength\n+    )\n+    const analyzeJsonString = new TextDecoder('utf-8').decode(analyzeJsonBytes)\n+    this.analyzeHeader = JSON.parse(analyzeJsonString) as AnalyzeDataHeader\n+    const analyzeBinaryOffset = 4 + analyzeJsonLength\n+    this.analyzeBinaryData = new DataView(\n+      analyzeArrayBuffer,\n+      analyzeBinaryOffset\n+    )\n+  }\n+\n+  // Accessor methods for header data\n+\n+  source(index: number): AnalyzeSource | undefined {\n+    return this.analyzeHeader.sources[index]\n+  }\n+\n+  sourceCount(): number {\n+    return this.analyzeHeader.sources.length\n+  }\n+\n+  chunkPart(index: number): AnalyzeChunkPart | undefined {\n+    return this.analyzeHeader.chunk_parts[index]\n+  }\n+\n+  chunkPartCount(): number {\n+    return this.analyzeHeader.chunk_parts.length\n+  }\n+\n+  outputFile(index: number): AnalyzeOutputFile | undefined {\n+    return this.analyzeHeader.output_files[index]\n+  }\n+\n+  outputFileCount(): number {\n+    return this.analyzeHeader.output_files.length\n+  }\n+\n+  sourceRoots(): number[] {\n+    return this.analyzeHeader.source_roots\n+  }\n+\n+  // Methods to read edges data from the binary section\n+\n+  // Read edges data for a specific index only\n+  private readEdgesDataAtIndex(\n+    reference: EdgesDataReference,\n+    index: number\n+  ): number[] {\n+    const { offset, length } = reference\n+\n+    if (length === 0) {\n+      return []\n+    }\n+\n+    // Read the number of offset entries (first u32)\n+    const numOffsets = this.analyzeBinaryData.getUint32(offset, false)\n+\n+    if (index < 0 || index >= numOffsets) {\n+      return []\n+    }\n+\n+    // Read only the two offsets we need\n+    const offsetsStart = offset + 4\n+    const prevOffset =\n+      index === 0\n+        ? 0\n+        : this.analyzeBinaryData.getUint32(\n+            offsetsStart + (index - 1) * 4,\n+            false\n+          )\n+    const currentOffset = this.analyzeBinaryData.getUint32(\n+      offsetsStart + index * 4,\n+      false\n+    )\n+\n+    const edgeCount = currentOffset - prevOffset\n+    if (edgeCount === 0) {\n+      return []\n+    }\n+\n+    // Read only the data for this index\n+    const dataStart = offset + 4 + numOffsets * 4\n+    const edges: number[] = []\n+    for (let j = 0; j < edgeCount; j++) {\n+      const edgeValue = this.analyzeBinaryData.getUint32(\n+        dataStart + (prevOffset + j) * 4,\n+        false\n+      )\n+      edges.push(edgeValue)\n+    }\n+\n+    return edges\n+  }\n+\n+  outputFileChunkParts(index: number): number[] {\n+    return this.readEdgesDataAtIndex(\n+      this.analyzeHeader.output_file_chunk_parts,\n+      index\n+    )\n+  }\n+\n+  sourceChunkParts(index: number): number[] {\n+    return this.readEdgesDataAtIndex(\n+      this.analyzeHeader.source_chunk_parts,\n+      index\n+    )\n+  }\n+\n+  sourceChildren(index: number): number[] {\n+    return this.readEdgesDataAtIndex(this.analyzeHeader.source_children, index)\n+  }\n+\n+  // Utility method to get the full path of a source by walking up the parent chain\n+  getFullSourcePath(index: number): string {\n+    const source = this.source(index)\n+    if (!source) return ''\n+\n+    if (source.parent_source_index === null) {\n+      return source.path\n+    }\n+\n+    const parentPath = this.getFullSourcePath(source.parent_source_index)\n+    return parentPath + source.path\n+  }\n+\n+  getSourceOutputSize(index: number): number {\n+    const chunkParts = this.sourceChunkParts(index)\n+    let totalSize = 0\n+    for (const chunkPartIndex of chunkParts) {\n+      const chunkPart = this.chunkPart(chunkPartIndex)\n+      if (chunkPart) {\n+        totalSize += chunkPart.size\n+      }\n+    }\n+    return totalSize\n+  }\n+\n+  sourceChunks(index: number): string[] {\n+    const chunkParts = this.sourceChunkParts(index)\n+    const uniqueChunks = new Set<string>()\n+\n+    for (const chunkPartIndex of chunkParts) {\n+      const chunkPart = this.chunkPart(chunkPartIndex)\n+      if (chunkPart) {\n+        const outputFile = this.outputFile(chunkPart.output_file_index)\n+        if (outputFile) {\n+          uniqueChunks.add(outputFile.filename)\n+        }\n+      }\n+    }\n+\n+    return Array.from(uniqueChunks).sort()\n+  }\n+\n+  getSourceFlags(index: number): {\n+    client: boolean\n+    server: boolean\n+    traced: boolean\n+    js: boolean\n+    css: boolean\n+    json: boolean\n+    asset: boolean\n+  } {\n+    let client = false\n+    let server = false\n+    let traced = false\n+    let js = false\n+    let css = false\n+    let json = false\n+    let asset = false\n+\n+    const chunkParts = this.sourceChunkParts(index)\n+    for (const chunkPartIndex of chunkParts) {\n+      const chunkPart = this.chunkPart(chunkPartIndex)\n+      if (!chunkPart) continue\n+      const outputFile = this.outputFile(chunkPart.output_file_index)\n+      if (!outputFile) continue\n+      if (outputFile.filename.startsWith('[client-fs]/')) {\n+        client = true\n+      } else if (outputFile.filename.startsWith('[project]/')) {\n+        traced = true\n+      } else {\n+        server = true\n+      }\n+      if (outputFile.filename.endsWith('.js')) {\n+        js = true\n+      } else if (outputFile.filename.endsWith('.css')) {\n+        css = true\n+      } else if (outputFile.filename.endsWith('.json')) {\n+        json = true\n+      } else {\n+        asset = true\n+      }\n+    }\n+\n+    return { client, server, traced, js, css, json, asset }\n+  }\n+\n+  // Get the raw header for debugging\n+  getRawAnalyzeHeader(): AnalyzeDataHeader {\n+    return this.analyzeHeader\n+  }\n+}"
        },
        {
            "sha": "3e6c99ce636945557006781a7d000c51e9ef2b0f",
            "filename": "apps/bundle-analyzer/lib/layout-treemap.ts",
            "status": "added",
            "additions": 121,
            "deletions": 0,
            "changes": 121,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Flayout-treemap.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Flayout-treemap.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Flib%2Flayout-treemap.ts?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,121 @@\n+import type { LayoutRect } from './treemap-layout'\n+\n+export function layoutTreemap(sizes: number[], rect: LayoutRect): LayoutRect[] {\n+  if (sizes.length === 0) return []\n+  if (sizes.length === 1) return [rect]\n+\n+  const totalSize = sizes.reduce((a, b) => a + b, 0)\n+  const normalizedSizes = sizes.map(\n+    (s) => (s / totalSize) * rect.width * rect.height\n+  )\n+\n+  const result: LayoutRect[] = []\n+  let remaining = [...normalizedSizes]\n+  let currentRect = { ...rect }\n+  let totalRemaining = remaining.reduce((a, b) => a + b, 0)\n+\n+  while (remaining.length > 1) {\n+    // Decide orientation: vertical if wider, horizontal if taller\n+    const vertical = currentRect.width >= currentRect.height\n+\n+    // Pick items until sum > total / count\n+    const picked: number[] = []\n+    let sum = 0\n+\n+    for (const size of remaining) {\n+      picked.push(size)\n+      sum += size\n+\n+      if (vertical) {\n+        const width = (currentRect.width * sum) / totalRemaining\n+        if (width > (currentRect.height / picked.length) * 0.9) {\n+          break\n+        }\n+      } else {\n+        const height = (currentRect.height * sum) / totalRemaining\n+        if (height > (currentRect.width / picked.length) * 0.9) {\n+          break\n+        }\n+      }\n+    }\n+\n+    // Ensure at least one item is picked\n+    if (picked.length === 0) {\n+      picked.push(remaining[0])\n+      sum = remaining[0]\n+    }\n+\n+    // Calculate the space used by this row/column\n+    const spaceRatio = sum / totalRemaining\n+\n+    totalRemaining -= sum\n+\n+    if (vertical) {\n+      // Items stacked vertically, filling full width\n+      const rowWidth = Math.round(spaceRatio * currentRect.width)\n+      let offsetY = 0\n+\n+      for (let i = 0; i < picked.length; i++) {\n+        const size = picked[i]\n+        const itemHeight =\n+          i === picked.length - 1\n+            ? Math.round(currentRect.height - offsetY)\n+            : Math.round((size / sum) * currentRect.height)\n+\n+        result.push({\n+          x: Math.round(currentRect.x),\n+          y: Math.round(currentRect.y + offsetY),\n+          width: rowWidth,\n+          height: itemHeight,\n+        })\n+        offsetY += itemHeight\n+      }\n+\n+      // Update remaining rectangle\n+      currentRect = {\n+        x: Math.round(currentRect.x + rowWidth),\n+        y: Math.round(currentRect.y),\n+        width: Math.round(currentRect.width - rowWidth),\n+        height: Math.round(currentRect.height),\n+      }\n+    } else {\n+      // Items placed horizontally, filling full height\n+      const rowHeight = Math.round(spaceRatio * currentRect.height)\n+      let offsetX = 0\n+\n+      for (let i = 0; i < picked.length; i++) {\n+        const size = picked[i]\n+        const itemWidth =\n+          i === picked.length - 1\n+            ? Math.round(currentRect.width - offsetX)\n+            : Math.round((size / sum) * currentRect.width)\n+\n+        result.push({\n+          x: Math.round(currentRect.x + offsetX),\n+          y: Math.round(currentRect.y),\n+          width: itemWidth,\n+          height: rowHeight,\n+        })\n+        offsetX += itemWidth\n+      }\n+\n+      // Update remaining rectangle\n+      currentRect = {\n+        x: Math.round(currentRect.x),\n+        y: Math.round(currentRect.y + rowHeight),\n+        width: Math.round(currentRect.width),\n+        height: Math.round(currentRect.height - rowHeight),\n+      }\n+    }\n+\n+    // Remove picked items from remaining\n+    remaining = remaining.slice(picked.length)\n+  }\n+\n+  // Last item fills remaining space\n+  if (remaining.length === 1) {\n+    result.push(currentRect)\n+  }\n+\n+  return result\n+}"
        },
        {
            "sha": "29a3a0e8b37a6abb5d6964fd668280562eb460ca",
            "filename": "apps/bundle-analyzer/lib/treemap-layout.ts",
            "status": "added",
            "additions": 265,
            "deletions": 0,
            "changes": 265,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Ftreemap-layout.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Ftreemap-layout.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Flib%2Ftreemap-layout.ts?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,265 @@\n+import type { AnalyzeData } from './analyze-data'\n+import { layoutTreemap } from './layout-treemap'\n+\n+export interface LayoutRect {\n+  x: number\n+  y: number\n+  width: number\n+  height: number\n+}\n+\n+export interface LayoutNodeInfo {\n+  name: string\n+  server?: boolean\n+  client?: boolean\n+}\n+\n+export interface LayoutNode extends LayoutNodeInfo {\n+  size: number\n+  rect: LayoutRect\n+  type: 'file' | 'directory' | 'collapsed-directory'\n+  titleBarHeight?: number\n+  children?: LayoutNode[]\n+  itemCount?: number\n+  traced?: boolean\n+  js?: boolean\n+  css?: boolean\n+  json?: boolean\n+  asset?: boolean\n+  sourceIndex?: number // Track which source this node represents\n+}\n+\n+interface SourceMetadata {\n+  filtered: boolean\n+  totalSize: number\n+}\n+\n+function precomputeSourceMetadata(\n+  analyzeData: AnalyzeData,\n+  filterSource?: (sourceIndex: number) => boolean\n+): SourceMetadata[] {\n+  const sourceCount = analyzeData.sourceCount()\n+  const metadata: SourceMetadata[] = new Array(sourceCount)\n+\n+  // Initialize all entries\n+  for (let i = 0; i < sourceCount; i++) {\n+    metadata[i] = { filtered: true, totalSize: 0 }\n+  }\n+\n+  // Bottom-up pass: compute leaf node data\n+  for (let i = sourceCount - 1; i >= 0; i--) {\n+    const children = analyzeData.sourceChildren(i)\n+    const ownSize = analyzeData.getSourceOutputSize(i)\n+\n+    if (children.length === 0) {\n+      // Leaf node (file)\n+      metadata[i].totalSize = ownSize\n+      metadata[i].filtered = filterSource ? !filterSource(i) : false\n+    } else {\n+      // Directory - initialize with own size\n+      metadata[i].totalSize = ownSize\n+    }\n+  }\n+\n+  // Top-down pass: aggregate child sizes and filtered status for directories\n+  function processDirectory(idx: number) {\n+    const children = analyzeData.sourceChildren(idx)\n+    if (children.length === 0) return // Already processed as leaf\n+\n+    let totalSize = metadata[idx].totalSize // Start with own size\n+    let hasVisibleChild = false\n+\n+    for (const childIdx of children) {\n+      processDirectory(childIdx) // Process child first\n+      if (!metadata[childIdx].filtered) {\n+        // Only add size of visible (non-filtered) children\n+        totalSize += metadata[childIdx].totalSize\n+        hasVisibleChild = true\n+      }\n+    }\n+\n+    metadata[idx].totalSize = totalSize\n+    metadata[idx].filtered = !hasVisibleChild // Directory filtered if no visible children\n+  }\n+\n+  // Process from root sources\n+  const roots = analyzeData.sourceRoots()\n+  for (const rootIdx of roots) {\n+    processDirectory(rootIdx)\n+  }\n+\n+  return metadata\n+}\n+\n+// Internal function that uses precomputed metadata\n+function computeTreemapLayoutFromAnalyzeInternal(\n+  analyzeData: AnalyzeData,\n+  sourceIndex: number,\n+  foldedPath: string,\n+  rect: LayoutRect,\n+  metadata: SourceMetadata[],\n+  filterSource?: (sourceIndex: number) => boolean\n+): LayoutNode {\n+  const source = analyzeData.source(sourceIndex)\n+  if (!source) {\n+    throw new Error(`Source at index ${sourceIndex} not found`)\n+  }\n+\n+  const isDirectory = source.path.endsWith('/') || !source.path\n+\n+  // Get children sources\n+  const childrenIndices = analyzeData.sourceChildren(sourceIndex)\n+\n+  // Fold single-child directories\n+  if (\n+    childrenIndices.length === 1 &&\n+    isDirectory &&\n+    (foldedPath + source.path).length <= 40\n+  ) {\n+    const childIndex = childrenIndices[0]\n+    const child = analyzeData.source(childIndex)\n+    if (child?.path.endsWith('/')) {\n+      return computeTreemapLayoutFromAnalyzeInternal(\n+        analyzeData,\n+        childIndex,\n+        foldedPath + source.path,\n+        rect,\n+        metadata,\n+        filterSource\n+      )\n+    }\n+  }\n+\n+  // Use precomputed size\n+  const totalSize = metadata[sourceIndex].totalSize\n+\n+  // If this is a file (no children), create a file node\n+  if (!isDirectory || childrenIndices.length === 0) {\n+    return {\n+      name: source.path,\n+      size: totalSize,\n+      type: 'file',\n+      rect,\n+      sourceIndex,\n+      ...analyzeData.getSourceFlags(sourceIndex),\n+    }\n+  }\n+\n+  // This is a directory with children\n+  const titleBarHeight = Math.round(\n+    Math.max(12, Math.min(24, rect.height * 0.1))\n+  )\n+  const isCollapsed = rect.height < 30\n+\n+  const contentRect: LayoutRect = {\n+    x: Math.round(rect.x),\n+    y: Math.round(rect.y + titleBarHeight),\n+    width: Math.max(0, Math.round(rect.width - 2)),\n+    height: Math.max(0, Math.round(rect.height - titleBarHeight - 2)),\n+  }\n+\n+  if (isCollapsed) {\n+    // Count all descendant files\n+    function countDescendants(idx: number): number {\n+      const children = analyzeData.sourceChildren(idx)\n+      if (children.length === 0) return 1\n+      return children.reduce(\n+        (sum, childIdx) => sum + countDescendants(childIdx),\n+        0\n+      )\n+    }\n+\n+    return {\n+      name: foldedPath + source.path,\n+      size: totalSize,\n+      type: 'collapsed-directory',\n+      rect,\n+      titleBarHeight,\n+      itemCount: countDescendants(sourceIndex),\n+      children: [],\n+      sourceIndex,\n+    }\n+  }\n+\n+  // Recursively build children with their sizes\n+  const childrenData: { index: number; size: number }[] = []\n+\n+  for (const childIndex of childrenIndices) {\n+    const childSource = analyzeData.source(childIndex)\n+    if (!childSource) continue\n+\n+    // Use precomputed filter status\n+    if (metadata[childIndex].filtered) {\n+      continue\n+    }\n+\n+    // Use precomputed size\n+    const childSize = metadata[childIndex].totalSize\n+\n+    childrenData.push({\n+      index: childIndex,\n+      size: childSize || 1, // Fallback to 1 for visibility\n+    })\n+  }\n+\n+  if (childrenData.length === 0) {\n+    return {\n+      name: foldedPath + source.path,\n+      size: totalSize,\n+      type: 'directory',\n+      rect,\n+      titleBarHeight,\n+      children: [],\n+      sourceIndex,\n+    }\n+  }\n+\n+  // Sort by size (descending)\n+  childrenData.sort((a, b) => b.size - a.size)\n+\n+  // Compute layout\n+  const sizes = childrenData.map((c) => c.size)\n+  const childRects = layoutTreemap(sizes, contentRect)\n+\n+  const layoutChildren: LayoutNode[] = childrenData.map((child, i) =>\n+    computeTreemapLayoutFromAnalyzeInternal(\n+      analyzeData,\n+      child.index,\n+      '',\n+      childRects[i],\n+      metadata,\n+      filterSource\n+    )\n+  )\n+\n+  return {\n+    name: foldedPath + source.path,\n+    size: totalSize,\n+    type: 'directory',\n+    rect,\n+    titleBarHeight,\n+    children: layoutChildren,\n+    sourceIndex,\n+  }\n+}\n+\n+// Public function that precomputes metadata and calls internal function\n+export function computeTreemapLayoutFromAnalyze(\n+  analyzeData: AnalyzeData,\n+  sourceIndex: number,\n+  rect: LayoutRect,\n+  filterSource?: (sourceIndex: number) => boolean\n+): LayoutNode {\n+  // Precompute metadata once for entire tree\n+  const metadata = precomputeSourceMetadata(analyzeData, filterSource)\n+\n+  // Use internal function with precomputed metadata\n+  return computeTreemapLayoutFromAnalyzeInternal(\n+    analyzeData,\n+    sourceIndex,\n+    '',\n+    rect,\n+    metadata,\n+    filterSource\n+  )\n+}"
        },
        {
            "sha": "cb1efb0df7f25d6117510873c016a87f49bd7753",
            "filename": "apps/bundle-analyzer/lib/types.ts",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Flib%2Ftypes.ts?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,35 @@\n+export interface FileNode {\n+  id: number\n+  name: string\n+  type: 'file'\n+  size: number\n+  outputType: 'code' | 'css' | 'asset'\n+  server: boolean\n+  client: boolean\n+  dependencies: number[]\n+  dependents: number[]\n+}\n+\n+export interface DirectoryNode {\n+  id: number\n+  name: string\n+  type: 'directory'\n+  children: TreeNode[]\n+  size?: number\n+}\n+\n+export type TreeNode = FileNode | DirectoryNode\n+\n+interface Route {\n+  page: string\n+  regex: string\n+  routeKeys?: Record<string, string>\n+  namedRegex?: string\n+}\n+\n+export interface RouteManifest {\n+  version: number\n+  pages: Record<string, string>\n+  staticRoutes: Array<Route>\n+  dynamicRoutes: Array<Route>\n+}"
        },
        {
            "sha": "879fcef2e26ea527ea84187b82a565146276c87b",
            "filename": "apps/bundle-analyzer/lib/utils.ts",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Flib%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Flib%2Futils.ts?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,10 @@\n+import { type ClassValue, clsx } from 'clsx'\n+import { twMerge } from 'tailwind-merge'\n+\n+export function cn(...inputs: ClassValue[]) {\n+  return twMerge(clsx(inputs))\n+}\n+\n+export function jsonFetcher<T>(url: string): Promise<T> {\n+  return fetch(url).then((res) => res.json())\n+}"
        },
        {
            "sha": "c4e7c0ebef49ba97427bd79a5d812c9f18be248c",
            "filename": "apps/bundle-analyzer/next-env.d.ts",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fnext-env.d.ts?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,6 @@\n+/// <reference types=\"next\" />\n+/// <reference types=\"next/image-types/global\" />\n+import './.next/types/routes.d.ts'\n+\n+// NOTE: This file should not be edited\n+// see https://nextjs.org/docs/app/api-reference/config/typescript for more information."
        },
        {
            "sha": "a04884622e9e3f3e7902d7ba88d6825daf621839",
            "filename": "apps/bundle-analyzer/next.config.mjs",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fnext.config.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fnext.config.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fnext.config.mjs?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,7 @@\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  output: 'export',\n+  distDir: 'dist',\n+}\n+\n+export default nextConfig"
        },
        {
            "sha": "dbba31a93006e37d361d181361bb1ad20806fc4c",
            "filename": "apps/bundle-analyzer/package.json",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fpackage.json?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,41 @@\n+{\n+  \"name\": \"@next/bundle-analyzer-ui\",\n+  \"version\": \"16.0.2-canary.16\",\n+  \"private\": true,\n+  \"scripts\": {\n+    \"build\": \"next build --no-mangling\",\n+    \"dev\": \"next dev\",\n+    \"lint\": \"eslint .\",\n+    \"start\": \"next start\"\n+  },\n+  \"dependencies\": {\n+    \"@radix-ui/react-dialog\": \"1.1.4\",\n+    \"@radix-ui/react-popover\": \"1.1.4\",\n+    \"@radix-ui/react-slot\": \"1.1.1\",\n+    \"@radix-ui/react-toggle-group\": \"1.1.1\",\n+    \"autoprefixer\": \"^10.4.20\",\n+    \"class-variance-authority\": \"^0.7.1\",\n+    \"clsx\": \"^2.1.1\",\n+    \"cmdk\": \"1.0.4\",\n+    \"lucide-react\": \"^0.454.0\",\n+    \"next\": \"16.0.1\",\n+    \"next-themes\": \"^0.4.6\",\n+    \"polished\": \"^4.3.1\",\n+    \"react\": \"19.2.0\",\n+    \"react-dom\": \"19.2.0\",\n+    \"swr\": \"^2.2.4\",\n+    \"tailwind-merge\": \"^2.5.5\",\n+    \"tailwindcss-animate\": \"^1.0.7\"\n+  },\n+  \"devDependencies\": {\n+    \"@tailwindcss/postcss\": \"^4.1.9\",\n+    \"@types/node\": \"^22\",\n+    \"@types/react\": \"^18\",\n+    \"@types/react-dom\": \"^18\",\n+    \"inliner\": \"1.13.1\",\n+    \"postcss\": \"^8.5\",\n+    \"tailwindcss\": \"^4.1.9\",\n+    \"tw-animate-css\": \"1.3.3\",\n+    \"typescript\": \"^5\"\n+  }\n+}"
        },
        {
            "sha": "a869506ee48c89838ee770863c5d99ba97eeb930",
            "filename": "apps/bundle-analyzer/postcss.config.mjs",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fpostcss.config.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fpostcss.config.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fpostcss.config.mjs?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,8 @@\n+/** @type {import('postcss-load-config').Config} */\n+const config = {\n+  plugins: {\n+    '@tailwindcss/postcss': {},\n+  },\n+}\n+\n+export default config"
        },
        {
            "sha": "c3272f8b358bec9ce4120a3f1b8e64c03073f6dc",
            "filename": "apps/bundle-analyzer/styles/globals.css",
            "status": "added",
            "additions": 80,
            "deletions": 0,
            "changes": 80,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fstyles%2Fglobals.css",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Fstyles%2Fglobals.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fstyles%2Fglobals.css?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,80 @@\n+@import 'tailwindcss';\n+@import 'tw-animate-css';\n+\n+@custom-variant dark (&:is(.dark *));\n+\n+:root {\n+  --background: oklch(1 0 0);\n+  --foreground: oklch(0.145 0 0);\n+  --popover: oklch(1 0 0);\n+  --popover-foreground: oklch(0.145 0 0);\n+  --primary: oklch(0.205 0 0);\n+  --primary-foreground: oklch(0.985 0 0);\n+  --secondary: oklch(0.97 0 0);\n+  --secondary-foreground: oklch(0.205 0 0);\n+  --muted: oklch(0.97 0 0);\n+  --muted-foreground: oklch(0.556 0 0);\n+  --accent: oklch(0.97 0 0);\n+  --accent-foreground: oklch(0.205 0 0);\n+  --destructive: oklch(0.577 0.245 27.325);\n+  --destructive-foreground: oklch(0.577 0.245 27.325);\n+  --border: oklch(0.922 0 0);\n+  --input: oklch(0.922 0 0);\n+  --ring: oklch(0.708 0 0);\n+  --radius: 0.625rem;\n+}\n+\n+.dark {\n+  --background: oklch(0.145 0 0);\n+  --foreground: oklch(0.985 0 0);\n+  --popover: oklch(0.145 0 0);\n+  --popover-foreground: oklch(0.985 0 0);\n+  --primary: oklch(0.985 0 0);\n+  --primary-foreground: oklch(0.205 0 0);\n+  --secondary: oklch(0.269 0 0);\n+  --secondary-foreground: oklch(0.985 0 0);\n+  --muted: oklch(0.269 0 0);\n+  --muted-foreground: oklch(0.708 0 0);\n+  --accent: oklch(0.269 0 0);\n+  --accent-foreground: oklch(0.985 0 0);\n+  --destructive: oklch(0.396 0.141 25.723);\n+  --destructive-foreground: oklch(0.637 0.237 25.331);\n+  --border: oklch(0.269 0 0);\n+  --input: oklch(0.269 0 0);\n+  --ring: oklch(0.439 0 0);\n+}\n+\n+@theme inline {\n+  --font-sans: 'Geist', 'Geist Fallback';\n+  --font-mono: 'Geist Mono', 'Geist Mono Fallback';\n+  --color-background: var(--background);\n+  --color-foreground: var(--foreground);\n+  --color-popover: var(--popover);\n+  --color-popover-foreground: var(--popover-foreground);\n+  --color-primary: var(--primary);\n+  --color-primary-foreground: var(--primary-foreground);\n+  --color-secondary: var(--secondary);\n+  --color-secondary-foreground: var(--secondary-foreground);\n+  --color-muted: var(--muted);\n+  --color-muted-foreground: var(--muted-foreground);\n+  --color-accent: var(--accent);\n+  --color-accent-foreground: var(--accent-foreground);\n+  --color-destructive: var(--destructive);\n+  --color-destructive-foreground: var(--destructive-foreground);\n+  --color-border: var(--border);\n+  --color-input: var(--input);\n+  --color-ring: var(--ring);\n+  --radius-sm: calc(var(--radius) - 4px);\n+  --radius-md: calc(var(--radius) - 2px);\n+  --radius-lg: var(--radius);\n+  --radius-xl: calc(var(--radius) + 4px);\n+}\n+\n+@layer base {\n+  * {\n+    @apply border-border outline-ring/50;\n+  }\n+  body {\n+    @apply bg-background text-foreground;\n+  }\n+}"
        },
        {
            "sha": "d3a3fd16c89990bb94c74f13ee4e3b7f08cf72cb",
            "filename": "apps/bundle-analyzer/tsconfig.json",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/apps%2Fbundle-analyzer%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Ftsconfig.json?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -0,0 +1,33 @@\n+{\n+  \"compilerOptions\": {\n+    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n+    \"allowJs\": true,\n+    \"target\": \"ES6\",\n+    \"skipLibCheck\": true,\n+    \"strict\": true,\n+    \"noEmit\": true,\n+    \"esModuleInterop\": true,\n+    \"module\": \"esnext\",\n+    \"moduleResolution\": \"bundler\",\n+    \"resolveJsonModule\": true,\n+    \"isolatedModules\": true,\n+    \"jsx\": \"react-jsx\",\n+    \"incremental\": true,\n+    \"plugins\": [\n+      {\n+        \"name\": \"next\"\n+      }\n+    ],\n+    \"paths\": {\n+      \"@/*\": [\"./*\"]\n+    }\n+  },\n+  \"include\": [\n+    \"next-env.d.ts\",\n+    \"**/*.ts\",\n+    \"**/*.tsx\",\n+    \".next/types/**/*.ts\",\n+    \".next/dev/types/**/*.ts\"\n+  ],\n+  \"exclude\": [\"node_modules\"]\n+}"
        },
        {
            "sha": "0fc3f691acb293fa622c7e30e79c453d76941329",
            "filename": "crates/napi/src/next_api/analyze.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/crates%2Fnapi%2Fsrc%2Fnext_api%2Fanalyze.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/crates%2Fnapi%2Fsrc%2Fnext_api%2Fanalyze.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2Fsrc%2Fnext_api%2Fanalyze.rs?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -64,7 +64,7 @@ async fn get_analyze_data_operation(\n         .node_root()\n         .owned()\n         .await?\n-        .join(\"diagnostics/analyze\")?;\n+        .join(\"diagnostics/analyze/data\")?;\n     let whole_app_module_graphs = project.whole_app_module_graphs();\n     let analyze_output_root = &analyze_output_root;\n     let analyze_data = project"
        },
        {
            "sha": "d85943f4a9ad18ee9ea55724e726aad5fa6eb0ca",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 25,
            "deletions": 1,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -223,7 +223,7 @@ import {\n   sortPages,\n   sortSortableRouteObjects,\n } from '../shared/lib/router/utils/sortable-routes'\n-import { mkdir } from 'fs/promises'\n+import { cp, mkdir, writeFile } from 'fs/promises'\n import {\n   createRouteTypesManifest,\n   writeRouteTypesManifest,\n@@ -4321,6 +4321,30 @@ export default async function build(\n         .traceAsyncFn(() => telemetry.flush())\n \n       await shutdownPromise\n+\n+      if (NextBuildContext.analyze) {\n+        await cp(\n+          path.join(__dirname, '../bundle-analyzer'),\n+          path.join(dir, '.next/diagnostics/analyze'),\n+          { recursive: true }\n+        )\n+\n+        await mkdir(path.join(dir, '.next/diagnostics/analyze/data'), {\n+          recursive: true,\n+        })\n+\n+        // Write an index of routes for the route picker\n+        await writeFile(\n+          path.join(dir, '.next/diagnostics/analyze/data/routes.json'),\n+          JSON.stringify(\n+            routesManifest.dynamicRoutes\n+              .map((r) => r.page)\n+              .concat(routesManifest.staticRoutes.map((r) => r.page)),\n+            null,\n+            2\n+          )\n+        )\n+      }\n     })\n   } catch (e) {\n     const telemetry: Telemetry | undefined = traceGlobals.get('telemetry')"
        },
        {
            "sha": "5a6986e2f9dc072d368e8ada1e36133f9bd7b54b",
            "filename": "packages/next/src/compiled/node-html-parser/index.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/packages%2Fnext%2Fsrc%2Fcompiled%2Fnode-html-parser%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/packages%2Fnext%2Fsrc%2Fcompiled%2Fnode-html-parser%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcompiled%2Fnode-html-parser%2Findex.js?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6"
        },
        {
            "sha": "20e8f07b929366b8f1a7afc94cd429f31112d08c",
            "filename": "packages/next/src/compiled/postcss-preset-env/index.cjs",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/packages%2Fnext%2Fsrc%2Fcompiled%2Fpostcss-preset-env%2Findex.cjs",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/packages%2Fnext%2Fsrc%2Fcompiled%2Fpostcss-preset-env%2Findex.cjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcompiled%2Fpostcss-preset-env%2Findex.cjs?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6"
        },
        {
            "sha": "ea6338bfa14a4d40f4b0d06de619f9fc47002568",
            "filename": "packages/next/taskfile.js",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/packages%2Fnext%2Ftaskfile.js",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/packages%2Fnext%2Ftaskfile.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftaskfile.js?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6",
            "patch": "@@ -260,6 +260,13 @@ export async function copy_vercel_og(task, opts) {\n   )\n }\n \n+export async function copy_bundle_analyzer_ui(task, opts) {\n+  const bundleAnalyzerPath = join(__dirname, '../../apps/bundle-analyzer/dist')\n+  await task\n+    .source(join(bundleAnalyzerPath, '**/*'))\n+    .target('dist/bundle-analyzer')\n+}\n+\n externals['anser'] = 'next/dist/compiled/anser'\n externals['next/dist/compiled/anser'] = 'next/dist/compiled/anser'\n export async function ncc_node_anser(task, opts) {\n@@ -2336,6 +2343,7 @@ export async function next_compile(task, opts) {\n   await task.parallel(\n     [\n       'cli',\n+      'copy_bundle_analyzer_ui',\n       'bin',\n       'server',\n       'server_esm',"
        },
        {
            "sha": "134f969651c120c6802dea0d1c3695d1d7ba2800",
            "filename": "pnpm-lock.yaml",
            "status": "modified",
            "additions": 1430,
            "deletions": 47,
            "changes": 1477,
            "blob_url": "https://github.com/vercel/next.js/blob/617ead5753f58ce1d948927512fe3ff39a12b5b6/pnpm-lock.yaml",
            "raw_url": "https://github.com/vercel/next.js/raw/617ead5753f58ce1d948927512fe3ff39a12b5b6/pnpm-lock.yaml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/pnpm-lock.yaml?ref=617ead5753f58ce1d948927512fe3ff39a12b5b6"
        }
    ],
    "stats": {
        "total": 5071,
        "additions": 5009,
        "deletions": 62
    }
}