{
    "author": "wentsul",
    "message": "[Testing] Update middleware/next-config tests to include search params (#76354)",
    "sha": "b60bb5e7f7d27a0a7e822843eaf8ce30ee978cea",
    "files": [
        {
            "sha": "65b22bf635fcc71777d321a4ebb07eeff47d92cc",
            "filename": "packages/next/src/experimental/testing/server/config-testing-utils.test.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/b60bb5e7f7d27a0a7e822843eaf8ce30ee978cea/packages%2Fnext%2Fsrc%2Fexperimental%2Ftesting%2Fserver%2Fconfig-testing-utils.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b60bb5e7f7d27a0a7e822843eaf8ce30ee978cea/packages%2Fnext%2Fsrc%2Fexperimental%2Ftesting%2Fserver%2Fconfig-testing-utils.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexperimental%2Ftesting%2Fserver%2Fconfig-testing-utils.test.ts?ref=b60bb5e7f7d27a0a7e822843eaf8ce30ee978cea",
            "patch": "@@ -49,6 +49,27 @@ describe('config-testing-utils', () => {\n       )\n     })\n \n+    it('handles redirect with query params', async () => {\n+      const response = await unstable_getResponseFromNextConfig({\n+        url: 'https://nextjs.org/test/foo',\n+        nextConfig: {\n+          async redirects() {\n+            return [\n+              {\n+                source: '/test/:slug',\n+                destination: '/test2?slug=:slug',\n+                permanent: true,\n+              },\n+            ]\n+          },\n+        },\n+      })\n+      expect(response.status).toEqual(308)\n+      expect(response.headers.get('location')).toEqual(\n+        'https://nextjs.org/test2?slug=foo'\n+      )\n+    })\n+\n     it(\"ignores redirect that doesn't match has\", async () => {\n       const response = await unstable_getResponseFromNextConfig({\n         url: 'https://nextjs.org/test/foo',"
        },
        {
            "sha": "dec3f5f63d7253ac9a4883738f03c49b32e79eb4",
            "filename": "packages/next/src/experimental/testing/server/config-testing-utils.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/b60bb5e7f7d27a0a7e822843eaf8ce30ee978cea/packages%2Fnext%2Fsrc%2Fexperimental%2Ftesting%2Fserver%2Fconfig-testing-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b60bb5e7f7d27a0a7e822843eaf8ce30ee978cea/packages%2Fnext%2Fsrc%2Fexperimental%2Ftesting%2Fserver%2Fconfig-testing-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexperimental%2Ftesting%2Fserver%2Fconfig-testing-utils.ts?ref=b60bb5e7f7d27a0a7e822843eaf8ce30ee978cea",
            "patch": "@@ -18,6 +18,7 @@ import type {\n import type { BaseNextRequest } from '../../../server/base-http'\n import type { Params } from '../../../server/request/params'\n import { constructRequest } from './utils'\n+import { parsedUrlQueryToParams } from '../../../server/route-modules/app-route/helpers/parsed-url-query-to-params'\n \n /**\n  * Tries to match the current request against the provided route. If there is\n@@ -122,8 +123,11 @@ export async function unstable_getResponseFromNextConfig({\n       params,\n       query: parsedUrl.query,\n     })\n+    const searchParams = new URLSearchParams(\n+      parsedUrlQueryToParams(parsedDestination.query) as Record<string, string>\n+    )\n     return new URL(\n-      newUrl,\n+      searchParams.size > 0 ? `${newUrl}?${searchParams.toString()}` : newUrl,\n       parsedDestination.hostname\n         ? `${parsedDestination.protocol}//${parsedDestination.hostname}`\n         : parsedUrl.host"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 26,
        "deletions": 1
    }
}