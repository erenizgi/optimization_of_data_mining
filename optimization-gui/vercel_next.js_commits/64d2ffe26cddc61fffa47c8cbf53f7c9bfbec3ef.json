{
    "author": "sokra",
    "message": "Turbopack: enable nodelay for node.js pool socket (#83942)\n\n### What?\n\nRemoves delays from sending data from and to the worker process.",
    "sha": "64d2ffe26cddc61fffa47c8cbf53f7c9bfbec3ef",
    "files": [
        {
            "sha": "2e4d29781e1c032139ac591d2d1f4abda12a4381",
            "filename": "turbopack/crates/turbopack-node/js/src/ipc/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/64d2ffe26cddc61fffa47c8cbf53f7c9bfbec3ef/turbopack%2Fcrates%2Fturbopack-node%2Fjs%2Fsrc%2Fipc%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/64d2ffe26cddc61fffa47c8cbf53f7c9bfbec3ef/turbopack%2Fcrates%2Fturbopack-node%2Fjs%2Fsrc%2Fipc%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fjs%2Fsrc%2Fipc%2Findex.ts?ref=64d2ffe26cddc61fffa47c8cbf53f7c9bfbec3ef",
            "patch": "@@ -80,6 +80,7 @@ function createIpc<TIncoming, TOutgoing>(\n   let state: State = { type: 'waiting' }\n   let buffer: Buffer = Buffer.alloc(0)\n   socket.once('connect', () => {\n+    socket.setNoDelay(true)\n     socket.on('data', (chunk) => {\n       buffer = Buffer.concat([buffer, chunk])\n "
        },
        {
            "sha": "562173100f170915d4522dac39cc34f4bf6eae8a",
            "filename": "turbopack/crates/turbopack-node/src/pool.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/64d2ffe26cddc61fffa47c8cbf53f7c9bfbec3ef/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Fpool.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/64d2ffe26cddc61fffa47c8cbf53f7c9bfbec3ef/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Fpool.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Fpool.rs?ref=64d2ffe26cddc61fffa47c8cbf53f7c9bfbec3ef",
            "patch": "@@ -431,6 +431,7 @@ impl NodeJsPoolProcess {\n                 bail!(\"timed out waiting for the Node.js process to connect ({timeout:?} timeout)\\nProcess output:\\n{stdout}\\nProcess error output:\\n{stderr}\");\n             },\n         };\n+        connection.set_nodelay(true)?;\n \n         let child_stdout = BufReader::new(child.stdout.take().unwrap());\n         let child_stderr = BufReader::new(child.stderr.take().unwrap());\n@@ -540,6 +541,10 @@ impl NodeJsPoolProcess {\n             .write_all(&packet_data)\n             .await\n             .context(\"writing packet data\")?;\n+        self.connection\n+            .flush()\n+            .await\n+            .context(\"flushing packet data\")?;\n         Ok(())\n     }\n }"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 6,
        "deletions": 0
    }
}