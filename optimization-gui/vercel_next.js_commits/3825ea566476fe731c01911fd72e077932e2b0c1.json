{
    "author": "eps1lon",
    "message": "[test] Add case for import conditions in Pages Router API routes (#81036)\n\nCase was absent from the react-server condition test suite but relevant to double check for an upcoming refactor",
    "sha": "3825ea566476fe731c01911fd72e077932e2b0c1",
    "files": [
        {
            "sha": "2ccbe4656c6078ded72491cf2ee9c5ec20219624",
            "filename": "test/e2e/import-conditions/.gitignore",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/3825ea566476fe731c01911fd72e077932e2b0c1/test%2Fe2e%2Fimport-conditions%2F.gitignore",
            "raw_url": "https://github.com/vercel/next.js/raw/3825ea566476fe731c01911fd72e077932e2b0c1/test%2Fe2e%2Fimport-conditions%2F.gitignore",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fimport-conditions%2F.gitignore?ref=3825ea566476fe731c01911fd72e077932e2b0c1",
            "patch": "@@ -0,0 +1 @@\n+/node_modules/"
        },
        {
            "sha": "becf67b9abf98dfd51aba5b98adbc691fa31b97b",
            "filename": "test/e2e/import-conditions/import-conditions.test.ts",
            "status": "modified",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/3825ea566476fe731c01911fd72e077932e2b0c1/test%2Fe2e%2Fimport-conditions%2Fimport-conditions.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3825ea566476fe731c01911fd72e077932e2b0c1/test%2Fe2e%2Fimport-conditions%2Fimport-conditions.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fimport-conditions%2Fimport-conditions.test.ts?ref=3825ea566476fe731c01911fd72e077932e2b0c1",
            "patch": "@@ -89,6 +89,58 @@ describe('react version', () => {\n     })\n   })\n \n+  it('Pages Router API route with nodejs runtime', async () => {\n+    const response = await next.fetch('/api/node-route')\n+    const middlewareHeaders = {\n+      react: response.headers.get('x-react-condition'),\n+      serverFavoringBrowser: response.headers.get(\n+        'x-server-favoring-browser-condition'\n+      ),\n+      serverFavoringEdge: response.headers.get(\n+        'x-server-favoring-edge-condition'\n+      ),\n+    }\n+    const apiConditions = await response.json()\n+    expect({ apiConditions, middlewareHeaders }).toEqual({\n+      apiConditions: {\n+        react: 'default',\n+        serverFavoringBrowser: 'node',\n+        serverFavoringEdge: 'node',\n+      },\n+      middlewareHeaders: {\n+        react: 'react-server',\n+        serverFavoringBrowser: 'browser',\n+        serverFavoringEdge: 'edge-light',\n+      },\n+    })\n+  })\n+\n+  it('Pages Router API route with edge runtime', async () => {\n+    const response = await next.fetch('/api/edge-route')\n+    const middlewareHeaders = {\n+      react: response.headers.get('x-react-condition'),\n+      serverFavoringBrowser: response.headers.get(\n+        'x-server-favoring-browser-condition'\n+      ),\n+      serverFavoringEdge: response.headers.get(\n+        'x-server-favoring-edge-condition'\n+      ),\n+    }\n+    const apiConditions = await response.json()\n+    expect({ apiConditions, middlewareHeaders }).toEqual({\n+      apiConditions: {\n+        react: 'default',\n+        serverFavoringBrowser: 'browser',\n+        serverFavoringEdge: 'edge-light',\n+      },\n+      middlewareHeaders: {\n+        react: 'react-server',\n+        serverFavoringBrowser: 'browser',\n+        serverFavoringEdge: 'edge-light',\n+      },\n+    })\n+  })\n+\n   it('App Router page headers with edge runtime', async () => {\n     const response = await next.fetch('/app/edge-page')\n "
        },
        {
            "sha": "8cf16dc139b032287a93d0a95f1557e5e8b1dd2a",
            "filename": "test/e2e/import-conditions/pages/api/edge-route.ts",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/3825ea566476fe731c01911fd72e077932e2b0c1/test%2Fe2e%2Fimport-conditions%2Fpages%2Fapi%2Fedge-route.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3825ea566476fe731c01911fd72e077932e2b0c1/test%2Fe2e%2Fimport-conditions%2Fpages%2Fapi%2Fedge-route.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fimport-conditions%2Fpages%2Fapi%2Fedge-route.ts?ref=3825ea566476fe731c01911fd72e077932e2b0c1",
            "patch": "@@ -0,0 +1,15 @@\n+import * as react from 'library-with-exports/react'\n+import * as serverFavoringBrowser from 'library-with-exports/server-favoring-browser'\n+import * as serverFavoringEdge from 'library-with-exports/server-favoring-edge'\n+\n+export const config = {\n+  runtime: 'experimental-edge',\n+}\n+\n+export default function handler() {\n+  return Response.json({\n+    react: react.condition,\n+    serverFavoringBrowser: serverFavoringBrowser.condition,\n+    serverFavoringEdge: serverFavoringEdge.condition,\n+  })\n+}"
        },
        {
            "sha": "2bec7e74f915309311afa2c8e0522b4c550e2677",
            "filename": "test/e2e/import-conditions/pages/api/node-route.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/3825ea566476fe731c01911fd72e077932e2b0c1/test%2Fe2e%2Fimport-conditions%2Fpages%2Fapi%2Fnode-route.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3825ea566476fe731c01911fd72e077932e2b0c1/test%2Fe2e%2Fimport-conditions%2Fpages%2Fapi%2Fnode-route.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fimport-conditions%2Fpages%2Fapi%2Fnode-route.ts?ref=3825ea566476fe731c01911fd72e077932e2b0c1",
            "patch": "@@ -0,0 +1,19 @@\n+import type { NextApiRequest, NextApiResponse } from 'next'\n+import * as react from 'library-with-exports/react'\n+import * as serverFavoringBrowser from 'library-with-exports/server-favoring-browser'\n+import * as serverFavoringEdge from 'library-with-exports/server-favoring-edge'\n+\n+export const config = {\n+  runtime: 'nodejs',\n+}\n+\n+export default function handler(\n+  request: NextApiRequest,\n+  response: NextApiResponse\n+) {\n+  return response.status(200).json({\n+    react: react.condition,\n+    serverFavoringBrowser: serverFavoringBrowser.condition,\n+    serverFavoringEdge: serverFavoringEdge.condition,\n+  })\n+}"
        }
    ],
    "stats": {
        "total": 87,
        "additions": 87,
        "deletions": 0
    }
}