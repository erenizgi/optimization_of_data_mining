{
    "author": "eps1lon",
    "message": "[test] Use unique error messages in `server-source-maps` (#79108)\n\nAllows unambigious assertions on CLI output.\r\nNot that interesting for dev but `next build` will have the logs for all pages in all tests.\r\n\r\nI also made the pages static where possible so that we'll be able to assert on the logged errors during `next build`.",
    "sha": "34039551d2e5f611c0abde31a197d9985918adaf",
    "files": [
        {
            "sha": "bde2d0f5675fb1e884c811236cdcbcb2589a353b",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/app/bad-sourcemap/page.js",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fbad-sourcemap%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fbad-sourcemap%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fbad-sourcemap%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -1,12 +1,10 @@\n // Compile with pnpm tsc test/e2e/app-dir/server-source-maps/fixtures/default/bad-sourcemap/page.js --allowJs --sourceMap --target esnext --outDir test/e2e/app-dir/server-source-maps/fixtures/default/app/bad-sourcemap\n // Then change the `sources` entry in the sourcemap to `[\"custom://[badhost]/app/bad-sourcemap/page.js\"]`\n // tsc compile errors can be ignored\n-import { connection } from 'next/server';\n function logError() {\n-    console.error(new Error('Boom!'));\n+    console.error(new Error('bad-sourcemap'));\n }\n-export default async function Page() {\n-    await connection();\n+export default function Page() {\n     logError();\n     return <p>Hello, Dave!</p>;\n }"
        },
        {
            "sha": "b911a10fb84bef3cb210be62608443ecbfc3fd4d",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/app/bad-sourcemap/page.js.map",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fbad-sourcemap%2Fpage.js.map",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fbad-sourcemap%2Fpage.js.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fbad-sourcemap%2Fpage.js.map?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -6,5 +6,5 @@\n     \"custom://[badhost]/app/bad-sourcemap/page.js\"\n   ],\n   \"names\": [],\n-  \"mappings\": \"AAAA,yNAAyN;AACzN,yGAAyG;AACzG,oCAAoC;AAEpC,OAAO,EAAE,UAAU,EAAE,MAAM,aAAa,CAAA;AAExC,SAAS,QAAQ;IACf,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,OAAO,CAAC,CAAC,CAAA;AACnC,CAAC;AAED,MAAM,CAAC,OAAO,CAAC,KAAK,UAAU,IAAI;IAChC,MAAM,UAAU,EAAE,CAAA;IAClB,QAAQ,EAAE,CAAA;IACV,OAAO,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC,CAAA;AAC5B,CAAC\"\n+  \"mappings\": \"AAAA,yNAAyN;AACzN,yGAAyG;AACzG,oCAAoC;AAEpC,SAAS,QAAQ;IACf,OAAO,CAAC,KAAK,CAAC,IAAI,KAAK,CAAC,eAAe,CAAC,CAAC,CAAA;AAC3C,CAAC;AAED,MAAM,CAAC,OAAO,UAAU,IAAI;IAC1B,QAAQ,EAAE,CAAA;IACV,OAAO,CAAC,CAAC,CAAC,YAAY,EAAE,CAAC,CAAC,CAAA;AAC5B,CAAC\"\n }"
        },
        {
            "sha": "0217f5f10eb710d8f777c510e36fbbd1393302e6",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/app/rsc-error-log-cause/page.js",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log-cause%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log-cause%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log-cause%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -1,13 +1,9 @@\n-import { connection } from 'next/server'\n-\n function logError(cause) {\n-  const error = new Error('Boom', { cause })\n+  const error = new Error('rsc-error-log-cause', { cause })\n   console.error(error)\n }\n \n-export default async function Page() {\n-  await connection()\n-\n+export default function Page() {\n   const error = new Error('Boom')\n   logError(error)\n   return null"
        },
        {
            "sha": "5cd461067c0dd8f71cdac3494172c48e3929ac10",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/app/rsc-error-log-custom-name/page.js",
            "status": "modified",
            "additions": 3,
            "deletions": 7,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log-custom-name%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log-custom-name%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log-custom-name%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -1,14 +1,10 @@\n-import { connection } from 'next/server'\n-\n class UnnamedError extends Error {}\n class NamedError extends Error {\n   name = 'MyError'\n }\n \n-export default async function Page() {\n-  await connection()\n-\n-  console.error(new UnnamedError('Foo'))\n-  console.error(new NamedError('Bar'))\n+export default function Page() {\n+  console.error(new UnnamedError('rsc-error-log-custom-name-Foo'))\n+  console.error(new NamedError('rsc-error-log-custom-name-Bar'))\n   return null\n }"
        },
        {
            "sha": "eccf30c58f0b0fada19716ec534f50e156c4e4f6",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/app/rsc-error-log-ignore-listed/page.js",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log-ignore-listed%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log-ignore-listed%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log-ignore-listed%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -1,18 +1,15 @@\n-import { connection } from 'next/server'\n import { runInternal } from 'internal-pkg'\n import { runInternalSourceMapped } from 'internal-pkg/sourcemapped'\n import { runInternalIgnored } from 'internal-pkg/ignored'\n import { runExternal } from 'external-pkg'\n import { runExternalSourceMapped } from 'external-pkg/sourcemapped'\n \n function logError() {\n-  const error = new Error('Boom')\n+  const error = new Error('rsc-error-log-ignore-listed')\n   console.error(error)\n }\n \n export default async function Page() {\n-  await connection()\n-\n   runInternal(function runWithInternal() {\n     runInternalSourceMapped(function runWithInternalSourceMapped() {\n       runExternal(function runWithExternal() {"
        },
        {
            "sha": "071fef14e089ba288e7aaef71c44aa65ba737539",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/app/rsc-error-log/page.js",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Frsc-error-log%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -1,14 +1,11 @@\n import { someClass } from './styles.module.css'\n-import { connection } from 'next/server'\n \n function logError() {\n-  const error = new Error('Boom')\n+  const error = new Error('rsc-error-log')\n   console.error(error)\n }\n \n-export default async function Page() {\n-  await connection()\n-\n+export default function Page() {\n   logError()\n   return <p className={someClass}>Hello, Dave!</p>\n }"
        },
        {
            "sha": "0c6c69514c4815bcb609741128912747d412e162",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/app/ssr-error-log-ignore-listed/page.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fssr-error-log-ignore-listed%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fssr-error-log-ignore-listed%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fssr-error-log-ignore-listed%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -6,7 +6,7 @@ import { runExternal } from 'external-pkg'\n import { runExternalSourceMapped } from 'external-pkg/sourcemapped'\n \n function logError() {\n-  const error = new Error('Boom')\n+  const error = new Error('ssr-error-log-ignore-listed')\n   console.error(error)\n }\n "
        },
        {
            "sha": "b021a4cc8f25a9fd21576272e4a14aab3d330005",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/app/ssr-throw/Thrower.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fssr-throw%2FThrower.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fssr-throw%2FThrower.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fapp%2Fssr-throw%2FThrower.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -1,7 +1,7 @@\n 'use client'\n \n function throwError() {\n-  throw new Error('Boom')\n+  throw new Error('ssr-throw')\n }\n \n export function Thrower() {"
        },
        {
            "sha": "3afe4355df750c0e51ff8051280d548ac26dcb17",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/default/bad-sourcemap/page.js",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fbad-sourcemap%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fbad-sourcemap%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fdefault%2Fbad-sourcemap%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -2,14 +2,11 @@\n // Then change the `sources` entry in the sourcemap to `[\"custom://[badhost]/app/bad-sourcemap/page.js\"]`\n // tsc compile errors can be ignored\n \n-import { connection } from 'next/server'\n-\n function logError() {\n-  console.error(new Error('Boom!'))\n+  console.error(new Error('bad-sourcemap'))\n }\n \n-export default async function Page() {\n-  await connection()\n+export default function Page() {\n   logError()\n   return <p>Hello, Dave!</p>\n }"
        },
        {
            "sha": "641fb161fd4343644d3d58119a88f403d353ac22",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/edge/app/rsc-error-log/page.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fedge%2Fapp%2Frsc-error-log%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fedge%2Fapp%2Frsc-error-log%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fedge%2Fapp%2Frsc-error-log%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -1,5 +1,5 @@\n function logError() {\n-  console.error(new Error('Boom'))\n+  console.error(new Error('rsc-error-log'))\n }\n \n export default function Page() {"
        },
        {
            "sha": "e0f3e50abcf01810782ec6e41fdab5d62394e1f4",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/edge/app/rsc-throw/page.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fedge%2Fapp%2Frsc-throw%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fedge%2Fapp%2Frsc-throw%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fedge%2Fapp%2Frsc-throw%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -1,5 +1,5 @@\n function throwError() {\n-  throw new Error('Boom')\n+  throw new Error('rsc-throw')\n }\n \n export default function Page() {"
        },
        {
            "sha": "37860879d107833576e654b6969bc5e31af39f11",
            "filename": "test/e2e/app-dir/server-source-maps/fixtures/edge/app/ssr-throw/page.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fedge%2Fapp%2Fssr-throw%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fedge%2Fapp%2Fssr-throw%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Ffixtures%2Fedge%2Fapp%2Fssr-throw%2Fpage.js?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -1,7 +1,7 @@\n 'use client'\n \n function throwError() {\n-  throw new Error('Boom')\n+  throw new Error('ssr-throw')\n }\n \n export default function Page() {"
        },
        {
            "sha": "f8ec2192a75e0ababa6cafa9e5c2cd70ba75e967",
            "filename": "test/e2e/app-dir/server-source-maps/server-source-maps-edge.test.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps-edge.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps-edge.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps-edge.test.ts?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -24,14 +24,16 @@ describe('app-dir - server source maps edge runtime', () => {\n \n     if (isNextDev) {\n       await retry(() => {\n-        expect(next.cliOutput.slice(outputIndex)).toContain('Error: Boom')\n+        expect(next.cliOutput.slice(outputIndex)).toContain(\n+          'Error: rsc-error-log'\n+        )\n       })\n       expect(normalizeCliOutput(next.cliOutput.slice(outputIndex))).toContain(\n-        '\\nError: Boom' +\n+        '\\nError: rsc-error-log' +\n           '\\n    at logError (app/rsc-error-log/page.js:2:16)' +\n           '\\n    at Page (app/rsc-error-log/page.js:6:2)' +\n           '\\n  1 | function logError() {' +\n-          \"\\n> 2 |   console.error(new Error('Boom'))\" +\n+          \"\\n> 2 |   console.error(new Error('rsc-error-log'))\" +\n           '\\n    |                ^' +\n           '\\n  3 | }' +\n           '\\n  4 |' +\n@@ -50,17 +52,17 @@ describe('app-dir - server source maps edge runtime', () => {\n \n     if (isNextDev) {\n       await retry(() => {\n-        expect(next.cliOutput.slice(outputIndex)).toContain('Error: Boom')\n+        expect(next.cliOutput.slice(outputIndex)).toContain('Error: ssr-throw')\n       })\n \n       const cliOutput = stripAnsi(next.cliOutput.slice(outputIndex))\n       expect(cliOutput).toContain(\n-        '\\n ⨯ Error: Boom' +\n+        '\\n ⨯ Error: ssr-throw' +\n           '\\n    at throwError (app/ssr-throw/page.js:4:8)' +\n           '\\n    at Page (app/ssr-throw/page.js:8:2)' +\n           '\\n  2 |' +\n           '\\n  3 | function throwError() {' +\n-          \"\\n> 4 |   throw new Error('Boom')\" +\n+          \"\\n> 4 |   throw new Error('ssr-throw')\" +\n           '\\n    |        ^' +\n           '\\n  5 | }' +\n           '\\n  6 |' +\n@@ -79,16 +81,16 @@ describe('app-dir - server source maps edge runtime', () => {\n \n     if (isNextDev) {\n       await retry(() => {\n-        expect(next.cliOutput.slice(outputIndex)).toMatch(/Error: Boom/)\n+        expect(next.cliOutput.slice(outputIndex)).toMatch(/Error: rsc-throw/)\n       })\n \n       const cliOutput = stripAnsi(next.cliOutput.slice(outputIndex))\n       expect(cliOutput).toContain(\n-        '\\n ⨯ Error: Boom' +\n+        '\\n ⨯ Error: rsc-throw' +\n           '\\n    at throwError (app/rsc-throw/page.js:2:8)' +\n           '\\n    at Page (app/rsc-throw/page.js:6:2)' +\n           '\\n  1 | function throwError() {' +\n-          \"\\n> 2 |   throw new Error('Boom')\" +\n+          \"\\n> 2 |   throw new Error('rsc-throw')\" +\n           '\\n    |        ^' +\n           '\\n  3 | }' +\n           '\\n  4 |' +"
        },
        {
            "sha": "a3950aa3833dca41c59fd74c40306b69ac901f9f",
            "filename": "test/e2e/app-dir/server-source-maps/server-source-maps.test.ts",
            "status": "modified",
            "additions": 96,
            "deletions": 85,
            "changes": 181,
            "blob_url": "https://github.com/vercel/next.js/blob/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/34039551d2e5f611c0abde31a197d9985918adaf/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts?ref=34039551d2e5f611c0abde31a197d9985918adaf",
            "patch": "@@ -30,19 +30,21 @@ describe('app-dir - server source maps', () => {\n \n     if (isNextDev) {\n       await retry(() => {\n-        expect(next.cliOutput.slice(outputIndex)).toContain('Error: Boom')\n+        expect(next.cliOutput.slice(outputIndex)).toContain(\n+          'Error: rsc-error-log'\n+        )\n       })\n       expect(normalizeCliOutput(next.cliOutput.slice(outputIndex))).toContain(\n-        '\\nError: Boom' +\n-          '\\n    at logError (app/rsc-error-log/page.js:5:16)' +\n-          '\\n    at Page (app/rsc-error-log/page.js:12:2)' +\n-          '\\n  3 |' +\n-          '\\n  4 | function logError() {' +\n-          \"\\n> 5 |   const error = new Error('Boom')\" +\n+        '\\nError: rsc-error-log' +\n+          '\\n    at logError (app/rsc-error-log/page.js:4:16)' +\n+          '\\n    at Page (app/rsc-error-log/page.js:9:2)' +\n+          '\\n  2 |' +\n+          '\\n  3 | function logError() {' +\n+          \"\\n> 4 |   const error = new Error('rsc-error-log')\" +\n           '\\n    |                ^' +\n-          '\\n  6 |   console.error(error)' +\n-          '\\n  7 | }' +\n-          '\\n  8 |' +\n+          '\\n  5 |   console.error(error)' +\n+          '\\n  6 | }' +\n+          '\\n  7 |' +\n           '\\n'\n       )\n     } else {\n@@ -56,30 +58,29 @@ describe('app-dir - server source maps', () => {\n \n     if (isNextDev) {\n       await retry(() => {\n-        expect(next.cliOutput.slice(outputIndex)).toContain('Error: Boom')\n+        expect(next.cliOutput.slice(outputIndex)).toContain(\n+          'Error: rsc-error-log-cause'\n+        )\n       })\n       expect(normalizeCliOutput(next.cliOutput.slice(outputIndex))).toContain(\n-        '\\nError: Boom' +\n-          '\\n    at logError (app/rsc-error-log-cause/page.js:4:16)' +\n-          (isTurbopack\n-            ? '\\n    at Page (app/rsc-error-log-cause/page.js:12:2)'\n-            : '\\n    at Page (app/rsc-error-log-cause/page.js:12:2)') +\n-          '\\n  2 |' +\n-          '\\n  3 | function logError(cause) {' +\n-          \"\\n> 4 |   const error = new Error('Boom', { cause })\" +\n+        '\\nError: rsc-error-log-cause' +\n+          '\\n    at logError (app/rsc-error-log-cause/page.js:2:16)' +\n+          '\\n    at Page (app/rsc-error-log-cause/page.js:8:2)' +\n+          '\\n  1 | function logError(cause) {' +\n+          \"\\n> 2 |   const error = new Error('rsc-error-log-cause', { cause })\" +\n           '\\n    |                ^' +\n-          '\\n  5 |   console.error(error)' +\n-          '\\n  6 | }' +\n-          '\\n  7 | {' +\n+          '\\n  3 |   console.error(error)' +\n+          '\\n  4 | }' +\n+          '\\n  5 | {' +\n           '\\n  [cause]: Error: Boom' +\n-          '\\n      at Page (app/rsc-error-log-cause/page.js:11:16)' +\n-          '\\n     9 |   await connection()' +\n-          '\\n    10 |' +\n-          \"\\n  > 11 |   const error = new Error('Boom')\" +\n+          '\\n      at Page (app/rsc-error-log-cause/page.js:7:16)' +\n+          '\\n     5 |' +\n+          '\\n     6 | export default function Page() {' +\n+          \"\\n  >  7 |   const error = new Error('Boom')\" +\n           '\\n       |                ^' +\n-          '\\n    12 |   logError(error)' +\n-          '\\n    13 |   return null' +\n-          '\\n    14 | }' +\n+          '\\n     8 |   logError(error)' +\n+          '\\n     9 |   return null' +\n+          '\\n    10 | }' +\n           '\\n'\n       )\n     } else {\n@@ -93,11 +94,13 @@ describe('app-dir - server source maps', () => {\n \n     if (isNextDev) {\n       await retry(() => {\n-        expect(next.cliOutput.slice(outputIndex)).toContain('Error: Boom')\n+        expect(next.cliOutput.slice(outputIndex)).toContain(\n+          'Error: ssr-error-log-ignore-listed'\n+        )\n       })\n       expect(normalizeCliOutput(next.cliOutput.slice(outputIndex))).toContain(\n         isTurbopack\n-          ? '\\nError: Boom' +\n+          ? '\\nError: ssr-error-log-ignore-listed' +\n               '\\n    at logError (app/ssr-error-log-ignore-listed/page.js:9:16)' +\n               '\\n    at runWithInternalIgnored (app/ssr-error-log-ignore-listed/page.js:19:12)' +\n               '\\n    at runWithExternalSourceMapped (app/ssr-error-log-ignore-listed/page.js:18:29)' +\n@@ -112,7 +115,7 @@ describe('app-dir - server source maps', () => {\n               '\\n    at Page (app/ssr-error-log-ignore-listed/page.js:14:14)' +\n               '\\n   7 |' +\n               '\\n'\n-          : '\\nError: Boom' +\n+          : '\\nError: ssr-error-log-ignore-listed' +\n               '\\n    at logError (app/ssr-error-log-ignore-listed/page.js:9:16)' +\n               '\\n    at runWithInternalIgnored (app/ssr-error-log-ignore-listed/page.js:19:12)' +\n               // TODO(veil-NDX-910): Webpacks's sourcemap loader drops `ignoreList`\n@@ -138,11 +141,11 @@ describe('app-dir - server source maps', () => {\n         // TODO(veil-NDX-910): Turbopack's sourcemap loader drops `ignoreList` in browser sourcemaps.\n         await expect(browser).toDisplayCollapsedRedbox(`\n          {\n-           \"description\": \"Boom\",\n+           \"description\": \"ssr-error-log-ignore-listed\",\n            \"environmentLabel\": null,\n            \"label\": \"Console Error\",\n            \"source\": \"app/ssr-error-log-ignore-listed/page.js (9:17) @ logError\n-         >  9 |   const error = new Error('Boom')\n+         >  9 |   const error = new Error('ssr-error-log-ignore-listed')\n               |                 ^\",\n            \"stack\": [\n              \"logError app/ssr-error-log-ignore-listed/page.js (9:17)\",\n@@ -164,11 +167,11 @@ describe('app-dir - server source maps', () => {\n         // TODO(veil): Webpack's sourcemap loader creates an incorrect `sources` entry.\n         await expect(browser).toDisplayCollapsedRedbox(`\n          {\n-           \"description\": \"Boom\",\n+           \"description\": \"ssr-error-log-ignore-listed\",\n            \"environmentLabel\": null,\n            \"label\": \"Console Error\",\n            \"source\": \"app/ssr-error-log-ignore-listed/page.js (9:17) @ logError\n-         >  9 |   const error = new Error('Boom')\n+         >  9 |   const error = new Error('ssr-error-log-ignore-listed')\n               |                 ^\",\n            \"stack\": [\n              \"logError app/ssr-error-log-ignore-listed/page.js (9:17)\",\n@@ -197,45 +200,45 @@ describe('app-dir - server source maps', () => {\n     if (isNextDev) {\n       await retry(() => {\n         expect(normalizeCliOutput(next.cliOutput.slice(outputIndex))).toContain(\n-          'Error: Boom'\n+          'Error: rsc-error-log-ignore-listed'\n         )\n       })\n       expect(normalizeCliOutput(next.cliOutput.slice(outputIndex))).toContain(\n         isTurbopack\n-          ? '\\nError: Boom' +\n-              '\\n    at logError (app/rsc-error-log-ignore-listed/page.js:9:16)' +\n-              '\\n    at runWithInternalIgnored (app/rsc-error-log-ignore-listed/page.js:21:12)' +\n-              '\\n    at runWithExternalSourceMapped (app/rsc-error-log-ignore-listed/page.js:20:29)' +\n-              '\\n    at runWithExternal (app/rsc-error-log-ignore-listed/page.js:19:32)' +\n-              '\\n    at runWithInternalSourceMapped (app/rsc-error-log-ignore-listed/page.js:18:18)' +\n+          ? '\\nError: rsc-error-log-ignore-listed' +\n+              '\\n    at logError (app/rsc-error-log-ignore-listed/page.js:8:16)' +\n+              '\\n    at runWithInternalIgnored (app/rsc-error-log-ignore-listed/page.js:18:12)' +\n+              '\\n    at runWithExternalSourceMapped (app/rsc-error-log-ignore-listed/page.js:17:29)' +\n+              '\\n    at runWithExternal (app/rsc-error-log-ignore-listed/page.js:16:32)' +\n+              '\\n    at runWithInternalSourceMapped (app/rsc-error-log-ignore-listed/page.js:15:18)' +\n               // Realpath does not point into node_modules so we don't ignore it.\n               // TODO(veil): Should be internal-pkg/sourcemapped.ts\n               '\\n    at runInternalSourceMapped (sourcemapped.ts:5:9)' +\n-              '\\n    at runWithInternal (app/rsc-error-log-ignore-listed/page.js:17:28)' +\n+              '\\n    at runWithInternal (app/rsc-error-log-ignore-listed/page.js:14:28)' +\n               // Realpath does not point into node_modules so we don't ignore it.\n               '\\n    at runInternal (internal-pkg/index.js:2:9)' +\n-              '\\n    at Page (app/rsc-error-log-ignore-listed/page.js:16:14)' +\n-              '\\n   7 |' +\n+              '\\n    at Page (app/rsc-error-log-ignore-listed/page.js:13:14)' +\n+              '\\n   6 |' +\n               '\\n'\n-          : '\\nError: Boom' +\n-              '\\n    at logError (app/rsc-error-log-ignore-listed/page.js:9:16)' +\n-              '\\n    at runWithInternalIgnored (app/rsc-error-log-ignore-listed/page.js:21:12)' +\n+          : '\\nError: rsc-error-log-ignore-listed' +\n+              '\\n    at logError (app/rsc-error-log-ignore-listed/page.js:8:16)' +\n+              '\\n    at runWithInternalIgnored (app/rsc-error-log-ignore-listed/page.js:18:12)' +\n               // TODO(veil): Webpacks's sourcemap loader drops `ignoreList`\n               // TODO(veil): Webpack's sourcemap loader creates an incorrect `sources` entry.\n               // Can be worked around by using `./sourcemapped.ts` instead of `sourcemapped.ts`.\n               '\\n    at runInternalIgnored (webpack-internal:/(rsc)/internal-pkg/ignored.ts:6:9)' +\n-              '\\n    at runWithExternalSourceMapped (app/rsc-error-log-ignore-listed/page.js:20:29)' +\n-              '\\n    at runWithExternal (app/rsc-error-log-ignore-listed/page.js:19:32)' +\n-              '\\n    at runWithInternalSourceMapped (app/rsc-error-log-ignore-listed/page.js:18:18)' +\n+              '\\n    at runWithExternalSourceMapped (app/rsc-error-log-ignore-listed/page.js:17:29)' +\n+              '\\n    at runWithExternal (app/rsc-error-log-ignore-listed/page.js:16:32)' +\n+              '\\n    at runWithInternalSourceMapped (app/rsc-error-log-ignore-listed/page.js:15:18)' +\n               // TODO(veil): Webpack's sourcemap loader creates an incorrect `sources` entry.\n               // Can be worked around by using `./sourcemapped.ts` instead of `sourcemapped.ts`.\n               // Realpath does not point into node_modules so we don't ignore it.\n               '\\n    at runInternalSourceMapped (webpack-internal:/(rsc)/internal-pkg/sourcemapped.ts:5:9)' +\n-              '\\n    at runWithInternal (app/rsc-error-log-ignore-listed/page.js:17:28)' +\n+              '\\n    at runWithInternal (app/rsc-error-log-ignore-listed/page.js:14:28)' +\n               // Realpath does not point into node_modules so we don't ignore it.\n               '\\n    at runInternal (internal-pkg/index.js:2:9)' +\n-              '\\n    at Page (app/rsc-error-log-ignore-listed/page.js:16:14)' +\n-              '\\n   7 |' +\n+              '\\n    at Page (app/rsc-error-log-ignore-listed/page.js:13:14)' +\n+              '\\n   6 |' +\n               '\\n'\n       )\n     } else {\n@@ -249,17 +252,17 @@ describe('app-dir - server source maps', () => {\n \n     if (isNextDev) {\n       await retry(() => {\n-        expect(next.cliOutput.slice(outputIndex)).toContain('Error: Boom')\n+        expect(next.cliOutput.slice(outputIndex)).toContain('Error: ssr-throw')\n       })\n \n       const cliOutput = stripAnsi(next.cliOutput.slice(outputIndex))\n       expect(cliOutput).toContain(\n-        '\\n ⨯ Error: Boom' +\n+        '\\n ⨯ Error: ssr-throw' +\n           '\\n    at throwError (app/ssr-throw/Thrower.js:4:8)' +\n           '\\n    at Thrower (app/ssr-throw/Thrower.js:8:2)' +\n           '\\n  2 |' +\n           '\\n  3 | function throwError() {' +\n-          \"\\n> 4 |   throw new Error('Boom')\" +\n+          \"\\n> 4 |   throw new Error('ssr-throw')\" +\n           '\\n    |        ^' +\n           '\\n  5 | }' +\n           '\\n  6 |' +\n@@ -270,11 +273,11 @@ describe('app-dir - server source maps', () => {\n \n       await expect(browser).toDisplayRedbox(`\n        {\n-         \"description\": \"Boom\",\n+         \"description\": \"ssr-throw\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\",\n          \"source\": \"app/ssr-throw/Thrower.js (4:9) @ throwError\n-       > 4 |   throw new Error('Boom')\n+       > 4 |   throw new Error('ssr-throw')\n            |         ^\",\n          \"stack\": [\n            \"throwError app/ssr-throw/Thrower.js (4:9)\",\n@@ -289,40 +292,47 @@ describe('app-dir - server source maps', () => {\n   })\n \n   it('logged errors preserve their name', async () => {\n-    const outputIndex = next.cliOutput.length\n-    await next.render('/rsc-error-log-custom-name')\n+    let cliOutput = next.cliOutput\n+    if (isNextDev) {\n+      const outputIndex = next.cliOutput.length\n+      await next.render('/rsc-error-log-custom-name')\n+      cliOutput = next.cliOutput.slice(outputIndex)\n+    }\n \n     await retry(() => {\n-      expect(next.cliOutput.slice(outputIndex)).toContain(\n-        // TODO: isNextDev ? 'UnnamedError: Foo' : '[Error]: Foo'\n-        isNextDev ? 'Error: Foo' : 'Error: Foo'\n+      expect(cliOutput).toContain(\n+        // TODO: isNextDev ? 'UnnamedError: rsc-error-log-custom-name-Foo' : '[Error]: rsc-error-log-custom-name-Foo'\n+        isNextDev\n+          ? 'Error: rsc-error-log-custom-name-Foo'\n+          : 'Error: rsc-error-log-custom-name-Foo'\n       )\n     })\n \n-    expect(next.cliOutput.slice(outputIndex)).toContain(\n-      // TODO: isNextDev ? 'NamedError [MyError]: Bar' : '[MyError]: Bar'\n-      isNextDev ? 'Error [MyError]: Bar' : 'Error [MyError]: Bar'\n+    expect(cliOutput).toContain(\n+      // TODO: isNextDev ? 'NamedError [MyError]: rsc-error-log-custom-name-Bar' : '[MyError]: rsc-error-log-custom-name-Bar'\n+      isNextDev\n+        ? 'Error [MyError]: rsc-error-log-custom-name-Bar'\n+        : 'Error [MyError]: rsc-error-log-custom-name-Bar'\n     )\n   })\n \n   it('handles invalid sourcemaps gracefully', async () => {\n-    const outputIndex = next.cliOutput.length\n-    await next.render('/bad-sourcemap')\n-\n-    await retry(() => {\n-      expect(normalizeCliOutput(next.cliOutput.slice(outputIndex))).toContain(\n-        'Error: Boom!'\n-      )\n-    })\n-\n     if (isNextDev) {\n+      const outputIndex = next.cliOutput.length\n+      await next.render('/bad-sourcemap')\n+\n+      await retry(() => {\n+        expect(normalizeCliOutput(next.cliOutput.slice(outputIndex))).toContain(\n+          'Error: bad-sourcemap'\n+        )\n+      })\n       if (isTurbopack) {\n         expect(normalizeCliOutput(next.cliOutput.slice(outputIndex))).toContain(\n           // Node.js is fine with invalid URLs in index maps apparently.\n           '' +\n-            '\\nError: Boom!' +\n-            '\\n    at logError (custom://[badhost]/app/bad-sourcemap/page.js:8:16)' +\n-            '\\n    at Page (custom://[badhost]/app/bad-sourcemap/page.js:13:2)' +\n+            '\\nError: bad-sourcemap' +\n+            '\\n    at logError (custom://[badhost]/app/bad-sourcemap/page.js:6:16)' +\n+            '\\n    at Page (custom://[badhost]/app/bad-sourcemap/page.js:10:2)' +\n             // TODO: Remove blank line\n             '\\n'\n         )\n@@ -333,16 +343,17 @@ describe('app-dir - server source maps', () => {\n           // sourcemapping is broken on invalid sources.\n           '' +\n             `\\nwebpack-internal:///(rsc)/./app/bad-sourcemap/page.js: Invalid source map. Only conformant source maps can be used to find the original code. Cause: TypeError [ERR_INVALID_ARG_TYPE]: The \"payload\" argument must be of type object. Received null` +\n-            '\\nError: Boom!' +\n-            '\\n    at logError (webpack-internal:///(rsc)/./app/bad-sourcemap/page.js:14:19)' +\n-            '\\n    at Page (webpack-internal:///(rsc)/./app/bad-sourcemap/page.js:18:5)'\n+            '\\nError: bad-sourcemap' +\n+            '\\n    at logError (webpack-internal:///(rsc)/./app/bad-sourcemap/page.js:12:19)' +\n+            '\\n    at Page (webpack-internal:///(rsc)/./app/bad-sourcemap/page.js:15:5)'\n         )\n-        // Expect the invalid sourcemap warning only once.\n+        // Expect the invalid sourcemap warning only once per render.\n+        // Dynamic I/O renders three times.\n         expect(\n           normalizeCliOutput(next.cliOutput.slice(outputIndex)).split(\n             'Invalid source map.'\n           ).length - 1\n-        ).toEqual(1)\n+        ).toEqual(3)\n       }\n     } else {\n       // TODO: test `next start` with `--enable-source-maps`"
        }
    ],
    "stats": {
        "total": 256,
        "additions": 125,
        "deletions": 131
    }
}