{
    "author": "eps1lon",
    "message": "[test] Resolve `elementByCSS` and `waitForElementByCSS` once visible (#83301)",
    "sha": "caffa0d866773a03346b484336a582ba53b27f02",
    "files": [
        {
            "sha": "f61c744c2f1bdd6bd83fe8c2ca805f5ebdb45931",
            "filename": "test/development/acceptance-app/editor-links.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Facceptance-app%2Feditor-links.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Facceptance-app%2Feditor-links.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Feditor-links.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1,10 +1,11 @@\n import { check, retry } from 'next-test-utils'\n+import type { Playwright } from 'next-webdriver'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n import path from 'path'\n import { createSandbox } from 'development-sandbox'\n import { outdent } from 'outdent'\n \n-async function clickSourceFile(browser: any) {\n+async function clickSourceFile(browser: Playwright) {\n   await browser.waitForElementByCss(\n     '[data-with-open-in-editor-link-source-file]'\n   )\n@@ -13,7 +14,7 @@ async function clickSourceFile(browser: any) {\n     .click()\n }\n \n-async function clickImportTraceFiles(browser: any) {\n+async function clickImportTraceFiles(browser: Playwright) {\n   await browser.waitForElementByCss(\n     '[data-with-open-in-editor-link-import-trace]'\n   )"
        },
        {
            "sha": "0fd15e0dac492b4c21ba13587b4cb14b1c4360fd",
            "filename": "test/development/app-dir/react-performance-track/react-performance-track.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Freact-performance-track.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Freact-performance-track.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Freact-performance-track.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -10,7 +10,9 @@ describe('react-performance-track', () => {\n \n   it('should show setTimeout', async () => {\n     const browser = await next.browser('/set-timeout')\n-    await browser.elementByCss('[data-react-server-requests-done]')\n+    await browser.elementByCss('[data-react-server-requests-done]', {\n+      state: 'attached',\n+    })\n \n     const track = await browser.eval('window.reactServerRequests.getSnapshot()')\n     expect(track).toEqual(\n@@ -23,7 +25,9 @@ describe('react-performance-track', () => {\n \n   it('should show fetch', async () => {\n     const browser = await next.browser('/fetch')\n-    await browser.elementByCss('[data-react-server-requests-done]')\n+    await browser.elementByCss('[data-react-server-requests-done]', {\n+      state: 'attached',\n+    })\n \n     const track = await browser.eval('window.reactServerRequests.getSnapshot()')\n     expect(track).toEqual("
        },
        {
            "sha": "02cd30da6c29acaa2b98924960c12e3a334c7386",
            "filename": "test/development/app-dir/segment-explorer/segment-explorer.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fsegment-explorer%2Fsegment-explorer.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -92,7 +92,7 @@ describe('segment-explorer', () => {\n       `\"app/ [global-error.js]\"`\n     )\n     // FIXME: handle preserve the url when hitting global-error\n-    expect(await getSegmentExplorerRoute(browser)).toBe('')\n+    expect(await getSegmentExplorerRoute(browser)).toBe('<empty>')\n   })\n \n   it('should show navigation boundaries of the segment', async () => {"
        },
        {
            "sha": "be762291ac74aaa5af10fd09afa68770a3860c0f",
            "filename": "test/development/app-hmr/hmr.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fapp-hmr%2Fhmr.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fapp-hmr%2Fhmr.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-hmr%2Fhmr.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -123,7 +123,9 @@ describe(`app-dir-hmr`, () => {\n       await browser\n         .elementByCss('a')\n         .click()\n-        .waitForElementByCss('[data-testid=\"new-runtime-functionality-page\"]')\n+        .waitForElementByCss('[data-testid=\"new-runtime-functionality-page\"]', {\n+          state: 'attached',\n+        })\n \n       const logs = await browser.log()\n       // TODO: Should assert on all logs but these are cluttered with logs from our test utils (e.g. playwright tracing or webdriver)"
        },
        {
            "sha": "f18157ec287ce39955ac15e7c4430d10a508af36",
            "filename": "test/development/basic/define-class-fields/define-class-fields.test.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 36,
            "changes": 50,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fbasic%2Fdefine-class-fields%2Fdefine-class-fields.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fbasic%2Fdefine-class-fields%2Fdefine-class-fields.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fdefine-class-fields%2Fdefine-class-fields.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1,5 +1,4 @@\n import { join } from 'path'\n-import webdriver from 'next-webdriver'\n import { nextTestSetup } from 'e2e-utils'\n import { check } from 'next-test-utils'\n \n@@ -16,32 +15,18 @@ describe('useDefineForClassFields SWC option', () => {\n   })\n \n   it('tsx should compile with useDefineForClassFields enabled', async () => {\n-    let browser\n-    try {\n-      browser = await webdriver(next.url, '/')\n-      await browser.elementByCss('#action').click()\n-      await check(\n-        () => browser.elementByCss('#name').text(),\n-        /this is my name: next/\n-      )\n-    } finally {\n-      if (browser) {\n-        await browser.close()\n-      }\n-    }\n+    const browser = await next.browser('/')\n+    await browser.elementByCss('#action').click()\n+    await check(\n+      () => browser.elementByCss('#name').text(),\n+      /this is my name: next/\n+    )\n   })\n \n   it(\"Initializes resident to undefined after the call to 'super()' when with useDefineForClassFields enabled\", async () => {\n-    let browser\n-    try {\n-      browser = await webdriver(next.url, '/animal')\n-      expect(await browser.elementByCss('#dog').text()).toBe('')\n-      expect(await browser.elementByCss('#dogDecl').text()).toBe('dog')\n-    } finally {\n-      if (browser) {\n-        await browser.close()\n-      }\n-    }\n+    const browser = await next.browser('/animal')\n+    expect(await browser.elementByCss('#dog').text()).toBe('undefined')\n+    expect(await browser.elementByCss('#dogDecl').text()).toBe('dog')\n   })\n \n   async function matchLogs$(browser) {\n@@ -62,17 +47,10 @@ describe('useDefineForClassFields SWC option', () => {\n   }\n \n   it('set accessors from base classes wonâ€™t get triggered with useDefineForClassFields enabled', async () => {\n-    let browser\n-    try {\n-      browser = await webdriver(next.url, '/derived')\n-      await matchLogs$(browser).then(([data_foundLog, name_foundLog]) => {\n-        expect(data_foundLog).toBe(true)\n-        expect(name_foundLog).toBe(false)\n-      })\n-    } finally {\n-      if (browser) {\n-        await browser.close()\n-      }\n-    }\n+    const browser = await next.browser('/derived')\n+    await matchLogs$(browser).then(([data_foundLog, name_foundLog]) => {\n+      expect(data_foundLog).toBe(true)\n+      expect(name_foundLog).toBe(false)\n+    })\n   })\n })"
        },
        {
            "sha": "5d92bc6d3b43a4fbb5113dd87b5135badb80b7d5",
            "filename": "test/development/basic/define-class-fields/fixture/pages/animal.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fbasic%2Fdefine-class-fields%2Ffixture%2Fpages%2Fanimal.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fbasic%2Fdefine-class-fields%2Ffixture%2Fpages%2Fanimal.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fdefine-class-fields%2Ffixture%2Fpages%2Fanimal.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -46,7 +46,7 @@ export default function AnimalView() {\n   })\n   return (\n     <>\n-      <div id={'dog'}>{dog.resident}</div>\n+      <div id={'dog'}>{String(dog.resident)}</div>\n       <div id={'dogDecl'}>{dogDeclare.resident?.dogStuff}</div>\n     </>\n   )"
        },
        {
            "sha": "bfb166c0793bcae0aeedaef5eaee869956439912",
            "filename": "test/development/basic/define-class-fields/fixture/tsconfig.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fbasic%2Fdefine-class-fields%2Ffixture%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fdevelopment%2Fbasic%2Fdefine-class-fields%2Ffixture%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fdefine-class-fields%2Ffixture%2Ftsconfig.json?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -17,5 +17,5 @@\n     \"isolatedModules\": true\n   },\n   \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\"],\n-  \"exclude\": [\"node_modules\"]\n+  \"exclude\": [\"node_modules\", \"**/*.test.ts\", \"**/*.test.tsx\"]\n }"
        },
        {
            "sha": "94f3af39c75d7d3f3da84a1ebe83e736cfb71fae",
            "filename": "test/e2e/404-page-router/app/components/debug.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2F404-page-router%2Fapp%2Fcomponents%2Fdebug.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2F404-page-router%2Fapp%2Fcomponents%2Fdebug.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2F404-page-router%2Fapp%2Fcomponents%2Fdebug.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -2,7 +2,7 @@ export default function Debug({ name, value }) {\n   return (\n     <>\n       <dt>{name}</dt>\n-      <dd id={name}>{value}</dd>\n+      <dd id={name}>{value || '<empty>'}</dd>\n     </>\n   )\n }"
        },
        {
            "sha": "e5bff4720f424436011527aa0e34b588caa41c9d",
            "filename": "test/e2e/404-page-router/index.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 17,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2F404-page-router%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2F404-page-router%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2F404-page-router%2Findex.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1,6 +1,5 @@\n import path from 'path'\n import fs from 'fs-extra'\n-import webdriver from 'next-webdriver'\n import { createNext, FileRef, type NextInstance } from 'e2e-utils'\n import { check, retry } from 'next-test-utils'\n \n@@ -122,29 +121,23 @@ describe('404-page-router', () => {\n \n       describe.each(urls)('for $url', ({ url, pathname, asPath }) => {\n         it('should have the correct router parameters after it is ready', async () => {\n-          const query = url.split('?', 2)[1] ?? ''\n-          const browser = await webdriver(next.url, url)\n+          const query = url.split('?', 2)[1] ?? '<empty>'\n+          const browser = await next.browser(url)\n \n-          try {\n-            await check(\n-              () => browser.eval('next.router.isReady ? \"yes\" : \"no\"'),\n-              'yes'\n-            )\n-            expect(await browser.elementById('pathname').text()).toEqual(\n-              pathname\n-            )\n-            expect(await browser.elementById('asPath').text()).toEqual(asPath)\n-            expect(await browser.elementById('query').text()).toEqual(query)\n-          } finally {\n-            await browser.close()\n-          }\n+          await check(\n+            () => browser.eval('next.router.isReady ? \"yes\" : \"no\"'),\n+            'yes'\n+          )\n+          expect(await browser.elementById('pathname').text()).toEqual(pathname)\n+          expect(await browser.elementById('asPath').text()).toEqual(asPath)\n+          expect(await browser.elementById('query').text()).toEqual(query)\n         })\n       })\n \n       // It should not throw any errors when re-fetching the route info:\n       // https://github.com/vercel/next.js/issues/44293\n       it('should not throw any errors when re-fetching the route info', async () => {\n-        const browser = await webdriver(next.url, '/?test=1')\n+        const browser = await next.browser('/?test=1')\n         await check(\n           () => browser.eval('next.router.isReady ? \"yes\" : \"no\"'),\n           'yes'"
        },
        {
            "sha": "95836c43aacb002d6cb45ecb60dd64c44df4cf78",
            "filename": "test/e2e/app-dir/actions/app-action-progressive-enhancement.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action-progressive-enhancement.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action-progressive-enhancement.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action-progressive-enhancement.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -71,7 +71,7 @@ describe('app-dir action progressive enhancement', () => {\n       await browser.elementById('set-cookie').click()\n \n       await retry(async () => {\n-        expect(await browser.elementById('referer').text()).toBe('')\n+        expect(await browser.elementById('referer').text()).toBe('<null>')\n       })\n \n       await browser.elementById('get-cookie').click()"
        },
        {
            "sha": "839f24efd1fef0193f62f117e2a095ca4c76c1a9",
            "filename": "test/e2e/app-dir/actions/app-action.test.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 13,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -198,22 +198,22 @@ describe('app-dir action handling', () => {\n \n     await browser.elementByCss('#cookie').click()\n     await retry(async () => {\n-      const res = (await browser.elementByCss('h1').text()) || ''\n+      const res = await browser.elementByCss('h1', { state: 'attached' }).text()\n       const id = res.split(':', 2)\n       expect(id[0]).toBeDefined()\n       expect(id[0]).toBe(id[1])\n     })\n \n     await browser.elementByCss('#header').click()\n     await retry(async () => {\n-      const res = (await browser.elementByCss('h1').text()) || ''\n+      const res = await browser.elementByCss('h1').text()\n       expect(res).toContain('Mozilla')\n     })\n \n     // Set cookies\n     await browser.elementByCss('#setCookie').click()\n     await retry(async () => {\n-      const res = (await browser.elementByCss('h1').text()) || ''\n+      const res = await browser.elementByCss('h1').text()\n       const id = res.split(':', 3)\n \n       expect(id[0]).toBeDefined()\n@@ -231,7 +231,7 @@ describe('app-dir action handling', () => {\n       const browser = await next.browser('/mutate-cookie-with-redirect', {\n         disableJavaScript,\n       })\n-      expect(await browser.elementByCss('#value').text()).toBe('')\n+      expect(await browser.elementByCss('#value').text()).toBe('<null>')\n \n       await browser.elementByCss('#update-cookie').click()\n       await browser.elementByCss('#redirect-target')\n@@ -864,7 +864,9 @@ describe('app-dir action handling', () => {\n       const browser = await next.browser(`/delayed-action/${runtime}`)\n \n       // confirm there's no data yet\n-      expect(await browser.elementById('delayed-action-result').text()).toBe('')\n+      expect(await browser.elementById('delayed-action-result').text()).toBe(\n+        '<null>'\n+      )\n \n       // Trigger the delayed action. This will sleep for a few seconds before dispatching the server action handler\n       await browser.elementById('run-action').click()\n@@ -1395,7 +1397,9 @@ describe('app-dir action handling', () => {\n \n     it('should revalidate when cookies.set is called', async () => {\n       const browser = await next.browser('/revalidate')\n-      const randomNumber = await browser.elementByCss('#random-cookie').text()\n+      const randomNumber = await browser\n+        .elementByCss('#random-cookie', { state: 'attached' })\n+        .text()\n \n       await browser.elementByCss('#set-cookie').click()\n \n@@ -1446,12 +1450,9 @@ describe('app-dir action handling', () => {\n       await retry(async () => {\n         randomCookie = JSON.parse(\n           await browser.elementByCss('#random-cookie').text()\n-        ).value\n-        expect(randomCookie).toBeDefined()\n+        ).cookie.value\n       })\n \n-      console.log(123, await browser.elementByCss('body').text())\n-\n       await browser.elementByCss('#another').click()\n       await retry(async () => {\n         expect(await browser.elementByCss('#title').text()).toBe(\n@@ -1461,7 +1462,7 @@ describe('app-dir action handling', () => {\n \n       const newRandomCookie = JSON.parse(\n         await browser.elementByCss('#random-cookie').text()\n-      ).value\n+      ).cookie.value\n \n       console.log(456, await browser.elementByCss('body').text())\n \n@@ -1478,7 +1479,7 @@ describe('app-dir action handling', () => {\n       await retry(async () => {\n         revalidatedRandomCookie = JSON.parse(\n           await browser.elementByCss('#random-cookie').text()\n-        ).value\n+        ).cookie.value\n         expect(revalidatedRandomCookie).not.toBe(randomCookie)\n       })\n \n@@ -1488,7 +1489,7 @@ describe('app-dir action handling', () => {\n       await retry(async () => {\n         const newRandomCookie = await JSON.parse(\n           await browser.elementByCss('#random-cookie').text()\n-        ).value\n+        ).cookie.value\n         expect(revalidatedRandomCookie).toBe(newRandomCookie)\n       })\n     })"
        },
        {
            "sha": "3f59810cfe90a93539f005bac2787e520699819f",
            "filename": "test/e2e/app-dir/actions/app/delayed-action/layout-edge.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fdelayed-action%2Flayout-edge.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fdelayed-action%2Flayout-edge.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fdelayed-action%2Flayout-edge.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -11,7 +11,7 @@ export default function Layout({ children }) {\n   return (\n     <DataContext.Provider value={{ data, setData }}>\n       <div>{children}</div>\n-      <div id=\"delayed-action-result\">{data}</div>\n+      <div id=\"delayed-action-result\">{data ?? '<null>'}</div>\n     </DataContext.Provider>\n   )\n }"
        },
        {
            "sha": "766e1da2cba966e450a2f893b8f074db421fffc5",
            "filename": "test/e2e/app-dir/actions/app/delayed-action/layout-node.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fdelayed-action%2Flayout-node.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fdelayed-action%2Flayout-node.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fdelayed-action%2Flayout-node.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -9,7 +9,7 @@ export default function Layout({ children }) {\n   return (\n     <DataContext.Provider value={{ data, setData }}>\n       <div>{children}</div>\n-      <div id=\"delayed-action-result\">{data}</div>\n+      <div id=\"delayed-action-result\">{data ?? '<null>'}</div>\n     </DataContext.Provider>\n   )\n }"
        },
        {
            "sha": "b78c839de6ed407e0919abbc4e45b80a9a785b76",
            "filename": "test/e2e/app-dir/actions/app/header/node/form/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fheader%2Fnode%2Fform%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fheader%2Fnode%2Fform%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fheader%2Fnode%2Fform%2Fpage.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -17,7 +17,7 @@ export default function Page() {\n   return (\n     <>\n       <form action={getReferrerAction}>\n-        <p id=\"referer\">{referer}</p>\n+        <p id=\"referer\">{referer ?? '<null>'}</p>\n         <button id=\"get-referer\">Get Referer</button>\n       </form>\n       <form action={getTestCookieAction}>"
        },
        {
            "sha": "78dace1729cd91020b43bfa8ed7d66f7326e1903",
            "filename": "test/e2e/app-dir/actions/app/mutate-cookie-with-redirect/page.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fmutate-cookie-with-redirect%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fmutate-cookie-with-redirect%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Fmutate-cookie-with-redirect%2Fpage.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -10,7 +10,7 @@ async function updateCookieAndRedirect() {\n export default async function Page() {\n   return (\n     <>\n-      <p id=\"value\">{(await cookies()).get('testCookie')?.value ?? null}</p>\n+      <p id=\"value\">{(await cookies()).get('testCookie')?.value ?? '<null>'}</p>\n       <form action={updateCookieAndRedirect}>\n         <button id=\"update-cookie\" type=\"submit\">\n           Update Cookie"
        },
        {
            "sha": "3609ab78a6896a4dcedb360afc1f98db71812e84",
            "filename": "test/e2e/app-dir/actions/app/revalidate-2/page.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Frevalidate-2%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Frevalidate-2%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Frevalidate-2%2Fpage.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -34,7 +34,9 @@ export default async function Page() {\n       </form>\n       <p>\n         random cookie:{' '}\n-        <span id=\"random-cookie\">{JSON.stringify(randomCookie)}</span>\n+        <span id=\"random-cookie\">\n+          {JSON.stringify({ cookie: randomCookie })}\n+        </span>\n       </p>\n     </>\n   )"
        },
        {
            "sha": "ef27713d7e241a2876d046ce41eea2c240f6bfe7",
            "filename": "test/e2e/app-dir/actions/app/revalidate/page.js",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Frevalidate%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Frevalidate%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp%2Frevalidate%2Fpage.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -40,7 +40,8 @@ export default async function Page() {\n         <span id=\"justputit\">{data2}</span>\n       </p>\n       <p>\n-        random cookie: <span id=\"random-cookie\">{JSON.stringify(cookie)}</span>\n+        random cookie:{' '}\n+        <span id=\"random-cookie\">{JSON.stringify({ cookie })}</span>\n       </p>\n       <form>\n         <button"
        },
        {
            "sha": "86248008d5d2ed2f135cbd7ba072b66657e956e0",
            "filename": "test/e2e/app-dir/app-external/app-external.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fapp-external%2Fapp-external.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fapp-external%2Fapp-external.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-external%2Fapp-external.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -287,7 +287,9 @@ describe('app dir - external dependency', () => {\n   describe('server actions', () => {\n     it('should prefer to resolve esm over cjs for bundling optout packages', async () => {\n       const browser = await next.browser('/optout/action')\n-      expect(await browser.elementByCss('#dual-pkg-outout p').text()).toBe('')\n+      expect(await browser.elementByCss('#dual-pkg-outout p').text()).toBe(\n+        'initial'\n+      )\n \n       browser.elementByCss('#dual-pkg-outout button').click()\n       await check(async () => {"
        },
        {
            "sha": "9320959728fc160ff1931c8bec16fe488ed41dbb",
            "filename": "test/e2e/app-dir/app-external/app/optout/action/page.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fapp-external%2Fapp%2Foptout%2Faction%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fapp-external%2Fapp%2Foptout%2Faction%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-external%2Fapp%2Foptout%2Faction%2Fpage.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -4,7 +4,7 @@ import { useState } from 'react'\n import { getDualOptoutValue } from './actions'\n \n export default function Page() {\n-  const [optoutDisplayValue, setOptoutDisplayValue] = useState('')\n+  const [optoutDisplayValue, setOptoutDisplayValue] = useState('initial')\n   return (\n     <div id=\"dual-pkg-outout\">\n       <p>{optoutDisplayValue}</p>"
        },
        {
            "sha": "4bbb1816505bb82370c3a67c700cece85f4fae03",
            "filename": "test/e2e/app-dir/app-static/app-static.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -4244,7 +4244,11 @@ describe('app-dir static/dynamic handling', () => {\n         expect(await browser.elementByCss('#params-second').text()).toBe(\n           'other'\n         )\n-        expect(await browser.elementByCss('#params-third').text()).toBe('')\n+        expect(\n+          await browser\n+            .elementByCss('#params-third', { state: 'attached' })\n+            .text()\n+        ).toBe('')\n         expect(await browser.elementByCss('#params-not-real').text()).toBe(\n           'N/A'\n         )"
        },
        {
            "sha": "ddd51b2eff7da5e750209564dc0535cbff7b1386",
            "filename": "test/e2e/app-dir/global-not-found/metadata/metadata.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fmetadata%2Fmetadata.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fmetadata%2Fmetadata.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fglobal-not-found%2Fmetadata%2Fmetadata.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -24,7 +24,9 @@ describe('global-not-found - metadata', () => {\n       'global-not-found description'\n     )\n     // pick up static icon svg\n-    const icon = await browser.elementByCss('link[rel=\"icon\"]')\n+    const icon = await browser.elementByCss('link[rel=\"icon\"]', {\n+      state: 'attached',\n+    })\n     expect(await icon.getAttribute('type')).toBe('image/svg+xml')\n   })\n })"
        },
        {
            "sha": "d6cb9d04e37d8098116009773165c1f84bd426b4",
            "filename": "test/e2e/app-dir/hooks/components/router-hooks-fixtures.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fhooks%2Fcomponents%2Frouter-hooks-fixtures.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fhooks%2Fcomponents%2Frouter-hooks-fixtures.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fhooks%2Fcomponents%2Frouter-hooks-fixtures.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -27,7 +27,7 @@ export const RouterHooksFixtures = () => {\n \n   return (\n     <div id={pagesRouter.isReady ? 'router-ready' : 'router-not-ready'}>\n-      <div id=\"key-value\">{value}</div>\n+      <div id=\"key-value\">Value:{value}</div>\n       <div id=\"pathname\">{pathname}</div>\n       <button type=\"button\" onClick={onClick}>\n         Push"
        },
        {
            "sha": "7e969adcadefb11c406138835861bb97ba679892",
            "filename": "test/e2e/app-dir/hooks/hooks.test.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 24,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fhooks%2Fhooks.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fhooks%2Fhooks.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fhooks%2Fhooks.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -22,16 +22,14 @@ describe('app dir - hooks', () => {\n           pathname + (keyValue ? `?key=${keyValue}` : '')\n         )\n \n-        try {\n-          await browser.waitForElementByCss('#router-ready')\n-          expect(await browser.elementById('key-value').text()).toBe(keyValue)\n-          expect(await browser.elementById('pathname').text()).toBe(pathname)\n-\n-          await browser.elementByCss('button').click()\n-          await browser.waitForElementByCss('#pushed')\n-        } finally {\n-          await browser.close()\n-        }\n+        await browser.waitForElementByCss('#router-ready')\n+        expect(await browser.elementById('key-value').text()).toBe(\n+          `Value:${keyValue}`\n+        )\n+        expect(await browser.elementById('pathname').text()).toBe(pathname)\n+\n+        await browser.elementByCss('button').click()\n+        await browser.waitForElementByCss('#pushed', { state: 'attached' })\n       }\n     )\n   })\n@@ -108,20 +106,16 @@ describe('app dir - hooks', () => {\n     it('should allow access to the router', async () => {\n       const browser = await next.browser('/hooks/use-router')\n \n-      try {\n-        // Wait for the page to load, click the button (which uses a method\n-        // on the router) and then wait for the correct page to load.\n-        await browser.waitForElementByCss('#router')\n-        await browser.elementById('button-push').click()\n-        await browser.waitForElementByCss('#router-sub-page')\n-\n-        // Go back (confirming we did do a hard push), and wait for the\n-        // correct previous page.\n-        await browser.back()\n-        await browser.waitForElementByCss('#router')\n-      } finally {\n-        await browser.close()\n-      }\n+      // Wait for the page to load, click the button (which uses a method\n+      // on the router) and then wait for the correct page to load.\n+      await browser.waitForElementByCss('#router')\n+      await browser.elementById('button-push').click()\n+      await browser.waitForElementByCss('#router-sub-page')\n+\n+      // Go back (confirming we did do a hard push), and wait for the\n+      // correct previous page.\n+      await browser.back()\n+      await browser.waitForElementByCss('#router')\n     })\n   })\n "
        },
        {
            "sha": "2c6e0672552c6788cf9e74960dd5225e6fb2fd70",
            "filename": "test/e2e/app-dir/interception-dynamic-segment-middleware/app/[locale]/@modal/default.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment-middleware%2Fapp%2F%5Blocale%5D%2F%40modal%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment-middleware%2Fapp%2F%5Blocale%5D%2F%40modal%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment-middleware%2Fapp%2F%5Blocale%5D%2F%40modal%2Fdefault.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1 +1 @@\n-export default () => null\n+export default () => 'default'"
        },
        {
            "sha": "acdfce95491ef511527c0d30174ac9ced82b6bbf",
            "filename": "test/e2e/app-dir/interception-dynamic-segment-middleware/interception-dynamic-segment-middleware.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment-middleware%2Finterception-dynamic-segment-middleware.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment-middleware%2Finterception-dynamic-segment-middleware.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment-middleware%2Finterception-dynamic-segment-middleware.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -12,7 +12,7 @@ describe('interception-dynamic-segment-middleware', () => {\n     await browser.elementByCss('[href=\"/foo/p/1\"]').click()\n     await check(() => browser.elementById('modal').text(), /intercepted/)\n     await browser.refresh()\n-    await check(() => browser.elementById('modal').text(), '')\n+    await check(() => browser.elementById('modal').text(), 'default')\n     await check(() => browser.elementById('children').text(), /not intercepted/)\n   })\n })"
        },
        {
            "sha": "db096f874dc433d77723e454fde982614a6f7233",
            "filename": "test/e2e/app-dir/interception-dynamic-segment/app/@modal/[...catchAll]/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment%2Fapp%2F%40modal%2F%5B...catchAll%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment%2Fapp%2F%40modal%2F%5B...catchAll%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment%2Fapp%2F%40modal%2F%5B...catchAll%5D%2Fpage.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1,3 +1,3 @@\n export default function CatchAll() {\n-  return null\n+  return 'catch-all'\n }"
        },
        {
            "sha": "2c6e0672552c6788cf9e74960dd5225e6fb2fd70",
            "filename": "test/e2e/app-dir/interception-dynamic-segment/app/@modal/default.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment%2Fapp%2F%40modal%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment%2Fapp%2F%40modal%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment%2Fapp%2F%40modal%2Fdefault.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1 +1 @@\n-export default () => null\n+export default () => 'default'"
        },
        {
            "sha": "90d9ef22b6e5354c70162f644fb816934132e78c",
            "filename": "test/e2e/app-dir/interception-dynamic-segment/interception-dynamic-segment.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment%2Finterception-dynamic-segment.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment%2Finterception-dynamic-segment.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Finterception-dynamic-segment%2Finterception-dynamic-segment.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1,5 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { check } from 'next-test-utils'\n+import { retry } from 'next-test-utils'\n \n describe('interception-dynamic-segment', () => {\n   const { next, isNextStart } = nextTestSetup({\n@@ -10,10 +10,18 @@ describe('interception-dynamic-segment', () => {\n     const browser = await next.browser('/')\n \n     await browser.elementByCss('[href=\"/foo/1\"]').click()\n-    await check(() => browser.elementById('modal').text(), /intercepted/)\n+    await retry(async () => {\n+      expect(await browser.elementById('modal').text()).toEqual('intercepted')\n+    })\n     await browser.refresh()\n-    await check(() => browser.elementById('modal').text(), '')\n-    await check(() => browser.elementById('children').text(), /not intercepted/)\n+    await retry(async () => {\n+      expect(await browser.elementById('modal').text()).toEqual('catch-all')\n+    })\n+    await retry(async () => {\n+      expect(await browser.elementById('children').text()).toEqual(\n+        'not intercepted'\n+      )\n+    })\n   })\n \n   if (isNextStart) {"
        },
        {
            "sha": "2c6e0672552c6788cf9e74960dd5225e6fb2fd70",
            "filename": "test/e2e/app-dir/interception-middleware-rewrite/app/[lang]/@modal/default.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-middleware-rewrite%2Fapp%2F%5Blang%5D%2F%40modal%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-middleware-rewrite%2Fapp%2F%5Blang%5D%2F%40modal%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Finterception-middleware-rewrite%2Fapp%2F%5Blang%5D%2F%40modal%2Fdefault.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1 +1 @@\n-export default () => null\n+export default () => 'default'"
        },
        {
            "sha": "ad0cb55b323ec49d18db20345d3d0e9094346c8f",
            "filename": "test/e2e/app-dir/interception-middleware-rewrite/interception-middleware-rewrite.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-middleware-rewrite%2Finterception-middleware-rewrite.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-middleware-rewrite%2Finterception-middleware-rewrite.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Finterception-middleware-rewrite%2Finterception-middleware-rewrite.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -15,24 +15,24 @@ describe('interception-middleware-rewrite', () => {\n   it('should support intercepting routes with a middleware rewrite', async () => {\n     const browser = await next.browser('/')\n \n-    await check(() => browser.waitForElementByCss('#children').text(), 'root')\n+    await check(() => browser.elementByCss('#children').text(), 'root')\n \n     await check(\n       () =>\n         browser\n           .elementByCss('[href=\"/feed\"]')\n           .click()\n-          .waitForElementByCss('#modal')\n+          .elementByCss('#modal')\n           .text(),\n       'intercepted'\n     )\n \n     await check(\n-      () => browser.refresh().waitForElementByCss('#children').text(),\n+      () => browser.refresh().elementByCss('#children').text(),\n       'not intercepted'\n     )\n \n-    await check(() => browser.waitForElementByCss('#modal').text(), '')\n+    await check(() => browser.elementByCss('#modal').text(), 'default')\n   })\n \n   it('should continue to work after using browser back button and following another intercepting route', async () => {\n@@ -73,7 +73,7 @@ describe('interception-middleware-rewrite', () => {\n     )\n \n     // modal should no longer be showing\n-    await check(() => browser.elementById('modal').text(), '')\n+    await check(() => browser.elementById('modal').text(), 'default')\n \n     await browser.back()\n "
        },
        {
            "sha": "f45f99012040ac0326a7d2b2c1daa25c788e1c53",
            "filename": "test/e2e/app-dir/interception-middleware-rewrite/tsconfig.json",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-middleware-rewrite%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Finterception-middleware-rewrite%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Finterception-middleware-rewrite%2Ftsconfig.json?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1,25 +1,24 @@\n {\n   \"compilerOptions\": {\n+    \"target\": \"ES2017\",\n     \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n     \"allowJs\": true,\n     \"skipLibCheck\": true,\n     \"strict\": false,\n-    \"forceConsistentCasingInFileNames\": true,\n     \"noEmit\": true,\n     \"incremental\": true,\n-    \"esModuleInterop\": true,\n     \"module\": \"esnext\",\n-    \"moduleResolution\": \"bundler\",\n+    \"esModuleInterop\": true,\n+    \"moduleResolution\": \"node\",\n     \"resolveJsonModule\": true,\n     \"isolatedModules\": true,\n-    \"jsx\": \"preserve\",\n+    \"jsx\": \"react-jsx\",\n     \"plugins\": [\n       {\n         \"name\": \"next\"\n       }\n-    ],\n-    \"target\": \"ES2017\"\n+    ]\n   },\n   \"include\": [\"next-env.d.ts\", \".next/types/**/*.ts\", \"**/*.ts\", \"**/*.tsx\"],\n-  \"exclude\": [\"node_modules\"]\n+  \"exclude\": [\"node_modules\", \"**/*.test.ts\", \"**/*.test.tsx\"]\n }"
        },
        {
            "sha": "d886dd145346df41eeb4fc9b9d723636f934bd03",
            "filename": "test/e2e/app-dir/metadata-navigation/metadata-navigation.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fmetadata-navigation%2Fmetadata-navigation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fmetadata-navigation%2Fmetadata-navigation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-navigation%2Fmetadata-navigation.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -89,14 +89,14 @@ describe('app dir - metadata navigation', () => {\n \n     it('should show the index title', async () => {\n       const browser = await next.browser('/parallel-route')\n-      expect(await browser.elementByCss('title').text()).toBe('Home Layout')\n+      expect(await getTitle(browser)).toBe('Home Layout')\n     })\n \n     it('should show target page metadata after navigation', async () => {\n       const browser = await next.browser('/parallel-route')\n       await browser.elementByCss('#product-link').click()\n       await browser.waitForElementByCss('#product-title')\n-      expect(await browser.elementByCss('title').text()).toBe('Product Layout')\n+      expect(await getTitle(browser)).toBe('Product Layout')\n     })\n \n     it('should show target page metadata after navigation with back', async () => {\n@@ -105,7 +105,7 @@ describe('app dir - metadata navigation', () => {\n       await browser.waitForElementByCss('#product-title')\n       await browser.elementByCss('#home-link').click()\n       await browser.waitForElementByCss('#home-title')\n-      expect(await browser.elementByCss('title').text()).toBe('Home Layout')\n+      expect(await getTitle(browser)).toBe('Home Layout')\n     })\n   })\n "
        },
        {
            "sha": "e588b424b35e84e98c48889464863273a40fb7cc",
            "filename": "test/e2e/app-dir/metadata-streaming/metadata-streaming.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -98,9 +98,9 @@ describe('app-dir - metadata-streaming', () => {\n     it('should load the metadata in browser', async () => {\n       const browser = await next.browser('/dynamic-api')\n       await retry(async () => {\n-        expect(await browser.elementByCss('body title').text()).toMatch(\n-          /Dynamic api \\d+/\n-        )\n+        expect(\n+          await browser.elementByCss('body title', { state: 'attached' }).text()\n+        ).toMatch(/Dynamic api \\d+/)\n       })\n     })\n   })"
        },
        {
            "sha": "9ff7735d61c93f8878a985631d9478ffe0b7bfdb",
            "filename": "test/e2e/app-dir/navigation/app/page.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fapp%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fapp%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fapp%2Fpage.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -10,7 +10,7 @@ export default function Page() {\n       <Link id=\"set-query\" href=\"/?a=b&c=d\">\n         set Query\n       </Link>\n-      <div id=\"query\">{params.toString()}</div>\n+      <div id=\"query\">{params.toString() || '<empty-query>'}</div>\n     </>\n   )\n }"
        },
        {
            "sha": "0cef1547a6cf6ec11a39ae56c0d620a228208146",
            "filename": "test/e2e/app-dir/navigation/navigation.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fnavigation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fnavigation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fnavigation.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1,5 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { retry, waitFor } from 'next-test-utils'\n+import { getTitle, retry, waitFor } from 'next-test-utils'\n \n describe('app dir - navigation', () => {\n   const { next, isNextDev, isNextStart, isNextDeploy } = nextTestSetup({\n@@ -10,7 +10,7 @@ describe('app dir - navigation', () => {\n     it('should set query correctly', async () => {\n       const browser = await next.browser('/')\n       expect(await browser.elementById('query').text()).toMatchInlineSnapshot(\n-        `\"\"`\n+        `\"<empty-query>\"`\n       )\n \n       await browser.elementById('set-query').click()\n@@ -895,7 +895,7 @@ describe('app dir - navigation', () => {\n       await waitFor(resolveMetadataDuration + 500)\n \n       expect(await browser.elementById('page-content').text()).toBe('Content')\n-      expect(await browser.elementByCss('title').text()).toBe('Async Title')\n+      expect(await getTitle(browser)).toBe('Async Title')\n     })\n \n     it('shows a fallback when prefetch completed', async () => {"
        },
        {
            "sha": "f2cf6d010f1aed174f3e5ca7b4847a06579a6a58",
            "filename": "test/e2e/app-dir/parallel-routes-use-selected-layout-segment/app/layout.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 10,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fparallel-routes-use-selected-layout-segment%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fparallel-routes-use-selected-layout-segment%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-routes-use-selected-layout-segment%2Fapp%2Flayout.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -34,17 +34,11 @@ export default function RootLayout({\n               Reset with Mobile (/app/@auth/reset/withMobile)\n             </Link>\n           </nav>\n-          <div>\n-            navSegment (parallel route): <div id=\"navSegment\">{navSegment}</div>\n-          </div>\n-          <div>\n-            authSegment (parallel route):{' '}\n-            <div id=\"authSegment\">{authSegment}</div>\n-          </div>\n-          <div>\n-            routeSegment (app route):{' '}\n-            <div id=\"routeSegment\">{routeSegment}</div>\n+          <div id=\"navSegment\">navSegment (parallel route): {navSegment}</div>\n+          <div id=\"authSegment\">\n+            authSegment (parallel route): {authSegment}\n           </div>\n+          <div id=\"routeSegment\">routeSegment (app route): {routeSegment}</div>\n \n           <section id=\"navSlot\">{nav}</section>\n           <section id=\"authSlot\">{auth}</section>"
        },
        {
            "sha": "ec75ba965b6660eda1116d374f8a0b0258e80bd7",
            "filename": "test/e2e/app-dir/parallel-routes-use-selected-layout-segment/parallel-routes-use-selected-layout-segment.test.ts",
            "status": "modified",
            "additions": 120,
            "deletions": 30,
            "changes": 150,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fparallel-routes-use-selected-layout-segment%2Fparallel-routes-use-selected-layout-segment.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fparallel-routes-use-selected-layout-segment%2Fparallel-routes-use-selected-layout-segment.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-routes-use-selected-layout-segment%2Fparallel-routes-use-selected-layout-segment.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -8,66 +8,156 @@ describe('parallel-routes-use-selected-layout-segment', () => {\n \n   it('hard nav to router page and soft nav around other router pages', async () => {\n     const browser = await next.browser('/')\n-    await check(() => browser.elementById('navSegment').text(), /^$/)\n-    await check(() => browser.elementById('authSegment').text(), /^$/)\n-    await check(() => browser.elementById('routeSegment').text(), /^$/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route):'\n+    )\n \n     await browser.elementByCss('[href=\"/foo\"]').click()\n-    await check(() => browser.elementById('navSegment').text(), /^$/)\n-    await check(() => browser.elementById('authSegment').text(), /^$/)\n-    await check(() => browser.elementById('routeSegment').text(), /foo/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route): foo'\n+    )\n   })\n \n   it('hard nav to router page and soft nav to parallel routes', async () => {\n     const browser = await next.browser('/')\n-    await check(() => browser.elementById('navSegment').text(), /^$/)\n-    await check(() => browser.elementById('authSegment').text(), /^$/)\n-    await check(() => browser.elementById('routeSegment').text(), /^$/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route):'\n+    )\n \n     // soft nav to /login, since both @nav and @auth has /login defined, we expect both navSegment and authSegment to be 'login'\n     await browser.elementByCss('[href=\"/login\"]').click()\n-    await check(() => browser.elementById('navSegment').text(), /login/)\n-    await check(() => browser.elementById('authSegment').text(), /login/)\n-    await check(() => browser.elementById('routeSegment').text(), /^$/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route): login'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route): login'\n+    )\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route):'\n+    )\n \n     // when navigating to /reset, the @auth slot will render the /reset page ('reset') while maintaining the currently active page for the @nav slot ('login') since /reset is only defined in @auth\n     await browser.elementByCss('[href=\"/reset\"]').click()\n-    await check(() => browser.elementById('navSegment').text(), /login/)\n-    await check(() => browser.elementById('authSegment').text(), /reset/)\n-    await check(() => browser.elementById('routeSegment').text(), /^$/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route): login'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route): reset'\n+    )\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route):'\n+    )\n \n     // when navigating to nested path /reset/withEmail, the @auth slot will render the nested /reset/withEmail page ('reset') while maintaining the currently active page for the @nav slot ('login') since /reset/withEmail is only defined in @auth\n     await browser.elementByCss('[href=\"/reset/withEmail\"]').click()\n-    await check(() => browser.elementById('navSegment').text(), /login/)\n-    await check(() => browser.elementById('authSegment').text(), /withEmail/)\n-    await check(() => browser.elementById('routeSegment').text(), /^$/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route): login'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route): withEmail'\n+    )\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route):'\n+    )\n   })\n \n   it('hard nav to router page and soft nav to parallel route and soft nav back to another router page', async () => {\n     const browser = await next.browser('/')\n-    await check(() => browser.elementById('navSegment').text(), /^$/)\n-    await check(() => browser.elementById('authSegment').text(), /^$/)\n-    await check(() => browser.elementById('routeSegment').text(), /^$/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route):'\n+    )\n \n     // when navigating to /reset, the @auth slot will render the /reset page ('reset') while maintaining the currently active page for the @nav slot ('null') since /reset is only defined in @auth\n     await browser.elementByCss('[href=\"/reset\"]').click()\n-    await check(() => browser.elementById('navSegment').text(), /^$/)\n-    await check(() => browser.elementById('authSegment').text(), /reset/)\n-    await check(() => browser.elementById('routeSegment').text(), /^$/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route): reset'\n+    )\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route):'\n+    )\n \n     // when soft navigate to /foo, the @auth and @nav slot will maintain their the currently active states since they do not have /foo defined\n     await browser.elementByCss('[href=\"/foo\"]').click()\n-    await check(() => browser.elementById('navSegment').text(), /^$/)\n-    await check(() => browser.elementById('authSegment').text(), /reset/)\n-    await check(() => browser.elementById('routeSegment').text(), /foo/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route): reset'\n+    )\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route): foo'\n+    )\n   })\n \n   it('hard nav to parallel route', async () => {\n     const browser = await next.browser('/reset/withMobile')\n-    await check(() => browser.elementById('navSegment').text(), /^$/)\n-    await check(() => browser.elementById('authSegment').text(), /withMobile/)\n+    await check(\n+      () => browser.elementById('navSegment').text(),\n+      'navSegment (parallel route):'\n+    )\n+    await check(\n+      () => browser.elementById('authSegment').text(),\n+      'authSegment (parallel route): withMobile'\n+    )\n \n     // the /app/default.tsx is rendered since /reset/withMobile is only defined in @auth\n-    await check(() => browser.elementById('routeSegment').text(), /^$/)\n+    await check(\n+      () => browser.elementById('routeSegment').text(),\n+      'routeSegment (app route):'\n+    )\n   })\n })"
        },
        {
            "sha": "f5b3f7f427322ab66a6c96db94c9b415a193274a",
            "filename": "test/e2e/app-dir/ppr-metadata-streaming/ppr-metadata-streaming.test.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 14,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fppr-metadata-streaming%2Fppr-metadata-streaming.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fppr-metadata-streaming%2Fppr-metadata-streaming.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-metadata-streaming%2Fppr-metadata-streaming.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -23,7 +23,9 @@ describe('ppr-metadata-streaming', () => {\n         pushErrorAsConsoleLog: true,\n       })\n       expect(\n-        await browser.waitForElementByCss(`${rootSelector} title`).text()\n+        await browser\n+          .waitForElementByCss(`${rootSelector} title`, { state: 'attached' })\n+          .text()\n       ).toBe('fully static')\n       await assertNoConsoleErrors(browser)\n     })\n@@ -36,9 +38,11 @@ describe('ppr-metadata-streaming', () => {\n       const browser = await next.browser('/dynamic-page', {\n         pushErrorAsConsoleLog: true,\n       })\n-      expect(await browser.waitForElementByCss('body title').text()).toBe(\n-        'dynamic page'\n-      )\n+      expect(\n+        await browser\n+          .waitForElementByCss('body title', { state: 'attached' })\n+          .text()\n+      ).toBe('dynamic page')\n       await assertNoConsoleErrors(browser)\n     })\n   })\n@@ -53,9 +57,11 @@ describe('ppr-metadata-streaming', () => {\n       const browser = await next.browser('/fully-dynamic', {\n         pushErrorAsConsoleLog: true,\n       })\n-      expect(await browser.waitForElementByCss('body title').text()).toBe(\n-        'fully dynamic'\n-      )\n+      expect(\n+        await browser\n+          .waitForElementByCss('body title', { state: 'attached' })\n+          .text()\n+      ).toBe('fully dynamic')\n       await assertNoConsoleErrors(browser)\n     })\n \n@@ -65,9 +71,11 @@ describe('ppr-metadata-streaming', () => {\n       expect(countSubstring($.html(), '<title>')).toBe(1)\n \n       const browser = await next.browser('/dynamic-metadata')\n-      expect(await browser.waitForElementByCss('body title').text()).toBe(\n-        'dynamic metadata'\n-      )\n+      expect(\n+        await browser\n+          .waitForElementByCss('body title', { state: 'attached' })\n+          .text()\n+      ).toBe('dynamic metadata')\n       await assertNoConsoleErrors(browser)\n     })\n   })\n@@ -81,9 +89,11 @@ describe('ppr-metadata-streaming', () => {\n       const browser = await next.browser('/dynamic-metadata/partial', {\n         pushErrorAsConsoleLog: true,\n       })\n-      expect(await browser.waitForElementByCss('body title').text()).toBe(\n-        'dynamic-metadata - partial'\n-      )\n+      expect(\n+        await browser\n+          .waitForElementByCss('body title', { state: 'attached' })\n+          .text()\n+      ).toBe('dynamic-metadata - partial')\n       await assertNoConsoleErrors(browser)\n     })\n \n@@ -97,7 +107,9 @@ describe('ppr-metadata-streaming', () => {\n         pushErrorAsConsoleLog: true,\n       })\n       expect(\n-        await browser.waitForElementByCss(`${rootSelector} title`).text()\n+        await browser\n+          .waitForElementByCss(`${rootSelector} title`, { state: 'attached' })\n+          .text()\n       ).toBe('dynamic-page - partial')\n       await assertNoConsoleErrors(browser)\n     })"
        },
        {
            "sha": "07872d629eefbe8b38c45199177e3148cdce7713",
            "filename": "test/e2e/app-dir/ppr-partial-hydration/ppr-partial-hydration.test.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 21,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fppr-partial-hydration%2Fppr-partial-hydration.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fppr-partial-hydration%2Fppr-partial-hydration.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-partial-hydration%2Fppr-partial-hydration.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -4,8 +4,8 @@\n // no shell + no metadata\n // no shell + streaming metadata\n \n-import { nextTestSetup } from '../../../lib/e2e-utils'\n-import { retry } from '../../../lib/next-test-utils'\n+import { nextTestSetup } from 'e2e-utils'\n+import { retry } from 'next-test-utils'\n \n describe('PPR - partial hydration', () => {\n   const { next, isNextDev } = nextTestSetup({ files: __dirname })\n@@ -51,16 +51,13 @@ describe('PPR - partial hydration', () => {\n           // without waiting for the dynamic content\n           expect(\n             await browser\n-              .elementByCssInstant('#shell-hydrated', { state: 'visible' })\n+              .elementByCssInstant('#shell-hydrated')\n               .getAttribute('data-is-hydrated')\n           ).toBe('true')\n \n           // The dynamic content hasn't streamed in yet, we should only see the fallback\n-          expect(await browser.elementsByCss('main #dynamic')).toHaveLength(0)\n           expect(\n-            await browser\n-              .elementByCssInstant('#dynamic-fallback', { state: 'visible' })\n-              .text()\n+            await browser.elementByCssInstant('#dynamic-fallback').text()\n           ).toContain('Loading...')\n         },\n         1000,\n@@ -72,19 +69,17 @@ describe('PPR - partial hydration', () => {\n         // The shell is already hydrated, this shouldn't change\n         expect(\n           await browser\n-            .elementByCssInstant('#shell-hydrated', { state: 'visible' })\n+            .elementByCssInstant('#shell-hydrated')\n             .getAttribute('data-is-hydrated')\n         ).toBe('true')\n \n         // The dynamic content should be visible and hydrated\n+        expect(await browser.elementByCssInstant('#dynamic').text()).toMatch(\n+          /Random value: \\d+/\n+        )\n         expect(\n           await browser\n-            .elementByCssInstant('#dynamic', { state: 'visible' })\n-            .text()\n-        ).toMatch(/Random value: \\d+/)\n-        expect(\n-          await browser\n-            .elementByCssInstant('#dynamic-hydrated', { state: 'visible' })\n+            .elementByCssInstant('#dynamic-hydrated')\n             .getAttribute('data-is-hydrated')\n         ).toBe('true')\n       })\n@@ -122,18 +117,15 @@ describe('PPR - partial hydration', () => {\n       )\n       expect(\n         await browser\n-          .elementByCss('#shell-hydrated', { state: 'visible' })\n+          .elementByCss('#shell-hydrated')\n           .getAttribute('data-is-hydrated')\n       ).toBe('false')\n \n       // The dynamic content can't be inserted into the document because we disabled JS,\n       // so we should only see the fallback\n-      expect(await browser.elementsByCss('main #dynamic')).toHaveLength(0)\n-      expect(\n-        await browser\n-          .elementByCss('#dynamic-fallback', { state: 'visible' })\n-          .text()\n-      ).toContain('Loading...')\n+      expect(await browser.elementByCss('#dynamic-fallback').text()).toContain(\n+        'Loading...'\n+      )\n     })\n   })\n })"
        },
        {
            "sha": "d8cc33b2eb4726910802452e8a88c3458d8e6a80",
            "filename": "test/e2e/app-dir/rsc-basic/rsc-basic.test.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 6,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -75,37 +75,55 @@ describe('app dir - rsc basics', () => {\n \n   it('should correctly render page returning null', async () => {\n     const browser = await next.browser('/return-null/page')\n-    expect(await browser.elementByCss('#return-null-layout').text()).toBeEmpty()\n+    expect(\n+      await browser\n+        .elementByCss('#return-null-layout', { state: 'attached' })\n+        .text()\n+    ).toBeEmpty()\n   })\n \n   it('should correctly render component returning null', async () => {\n     const browser = await next.browser('/return-null/component')\n-    expect(await browser.elementByCss('#return-null-layout').text()).toBeEmpty()\n+    expect(\n+      await browser\n+        .elementByCss('#return-null-layout', { state: 'attached' })\n+        .text()\n+    ).toBeEmpty()\n   })\n \n   it('should correctly render layout returning null', async () => {\n     const browser = await next.browser('/return-null/layout')\n-    expect(await browser.elementByCss('#return-null-layout').text()).toBeEmpty()\n+    expect(\n+      await browser\n+        .elementByCss('#return-null-layout', { state: 'attached' })\n+        .text()\n+    ).toBeEmpty()\n   })\n \n   it('should correctly render page returning undefined', async () => {\n     const browser = await next.browser('/return-undefined/page')\n     expect(\n-      await browser.elementByCss('#return-undefined-layout').text()\n+      await browser\n+        .elementByCss('#return-undefined-layout', { state: 'attached' })\n+        .text()\n     ).toBeEmpty()\n   })\n \n   it('should correctly render component returning undefined', async () => {\n     const browser = await next.browser('/return-undefined/component')\n     expect(\n-      await browser.elementByCss('#return-undefined-layout').text()\n+      await browser\n+        .elementByCss('#return-undefined-layout', { state: 'attached' })\n+        .text()\n     ).toBeEmpty()\n   })\n \n   it('should correctly render layout returning undefined', async () => {\n     const browser = await next.browser('/return-undefined/layout')\n     expect(\n-      await browser.elementByCss('#return-undefined-layout').text()\n+      await browser\n+        .elementByCss('#return-undefined-layout', { state: 'attached' })\n+        .text()\n     ).toBeEmpty()\n   })\n "
        },
        {
            "sha": "546713a8abf5833b9ddaee75383b3d50d6590b1c",
            "filename": "test/e2e/app-dir/script-before-interactive/script-before-interactive.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fscript-before-interactive%2Fscript-before-interactive.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fscript-before-interactive%2Fscript-before-interactive.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fscript-before-interactive%2Fscript-before-interactive.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -9,7 +9,7 @@ describe('Script component with beforeInteractive strategy CSS class rendering',\n     const browser = await next.browser('/')\n \n     // Wait for the page to fully load\n-    await browser.waitForElementByCss('#example-script')\n+    await browser.waitForElementByCss('script#example-script')\n \n     // Get the HTML content to check the actual rendered attributes\n     const html = await browser.eval(() => document.documentElement.innerHTML)\n@@ -19,7 +19,7 @@ describe('Script component with beforeInteractive strategy CSS class rendering',\n     expect(html).not.toContain('classname=\"example-class\"')\n \n     // Also verify the script element directly\n-    const scriptElement = await browser.elementByCss('#example-script')\n+    const scriptElement = await browser.elementByCss('script#example-script')\n     const className = await scriptElement.getAttribute('class')\n \n     expect(className).toBe('example-class')"
        },
        {
            "sha": "b2d4e03d74d16295e2492fde59b34d9789c572e1",
            "filename": "test/e2e/app-dir/shallow-routing/shallow-routing.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fshallow-routing%2Fshallow-routing.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fshallow-routing%2Fshallow-routing.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fshallow-routing%2Fshallow-routing.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -19,7 +19,7 @@ describe('shallow-routing', () => {\n       await browser\n         .elementByCss('#push-state')\n         .click()\n-        .waitForElementByCss('#state-updated')\n+        .waitForElementByCss('#state-updated', { state: 'attached' })\n         .elementByCss('#get-latest')\n         .click()\n       await check(\n@@ -192,7 +192,7 @@ describe('shallow-routing', () => {\n       await browser\n         .elementByCss('#replace-state')\n         .click()\n-        .waitForElementByCss('#state-updated')\n+        .waitForElementByCss('#state-updated', { state: 'attached' })\n         .elementByCss('#get-latest')\n         .click()\n       await check(\n@@ -408,7 +408,7 @@ describe('shallow-routing', () => {\n         await browser\n           .elementByCss('#push-state')\n           .click()\n-          .waitForElementByCss('#state-updated')\n+          .waitForElementByCss('#state-updated', { state: 'attached' })\n           .elementByCss('#get-latest')\n           .click()\n "
        },
        {
            "sha": "aa5238f2467cdefc45dba0e81537f67306b67377",
            "filename": "test/e2e/app-dir/third-parties/basic.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 20,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fthird-parties%2Fbasic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fthird-parties%2Fbasic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fthird-parties%2Fbasic.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1,5 +1,4 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { waitFor } from 'next-test-utils'\n \n describe('@next/third-parties basic usage', () => {\n   const { next } = nextTestSetup({\n@@ -33,18 +32,12 @@ describe('@next/third-parties basic usage', () => {\n   it('renders GTM', async () => {\n     const browser = await next.browser('/gtm')\n \n-    await browser.waitForElementByCss('#_next-gtm')\n-    await waitFor(1000)\n-\n-    const gtmInlineScript = await browser.elementsByCss('#_next-gtm-init')\n-    expect(gtmInlineScript.length).toBe(1)\n-\n-    const gtmScript = await browser.elementsByCss(\n-      '[src^=\"https://www.googletagmanager.com/gtm.js?id=GTM-XYZ\"]'\n+    await browser.waitForElementByCss('script#_next-gtm')\n+    await browser.elementByCss('script#_next-gtm-init')\n+    await browser.elementByCssInstant(\n+      'script[src^=\"https://www.googletagmanager.com/gtm.js?id=GTM-XYZ\"]'\n     )\n \n-    expect(gtmScript.length).toBe(1)\n-\n     const dataLayer = await browser.eval('window.dataLayer')\n     expect(dataLayer.length).toBe(1)\n \n@@ -57,17 +50,12 @@ describe('@next/third-parties basic usage', () => {\n   it('renders GA', async () => {\n     const browser = await next.browser('/ga')\n \n-    await browser.waitForElementByCss('#_next-ga')\n-    await waitFor(1000)\n-\n-    const gaInlineScript = await browser.elementsByCss('#_next-ga-init')\n-    expect(gaInlineScript.length).toBe(1)\n-\n-    const gaScript = await browser.elementsByCss(\n-      '[src^=\"https://www.googletagmanager.com/gtag/js?id=GA-XYZ\"]'\n+    await browser.waitForElementByCss('script#_next-ga')\n+    await browser.elementByCss('script#_next-ga-init')\n+    await browser.elementByCssInstant(\n+      'script[src^=\"https://www.googletagmanager.com/gtag/js?id=GA-XYZ\"]'\n     )\n \n-    expect(gaScript.length).toBe(1)\n     const dataLayer = await browser.eval('window.dataLayer')\n     expect(dataLayer.length).toBe(4)\n "
        },
        {
            "sha": "4db41db87eeabf8294f5c5ac71100ead4529eb6a",
            "filename": "test/e2e/app-dir/use-cache-private/app/cookies/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fuse-cache-private%2Fapp%2Fcookies%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fuse-cache-private%2Fapp%2Fcookies%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-private%2Fapp%2Fcookies%2Fpage.tsx?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -25,7 +25,7 @@ async function Private() {\n \n   return (\n     <pre>\n-      test-cookie: <span id=\"test-cookie\">{cookieHeader}</span>\n+      test-cookie: <span id=\"test-cookie\">{cookieHeader || '<empty>'}</span>\n     </pre>\n   )\n }"
        },
        {
            "sha": "cf0e4a6378b58113020d4a981ef511ad10d1a6dd",
            "filename": "test/e2e/app-dir/use-cache-private/use-cache-private.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fuse-cache-private%2Fuse-cache-private.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fapp-dir%2Fuse-cache-private%2Fuse-cache-private.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-private%2Fuse-cache-private.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -22,7 +22,7 @@ describe('use-cache-private', () => {\n   it('allows reading cookies in private caches', async () => {\n     const browser = await next.browser('/cookies')\n \n-    expect(await browser.elementById('test-cookie').text()).toBe('')\n+    expect(await browser.elementById('test-cookie').text()).toBe('<empty>')\n \n     await browser.addCookie({ name: 'test-cookie', value: 'foo' })\n     await browser.refresh()"
        },
        {
            "sha": "dfe0bb649a324bd07b7b04985b3501c3248f23c0",
            "filename": "test/e2e/basepath/basepath.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fbasepath%2Fbasepath.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fbasepath%2Fbasepath.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fbasepath%2Fbasepath.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -67,7 +67,7 @@ describe('basePath', () => {\n     await browser\n       .elementByCss('a')\n       .click()\n-      .waitForElementByCss('input')\n+      .waitForElementByCss('input', { state: 'attached' })\n       .back()\n       .waitForElementByCss('p')\n "
        },
        {
            "sha": "354fd18e7629b98bf8274d5add7305f5977746ff",
            "filename": "test/e2e/third-parties/index.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fthird-parties%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Fthird-parties%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fthird-parties%2Findex.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -32,7 +32,7 @@ describe('@next/third-parties basic usage', () => {\n   it('renders GTM', async () => {\n     const browser = await next.browser('/gtm')\n \n-    await browser.waitForElementByCss('#_next-gtm')\n+    await browser.waitForElementByCss('script#_next-gtm')\n     await waitFor(1000)\n \n     const gtmInlineScript = await browser.elementsByCss('#_next-gtm-init')\n@@ -56,7 +56,7 @@ describe('@next/third-parties basic usage', () => {\n   it('renders GA', async () => {\n     const browser = await next.browser('/ga')\n \n-    await browser.waitForElementByCss('#_next-ga')\n+    await browser.waitForElementByCss('script#_next-ga')\n     await waitFor(1000)\n \n     const gaInlineScript = await browser.elementsByCss('#_next-ga-init')"
        },
        {
            "sha": "4a5878d26ec27430715ffe6b7cecb9ae88c21648",
            "filename": "test/e2e/trailing-slashes/shared-tests.util.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Ftrailing-slashes%2Fshared-tests.util.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fe2e%2Ftrailing-slashes%2Fshared-tests.util.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftrailing-slashes%2Fshared-tests.util.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -45,7 +45,9 @@ export function testShouldResolve(\n       try {\n         browser = await next.browser(route)\n \n-        await browser.waitForElementByCss('#hydration-marker')\n+        await browser.waitForElementByCss('#hydration-marker', {\n+          state: 'attached',\n+        })\n         const text = await browser.elementByCss('#page-marker').text()\n         expect(text).toBe(expectedPage)\n         const routerPathname = await browser\n@@ -92,7 +94,9 @@ export function testLinkShouldRewriteTo(\n         browser = await next.browser(linkPage)\n         await browser.elementByCss('#link').click()\n \n-        await browser.waitForElementByCss('#hydration-marker')\n+        await browser.waitForElementByCss('#hydration-marker', {\n+          state: 'attached',\n+        })\n         const url = new URL(await browser.eval('window.location.href'))\n         const pathname = url.href.slice(url.origin.length)\n         expect(pathname).toBe(expectedHref)\n@@ -110,7 +114,9 @@ export function testLinkShouldRewriteTo(\n         browser = await next.browser(linkPage)\n         await browser.elementByCss('#route-pusher').click()\n \n-        await browser.waitForElementByCss('#hydration-marker')\n+        await browser.waitForElementByCss('#hydration-marker', {\n+          state: 'attached',\n+        })\n         const url = new URL(await browser.eval('window.location.href'))\n         const pathname = url.href.slice(url.origin.length)\n         expect(pathname).toBe(expectedHref)"
        },
        {
            "sha": "945aeba52da3385988e04821a21b8db6af844fc4",
            "filename": "test/integration/config-mjs/pages/next-config.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fconfig-mjs%2Fpages%2Fnext-config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fconfig-mjs%2Fpages%2Fnext-config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fconfig-mjs%2Fpages%2Fnext-config.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -3,7 +3,7 @@ const { serverRuntimeConfig, publicRuntimeConfig } = getConfig()\n \n export default () => (\n   <div>\n-    <p id=\"server-only\">{serverRuntimeConfig.mySecret}</p>\n+    <p id=\"server-only\">server-only: {serverRuntimeConfig.mySecret || '***'}</p>\n     <p id=\"server-and-client\">{publicRuntimeConfig.staticFolder}</p>\n     <p id=\"env\">{process.env.customVar}</p>\n   </div>"
        },
        {
            "sha": "16a13738f99f91e54fd340a89b964b5d29234eb2",
            "filename": "test/integration/config-mjs/test/index.test.ts",
            "status": "renamed",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fconfig-mjs%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fconfig-mjs%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fconfig-mjs%2Ftest%2Findex.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -6,7 +6,7 @@ import webdriver from 'next-webdriver'\n import fetch from 'node-fetch'\n import { join } from 'path'\n \n-const context = {}\n+const context = { output: '', appPort: -1, server: undefined }\n \n describe('Configuration', () => {\n   beforeAll(async () => {\n@@ -33,7 +33,7 @@ describe('Configuration', () => {\n     await killApp(context.server)\n   })\n \n-  async function get$(path, query) {\n+  async function get$(path: string, query?: any) {\n     const html = await renderViaHTTP(context.appPort, path, query)\n     return cheerio.load(html)\n   }\n@@ -46,7 +46,7 @@ describe('Configuration', () => {\n \n   test('renders server config on the server only', async () => {\n     const $ = await get$('/next-config')\n-    expect($('#server-only').text()).toBe('secret')\n+    expect($('#server-only').text()).toBe('server-only: secret')\n   })\n \n   test('renders public config on the server only', async () => {\n@@ -68,7 +68,7 @@ describe('Configuration', () => {\n       .text()\n     const envValue = await browser.elementByCss('#env').text()\n \n-    expect(serverText).toBe('')\n+    expect(serverText).toBe('server-only: ***')\n     expect(serverClientText).toBe('/static')\n     expect(envValue).toBe('hello')\n     await browser.close()",
            "previous_filename": "test/integration/config-mjs/test/index.test.js"
        },
        {
            "sha": "945aeba52da3385988e04821a21b8db6af844fc4",
            "filename": "test/integration/config/pages/next-config.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fconfig%2Fpages%2Fnext-config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fconfig%2Fpages%2Fnext-config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fconfig%2Fpages%2Fnext-config.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -3,7 +3,7 @@ const { serverRuntimeConfig, publicRuntimeConfig } = getConfig()\n \n export default () => (\n   <div>\n-    <p id=\"server-only\">{serverRuntimeConfig.mySecret}</p>\n+    <p id=\"server-only\">server-only: {serverRuntimeConfig.mySecret || '***'}</p>\n     <p id=\"server-and-client\">{publicRuntimeConfig.staticFolder}</p>\n     <p id=\"env\">{process.env.customVar}</p>\n   </div>"
        },
        {
            "sha": "2bad399016e629c92c6b391c8ae2c0a2eee8a65b",
            "filename": "test/integration/config/test/index.test.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fconfig%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fconfig%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fconfig%2Ftest%2Findex.test.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -46,7 +46,7 @@ describe('Configuration', () => {\n \n   test('renders server config on the server only', async () => {\n     const $ = await get$('/next-config')\n-    expect($('#server-only').text()).toBe('secret')\n+    expect($('#server-only').text()).toBe('server-only: secret')\n   })\n \n   test('renders public config on the server only', async () => {\n@@ -68,7 +68,7 @@ describe('Configuration', () => {\n       .text()\n     const envValue = await browser.elementByCss('#env').text()\n \n-    expect(serverText).toBe('')\n+    expect(serverText).toBe('server-only: ***')\n     expect(serverClientText).toBe('/static')\n     expect(envValue).toBe('hello')\n     await browser.close()"
        },
        {
            "sha": "849e57f244567784c9caa6e6620da2e2c9260ac1",
            "filename": "test/integration/env-config/app/pages/index.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fenv-config%2Fapp%2Fpages%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fenv-config%2Fapp%2Fpages%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fenv-config%2Fapp%2Fpages%2Findex.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -55,7 +55,7 @@ export default function Page({ env }) {\n         {process.env.NEXT_PUBLIC_NEW_NEXT_CONFIG_VALUE}\n       </div>\n       <div id=\"nextPublicEmptyEnvVar\">\n-        {`${process.env.NEXT_PUBLIC_EMPTY_ENV_VAR}`}\n+        content: {`${process.env.NEXT_PUBLIC_EMPTY_ENV_VAR}`}\n       </div>\n     </>\n   )"
        },
        {
            "sha": "b38abee43c93350b98813f29300a3a6b767f2d80",
            "filename": "test/integration/env-config/test/index.test.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fenv-config%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fenv-config%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fenv-config%2Ftest%2Findex.test.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -134,7 +134,7 @@ const runTests = (mode = 'dev', didReload = false) => {\n     // Verify that after hydration, the empty env var is not replaced by undefined\n     expect(\n       await browser.waitForElementByCss('#nextPublicEmptyEnvVar').text()\n-    ).toBe('')\n+    ).toBe('content:')\n   })\n }\n "
        },
        {
            "sha": "a99c7a0273c5fff51dd2517952bfcb342283368e",
            "filename": "test/integration/hydrate-then-render/test/index.test.ts",
            "status": "renamed",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fhydrate-then-render%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fhydrate-then-render%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fhydrate-then-render%2Ftest%2Findex.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -5,8 +5,8 @@ import webdriver from 'next-webdriver'\n import { join } from 'path'\n \n const appDir = join(__dirname, '../')\n-let appPort\n-let server\n+let appPort: number\n+let server: Awaited<ReturnType<typeof nextStart>>\n \n describe('hydrate/render ordering', () => {\n   ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n@@ -23,7 +23,7 @@ describe('hydrate/render ordering', () => {\n         const browser = await webdriver(appPort, '/')\n         await browser.waitForElementByCss('#to-other')\n         await browser.elementByCss('#to-other').click()\n-        await browser.waitForElementByCss('#on-other')\n+        await browser.waitForElementByCss('#on-other', { state: 'attached' })\n \n         const beacons = (await browser.eval('window.__BEACONS'))\n           .map(([, value]) => Object.fromEntries(new URLSearchParams(value)))",
            "previous_filename": "test/integration/hydrate-then-render/test/index.test.js"
        },
        {
            "sha": "50ba4e7330f0ad20ddd26cf37338513efe665e60",
            "filename": "test/integration/index-index/test/index.test.ts",
            "status": "renamed",
            "additions": 16,
            "deletions": 9,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Findex-index%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Findex-index%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Findex-index%2Ftest%2Findex.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -16,11 +16,14 @@ import {\n import webdriver from 'next-webdriver'\n import { join } from 'path'\n \n-let app\n-let appPort\n+let app: Awaited<ReturnType<typeof launchApp>>\n+let appPort: number\n const appDir = join(__dirname, '../')\n \n-function runTests() {\n+function runTests(testMode: 'start' | 'dev') {\n+  const testNotWebpackDev =\n+    testMode !== 'dev' || process.env.IS_TURBOPACK_TEST ? it : it.failing\n+\n   it('should ssr page /', async () => {\n     const html = await renderViaHTTP(appPort, '/')\n     const $ = cheerio.load(html)\n@@ -54,7 +57,8 @@ function runTests() {\n     expect($('#page').text()).toBe('index > index')\n   })\n \n-  it('should client render page /index', async () => {\n+  // FIXME: pages named \"index\" are never hydrated in Webpack during development\n+  testNotWebpackDev('should client render page /index', async () => {\n     const browser = await webdriver(appPort, '/index')\n     try {\n       const text = await browser.elementByCss('#page').text()\n@@ -81,7 +85,8 @@ function runTests() {\n     expect($('#page').text()).toBe('index > user')\n   })\n \n-  it('should client render page /index/user', async () => {\n+  // FIXME: pages named \"index\" are never hydrated in Webpack during development\n+  testNotWebpackDev('should client render page /index/user', async () => {\n     const browser = await webdriver(appPort, '/index/user')\n     try {\n       const text = await browser.elementByCss('#page').text()\n@@ -108,7 +113,8 @@ function runTests() {\n     expect($('#page').text()).toBe('index > project')\n   })\n \n-  it('should client render page /index/project', async () => {\n+  // FIXME: pages named \"index\" are never hydrated in Webpack during development\n+  testNotWebpackDev('should client render page /index/project', async () => {\n     const browser = await webdriver(appPort, '/index/project')\n     try {\n       const text = await browser.elementByCss('#page').text()\n@@ -138,7 +144,8 @@ function runTests() {\n     expect($('#page').text()).toBe('index > index > index')\n   })\n \n-  it('should client render page /index/index', async () => {\n+  // FIXME: pages named \"index\" are never hydrated in Webpack during development\n+  testNotWebpackDev('should client render page /index/index', async () => {\n     const browser = await webdriver(appPort, '/index/index')\n     try {\n       const text = await browser.elementByCss('#page').text()\n@@ -191,7 +198,7 @@ describe('nested index.js', () => {\n       })\n       afterAll(() => killApp(app))\n \n-      runTests()\n+      runTests('dev')\n     }\n   )\n   ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n@@ -210,7 +217,7 @@ describe('nested index.js', () => {\n       })\n       afterAll(() => killApp(app))\n \n-      runTests()\n+      runTests('start')\n     }\n   )\n })",
            "previous_filename": "test/integration/index-index/test/index.test.js"
        },
        {
            "sha": "987691328b4650e79a797aed66dd00582370674a",
            "filename": "test/integration/middleware-dev-update/pages/index.js",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fmiddleware-dev-update%2Fpages%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fmiddleware-dev-update%2Fpages%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fmiddleware-dev-update%2Fpages%2Findex.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -1,4 +1,6 @@\n-export default (props) => <div id=\"from-middleware\">{props.fromMiddleware}</div>\n+export default (props) => (\n+  <div id=\"from-middleware\">{String(props.fromMiddleware)}</div>\n+)\n \n export async function getServerSideProps({ req, res }) {\n   return {"
        },
        {
            "sha": "9174f4e20feb46e215630af0152492a9cfc197dd",
            "filename": "test/integration/middleware-dev-update/test/index.test.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fmiddleware-dev-update%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fmiddleware-dev-update%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fmiddleware-dev-update%2Ftest%2Findex.test.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -53,7 +53,7 @@ describe('Middleware development errors', () => {\n   async function assertMiddlewareRender(hasMiddleware, path = '/') {\n     const browser = await webdriver(context.appPort, path)\n     const fromMiddleware = await browser.elementById('from-middleware').text()\n-    expect(fromMiddleware).toBe(hasMiddleware ? 'true' : '')\n+    expect(fromMiddleware).toBe(hasMiddleware ? 'true' : 'null')\n   }\n \n   describe('when middleware is removed', () => {"
        },
        {
            "sha": "b8f2bde5179f727d31f5ad8d2c22c2d2c726c620",
            "filename": "test/integration/react-current-version/test/index.test.ts",
            "status": "renamed",
            "additions": 27,
            "deletions": 8,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Freact-current-version%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Freact-current-version%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Freact-current-version%2Ftest%2Findex.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -10,7 +10,7 @@ import {\n   runDevSuite,\n   runProdSuite,\n } from 'next-test-utils'\n-import webdriver from 'next-webdriver'\n+import webdriver, { type Playwright } from 'next-webdriver'\n \n const appDir = join(__dirname, '../app')\n const indexPage = new File(join(appDir, 'pages/index.js'))\n@@ -77,9 +77,12 @@ describe('Basics', () => {\n function runTestsAgainstRuntime(runtime) {\n   runTests(\n     `Concurrent mode in the ${runtime} runtime`,\n-    (context, env) => {\n-      async function withBrowser(path, cb) {\n-        let browser\n+    (context) => {\n+      async function withBrowser(\n+        path: string,\n+        cb: (browser: Playwright) => Promise<void>\n+      ) {\n+        let browser: Playwright\n         try {\n           browser = await webdriver(context.appPort, path)\n           await cb(browser)\n@@ -100,11 +103,21 @@ function runTestsAgainstRuntime(runtime) {\n \n         await withBrowser('/use-flush-effect/styled-jsx', async (browser) => {\n           await check(\n-            () => browser.waitForElementByCss('#__jsx-900f996af369fc74').text(),\n+            () =>\n+              browser\n+                .waitForElementByCss('style#__jsx-900f996af369fc74', {\n+                  state: 'attached',\n+                })\n+                .text(),\n             /(?:blue|#00f)/\n           )\n           await check(\n-            () => browser.waitForElementByCss('#__jsx-8b0811664c4e575e').text(),\n+            () =>\n+              browser\n+                .waitForElementByCss('style#__jsx-8b0811664c4e575e', {\n+                  state: 'attached',\n+                })\n+                .text(),\n             /red/\n           )\n         })\n@@ -114,7 +127,9 @@ function runTestsAgainstRuntime(runtime) {\n         it('should not have the initial route announced', async () => {\n           const browser = await webdriver(context.appPort, '/')\n           const title = await browser\n-            .waitForElementByCss('#__next-route-announcer__')\n+            .waitForElementByCss('#__next-route-announcer__', {\n+              state: 'attached',\n+            })\n             .text()\n \n           expect(title).toBe('')\n@@ -143,7 +158,11 @@ function runTestsAgainstRuntime(runtime) {\n runTestsAgainstRuntime('experimental-edge')\n runTestsAgainstRuntime('nodejs')\n \n-function runTests(name, fn, opts) {\n+function runTests(\n+  name: string,\n+  fn: (context: any, env: any) => void,\n+  opts?: any\n+) {\n   const suiteOptions = { ...opts, runTests: fn }\n   runDevSuite(name, appDir, suiteOptions)\n   runProdSuite(name, appDir, suiteOptions)",
            "previous_filename": "test/integration/react-current-version/test/index.test.js"
        },
        {
            "sha": "2c438f8705c6eb36e1c58d1d1bcd209af5689dc7",
            "filename": "test/integration/script-loader/base/pages/page4.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fscript-loader%2Fbase%2Fpages%2Fpage4.js",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fscript-loader%2Fbase%2Fpages%2Fpage4.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fscript-loader%2Fbase%2Fpages%2Fpage4.js?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -8,7 +8,7 @@ const url =\n const Page = () => {\n   return (\n     <div class=\"container\">\n-      <div id=\"onload-div-1\" />\n+      <div id=\"onload-div-1\">initial</div>\n       <Link href=\"/page9\">Page 9</Link>\n       <Script\n         src={url}"
        },
        {
            "sha": "8d99aba207e4e757affcff13fe9ebae1ec5fb0b1",
            "filename": "test/integration/script-loader/test/index.test.ts",
            "status": "renamed",
            "additions": 22,
            "deletions": 28,
            "changes": 50,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fscript-loader%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fintegration%2Fscript-loader%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fscript-loader%2Ftest%2Findex.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -12,7 +12,7 @@ import {\n   launchApp,\n   killApp,\n } from 'next-test-utils'\n-import webdriver from 'next-webdriver'\n+import webdriver, { type Playwright } from 'next-webdriver'\n import cheerio from 'cheerio'\n \n let appDir = join(__dirname, '../base')\n@@ -24,16 +24,16 @@ const runTests = (isDev) => {\n   // TODO: We will refactor the next/script to be strict mode resilient\n   // Don't skip the test case for development mode (strict mode) once refactoring is finished\n   it('priority afterInteractive', async () => {\n-    let browser\n+    let browser: Playwright\n     try {\n       browser = await webdriver(appPort, '/')\n       await waitFor(1000)\n \n-      async function test(id) {\n-        const script = await browser.elementById(id)\n+      async function test(scriptID: string) {\n+        const script = await browser.elementByCss(`script#${scriptID}`)\n         const dataAttr = await script.getAttribute('data-nscript')\n         const endScripts = await browser.elementsByCss(\n-          `#__NEXT_DATA__ ~ #${id}`\n+          `#__NEXT_DATA__ ~ script#${scriptID}`\n         )\n \n         // Renders script tag\n@@ -54,27 +54,18 @@ const runTests = (isDev) => {\n   })\n \n   it('priority lazyOnload', async () => {\n-    let browser\n+    let browser: Playwright\n     try {\n       browser = await webdriver(appPort, '/page3')\n \n-      await browser.waitForElementByCss('#onload-div')\n+      await browser.waitForElementByCss('#onload-div', { state: 'attached' })\n       await waitFor(1000)\n \n-      const logs = await browser.log()\n-      const filteredLogs = logs.filter(\n-        (log) =>\n-          !log.message.includes('Failed to load resource') &&\n-          !log.message === 'error' &&\n-          !log.message === 'Event'\n-      )\n-      expect(filteredLogs.length).toBe(0)\n-\n-      async function test(id, css) {\n-        const script = await browser.elementById(id)\n+      async function test(scriptId: string, css?: string) {\n+        const script = await browser.elementByCss(`script#${scriptId}`)\n         const dataAttr = await script.getAttribute('data-nscript')\n         const endScripts = await browser.elementsByCss(\n-          `#__NEXT_DATA__ ~ #${id}`\n+          `#__NEXT_DATA__ ~ #${scriptId}`\n         )\n \n         // Renders script tag\n@@ -176,7 +167,7 @@ const runTests = (isDev) => {\n   })\n \n   it('priority beforeInteractive on navigate', async () => {\n-    let browser\n+    let browser: Playwright\n     try {\n       browser = await webdriver(appPort, '/')\n \n@@ -201,13 +192,13 @@ const runTests = (isDev) => {\n   })\n \n   it('onload fires correctly', async () => {\n-    let browser\n+    let browser: Playwright\n     try {\n       browser = await webdriver(appPort, '/page4')\n       await waitFor(3000)\n \n       const text = await browser.elementById('onload-div-1').text()\n-      expect(text).toBe('aaabbbccc')\n+      expect(text).toBe('initialaaabbbccc')\n \n       // Navigate to different page and back\n       await browser.waitForElementByCss('[href=\"/page9\"]').click()\n@@ -216,7 +207,7 @@ const runTests = (isDev) => {\n       await browser.waitForElementByCss('#onload-div-1')\n       const sameText = await browser.elementById('onload-div-1').text()\n       // onload should only be fired once, not on sequential re-mount\n-      expect(sameText).toBe('')\n+      expect(sameText).toBe('initial')\n     } finally {\n       if (browser) await browser.close()\n     }\n@@ -241,7 +232,7 @@ const runTests = (isDev) => {\n   })\n \n   it('priority beforeInteractive with inline script should execute', async () => {\n-    let browser\n+    let browser: Playwright\n     try {\n       browser = await webdriver(appPort, '/page7')\n       await waitFor(1000)\n@@ -259,7 +250,7 @@ const runTests = (isDev) => {\n   })\n \n   it('Does not duplicate inline scripts', async () => {\n-    let browser\n+    let browser: Playwright\n     try {\n       browser = await webdriver(appPort, '/')\n \n@@ -298,7 +289,7 @@ const runTests = (isDev) => {\n   }\n \n   it('onReady fires after load event and then on every subsequent re-mount', async () => {\n-    let browser\n+    let browser: Playwright\n     try {\n       browser = await webdriver(appPort, '/page8')\n \n@@ -321,7 +312,7 @@ const runTests = (isDev) => {\n \n   // https://github.com/vercel/next.js/issues/39993\n   it('onReady should only fires once after loaded (issue #39993)', async () => {\n-    let browser\n+    let browser: Playwright\n     try {\n       browser = await webdriver(appPort, '/page10')\n \n@@ -361,7 +352,10 @@ describe('Next.js Script - Primary Strategies - Production Mode', () => {\n           quiet: true,\n         })\n \n-        server = await startApp(app)\n+        server = await startApp(\n+          // @ts-expect-error -- Discovered when converting from JS to TS\n+          app\n+        )\n         appPort = server.address().port\n       })\n       afterAll(async () => {",
            "previous_filename": "test/integration/script-loader/test/index.test.js"
        },
        {
            "sha": "54d338ed2194af5180b5044a1756442eb5bda882",
            "filename": "test/lib/browsers/playwright.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 3,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Flib%2Fbrowsers%2Fplaywright.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Flib%2Fbrowsers%2Fplaywright.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fbrowsers%2Fplaywright.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -59,9 +59,15 @@ interface ElementHandleExt extends ElementHandle {\n \n export type ElementByCssOpts = {\n   timeout?: number\n-  /** The state of the DOM element. */\n+  /**\n+   * The state of the DOM element.\n+   * @default 'visible'\n+   */\n   state?: 'attached' | 'visible' | 'hidden'\n-  /** The state of the page. */\n+  /**\n+   * The state of the page.\n+   * @default 'load'\n+   */\n   waitUntil?: false | 'load' | 'domcontentloaded' | 'networkidle'\n }\n \n@@ -486,7 +492,20 @@ export class Playwright<TCurrent = undefined> {\n     const {\n       timeout = 10_000,\n       waitUntil = 'load', // TODO: we should get rid of this and fix the tests that implicitly rely on it\n-      state = 'attached', // TODO: we should probably default to \"visible\" instead\n+      // Selected elements may be in a completed boundary that React hasn't revealed yet.\n+      // We almost always want to wait for the reveal.\n+      // This matches Playwright's default behavior.\n+      // We don't care about visibility of metadata tags.\n+      // Can hopefully be dropped if https://github.com/microsoft/playwright/pull/37265 is accepted\n+      state = selector.startsWith('base') ||\n+      selector.startsWith('link') ||\n+      selector.startsWith('meta') ||\n+      selector.startsWith('script') ||\n+      selector.startsWith('source') ||\n+      selector.startsWith('style') ||\n+      selector.startsWith('title')\n+        ? 'attached'\n+        : 'visible',\n     } = typeof opts === 'number' ? { timeout: opts } : opts\n \n     return this.startChain(async () => {"
        },
        {
            "sha": "d292128f4b032797f6c48a4e6f8e59684cd88408",
            "filename": "test/lib/next-test-utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Flib%2Fnext-test-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Flib%2Fnext-test-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-test-utils.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -968,6 +968,7 @@ export async function getSegmentExplorerRoute(browser: Playwright) {\n   return await browser\n     .elementByCss('.segment-explorer-page-route-bar-path')\n     .text()\n+    .catch(() => '<empty>')\n }\n \n export async function getSegmentExplorerContent(browser: Playwright) {\n@@ -1581,7 +1582,7 @@ export function getUrlFromBackgroundImage(backgroundImage: string) {\n }\n \n export const getTitle = (browser: Playwright) =>\n-  browser.elementByCss('title').text()\n+  browser.elementByCss('title', { state: 'attached' }).text()\n \n async function checkMeta(\n   browser: Playwright,"
        },
        {
            "sha": "7746950814cab05498eca94af2c80d4bb5d48c98",
            "filename": "test/production/pages-dir/production/test/index.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/caffa0d866773a03346b484336a582ba53b27f02/test%2Fproduction%2Fpages-dir%2Fproduction%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/caffa0d866773a03346b484336a582ba53b27f02/test%2Fproduction%2Fpages-dir%2Fproduction%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fpages-dir%2Fproduction%2Ftest%2Findex.test.ts?ref=caffa0d866773a03346b484336a582ba53b27f02",
            "patch": "@@ -783,7 +783,8 @@ describe('Production Usage', () => {\n     await browser\n       .elementByCss('a')\n       .click()\n-      .waitForElementByCss('input')\n+      // Just wait for google.com to be revealed. We can't control which input we get.\n+      .waitForElementByCss('input', { state: 'attached' })\n       .back()\n       .waitForElementByCss('p')\n \n@@ -800,7 +801,7 @@ describe('Production Usage', () => {\n     await browser\n       .elementByCss('a')\n       .click()\n-      .waitForElementByCss('input')\n+      .waitForElementByCss('input', { state: 'attached' })\n       .back()\n       .waitForElementByCss('p')\n \n@@ -820,7 +821,7 @@ describe('Production Usage', () => {\n     await browser\n       .elementByCss('a')\n       .click()\n-      .waitForElementByCss('input')\n+      .waitForElementByCss('input', { state: 'attached' })\n       .back()\n       .waitForElementByCss('p')\n "
        }
    ],
    "stats": {
        "total": 782,
        "additions": 458,
        "deletions": 324
    }
}