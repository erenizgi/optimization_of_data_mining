{
    "author": "lukesandberg",
    "message": "[turbopack] tweak the ui of the module-cost benchmark (#81817)\n\nHave the module-cost benchmark page self identify and output into a text box to make copy-pasting the data out easier.",
    "sha": "d85d3e273452b70a98185402425fdd53ea9b18f6",
    "files": [
        {
            "sha": "967e20a312fa9d74539ad7761c79b3c73f68ea2a",
            "filename": "bench/module-cost/components/client.js",
            "status": "modified",
            "additions": 52,
            "deletions": 11,
            "changes": 63,
            "blob_url": "https://github.com/vercel/next.js/blob/d85d3e273452b70a98185402425fdd53ea9b18f6/bench%2Fmodule-cost%2Fcomponents%2Fclient.js",
            "raw_url": "https://github.com/vercel/next.js/raw/d85d3e273452b70a98185402425fdd53ea9b18f6/bench%2Fmodule-cost%2Fcomponents%2Fclient.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/bench%2Fmodule-cost%2Fcomponents%2Fclient.js?ref=d85d3e273452b70a98185402425fdd53ea9b18f6",
            "patch": "@@ -1,45 +1,63 @@\n 'use client'\n \n+import { useEffect, useRef, useState } from 'react'\n import { format, measure } from '../lib/measure'\n \n-async function measureClientButton(element, name, fn) {\n+function report(result, element, textarea) {\n+  const formattedResult = format(result)\n+  element.textContent += `: ${formattedResult}`\n+  textarea.current.value += `\\n    ${formattedResult}`\n+  console.log(formattedResult)\n+  element.disabled = true\n+}\n+\n+async function measureClientButton(element, textarea, name, fn) {\n   if (element.textContent.includes('Loading time')) {\n     return\n   }\n \n   const result = await measure(name, fn)\n-\n-  element.textContent += ` (${format(result)})`\n+  report(result, element, textarea)\n }\n \n-async function measureActionButton(element, action) {\n+async function measureActionButton(element, textarea, action) {\n   if (element.textContent.includes('Loading time')) {\n     return\n   }\n \n   const result = await action()\n \n-  element.textContent += ` (${format(result)})`\n+  report(result, element, textarea)\n }\n \n-async function measureApiButton(element, url) {\n+async function measureApiButton(element, textarea, url) {\n   if (element.textContent.includes('Loading time')) {\n     return\n   }\n \n   const result = await fetch(url).then((res) => res.json())\n \n-  element.textContent += ` (${format(result)})`\n+  report(result, element, textarea)\n }\n \n export function Client({ prefix, commonjsAction, esmAction }) {\n+  const [runtime, setRuntime] = useState('')\n+  const textarea = useRef()\n+  useEffect(() => {\n+    setRuntime(\n+      `${globalThis.TURBOPACK ? 'Turbopack' : 'Webpack'} (${process.env.NODE_ENV})`\n+    )\n+  }, [])\n   return (\n     <>\n+      <h1>{runtime}</h1>\n       <p>\n         <button\n+          type=\"button\"\n           onClick={(e) =>\n             measureClientButton(\n               e.target,\n+              textarea,\n               'client commonjs',\n               () => import('../lib/commonjs.js')\n             )\n@@ -50,9 +68,11 @@ export function Client({ prefix, commonjsAction, esmAction }) {\n       </p>\n       <p>\n         <button\n+          type=\"button\"\n           onClick={(e) =>\n             measureClientButton(\n               e.target,\n+              textarea,\n               'client esm',\n               () => import('../lib/esm.js')\n             )\n@@ -64,31 +84,52 @@ export function Client({ prefix, commonjsAction, esmAction }) {\n       {commonjsAction && (\n         <p>\n           <button\n-            onClick={(e) => measureActionButton(e.target, commonjsAction)}\n+            type=\"button\"\n+            onClick={(e) =>\n+              measureActionButton(e.target, textarea, commonjsAction)\n+            }\n           >\n             CommonJs server action\n           </button>\n         </p>\n       )}\n       {esmAction && (\n         <p>\n-          <button onClick={(e) => measureActionButton(e.target, esmAction)}>\n+          <button\n+            type=\"button\"\n+            onClick={(e) => measureActionButton(e.target, textarea, esmAction)}\n+          >\n             ESM server action\n           </button>\n         </p>\n       )}\n       <p>\n         <button\n-          onClick={(e) => measureApiButton(e.target, `${prefix}/commonjs`)}\n+          type=\"button\"\n+          onClick={(e) =>\n+            measureApiButton(e.target, textarea, `${prefix}/commonjs`)\n+          }\n         >\n           CommonJs API\n         </button>\n       </p>\n       <p>\n-        <button onClick={(e) => measureApiButton(e.target, `${prefix}/esm`)}>\n+        <button\n+          type=\"button\"\n+          onClick={(e) => measureApiButton(e.target, textarea, `${prefix}/esm`)}\n+        >\n           ESM API\n         </button>\n       </p>\n+      {\n+        // holds all the timing data for easier copy paste\n+      }\n+      <textarea\n+        readOnly={true}\n+        ref={textarea}\n+        value={runtime}\n+        style={{ fieldSizing: 'content' }}\n+      ></textarea>\n     </>\n   )\n }"
        },
        {
            "sha": "0914c0e14eb57d18eb95c0df078c2ea06dfe372f",
            "filename": "bench/module-cost/lib/measure.js",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/d85d3e273452b70a98185402425fdd53ea9b18f6/bench%2Fmodule-cost%2Flib%2Fmeasure.js",
            "raw_url": "https://github.com/vercel/next.js/raw/d85d3e273452b70a98185402425fdd53ea9b18f6/bench%2Fmodule-cost%2Flib%2Fmeasure.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/bench%2Fmodule-cost%2Flib%2Fmeasure.js?ref=d85d3e273452b70a98185402425fdd53ea9b18f6",
            "patch": "@@ -18,12 +18,11 @@ export async function measure(name, fn) {\n     executeDuration = end - start\n   }\n \n-  const result = { loadDuration, executeDuration, files }\n-  console.log(`${name} Measurement: ${format(result)}`)\n+  const result = { name, loadDuration, executeDuration, files }\n \n   return result\n }\n \n export function format(result) {\n-  return `Load duration: ${result.loadDuration.toFixed(2)}ms, Execution duration: ${result.executeDuration.toFixed(2)}ms, Files: ${result.files}`\n+  return `${result.name}: Load duration: ${result.loadDuration.toFixed(2)}ms, Execution duration: ${result.executeDuration.toFixed(2)}ms, Files: ${result.files}`\n }"
        },
        {
            "sha": "d839ff70688a6c5fe9292de299df111195bfd512",
            "filename": "bench/module-cost/scripts/prepare-bench.mjs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/d85d3e273452b70a98185402425fdd53ea9b18f6/bench%2Fmodule-cost%2Fscripts%2Fprepare-bench.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/d85d3e273452b70a98185402425fdd53ea9b18f6/bench%2Fmodule-cost%2Fscripts%2Fprepare-bench.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/bench%2Fmodule-cost%2Fscripts%2Fprepare-bench.mjs?ref=d85d3e273452b70a98185402425fdd53ea9b18f6",
            "patch": "@@ -1,6 +1,6 @@\n-import fs from 'fs/promises'\n-import path from 'path'\n-import { fileURLToPath } from 'url'\n+import fs from 'node:fs/promises'\n+import path from 'node:path'\n+import { fileURLToPath } from 'node:url'\n \n const __dirname = path.dirname(fileURLToPath(import.meta.url))\n const commonjsDir = path.join(__dirname, '../commonjs')"
        }
    ],
    "stats": {
        "total": 74,
        "additions": 57,
        "deletions": 17
    }
}