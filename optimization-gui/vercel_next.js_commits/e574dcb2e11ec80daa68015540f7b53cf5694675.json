{
    "author": "mischnic",
    "message": " Turbopack: sourceMappingURL for Node.js runtime chunk (#81300)\n\nThe file was generated, but the comment referencing it was missing.\r\nCopy the logic over from the browser runtime chunk",
    "sha": "e574dcb2e11ec80daa68015540f7b53cf5694675",
    "files": [
        {
            "sha": "74895357186b4c434d294ee577d83f9614c51811",
            "filename": "turbopack/crates/turbopack-nodejs/src/ecmascript/node/entry/runtime.rs",
            "status": "modified",
            "additions": 17,
            "deletions": 4,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/e574dcb2e11ec80daa68015540f7b53cf5694675/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fruntime.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/e574dcb2e11ec80daa68015540f7b53cf5694675/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fruntime.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fentry%2Fruntime.rs?ref=e574dcb2e11ec80daa68015540f7b53cf5694675",
            "patch": "@@ -4,7 +4,7 @@ use anyhow::{Result, bail};\n use indoc::writedoc;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n-use turbo_tasks_fs::{File, FileSystem, FileSystemPath};\n+use turbo_tasks_fs::{File, FileSystem, FileSystemPath, rope::RopeBuilder};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::ChunkingContext,\n@@ -157,9 +157,22 @@ impl Asset for EcmascriptBuildNodeRuntimeChunk {\n     #[turbo_tasks::function]\n     async fn content(self: Vc<Self>) -> Result<Vc<AssetContent>> {\n         let code = self.code().await?;\n-        Ok(AssetContent::file(\n-            File::from(code.source_code().clone()).into(),\n-        ))\n+\n+        let rope = if code.has_source_map() {\n+            let mut rope_builder = RopeBuilder::default();\n+            rope_builder.concat(code.source_code());\n+            let source_map_path = self.source_map().path().await?;\n+            write!(\n+                rope_builder,\n+                \"\\n\\n//# sourceMappingURL={}\",\n+                urlencoding::encode(source_map_path.file_name())\n+            )?;\n+            rope_builder.build()\n+        } else {\n+            code.source_code().clone()\n+        };\n+\n+        Ok(AssetContent::file(File::from(rope).into()))\n     }\n }\n "
        },
        {
            "sha": "7daf9d94b3c05ea8f9a4c16de5c12e82c0a7df3f",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/runtime/default_build_runtime/output/[turbopack]_runtime.js",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/e574dcb2e11ec80daa68015540f7b53cf5694675/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_build_runtime%2Foutput%2F%5Bturbopack%5D_runtime.js",
            "raw_url": "https://github.com/vercel/next.js/raw/e574dcb2e11ec80daa68015540f7b53cf5694675/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_build_runtime%2Foutput%2F%5Bturbopack%5D_runtime.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_build_runtime%2Foutput%2F%5Bturbopack%5D_runtime.js?ref=e574dcb2e11ec80daa68015540f7b53cf5694675",
            "patch": "@@ -713,4 +713,7 @@ const regexJsUrl = /\\.js(?:\\?[^#]*)?(?:#.*)?$/;\n module.exports = {\n     getOrInstantiateRuntimeModule,\n     loadChunk\n-};\n\\ No newline at end of file\n+};\n+\n+\n+//# sourceMappingURL=%5Bturbopack%5D_runtime.js.map\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 26,
        "additions": 21,
        "deletions": 5
    }
}