{
    "author": "devjiwonchoi",
    "message": "[next] use `tsconfig.build.json` for production build (#76373)\n\n### Why?\n\nThe types of unit tests and stories were included in the package.\nExclude them by using `tsconfig.declaration.json` when `pnpm run types`\nduring production build.\n\n| Before | After |\n|--------|--------|\n| ![CleanShot 2025-02-22 at 18 53\n43@2x](https://github.com/user-attachments/assets/4e926395-4c53-4d82-aaf9-e7aa03124294)\n| ![CleanShot 2025-02-22 at 19 09\n37@2x](https://github.com/user-attachments/assets/9a4d3fbc-f5b8-421e-9cb5-d8d0aa1d7509)\n|\n\nCloses NDX-747\n\n---------\n\nCo-authored-by: Sebastian Sebbie Silbermann <sebastian.silbermann@vercel.com>",
    "sha": "4b23c7b02eb0e75b5d345797b485e9f901bd2790",
    "files": [
        {
            "sha": "1d6252799dfc39c427be4dccebaf5e5f889b61e0",
            "filename": "packages/next/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/4b23c7b02eb0e75b5d345797b485e9f901bd2790/packages%2Fnext%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/4b23c7b02eb0e75b5d345797b485e9f901bd2790/packages%2Fnext%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fpackage.json?ref=4b23c7b02eb0e75b5d345797b485e9f901bd2790",
            "patch": "@@ -84,7 +84,7 @@\n     \"release\": \"taskr release\",\n     \"build\": \"pnpm release\",\n     \"prepublishOnly\": \"cd ../../ && turbo run build\",\n-    \"types\": \"tsc --declaration --emitDeclarationOnly --stripInternal --declarationDir dist\",\n+    \"types\": \"tsc --project tsconfig.build.json --declaration --emitDeclarationOnly --stripInternal --declarationDir dist\",\n     \"typescript\": \"tsec --noEmit\",\n     \"ncc-compiled\": \"taskr ncc\",\n     \"storybook\": \"storybook dev -p 6006\","
        },
        {
            "sha": "8fbbdc157f703adeea3f5a38a06de9db61130a1b",
            "filename": "packages/next/taskfile.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4b23c7b02eb0e75b5d345797b485e9f901bd2790/packages%2Fnext%2Ftaskfile.js",
            "raw_url": "https://github.com/vercel/next.js/raw/4b23c7b02eb0e75b5d345797b485e9f901bd2790/packages%2Fnext%2Ftaskfile.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftaskfile.js?ref=4b23c7b02eb0e75b5d345797b485e9f901bd2790",
            "patch": "@@ -2573,14 +2573,14 @@ export async function nextbuildjest(task, opts) {\n \n export async function client(task, opts) {\n   await task\n-    .source('src/client/**/!(*.test).+(js|ts|tsx|woff2)')\n+    .source('src/client/**/!(*.test|*.stories).+(js|ts|tsx|woff2)')\n     .swc('client', { dev: opts.dev, interopClientDefaultExport: true })\n     .target('dist/client')\n }\n \n export async function client_esm(task, opts) {\n   await task\n-    .source('src/client/**/!(*.test).+(js|ts|tsx|woff2)')\n+    .source('src/client/**/!(*.test|*.stories).+(js|ts|tsx|woff2)')\n     .swc('client', { dev: opts.dev, esm: true })\n     .target('dist/esm/client')\n }"
        },
        {
            "sha": "0190e0c0147a5ed1c7922ff40f6acf36b0fb5255",
            "filename": "packages/next/tsconfig.build.json",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/4b23c7b02eb0e75b5d345797b485e9f901bd2790/packages%2Fnext%2Ftsconfig.build.json",
            "raw_url": "https://github.com/vercel/next.js/raw/4b23c7b02eb0e75b5d345797b485e9f901bd2790/packages%2Fnext%2Ftsconfig.build.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftsconfig.build.json?ref=4b23c7b02eb0e75b5d345797b485e9f901bd2790",
            "patch": "@@ -0,0 +1,20 @@\n+{\n+  \"extends\": \"./tsconfig.json\",\n+  // Copied from tsconfig.json to not overwrite.\n+  \"exclude\": [\n+    \"dist\",\n+    \"./*.d.ts\",\n+    \"future/*.d.ts\",\n+    \"image-types/global.d.ts\",\n+    \"compat/*.d.ts\",\n+    \"legacy/*.d.ts\",\n+    \"types/compiled.d.ts\",\n+    \"navigation-types/*.d.ts\",\n+    \"navigation-types/compat/*.d.ts\",\n+    \"experimental/**/*.d.ts\",\n+    // Don't generate types for internal files.\n+    \"./**/*.test.ts\",\n+    \"./**/*.test.tsx\",\n+    \"./**/*.stories.tsx\"\n+  ]\n+}"
        },
        {
            "sha": "fc5a5ebf883abec22aa5352f96ef638c26c3b894",
            "filename": "packages/next/tsconfig.json",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/4b23c7b02eb0e75b5d345797b485e9f901bd2790/packages%2Fnext%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/4b23c7b02eb0e75b5d345797b485e9f901bd2790/packages%2Fnext%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftsconfig.json?ref=4b23c7b02eb0e75b5d345797b485e9f901bd2790",
            "patch": "@@ -10,6 +10,8 @@\n     \"target\": \"ES2018\",\n     \"moduleResolution\": \"node\"\n   },\n+  // When changing `exclude`, also update\n+  // `tsconfig.build.json`.\n   \"exclude\": [\n     \"dist\",\n     \"./*.d.ts\","
        }
    ],
    "stats": {
        "total": 28,
        "additions": 25,
        "deletions": 3
    }
}