{
    "author": "ztanner",
    "message": "Revert \"auto-enable clientParamParsing and clientSegmentCache w/ cacheComponents\" (#84419)\n\nReverts vercel/next.js#84250\n\nNeed to investigate deployment failures\n\n[x-ref](https://github.com/vercel/next.js/actions/runs/18154875270)",
    "sha": "ab758f16364cac927fd0c1bf23588e2705ef0361",
    "files": [
        {
            "sha": "a4211d677043d59f6ae9f78aae0700f5bcd07d24",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 30,
            "changes": 51,
            "blob_url": "https://github.com/vercel/next.js/blob/ab758f16364cac927fd0c1bf23588e2705ef0361/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab758f16364cac927fd0c1bf23588e2705ef0361/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=ab758f16364cac927fd0c1bf23588e2705ef0361",
            "patch": "@@ -1690,68 +1690,59 @@ function enforceExperimentalFeatures(\n     }\n   }\n \n-  // TODO: Remove this once we've made Cache Components the default.\n+  // TODO: Remove this once we've made Client Segment Cache the default.\n   if (\n-    process.env.__NEXT_EXPERIMENTAL_CACHE_COMPONENTS === 'true' &&\n+    process.env.__NEXT_EXPERIMENTAL_PPR === 'true' &&\n     // We do respect an explicit value in the user config.\n-    (config.experimental.cacheComponents === undefined ||\n-      (isDefaultConfig && !config.experimental.cacheComponents))\n+    (config.experimental.clientSegmentCache === undefined ||\n+      (isDefaultConfig && !config.experimental.clientSegmentCache))\n   ) {\n-    config.experimental.cacheComponents = true\n+    config.experimental.clientSegmentCache = true\n \n     if (configuredExperimentalFeatures) {\n       addConfiguredExperimentalFeature(\n         configuredExperimentalFeatures,\n-        'cacheComponents',\n+        'clientSegmentCache',\n         true,\n-        'enabled by `__NEXT_EXPERIMENTAL_CACHE_COMPONENTS`'\n+        'enabled by `__NEXT_EXPERIMENTAL_PPR`'\n       )\n     }\n   }\n \n-  const enabledByPprEnv = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n-  const enabledByCacheComponents = config.experimental.cacheComponents === true\n-\n-  // TODO: Remove this once we've made Client Segment Cache the default.\n+  // TODO: Remove this once we've made Client Param Parsing the default.\n   if (\n-    (enabledByPprEnv || enabledByCacheComponents) &&\n+    process.env.__NEXT_EXPERIMENTAL_PPR === 'true' &&\n     // We do respect an explicit value in the user config.\n-    (config.experimental.clientSegmentCache === undefined ||\n-      (isDefaultConfig && !config.experimental.clientSegmentCache))\n+    (config.experimental.clientParamParsing === undefined ||\n+      (isDefaultConfig && !config.experimental.clientParamParsing))\n   ) {\n-    config.experimental.clientSegmentCache = true\n-    const reason = enabledByCacheComponents\n-      ? 'enabled by `experimental.cacheComponents`'\n-      : 'enabled by `__NEXT_EXPERIMENTAL_PPR`'\n+    config.experimental.clientParamParsing = true\n \n     if (configuredExperimentalFeatures) {\n       addConfiguredExperimentalFeature(\n         configuredExperimentalFeatures,\n-        'clientSegmentCache',\n+        'clientParamParsing',\n         true,\n-        reason\n+        'enabled by `__NEXT_EXPERIMENTAL_PPR`'\n       )\n     }\n   }\n \n-  // TODO: Remove this once we've made Client Param Parsing the default.\n+  // TODO: Remove this once we've made Cache Components the default.\n   if (\n-    (enabledByPprEnv || enabledByCacheComponents) &&\n+    process.env.__NEXT_EXPERIMENTAL_CACHE_COMPONENTS === 'true' &&\n     // We do respect an explicit value in the user config.\n-    (config.experimental.clientParamParsing === undefined ||\n-      (isDefaultConfig && !config.experimental.clientParamParsing))\n+    (config.experimental.cacheComponents === undefined ||\n+      (isDefaultConfig && !config.experimental.cacheComponents))\n   ) {\n-    config.experimental.clientParamParsing = true\n-    const reason = enabledByCacheComponents\n-      ? 'enabled by `experimental.cacheComponents`'\n-      : 'enabled by `__NEXT_EXPERIMENTAL_PPR`'\n+    config.experimental.cacheComponents = true\n \n     if (configuredExperimentalFeatures) {\n       addConfiguredExperimentalFeature(\n         configuredExperimentalFeatures,\n-        'clientParamParsing',\n+        'cacheComponents',\n         true,\n-        reason\n+        'enabled by `__NEXT_EXPERIMENTAL_CACHE_COMPONENTS`'\n       )\n     }\n   }"
        },
        {
            "sha": "dd1647292617ee2ceba441d1f3dceecd12343db8",
            "filename": "test/e2e/app-dir/segment-cache/basic/segment-cache-basic.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 5,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/ab758f16364cac927fd0c1bf23588e2705ef0361/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab758f16364cac927fd0c1bf23588e2705ef0361/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts?ref=ab758f16364cac927fd0c1bf23588e2705ef0361",
            "patch": "@@ -93,11 +93,7 @@ describe('segment cache (basic tests)', () => {\n     )\n   })\n \n-  // TODO(client-param-parsing): With `clientParamParsing` enabled, this test is outdated, because\n-  // we no longer put the param values in the prefetched RSC response. You'd have to opt into runtime\n-  // prefetching for this test to pass until we ship the optimization that would mark this as fully static\n-  // if you don't reference any dynamic params in the server components.\n-  it.skip('navigate to page with lazily-generated (not at build time) static param', async () => {\n+  it('navigate to page with lazily-generated (not at build time) static param', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/lazily-generated-params', {\n       beforePageLoad(page) {"
        },
        {
            "sha": "335377e9a9a53b6b776ab7ae0d32142b19e15efd",
            "filename": "test/production/app-dir/build-output-prerender/build-output-prerender.test.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 32,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/ab758f16364cac927fd0c1bf23588e2705ef0361/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab758f16364cac927fd0c1bf23588e2705ef0361/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts?ref=ab758f16364cac927fd0c1bf23588e2705ef0361",
            "patch": "@@ -26,8 +26,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n@@ -37,8 +37,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n@@ -61,8 +61,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n@@ -74,8 +74,6 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n@@ -85,8 +83,6 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (Rspack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n@@ -96,8 +92,6 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n@@ -155,8 +149,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -170,8 +164,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -202,8 +196,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -219,8 +213,6 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -234,8 +226,6 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (Rspack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -249,8 +239,6 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`experimental.cacheComponents\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -309,8 +297,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n@@ -320,8 +308,8 @@ describe('build-output-prerender', () => {\n              \"▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ✓ rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\"\n@@ -382,8 +370,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -397,8 +385,8 @@ describe('build-output-prerender', () => {\n                 ▲ Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                   ✓ cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n-                  ✓ clientParamParsing (enabled by \\`experimental.cacheComponents\\`)\n-                  ✓ clientSegmentCache (enabled by \\`experimental.cacheComponents\\`)\n+                  ✓ clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n+                  ✓ clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                   ✓ enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                   ✓ ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                   ⨯ prerenderEarlyExit (disabled by \\`--debug-prerender\\`)"
        }
    ],
    "stats": {
        "total": 109,
        "additions": 42,
        "deletions": 67
    }
}