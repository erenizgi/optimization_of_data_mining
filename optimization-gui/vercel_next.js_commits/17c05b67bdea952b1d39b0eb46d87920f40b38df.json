{
    "author": "unstubbable",
    "message": "Always consider `captureOwnerStack` optional (#81370)\n\nWhen running `next build` with a custom `NODE_ENV` (e.g. `test` or\n`development`), the `captureOwnerStack` method is not defined and may\nlead to errors if called. This change ensures that we only call\n`captureOwnerStack` if it is defined, preventing potential runtime\nerrors.",
    "sha": "17c05b67bdea952b1d39b0eb46d87920f40b38df",
    "files": [
        {
            "sha": "3ddd0f3e289b21bb696b4f8ae6b28855039b8dc6",
            "filename": "packages/next/src/server/app-render/dynamic-rendering.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/17c05b67bdea952b1d39b0eb46d87920f40b38df/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/17c05b67bdea952b1d39b0eb46d87920f40b38df/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts?ref=17c05b67bdea952b1d39b0eb46d87920f40b38df",
            "patch": "@@ -664,7 +664,10 @@ function createErrorWithComponentOrOwnerStack(\n   componentStack: string\n ) {\n   const ownerStack =\n-    process.env.NODE_ENV !== 'production' ? React.captureOwnerStack() : null\n+    process.env.NODE_ENV !== 'production' && React.captureOwnerStack\n+      ? React.captureOwnerStack()\n+      : null\n+\n   const error = new Error(message)\n   error.stack = error.name + ': ' + message + (ownerStack ?? componentStack)\n   return error"
        },
        {
            "sha": "dd739edd23473ef30a14ce9a4f7005e2e2d5e5b9",
            "filename": "packages/next/src/server/node-environment-extensions/utils.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/17c05b67bdea952b1d39b0eb46d87920f40b38df/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Futils.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/17c05b67bdea952b1d39b0eb46d87920f40b38df/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Futils.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnode-environment-extensions%2Futils.tsx?ref=17c05b67bdea952b1d39b0eb46d87920f40b38df",
            "patch": "@@ -47,8 +47,11 @@ export function io(expression: string, type: ApiType) {\n \n           const errorWithStack = new Error(message)\n \n-          if (process.env.NODE_ENV !== 'production') {\n-            const ownerStack = workUnitStore.captureOwnerStack!()\n+          if (\n+            process.env.NODE_ENV !== 'production' &&\n+            workUnitStore.captureOwnerStack\n+          ) {\n+            const ownerStack = workUnitStore.captureOwnerStack()\n \n             if (ownerStack) {\n               // TODO: Instead of stitching the stacks here, we should log the"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 9,
        "deletions": 3
    }
}