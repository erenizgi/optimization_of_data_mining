{
    "author": "ijjk",
    "message": "Skip globally installing turbo CLI (#76532)\n\nThis aims to avoid the below error with globally installing `turbo` with\n`npm` by using `pnpm dlx` the same as we are for the DataDog CLI.\n\n```sh\nRun npm i -g turbo@2.3.3 && node ./scripts/pull-turbo-cache.js x86_64-unknown-linux-musl\nnpm error code ENOTEMPTY\nnpm error syscall rename\nnpm error path /root/.local/share/fnm/node-versions/v[18](https://github.com/vercel/next.js/actions/runs/13537303233/job/37831195809#step:15:19).20.4/installation/lib/node_modules/turbo\n```\n\nx-ref: [slack\nthread](https://vercel.slack.com/archives/C04KC8A53T7/p1740004625721209)",
    "sha": "78ac4e2edce1ab749e290f2c912ce7b2688171bc",
    "files": [
        {
            "sha": "385c0946f7a199fa0081815766ea0d20209210ba",
            "filename": ".github/workflows/build_and_deploy.yml",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/78ac4e2edce1ab749e290f2c912ce7b2688171bc/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/78ac4e2edce1ab749e290f2c912ce7b2688171bc/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_deploy.yml?ref=78ac4e2edce1ab749e290f2c912ce7b2688171bc",
            "patch": "@@ -146,8 +146,8 @@ jobs:\n             # --env-mode loose is a breaking change required with turbo 2.x since Strict mode is now the default\n             # TODO: we should add the relevant envs later to to switch to strict mode\n             build: |\n-              npm i -g \"@napi-rs/cli@${NAPI_CLI_VERSION}\" \"turbo@${TURBO_VERSION}\" && corepack enable\n-              turbo run build-native-release -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target x86_64-apple-darwin\n+              npm i -g \"@napi-rs/cli@${NAPI_CLI_VERSION}\" && corepack enable\n+              pnpm dlx turbo@${TURBO_VERSION} run build-native-release -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target x86_64-apple-darwin\n               strip -x packages/next-swc/native/next-swc.*.node\n \n           - host:\n@@ -159,8 +159,8 @@ jobs:\n             # --env-mode loose is a breaking change required with turbo 2.x since Strict mode is now the default\n             # TODO: we should add the relevant envs later to to switch to strict mode\n             build: |\n-              npm i -g \"@napi-rs/cli@${NAPI_CLI_VERSION}\" \"turbo@${TURBO_VERSION}\" && corepack enable\n-              turbo run build-native-release -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target aarch64-apple-darwin\n+              npm i -g \"@napi-rs/cli@${NAPI_CLI_VERSION}\" && corepack enable\n+              pnpm dlx turbo@${TURBO_VERSION} run build-native-release -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target aarch64-apple-darwin\n               strip -x packages/next-swc/native/next-swc.*.node\n \n           - host:\n@@ -172,8 +172,8 @@ jobs:\n             # TODO: we should add the relevant envs later to to switch to strict mode\n             build: |\n               corepack enable\n-              npm i -g \"@napi-rs/cli@${NAPI_CLI_VERSION}\" \"turbo@${TURBO_VERSION}\"\n-              turbo run build-native-release -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target x86_64-pc-windows-msvc\n+              npm i -g \"@napi-rs/cli@${NAPI_CLI_VERSION}\"\n+              pnpm dlx turbo@${TURBO_VERSION} run build-native-release -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target x86_64-pc-windows-msvc\n             target: 'x86_64-pc-windows-msvc'\n \n           - host:\n@@ -186,8 +186,8 @@ jobs:\n             # TODO: we should add the relevant envs later to to switch to strict mode\n             build: |\n               corepack enable\n-              npm i -g \"@napi-rs/cli@${NAPI_CLI_VERSION}\" \"turbo@${TURBO_VERSION}\"\n-              turbo run build-native-no-plugin-release -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target aarch64-pc-windows-msvc\n+              npm i -g \"@napi-rs/cli@${NAPI_CLI_VERSION}\"\n+              pnpm dlx turbo@${TURBO_VERSION} run build-native-no-plugin-release -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target aarch64-pc-windows-msvc\n \n           - host:\n               - 'self-hosted'\n@@ -434,7 +434,7 @@ jobs:\n       - name: Build\n         # --env-mode loose is a breaking change required with turbo 2.x since Strict mode is now the default\n         # TODO: we should add the relevant envs later to to switch to strict mode\n-        run: turbo run build-wasm -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target ${{ matrix.target }}\n+        run: pnpm dlx turbo@${TURBO_VERSION} run build-wasm -vvv --env-mode loose --remote-cache-timeout 90 --summarize -- --target ${{ matrix.target }}\n \n       - name: Add target to folder name\n         run: '[[ -d \"crates/wasm/pkg\" ]] && mv crates/wasm/pkg crates/wasm/pkg-${{ matrix.target }} || ls crates/wasm'"
        },
        {
            "sha": "420ef70cf32b3beda7a59ed10adff465d366fe33",
            "filename": ".github/workflows/build_reusable.yml",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/78ac4e2edce1ab749e290f2c912ce7b2688171bc/.github%2Fworkflows%2Fbuild_reusable.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/78ac4e2edce1ab749e290f2c912ce7b2688171bc/.github%2Fworkflows%2Fbuild_reusable.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_reusable.yml?ref=78ac4e2edce1ab749e290f2c912ce7b2688171bc",
            "patch": "@@ -167,7 +167,7 @@ jobs:\n       - run: rustc --version\n         if: ${{ inputs.skipNativeBuild != 'yes' || inputs.needsNextest == 'yes' || inputs.needsRust == 'yes' }}\n \n-      - run: corepack prepare --activate yarn@1.22.19 && (killall turbo || echo 'no turbo') && npm i -g \"turbo@${TURBO_VERSION}\" \"@napi-rs/cli@${NAPI_CLI_VERSION}\"\n+      - run: corepack prepare --activate yarn@1.22.19 && npm i -g \"@napi-rs/cli@${NAPI_CLI_VERSION}\"\n \n       - name: Cache on ${{ github.ref_name }}\n         uses: ijjk/rust-cache@turbo-cache-v1.0.8\n@@ -193,7 +193,7 @@ jobs:\n       - run: node scripts/normalize-version-bump.js\n         name: normalize versions\n \n-      - run: turbo run build-native-release -v --env-mode loose --remote-cache-timeout 90 --summarize -- --target ${{ inputs.buildNativeTarget }}\n+      - run: pnpm dlx turbo@${TURBO_VERSION} run build-native-release -v --env-mode loose --remote-cache-timeout 90 --summarize -- --target ${{ inputs.buildNativeTarget }}\n         if: ${{ inputs.skipNativeBuild != 'yes' }}\n \n       - name: Upload next-swc artifact\n@@ -224,7 +224,7 @@ jobs:\n       - run: pnpm playwright install chromium\n         if: ${{ inputs.skipInstallBuild != 'yes' }}\n \n-      - run: turbo run get-test-timings -- --build ${{ github.sha }}\n+      - run: pnpm dlx turbo@${TURBO_VERSION} run get-test-timings -- --build ${{ github.sha }}\n \n       - run: ${{ inputs.afterBuild }}\n         # defaults.run.shell sets a stronger options (`-leo pipefail`)"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 12,
        "deletions": 12
    }
}