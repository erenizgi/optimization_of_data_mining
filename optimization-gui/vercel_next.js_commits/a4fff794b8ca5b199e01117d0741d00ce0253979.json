{
    "author": "mischnic",
    "message": "Turbopack: correctly reference injected variable for Wasm on Edge (#78771)\n\nCloses PACK-4511\r\n\r\nConcerning that we have test coverage for this never the deployment test never ran with Turbopack: https://github.com/vercel/next.js/pull/78768\r\n\r\nThis never (?) worked: \r\n\r\n```js\r\nconst wasm_vercel_og__resvg = require(\"...\");\r\nfunction loadWebAssemblyModule() {\r\n\tconsole.log(globalThis[\"wasm_vercel_og__resvg\"]); // undefined\r\n}\r\nloadWebAssemblyModule();\r\n```\r\n\r\n\r\n\r\nWebpack generates the following, so let's do that as well\r\n```js\r\nconst wasm_77d9faebf7af9e421806970ce10a58e9d83116d7 = require(\"/wasm/wasm_77d9faebf7af9e421806970ce10a58e9d83116d7.wasm\");\r\n.....\r\n/***/ \"(rsc)/../../node_modules/.pnpm/next@15.4.0-canary.12_react-dom@19.0.0_react@19.0.0/node_modules/next/dist/compiled/@vercel/og/resvg.wasm?module\":\r\n/***/ ((module) => {\r\nmodule.exports = wasm_77d9faebf7af9e421806970ce10a58e9d83116d7;\r\n/***/ }),\r\n```",
    "sha": "a4fff794b8ca5b199e01117d0741d00ce0253979",
    "files": [
        {
            "sha": "542d4219397596173e81ff34ef2648173f27f750",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -4508,6 +4508,7 @@ dependencies = [\n  \"turbopack-env\",\n  \"turbopack-node\",\n  \"turbopack-nodejs\",\n+ \"turbopack-wasm\",\n  \"vergen 9.0.5\",\n ]\n \n@@ -10315,6 +10316,7 @@ dependencies = [\n  \"turbo-tasks\",\n  \"turbo-tasks-build\",\n  \"turbo-tasks-fs\",\n+ \"turbo-tasks-hash\",\n  \"turbopack-core\",\n  \"turbopack-ecmascript\",\n  \"wasmparser 0.110.0\","
        },
        {
            "sha": "214d3fdb9b3765ce53b0c40cbc07b5162a137d87",
            "filename": "crates/next-api/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2FCargo.toml?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -40,6 +40,7 @@ turbopack-ecmascript = { workspace = true }\n turbopack-env = { workspace = true }\n turbopack-node = { workspace = true }\n turbopack-nodejs = { workspace = true }\n+turbopack-wasm = { workspace = true }\n \n [build-dependencies]\n anyhow = { workspace = true }"
        },
        {
            "sha": "de3079b64da2c40100efb411343af5269f75d1d6",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -1556,7 +1556,7 @@ impl AppEndpoint {\n                     };\n                     let edge_function_definition = EdgeFunctionDefinition {\n                         files: file_paths_from_root.into_iter().collect(),\n-                        wasm: wasm_paths_to_bindings(wasm_paths_from_root.into_iter().collect()),\n+                        wasm: wasm_paths_to_bindings(wasm_paths_from_root).await?,\n                         assets: paths_to_bindings(all_assets),\n                         name: app_entry.pathname.clone(),\n                         page: app_entry.original_name.clone(),"
        },
        {
            "sha": "7fc3572b051581a4f1719bb05bd675103ce1246b",
            "filename": "crates/next-api/src/instrumentation.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -187,7 +187,7 @@ impl InstrumentationEndpoint {\n \n             let instrumentation_definition = InstrumentationDefinition {\n                 files: file_paths_from_root,\n-                wasm: wasm_paths_to_bindings(wasm_paths_from_root),\n+                wasm: wasm_paths_to_bindings(wasm_paths_from_root).await?,\n                 name: \"instrumentation\".into(),\n                 ..Default::default()\n             };"
        },
        {
            "sha": "765842cf26851c60ea1a25c0fd3e9802f7924264",
            "filename": "crates/next-api/src/middleware.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -304,7 +304,7 @@ impl MiddlewareEndpoint {\n \n             let edge_function_definition = EdgeFunctionDefinition {\n                 files: file_paths_from_root,\n-                wasm: wasm_paths_to_bindings(wasm_paths_from_root),\n+                wasm: wasm_paths_to_bindings(wasm_paths_from_root).await?,\n                 assets: paths_to_bindings(all_assets),\n                 name: \"middleware\".into(),\n                 page: \"/\".into(),"
        },
        {
            "sha": "c8d958d3bd2d9fc9e7e92348e74c37776e38f536",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -30,8 +30,8 @@ use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n-    fxindexmap, trace::TraceRawVcs, Completion, FxIndexMap, NonLocalValue, ResolvedVc, TaskInput,\n-    Value, ValueToString, Vc,\n+    fxindexmap, fxindexset, trace::TraceRawVcs, Completion, FxIndexMap, NonLocalValue, ResolvedVc,\n+    TaskInput, Value, ValueToString, Vc,\n };\n use turbo_tasks_fs::{\n     self, File, FileContent, FileSystem, FileSystemPath, FileSystemPathOption, VirtualFileSystem,\n@@ -1375,7 +1375,7 @@ impl PageEndpoint {\n                         \"server/middleware-build-manifest.js\".into(),\n                         \"server/next-font-manifest.js\".into(),\n                     ];\n-                    let mut wasm_paths_from_root = vec![];\n+                    let mut wasm_paths_from_root = fxindexset![];\n \n                     let node_root_value = node_root.await?;\n \n@@ -1404,7 +1404,7 @@ impl PageEndpoint {\n                     let original_name = this.original_name.owned().await?;\n                     let edge_function_definition = EdgeFunctionDefinition {\n                         files: file_paths_from_root,\n-                        wasm: wasm_paths_to_bindings(wasm_paths_from_root),\n+                        wasm: wasm_paths_to_bindings(wasm_paths_from_root).await?,\n                         assets: paths_to_bindings(all_assets),\n                         name: pathname.clone(),\n                         page: original_name.clone(),"
        },
        {
            "sha": "32c1f7da95af4830c98cf3914f34e8fbbe641dbe",
            "filename": "crates/next-api/src/paths.rs",
            "status": "modified",
            "additions": 30,
            "deletions": 35,
            "changes": 65,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Fpaths.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/crates%2Fnext-api%2Fsrc%2Fpaths.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpaths.rs?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -3,12 +3,15 @@ use next_core::{all_assets_from_entries, next_manifests::AssetBinding};\n use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{trace::TraceRawVcs, NonLocalValue, ResolvedVc, TryFlatJoinIterExt, Vc};\n+use turbo_tasks::{\n+    trace::TraceRawVcs, NonLocalValue, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Vc,\n+};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     output::{OutputAsset, OutputAssets},\n };\n+use turbopack_wasm::wasm_edge_var_name;\n \n /// A reference to a server file with content hash for change detection\n #[derive(Debug, Clone, PartialEq, Eq, Hash, Serialize, Deserialize, TraceRawVcs, NonLocalValue)]\n@@ -109,8 +112,23 @@ pub(crate) async fn get_js_paths_from_root(\n pub(crate) async fn get_wasm_paths_from_root(\n     root: &FileSystemPath,\n     output_assets: impl IntoIterator<Item = &ResolvedVc<Box<dyn OutputAsset>>>,\n-) -> Result<Vec<RcStr>> {\n-    get_paths_from_root(root, output_assets, |path| path.ends_with(\".wasm\")).await\n+) -> Result<Vec<(RcStr, ResolvedVc<Box<dyn OutputAsset>>)>> {\n+    output_assets\n+        .into_iter()\n+        .map(move |&file| async move {\n+            let path = &*file.path().await?;\n+            let Some(relative) = root.get_path_to(path) else {\n+                return Ok(None);\n+            };\n+\n+            Ok(if relative.ends_with(\".wasm\") {\n+                Some((relative.into(), file))\n+            } else {\n+                None\n+            })\n+        })\n+        .try_flat_join()\n+        .await\n }\n \n pub(crate) async fn get_asset_paths_from_root(\n@@ -137,42 +155,19 @@ pub(crate) async fn get_font_paths_from_root(\n     .await\n }\n \n-fn get_file_stem(path: &str) -> &str {\n-    let file_name = if let Some((_, file_name)) = path.rsplit_once('/') {\n-        file_name\n-    } else {\n-        path\n-    };\n-\n-    if let Some((stem, _)) = file_name.split_once('.') {\n-        if stem.is_empty() {\n-            file_name\n-        } else {\n-            stem\n-        }\n-    } else {\n-        file_name\n-    }\n-}\n-\n-pub(crate) fn wasm_paths_to_bindings(paths: Vec<RcStr>) -> Vec<AssetBinding> {\n+pub(crate) async fn wasm_paths_to_bindings(\n+    paths: impl IntoIterator<Item = (RcStr, ResolvedVc<Box<dyn OutputAsset>>)>,\n+) -> Result<Vec<AssetBinding>> {\n     paths\n         .into_iter()\n-        .map(|path| {\n-            let stem = get_file_stem(&path);\n-\n-            // very simple escaping just replacing unsupported characters with `_`\n-            let escaped = stem.replace(\n-                |c: char| !c.is_ascii_alphanumeric() && c != '$' && c != '_',\n-                \"_\",\n-            );\n-\n-            AssetBinding {\n-                name: format!(\"wasm_{}\", escaped).into(),\n+        .map(async |(path, asset)| {\n+            Ok(AssetBinding {\n+                name: wasm_edge_var_name(Vc::upcast(*asset)).owned().await?,\n                 file_path: path,\n-            }\n+            })\n         })\n-        .collect()\n+        .try_join()\n+        .await\n }\n \n pub(crate) fn paths_to_bindings(paths: Vec<RcStr>) -> Vec<AssetBinding> {"
        },
        {
            "sha": "1501a6caba606222f5f38a7f62c1b4f19926f506",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/js/src/browser/runtime/base/dummy.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fbrowser%2Fruntime%2Fbase%2Fdummy.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fbrowser%2Fruntime%2Fbase%2Fdummy.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fbrowser%2Fruntime%2Fbase%2Fdummy.ts?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -14,10 +14,12 @@ declare var BACKEND: RuntimeBackend\n declare var loadWebAssembly: (\n   source: SourceInfo,\n   wasmChunkPath: ChunkPath,\n+  edgeModule: () => WebAssembly.Module,\n   imports: WebAssembly.Imports\n ) => Exports\n declare var loadWebAssemblyModule: (\n   source: SourceInfo,\n-  wasmChunkPath: ChunkPath\n+  wasmChunkPath: ChunkPath,\n+  edgeModule: () => WebAssembly.Module\n ) => WebAssembly.Module\n declare var relativeURL: (inputUrl: string) => void"
        },
        {
            "sha": "a7b9d048e0fc089fc3365558fdcabf1d2253b3ee",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/js/src/browser/runtime/dom/runtime-backend-dom.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fbrowser%2Fruntime%2Fdom%2Fruntime-backend-dom.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fbrowser%2Fruntime%2Fdom%2Fruntime-backend-dom.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fbrowser%2Fruntime%2Fdom%2Fruntime-backend-dom.ts?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -31,6 +31,7 @@ function fetchWebAssembly(wasmChunkPath: ChunkPath) {\n async function loadWebAssembly(\n   _source: unknown,\n   wasmChunkPath: ChunkPath,\n+  _edgeModule: () => WebAssembly.Module,\n   importsObj: WebAssembly.Imports\n ): Promise<Exports> {\n   const req = fetchWebAssembly(wasmChunkPath)\n@@ -42,7 +43,8 @@ async function loadWebAssembly(\n \n async function loadWebAssemblyModule(\n   _source: unknown,\n-  wasmChunkPath: ChunkPath\n+  wasmChunkPath: ChunkPath,\n+  _edgeModule: () => WebAssembly.Module\n ): Promise<WebAssembly.Module> {\n   const req = fetchWebAssembly(wasmChunkPath)\n "
        },
        {
            "sha": "d5f6c95e3bd048c0219d791a113e7118dae59a0d",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/js/src/browser/runtime/edge/runtime-backend-edge.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 15,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fbrowser%2Fruntime%2Fedge%2Fruntime-backend-edge.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fbrowser%2Fruntime%2Fedge%2Fruntime-backend-edge.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fbrowser%2Fruntime%2Fedge%2Fruntime-backend-edge.ts?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -43,9 +43,10 @@ function augmentContext(\n async function loadWebAssembly(\n   source: SourceInfo,\n   chunkPath: ChunkPath,\n+  edgeModule: () => WebAssembly.Module,\n   imports: WebAssembly.Imports\n ): Promise<Exports> {\n-  const module = await loadWebAssemblyModule(source, chunkPath)\n+  const module = await loadWebAssemblyModule(source, chunkPath, edgeModule)\n \n   return await WebAssembly.instantiate(module, imports)\n }\n@@ -62,26 +63,19 @@ function getFileStem(path: string): string {\n   return stem\n }\n \n-type GlobalWithInjectedWebAssembly = typeof globalThis & {\n-  [key: `wasm_${string}`]: WebAssembly.Module\n-}\n-\n async function loadWebAssemblyModule(\n   _source: SourceInfo,\n-  chunkPath: ChunkPath\n+  chunkPath: ChunkPath,\n+  edgeModule: () => WebAssembly.Module\n ): Promise<WebAssembly.Module> {\n-  const stem = getFileStem(chunkPath)\n-\n-  // very simple escaping just replacing unsupported characters with `_`\n-  const escaped = stem.replace(/[^a-zA-Z0-9$_]/gi, '_')\n-\n-  const identifier: `wasm_${string}` = `wasm_${escaped}`\n-\n-  const module = (globalThis as GlobalWithInjectedWebAssembly)[identifier]\n+  let module\n+  try {\n+    module = edgeModule()\n+  } catch (_e) {}\n \n   if (!module) {\n     throw new Error(\n-      `dynamically loading WebAssembly is not supported in this runtime and global \\`${identifier}\\` was not injected`\n+      `dynamically loading WebAssembly is not supported in this runtime as global was not injected for chunk '${chunkPath}'`\n     )\n   }\n "
        },
        {
            "sha": "fe5ceae47fc1af3416bc1592dd6b9125140aa75d",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/js/src/nodejs/runtime.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 2,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fnodejs%2Fruntime.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fnodejs%2Fruntime.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fnodejs%2Fruntime.ts?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -190,13 +190,20 @@ async function loadChunkAsyncByUrl(source: SourceInfo, chunkUrl: string) {\n   return loadChunkAsync(source, path)\n }\n \n-function loadWebAssembly(chunkPath: ChunkPath, imports: WebAssembly.Imports) {\n+function loadWebAssembly(\n+  chunkPath: ChunkPath,\n+  _edgeModule: () => WebAssembly.Module,\n+  imports: WebAssembly.Imports\n+) {\n   const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\n \n   return instantiateWebAssemblyFromPath(resolved, imports)\n }\n \n-function loadWebAssemblyModule(chunkPath: ChunkPath) {\n+function loadWebAssemblyModule(\n+  chunkPath: ChunkPath,\n+  _edgeModule: () => WebAssembly.Module\n+) {\n   const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\n \n   return compileWebAssemblyFromPath(resolved)"
        },
        {
            "sha": "68b7ca46c6082c87598ff1f0c855fcdbb7a1d753",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/js/src/shared/runtime-types.d.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fshared%2Fruntime-types.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fshared%2Fruntime-types.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fjs%2Fsrc%2Fshared%2Fruntime-types.d.ts?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -45,9 +45,13 @@ type LoadChunk = (chunkPath: ChunkPath) => Promise<any> | undefined\n type LoadChunkByUrl = (chunkUrl: ChunkUrl) => Promise<any> | undefined\n type LoadWebAssembly = (\n   wasmChunkPath: ChunkPath,\n+  edgeModule: () => WebAssembly.Module,\n   imports: WebAssembly.Imports\n ) => Exports\n-type LoadWebAssemblyModule = (wasmChunkPath: ChunkPath) => WebAssembly.Module\n+type LoadWebAssemblyModule = (\n+  wasmChunkPath: ChunkPath,\n+  edgeModule: () => WebAssembly.Module\n+) => WebAssembly.Module\n \n type ModuleCache<M> = Record<ModuleId, M>\n type ModuleFactories = Record<ModuleId, unknown>"
        },
        {
            "sha": "76d9ccb7c294d18b50e31fc3f73124bda9f125c0",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/runtime/default_build_runtime/output/[turbopack]_runtime.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_build_runtime%2Foutput%2F%5Bturbopack%5D_runtime.js",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_build_runtime%2Foutput%2F%5Bturbopack%5D_runtime.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_build_runtime%2Foutput%2F%5Bturbopack%5D_runtime.js?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -540,11 +540,11 @@ async function loadChunkAsyncByUrl(source, chunkUrl) {\n     const path1 = url.fileURLToPath(new URL(chunkUrl, RUNTIME_ROOT));\n     return loadChunkAsync(source, path1);\n }\n-function loadWebAssembly(chunkPath, imports) {\n+function loadWebAssembly(chunkPath, _edgeModule, imports) {\n     const resolved = path.resolve(RUNTIME_ROOT, chunkPath);\n     return instantiateWebAssemblyFromPath(resolved, imports);\n }\n-function loadWebAssemblyModule(chunkPath) {\n+function loadWebAssemblyModule(chunkPath, _edgeModule) {\n     const resolved = path.resolve(RUNTIME_ROOT, chunkPath);\n     return compileWebAssemblyFromPath(resolved);\n }"
        },
        {
            "sha": "0b3301f60caca948caf2f37a40c706cdeb6fba9c",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/runtime/default_build_runtime/output/[turbopack]_runtime.js.map",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_build_runtime%2Foutput%2F%5Bturbopack%5D_runtime.js.map",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_build_runtime%2Foutput%2F%5Bturbopack%5D_runtime.js.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_build_runtime%2Foutput%2F%5Bturbopack%5D_runtime.js.map?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -6,5 +6,5 @@\n     {\"offset\": {\"line\": 337, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[turbopack]/shared-node/base-externals-utils.ts\"],\"sourcesContent\":[\"/* eslint-disable @typescript-eslint/no-unused-vars */\\n\\n/// <reference path=\\\"../shared/runtime-utils.ts\\\" />\\n\\n/// A 'base' utilities to support runtime can have externals.\\n/// Currently this is for node.js / edge runtime both.\\n/// If a fn requires node.js specific behavior, it should be placed in `node-external-utils` instead.\\n\\nasync function externalImport(id: ModuleId) {\\n  let raw\\n  try {\\n    raw = await import(id)\\n  } catch (err) {\\n    // TODO(alexkirsz) This can happen when a client-side module tries to load\\n    // an external module we don't provide a shim for (e.g. querystring, url).\\n    // For now, we fail semi-silently, but in the future this should be a\\n    // compilation error.\\n    throw new Error(`Failed to load external module ${id}: ${err}`)\\n  }\\n\\n  if (raw && raw.__esModule && raw.default && 'default' in raw.default) {\\n    return interopEsm(raw.default, createNS(raw), true)\\n  }\\n\\n  return raw\\n}\\n\\nfunction externalRequire(\\n  id: ModuleId,\\n  thunk: () => any,\\n  esm: boolean = false\\n): Exports | EsmNamespaceObject {\\n  let raw\\n  try {\\n    raw = thunk()\\n  } catch (err) {\\n    // TODO(alexkirsz) This can happen when a client-side module tries to load\\n    // an external module we don't provide a shim for (e.g. querystring, url).\\n    // For now, we fail semi-silently, but in the future this should be a\\n    // compilation error.\\n    throw new Error(`Failed to load external module ${id}: ${err}`)\\n  }\\n\\n  if (!esm || raw.__esModule) {\\n    return raw\\n  }\\n\\n  return interopEsm(raw, createNS(raw), true)\\n}\\n\\nexternalRequire.resolve = (\\n  id: string,\\n  options?: {\\n    paths?: string[]\\n  }\\n) => {\\n  return require.resolve(id, options)\\n}\\n\"],\"names\":[],\"mappings\":\"AAAA,oDAAoD,GAEpD,mDAAmD;AAEnD,6DAA6D;AAC7D,sDAAsD;AACtD,qGAAqG;AAErG,eAAe,eAAe,EAAY;IACxC,IAAI;IACJ,IAAI;QACF,MAAM,MAAM,MAAM,CAAC;IACrB,EAAE,OAAO,KAAK;QACZ,0EAA0E;QAC1E,0EAA0E;QAC1E,qEAAqE;QACrE,qBAAqB;QACrB,MAAM,IAAI,MAAM,CAAC,+BAA+B,EAAE,GAAG,EAAE,EAAE,KAAK;IAChE;IAEA,IAAI,OAAO,IAAI,UAAU,IAAI,IAAI,OAAO,IAAI,aAAa,IAAI,OAAO,EAAE;QACpE,OAAO,WAAW,IAAI,OAAO,EAAE,SAAS,MAAM;IAChD;IAEA,OAAO;AACT;AAEA,SAAS,gBACP,EAAY,EACZ,KAAgB,EAChB,MAAe,KAAK;IAEpB,IAAI;IACJ,IAAI;QACF,MAAM;IACR,EAAE,OAAO,KAAK;QACZ,0EAA0E;QAC1E,0EAA0E;QAC1E,qEAAqE;QACrE,qBAAqB;QACrB,MAAM,IAAI,MAAM,CAAC,+BAA+B,EAAE,GAAG,EAAE,EAAE,KAAK;IAChE;IAEA,IAAI,CAAC,OAAO,IAAI,UAAU,EAAE;QAC1B,OAAO;IACT;IAEA,OAAO,WAAW,KAAK,SAAS,MAAM;AACxC;AAEA,gBAAgB,OAAO,GAAG,CACxB,IACA;IAIA,OAAO,QAAQ,OAAO,CAAC,IAAI;AAC7B\",\"ignoreList\":[0]}},\n     {\"offset\": {\"line\": 376, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[turbopack]/shared-node/node-externals-utils.ts\"],\"sourcesContent\":[\"/* eslint-disable @typescript-eslint/no-unused-vars */\\n\\ndeclare var RUNTIME_PUBLIC_PATH: string\\ndeclare var RELATIVE_ROOT_PATH: string\\ndeclare var ASSET_PREFIX: string\\n\\nconst path = require('path')\\n\\nconst relativePathToRuntimeRoot = path.relative(RUNTIME_PUBLIC_PATH, '.')\\n// Compute the relative path to the `distDir`.\\nconst relativePathToDistRoot = path.join(\\n  relativePathToRuntimeRoot,\\n  RELATIVE_ROOT_PATH\\n)\\nconst RUNTIME_ROOT = path.resolve(__filename, relativePathToRuntimeRoot)\\n// Compute the absolute path to the root, by stripping distDir from the absolute path to this file.\\nconst ABSOLUTE_ROOT = path.resolve(__filename, relativePathToDistRoot)\\n\\n/**\\n * Returns an absolute path to the given module path.\\n * Module path should be relative, either path to a file or a directory.\\n *\\n * This fn allows to calculate an absolute path for some global static values, such as\\n * `__dirname` or `import.meta.url` that Turbopack will not embeds in compile time.\\n * See ImportMetaBinding::code_generation for the usage.\\n */\\nfunction resolveAbsolutePath(modulePath?: string): string {\\n  if (modulePath) {\\n    return path.join(ABSOLUTE_ROOT, modulePath)\\n  }\\n  return ABSOLUTE_ROOT\\n}\\n\"],\"names\":[],\"mappings\":\"AAAA,oDAAoD,GAMpD,MAAM,OAAO,QAAQ;AAErB,MAAM,4BAA4B,KAAK,QAAQ,CAAC,qBAAqB;AACrE,8CAA8C;AAC9C,MAAM,yBAAyB,KAAK,IAAI,CACtC,2BACA;AAEF,MAAM,eAAe,KAAK,OAAO,CAAC,YAAY;AAC9C,mGAAmG;AACnG,MAAM,gBAAgB,KAAK,OAAO,CAAC,YAAY;AAE/C;;;;;;;CAOC,GACD,SAAS,oBAAoB,UAAmB;IAC9C,IAAI,YAAY;QACd,OAAO,KAAK,IAAI,CAAC,eAAe;IAClC;IACA,OAAO;AACT\",\"ignoreList\":[0]}},\n     {\"offset\": {\"line\": 396, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[turbopack]/shared-node/node-wasm-utils.ts\"],\"sourcesContent\":[\"/* eslint-disable @typescript-eslint/no-unused-vars */\\n\\n/// <reference path=\\\"../shared/runtime-utils.ts\\\" />\\n\\nfunction readWebAssemblyAsResponse(path: string) {\\n  const { createReadStream } = require('fs') as typeof import('fs')\\n  const { Readable } = require('stream') as typeof import('stream')\\n\\n  const stream = createReadStream(path)\\n\\n  // @ts-ignore unfortunately there's a slight type mismatch with the stream.\\n  return new Response(Readable.toWeb(stream), {\\n    headers: {\\n      'content-type': 'application/wasm',\\n    },\\n  })\\n}\\n\\nasync function compileWebAssemblyFromPath(\\n  path: string\\n): Promise<WebAssembly.Module> {\\n  const response = readWebAssemblyAsResponse(path)\\n\\n  return await WebAssembly.compileStreaming(response)\\n}\\n\\nasync function instantiateWebAssemblyFromPath(\\n  path: string,\\n  importsObj: WebAssembly.Imports\\n): Promise<Exports> {\\n  const response = readWebAssemblyAsResponse(path)\\n\\n  const { instance } = await WebAssembly.instantiateStreaming(\\n    response,\\n    importsObj\\n  )\\n\\n  return instance.exports\\n}\\n\"],\"names\":[],\"mappings\":\"AAAA,oDAAoD,GAEpD,mDAAmD;AAEnD,SAAS,0BAA0B,IAAY;IAC7C,MAAM,EAAE,gBAAgB,EAAE,GAAG,QAAQ;IACrC,MAAM,EAAE,QAAQ,EAAE,GAAG,QAAQ;IAE7B,MAAM,SAAS,iBAAiB;IAEhC,2EAA2E;IAC3E,OAAO,IAAI,SAAS,SAAS,KAAK,CAAC,SAAS;QAC1C,SAAS;YACP,gBAAgB;QAClB;IACF;AACF;AAEA,eAAe,2BACb,IAAY;IAEZ,MAAM,WAAW,0BAA0B;IAE3C,OAAO,MAAM,YAAY,gBAAgB,CAAC;AAC5C;AAEA,eAAe,+BACb,IAAY,EACZ,UAA+B;IAE/B,MAAM,WAAW,0BAA0B;IAE3C,MAAM,EAAE,QAAQ,EAAE,GAAG,MAAM,YAAY,oBAAoB,CACzD,UACA;IAGF,OAAO,SAAS,OAAO;AACzB\",\"ignoreList\":[0]}},\n-    {\"offset\": {\"line\": 417, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[turbopack]/nodejs/runtime.ts\"],\"sourcesContent\":[\"/* eslint-disable @typescript-eslint/no-unused-vars */\\n\\n/// <reference path=\\\"../shared/runtime-utils.ts\\\" />\\n/// <reference path=\\\"../shared-node/base-externals-utils.ts\\\" />\\n/// <reference path=\\\"../shared-node/node-externals-utils.ts\\\" />\\n/// <reference path=\\\"../shared-node/node-wasm-utils.ts\\\" />\\n\\nenum SourceType {\\n  /**\\n   * The module was instantiated because it was included in an evaluated chunk's\\n   * runtime.\\n   */\\n  Runtime = 0,\\n  /**\\n   * The module was instantiated because a parent module imported it.\\n   */\\n  Parent = 1,\\n}\\n\\ntype SourceInfo =\\n  | {\\n      type: SourceType.Runtime\\n      chunkPath: ChunkPath\\n    }\\n  | {\\n      type: SourceType.Parent\\n      parentId: ModuleId\\n    }\\n\\nprocess.env.TURBOPACK = '1'\\n\\nfunction stringifySourceInfo(source: SourceInfo): string {\\n  switch (source.type) {\\n    case SourceType.Runtime:\\n      return `runtime for chunk ${source.chunkPath}`\\n    case SourceType.Parent:\\n      return `parent module ${source.parentId}`\\n    default:\\n      invariant(source, (source) => `Unknown source type: ${source?.type}`)\\n  }\\n}\\n\\ntype ExternalRequire = (\\n  id: ModuleId,\\n  thunk: () => any,\\n  esm?: boolean\\n) => Exports | EsmNamespaceObject\\ntype ExternalImport = (id: ModuleId) => Promise<Exports | EsmNamespaceObject>\\n\\ninterface TurbopackNodeBuildContext extends TurbopackBaseContext<Module> {\\n  R: ResolvePathFromModule\\n  x: ExternalRequire\\n  y: ExternalImport\\n}\\n\\ntype ModuleFactory = (\\n  this: Module['exports'],\\n  context: TurbopackNodeBuildContext\\n) => undefined\\n\\nconst url = require('url') as typeof import('url')\\nconst fs = require('fs/promises') as typeof import('fs/promises')\\n\\nconst moduleFactories: ModuleFactories = Object.create(null)\\nconst moduleCache: ModuleCache<ModuleWithDirection> = Object.create(null)\\n\\n/**\\n * Returns an absolute path to the given module's id.\\n */\\nfunction createResolvePathFromModule(\\n  resolver: (moduleId: string) => Exports\\n): (moduleId: string) => string {\\n  return function resolvePathFromModule(moduleId: string): string {\\n    const exported = resolver(moduleId)\\n    const exportedPath = exported?.default ?? exported\\n    if (typeof exportedPath !== 'string') {\\n      return exported as any\\n    }\\n\\n    const strippedAssetPrefix = exportedPath.slice(ASSET_PREFIX.length)\\n    const resolved = path.resolve(RUNTIME_ROOT, strippedAssetPrefix)\\n\\n    return url.pathToFileURL(resolved).href\\n  }\\n}\\n\\nfunction loadChunk(chunkData: ChunkData, source?: SourceInfo): void {\\n  if (typeof chunkData === 'string') {\\n    return loadChunkPath(chunkData, source)\\n  } else {\\n    return loadChunkPath(chunkData.path, source)\\n  }\\n}\\n\\nconst loadedChunks = new Set<ChunkPath>()\\n\\nfunction loadChunkPath(chunkPath: ChunkPath, source?: SourceInfo): void {\\n  if (!isJs(chunkPath)) {\\n    // We only support loading JS chunks in Node.js.\\n    // This branch can be hit when trying to load a CSS chunk.\\n    return\\n  }\\n\\n  if (loadedChunks.has(chunkPath)) {\\n    return\\n  }\\n\\n  try {\\n    const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\\n    const chunkModules: ModuleFactories = require(resolved)\\n\\n    for (const [moduleId, moduleFactory] of Object.entries(chunkModules)) {\\n      if (!moduleFactories[moduleId]) {\\n        moduleFactories[moduleId] = moduleFactory\\n      }\\n    }\\n    loadedChunks.add(chunkPath)\\n  } catch (e) {\\n    let errorMessage = `Failed to load chunk ${chunkPath}`\\n\\n    if (source) {\\n      errorMessage += ` from ${stringifySourceInfo(source)}`\\n    }\\n\\n    throw new Error(errorMessage, {\\n      cause: e,\\n    })\\n  }\\n}\\n\\nasync function loadChunkAsync(\\n  source: SourceInfo,\\n  chunkData: ChunkData\\n): Promise<any> {\\n  const chunkPath = typeof chunkData === 'string' ? chunkData : chunkData.path\\n  if (!isJs(chunkPath)) {\\n    // We only support loading JS chunks in Node.js.\\n    // This branch can be hit when trying to load a CSS chunk.\\n    return\\n  }\\n\\n  if (loadedChunks.has(chunkPath)) {\\n    return\\n  }\\n\\n  const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\\n\\n  try {\\n    const contents = await fs.readFile(resolved, 'utf-8')\\n\\n    const localRequire = (id: string) => {\\n      let resolvedId = require.resolve(id, { paths: [path.dirname(resolved)] })\\n      return require(resolvedId)\\n    }\\n    const module = {\\n      exports: {},\\n    }\\n    // TODO: Use vm.runInThisContext once our minimal supported Node.js version includes https://github.com/nodejs/node/pull/52153\\n    // eslint-disable-next-line no-eval -- Can't use vm.runInThisContext due to https://github.com/nodejs/node/issues/52102\\n    ;(0, eval)(\\n      '(function(module, exports, require, __dirname, __filename) {' +\\n        contents +\\n        '\\\\n})' +\\n        '\\\\n//# sourceURL=' +\\n        url.pathToFileURL(resolved)\\n    )(module, module.exports, localRequire, path.dirname(resolved), resolved)\\n\\n    const chunkModules: ModuleFactories = module.exports\\n    for (const [moduleId, moduleFactory] of Object.entries(chunkModules)) {\\n      if (!moduleFactories[moduleId]) {\\n        moduleFactories[moduleId] = moduleFactory\\n      }\\n    }\\n    loadedChunks.add(chunkPath)\\n  } catch (e) {\\n    let errorMessage = `Failed to load chunk ${chunkPath}`\\n\\n    if (source) {\\n      errorMessage += ` from ${stringifySourceInfo(source)}`\\n    }\\n\\n    throw new Error(errorMessage, {\\n      cause: e,\\n    })\\n  }\\n}\\n\\nasync function loadChunkAsyncByUrl(source: SourceInfo, chunkUrl: string) {\\n  const path = url.fileURLToPath(new URL(chunkUrl, RUNTIME_ROOT)) as ChunkPath\\n  return loadChunkAsync(source, path)\\n}\\n\\nfunction loadWebAssembly(chunkPath: ChunkPath, imports: WebAssembly.Imports) {\\n  const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\\n\\n  return instantiateWebAssemblyFromPath(resolved, imports)\\n}\\n\\nfunction loadWebAssemblyModule(chunkPath: ChunkPath) {\\n  const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\\n\\n  return compileWebAssemblyFromPath(resolved)\\n}\\n\\nfunction getWorkerBlobURL(_chunks: ChunkPath[]): string {\\n  throw new Error('Worker blobs are not implemented yet for Node.js')\\n}\\n\\nfunction instantiateModule(\\n  id: ModuleId,\\n  source: SourceInfo\\n): ModuleWithDirection {\\n  const moduleFactory = moduleFactories[id]\\n  if (typeof moduleFactory !== 'function') {\\n    // This can happen if modules incorrectly handle HMR disposes/updates,\\n    // e.g. when they keep a `setTimeout` around which still executes old code\\n    // and contains e.g. a `require(\\\"something\\\")` call.\\n    let instantiationReason\\n    switch (source.type) {\\n      case SourceType.Runtime:\\n        instantiationReason = `as a runtime entry of chunk ${source.chunkPath}`\\n        break\\n      case SourceType.Parent:\\n        instantiationReason = `because it was required from module ${source.parentId}`\\n        break\\n      default:\\n        invariant(source, (source) => `Unknown source type: ${source?.type}`)\\n    }\\n    throw new Error(\\n      `Module ${id} was instantiated ${instantiationReason}, but the module factory is not available. It might have been deleted in an HMR update.`\\n    )\\n  }\\n\\n  let parents: ModuleId[]\\n  switch (source.type) {\\n    case SourceType.Runtime:\\n      parents = []\\n      break\\n    case SourceType.Parent:\\n      // No need to add this module as a child of the parent module here, this\\n      // has already been taken care of in `getOrInstantiateModuleFromParent`.\\n      parents = [source.parentId]\\n      break\\n    default:\\n      invariant(source, (source) => `Unknown source type: ${source?.type}`)\\n  }\\n\\n  const module: ModuleWithDirection = {\\n    exports: {},\\n    error: undefined,\\n    loaded: false,\\n    id,\\n    parents,\\n    children: [],\\n    namespaceObject: undefined,\\n  }\\n  moduleCache[id] = module\\n\\n  // NOTE(alexkirsz) This can fail when the module encounters a runtime error.\\n  try {\\n    const r = commonJsRequire.bind(null, module)\\n    moduleFactory.call(module.exports, {\\n      a: asyncModule.bind(null, module),\\n      e: module.exports,\\n      r,\\n      t: runtimeRequire,\\n      x: externalRequire,\\n      y: externalImport,\\n      f: moduleContext,\\n      i: esmImport.bind(null, module),\\n      s: esmExport.bind(null, module, module.exports),\\n      j: dynamicExport.bind(null, module, module.exports),\\n      v: exportValue.bind(null, module),\\n      n: exportNamespace.bind(null, module),\\n      m: module,\\n      c: moduleCache,\\n      M: moduleFactories,\\n      l: loadChunkAsync.bind(null, { type: SourceType.Parent, parentId: id }),\\n      L: loadChunkAsyncByUrl.bind(null, {\\n        type: SourceType.Parent,\\n        parentId: id,\\n      }),\\n      w: loadWebAssembly,\\n      u: loadWebAssemblyModule,\\n      g: globalThis,\\n      P: resolveAbsolutePath,\\n      U: relativeURL,\\n      R: createResolvePathFromModule(r),\\n      b: getWorkerBlobURL,\\n      z: requireStub,\\n      __dirname:\\n        typeof module.id === 'string'\\n          ? module.id.replace(/(^|\\\\/)\\\\/+$/, '')\\n          : module.id,\\n    })\\n  } catch (error) {\\n    module.error = error as any\\n    throw error\\n  }\\n\\n  module.loaded = true\\n  if (module.namespaceObject && module.exports !== module.namespaceObject) {\\n    // in case of a circular dependency: cjs1 -> esm2 -> cjs1\\n    interopEsm(module.exports, module.namespaceObject)\\n  }\\n\\n  return module\\n}\\n\\n/**\\n * Retrieves a module from the cache, or instantiate it if it is not cached.\\n */\\n// @ts-ignore\\nfunction getOrInstantiateModuleFromParent(\\n  id: ModuleId,\\n  sourceModule: ModuleWithDirection\\n): ModuleWithDirection {\\n  const module = moduleCache[id]\\n\\n  if (sourceModule.children.indexOf(id) === -1) {\\n    sourceModule.children.push(id)\\n  }\\n\\n  if (module) {\\n    if (module.parents.indexOf(sourceModule.id) === -1) {\\n      module.parents.push(sourceModule.id)\\n    }\\n\\n    return module\\n  }\\n\\n  return instantiateModule(id, {\\n    type: SourceType.Parent,\\n    parentId: sourceModule.id,\\n  })\\n}\\n\\n/**\\n * Instantiates a runtime module.\\n */\\nfunction instantiateRuntimeModule(\\n  moduleId: ModuleId,\\n  chunkPath: ChunkPath\\n): Module {\\n  return instantiateModule(moduleId, { type: SourceType.Runtime, chunkPath })\\n}\\n\\n/**\\n * Retrieves a module from the cache, or instantiate it as a runtime module if it is not cached.\\n */\\n// @ts-ignore TypeScript doesn't separate this module space from the browser runtime\\nfunction getOrInstantiateRuntimeModule(\\n  moduleId: ModuleId,\\n  chunkPath: ChunkPath\\n): Module {\\n  const module = moduleCache[moduleId]\\n  if (module) {\\n    if (module.error) {\\n      throw module.error\\n    }\\n    return module\\n  }\\n\\n  return instantiateRuntimeModule(moduleId, chunkPath)\\n}\\n\\nconst regexJsUrl = /\\\\.js(?:\\\\?[^#]*)?(?:#.*)?$/\\n/**\\n * Checks if a given path/URL ends with .js, optionally followed by ?query or #fragment.\\n */\\nfunction isJs(chunkUrlOrPath: ChunkUrl | ChunkPath): boolean {\\n  return regexJsUrl.test(chunkUrlOrPath)\\n}\\n\\nmodule.exports = {\\n  getOrInstantiateRuntimeModule,\\n  loadChunk,\\n}\\n\"],\"names\":[],\"mappings\":\"AAAA,oDAAoD,GAEpD,mDAAmD;AACnD,+DAA+D;AAC/D,+DAA+D;AAC/D,0DAA0D;AAE1D,IAAA,AAAK,oCAAA;IACH;;;GAGC;IAED;;GAEC;WARE;EAAA;AAsBL,QAAQ,GAAG,CAAC,SAAS,GAAG;AAExB,SAAS,oBAAoB,MAAkB;IAC7C,OAAQ,OAAO,IAAI;QACjB;YACE,OAAO,CAAC,kBAAkB,EAAE,OAAO,SAAS,EAAE;QAChD;YACE,OAAO,CAAC,cAAc,EAAE,OAAO,QAAQ,EAAE;QAC3C;YACE,UAAU,QAAQ,CAAC,SAAW,CAAC,qBAAqB,EAAE,QAAQ,MAAM;IACxE;AACF;AAoBA,MAAM,MAAM,QAAQ;AACpB,MAAM,KAAK,QAAQ;AAEnB,MAAM,kBAAmC,OAAO,MAAM,CAAC;AACvD,MAAM,cAAgD,OAAO,MAAM,CAAC;AAEpE;;CAEC,GACD,SAAS,4BACP,QAAuC;IAEvC,OAAO,SAAS,sBAAsB,QAAgB;QACpD,MAAM,WAAW,SAAS;QAC1B,MAAM,eAAe,UAAU,WAAW;QAC1C,IAAI,OAAO,iBAAiB,UAAU;YACpC,OAAO;QACT;QAEA,MAAM,sBAAsB,aAAa,KAAK,CAAC,aAAa,MAAM;QAClE,MAAM,WAAW,KAAK,OAAO,CAAC,cAAc;QAE5C,OAAO,IAAI,aAAa,CAAC,UAAU,IAAI;IACzC;AACF;AAEA,SAAS,UAAU,SAAoB,EAAE,MAAmB;IAC1D,IAAI,OAAO,cAAc,UAAU;QACjC,OAAO,cAAc,WAAW;IAClC,OAAO;QACL,OAAO,cAAc,UAAU,IAAI,EAAE;IACvC;AACF;AAEA,MAAM,eAAe,IAAI;AAEzB,SAAS,cAAc,SAAoB,EAAE,MAAmB;IAC9D,IAAI,CAAC,KAAK,YAAY;QACpB,gDAAgD;QAChD,0DAA0D;QAC1D;IACF;IAEA,IAAI,aAAa,GAAG,CAAC,YAAY;QAC/B;IACF;IAEA,IAAI;QACF,MAAM,WAAW,KAAK,OAAO,CAAC,cAAc;QAC5C,MAAM,eAAgC,QAAQ;QAE9C,KAAK,MAAM,CAAC,UAAU,cAAc,IAAI,OAAO,OAAO,CAAC,cAAe;YACpE,IAAI,CAAC,eAAe,CAAC,SAAS,EAAE;gBAC9B,eAAe,CAAC,SAAS,GAAG;YAC9B;QACF;QACA,aAAa,GAAG,CAAC;IACnB,EAAE,OAAO,GAAG;QACV,IAAI,eAAe,CAAC,qBAAqB,EAAE,WAAW;QAEtD,IAAI,QAAQ;YACV,gBAAgB,CAAC,MAAM,EAAE,oBAAoB,SAAS;QACxD;QAEA,MAAM,IAAI,MAAM,cAAc;YAC5B,OAAO;QACT;IACF;AACF;AAEA,eAAe,eACb,MAAkB,EAClB,SAAoB;IAEpB,MAAM,YAAY,OAAO,cAAc,WAAW,YAAY,UAAU,IAAI;IAC5E,IAAI,CAAC,KAAK,YAAY;QACpB,gDAAgD;QAChD,0DAA0D;QAC1D;IACF;IAEA,IAAI,aAAa,GAAG,CAAC,YAAY;QAC/B;IACF;IAEA,MAAM,WAAW,KAAK,OAAO,CAAC,cAAc;IAE5C,IAAI;QACF,MAAM,WAAW,MAAM,GAAG,QAAQ,CAAC,UAAU;QAE7C,MAAM,eAAe,CAAC;YACpB,IAAI,aAAa,QAAQ,OAAO,CAAC,IAAI;gBAAE,OAAO;oBAAC,KAAK,OAAO,CAAC;iBAAU;YAAC;YACvE,OAAO,QAAQ;QACjB;QACA,MAAM,UAAS;YACb,SAAS,CAAC;QACZ;QAGC,CAAC,GAAG,IAAI,EACP,iEACE,WACA,SACA,qBACA,IAAI,aAAa,CAAC,WACpB,SAAQ,QAAO,OAAO,EAAE,cAAc,KAAK,OAAO,CAAC,WAAW;QAEhE,MAAM,eAAgC,QAAO,OAAO;QACpD,KAAK,MAAM,CAAC,UAAU,cAAc,IAAI,OAAO,OAAO,CAAC,cAAe;YACpE,IAAI,CAAC,eAAe,CAAC,SAAS,EAAE;gBAC9B,eAAe,CAAC,SAAS,GAAG;YAC9B;QACF;QACA,aAAa,GAAG,CAAC;IACnB,EAAE,OAAO,GAAG;QACV,IAAI,eAAe,CAAC,qBAAqB,EAAE,WAAW;QAEtD,IAAI,QAAQ;YACV,gBAAgB,CAAC,MAAM,EAAE,oBAAoB,SAAS;QACxD;QAEA,MAAM,IAAI,MAAM,cAAc;YAC5B,OAAO;QACT;IACF;AACF;AAEA,eAAe,oBAAoB,MAAkB,EAAE,QAAgB;IACrE,MAAM,QAAO,IAAI,aAAa,CAAC,IAAI,IAAI,UAAU;IACjD,OAAO,eAAe,QAAQ;AAChC;AAEA,SAAS,gBAAgB,SAAoB,EAAE,OAA4B;IACzE,MAAM,WAAW,KAAK,OAAO,CAAC,cAAc;IAE5C,OAAO,+BAA+B,UAAU;AAClD;AAEA,SAAS,sBAAsB,SAAoB;IACjD,MAAM,WAAW,KAAK,OAAO,CAAC,cAAc;IAE5C,OAAO,2BAA2B;AACpC;AAEA,SAAS,iBAAiB,OAAoB;IAC5C,MAAM,IAAI,MAAM;AAClB;AAEA,SAAS,kBACP,EAAY,EACZ,MAAkB;IAElB,MAAM,gBAAgB,eAAe,CAAC,GAAG;IACzC,IAAI,OAAO,kBAAkB,YAAY;QACvC,sEAAsE;QACtE,0EAA0E;QAC1E,mDAAmD;QACnD,IAAI;QACJ,OAAQ,OAAO,IAAI;YACjB;gBACE,sBAAsB,CAAC,4BAA4B,EAAE,OAAO,SAAS,EAAE;gBACvE;YACF;gBACE,sBAAsB,CAAC,oCAAoC,EAAE,OAAO,QAAQ,EAAE;gBAC9E;YACF;gBACE,UAAU,QAAQ,CAAC,SAAW,CAAC,qBAAqB,EAAE,QAAQ,MAAM;QACxE;QACA,MAAM,IAAI,MACR,CAAC,OAAO,EAAE,GAAG,kBAAkB,EAAE,oBAAoB,uFAAuF,CAAC;IAEjJ;IAEA,IAAI;IACJ,OAAQ,OAAO,IAAI;QACjB;YACE,UAAU,EAAE;YACZ;QACF;YACE,wEAAwE;YACxE,wEAAwE;YACxE,UAAU;gBAAC,OAAO,QAAQ;aAAC;YAC3B;QACF;YACE,UAAU,QAAQ,CAAC,SAAW,CAAC,qBAAqB,EAAE,QAAQ,MAAM;IACxE;IAEA,MAAM,UAA8B;QAClC,SAAS,CAAC;QACV,OAAO;QACP,QAAQ;QACR;QACA;QACA,UAAU,EAAE;QACZ,iBAAiB;IACnB;IACA,WAAW,CAAC,GAAG,GAAG;IAElB,4EAA4E;IAC5E,IAAI;QACF,MAAM,IAAI,gBAAgB,IAAI,CAAC,MAAM;QACrC,cAAc,IAAI,CAAC,QAAO,OAAO,EAAE;YACjC,GAAG,YAAY,IAAI,CAAC,MAAM;YAC1B,GAAG,QAAO,OAAO;YACjB;YACA,GAAG;YACH,GAAG;YACH,GAAG;YACH,GAAG;YACH,GAAG,UAAU,IAAI,CAAC,MAAM;YACxB,GAAG,UAAU,IAAI,CAAC,MAAM,SAAQ,QAAO,OAAO;YAC9C,GAAG,cAAc,IAAI,CAAC,MAAM,SAAQ,QAAO,OAAO;YAClD,GAAG,YAAY,IAAI,CAAC,MAAM;YAC1B,GAAG,gBAAgB,IAAI,CAAC,MAAM;YAC9B,GAAG;YACH,GAAG;YACH,GAAG;YACH,GAAG,eAAe,IAAI,CAAC,MAAM;gBAAE,IAAI;gBAAqB,UAAU;YAAG;YACrE,GAAG,oBAAoB,IAAI,CAAC,MAAM;gBAChC,IAAI;gBACJ,UAAU;YACZ;YACA,GAAG;YACH,GAAG;YACH,GAAG;YACH,GAAG;YACH,GAAG;YACH,GAAG,4BAA4B;YAC/B,GAAG;YACH,GAAG;YACH,WACE,OAAO,QAAO,EAAE,KAAK,WACjB,QAAO,EAAE,CAAC,OAAO,CAAC,cAAc,MAChC,QAAO,EAAE;QACjB;IACF,EAAE,OAAO,OAAO;QACd,QAAO,KAAK,GAAG;QACf,MAAM;IACR;IAEA,QAAO,MAAM,GAAG;IAChB,IAAI,QAAO,eAAe,IAAI,QAAO,OAAO,KAAK,QAAO,eAAe,EAAE;QACvE,yDAAyD;QACzD,WAAW,QAAO,OAAO,EAAE,QAAO,eAAe;IACnD;IAEA,OAAO;AACT;AAEA;;CAEC,GACD,aAAa;AACb,SAAS,iCACP,EAAY,EACZ,YAAiC;IAEjC,MAAM,UAAS,WAAW,CAAC,GAAG;IAE9B,IAAI,aAAa,QAAQ,CAAC,OAAO,CAAC,QAAQ,CAAC,GAAG;QAC5C,aAAa,QAAQ,CAAC,IAAI,CAAC;IAC7B;IAEA,IAAI,SAAQ;QACV,IAAI,QAAO,OAAO,CAAC,OAAO,CAAC,aAAa,EAAE,MAAM,CAAC,GAAG;YAClD,QAAO,OAAO,CAAC,IAAI,CAAC,aAAa,EAAE;QACrC;QAEA,OAAO;IACT;IAEA,OAAO,kBAAkB,IAAI;QAC3B,IAAI;QACJ,UAAU,aAAa,EAAE;IAC3B;AACF;AAEA;;CAEC,GACD,SAAS,yBACP,QAAkB,EAClB,SAAoB;IAEpB,OAAO,kBAAkB,UAAU;QAAE,IAAI;QAAsB;IAAU;AAC3E;AAEA;;CAEC,GACD,oFAAoF;AACpF,SAAS,8BACP,QAAkB,EAClB,SAAoB;IAEpB,MAAM,UAAS,WAAW,CAAC,SAAS;IACpC,IAAI,SAAQ;QACV,IAAI,QAAO,KAAK,EAAE;YAChB,MAAM,QAAO,KAAK;QACpB;QACA,OAAO;IACT;IAEA,OAAO,yBAAyB,UAAU;AAC5C;AAEA,MAAM,aAAa;AACnB;;CAEC,GACD,SAAS,KAAK,cAAoC;IAChD,OAAO,WAAW,IAAI,CAAC;AACzB;AAEA,OAAO,OAAO,GAAG;IACf;IACA;AACF\",\"ignoreList\":[0]}}]\n+    {\"offset\": {\"line\": 417, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[turbopack]/nodejs/runtime.ts\"],\"sourcesContent\":[\"/* eslint-disable @typescript-eslint/no-unused-vars */\\n\\n/// <reference path=\\\"../shared/runtime-utils.ts\\\" />\\n/// <reference path=\\\"../shared-node/base-externals-utils.ts\\\" />\\n/// <reference path=\\\"../shared-node/node-externals-utils.ts\\\" />\\n/// <reference path=\\\"../shared-node/node-wasm-utils.ts\\\" />\\n\\nenum SourceType {\\n  /**\\n   * The module was instantiated because it was included in an evaluated chunk's\\n   * runtime.\\n   */\\n  Runtime = 0,\\n  /**\\n   * The module was instantiated because a parent module imported it.\\n   */\\n  Parent = 1,\\n}\\n\\ntype SourceInfo =\\n  | {\\n      type: SourceType.Runtime\\n      chunkPath: ChunkPath\\n    }\\n  | {\\n      type: SourceType.Parent\\n      parentId: ModuleId\\n    }\\n\\nprocess.env.TURBOPACK = '1'\\n\\nfunction stringifySourceInfo(source: SourceInfo): string {\\n  switch (source.type) {\\n    case SourceType.Runtime:\\n      return `runtime for chunk ${source.chunkPath}`\\n    case SourceType.Parent:\\n      return `parent module ${source.parentId}`\\n    default:\\n      invariant(source, (source) => `Unknown source type: ${source?.type}`)\\n  }\\n}\\n\\ntype ExternalRequire = (\\n  id: ModuleId,\\n  thunk: () => any,\\n  esm?: boolean\\n) => Exports | EsmNamespaceObject\\ntype ExternalImport = (id: ModuleId) => Promise<Exports | EsmNamespaceObject>\\n\\ninterface TurbopackNodeBuildContext extends TurbopackBaseContext<Module> {\\n  R: ResolvePathFromModule\\n  x: ExternalRequire\\n  y: ExternalImport\\n}\\n\\ntype ModuleFactory = (\\n  this: Module['exports'],\\n  context: TurbopackNodeBuildContext\\n) => undefined\\n\\nconst url = require('url') as typeof import('url')\\nconst fs = require('fs/promises') as typeof import('fs/promises')\\n\\nconst moduleFactories: ModuleFactories = Object.create(null)\\nconst moduleCache: ModuleCache<ModuleWithDirection> = Object.create(null)\\n\\n/**\\n * Returns an absolute path to the given module's id.\\n */\\nfunction createResolvePathFromModule(\\n  resolver: (moduleId: string) => Exports\\n): (moduleId: string) => string {\\n  return function resolvePathFromModule(moduleId: string): string {\\n    const exported = resolver(moduleId)\\n    const exportedPath = exported?.default ?? exported\\n    if (typeof exportedPath !== 'string') {\\n      return exported as any\\n    }\\n\\n    const strippedAssetPrefix = exportedPath.slice(ASSET_PREFIX.length)\\n    const resolved = path.resolve(RUNTIME_ROOT, strippedAssetPrefix)\\n\\n    return url.pathToFileURL(resolved).href\\n  }\\n}\\n\\nfunction loadChunk(chunkData: ChunkData, source?: SourceInfo): void {\\n  if (typeof chunkData === 'string') {\\n    return loadChunkPath(chunkData, source)\\n  } else {\\n    return loadChunkPath(chunkData.path, source)\\n  }\\n}\\n\\nconst loadedChunks = new Set<ChunkPath>()\\n\\nfunction loadChunkPath(chunkPath: ChunkPath, source?: SourceInfo): void {\\n  if (!isJs(chunkPath)) {\\n    // We only support loading JS chunks in Node.js.\\n    // This branch can be hit when trying to load a CSS chunk.\\n    return\\n  }\\n\\n  if (loadedChunks.has(chunkPath)) {\\n    return\\n  }\\n\\n  try {\\n    const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\\n    const chunkModules: ModuleFactories = require(resolved)\\n\\n    for (const [moduleId, moduleFactory] of Object.entries(chunkModules)) {\\n      if (!moduleFactories[moduleId]) {\\n        moduleFactories[moduleId] = moduleFactory\\n      }\\n    }\\n    loadedChunks.add(chunkPath)\\n  } catch (e) {\\n    let errorMessage = `Failed to load chunk ${chunkPath}`\\n\\n    if (source) {\\n      errorMessage += ` from ${stringifySourceInfo(source)}`\\n    }\\n\\n    throw new Error(errorMessage, {\\n      cause: e,\\n    })\\n  }\\n}\\n\\nasync function loadChunkAsync(\\n  source: SourceInfo,\\n  chunkData: ChunkData\\n): Promise<any> {\\n  const chunkPath = typeof chunkData === 'string' ? chunkData : chunkData.path\\n  if (!isJs(chunkPath)) {\\n    // We only support loading JS chunks in Node.js.\\n    // This branch can be hit when trying to load a CSS chunk.\\n    return\\n  }\\n\\n  if (loadedChunks.has(chunkPath)) {\\n    return\\n  }\\n\\n  const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\\n\\n  try {\\n    const contents = await fs.readFile(resolved, 'utf-8')\\n\\n    const localRequire = (id: string) => {\\n      let resolvedId = require.resolve(id, { paths: [path.dirname(resolved)] })\\n      return require(resolvedId)\\n    }\\n    const module = {\\n      exports: {},\\n    }\\n    // TODO: Use vm.runInThisContext once our minimal supported Node.js version includes https://github.com/nodejs/node/pull/52153\\n    // eslint-disable-next-line no-eval -- Can't use vm.runInThisContext due to https://github.com/nodejs/node/issues/52102\\n    ;(0, eval)(\\n      '(function(module, exports, require, __dirname, __filename) {' +\\n        contents +\\n        '\\\\n})' +\\n        '\\\\n//# sourceURL=' +\\n        url.pathToFileURL(resolved)\\n    )(module, module.exports, localRequire, path.dirname(resolved), resolved)\\n\\n    const chunkModules: ModuleFactories = module.exports\\n    for (const [moduleId, moduleFactory] of Object.entries(chunkModules)) {\\n      if (!moduleFactories[moduleId]) {\\n        moduleFactories[moduleId] = moduleFactory\\n      }\\n    }\\n    loadedChunks.add(chunkPath)\\n  } catch (e) {\\n    let errorMessage = `Failed to load chunk ${chunkPath}`\\n\\n    if (source) {\\n      errorMessage += ` from ${stringifySourceInfo(source)}`\\n    }\\n\\n    throw new Error(errorMessage, {\\n      cause: e,\\n    })\\n  }\\n}\\n\\nasync function loadChunkAsyncByUrl(source: SourceInfo, chunkUrl: string) {\\n  const path = url.fileURLToPath(new URL(chunkUrl, RUNTIME_ROOT)) as ChunkPath\\n  return loadChunkAsync(source, path)\\n}\\n\\nfunction loadWebAssembly(\\n  chunkPath: ChunkPath,\\n  _edgeModule: () => WebAssembly.Module,\\n  imports: WebAssembly.Imports\\n) {\\n  const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\\n\\n  return instantiateWebAssemblyFromPath(resolved, imports)\\n}\\n\\nfunction loadWebAssemblyModule(\\n  chunkPath: ChunkPath,\\n  _edgeModule: () => WebAssembly.Module\\n) {\\n  const resolved = path.resolve(RUNTIME_ROOT, chunkPath)\\n\\n  return compileWebAssemblyFromPath(resolved)\\n}\\n\\nfunction getWorkerBlobURL(_chunks: ChunkPath[]): string {\\n  throw new Error('Worker blobs are not implemented yet for Node.js')\\n}\\n\\nfunction instantiateModule(\\n  id: ModuleId,\\n  source: SourceInfo\\n): ModuleWithDirection {\\n  const moduleFactory = moduleFactories[id]\\n  if (typeof moduleFactory !== 'function') {\\n    // This can happen if modules incorrectly handle HMR disposes/updates,\\n    // e.g. when they keep a `setTimeout` around which still executes old code\\n    // and contains e.g. a `require(\\\"something\\\")` call.\\n    let instantiationReason\\n    switch (source.type) {\\n      case SourceType.Runtime:\\n        instantiationReason = `as a runtime entry of chunk ${source.chunkPath}`\\n        break\\n      case SourceType.Parent:\\n        instantiationReason = `because it was required from module ${source.parentId}`\\n        break\\n      default:\\n        invariant(source, (source) => `Unknown source type: ${source?.type}`)\\n    }\\n    throw new Error(\\n      `Module ${id} was instantiated ${instantiationReason}, but the module factory is not available. It might have been deleted in an HMR update.`\\n    )\\n  }\\n\\n  let parents: ModuleId[]\\n  switch (source.type) {\\n    case SourceType.Runtime:\\n      parents = []\\n      break\\n    case SourceType.Parent:\\n      // No need to add this module as a child of the parent module here, this\\n      // has already been taken care of in `getOrInstantiateModuleFromParent`.\\n      parents = [source.parentId]\\n      break\\n    default:\\n      invariant(source, (source) => `Unknown source type: ${source?.type}`)\\n  }\\n\\n  const module: ModuleWithDirection = {\\n    exports: {},\\n    error: undefined,\\n    loaded: false,\\n    id,\\n    parents,\\n    children: [],\\n    namespaceObject: undefined,\\n  }\\n  moduleCache[id] = module\\n\\n  // NOTE(alexkirsz) This can fail when the module encounters a runtime error.\\n  try {\\n    const r = commonJsRequire.bind(null, module)\\n    moduleFactory.call(module.exports, {\\n      a: asyncModule.bind(null, module),\\n      e: module.exports,\\n      r,\\n      t: runtimeRequire,\\n      x: externalRequire,\\n      y: externalImport,\\n      f: moduleContext,\\n      i: esmImport.bind(null, module),\\n      s: esmExport.bind(null, module, module.exports),\\n      j: dynamicExport.bind(null, module, module.exports),\\n      v: exportValue.bind(null, module),\\n      n: exportNamespace.bind(null, module),\\n      m: module,\\n      c: moduleCache,\\n      M: moduleFactories,\\n      l: loadChunkAsync.bind(null, { type: SourceType.Parent, parentId: id }),\\n      L: loadChunkAsyncByUrl.bind(null, {\\n        type: SourceType.Parent,\\n        parentId: id,\\n      }),\\n      w: loadWebAssembly,\\n      u: loadWebAssemblyModule,\\n      g: globalThis,\\n      P: resolveAbsolutePath,\\n      U: relativeURL,\\n      R: createResolvePathFromModule(r),\\n      b: getWorkerBlobURL,\\n      z: requireStub,\\n      __dirname:\\n        typeof module.id === 'string'\\n          ? module.id.replace(/(^|\\\\/)\\\\/+$/, '')\\n          : module.id,\\n    })\\n  } catch (error) {\\n    module.error = error as any\\n    throw error\\n  }\\n\\n  module.loaded = true\\n  if (module.namespaceObject && module.exports !== module.namespaceObject) {\\n    // in case of a circular dependency: cjs1 -> esm2 -> cjs1\\n    interopEsm(module.exports, module.namespaceObject)\\n  }\\n\\n  return module\\n}\\n\\n/**\\n * Retrieves a module from the cache, or instantiate it if it is not cached.\\n */\\n// @ts-ignore\\nfunction getOrInstantiateModuleFromParent(\\n  id: ModuleId,\\n  sourceModule: ModuleWithDirection\\n): ModuleWithDirection {\\n  const module = moduleCache[id]\\n\\n  if (sourceModule.children.indexOf(id) === -1) {\\n    sourceModule.children.push(id)\\n  }\\n\\n  if (module) {\\n    if (module.parents.indexOf(sourceModule.id) === -1) {\\n      module.parents.push(sourceModule.id)\\n    }\\n\\n    return module\\n  }\\n\\n  return instantiateModule(id, {\\n    type: SourceType.Parent,\\n    parentId: sourceModule.id,\\n  })\\n}\\n\\n/**\\n * Instantiates a runtime module.\\n */\\nfunction instantiateRuntimeModule(\\n  moduleId: ModuleId,\\n  chunkPath: ChunkPath\\n): Module {\\n  return instantiateModule(moduleId, { type: SourceType.Runtime, chunkPath })\\n}\\n\\n/**\\n * Retrieves a module from the cache, or instantiate it as a runtime module if it is not cached.\\n */\\n// @ts-ignore TypeScript doesn't separate this module space from the browser runtime\\nfunction getOrInstantiateRuntimeModule(\\n  moduleId: ModuleId,\\n  chunkPath: ChunkPath\\n): Module {\\n  const module = moduleCache[moduleId]\\n  if (module) {\\n    if (module.error) {\\n      throw module.error\\n    }\\n    return module\\n  }\\n\\n  return instantiateRuntimeModule(moduleId, chunkPath)\\n}\\n\\nconst regexJsUrl = /\\\\.js(?:\\\\?[^#]*)?(?:#.*)?$/\\n/**\\n * Checks if a given path/URL ends with .js, optionally followed by ?query or #fragment.\\n */\\nfunction isJs(chunkUrlOrPath: ChunkUrl | ChunkPath): boolean {\\n  return regexJsUrl.test(chunkUrlOrPath)\\n}\\n\\nmodule.exports = {\\n  getOrInstantiateRuntimeModule,\\n  loadChunk,\\n}\\n\"],\"names\":[],\"mappings\":\"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\",\"ignoreList\":[0]}}]\n }\n\\ No newline at end of file"
        },
        {
            "sha": "4da58585b5af21879e2f46ff4959b1f170eb6d80",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/runtime/default_dev_runtime/output/b1abf_turbopack-tests_tests_snapshot_runtime_default_dev_runtime_input_index_75df6705.js",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_dev_runtime%2Foutput%2Fb1abf_turbopack-tests_tests_snapshot_runtime_default_dev_runtime_input_index_75df6705.js",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_dev_runtime%2Foutput%2Fb1abf_turbopack-tests_tests_snapshot_runtime_default_dev_runtime_input_index_75df6705.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_dev_runtime%2Foutput%2Fb1abf_turbopack-tests_tests_snapshot_runtime_default_dev_runtime_input_index_75df6705.js?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -1440,12 +1440,12 @@ function augmentContext(context) {\n function fetchWebAssembly(wasmChunkPath) {\n     return fetch(getChunkRelativeUrl(wasmChunkPath));\n }\n-async function loadWebAssembly(_source, wasmChunkPath, importsObj) {\n+async function loadWebAssembly(_source, wasmChunkPath, _edgeModule, importsObj) {\n     const req = fetchWebAssembly(wasmChunkPath);\n     const { instance } = await WebAssembly.instantiateStreaming(req, importsObj);\n     return instance.exports;\n }\n-async function loadWebAssemblyModule(_source, wasmChunkPath) {\n+async function loadWebAssemblyModule(_source, wasmChunkPath, _edgeModule) {\n     const req = fetchWebAssembly(wasmChunkPath);\n     return await WebAssembly.compileStreaming(req);\n }"
        },
        {
            "sha": "b6c0a9276a1b99e7f0e11a2cdfeac87cf2cdf654",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/runtime/default_dev_runtime/output/b1abf_turbopack-tests_tests_snapshot_runtime_default_dev_runtime_input_index_75df6705.js.map",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_dev_runtime%2Foutput%2Fb1abf_turbopack-tests_tests_snapshot_runtime_default_dev_runtime_input_index_75df6705.js.map",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_dev_runtime%2Foutput%2Fb1abf_turbopack-tests_tests_snapshot_runtime_default_dev_runtime_input_index_75df6705.js.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fruntime%2Fdefault_dev_runtime%2Foutput%2Fb1abf_turbopack-tests_tests_snapshot_runtime_default_dev_runtime_input_index_75df6705.js.map?ref=a4fff794b8ca5b199e01117d0741d00ce0253979"
        },
        {
            "sha": "5a32ea1143e3eea7591c7094a97efba3d563fa12",
            "filename": "turbopack/crates/turbopack-wasm/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-wasm%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-wasm%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2FCargo.toml?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -20,6 +20,7 @@ serde = { workspace = true }\n turbo-rcstr = { workspace = true }\n turbo-tasks = { workspace = true }\n turbo-tasks-fs = { workspace = true }\n+turbo-tasks-hash = { workspace = true }\n turbopack-core = { workspace = true }\n turbopack-ecmascript = { workspace = true }\n wasmparser = \"0.110.0\""
        },
        {
            "sha": "e485aaab749c4abdaba6a6c907318516be392a8a",
            "filename": "turbopack/crates/turbopack-wasm/src/lib.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Flib.rs?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -9,13 +9,27 @@\n #![feature(arbitrary_self_types)]\n #![feature(arbitrary_self_types_pointers)]\n \n+use anyhow::Result;\n+use turbo_rcstr::RcStr;\n+use turbo_tasks::Vc;\n+use turbo_tasks_hash::hash_xxh3_hash64;\n+use turbopack_core::asset::Asset;\n+\n pub(crate) mod analysis;\n pub(crate) mod loader;\n pub mod module_asset;\n pub(crate) mod output_asset;\n pub mod raw;\n pub mod source;\n \n+#[turbo_tasks::function]\n+pub async fn wasm_edge_var_name(asset: Vc<Box<dyn Asset>>) -> Result<Vc<RcStr>> {\n+    let content = asset.content().file_content().await?;\n+    Ok(Vc::cell(\n+        format!(\"wasm_{:08x}\", hash_xxh3_hash64(content)).into(),\n+    ))\n+}\n+\n pub fn register() {\n     turbo_tasks::register();\n     turbo_tasks_fs::register();"
        },
        {
            "sha": "080173feec61a35c9f09f4f9e56d68e07e22c746",
            "filename": "turbopack/crates/turbopack-wasm/src/loader.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 7,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Floader.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a4fff794b8ca5b199e01117d0741d00ce0253979/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Floader.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Floader.rs?ref=a4fff794b8ca5b199e01117d0741d00ce0253979",
            "patch": "@@ -8,7 +8,7 @@ use turbo_tasks_fs::File;\n use turbopack_core::{asset::AssetContent, source::Source, virtual_source::VirtualSource};\n use turbopack_ecmascript::utils::StringifyJs;\n \n-use crate::{analysis::analyze, source::WebAssemblySource};\n+use crate::{analysis::analyze, source::WebAssemblySource, wasm_edge_var_name};\n \n /// Create a javascript loader to instantiate the WebAssembly module with the\n /// necessary imports and exports to be processed by [turbopack_ecmascript].\n@@ -44,10 +44,11 @@ pub(crate) async fn instantiating_loader_source(\n     writedoc!(\n         code,\n         r#\"\n-            const {{ {exports} }} = await __turbopack_wasm__(wasmPath, {imports});\n+            const {{ {exports} }} = await __turbopack_wasm__(wasmPath, () => {edgeVariable}, {imports});\n \n             export {{ {exports} }};\n         \"#,\n+        edgeVariable = wasm_edge_var_name(Vc::upcast(source)).await?,\n         imports = imports_obj,\n         exports = analysis.exports.join(\", \"),\n     )?;\n@@ -63,20 +64,23 @@ pub(crate) async fn instantiating_loader_source(\n /// Create a javascript loader to compile the WebAssembly module and export it\n /// without instantiating.\n #[turbo_tasks::function]\n-pub(crate) fn compiling_loader_source(source: Vc<WebAssemblySource>) -> Vc<Box<dyn Source>> {\n+pub(crate) async fn compiling_loader_source(\n+    source: Vc<WebAssemblySource>,\n+) -> Result<Vc<Box<dyn Source>>> {\n     let code: RcStr = formatdoc! {\n         r#\"\n             import wasmPath from \"WASM_PATH\";\n \n-            const mod = await __turbopack_wasm_module__(wasmPath);\n+            const mod = await __turbopack_wasm_module__(wasmPath, () => {edgeVariable});\n \n             export default mod;\n-        \"#\n+        \"#,\n+        edgeVariable = wasm_edge_var_name(Vc::upcast(source)).await?\n     }\n     .into();\n \n-    Vc::upcast(VirtualSource::new(\n+    Ok(Vc::upcast(VirtualSource::new(\n         source.ident().path().append(\"_.loader.mjs\".into()),\n         AssetContent::file(File::from(code).into()),\n-    ))\n+    )))\n }"
        }
    ],
    "stats": {
        "total": 176,
        "additions": 101,
        "deletions": 75
    }
}