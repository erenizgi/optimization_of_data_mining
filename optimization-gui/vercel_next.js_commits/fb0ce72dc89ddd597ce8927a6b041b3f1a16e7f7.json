{
    "author": "lukesandberg",
    "message": "[turbopack] Simplify the definition of AssetIdent (#79805)\n\nReplace the `ResolvedVc<RcStr>` uses inside of `AssetIdent` with `RcStr` directly\n\n## Why\n\nThis simplifies construction and usage and provides more reasonably equality semantics.  In principle, storing `ResolvedVc` would enable finer grained invalidations.  e.g. if only the `query` changed and a task only depended upon the `modifiers` then that task wouldn't get invalidated.  However, the entire `Assetident` is often consumed monolithically already.  For example, it is when producing output chunks and constructing the modulegraph (via the `to_string` function).  So modeling it more monolitically seems appropriate.\n\nAdditionally, by accepting `RcStr` values as _values_ instead of `cells` we clarify equality semantics.  So we should expect to get _more_ cache hits from `AssetIdent::new`.   In principle this may make equality slower, but it is very rare that any of the RcStr instances involved are more than a handful of bytes, so this shouldn't be much of a concern.\n\nThis makes the type slightly smaller, now it is `120 bytes` instead of `144 bytes`, which should help with performance a bit since there are many thousands of these in a build.\n\n## What\n\nThis was mostly done by just replacing the types and chasing build errors backwards to remove the `ResolvedVc` values at the source.  This allowed me to replace many tiny turbotask functions with the `rcstr!` macro and remove many calls to `cell`.\n\n## Performance\n\n![image.png](https://graphite-user-uploaded-assets-prod.s3.amazonaws.com/AwJ29EfoPcPdLSwCZxAz/70962bb3-5a5a-4762-9580-a38141f84c1c.png)\n\nTesting `vercel-site` reveals a small improvement in MaxRSS which is expected due to 1. eliminating a bunch of turbotask cells, and 2 reducing the size of `AssetIdent`",
    "sha": "fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
    "files": [
        {
            "sha": "cd40305f727c6fc1615c8becfacc6bfa2a770a9b",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 22,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -37,7 +37,7 @@ use next_core::{\n };\n use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     Completion, FxIndexSet, NonLocalValue, ResolvedVc, TryJoinIterExt, Value, ValueToString, Vc,\n     fxindexmap, fxindexset, trace::TraceRawVcs,\n@@ -438,7 +438,7 @@ impl AppProject {\n             self.project().server_compile_time_info(),\n             self.rsc_module_options_context(),\n             self.rsc_resolve_options_context(),\n-            Vc::cell(\"app-rsc\".into()),\n+            rcstr!(\"app-rsc\"),\n         ))\n     }\n \n@@ -453,7 +453,7 @@ impl AppProject {\n             self.project().edge_compile_time_info(),\n             self.edge_rsc_module_options_context(),\n             self.edge_rsc_resolve_options_context(),\n-            Vc::cell(\"app-edge-rsc\".into()),\n+            rcstr!(\"app-edge-rsc\"),\n         ))\n     }\n \n@@ -504,7 +504,7 @@ impl AppProject {\n             self.project().server_compile_time_info(),\n             self.route_module_options_context(),\n             self.route_resolve_options_context(),\n-            Vc::cell(\"app-route\".into()),\n+            rcstr!(\"app-route\"),\n         ))\n     }\n \n@@ -554,7 +554,7 @@ impl AppProject {\n             self.project().edge_compile_time_info(),\n             self.edge_route_module_options_context(),\n             self.edge_route_resolve_options_context(),\n-            Vc::cell(\"app-edge-route\".into()),\n+            rcstr!(\"app-edge-route\"),\n         ))\n     }\n \n@@ -581,7 +581,7 @@ impl AppProject {\n             self.project().client_compile_time_info(),\n             self.client_module_options_context(),\n             self.client_resolve_options_context(),\n-            Vc::cell(\"app-client\".into()),\n+            rcstr!(\"app-client\"),\n         ))\n     }\n \n@@ -664,7 +664,7 @@ impl AppProject {\n             self.project().server_compile_time_info(),\n             self.ssr_module_options_context(),\n             self.ssr_resolve_options_context(),\n-            Vc::cell(\"app-ssr\".into()),\n+            rcstr!(\"app-ssr\"),\n         ))\n     }\n \n@@ -684,7 +684,7 @@ impl AppProject {\n             self.project().server_compile_time_info(),\n             self.ssr_module_options_context(),\n             self.ssr_resolve_options_context(),\n-            Vc::cell(\"app-shared\".into()),\n+            rcstr!(\"app-shared\"),\n         ))\n     }\n \n@@ -724,7 +724,7 @@ impl AppProject {\n             self.project().edge_compile_time_info(),\n             self.edge_ssr_module_options_context(),\n             self.edge_ssr_resolve_options_context(),\n-            Vc::cell(\"app-edge-ssr\".into()),\n+            rcstr!(\"app-edge-ssr\"),\n         ))\n     }\n \n@@ -744,7 +744,7 @@ impl AppProject {\n             self.project().edge_compile_time_info(),\n             self.edge_ssr_module_options_context(),\n             self.edge_ssr_resolve_options_context(),\n-            Vc::cell(\"app-edge-shared\".into()),\n+            rcstr!(\"app-edge-shared\"),\n         ))\n     }\n \n@@ -1027,16 +1027,6 @@ pub fn app_entry_point_to_route(\n     .cell()\n }\n \n-#[turbo_tasks::function]\n-fn client_shared_chunks_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"client-shared-chunks\".into())\n-}\n-\n-#[turbo_tasks::function]\n-fn server_utils_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"server-utils\".into())\n-}\n-\n #[turbo_tasks::value(transparent)]\n struct OutputAssetsWithAvailability((ResolvedVc<OutputAssets>, AvailabilityInfo));\n \n@@ -1230,7 +1220,7 @@ impl AppEndpoint {\n \n         let client_shared_chunk_group = get_app_client_shared_chunk_group(\n             AssetIdent::from_path(project.project_path())\n-                .with_modifier(client_shared_chunks_modifier()),\n+                .with_modifier(rcstr!(\"client-shared-chunks\")),\n             this.app_project.client_runtime_entries(),\n             *module_graphs.full,\n             *client_chunking_context,\n@@ -1785,7 +1775,7 @@ impl AppEndpoint {\n                         let chunk_group = chunking_context\n                             .chunk_group(\n                                 AssetIdent::from_path(this.app_project.project().project_path())\n-                                    .with_modifier(server_utils_modifier()),\n+                                    .with_modifier(rcstr!(\"server-utils\")),\n                                 // TODO this should be ChunkGroup::Shared\n                                 ChunkGroup::Entry(server_utils),\n                                 module_graph,"
        },
        {
            "sha": "91fdb2ccc28ddbb82add03431944fd5302065737",
            "filename": "crates/next-api/src/dynamic_imports.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -126,11 +126,14 @@ pub async fn map_next_dynamic(graph: Vc<SingleModuleGraph>) -> Result<Vc<Dynamic\n         .iter_nodes()\n         .map(|node| async move {\n             let SingleModuleGraphModuleNode { module } = node;\n-            let layer = match module.ident().await?.layer {\n-                Some(l) => Some(l.await?),\n-                None => None,\n-            };\n-            if layer.is_some_and(|layer| *layer == \"app-client\" || *layer == \"client\") {\n+\n+            if module\n+                .ident()\n+                .await?\n+                .layer\n+                .as_ref()\n+                .is_some_and(|layer| *layer == \"app-client\" || *layer == \"client\")\n+            {\n                 if let Some(dynamic_entry_module) =\n                     ResolvedVc::try_downcast_type::<NextDynamicEntryModule>(*module)\n                 {"
        },
        {
            "sha": "34b8b59ab5d131dbefe12e568ef0958fc682043f",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 13,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -27,7 +27,7 @@ use next_core::{\n };\n use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     Completion, FxIndexMap, NonLocalValue, ResolvedVc, TaskInput, Value, ValueToString, Vc,\n     fxindexmap, fxindexset, trace::TraceRawVcs,\n@@ -86,11 +86,6 @@ pub struct PagesProject {\n     project: ResolvedVc<Project>,\n }\n \n-#[turbo_tasks::function]\n-fn client_layer() -> Vc<RcStr> {\n-    Vc::cell(\"client\".into())\n-}\n-\n #[turbo_tasks::value_impl]\n impl PagesProject {\n     #[turbo_tasks::function]\n@@ -373,7 +368,7 @@ impl PagesProject {\n             self.project().client_compile_time_info(),\n             self.client_module_options_context(),\n             self.client_resolve_options_context(),\n-            client_layer(),\n+            rcstr!(\"client\"),\n         )\n     }\n \n@@ -384,7 +379,7 @@ impl PagesProject {\n             self.project().server_compile_time_info(),\n             self.ssr_module_options_context(),\n             self.ssr_resolve_options_context(),\n-            Vc::cell(\"ssr\".into()),\n+            rcstr!(\"ssr\"),\n         )\n     }\n \n@@ -397,7 +392,7 @@ impl PagesProject {\n             self.project().server_compile_time_info(),\n             self.api_module_options_context(),\n             self.ssr_resolve_options_context(),\n-            Vc::cell(\"api\".into()),\n+            rcstr!(\"api\"),\n         )\n     }\n \n@@ -408,7 +403,7 @@ impl PagesProject {\n             self.project().server_compile_time_info(),\n             self.ssr_data_module_options_context(),\n             self.ssr_resolve_options_context(),\n-            Vc::cell(\"ssr-data\".into()),\n+            rcstr!(\"ssr-data\"),\n         )\n     }\n \n@@ -419,7 +414,7 @@ impl PagesProject {\n             self.project().edge_compile_time_info(),\n             self.edge_ssr_module_options_context(),\n             self.edge_ssr_resolve_options_context(),\n-            Vc::cell(\"edge-ssr\".into()),\n+            rcstr!(\"edge-ssr\"),\n         )\n     }\n \n@@ -430,7 +425,7 @@ impl PagesProject {\n             self.project().edge_compile_time_info(),\n             self.edge_api_module_options_context(),\n             self.edge_ssr_resolve_options_context(),\n-            Vc::cell(\"edge-api\".into()),\n+            rcstr!(\"edge-api\"),\n         )\n     }\n \n@@ -441,7 +436,7 @@ impl PagesProject {\n             self.project().edge_compile_time_info(),\n             self.edge_ssr_data_module_options_context(),\n             self.edge_ssr_resolve_options_context(),\n-            Vc::cell(\"edge-ssr-data\".into()),\n+            rcstr!(\"edge-ssr-data\"),\n         )\n     }\n "
        },
        {
            "sha": "a5ff9d9371cc6d15da05d7d7fce2752ac534013c",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -22,7 +22,7 @@ use next_core::{\n };\n use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     Completion, Completions, FxIndexMap, IntoTraitRef, NonLocalValue, OperationValue, OperationVc,\n     ReadRef, ResolvedVc, State, TaskInput, TransientInstance, TryFlatJoinIterExt, Value, Vc,\n@@ -1308,7 +1308,7 @@ impl Project {\n                 self.next_config(),\n                 self.execution_context(),\n             ),\n-            Vc::cell(\"middleware-edge\".into()),\n+            rcstr!(\"middleware-edge\"),\n         )))\n     }\n \n@@ -1363,7 +1363,7 @@ impl Project {\n                 self.next_config(),\n                 self.execution_context(),\n             ),\n-            Vc::cell(\"middleware\".into()),\n+            rcstr!(\"middleware\"),\n         )))\n     }\n \n@@ -1475,7 +1475,7 @@ impl Project {\n                 self.next_config(),\n                 self.execution_context(),\n             ),\n-            Vc::cell(\"instrumentation\".into()),\n+            rcstr!(\"instrumentation\"),\n         )))\n     }\n \n@@ -1530,7 +1530,7 @@ impl Project {\n                 self.next_config(),\n                 self.execution_context(),\n             ),\n-            Vc::cell(\"instrumentation-edge\".into()),\n+            rcstr!(\"instrumentation-edge\"),\n         )))\n     }\n "
        },
        {
            "sha": "6bfdb7ff8cbef4272563cbe7572fe1afc3a39cde",
            "filename": "crates/next-api/src/server_actions.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 12,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fserver_actions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-api%2Fsrc%2Fserver_actions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fserver_actions.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -18,7 +18,7 @@ use swc_core::{\n         utils::find_pat_ids,\n     },\n };\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexMap, ResolvedVc, TryFlatJoinIterExt, Value, ValueToString, Vc};\n use turbo_tasks_fs::{self, File, FileSystemPath, rope::RopeBuilder};\n use turbopack_core::{\n@@ -92,11 +92,6 @@ pub(crate) async fn create_server_actions_manifest(\n     .cell())\n }\n \n-#[turbo_tasks::function]\n-fn server_actions_loader_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"server actions loader\".into())\n-}\n-\n /// Builds the \"action loader\" entry point, which reexports every found action\n /// behind a lazy dynamic import.\n ///\n@@ -132,7 +127,7 @@ pub(crate) async fn build_server_actions_loader(\n     let path = project_path.join(format!(\".next-internal/server/app{page_name}/actions.js\").into());\n     let file = File::from(contents.build());\n     let source = VirtualSource::new_with_ident(\n-        AssetIdent::from_path(path).with_modifier(server_actions_loader_modifier()),\n+        AssetIdent::from_path(path).with_modifier(rcstr!(\"server actions loader\")),\n         AssetContent::file(file.into()),\n     );\n     let import_map = import_map.into_iter().map(|(k, v)| (v, k)).collect();\n@@ -436,12 +431,8 @@ pub async fn map_server_actions(graph: Vc<SingleModuleGraph>) -> Result<Vc<AllMo\n         .map(|node| {\n             async move {\n                 let SingleModuleGraphModuleNode { module } = node;\n-                let layer = match module.ident().await?.layer {\n-                    Some(l) => Some(l.await?),\n-                    None => None,\n-                };\n                 // TODO: compare module contexts instead?\n-                let layer = match layer {\n+                let layer = match module.ident().await?.layer.as_ref() {\n                     Some(layer) if *layer == \"app-rsc\" || *layer == \"app-edge-rsc\" => {\n                         ActionLayer::Rsc\n                     }"
        },
        {
            "sha": "291d43c39c66102d3456ef41fb1bb66324aafcc0",
            "filename": "crates/next-core/src/hmr_entry.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fhmr_entry.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,7 +1,7 @@\n use std::io::Write;\n \n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::{glob::Glob, rope::RopeBuilder};\n use turbopack_core::{\n@@ -25,11 +25,6 @@ use turbopack_ecmascript::{\n     utils::StringifyJs,\n };\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"hmr-entry\".into())\n-}\n-\n #[turbo_tasks::value(shared)]\n pub struct HmrEntryModule {\n     pub ident: ResolvedVc<AssetIdent>,\n@@ -51,7 +46,7 @@ impl HmrEntryModule {\n impl Module for HmrEntryModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.ident.with_modifier(modifier())\n+        self.ident.with_modifier(rcstr!(\"hmr-entry\"))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "65c131d5ad5ffab80b6492ff8568246e95e6c6c8",
            "filename": "crates/next-core/src/next_app/app_client_references_chunks.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 16,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_references_chunks.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_references_chunks.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_references_chunks.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use tracing::Instrument;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{\n     FxIndexMap, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Value, ValueToString, Vc,\n };\n@@ -15,23 +15,13 @@ use crate::{\n     next_client_reference::{\n         ClientReferenceType,\n         ecmascript_client_reference::ecmascript_client_reference_module::{\n-            ECMASCRIPT_CLIENT_REFERENCE_MERGE_TAG_CLIENT, ECMASCRIPT_CLIENT_REFERENCE_MERGE_TAG_SSR,\n+            ecmascript_client_reference_merge_tag, ecmascript_client_reference_merge_tag_ssr,\n         },\n         visit_client_reference::ClientReferenceGraphResult,\n     },\n     next_server_component::server_component_module::NextServerComponentModule,\n };\n \n-#[turbo_tasks::function]\n-pub fn client_modules_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"client modules\".into())\n-}\n-\n-#[turbo_tasks::function]\n-pub fn ssr_modules_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"ssr modules\".into())\n-}\n-\n #[turbo_tasks::value]\n pub struct ClientReferencesChunks {\n     pub client_component_client_chunks:\n@@ -224,10 +214,10 @@ pub async fn get_app_client_references_chunks(\n                         .entered();\n \n                         ssr_chunking_context.chunk_group(\n-                            base_ident.with_modifier(ssr_modules_modifier()),\n+                            base_ident.with_modifier(rcstr!(\"ssr modules\")),\n                             ChunkGroup::IsolatedMerged {\n                                 parent: parent_chunk_group,\n-                                merge_tag: ECMASCRIPT_CLIENT_REFERENCE_MERGE_TAG_SSR.clone(),\n+                                merge_tag: ecmascript_client_reference_merge_tag_ssr(),\n                                 entries: ssr_modules,\n                             },\n                             module_graph,\n@@ -262,10 +252,10 @@ pub async fn get_app_client_references_chunks(\n                     .entered();\n \n                     Some(client_chunking_context.chunk_group(\n-                        base_ident.with_modifier(client_modules_modifier()),\n+                        base_ident.with_modifier(rcstr!(\"client modules\")),\n                         ChunkGroup::IsolatedMerged {\n                             parent: parent_chunk_group,\n-                            merge_tag: ECMASCRIPT_CLIENT_REFERENCE_MERGE_TAG_CLIENT.clone(),\n+                            merge_tag: ecmascript_client_reference_merge_tag(),\n                             entries: client_modules,\n                         },\n                         module_graph,"
        },
        {
            "sha": "e9dda423ea47c8c083cf72d23dd3e4d05c5b38b4",
            "filename": "crates/next-core/src/next_app/app_page_entry.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -109,9 +109,7 @@ pub async fn get_app_page_entry(\n \n     let file = File::from(result.build());\n     let source = VirtualSource::new_with_ident(\n-        source\n-            .ident()\n-            .with_query(Vc::cell(format!(\"?{query}\").into())),\n+        source.ident().with_query(RcStr::from(format!(\"?{query}\"))),\n         AssetContent::file(file.into()),\n     );\n "
        },
        {
            "sha": "24ec6cde17930da231c4a9b8ddbfcd7a27ff0a28",
            "filename": "crates/next-core/src/next_client_reference/css_client_reference/css_client_reference_module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fcss_client_reference%2Fcss_client_reference_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fcss_client_reference%2Fcss_client_reference_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fcss_client_reference%2Fcss_client_reference_module.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::{Result, bail};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbopack::css::chunk::CssChunkPlaceable;\n use turbopack_core::{\n@@ -31,18 +31,13 @@ impl CssClientReferenceModule {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn css_client_reference_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"css client reference\".into())\n-}\n-\n #[turbo_tasks::value_impl]\n impl Module for CssClientReferenceModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n         self.client_module\n             .ident()\n-            .with_modifier(css_client_reference_modifier())\n+            .with_modifier(rcstr!(\"css client reference\"))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "73201268f8e48e4c190268ff03a86523564fe6a1",
            "filename": "crates/next-core/src/next_client_reference/ecmascript_client_reference/ecmascript_client_reference_module.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 16,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -2,8 +2,7 @@ use std::{io::Write, iter::once};\n \n use anyhow::{Context, Result, bail};\n use indoc::writedoc;\n-use once_cell::sync::Lazy;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n use turbo_tasks_fs::File;\n use turbopack_core::{\n@@ -177,11 +176,6 @@ impl EcmascriptClientReferenceModule {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn client_reference_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"client reference proxy\".into())\n-}\n-\n #[turbo_tasks::function]\n fn ecmascript_client_reference_client_ref_modifier() -> Vc<RcStr> {\n     Vc::cell(\"ecmascript client reference to client\".into())\n@@ -192,17 +186,21 @@ fn ecmascript_client_reference_ssr_ref_modifier() -> Vc<RcStr> {\n     Vc::cell(\"ecmascript client reference to ssr\".into())\n }\n \n-pub static ECMASCRIPT_CLIENT_REFERENCE_MERGE_TAG_CLIENT: Lazy<RcStr> =\n-    Lazy::new(|| \"client\".into());\n-pub static ECMASCRIPT_CLIENT_REFERENCE_MERGE_TAG_SSR: Lazy<RcStr> = Lazy::new(|| \"ssr\".into());\n+pub fn ecmascript_client_reference_merge_tag() -> RcStr {\n+    rcstr!(\"client\")\n+}\n+pub fn ecmascript_client_reference_merge_tag_ssr() -> RcStr {\n+    rcstr!(\"ssr\")\n+}\n \n #[turbo_tasks::value_impl]\n impl Module for EcmascriptClientReferenceModule {\n     #[turbo_tasks::function]\n-    fn ident(&self) -> Vc<AssetIdent> {\n-        self.server_ident\n-            .with_modifier(client_reference_modifier())\n-            .with_layer(self.server_asset_context.layer())\n+    async fn ident(&self) -> Result<Vc<AssetIdent>> {\n+        Ok(self\n+            .server_ident\n+            .with_modifier(rcstr!(\"client reference proxy\"))\n+            .with_layer(self.server_asset_context.layer().owned().await?))\n     }\n \n     #[turbo_tasks::function]\n@@ -223,7 +221,7 @@ impl Module for EcmascriptClientReferenceModule {\n                 EcmascriptClientReference::new(\n                     *ResolvedVc::upcast(*client_module),\n                     ChunkGroupType::Evaluated,\n-                    Some(ECMASCRIPT_CLIENT_REFERENCE_MERGE_TAG_CLIENT.clone()),\n+                    Some(ecmascript_client_reference_merge_tag()),\n                     ecmascript_client_reference_client_ref_modifier(),\n                 )\n                 .to_resolved()\n@@ -233,7 +231,7 @@ impl Module for EcmascriptClientReferenceModule {\n                 EcmascriptClientReference::new(\n                     *ResolvedVc::upcast(*ssr_module),\n                     ChunkGroupType::Entry,\n-                    Some(ECMASCRIPT_CLIENT_REFERENCE_MERGE_TAG_SSR.clone()),\n+                    Some(ecmascript_client_reference_merge_tag_ssr()),\n                     ecmascript_client_reference_ssr_ref_modifier(),\n                 )\n                 .to_resolved()"
        },
        {
            "sha": "e4559687abf400d19fd4e575a0bdd08cabebdecb",
            "filename": "crates/next-core/src/next_client_reference/ecmascript_client_reference/ecmascript_client_reference_transition.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_transition.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_transition.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_transition.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,4 @@\n use anyhow::{Result, bail};\n-use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, Value, Vc};\n use turbopack::{ModuleAssetContext, transition::Transition};\n use turbopack_core::{\n@@ -35,11 +34,6 @@ impl NextEcmascriptClientReferenceTransition {\n \n #[turbo_tasks::value_impl]\n impl Transition for NextEcmascriptClientReferenceTransition {\n-    #[turbo_tasks::function]\n-    fn process_layer(self: Vc<Self>, layer: Vc<RcStr>) -> Vc<RcStr> {\n-        layer\n-    }\n-\n     #[turbo_tasks::function]\n     async fn process(\n         self: Vc<Self>,\n@@ -73,8 +67,8 @@ impl Transition for NextEcmascriptClientReferenceTransition {\n             );\n             Vc::upcast(FileSource::new_with_query_and_fragment(\n                 path,\n-                (*ident_ref.query.await?).clone(),\n-                (*ident_ref.fragment.await?).clone(),\n+                ident_ref.query.clone(),\n+                ident_ref.fragment.clone(),\n             ))\n         } else {\n             source\n@@ -122,7 +116,7 @@ impl Transition for NextEcmascriptClientReferenceTransition {\n             *module_asset_context.compile_time_info,\n             *module_asset_context.module_options_context,\n             *module_asset_context.resolve_options_context,\n-            *module_asset_context.layer,\n+            module_asset_context.layer.clone(),\n         );\n \n         Ok(ProcessResult::Module(ResolvedVc::upcast("
        },
        {
            "sha": "39f1faaa4fa4b4df5690912d7a1cd4d6d93c219e",
            "filename": "crates/next-core/src/next_dynamic/dynamic_module.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_module.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -2,7 +2,7 @@ use std::collections::BTreeMap;\n \n use anyhow::{Result, bail};\n use indoc::formatdoc;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -22,11 +22,6 @@ use turbopack_ecmascript::{\n     utils::StringifyJs,\n };\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"next/dynamic entry\".into())\n-}\n-\n /// A [`NextDynamicEntryModule`] is a marker asset used to indicate which\n /// dynamic assets should appear in the dynamic manifest.\n #[turbo_tasks::value(shared)]\n@@ -51,7 +46,9 @@ fn dynamic_ref_description() -> Vc<RcStr> {\n impl Module for NextDynamicEntryModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.module.ident().with_modifier(modifier())\n+        self.module\n+            .ident()\n+            .with_modifier(rcstr!(\"next/dynamic entry\"))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "25d0037e4524acb2606651b4e4678aa4e64ec4b4",
            "filename": "crates/next-core/src/next_dynamic/dynamic_transition.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_transition.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_transition.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_transition.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,4 @@\n use anyhow::{Result, bail};\n-use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, Value, Vc};\n use turbopack::{ModuleAssetContext, transition::Transition};\n use turbopack_core::{\n@@ -45,11 +44,6 @@ impl NextDynamicTransition {\n \n #[turbo_tasks::value_impl]\n impl Transition for NextDynamicTransition {\n-    #[turbo_tasks::function]\n-    fn process_layer(self: Vc<Self>, layer: Vc<RcStr>) -> Vc<RcStr> {\n-        layer\n-    }\n-\n     #[turbo_tasks::function]\n     async fn process(\n         self: Vc<Self>,"
        },
        {
            "sha": "0455bb23f9522a35316d018c88d32c9f109643bc",
            "filename": "crates/next-core/src/next_edge/unsupported.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Funsupported.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Funsupported.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Funsupported.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -71,7 +71,7 @@ fn unsupported_module_source(root_path: Vc<FileSystemPath>, module: RcStr) -> Vc\n     let content = AssetContent::file(File::from(code).into());\n     VirtualSource::new_with_ident(\n         AssetIdent::from_path(root_path)\n-            .with_modifier(Vc::cell(format!(\"unsupported edge import {module}\").into())),\n+            .with_modifier(format!(\"unsupported edge import {module}\").into()),\n         content,\n     )\n }"
        },
        {
            "sha": "f3c11c28052f6afd5b40cfa1a7a560f766b672ad",
            "filename": "crates/next-core/src/next_font/google/mod.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 20,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -86,13 +86,11 @@ impl NextFontGoogleReplacer {\n \n     #[turbo_tasks::function]\n     async fn import_map_result(&self, query: RcStr) -> Result<Vc<ImportMapResult>> {\n-        let request_hash = get_request_hash(&query).await?;\n+        let request_hash = get_request_hash(&query);\n         let qstr = qstring::QString::from(query.as_str());\n \n-        let query_vc = Vc::cell(query);\n-\n         let font_data = load_font_data(*self.project_path);\n-        let options = font_options_from_query_map(query_vc, font_data);\n+        let options = font_options_from_query_map(query, font_data);\n \n         let fallback = get_font_fallback(*self.project_path, options);\n         let properties = get_font_css_properties(options, fallback).await?;\n@@ -169,8 +167,8 @@ impl ImportMappingReplacement for NextFontGoogleReplacer {\n         };\n \n         let this = &*self.await?;\n-        if can_use_next_font(*this.project_path, **query).await? {\n-            Ok(self.import_map_result(query.await?.as_str().into()))\n+        if can_use_next_font(*this.project_path, query).await? {\n+            Ok(self.import_map_result(query.clone()))\n         } else {\n             Ok(ImportMapResult::NoEntry.into())\n         }\n@@ -198,10 +196,9 @@ impl NextFontGoogleCssModuleReplacer {\n \n     #[turbo_tasks::function]\n     async fn import_map_result(&self, query: RcStr) -> Result<Vc<ImportMapResult>> {\n-        let request_hash = get_request_hash(&query).await?;\n-        let query_vc = Vc::cell(query);\n+        let request_hash = get_request_hash(&query);\n         let font_data = load_font_data(*self.project_path);\n-        let options = font_options_from_query_map(query_vc, font_data);\n+        let options = font_options_from_query_map(query, font_data);\n         let stylesheet_url = get_stylesheet_url_from_options(options, font_data);\n         let scoped_font_family =\n             get_scoped_font_family(FontFamilyType::WebFont.cell(), options.font_family());\n@@ -291,14 +288,14 @@ impl ImportMappingReplacement for NextFontGoogleCssModuleReplacer {\n         let Request::Module {\n             module: _,\n             path: _,\n-            query: query_vc,\n+            query,\n             fragment: _,\n         } = request\n         else {\n             return Ok(ImportMapResult::NoEntry.cell());\n         };\n \n-        Ok(self.import_map_result(query_vc.owned().await?))\n+        Ok(self.import_map_result(query.clone()))\n     }\n }\n \n@@ -342,7 +339,7 @@ impl ImportMappingReplacement for NextFontGoogleFontFileReplacer {\n         let Request::Module {\n             module: _,\n             path: _,\n-            query: query_vc,\n+            query,\n             fragment: _,\n         } = request\n         else {\n@@ -353,7 +350,7 @@ impl ImportMappingReplacement for NextFontGoogleFontFileReplacer {\n             url,\n             preload,\n             has_size_adjust: size_adjust,\n-        } = font_file_options_from_query_map(**query_vc).await?;\n+        } = font_file_options_from_query_map(query)?;\n \n         let (filename, ext) = split_extension(&url);\n         let ext = ext.with_context(|| format!(\"font url {} is missing an extension\", &url))?;\n@@ -562,10 +559,10 @@ async fn get_font_css_properties(\n \n #[turbo_tasks::function]\n async fn font_options_from_query_map(\n-    query: Vc<RcStr>,\n+    query: RcStr,\n     font_data: Vc<FontData>,\n ) -> Result<Vc<NextFontGoogleOptions>> {\n-    let query_map = qstring::QString::from(&**query.await?);\n+    let query_map = qstring::QString::from(query.as_str());\n \n     if query_map.len() != 1 {\n         bail!(\"next/font/google queries must have exactly one entry\");\n@@ -579,11 +576,8 @@ async fn font_options_from_query_map(\n         options_from_request(&parse_json_with_source_context(&json)?, &*font_data.await?)?;\n     Ok(NextFontGoogleOptions::new(Value::new(options)))\n }\n-\n-async fn font_file_options_from_query_map(\n-    query: Vc<RcStr>,\n-) -> Result<NextFontGoogleFontFileOptions> {\n-    let query_map = qstring::QString::from(&**query.await?);\n+fn font_file_options_from_query_map(query: &RcStr) -> Result<NextFontGoogleFontFileOptions> {\n+    let query_map = qstring::QString::from(query.as_str());\n \n     if query_map.len() != 1 {\n         bail!(\"next/font/google queries have exactly one entry\");"
        },
        {
            "sha": "33de435e8b7442e5d15b63dd2b012f46e4f00944",
            "filename": "crates/next-core/src/next_font/local/mod.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 16,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -90,7 +90,7 @@ impl BeforeResolvePlugin for NextFontLocalResolvePlugin {\n         let Request::Module {\n             module: _,\n             path: _,\n-            query: query_vc,\n+            query,\n             fragment: _,\n         } = request\n         else {\n@@ -99,14 +99,13 @@ impl BeforeResolvePlugin for NextFontLocalResolvePlugin {\n \n         match request_key.as_str() {\n             \"next/font/local/target.css\" => {\n-                if !can_use_next_font(*this.root, **query_vc).await? {\n+                if !can_use_next_font(*this.root, query).await? {\n                     return Ok(ResolveResultOption::none());\n                 }\n \n-                let query = query_vc.await?.to_string();\n-                let request_hash = get_request_hash(&query).await?;\n+                let request_hash = get_request_hash(query.as_str());\n                 let qstr = qstring::QString::from(query.as_str());\n-                let options_vc = font_options_from_query_map(**query_vc);\n+                let options_vc = font_options_from_query_map(query.clone());\n \n                 let font_fallbacks = &*get_font_fallbacks(lookup_path, options_vc).await?;\n                 let lookup_path = lookup_path.to_resolved().await?;\n@@ -178,9 +177,8 @@ impl BeforeResolvePlugin for NextFontLocalResolvePlugin {\n                 )))\n             }\n             \"@vercel/turbopack-next/internal/font/local/cssmodule.module.css\" => {\n-                let query = query_vc.await?.to_string();\n-                let request_hash = get_request_hash(&query).await?;\n-                let options = font_options_from_query_map(**query_vc);\n+                let request_hash = get_request_hash(query);\n+                let options = font_options_from_query_map(query.clone());\n                 let css_virtual_path = lookup_path.join(\n                     format!(\n                         \"/{}.module.css\",\n@@ -206,7 +204,7 @@ impl BeforeResolvePlugin for NextFontLocalResolvePlugin {\n                 };\n \n                 let stylesheet = build_stylesheet(\n-                    font_options_from_query_map(**query_vc),\n+                    font_options_from_query_map(query.clone()),\n                     fallback,\n                     get_font_css_properties(options, fallback),\n                 )\n@@ -228,7 +226,7 @@ impl BeforeResolvePlugin for NextFontLocalResolvePlugin {\n                     path,\n                     preload,\n                     has_size_adjust: size_adjust,\n-                } = font_file_options_from_query_map(**query_vc).await?;\n+                } = font_file_options_from_query_map(query).await?;\n \n                 let (filename, ext) = split_extension(&path);\n                 let ext = ext.with_context(|| format!(\"font {} needs an extension\", &path))?;\n@@ -294,8 +292,8 @@ async fn get_font_css_properties(\n }\n \n #[turbo_tasks::function]\n-async fn font_options_from_query_map(query: Vc<RcStr>) -> Result<Vc<NextFontLocalOptions>> {\n-    let query_map = qstring::QString::from(&**query.await?);\n+fn font_options_from_query_map(query: RcStr) -> Result<Vc<NextFontLocalOptions>> {\n+    let query_map = qstring::QString::from(query.as_str());\n \n     if query_map.len() != 1 {\n         bail!(\"next/font/local queries have exactly one entry\");\n@@ -309,10 +307,8 @@ async fn font_options_from_query_map(query: Vc<RcStr>) -> Result<Vc<NextFontLoca\n         .map(|o| NextFontLocalOptions::new(Value::new(o)))\n }\n \n-async fn font_file_options_from_query_map(\n-    query: Vc<RcStr>,\n-) -> Result<NextFontLocalFontFileOptions> {\n-    let query_map = qstring::QString::from(&**query.await?);\n+async fn font_file_options_from_query_map(query: &RcStr) -> Result<NextFontLocalFontFileOptions> {\n+    let query_map = qstring::QString::from(query.as_str());\n \n     if query_map.len() != 1 {\n         bail!(\"next/font/local queries have exactly one entry\");"
        },
        {
            "sha": "836140e3c0647dbbbc28583bb199df48b1a8a582",
            "filename": "crates/next-core/src/next_font/util.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 9,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_font%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Futil.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -22,19 +22,17 @@ pub(crate) struct FontCssProperties {\n /// A hash of the requested querymap derived from how the user invoked\n /// next/font. Used to uniquely identify font requests for generated filenames\n /// and scoped font family names.\n-pub(crate) async fn get_request_hash(query: &str) -> Result<u32> {\n+pub(crate) fn get_request_hash(query: &str) -> u32 {\n     let query = qstring::QString::from(query);\n-    let mut to_hash = vec![];\n+    let mut to_hash = Vec::with_capacity(query.len() * 2);\n     for (k, v) in query {\n         to_hash.push(k);\n         to_hash.push(v);\n     }\n \n-    Ok(\n-        // Truncate the hash to u32. These hashes are ultimately displayed as 6- or 8-character\n-        // hexadecimal values.\n-        hash_xxh3_hash64(to_hash) as u32,\n-    )\n+    // Truncate the hash to u32. These hashes are ultimately displayed as 6- or 8-character\n+    // hexadecimal values.\n+    hash_xxh3_hash64(to_hash) as u32\n }\n \n #[turbo_tasks::value(shared)]\n@@ -82,9 +80,9 @@ struct HasPath {\n \n pub(crate) async fn can_use_next_font(\n     project_path: Vc<FileSystemPath>,\n-    query: Vc<RcStr>,\n+    query: &RcStr,\n ) -> Result<bool> {\n-    let query_map = qstring::QString::from(&**query.await?);\n+    let query_map = qstring::QString::from(query.as_str());\n     let request: HasPath = parse_json_with_source_context(\n         query_map\n             .to_pairs()"
        },
        {
            "sha": "5cd774d06f83ae1c0bf3efb517404e9cad338499",
            "filename": "crates/next-core/src/next_image/source_asset.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fsource_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fsource_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fsource_asset.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,7 +1,7 @@\n use std::io::Write;\n \n use anyhow::{Result, bail};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{FileContent, rope::RopeBuilder};\n use turbopack_core::{\n@@ -14,10 +14,6 @@ use turbopack_image::process::{BlurPlaceholderOptions, get_meta_data};\n \n use super::module::BlurPlaceholderMode;\n \n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"structured image object\".into())\n-}\n-\n #[turbo_tasks::function]\n fn blur_options() -> Vc<BlurPlaceholderOptions> {\n     BlurPlaceholderOptions {\n@@ -41,7 +37,7 @@ impl Source for StructuredImageFileSource {\n     fn ident(&self) -> Vc<AssetIdent> {\n         self.image\n             .ident()\n-            .with_modifier(modifier())\n+            .with_modifier(rcstr!(\"structured image object\"))\n             .rename_as(\"*.mjs\".into())\n     }\n }"
        },
        {
            "sha": "c6df49ff0f1f5a9f9fd2696bb5e95fe978afbf14",
            "filename": "crates/next-core/src/next_server_component/server_component_module.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_module.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -2,7 +2,7 @@ use std::collections::BTreeMap;\n \n use anyhow::{Result, bail};\n use indoc::formatdoc;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -25,11 +25,6 @@ use turbopack_ecmascript::{\n \n use super::server_component_reference::NextServerComponentModuleReference;\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"Next.js Server Component\".into())\n-}\n-\n #[turbo_tasks::value(shared)]\n pub struct NextServerComponentModule {\n     pub module: ResolvedVc<Box<dyn EcmascriptChunkPlaceable>>,\n@@ -52,7 +47,9 @@ impl NextServerComponentModule {\n impl Module for NextServerComponentModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.module.ident().with_modifier(modifier())\n+        self.module\n+            .ident()\n+            .with_modifier(rcstr!(\"Next.js Server Component\"))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "adc9c37a1b9dcc7516e9cf910e6f6c2dd533819a",
            "filename": "crates/next-core/src/next_server_component/server_component_transition.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_transition.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_transition.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server_component%2Fserver_component_transition.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,4 @@\n use anyhow::{Result, bail};\n-use turbo_rcstr::RcStr;\n use turbo_tasks::Vc;\n use turbopack::{ModuleAssetContext, transition::Transition};\n use turbopack_core::module::Module;\n@@ -27,11 +26,6 @@ impl NextServerComponentTransition {\n \n #[turbo_tasks::value_impl]\n impl Transition for NextServerComponentTransition {\n-    #[turbo_tasks::function]\n-    fn process_layer(self: Vc<Self>, layer: Vc<RcStr>) -> Vc<RcStr> {\n-        layer\n-    }\n-\n     #[turbo_tasks::function]\n     async fn process_module(\n         self: Vc<Self>,"
        },
        {
            "sha": "7835ba49430ec08c74c9bd3c3d2a57cfa29022ce",
            "filename": "crates/next-core/src/next_server_utility/server_utility_module.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_module.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -2,7 +2,7 @@ use std::collections::BTreeMap;\n \n use anyhow::{Result, bail};\n use indoc::formatdoc;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -25,11 +25,6 @@ use turbopack_ecmascript::{\n \n use super::server_utility_reference::NextServerUtilityModuleReference;\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"Next.js server utility\".into())\n-}\n-\n #[turbo_tasks::value(shared)]\n pub struct NextServerUtilityModule {\n     pub module: ResolvedVc<Box<dyn EcmascriptChunkPlaceable>>,\n@@ -52,7 +47,9 @@ impl NextServerUtilityModule {\n impl Module for NextServerUtilityModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.module.ident().with_modifier(modifier())\n+        self.module\n+            .ident()\n+            .with_modifier(rcstr!(\"Next.js server utility\"))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "949eed411454d5d7bc1f4c7347faf901966edd89",
            "filename": "crates/next-core/src/next_server_utility/server_utility_transition.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_transition.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_transition.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server_utility%2Fserver_utility_transition.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,4 @@\n use anyhow::{Result, bail};\n-use turbo_rcstr::RcStr;\n use turbo_tasks::Vc;\n use turbopack::{ModuleAssetContext, transition::Transition};\n use turbopack_core::module::Module;\n@@ -27,11 +26,6 @@ impl NextServerUtilityTransition {\n \n #[turbo_tasks::value_impl]\n impl Transition for NextServerUtilityTransition {\n-    #[turbo_tasks::function]\n-    fn process_layer(self: Vc<Self>, layer: Vc<RcStr>) -> Vc<RcStr> {\n-        layer\n-    }\n-\n     #[turbo_tasks::function]\n     async fn process_module(\n         self: Vc<Self>,"
        },
        {
            "sha": "84f451e4dd67701a0466a65cdaadce7cbc5ad3d3",
            "filename": "turbopack/crates/turbopack-browser/src/chunking_context.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::{Context, Result, bail};\n use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     NonLocalValue, ResolvedVc, TaskInput, TryJoinIterExt, Upcast, Value, ValueToString, Vc,\n     trace::TraceRawVcs,\n@@ -403,6 +403,10 @@ impl ChunkingContext for BrowserChunkingContext {\n         ident: Vc<AssetIdent>,\n         extension: RcStr,\n     ) -> Result<Vc<FileSystemPath>> {\n+        debug_assert!(\n+            extension.starts_with(\".\"),\n+            \"`extension` should include the leading '.', got '{extension}'\"\n+        );\n         let root_path = self.chunk_root_path;\n         let name = match self.content_hashing {\n             None => {\n@@ -550,12 +554,11 @@ impl ChunkingContext for BrowserChunkingContext {\n                 match input_availability_info {\n                     AvailabilityInfo::Root => {}\n                     AvailabilityInfo::Untracked => {\n-                        ident = ident.with_modifier(Vc::cell(\"untracked\".into()));\n+                        ident = ident.with_modifier(rcstr!(\"untracked\"));\n                     }\n                     AvailabilityInfo::Complete { available_modules } => {\n-                        ident = ident.with_modifier(Vc::cell(\n-                            available_modules.hash().await?.to_string().into(),\n-                        ));\n+                        ident =\n+                            ident.with_modifier(available_modules.hash().await?.to_string().into());\n                     }\n                 }\n                 assets.push("
        },
        {
            "sha": "234d00bc839098bdbf9eea10572021bde0000758",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/chunk.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fchunk.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexSet, ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -50,7 +50,9 @@ impl EcmascriptBrowserChunk {\n \n impl EcmascriptBrowserChunk {\n     fn ident_for_path(&self) -> Vc<AssetIdent> {\n-        self.chunk.ident().with_modifier(modifier())\n+        self.chunk\n+            .ident()\n+            .with_modifier(rcstr!(\"ecmascript dev chunk\"))\n     }\n }\n \n@@ -74,11 +76,6 @@ impl OutputChunk for EcmascriptBrowserChunk {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"ecmascript dev chunk\".into())\n-}\n-\n #[turbo_tasks::value_impl]\n impl EcmascriptBrowserChunk {\n     #[turbo_tasks::function]"
        },
        {
            "sha": "241bac72b2a393fe87fe9ff0e7dffae83c83768a",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/evaluate/chunk.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Fevaluate%2Fchunk.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -4,7 +4,7 @@ use anyhow::{Result, bail};\n use either::Either;\n use indoc::writedoc;\n use serde::Serialize;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ReadRef, ResolvedVc, TryJoinIterExt, Value, ValueToString, Vc};\n use turbo_tasks_fs::{File, FileSystemPath, rope::RopeBuilder};\n use turbopack_core::{\n@@ -204,13 +204,13 @@ impl EcmascriptBrowserEvaluateChunk {\n     async fn ident_for_path(&self) -> Result<Vc<AssetIdent>> {\n         let mut ident = self.ident.owned().await?;\n \n-        ident.add_modifier(modifier().to_resolved().await?);\n+        ident.add_modifier(rcstr!(\"ecmascript browser evaluate chunk\"));\n \n         let evaluatable_assets = self.evaluatable_assets.await?;\n         ident.modifiers.extend(\n             evaluatable_assets\n                 .iter()\n-                .map(|entry| entry.ident().to_string().to_resolved())\n+                .map(|entry| async move { Ok((*entry.ident().to_string().await?).clone()) })\n                 .try_join()\n                 .await?,\n         );\n@@ -219,7 +219,7 @@ impl EcmascriptBrowserEvaluateChunk {\n             self.other_chunks\n                 .await?\n                 .iter()\n-                .map(|chunk| chunk.path().to_string().to_resolved())\n+                .map(|chunk| async move { Ok((*chunk.path().to_string().await?).clone()) })\n                 .try_join()\n                 .await?,\n         );\n@@ -246,11 +246,6 @@ impl ValueToString for EcmascriptBrowserEvaluateChunk {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"ecmascript browser evaluate chunk\".into())\n-}\n-\n #[turbo_tasks::value_impl]\n impl OutputAsset for EcmascriptBrowserEvaluateChunk {\n     #[turbo_tasks::function]"
        },
        {
            "sha": "50f09ad31c373f507ad4167a710692ce66628b57",
            "filename": "turbopack/crates/turbopack-browser/src/ecmascript/list/asset.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 23,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fecmascript%2Flist%2Fasset.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -68,38 +68,18 @@ impl ValueToString for EcmascriptDevChunkList {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"ecmascript dev chunk list\".into())\n-}\n-\n-#[turbo_tasks::function]\n-fn dynamic_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"dynamic\".into())\n-}\n-\n-#[turbo_tasks::function]\n-fn chunk_list_chunk_reference_description() -> Vc<RcStr> {\n-    Vc::cell(\"chunk list chunk\".into())\n-}\n-\n-#[turbo_tasks::function]\n-fn chunk_key() -> Vc<RcStr> {\n-    Vc::cell(\"chunk\".into())\n-}\n-\n #[turbo_tasks::value_impl]\n impl OutputAsset for EcmascriptDevChunkList {\n     #[turbo_tasks::function]\n     async fn path(self: Vc<Self>) -> Result<Vc<FileSystemPath>> {\n         let this = self.await?;\n         let mut ident = this.ident.owned().await?;\n-        ident.add_modifier(modifier().to_resolved().await?);\n+        ident.add_modifier(rcstr!(\"ecmascript dev chunk list\"));\n \n         match this.source {\n             EcmascriptDevChunkListSource::Entry => {}\n             EcmascriptDevChunkListSource::Dynamic => {\n-                ident.add_modifier(dynamic_modifier().to_resolved().await?);\n+                ident.add_modifier(rcstr!(\"dynamic\"));\n             }\n         }\n "
        },
        {
            "sha": "e2c2c7f1ee509da2dfcff00aefc8e0c5183f5708",
            "filename": "turbopack/crates/turbopack-cli/src/contexts.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fcontexts.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fcontexts.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fcontexts.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,7 +1,7 @@\n use std::fmt;\n \n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, Value, Vc};\n use turbo_tasks_fs::{FileSystem, FileSystemPath};\n use turbopack::{\n@@ -192,7 +192,7 @@ pub fn get_client_asset_context(\n         compile_time_info,\n         module_options_context,\n         resolve_options_context,\n-        Vc::cell(\"client\".into()),\n+        rcstr!(\"client\"),\n     ));\n \n     asset_context"
        },
        {
            "sha": "778ad24451c5d685f9d852fbaa2ac9eabd04ff33",
            "filename": "turbopack/crates/turbopack-core/src/file_source.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Ffile_source.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Ffile_source.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Ffile_source.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -49,10 +49,10 @@ impl Source for FileSource {\n     fn ident(&self) -> Vc<AssetIdent> {\n         let mut ident = AssetIdent::from_path(*self.path);\n         if !self.query.is_empty() {\n-            ident = ident.with_query(Vc::cell(self.query.clone()));\n+            ident = ident.with_query(self.query.clone());\n         }\n         if !self.fragment.is_empty() {\n-            ident = ident.with_fragment(Vc::cell(self.fragment.clone()));\n+            ident = ident.with_fragment(self.fragment.clone());\n         }\n         ident\n     }"
        },
        {
            "sha": "1a9b2e5cc9f3c46519ad0672b557462da4f73179",
            "filename": "turbopack/crates/turbopack-core/src/ident.rs",
            "status": "modified",
            "additions": 28,
            "deletions": 36,
            "changes": 64,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fident.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fident.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fident.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -17,28 +17,28 @@ pub struct AssetIdent {\n     pub path: ResolvedVc<FileSystemPath>,\n     /// The query string of the asset this is either the empty string or a query string that starts\n     /// with a `?` (e.g. `?foo=bar`)\n-    pub query: ResolvedVc<RcStr>,\n+    pub query: RcStr,\n     /// The fragment of the asset, this is either the empty string or a fragment string that starts\n     /// with a `#` (e.g. `#foo`)\n-    pub fragment: ResolvedVc<RcStr>,\n+    pub fragment: RcStr,\n     /// The assets that are nested in this asset\n-    pub assets: Vec<(ResolvedVc<RcStr>, ResolvedVc<AssetIdent>)>,\n+    pub assets: Vec<(RcStr, ResolvedVc<AssetIdent>)>,\n     /// The modifiers of this asset (e.g. `client chunks`)\n-    pub modifiers: Vec<ResolvedVc<RcStr>>,\n+    pub modifiers: Vec<RcStr>,\n     /// The parts of the asset that are (ECMAScript) modules\n     pub parts: Vec<ModulePart>,\n     /// The asset layer the asset was created from.\n-    pub layer: Option<ResolvedVc<RcStr>>,\n+    pub layer: Option<RcStr>,\n     /// The MIME content type, if this asset was created from a data URL.\n     pub content_type: Option<RcStr>,\n }\n \n impl AssetIdent {\n-    pub fn add_modifier(&mut self, modifier: ResolvedVc<RcStr>) {\n+    pub fn add_modifier(&mut self, modifier: RcStr) {\n         self.modifiers.push(modifier);\n     }\n \n-    pub fn add_asset(&mut self, key: ResolvedVc<RcStr>, asset: ResolvedVc<AssetIdent>) {\n+    pub fn add_asset(&mut self, key: RcStr, asset: ResolvedVc<AssetIdent>) {\n         self.assets.push((key, asset));\n     }\n \n@@ -60,9 +60,9 @@ impl ValueToString for AssetIdent {\n         let mut s = self.path.to_string().owned().await?.into_owned();\n \n         // The query string is either empty or non-empty starting with `?` so we can just concat\n-        s.push_str(&self.query.await?);\n+        s.push_str(&self.query);\n         // ditto for fragment\n-        s.push_str(&self.fragment.await?);\n+        s.push_str(&self.fragment);\n \n         if !self.assets.is_empty() {\n             s.push_str(\" {\");\n@@ -72,16 +72,15 @@ impl ValueToString for AssetIdent {\n                     s.push(',');\n                 }\n \n-                let key_str = key.await?;\n                 let asset_str = asset.to_string().await?;\n-                write!(s, \" {key_str} => {asset_str:?}\")?;\n+                write!(s, \" {key} => {asset_str:?}\")?;\n             }\n \n             s.push_str(\" }\");\n         }\n \n         if let Some(layer) = &self.layer {\n-            write!(s, \" [{}]\", layer.await?)?;\n+            write!(s, \" [{layer}]\")?;\n         }\n \n         if !self.modifiers.is_empty() {\n@@ -92,7 +91,7 @@ impl ValueToString for AssetIdent {\n                     s.push_str(\", \");\n                 }\n \n-                s.push_str(&modifier.await?);\n+                s.push_str(modifier);\n             }\n \n             s.push(')');\n@@ -120,15 +119,12 @@ impl ValueToString for AssetIdent {\n impl AssetIdent {\n     #[turbo_tasks::function]\n     pub async fn new(ident: Value<AssetIdent>) -> Result<Vc<Self>> {\n-        let query = &*ident.query.await?;\n-        // TODO(lukesandberg); downgrade to debug_assert\n-        assert!(\n-            query.is_empty() || query.starts_with(\"?\"),\n+        debug_assert!(\n+            ident.query.is_empty() || ident.query.starts_with(\"?\"),\n             \"query should be empty or start with a `?`\"\n         );\n-        let fragment = &*ident.fragment.await?;\n-        assert!(\n-            fragment.is_empty() || fragment.starts_with(\"#\"),\n+        debug_assert!(\n+            ident.fragment.is_empty() || ident.fragment.starts_with(\"#\"),\n             \"query should be empty or start with a `?`\"\n         );\n         Ok(ident.into_value().cell())\n@@ -139,8 +135,8 @@ impl AssetIdent {\n     pub fn from_path(path: ResolvedVc<FileSystemPath>) -> Vc<Self> {\n         Self::new(Value::new(AssetIdent {\n             path,\n-            query: ResolvedVc::cell(RcStr::default()),\n-            fragment: ResolvedVc::cell(RcStr::default()),\n+            query: RcStr::default(),\n+            fragment: RcStr::default(),\n             assets: Vec::new(),\n             modifiers: Vec::new(),\n             parts: Vec::new(),\n@@ -150,21 +146,21 @@ impl AssetIdent {\n     }\n \n     #[turbo_tasks::function]\n-    pub fn with_query(&self, query: ResolvedVc<RcStr>) -> Vc<Self> {\n+    pub fn with_query(&self, query: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n         this.query = query;\n         Self::new(Value::new(this))\n     }\n \n     #[turbo_tasks::function]\n-    pub fn with_fragment(&self, fragment: ResolvedVc<RcStr>) -> Vc<Self> {\n+    pub fn with_fragment(&self, fragment: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n         this.fragment = fragment;\n         Self::new(Value::new(this))\n     }\n \n     #[turbo_tasks::function]\n-    pub fn with_modifier(&self, modifier: ResolvedVc<RcStr>) -> Vc<Self> {\n+    pub fn with_modifier(&self, modifier: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n         this.add_modifier(modifier);\n         Self::new(Value::new(this))\n@@ -185,7 +181,7 @@ impl AssetIdent {\n     }\n \n     #[turbo_tasks::function]\n-    pub fn with_layer(&self, layer: ResolvedVc<RcStr>) -> Vc<Self> {\n+    pub fn with_layer(&self, layer: RcStr) -> Vc<Self> {\n         let mut this = self.clone();\n         this.layer = Some(layer);\n         Self::new(Value::new(this))\n@@ -210,11 +206,6 @@ impl AssetIdent {\n         *self.path\n     }\n \n-    #[turbo_tasks::function]\n-    pub fn query(&self) -> Vc<RcStr> {\n-        *self.query\n-    }\n-\n     /// Computes a unique output asset name for the given asset identifier.\n     /// TODO(alexkirsz) This is `turbopack-browser` specific, as\n     /// `turbopack-nodejs` would use a content hash instead. But for now\n@@ -225,6 +216,10 @@ impl AssetIdent {\n         context_path: Vc<FileSystemPath>,\n         expected_extension: RcStr,\n     ) -> Result<Vc<RcStr>> {\n+        debug_assert!(\n+            expected_extension.starts_with(\".\"),\n+            \"the extension should include the leading '.', got '{expected_extension}'\"\n+        );\n         // TODO(PACK-2140): restrict character set to AZaz09-_.~'()\n         // to be compatible with all operating systems + URLs.\n \n@@ -262,26 +257,23 @@ impl AssetIdent {\n             layer,\n             content_type,\n         } = self;\n-        let query = query.await?;\n         if !query.is_empty() {\n             0_u8.deterministic_hash(&mut hasher);\n             query.deterministic_hash(&mut hasher);\n             has_hash = true;\n         }\n-        let fragment = fragment.await?;\n         if !fragment.is_empty() {\n             1_u8.deterministic_hash(&mut hasher);\n             fragment.deterministic_hash(&mut hasher);\n             has_hash = true;\n         }\n         for (key, ident) in assets.iter() {\n             2_u8.deterministic_hash(&mut hasher);\n-            key.await?.deterministic_hash(&mut hasher);\n+            key.deterministic_hash(&mut hasher);\n             ident.to_string().await?.deterministic_hash(&mut hasher);\n             has_hash = true;\n         }\n         for modifier in modifiers.iter() {\n-            let modifier = modifier.await?;\n             if let Some(default_modifier) = default_modifier {\n                 if *modifier == default_modifier {\n                     continue;\n@@ -332,7 +324,7 @@ impl AssetIdent {\n         }\n         if let Some(layer) = layer {\n             5_u8.deterministic_hash(&mut hasher);\n-            layer.await?.deterministic_hash(&mut hasher);\n+            layer.deterministic_hash(&mut hasher);\n             has_hash = true;\n         }\n         if let Some(content_type) = content_type {"
        },
        {
            "sha": "04b8d192352e9947a8b4a0d967e34b2077d41c8c",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -320,7 +320,7 @@ impl SingleModuleGraph {\n             for &module in modules.keys() {\n                 let ident = module.ident().to_string().await?;\n                 if !set.insert(ident.clone()) {\n-                    duplicates.push(ident);\n+                    duplicates.push(ident)\n                 }\n             }\n             if !duplicates.is_empty() {"
        },
        {
            "sha": "217f9e4eb484a0034a19e686c3afac772e53135c",
            "filename": "turbopack/crates/turbopack-core/src/resolve/mod.rs",
            "status": "modified",
            "additions": 60,
            "deletions": 65,
            "changes": 125,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1796,7 +1796,7 @@ async fn resolve_internal_inline(\n                         lookup_path,\n                         *request,\n                         options,\n-                        request.query(),\n+                        request.query().owned().await?,\n                     )\n                     .await?;\n                     // We might have matched an alias in the import map, but there is no guarantee\n@@ -1851,8 +1851,8 @@ async fn resolve_internal_inline(\n                                     request,\n                                     options_value,\n                                     options,\n-                                    **query,\n-                                    **fragment,\n+                                    query.clone(),\n+                                    fragment.clone(),\n                                 )\n                                 .await?,\n                             );\n@@ -1874,16 +1874,16 @@ async fn resolve_internal_inline(\n                 force_in_lookup_dir,\n                 fragment,\n             } => {\n-                if !fragment.await?.is_empty() {\n+                if !fragment.is_empty() {\n                     if let Ok(result) = resolve_relative_request(\n                         lookup_path,\n                         request,\n                         options,\n                         options_value,\n                         path,\n-                        **query,\n+                        query.clone(),\n                         *force_in_lookup_dir,\n-                        **fragment,\n+                        fragment.clone(),\n                     )\n                     .await\n                     {\n@@ -1897,9 +1897,9 @@ async fn resolve_internal_inline(\n                     options,\n                     options_value,\n                     path,\n-                    **query,\n+                    query.clone(),\n                     *force_in_lookup_dir,\n-                    Vc::cell(RcStr::default()),\n+                    RcStr::default(),\n                 )\n                 .await?\n             }\n@@ -1916,8 +1916,8 @@ async fn resolve_internal_inline(\n                     options_value,\n                     module,\n                     path,\n-                    **query,\n-                    **fragment,\n+                    query.clone(),\n+                    fragment.clone(),\n                 )\n                 .await?\n             }\n@@ -1928,7 +1928,8 @@ async fn resolve_internal_inline(\n             } => {\n                 let mut new_pat = path.clone();\n                 new_pat.push_front(RcStr::from(\".\").into());\n-                let relative = Request::relative(Value::new(new_pat), **query, **fragment, true);\n+                let relative =\n+                    Request::relative(Value::new(new_pat), query.clone(), fragment.clone(), true);\n \n                 if !has_alias {\n                     ResolvingIssue {\n@@ -2078,7 +2079,7 @@ async fn resolve_internal_inline(\n                     lookup_path,\n                     request,\n                     options,\n-                    request.query(),\n+                    request.query().owned().await?,\n                 )\n                 .await?;\n                 if let Some(result) = resolved_result {\n@@ -2175,9 +2176,9 @@ async fn resolve_relative_request(\n     options: Vc<ResolveOptions>,\n     options_value: &ResolveOptions,\n     path_pattern: &Pattern,\n-    query: Vc<RcStr>,\n+    query: RcStr,\n     force_in_lookup_dir: bool,\n-    fragment: Vc<RcStr>,\n+    fragment: RcStr,\n ) -> Result<Vc<ResolveResult>> {\n     // Check alias field for aliases first\n     let lookup_path_ref = &*lookup_path.await?;\n@@ -2191,8 +2192,8 @@ async fn resolve_relative_request(\n             let request = normalize_request(&format!(\"./{prefix_path}/{request}\"));\n             Some(request.into())\n         },\n-        query,\n-        fragment,\n+        query.clone(),\n+        fragment.clone(),\n     )\n     .await?\n     {\n@@ -2201,11 +2202,10 @@ async fn resolve_relative_request(\n \n     let mut new_path = path_pattern.clone();\n \n-    let fragment_val = fragment.await?;\n-    if !fragment_val.is_empty() {\n+    if !fragment.is_empty() {\n         new_path.push(Pattern::Alternatives(vec![\n             Pattern::Constant(RcStr::default()),\n-            Pattern::Constant((*fragment_val).clone()),\n+            Pattern::Constant(fragment.clone()),\n         ]));\n     }\n \n@@ -2284,11 +2284,11 @@ async fn resolve_relative_request(\n                         continue;\n                     };\n \n-                    if !fragment_val.is_empty() {\n+                    if !fragment.is_empty() {\n                         // If the fragment is not empty, we need to strip it from the matched\n                         // pattern\n                         if let Some(matched_pattern) = matched_pattern\n-                            .strip_suffix(&**fragment_val)\n+                            .strip_suffix(fragment.as_str())\n                             .and_then(|s| s.strip_suffix('#'))\n                         {\n                             results.push(\n@@ -2299,8 +2299,8 @@ async fn resolve_relative_request(\n                                     request,\n                                     options_value,\n                                     options,\n-                                    query,\n-                                    Vc::cell(RcStr::default()),\n+                                    query.clone(),\n+                                    RcStr::default(),\n                                 )\n                                 .await?,\n                             );\n@@ -2316,18 +2316,18 @@ async fn resolve_relative_request(\n                                 request,\n                                 options_value,\n                                 options,\n-                                query,\n-                                fragment,\n+                                query.clone(),\n+                                fragment.clone(),\n                             )\n                             .await?,\n                         );\n                         pushed = true;\n                     }\n                 }\n             }\n-            if !fragment_val.is_empty() {\n+            if !fragment.is_empty() {\n                 // If the fragment is not empty, we need to strip it from the matched pattern\n-                if let Some(matched_pattern) = matched_pattern.strip_suffix(&**fragment_val) {\n+                if let Some(matched_pattern) = matched_pattern.strip_suffix(fragment.as_str()) {\n                     results.push(\n                         resolved(\n                             RequestKey::new(matched_pattern.into()),\n@@ -2336,8 +2336,8 @@ async fn resolve_relative_request(\n                             request,\n                             options_value,\n                             options,\n-                            query,\n-                            Vc::cell(RcStr::default()),\n+                            query.clone(),\n+                            RcStr::default(),\n                         )\n                         .await?,\n                     );\n@@ -2354,8 +2354,8 @@ async fn resolve_relative_request(\n                         request,\n                         options_value,\n                         options,\n-                        query,\n-                        fragment,\n+                        query.clone(),\n+                        fragment.clone(),\n                     )\n                     .await?,\n                 );\n@@ -2379,8 +2379,8 @@ async fn apply_in_package(\n     options: Vc<ResolveOptions>,\n     options_value: &ResolveOptions,\n     get_request: impl Fn(&FileSystemPath) -> Option<RcStr>,\n-    query: Vc<RcStr>,\n-    fragment: Vc<RcStr>,\n+    query: RcStr,\n+    fragment: RcStr,\n ) -> Result<Option<Vc<ResolveResult>>> {\n     // Check alias field for module aliases first\n     for in_package in options_value.in_package.iter() {\n@@ -2443,8 +2443,8 @@ async fn apply_in_package(\n                 resolve_internal(\n                     package_path,\n                     Request::parse(Value::new(Pattern::Constant(value.into())))\n-                        .with_query(query)\n-                        .with_fragment(fragment),\n+                        .with_query(query.clone())\n+                        .with_fragment(fragment.clone()),\n                     options,\n                 )\n                 .with_replaced_request_key(value.into(), Value::new(request_key))\n@@ -2514,8 +2514,8 @@ async fn resolve_module_request(\n     options_value: &ResolveOptions,\n     module: &str,\n     path: &Pattern,\n-    query: Vc<RcStr>,\n-    fragment: Vc<RcStr>,\n+    query: RcStr,\n+    fragment: RcStr,\n ) -> Result<Vc<ResolveResult>> {\n     // Check alias field for module aliases first\n     if let Some(result) = apply_in_package(\n@@ -2526,8 +2526,8 @@ async fn resolve_module_request(\n             let full_pattern = Pattern::concat([RcStr::from(module).into(), path.clone()]);\n             full_pattern.into_string()\n         },\n-        query,\n-        fragment,\n+        query.clone(),\n+        fragment.clone(),\n     )\n     .await?\n     {\n@@ -2544,8 +2544,8 @@ async fn resolve_module_request(\n             let result = resolve_into_package(\n                 Value::new(path.clone()),\n                 **package_path,\n-                query,\n-                fragment,\n+                query.clone(),\n+                fragment.clone(),\n                 options,\n             );\n             if !(*result.is_unresolvable().await?) {\n@@ -2580,8 +2580,8 @@ async fn resolve_module_request(\n                 results.push(resolve_into_package(\n                     Value::new(path.clone()),\n                     *package_path,\n-                    query,\n-                    fragment,\n+                    query.clone(),\n+                    fragment.clone(),\n                     options,\n                 ));\n             }\n@@ -2594,8 +2594,8 @@ async fn resolve_module_request(\n                         request,\n                         options_value,\n                         options,\n-                        query,\n-                        fragment,\n+                        query.clone(),\n+                        fragment.clone(),\n                     )\n                     .await?;\n                     results.push(resolved)\n@@ -2633,8 +2633,8 @@ async fn resolve_module_request(\n async fn resolve_into_package(\n     path: Value<Pattern>,\n     package_path: ResolvedVc<FileSystemPath>,\n-    query: Vc<RcStr>,\n-    fragment: Vc<RcStr>,\n+    query: RcStr,\n+    fragment: RcStr,\n     options: ResolvedVc<ResolveOptions>,\n ) -> Result<Vc<ResolveResult>> {\n     let path = path.into_value();\n@@ -2718,7 +2718,7 @@ async fn resolve_import_map_result(\n     original_lookup_path: Vc<FileSystemPath>,\n     original_request: Vc<Request>,\n     options: Vc<ResolveOptions>,\n-    query: Vc<RcStr>,\n+    query: RcStr,\n ) -> Result<Option<Vc<ResolveResult>>> {\n     Ok(match result {\n         ImportMapResult::Result(result) => Some(**result),\n@@ -2797,7 +2797,7 @@ async fn resolve_import_map_result(\n                         original_lookup_path,\n                         original_request,\n                         options,\n-                        query,\n+                        query.clone(),\n                     ))\n                 })\n                 .try_join()\n@@ -2817,8 +2817,8 @@ async fn resolved(\n     original_request: Vc<Request>,\n     options_value: &ResolveOptions,\n     options: Vc<ResolveOptions>,\n-    query: Vc<RcStr>,\n-    fragment: Vc<RcStr>,\n+    query: RcStr,\n+    fragment: RcStr,\n ) -> Result<Vc<ResolveResult>> {\n     let RealPathResult { path, symlinks } = &*fs_path.realpath_with_links().await?;\n \n@@ -2829,8 +2829,8 @@ async fn resolved(\n         options,\n         options_value,\n         |package_path| package_path.get_relative_path_to(path_ref),\n-        query,\n-        fragment,\n+        query.clone(),\n+        fragment.clone(),\n     )\n     .await?\n     {\n@@ -2848,7 +2848,7 @@ async fn resolved(\n             original_context,\n             original_request,\n             options,\n-            query,\n+            query.clone(),\n         )\n         .await?;\n \n@@ -2860,13 +2860,9 @@ async fn resolved(\n     Ok(*ResolveResult::source_with_affecting_sources(\n         request_key,\n         ResolvedVc::upcast(\n-            FileSource::new_with_query_and_fragment(\n-                **path,\n-                (*query.await?).clone(),\n-                (*fragment.await?).clone(),\n-            )\n-            .to_resolved()\n-            .await?,\n+            FileSource::new_with_query_and_fragment(**path, query, fragment)\n+                .to_resolved()\n+                .await?,\n         ),\n         symlinks\n             .iter()\n@@ -2888,13 +2884,12 @@ async fn handle_exports_imports_field(\n     path: &str,\n     conditions: &BTreeMap<RcStr, ConditionValue>,\n     unspecified_conditions: &ConditionValue,\n-    query: Vc<RcStr>,\n+    query: RcStr,\n ) -> Result<Vc<ResolveResult>> {\n     let mut results = Vec::new();\n     let mut conditions_state = FxHashMap::default();\n \n-    let query_str = query.await?;\n-    let req = Pattern::Constant(format!(\"{path}{query_str}\").into());\n+    let req = Pattern::Constant(format!(\"{path}{query}\").into());\n \n     let values = exports_imports_field\n         .lookup(&req)\n@@ -2988,7 +2983,7 @@ async fn resolve_package_internal_with_imports_field(\n         specifier,\n         conditions,\n         unspecified_conditions,\n-        Vc::<RcStr>::default(),\n+        RcStr::default(),\n     )\n     .await\n }"
        },
        {
            "sha": "e1c6a6db36dee0ff17b2c35737cc2333e658805f",
            "filename": "turbopack/crates/turbopack-core/src/resolve/parse.rs",
            "status": "modified",
            "additions": 119,
            "deletions": 112,
            "changes": 231,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fparse.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fparse.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fparse.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -11,31 +11,31 @@ use super::pattern::Pattern;\n pub enum Request {\n     Raw {\n         path: Pattern,\n-        query: ResolvedVc<RcStr>,\n+        query: RcStr,\n         force_in_lookup_dir: bool,\n-        fragment: ResolvedVc<RcStr>,\n+        fragment: RcStr,\n     },\n     Relative {\n         path: Pattern,\n-        query: ResolvedVc<RcStr>,\n+        query: RcStr,\n         force_in_lookup_dir: bool,\n-        fragment: ResolvedVc<RcStr>,\n+        fragment: RcStr,\n     },\n     Module {\n         module: RcStr,\n         path: Pattern,\n-        query: ResolvedVc<RcStr>,\n-        fragment: ResolvedVc<RcStr>,\n+        query: RcStr,\n+        fragment: RcStr,\n     },\n     ServerRelative {\n         path: Pattern,\n-        query: ResolvedVc<RcStr>,\n-        fragment: ResolvedVc<RcStr>,\n+        query: RcStr,\n+        fragment: RcStr,\n     },\n     Windows {\n         path: Pattern,\n-        query: ResolvedVc<RcStr>,\n-        fragment: ResolvedVc<RcStr>,\n+        query: RcStr,\n+        fragment: RcStr,\n     },\n     Empty,\n     PackageInternal {\n@@ -44,8 +44,8 @@ pub enum Request {\n     Uri {\n         protocol: RcStr,\n         remainder: RcStr,\n-        query: ResolvedVc<RcStr>,\n-        fragment: ResolvedVc<RcStr>,\n+        query: RcStr,\n+        fragment: RcStr,\n     },\n     DataUri {\n         media_type: RcStr,\n@@ -160,8 +160,8 @@ impl Request {\n             return Ok(Request::Uri {\n                 protocol: \"//\".into(),\n                 remainder: remainder.into(),\n-                query: ResolvedVc::cell(RcStr::default()),\n-                fragment: ResolvedVc::cell(RcStr::default()),\n+                query: RcStr::default(),\n+                fragment: RcStr::default(),\n             });\n         }\n \n@@ -170,8 +170,8 @@ impl Request {\n \n             return Ok(Request::ServerRelative {\n                 path,\n-                query: ResolvedVc::cell(query),\n-                fragment: ResolvedVc::cell(fragment),\n+                query,\n+                fragment,\n             });\n         }\n \n@@ -187,8 +187,8 @@ impl Request {\n             return Ok(Request::Relative {\n                 path,\n                 force_in_lookup_dir: false,\n-                query: ResolvedVc::cell(query),\n-                fragment: ResolvedVc::cell(fragment),\n+                query,\n+                fragment,\n             });\n         }\n \n@@ -197,8 +197,8 @@ impl Request {\n \n             return Ok(Request::Windows {\n                 path,\n-                query: ResolvedVc::cell(query),\n-                fragment: ResolvedVc::cell(fragment),\n+                query,\n+                fragment,\n             });\n         }\n \n@@ -219,8 +219,8 @@ impl Request {\n                 return Ok(Request::Uri {\n                     protocol: protocol.as_str().into(),\n                     remainder: remainder.as_str().into(),\n-                    query: ResolvedVc::cell(RcStr::default()),\n-                    fragment: ResolvedVc::cell(RcStr::default()),\n+                    query: RcStr::default(),\n+                    fragment: RcStr::default(),\n                 });\n             }\n         }\n@@ -234,8 +234,8 @@ impl Request {\n             return Ok(Request::Module {\n                 module: module.as_str().into(),\n                 path,\n-                query: ResolvedVc::cell(query),\n-                fragment: ResolvedVc::cell(fragment),\n+                query,\n+                fragment,\n             });\n         }\n \n@@ -317,48 +317,43 @@ impl Request {\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn raw(\n+    pub fn raw(\n         request: Value<Pattern>,\n-        query: Vc<RcStr>,\n-        fragment: Vc<RcStr>,\n+        query: RcStr,\n+        fragment: RcStr,\n         force_in_lookup_dir: bool,\n-    ) -> Result<Vc<Self>> {\n-        Ok(Self::cell(Request::Raw {\n+    ) -> Vc<Self> {\n+        Self::cell(Request::Raw {\n             path: request.into_value(),\n             force_in_lookup_dir,\n-            query: query.to_resolved().await?,\n-            fragment: fragment.to_resolved().await?,\n-        }))\n+            query,\n+            fragment,\n+        })\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn relative(\n+    pub fn relative(\n         request: Value<Pattern>,\n-        query: Vc<RcStr>,\n-        fragment: Vc<RcStr>,\n+        query: RcStr,\n+        fragment: RcStr,\n         force_in_lookup_dir: bool,\n-    ) -> Result<Vc<Self>> {\n-        Ok(Self::cell(Request::Relative {\n+    ) -> Vc<Self> {\n+        Self::cell(Request::Relative {\n             path: request.into_value(),\n             force_in_lookup_dir,\n-            query: query.to_resolved().await?,\n-            fragment: fragment.to_resolved().await?,\n-        }))\n+            query,\n+            fragment,\n+        })\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn module(\n-        module: RcStr,\n-        path: Value<Pattern>,\n-        query: Vc<RcStr>,\n-        fragment: Vc<RcStr>,\n-    ) -> Result<Vc<Self>> {\n-        Ok(Self::cell(Request::Module {\n+    pub fn module(module: RcStr, path: Value<Pattern>, query: RcStr, fragment: RcStr) -> Vc<Self> {\n+        Self::cell(Request::Module {\n             module,\n             path: path.into_value(),\n-            query: query.to_resolved().await?,\n-            fragment: fragment.to_resolved().await?,\n-        }))\n+            query,\n+            fragment,\n+        })\n     }\n \n     #[turbo_tasks::function]\n@@ -409,52 +404,49 @@ impl Request {\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn with_query(self: Vc<Self>, query: Vc<RcStr>) -> Result<Vc<Self>> {\n+    pub async fn with_query(self: Vc<Self>, query: RcStr) -> Result<Vc<Self>> {\n         Ok(match &*self.await? {\n             Request::Raw {\n                 path,\n                 query: _,\n                 force_in_lookup_dir,\n                 fragment,\n-            } => Request::Raw {\n-                path: path.clone(),\n-                query: query.to_resolved().await?,\n-                force_in_lookup_dir: *force_in_lookup_dir,\n-                fragment: *fragment,\n-            }\n-            .cell(),\n+            } => Request::raw(\n+                Value::new(path.clone()),\n+                query,\n+                fragment.clone(),\n+                *force_in_lookup_dir,\n+            ),\n             Request::Relative {\n                 path,\n                 query: _,\n                 force_in_lookup_dir,\n                 fragment,\n-            } => Request::Relative {\n-                path: path.clone(),\n-                query: query.to_resolved().await?,\n-                force_in_lookup_dir: *force_in_lookup_dir,\n-                fragment: *fragment,\n-            }\n-            .cell(),\n+            } => Request::relative(\n+                Value::new(path.clone()),\n+                query,\n+                fragment.clone(),\n+                *force_in_lookup_dir,\n+            ),\n             Request::Module {\n                 module,\n                 path,\n                 query: _,\n                 fragment,\n-            } => Request::Module {\n-                module: module.clone(),\n-                path: path.clone(),\n-                query: query.to_resolved().await?,\n-                fragment: *fragment,\n-            }\n-            .cell(),\n+            } => Request::module(\n+                module.clone(),\n+                Value::new(path.clone()),\n+                query,\n+                fragment.clone(),\n+            ),\n             Request::ServerRelative {\n                 path,\n                 query: _,\n                 fragment,\n             } => Request::ServerRelative {\n                 path: path.clone(),\n-                query: query.to_resolved().await?,\n-                fragment: *fragment,\n+                query,\n+                fragment: fragment.clone(),\n             }\n             .cell(),\n             Request::Windows {\n@@ -463,8 +455,8 @@ impl Request {\n                 fragment,\n             } => Request::Windows {\n                 path: path.clone(),\n-                query: query.to_resolved().await?,\n-                fragment: *fragment,\n+                query,\n+                fragment: fragment.clone(),\n             }\n             .cell(),\n             Request::Empty => self,\n@@ -477,7 +469,7 @@ impl Request {\n                 let requests = requests\n                     .iter()\n                     .copied()\n-                    .map(|req| req.with_query(query))\n+                    .map(|req| req.with_query(query.clone()))\n                     .map(|v| async move { v.to_resolved().await })\n                     .try_join()\n                     .await?;\n@@ -487,7 +479,7 @@ impl Request {\n     }\n \n     #[turbo_tasks::function]\n-    pub async fn with_fragment(self: Vc<Self>, fragment: Vc<RcStr>) -> Result<Vc<Self>> {\n+    pub async fn with_fragment(self: Vc<Self>, fragment: RcStr) -> Result<Vc<Self>> {\n         Ok(match &*self.await? {\n             Request::Raw {\n                 path,\n@@ -496,9 +488,9 @@ impl Request {\n                 fragment: _,\n             } => Request::Raw {\n                 path: path.clone(),\n-                query: *query,\n+                query: query.clone(),\n                 force_in_lookup_dir: *force_in_lookup_dir,\n-                fragment: fragment.to_resolved().await?,\n+                fragment,\n             }\n             .cell(),\n             Request::Relative {\n@@ -508,9 +500,9 @@ impl Request {\n                 fragment: _,\n             } => Request::Relative {\n                 path: path.clone(),\n-                query: *query,\n+                query: query.clone(),\n                 force_in_lookup_dir: *force_in_lookup_dir,\n-                fragment: fragment.to_resolved().await?,\n+                fragment,\n             }\n             .cell(),\n             Request::Module {\n@@ -521,8 +513,8 @@ impl Request {\n             } => Request::Module {\n                 module: module.clone(),\n                 path: path.clone(),\n-                query: *query,\n-                fragment: fragment.to_resolved().await?,\n+                query: query.clone(),\n+                fragment,\n             }\n             .cell(),\n             Request::ServerRelative {\n@@ -531,8 +523,8 @@ impl Request {\n                 fragment: _,\n             } => Request::ServerRelative {\n                 path: path.clone(),\n-                query: *query,\n-                fragment: fragment.to_resolved().await?,\n+                query: query.clone(),\n+                fragment,\n             }\n             .cell(),\n             Request::Windows {\n@@ -541,8 +533,8 @@ impl Request {\n                 fragment: _,\n             } => Request::Windows {\n                 path: path.clone(),\n-                query: *query,\n-                fragment: fragment.to_resolved().await?,\n+                query: query.clone(),\n+                fragment,\n             }\n             .cell(),\n             Request::Empty => self,\n@@ -555,7 +547,7 @@ impl Request {\n                 let requests = requests\n                     .iter()\n                     .copied()\n-                    .map(|req| req.with_fragment(fragment))\n+                    .map(|req| req.with_fragment(fragment.clone()))\n                     .map(|v| async move { v.to_resolved().await })\n                     .try_join()\n                     .await?;\n@@ -575,7 +567,12 @@ impl Request {\n             } => {\n                 let mut pat = Pattern::concat([path.clone(), suffix.into()]);\n                 pat.normalize();\n-                Self::raw(Value::new(pat), **query, **fragment, *force_in_lookup_dir)\n+                Self::raw(\n+                    Value::new(pat),\n+                    query.clone(),\n+                    fragment.clone(),\n+                    *force_in_lookup_dir,\n+                )\n             }\n             Request::Relative {\n                 path,\n@@ -585,7 +582,12 @@ impl Request {\n             } => {\n                 let mut pat = Pattern::concat([path.clone(), suffix.into()]);\n                 pat.normalize();\n-                Self::relative(Value::new(pat), **query, **fragment, *force_in_lookup_dir)\n+                Self::relative(\n+                    Value::new(pat),\n+                    query.clone(),\n+                    fragment.clone(),\n+                    *force_in_lookup_dir,\n+                )\n             }\n             Request::Module {\n                 module,\n@@ -595,7 +597,12 @@ impl Request {\n             } => {\n                 let mut pat = Pattern::concat([path.clone(), suffix.into()]);\n                 pat.normalize();\n-                Self::module(module.clone(), Value::new(pat), **query, **fragment)\n+                Self::module(\n+                    module.clone(),\n+                    Value::new(pat),\n+                    query.clone(),\n+                    fragment.clone(),\n+                )\n             }\n             Request::ServerRelative {\n                 path,\n@@ -606,8 +613,8 @@ impl Request {\n                 pat.normalize();\n                 Self::ServerRelative {\n                     path: pat,\n-                    query: *query,\n-                    fragment: *fragment,\n+                    query: query.clone(),\n+                    fragment: fragment.clone(),\n                 }\n                 .cell()\n             }\n@@ -620,8 +627,8 @@ impl Request {\n                 pat.normalize();\n                 Self::Windows {\n                     path: pat,\n-                    query: *query,\n-                    fragment: *fragment,\n+                    query: query.clone(),\n+                    fragment: fragment.clone(),\n                 }\n                 .cell()\n             }\n@@ -654,8 +661,8 @@ impl Request {\n                 Self::Uri {\n                     protocol: protocol.clone(),\n                     remainder,\n-                    query: *query,\n-                    fragment: *fragment,\n+                    query: query.clone(),\n+                    fragment: fragment.clone(),\n                 }\n                 .cell()\n             }\n@@ -678,21 +685,21 @@ impl Request {\n \n     #[turbo_tasks::function]\n     pub fn query(&self) -> Vc<RcStr> {\n-        match self {\n-            Request::Raw { query, .. } => **query,\n-            Request::Relative { query, .. } => **query,\n-            Request::Module { query, .. } => **query,\n-            Request::ServerRelative { query, .. } => **query,\n-            Request::Windows { query, .. } => **query,\n-            Request::Empty => Vc::<RcStr>::default(),\n-            Request::PackageInternal { .. } => Vc::<RcStr>::default(),\n-            Request::DataUri { .. } => Vc::<RcStr>::default(),\n-            Request::Uri { .. } => Vc::<RcStr>::default(),\n-            Request::Unknown { .. } => Vc::<RcStr>::default(),\n-            Request::Dynamic => Vc::<RcStr>::default(),\n+        Vc::cell(match self {\n+            Request::Windows { query, .. }\n+            | Request::ServerRelative { query, .. }\n+            | Request::Module { query, .. }\n+            | Request::Relative { query, .. }\n+            | Request::Raw { query, .. } => query.clone(),\n+            Request::Dynamic\n+            | Request::Unknown { .. }\n+            | Request::Uri { .. }\n+            | Request::DataUri { .. }\n+            | Request::PackageInternal { .. }\n+            | Request::Empty => RcStr::default(),\n             // TODO: is this correct, should we return the first one instead?\n-            Request::Alternatives { .. } => Vc::<RcStr>::default(),\n-        }\n+            Request::Alternatives { .. } => RcStr::default(),\n+        })\n     }\n \n     /// Turns the request into a pattern, similar to [Request::request()] but"
        },
        {
            "sha": "f54137381b4dce9af356381f8d5e10b1acc05b07",
            "filename": "turbopack/crates/turbopack-css/src/asset.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 11,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fasset.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, TryJoinIterExt, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -29,11 +29,6 @@ use crate::{\n     },\n };\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"css\".into())\n-}\n-\n #[turbo_tasks::value]\n #[derive(Clone)]\n pub struct CssModuleAsset {\n@@ -110,16 +105,16 @@ impl ProcessCss for CssModuleAsset {\n #[turbo_tasks::value_impl]\n impl Module for CssModuleAsset {\n     #[turbo_tasks::function]\n-    fn ident(&self) -> Vc<AssetIdent> {\n+    async fn ident(&self) -> Result<Vc<AssetIdent>> {\n         let mut ident = self\n             .source\n             .ident()\n-            .with_modifier(modifier())\n-            .with_layer(self.asset_context.layer());\n+            .with_modifier(rcstr!(\"css\"))\n+            .with_layer(self.asset_context.layer().owned().await?);\n         if let Some(import_context) = self.import_context {\n-            ident = ident.with_modifier(import_context.modifier())\n+            ident = ident.with_modifier(import_context.modifier().owned().await?)\n         }\n-        ident\n+        Ok(ident)\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "4de112bb50bb093fd0c82106724a401326511bb4",
            "filename": "turbopack/crates/turbopack-css/src/chunk/mod.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 11,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -5,7 +5,7 @@ use std::fmt::Write;\n \n use anyhow::{Result, bail};\n use swc_core::common::pass::Either;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     FxIndexSet, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Value, ValueDefault, ValueToString,\n     Vc,\n@@ -161,7 +161,6 @@ impl CssChunk {\n \n         // The included chunk items and the availability info describe the chunk\n         // uniquely\n-        let chunk_item_key = chunk_item_key().to_resolved().await?;\n         for &chunk_item in chunk_items.iter() {\n             if let Some((common_path_vc, common_path_ref)) = common_path.as_mut() {\n                 let path = chunk_item.asset_ident().path().await?;\n@@ -180,7 +179,7 @@ impl CssChunk {\n             .iter()\n             .map(|chunk_item| async move {\n                 Ok((\n-                    chunk_item_key,\n+                    rcstr!(\"chunk item\"),\n                     chunk_item.content_ident().to_resolved().await?,\n                 ))\n             })\n@@ -193,8 +192,8 @@ impl CssChunk {\n             } else {\n                 ServerFileSystem::new().root().to_resolved().await?\n             },\n-            query: ResolvedVc::cell(RcStr::default()),\n-            fragment: ResolvedVc::cell(RcStr::default()),\n+            query: RcStr::default(),\n+            fragment: RcStr::default(),\n             assets,\n             modifiers: Vec::new(),\n             parts: Vec::new(),\n@@ -315,11 +314,6 @@ impl OutputChunk for CssChunk {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn chunk_item_key() -> Vc<RcStr> {\n-    Vc::cell(\"chunk item\".into())\n-}\n-\n #[turbo_tasks::value_impl]\n impl OutputAsset for CssChunk {\n     #[turbo_tasks::function]\n@@ -329,7 +323,7 @@ impl OutputAsset for CssChunk {\n         Ok(self\n             .await?\n             .chunking_context\n-            .chunk_path(Some(Vc::upcast(self)), ident, \".css\".into()))\n+            .chunk_path(Some(Vc::upcast(self)), ident, rcstr!(\".css\")))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "67818745e7ae0ef1e08b783dadd67ac55795abc4",
            "filename": "turbopack/crates/turbopack-css/src/chunk/single_item_chunk/chunk.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fsingle_item_chunk%2Fchunk.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,7 +1,7 @@\n use std::fmt::Write;\n \n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::{File, FileSystemPath, rope::RopeBuilder};\n use turbopack_core::{\n@@ -75,7 +75,7 @@ impl SingleItemCssChunk {\n     #[turbo_tasks::function]\n     pub(super) async fn ident_for_path(&self) -> Result<Vc<AssetIdent>> {\n         let item = self.item.asset_ident();\n-        Ok(item.with_modifier(single_item_modifier()))\n+        Ok(item.with_modifier(rcstr!(\"single item css chunk\")))\n     }\n }\n \n@@ -93,11 +93,6 @@ impl Chunk for SingleItemCssChunk {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn single_item_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"single item css chunk\".into())\n-}\n-\n #[turbo_tasks::value_impl]\n impl OutputAsset for SingleItemCssChunk {\n     #[turbo_tasks::function]"
        },
        {
            "sha": "b077be4d28206e001f7cc9551a7cf81581bbd238",
            "filename": "turbopack/crates/turbopack-css/src/module_asset.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 10,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -4,7 +4,7 @@ use anyhow::{Context, Result, bail};\n use indoc::formatdoc;\n use lightningcss::css_modules::CssModuleReference;\n use swc_core::common::{BytePos, FileName, LineCol, SourceMap};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexMap, ResolvedVc, Value, ValueToString, Vc};\n use turbo_tasks_fs::{FileSystemPath, rope::Rope};\n use turbopack_core::{\n@@ -35,11 +35,6 @@ use crate::{\n     references::{compose::CssModuleComposeReference, internal::InternalCssAssetReference},\n };\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"css module\".into())\n-}\n-\n #[turbo_tasks::value]\n #[derive(Clone)]\n pub struct ModuleCssAsset {\n@@ -64,11 +59,12 @@ impl ModuleCssAsset {\n #[turbo_tasks::value_impl]\n impl Module for ModuleCssAsset {\n     #[turbo_tasks::function]\n-    fn ident(&self) -> Vc<AssetIdent> {\n-        self.source\n+    async fn ident(&self) -> Result<Vc<AssetIdent>> {\n+        Ok(self\n+            .source\n             .ident()\n-            .with_modifier(modifier())\n-            .with_layer(self.asset_context.layer())\n+            .with_modifier(rcstr!(\"css module\"))\n+            .with_layer(self.asset_context.layer().owned().await?))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "7e18d2a3114fc89c7fa08841340e800dcfb0240b",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/src/asset_context.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fasset_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fasset_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fasset_context.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,3 +1,4 @@\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{Result, Vc};\n use turbopack::{\n     ModuleAssetContext,\n@@ -34,7 +35,7 @@ pub async fn get_runtime_asset_context(\n         compile_time_info,\n         module_options_context,\n         Vc::default(),\n-        Vc::cell(\"runtime\".into()),\n+        rcstr!(\"runtime\"),\n     ));\n \n     Ok(asset_context)"
        },
        {
            "sha": "769c2c8a01be5cfd51d9b2f711dbc7f99dcab16f",
            "filename": "turbopack/crates/turbopack-ecmascript/src/async_chunk/chunk_item.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -168,9 +168,7 @@ impl ChunkItem for AsyncLoaderChunkItem {\n     async fn content_ident(self: Vc<Self>) -> Result<Vc<AssetIdent>> {\n         let ident = self.module().ident();\n \n-        Ok(ident.with_modifier(Vc::cell(\n-            self.chunks_data().hash().await?.to_string().into(),\n-        )))\n+        Ok(ident.with_modifier(self.chunks_data().hash().await?.to_string().into()))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "7b192633542d347717d15b89cde6eeeabd98e147",
            "filename": "turbopack/crates/turbopack-ecmascript/src/async_chunk/module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fmodule.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, Value, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -43,7 +43,7 @@ impl AsyncLoaderModule {\n \n     #[turbo_tasks::function]\n     pub fn asset_ident_for(module: Vc<Box<dyn ChunkableModule>>) -> Vc<AssetIdent> {\n-        module.ident().with_modifier(async_loader_modifier())\n+        module.ident().with_modifier(rcstr!(\"async loader\"))\n     }\n }\n "
        },
        {
            "sha": "2bde0f08f4ae2dc70e1410345e9e848085cb644e",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/mod.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 15,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -9,7 +9,7 @@ pub(crate) mod placeable;\n use std::fmt::Write;\n \n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Value, ValueToString, Vc};\n use turbo_tasks_fs::FileSystem;\n use turbopack_core::{\n@@ -66,16 +66,6 @@ impl EcmascriptChunk {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn chunk_item_key() -> Vc<RcStr> {\n-    Vc::cell(\"chunk item\".into())\n-}\n-\n-#[turbo_tasks::function]\n-fn availability_root_key() -> Vc<RcStr> {\n-    Vc::cell(\"current_availability_root\".into())\n-}\n-\n #[turbo_tasks::value_impl]\n impl Chunk for EcmascriptChunk {\n     #[turbo_tasks::function]\n@@ -104,12 +94,11 @@ impl Chunk for EcmascriptChunk {\n             }\n         }\n \n-        let chunk_item_key = chunk_item_key().to_resolved().await?;\n         let assets = chunk_items\n             .iter()\n             .map(|&chunk_item| async move {\n                 Ok((\n-                    chunk_item_key,\n+                    rcstr!(\"chunk item\"),\n                     chunk_item.content_ident().to_resolved().await?,\n                 ))\n             })\n@@ -122,8 +111,8 @@ impl Chunk for EcmascriptChunk {\n             } else {\n                 ServerFileSystem::new().root().to_resolved().await?\n             },\n-            query: ResolvedVc::cell(RcStr::default()),\n-            fragment: ResolvedVc::cell(RcStr::default()),\n+            query: RcStr::default(),\n+            fragment: RcStr::default(),\n             assets,\n             modifiers: Vec::new(),\n             parts: Vec::new(),"
        },
        {
            "sha": "66de6e133c8974f0859313534763c085a3fa0709",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 20,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -68,7 +68,7 @@ pub use transform::{\n     CustomTransformer, EcmascriptInputTransform, EcmascriptInputTransforms, TransformContext,\n     TransformPlugin, UnsupportedServerActionIssue,\n };\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{\n     FxIndexMap, NonLocalValue, ReadRef, ResolvedVc, TaskInput, TryJoinIterExt, Value,\n     ValueToString, Vc, trace::TraceRawVcs,\n@@ -208,11 +208,6 @@ impl Display for EcmascriptModuleAssetType {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"ecmascript\".into())\n-}\n-\n #[derive(Clone)]\n pub struct EcmascriptModuleAssetBuilder {\n     source: ResolvedVc<Box<dyn Source>>,\n@@ -610,24 +605,15 @@ impl EcmascriptModuleAsset {\n impl Module for EcmascriptModuleAsset {\n     #[turbo_tasks::function]\n     async fn ident(&self) -> Result<Vc<AssetIdent>> {\n+        let mut ident = self.source.ident().owned().await?;\n         if let Some(inner_assets) = self.inner_assets {\n-            let mut ident = self.source.ident().owned().await?;\n             for (name, asset) in inner_assets.await?.iter() {\n-                ident.add_asset(\n-                    ResolvedVc::cell(name.to_string().into()),\n-                    asset.ident().to_resolved().await?,\n-                );\n+                ident.add_asset(name.clone(), asset.ident().to_resolved().await?);\n             }\n-            ident.add_modifier(modifier().to_resolved().await?);\n-            ident.layer = Some(self.asset_context.layer().to_resolved().await?);\n-            Ok(AssetIdent::new(Value::new(ident)))\n-        } else {\n-            Ok(self\n-                .source\n-                .ident()\n-                .with_modifier(modifier())\n-                .with_layer(self.asset_context.layer()))\n         }\n+        ident.add_modifier(rcstr!(\"ecmascript\"));\n+        ident.layer = Some(self.asset_context.layer().owned().await?);\n+        Ok(AssetIdent::new(Value::new(ident)))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "fda880f872ccc6ce3644160c5d48144a5b4f2baa",
            "filename": "turbopack/crates/turbopack-ecmascript/src/manifest/chunk_asset.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 9,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_asset.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -18,11 +18,6 @@ use turbopack_core::{\n use super::chunk_item::ManifestChunkItem;\n use crate::chunk::{EcmascriptChunkPlaceable, EcmascriptExports};\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"manifest chunk\".into())\n-}\n-\n /// The manifest module is deferred until requested by the manifest loader\n /// item when the dynamic `import()` expression is reached.\n ///\n@@ -104,8 +99,7 @@ impl ManifestAsyncModule {\n     pub async fn content_ident(&self) -> Result<Vc<AssetIdent>> {\n         let mut ident = self.inner.ident();\n         if let Some(available_modules) = self.availability_info.available_modules() {\n-            ident =\n-                ident.with_modifier(Vc::cell(available_modules.hash().await?.to_string().into()));\n+            ident = ident.with_modifier(available_modules.hash().await?.to_string().into());\n         }\n         Ok(ident)\n     }\n@@ -120,7 +114,7 @@ fn manifest_chunk_reference_description() -> Vc<RcStr> {\n impl Module for ManifestAsyncModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.inner.ident().with_modifier(modifier())\n+        self.inner.ident().with_modifier(rcstr!(\"manifest chunk\"))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "1ff4bd8b5a47f0048933d6279116754b5fe99f3b",
            "filename": "turbopack/crates/turbopack-ecmascript/src/manifest/loader_item.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Floader_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Floader_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Floader_item.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -2,7 +2,7 @@ use std::io::Write as _;\n \n use anyhow::{Result, anyhow};\n use indoc::writedoc;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc};\n use turbopack_core::{\n     chunk::{\n@@ -25,9 +25,8 @@ use crate::{\n     utils::{StringifyJs, StringifyModuleId},\n };\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"loader\".into())\n+fn modifier() -> RcStr {\n+    rcstr!(\"loader\")\n }\n \n /// The manifest loader item is shipped in the same chunk that uses the dynamic"
        },
        {
            "sha": "215058c0b770813edd8d8da21f625bcaea22d190",
            "filename": "turbopack/crates/turbopack-ecmascript/src/parse.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fparse.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fparse.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fparse.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -226,7 +226,7 @@ async fn parse_internal(\n                         fs_path_vc,\n                         fs_path,\n                         ident,\n-                        source.ident().query().owned().await?,\n+                        source.ident().await?.query.clone(),\n                         file_path_hash,\n                         source,\n                         ty,"
        },
        {
            "sha": "4a1b640b6c611128d2e1e96cdab73cc117837a5a",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/external_module.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 9,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fexternal_module.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -2,7 +2,7 @@ use std::{fmt::Display, io::Write};\n \n use anyhow::Result;\n use serde::{Deserialize, Serialize};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{NonLocalValue, ResolvedVc, TaskInput, Vc, trace::TraceRawVcs};\n use turbo_tasks_fs::{FileContent, FileSystem, VirtualFileSystem, glob::Glob, rope::RopeBuilder};\n use turbopack_core::{\n@@ -27,11 +27,6 @@ use crate::{\n     utils::StringifyJs,\n };\n \n-#[turbo_tasks::function]\n-fn layer() -> Vc<RcStr> {\n-    Vc::cell(\"external\".into())\n-}\n-\n #[derive(\n     Copy,\n     Clone,\n@@ -126,9 +121,9 @@ impl Module for CachedExternalModule {\n         let fs = VirtualFileSystem::new_with_name(\"externals\".into());\n \n         AssetIdent::from_path(fs.root().join(self.request.clone()))\n-            .with_layer(layer())\n-            .with_modifier(Vc::cell(self.request.clone()))\n-            .with_modifier(Vc::cell(self.external_type.to_string().into()))\n+            .with_layer(rcstr!(\"external\"))\n+            .with_modifier(self.request.clone())\n+            .with_modifier(self.external_type.to_string().into())\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "be24c3edf9c16d77297efe7598f1ccab5bee0060",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/require_context.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 10,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -373,16 +373,13 @@ pub struct RequireContextAsset {\n     include_subdirs: bool,\n }\n \n-#[turbo_tasks::function]\n-fn modifier(dir: RcStr, include_subdirs: bool) -> Vc<RcStr> {\n-    Vc::cell(\n-        format!(\n-            \"require.context {}/{}\",\n-            dir,\n-            if include_subdirs { \"**\" } else { \"*\" },\n-        )\n-        .into(),\n+fn modifier(dir: &RcStr, include_subdirs: bool) -> RcStr {\n+    format!(\n+        \"require.context {}/{}\",\n+        dir,\n+        if include_subdirs { \"**\" } else { \"*\" },\n     )\n+    .into()\n }\n \n #[turbo_tasks::value_impl]\n@@ -391,7 +388,7 @@ impl Module for RequireContextAsset {\n     fn ident(&self) -> Vc<AssetIdent> {\n         self.source\n             .ident()\n-            .with_modifier(modifier(self.dir.clone(), self.include_subdirs))\n+            .with_modifier(modifier(&self.dir, self.include_subdirs))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "03628a61fcff540d3b82eb5f76069fddee20297a",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/typescript.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftypescript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftypescript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftypescript.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -132,8 +132,8 @@ impl ModuleReference for TsReferenceTypeAssetReference {\n             Request::module(\n                 self.module.clone(),\n                 Value::new(RcStr::default().into()),\n-                Vc::<RcStr>::default(),\n-                Vc::<RcStr>::default(),\n+                RcStr::default(),\n+                RcStr::default(),\n             ),\n         )\n     }"
        },
        {
            "sha": "6f66866b3993f4f0da9e2fd700afc486a4955cbc",
            "filename": "turbopack/crates/turbopack-ecmascript/src/text/mod.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 8,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftext%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftext%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftext%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileContent;\n use turbopack_core::{\n@@ -10,11 +10,6 @@ use turbopack_core::{\n \n use crate::utils::StringifyJs;\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"text content\".into())\n-}\n-\n /// A source asset that exports the string content of an asset as the default\n /// export of a JS module.\n #[turbo_tasks::value]\n@@ -36,8 +31,8 @@ impl Source for TextContentFileSource {\n     fn ident(&self) -> Vc<AssetIdent> {\n         self.source\n             .ident()\n-            .with_modifier(modifier())\n-            .rename_as(\"*.mjs\".into())\n+            .with_modifier(rcstr!(\"text content\"))\n+            .rename_as(rcstr!(\"*.mjs\"))\n     }\n }\n "
        },
        {
            "sha": "cb5c344c0797d78a67f4a95cae276e4a676ac90c",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/side_effect_module.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fside_effect_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fside_effect_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fside_effect_module.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc};\n use turbo_tasks_fs::glob::Glob;\n use turbopack_core::{\n@@ -57,15 +57,15 @@ impl Module for SideEffectsModule {\n         ident.parts.push(self.part.clone());\n \n         ident.add_asset(\n-            ResolvedVc::cell(RcStr::from(\"resolved\")),\n+            rcstr!(\"resolved\"),\n             self.resolved_as.ident().to_resolved().await?,\n         );\n \n-        ident.add_modifier(ResolvedVc::cell(RcStr::from(\"side effects\")));\n+        ident.add_modifier(rcstr!(\"side effects\"));\n \n         for (i, side_effect) in self.side_effects.iter().enumerate() {\n             ident.add_asset(\n-                ResolvedVc::cell(RcStr::from(format!(\"side effect {i}\"))),\n+                RcStr::from(format!(\"side effect {i}\")),\n                 side_effect.ident().to_resolved().await?,\n             );\n         }\n@@ -84,7 +84,7 @@ impl Module for SideEffectsModule {\n                     Ok(ResolvedVc::upcast(\n                         SingleChunkableModuleReference::new(\n                             *ResolvedVc::upcast(*side_effect),\n-                            Vc::cell(RcStr::from(\"side effect\")),\n+                            Vc::cell(rcstr!(\"side effect\")),\n                         )\n                         .to_resolved()\n                         .await?,\n@@ -97,7 +97,7 @@ impl Module for SideEffectsModule {\n         references.push(ResolvedVc::upcast(\n             SingleChunkableModuleReference::new(\n                 *ResolvedVc::upcast(self.resolved_as),\n-                Vc::cell(RcStr::from(\"resolved as\")),\n+                Vc::cell(rcstr!(\"resolved as\")),\n             )\n             .to_resolved()\n             .await?,"
        },
        {
            "sha": "745f8a1d2b0a379e6813b0bc34f90734366c3eac",
            "filename": "turbopack/crates/turbopack-ecmascript/src/typescript/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -165,8 +165,8 @@ impl Module for TsConfigModuleAsset {\n                         Request::module(\n                             name,\n                             Value::new(RcStr::default().into()),\n-                            Vc::<RcStr>::default(),\n-                            Vc::<RcStr>::default(),\n+                            RcStr::default(),\n+                            RcStr::default(),\n                         ),\n                     )\n                     .to_resolved()"
        },
        {
            "sha": "0363c7a193e273d8c0083639856b0a128742d5e4",
            "filename": "turbopack/crates/turbopack-ecmascript/src/webpack/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use swc_core::ecma::ast::Lit;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -25,11 +25,6 @@ use crate::EcmascriptInputTransforms;\n pub mod parse;\n pub(crate) mod references;\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"webpack\".into())\n-}\n-\n #[turbo_tasks::value]\n pub struct WebpackModuleAsset {\n     pub source: ResolvedVc<Box<dyn Source>>,\n@@ -57,7 +52,7 @@ impl WebpackModuleAsset {\n impl Module for WebpackModuleAsset {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.source.ident().with_modifier(modifier())\n+        self.source.ident().with_modifier(rcstr!(\"webpack\"))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "70b1a3d82fd02db60f3fde591a4f5fc3ffaaf2a2",
            "filename": "turbopack/crates/turbopack-ecmascript/src/worker_chunk/chunk_item.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use indoc::formatdoc;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc};\n use turbopack_core::{\n     chunk::{\n@@ -30,19 +30,14 @@ pub struct WorkerLoaderChunkItem {\n     pub chunking_context: ResolvedVc<Box<dyn ChunkingContext>>,\n }\n \n-#[turbo_tasks::function]\n-pub fn worker_modifier() -> Vc<RcStr> {\n-    Vc::cell(\"worker\".into())\n-}\n-\n #[turbo_tasks::value_impl]\n impl WorkerLoaderChunkItem {\n     #[turbo_tasks::function]\n     async fn chunks(&self) -> Result<Vc<OutputAssets>> {\n         let module = self.module.await?;\n \n         Ok(self.chunking_context.evaluated_chunk_group_assets(\n-            module.inner.ident().with_modifier(worker_modifier()),\n+            module.inner.ident().with_modifier(rcstr!(\"worker\")),\n             ChunkGroup::Isolated(ResolvedVc::upcast(module.inner)),\n             *self.module_graph,\n             Value::new(AvailabilityInfo::Root),"
        },
        {
            "sha": "c58bdf56994298458a8d88c2941a94203e8f7259",
            "filename": "turbopack/crates/turbopack-ecmascript/src/worker_chunk/module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fmodule.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -16,11 +16,6 @@ use turbopack_core::{\n \n use super::chunk_item::WorkerLoaderChunkItem;\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"worker loader\".into())\n-}\n-\n /// The WorkerLoaderModule is a module that creates a separate root chunk group for the given module\n /// and exports a URL to pass to the worker constructor.\n #[turbo_tasks::value]\n@@ -37,7 +32,7 @@ impl WorkerLoaderModule {\n \n     #[turbo_tasks::function]\n     pub fn asset_ident_for(module: Vc<Box<dyn ChunkableModule>>) -> Vc<AssetIdent> {\n-        module.ident().with_modifier(modifier())\n+        module.ident().with_modifier(rcstr!(\"worker loader\"))\n     }\n }\n "
        },
        {
            "sha": "612394acd933d9df44efbc79bd9290d7f78645da",
            "filename": "turbopack/crates/turbopack-json/src/lib.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-json%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-json%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-json%2Fsrc%2Flib.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -12,7 +12,7 @@\n use std::fmt::Write;\n \n use anyhow::{Error, Result, bail};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::{FileContent, FileJsonContent, glob::Glob};\n use turbopack_core::{\n@@ -31,11 +31,6 @@ use turbopack_ecmascript::{\n     runtime_functions::TURBOPACK_EXPORT_VALUE,\n };\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"json\".into())\n-}\n-\n #[turbo_tasks::value]\n pub struct JsonModuleAsset {\n     source: ResolvedVc<Box<dyn Source>>,\n@@ -53,7 +48,7 @@ impl JsonModuleAsset {\n impl Module for JsonModuleAsset {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.source.ident().with_modifier(modifier())\n+        self.source.ident().with_modifier(rcstr!(\"json\"))\n     }\n }\n "
        },
        {
            "sha": "77159d69ae4777488f9635cf140f55b97cfb21c1",
            "filename": "turbopack/crates/turbopack-node/src/transforms/webpack.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -266,7 +266,7 @@ impl WebpackLoadersProcessedAsset {\n                 ResolvedVc::cell(content),\n                 // We need to pass the query string to the loader\n                 ResolvedVc::cell(resource_path.to_string().into()),\n-                ResolvedVc::cell(this.source.ident().query().await?.to_string().into()),\n+                ResolvedVc::cell(this.source.ident().await?.query.to_string().into()),\n                 ResolvedVc::cell(json!(*loaders)),\n                 ResolvedVc::cell(transform.source_maps.into()),\n             ],"
        },
        {
            "sha": "0f9bdd7fc5d8b6553277e911d0077c74c5fc309d",
            "filename": "turbopack/crates/turbopack-nodejs/src/ecmascript/node/chunk.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fchunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fchunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fecmascript%2Fnode%2Fchunk.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexSet, ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -56,9 +56,8 @@ impl ValueToString for EcmascriptBuildNodeChunk {\n     }\n }\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"ecmascript build node chunk\".into())\n+fn modifier() -> RcStr {\n+    rcstr!(\"ecmascript build node chunk\")\n }\n \n #[turbo_tasks::value_impl]"
        },
        {
            "sha": "b52b4f5c05f8b6c001e53128146f07d7cf3f348e",
            "filename": "turbopack/crates/turbopack-resolve/src/typescript.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -408,8 +408,8 @@ pub async fn type_resolve(\n         Some(Request::module(\n             format!(\"@types/{m}\").into(),\n             Value::new(p.clone()),\n-            Vc::<RcStr>::default(),\n-            Vc::<RcStr>::default(),\n+            RcStr::default(),\n+            RcStr::default(),\n         ))\n     } else {\n         None"
        },
        {
            "sha": "439be258dcee63815599bd6df8b6ac041985c8d9",
            "filename": "turbopack/crates/turbopack-static/src/css.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Fcss.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Fcss.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Fcss.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,4 +1,4 @@\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -12,11 +12,6 @@ use turbopack_css::embed::CssEmbed;\n \n use crate::output_asset::StaticOutputAsset;\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"static in css\".into())\n-}\n-\n #[turbo_tasks::value]\n #[derive(Clone)]\n pub struct StaticUrlCssModule {\n@@ -43,7 +38,7 @@ impl StaticUrlCssModule {\n impl Module for StaticUrlCssModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.source.ident().with_modifier(modifier())\n+        self.source.ident().with_modifier(rcstr!(\"static in css\"))\n     }\n }\n "
        },
        {
            "sha": "ab07c2b7e75d11d1540c4e783629e0757f7ff75f",
            "filename": "turbopack/crates/turbopack-static/src/ecma.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Fecma.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Fecma.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-static%2Fsrc%2Fecma.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -21,11 +21,6 @@ use turbopack_ecmascript::{\n \n use crate::output_asset::StaticOutputAsset;\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"static in ecmascript\".into())\n-}\n-\n #[turbo_tasks::value]\n #[derive(Clone)]\n pub struct StaticUrlJsModule {\n@@ -52,7 +47,9 @@ impl StaticUrlJsModule {\n impl Module for StaticUrlJsModule {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n-        self.source.ident().with_modifier(modifier())\n+        self.source\n+            .ident()\n+            .with_modifier(rcstr!(\"static in ecmascript\"))\n     }\n }\n "
        },
        {
            "sha": "6c7d543172cb5bb4b788782b6156385c066f5936",
            "filename": "turbopack/crates/turbopack-tests/tests/execution.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -11,7 +11,7 @@ use anyhow::{Context, Result};\n use dunce::canonicalize;\n use serde::{Deserialize, Serialize};\n use tracing_subscriber::{Registry, layer::SubscriberExt, util::SubscriberInitExt};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     Completion, NonLocalValue, OperationVc, ResolvedVc, TryJoinIterExt, TurboTasks, Value, Vc,\n     apply_effects, debug::ValueDebugFormat, fxindexmap, trace::TraceRawVcs,\n@@ -404,7 +404,7 @@ async fn run_test_operation(prepared_test: ResolvedVc<PreparedTest>) -> Result<V\n             ..Default::default()\n         }\n         .cell(),\n-        Vc::cell(\"test\".into()),\n+        rcstr!(\"test\"),\n     ));\n \n     let chunking_context = NodeJsChunkingContext::builder("
        },
        {
            "sha": "f01467b6660ed845c4b6e247277a49507680b437",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -10,7 +10,7 @@ use dunce::canonicalize;\n use rustc_hash::FxHashSet;\n use serde::Deserialize;\n use serde_json::json;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     ReadConsistency, ReadRef, ResolvedVc, TryJoinIterExt, TurboTasks, Value, ValueToString, Vc,\n     apply_effects,\n@@ -335,7 +335,7 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n             ..Default::default()\n         }\n         .cell(),\n-        Vc::cell(\"test\".into()),\n+        rcstr!(\"test\"),\n     ));\n \n     let runtime_entries = maybe_load_env(asset_context, *project_path)"
        },
        {
            "sha": "17e25fbe973a7e9ba241b165c8f34c16ecfd7c97",
            "filename": "turbopack/crates/turbopack-wasm/src/module_asset.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 11,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::{Context, Result, bail};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Value, Vc, fxindexmap};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -33,11 +33,6 @@ use crate::{\n     source::WebAssemblySource,\n };\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"wasm module\".into())\n-}\n-\n /// Creates a javascript loader which instantiates the WebAssembly source and\n /// re-exports its exports.\n #[turbo_tasks::value]\n@@ -68,7 +63,7 @@ impl WebAssemblyModuleAsset {\n     #[turbo_tasks::function]\n     async fn loader_as_module(self: Vc<Self>) -> Result<Vc<Box<dyn Module>>> {\n         let this = self.await?;\n-        let query = &*this.source.ident().query().await?;\n+        let query = &this.source.ident().await?.query;\n \n         let loader_source = if query == \"?module\" {\n             compiling_loader_source(*this.source)\n@@ -126,11 +121,12 @@ impl WebAssemblyModuleAsset {\n #[turbo_tasks::value_impl]\n impl Module for WebAssemblyModuleAsset {\n     #[turbo_tasks::function]\n-    fn ident(&self) -> Vc<AssetIdent> {\n-        self.source\n+    async fn ident(&self) -> Result<Vc<AssetIdent>> {\n+        Ok(self\n+            .source\n             .ident()\n-            .with_modifier(modifier())\n-            .with_layer(self.asset_context.layer())\n+            .with_modifier(rcstr!(\"wasm module\"))\n+            .with_layer(self.asset_context.layer().owned().await?))\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "ce9e5ba304c9518a008bb2d1eefe54bd7233e338",
            "filename": "turbopack/crates/turbopack-wasm/src/output_asset.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 8,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Foutput_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Foutput_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Foutput_asset.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n@@ -11,11 +11,6 @@ use turbopack_core::{\n \n use crate::source::WebAssemblySource;\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"wasm\".into())\n-}\n-\n /// Emits the [WebAssemblySource] at a chunk path determined by the\n /// [ChunkingContext].\n #[turbo_tasks::value]\n@@ -43,10 +38,10 @@ impl OutputAsset for WebAssemblyAsset {\n     #[turbo_tasks::function]\n     async fn path(self: Vc<Self>) -> Result<Vc<FileSystemPath>> {\n         let this = self.await?;\n-        let ident = this.source.ident().with_modifier(modifier());\n+        let ident = this.source.ident().with_modifier(rcstr!(\"wasm\"));\n         Ok(this\n             .chunking_context\n-            .chunk_path(Some(Vc::upcast(self)), ident, \".wasm\".into()))\n+            .chunk_path(Some(Vc::upcast(self)), ident, rcstr!(\".wasm\")))\n     }\n }\n "
        },
        {
            "sha": "e16a6c18cefb45a15bdcf0f512af6f494aa1673b",
            "filename": "turbopack/crates/turbopack-wasm/src/raw.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 14,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fraw.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fraw.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fraw.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::{Result, bail};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{ResolvedVc, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -22,11 +22,6 @@ use turbopack_ecmascript::{\n \n use crate::{output_asset::WebAssemblyAsset, source::WebAssemblySource};\n \n-#[turbo_tasks::function]\n-fn modifier() -> Vc<RcStr> {\n-    Vc::cell(\"wasm raw\".into())\n-}\n-\n /// Exports the relative path to the WebAssembly file without loading it.\n #[turbo_tasks::value]\n #[derive(Clone)]\n@@ -57,11 +52,12 @@ impl RawWebAssemblyModuleAsset {\n #[turbo_tasks::value_impl]\n impl Module for RawWebAssemblyModuleAsset {\n     #[turbo_tasks::function]\n-    fn ident(&self) -> Vc<AssetIdent> {\n-        self.source\n+    async fn ident(&self) -> Result<Vc<AssetIdent>> {\n+        Ok(self\n+            .source\n             .ident()\n-            .with_modifier(modifier())\n-            .with_layer(self.asset_context.layer())\n+            .with_modifier(rcstr!(\"wasm raw\"))\n+            .with_layer(self.asset_context.layer().owned().await?))\n     }\n }\n \n@@ -85,10 +81,7 @@ impl ChunkableModule for RawWebAssemblyModuleAsset {\n             RawModuleChunkItem {\n                 module: self,\n                 chunking_context,\n-                wasm_asset: self\n-                    .wasm_asset(Vc::upcast(*chunking_context))\n-                    .to_resolved()\n-                    .await?,\n+                wasm_asset: self.wasm_asset(*chunking_context).to_resolved().await?,\n             }\n             .cell(),\n         ))"
        },
        {
            "sha": "b1eb32dfaaf5647ac1ec5bc7d88da8224da75b51",
            "filename": "turbopack/crates/turbopack-wasm/src/source.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fsource.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fsource.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fsource.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -1,5 +1,6 @@\n use anyhow::Result;\n use serde::{Deserialize, Serialize};\n+use turbo_rcstr::rcstr;\n use turbo_tasks::{NonLocalValue, ResolvedVc, TaskInput, Vc, trace::TraceRawVcs};\n use turbo_tasks_fs::{File, FileContent};\n use turbopack_core::{\n@@ -56,7 +57,7 @@ impl Source for WebAssemblySource {\n             WebAssemblySourceType::Text => self\n                 .source\n                 .ident()\n-                .with_path(self.source.ident().path().append(\"_.wasm\".into())),\n+                .with_path(self.source.ident().path().append(rcstr!(\"_.wasm\"))),\n         }\n     }\n }"
        },
        {
            "sha": "93828a9e331c40375f036844c20ba5387781d1d3",
            "filename": "turbopack/crates/turbopack/benches/node_file_trace.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -2,7 +2,7 @@ use std::{fs, path::PathBuf};\n \n use criterion::{Bencher, BenchmarkId, Criterion};\n use regex::Regex;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ReadConsistency, ResolvedVc, TurboTasks, Value, Vc, apply_effects};\n use turbo_tasks_backend::{BackendOptions, TurboTasksBackend, noop_backing_storage};\n use turbo_tasks_fs::{DiskFileSystem, FileSystem, NullFileSystem};\n@@ -113,7 +113,7 @@ fn bench_emit(b: &mut Bencher, bench_input: &BenchInput) {\n                         ..Default::default()\n                     }\n                     .cell(),\n-                    Vc::cell(\"node_file_trace\".into()),\n+                    rcstr!(\"node_file_trace\"),\n                 );\n                 let module = module_asset_context\n                     .process(Vc::upcast(source), Value::new(ReferenceType::Undefined))"
        },
        {
            "sha": "cb238b2525f8c0778aefa8a48f8b63693d2d88b3",
            "filename": "turbopack/crates/turbopack/examples/turbopack.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fexamples%2Fturbopack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fexamples%2Fturbopack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fexamples%2Fturbopack.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -8,7 +8,7 @@ use std::{\n \n use anyhow::Result;\n use tokio::{spawn, time::sleep};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ReadConsistency, TurboTasks, UpdateInfo, Value, Vc, util::FormatDuration};\n use turbo_tasks_backend::{BackendOptions, TurboTasksBackend, noop_backing_storage};\n use turbo_tasks_fs::{DiskFileSystem, FileSystem};\n@@ -62,7 +62,7 @@ async fn main() -> Result<()> {\n                     ..Default::default()\n                 }\n                 .cell(),\n-                Vc::cell(\"default\".into()),\n+                rcstr!(\"default\"),\n             );\n             let module = module_asset_context\n                 .process("
        },
        {
            "sha": "ea95883297213370d050104e285f9d101681be4e",
            "filename": "turbopack/crates/turbopack/src/evaluate_context.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fevaluate_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fevaluate_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fevaluate_context.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -115,6 +115,6 @@ pub async fn node_evaluate_asset_context(\n         }\n         .cell(),\n         resolve_options_context,\n-        Vc::cell(layer),\n+        layer,\n     )))\n }"
        },
        {
            "sha": "bbedd5407ae787bb5617f0a0d0bdba78880d32db",
            "filename": "turbopack/crates/turbopack/src/lib.rs",
            "status": "modified",
            "additions": 21,
            "deletions": 22,
            "changes": 43,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -25,7 +25,7 @@ use ecmascript::{\n use graph::{AggregatedGraph, AggregatedGraphNodeContent, aggregate};\n use module_options::{ModuleOptions, ModuleOptionsContext, ModuleRuleEffect, ModuleType};\n use tracing::{Instrument, field::Empty};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexSet, ResolvedVc, Value, ValueToString, Vc};\n use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n pub use turbopack_core::condition;\n@@ -135,10 +135,10 @@ async fn apply_module_type(\n                 builder = builder.with_inner_assets(inner_assets);\n             }\n \n+            let module = builder.build().to_resolved().await?;\n             if runtime_code {\n-                ResolvedVc::upcast(builder.build().to_resolved().await?)\n+                ResolvedVc::upcast(module)\n             } else {\n-                let module = builder.build().resolve().await?;\n                 if matches!(&part, Some(ModulePart::Evaluation)) {\n                     // Skip the evaluation part if the module is marked as side effect free.\n                     let side_effect_free_packages = module_asset_context\n@@ -158,7 +158,7 @@ async fn apply_module_type(\n                 match options.tree_shaking_mode {\n                     Some(TreeShakingMode::ModuleFragments) => {\n                         Vc::upcast(EcmascriptModulePartAsset::select_part(\n-                            module,\n+                            *module,\n                             part.unwrap_or(ModulePart::facade()),\n                         ))\n                     }\n@@ -168,11 +168,11 @@ async fn apply_module_type(\n                                 ModulePart::Evaluation => {\n                                     if *module.get_exports().needs_facade().await? {\n                                         Vc::upcast(EcmascriptModuleFacadeModule::new(\n-                                            Vc::upcast(module),\n+                                            Vc::upcast(*module),\n                                             part,\n                                         ))\n                                     } else {\n-                                        Vc::upcast(module)\n+                                        Vc::upcast(*module)\n                                     }\n                                 }\n                                 ModulePart::Export(_) => {\n@@ -185,7 +185,7 @@ async fn apply_module_type(\n                                         apply_reexport_tree_shaking(\n                                             Vc::upcast(\n                                                 EcmascriptModuleFacadeModule::new(\n-                                                    Vc::upcast(module),\n+                                                    Vc::upcast(*module),\n                                                     ModulePart::exports(),\n                                                 )\n                                                 .resolve()\n@@ -196,7 +196,7 @@ async fn apply_module_type(\n                                         )\n                                     } else {\n                                         apply_reexport_tree_shaking(\n-                                            Vc::upcast(module.resolve().await?),\n+                                            Vc::upcast(*module),\n                                             part,\n                                             side_effect_free_packages,\n                                         )\n@@ -210,14 +210,14 @@ async fn apply_module_type(\n                             }\n                         } else if *module.get_exports().needs_facade().await? {\n                             Vc::upcast(EcmascriptModuleFacadeModule::new(\n-                                Vc::upcast(module),\n+                                Vc::upcast(*module),\n                                 ModulePart::facade(),\n                             ))\n                         } else {\n-                            Vc::upcast(module)\n+                            Vc::upcast(*module)\n                         }\n                     }\n-                    None => Vc::upcast(module),\n+                    None => Vc::upcast(*module),\n                 }\n                 .to_resolved()\n                 .await?\n@@ -309,7 +309,7 @@ pub struct ModuleAssetContext {\n     pub compile_time_info: ResolvedVc<CompileTimeInfo>,\n     pub module_options_context: ResolvedVc<ModuleOptionsContext>,\n     pub resolve_options_context: ResolvedVc<ResolveOptionsContext>,\n-    pub layer: ResolvedVc<RcStr>,\n+    pub layer: RcStr,\n     transition: Option<ResolvedVc<Box<dyn Transition>>>,\n     /// Whether to replace external resolutions with CachedExternalModules. Used with\n     /// ModuleOptionsContext.enable_externals_tracing to handle transitive external dependencies.\n@@ -324,7 +324,7 @@ impl ModuleAssetContext {\n         compile_time_info: ResolvedVc<CompileTimeInfo>,\n         module_options_context: ResolvedVc<ModuleOptionsContext>,\n         resolve_options_context: ResolvedVc<ResolveOptionsContext>,\n-        layer: ResolvedVc<RcStr>,\n+        layer: RcStr,\n     ) -> Vc<Self> {\n         Self::cell(ModuleAssetContext {\n             transitions,\n@@ -343,7 +343,7 @@ impl ModuleAssetContext {\n         compile_time_info: ResolvedVc<CompileTimeInfo>,\n         module_options_context: ResolvedVc<ModuleOptionsContext>,\n         resolve_options_context: ResolvedVc<ResolveOptionsContext>,\n-        layer: ResolvedVc<RcStr>,\n+        layer: RcStr,\n         transition: ResolvedVc<Box<dyn Transition>>,\n     ) -> Vc<Self> {\n         Self::cell(ModuleAssetContext {\n@@ -363,7 +363,7 @@ impl ModuleAssetContext {\n         compile_time_info: ResolvedVc<CompileTimeInfo>,\n         module_options_context: ResolvedVc<ModuleOptionsContext>,\n         resolve_options_context: ResolvedVc<ResolveOptionsContext>,\n-        layer: ResolvedVc<RcStr>,\n+        layer: RcStr,\n     ) -> Vc<Self> {\n         Self::cell(ModuleAssetContext {\n             transitions,\n@@ -411,7 +411,7 @@ impl ModuleAssetContext {\n             *this.compile_time_info,\n             *this.module_options_context,\n             resolve_options_context,\n-            *this.layer,\n+            this.layer.clone(),\n         ))\n     }\n }\n@@ -461,8 +461,7 @@ async fn process_default(\n     if !span.is_disabled() {\n         // Need to use record, otherwise future is not Send for some reason.\n         let module_asset_context_ref = module_asset_context.await?;\n-        let layer = module_asset_context_ref.layer.await?;\n-        span.record(\"layer\", &**layer);\n+        span.record(\"layer\", module_asset_context_ref.layer.as_str());\n     }\n     process_default_internal(\n         module_asset_context,\n@@ -684,7 +683,7 @@ async fn externals_tracing_module_context(ty: ExternalType) -> Result<Vc<ModuleA\n         }\n         .cell(),\n         resolve_options.cell(),\n-        Vc::cell(\"externals-tracing\".into()),\n+        rcstr!(\"externals-tracing\"),\n     ))\n }\n \n@@ -697,7 +696,7 @@ impl AssetContext for ModuleAssetContext {\n \n     #[turbo_tasks::function]\n     fn layer(&self) -> Vc<RcStr> {\n-        *self.layer\n+        Vc::cell(self.layer.clone())\n     }\n \n     #[turbo_tasks::function]\n@@ -907,7 +906,7 @@ impl AssetContext for ModuleAssetContext {\n                     *self.compile_time_info,\n                     *self.module_options_context,\n                     *self.resolve_options_context,\n-                    *self.layer,\n+                    self.layer.clone(),\n                     *transition,\n                 ))\n             } else {\n@@ -917,7 +916,7 @@ impl AssetContext for ModuleAssetContext {\n                     *self.compile_time_info,\n                     *self.module_options_context,\n                     *self.resolve_options_context,\n-                    *self.layer,\n+                    self.layer.clone(),\n                 ))\n             },\n         )"
        },
        {
            "sha": "a6e6746cca9903a50e7a6b7c7d4ad2125bc7d742",
            "filename": "turbopack/crates/turbopack/src/transition/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Ftransition%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Ftransition%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Ftransition%2Fmod.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -34,11 +34,6 @@ pub trait Transition {\n         compile_time_info\n     }\n \n-    /// Apply modifications to the layer\n-    fn process_layer(self: Vc<Self>, layer: Vc<RcStr>) -> Vc<RcStr> {\n-        layer\n-    }\n-\n     /// Apply modifications/wrapping to the module options context\n     fn process_module_options_context(\n         self: Vc<Self>,\n@@ -84,7 +79,7 @@ pub trait Transition {\n             self.process_module_options_context(*module_asset_context.module_options_context);\n         let resolve_options_context =\n             self.process_resolve_options_context(*module_asset_context.resolve_options_context);\n-        let layer = self.process_layer(*module_asset_context.layer);\n+        let layer = module_asset_context.layer.clone();\n         let transition_options = self.process_transition_options(*module_asset_context.transitions);\n         let module_asset_context = ModuleAssetContext::new(\n             transition_options,"
        },
        {
            "sha": "29fcdecbad080e214aff864f818dd4ce1e6980a7",
            "filename": "turbopack/crates/turbopack/tests/node-file-trace.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs?ref=fb0ce72dc89ddd597ce8927a6b041b3f1a16e7f7",
            "patch": "@@ -27,7 +27,7 @@ use rstest_reuse::{\n };\n use serde::{Deserialize, Serialize};\n use tokio::{process::Command, time::timeout};\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     ResolvedVc, TurboTasks, Value, ValueToString, Vc, apply_effects, backend::Backend,\n     trace::TraceRawVcs,\n@@ -365,7 +365,7 @@ async fn node_file_trace_operation(\n             ..Default::default()\n         }\n         .cell(),\n-        Vc::cell(\"test\".into()),\n+        rcstr!(\"test\"),\n     );\n     let module = module_asset_context\n         .process(Vc::upcast(source), Value::new(ReferenceType::Undefined))"
        }
    ],
    "stats": {
        "total": 1201,
        "additions": 480,
        "deletions": 721
    }
}