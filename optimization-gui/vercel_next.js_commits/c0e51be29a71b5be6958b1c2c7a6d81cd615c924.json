{
    "author": "eps1lon",
    "message": "Don't use inspector frontend URLs from other processes (#86082)",
    "sha": "c0e51be29a71b5be6958b1c2c7a6d81cd615c924",
    "files": [
        {
            "sha": "8dda5c8f9746b8de0aea4b738230d5f6920d8a62",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/c0e51be29a71b5be6958b1c2c7a6d81cd615c924/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c0e51be29a71b5be6958b1c2c7a6d81cd615c924/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=c0e51be29a71b5be6958b1c2c7a6d81cd615c924",
            "patch": "@@ -1,5 +1,6 @@\n import type { Socket } from 'net'\n import { mkdir, writeFile } from 'fs/promises'\n+import * as inspector from 'inspector'\n import { join, extname, relative } from 'path'\n import { pathToFileURL } from 'url'\n \n@@ -78,7 +79,6 @@ import { generateEncryptionKeyBase64 } from '../app-render/encryption-utils-serv\n import { isAppPageRouteDefinition } from '../route-definitions/app-page-route-definition'\n import { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\n import type { ModernSourceMapPayload } from '../lib/source-maps'\n-import { getNodeDebugType, getParsedNodeOptions } from '../lib/utils'\n import { isMetadataRouteFile } from '../../lib/metadata/is-metadata-route'\n import { setBundlerFindSourceMapImplementation } from '../patch-error-inspect'\n import { getNextErrorFeedbackMiddleware } from '../../next-devtools/server/get-next-error-feedback-middleware'\n@@ -814,15 +814,14 @@ export async function createHotReloaderTurbopack(\n   }\n \n   let devtoolsFrontendUrl: string | undefined\n-  const nodeOptions = getParsedNodeOptions()\n-  const nodeDebugType = getNodeDebugType(nodeOptions)\n-  if (nodeDebugType) {\n-    const debugPort = process.debugPort\n+  const inspectorURLRaw = inspector.url()\n+  if (inspectorURLRaw !== undefined) {\n+    const inspectorURL = new URL(inspectorURLRaw)\n+\n     let debugInfo\n     try {\n-      // It requires to use 127.0.0.1 instead of localhost for server-side fetching.\n       const debugInfoList = await fetch(\n-        `http://127.0.0.1:${debugPort}/json/list`\n+        `http://${inspectorURL.host}/json/list`\n       ).then((res) => res.json())\n       debugInfo = debugInfoList[0]\n     } catch {}"
        },
        {
            "sha": "946804ce43a030c1778f8494154fb78e6d0a940a",
            "filename": "packages/next/src/server/dev/hot-reloader-webpack.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/c0e51be29a71b5be6958b1c2c7a6d81cd615c924/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c0e51be29a71b5be6958b1c2c7a6d81cd615c924/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts?ref=c0e51be29a71b5be6958b1c2c7a6d81cd615c924",
            "patch": "@@ -13,6 +13,7 @@ import {\n   getOriginalStackFrames,\n } from './middleware-webpack'\n import { WebpackHotMiddleware } from './hot-middleware'\n+import * as inspector from 'inspector'\n import { join, relative, isAbsolute, posix, dirname } from 'path'\n import {\n   createEntrypoints,\n@@ -81,7 +82,6 @@ import type { HmrMessageSentToBrowser } from './hot-reloader-types'\n import type { WebpackError } from 'webpack'\n import { PAGE_TYPES } from '../../lib/page-types'\n import { FAST_REFRESH_RUNTIME_RELOAD } from './messages'\n-import { getNodeDebugType, getParsedNodeOptions } from '../lib/utils'\n import { getNextErrorFeedbackMiddleware } from '../../next-devtools/server/get-next-error-feedback-middleware'\n import { getDevOverlayFontMiddleware } from '../../next-devtools/server/font/get-dev-overlay-font-middleware'\n import { getDisableDevIndicatorMiddleware } from '../../next-devtools/server/dev-indicator-middleware'\n@@ -861,17 +861,15 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n \n     this.versionInfo = await this.tracedGetVersionInfo(startSpan)\n \n-    const nodeOptions = getParsedNodeOptions()\n-    const nodeDebugType = getNodeDebugType(nodeOptions)\n-    if (nodeDebugType && !this.devtoolsFrontendUrl) {\n-      const debugPort = process.debugPort\n+    const inspectorURLRaw = inspector.url()\n+    if (inspectorURLRaw !== undefined) {\n+      const inspectorURL = new URL(inspectorURLRaw)\n+\n       let debugInfo\n       try {\n-        // It requires to use 127.0.0.1 instead of localhost for server-side fetching.\n         const debugInfoList = await fetch(\n-          `http://127.0.0.1:${debugPort}/json/list`\n+          `http://${inspectorURL.host}/json/list`\n         ).then((res) => res.json())\n-        // There will be only one item for current process, so always get the first item.\n         debugInfo = debugInfoList[0]\n       } catch {}\n       if (debugInfo) {"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 12,
        "deletions": 15
    }
}