{
    "author": "raunofreiberg",
    "message": "[dev-tools] Custom keyboard shortcut to toggle visibility (#81064)\n\nThis PR implements a `<ShortcutRecorder>` component to assign custom\nkeyboard shortcuts. For now, we can use this to let engineers choose a\nshortcut to hide (and show) the Dev Tools badge:\n\n\nhttps://github.com/user-attachments/assets/2366271d-b9e6-4577-bfe5-e21705c88f8c\n\n`ShortcutRecorder` stores the shortcut in `localStorage` and supports\nassigning keybinds with up to 3 keys, and automatically reorders the\npressed keys in the order in which they would be registered by a browser\n`keydown` event:\n\n\n\nhttps://github.com/user-attachments/assets/aa7b0119-9a03-4fd3-8a81-bd8cb2500054\n\n---------\n\nCo-authored-by: graphite-app[bot] <96075541+graphite-app[bot]@users.noreply.github.com>",
    "sha": "b81f9892b3f5216e8c40a413f840f6ce8e00f1f4",
    "files": [
        {
            "sha": "9c8a0ca210b6a6eaab65706fc8e8f0b72d0d6d96",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=b81f9892b3f5216e8c40a413f840f6ce8e00f1f4",
            "patch": "@@ -23,9 +23,11 @@ import {\n } from './utils'\n import {\n   getInitialPosition,\n+  useHideShortcutStorage,\n   type DevToolsScale,\n } from './dev-tools-info/preferences'\n import { Draggable } from './draggable'\n+import { useShortcuts } from '../../../hooks/use-shortcuts'\n import { SegmentsExplorer } from './dev-tools-info/segments-explorer'\n \n // TODO: add E2E tests to cover different scenarios\n@@ -61,6 +63,9 @@ export function DevToolsIndicator({\n           method: 'POST',\n         })\n       }}\n+      toggleVisibility={() => {\n+        setIsDevToolsIndicatorVisible(!isDevToolsIndicatorVisible)\n+      }}\n       isTurbopack={!!process.env.TURBOPACK}\n       disabled={state.disableDevIndicator || !isDevToolsIndicatorVisible}\n       isBuildError={isBuildError}\n@@ -102,6 +107,7 @@ function DevToolsPopover({\n   isTurbopack,\n   isBuildError,\n   hide,\n+  toggleVisibility,\n   dispatch,\n   scale,\n   setScale,\n@@ -117,17 +123,20 @@ function DevToolsPopover({\n   isTurbopack: boolean\n   isBuildError: boolean\n   hide: () => void\n+  toggleVisibility: () => void\n   dispatch: OverlayDispatch\n   scale: DevToolsScale\n   setScale: (value: DevToolsScale) => void\n   page: string\n }) {\n+  const rootRef = useRef<HTMLDivElement>(null)\n   const menuRef = useRef<HTMLDivElement>(null)\n   const triggerRef = useRef<HTMLButtonElement | null>(null)\n \n   const [open, setOpen] = useState<Overlays | null>(null)\n   const [position, setPosition] = useState(getInitialPosition())\n   const [selectedIndex, setSelectedIndex] = useState(-1)\n+  const [hideShortcut, setHideShortcut] = useHideShortcutStorage()\n \n   const isMenuOpen = open === OVERLAYS.Root\n   const isTurbopackInfoOpen = open === OVERLAYS.Turbo\n@@ -148,6 +157,7 @@ function DevToolsPopover({\n   // Features to make the menu accessible\n   useFocusTrap(menuRef, triggerRef, isMenuOpen)\n   useClickOutside(menuRef, triggerRef, isMenuOpen, closeMenu)\n+  useShortcuts(hideShortcut ? { [hideShortcut]: hideDevTools } : {}, triggerRef)\n \n   useEffect(() => {\n     if (open === null) {\n@@ -159,6 +169,17 @@ function DevToolsPopover({\n     }\n   }, [open])\n \n+  function hideDevTools() {\n+    toggleVisibility()\n+    const root = rootRef.current\n+    // Toggle custom hidden attribute, no need\n+    // to close the menu in case you want to quickly get it\n+    // out the way to see an element behind it.\n+    if (root) {\n+      root.dataset.hidden = root.dataset.hidden === 'true' ? 'false' : 'true'\n+    }\n+  }\n+\n   function select(index: number | 'first' | 'last') {\n     if (index === 'first') {\n       setTimeout(() => {\n@@ -268,6 +289,7 @@ function DevToolsPopover({\n \n   return (\n     <Toast\n+      ref={rootRef}\n       data-nextjs-toast\n       style={\n         {\n@@ -336,6 +358,8 @@ function DevToolsPopover({\n         position={position}\n         scale={scale}\n         setScale={setScale}\n+        hideShortcut={hideShortcut}\n+        setHideShortcut={setHideShortcut}\n       />\n \n       {/* Page Route Info */}\n@@ -525,6 +549,12 @@ function IssueCount({ children }: { children: number }) {\n //////////////////////////////////////////////////////////////////////////////////////\n \n export const DEV_TOOLS_INDICATOR_STYLES = `\n+  [data-nextjs-toast] {\n+    &[data-hidden='true'] {\n+      display: none;\n+    }\n+  }\n+\n   .dev-tools-indicator-menu {\n     -webkit-font-smoothing: antialiased;\n     display: flex;"
        },
        {
            "sha": "b79358269b65075ec7616a80346c5735e95c6f07",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/preferences.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fpreferences.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fpreferences.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fpreferences.ts?ref=b81f9892b3f5216e8c40a413f840f6ce8e00f1f4",
            "patch": "@@ -11,6 +11,8 @@ const INDICATOR_POSITION =\n     .__NEXT_DEV_INDICATOR_POSITION as typeof window.__NEXT_DEV_INDICATOR_POSITION) ||\n   'bottom-left'\n \n+export const STORAGE_KEY_HIDE_SHORTCUT = '__nextjs_hide_shortcut'\n+\n export type DevToolsIndicatorPosition = typeof INDICATOR_POSITION\n \n export function getInitialPosition() {\n@@ -63,3 +65,33 @@ export function getInitialTheme() {\n   const theme = localStorage.getItem(STORAGE_KEY_THEME)\n   return theme === 'dark' || theme === 'light' ? theme : 'system'\n }\n+\n+//////////////////////////////////////////////////////////////////////////////////////\n+\n+export function getInitialHideShortcut(): string | null {\n+  if (typeof localStorage === 'undefined') {\n+    return null\n+  }\n+  const hideShortcut = localStorage.getItem(STORAGE_KEY_HIDE_SHORTCUT)\n+  return hideShortcut ? hideShortcut : null\n+}\n+\n+export function useHideShortcutStorage(): [\n+  string | null,\n+  (value: string | null) => void,\n+] {\n+  const [hideShortcut, setHideShortcut] = useState<string | null>(\n+    getInitialHideShortcut()\n+  )\n+\n+  function set(value: string | null) {\n+    setHideShortcut(value)\n+    if (value === null) {\n+      localStorage.removeItem(STORAGE_KEY_HIDE_SHORTCUT)\n+    } else {\n+      localStorage.setItem(STORAGE_KEY_HIDE_SHORTCUT, value)\n+    }\n+  }\n+\n+  return [hideShortcut, set]\n+}"
        },
        {
            "sha": "73302d6871da6a74b47b02c33d907ad1ba320969",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/shortcut-recorder.tsx",
            "status": "added",
            "additions": 465,
            "deletions": 0,
            "changes": 465,
            "blob_url": "https://github.com/vercel/next.js/blob/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fshortcut-recorder.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fshortcut-recorder.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fshortcut-recorder.tsx?ref=b81f9892b3f5216e8c40a413f840f6ce8e00f1f4",
            "patch": "@@ -0,0 +1,465 @@\n+import { useState, useRef, useEffect } from 'react'\n+import { css } from '../../../../utils/css'\n+\n+const SUCCESS_SHOW_DELAY_MS = 180\n+const SUCCESS_FADE_DELAY_MS = 1000\n+\n+const modifierKeys = ['Meta', 'Control', 'Ctrl', 'Alt', 'Option', 'Shift']\n+\n+export function ShortcutRecorder({\n+  value,\n+  onChange,\n+}: {\n+  value: string[] | null\n+  onChange: (value: string | null) => void\n+}) {\n+  const [show, setShow] = useState(false)\n+  const [keys, setKeys] = useState<string[]>(value ?? [])\n+  const [success, setSuccess] = useState<boolean>(false)\n+  const timeoutRef = useRef<number | null>(null)\n+  const buttonRef = useRef<HTMLButtonElement>(null)\n+  const hasShortcut = Boolean(value) || keys.length > 0\n+\n+  function handleKeyDown(e: React.KeyboardEvent<HTMLButtonElement>) {\n+    // Don't handle events from the Clear button\n+    if (e.target !== buttonRef.current) return\n+    if (e.key === 'Tab') return\n+    if (timeoutRef.current) clearTimeout(timeoutRef.current)\n+\n+    if (!show) {\n+      setShow(true)\n+    }\n+\n+    function handleValidation(next: string[]) {\n+      timeoutRef.current = window.setTimeout(() => {\n+        setSuccess(true)\n+        onChange(next.join('+'))\n+        timeoutRef.current = window.setTimeout(() => {\n+          setShow(false)\n+        }, SUCCESS_FADE_DELAY_MS)\n+      }, SUCCESS_SHOW_DELAY_MS)\n+    }\n+\n+    if (keys.length === 3) return\n+\n+    e.preventDefault()\n+    e.stopPropagation()\n+\n+    setKeys((prev) => {\n+      // Don't add duplicate keys\n+      if (prev.includes(e.key)) return prev\n+\n+      // Handle non-modifier keys (action keys)\n+      if (!modifierKeys.includes(e.key)) {\n+        // Replace existing non-modifier key if present\n+        const existingNonModifierIndex = prev.findIndex(\n+          (key) => !modifierKeys.includes(key)\n+        )\n+        if (existingNonModifierIndex !== -1) {\n+          const next = [...prev]\n+          next[existingNonModifierIndex] = e.key\n+          handleValidation(next)\n+          return next\n+        }\n+        // Add new non-modifier key at the end\n+        const next = [...prev, e.key]\n+        handleValidation(next)\n+        return next\n+      }\n+\n+      // Handle modifier keys\n+      const next = [...prev]\n+\n+      // Find the correct position for the modifier key based on predefined order\n+      const keyOrderIndex = modifierKeys.indexOf(e.key)\n+      let insertIndex = 0\n+\n+      // Find where to insert by checking existing modifier keys\n+      for (let i = 0; i < next.length; i++) {\n+        if (modifierKeys.includes(next[i])) {\n+          const existingOrderIndex = modifierKeys.indexOf(next[i])\n+          if (keyOrderIndex < existingOrderIndex) {\n+            insertIndex = i\n+            break\n+          }\n+          insertIndex = i + 1\n+        } else {\n+          // Stop at first non-modifier key\n+          break\n+        }\n+      }\n+\n+      next.splice(insertIndex, 0, e.key)\n+      handleValidation(next)\n+      return next\n+    })\n+  }\n+\n+  function clear() {\n+    buttonRef.current?.focus()\n+    setKeys([])\n+    setSuccess(false)\n+    setTimeout(() => {\n+      setShow(true)\n+    })\n+    onChange(null)\n+  }\n+\n+  function onBlur() {\n+    setSuccess(false)\n+    setShow(false)\n+  }\n+\n+  function onStart() {\n+    // Clear out timeouts for hiding the tooltip after success\n+    if (timeoutRef.current) clearTimeout(timeoutRef.current)\n+    setShow(true)\n+    buttonRef.current?.focus()\n+  }\n+\n+  return (\n+    <div className=\"shortcut-recorder\">\n+      <button\n+        className=\"shortcut-recorder-button\"\n+        ref={buttonRef}\n+        onClick={onStart}\n+        onFocus={onStart}\n+        onBlur={onBlur}\n+        onKeyDown={handleKeyDown}\n+        data-has-shortcut={hasShortcut}\n+        data-shortcut-recorder=\"true\"\n+      >\n+        {!hasShortcut ? (\n+          'Record Shortcut'\n+        ) : (\n+          <div className=\"shortcut-recorder-keys\">\n+            {keys.map((key) => (\n+              <Kbd key={key}>{key}</Kbd>\n+            ))}\n+          </div>\n+        )}\n+        {hasShortcut && (\n+          <div\n+            className=\"shortcut-recorder-clear-button\"\n+            role=\"button\"\n+            onClick={clear}\n+            onFocus={(e) => e.stopPropagation()}\n+            onKeyDown={(e) => {\n+              if (e.key === 'Enter' || e.key === ' ') {\n+                clear()\n+                e.stopPropagation()\n+              }\n+            }}\n+            aria-label=\"Clear shortcut\"\n+            tabIndex={0}\n+          >\n+            <IconCross />\n+          </div>\n+        )}\n+      </button>\n+      <div className=\"shortcut-recorder-tooltip\" data-show={show}>\n+        <div className=\"shortcut-recorder-status\">\n+          <div\n+            className=\"shortcut-recorder-status-icon\"\n+            data-success={success}\n+          />\n+          {success ? 'Shortcut set' : 'Recording'}\n+        </div>\n+        <BottomArrow />\n+      </div>\n+    </div>\n+  )\n+}\n+\n+function BottomArrow() {\n+  return (\n+    <svg\n+      fill=\"none\"\n+      height=\"6\"\n+      viewBox=\"0 0 14 6\"\n+      width=\"14\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+    >\n+      <path\n+        d=\"M13.8284 0H0.17157C0.702003 0 1.21071 0.210714 1.58578 0.585787L5.58578 4.58579C6.36683 5.36684 7.63316 5.36683 8.41421 4.58579L12.4142 0.585786C12.7893 0.210714 13.298 0 13.8284 0Z\"\n+        fill=\"var(--background)\"\n+      />\n+    </svg>\n+  )\n+}\n+\n+function Kbd({ children }: { children: string }) {\n+  function renderKey(key: string) {\n+    switch (key) {\n+      case 'Meta':\n+        // Command symbol (⌘) on macOS\n+        // On non-macOS, shows \"Ctrl\"\n+        return <MetaKey />\n+      case 'Alt':\n+      case 'Option':\n+        // Option symbol (⌥)\n+        return '⌥'\n+      case 'Control':\n+      case 'Ctrl':\n+        // Control abbreviation\n+        return 'Ctrl'\n+      case 'Shift':\n+        // Shift symbol (⇧)\n+        return '⇧'\n+      case 'Enter':\n+        // Enter symbol (⏎)\n+        return '⏎'\n+      case 'Escape':\n+      case 'Esc':\n+        return 'Esc'\n+      case ' ':\n+      case 'Space':\n+      case 'Spacebar':\n+        return 'Space'\n+      case 'ArrowUp':\n+        return '↑'\n+      case 'ArrowDown':\n+        return '↓'\n+      case 'ArrowLeft':\n+        return '←'\n+      case 'ArrowRight':\n+        return '→'\n+      case 'Tab':\n+        return 'Tab'\n+      case 'Backspace':\n+        return '⌫'\n+      case 'Delete':\n+        return '⌦'\n+      default:\n+        // Capitalize single letters, otherwise show as-is\n+        if (children.length === 1) {\n+          return children.toUpperCase()\n+        }\n+        return children\n+    }\n+  }\n+  const key = renderKey(children)\n+  const isSymbol = typeof key === 'string' ? key.length === 1 : false\n+  return <kbd data-symbol={isSymbol}>{key}</kbd>\n+}\n+\n+function MetaKey() {\n+  // u00A0 = &nbsp;\n+  const [label, setLabel] = useState('\\u00A0')\n+\n+  const apple = isApple()\n+\n+  useEffect(() => {\n+    // Meta is Command on Apple devices, otherwise Control\n+    if (apple === true) {\n+      setLabel('⌘')\n+    }\n+\n+    // Explicitly say \"Ctrl\" instead of the symbol \"⌃\"\n+    // because most Windows/Linux laptops do not print the symbol\n+    // Other keyboard-intensive apps like Linear do this\n+    if (apple === false) {\n+      setLabel('Ctrl')\n+    }\n+  }, [apple])\n+\n+  return (\n+    <span style={{ minWidth: '1em', display: 'inline-block' }}>{label}</span>\n+  )\n+}\n+\n+function IconCross() {\n+  return (\n+    <svg height=\"16\" strokeLinejoin=\"round\" viewBox=\"0 0 16 16\" width=\"16\">\n+      <path\n+        fillRule=\"evenodd\"\n+        clipRule=\"evenodd\"\n+        d=\"M12.4697 13.5303L13 14.0607L14.0607 13L13.5303 12.4697L9.06065 7.99999L13.5303 3.53032L14.0607 2.99999L13 1.93933L12.4697 2.46966L7.99999 6.93933L3.53032 2.46966L2.99999 1.93933L1.93933 2.99999L2.46966 3.53032L6.93933 7.99999L2.46966 12.4697L1.93933 13L2.99999 14.0607L3.53032 13.5303L7.99999 9.06065L12.4697 13.5303Z\"\n+        fill=\"currentColor\"\n+      />\n+    </svg>\n+  )\n+}\n+\n+export const SHORTCUT_RECORDER_STYLES = css`\n+  .shortcut-recorder {\n+    display: flex;\n+    align-items: center;\n+    justify-content: center;\n+    gap: 8px;\n+    position: relative;\n+    font-family: var(--font-stack-sans);\n+\n+    .shortcut-recorder-button {\n+      display: flex;\n+      align-items: center;\n+      gap: 4px;\n+      background: transparent;\n+      border: 1px dashed var(--color-gray-500);\n+      border-radius: var(--rounded-lg);\n+      padding: 6px 8px;\n+      font-weight: 400;\n+      font-size: var(--size-14);\n+      color: var(--color-gray-1000);\n+      transition: border-color 150ms var(--timing-swift);\n+\n+      &[data-has-shortcut='true'] {\n+        border: 1px solid var(--color-gray-alpha-400);\n+\n+        &:hover {\n+          border-color: var(--color-gray-500);\n+        }\n+      }\n+\n+      &:hover {\n+        border-color: var(--color-gray-600);\n+      }\n+\n+      &::placeholder {\n+        color: var(--color-gray-900);\n+      }\n+\n+      &[data-pristine='false']::placeholder {\n+        color: transparent;\n+      }\n+\n+      &:focus-visible {\n+        outline: var(--focus-ring);\n+        outline-offset: -1px;\n+      }\n+    }\n+\n+    kbd {\n+      display: inline-flex;\n+      align-items: center;\n+      justify-content: center;\n+      font-family: var(--font-stack-sans);\n+      background: var(--color-gray-200);\n+      min-width: 20px;\n+      height: 20px;\n+      font-size: 14px;\n+      border-radius: 4px;\n+      color: var(--color-gray-1000);\n+\n+      &[data-symbol='false'] {\n+        padding: 0 4px;\n+      }\n+    }\n+\n+    .shortcut-recorder-clear-button {\n+      cursor: pointer;\n+      color: var(--color-gray-1000);\n+      width: 20px;\n+      height: 20px;\n+      display: flex;\n+      align-items: center;\n+      justify-content: center;\n+      border-radius: 4px;\n+      transition: background 150ms var(--timing-swift);\n+\n+      &:hover {\n+        background: var(--color-gray-300);\n+      }\n+\n+      &:focus-visible {\n+        outline: var(--focus-ring);\n+      }\n+\n+      svg {\n+        width: 14px;\n+        height: 14px;\n+      }\n+    }\n+  }\n+\n+  .shortcut-recorder-keys {\n+    pointer-events: none;\n+    user-select: none;\n+    display: flex;\n+    align-items: center;\n+    gap: 2px;\n+  }\n+\n+  .shortcut-recorder-tooltip {\n+    --gap: 8px;\n+    --background: var(--color-gray-1000);\n+    background: var(--background);\n+    color: var(--color-background-100);\n+    font-size: var(--size-14);\n+    padding: 4px 8px;\n+    border-radius: 8px;\n+    position: absolute;\n+    bottom: calc(100% + var(--gap));\n+    text-align: center;\n+    opacity: 0;\n+    scale: 0.96;\n+    white-space: nowrap;\n+    user-select: none;\n+    transition:\n+      opacity 150ms var(--timing-swift),\n+      scale 150ms var(--timing-swift);\n+\n+    &[data-show='true'] {\n+      opacity: 1;\n+      scale: 1;\n+    }\n+\n+    svg {\n+      position: absolute;\n+      transform: translateX(-50%);\n+      bottom: -6px;\n+      left: 50%;\n+    }\n+\n+    .shortcut-recorder-status {\n+      display: flex;\n+      align-items: center;\n+      gap: 6px;\n+    }\n+\n+    .shortcut-recorder-status-icon {\n+      width: 7px;\n+      height: 7px;\n+      border-radius: 50%;\n+      flex-shrink: 0;\n+      background: var(--color-red-700);\n+\n+      &[data-success='true'] {\n+        background: var(--color-green-700);\n+      }\n+    }\n+  }\n+`\n+\n+///////////////////////////////////////////////////////////////////////////////////////////////////\n+\n+function testPlatform(re: RegExp): boolean | undefined {\n+  // eslint-disable-next-line @typescript-eslint/no-unnecessary-condition -- Checking on an unusual environment.\n+  return typeof window !== 'undefined' && window.navigator != null\n+    ? re.test(window.navigator.platform)\n+    : undefined\n+}\n+\n+export function isMac(): boolean | undefined {\n+  return testPlatform(/^Mac/)\n+}\n+\n+export function isIPhone(): boolean | undefined {\n+  return testPlatform(/^iPhone/)\n+}\n+\n+export function isIPad(): boolean | undefined {\n+  return (\n+    testPlatform(/^iPad/) ||\n+    // iPadOS 13 lies and says it's a Mac, but we can distinguish by detecting touch support.\n+    (isMac() && navigator.maxTouchPoints > 1)\n+  )\n+}\n+\n+export function isIOS(): boolean | undefined {\n+  return isIPhone() || isIPad()\n+}\n+\n+export function isApple(): boolean | undefined {\n+  return isMac() || isIPhone() || isIPad()\n+}"
        },
        {
            "sha": "ec338ce0054bf5702603eb53a0b9dbf881d3f273",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/user-preferences.tsx",
            "status": "modified",
            "additions": 29,
            "deletions": 1,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx?ref=b81f9892b3f5216e8c40a413f840f6ce8e00f1f4",
            "patch": "@@ -16,20 +16,25 @@ import {\n   type DevToolsIndicatorPosition,\n   type DevToolsScale,\n } from './preferences'\n+import { ShortcutRecorder } from './shortcut-recorder'\n \n export function UserPreferences({\n   setPosition,\n   position,\n   hide,\n   scale,\n   setScale,\n+  hideShortcut,\n+  setHideShortcut,\n   ...props\n }: {\n   setPosition: (position: DevToolsIndicatorPosition) => void\n   position: DevToolsIndicatorPosition\n   scale: DevToolsScale\n   setScale: (value: DevToolsScale) => void\n   hide: () => void\n+  hideShortcut: string | null\n+  setHideShortcut: (value: string | null) => void\n } & DevToolsInfoPropsCore &\n   Omit<HTMLProps<HTMLDivElement>, 'size'>) {\n   // derive initial theme from system preference\n@@ -172,6 +177,21 @@ export function UserPreferences({\n           </div>\n         </div>\n \n+        <div className=\"preference-section\">\n+          <div className=\"preference-header\">\n+            <label id=\"hide-dev-tools\">Hide Dev Tools shortcut</label>\n+            <p className=\"preference-description\">\n+              Set a custom keyboard shortcut to toggle visibility.\n+            </p>\n+          </div>\n+          <div className=\"preference-control\">\n+            <ShortcutRecorder\n+              value={hideShortcut?.split('+') ?? null}\n+              onChange={setHideShortcut}\n+            />\n+          </div>\n+        </div>\n+\n         <div className=\"preference-section\">\n           <div className=\"preference-header\">\n             <label>Disable Dev Tools for this project</label>\n@@ -328,15 +348,23 @@ export const DEV_TOOLS_INFO_USER_PREFERENCES_STYLES = css`\n     font-size: var(--size-14);\n     color: var(--color-gray-1000);\n     padding: 6px 8px;\n+    transition: border-color 150ms var(--timing-swift);\n \n     &:hover {\n-      background: var(--color-gray-100);\n+      border-color: var(--color-gray-500);\n+    }\n+\n+    svg {\n+      width: 14px;\n+      height: 14px;\n+      overflow: visible;\n     }\n   }\n \n   .select-button {\n     &:focus-within {\n       outline: var(--focus-ring);\n+      outline-offset: -1px;\n     }\n \n     select {"
        },
        {
            "sha": "31db5219cb9e8f0f6529a1bb78d9c0ebe3be1801",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Futils.ts?ref=b81f9892b3f5216e8c40a413f840f6ce8e00f1f4",
            "patch": "@@ -60,7 +60,7 @@ export function useFocusTrap(\n   }, [active])\n }\n \n-function getActiveElement(node: HTMLElement | null) {\n+export function getActiveElement(node: HTMLElement | null) {\n   const root = node?.getRootNode()\n   return root instanceof ShadowRoot\n     ? (root?.activeElement as HTMLElement)"
        },
        {
            "sha": "a5ec2424a1c421625525a3b8e1824325dd922925",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/toast/toast.tsx",
            "status": "modified",
            "additions": 19,
            "deletions": 21,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ftoast%2Ftoast.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ftoast%2Ftoast.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ftoast%2Ftoast.tsx?ref=b81f9892b3f5216e8c40a413f840f6ce8e00f1f4",
            "patch": "@@ -6,24 +6,22 @@ export type ToastProps = React.HTMLProps<HTMLDivElement> & {\n   className?: string\n }\n \n-export const Toast: React.FC<ToastProps> = function Toast({\n-  onClick,\n-  children,\n-  className,\n-  ...props\n-}) {\n-  return (\n-    <div\n-      {...props}\n-      onClick={(e) => {\n-        if (!(e.target as HTMLElement).closest('a')) {\n-          e.preventDefault()\n-        }\n-        return onClick?.()\n-      }}\n-      className={cx('nextjs-toast', className)}\n-    >\n-      <div data-nextjs-toast-wrapper>{children}</div>\n-    </div>\n-  )\n-}\n+export const Toast = React.forwardRef<HTMLDivElement, ToastProps>(\n+  function Toast({ onClick, children, className, ...props }, ref) {\n+    return (\n+      <div\n+        {...props}\n+        ref={ref}\n+        onClick={(e) => {\n+          if (!(e.target as HTMLElement).closest('a')) {\n+            e.preventDefault()\n+          }\n+          return onClick?.()\n+        }}\n+        className={cx('nextjs-toast', className)}\n+      >\n+        {children}\n+      </div>\n+    )\n+  }\n+)"
        },
        {
            "sha": "48dddf048f3b570c80a63c7085d3f6ecabef0d36",
            "filename": "packages/next/src/next-devtools/dev-overlay/hooks/use-shortcuts.ts",
            "status": "added",
            "additions": 62,
            "deletions": 0,
            "changes": 62,
            "blob_url": "https://github.com/vercel/next.js/blob/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fhooks%2Fuse-shortcuts.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fhooks%2Fuse-shortcuts.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fhooks%2Fuse-shortcuts.ts?ref=b81f9892b3f5216e8c40a413f840f6ce8e00f1f4",
            "patch": "@@ -0,0 +1,62 @@\n+import { useEffect } from 'react'\n+import { getActiveElement } from '../components/errors/dev-tools-indicator/utils'\n+\n+export function useShortcuts(\n+  shortcuts: Record<string, () => void>,\n+  rootRef: React.RefObject<HTMLElement | null>\n+) {\n+  useEffect(() => {\n+    function handleKeyDown(e: KeyboardEvent) {\n+      if (isFocusedOnElement(rootRef)) return\n+\n+      const keys = []\n+\n+      if (e.metaKey) keys.push('Meta')\n+      if (e.ctrlKey) keys.push('Control')\n+      if (e.altKey) keys.push('Alt')\n+      if (e.shiftKey) keys.push('Shift')\n+\n+      if (\n+        e.key !== 'Meta' &&\n+        e.key !== 'Control' &&\n+        e.key !== 'Alt' &&\n+        e.key !== 'Shift'\n+      ) {\n+        keys.push(e.key)\n+      }\n+\n+      const shortcut = keys.join('+')\n+\n+      if (shortcuts[shortcut]) {\n+        e.preventDefault()\n+        shortcuts[shortcut]()\n+      }\n+    }\n+\n+    window.addEventListener('keydown', handleKeyDown)\n+    return () => window.removeEventListener('keydown', handleKeyDown)\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, [shortcuts])\n+}\n+\n+function isFocusedOnElement(rootRef: React.RefObject<HTMLElement | null>) {\n+  const el = getActiveElement(rootRef.current)\n+\n+  if (!el) return false\n+\n+  if (\n+    el.contentEditable === 'true' ||\n+    el.tagName === 'INPUT' ||\n+    el.tagName === 'TEXTAREA' ||\n+    el.tagName === 'SELECT' ||\n+    el.dataset['shortcut-recorder'] === 'true'\n+  ) {\n+    // It's okay to trigger global keybinds from readonly inputs\n+    if (el.hasAttribute('readonly')) {\n+      return false\n+    }\n+    return true\n+  }\n+\n+  return false\n+}"
        },
        {
            "sha": "7aa7170fb2bd7bbf9fc3c8c287867def2f056ccd",
            "filename": "packages/next/src/next-devtools/dev-overlay/styles/component-styles.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b81f9892b3f5216e8c40a413f840f6ce8e00f1f4/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx?ref=b81f9892b3f5216e8c40a413f840f6ce8e00f1f4",
            "patch": "@@ -38,6 +38,7 @@ import { SEGMENTS_EXPLORER_TAB_STYLES } from '../components/devtools-panel/devto\n import { SEGMENTS_EXPLORER_STYLES } from '../components/errors/dev-tools-indicator/dev-tools-info/segments-explorer'\n import { DEVTOOLS_PANEL_TAB_ISSUES_CONTENT_LAYOUT_STYLES } from '../components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-content-layout'\n import { DEVTOOLS_PANEL_TAB_ISSUES_EMPTY_CONTENT_STYLES } from '../components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-empty-content'\n+import { SHORTCUT_RECORDER_STYLES } from '../components/errors/dev-tools-indicator/dev-tools-info/shortcut-recorder'\n \n export function ComponentStyles() {\n   return (\n@@ -82,6 +83,7 @@ export function ComponentStyles() {\n         ${ISSUE_FEEDBACK_BUTTON_STYLES}\n         ${ERROR_CONTENT_SKELETON_STYLES}\n         ${SEGMENTS_EXPLORER_TAB_STYLES}\n+        ${SHORTCUT_RECORDER_STYLES}\n       `}\n     </style>\n   )"
        }
    ],
    "stats": {
        "total": 663,
        "additions": 640,
        "deletions": 23
    }
}