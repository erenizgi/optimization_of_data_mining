{
    "author": "devjiwonchoi",
    "message": "[TypeScript Plugin] Moved the diagnostics' positions to the prop's type instead of the value for client-boundary warnings (#79193)\n\nBest be reviewed with \"Hide whitespace\".\n\n### Why?\n\nSince it was matching `ts.isObjectBindingPattern`, which checks only the\ndestructured props:\n\n![CleanShot 2025-05-14 at 12 17\n25@2x](https://github.com/user-attachments/assets/44aaffd2-9276-486e-86ce-acb77d488ab0)\n\nIt didn't handle non-destructured:\n\n![CleanShot 2025-05-14 at 12 17\n34@2x](https://github.com/user-attachments/assets/23abc130-3e17-4f72-89a2-bc084841f52f)\n\nTherefore, I think it's more natural to target the types, not the props\nvalue, as the cause of this warning is actually the types:\n\n![CleanShot 2025-05-14 at 12 18\n00@2x](https://github.com/user-attachments/assets/0a5a64c8-1ac9-4b0f-8fe7-20e78db2acec)\n\n![CleanShot 2025-05-14 at 12 17\n53@2x](https://github.com/user-attachments/assets/72008c25-7d7b-46e4-8e2f-e52f01e50b80)\n\nx-ref:\nhttps://github.com/vercel/next.js/pull/79144#discussion_r2086941435\n\n---------\n\nCo-authored-by: Janka Uryga <lolzatu2@gmail.com>",
    "sha": "3ecf087f10fdfba4426daa02b459387bc9c3c54f",
    "files": [
        {
            "sha": "e9f93508de5b17ac3aed0de8c8f5356aadabf79b",
            "filename": ".changeset/shy-impalas-add.md",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/3ecf087f10fdfba4426daa02b459387bc9c3c54f/.changeset%2Fshy-impalas-add.md",
            "raw_url": "https://github.com/vercel/next.js/raw/3ecf087f10fdfba4426daa02b459387bc9c3c54f/.changeset%2Fshy-impalas-add.md",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.changeset%2Fshy-impalas-add.md?ref=3ecf087f10fdfba4426daa02b459387bc9c3c54f",
            "patch": "@@ -0,0 +1,5 @@\n+---\n+\"next\": patch\n+---\n+\n+[TypeScript Plugin] Moved the diagnostics' positions to the prop's type instead of the value for client-boundary warnings."
        },
        {
            "sha": "c97b8cd0a0458f1543874d62572f7e02a47dd79c",
            "filename": "packages/next/src/server/typescript/rules/client-boundary.ts",
            "status": "modified",
            "additions": 62,
            "deletions": 50,
            "changes": 112,
            "blob_url": "https://github.com/vercel/next.js/blob/3ecf087f10fdfba4426daa02b459387bc9c3c54f/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fclient-boundary.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ecf087f10fdfba4426daa02b459387bc9c3c54f/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fclient-boundary.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fclient-boundary.ts?ref=3ecf087f10fdfba4426daa02b459387bc9c3c54f",
            "patch": "@@ -43,57 +43,69 @@ const clientBoundary = {\n     const isErrorFile = /[\\\\/]error\\.tsx?$/.test(source.fileName)\n     const isGlobalErrorFile = /[\\\\/]global-error\\.tsx?$/.test(source.fileName)\n \n-    const props = node.parameters?.[0]?.name\n-    if (props && ts.isObjectBindingPattern(props)) {\n-      for (const prop of (props as tsModule.ObjectBindingPattern).elements) {\n-        const type = typeChecker.getTypeAtLocation(prop)\n-        const typeDeclarationNode = type.symbol?.getDeclarations()?.[0]\n-        const propName = (prop.propertyName || prop.name).getText()\n-\n-        if (typeDeclarationNode) {\n-          if (ts.isFunctionTypeNode(typeDeclarationNode)) {\n-            // By convention, props named \"action\" can accept functions since we\n-            // assume these are Server Actions. Structurally, there's no\n-            // difference between a Server Action and a normal function until\n-            // TypeScript exposes directives in the type of a function. This\n-            // will miss accidentally passing normal functions but a false\n-            // negative is better than a false positive given how frequent the\n-            // false-positive would be.\n-            const maybeServerAction =\n-              propName === 'action' || /.+Action$/.test(propName)\n-\n-            // There's a special case for the error file that the `reset` prop\n-            // is allowed to be a function:\n-            // https://github.com/vercel/next.js/issues/46573\n-            const isErrorReset =\n-              (isErrorFile || isGlobalErrorFile) && propName === 'reset'\n-\n-            if (!maybeServerAction && !isErrorReset) {\n-              diagnostics.push({\n-                file: source,\n-                category: ts.DiagnosticCategory.Warning,\n-                code: NEXT_TS_ERRORS.INVALID_CLIENT_ENTRY_PROP,\n-                messageText:\n-                  `Props must be serializable for components in the \"use client\" entry file. ` +\n-                  `\"${propName}\" is a function that's not a Server Action. ` +\n-                  `Rename \"${propName}\" either to \"action\" or have its name end with \"Action\" e.g. \"${propName}Action\" to indicate it is a Server Action.`,\n-                start: prop.getStart(),\n-                length: prop.getWidth(),\n-              })\n+    const props = node.parameters?.[0]\n+    if (props) {\n+      const propsType = typeChecker.getTypeAtLocation(props)\n+      const typeNode = propsType.symbol?.getDeclarations()?.[0]\n+\n+      if (typeNode && ts.isTypeLiteralNode(typeNode)) {\n+        for (const member of typeNode.members) {\n+          if (ts.isPropertySignature(member)) {\n+            const propName = member.name.getText()\n+            const propType = member.type\n+\n+            if (propType) {\n+              const propTypeInfo = typeChecker.getTypeAtLocation(propType)\n+              const typeDeclarationNode =\n+                propTypeInfo.symbol?.getDeclarations()?.[0]\n+\n+              if (typeDeclarationNode) {\n+                if (ts.isFunctionTypeNode(typeDeclarationNode)) {\n+                  // By convention, props named \"action\" can accept functions since we\n+                  // assume these are Server Actions. Structurally, there's no\n+                  // difference between a Server Action and a normal function until\n+                  // TypeScript exposes directives in the type of a function. This\n+                  // will miss accidentally passing normal functions but a false\n+                  // negative is better than a false positive given how frequent the\n+                  // false-positive would be.\n+                  const maybeServerAction =\n+                    propName === 'action' || /.+Action$/.test(propName)\n+\n+                  // There's a special case for the error file that the `reset` prop\n+                  // is allowed to be a function:\n+                  // https://github.com/vercel/next.js/issues/46573\n+                  const isErrorReset =\n+                    (isErrorFile || isGlobalErrorFile) && propName === 'reset'\n+\n+                  if (!maybeServerAction && !isErrorReset) {\n+                    diagnostics.push({\n+                      file: source,\n+                      category: ts.DiagnosticCategory.Warning,\n+                      code: NEXT_TS_ERRORS.INVALID_CLIENT_ENTRY_PROP,\n+                      messageText:\n+                        `Props must be serializable for components in the \"use client\" entry file. ` +\n+                        `\"${propName}\" is a function that's not a Server Action. ` +\n+                        `Rename \"${propName}\" either to \"action\" or have its name end with \"Action\" e.g. \"${propName}Action\" to indicate it is a Server Action.`,\n+                      start: propType.getStart(),\n+                      length: propType.getWidth(),\n+                    })\n+                  }\n+                } else if (\n+                  // Show warning for not serializable props.\n+                  ts.isConstructorTypeNode(typeDeclarationNode) ||\n+                  ts.isClassDeclaration(typeDeclarationNode)\n+                ) {\n+                  diagnostics.push({\n+                    file: source,\n+                    category: ts.DiagnosticCategory.Warning,\n+                    code: NEXT_TS_ERRORS.INVALID_CLIENT_ENTRY_PROP,\n+                    messageText: `Props must be serializable for components in the \"use client\" entry file, \"${propName}\" is invalid.`,\n+                    start: propType.getStart(),\n+                    length: propType.getWidth(),\n+                  })\n+                }\n+              }\n             }\n-          } else if (\n-            // Show warning for not serializable props.\n-            ts.isConstructorTypeNode(typeDeclarationNode) ||\n-            ts.isClassDeclaration(typeDeclarationNode)\n-          ) {\n-            diagnostics.push({\n-              file: source,\n-              category: ts.DiagnosticCategory.Warning,\n-              code: NEXT_TS_ERRORS.INVALID_CLIENT_ENTRY_PROP,\n-              messageText: `Props must be serializable for components in the \"use client\" entry file, \"${propName}\" is invalid.`,\n-              start: prop.getStart(),\n-              length: prop.getWidth(),\n-            })\n           }\n         }\n       }"
        },
        {
            "sha": "54e47ea1fe648063efc0241bbbc4961937937319",
            "filename": "test/development/typescript-plugin/client-boundary/app/non-serializable-action-props.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/3ecf087f10fdfba4426daa02b459387bc9c3c54f/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-action-props.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3ecf087f10fdfba4426daa02b459387bc9c3c54f/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-action-props.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-action-props.tsx?ref=3ecf087f10fdfba4426daa02b459387bc9c3c54f",
            "patch": "@@ -4,13 +4,7 @@ class Class {}\n \n type ArrowFunctionTypeAlias = () => void\n \n-export default function ClientComponent({\n-  _arrowFunctionAction,\n-  _arrowFunctionTypeAliasAction,\n-  // Doesn't make sense, but check for loophole\n-  _classAction,\n-  _constructorAction,\n-}: {\n+export default function ClientComponent(props: {\n   _arrowFunctionAction: () => void\n   _arrowFunctionTypeAliasAction: ArrowFunctionTypeAlias\n   // Doesn't make sense, but check for loophole"
        },
        {
            "sha": "45135b2da6f28f138d0c43ad400a487cc9bd540e",
            "filename": "test/development/typescript-plugin/client-boundary/app/non-serializable-props.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 6,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/3ecf087f10fdfba4426daa02b459387bc9c3c54f/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-props.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3ecf087f10fdfba4426daa02b459387bc9c3c54f/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-props.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-props.tsx?ref=3ecf087f10fdfba4426daa02b459387bc9c3c54f",
            "patch": "@@ -4,12 +4,7 @@ class Class {}\n \n type ArrowFunctionTypeAlias = () => void\n \n-export default function ClientComponent({\n-  _arrowFunction,\n-  _arrowFunctionTypeAlias,\n-  _class,\n-  _constructor,\n-}: {\n+export default function ClientComponent(props: {\n   _arrowFunction: () => void\n   _arrowFunctionTypeAlias: ArrowFunctionTypeAlias\n   _class: Class"
        },
        {
            "sha": "26bc7ecba6fb87302fb60a228e99f08fbcf165f7",
            "filename": "test/development/typescript-plugin/client-boundary/app/serializable-props.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/3ecf087f10fdfba4426daa02b459387bc9c3c54f/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fserializable-props.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/3ecf087f10fdfba4426daa02b459387bc9c3c54f/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fserializable-props.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fserializable-props.tsx?ref=3ecf087f10fdfba4426daa02b459387bc9c3c54f",
            "patch": "@@ -1,14 +1,6 @@\n 'use client'\n \n-export default function ClientComponent({\n-  _string,\n-  _number,\n-  _boolean,\n-  _array,\n-  _object,\n-  _null,\n-  _undefined,\n-}: {\n+export default function ClientComponent(props: {\n   _string: string\n   _number: number\n   _boolean: boolean"
        },
        {
            "sha": "02ca4c99a1e096335953adcbcc9ac91a7113221d",
            "filename": "test/development/typescript-plugin/client-boundary/client-boundary.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/3ecf087f10fdfba4426daa02b459387bc9c3c54f/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fclient-boundary.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/3ecf087f10fdfba4426daa02b459387bc9c3c54f/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fclient-boundary.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fclient-boundary.test.ts?ref=3ecf087f10fdfba4426daa02b459387bc9c3c54f",
            "patch": "@@ -58,15 +58,15 @@ describe('typescript-plugin - client-boundary', () => {\n        \"app/non-serializable-action-props.tsx\": [\n          {\n            \"code\": 71007,\n-           \"length\": 12,\n+           \"length\": 5,\n            \"messageText\": \"Props must be serializable for components in the \"use client\" entry file, \"_classAction\" is invalid.\",\n-           \"start\": 221,\n+           \"start\": 276,\n          },\n          {\n            \"code\": 71007,\n-           \"length\": 18,\n+           \"length\": 14,\n            \"messageText\": \"Props must be serializable for components in the \"use client\" entry file, \"_constructorAction\" is invalid.\",\n-           \"start\": 237,\n+           \"start\": 304,\n          },\n        ],\n      }\n@@ -91,27 +91,27 @@ describe('typescript-plugin - client-boundary', () => {\n        \"app/non-serializable-props.tsx\": [\n          {\n            \"code\": 71007,\n-           \"length\": 14,\n+           \"length\": 10,\n            \"messageText\": \"Props must be serializable for components in the \"use client\" entry file. \"_arrowFunction\" is a function that's not a Server Action. Rename \"_arrowFunction\" either to \"action\" or have its name end with \"Action\" e.g. \"_arrowFunctionAction\" to indicate it is a Server Action.\",\n-           \"start\": 116,\n+           \"start\": 139,\n          },\n          {\n            \"code\": 71007,\n-           \"length\": 23,\n+           \"length\": 22,\n            \"messageText\": \"Props must be serializable for components in the \"use client\" entry file. \"_arrowFunctionTypeAlias\" is a function that's not a Server Action. Rename \"_arrowFunctionTypeAlias\" either to \"action\" or have its name end with \"Action\" e.g. \"_arrowFunctionTypeAliasAction\" to indicate it is a Server Action.\",\n-           \"start\": 134,\n+           \"start\": 177,\n          },\n          {\n            \"code\": 71007,\n-           \"length\": 6,\n+           \"length\": 5,\n            \"messageText\": \"Props must be serializable for components in the \"use client\" entry file, \"_class\" is invalid.\",\n-           \"start\": 161,\n+           \"start\": 210,\n          },\n          {\n            \"code\": 71007,\n-           \"length\": 12,\n+           \"length\": 14,\n            \"messageText\": \"Props must be serializable for components in the \"use client\" entry file, \"_constructor\" is invalid.\",\n-           \"start\": 171,\n+           \"start\": 232,\n          },\n        ],\n      }"
        }
    ],
    "stats": {
        "total": 166,
        "additions": 82,
        "deletions": 84
    }
}