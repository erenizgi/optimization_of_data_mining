{
    "author": "eps1lon",
    "message": "[dev-overlay] Remove unused hydration error related code (#77929)\n\nAlso inlined some of the indirections that we no longer need.",
    "sha": "f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
    "files": [
        {
            "sha": "8292fde4c8e09b391c731e04752e7407103acbfa",
            "filename": "packages/next/src/client/components/errors/attach-hydration-error-state.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 10,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fattach-hydration-error-state.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fattach-hydration-error-state.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fattach-hydration-error-state.ts?ref=f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
            "patch": "@@ -1,11 +1,11 @@\n import {\n   getDefaultHydrationErrorMessage,\n+  getHydrationErrorStackInfo,\n   isHydrationError,\n   testReactHydrationWarning,\n } from '../is-hydration-error'\n import {\n   hydrationErrorState,\n-  getReactHydrationDiffSegments,\n   type HydrationErrorState,\n } from './hydration-error-info'\n \n@@ -19,14 +19,8 @@ export function attachHydrationErrorState(error: Error) {\n     return\n   }\n \n-  const reactHydrationDiffSegments = getReactHydrationDiffSegments(\n-    error.message\n-  )\n-  // If the reactHydrationDiffSegments exists\n-  // and the diff (reactHydrationDiffSegments[1]) exists\n-  // e.g. the hydration diff log error.\n-  if (reactHydrationDiffSegments) {\n-    const diff = reactHydrationDiffSegments[1]\n+  const { message, diff } = getHydrationErrorStackInfo(error.message)\n+  if (message) {\n     parsedHydrationErrorState = {\n       ...((error as any).details as HydrationErrorState),\n       ...hydrationErrorState,\n@@ -43,7 +37,7 @@ export function attachHydrationErrorState(error: Error) {\n       ],\n       // When it's hydration diff log, do not show notes section.\n       // This condition is only for the 1st squashed error.\n-      notes: isHydrationWarning ? '' : reactHydrationDiffSegments[0],\n+      notes: isHydrationWarning ? '' : message,\n       reactOutputComponentDiff: diff,\n     }\n     // Cache the `reactOutputComponentDiff` into hydrationErrorState."
        },
        {
            "sha": "8faa37e881fdfa9183d52ebec915abb741870b66",
            "filename": "packages/next/src/client/components/errors/hydration-error-info.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 12,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fhydration-error-info.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fhydration-error-info.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fhydration-error-info.ts?ref=f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
            "patch": "@@ -1,7 +1,4 @@\n-import {\n-  getHydrationErrorStackInfo,\n-  testReactHydrationWarning,\n-} from '../is-hydration-error'\n+import { testReactHydrationWarning } from '../is-hydration-error'\n \n export type HydrationErrorState = {\n   // Hydration warning template format: <message> <serverContent> <clientContent>\n@@ -55,14 +52,6 @@ const isHtmlTagsWarning = (message: string) => htmlTagsWarnings.has(message)\n const isTextInTagsMismatchWarning = (msg: string) =>\n   textAndTagsMismatchWarnings.has(msg)\n \n-export const getReactHydrationDiffSegments = (msg: NullableText) => {\n-  if (msg) {\n-    const { message, diff } = getHydrationErrorStackInfo(msg)\n-    if (message) return [message, diff]\n-  }\n-  return undefined\n-}\n-\n /**\n  * Patch console.error to capture hydration errors.\n  * If any of the knownHydrationWarnings are logged, store the message and component stack."
        },
        {
            "sha": "acb6850f56423f792b137e422a54f9c27510ced8",
            "filename": "packages/next/src/client/components/is-hydration-error.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 9,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fis-hydration-error.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fis-hydration-error.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fis-hydration-error.ts?ref=f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
            "patch": "@@ -52,7 +52,6 @@ export function testReactHydrationWarning(msg: string): boolean {\n \n export function getHydrationErrorStackInfo(rawMessage: string): {\n   message: string | null\n-  stack?: string\n   diff?: string\n } {\n   rawMessage = rawMessage.replace(/^Error: /, '')\n@@ -62,7 +61,6 @@ export function getHydrationErrorStackInfo(rawMessage: string): {\n   if (!isReactHydrationErrorMessage(rawMessage) && !isReactHydrationWarning) {\n     return {\n       message: null,\n-      stack: rawMessage,\n       diff: '',\n     }\n   }\n@@ -71,7 +69,6 @@ export function getHydrationErrorStackInfo(rawMessage: string): {\n     const [message, diffLog] = rawMessage.split('\\n\\n')\n     return {\n       message: message.trim(),\n-      stack: '',\n       diff: (diffLog || '').trim(),\n     }\n   }\n@@ -83,26 +80,21 @@ export function getHydrationErrorStackInfo(rawMessage: string): {\n   const trimmedMessage = message.trim()\n   // React built-in hydration diff starts with a newline, checking if length is > 1\n   if (trailing && trailing.length > 1) {\n-    const stacks: string[] = []\n     const diffs: string[] = []\n     trailing.split('\\n').forEach((line) => {\n       if (line.trim() === '') return\n-      if (line.trim().startsWith('at ')) {\n-        stacks.push(line)\n-      } else {\n+      if (!line.trim().startsWith('at ')) {\n         diffs.push(line)\n       }\n     })\n \n     return {\n       message: trimmedMessage,\n       diff: diffs.join('\\n'),\n-      stack: stacks.join('\\n'),\n     }\n   } else {\n     return {\n       message: trimmedMessage,\n-      stack: trailing, // without hydration diff\n     }\n   }\n }"
        },
        {
            "sha": "9a67c3bb493c375d8e067a1752659cecf7a308dd",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/dialog/dialog.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fdialog%2Fdialog.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fdialog%2Fdialog.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fdialog%2Fdialog.tsx?ref=f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
            "patch": "@@ -4,7 +4,6 @@ import { useMeasureHeight } from '../../hooks/use-measure-height'\n \n export type DialogProps = {\n   children?: React.ReactNode\n-  type: 'error' | 'warning'\n   'aria-labelledby': string\n   'aria-describedby': string\n   className?: string\n@@ -22,7 +21,6 @@ const CSS_SELECTORS_TO_EXCLUDE_ON_CLICK_OUTSIDE = [\n \n const Dialog: React.FC<DialogProps> = function Dialog({\n   children,\n-  type,\n   className,\n   onClose,\n   'aria-labelledby': ariaLabelledBy,"
        },
        {
            "sha": "9fc6bc39869c38eab2eafe77cf58e34cee774270",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dialog/dialog.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdialog%2Fdialog.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdialog%2Fdialog.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdialog%2Fdialog.tsx?ref=f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
            "patch": "@@ -16,7 +16,6 @@ export function ErrorOverlayDialog({\n   return (\n     <div className=\"error-overlay-dialog-container\">\n       <Dialog\n-        type=\"error\"\n         aria-labelledby=\"nextjs__container_errors_label\"\n         aria-describedby=\"nextjs__container_errors_desc\"\n         className=\"error-overlay-dialog-scroll\""
        },
        {
            "sha": "b807664b92747179a03ec7a8a70be91275458fb4",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/hydration-diff/diff-view.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fhydration-diff%2Fdiff-view.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fhydration-diff%2Fdiff-view.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fhydration-diff%2Fdiff-view.tsx?ref=f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
            "patch": "@@ -49,16 +49,10 @@ import { CollapseIcon } from '../../icons/collapse-icon'\n  *\n  */\n export function PseudoHtmlDiff({\n-  firstContent,\n-  secondContent,\n-  hydrationMismatchType,\n   reactOutputComponentDiff,\n   ...props\n }: {\n-  firstContent: string\n-  secondContent: string\n   reactOutputComponentDiff: string\n-  hydrationMismatchType: 'tag' | 'text' | 'text-in-tag'\n } & React.HTMLAttributes<HTMLPreElement>) {\n   const [isDiffCollapsed, toggleCollapseHtml] = useState(true)\n "
        },
        {
            "sha": "fc5cf9f7d3eef741930c606a4b3a6da277bca969",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/container/errors.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx?ref=f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
            "patch": "@@ -5,10 +5,7 @@ import { RuntimeError } from './runtime-error'\n import { getErrorSource } from '../../../../../shared/lib/error-source'\n import { HotlinkedText } from '../components/hot-linked-text'\n import { PseudoHtmlDiff } from './runtime-error/component-stack-pseudo-html'\n-import {\n-  type HydrationErrorState,\n-  getHydrationWarningType,\n-} from '../../../errors/hydration-error-info'\n+import type { HydrationErrorState } from '../../../errors/hydration-error-info'\n import {\n   isConsoleError,\n   getConsoleErrorType,\n@@ -131,7 +128,6 @@ export function Errors({\n   const [warningTemplate, serverContent, clientContent] =\n     errorDetails.warning || [null, '', '']\n \n-  const hydrationErrorType = getHydrationWarningType(warningTemplate)\n   const hydrationWarning = warningTemplate\n     ? warningTemplate\n         .replace('%s', serverContent)\n@@ -193,9 +189,6 @@ export function Errors({\n         !!errorDetails.reactOutputComponentDiff) ? (\n         <PseudoHtmlDiff\n           className=\"nextjs__container_errors__component-stack\"\n-          hydrationMismatchType={hydrationErrorType}\n-          firstContent={serverContent}\n-          secondContent={clientContent}\n           reactOutputComponentDiff={errorDetails.reactOutputComponentDiff || ''}\n         />\n       ) : null}"
        },
        {
            "sha": "820359e76affe6bb63f274738a66b2a26dae83da",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/container/runtime-error/component-stack-pseudo-html.stories.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Fruntime-error%2Fcomponent-stack-pseudo-html.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Fruntime-error%2Fcomponent-stack-pseudo-html.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Fruntime-error%2Fcomponent-stack-pseudo-html.stories.tsx?ref=f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
            "patch": "@@ -15,25 +15,18 @@ type Story = StoryObj<typeof PseudoHtmlDiff>\n \n export const TextMismatch: Story = {\n   args: {\n-    firstContent: 'Server rendered content',\n-    secondContent: 'Client rendered content',\n-    hydrationMismatchType: 'text',\n     reactOutputComponentDiff: undefined,\n   },\n }\n \n export const TextInTagMismatch: Story = {\n   args: {\n-    firstContent: 'Mismatched content',\n-    secondContent: 'p',\n-    hydrationMismatchType: 'text-in-tag',\n     reactOutputComponentDiff: undefined,\n   },\n }\n \n export const ReactUnifiedMismatch: Story = {\n   args: {\n-    hydrationMismatchType: 'tag',\n     reactOutputComponentDiff: `<Page>\n   <Layout>\n     <div>"
        },
        {
            "sha": "e4882eadea3b987ac3c99ec35fac8e16fb11ad06",
            "filename": "packages/next/src/client/components/react-dev-overlay/utils/parse-stack.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Fparse-stack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e447f04f4e47d85744d63be70f4cb9d8e1035a/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Fparse-stack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Futils%2Fparse-stack.ts?ref=f5e447f04f4e47d85744d63be70f4cb9d8e1035a",
            "patch": "@@ -1,21 +1,10 @@\n import { parse } from 'next/dist/compiled/stacktrace-parser'\n import type { StackFrame } from 'next/dist/compiled/stacktrace-parser'\n-import {\n-  getHydrationErrorStackInfo,\n-  isReactHydrationErrorMessage,\n-} from '../../is-hydration-error'\n \n const regexNextStatic = /\\/_next(\\/static\\/.+)/\n \n export function parseStack(stack: string | undefined): StackFrame[] {\n   if (!stack) return []\n-  const messageAndStack = stack.replace(/^Error: /, '')\n-  if (isReactHydrationErrorMessage(messageAndStack)) {\n-    const { stack: parsedStack } = getHydrationErrorStackInfo(messageAndStack)\n-    if (parsedStack) {\n-      stack = parsedStack\n-    }\n-  }\n \n   // throw away eval information that stacktrace-parser doesn't support\n   // adapted from https://github.com/stacktracejs/error-stack-parser/blob/9f33c224b5d7b607755eb277f9d51fcdb7287e24/error-stack-parser.js#L59C33-L59C62"
        }
    ],
    "stats": {
        "total": 73,
        "additions": 7,
        "deletions": 66
    }
}