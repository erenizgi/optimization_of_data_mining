{
    "author": "huozhi",
    "message": "[segment explorer] reset error and not-found boundary (#81115)\n\n### Description\r\n\r\nAdd a `key` prop to the segment state boundary and change the key when we call reset, this way it will force the children re-render with the new state where the boundaries will get reset and the simulated error will be gone since we're rendering the page component now.\r\n\r\nReseting the error boundary only won't help, it will still get the error from `getDerivedStateFromError` class method and apply to the state. This approach will reset the state group of layout-router, and ensure we keep rendering the page segment (or anything by default).\r\n\r\n### Video\r\n\r\nhttps://github.com/user-attachments/assets/f6fc21da-abc1-41fc-857f-136a203f6039\r\n\r\n\r\nCloses NEXT-4583",
    "sha": "c6343db71ee1afd3cb29c805443fcf4152d9eccb",
    "files": [
        {
            "sha": "b15e910b6ebc61122b9fcc48a3119f4b1264b4e6",
            "filename": "packages/next/src/next-devtools/userspace/app/segment-explorer-node.tsx",
            "status": "modified",
            "additions": 28,
            "deletions": 2,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/c6343db71ee1afd3cb29c805443fcf4152d9eccb/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fsegment-explorer-node.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c6343db71ee1afd3cb29c805443fcf4152d9eccb/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fsegment-explorer-node.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fsegment-explorer-node.tsx?ref=c6343db71ee1afd3cb29c805443fcf4152d9eccb",
            "patch": "@@ -1,7 +1,14 @@\n 'use client'\n \n import type { ReactNode } from 'react'\n-import { useState, createContext, useContext, use, useMemo } from 'react'\n+import {\n+  useState,\n+  createContext,\n+  useContext,\n+  use,\n+  useMemo,\n+  useCallback,\n+} from 'react'\n import { useLayoutEffect } from 'react'\n import { dispatcher } from 'next/dist/compiled/next-devtools'\n import { notFound } from '../../../client/components/not-found'\n@@ -117,8 +124,27 @@ export function SegmentStateProvider({ children }: { children: ReactNode }) {\n     'not-found' | 'error' | 'loading' | null\n   >(null)\n \n+  const [errorBoundaryKey, setErrorBoundaryKey] = useState(0)\n+  const reloadBoundary = useCallback(\n+    () => setErrorBoundaryKey((prev) => prev + 1),\n+    []\n+  )\n+\n+  const setBoundaryTypeAndReload = useCallback(\n+    (type: 'not-found' | 'error' | 'loading' | null) => {\n+      if (type === null) {\n+        reloadBoundary()\n+      }\n+      setBoundaryType(type)\n+    },\n+    [reloadBoundary]\n+  )\n+\n   return (\n-    <SegmentStateContext.Provider value={{ boundaryType, setBoundaryType }}>\n+    <SegmentStateContext.Provider\n+      key={errorBoundaryKey}\n+      value={{ boundaryType, setBoundaryType: setBoundaryTypeAndReload }}\n+    >\n       {children}\n     </SegmentStateContext.Provider>\n   )"
        }
    ],
    "stats": {
        "total": 30,
        "additions": 28,
        "deletions": 2
    }
}