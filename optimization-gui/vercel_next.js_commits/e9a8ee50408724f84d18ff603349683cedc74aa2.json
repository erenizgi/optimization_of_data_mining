{
    "author": "devjiwonchoi",
    "message": "Update  codemod ESLint template to Flat config (#84919)\n\nStacked on https://github.com/vercel/next.js/pull/84874\n\n### Why?\n\nAs `eslint-config-next` supports Flat config since PR\nhttps://github.com/vercel/next.js/pull/84874, Release\n[v16.0.0-canary.6](https://github.com/vercel/next.js/releases/tag/v16.0.0-canary.6),\nupdate codemod to use Flat config. Since `eslint-config-next` version\nand this codemod's version will match, no need to gate the version, as\nby the time this change is released, the same `eslint-config-next`\nversion will support Flat config.\n\n### How?\n\nUpdated to handle the three cases:\n\n- Legacy config\n- Flat config with FlatCompat (Which we used to recommend for v15)\n- Flat config with no FlatCompat (Which means the app does not use\n`eslint-config-next`)\n\nFor the Legacy config, ESLint provides a [Migration\ntool](https://eslint.org/docs/latest/use/configure/migration-guide), so\nuse that to convert to Flat config. It will include FlatCompat, so the\nrest of the process is the same as Flat config with FlatCompat.\n\nFor the Flat config with FlatCompat, the codemod will remove FlatCompat\nand map the `eslint-config-next` imports directly to the export.\n\nFor the Flat config with no FlatCompat, the codemod will import\n`eslint-config-next` and map the imports directly to the export.\n\nTested on\n[shadcn/ui](https://github.com/shadcn-ui/ui/blob/cb769b7059b50b5dca033a6eb57bb8ecde69fc87/.eslintrc.json)\nand other large legacy ESLint configs.",
    "sha": "e9a8ee50408724f84d18ff603349683cedc74aa2",
    "files": [
        {
            "sha": "900a214d41ff2c011bf7b2d7c7e38e3ccb0f59de",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/basic.input.json",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fbasic.input.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fbasic.input.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fbasic.input.json?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,22 +0,0 @@\n-{\n-  \"name\": \"my-app\",\n-  \"version\": \"0.1.0\",\n-  \"private\": true,\n-  \"scripts\": {\n-    \"dev\": \"next dev\",\n-    \"build\": \"next build\",\n-    \"start\": \"next start\",\n-    \"lint\": \"next lint\"\n-  },\n-  \"dependencies\": {\n-    \"react\": \"^18.3.0\",\n-    \"react-dom\": \"^18.3.0\",\n-    \"next\": \"15.0.0\"\n-  },\n-  \"devDependencies\": {\n-    \"typescript\": \"^5\",\n-    \"@types/node\": \"^20\",\n-    \"@types/react\": \"^19\",\n-    \"@types/react-dom\": \"^19\"\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "756e91e079a4d4a288f5cb12d53ffa36038cc0cb",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/basic.output.json",
            "status": "removed",
            "additions": 0,
            "deletions": 25,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fbasic.output.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fbasic.output.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fbasic.output.json?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,25 +0,0 @@\n-{\n-  \"name\": \"my-app\",\n-  \"version\": \"0.1.0\",\n-  \"private\": true,\n-  \"scripts\": {\n-    \"dev\": \"next dev\",\n-    \"build\": \"next build\",\n-    \"start\": \"next start\",\n-    \"lint\": \"eslint .\"\n-  },\n-  \"dependencies\": {\n-    \"react\": \"^18.3.0\",\n-    \"react-dom\": \"^18.3.0\",\n-    \"next\": \"15.0.0\"\n-  },\n-  \"devDependencies\": {\n-    \"typescript\": \"^5\",\n-    \"@types/node\": \"^20\",\n-    \"@types/react\": \"^19\",\n-    \"@types/react-dom\": \"^19\",\n-    \"eslint\": \"^9\",\n-    \"eslint-config-next\": \"15.0.0\",\n-    \"@eslint/eslintrc\": \"^3\"\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "876834061d5fb3a4ad4f1d1942c8383ecea0b25a",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/cjs-flat-config.eslint.cjs",
            "status": "removed",
            "additions": 0,
            "deletions": 8,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fcjs-flat-config.eslint.cjs",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fcjs-flat-config.eslint.cjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fcjs-flat-config.eslint.cjs?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,8 +0,0 @@\n-module.exports = [\n-  {\n-    rules: {\n-      \"quotes\": [\"error\", \"double\"],\n-      \"indent\": [\"error\", 2]\n-    }\n-  }\n-]\n\\ No newline at end of file"
        },
        {
            "sha": "b9d89b51290241b6d7f0072dcf226010504f2a50",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/complex-scripts.output.json",
            "status": "removed",
            "additions": 0,
            "deletions": 23,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fcomplex-scripts.output.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fcomplex-scripts.output.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fcomplex-scripts.output.json?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,23 +0,0 @@\n-{\n-  \"name\": \"complex-scripts-app\",\n-  \"version\": \"1.0.0\",\n-  \"scripts\": {\n-    \"lint\": \"eslint --fix src pages\",\n-    \"lint:strict\": \"eslint --max-warnings 0 .\",\n-    \"lint:ci\": \"eslint --quiet --output-file lint-results.json .\",\n-    \"precommit\": \"eslint --fix . && npm test\",\n-    \"test\": \"jest && eslint .\",\n-    \"complex\": \"npm run build && eslint . 2>/dev/null\",\n-    \"pipe\": \"eslint . | tee lint.log\",\n-    \"redirect\": \"eslint . > output.txt 2>&1\",\n-    \"multi\": \"eslint .; next build; eslint --fix .\"\n-  },\n-  \"dependencies\": {\n-    \"next\": \"15.0.0\"\n-  },\n-  \"devDependencies\": {\n-    \"eslint\": \"^9\",\n-    \"eslint-config-next\": \"15.0.0\",\n-    \"@eslint/eslintrc\": \"^3\"\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "6ded3a87ff84a2c1ef9399742da9ef4878f7397a",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/existing-eslint.input.json",
            "status": "removed",
            "additions": 0,
            "deletions": 20,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-eslint.input.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-eslint.input.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-eslint.input.json?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,20 +0,0 @@\n-{\n-  \"name\": \"my-app\",\n-  \"version\": \"0.1.0\",\n-  \"private\": true,\n-  \"scripts\": {\n-    \"dev\": \"next dev\",\n-    \"build\": \"next build\",\n-    \"start\": \"next start\",\n-    \"lint\": \"next lint\"\n-  },\n-  \"dependencies\": {\n-    \"react\": \"^18.3.0\",\n-    \"react-dom\": \"^18.3.0\",\n-    \"next\": \"15.0.0\"\n-  },\n-  \"devDependencies\": {\n-    \"eslint\": \"^8.0.0\",\n-    \"eslint-config-next\": \"15.0.0\"\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "a5b1d67f613c9d43748d43b4c6f339dcb3650e81",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/existing-eslint.output.json",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-eslint.output.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-eslint.output.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-eslint.output.json?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,21 +0,0 @@\n-{\n-  \"name\": \"my-app\",\n-  \"version\": \"0.1.0\",\n-  \"private\": true,\n-  \"scripts\": {\n-    \"dev\": \"next dev\",\n-    \"build\": \"next build\",\n-    \"start\": \"next start\",\n-    \"lint\": \"eslint .\"\n-  },\n-  \"dependencies\": {\n-    \"react\": \"^18.3.0\",\n-    \"react-dom\": \"^18.3.0\",\n-    \"next\": \"15.0.0\"\n-  },\n-  \"devDependencies\": {\n-    \"eslint\": \"^8.0.0\",\n-    \"eslint-config-next\": \"15.0.0\",\n-    \"@eslint/eslintrc\": \"^3\"\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "61b68fdabe9ce136ff0277802525742f0444840b",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/existing-flat-config.eslint.js",
            "status": "removed",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-flat-config.eslint.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-flat-config.eslint.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-flat-config.eslint.js?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,14 +0,0 @@\n-export default [\n-  {\n-    rules: {\n-      \"no-console\": \"warn\",\n-      \"semi\": [\"error\", \"always\"]\n-    }\n-  },\n-  {\n-    files: [\"**/*.test.js\"],\n-    rules: {\n-      \"no-console\": \"off\"\n-    }\n-  }\n-]\n\\ No newline at end of file"
        },
        {
            "sha": "4e6cb6a0b2bd104429d2766a35e6287b42f130e0",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/existing-flat-config.input.json",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-flat-config.input.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-flat-config.input.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-flat-config.input.json?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,11 +0,0 @@\n-{\n-  \"name\": \"app-with-flat-config\",\n-  \"version\": \"1.0.0\",\n-  \"scripts\": {\n-    \"lint\": \"next lint\",\n-    \"lint:fix\": \"next lint --fix\"\n-  },\n-  \"dependencies\": {\n-    \"next\": \"15.0.0\"\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "f0ec2aaf2708726155029db51ab508d51a9e2a41",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/existing-flat-config.output.json",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-flat-config.output.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-flat-config.output.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-flat-config.output.json?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,16 +0,0 @@\n-{\n-  \"name\": \"app-with-flat-config\",\n-  \"version\": \"1.0.0\",\n-  \"scripts\": {\n-    \"lint\": \"eslint .\",\n-    \"lint:fix\": \"eslint --fix .\"\n-  },\n-  \"dependencies\": {\n-    \"next\": \"15.0.0\"\n-  },\n-  \"devDependencies\": {\n-    \"eslint\": \"^9\",\n-    \"eslint-config-next\": \"15.0.0\",\n-    \"@eslint/eslintrc\": \"^3\"\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "21c14eabaf6c89865455db0cafb261b6022b36be",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/existing-ignores.eslint.js",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-ignores.eslint.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-ignores.eslint.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fexisting-ignores.eslint.js?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,10 +0,0 @@\n-export default [\n-  {\n-    ignores: [\"dist/**\", \"coverage/**\"]\n-  },\n-  {\n-    rules: {\n-      \"no-unused-vars\": \"warn\"\n-    }\n-  }\n-]\n\\ No newline at end of file"
        },
        {
            "sha": "d60a2cac9c568d4426d280616bfba059190bf75c",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/flat-config-flat-compat/eslint.config.mjs",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config-flat-compat%2Feslint.config.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config-flat-compat%2Feslint.config.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config-flat-compat%2Feslint.config.mjs?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -0,0 +1,25 @@\n+import { dirname } from 'path'\n+import { fileURLToPath } from 'url'\n+import { FlatCompat } from '@eslint/eslintrc'\n+\n+const __filename = fileURLToPath(import.meta.url)\n+const __dirname = dirname(__filename)\n+\n+const compat = new FlatCompat({\n+  baseDirectory: __dirname,\n+})\n+\n+const eslintConfig = [\n+  ...compat.extends('next/core-web-vitals', 'next/typescript'),\n+  {\n+    ignores: [\n+      'node_modules/**',\n+      '.next/**',\n+      'out/**',\n+      'build/**',\n+      'next-env.d.ts',\n+    ],\n+  },\n+]\n+\n+export default eslintConfig"
        },
        {
            "sha": "0c8f6fafba8a7048eddf4b85eb98b0a08f48d12a",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/flat-config-flat-compat/package.json",
            "status": "renamed",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config-flat-compat%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config-flat-compat%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config-flat-compat%2Fpackage.json?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -1,6 +1,4 @@\n {\n-  \"name\": \"complex-scripts-app\",\n-  \"version\": \"1.0.0\",\n   \"scripts\": {\n     \"lint\": \"next lint --fix --dir src --dir pages\",\n     \"lint:strict\": \"next lint --strict\",\n@@ -13,6 +11,16 @@\n     \"multi\": \"next lint; next build; next lint --fix\"\n   },\n   \"dependencies\": {\n-    \"next\": \"15.0.0\"\n+    \"react\": \"^19\",\n+    \"react-dom\": \"^19\",\n+    \"next\": \"^16\"\n+  },\n+  \"devDependencies\": {\n+    \"typescript\": \"^5\",\n+    \"@types/node\": \"^20\",\n+    \"@types/react\": \"^19\",\n+    \"@types/react-dom\": \"^19\",\n+    \"eslint\": \"^9\",\n+    \"eslint-config-next\": \"^16\"\n   }\n-}\n\\ No newline at end of file\n+}",
            "previous_filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/complex-scripts.input.json"
        },
        {
            "sha": "627c1d80fa5a4362290119bc7c7d0d3720c25a06",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/flat-config/eslint.config.mjs",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config%2Feslint.config.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config%2Feslint.config.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config%2Feslint.config.mjs?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -0,0 +1,19 @@\n+import { defineConfig } from 'eslint/config'\n+import foo from 'foo'\n+import bar from 'bar'\n+\n+const eslintConfig = defineConfig([\n+  foo,\n+  bar,\n+  {\n+    ignores: [\n+      'node_modules/**',\n+      '.next/**',\n+      'out/**',\n+      'build/**',\n+      'next-env.d.ts',\n+    ],\n+  },\n+])\n+\n+export default eslintConfig"
        },
        {
            "sha": "0c8f6fafba8a7048eddf4b85eb98b0a08f48d12a",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/flat-config/package.json",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config%2Fpackage.json?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -0,0 +1,26 @@\n+{\n+  \"scripts\": {\n+    \"lint\": \"next lint --fix --dir src --dir pages\",\n+    \"lint:strict\": \"next lint --strict\",\n+    \"lint:ci\": \"next lint --quiet --output-file lint-results.json\",\n+    \"precommit\": \"next lint --fix && npm test\",\n+    \"test\": \"jest && next lint\",\n+    \"complex\": \"npm run build && next lint --dir . --ext .js,.jsx,.ts,.tsx 2>/dev/null\",\n+    \"pipe\": \"next lint | tee lint.log\",\n+    \"redirect\": \"next lint > output.txt 2>&1\",\n+    \"multi\": \"next lint; next build; next lint --fix\"\n+  },\n+  \"dependencies\": {\n+    \"react\": \"^19\",\n+    \"react-dom\": \"^19\",\n+    \"next\": \"^16\"\n+  },\n+  \"devDependencies\": {\n+    \"typescript\": \"^5\",\n+    \"@types/node\": \"^20\",\n+    \"@types/react\": \"^19\",\n+    \"@types/react-dom\": \"^19\",\n+    \"eslint\": \"^9\",\n+    \"eslint-config-next\": \"^16\"\n+  }\n+}"
        },
        {
            "sha": "9e26dfeeb6e641a33dae4961196235bdb965b21b",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/flat-config/tsconfig.json",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fflat-config%2Ftsconfig.json?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -0,0 +1 @@\n+{}\n\\ No newline at end of file"
        },
        {
            "sha": "180318cdf1f90c3c5a5abe550579ae39a124fb3f",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/legacy-config/.eslintignore",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2F.eslintignore",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2F.eslintignore",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2F.eslintignore?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -0,0 +1,6 @@\n+node_modules/**\n+.next/**\n+out/**\n+build/**\n+next-env.d.ts\n+**/*.md\n\\ No newline at end of file"
        },
        {
            "sha": "ba93ef2ed037bcd9480aaa033d11c2a4d1d9a2f6",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/legacy-config/.eslintrc.json",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2F.eslintrc.json",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2F.eslintrc.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2F.eslintrc.json?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -0,0 +1,32 @@\n+{\n+  \"$schema\": \"https://json.schemastore.org/eslintrc\",\n+  \"root\": true,\n+  \"extends\": [\n+    \"next/core-web-vitals\",\n+    \"turbo\",\n+    \"prettier\",\n+    \"plugin:tailwindcss/recommended\"\n+  ],\n+  \"plugins\": [\"tailwindcss\"],\n+  \"ignorePatterns\": [\"**/fixtures/**\"],\n+  \"rules\": {\n+    \"@next/next/no-html-link-for-pages\": \"off\",\n+    \"tailwindcss/no-custom-classname\": \"off\",\n+    \"tailwindcss/classnames-order\": \"error\"\n+  },\n+  \"settings\": {\n+    \"tailwindcss\": {\n+      \"callees\": [\"cn\", \"cva\"],\n+      \"config\": \"tailwind.config.cjs\"\n+    },\n+    \"next\": {\n+      \"rootDir\": [\"apps/*/\"]\n+    }\n+  },\n+  \"overrides\": [\n+    {\n+      \"files\": [\"*.ts\", \"*.tsx\"],\n+      \"parser\": \"@typescript-eslint/parser\"\n+    }\n+  ]\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "0c8f6fafba8a7048eddf4b85eb98b0a08f48d12a",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/legacy-config/package.json",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Flegacy-config%2Fpackage.json?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -0,0 +1,26 @@\n+{\n+  \"scripts\": {\n+    \"lint\": \"next lint --fix --dir src --dir pages\",\n+    \"lint:strict\": \"next lint --strict\",\n+    \"lint:ci\": \"next lint --quiet --output-file lint-results.json\",\n+    \"precommit\": \"next lint --fix && npm test\",\n+    \"test\": \"jest && next lint\",\n+    \"complex\": \"npm run build && next lint --dir . --ext .js,.jsx,.ts,.tsx 2>/dev/null\",\n+    \"pipe\": \"next lint | tee lint.log\",\n+    \"redirect\": \"next lint > output.txt 2>&1\",\n+    \"multi\": \"next lint; next build; next lint --fix\"\n+  },\n+  \"dependencies\": {\n+    \"react\": \"^19\",\n+    \"react-dom\": \"^19\",\n+    \"next\": \"^16\"\n+  },\n+  \"devDependencies\": {\n+    \"typescript\": \"^5\",\n+    \"@types/node\": \"^20\",\n+    \"@types/react\": \"^19\",\n+    \"@types/react-dom\": \"^19\",\n+    \"eslint\": \"^9\",\n+    \"eslint-config-next\": \"^16\"\n+  }\n+}"
        },
        {
            "sha": "b321d83ddd60e11266a13cdfbbc37284cf39fc3e",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/no-scripts.input.json",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fno-scripts.input.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fno-scripts.input.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fno-scripts.input.json?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,7 +0,0 @@\n-{\n-  \"name\": \"app-without-scripts\",\n-  \"version\": \"1.0.0\",\n-  \"dependencies\": {\n-    \"next\": \"15.0.0\"\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "5debaf9f0228ef4d3ffe82829c5f2731114704d8",
            "filename": "packages/next-codemod/transforms/__testfixtures__/next-lint-to-eslint-cli/no-scripts.output.json",
            "status": "removed",
            "additions": 0,
            "deletions": 13,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fno-scripts.output.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c525e1395bed512bbbba90888f3f56a6138d3fa0/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fno-scripts.output.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__testfixtures__%2Fnext-lint-to-eslint-cli%2Fno-scripts.output.json?ref=c525e1395bed512bbbba90888f3f56a6138d3fa0",
            "patch": "@@ -1,13 +0,0 @@\n-{\n-  \"name\": \"app-without-scripts\",\n-  \"version\": \"1.0.0\",\n-  \"scripts\": {},\n-  \"dependencies\": {\n-    \"next\": \"15.0.0\"\n-  },\n-  \"devDependencies\": {\n-    \"eslint\": \"^9\",\n-    \"eslint-config-next\": \"15.0.0\",\n-    \"@eslint/eslintrc\": \"^3\"\n-  }\n-}\n\\ No newline at end of file"
        },
        {
            "sha": "b410d89503c5d7baf045f798e8b628e8b93f0da8",
            "filename": "packages/next-codemod/transforms/__tests__/next-lint-to-eslint-cli.test.js",
            "status": "modified",
            "additions": 491,
            "deletions": 474,
            "changes": 965,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__tests__%2Fnext-lint-to-eslint-cli.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2F__tests__%2Fnext-lint-to-eslint-cli.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2F__tests__%2Fnext-lint-to-eslint-cli.test.js?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -1,491 +1,508 @@\n-/* global jest */\n-jest.autoMockOff()\n const fs = require('fs')\n const path = require('path')\n-const { tmpdir } = require('os')\n-const transformer = require('../next-lint-to-eslint-cli').default\n+const os = require('os')\n \n describe('next-lint-to-eslint-cli', () => {\n-  let tempDir\n-\n-  beforeEach(() => {\n-    // Create a unique temp directory for each test\n-    tempDir = fs.mkdtempSync(path.join(tmpdir(), 'codemod-test-'))\n-  })\n-\n-  afterEach(() => {\n-    // Clean up temp directory\n-    if (tempDir && fs.existsSync(tempDir)) {\n-      fs.rmSync(tempDir, { recursive: true, force: true })\n-    }\n-  })\n-\n-  test('transforms correctly using basic data', () => {\n-    // Read input fixture\n-    const inputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/basic.input.json')\n-    const expectedOutputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/basic.output.json')\n-    \n-    const inputContent = fs.readFileSync(inputPath, 'utf8')\n-    const expectedOutput = fs.readFileSync(expectedOutputPath, 'utf8')\n-\n-    // Set up test project\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    const tsConfigPath = path.join(tempDir, 'tsconfig.json')\n-    \n-    fs.writeFileSync(packageJsonPath, inputContent)\n-    fs.writeFileSync(tsConfigPath, '{}') // Create tsconfig.json to indicate TypeScript project\n-\n-    // Run transformer\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    // Check package.json was updated correctly\n-    const actualPackageJson = fs.readFileSync(packageJsonPath, 'utf8')\n-    expect(JSON.parse(actualPackageJson)).toEqual(JSON.parse(expectedOutput))\n-\n-    // Check eslint.config.mjs was created\n-    const eslintConfigPath = path.join(tempDir, 'eslint.config.mjs')\n-    expect(fs.existsSync(eslintConfigPath)).toBe(true)\n-    \n-    const eslintConfig = fs.readFileSync(eslintConfigPath, 'utf8')\n-    expect(eslintConfig).toContain('next/core-web-vitals')\n-    expect(eslintConfig).toContain('next/typescript')\n-    expect(eslintConfig).toContain('ignores:')\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-  })\n-\n-  test('transforms correctly using existing-eslint data', () => {\n-    // Read input fixture\n-    const inputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/existing-eslint.input.json')\n-    const expectedOutputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/existing-eslint.output.json')\n-    \n-    const inputContent = fs.readFileSync(inputPath, 'utf8')\n-    const expectedOutput = fs.readFileSync(expectedOutputPath, 'utf8')\n-\n-    // Set up test project\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    const existingEslintPath = path.join(tempDir, '.eslintrc.json')\n-    \n-    fs.writeFileSync(packageJsonPath, inputContent)\n-    fs.writeFileSync(existingEslintPath, '{\"extends\": [\"next\"]}') // Create existing ESLint config\n-\n-    // Run transformer\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    // Check package.json was updated correctly\n-    const actualPackageJson = fs.readFileSync(packageJsonPath, 'utf8')\n-    expect(JSON.parse(actualPackageJson)).toEqual(JSON.parse(expectedOutput))\n-\n-    // Check that no new eslint.config.mjs was created (existing config should be preserved)\n-    const eslintConfigPath = path.join(tempDir, 'eslint.config.mjs')\n-    expect(fs.existsSync(eslintConfigPath)).toBe(false)\n-\n-    // Check that existing config still exists\n-    expect(fs.existsSync(existingEslintPath)).toBe(true)\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-  })\n-\n-  test('handles complex script patterns correctly', () => {\n-    const inputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/complex-scripts.input.json')\n-    const expectedOutputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/complex-scripts.output.json')\n-    \n-    const inputContent = fs.readFileSync(inputPath, 'utf8')\n-    const expectedOutput = fs.readFileSync(expectedOutputPath, 'utf8')\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    fs.writeFileSync(packageJsonPath, inputContent)\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    const actualPackageJson = fs.readFileSync(packageJsonPath, 'utf8')\n-    expect(JSON.parse(actualPackageJson)).toEqual(JSON.parse(expectedOutput))\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-  })\n-\n-  test('updates existing ES module flat config with AST manipulation', () => {\n-    const inputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/existing-flat-config.input.json')\n-    const expectedOutputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/existing-flat-config.output.json')\n-    const eslintConfigFixture = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/existing-flat-config.eslint.js')\n-    \n-    const inputContent = fs.readFileSync(inputPath, 'utf8')\n-    const expectedOutput = fs.readFileSync(expectedOutputPath, 'utf8')\n-    const eslintConfigContent = fs.readFileSync(eslintConfigFixture, 'utf8')\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    const eslintConfigPath = path.join(tempDir, 'eslint.config.js')\n-    \n-    fs.writeFileSync(packageJsonPath, inputContent)\n-    fs.writeFileSync(eslintConfigPath, eslintConfigContent)\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    // Check package.json was updated\n-    const actualPackageJson = fs.readFileSync(packageJsonPath, 'utf8')\n-    expect(JSON.parse(actualPackageJson)).toEqual(JSON.parse(expectedOutput))\n-\n-    // Check that existing config was updated with Next.js configs\n-    const updatedConfig = fs.readFileSync(eslintConfigPath, 'utf8')\n-    expect(updatedConfig).toContain('FlatCompat')\n-    expect(updatedConfig).toContain('next/core-web-vitals')\n-    expect(updatedConfig).toContain('no-console') // Original rule should be preserved\n-    expect(updatedConfig).toContain('semi') // Original rule should be preserved\n-    expect(updatedConfig).toContain('ignores') // Should add ignores section\n-    expect(updatedConfig).toContain('.next/**') // Should include Next.js build directory\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-  })\n-\n-  test('updates existing CommonJS flat config with AST manipulation', () => {\n-    const inputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/existing-flat-config.input.json')\n-    const expectedOutputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/existing-flat-config.output.json')\n-    const eslintConfigFixture = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/cjs-flat-config.eslint.cjs')\n-    \n-    const inputContent = fs.readFileSync(inputPath, 'utf8')\n-    const expectedOutput = fs.readFileSync(expectedOutputPath, 'utf8')\n-    const eslintConfigContent = fs.readFileSync(eslintConfigFixture, 'utf8')\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    const eslintConfigPath = path.join(tempDir, 'eslint.config.cjs')\n-    \n-    fs.writeFileSync(packageJsonPath, inputContent)\n-    fs.writeFileSync(eslintConfigPath, eslintConfigContent)\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    // Check package.json was updated\n-    const actualPackageJson = fs.readFileSync(packageJsonPath, 'utf8')\n-    expect(JSON.parse(actualPackageJson)).toEqual(JSON.parse(expectedOutput))\n-\n-    // Check that existing config was updated with Next.js configs\n-    const updatedConfig = fs.readFileSync(eslintConfigPath, 'utf8')\n-    expect(updatedConfig).toContain('FlatCompat')\n-    expect(updatedConfig).toContain('require')\n-    expect(updatedConfig).toContain('next/core-web-vitals')\n-    expect(updatedConfig).toContain('quotes') // Original rule should be preserved\n-    expect(updatedConfig).toContain('indent') // Original rule should be preserved\n-    expect(updatedConfig).toContain('ignores') // Should add ignores section\n-    expect(updatedConfig).toContain('node_modules/**') // Should include common ignores\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-  })\n-\n-  test('handles package.json without scripts section', () => {\n-    const inputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/no-scripts.input.json')\n-    const expectedOutputPath = path.join(__dirname, '../__testfixtures__/next-lint-to-eslint-cli/no-scripts.output.json')\n-    \n-    const inputContent = fs.readFileSync(inputPath, 'utf8')\n-    const expectedOutput = fs.readFileSync(expectedOutputPath, 'utf8')\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    fs.writeFileSync(packageJsonPath, inputContent)\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    // Check package.json was updated with dependencies only\n-    const actualPackageJson = fs.readFileSync(packageJsonPath, 'utf8')\n-    expect(JSON.parse(actualPackageJson)).toEqual(JSON.parse(expectedOutput))\n-\n-    // Check that eslint.config.mjs was created\n-    const eslintConfigPath = path.join(tempDir, 'eslint.config.mjs')\n-    expect(fs.existsSync(eslintConfigPath)).toBe(true)\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-  })\n-\n-  test('preserves existing eslint dependencies', () => {\n-    const packageJson = {\n-      name: 'app-with-eslint',\n-      scripts: {\n-        lint: 'next lint'\n-      },\n-      dependencies: {\n-        next: '15.0.0'\n-      },\n-      devDependencies: {\n-        eslint: '^8.57.0',\n-        'eslint-config-next': '14.2.0'\n-      }\n-    }\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2))\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    const actualPackageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'))\n-    \n-    // Should preserve existing eslint versions\n-    expect(actualPackageJson.devDependencies.eslint).toBe('^8.57.0')\n-    expect(actualPackageJson.devDependencies['eslint-config-next']).toBe('14.2.0')\n-    // Should add missing @eslint/eslintrc\n-    expect(actualPackageJson.devDependencies['@eslint/eslintrc']).toBe('^3')\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-  })\n-\n-  test('handles TypeScript config files', () => {\n-    const packageJson = {\n-      name: 'app-with-ts-config',\n-      scripts: {\n-        lint: 'next lint'\n-      },\n-      dependencies: {\n-        next: '15.0.0'\n-      }\n-    }\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    const eslintConfigPath = path.join(tempDir, 'eslint.config.ts')\n-    \n-    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2))\n-    fs.writeFileSync(eslintConfigPath, 'export default []')\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    const consoleWarnSpy = jest.spyOn(console, 'warn').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    // Should log that TypeScript configs require manual migration\n-    expect(consoleWarnSpy).toHaveBeenCalledWith(\n-      expect.anything(),\n-      expect.stringContaining('TypeScript config files require manual migration')\n+  let isolatedDir\n+  let transformer\n+  let fixturesDir\n+\n+  beforeAll(() => {\n+    // Create isolated directory ONCE\n+    const tmpBase = process.env.NEXT_TEST_DIR || os.tmpdir()\n+    isolatedDir = path.join(\n+      tmpBase,\n+      `next-lint-to-eslint-cli-test-${Date.now()}-${(Math.random() * 1000) | 0}`\n     )\n+    fs.mkdirSync(isolatedDir, { recursive: true })\n \n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-    consoleWarnSpy.mockRestore()\n-  })\n-\n-  test('handles missing package.json gracefully', () => {\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    expect(consoleErrorSpy).toHaveBeenCalledWith('Error: package.json not found in the specified directory')\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-  })\n-\n-  test('handles missing directory argument', () => {\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([], { skipInstall: true })\n-\n-    expect(consoleErrorSpy).toHaveBeenCalledWith('Error: Please specify a directory path')\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n-  })\n-\n-  test('creates JavaScript config for non-TypeScript projects', () => {\n-    const packageJson = {\n-      name: 'js-app',\n-      scripts: {\n-        lint: 'next lint'\n-      },\n-      dependencies: {\n-        next: '15.0.0',\n-        react: '^18.0.0'\n-      }\n-    }\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2))\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    // Check that eslint.config.mjs was created without TypeScript config\n-    const eslintConfigPath = path.join(tempDir, 'eslint.config.mjs')\n-    const eslintConfig = fs.readFileSync(eslintConfigPath, 'utf8')\n-    \n-    expect(eslintConfig).toContain('next/core-web-vitals')\n-    expect(eslintConfig).not.toContain('next/typescript')\n+    // Copy all fixtures ONCE\n+    fixturesDir = path.join(isolatedDir, 'fixtures')\n+    const fixturesSrc = path.join(\n+      __dirname,\n+      '../__testfixtures__/next-lint-to-eslint-cli'\n+    )\n+    fs.cpSync(fixturesSrc, fixturesDir, { recursive: true })\n \n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n+    // Load transformer from original location (has all dependencies)\n+    transformer = require('../next-lint-to-eslint-cli.js').default\n   })\n \n-  test('adds ignores even when Next.js configs are already present', () => {\n-    const existingConfig = `\n-import { FlatCompat } from \"@eslint/eslintrc\"\n-const compat = new FlatCompat({ baseDirectory: __dirname })\n-export default [\n-  ...compat.extends(\"next/core-web-vitals\"),\n-  { rules: { \"no-console\": \"warn\" } }\n-]`\n-\n-    const packageJson = {\n-      name: 'app-with-next-config',\n-      scripts: {\n-        lint: 'next lint'\n-      },\n-      dependencies: {\n-        next: '15.0.0'\n-      }\n+  afterAll(() => {\n+    // Clean up ONCE after all tests\n+    if (isolatedDir && fs.existsSync(isolatedDir)) {\n+      fs.rmSync(isolatedDir, { recursive: true, force: true })\n     }\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    const eslintConfigPath = path.join(tempDir, 'eslint.config.js')\n-    \n-    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2))\n-    fs.writeFileSync(eslintConfigPath, existingConfig)\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    // Should still add ignores even though Next.js configs are present\n-    const updatedConfig = fs.readFileSync(eslintConfigPath, 'utf8')\n-    expect(updatedConfig).toContain('ignores')\n-    expect(updatedConfig).toContain('.next/**')\n-    expect(updatedConfig).toContain('node_modules/**')\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n   })\n \n-  test('handles scripts with paths containing spaces', () => {\n-    const packageJson = {\n-      name: 'app-with-spaces',\n-      scripts: {\n-        lint: 'next lint --dir \"src/my components\" --file \"test file.js\"'\n-      },\n-      dependencies: {\n-        next: '15.0.0'\n-      }\n-    }\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2))\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    const actualPackageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'))\n-    expect(actualPackageJson.scripts.lint).toBe('eslint \"src/my components\" \"test file.js\"')\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n+  describe('flat-config', () => {\n+    it('should keep config unchanged and transform package.json', () => {\n+      const testDir = path.join(fixturesDir, 'flat-config')\n+      // Check BEFORE state\n+      const beforeConfig = fs.readFileSync(\n+        path.join(testDir, 'eslint.config.mjs'),\n+        'utf8'\n+      )\n+      const beforePackage = fs.readFileSync(\n+        path.join(testDir, 'package.json'),\n+        'utf8'\n+      )\n+\n+      expect(beforeConfig).toMatchInlineSnapshot(`\n+       \"import { defineConfig } from 'eslint/config'\n+       import foo from 'foo'\n+       import bar from 'bar'\n+\n+       const eslintConfig = defineConfig([\n+         foo,\n+         bar,\n+         {\n+           ignores: [\n+             'node_modules/**',\n+             '.next/**',\n+             'out/**',\n+             'build/**',\n+             'next-env.d.ts',\n+           ],\n+         },\n+       ])\n+\n+       export default eslintConfig\n+       \"\n+      `)\n+\n+      expect(beforePackage).toMatchInlineSnapshot(`\n+        \"{\n+          \"scripts\": {\n+            \"lint\": \"next lint --fix --dir src --dir pages\",\n+            \"lint:strict\": \"next lint --strict\",\n+            \"lint:ci\": \"next lint --quiet --output-file lint-results.json\",\n+            \"precommit\": \"next lint --fix && npm test\",\n+            \"test\": \"jest && next lint\",\n+            \"complex\": \"npm run build && next lint --dir . --ext .js,.jsx,.ts,.tsx 2>/dev/null\",\n+            \"pipe\": \"next lint | tee lint.log\",\n+            \"redirect\": \"next lint > output.txt 2>&1\",\n+            \"multi\": \"next lint; next build; next lint --fix\"\n+          },\n+          \"dependencies\": {\n+            \"react\": \"^19\",\n+            \"react-dom\": \"^19\",\n+            \"next\": \"^16\"\n+          },\n+          \"devDependencies\": {\n+            \"typescript\": \"^5\",\n+            \"@types/node\": \"^20\",\n+            \"@types/react\": \"^19\",\n+            \"@types/react-dom\": \"^19\",\n+            \"eslint\": \"^9\",\n+            \"eslint-config-next\": \"^16\"\n+          }\n+        }\n+        \"\n+      `)\n+\n+      // Run transformer\n+      transformer([testDir], { skipInstall: true })\n+\n+      // Check AFTER state\n+      const actualConfig = fs.readFileSync(\n+        path.join(testDir, 'eslint.config.mjs'),\n+        'utf8'\n+      )\n+      expect(actualConfig).toMatchInlineSnapshot(`\n+       \"import nextCoreWebVitals from \"eslint-config-next/core-web-vitals\";\n+       import nextTypescript from \"eslint-config-next/typescript\";\n+       import { defineConfig } from 'eslint/config'\n+       import foo from 'foo'\n+       import bar from 'bar'\n+\n+       const eslintConfig = defineConfig([...nextCoreWebVitals, ...nextTypescript, foo, bar, {\n+         ignores: [\n+           'node_modules/**',\n+           '.next/**',\n+           'out/**',\n+           'build/**',\n+           'next-env.d.ts',\n+         ],\n+       }])\n+\n+       export default eslintConfig\n+       \"\n+      `)\n+\n+      // Check package.json transformed\n+      const actualPackage = fs.readFileSync(\n+        path.join(testDir, 'package.json'),\n+        'utf8'\n+      )\n+      expect(actualPackage).toMatchInlineSnapshot(`\n+       \"{\n+         \"scripts\": {\n+           \"lint\": \"eslint --fix src pages\",\n+           \"lint:strict\": \"eslint --max-warnings 0 .\",\n+           \"lint:ci\": \"eslint --quiet --output-file lint-results.json .\",\n+           \"precommit\": \"eslint --fix . && npm test\",\n+           \"test\": \"jest && eslint .\",\n+           \"complex\": \"npm run build && eslint . 2>/dev/null\",\n+           \"pipe\": \"eslint . | tee lint.log\",\n+           \"redirect\": \"eslint . > output.txt 2>&1\",\n+           \"multi\": \"eslint .; next build; eslint --fix .\"\n+         },\n+         \"dependencies\": {\n+           \"react\": \"^19\",\n+           \"react-dom\": \"^19\",\n+           \"next\": \"^16\"\n+         },\n+         \"devDependencies\": {\n+           \"typescript\": \"^5\",\n+           \"@types/node\": \"^20\",\n+           \"@types/react\": \"^19\",\n+           \"@types/react-dom\": \"^19\",\n+           \"eslint\": \"^9\",\n+           \"eslint-config-next\": \"^16\"\n+         }\n+       }\n+       \"\n+      `)\n+    })\n   })\n \n-  test('does not duplicate ignores if already present', () => {\n-    const packageJson = {\n-      name: 'app-with-existing-ignores',\n-      scripts: {\n-        lint: 'next lint'\n-      },\n-      dependencies: {\n-        next: '15.0.0'\n-      }\n-    }\n-\n-    const existingConfig = `export default [\n-  {\n-    ignores: [\"dist/**\", \"coverage/**\"]\n-  },\n-  {\n-    rules: {\n-      \"no-unused-vars\": \"warn\"\n-    }\n-  }\n-]`\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    const eslintConfigPath = path.join(tempDir, 'eslint.config.js')\n-    \n-    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2))\n-    fs.writeFileSync(eslintConfigPath, existingConfig)\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    const updatedConfig = fs.readFileSync(eslintConfigPath, 'utf8')\n-    \n-    // Should add Next.js extends\n-    expect(updatedConfig).toContain('next/core-web-vitals')\n-    \n-    // Should preserve existing ignores\n-    expect(updatedConfig).toContain('dist/**')\n-    expect(updatedConfig).toContain('coverage/**')\n-    \n-    // Check that Next.js ignores are added to existing ignores\n-    expect(updatedConfig).toContain('.next/**') // Next.js build dir added\n-    expect(updatedConfig).toContain('node_modules/**') // Common ignore added\n-    \n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n+  describe('flat-config-flat-compat', () => {\n+    it('should replace FlatCompat with direct imports and transform package.json', () => {\n+      const testDir = path.join(fixturesDir, 'flat-config-flat-compat')\n+      // Check BEFORE state\n+      const beforeConfig = fs.readFileSync(\n+        path.join(testDir, 'eslint.config.mjs'),\n+        'utf8'\n+      )\n+      const beforePackage = fs.readFileSync(\n+        path.join(testDir, 'package.json'),\n+        'utf8'\n+      )\n+\n+      expect(beforeConfig).toMatchInlineSnapshot(`\n+       \"import { dirname } from 'path'\n+       import { fileURLToPath } from 'url'\n+       import { FlatCompat } from '@eslint/eslintrc'\n+\n+       const __filename = fileURLToPath(import.meta.url)\n+       const __dirname = dirname(__filename)\n+\n+       const compat = new FlatCompat({\n+         baseDirectory: __dirname,\n+       })\n+\n+       const eslintConfig = [\n+         ...compat.extends('next/core-web-vitals', 'next/typescript'),\n+         {\n+           ignores: [\n+             'node_modules/**',\n+             '.next/**',\n+             'out/**',\n+             'build/**',\n+             'next-env.d.ts',\n+           ],\n+         },\n+       ]\n+\n+       export default eslintConfig\n+       \"\n+      `)\n+\n+      expect(beforePackage).toMatchInlineSnapshot(`\n+        \"{\n+          \"scripts\": {\n+            \"lint\": \"next lint --fix --dir src --dir pages\",\n+            \"lint:strict\": \"next lint --strict\",\n+            \"lint:ci\": \"next lint --quiet --output-file lint-results.json\",\n+            \"precommit\": \"next lint --fix && npm test\",\n+            \"test\": \"jest && next lint\",\n+            \"complex\": \"npm run build && next lint --dir . --ext .js,.jsx,.ts,.tsx 2>/dev/null\",\n+            \"pipe\": \"next lint | tee lint.log\",\n+            \"redirect\": \"next lint > output.txt 2>&1\",\n+            \"multi\": \"next lint; next build; next lint --fix\"\n+          },\n+          \"dependencies\": {\n+            \"react\": \"^19\",\n+            \"react-dom\": \"^19\",\n+            \"next\": \"^16\"\n+          },\n+          \"devDependencies\": {\n+            \"typescript\": \"^5\",\n+            \"@types/node\": \"^20\",\n+            \"@types/react\": \"^19\",\n+            \"@types/react-dom\": \"^19\",\n+            \"eslint\": \"^9\",\n+            \"eslint-config-next\": \"^16\"\n+          }\n+        }\n+        \"\n+      `)\n+\n+      // Run transformer\n+      transformer([testDir], { skipInstall: true })\n+\n+      // Check AFTER state\n+      const actualConfig = fs.readFileSync(\n+        path.join(testDir, 'eslint.config.mjs'),\n+        'utf8'\n+      )\n+      expect(actualConfig).toMatchInlineSnapshot(`\n+       \"import nextCoreWebVitals from \"eslint-config-next/core-web-vitals\";\n+       import nextTypescript from \"eslint-config-next/typescript\";\n+       import { dirname } from 'path'\n+       import { fileURLToPath } from 'url'\n+\n+       const __filename = fileURLToPath(import.meta.url)\n+       const __dirname = dirname(__filename)\n+\n+       const eslintConfig = [...nextCoreWebVitals, ...nextTypescript, {\n+         ignores: [\n+           'node_modules/**',\n+           '.next/**',\n+           'out/**',\n+           'build/**',\n+           'next-env.d.ts',\n+         ],\n+       }]\n+\n+       export default eslintConfig\n+       \"\n+      `)\n+\n+      // Check package.json transformed\n+      const actualPackage = fs.readFileSync(\n+        path.join(testDir, 'package.json'),\n+        'utf8'\n+      )\n+      expect(actualPackage).toMatchInlineSnapshot(`\n+       \"{\n+         \"scripts\": {\n+           \"lint\": \"eslint --fix src pages\",\n+           \"lint:strict\": \"eslint --max-warnings 0 .\",\n+           \"lint:ci\": \"eslint --quiet --output-file lint-results.json .\",\n+           \"precommit\": \"eslint --fix . && npm test\",\n+           \"test\": \"jest && eslint .\",\n+           \"complex\": \"npm run build && eslint . 2>/dev/null\",\n+           \"pipe\": \"eslint . | tee lint.log\",\n+           \"redirect\": \"eslint . > output.txt 2>&1\",\n+           \"multi\": \"eslint .; next build; eslint --fix .\"\n+         },\n+         \"dependencies\": {\n+           \"react\": \"^19\",\n+           \"react-dom\": \"^19\",\n+           \"next\": \"^16\"\n+         },\n+         \"devDependencies\": {\n+           \"typescript\": \"^5\",\n+           \"@types/node\": \"^20\",\n+           \"@types/react\": \"^19\",\n+           \"@types/react-dom\": \"^19\",\n+           \"eslint\": \"^9\",\n+           \"eslint-config-next\": \"^16\"\n+         }\n+       }\n+       \"\n+      `)\n+    })\n   })\n \n-  test('handles unsupported flags with warnings', () => {\n-    const packageJson = {\n-      name: 'app-with-unsupported-flags',\n-      scripts: {\n-        lint: 'next lint --rulesdir ./custom-rules --ext .js,.jsx'\n-      },\n-      dependencies: {\n-        next: '15.0.0'\n-      }\n-    }\n-\n-    const packageJsonPath = path.join(tempDir, 'package.json')\n-    fs.writeFileSync(packageJsonPath, JSON.stringify(packageJson, null, 2))\n-\n-    const consoleSpy = jest.spyOn(console, 'log').mockImplementation(() => {})\n-    const consoleErrorSpy = jest.spyOn(console, 'error').mockImplementation(() => {})\n-    \n-    transformer([tempDir], { skipInstall: true })\n-\n-    // Should show warnings about unsupported flags\n-    expect(consoleSpy).toHaveBeenCalledWith(expect.stringContaining('--rulesdir is not supported in ESLint v9'))\n-    expect(consoleSpy).toHaveBeenCalledWith(expect.stringContaining('--ext is not needed in ESLint v9'))\n-\n-    // Script should be updated without the unsupported flags\n-    const actualPackageJson = JSON.parse(fs.readFileSync(packageJsonPath, 'utf8'))\n-    expect(actualPackageJson.scripts.lint).toBe('eslint .')\n-\n-    consoleSpy.mockRestore()\n-    consoleErrorSpy.mockRestore()\n+  describe('legacy-config', () => {\n+    it('should migrate legacy config to flat config and transform package.json', async () => {\n+      const testDir = path.join(fixturesDir, 'legacy-config')\n+      // Check BEFORE state\n+      const beforeEslintrc = fs.readFileSync(\n+        path.join(testDir, '.eslintrc.json'),\n+        'utf8'\n+      )\n+      const beforeEslintignore = fs.readFileSync(\n+        path.join(testDir, '.eslintignore'),\n+        'utf8'\n+      )\n+      const beforePackage = fs.readFileSync(\n+        path.join(testDir, 'package.json'),\n+        'utf8'\n+      )\n+\n+      expect(beforeEslintrc).toMatchInlineSnapshot(`\n+       \"{\n+         \"$schema\": \"https://json.schemastore.org/eslintrc\",\n+         \"root\": true,\n+         \"extends\": [\n+           \"next/core-web-vitals\",\n+           \"turbo\",\n+           \"prettier\",\n+           \"plugin:tailwindcss/recommended\"\n+         ],\n+         \"plugins\": [\"tailwindcss\"],\n+         \"ignorePatterns\": [\"**/fixtures/**\"],\n+         \"rules\": {\n+           \"@next/next/no-html-link-for-pages\": \"off\",\n+           \"tailwindcss/no-custom-classname\": \"off\",\n+           \"tailwindcss/classnames-order\": \"error\"\n+         },\n+         \"settings\": {\n+           \"tailwindcss\": {\n+             \"callees\": [\"cn\", \"cva\"],\n+             \"config\": \"tailwind.config.cjs\"\n+           },\n+           \"next\": {\n+             \"rootDir\": [\"apps/*/\"]\n+           }\n+         },\n+         \"overrides\": [\n+           {\n+             \"files\": [\"*.ts\", \"*.tsx\"],\n+             \"parser\": \"@typescript-eslint/parser\"\n+           }\n+         ]\n+       }\"\n+      `)\n+\n+      expect(beforeEslintignore).toMatchInlineSnapshot(`\n+        \"node_modules/**\n+        .next/**\n+        out/**\n+        build/**\n+        next-env.d.ts\n+        **/*.md\"\n+      `)\n+\n+      expect(beforePackage).toMatchInlineSnapshot(`\n+        \"{\n+          \"scripts\": {\n+            \"lint\": \"next lint --fix --dir src --dir pages\",\n+            \"lint:strict\": \"next lint --strict\",\n+            \"lint:ci\": \"next lint --quiet --output-file lint-results.json\",\n+            \"precommit\": \"next lint --fix && npm test\",\n+            \"test\": \"jest && next lint\",\n+            \"complex\": \"npm run build && next lint --dir . --ext .js,.jsx,.ts,.tsx 2>/dev/null\",\n+            \"pipe\": \"next lint | tee lint.log\",\n+            \"redirect\": \"next lint > output.txt 2>&1\",\n+            \"multi\": \"next lint; next build; next lint --fix\"\n+          },\n+          \"dependencies\": {\n+            \"react\": \"^19\",\n+            \"react-dom\": \"^19\",\n+            \"next\": \"^16\"\n+          },\n+          \"devDependencies\": {\n+            \"typescript\": \"^5\",\n+            \"@types/node\": \"^20\",\n+            \"@types/react\": \"^19\",\n+            \"@types/react-dom\": \"^19\",\n+            \"eslint\": \"^9\",\n+            \"eslint-config-next\": \"^16\"\n+          }\n+        }\n+        \"\n+      `)\n+\n+      // Run transformer (now async)\n+      await transformer([testDir], { skipInstall: true })\n+\n+      // Check AFTER state - eslint.config.mjs was created and transformed\n+      const actualConfig = fs.readFileSync(\n+        path.join(testDir, 'eslint.config.mjs'),\n+        'utf8'\n+      )\n+      expect(actualConfig).toMatchInlineSnapshot(`\n+       \"import { defineConfig, globalIgnores } from \"eslint/config\";\n+       import nextCoreWebVitals from \"eslint-config-next/core-web-vitals\";\n+       import tailwindcss from \"eslint-plugin-tailwindcss\";\n+       import tsParser from \"@typescript-eslint/parser\";\n+       import path from \"node:path\";\n+       import { fileURLToPath } from \"node:url\";\n+       import js from \"@eslint/js\";\n+       import { FlatCompat } from \"@eslint/eslintrc\";\n+\n+       const __filename = fileURLToPath(import.meta.url);\n+       const __dirname = path.dirname(__filename);\n+       const compat = new FlatCompat({\n+           baseDirectory: __dirname,\n+           recommendedConfig: js.configs.recommended,\n+           allConfig: js.configs.all\n+       });\n+\n+       export default defineConfig([globalIgnores([\n+           \"**/fixtures/**/*\",\n+           \"node_modules/**/*\",\n+           \".next/**/*\",\n+           \"out/**/*\",\n+           \"build/**/*\",\n+           \"**/next-env.d.ts\",\n+           \"**/*.md\",\n+       ]), {\n+           extends: [\n+               ...nextCoreWebVitals,\n+               ...compat.extends(\"turbo\"),\n+               ...compat.extends(\"prettier\"),\n+               ...compat.extends(\"plugin:tailwindcss/recommended\")\n+           ],\n+\n+           plugins: {\n+               tailwindcss,\n+           },\n+\n+           settings: {\n+               tailwindcss: {\n+                   callees: [\"cn\", \"cva\"],\n+                   config: \"tailwind.config.cjs\",\n+               },\n+\n+               next: {\n+                   rootDir: [\"apps/*/\"],\n+               },\n+           },\n+\n+           rules: {\n+               \"@next/next/no-html-link-for-pages\": \"off\",\n+               \"tailwindcss/no-custom-classname\": \"off\",\n+               \"tailwindcss/classnames-order\": \"error\",\n+           },\n+       }, {\n+           files: [\"**/*.ts\", \"**/*.tsx\"],\n+\n+           languageOptions: {\n+               parser: tsParser,\n+           },\n+       }]);\"\n+      `)\n+\n+      // Check package.json transformed\n+      const actualPackage = fs.readFileSync(\n+        path.join(testDir, 'package.json'),\n+        'utf8'\n+      )\n+      expect(actualPackage).toMatchInlineSnapshot(`\n+        \"{\n+          \"scripts\": {\n+            \"lint\": \"eslint --fix src pages\",\n+            \"lint:strict\": \"eslint --max-warnings 0 .\",\n+            \"lint:ci\": \"eslint --quiet --output-file lint-results.json .\",\n+            \"precommit\": \"eslint --fix . && npm test\",\n+            \"test\": \"jest && eslint .\",\n+            \"complex\": \"npm run build && eslint . 2>/dev/null\",\n+            \"pipe\": \"eslint . | tee lint.log\",\n+            \"redirect\": \"eslint . > output.txt 2>&1\",\n+            \"multi\": \"eslint .; next build; eslint --fix .\"\n+          },\n+          \"dependencies\": {\n+            \"react\": \"^19\",\n+            \"react-dom\": \"^19\",\n+            \"next\": \"^16\"\n+          },\n+          \"devDependencies\": {\n+            \"typescript\": \"^5\",\n+            \"@types/node\": \"^20\",\n+            \"@types/react\": \"^19\",\n+            \"@types/react-dom\": \"^19\",\n+            \"eslint\": \"^9\",\n+            \"eslint-config-next\": \"^16\"\n+          }\n+        }\n+        \"\n+      `)\n+    })\n   })\n-})\n\\ No newline at end of file\n+})"
        },
        {
            "sha": "bf515ac386d62034c3c0dade8fa7c3194dadcfda",
            "filename": "packages/next-codemod/transforms/next-lint-to-eslint-cli.ts",
            "status": "modified",
            "additions": 538,
            "deletions": 432,
            "changes": 970,
            "blob_url": "https://github.com/vercel/next.js/blob/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2Fnext-lint-to-eslint-cli.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e9a8ee50408724f84d18ff603349683cedc74aa2/packages%2Fnext-codemod%2Ftransforms%2Fnext-lint-to-eslint-cli.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-codemod%2Ftransforms%2Fnext-lint-to-eslint-cli.ts?ref=e9a8ee50408724f84d18ff603349683cedc74aa2",
            "patch": "@@ -1,5 +1,6 @@\n-import { existsSync, readFileSync, writeFileSync } from 'node:fs'\n+import { existsSync, readFileSync, writeFileSync, unlinkSync } from 'node:fs'\n import path from 'node:path'\n+import { execSync } from 'node:child_process'\n import { getPkgManager, installPackages } from '../lib/handle-package'\n import { createParserFromPath } from '../lib/parser'\n import { white, bold, red, yellow, green, magenta } from 'picocolors'\n@@ -19,20 +20,12 @@ interface TransformerOptions {\n   [key: string]: unknown\n }\n \n-const ESLINT_CONFIG_TEMPLATE_TYPESCRIPT = `\\\n-import { dirname } from \"path\";\n-import { fileURLToPath } from \"url\";\n-import { FlatCompat } from \"@eslint/eslintrc\";\n-\n-const __filename = fileURLToPath(import.meta.url);\n-const __dirname = dirname(__filename);\n-\n-const compat = new FlatCompat({\n-  baseDirectory: __dirname,\n-});\n+const ESLINT_CONFIG_TEMPLATE_TYPESCRIPT = `import nextCoreWebVitals from \"eslint-config-next/core-web-vitals\";\n+import nextTypescript from \"eslint-config-next/typescript\";\n \n const eslintConfig = [\n-  ...compat.extends(\"next/core-web-vitals\", \"next/typescript\"),\n+  ...nextCoreWebVitals,\n+  ...nextTypescript,\n   {\n     ignores: [\n       \"node_modules/**\",\n@@ -47,19 +40,10 @@ const eslintConfig = [\n export default eslintConfig;\n `\n \n-const ESLINT_CONFIG_TEMPLATE_JAVASCRIPT = `import { dirname } from \"path\";\n-import { fileURLToPath } from \"url\";\n-import { FlatCompat } from \"@eslint/eslintrc\";\n-\n-const __filename = fileURLToPath(import.meta.url);\n-const __dirname = dirname(__filename);\n-\n-const compat = new FlatCompat({\n-  baseDirectory: __dirname,\n-});\n+const ESLINT_CONFIG_TEMPLATE_JAVASCRIPT = `import nextCoreWebVitals from \"eslint-config-next/core-web-vitals\";\n \n const eslintConfig = [\n-  ...compat.extends(\"next/core-web-vitals\"),\n+  ...nextCoreWebVitals,\n   {\n     ignores: [\n       \"node_modules/**\",\n@@ -80,8 +64,8 @@ function detectTypeScript(projectRoot: string): boolean {\n \n function findExistingEslintConfig(projectRoot: string): {\n   exists: boolean\n-  path?: string\n-  isFlat?: boolean\n+  path: string | null\n+  isLegacy: boolean | null\n } {\n   const flatConfigs = [\n     'eslint.config.js',\n@@ -105,25 +89,22 @@ function findExistingEslintConfig(projectRoot: string): {\n   for (const config of flatConfigs) {\n     const configPath = path.join(projectRoot, config)\n     if (existsSync(configPath)) {\n-      return { exists: true, path: configPath, isFlat: true }\n+      return { exists: true, path: configPath, isLegacy: false }\n     }\n   }\n \n   // Check for legacy configs\n   for (const config of legacyConfigs) {\n     const configPath = path.join(projectRoot, config)\n     if (existsSync(configPath)) {\n-      return { exists: true, path: configPath, isFlat: false }\n+      return { exists: true, path: configPath, isLegacy: true }\n     }\n   }\n \n-  return { exists: false }\n+  return { exists: false, path: null, isLegacy: null }\n }\n \n-function updateExistingFlatConfig(\n-  configPath: string,\n-  isTypeScript: boolean\n-): boolean {\n+function replaceFlatCompatInConfig(configPath: string): boolean {\n   let configContent: string\n   try {\n     configContent = readFileSync(configPath, 'utf8')\n@@ -132,129 +113,353 @@ function updateExistingFlatConfig(\n     return false\n   }\n \n-  // Check if Next.js configs are already imported\n-  const hasNextConfigs =\n-    configContent.includes('next/core-web-vitals') ||\n-    configContent.includes('next/typescript')\n-\n-  // TypeScript config files need special handling\n-  if (\n-    configPath.endsWith('.ts') ||\n-    configPath.endsWith('.mts') ||\n-    configPath.endsWith('.cts')\n-  ) {\n-    console.warn(\n-      prefixes.warn,\n-      '   TypeScript config files require manual migration'\n-    )\n-    console.log('   Please add the following to your config:')\n-    console.log('   - Import: import { FlatCompat } from \"@eslint/eslintrc\"')\n-    console.log(\n-      '   - Extend: ...compat.extends(\"next/core-web-vitals\"' +\n-        (isTypeScript ? ', \"next/typescript\"' : '') +\n-        ')'\n-    )\n+  // Check if FlatCompat is used\n+  const hasFlatCompat =\n+    configContent.includes('FlatCompat') ||\n+    configContent.includes('@eslint/eslintrc')\n+\n+  if (!hasFlatCompat) {\n+    console.log('   No FlatCompat usage found, no changes needed')\n     return false\n   }\n \n   // Parse the file using jscodeshift\n   const j = createParserFromPath(configPath)\n   const root = j(configContent)\n \n-  // Determine if it's CommonJS or ES modules\n-  let isCommonJS = false\n+  // Track if we need to add imports and preserve other configs\n+  let needsNextVitals = false\n+  let needsNextTs = false\n+  let otherConfigs: string[] = []\n \n-  if (configPath.endsWith('.cjs')) {\n-    isCommonJS = true\n-  } else if (configPath.endsWith('.mjs')) {\n-    isCommonJS = false\n-  } else if (configPath.endsWith('.js')) {\n-    // For .js files, check package.json type field\n-    const projectRoot = path.dirname(configPath)\n-    const packageJsonPath = path.join(projectRoot, 'package.json')\n+  // Look for FlatCompat extends usage and identify which configs are being used\n+  root.find(j.CallExpression).forEach((astPath) => {\n+    const node = astPath.value\n \n-    try {\n-      if (existsSync(packageJsonPath)) {\n-        const packageJson = JSON.parse(readFileSync(packageJsonPath, 'utf8'))\n-        isCommonJS = packageJson.type !== 'module'\n-      } else {\n-        // Default to CommonJS if no package.json found\n-        isCommonJS = true\n-      }\n-    } catch {\n-      // Default to CommonJS if package.json can't be read\n-      isCommonJS = true\n+    if (\n+      node.callee.type === 'MemberExpression' &&\n+      (node.callee as any).object.type === 'Identifier' &&\n+      (node.callee as any).object.name === 'compat' &&\n+      (node.callee as any).property.type === 'Identifier' &&\n+      (node.callee as any).property.name === 'extends'\n+    ) {\n+      // Check arguments for all configs\n+      node.arguments.forEach((arg: any) => {\n+        if (arg.type === 'Literal' || arg.type === 'StringLiteral') {\n+          if (arg.value === 'next/core-web-vitals') {\n+            needsNextVitals = true\n+          } else if (arg.value === 'next/typescript') {\n+            needsNextTs = true\n+          } else if (typeof arg.value === 'string') {\n+            // Preserve other configs (non-Next.js or other Next.js variants)\n+            otherConfigs.push(arg.value)\n+          }\n+        }\n+      })\n     }\n+  })\n+\n+  if (!needsNextVitals && !needsNextTs && otherConfigs.length === 0) {\n+    console.warn(\n+      prefixes.warn,\n+      '   No ESLint configs found in FlatCompat usage'\n+    )\n+    return false\n+  }\n \n-    // Always check file syntax to override package.json detection if needed\n-    // This handles cases where package.json doesn't specify type but file uses ES modules\n-    const hasESModuleSyntax =\n-      root.find(j.ExportDefaultDeclaration).size() > 0 ||\n-      root.find(j.ExportNamedDeclaration).size() > 0 ||\n-      root.find(j.ImportDeclaration).size() > 0\n-\n-    const hasCommonJSSyntax =\n-      root\n-        .find(j.AssignmentExpression, {\n-          left: {\n-            type: 'MemberExpression',\n-            object: { name: 'module' },\n-            property: { name: 'exports' },\n-          },\n+  if (!needsNextVitals && !needsNextTs) {\n+    console.log('   No Next.js configs found, but preserving other configs')\n+  }\n+\n+  // Only remove FlatCompat setup if no other configs need it\n+  if (otherConfigs.length === 0) {\n+    // Remove FlatCompat imports and setup\n+    root.find(j.ImportDeclaration).forEach((astPath) => {\n+      const node = astPath.value\n+      if (\n+        node.source.value === '@eslint/eslintrc' ||\n+        node.source.value === '@eslint/js'\n+      ) {\n+        // Only remove FlatCompat-specific imports\n+        j(astPath).remove()\n+      }\n+      // Leave path/url imports alone - they might be used elsewhere\n+    })\n+\n+    // Remove only the compat variable - keep __dirname and __filename\n+    root.find(j.VariableDeclaration).forEach((astPath) => {\n+      const node = astPath.value\n+      if (node.declarations) {\n+        // Filter out only the compat variable\n+        const filteredDeclarations = node.declarations.filter((decl: any) => {\n+          if (decl && decl.id && decl.id.type === 'Identifier') {\n+            return decl.id.name !== 'compat'\n+          }\n+          return true\n         })\n-        .size() > 0\n \n-    // Override package.json detection based on actual syntax\n-    if (hasESModuleSyntax && !hasCommonJSSyntax) {\n-      isCommonJS = false\n-    } else if (hasCommonJSSyntax && !hasESModuleSyntax) {\n-      isCommonJS = true\n-    }\n-    // If both or neither are found, keep the package.json-based detection\n+        if (filteredDeclarations.length === 0) {\n+          // Remove entire declaration if no declarations left\n+          j(astPath).remove()\n+        } else if (filteredDeclarations.length < node.declarations.length) {\n+          // Update declaration with filtered declarations\n+          node.declarations = filteredDeclarations\n+        }\n+      }\n+    })\n   } else {\n-    // For other extensions (.ts, .mts, .cts), assume based on extension\n-    isCommonJS = configPath.endsWith('.cts')\n+    console.log('   Preserving FlatCompat setup for other ESLint configs')\n   }\n \n-  // Find the exported array\n-  let exportedArray = null\n-  let exportNode = null\n-\n-  if (isCommonJS) {\n-    // Look for module.exports = [...]\n-    const moduleExports = root.find(j.AssignmentExpression, {\n-      left: {\n-        type: 'MemberExpression',\n-        object: { name: 'module' },\n-        property: { name: 'exports' },\n-      },\n-      right: { type: 'ArrayExpression' },\n-    })\n+  // Add new imports after the eslint/config import\n+  const imports = []\n+\n+  // Add imports in correct order: core-web-vitals first, then typescript\n+  if (needsNextVitals) {\n+    imports.push(\n+      j.importDeclaration(\n+        [j.importDefaultSpecifier(j.identifier('nextCoreWebVitals'))],\n+        j.literal('eslint-config-next/core-web-vitals')\n+      )\n+    )\n+  }\n \n-    if (moduleExports.size() > 0) {\n-      exportNode = moduleExports.at(0)\n-      exportedArray = exportNode.get('right')\n+  if (needsNextTs) {\n+    imports.push(\n+      j.importDeclaration(\n+        [j.importDefaultSpecifier(j.identifier('nextTypescript'))],\n+        j.literal('eslint-config-next/typescript')\n+      )\n+    )\n+  }\n+\n+  // Find the eslint/config import and insert our imports after it\n+  let eslintConfigImportPath = null\n+  root.find(j.ImportDeclaration).forEach((astPath) => {\n+    if (astPath.value.source.value === 'eslint/config') {\n+      eslintConfigImportPath = astPath\n+    }\n+  })\n+\n+  // Insert imports after eslint/config import (or at beginning if not found)\n+  if (eslintConfigImportPath) {\n+    // Insert after the eslint/config import in correct order\n+    for (let i = imports.length - 1; i >= 0; i--) {\n+      eslintConfigImportPath.insertAfter(imports[i])\n     }\n   } else {\n-    // Look for export default [...]\n-    const defaultExports = root.find(j.ExportDefaultDeclaration, {\n-      declaration: { type: 'ArrayExpression' },\n-    })\n+    // Fallback: insert at the beginning in correct order\n+    const program = root.find(j.Program)\n+    for (let i = imports.length - 1; i >= 0; i--) {\n+      program.get('body', 0).insertBefore(imports[i])\n+    }\n+  }\n \n-    if (defaultExports.size() > 0) {\n-      exportNode = defaultExports.at(0)\n-      exportedArray = exportNode.get('declaration')\n-    } else {\n-      // Look for const variable = [...]; export default variable\n-      const defaultExportIdentifier = root.find(j.ExportDefaultDeclaration, {\n-        declaration: { type: 'Identifier' },\n+  // Replace FlatCompat extends with spread imports\n+  root.find(j.SpreadElement).forEach((astPath) => {\n+    const node = astPath.value\n+    if (\n+      node.argument.type === 'CallExpression' &&\n+      node.argument.callee.type === 'MemberExpression' &&\n+      node.argument.callee.object.type === 'Identifier' &&\n+      node.argument.callee.object.name === 'compat' &&\n+      node.argument.callee.property.type === 'Identifier' &&\n+      node.argument.callee.property.name === 'extends'\n+    ) {\n+      // Replace with spread of direct imports and preserve other configs\n+      const replacements = []\n+      node.argument.arguments.forEach((arg: any) => {\n+        if (arg.type === 'Literal' || arg.type === 'StringLiteral') {\n+          if (arg.value === 'next/core-web-vitals') {\n+            replacements.push(\n+              j.spreadElement(j.identifier('nextCoreWebVitals'))\n+            )\n+          } else if (arg.value === 'next/typescript') {\n+            replacements.push(j.spreadElement(j.identifier('nextTypescript')))\n+          } else if (typeof arg.value === 'string') {\n+            // Preserve other configs as compat.extends() calls\n+            replacements.push(\n+              j.spreadElement(\n+                j.callExpression(\n+                  j.memberExpression(\n+                    j.identifier('compat'),\n+                    j.identifier('extends')\n+                  ),\n+                  [j.literal(arg.value)]\n+                )\n+              )\n+            )\n+          }\n+        }\n       })\n \n-      if (defaultExportIdentifier.size() > 0) {\n-        const declarationNode = defaultExportIdentifier.at(0).get('declaration')\n-        if (!declarationNode.value) {\n-          return false\n+      if (replacements.length > 0) {\n+        // Replace the current spread element with multiple spread elements\n+        const parent = astPath.parent\n+        if (parent.value.type === 'ArrayExpression') {\n+          const index = parent.value.elements.indexOf(node)\n+          if (index !== -1) {\n+            parent.value.elements.splice(index, 1, ...replacements)\n+          }\n+        }\n+      }\n+    }\n+  })\n+\n+  // Also handle the case where extends is used as a property value (not spread)\n+  root.find(j.ObjectExpression).forEach((astPath) => {\n+    const objectNode = astPath.value\n+    objectNode.properties?.forEach((prop: any) => {\n+      if (\n+        prop.type === 'ObjectProperty' &&\n+        prop.key.type === 'Identifier' &&\n+        prop.key.name === 'extends' &&\n+        prop.value.type === 'CallExpression' &&\n+        prop.value.callee.type === 'MemberExpression' &&\n+        prop.value.callee.object.type === 'Identifier' &&\n+        prop.value.callee.object.name === 'compat' &&\n+        prop.value.callee.property.type === 'Identifier' &&\n+        prop.value.callee.property.name === 'extends'\n+      ) {\n+        // Replace with array of spread imports and preserve other configs\n+        const replacements = []\n+        prop.value.arguments.forEach((arg: any) => {\n+          if (arg.type === 'Literal' || arg.type === 'StringLiteral') {\n+            if (arg.value === 'next/core-web-vitals') {\n+              replacements.push(\n+                j.spreadElement(j.identifier('nextCoreWebVitals'))\n+              )\n+            } else if (arg.value === 'next/typescript') {\n+              replacements.push(j.spreadElement(j.identifier('nextTypescript')))\n+            } else if (typeof arg.value === 'string') {\n+              // Preserve other configs as compat.extends() calls\n+              replacements.push(\n+                j.spreadElement(\n+                  j.callExpression(\n+                    j.memberExpression(\n+                      j.identifier('compat'),\n+                      j.identifier('extends')\n+                    ),\n+                    [j.literal(arg.value)]\n+                  )\n+                )\n+              )\n+            }\n+          }\n+        })\n+\n+        if (replacements.length > 0) {\n+          // Replace the property value with an array of spreads\n+          prop.value = j.arrayExpression(replacements)\n+        }\n+      }\n+    })\n+  })\n+\n+  // Generate the updated code\n+  const updatedContent = root.toSource()\n+\n+  if (updatedContent !== configContent) {\n+    // Validate the generated code by parsing it\n+    try {\n+      const validateJ = createParserFromPath(configPath)\n+      validateJ(updatedContent) // This will throw if the syntax is invalid\n+    } catch (parseError) {\n+      console.error(\n+        `   Generated code has invalid syntax: ${parseError instanceof Error ? parseError.message : parseError}`\n+      )\n+      console.error('   Skipping update to prevent breaking the config file')\n+      return false\n+    }\n+\n+    // Create backup of original file\n+    const backupPath = `${configPath}.backup-${Date.now()}`\n+    try {\n+      writeFileSync(backupPath, configContent)\n+    } catch (backupError) {\n+      console.warn(`   Warning: Could not create backup file: ${backupError}`)\n+    }\n+\n+    try {\n+      writeFileSync(configPath, updatedContent)\n+      console.log(\n+        `   Updated ${path.basename(configPath)} to use direct eslint-config-next imports`\n+      )\n+\n+      // Remove backup on success\n+      try {\n+        if (existsSync(backupPath)) {\n+          unlinkSync(backupPath)\n+        }\n+      } catch (cleanupError) {\n+        console.warn(\n+          `   Warning: Could not remove backup file ${backupPath}: ${cleanupError}`\n+        )\n+      }\n+\n+      return true\n+    } catch (error) {\n+      console.error(`   Error writing config file: ${error}`)\n+\n+      // Restore from backup on failure\n+      try {\n+        if (existsSync(backupPath)) {\n+          writeFileSync(configPath, readFileSync(backupPath, 'utf8'))\n+          console.log('   Restored original config from backup')\n         }\n+      } catch (restoreError) {\n+        console.error(`   Error restoring backup: ${restoreError}`)\n+      }\n+\n+      return false\n+    }\n+  }\n+\n+  return true\n+}\n+\n+function updateExistingFlatConfig(\n+  configPath: string,\n+  isTypeScript: boolean = false\n+): boolean {\n+  let configContent: string\n+  try {\n+    configContent = readFileSync(configPath, 'utf8')\n+  } catch (error) {\n+    console.error(`   Error reading config file: ${error}`)\n+    return false\n+  }\n+\n+  // Check if Next.js configs are already imported directly\n+  const hasNextVitals = configContent.includes(\n+    'eslint-config-next/core-web-vitals'\n+  )\n+  const hasNextTs = configContent.includes('eslint-config-next/typescript')\n+  const hasNextConfigs = hasNextVitals || hasNextTs\n+\n+  // Parse the file using jscodeshift\n+  const j = createParserFromPath(configPath)\n+  const root = j(configContent)\n+\n+  // Find the exported array - support different export patterns\n+  let exportedArray = null\n+\n+  // Pattern 1: export default [...]\n+  const directArrayExports = root.find(j.ExportDefaultDeclaration, {\n+    declaration: { type: 'ArrayExpression' },\n+  })\n+\n+  if (directArrayExports.size() > 0) {\n+    exportedArray = directArrayExports.at(0).get('declaration')\n+  } else {\n+    // Pattern 2: const config = [...]; export default config\n+    const defaultExportIdentifier = root.find(j.ExportDefaultDeclaration, {\n+      declaration: { type: 'Identifier' },\n+    })\n+\n+    if (defaultExportIdentifier.size() > 0) {\n+      const declarationNode = defaultExportIdentifier.at(0).get('declaration')\n+      if (declarationNode.value) {\n         const varName = declarationNode.value.name\n         const varDeclaration = root.find(j.VariableDeclarator, {\n           id: { name: varName },\n@@ -263,6 +468,28 @@ function updateExistingFlatConfig(\n \n         if (varDeclaration.size() > 0) {\n           exportedArray = varDeclaration.at(0).get('init')\n+        } else {\n+          // Pattern 3: defineConfig([...]) or similar wrapper function\n+          const callDeclaration = root.find(j.VariableDeclarator, {\n+            id: { name: varName },\n+            init: { type: 'CallExpression' },\n+          })\n+\n+          if (callDeclaration.size() > 0) {\n+            const callExpression = callDeclaration.at(0).get('init')\n+            if (\n+              callExpression.value.arguments.length > 0 &&\n+              callExpression.value.arguments[0].type === 'ArrayExpression'\n+            ) {\n+              exportedArray = callExpression.get('arguments', 0)\n+            } else {\n+              console.warn(\n+                prefixes.warn,\n+                '   Wrapper function does not have an array parameter. Manual migration required.'\n+              )\n+              return false\n+            }\n+          }\n         }\n       }\n     }\n@@ -271,286 +498,154 @@ function updateExistingFlatConfig(\n   if (!exportedArray) {\n     console.warn(\n       prefixes.warn,\n-      '   Config does not export an array. Manual migration required.'\n-    )\n-    console.warn(\n-      prefixes.warn,\n-      '   ESLint flat configs must export an array of configuration objects.'\n+      '   Config does not export an array or supported pattern. Manual migration required.'\n     )\n     return false\n   }\n \n-  // Check if FlatCompat is already imported\n-  const hasFlatCompat = isCommonJS\n-    ? root\n-        .find(j.CallExpression, {\n-          callee: { name: 'require' },\n-          arguments: [{ value: '@eslint/eslintrc' }],\n-        })\n-        .size() > 0\n-    : root\n-        .find(j.ImportDeclaration, {\n-          source: { value: '@eslint/eslintrc' },\n-        })\n-        .size() > 0\n-\n-  // Add necessary imports if not present and if we're adding Next.js extends\n-  if (!hasFlatCompat && !hasNextConfigs) {\n-    if (isCommonJS) {\n-      // Add CommonJS requires at the top\n-      const firstNode = root.find(j.Program).get('body', 0)\n-      const compatRequire = j.variableDeclaration('const', [\n-        j.variableDeclarator(\n-          j.objectPattern([\n-            j.property(\n-              'init',\n-              j.identifier('FlatCompat'),\n-              j.identifier('FlatCompat')\n-            ),\n-          ]),\n-          j.callExpression(j.identifier('require'), [\n-            j.literal('@eslint/eslintrc'),\n-          ])\n-        ),\n-      ])\n-      const pathRequire = j.variableDeclaration('const', [\n-        j.variableDeclarator(\n-          j.identifier('path'),\n-          j.callExpression(j.identifier('require'), [j.literal('path')])\n-        ),\n-      ])\n-      const compatNew = j.variableDeclaration('const', [\n-        j.variableDeclarator(\n-          j.identifier('compat'),\n-          j.newExpression(j.identifier('FlatCompat'), [\n-            j.objectExpression([\n-              j.property(\n-                'init',\n-                j.identifier('baseDirectory'),\n-                j.identifier('__dirname')\n-              ),\n-            ]),\n-          ])\n-        ),\n-      ])\n-\n-      j(firstNode).insertBefore(compatRequire)\n-      j(firstNode).insertBefore(pathRequire)\n-      j(firstNode).insertBefore(compatNew)\n-    } else {\n-      // Add ES module imports\n-      const firstImport = root.find(j.ImportDeclaration).at(0)\n-      const insertPoint =\n-        firstImport.size() > 0\n-          ? firstImport\n-          : root.find(j.Program).get('body', 0)\n-\n-      const imports = [\n-        j.importDeclaration(\n-          [j.importSpecifier(j.identifier('dirname'))],\n-          j.literal('path')\n-        ),\n-        j.importDeclaration(\n-          [j.importSpecifier(j.identifier('fileURLToPath'))],\n-          j.literal('url')\n-        ),\n-        j.importDeclaration(\n-          [j.importSpecifier(j.identifier('FlatCompat'))],\n-          j.literal('@eslint/eslintrc')\n-        ),\n-      ]\n-\n-      const setupVars = [\n-        j.variableDeclaration('const', [\n-          j.variableDeclarator(\n-            j.identifier('__filename'),\n-            j.callExpression(j.identifier('fileURLToPath'), [\n-              j.memberExpression(\n-                j.memberExpression(\n-                  j.identifier('import'),\n-                  j.identifier('meta')\n-                ),\n-                j.identifier('url')\n-              ),\n-            ])\n-          ),\n-        ]),\n-        j.variableDeclaration('const', [\n-          j.variableDeclarator(\n-            j.identifier('__dirname'),\n-            j.callExpression(j.identifier('dirname'), [\n-              j.identifier('__filename'),\n-            ])\n-          ),\n-        ]),\n-        j.variableDeclaration('const', [\n-          j.variableDeclarator(\n-            j.identifier('compat'),\n-            j.newExpression(j.identifier('FlatCompat'), [\n-              j.objectExpression([\n-                j.property(\n-                  'init',\n-                  j.identifier('baseDirectory'),\n-                  j.identifier('__dirname')\n-                ),\n-              ]),\n-            ])\n-          ),\n-        ]),\n-      ]\n-\n-      if (firstImport.size() > 0) {\n-        // Insert after the last import\n-        const lastImportPath = root.find(j.ImportDeclaration).at(-1).get()\n-        if (!lastImportPath) {\n-          // Fallback to inserting at the beginning\n-          const fallbackInsertPoint = root.find(j.Program).get('body', 0)\n-          imports.forEach((imp) => j(fallbackInsertPoint).insertBefore(imp))\n-          setupVars.forEach((v) => j(fallbackInsertPoint).insertBefore(v))\n-        } else {\n-          imports.forEach((imp) => j(lastImportPath).insertAfter(imp))\n-          setupVars.forEach((v) => j(lastImportPath).insertAfter(v))\n-        }\n-      } else {\n-        // Insert at the beginning\n-        imports.forEach((imp) => j(insertPoint).insertBefore(imp))\n-        setupVars.forEach((v) => j(insertPoint).insertBefore(v))\n-      }\n-    }\n+  // Add Next.js imports if not present\n+  const program = root.find(j.Program)\n+  const imports = []\n+\n+  if (!hasNextVitals) {\n+    imports.push(\n+      j.importDeclaration(\n+        [j.importDefaultSpecifier(j.identifier('nextCoreWebVitals'))],\n+        j.literal('eslint-config-next/core-web-vitals')\n+      )\n+    )\n   }\n \n-  // Create ignores configuration object\n-  const ignoresConfig = j.objectExpression([\n-    j.property(\n-      'init',\n-      j.identifier('ignores'),\n-      j.arrayExpression([\n-        j.literal('node_modules/**'),\n-        j.literal('.next/**'),\n-        j.literal('out/**'),\n-        j.literal('build/**'),\n-        j.literal('next-env.d.ts'),\n-      ])\n-    ),\n-  ])\n-\n-  // Only add Next.js extends if they're not already present\n-  if (!hasNextConfigs) {\n-    // Add Next.js configs to the array\n-    const nextExtends = isTypeScript\n-      ? ['next/core-web-vitals', 'next/typescript']\n-      : ['next/core-web-vitals']\n-\n-    const spreadElement = j.spreadElement(\n-      j.callExpression(\n-        j.memberExpression(j.identifier('compat'), j.identifier('extends')),\n-        nextExtends.map((ext) => j.literal(ext))\n+  if (!hasNextTs && isTypeScript) {\n+    imports.push(\n+      j.importDeclaration(\n+        [j.importDefaultSpecifier(j.identifier('nextTypescript'))],\n+        j.literal('eslint-config-next/typescript')\n       )\n     )\n+  }\n \n-    // Insert Next.js extends at the beginning of the array\n-    if (!exportedArray.value.elements) {\n-      exportedArray.value.elements = []\n-    }\n-    exportedArray.value.elements.unshift(spreadElement)\n+  // Insert imports at the beginning in correct order\n+  for (let i = imports.length - 1; i >= 0; i--) {\n+    program.get('body', 0).insertBefore(imports[i])\n   }\n \n-  // Check if ignores already exist in the config and merge if needed\n-  let existingIgnoresIndex = -1\n-  if (exportedArray.value.elements) {\n-    for (let i = 0; i < exportedArray.value.elements.length; i++) {\n-      const element = exportedArray.value.elements[i]\n-      if (\n-        element &&\n-        element.type === 'ObjectExpression' &&\n-        element.properties &&\n-        element.properties.some(\n-          (prop) =>\n-            prop.type === 'Property' &&\n-            prop.key &&\n-            prop.key.type === 'Identifier' &&\n-            prop.key.name === 'ignores'\n-        )\n-      ) {\n-        existingIgnoresIndex = i\n-        break\n-      }\n-    }\n+  // Add spread elements to config array if not already present\n+  if (!exportedArray.value.elements) {\n+    exportedArray.value.elements = []\n   }\n \n-  if (existingIgnoresIndex === -1) {\n-    // No existing ignores, add our own at appropriate position\n-    const insertIndex = hasNextConfigs ? 0 : 1\n-    exportedArray.value.elements.splice(insertIndex, 0, ignoresConfig)\n-  } else {\n-    // Merge with existing ignores\n-    const existingIgnoresArr =\n-      exportedArray.value.elements[existingIgnoresIndex]?.properties ?? []\n-\n-    const ignoresProp = existingIgnoresArr.find(\n-      (prop) =>\n-        prop.type === 'Property' &&\n-        prop.key &&\n-        prop.key.type === 'Identifier' &&\n-        prop.key.name === 'ignores'\n-    )\n+  const spreadsToAdd = []\n+  if (!hasNextVitals) {\n+    spreadsToAdd.push(j.spreadElement(j.identifier('nextCoreWebVitals')))\n+  }\n+  if (!hasNextTs && isTypeScript) {\n+    spreadsToAdd.push(j.spreadElement(j.identifier('nextTypescript')))\n+  }\n \n-    if (\n-      ignoresProp &&\n-      ignoresProp.value &&\n-      ignoresProp.value.type === 'ArrayExpression'\n-    ) {\n-      // Add our ignores to the existing array if they're not already there\n-      const nextIgnores = [\n-        'node_modules/**',\n-        '.next/**',\n-        'out/**',\n-        'build/**',\n-        'next-env.d.ts',\n-      ]\n-\n-      const existingIgnores = ignoresProp.value.elements\n-        .map((el) => (el.type === 'Literal' ? el.value : null))\n-        .filter(Boolean)\n-\n-      for (const ignore of nextIgnores) {\n-        if (!existingIgnores.includes(ignore)) {\n-          ignoresProp.value.elements.push(j.literal(ignore))\n-        }\n-      }\n-    }\n+  // Insert at the beginning of array in correct order\n+  for (let i = spreadsToAdd.length - 1; i >= 0; i--) {\n+    exportedArray.value.elements.unshift(spreadsToAdd[i])\n+  }\n+\n+  // Add ignores config if not already present\n+  const hasIgnores = exportedArray.value.elements.some(\n+    (element) =>\n+      element &&\n+      element.type === 'ObjectExpression' &&\n+      element.properties &&\n+      element.properties.some(\n+        (prop) =>\n+          prop.type === 'ObjectProperty' &&\n+          prop.key &&\n+          prop.key.type === 'Identifier' &&\n+          prop.key.name === 'ignores'\n+      )\n+  )\n+\n+  if (!hasIgnores) {\n+    const ignoresConfig = j.objectExpression([\n+      j.property(\n+        'init',\n+        j.identifier('ignores'),\n+        j.arrayExpression([\n+          j.literal('node_modules/**'),\n+          j.literal('.next/**'),\n+          j.literal('out/**'),\n+          j.literal('build/**'),\n+          j.literal('next-env.d.ts'),\n+        ])\n+      ),\n+    ])\n+    exportedArray.value.elements.push(ignoresConfig)\n   }\n \n   // Generate the updated code\n   const updatedContent = root.toSource()\n \n   if (updatedContent !== configContent) {\n+    // Validate the generated code by parsing it\n     try {\n-      writeFileSync(configPath, updatedContent)\n-    } catch (error) {\n-      console.error(`   Error writing config file: ${error}`)\n+      const validateJ = createParserFromPath(configPath)\n+      validateJ(updatedContent) // This will throw if the syntax is invalid\n+    } catch (parseError) {\n+      console.error(\n+        `   Generated code has invalid syntax: ${parseError instanceof Error ? parseError.message : parseError}`\n+      )\n+      console.error('   Skipping update to prevent breaking the config file')\n       return false\n     }\n \n-    if (hasNextConfigs) {\n-      console.log(\n-        `   Updated ${path.basename(configPath)} with Next.js ignores configuration`\n-      )\n-    } else {\n+    // Create backup of original file\n+    const backupPath = `${configPath}.backup-${Date.now()}`\n+    try {\n+      writeFileSync(backupPath, configContent)\n+    } catch (backupError) {\n+      console.warn(`   Warning: Could not create backup file: ${backupError}`)\n+    }\n+\n+    try {\n+      writeFileSync(configPath, updatedContent)\n       console.log(\n-        `   Updated ${path.basename(configPath)} with Next.js ESLint configs`\n+        `   Updated ${path.basename(configPath)} with Next.js configurations`\n       )\n+\n+      // Remove backup on success\n+      try {\n+        if (existsSync(backupPath)) {\n+          unlinkSync(backupPath)\n+        }\n+      } catch (cleanupError) {\n+        console.warn(\n+          `   Warning: Could not remove backup file ${backupPath}: ${cleanupError}`\n+        )\n+      }\n+\n+      return true\n+    } catch (error) {\n+      console.error(`   Error writing config file: ${error}`)\n+\n+      // Restore from backup on failure\n+      try {\n+        if (existsSync(backupPath)) {\n+          writeFileSync(configPath, readFileSync(backupPath, 'utf8'))\n+          console.log('   Restored original config from backup')\n+        }\n+      } catch (restoreError) {\n+        console.error(`   Error restoring backup: ${restoreError}`)\n+      }\n+\n+      return false\n     }\n-    return true\n   }\n \n-  // If nothing changed but Next.js configs were already present, that's still success\n+  // If nothing changed but configs are present, that's still success\n   if (hasNextConfigs) {\n     console.log('   Next.js ESLint configs already present in flat config')\n     return true\n   }\n \n-  return false\n+  return true\n }\n \n function updatePackageJsonScripts(packageJsonContent: string): {\n@@ -728,12 +823,13 @@ function updatePackageJsonScripts(packageJsonContent: string): {\n       needsUpdate = true\n     }\n \n-    // Check if @eslint/eslintrc exists in either dependencies or devDependencies\n-    if (\n-      !packageJson.devDependencies['@eslint/eslintrc'] &&\n-      !packageJson.dependencies?.['@eslint/eslintrc']\n-    ) {\n-      packageJson.devDependencies['@eslint/eslintrc'] = '^3'\n+    // Remove @eslint/eslintrc if it exists since we no longer use FlatCompat\n+    if (packageJson.devDependencies?.['@eslint/eslintrc']) {\n+      delete packageJson.devDependencies['@eslint/eslintrc']\n+      needsUpdate = true\n+    }\n+    if (packageJson.dependencies?.['@eslint/eslintrc']) {\n+      delete packageJson.dependencies['@eslint/eslintrc']\n       needsUpdate = true\n     }\n \n@@ -776,52 +872,8 @@ export default function transformer(\n   // Check for existing ESLint config\n   const existingConfig = findExistingEslintConfig(projectRoot)\n \n-  if (existingConfig.exists) {\n-    if (existingConfig.isFlat) {\n-      // Try to update existing flat config\n-      if (existingConfig.path) {\n-        console.log(\n-          `   Found existing flat config: ${path.basename(existingConfig.path)}`\n-        )\n-        const updated = updateExistingFlatConfig(\n-          existingConfig.path,\n-          isTypeScript\n-        )\n-\n-        if (!updated) {\n-          console.log(\n-            '   Could not automatically update the existing flat config.'\n-          )\n-          console.log(\n-            '   Please manually ensure your ESLint config extends \"next/core-web-vitals\"'\n-          )\n-          if (isTypeScript) {\n-            console.log('   and \"next/typescript\" for TypeScript projects.')\n-          }\n-        }\n-      }\n-    } else {\n-      // Legacy config exists\n-      if (existingConfig.path) {\n-        console.log(\n-          `   Found legacy ESLint config: ${path.basename(existingConfig.path)}`\n-        )\n-        console.log(\n-          '   Legacy .eslintrc configs are not automatically migrated.'\n-        )\n-        console.log(\n-          '   Please migrate to flat config format (eslint.config.js) and ensure it extends:'\n-        )\n-        console.log('   - \"next/core-web-vitals\"')\n-        if (isTypeScript) {\n-          console.log('   - \"next/typescript\"')\n-        }\n-        console.log(\n-          '   Learn more: https://eslint.org/docs/latest/use/configure/migration-guide'\n-        )\n-      }\n-    }\n-  } else {\n+  // If no existing ESLint config found, create a new one.\n+  if (existingConfig.exists === false) {\n     // Create new ESLint flat config\n     const eslintConfigPath = path.join(projectRoot, 'eslint.config.mjs')\n     const template = isTypeScript\n@@ -834,9 +886,63 @@ export default function transformer(\n     } catch (error) {\n       console.error('   Error creating ESLint config:', error)\n     }\n+  } else {\n+    let eslintConfigFilename = path.basename(existingConfig.path)\n+    let eslintConfigPath = existingConfig.path\n+\n+    // If legacy config found, run ESLint migration tool first. It will\n+    // use FlatCompat, so will continue to migrate using Flat config format.\n+    if (existingConfig.isLegacy && existingConfig.path) {\n+      console.log(`   Found legacy ESLint config: ${eslintConfigFilename}`)\n+\n+      // Run npx @eslint/migrate-config\n+      const command = `npx @eslint/migrate-config ${existingConfig.path}`\n+      console.log(`   Running \"${command}\" to convert legacy config...`)\n+      try {\n+        execSync(command, {\n+          cwd: projectRoot,\n+          stdio: 'pipe',\n+        })\n+\n+        // The migration tool creates eslint.config.mjs by default\n+        const outputPath = path.join(projectRoot, 'eslint.config.mjs')\n+        if (!existsSync(outputPath)) {\n+          throw new Error(\n+            `Failed to find the expected output file \"${outputPath}\" generated by the migration tool.`\n+          )\n+        }\n+\n+        // Use generated config will have FlatCompat, so continue to apply\n+        // the next steps to it.\n+        eslintConfigPath = outputPath\n+        eslintConfigFilename = path.basename(eslintConfigPath)\n+      } catch (cause) {\n+        throw new Error(\n+          `Failed to run \"${command}\" to migrate the legacy ESLint config \"${eslintConfigFilename}\".\\n` +\n+            `Please try the migration to Flat config manually.\\n` +\n+            `Learn more: https://eslint.org/docs/latest/use/configure/migration-guide`,\n+          { cause }\n+        )\n+      }\n+    }\n+\n+    console.log(`   Found existing ESLint Flat config: ${eslintConfigFilename}`)\n+\n+    // First try to replace FlatCompat usage if present\n+    replaceFlatCompatInConfig(eslintConfigPath)\n+\n+    // Always try to update flat config with Next.js configurations\n+    // regardless of whether FlatCompat was found\n+    const updated = updateExistingFlatConfig(eslintConfigPath, isTypeScript)\n+\n+    if (!updated) {\n+      console.log('   Could not automatically update the existing flat config.')\n+      console.log(\n+        '   Please manually ensure your ESLint config includes the Next.js configurations'\n+      )\n+    }\n   }\n \n-  // Update package.json\n   const packageJsonContent = readFileSync(packageJsonPath, 'utf8')\n   const result = updatePackageJsonScripts(packageJsonContent)\n "
        }
    ],
    "stats": {
        "total": 2276,
        "additions": 1176,
        "deletions": 1100
    }
}