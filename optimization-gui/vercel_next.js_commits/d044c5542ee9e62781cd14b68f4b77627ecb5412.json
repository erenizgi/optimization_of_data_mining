{
    "author": "ztanner",
    "message": "ci: fix javascript-urls test to account for React 18 (#88249)\n\nThis was caught by our React 18 tests which only run on `canary`. There\nwas a console error about breaking `javascript:` urls in an upcoming\nReact release but it didn't actually block them.",
    "sha": "d044c5542ee9e62781cd14b68f4b77627ecb5412",
    "files": [
        {
            "sha": "78a523f3e3b59432b88a19ef9a3ce3129449cc11",
            "filename": "test/e2e/app-dir/javascript-urls/javascript-urls.test.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 28,
            "changes": 65,
            "blob_url": "https://github.com/vercel/next.js/blob/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fjavascript-urls.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fjavascript-urls.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fjavascript-urls.test.ts?ref=d044c5542ee9e62781cd14b68f4b77627ecb5412",
            "patch": "@@ -7,6 +7,8 @@ import {\n } from 'next-test-utils'\n import type { Page, Request } from 'playwright'\n \n+const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n+\n describe('javascript-urls', () => {\n   const { next, isNextDev } = nextTestSetup({\n     files: __dirname,\n@@ -247,40 +249,47 @@ describe('javascript-urls', () => {\n     expect(safePageUrl).toContain('/app/safe')\n   })\n \n-  it('should prevent javascript URLs in pages router Link component', async () => {\n-    const { beforePageLoad, getNavigationRequests } =\n-      createNavigationInterceptor()\n-\n-    const browser = await next.browser('/pages/link-href', {\n-      pushErrorAsConsoleLog: true,\n-      beforePageLoad,\n-    })\n-    const initialUrl = await browser.url()\n+  // React 18 did not block JavaScript URLs, it was just a console error.\n+  if (!isReact18) {\n+    it('should prevent javascript URLs in pages router Link component', async () => {\n+      const { beforePageLoad, getNavigationRequests } =\n+        createNavigationInterceptor()\n \n-    await browser.elementByCss('a').click()\n+      const browser = await next.browser('/pages/link-href', {\n+        pushErrorAsConsoleLog: true,\n+        beforePageLoad,\n+      })\n+      const initialUrl = await browser.url()\n \n-    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+      await browser.elementByCss('a').click()\n \n-    if (isNextDev) {\n-      await waitForRedbox(browser)\n-      expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n-        `\"React has blocked a javascript: URL as a security precaution.\"`\n+      await expectJavascriptUrlBlocked(\n+        browser,\n+        initialUrl,\n+        getNavigationRequests\n       )\n-      browser.keydown('Escape')\n-      await waitForNoRedbox(browser)\n-    }\n-\n-    // Click the safe page link\n-    await browser.elementByCss('a[href=\"/pages/safe\"]').click()\n \n-    // Wait for navigation to complete\n-    await browser.waitForCondition(\n-      'window.location.pathname.includes(\"/pages/safe\")'\n-    )\n+      if (isNextDev) {\n+        await waitForRedbox(browser)\n+        expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n+          `\"React has blocked a javascript: URL as a security precaution.\"`\n+        )\n+        browser.keydown('Escape')\n+        await waitForNoRedbox(browser)\n+      }\n+\n+      // Click the safe page link\n+      await browser.elementByCss('a[href=\"/pages/safe\"]').click()\n+\n+      // Wait for navigation to complete\n+      await browser.waitForCondition(\n+        'window.location.pathname.includes(\"/pages/safe\")'\n+      )\n \n-    const safePageUrl = await browser.url()\n-    expect(safePageUrl).toContain('/pages/safe')\n-  })\n+      const safePageUrl = await browser.url()\n+      expect(safePageUrl).toContain('/pages/safe')\n+    })\n+  }\n \n   it('should prevent javascript URLs in pages router Link as prop', async () => {\n     const { beforePageLoad, getNavigationRequests } ="
        },
        {
            "sha": "b7163a3bdc170265c8d5e85370edefb8279c85b8",
            "filename": "test/e2e/app-dir/javascript-urls/pages/pages/link-as.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 16,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-as.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-as.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-as.tsx?ref=d044c5542ee9e62781cd14b68f4b77627ecb5412",
            "patch": "@@ -4,21 +4,19 @@ import { DANGEROUS_JAVASCRIPT_URL } from '../../bad-url'\n \n export default function Page() {\n   return (\n-    <html>\n-      <body>\n-        <main>\n-          <p>\n-            Clicking this link should result in an error where React blocks a\n-            javascript URL\n-          </p>\n-          <Link href=\"/\" as={DANGEROUS_JAVASCRIPT_URL}>\n-            Link with javascript URL `as`\n-          </Link>\n-        </main>\n-        <footer>\n-          <Link href=\"/pages/safe\">Safe Page</Link>\n-        </footer>\n-      </body>\n-    </html>\n+    <div>\n+      <main>\n+        <p>\n+          Clicking this link should result in an error where React blocks a\n+          javascript URL\n+        </p>\n+        <Link href=\"/\" as={DANGEROUS_JAVASCRIPT_URL}>\n+          Link with javascript URL `as`\n+        </Link>\n+      </main>\n+      <footer>\n+        <Link href=\"/pages/safe\">Safe Page</Link>\n+      </footer>\n+    </div>\n   )\n }"
        },
        {
            "sha": "f13c855417e672fed32a658d13e6de60ea3da140",
            "filename": "test/e2e/app-dir/javascript-urls/pages/pages/link-href.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 16,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-href.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-href.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-href.tsx?ref=d044c5542ee9e62781cd14b68f4b77627ecb5412",
            "patch": "@@ -4,21 +4,19 @@ import { DANGEROUS_JAVASCRIPT_URL } from '../../bad-url'\n \n export default function Page() {\n   return (\n-    <html>\n-      <body>\n-        <main>\n-          <p>\n-            Clicking this link should result in an error where React blocks a\n-            javascript URL\n-          </p>\n-          <Link href={DANGEROUS_JAVASCRIPT_URL}>\n-            Link with javascript URL `href`\n-          </Link>\n-        </main>\n-        <footer>\n-          <Link href=\"/pages/safe\">Safe Page</Link>\n-        </footer>\n-      </body>\n-    </html>\n+    <div>\n+      <main>\n+        <p>\n+          Clicking this link should result in an error where React blocks a\n+          javascript URL\n+        </p>\n+        <Link href={DANGEROUS_JAVASCRIPT_URL}>\n+          Link with javascript URL `href`\n+        </Link>\n+      </main>\n+      <footer>\n+        <Link href=\"/pages/safe\">Safe Page</Link>\n+      </footer>\n+    </div>\n   )\n }"
        },
        {
            "sha": "f83577a1ba99970a3f3a30552cd2680ad802a2a3",
            "filename": "test/e2e/app-dir/javascript-urls/pages/pages/router-push.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 16,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-push.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-push.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-push.tsx?ref=d044c5542ee9e62781cd14b68f4b77627ecb5412",
            "patch": "@@ -6,21 +6,19 @@ import { DANGEROUS_JAVASCRIPT_URL } from '../../bad-url'\n export default function Page() {\n   const router = useRouter()\n   return (\n-    <html>\n-      <body>\n-        <main>\n-          <p>\n-            Clicking this button should result in an error where Next.js blocks\n-            a javascript URL\n-          </p>\n-          <button onClick={() => router.push(DANGEROUS_JAVASCRIPT_URL)}>\n-            push javascript URL\n-          </button>\n-        </main>\n-        <footer>\n-          <Link href=\"/pages/safe\">Safe Page</Link>\n-        </footer>\n-      </body>\n-    </html>\n+    <div>\n+      <main>\n+        <p>\n+          Clicking this button should result in an error where Next.js blocks a\n+          javascript URL\n+        </p>\n+        <button onClick={() => router.push(DANGEROUS_JAVASCRIPT_URL)}>\n+          push javascript URL\n+        </button>\n+      </main>\n+      <footer>\n+        <Link href=\"/pages/safe\">Safe Page</Link>\n+      </footer>\n+    </div>\n   )\n }"
        },
        {
            "sha": "5c726f84047358beb42a6ed9561efb7b4ae59cd6",
            "filename": "test/e2e/app-dir/javascript-urls/pages/pages/router-replace.tsx",
            "status": "modified",
            "additions": 14,
            "deletions": 16,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-replace.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d044c5542ee9e62781cd14b68f4b77627ecb5412/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-replace.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-replace.tsx?ref=d044c5542ee9e62781cd14b68f4b77627ecb5412",
            "patch": "@@ -6,21 +6,19 @@ import { DANGEROUS_JAVASCRIPT_URL } from '../../bad-url'\n export default function Page() {\n   const router = useRouter()\n   return (\n-    <html>\n-      <body>\n-        <main>\n-          <p>\n-            Clicking this button should result in an error where Next.js blocks\n-            a javascript URL\n-          </p>\n-          <button onClick={() => router.replace(DANGEROUS_JAVASCRIPT_URL)}>\n-            replace javascript URL\n-          </button>\n-        </main>\n-        <footer>\n-          <Link href=\"/pages/safe\">Safe Page</Link>\n-        </footer>\n-      </body>\n-    </html>\n+    <div>\n+      <main>\n+        <p>\n+          Clicking this button should result in an error where Next.js blocks a\n+          javascript URL\n+        </p>\n+        <button onClick={() => router.replace(DANGEROUS_JAVASCRIPT_URL)}>\n+          replace javascript URL\n+        </button>\n+      </main>\n+      <footer>\n+        <Link href=\"/pages/safe\">Safe Page</Link>\n+      </footer>\n+    </div>\n   )\n }"
        }
    ],
    "stats": {
        "total": 185,
        "additions": 93,
        "deletions": 92
    }
}