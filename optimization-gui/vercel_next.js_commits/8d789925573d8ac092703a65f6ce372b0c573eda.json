{
    "author": "eps1lon",
    "message": "[sourcemaps] Ignore-list sources whose sourcemaps ignore-list everything (#81231)\n\nwebpack-only at the moment since I have no easy stack to test this on in Turbopack until we sourcemap the Turbopack runtime.\r\n\r\nThis applies the same heuristic Chrome uses. For sources whose associated sourcemap ignores everyone of its sources, we ignore-list that source even if we didn't find a mapping. This is similar to other common heuristic where the closest mapping is used when no exact mapping exists.",
    "sha": "8d789925573d8ac092703a65f6ce372b0c573eda",
    "files": [
        {
            "sha": "deb34e4b03f5e1dbc8fe11a716c7f80974be8bad",
            "filename": "packages/next/src/build/webpack/plugins/wellknown-errors-plugin/parseNotFoundError.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fwellknown-errors-plugin%2FparseNotFoundError.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fwellknown-errors-plugin%2FparseNotFoundError.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fwellknown-errors-plugin%2FparseNotFoundError.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -5,6 +5,7 @@ import {\n   getIgnoredSources,\n } from '../../../../server/dev/middleware-webpack'\n import type { webpack } from 'next/dist/compiled/webpack/webpack'\n+import type { RawSourceMap } from 'next/dist/compiled/source-map08'\n \n // Based on https://github.com/webpack/webpack/blob/fcdd04a833943394bbb0a9eeb54a962a24cc7e41/lib/stats/DefaultStatsFactoryPlugin.js#L422-L431\n /*\n@@ -46,6 +47,12 @@ function getModuleTrace(input: any, compilation: any) {\n   return moduleTrace\n }\n \n+function sourceMapIgnoreListsEverything(\n+  sourceMap: RawSourceMap & { ignoreList?: number[] }\n+): boolean {\n+  return sourceMap.sources.length === sourceMap.ignoreList?.length\n+}\n+\n async function getSourceFrame(\n   input: any,\n   fileName: any,\n@@ -62,6 +69,7 @@ async function getSourceFrame(\n       const moduleId = compilation.chunkGraph.getModuleId(module)\n \n       const result = await createOriginalStackFrame({\n+        ignoredByDefault: sourceMapIgnoreListsEverything(sourceMap),\n         source: {\n           type: 'bundle',\n           sourceMap,"
        },
        {
            "sha": "0d33789cb231d057fd6079af45dee65f4aea0624",
            "filename": "packages/next/src/server/dev/middleware-webpack.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 3,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmiddleware-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmiddleware-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fmiddleware-webpack.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -94,10 +94,13 @@ async function findOriginalSourcePositionAndContent(\n   try {\n     consumer = await new SourceMapConsumer(sourceMap)\n   } catch (cause) {\n-    throw new Error(\n-      `${sourceMap.file}: Invalid source map. Only conformant source maps can be used to find the original code.`,\n-      { cause }\n+    console.error(\n+      new Error(\n+        `${sourceMap.file}: Invalid source map. Only conformant source maps can be used to find the original code.`,\n+        { cause }\n+      )\n     )\n+    return null\n   }\n \n   try {\n@@ -178,11 +181,14 @@ function findOriginalSourcePositionAndContentFromCompilation(\n }\n \n export async function createOriginalStackFrame({\n+  ignoredByDefault,\n   source,\n   rootDirectory,\n   frame,\n   errorMessage,\n }: {\n+  /** setting this to true will not consult ignoreList */\n+  ignoredByDefault: boolean\n   source: Source\n   rootDirectory: string\n   frame: StackFrame\n@@ -214,6 +220,7 @@ export async function createOriginalStackFrame({\n   }\n \n   const ignored =\n+    ignoredByDefault ||\n     isIgnoredSource(source, sourcePosition) ||\n     // If the source file is externals, should be excluded even it's not ignored source.\n     // e.g. webpack://next/dist/.. needs to be ignored\n@@ -404,6 +411,12 @@ function getOriginalStackFrames({\n   )\n }\n \n+function sourceMapIgnoreListsEverything(\n+  sourceMap: RawSourceMap & { ignoreList?: number[] }\n+): boolean {\n+  return sourceMap.sources.length === sourceMap.ignoreList?.length\n+}\n+\n async function getOriginalStackFrame({\n   isServer,\n   isEdgeServer,\n@@ -494,8 +507,10 @@ async function getOriginalStackFrame({\n       originalCodeFrame: null,\n     }\n   }\n+  defaultStackFrame.ignored ||= sourceMapIgnoreListsEverything(source.sourceMap)\n \n   const originalStackFrameResponse = await createOriginalStackFrame({\n+    ignoredByDefault: defaultStackFrame.ignored,\n     frame,\n     source,\n     rootDirectory,"
        },
        {
            "sha": "f2b4c9345026f9153bc0098f6bbb1b527a4dbcad",
            "filename": "packages/next/src/server/patch-error-inspect.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 4,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/packages%2Fnext%2Fsrc%2Fserver%2Fpatch-error-inspect.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/packages%2Fnext%2Fsrc%2Fserver%2Fpatch-error-inspect.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fpatch-error-inspect.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -173,6 +173,19 @@ function createUnsourcemappedFrame(\n   }\n }\n \n+function sourceMapIgnoreListsEverything(\n+  sourceMap: ModernSourceMapPayload\n+): boolean {\n+  if ('sections' in sourceMap) {\n+    // If sections are present, the ignoreList is not used.\n+    // This is because sections are used to ignore-list everything.\n+    return sourceMap.sections.every((section) => {\n+      return sourceMapIgnoreListsEverything(section.map)\n+    })\n+  }\n+  return sourceMap.sources.length === sourceMap.ignoreList?.length\n+}\n+\n /**\n  * @param frame\n  * @param sourceMapCache\n@@ -261,6 +274,7 @@ function getSourcemappedFrameIfPossible(\n     line: frame.lineNumber ?? 1,\n   })\n \n+  let ignored = sourceMapIgnoreListsEverything(sourceMapPayload)\n   if (sourcePosition.source === null) {\n     return {\n       stack: {\n@@ -269,7 +283,7 @@ function getSourcemappedFrameIfPossible(\n         file: frame.file,\n         lineNumber: frame.lineNumber,\n         methodName: frame.methodName,\n-        ignored: shouldIgnoreListGeneratedFrame(frame.file),\n+        ignored: ignored || shouldIgnoreListGeneratedFrame(frame.file),\n       },\n       code: null,\n     }\n@@ -280,18 +294,17 @@ function getSourcemappedFrameIfPossible(\n     sourceMapPayload\n   )\n   // TODO(veil): Upstream a method to sourcemap consumer that immediately says if a frame is ignored or not.\n-  let ignored = false\n   if (applicableSourceMap === undefined) {\n     console.error('No applicable source map found in sections for frame', frame)\n-  } else if (shouldIgnoreListOriginalFrame(sourcePosition.source)) {\n+  } else if (!ignored && shouldIgnoreListOriginalFrame(sourcePosition.source)) {\n     // Externals may be libraries that don't ship ignoreLists.\n     // This is really taking control away from libraries.\n     // They should still ship `ignoreList` so that attached debuggers ignore-list their frames.\n     // TODO: Maybe only ignore library sourcemaps if `ignoreList` is absent?\n     // Though keep in mind that Turbopack omits empty `ignoreList`.\n     // So if we establish this convention, we should communicate it to the ecosystem.\n     ignored = true\n-  } else {\n+  } else if (!ignored) {\n     // TODO: O(n^2). Consider moving `ignoreList` into a Set\n     const sourceIndex = applicableSourceMap.sources.indexOf(\n       sourcePosition.source"
        },
        {
            "sha": "9a60d7e1bd0db8e8efd6ea5ba92fe4883af298ec",
            "filename": "test/development/acceptance-app/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 26,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2FReactRefreshLogBox.test.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -115,14 +115,8 @@ describe('ReactRefreshLogBox app', () => {\n            \"stack\": [\n              \"eval index.js (3:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n              \"eval ./app/page.js\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n            ],\n          },\n          {\n@@ -135,14 +129,8 @@ describe('ReactRefreshLogBox app', () => {\n            \"stack\": [\n              \"eval index.js (3:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n              \"eval ./app/page.js\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n            ],\n          },\n        ]\n@@ -1474,10 +1462,8 @@ describe('ReactRefreshLogBox app', () => {\n            \"stack\": [\n              \"eval index.js (1:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n              \"eval ./app/server/page.js\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n            ],\n          }\n         `)\n@@ -1643,14 +1629,8 @@ export default function Home() {\n            \"stack\": [\n              \"eval app/utils.ts (1:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n              \"eval ./app/page.js\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n            ],\n          },\n          {\n@@ -1663,14 +1643,8 @@ export default function Home() {\n            \"stack\": [\n              \"eval app/utils.ts (1:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n              \"eval ./app/page.js\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n            ],\n          },\n        ]"
        },
        {
            "sha": "d137bd478167121bd08a18464f1dd9171b33404d",
            "filename": "test/development/acceptance/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 68,
            "deletions": 43,
            "changes": 111,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -144,17 +144,13 @@ describe('ReactRefreshLogBox', () => {\n            \"stack\": [\n              \"eval index.js (3:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n              \"eval ./pages/index.js\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n            ],\n          }\n         `)\n@@ -189,17 +185,13 @@ describe('ReactRefreshLogBox', () => {\n            \"stack\": [\n              \"eval index.js (3:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n              \"eval ./pages/index.js\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n            ],\n          }\n         `)\n@@ -208,7 +200,7 @@ describe('ReactRefreshLogBox', () => {\n   })\n \n   // https://github.com/pmmmwh/react-refresh-webpack-plugin/pull/3#issuecomment-554152127\n-  test('boundaries', async () => {\n+  it('boundaries', async () => {\n     await using sandbox = await createSandbox(next)\n     const { browser, session } = sandbox\n \n@@ -297,22 +289,39 @@ describe('ReactRefreshLogBox', () => {\n        ]\n       `)\n     } else {\n-      await expect(browser).toDisplayRedbox(`\n-       {\n-         \"description\": \"no\",\n-         \"environmentLabel\": null,\n-         \"label\": \"Runtime Error\",\n-         \"source\": \"FunctionDefault.js (1:51) @ FunctionDefault\n-       > 1 | export default function FunctionDefault() { throw new Error('no'); }\n-           |                                                   ^\",\n-         \"stack\": [\n-           \"FunctionDefault FunctionDefault.js (1:51)\",\n-           \"Set.forEach <anonymous>\",\n-           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-         ],\n-       }\n-      `)\n+      if (isTurbopack) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"no\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"FunctionDefault.js (1:51) @ FunctionDefault\n+         > 1 | export default function FunctionDefault() { throw new Error('no'); }\n+             |                                                   ^\",\n+           \"stack\": [\n+             \"FunctionDefault FunctionDefault.js (1:51)\",\n+             \"Set.forEach <anonymous>\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n+           ],\n+         }\n+        `)\n+      } else {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"no\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"FunctionDefault.js (1:51) @ FunctionDefault\n+         > 1 | export default function FunctionDefault() { throw new Error('no'); }\n+             |                                                   ^\",\n+           \"stack\": [\n+             \"FunctionDefault FunctionDefault.js (1:51)\",\n+             \"Set.forEach <anonymous>\",\n+           ],\n+         }\n+        `)\n+      }\n     }\n   })\n \n@@ -417,7 +426,7 @@ describe('ReactRefreshLogBox', () => {\n     }\n   })\n \n-  test('conversion to class component (1)', async () => {\n+  it('conversion to class component (1)', async () => {\n     await using sandbox = await createSandbox(next)\n     const { browser, session } = sandbox\n \n@@ -462,7 +471,6 @@ describe('ReactRefreshLogBox', () => {\n       `\n     )\n \n-    // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     if (isReact18 && isTurbopack) {\n       await expect(browser).toDisplayRedbox(`\n@@ -498,22 +506,39 @@ describe('ReactRefreshLogBox', () => {\n        ]\n       `)\n     } else {\n-      await expect(browser).toDisplayRedbox(`\n-       {\n-         \"description\": \"\",\n-         \"environmentLabel\": null,\n-         \"label\": \"Runtime Error\",\n-         \"source\": \"Child.js (4:11) @ ClickCount.render\n-       > 4 |     throw new Error()\n-           |           ^\",\n-         \"stack\": [\n-           \"ClickCount.render Child.js (4:11)\",\n-           \"Set.forEach <anonymous>\",\n-           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-         ],\n-       }\n-      `)\n+      if (isTurbopack) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"Child.js (4:11) @ ClickCount.render\n+         > 4 |     throw new Error()\n+             |           ^\",\n+           \"stack\": [\n+             \"ClickCount.render Child.js (4:11)\",\n+             \"Set.forEach <anonymous>\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n+           ],\n+         }\n+        `)\n+      } else {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"Child.js (4:11) @ ClickCount.render\n+         > 4 |     throw new Error()\n+             |           ^\",\n+           \"stack\": [\n+             \"ClickCount.render Child.js (4:11)\",\n+             \"Set.forEach <anonymous>\",\n+           ],\n+         }\n+        `)\n+      }\n     }\n \n     await session.patch("
        },
        {
            "sha": "18c6ca22da4d7a6f5b12b5453267e7a17726eb80",
            "filename": "test/development/acceptance/error-recovery.test.ts",
            "status": "modified",
            "additions": 100,
            "deletions": 52,
            "changes": 152,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -202,7 +202,7 @@ describe('pages/ error recovery', () => {\n     await session.assertNoRedbox()\n   })\n \n-  test('logbox: can recover from a component error', async () => {\n+  it('logbox: can recover from a component error', async () => {\n     await using sandbox = await createSandbox(next)\n     const { browser, session } = sandbox\n \n@@ -244,7 +244,6 @@ describe('pages/ error recovery', () => {\n       `\n     )\n \n-    // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     // Somehow we end up with two in React 18 + Turbopack due to React's attempt to recover from this error.\n     if (isReact18 && isTurbopack) {\n@@ -281,22 +280,39 @@ describe('pages/ error recovery', () => {\n        ]\n       `)\n     } else {\n-      await expect(browser).toDisplayRedbox(`\n-       {\n-         \"description\": \"oops\",\n-         \"environmentLabel\": null,\n-         \"label\": \"Runtime Error\",\n-         \"source\": \"child.js (3:9) @ Child\n-       > 3 |   throw new Error('oops')\n-           |         ^\",\n-         \"stack\": [\n-           \"Child child.js (3:9)\",\n-           \"Set.forEach <anonymous>\",\n-           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-         ],\n-       }\n-      `)\n+      if (isTurbopack) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"oops\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"child.js (3:9) @ Child\n+         > 3 |   throw new Error('oops')\n+             |         ^\",\n+           \"stack\": [\n+             \"Child child.js (3:9)\",\n+             \"Set.forEach <anonymous>\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n+           ],\n+         }\n+        `)\n+      } else {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"oops\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"child.js (3:9) @ Child\n+         > 3 |   throw new Error('oops')\n+             |         ^\",\n+           \"stack\": [\n+             \"Child child.js (3:9)\",\n+             \"Set.forEach <anonymous>\",\n+           ],\n+         }\n+        `)\n+      }\n     }\n \n     const didNotReload = await session.patch(\n@@ -532,7 +548,6 @@ describe('pages/ error recovery', () => {\n       await expect(session.getRedboxSource()).resolves.toInclude('render() {')\n     })\n \n-    // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n     if (isReact18 && isTurbopack) {\n@@ -584,22 +599,39 @@ describe('pages/ error recovery', () => {\n          }\n         `)\n       } else {\n-        await expect(browser).toDisplayRedbox(`\n-         {\n-           \"description\": \"nooo\",\n-           \"environmentLabel\": null,\n-           \"label\": \"Runtime Error\",\n-           \"source\": \"index.js (5:11) @ ClassDefault.render\n-         > 5 |     throw new Error('nooo');\n-             |           ^\",\n-           \"stack\": [\n-             \"ClassDefault.render index.js (5:11)\",\n-             \"Set.forEach <anonymous>\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-             \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-           ],\n-         }\n-        `)\n+        if (isTurbopack) {\n+          await expect(browser).toDisplayRedbox(`\n+           {\n+             \"description\": \"nooo\",\n+             \"environmentLabel\": null,\n+             \"label\": \"Runtime Error\",\n+             \"source\": \"index.js (5:11) @ ClassDefault.render\n+           > 5 |     throw new Error('nooo');\n+               |           ^\",\n+             \"stack\": [\n+               \"ClassDefault.render index.js (5:11)\",\n+               \"Set.forEach <anonymous>\",\n+               \"<FIXME-file-protocol>\",\n+               \"<FIXME-file-protocol>\",\n+             ],\n+           }\n+          `)\n+        } else {\n+          await expect(browser).toDisplayRedbox(`\n+           {\n+             \"description\": \"nooo\",\n+             \"environmentLabel\": null,\n+             \"label\": \"Runtime Error\",\n+             \"source\": \"index.js (5:11) @ ClassDefault.render\n+           > 5 |     throw new Error('nooo');\n+               |           ^\",\n+             \"stack\": [\n+               \"ClassDefault.render index.js (5:11)\",\n+               \"Set.forEach <anonymous>\",\n+             ],\n+           }\n+          `)\n+        }\n       }\n     }\n   })\n@@ -647,7 +679,6 @@ describe('pages/ error recovery', () => {\n       `\n     )\n \n-    // TODO(veil): ignore-list Webpack runtime (https://linear.app/vercel/issue/NDX-945)\n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     // We get an error because Foo didn't import React. Fair.\n     // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n@@ -685,22 +716,39 @@ describe('pages/ error recovery', () => {\n        ]\n       `)\n     } else {\n-      await expect(browser).toDisplayRedbox(`\n-       {\n-         \"description\": \"React is not defined\",\n-         \"environmentLabel\": null,\n-         \"label\": \"Runtime ReferenceError\",\n-         \"source\": \"Foo.js (3:3) @ Foo\n-       > 3 |   return React.createElement('h1', null, 'Foo');\n-           |   ^\",\n-         \"stack\": [\n-           \"Foo Foo.js (3:3)\",\n-           \"Set.forEach <anonymous>\",\n-           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-           \"${isTurbopack ? '<FIXME-file-protocol>' : '<FIXME-next-dist-dir>'}\",\n-         ],\n-       }\n-      `)\n+      if (isTurbopack) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"React is not defined\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime ReferenceError\",\n+           \"source\": \"Foo.js (3:3) @ Foo\n+         > 3 |   return React.createElement('h1', null, 'Foo');\n+             |   ^\",\n+           \"stack\": [\n+             \"Foo Foo.js (3:3)\",\n+             \"Set.forEach <anonymous>\",\n+             \"<FIXME-file-protocol>\",\n+             \"<FIXME-file-protocol>\",\n+           ],\n+         }\n+        `)\n+      } else {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"description\": \"React is not defined\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime ReferenceError\",\n+           \"source\": \"Foo.js (3:3) @ Foo\n+         > 3 |   return React.createElement('h1', null, 'Foo');\n+             |   ^\",\n+           \"stack\": [\n+             \"Foo Foo.js (3:3)\",\n+             \"Set.forEach <anonymous>\",\n+           ],\n+         }\n+        `)\n+      }\n     }\n \n     // Let's add that to Foo."
        },
        {
            "sha": "8926b01716a471bb02113ec65f5f3321bfa7ddd0",
            "filename": "test/development/pages-dir/client-navigation/index.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Findex.test.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -373,9 +373,6 @@ describe('Client Navigation', () => {\n              \"stack\": [\n                \"eval pages/error-in-the-browser-global-scope.js (2:9)\",\n                \"<FIXME-next-dist-dir>\",\n-               \"<FIXME-next-dist-dir>\",\n-               \"<FIXME-next-dist-dir>\",\n-               \"<FIXME-next-dist-dir>\",\n              ],\n            }\n           `)"
        },
        {
            "sha": "984f6b7428639f5b14374335d83f7a9bef038880",
            "filename": "test/development/pages-dir/client-navigation/rendering.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Frendering.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Frendering.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fpages-dir%2Fclient-navigation%2Frendering.test.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -300,9 +300,6 @@ describe('Client Navigation rendering', () => {\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n            ],\n          }\n         `)"
        },
        {
            "sha": "0b2e0e96f780f4aaba05fc9d3c24d5ee467e6eed",
            "filename": "test/e2e/app-dir/non-root-project-monorepo/non-root-project-monorepo.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fe2e%2Fapp-dir%2Fnon-root-project-monorepo%2Fnon-root-project-monorepo.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fe2e%2Fapp-dir%2Fnon-root-project-monorepo%2Fnon-root-project-monorepo.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnon-root-project-monorepo%2Fnon-root-project-monorepo.test.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -118,7 +118,6 @@ describe('non-root-project-monorepo', () => {\n            [\n              \"eval app/separate-file.ts (1:11)\",\n              \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n              \"innerArrowFunction app/source-maps-rsc/page.tsx (14:3)\",\n              \"innerFunction app/source-maps-rsc/page.tsx (10:3)\",\n              \"Page app/source-maps-rsc/page.tsx (4:5)\",\n@@ -163,9 +162,6 @@ describe('non-root-project-monorepo', () => {\n            [\n              \"eval app/separate-file.ts (1:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n              \"innerArrowFunction app/source-maps-ssr/page.tsx (16:3)\",\n              \"innerFunction app/source-maps-ssr/page.tsx (12:3)\",\n              \"Page app/source-maps-ssr/page.tsx (6:5)\",\n@@ -210,9 +206,6 @@ describe('non-root-project-monorepo', () => {\n            [\n              \"eval app/separate-file.ts (1:7)\",\n              \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n-             \"<FIXME-next-dist-dir>\",\n              \"innerArrowFunction app/source-maps-client/page.tsx (17:3)\",\n              \"innerFunction app/source-maps-client/page.tsx (13:3)\",\n              \"effectCallback app/source-maps-client/page.tsx (7:5)\","
        },
        {
            "sha": "e7a25f7143c5143feec6cee0563b34c431c9b1d1",
            "filename": "test/e2e/app-dir/server-source-maps/server-source-maps.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8d789925573d8ac092703a65f6ce372b0c573eda/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fserver-source-maps%2Fserver-source-maps.test.ts?ref=8d789925573d8ac092703a65f6ce372b0c573eda",
            "patch": "@@ -463,7 +463,6 @@ describe('app-dir - server source maps', () => {\n       )\n \n       if (isTurbopack) {\n-        // TODO(veil): Ignore-list Turbopack runtime\n         await expect(browser).toDisplayCollapsedRedbox(`\n          {\n            \"description\": \"module-evaluation\",\n@@ -482,7 +481,6 @@ describe('app-dir - server source maps', () => {\n          }\n         `)\n       } else {\n-        // TODO(veil): Ignore-list Webpack runtime\n         await expect(browser).toDisplayCollapsedRedbox(`\n          {\n            \"description\": \"module-evaluation\",\n@@ -494,10 +492,8 @@ describe('app-dir - server source maps', () => {\n            \"stack\": [\n              \"eval app/module-evaluation/module.js (1:22)\",\n              \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n              \"eval rsc:/Prerender/webpack-internal:///(rsc)/app/module-evaluation/page.js (5:65)\",\n              \"<FIXME-file-protocol>\",\n-             \"<FIXME-file-protocol>\",\n              \"Function.all <anonymous>\",\n              \"Function.all <anonymous>\",\n              \"Page <anonymous>\",\n@@ -516,8 +512,8 @@ describe('app-dir - server source maps', () => {\n           '' +\n             '\\nError: module-evaluation' +\n             '\\n    at <TurbopackModuleID> (turbopack:///[project]/app/module-evaluation/module.js:1:21)' +\n-            // TODO(veil): Why are there unsourcemapped module frames below?\n-            '\\n    at <TurbopackModuleID> (.next/'\n+            // TODO(veil): Turbopack internals. Feel free to update. Tracked in https://linear.app/vercel/issue/NEXT-4362\n+            '\\n    at Object.<anonymous>'\n         )\n         expect(normalizeCliOutput(next.cliOutput)).toContain(\n           '' +"
        }
    ],
    "stats": {
        "total": 360,
        "additions": 213,
        "deletions": 147
    }
}