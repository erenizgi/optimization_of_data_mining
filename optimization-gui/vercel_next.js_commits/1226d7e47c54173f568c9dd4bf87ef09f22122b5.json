{
    "author": "wbinnssmith",
    "message": "Turbopack: Make `turbo-tasks-memory` crate Rust 2024 (#79130)\n\nIsolated `cargo fmt` changes into their own commit. Please review the\nfirst commit for core changes.\n\n- `gen` is now a reserved word\n- Marked `get_event_description_static` and `get_event_description` as\n`'static`\n- Marked `handle_new_edge` as `use<C>`",
    "sha": "1226d7e47c54173f568c9dd4bf87ef09f22122b5",
    "files": [
        {
            "sha": "0874c14c8a7a881648a93c688451d382adfd84e7",
            "filename": "turbopack/crates/turbo-tasks-memory/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2FCargo.toml?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -3,7 +3,7 @@ name = \"turbo-tasks-memory\"\n version = \"0.1.0\"\n description = \"TBD\"\n license = \"MIT\"\n-edition = \"2021\"\n+edition = \"2024\"\n autobenches = false\n \n [lib]"
        },
        {
            "sha": "4c8c1a1f00b7e11824d9508863bf0c882cb4cca7",
            "filename": "turbopack/crates/turbo-tasks-memory/benches/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fbenches%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fbenches%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fbenches%2Fmod.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,7 +1,7 @@\n #![feature(arbitrary_self_types)]\n #![feature(arbitrary_self_types_pointers)]\n \n-use criterion::{criterion_group, criterion_main, Criterion};\n+use criterion::{Criterion, criterion_group, criterion_main};\n \n pub(crate) mod scope_stress;\n pub(crate) mod stress;"
        },
        {
            "sha": "80b5435d3f955376040a10f8f5c06a25792d6b6e",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/aggregation_data.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Faggregation_data.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Faggregation_data.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Faggregation_data.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,7 +1,7 @@\n use std::ops::{Deref, DerefMut};\n \n use super::{\n-    increase_aggregation_number_internal, AggregationContext, AggregationNode, AggregationNodeGuard,\n+    AggregationContext, AggregationNode, AggregationNodeGuard, increase_aggregation_number_internal,\n };\n use crate::aggregation::{balance_queue::BalanceQueue, increase::IncreaseReason};\n "
        },
        {
            "sha": "fa686a8b96be19092b1debdbc8c908951763a0a2",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/balance_edge.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fbalance_edge.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fbalance_edge.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fbalance_edge.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,14 +1,14 @@\n use std::cmp::Ordering;\n \n use super::{\n+    AggregationContext, AggregationNode, PreparedInternalOperation, PreparedOperation, StackVec,\n     balance_queue::BalanceQueue,\n     in_progress::{is_in_progress, start_in_progress_all, start_in_progress_count},\n     increase::IncreaseReason,\n     increase_aggregation_number_internal,\n     notify_lost_follower::notify_lost_follower,\n     notify_new_follower::notify_new_follower,\n     util::{get_aggregated_add_change, get_aggregated_remove_change, get_followers_or_children},\n-    AggregationContext, AggregationNode, PreparedInternalOperation, PreparedOperation, StackVec,\n };\n \n // Migrate followers to uppers or uppers to followers depending on the"
        },
        {
            "sha": "cc0df24a00bcf0e03fcff9aeb7d8040088a348ee",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/balance_queue.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fbalance_queue.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fbalance_queue.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fbalance_queue.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -2,7 +2,7 @@ use std::{hash::Hash, mem::take};\n \n use turbo_tasks::FxIndexSet;\n \n-use super::{balance_edge, AggregationContext};\n+use super::{AggregationContext, balance_edge};\n \n /// Enqueued edges that need to be balanced. Deduplicates edges and keeps track\n /// of aggregation numbers read during balancing."
        },
        {
            "sha": "9546f8245b26af35bcf78b31372107b3145a642c",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/followers.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Ffollowers.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Ffollowers.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Ffollowers.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,9 +1,9 @@\n use super::{\n+    AggregationContext, AggregationNode, StackVec,\n     balance_queue::BalanceQueue,\n     in_progress::start_in_progress_all,\n     notify_new_follower,\n-    optimize::{optimize_aggregation_number_for_followers, MAX_FOLLOWERS},\n-    AggregationContext, AggregationNode, StackVec,\n+    optimize::{MAX_FOLLOWERS, optimize_aggregation_number_for_followers},\n };\n \n /// Add a follower to a node. Followers will be propagated to the uppers of the"
        },
        {
            "sha": "c7088a31bbaa0172757a5d51a9db244b8f1861be",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/in_progress.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fin_progress.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fin_progress.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fin_progress.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,6 +1,6 @@\n use std::{hash::Hash, mem::take};\n \n-use super::{balance_queue::BalanceQueue, AggregationContext, AggregationNode, StackVec};\n+use super::{AggregationContext, AggregationNode, StackVec, balance_queue::BalanceQueue};\n \n impl<I: Clone + Eq + Hash, D> AggregationNode<I, D> {\n     /// Finishes an in progress operation. This might enqueue balancing"
        },
        {
            "sha": "1a74d201c1d6ee683e62c2dc6971c4e2d0d46e1d",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/increase.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fincrease.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fincrease.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fincrease.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,8 +1,8 @@\n use std::{hash::Hash, mem::take};\n \n use super::{\n-    balance_queue::BalanceQueue, AggegatingNode, AggregationContext, AggregationNode,\n-    AggregationNodeGuard, PreparedInternalOperation, PreparedOperation, StackVec,\n+    AggegatingNode, AggregationContext, AggregationNode, AggregationNodeGuard,\n+    PreparedInternalOperation, PreparedOperation, StackVec, balance_queue::BalanceQueue,\n };\n pub(super) const LEAF_NUMBER: u32 = 16;\n "
        },
        {
            "sha": "369d7d477889124dce894e52c6003dd8f82cd053",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/loom_tests.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Floom_tests.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Floom_tests.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Floom_tests.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -2,20 +2,20 @@ use std::{\n     fmt::Debug,\n     hash::Hash,\n     ops::{Deref, DerefMut},\n-    sync::{atomic::AtomicU32, Arc},\n+    sync::{Arc, atomic::AtomicU32},\n };\n \n use loom::{\n     sync::{Mutex, MutexGuard},\n     thread,\n };\n-use rand::{rngs::SmallRng, Rng, SeedableRng};\n+use rand::{Rng, SeedableRng, rngs::SmallRng};\n use ref_cast::RefCast;\n use rstest::*;\n \n use super::{\n-    aggregation_data, handle_new_edge, AggregationContext, AggregationNode, AggregationNodeGuard,\n-    PreparedOperation,\n+    AggregationContext, AggregationNode, AggregationNodeGuard, PreparedOperation, aggregation_data,\n+    handle_new_edge,\n };\n \n struct Node {"
        },
        {
            "sha": "979fe30f7c58bf0e54de72dec8635b589d85f152",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/lost_edge.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Flost_edge.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Flost_edge.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Flost_edge.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,9 +1,9 @@\n use std::hash::Hash;\n \n use super::{\n+    AggregationContext, AggregationNode, PreparedInternalOperation, PreparedOperation, StackVec,\n     balance_queue::BalanceQueue, in_progress::start_in_progress_count,\n-    notify_lost_follower::PreparedNotifyLostFollower, AggregationContext, AggregationNode,\n-    PreparedInternalOperation, PreparedOperation, StackVec,\n+    notify_lost_follower::PreparedNotifyLostFollower,\n };\n \n impl<I: Clone + Eq + Hash, D> AggregationNode<I, D> {"
        },
        {
            "sha": "962f64d42a681be4dd8d6277614038113d462308",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/mod.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fmod.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -24,12 +24,12 @@ mod tests;\n mod uppers;\n mod util;\n \n-pub use aggregation_data::{aggregation_data, AggregationDataGuard};\n+pub use aggregation_data::{AggregationDataGuard, aggregation_data};\n use balance_edge::balance_edge;\n use increase::increase_aggregation_number_internal;\n pub use new_edge::handle_new_edge;\n use notify_new_follower::notify_new_follower;\n-pub use root_query::{query_root_info, RootQuery};\n+pub use root_query::{RootQuery, query_root_info};\n \n use self::balance_queue::BalanceQueue;\n \n@@ -195,10 +195,10 @@ impl<C: AggregationContext, T: PreparedInternalOperation<C>, const N: usize>\n pub trait AggregationContext {\n     type NodeRef: Clone + Eq + Hash + Debug + 'static;\n     type Guard<'l>: AggregationNodeGuard<\n-        NodeRef = Self::NodeRef,\n-        Data = Self::Data,\n-        DataChange = Self::DataChange,\n-    >\n+            NodeRef = Self::NodeRef,\n+            Data = Self::Data,\n+            DataChange = Self::DataChange,\n+        >\n     where\n         Self: 'l;\n     type Data: 'static;"
        },
        {
            "sha": "1b13c848ff476953a7355f2263ba7b9a6c2770e7",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/new_edge.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fnew_edge.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fnew_edge.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fnew_edge.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,14 +1,14 @@\n use super::{\n+    AggregationContext, AggregationNode, PreparedInternalOperation, PreparedOperation, StackVec,\n     balance_queue::BalanceQueue,\n     in_progress::start_in_progress_all,\n     increase::{\n-        increase_aggregation_number_immediately, IncreaseReason,\n-        PreparedInternalIncreaseAggregationNumber, LEAF_NUMBER,\n+        IncreaseReason, LEAF_NUMBER, PreparedInternalIncreaseAggregationNumber,\n+        increase_aggregation_number_immediately,\n     },\n     increase_aggregation_number_internal, notify_new_follower,\n     notify_new_follower::PreparedNotifyNewFollower,\n     optimize::optimize_aggregation_number_for_uppers,\n-    AggregationContext, AggregationNode, PreparedInternalOperation, PreparedOperation, StackVec,\n };\n \n const BUFFER_SPACE: u32 = 2;\n@@ -25,7 +25,7 @@ pub fn handle_new_edge<C: AggregationContext>(\n     origin_id: &C::NodeRef,\n     target_id: &C::NodeRef,\n     number_of_children: usize,\n-) -> impl PreparedOperation<C> {\n+) -> impl PreparedOperation<C> + use<C> {\n     match **origin {\n         AggregationNode::Leaf {\n             ref mut aggregation_number,"
        },
        {
            "sha": "7130080567450d30dba20b2398f31c78df05634c",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/notify_lost_follower.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fnotify_lost_follower.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fnotify_lost_follower.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fnotify_lost_follower.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,11 +1,11 @@\n use std::{hash::Hash, thread::yield_now};\n \n use super::{\n+    AggegatingNode, AggregationContext, AggregationNode, AggregationNodeGuard,\n+    PreparedInternalOperation, PreparedOperation, StackVec,\n     balance_queue::BalanceQueue,\n     in_progress::{finish_in_progress_without_node, start_in_progress, start_in_progress_all},\n     util::get_aggregated_remove_change,\n-    AggegatingNode, AggregationContext, AggregationNode, AggregationNodeGuard,\n-    PreparedInternalOperation, PreparedOperation, StackVec,\n };\n use crate::count_hash_set::RemoveIfEntryResult;\n "
        },
        {
            "sha": "4b41cbf6e813346ef744b46422131c1c4da9a4da",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/notify_new_follower.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fnotify_new_follower.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fnotify_new_follower.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fnotify_new_follower.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,14 +1,14 @@\n use std::{cmp::Ordering, hash::Hash};\n \n use super::{\n+    AggregationContext, AggregationNode, PreparedInternalOperation, StackVec,\n     balance_queue::BalanceQueue,\n     followers::add_follower,\n     in_progress::{finish_in_progress_without_node, start_in_progress},\n     increase::IncreaseReason,\n     increase_aggregation_number_internal,\n     optimize::optimize_aggregation_number_for_uppers,\n     uppers::add_upper,\n-    AggregationContext, AggregationNode, PreparedInternalOperation, StackVec,\n };\n \n const MAX_AFFECTED_NODES: usize = 4096;"
        },
        {
            "sha": "47c0356d47d8d017aabb567594acd084cba7f933",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/optimize.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Foptimize.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Foptimize.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Foptimize.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,9 +1,9 @@\n use tracing::Level;\n \n use super::{\n-    balance_queue::BalanceQueue,\n-    increase::{increase_aggregation_number_internal, IncreaseReason, LEAF_NUMBER},\n     AggregationContext, StackVec,\n+    balance_queue::BalanceQueue,\n+    increase::{IncreaseReason, LEAF_NUMBER, increase_aggregation_number_internal},\n };\n \n pub const MAX_UPPERS: usize = 512;"
        },
        {
            "sha": "7cf70e45d3fca3a0e7e1d8a9b9ba7d6c819738df",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/tests.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Ftests.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Ftests.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Ftests.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -4,25 +4,25 @@ use std::{\n     iter::once,\n     ops::{ControlFlow, Deref, DerefMut},\n     sync::{\n-        atomic::{AtomicU32, Ordering},\n         Arc,\n+        atomic::{AtomicU32, Ordering},\n     },\n     time::Instant,\n };\n \n use parking_lot::{Mutex, MutexGuard};\n-use rand::{rngs::SmallRng, Rng, SeedableRng};\n+use rand::{Rng, SeedableRng, rngs::SmallRng};\n use ref_cast::RefCast;\n use rstest::*;\n use rustc_hash::FxHashSet;\n use turbo_tasks::FxIndexSet;\n \n use self::aggregation_data::prepare_aggregation_data;\n use super::{\n-    aggregation_data, handle_new_edge, lost_edge::handle_lost_edges, AggregationContext,\n-    AggregationNode, AggregationNodeGuard, RootQuery,\n+    AggregationContext, AggregationNode, AggregationNodeGuard, RootQuery, aggregation_data,\n+    handle_new_edge, lost_edge::handle_lost_edges,\n };\n-use crate::aggregation::{query_root_info, PreparedOperation, StackVec};\n+use crate::aggregation::{PreparedOperation, StackVec, query_root_info};\n \n fn find_root(mut node: NodeRef) -> NodeRef {\n     loop {"
        },
        {
            "sha": "49c8063794f920f32be641d458d8e6f0686f773b",
            "filename": "turbopack/crates/turbo-tasks-memory/src/aggregation/uppers.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fuppers.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fuppers.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Faggregation%2Fuppers.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,9 +1,9 @@\n use super::{\n-    balance_queue::BalanceQueue,\n-    in_progress::start_in_progress_count,\n-    optimize::{optimize_aggregation_number_for_uppers, MAX_UPPERS},\n     AggegatingNode, AggregationContext, AggregationNode, AggregationNodeGuard,\n     PreparedInternalOperation, PreparedOperation, StackVec,\n+    balance_queue::BalanceQueue,\n+    in_progress::start_in_progress_count,\n+    optimize::{MAX_UPPERS, optimize_aggregation_number_for_uppers},\n };\n \n /// Adds an upper node to a node. Returns the number of affected nodes by this"
        },
        {
            "sha": "2124f937a4e40cbe5a9b86b4ddb2567cb4438662",
            "filename": "turbopack/crates/turbo-tasks-memory/src/cell.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fcell.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fcell.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fcell.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,9 +1,9 @@\n use std::{fmt::Debug, mem::replace};\n \n use turbo_tasks::{\n+    TaskId, TaskIdSet, TurboTasksBackendApi,\n     backend::CellContent,\n     event::{Event, EventListener},\n-    TaskId, TaskIdSet, TurboTasksBackendApi,\n };\n \n use crate::MemoryBackend;"
        },
        {
            "sha": "1c24879675e47495010428c2eee80318f5c061ce",
            "filename": "turbopack/crates/turbo-tasks-memory/src/count_hash_set.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fcount_hash_set.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fcount_hash_set.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fcount_hash_set.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -6,8 +6,8 @@ use std::{\n };\n \n use auto_hash_map::{\n-    map::{Entry, Iter, RawEntry},\n     AutoMap,\n+    map::{Entry, Iter, RawEntry},\n };\n use rustc_hash::FxHasher;\n \n@@ -277,11 +277,7 @@ impl<T: Eq + Hash + Clone, H: BuildHasher + Default> CountHashSet<T, H> {\n }\n \n fn filter<'a, T>((k, v): (&'a T, &'a isize)) -> Option<&'a T> {\n-    if *v > 0 {\n-        Some(k)\n-    } else {\n-        None\n-    }\n+    if *v > 0 { Some(k) } else { None }\n }\n \n type InnerIter<'a, T> ="
        },
        {
            "sha": "87b4367212aae0a9edc85bba374a931dc49eca1e",
            "filename": "turbopack/crates/turbo-tasks-memory/src/edges_set.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fedges_set.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fedges_set.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fedges_set.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,6 +1,6 @@\n use std::{hash::BuildHasherDefault, mem::replace};\n \n-use auto_hash_map::{map::Entry, AutoMap, AutoSet};\n+use auto_hash_map::{AutoMap, AutoSet, map::Entry};\n use either::Either;\n use rustc_hash::FxHasher;\n use smallvec::SmallVec;"
        },
        {
            "sha": "dc339d840d8d1e9cb942ef47d1aeb6904b7648cf",
            "filename": "turbopack/crates/turbo-tasks-memory/src/gc.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 11,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fgc.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fgc.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fgc.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,5 +1,5 @@\n use std::{\n-    cmp::{max, Reverse},\n+    cmp::{Reverse, max},\n     collections::VecDeque,\n     fmt::Debug,\n     mem::take,\n@@ -11,10 +11,10 @@ use std::{\n use concurrent_queue::ConcurrentQueue;\n use dashmap::DashSet;\n use parking_lot::Mutex;\n-use tracing::field::{debug, Empty};\n+use tracing::field::{Empty, debug};\n use turbo_tasks::{TaskId, TurboTasksBackendApi};\n \n-use crate::{task::GcResult, MemoryBackend};\n+use crate::{MemoryBackend, task::GcResult};\n \n /// The priority of a task for garbage collection.\n /// Any action will shrink the internal memory structures of the task in a\n@@ -174,7 +174,7 @@ impl GcQueue {\n             self.incoming_tasks_count\n                 .fetch_sub(TASKS_PER_NEW_GENERATION, Ordering::Release);\n             // We are selected to move TASKS_PER_NEW_GENERATION tasks into a generation\n-            let gen = unsafe {\n+            let generation = unsafe {\n                 // SAFETY: We are sure that the generation is not 0, since we start at 1.\n                 NonZeroU32::new_unchecked(self.generation.fetch_add(1, Ordering::Relaxed))\n             };\n@@ -191,11 +191,10 @@ impl GcQueue {\n                     }\n                 }\n             }\n-            self.generations.lock().push_front(OldGeneration {\n-                tasks,\n-                generation: gen,\n-            });\n-            gen\n+            self.generations\n+                .lock()\n+                .push_front(OldGeneration { tasks, generation });\n+            generation\n         } else {\n             self.generation()\n         }\n@@ -251,8 +250,8 @@ impl GcQueue {\n         for (i, task) in tasks.iter().enumerate() {\n             backend.with_task(*task, |task| {\n                 if let Some(state) = task.gc_state() {\n-                    if let Some(gen) = state.generation {\n-                        if gen <= generation {\n+                    if let Some(task_generation) = state.generation {\n+                        if task_generation <= generation {\n                             indices.push((Reverse(state.priority), i as u32));\n                         }\n                     }"
        },
        {
            "sha": "4db5004a9ec60d448d344d8c078c29163aa62416",
            "filename": "turbopack/crates/turbo-tasks-memory/src/memory_backend.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fmemory_backend.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fmemory_backend.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Fmemory_backend.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -5,28 +5,28 @@ use std::{\n     num::NonZeroU32,\n     pin::Pin,\n     sync::{\n-        atomic::{AtomicBool, AtomicUsize, Ordering},\n         Arc,\n+        atomic::{AtomicBool, AtomicUsize, Ordering},\n     },\n     time::Duration,\n };\n \n-use anyhow::{anyhow, bail, Result};\n+use anyhow::{Result, anyhow, bail};\n use auto_hash_map::AutoMap;\n-use dashmap::{mapref::entry::Entry, DashMap};\n+use dashmap::{DashMap, mapref::entry::Entry};\n use rustc_hash::FxHasher;\n use tracing::trace_span;\n use turbo_prehash::{BuildHasherExt, PassThroughHash, PreHashed};\n use turbo_tasks::{\n+    CellId, FunctionId, RawVc, ReadCellOptions, ReadConsistency, TRANSIENT_TASK_BIT, TaskId,\n+    TaskIdSet, TraitTypeId, TurboTasksBackendApi, Unused, ValueTypeId,\n     backend::{\n         Backend, BackendJobId, CachedTaskType, CellContent, TaskCollectiblesMap, TaskExecutionSpec,\n         TransientTaskType, TypedCellContent,\n     },\n     event::EventListener,\n     task_statistics::TaskStatisticsApi,\n     util::{IdFactoryWithReuse, NoMoveVec},\n-    CellId, FunctionId, RawVc, ReadCellOptions, ReadConsistency, TaskId, TaskIdSet, TraitTypeId,\n-    TurboTasksBackendApi, Unused, ValueTypeId, TRANSIENT_TASK_BIT,\n };\n \n use crate::{"
        },
        {
            "sha": "47fd63eb2b330facf669a6f50493eab9fd5ed311",
            "filename": "turbopack/crates/turbo-tasks-memory/src/output.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Foutput.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Foutput.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Foutput.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -1,8 +1,8 @@\n use std::{borrow::Cow, fmt::Debug, mem::take};\n \n-use anyhow::{anyhow, Error, Result};\n+use anyhow::{Error, Result, anyhow};\n use turbo_tasks::{\n-    util::SharedError, OutputContent, RawVc, TaskId, TaskIdSet, TurboTasksBackendApi,\n+    OutputContent, RawVc, TaskId, TaskIdSet, TurboTasksBackendApi, util::SharedError,\n };\n \n use crate::MemoryBackend;"
        },
        {
            "sha": "ede71cf441b75a695c1fe7c58c34ba51e7e0aac9",
            "filename": "turbopack/crates/turbo-tasks-memory/src/task.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 7,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Ftask.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Ftask.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Ftask.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -6,7 +6,7 @@ use std::{\n     mem::{replace, take},\n     num::NonZeroU32,\n     pin::Pin,\n-    sync::{atomic::AtomicU32, Arc},\n+    sync::{Arc, atomic::AtomicU32},\n     time::Duration,\n };\n \n@@ -19,22 +19,23 @@ use smallvec::SmallVec;\n use tracing::Span;\n use turbo_prehash::PreHashed;\n use turbo_tasks::{\n+    CellId, Invalidator, RawVc, ReadConsistency, TaskId, TaskIdSet, TraitTypeId,\n+    TurboTasksBackendApi, TurboTasksBackendApiExt, ValueTypeId,\n     backend::{CachedTaskType, CellContent, TaskCollectiblesMap, TaskExecutionSpec},\n     event::{Event, EventListener},\n-    get_invalidator, registry, CellId, Invalidator, RawVc, ReadConsistency, TaskId, TaskIdSet,\n-    TraitTypeId, TurboTasksBackendApi, TurboTasksBackendApiExt, ValueTypeId,\n+    get_invalidator, registry,\n };\n \n use crate::{\n+    MemoryBackend,\n     aggregation::{\n-        aggregation_data, handle_new_edge, query_root_info, AggregationDataGuard, PreparedOperation,\n+        AggregationDataGuard, PreparedOperation, aggregation_data, handle_new_edge, query_root_info,\n     },\n     cell::{Cell, ReadContentError},\n     edges_set::{TaskEdge, TaskEdgesList, TaskEdgesSet},\n     gc::{GcQueue, GcTaskState},\n     output::Output,\n     task::aggregation::{TaskAggregationContext, TaskChange},\n-    MemoryBackend,\n };\n \n pub type NativeTaskFuture = Pin<Box<dyn Future<Output = Result<RawVc>> + Send>>;\n@@ -625,12 +626,12 @@ impl Task {\n     fn get_event_description_static(\n         id: TaskId,\n         ty: &TaskType,\n-    ) -> impl Fn() -> String + Send + Sync + Clone {\n+    ) -> impl Fn() -> String + Send + Sync + Clone + 'static {\n         let ty = TaskTypeForDescription::from(ty);\n         move || Self::format_description(&ty, id)\n     }\n \n-    fn get_event_description(&self) -> impl Fn() -> String + Send + Sync + Clone {\n+    fn get_event_description(&self) -> impl Fn() -> String + Send + Sync + Clone + 'static {\n         Self::get_event_description_static(self.id, &self.ty)\n     }\n "
        },
        {
            "sha": "eb2d88b7ba5723637cd1b1cc59e6f9b3e12399ce",
            "filename": "turbopack/crates/turbo-tasks-memory/src/task/aggregation.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Ftask%2Faggregation.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Ftask%2Faggregation.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Ftask%2Faggregation.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -6,25 +6,25 @@ use std::{\n     sync::atomic::AtomicU32,\n };\n \n-use auto_hash_map::{map::Entry, AutoMap};\n+use auto_hash_map::{AutoMap, map::Entry};\n use either::Either;\n use parking_lot::Mutex;\n use rustc_hash::FxHasher;\n use turbo_tasks::{\n-    backend::TaskCollectiblesMap, event::Event, RawVc, TaskId, TaskIdSet, TraitTypeId,\n-    TurboTasksBackendApi,\n+    RawVc, TaskId, TaskIdSet, TraitTypeId, TurboTasksBackendApi, backend::TaskCollectiblesMap,\n+    event::Event,\n };\n \n use super::{\n-    meta_state::{FullTaskWriteGuard, TaskMetaStateWriteGuard},\n     InProgressState, TaskStateType,\n+    meta_state::{FullTaskWriteGuard, TaskMetaStateWriteGuard},\n };\n use crate::{\n+    MemoryBackend,\n     aggregation::{\n-        aggregation_data, AggregationContext, AggregationDataGuard, AggregationNode,\n-        AggregationNodeGuard, RootQuery,\n+        AggregationContext, AggregationDataGuard, AggregationNode, AggregationNodeGuard, RootQuery,\n+        aggregation_data,\n     },\n-    MemoryBackend,\n };\n \n pub enum RootType {"
        },
        {
            "sha": "b9c42dc7c5214dad706fdc423ca4b4c816cc0f2e",
            "filename": "turbopack/crates/turbo-tasks-testing/tests/scope_stress.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fscope_stress.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1226d7e47c54173f568c9dd4bf87ef09f22122b5/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fscope_stress.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-testing%2Ftests%2Fscope_stress.rs?ref=1226d7e47c54173f568c9dd4bf87ef09f22122b5",
            "patch": "@@ -3,8 +3,8 @@\n #![allow(clippy::needless_return)] // tokio macro-generated code doesn't respect this\n \n use anyhow::Result;\n-use turbo_tasks::{run_once, Completion, TryJoinIterExt, Vc};\n-use turbo_tasks_testing::{register, run_with_tt, Registration};\n+use turbo_tasks::{Completion, TryJoinIterExt, Vc, run_once};\n+use turbo_tasks_testing::{Registration, register, run_with_tt};\n \n static REGISTRATION: Registration = register!();\n "
        }
    ],
    "stats": {
        "total": 158,
        "additions": 77,
        "deletions": 81
    }
}