{
    "author": "SyMind",
    "message": "feat: using eval source map plugin for Rspack (#79199)\n\nUse rspack.EvalSourceMapDevToolPlugin when running with Rspack\n\nThe modification specifically pass the test case in:\ntest/integration/server-side-dev-errors/test/index.test.js",
    "sha": "401bfe05f4adeb967586848642d8ee62759f707c",
    "files": [
        {
            "sha": "ff65ff76c59987e3b4eef0034b1c6d26db82cccc",
            "filename": "packages/next/src/build/webpack/config/blocks/base.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/401bfe05f4adeb967586848642d8ee62759f707c/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fconfig%2Fblocks%2Fbase.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/401bfe05f4adeb967586848642d8ee62759f707c/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fconfig%2Fblocks%2Fbase.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fconfig%2Fblocks%2Fbase.ts?ref=401bfe05f4adeb967586848642d8ee62759f707c",
            "patch": "@@ -4,6 +4,7 @@ import { COMPILER_NAMES } from '../../../../shared/lib/constants'\n import type { ConfigurationContext } from '../utils'\n import DevToolsIgnorePlugin from '../../plugins/devtools-ignore-list-plugin'\n import EvalSourceMapDevToolPlugin from '../../plugins/eval-source-map-dev-tool-plugin'\n+import { getRspackCore } from '../../../../shared/lib/get-rspack'\n \n function shouldIgnorePath(modulePath: string): boolean {\n   return (\n@@ -65,15 +66,23 @@ export const base = curry(function base(\n         shouldIgnorePath,\n       })\n     )\n-  } else if (config.devtool === 'eval-source-map' && !process.env.NEXT_RSPACK) {\n+  } else if (config.devtool === 'eval-source-map') {\n     // We're using a fork of `eval-source-map`\n     config.devtool = false\n-    config.plugins.push(\n-      new EvalSourceMapDevToolPlugin({\n-        moduleFilenameTemplate: config.output?.devtoolModuleFilenameTemplate,\n-        shouldIgnorePath,\n-      })\n-    )\n+    if (process.env.NEXT_RSPACK) {\n+      config.plugins.push(\n+        new (getRspackCore().EvalSourceMapDevToolPlugin)({\n+          moduleFilenameTemplate: config.output?.devtoolModuleFilenameTemplate,\n+        })\n+      )\n+    } else {\n+      config.plugins.push(\n+        new EvalSourceMapDevToolPlugin({\n+          moduleFilenameTemplate: config.output?.devtoolModuleFilenameTemplate,\n+          shouldIgnorePath,\n+        })\n+      )\n+    }\n   }\n \n   // TODO: add codemod for \"Should not import the named export\" with JSON files"
        },
        {
            "sha": "e32d82ce7df84a67b1e3093faf41a3f100498862",
            "filename": "test/integration/server-side-dev-errors/test/index.test.js",
            "status": "modified",
            "additions": 4,
            "deletions": 6,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/401bfe05f4adeb967586848642d8ee62759f707c/test%2Fintegration%2Fserver-side-dev-errors%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/401bfe05f4adeb967586848642d8ee62759f707c/test%2Fintegration%2Fserver-side-dev-errors%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fserver-side-dev-errors%2Ftest%2Findex.test.js?ref=401bfe05f4adeb967586848642d8ee62759f707c",
            "patch": "@@ -12,8 +12,6 @@ import {\n } from 'next-test-utils'\n import stripAnsi from 'strip-ansi'\n \n-const isRspack = process.env.NEXT_RSPACK !== undefined\n-\n const appDir = join(__dirname, '../')\n const gspPage = join(appDir, 'pages/gsp.js')\n const gsspPage = join(appDir, 'pages/gssp.js')\n@@ -369,7 +367,7 @@ describe('server-side dev errors', () => {\n       )\n       .trim()\n     // FIXME(veil): error repeated\n-    if (isTurbopack || isRspack) {\n+    if (isTurbopack) {\n       expect(stderrOutput).toMatchInlineSnapshot(`\n         \"Error: catch this rejection\n             at Timeout._onTimeout (../../test/integration/server-side-dev-errors/pages/uncaught-rejection.js:7:19)\n@@ -448,7 +446,7 @@ describe('server-side dev errors', () => {\n       )\n       .trim()\n     // FIXME(veil): error repeated\n-    if (isTurbopack || isRspack) {\n+    if (isTurbopack) {\n       expect(stderrOutput).toMatchInlineSnapshot(`\n        \"Error: \n            at Timeout._onTimeout (../../test/integration/server-side-dev-errors/pages/uncaught-empty-rejection.js:7:19)\n@@ -526,7 +524,7 @@ describe('server-side dev errors', () => {\n       )\n       .trim()\n     // FIXME(veil): error repeated\n-    if (isTurbopack || isRspack) {\n+    if (isTurbopack) {\n       expect(stderrOutput).toMatchInlineSnapshot(`\n         \"Error: catch this exception\n             at Timeout._onTimeout (../../test/integration/server-side-dev-errors/pages/uncaught-exception.js:7:10)\n@@ -604,7 +602,7 @@ describe('server-side dev errors', () => {\n       )\n       .trim()\n     // FIXME(veil): error repeated\n-    if (isTurbopack || isRspack) {\n+    if (isTurbopack) {\n       expect(stderrOutput).toMatchInlineSnapshot(`\n        \"Error: \n            at Timeout._onTimeout (../../test/integration/server-side-dev-errors/pages/uncaught-empty-exception.js:7:10)"
        }
    ],
    "stats": {
        "total": 33,
        "additions": 20,
        "deletions": 13
    }
}