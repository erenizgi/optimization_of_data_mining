{
    "author": "bgw",
    "message": "fix(next-swc-wasm): Only enable turbo-rcstr's napi feature when building the next-swc-napi crate/package (#80390)\n\nFixes https://vercel.slack.com/archives/C04KC8A53T7/p1749584921462879\n\n```\npnpm swc-build-wasm\n```",
    "sha": "624df11aedfc6282f349d8d687b2ee980f7e643e",
    "files": [
        {
            "sha": "fb937ea2d4a08813e63bd79e18db4ee8eecece22",
            "filename": "Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/624df11aedfc6282f349d8d687b2ee980f7e643e/Cargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/624df11aedfc6282f349d8d687b2ee980f7e643e/Cargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.toml?ref=624df11aedfc6282f349d8d687b2ee980f7e643e",
            "patch": "@@ -250,7 +250,7 @@ next-custom-transforms = { path = \"crates/next-custom-transforms\" }\n # Turbopack\n auto-hash-map = { path = \"turbopack/crates/turbo-tasks-auto-hash-map\" }\n turbo-prehash = { path = \"turbopack/crates/turbo-prehash\" }\n-turbo-rcstr = { path = \"turbopack/crates/turbo-rcstr\", features = [\"napi\"] }\n+turbo-rcstr = { path = \"turbopack/crates/turbo-rcstr\" }\n turbo-esregex = { path = \"turbopack/crates/turbo-esregex\" }\n turbo-persistence = { path = \"turbopack/crates/turbo-persistence\" }\n turbo-tasks-malloc = { path = \"turbopack/crates/turbo-tasks-malloc\", default-features = false }"
        },
        {
            "sha": "ca9543bd35763066720478c56a5c6e5133a24c66",
            "filename": "crates/napi/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/624df11aedfc6282f349d8d687b2ee980f7e643e/crates%2Fnapi%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/624df11aedfc6282f349d8d687b2ee980f7e643e/crates%2Fnapi%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnapi%2FCargo.toml?ref=624df11aedfc6282f349d8d687b2ee980f7e643e",
            "patch": "@@ -98,7 +98,7 @@ swc_core = { workspace = true, features = [\n [target.'cfg(not(target_arch = \"wasm32\"))'.dependencies]\n lightningcss-napi = { workspace = true }\n tokio = { workspace = true, features = [\"full\"] }\n-turbo-rcstr = { workspace = true }\n+turbo-rcstr = { workspace = true, features = [\"napi\"] }\n turbo-tasks = { workspace = true }\n turbo-tasks-backend = { workspace = true }\n turbo-tasks-fs = { workspace = true }"
        },
        {
            "sha": "3737f78c32d782a6044cd379ad9035cba3797ce7",
            "filename": "packages/next/src/build/swc/generated-wasm.d.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 40,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/624df11aedfc6282f349d8d687b2ee980f7e643e/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Fgenerated-wasm.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/624df11aedfc6282f349d8d687b2ee980f7e643e/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Fgenerated-wasm.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Fgenerated-wasm.d.ts?ref=624df11aedfc6282f349d8d687b2ee980f7e643e",
            "patch": "@@ -3,51 +3,11 @@\n \n /* tslint:disable */\n /* eslint-disable */\n-/**\n- * @param {string} s\n- * @param {any} opts\n- * @returns {any}\n- */\n export function minifySync(s: string, opts: any): any\n-/**\n- * @param {string} s\n- * @param {any} opts\n- * @returns {Promise<any>}\n- */\n export function minify(s: string, opts: any): Promise<any>\n-/**\n- * @param {any} s\n- * @param {any} opts\n- * @returns {any}\n- */\n export function transformSync(s: any, opts: any): any\n-/**\n- * @param {any} s\n- * @param {any} opts\n- * @returns {Promise<any>}\n- */\n export function transform(s: any, opts: any): Promise<any>\n-/**\n- * @param {string} s\n- * @param {any} opts\n- * @returns {any}\n- */\n export function parseSync(s: string, opts: any): any\n-/**\n- * @param {string} s\n- * @param {any} opts\n- * @returns {Promise<any>}\n- */\n export function parse(s: string, opts: any): Promise<any>\n-/**\n- * @param {string} value\n- * @param {any} opts\n- * @returns {any}\n- */\n export function mdxCompileSync(value: string, opts: any): any\n-/**\n- * @param {string} value\n- * @param {any} opts\n- * @returns {Promise<any>}\n- */\n export function mdxCompile(value: string, opts: any): Promise<any>"
        },
        {
            "sha": "6e72ff67b9f5dccf00b03da05ffe774084e5a943",
            "filename": "turbopack/crates/turbo-rcstr/Cargo.toml",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/624df11aedfc6282f349d8d687b2ee980f7e643e/turbopack%2Fcrates%2Fturbo-rcstr%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/624df11aedfc6282f349d8d687b2ee980f7e643e/turbopack%2Fcrates%2Fturbo-rcstr%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-rcstr%2FCargo.toml?ref=624df11aedfc6282f349d8d687b2ee980f7e643e",
            "patch": "@@ -15,9 +15,11 @@ turbo-tasks-hash = { workspace = true }\n serde = { workspace = true }\n new_debug_unreachable = \"1.0.6\"\n shrink-to-fit = { workspace = true }\n-napi = { workspace = true, optional = true }\n rustc-hash = { workspace = true }\n \n+[target.'cfg(not(target_family = \"wasm\"))'.dependencies]\n+napi = { workspace = true, optional = true }\n+\n [dev-dependencies]\n criterion = { workspace = true }\n "
        },
        {
            "sha": "85444d98b73bdbdd26309d1654d0b4898a7b1f38",
            "filename": "turbopack/crates/turbo-rcstr/src/lib.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/624df11aedfc6282f349d8d687b2ee980f7e643e/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/624df11aedfc6282f349d8d687b2ee980f7e643e/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-rcstr%2Fsrc%2Flib.rs?ref=624df11aedfc6282f349d8d687b2ee980f7e643e",
            "patch": "@@ -361,7 +361,10 @@ impl ShrinkToFit for RcStr {\n     fn shrink_to_fit(&mut self) {}\n }\n \n-#[cfg(feature = \"napi\")]\n+#[cfg(all(feature = \"napi\", target_family = \"wasm\"))]\n+compile_error!(\"The napi feature cannot be enabled for wasm targets\");\n+\n+#[cfg(all(feature = \"napi\", not(target_family = \"wasm\")))]\n mod napi_impl {\n     use napi::{\n         bindgen_prelude::{FromNapiValue, ToNapiValue, TypeName, ValidateNapiValue},"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 9,
        "deletions": 44
    }
}