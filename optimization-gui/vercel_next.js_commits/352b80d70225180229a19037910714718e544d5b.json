{
    "author": "lukesandberg",
    "message": "[turbopack] Replace uses of `Value<Pattern>` with just `Pattern`\n (#80134)\n\nReplace uses of `Value<Pattern>` in the resolve crate with `Pattern`\n\nThis required a manual implementation of `TaskInput` which ended up being trivial since there are no captured `Vcs`. However, the `derive` macro failed because it is a recursive type.\n\n### Why?\nThe Value<> type is confusing and error prone, lets destroy it!\n\nAs discussed over slack, turbo_tasks::Value type always implements is_resolved as true and is_transient as false which is incorrect and can enable smuggling transient vcs into turbo tasks.\n\n• https://vercel.slack.com/archives/C03EWR7LGEN/p1743456121241529\n• https://vercel.slack.com/archives/C04NGV98TPS/p1743455453764879",
    "sha": "352b80d70225180229a19037910714718e544d5b",
    "files": [
        {
            "sha": "04ca29db36847a824296f02ac0cc0e17727d7edc",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -39,7 +39,7 @@ use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    Completion, FxIndexSet, NonLocalValue, ResolvedVc, TryJoinIterExt, Value, ValueToString, Vc,\n+    Completion, FxIndexSet, NonLocalValue, ResolvedVc, TryJoinIterExt, ValueToString, Vc,\n     fxindexmap, fxindexset, trace::TraceRawVcs,\n };\n use turbo_tasks_env::{CustomProcessEnv, ProcessEnv};\n@@ -823,9 +823,9 @@ impl AppProject {\n                 client_module_context,\n                 self.project().project_path().join(rcstr!(\"_\")),\n             )),\n-            Request::parse(Value::new(Pattern::Constant(rcstr!(\n+            Request::parse(Pattern::Constant(rcstr!(\n                 \"next/dist/client/app-next-turbopack.js\"\n-            )))),\n+            ))),\n             None,\n             false,\n         )"
        },
        {
            "sha": "8eec2b9961dc1d6223093ee21c340848d2ccb0ae",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -629,13 +629,12 @@ impl PagesProject {\n                 client_module_context,\n                 self.project().project_path().join(rcstr!(\"_\")),\n             )),\n-            Request::parse(Value::new(Pattern::Constant(\n+            Request::parse(Pattern::Constant(\n                 match *self.project().next_mode().await? {\n-                    NextMode::Development => \"next/dist/client/next-dev-turbopack.js\",\n-                    NextMode::Build => \"next/dist/client/next-turbopack.js\",\n-                }\n-                .into(),\n-            ))),\n+                    NextMode::Development => rcstr!(\"next/dist/client/next-dev-turbopack.js\"),\n+                    NextMode::Build => rcstr!(\"next/dist/client/next-turbopack.js\"),\n+                },\n+            )),\n             Value::new(EcmaScriptModulesReferenceSubType::Undefined),\n             false,\n             None,"
        },
        {
            "sha": "1bd795a4215f9ba498bb0186dec40a1e0208a83c",
            "filename": "crates/next-core/src/next_client/context.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -530,9 +530,9 @@ pub async fn get_client_runtime_entries(\n     if matches!(ty, ClientContextType::App { .. },) {\n         runtime_entries.push(\n             RuntimeEntry::Request(\n-                Request::parse(Value::new(Pattern::Constant(rcstr!(\n+                Request::parse(Pattern::Constant(rcstr!(\n                     \"next/dist/client/app-next-turbopack.js\"\n-                ))))\n+                )))\n                 .to_resolved()\n                 .await?,\n                 project_root.join(rcstr!(\"_\")).to_resolved().await?,"
        },
        {
            "sha": "53557c8165928abef9d93d12af75930085cbaf66",
            "filename": "crates/next-core/src/next_import_map.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -3,7 +3,7 @@ use std::collections::BTreeMap;\n use anyhow::{Context, Result};\n use rustc_hash::FxHashMap;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Value, Vc, fxindexmap};\n+use turbo_tasks::{FxIndexMap, ResolvedVc, Vc, fxindexmap};\n use turbo_tasks_fs::{FileSystem, FileSystemPath};\n use turbopack_core::{\n     reference_type::{CommonJsReferenceSubType, ReferenceType},\n@@ -1009,7 +1009,7 @@ pub async fn get_next_package(context_directory: Vc<FileSystemPath>) -> Result<V\n     let result = resolve(\n         context_directory,\n         ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n-        Request::parse(Value::new(Pattern::Constant(rcstr!(\"next/package.json\")))),\n+        Request::parse(Pattern::Constant(rcstr!(\"next/package.json\"))),\n         node_cjs_resolve_options(context_directory.root()),\n     );\n     let source = result"
        },
        {
            "sha": "45ffeffd774ae86a8c75d0d6ffee977cd8b0e298",
            "filename": "crates/next-core/src/next_shared/transforms/swc_ecma_transform_plugins.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fswc_ecma_transform_plugins.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fswc_ecma_transform_plugins.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fswc_ecma_transform_plugins.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -36,13 +36,13 @@ pub async fn get_swc_ecma_transform_rule_impl(\n     enable_mdx_rs: bool,\n ) -> Result<Option<ModuleRule>> {\n     use anyhow::bail;\n-    use turbo_tasks::{TryFlatJoinIterExt, Value};\n+    use turbo_tasks::TryFlatJoinIterExt;\n     use turbo_tasks_fs::FileContent;\n     use turbopack::{resolve_options, resolve_options_context::ResolveOptionsContext};\n     use turbopack_core::{\n         asset::Asset,\n         reference_type::{CommonJsReferenceSubType, ReferenceType},\n-        resolve::{handle_resolve_error, parse::Request, pattern::Pattern, resolve},\n+        resolve::{handle_resolve_error, parse::Request, resolve},\n     };\n     use turbopack_ecmascript_plugins::transform::swc_ecma_transform_plugins::{\n         SwcEcmaTransformPluginsTransformer, SwcPluginModule,\n@@ -58,7 +58,7 @@ pub async fn get_swc_ecma_transform_rule_impl(\n             // one for implicit package name resolves to node_modules,\n             // and one for explicit path to a .wasm binary.\n             // Current resolve will fail with latter.\n-            let request = Request::parse(Value::new(Pattern::Constant(name.as_str().into())));\n+            let request = Request::parse_string(name.clone());\n             let resolve_options = resolve_options(\n                 *project_path,\n                 ResolveOptionsContext {"
        },
        {
            "sha": "9838cad3e5ec631b79fadf015e5ff16c70481674",
            "filename": "crates/next-core/src/next_shared/webpack_rules/babel.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fwebpack_rules%2Fbabel.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fwebpack_rules%2Fbabel.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fwebpack_rules%2Fbabel.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{self, FileSystemEntryType, FileSystemPath};\n use turbopack::module_options::{LoaderRuleItem, OptionWebpackRules, WebpackRules};\n use turbopack_core::{\n@@ -115,9 +115,7 @@ pub async fn is_babel_loader_available(project_path: Vc<FileSystemPath>) -> Resu\n     let result = resolve(\n         project_path,\n         ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n-        Request::parse(Value::new(Pattern::Constant(\n-            \"babel-loader/package.json\".into(),\n-        ))),\n+        Request::parse(Pattern::Constant(\"babel-loader/package.json\".into())),\n         node_cjs_resolve_options(project_path),\n     );\n     let assets = result.primary_sources().await?;"
        },
        {
            "sha": "86a0f0fe29a39256a1b98aa41f79585134df7424",
            "filename": "turbopack/crates/turbopack-cli/src/build/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -259,14 +259,14 @@ async fn build_internal(\n         .map(|r| async move {\n             Ok(match r {\n                 EntryRequest::Relative(p) => Request::relative(\n-                    Value::new(p.clone().into()),\n+                    p.clone().into(),\n                     Default::default(),\n                     Default::default(),\n                     false,\n                 ),\n                 EntryRequest::Module(m, p) => Request::module(\n                     m.clone(),\n-                    Value::new(p.clone().into()),\n+                    p.clone().into(),\n                     Default::default(),\n                     Default::default(),\n                 ),"
        },
        {
            "sha": "7802d6b7cdb1b95af843cffdc522d20ff62fe4af",
            "filename": "turbopack/crates/turbopack-cli/src/dev/mod.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fmod.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -13,7 +13,7 @@ use owo_colors::OwoColorize;\n use rustc_hash::FxHashSet;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    NonLocalValue, OperationVc, ResolvedVc, TransientInstance, TurboTasks, UpdateInfo, Value, Vc,\n+    NonLocalValue, OperationVc, ResolvedVc, TransientInstance, TurboTasks, UpdateInfo, Vc,\n     trace::TraceRawVcs,\n     util::{FormatBytes, FormatDuration},\n };\n@@ -310,14 +310,14 @@ async fn source(\n         .iter()\n         .map(|r| match r {\n             EntryRequest::Relative(p) => Request::relative(\n-                Value::new(p.clone().into()),\n+                p.clone().into(),\n                 Default::default(),\n                 Default::default(),\n                 false,\n             ),\n             EntryRequest::Module(m, p) => Request::module(\n                 m.clone(),\n-                Value::new(p.clone().into()),\n+                p.clone().into(),\n                 Default::default(),\n                 Default::default(),\n             ),"
        },
        {
            "sha": "2dbbdcd901b3d98dd21d49d13a19b4d97dc4a742",
            "filename": "turbopack/crates/turbopack-core/src/resolve/mod.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 17,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -1924,8 +1924,7 @@ async fn resolve_internal_inline(\n             } => {\n                 let mut new_pat = path.clone();\n                 new_pat.push_front(rcstr!(\".\").into());\n-                let relative =\n-                    Request::relative(Value::new(new_pat), query.clone(), fragment.clone(), true);\n+                let relative = Request::relative(new_pat, query.clone(), fragment.clone(), true);\n \n                 if !has_alias {\n                     ResolvingIssue {\n@@ -2113,17 +2112,15 @@ async fn resolve_into_folder(\n                     {\n                         continue;\n                     }\n-                    let request = Request::parse(Value::new(normalized_request.into()))\n-                        .to_resolved()\n-                        .await?;\n+                    let request = Request::parse_string(normalized_request);\n \n                     // main field will always resolve not fully specified\n                     let options = if options_value.fully_specified {\n                         options.with_fully_specified(false).resolve().await?\n                     } else {\n                         options\n                     };\n-                    let result = &*resolve_internal_inline(*package_path, *request, options)\n+                    let result = &*resolve_internal_inline(*package_path, request, options)\n                         .await?\n                         .await?;\n                     // we are not that strict when a main field fails to resolve\n@@ -2158,7 +2155,7 @@ async fn resolve_into_folder(\n         ),\n     };\n \n-    let request = Request::parse(Value::new(pattern));\n+    let request = Request::parse(pattern);\n \n     Ok(resolve_internal_inline(*package_path, request, options)\n         .await?\n@@ -2438,7 +2435,7 @@ async fn apply_in_package(\n             return Ok(Some(\n                 resolve_internal(\n                     package_path,\n-                    Request::parse(Value::new(Pattern::Constant(value.into())))\n+                    Request::parse(Pattern::Constant(value.into()))\n                         .with_query(query.clone())\n                         .with_fragment(fragment.clone()),\n                     options,\n@@ -2452,7 +2449,7 @@ async fn apply_in_package(\n             severity: error_severity(options).await?,\n             file_path: *package_json_path,\n             request_type: format!(\"alias field ({field})\"),\n-            request: Request::parse(Value::new(Pattern::Constant(request)))\n+            request: Request::parse(Pattern::Constant(request))\n                 .to_resolved()\n                 .await?,\n             resolve_options: options.to_resolved().await?,\n@@ -2537,7 +2534,7 @@ async fn resolve_module_request(\n         && name == module\n     {\n         let result = resolve_into_package(\n-            Value::new(path.clone()),\n+            path.clone(),\n             **package_path,\n             query.clone(),\n             fragment.clone(),\n@@ -2572,7 +2569,7 @@ async fn resolve_module_request(\n         match *item {\n             FindPackageItem::PackageDirectory(package_path) => {\n                 results.push(resolve_into_package(\n-                    Value::new(path.clone()),\n+                    path.clone(),\n                     *package_path,\n                     query.clone(),\n                     fragment.clone(),\n@@ -2609,7 +2606,7 @@ async fn resolve_module_request(\n             rcstr!(\"/\").into(),\n             path.clone(),\n         ]);\n-        let relative = Request::relative(Value::new(pattern), query, fragment, true)\n+        let relative = Request::relative(pattern, query, fragment, true)\n             .to_resolved()\n             .await?;\n         let relative_result =\n@@ -2625,13 +2622,12 @@ async fn resolve_module_request(\n \n #[turbo_tasks::function]\n async fn resolve_into_package(\n-    path: Value<Pattern>,\n+    path: Pattern,\n     package_path: ResolvedVc<FileSystemPath>,\n     query: RcStr,\n     fragment: RcStr,\n     options: ResolvedVc<ResolveOptions>,\n ) -> Result<Vc<ResolveResult>> {\n-    let path = path.into_value();\n     let options_value = options.await?;\n     let mut results = Vec::new();\n \n@@ -2696,7 +2692,7 @@ async fn resolve_into_package(\n         let mut new_pat = path.clone();\n         new_pat.push_front(rcstr!(\".\").into());\n \n-        let relative = Request::relative(Value::new(new_pat), query, fragment, true)\n+        let relative = Request::relative(new_pat, query, fragment, true)\n             .to_resolved()\n             .await?;\n         results.push(resolve_internal_inline(*package_path, *relative, *options).await?);\n@@ -2904,10 +2900,10 @@ async fn handle_exports_imports_field(\n     let mut resolved_results = Vec::new();\n     for (result_path, conditions) in results {\n         if let Some(result_path) = result_path.with_normalized_path() {\n-            let request = Request::parse(Value::new(Pattern::Concatenation(vec![\n+            let request = Request::parse(Pattern::Concatenation(vec![\n                 Pattern::Constant(rcstr!(\"./\")),\n                 result_path,\n-            ])))\n+            ]))\n             .to_resolved()\n             .await?;\n "
        },
        {
            "sha": "30edce0587ab47e0ea4f86408e9f2b9cc4a19ea9",
            "filename": "turbopack/crates/turbopack-core/src/resolve/options.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Foptions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Foptions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Foptions.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -4,7 +4,7 @@ use anyhow::{Result, bail};\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    FxIndexSet, NonLocalValue, ResolvedVc, TryJoinIterExt, Value, ValueToString, Vc,\n+    FxIndexSet, NonLocalValue, ResolvedVc, TryJoinIterExt, ValueToString, Vc,\n     debug::ValueDebugFormat, trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n@@ -276,7 +276,7 @@ impl AliasTemplate for Vc<ImportMapping> {\n                         .await?,\n                 ),\n                 ImportMapping::Dynamic(replacement) => {\n-                    (*replacement.replace(capture.clone().cell()).await?).clone()\n+                    (*replacement.replace(Pattern::new(capture.clone())).await?).clone()\n                 }\n             }\n             .resolved_cell())\n@@ -441,9 +441,7 @@ async fn import_mapping_to_result(\n             ImportMapResult::Result(ResolveResult::primary(ResolveResultItem::Empty))\n         }\n         ReplacedImportMapping::PrimaryAlternative(name, context) => {\n-            let request = Request::parse(Value::new(name.clone()))\n-                .to_resolved()\n-                .await?;\n+            let request = Request::parse(name.clone()).to_resolved().await?;\n             ImportMapResult::Alias(request, *context)\n         }\n         ReplacedImportMapping::Alternatives(list) => ImportMapResult::Alternatives("
        },
        {
            "sha": "7dfaf40d1f3697944b098f69b6409e7e6da89d43",
            "filename": "turbopack/crates/turbopack-core/src/resolve/parse.rs",
            "status": "modified",
            "additions": 25,
            "deletions": 58,
            "changes": 83,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fparse.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fparse.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fparse.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -2,7 +2,7 @@ use anyhow::{Ok, Result};\n use lazy_static::lazy_static;\n use regex::Regex;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, ValueToString, Vc};\n \n use super::pattern::Pattern;\n \n@@ -295,36 +295,34 @@ impl Request {\n         Ok(Request::Alternatives {\n             requests: list\n                 .into_iter()\n-                .map(Value::new)\n                 .map(Request::parse)\n                 .map(|v| async move { v.to_resolved().await })\n                 .try_join()\n                 .await?,\n         })\n     }\n+\n+    pub fn parse_string(request: RcStr) -> Vc<Self> {\n+        Self::parse(request.into())\n+    }\n }\n \n #[turbo_tasks::value_impl]\n impl Request {\n     #[turbo_tasks::function]\n-    pub async fn parse(request: Value<Pattern>) -> Result<Vc<Self>> {\n-        Ok(Self::cell(Request::parse_ref(request.into_value()).await?))\n-    }\n-\n-    #[turbo_tasks::function]\n-    pub async fn parse_string(request: RcStr) -> Result<Vc<Self>> {\n-        Ok(Self::cell(Request::parse_ref(request.into()).await?))\n+    pub async fn parse(request: Pattern) -> Result<Vc<Self>> {\n+        Ok(Self::cell(Request::parse_ref(request).await?))\n     }\n \n     #[turbo_tasks::function]\n     pub fn raw(\n-        request: Value<Pattern>,\n+        request: Pattern,\n         query: RcStr,\n         fragment: RcStr,\n         force_in_lookup_dir: bool,\n     ) -> Vc<Self> {\n         Self::cell(Request::Raw {\n-            path: request.into_value(),\n+            path: request,\n             force_in_lookup_dir,\n             query,\n             fragment,\n@@ -333,24 +331,24 @@ impl Request {\n \n     #[turbo_tasks::function]\n     pub fn relative(\n-        request: Value<Pattern>,\n+        request: Pattern,\n         query: RcStr,\n         fragment: RcStr,\n         force_in_lookup_dir: bool,\n     ) -> Vc<Self> {\n         Self::cell(Request::Relative {\n-            path: request.into_value(),\n+            path: request,\n             force_in_lookup_dir,\n             query,\n             fragment,\n         })\n     }\n \n     #[turbo_tasks::function]\n-    pub fn module(module: RcStr, path: Value<Pattern>, query: RcStr, fragment: RcStr) -> Vc<Self> {\n+    pub fn module(module: RcStr, path: Pattern, query: RcStr, fragment: RcStr) -> Vc<Self> {\n         Self::cell(Request::Module {\n             module,\n-            path: path.into_value(),\n+            path,\n             query,\n             fragment,\n         })\n@@ -377,17 +375,17 @@ impl Request {\n                 let mut pat = Pattern::Constant(format!(\"./{module}\").into());\n                 pat.push(path.clone());\n                 // TODO add query\n-                Self::parse(Value::new(pat))\n+                Self::parse(pat)\n             }\n             Request::PackageInternal { path } => {\n                 let mut pat = Pattern::Constant(rcstr!(\"./\"));\n                 pat.push(path.clone());\n-                Self::parse(Value::new(pat))\n+                Self::parse(pat)\n             }\n             Request::Unknown { path } => {\n                 let mut pat = Pattern::Constant(rcstr!(\"./\"));\n                 pat.push(path.clone());\n-                Self::parse(Value::new(pat))\n+                Self::parse(pat)\n             }\n             Request::Alternatives { requests } => {\n                 let requests = requests\n@@ -411,34 +409,19 @@ impl Request {\n                 query: _,\n                 force_in_lookup_dir,\n                 fragment,\n-            } => Request::raw(\n-                Value::new(path.clone()),\n-                query,\n-                fragment.clone(),\n-                *force_in_lookup_dir,\n-            ),\n+            } => Request::raw(path.clone(), query, fragment.clone(), *force_in_lookup_dir),\n             Request::Relative {\n                 path,\n                 query: _,\n                 force_in_lookup_dir,\n                 fragment,\n-            } => Request::relative(\n-                Value::new(path.clone()),\n-                query,\n-                fragment.clone(),\n-                *force_in_lookup_dir,\n-            ),\n+            } => Request::relative(path.clone(), query, fragment.clone(), *force_in_lookup_dir),\n             Request::Module {\n                 module,\n                 path,\n                 query: _,\n                 fragment,\n-            } => Request::module(\n-                module.clone(),\n-                Value::new(path.clone()),\n-                query,\n-                fragment.clone(),\n-            ),\n+            } => Request::module(module.clone(), path.clone(), query, fragment.clone()),\n             Request::ServerRelative {\n                 path,\n                 query: _,\n@@ -567,12 +550,7 @@ impl Request {\n             } => {\n                 let mut pat = Pattern::concat([path.clone(), suffix.into()]);\n                 pat.normalize();\n-                Self::raw(\n-                    Value::new(pat),\n-                    query.clone(),\n-                    fragment.clone(),\n-                    *force_in_lookup_dir,\n-                )\n+                Self::raw(pat, query.clone(), fragment.clone(), *force_in_lookup_dir)\n             }\n             Request::Relative {\n                 path,\n@@ -582,12 +560,7 @@ impl Request {\n             } => {\n                 let mut pat = Pattern::concat([path.clone(), suffix.into()]);\n                 pat.normalize();\n-                Self::relative(\n-                    Value::new(pat),\n-                    query.clone(),\n-                    fragment.clone(),\n-                    *force_in_lookup_dir,\n-                )\n+                Self::relative(pat, query.clone(), fragment.clone(), *force_in_lookup_dir)\n             }\n             Request::Module {\n                 module,\n@@ -597,12 +570,7 @@ impl Request {\n             } => {\n                 let mut pat = Pattern::concat([path.clone(), suffix.into()]);\n                 pat.normalize();\n-                Self::module(\n-                    module.clone(),\n-                    Value::new(pat),\n-                    query.clone(),\n-                    fragment.clone(),\n-                )\n+                Self::module(module.clone(), pat, query.clone(), fragment.clone())\n             }\n             Request::ServerRelative {\n                 path,\n@@ -632,7 +600,7 @@ impl Request {\n                 }\n                 .cell()\n             }\n-            Request::Empty => Self::parse(Value::new(suffix.into())),\n+            Request::Empty => Self::parse(suffix.into()),\n             Request::PackageInternal { path } => {\n                 let mut pat = Pattern::concat([path.clone(), suffix.into()]);\n                 pat.normalize();\n@@ -706,7 +674,7 @@ impl Request {\n     /// more complete.\n     #[turbo_tasks::function]\n     pub async fn request_pattern(self: Vc<Self>) -> Result<Vc<Pattern>> {\n-        Ok(match &*self.await? {\n+        Ok(Pattern::new(match &*self.await? {\n             Request::Raw { path, .. } => path.clone(),\n             Request::Relative { path, .. } => path.clone(),\n             Request::Module { module, path, .. } => {\n@@ -744,8 +712,7 @@ impl Request {\n                     .try_join()\n                     .await?,\n             ),\n-        }\n-        .cell())\n+        }))\n     }\n }\n "
        },
        {
            "sha": "7660d4389e8f44bfef519e6ba2e0ad763725102e",
            "filename": "turbopack/crates/turbopack-core/src/resolve/pattern.rs",
            "status": "modified",
            "additions": 17,
            "deletions": 6,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fpattern.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fpattern.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fpattern.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -12,15 +12,15 @@ use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n-    NonLocalValue, ResolvedVc, Value, ValueToString, Vc, debug::ValueDebugFormat,\n+    NonLocalValue, ResolvedVc, TaskInput, ValueToString, Vc, debug::ValueDebugFormat,\n     trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{\n     FileSystemPath, LinkContent, LinkType, RawDirectoryContent, RawDirectoryEntry,\n     util::normalize_path,\n };\n \n-#[turbo_tasks::value(shared, serialization = \"auto_for_input\")]\n+#[turbo_tasks::value]\n #[derive(Hash, Clone, Debug, Default)]\n pub enum Pattern {\n     Constant(RcStr),\n@@ -30,6 +30,16 @@ pub enum Pattern {\n     Concatenation(Vec<Pattern>),\n }\n \n+/// manually implement TaskInput to avoid recursion in the implementation of `resolve_input` in the\n+/// derived implementation.  We can instead use the default implementation since `Pattern` contains\n+/// no VCs.\n+impl TaskInput for Pattern {\n+    fn is_transient(&self) -> bool {\n+        // We contain no vcs so they cannot be transient.\n+        false\n+    }\n+}\n+\n fn concatenation_push_or_merge_item(list: &mut Vec<Pattern>, pat: Pattern) {\n     if let Pattern::Constant(ref s) = pat\n         && let Some(Pattern::Constant(last)) = list.last_mut()\n@@ -1170,16 +1180,17 @@ impl Pattern {\n }\n \n impl Pattern {\n-    pub fn new(pattern: Pattern) -> Vc<Self> {\n-        Pattern::new_internal(Value::new(pattern))\n+    pub fn new(mut pattern: Pattern) -> Vc<Self> {\n+        pattern.normalize();\n+        Pattern::new_internal(pattern)\n     }\n }\n \n #[turbo_tasks::value_impl]\n impl Pattern {\n     #[turbo_tasks::function]\n-    fn new_internal(pattern: Value<Pattern>) -> Vc<Self> {\n-        Self::cell(pattern.into_value())\n+    fn new_internal(pattern: Pattern) -> Vc<Self> {\n+        Self::cell(pattern)\n     }\n }\n "
        },
        {
            "sha": "13e59e1758c5f35b9384a385ca32091d2ace462b",
            "filename": "turbopack/crates/turbopack-css/src/module_asset.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -5,7 +5,7 @@ use indoc::formatdoc;\n use lightningcss::css_modules::CssModuleReference;\n use swc_core::common::{BytePos, FileName, LineCol, SourceMap};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{FxIndexMap, ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::{FileSystemPath, rope::Rope};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -195,9 +195,7 @@ impl ModuleCssAsset {\n                                 original: name.to_string(),\n                                 from: CssModuleComposeReference::new(\n                                     Vc::upcast(self),\n-                                    Request::parse(Value::new(\n-                                        RcStr::from(specifier.clone()).into(),\n-                                    )),\n+                                    Request::parse(RcStr::from(specifier.clone()).into()),\n                                 )\n                                 .to_resolved()\n                                 .await?,"
        },
        {
            "sha": "fdb16d80d7b3af5614db163465856d4771f2f467",
            "filename": "turbopack/crates/turbopack-css/src/references/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -102,7 +102,7 @@ impl Visitor<'_> for ModuleReferencesVisitor<'_> {\n \n                 self.references.push(Vc::upcast(ImportAssetReference::new(\n                     *self.origin,\n-                    Request::parse(Value::new(RcStr::from(src).into())),\n+                    Request::parse(RcStr::from(src).into()),\n                     ImportAttributes::new_from_lightningcss(&i.clone().into_owned()).into(),\n                     self.import_context.map(|ctx| *ctx),\n                     IssueSource::from_line_col(\n@@ -139,7 +139,7 @@ impl Visitor<'_> for ModuleReferencesVisitor<'_> {\n \n             let vc = UrlAssetReference::new(\n                 *self.origin,\n-                Request::parse(Value::new(RcStr::from(src).into())),\n+                Request::parse(RcStr::from(src).into()),\n                 IssueSource::from_line_col(\n                     ResolvedVc::upcast(self.source),\n                     SourcePos {"
        },
        {
            "sha": "d75797ab85776bb7d68801bb8398c9b6a6cb0833",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/mod.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 17,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -738,7 +738,7 @@ pub(crate) async fn analyse_ecmascript_module_internal(\n             let mut should_add_evaluation = false;\n             let reference = EsmAssetReference::new(\n                 origin,\n-                Request::parse(Value::new(RcStr::from(&*r.module_path).into()))\n+                Request::parse(RcStr::from(&*r.module_path).into())\n                     .to_resolved()\n                     .await?,\n                 r.issue_source\n@@ -915,9 +915,7 @@ pub(crate) async fn analyse_ecmascript_module_internal(\n     if let Some((request, webpack_runtime_span)) = webpack_runtime {\n         let span = tracing::info_span!(\"webpack runtime reference\");\n         async {\n-            let request = Request::parse(Value::new(request.into()))\n-                .to_resolved()\n-                .await?;\n+            let request = Request::parse(request.into()).to_resolved().await?;\n             let runtime = resolve_as_webpack_runtime(*origin, *request, *transforms)\n                 .to_resolved()\n                 .await?;\n@@ -1625,7 +1623,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                     analysis.add_reference_code_gen(\n                         UrlAssetReference::new(\n                             origin,\n-                            Request::parse(Value::new(pat)).to_resolved().await?,\n+                            Request::parse(pat).to_resolved().await?,\n                             *compile_time_info.environment().rendering().await?,\n                             issue_source(source, span),\n                             in_try,\n@@ -1658,7 +1656,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                         analysis.add_reference_code_gen(\n                             WorkerAssetReference::new(\n                                 origin,\n-                                Request::parse(Value::new(pat)).to_resolved().await?,\n+                                Request::parse(pat).to_resolved().await?,\n                                 issue_source(source, span),\n                                 in_try,\n                             ),\n@@ -1747,7 +1745,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                 analysis.add_reference_code_gen(\n                     EsmAsyncAssetReference::new(\n                         origin,\n-                        Request::parse(Value::new(pat)).to_resolved().await?,\n+                        Request::parse(pat).to_resolved().await?,\n                         issue_source(source, span),\n                         Value::new(import_annotations),\n                         in_try,\n@@ -1787,7 +1785,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                 analysis.add_reference_code_gen(\n                     CjsRequireAssetReference::new(\n                         origin,\n-                        Request::parse(Value::new(pat)).to_resolved().await?,\n+                        Request::parse(pat).to_resolved().await?,\n                         issue_source(source, span),\n                         in_try,\n                     ),\n@@ -1839,7 +1837,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                 analysis.add_reference_code_gen(\n                     CjsRequireResolveAssetReference::new(\n                         origin,\n-                        Request::parse(Value::new(pat)).to_resolved().await?,\n+                        Request::parse(pat).to_resolved().await?,\n                         issue_source(source, span),\n                         in_try,\n                     ),\n@@ -2027,7 +2025,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                         analysis.add_reference(\n                             CjsAssetReference::new(\n                                 *origin,\n-                                Request::parse(Value::new(pat)),\n+                                Request::parse(pat),\n                                 issue_source(source, span),\n                                 in_try,\n                             )\n@@ -2089,7 +2087,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                 analysis.add_reference(\n                     CjsAssetReference::new(\n                         *origin,\n-                        Request::parse(Value::new(pat)),\n+                        Request::parse(pat),\n                         issue_source(source, span),\n                         in_try,\n                     )\n@@ -2267,7 +2265,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                                 analysis.add_reference(\n                                     CjsAssetReference::new(\n                                         *origin,\n-                                        Request::parse(Value::new(pat)),\n+                                        Request::parse(pat),\n                                         issue_source(source, span),\n                                         in_try,\n                                     )\n@@ -2338,7 +2336,7 @@ async fn handle_call<G: Fn(Vec<Effect>) + Send + Sync>(\n                 analysis.add_reference(\n                     CjsAssetReference::new(\n                         *origin,\n-                        Request::parse(Value::new(js_value_to_pattern(&args[1]))),\n+                        Request::parse(js_value_to_pattern(&args[1])),\n                         issue_source(source, span),\n                         in_try,\n                     )\n@@ -2579,9 +2577,7 @@ async fn handle_free_var_reference(\n                         } else {\n                             state.origin\n                         },\n-                        Request::parse(Value::new(request.clone().into()))\n-                            .to_resolved()\n-                            .await?,\n+                        Request::parse(request.clone().into()).to_resolved().await?,\n                         IssueSource::from_swc_offsets(\n                             state.source,\n                             span.lo.to_u32(),\n@@ -3008,7 +3004,7 @@ async fn require_resolve_visitor(\n ) -> Result<JsValue> {\n     Ok(if args.len() == 1 {\n         let pat = js_value_to_pattern(&args[0]);\n-        let request = Request::parse(Value::new(pat.clone()));\n+        let request = Request::parse(pat.clone());\n         let resolved = cjs_resolve_source(origin, request, None, true)\n             .resolve()\n             .await?;"
        },
        {
            "sha": "ec641fdef1b9dd99245f0cc22c81ace3689d32ac",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/require_context.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -16,7 +16,7 @@ use swc_core::{\n use turbo_esregex::EsRegex;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    FxIndexMap, NonLocalValue, ResolvedVc, Value, ValueToString, Vc, debug::ValueDebugFormat,\n+    FxIndexMap, NonLocalValue, ResolvedVc, ValueToString, Vc, debug::ValueDebugFormat,\n     trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{DirectoryContent, DirectoryEntry, FileSystemPath};\n@@ -188,7 +188,7 @@ impl RequireContextMap {\n                 bail!(\"invariant error: this was already checked in `list_dir`\");\n             };\n \n-            let request = Request::parse(Value::new(origin_relative.clone().into()))\n+            let request = Request::parse(origin_relative.clone().into())\n                 .to_resolved()\n                 .await?;\n             let result = cjs_resolve(origin, *request, issue_source.clone(), is_optional)"
        },
        {
            "sha": "b530a4613dfc61a5cf6a2e4600795edd125a6a36",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/typescript.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftypescript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftypescript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftypescript.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     context::AssetContext,\n@@ -129,7 +129,7 @@ impl ModuleReference for TsReferenceTypeAssetReference {\n             *self.origin,\n             Request::module(\n                 self.module.clone(),\n-                Value::new(RcStr::default().into()),\n+                RcStr::default().into(),\n                 RcStr::default(),\n                 RcStr::default(),\n             ),"
        },
        {
            "sha": "37705a0a7753249d7553ebd807a93c309288a716",
            "filename": "turbopack/crates/turbopack-ecmascript/src/typescript/mod.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 13,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::Result;\n use serde_json::Value as JsonValue;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, ValueToString, Vc};\n use turbo_tasks_fs::DirectoryContent;\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -82,12 +82,12 @@ impl Module for TsConfigModuleAsset {\n                     .map(|s| (source, s.to_string()))\n             })\n             .await?;\n-            let compiler: RcStr = compiler\n-                .map(|(_, c)| c)\n-                .unwrap_or_else(|| \"typescript\".to_string())\n-                .into();\n+            let compiler = match compiler {\n+                Some((_, c)) => RcStr::from(c),\n+                None => rcstr!(\"typescript\"),\n+            };\n             references.push(ResolvedVc::upcast(\n-                CompilerReference::new(*self.origin, Request::parse(Value::new(compiler.into())))\n+                CompilerReference::new(*self.origin, Request::parse(compiler.into()))\n                     .to_resolved()\n                     .await?,\n             ));\n@@ -107,12 +107,9 @@ impl Module for TsConfigModuleAsset {\n             if let Some(require) = require {\n                 for (_, request) in require {\n                     references.push(ResolvedVc::upcast(\n-                        TsNodeRequireReference::new(\n-                            *self.origin,\n-                            Request::parse(Value::new(request.into())),\n-                        )\n-                        .to_resolved()\n-                        .await?,\n+                        TsNodeRequireReference::new(*self.origin, Request::parse(request.into()))\n+                            .to_resolved()\n+                            .await?,\n                     ));\n                 }\n             }\n@@ -165,7 +162,7 @@ impl Module for TsConfigModuleAsset {\n                         *self.origin,\n                         Request::module(\n                             name,\n-                            Value::new(RcStr::default().into()),\n+                            RcStr::default().into(),\n                             RcStr::default(),\n                             RcStr::default(),\n                         ),"
        },
        {
            "sha": "b08527e828ccce9975527049dab3484a4dfe803a",
            "filename": "turbopack/crates/turbopack-node/src/transforms/webpack.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -11,7 +11,7 @@ use serde_with::serde_as;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     Completion, NonLocalValue, OperationValue, OperationVc, ResolvedVc, TaskInput, TryJoinIterExt,\n-    Value, ValueToString, Vc, trace::TraceRawVcs,\n+    ValueToString, Vc, trace::TraceRawVcs,\n };\n use turbo_tasks_bytes::stream::SingleValue;\n use turbo_tasks_env::ProcessEnv;\n@@ -569,7 +569,7 @@ impl EvaluateContext for WebpackLoaderContext {\n                     bail!(\"Resolve options are not available in this context\");\n                 };\n                 let lookup_path = self.cwd.join(lookup_path);\n-                let request = Request::parse(Value::new(Pattern::Constant(request)));\n+                let request = Request::parse(Pattern::Constant(request));\n                 let options = resolve_options(lookup_path, *resolve_options_context);\n \n                 let options = apply_webpack_resolve_options(options, webpack_options);"
        },
        {
            "sha": "5a3323305af17cf001ee946ceab65f138be2c154",
            "filename": "turbopack/crates/turbopack-resolve/src/typescript.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/352b80d70225180229a19037910714718e544d5b/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs?ref=352b80d70225180229a19037910714718e544d5b",
            "patch": "@@ -3,7 +3,7 @@ use std::{collections::HashMap, fmt::Write, mem::take};\n use anyhow::Result;\n use serde_json::Value as JsonValue;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, Value, ValueDefault, Vc, fxindexset};\n+use turbo_tasks::{ResolvedVc, ValueDefault, Vc, fxindexset};\n use turbo_tasks_fs::{FileContent, FileJsonContent, FileSystemPath};\n use turbopack_core::{\n     asset::Asset,\n@@ -401,7 +401,7 @@ pub async fn type_resolve(\n         };\n         Some(Request::module(\n             format!(\"@types/{m}\").into(),\n-            Value::new(p.clone()),\n+            p.clone(),\n             RcStr::default(),\n             RcStr::default(),\n         ))"
        }
    ],
    "stats": {
        "total": 270,
        "additions": 115,
        "deletions": 155
    }
}