{
    "author": "wbinnssmith",
    "message": "Turbopack: Allow overriding tsconfig path via next-config (#77563)\n\nThis:\n- Adds a test asserting the user can override the tsconfig path via the\nnext-config. This is already supported with Next.js and Webpack.\n- Implements the necessary code to pass the test and implement support\nwith Turbopack.\n\nTest Plan: `pnpm test-dev test/e2e/tsconfig-path/index.test.ts && pnpm\ntest-dev-turbo test/e2e/tsconfig-path/index.test.ts`\n\nCloses PACK-4215",
    "sha": "570266a445d016d3d8455f1c9e5c0f080120459f",
    "files": [
        {
            "sha": "3cae7f50cc0726e9a13743f85919e430e3b135b5",
            "filename": "crates/next-core/src/next_client/context.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -2,7 +2,7 @@ use std::iter::once;\n \n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Value, Vc};\n+use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, Value, Vc};\n use turbo_tasks_env::EnvMap;\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{\n@@ -169,7 +169,7 @@ pub async fn get_client_resolve_options_context(\n             .to_resolved()\n             .await?;\n     let custom_conditions = vec![mode.await?.condition().into()];\n-    let module_options_context = ResolveOptionsContext {\n+    let resolve_options_context = ResolveOptionsContext {\n         enable_node_modules: Some(project_path.root().to_resolved().await?),\n         custom_conditions,\n         import_map: Some(next_client_import_map),\n@@ -201,16 +201,24 @@ pub async fn get_client_resolve_options_context(\n         )],\n         ..Default::default()\n     };\n+\n     Ok(ResolveOptionsContext {\n         enable_typescript: true,\n         enable_react: true,\n         enable_mjs_extension: true,\n         custom_extensions: next_config.resolve_extension().owned().await?,\n+        tsconfig_path: next_config\n+            .typescript_tsconfig_path()\n+            .await?\n+            .as_ref()\n+            .map(|p| project_path.join(p.to_owned()))\n+            .to_resolved()\n+            .await?,\n         rules: vec![(\n             foreign_code_context_condition(next_config, project_path).await?,\n-            module_options_context.clone().resolved_cell(),\n+            resolve_options_context.clone().resolved_cell(),\n         )],\n-        ..module_options_context\n+        ..resolve_options_context\n     }\n     .cell())\n }"
        },
        {
            "sha": "07e4977451a9a6268de110f3d09d07c6c3637b68",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 1,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -417,7 +417,7 @@ pub struct Rewrites {\n #[serde(rename_all = \"camelCase\")]\n pub struct TypeScriptConfig {\n     pub ignore_build_errors: Option<bool>,\n-    pub ts_config_path: Option<String>,\n+    pub tsconfig_path: Option<String>,\n }\n \n #[turbo_tasks::value(eq = \"manual\", operation)]\n@@ -1534,6 +1534,16 @@ impl NextConfig {\n \n         Ok(Vc::cell(source_maps.unwrap_or(true)))\n     }\n+\n+    #[turbo_tasks::function]\n+    pub async fn typescript_tsconfig_path(&self) -> Result<Vc<Option<RcStr>>> {\n+        Ok(Vc::cell(\n+            self.typescript\n+                .tsconfig_path\n+                .as_ref()\n+                .map(|path| path.to_owned().into()),\n+        ))\n+    }\n }\n \n /// A subset of ts/jsconfig that next.js implicitly"
        },
        {
            "sha": "0b31b423334e286bfc8033a408d18815b9b49c3f",
            "filename": "crates/next-core/src/next_edge/context.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 1,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Value, Vc};\n+use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, Value, Vc};\n use turbo_tasks_env::EnvMap;\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{css::chunk::CssChunkType, resolve_options_context::ResolveOptionsContext};\n@@ -183,6 +183,7 @@ pub async fn get_edge_resolve_options_context(\n         browser: true,\n         after_resolve_plugins,\n         before_resolve_plugins,\n+\n         ..Default::default()\n     };\n \n@@ -192,6 +193,13 @@ pub async fn get_edge_resolve_options_context(\n         enable_mjs_extension: true,\n         enable_edge_node_externals: true,\n         custom_extensions: next_config.resolve_extension().owned().await?,\n+        tsconfig_path: next_config\n+            .typescript_tsconfig_path()\n+            .await?\n+            .as_ref()\n+            .map(|p| project_path.join(p.to_owned()))\n+            .to_resolved()\n+            .await?,\n         rules: vec![(\n             foreign_code_context_condition(next_config, project_path).await?,\n             resolve_options_context.clone().resolved_cell(),"
        },
        {
            "sha": "0bad24f558ed4bb256aada3a3ffd77172b53449c",
            "filename": "crates/next-core/src/next_server/context.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -2,7 +2,7 @@ use std::iter::once;\n \n use anyhow::{bail, Result};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Value, Vc};\n+use turbo_tasks::{FxIndexMap, OptionVcExt, ResolvedVc, Value, Vc};\n use turbo_tasks_env::{EnvMap, ProcessEnv};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{\n@@ -324,6 +324,13 @@ pub async fn get_server_resolve_options_context(\n         enable_react: true,\n         enable_mjs_extension: true,\n         custom_extensions: next_config.resolve_extension().owned().await?,\n+        tsconfig_path: next_config\n+            .typescript_tsconfig_path()\n+            .await?\n+            .as_ref()\n+            .map(|p| project_path.join(p.to_owned()))\n+            .to_resolved()\n+            .await?,\n         rules: vec![(\n             foreign_code_context_condition,\n             resolve_options_context.clone().resolved_cell(),"
        },
        {
            "sha": "fe77289813127166a274c94fe2a84c82ebe72b93",
            "filename": "test/e2e/tsconfig-path/app/layout.tsx",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftsconfig-path%2Fapp%2Flayout.tsx?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,15 @@\n+export default async function Layout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}\n+\n+export async function generateMetadata() {\n+  return {}\n+}"
        },
        {
            "sha": "7dbe1ef96f04303e5e3d7a8bf5ac482851587298",
            "filename": "test/e2e/tsconfig-path/app/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftsconfig-path%2Fapp%2Fpage.tsx?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,5 @@\n+import foo from 'foo'\n+\n+export default function Page() {\n+  return <p>{foo}</p>\n+}"
        },
        {
            "sha": "03ac9dc49f81c50ed1c1e74021cbd7d1a392c4d4",
            "filename": "test/e2e/tsconfig-path/bar.ts",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fbar.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fbar.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftsconfig-path%2Fbar.ts?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1 @@\n+export default 'bar123'"
        },
        {
            "sha": "2ebd255541cf89ea27d4f56c4bb1c3bc23a2d2c6",
            "filename": "test/e2e/tsconfig-path/index.test.ts",
            "status": "added",
            "additions": 29,
            "deletions": 0,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftsconfig-path%2Findex.test.ts?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,29 @@\n+import { FileRef, nextTestSetup } from 'e2e-utils'\n+\n+describe('specified tsconfig', () => {\n+  const { next, skipped } = nextTestSetup({\n+    files: new FileRef(__dirname),\n+    dependencies: {\n+      typescript: '5.4.4',\n+    },\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  it('app router: allows a user-specific tsconfig via the next config', async () => {\n+    const html = await next.render('/')\n+    expect(html).toContain('bar123')\n+  })\n+\n+  it('pages router: allows a user-specific tsconfig via the next config', async () => {\n+    const html = await next.render('/page')\n+    expect(html).toContain('bar123')\n+  })\n+\n+  it('middleware: allows a user-specific tsconfig via the next config', async () => {\n+    const html = await next.render('/middleware')\n+    expect(html).toContain('bar123')\n+  })\n+})"
        },
        {
            "sha": "af58b2533723c07e206bd9ec3c85eba9dbece64d",
            "filename": "test/e2e/tsconfig-path/middleware.ts",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fmiddleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fmiddleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftsconfig-path%2Fmiddleware.ts?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,13 @@\n+import type { NextRequest } from 'next/server'\n+import { NextResponse } from 'next/server'\n+import foo from 'foo'\n+\n+// This function can be marked `async` if using `await` inside\n+export function middleware(request: NextRequest) {\n+  return NextResponse.json({ foo })\n+}\n+\n+// See \"Matching Paths\" below to learn more\n+export const config = {\n+  matcher: '/middleware',\n+}"
        },
        {
            "sha": "cb07c5dc8f597ad592f69d60e2d7554effe6259e",
            "filename": "test/e2e/tsconfig-path/myconfig.json",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fmyconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fmyconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftsconfig-path%2Fmyconfig.json?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,28 @@\n+{\n+  \"compilerOptions\": {\n+    \"paths\": {\n+      \"foo\": [\"./bar.ts\"]\n+    },\n+    \"target\": \"ES2017\",\n+    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n+    \"allowJs\": true,\n+    \"skipLibCheck\": true,\n+    \"strict\": false,\n+    \"noEmit\": true,\n+    \"incremental\": true,\n+    \"module\": \"esnext\",\n+    \"esModuleInterop\": true,\n+    \"moduleResolution\": \"node\",\n+    \"resolveJsonModule\": true,\n+    \"isolatedModules\": true,\n+    \"jsx\": \"preserve\",\n+    \"plugins\": [\n+      {\n+        \"name\": \"next\"\n+      }\n+    ],\n+    \"strictNullChecks\": true\n+  },\n+  \"include\": [\"next-env.d.ts\", \".next/types/**/*.ts\", \"**/*.ts\", \"**/*.tsx\"],\n+  \"exclude\": [\"node_modules\", \"**/*.test.ts\", \"**/*.test.tsx\"]\n+}"
        },
        {
            "sha": "3672422130094a84b3cfd5698eea126e4f3ed6d2",
            "filename": "test/e2e/tsconfig-path/next.config.ts",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftsconfig-path%2Fnext.config.ts?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,9 @@\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  typescript: {\n+    tsconfigPath: 'myconfig.json',\n+  },\n+}\n+\n+export default nextConfig"
        },
        {
            "sha": "7dbe1ef96f04303e5e3d7a8bf5ac482851587298",
            "filename": "test/e2e/tsconfig-path/pages/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fpages%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftsconfig-path%2Fpages%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftsconfig-path%2Fpages%2Fpage.tsx?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,5 @@\n+import foo from 'foo'\n+\n+export default function Page() {\n+  return <p>{foo}</p>\n+}"
        },
        {
            "sha": "fe77289813127166a274c94fe2a84c82ebe72b93",
            "filename": "test/e2e/typescript-custom-tsconfig/app/layout.tsx",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fapp%2Flayout.tsx?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,15 @@\n+export default async function Layout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}\n+\n+export async function generateMetadata() {\n+  return {}\n+}"
        },
        {
            "sha": "7dbe1ef96f04303e5e3d7a8bf5ac482851587298",
            "filename": "test/e2e/typescript-custom-tsconfig/app/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fapp%2Fpage.tsx?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,5 @@\n+import foo from 'foo'\n+\n+export default function Page() {\n+  return <p>{foo}</p>\n+}"
        },
        {
            "sha": "03ac9dc49f81c50ed1c1e74021cbd7d1a392c4d4",
            "filename": "test/e2e/typescript-custom-tsconfig/bar.ts",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fbar.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fbar.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fbar.ts?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1 @@\n+export default 'bar123'"
        },
        {
            "sha": "af58b2533723c07e206bd9ec3c85eba9dbece64d",
            "filename": "test/e2e/typescript-custom-tsconfig/middleware.ts",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fmiddleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fmiddleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fmiddleware.ts?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,13 @@\n+import type { NextRequest } from 'next/server'\n+import { NextResponse } from 'next/server'\n+import foo from 'foo'\n+\n+// This function can be marked `async` if using `await` inside\n+export function middleware(request: NextRequest) {\n+  return NextResponse.json({ foo })\n+}\n+\n+// See \"Matching Paths\" below to learn more\n+export const config = {\n+  matcher: '/middleware',\n+}"
        },
        {
            "sha": "cf91aa558b9e18bc680b14f52e8c83648685d884",
            "filename": "test/e2e/typescript-custom-tsconfig/next.config.ts",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fnext.config.ts?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,9 @@\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  typescript: {\n+    tsconfigPath: 'web.tsconfig.json',\n+  },\n+}\n+\n+export default nextConfig"
        },
        {
            "sha": "7dbe1ef96f04303e5e3d7a8bf5ac482851587298",
            "filename": "test/e2e/typescript-custom-tsconfig/pages/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fpages%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fpages%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fpages%2Fpage.tsx?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,5 @@\n+import foo from 'foo'\n+\n+export default function Page() {\n+  return <p>{foo}</p>\n+}"
        },
        {
            "sha": "944b5b8aab15db1db7cf2f48f8939801c58159f5",
            "filename": "test/e2e/typescript-custom-tsconfig/test/index.test.js",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftypescript-custom-tsconfig%2Ftest%2Findex.test.js?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,32 @@\n+/* eslint-env jest */\n+\n+import { join } from 'path'\n+import { nextTestSetup, FileRef } from 'e2e-utils'\n+\n+describe('Custom TypeScript Config', () => {\n+  const { next, skipped } = nextTestSetup({\n+    files: new FileRef(join(__dirname, '..')),\n+    dependencies: {\n+      typescript: '5.4.4',\n+    },\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  it('app router: allows a user-specific tsconfig via the next config', async () => {\n+    const html = await next.render('/')\n+    expect(html).toContain('bar123')\n+  })\n+\n+  it('pages router: allows a user-specific tsconfig via the next config', async () => {\n+    const html = await next.render('/page')\n+    expect(html).toContain('bar123')\n+  })\n+\n+  it('middleware: allows a user-specific tsconfig via the next config', async () => {\n+    const html = await next.render('/middleware')\n+    expect(html).toContain('bar123')\n+  })\n+})"
        },
        {
            "sha": "f224ccfdf99b4920f2142d06a0ac9f1586da9b7d",
            "filename": "test/e2e/typescript-custom-tsconfig/web.tsconfig.json",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fweb.tsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fweb.tsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Ftypescript-custom-tsconfig%2Fweb.tsconfig.json?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -0,0 +1,28 @@\n+{\n+  \"compilerOptions\": {\n+    \"paths\": {\n+      \"foo\": [\"./bar.ts\"]\n+    },\n+    \"target\": \"ES2017\",\n+    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n+    \"allowJs\": true,\n+    \"skipLibCheck\": true,\n+    \"strict\": false,\n+    \"noEmit\": true,\n+    \"incremental\": true,\n+    \"module\": \"esnext\",\n+    \"esModuleInterop\": true,\n+    \"moduleResolution\": \"node\",\n+    \"resolveJsonModule\": true,\n+    \"isolatedModules\": true,\n+    \"jsx\": \"preserve\",\n+    \"plugins\": [\n+      {\n+        \"name\": \"next\"\n+      }\n+    ],\n+    \"strictNullChecks\": true\n+  },\n+  \"include\": [\"**/*.ts\", \"**/*.tsx\", \"next-env.d.ts\", \".next/types/**/*.ts\"],\n+  \"exclude\": [\"node_modules\"]\n+}"
        },
        {
            "sha": "9d60b2fd2dd9cfb033dc286ce13608e194cdca87",
            "filename": "turbopack/crates/turbopack-resolve/src/resolve.rs",
            "status": "modified",
            "additions": 28,
            "deletions": 5,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fresolve.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fresolve.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fresolve.rs?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -293,12 +293,35 @@ pub async fn resolve_options(\n     let resolve_options = base_resolve_options(resolve_path, options_context);\n \n     let resolve_options = if options_context_value.enable_typescript {\n-        let tsconfig = find_context_file(resolve_path, tsconfig()).await?;\n-        match *tsconfig {\n-            FindContextFileResult::Found(path, _) => {\n-                apply_tsconfig_resolve_options(resolve_options, tsconfig_resolve_options(*path))\n+        let find_tsconfig = async || {\n+            // Otherwise, attempt to find a tsconfig up the file tree\n+            let tsconfig = find_context_file(resolve_path, tsconfig()).await?;\n+            anyhow::Ok::<Vc<ResolveOptions>>(match *tsconfig {\n+                FindContextFileResult::Found(path, _) => {\n+                    apply_tsconfig_resolve_options(resolve_options, tsconfig_resolve_options(*path))\n+                }\n+                FindContextFileResult::NotFound(_) => resolve_options,\n+            })\n+        };\n+\n+        // Use a specified tsconfig path if provided. In Next.js, this is always provided by the\n+        // default config, at the very least.\n+        if let Some(tsconfig_path) = options_context_value.tsconfig_path {\n+            let meta = tsconfig_path.metadata().await;\n+            if meta.is_ok() {\n+                // If the file exists, use it.\n+                apply_tsconfig_resolve_options(\n+                    resolve_options,\n+                    tsconfig_resolve_options(*tsconfig_path),\n+                )\n+            } else {\n+                // Otherwise, try and find one.\n+                // TODO: If the user provides a tsconfig.json explicitly, this should fail\n+                // explicitly. Currently implemented this way for parity with webpack.\n+                find_tsconfig().await?\n             }\n-            FindContextFileResult::NotFound(_) => resolve_options,\n+        } else {\n+            find_tsconfig().await?\n         }\n     } else {\n         resolve_options"
        },
        {
            "sha": "138affb8fa13e72c55ef9ba6563e2775f787115b",
            "filename": "turbopack/crates/turbopack-resolve/src/resolve_options_context.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/570266a445d016d3d8455f1c9e5c0f080120459f/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fresolve_options_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/570266a445d016d3d8455f1c9e5c0f080120459f/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fresolve_options_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fresolve_options_context.rs?ref=570266a445d016d3d8455f1c9e5c0f080120459f",
            "patch": "@@ -32,6 +32,10 @@ pub struct ResolveOptionsContext {\n     /// directory\n     pub enable_node_modules: Option<ResolvedVc<FileSystemPath>>,\n     #[serde(default)]\n+    /// A specific path to a tsconfig.json file to use for resolving modules. If `None`, one will\n+    /// be looked up through the filesystem\n+    pub tsconfig_path: Option<ResolvedVc<FileSystemPath>>,\n+    #[serde(default)]\n     /// Mark well-known Node.js modules as external imports and load them using\n     /// native `require`. e.g. url, querystring, os\n     pub enable_node_externals: bool,"
        }
    ],
    "stats": {
        "total": 297,
        "additions": 285,
        "deletions": 12
    }
}