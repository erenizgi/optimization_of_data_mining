{
    "author": "wbinnssmith",
    "message": "Update error-recovery test snapshots for alternative bundler [3/n] (#76446)\n\nTest Plan: `pnpm test-dev-rspack\ntest/development/acceptance/error-recovery.test.ts`",
    "sha": "0f02b289e83ffcab63221ba499cfb3c0b5033746",
    "files": [
        {
            "sha": "89eb36670276768aaf1ef555ab2b6e84f03eec19",
            "filename": "test/development/acceptance/error-recovery.test.ts",
            "status": "modified",
            "additions": 203,
            "deletions": 33,
            "changes": 236,
            "blob_url": "https://github.com/vercel/next.js/blob/0f02b289e83ffcab63221ba499cfb3c0b5033746/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0f02b289e83ffcab63221ba499cfb3c0b5033746/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts?ref=0f02b289e83ffcab63221ba499cfb3c0b5033746",
            "patch": "@@ -56,6 +56,29 @@ describe('pages/ error recovery', () => {\n          \"stack\": [],\n        }\n       `)\n+    } else if (process.env.NEXT_RSPACK) {\n+      await expect({ browser, next }).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"  × Module build failed:\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+         × Module build failed:\n+         ├─▶   ×\n+         │     │   x Unexpected eof\n+         │     │    ,-[<FIXME-project-root>/index.js:1:1]\n+         │     │  1 | export default () => <div/\n+         │     │    \\`----\n+         │     │\n+         │\n+         ╰─▶ Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n+      `)\n     } else {\n       await expect(browser).toDisplayRedbox(`\n        {\n@@ -335,6 +358,35 @@ describe('pages/ error recovery', () => {\n          \"stack\": [],\n        }\n       `)\n+    } else if (process.env.NEXT_RSPACK) {\n+      await expect({ browser, next }).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"  × Module build failed:\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+         × Module build failed:\n+         ├─▶   ×\n+         │     │   x Expected '{', got 'return'\n+         │     │    ,-[<FIXME-project-root>/index.js:5:1]\n+         │     │  2 |\n+         │     │  3 | class ClassDefault extends React.Component {\n+         │     │  4 |   render()\n+         │     │  5 |     return <h1>Default Export</h1>;\n+         │     │    :     ^^^^^^\n+         │     │  6 |   }\n+         │     │  7 | }\n+         │     │    \\`----\n+         │     │\n+         │\n+         ╰─▶ Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n+      `)\n     } else {\n       await expect(browser).toDisplayRedbox(`\n        {\n@@ -394,8 +446,38 @@ describe('pages/ error recovery', () => {\n          \"stack\": [],\n        }\n       `)\n+    } else if (process.env.NEXT_RSPACK) {\n+      await expect({ browser, next }).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"  × Module build failed:\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+         × Module build failed:\n+         ├─▶   ×\n+         │     │   x Expected '{', got 'throw'\n+         │     │    ,-[<FIXME-project-root>/index.js:5:1]\n+         │     │  2 |\n+         │     │  3 | class ClassDefault extends React.Component {\n+         │     │  4 |   render()\n+         │     │  5 |     throw new Error('nooo');\n+         │     │    :     ^^^^^\n+         │     │  6 |     return <h1>Default Export</h1>;\n+         │     │  7 |   }\n+         │     │  8 | }\n+         │     │    \\`----\n+         │     │\n+         │\n+         ╰─▶ Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n+      `)\n     } else {\n-      await expect(browser).toDisplayRedbox(`\n+      await expect({ browser, next }).toDisplayRedbox(`\n        {\n          \"count\": 1,\n          \"description\": \"Error:   x Expected '{', got 'throw'\",\n@@ -465,23 +547,40 @@ describe('pages/ error recovery', () => {\n        }\n       `)\n     } else {\n-      await expect(browser).toDisplayRedbox(`\n-       {\n-         \"count\": 1,\n-         \"description\": \"Error: nooo\",\n-         \"environmentLabel\": null,\n-         \"label\": \"Unhandled Runtime Error\",\n-         \"source\": \"index.js (5:11) @ ClassDefault.render\n-       > 5 |     throw new Error('nooo');\n-           |           ^\",\n-         \"stack\": [\n-           \"ClassDefault.render index.js (5:11)\",\n-           \"Set.forEach <anonymous> (0:0)\",\n-           \"<FIXME-file-protocol>\",\n-           \"<FIXME-file-protocol>\",\n-         ],\n-       }\n-      `)\n+      if (process.env.NEXT_RSPACK) {\n+        await expect(browser).toDisplayRedbox(`\n+         {\n+           \"count\": 1,\n+           \"description\": \"Error: nooo\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"index.js (5:11) @ ClassDefault.render\n+         > 5 |     throw new Error('nooo');\n+             |           ^\",\n+           \"stack\": [\n+             \"ClassDefault.render index.js (5:11)\",\n+           ],\n+         }\n+        `)\n+      } else {\n+        await expect(browser).toDisplayRedbox(`\n+                {\n+                  \"count\": 1,\n+                  \"description\": \"Error: nooo\",\n+                  \"environmentLabel\": null,\n+                  \"label\": \"Unhandled Runtime Error\",\n+                  \"source\": \"index.js (5:11) @ ClassDefault.render\n+                > 5 |     throw new Error('nooo');\n+                    |           ^\",\n+                  \"stack\": [\n+                    \"ClassDefault.render index.js (5:11)\",\n+                    \"Set.forEach <anonymous> (0:0)\",\n+                    \"<FIXME-file-protocol>\",\n+                    \"<FIXME-file-protocol>\",\n+                  ],\n+                }\n+              `)\n+      }\n     }\n   })\n \n@@ -616,20 +715,37 @@ describe('pages/ error recovery', () => {\n     )\n     await new Promise((resolve) => setTimeout(resolve, 1000))\n \n-    await expect(browser).toDisplayRedbox(`\n-     {\n-       \"count\": 1,\n-       \"description\": \"Error: no 1\",\n-       \"environmentLabel\": null,\n-       \"label\": \"Unhandled Runtime Error\",\n-       \"source\": \"index.js (5:9) @ eval\n-     > 5 |   throw Error('no ' + i)\n-         |         ^\",\n-       \"stack\": [\n-         \"eval index.js (5:9)\",\n-       ],\n-     }\n-    `)\n+    if (process.env.NEXT_RSPACK) {\n+      await expect(browser).toDisplayRedbox(`\n+            {\n+              \"count\": 1,\n+              \"description\": \"Error: no 1\",\n+              \"environmentLabel\": null,\n+              \"label\": \"Unhandled Runtime Error\",\n+              \"source\": \"index.js (5:9) @ <unknown>\n+            > 5 |   throw Error('no ' + i)\n+                |         ^\",\n+              \"stack\": [\n+                \"<unknown> index.js (5:9)\",\n+              ],\n+            }\n+          `)\n+    } else {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error: no 1\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Unhandled Runtime Error\",\n+         \"source\": \"index.js (5:9) @ eval\n+       > 5 |   throw Error('no ' + i)\n+           |         ^\",\n+         \"stack\": [\n+           \"eval index.js (5:9)\",\n+         ],\n+       }\n+      `)\n+    }\n \n     // Make a syntax error.\n     await session.patch(\n@@ -662,6 +778,33 @@ describe('pages/ error recovery', () => {\n          \"stack\": [],\n        }\n       `)\n+    } else if (process.env.NEXT_RSPACK) {\n+      await expect({ browser, next }).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"  × Module build failed:\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+         × Module build failed:\n+         ├─▶   ×\n+         │     │   x Expected '}', got '<eof>'\n+         │     │    ,-[<FIXME-project-root>/index.js:7:1]\n+         │     │  4 |   i++\n+         │     │  5 |   throw Error('no ' + i)\n+         │     │  6 | }, 1000)\n+         │     │  7 | export default function FunctionNamed() {\n+         │     │    :                                         ^\n+         │     │    \\`----\n+         │     │\n+         │\n+         ╰─▶ Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n+      `)\n     } else {\n       await expect(browser).toDisplayRedbox(`\n        {\n@@ -706,8 +849,35 @@ describe('pages/ error recovery', () => {\n          \"stack\": [],\n        }\n       `)\n+    } else if (process.env.NEXT_RSPACK) {\n+      await expect({ browser, next }).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"  × Module build failed:\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"./index.js\n+         × Module build failed:\n+         ├─▶   ×\n+         │     │   x Expected '}', got '<eof>'\n+         │     │    ,-[<FIXME-project-root>/index.js:7:1]\n+         │     │  4 |   i++\n+         │     │  5 |   throw Error('no ' + i)\n+         │     │  6 | }, 1000)\n+         │     │  7 | export default function FunctionNamed() {\n+         │     │    :                                         ^\n+         │     │    \\`----\n+         │     │\n+         │\n+         ╰─▶ Syntax Error\n+       Import trace for requested module:\n+       ./index.js\n+       ./pages/index.js\",\n+         \"stack\": [],\n+       }\n+      `)\n     } else {\n-      await expect(browser).toDisplayRedbox(`\n+      await expect({ browser, next }).toDisplayRedbox(`\n        {\n          \"count\": 1,\n          \"description\": \"Error:   x Expected '}', got '<eof>'\","
        }
    ],
    "stats": {
        "total": 236,
        "additions": 203,
        "deletions": 33
    }
}