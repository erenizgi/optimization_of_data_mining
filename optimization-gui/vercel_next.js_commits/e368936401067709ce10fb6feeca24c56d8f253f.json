{
    "author": "unstubbable",
    "message": "Fix uniqueness detection for `generateStaticParams` (#76713)",
    "sha": "e368936401067709ce10fb6feeca24c56d8f253f",
    "files": [
        {
            "sha": "40c1e4527ce2d03df1082b2bfddb28e813a5886b",
            "filename": "packages/next/src/build/static-paths/app.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/e368936401067709ce10fb6feeca24c56d8f253f/packages%2Fnext%2Fsrc%2Fbuild%2Fstatic-paths%2Fapp.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e368936401067709ce10fb6feeca24c56d8f253f/packages%2Fnext%2Fsrc%2Fbuild%2Fstatic-paths%2Fapp.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fstatic-paths%2Fapp.ts?ref=e368936401067709ce10fb6feeca24c56d8f253f",
            "patch": "@@ -38,7 +38,7 @@ function areParamValuesEqual(a: ParamValue, b: ParamValue) {\n       return false\n     }\n \n-    return a.every((item) => b.includes(item))\n+    return a.every((item, index) => item === b[index])\n   }\n \n   // Otherwise, they're not equal."
        },
        {
            "sha": "5ab0f533cd32a776de6d92680e0dcf3f3b539c05",
            "filename": "test/e2e/app-dir/app-static/app-static.test.ts",
            "status": "modified",
            "additions": 84,
            "deletions": 0,
            "changes": 84,
            "blob_url": "https://github.com/vercel/next.js/blob/e368936401067709ce10fb6feeca24c56d8f253f/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e368936401067709ce10fb6feeca24c56d8f253f/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts?ref=e368936401067709ce10fb6feeca24c56d8f253f",
            "patch": "@@ -833,6 +833,10 @@ describe('app-dir static/dynamic handling', () => {\n          \"force-static/first.rsc\",\n          \"force-static/second.html\",\n          \"force-static/second.rsc\",\n+         \"gen-params-catch-all-unique/foo/bar.html\",\n+         \"gen-params-catch-all-unique/foo/bar.rsc\",\n+         \"gen-params-catch-all-unique/foo/foo.html\",\n+         \"gen-params-catch-all-unique/foo/foo.rsc\",\n          \"gen-params-dynamic-revalidate/one.html\",\n          \"gen-params-dynamic-revalidate/one.rsc\",\n          \"hooks/use-pathname/slug.html\",\n@@ -1314,6 +1318,54 @@ describe('app-dir static/dynamic handling', () => {\n            \"initialRevalidateSeconds\": false,\n            \"srcRoute\": \"/force-static/[slug]\",\n          },\n+         \"/gen-params-catch-all-unique/foo/bar\": {\n+           \"allowHeader\": [\n+             \"host\",\n+             \"x-matched-path\",\n+             \"x-prerender-revalidate\",\n+             \"x-prerender-revalidate-if-generated\",\n+             \"x-next-revalidated-tags\",\n+             \"x-next-revalidate-tag-token\",\n+           ],\n+           \"dataRoute\": \"/gen-params-catch-all-unique/foo/bar.rsc\",\n+           \"experimentalBypassFor\": [\n+             {\n+               \"key\": \"Next-Action\",\n+               \"type\": \"header\",\n+             },\n+             {\n+               \"key\": \"content-type\",\n+               \"type\": \"header\",\n+               \"value\": \"multipart/form-data;.*\",\n+             },\n+           ],\n+           \"initialRevalidateSeconds\": false,\n+           \"srcRoute\": \"/gen-params-catch-all-unique/[...slug]\",\n+         },\n+         \"/gen-params-catch-all-unique/foo/foo\": {\n+           \"allowHeader\": [\n+             \"host\",\n+             \"x-matched-path\",\n+             \"x-prerender-revalidate\",\n+             \"x-prerender-revalidate-if-generated\",\n+             \"x-next-revalidated-tags\",\n+             \"x-next-revalidate-tag-token\",\n+           ],\n+           \"dataRoute\": \"/gen-params-catch-all-unique/foo/foo.rsc\",\n+           \"experimentalBypassFor\": [\n+             {\n+               \"key\": \"Next-Action\",\n+               \"type\": \"header\",\n+             },\n+             {\n+               \"key\": \"content-type\",\n+               \"type\": \"header\",\n+               \"value\": \"multipart/form-data;.*\",\n+             },\n+           ],\n+           \"initialRevalidateSeconds\": false,\n+           \"srcRoute\": \"/gen-params-catch-all-unique/[...slug]\",\n+         },\n          \"/gen-params-dynamic-revalidate/one\": {\n            \"allowHeader\": [\n              \"host\",\n@@ -2430,6 +2482,31 @@ describe('app-dir static/dynamic handling', () => {\n            \"fallback\": null,\n            \"routeRegex\": \"^\\\\/force\\\\-static\\\\/([^\\\\/]+?)(?:\\\\/)?$\",\n          },\n+         \"/gen-params-catch-all-unique/[...slug]\": {\n+           \"allowHeader\": [\n+             \"host\",\n+             \"x-matched-path\",\n+             \"x-prerender-revalidate\",\n+             \"x-prerender-revalidate-if-generated\",\n+             \"x-next-revalidated-tags\",\n+             \"x-next-revalidate-tag-token\",\n+           ],\n+           \"dataRoute\": \"/gen-params-catch-all-unique/[...slug].rsc\",\n+           \"dataRouteRegex\": \"^\\\\/gen\\\\-params\\\\-catch\\\\-all\\\\-unique\\\\/(.+?)\\\\.rsc$\",\n+           \"experimentalBypassFor\": [\n+             {\n+               \"key\": \"Next-Action\",\n+               \"type\": \"header\",\n+             },\n+             {\n+               \"key\": \"content-type\",\n+               \"type\": \"header\",\n+               \"value\": \"multipart/form-data;.*\",\n+             },\n+           ],\n+           \"fallback\": false,\n+           \"routeRegex\": \"^\\\\/gen\\\\-params\\\\-catch\\\\-all\\\\-unique\\\\/(.+?)(?:\\\\/)?$\",\n+         },\n          \"/gen-params-dynamic-revalidate/[slug]\": {\n            \"allowHeader\": [\n              \"host\",\n@@ -3678,6 +3755,13 @@ describe('app-dir static/dynamic handling', () => {\n   })\n \n   if (!process.env.CUSTOM_CACHE_HANDLER) {\n+    it('should not filter out catch-all params with repeated segments in generateStaticParams', async () => {\n+      const res1 = await next.fetch('/gen-params-catch-all-unique/foo/foo')\n+      expect(res1.status).toBe(200)\n+      const res2 = await next.fetch('/gen-params-catch-all-unique/foo/bar')\n+      expect(res2.status).toBe(200)\n+    })\n+\n     it('should honor dynamic = \"force-static\" correctly', async () => {\n       const res = await next.fetch('/force-static/first')\n       expect(res.status).toBe(200)"
        },
        {
            "sha": "410fa95b4ed51ee92578c9f67f1db5bef8375536",
            "filename": "test/e2e/app-dir/app-static/app/gen-params-catch-all-unique/[...slug]/page.js",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/e368936401067709ce10fb6feeca24c56d8f253f/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp%2Fgen-params-catch-all-unique%2F%5B...slug%5D%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/e368936401067709ce10fb6feeca24c56d8f253f/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp%2Fgen-params-catch-all-unique%2F%5B...slug%5D%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp%2Fgen-params-catch-all-unique%2F%5B...slug%5D%2Fpage.js?ref=e368936401067709ce10fb6feeca24c56d8f253f",
            "patch": "@@ -0,0 +1,17 @@\n+export const dynamicParams = false\n+\n+export default async function Page({ params }) {\n+  const { slug } = await params\n+  return <p>Test {slug.join('/')}</p>\n+}\n+\n+export function generateStaticParams() {\n+  return [\n+    {\n+      slug: ['foo', 'foo'],\n+    },\n+    {\n+      slug: ['foo', 'bar'],\n+    },\n+  ]\n+}"
        }
    ],
    "stats": {
        "total": 103,
        "additions": 102,
        "deletions": 1
    }
}