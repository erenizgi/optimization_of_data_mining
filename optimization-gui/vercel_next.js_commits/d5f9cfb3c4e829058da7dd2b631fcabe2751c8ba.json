{
    "author": "sokra",
    "message": "Turbopack: read project strongly consistent in project_update (#83974)\n\n### What?\n\nOnce tasks should read all cells strongly consistent, but `project()` was not read strongly consistent.\n\n* read project strongly consistent in project_update",
    "sha": "d5f9cfb3c4e829058da7dd2b631fcabe2751c8ba",
    "files": [
        {
            "sha": "ed264f21a8d8711da5d7d59ec82bce35ce276b4e",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 3,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/d5f9cfb3c4e829058da7dd2b631fcabe2751c8ba/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/d5f9cfb3c4e829058da7dd2b631fcabe2751c8ba/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=d5f9cfb3c4e829058da7dd2b631fcabe2751c8ba",
            "patch": "@@ -289,6 +289,11 @@ impl ProjectContainer {\n     }\n }\n \n+#[turbo_tasks::function(operation)]\n+fn project_operation(project: ResolvedVc<ProjectContainer>) -> Vc<Project> {\n+    project.project()\n+}\n+\n #[turbo_tasks::function(operation)]\n fn project_fs_operation(project: ResolvedVc<Project>) -> Vc<DiskFileSystem> {\n     project.project_fs()\n@@ -344,7 +349,8 @@ impl ProjectContainer {\n             preview_props,\n         } = options;\n \n-        let this = self.await?;\n+        let resolved_self = self.to_resolved().await?;\n+        let this = resolved_self.await?;\n \n         let mut new_options = this\n             .options_state\n@@ -386,7 +392,9 @@ impl ProjectContainer {\n         // TODO: Handle mode switch, should prevent mode being switched.\n         let watch = new_options.watch;\n \n-        let project = self.project().to_resolved().await?;\n+        let project = project_operation(resolved_self)\n+            .resolve_strongly_consistent()\n+            .await?;\n         let prev_project_fs = project_fs_operation(project)\n             .read_strongly_consistent()\n             .await?;\n@@ -395,7 +403,9 @@ impl ProjectContainer {\n             .await?;\n \n         this.options_state.set(Some(new_options));\n-        let project = self.project().to_resolved().await?;\n+        let project = project_operation(resolved_self)\n+            .resolve_strongly_consistent()\n+            .await?;\n         let project_fs = project_fs_operation(project)\n             .read_strongly_consistent()\n             .await?;"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 13,
        "deletions": 3
    }
}