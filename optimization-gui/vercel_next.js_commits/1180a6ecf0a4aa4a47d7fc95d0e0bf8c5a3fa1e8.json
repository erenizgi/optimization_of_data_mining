{
    "author": "Cy-Tek",
    "message": "fix(Turbopack): Address duplicated metadata image modules when they are impored (#82367)",
    "sha": "1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8",
    "files": [
        {
            "sha": "84922db3a2d376cf027ef92c40027909db789951",
            "filename": "crates/next-core/src/next_image/source_asset.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fsource_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fsource_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fsource_asset.rs?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8",
            "patch": "@@ -35,9 +35,16 @@ pub struct StructuredImageFileSource {\n impl Source for StructuredImageFileSource {\n     #[turbo_tasks::function]\n     fn ident(&self) -> Vc<AssetIdent> {\n+        let modifier = match self.blur_placeholder_mode {\n+            BlurPlaceholderMode::DataUrl => rcstr!(\"structured image object with data url\"),\n+            BlurPlaceholderMode::NextImageUrl => {\n+                rcstr!(\"structured image object with next image url\")\n+            }\n+            BlurPlaceholderMode::None => rcstr!(\"structured image object\"),\n+        };\n         self.image\n             .ident()\n-            .with_modifier(rcstr!(\"structured image object\"))\n+            .with_modifier(modifier)\n             .rename_as(rcstr!(\"*.mjs\"))\n     }\n }"
        },
        {
            "sha": "a3b5b9cecd3761eaac9f3cd82556cd945e4f1c06",
            "filename": "test/e2e/app-dir/metadata-image-files/app/apple-icon.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fapple-icon.png",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fapple-icon.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fapple-icon.png?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8"
        },
        {
            "sha": "d18801609f6d61c96b3f1281c715af7354536bf1",
            "filename": "test/e2e/app-dir/metadata-image-files/app/icon.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Ficon.png",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Ficon.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Ficon.png?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8"
        },
        {
            "sha": "762515029332e8c2e3a36650c4dfc42ec2fdf9c6",
            "filename": "test/e2e/app-dir/metadata-image-files/app/layout.jsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Flayout.jsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Flayout.jsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Flayout.jsx?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Layout({ children }) {\n+  return (\n+    <html>\n+      <head></head>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "d18801609f6d61c96b3f1281c715af7354536bf1",
            "filename": "test/e2e/app-dir/metadata-image-files/app/not-metadata-image.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fnot-metadata-image.png",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fnot-metadata-image.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fnot-metadata-image.png?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8"
        },
        {
            "sha": "3ec73a67d7287bbdb7836a314b8ec4bbdd6845d1",
            "filename": "test/e2e/app-dir/metadata-image-files/app/opengraph-image.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fopengraph-image.png",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fopengraph-image.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fopengraph-image.png?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8"
        },
        {
            "sha": "c7c80fd21a8f3b237eba49c947d07dd18414d3c4",
            "filename": "test/e2e/app-dir/metadata-image-files/app/page.jsx",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fpage.jsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fpage.jsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Fpage.jsx?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8",
            "patch": "@@ -0,0 +1,18 @@\n+import _img from './apple-icon.png'\n+import _img2 from './icon.png'\n+import _img3 from './opengraph-image.png'\n+import _img4 from './twitter-image.png'\n+import _img5 from './not-metadata-image.png'\n+import Image from 'next/image'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <Image src={_img} placeholder=\"blur\" />\n+      <Image src={_img2} placeholder=\"blur\" />\n+      <Image src={_img3} placeholder=\"blur\" />\n+      <Image src={_img4} placeholder=\"blur\" />\n+      <Image src={_img5} placeholder=\"blur\" />\n+    </>\n+  )\n+}"
        },
        {
            "sha": "d18801609f6d61c96b3f1281c715af7354536bf1",
            "filename": "test/e2e/app-dir/metadata-image-files/app/twitter-image.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Ftwitter-image.png",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Ftwitter-image.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fapp%2Ftwitter-image.png?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8"
        },
        {
            "sha": "93d23135a3ea0c5015bbdc503644fc73c8455dc8",
            "filename": "test/e2e/app-dir/metadata-image-files/metadata-image-files.test.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fmetadata-image-files.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fmetadata-image-files.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-image-files%2Fmetadata-image-files.test.ts?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8",
            "patch": "@@ -0,0 +1,18 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('app dir - metadata image files', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should handle imported metadata images', async () => {\n+    const browser = await next.browser('/')\n+    const images = await browser.elementsByCss('img')\n+    expect(images.length).toBe(5)\n+\n+    for (const image of images) {\n+      const src = await image.getAttribute('src')\n+      expect(src).not.toContain('undefined')\n+    }\n+  })\n+})"
        },
        {
            "sha": "0606430439553519982aeaac806ca95926c4e279",
            "filename": "test/turbopack-build-tests-manifest.json",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fturbopack-build-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fturbopack-build-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-build-tests-manifest.json?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8",
            "patch": "@@ -3093,6 +3093,15 @@\n     \"flakey\": [],\n     \"runtimeError\": false\n   },\n+  \"test/e2e/app-dir/metadata-image-files/metadata-image-files.test.ts\": {\n+    \"passed\": [\n+      \"app dir - metadata image files should handle imported metadata images\"\n+    ],\n+    \"failed\": [],\n+    \"pending\": [],\n+    \"flakey\": [],\n+    \"runtimeError\": false\n+  },\n   \"test/e2e/app-dir/metadata-json-manifest/index.test.ts\": {\n     \"passed\": [\n       \"app-dir metadata-json-manifest should support metadata.json manifest\""
        },
        {
            "sha": "3caac5f35d893e874ff3f5be05c450bd99489116",
            "filename": "test/turbopack-dev-tests-manifest.json",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fturbopack-dev-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8/test%2Fturbopack-dev-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-dev-tests-manifest.json?ref=1180a6ecf0a4aa4a47d7fc95d0e0bf8c5a3fa1e8",
            "patch": "@@ -6942,6 +6942,15 @@\n     \"flakey\": [],\n     \"runtimeError\": false\n   },\n+  \"test/e2e/app-dir/metadata-image-files/metadata-image-files.test.ts\": {\n+    \"passed\": [\n+      \"app dir - metadata image files should handle imported metadata images\"\n+    ],\n+    \"failed\": [],\n+    \"pending\": [],\n+    \"flakey\": [],\n+    \"runtimeError\": false\n+  },\n   \"test/e2e/app-dir/metadata-json-manifest/index.test.ts\": {\n     \"passed\": [\n       \"app-dir metadata-json-manifest should support metadata.json manifest\""
        }
    ],
    "stats": {
        "total": 71,
        "additions": 70,
        "deletions": 1
    }
}