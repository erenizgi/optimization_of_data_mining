{
    "author": "bgw",
    "message": "fix(CI build_and_deploy): Use a larger fetch-depth for build-native job (#77307)\n\nIf not supplied, this defaults to a fetch-depth of 1, which likely\nexplains some of the tagless version strings I've seen...\n\nUse a fetch-depth of 100 so that we're always likely to find a previous\ntag.",
    "sha": "d874f0161ae68aba058bd6d781a76f9453c48616",
    "files": [
        {
            "sha": "950af755de81ba305529c3cee25cf2909de7546e",
            "filename": ".github/workflows/build_and_deploy.yml",
            "status": "modified",
            "additions": 15,
            "deletions": 1,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/d874f0161ae68aba058bd6d781a76f9453c48616/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/d874f0161ae68aba058bd6d781a76f9453c48616/.github%2Fworkflows%2Fbuild_and_deploy.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_deploy.yml?ref=d874f0161ae68aba058bd6d781a76f9453c48616",
            "patch": "@@ -297,6 +297,10 @@ jobs:\n       # we use checkout here instead of the build cache since\n       # it can fail to restore in different OS'\n       - uses: actions/checkout@v4\n+        with:\n+          # crates/napi/build.rs uses git-describe to find the most recent git tag. It's okay if\n+          # this fails, but fetch with enough depth that we're likely to find a recent tag.\n+          fetch-depth: 100\n \n       - name: Setup node\n         uses: actions/setup-node@v4\n@@ -347,7 +351,17 @@ jobs:\n \n       - name: Build in docker\n         if: ${{ matrix.settings.docker && steps.build-exists.outputs.BUILD_EXISTS == 'no' }}\n-        run: docker run -v \"/var/run/docker.sock\":\"/var/run/docker.sock\" -e RUST_BACKTRACE -e NAPI_CLI_VERSION -e CARGO_TERM_COLOR -e CARGO_INCREMENTAL -e CARGO_PROFILE_RELEASE_LTO -e CARGO_REGISTRIES_CRATES_IO_PROTOCOL -e TURBO_API -e TURBO_TEAM -e TURBO_TOKEN -e TURBO_VERSION -e TURBO_CACHE=\"remote:rw\" -v ${{ env.HOME }}/.cargo/git:/root/.cargo/git -v ${{ env.HOME }}/.cargo/registry:/root/.cargo/registry -v ${{ github.workspace }}:/build -w /build --entrypoint=bash ${{ matrix.settings.docker }} -c \"${{ matrix.settings.build }}\"\n+        run: |\n+          docker run -v \"/var/run/docker.sock\":\"/var/run/docker.sock\" \\\n+            -e CI -e RUST_BACKTRACE -e NAPI_CLI_VERSION -e CARGO_TERM_COLOR -e CARGO_INCREMENTAL \\\n+            -e CARGO_PROFILE_RELEASE_LTO -e CARGO_REGISTRIES_CRATES_IO_PROTOCOL -e TURBO_API \\\n+            -e TURBO_TEAM -e TURBO_TOKEN -e TURBO_VERSION -e TURBO_CACHE=\"remote:rw\" \\\n+            -v ${{ env.HOME }}/.cargo/git:/root/.cargo/git \\\n+            -v ${{ env.HOME }}/.cargo/registry:/root/.cargo/registry \\\n+            -v ${{ github.workspace }}:/build \\\n+            -w /build \\\n+            --entrypoint=bash ${{ matrix.settings.docker }} \\\n+            -c \"${{ matrix.settings.build }}\"\n \n       - name: cache build\n         if: ${{ matrix.settings.docker && steps.build-exists.outputs.BUILD_EXISTS == 'no' }}"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 15,
        "deletions": 1
    }
}