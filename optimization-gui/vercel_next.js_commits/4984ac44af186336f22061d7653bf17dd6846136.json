{
    "author": "icyJoseph",
    "message": "fix: Prevent duplicate file entries in modulesCode (#82550)\n\nFixes: https://github.com/vercel/next.js/issues/82515\n\nWhen global-error, and presumably other similar files are defined by\nusers,`next build` (Webpack) outputs this to\n`.next/server/app/page.js`(removed some values for brevity, see OP for\nmore):\n\n```js\n    layout: [/* */],\n    \"global-error\": [() => Promise.resolve().then(c.bind(c, 6076)), \"/my-app/app/global-error.tsx\"],\n    \"global-error\": [() => Promise.resolve().then(c.bind(c, 6076)), \"/my-app/app/global-error.tsx\"],\n    \"not-found\": [/* */],\n    forbidden: [/* */],\n    unauthorized: [/* */],\n    metadata: { /* content */ }\n```\n\nSince this is then loaded into memory (copied to a JS file that's later\nparsed - rather), the last `global-error` key is used ( `{a: 0, a: 100}`\nis just `{a: 100}`) - In this case though, the duplicate keys have the\nsame value too which makes this a **nice** to fix.\n\nThis PR does a `reduceRight` pass checking if we have seen this `file`\nalready, if so, skip. That should be safe enough to not introduce\nregressions.\n\nVerified Turbopack builds just for the sake of it - no \"issue\" there.",
    "sha": "4984ac44af186336f22061d7653bf17dd6846136",
    "files": [
        {
            "sha": "8338c7bf225d021f0bb5deab6f65b9cae098384b",
            "filename": "packages/next/src/build/webpack/loaders/next-app-loader/index.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/4984ac44af186336f22061d7653bf17dd6846136/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4984ac44af186336f22061d7653bf17dd6846136/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts?ref=4984ac44af186336f22061d7653bf17dd6846136",
            "patch": "@@ -287,7 +287,7 @@ async function createTreeCodeFromPath(\n \n       // Fill in the loader tree for all of the special files types (layout, default, etc) at this level\n       // `page` is not included here as it's added above.\n-      const filePaths = await Promise.all(\n+      const filePathEntries = await Promise.all(\n         Object.values(FILE_TYPES).map(async (file) => {\n           return [\n             file,\n@@ -302,6 +302,9 @@ async function createTreeCodeFromPath(\n           ] as const\n         })\n       )\n+      const filePaths = new Map<ValueOf<typeof FILE_TYPES>, string | undefined>(\n+        filePathEntries\n+      )\n \n       // Only resolve global-* convention files at the root layer\n       if (isRootLayer) {\n@@ -313,7 +316,7 @@ async function createTreeCodeFromPath(\n         }\n         // Add global-error to root layer's filePaths, so that it's always available,\n         // by default it's the built-in global-error.js\n-        filePaths.push([GLOBAL_ERROR_FILE_TYPE, globalError])\n+        filePaths.set(GLOBAL_ERROR_FILE_TYPE, globalError)\n \n         // TODO(global-not-found): remove this flag assertion condition\n         //  once global-not-found is stable\n@@ -326,11 +329,11 @@ async function createTreeCodeFromPath(\n           }\n           // Add global-not-found to root layer's filePaths, so that it's always available,\n           // by default it's the built-in global-not-found.js\n-          filePaths.push([GLOBAL_NOT_FOUND_FILE_TYPE, globalNotFound])\n+          filePaths.set(GLOBAL_NOT_FOUND_FILE_TYPE, globalNotFound)\n         }\n       }\n \n-      let definedFilePaths = filePaths.filter(\n+      let definedFilePaths = Array.from(filePaths.entries()).filter(\n         ([, filePath]) => filePath !== undefined\n       ) as [ValueOf<typeof FILE_TYPES>, string][]\n \n@@ -403,7 +406,7 @@ async function createTreeCodeFromPath(\n             : parallelSegmentKey\n \n       const normalizedParallelKey = normalizeParallelKey(parallelKey)\n-      let subtreeCode\n+      let subtreeCode: string | undefined\n       // If it's root not found page, set not-found boundary as children page\n       if (isNotFoundRoute) {\n         if (normalizedParallelKey === 'children') {"
        }
    ],
    "stats": {
        "total": 13,
        "additions": 8,
        "deletions": 5
    }
}