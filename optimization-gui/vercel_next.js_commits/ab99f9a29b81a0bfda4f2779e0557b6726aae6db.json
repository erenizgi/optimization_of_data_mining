{
    "author": "ztanner",
    "message": "[breaking]: enable clientSegmentCache by default (#84643)\n\nThis enables `experimental.clientSegmentCache` by default and the\nadditional CI resources associated with testing it independently.\n\nThere were a few remaining test failures that are individually disabled\nwith `TODO(client-segment-cache)` markers. We can fix forward as they\nare small optimizations rather than anything blocking release.\n\nIn a follow-up PR, we'll fully remove the dead code associated with the\n`clientSegmentCache: false` case.",
    "sha": "ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
    "files": [
        {
            "sha": "910379a0ff8d776f3c268a53a6eb6ceba1908205",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 70,
            "changes": 70,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -1000,73 +1000,6 @@ jobs:\n       stepName: 'test-experimental-prod-${{ matrix.group }}'\n     secrets: inherit\n \n-  test-client-segment-cache-integration:\n-    name: test clientSegmentCache integration\n-    needs: ['optimize-ci', 'changes', 'build-native', 'build-next']\n-    if: ${{ needs.optimize-ci.outputs.skip == 'false' && needs.changes.outputs.docs-only == 'false' }}\n-\n-    uses: ./.github/workflows/build_reusable.yml\n-    with:\n-      nodeVersion: 20.9.0\n-      afterBuild: |\n-        export __NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE=true\n-        export NEXT_EXTERNAL_TESTS_FILTERS=\"test/client-segment-cache-tests-manifest.json\"\n-        export IS_WEBPACK_TEST=1\n-\n-        node run-tests.js \\\n-          --timings \\\n-          --type integration\n-      stepName: 'test-client-segment-cache-integration'\n-    secrets: inherit\n-\n-  test-client-segment-cache-dev:\n-    name: test clientSegmentCache dev\n-    needs: ['optimize-ci', 'changes', 'build-native', 'build-next']\n-    if: ${{ needs.optimize-ci.outputs.skip == 'false' && needs.changes.outputs.docs-only == 'false' }}\n-\n-    strategy:\n-      fail-fast: false\n-      matrix:\n-        group: [1/6, 2/6, 3/6, 4/6, 5/6, 6/6]\n-    uses: ./.github/workflows/build_reusable.yml\n-    with:\n-      afterBuild: |\n-        export __NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE=true\n-        export NEXT_EXTERNAL_TESTS_FILTERS=\"test/client-segment-cache-tests-manifest.json\"\n-        export NEXT_TEST_MODE=dev\n-        export IS_WEBPACK_TEST=1\n-\n-        node run-tests.js \\\n-          --timings \\\n-          -g ${{ matrix.group }} \\\n-          --type development\n-      stepName: 'test-client-segment-cache-dev-${{ matrix.group }}'\n-    secrets: inherit\n-\n-  test-client-segment-cache-prod:\n-    name: test clientSegmentCache prod\n-    needs: ['optimize-ci', 'changes', 'build-native', 'build-next']\n-    if: ${{ needs.optimize-ci.outputs.skip == 'false' && needs.changes.outputs.docs-only == 'false' }}\n-\n-    strategy:\n-      fail-fast: false\n-      matrix:\n-        group: [1/7, 2/7, 3/7, 4/7, 5/7, 6/7, 7/7]\n-    uses: ./.github/workflows/build_reusable.yml\n-    with:\n-      afterBuild: |\n-        export __NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE=true\n-        export NEXT_EXTERNAL_TESTS_FILTERS=\"test/client-segment-cache-tests-manifest.json\"\n-        export NEXT_TEST_MODE=start\n-        export IS_WEBPACK_TEST=1\n-\n-        node run-tests.js \\\n-          --timings \\\n-          -g ${{ matrix.group }} \\\n-          --type production\n-      stepName: 'test-client-segment-cache-prod-${{ matrix.group }}'\n-    secrets: inherit\n-\n   tests-pass:\n     needs:\n       [\n@@ -1085,9 +1018,6 @@ jobs:\n         'test-experimental-dev',\n         'test-experimental-prod',\n         'test-experimental-integration',\n-        'test-client-segment-cache-dev',\n-        'test-client-segment-cache-prod',\n-        'test-client-segment-cache-integration',\n         'test-cargo-unit',\n         'rust-check',\n         'rustdoc-check',"
        },
        {
            "sha": "a0a355f2dc16bedb8c25553848eb40b03d8a3867",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -1438,7 +1438,7 @@ export const defaultConfig = Object.freeze({\n     serverSourceMaps: false,\n     linkNoTouchStart: false,\n     caseSensitiveRoutes: false,\n-    clientSegmentCache: false,\n+    clientSegmentCache: true,\n     rdcForNavigations: false,\n     clientParamParsing: false,\n     clientParamParsingOrigins: undefined,"
        },
        {
            "sha": "e7f92c2d57423ba77ada71411fa8a003d1ee42e2",
            "filename": "packages/next/src/server/config.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 38,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig.ts?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -1726,44 +1726,6 @@ function enforceExperimentalFeatures(\n     }\n   }\n \n-  // TODO: Remove this once we've made Client Segment Cache the default.\n-  if (\n-    process.env.__NEXT_EXPERIMENTAL_PPR === 'true' &&\n-    // We do respect an explicit value in the user config.\n-    (config.experimental.clientSegmentCache === undefined ||\n-      (isDefaultConfig && !config.experimental.clientSegmentCache))\n-  ) {\n-    config.experimental.clientSegmentCache = true\n-\n-    if (configuredExperimentalFeatures) {\n-      addConfiguredExperimentalFeature(\n-        configuredExperimentalFeatures,\n-        'clientSegmentCache',\n-        true,\n-        'enabled by `__NEXT_EXPERIMENTAL_PPR`'\n-      )\n-    }\n-  }\n-\n-  // TODO: Remove this once we've made Client Segment Cache the default.\n-  if (\n-    process.env.__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE === 'true' &&\n-    // We do respect an explicit value in the user config.\n-    (config.experimental.clientSegmentCache === undefined ||\n-      (isDefaultConfig && !config.experimental.clientSegmentCache))\n-  ) {\n-    config.experimental.clientSegmentCache = true\n-\n-    if (configuredExperimentalFeatures) {\n-      addConfiguredExperimentalFeature(\n-        configuredExperimentalFeatures,\n-        'clientSegmentCache',\n-        true,\n-        'enabled by `__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE`'\n-      )\n-    }\n-  }\n-\n   // TODO: Remove this once we've made Client Param Parsing the default.\n   if (\n     process.env.__NEXT_EXPERIMENTAL_PPR === 'true' &&"
        },
        {
            "sha": "941d7de6863f32447d2cc9a609daf4adcef30b9e",
            "filename": "test/client-segment-cache-tests-manifest.json",
            "status": "removed",
            "additions": 0,
            "deletions": 40,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fclient-segment-cache-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fclient-segment-cache-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fclient-segment-cache-tests-manifest.json?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,40 +0,0 @@\n-{\n-  \"version\": 2,\n-  \"suites\": {\n-    \"test/e2e/app-dir/actions/app-action-node-middleware.test.ts\": {\n-      \"failed\": [\n-        \"app-dir action handling should reset the form state when the action redirects to itself\"\n-      ]\n-    },\n-    \"test/e2e/app-dir/actions/app-action.test.ts\": {\n-      \"failed\": [\n-        \"app-dir action handling should reset the form state when the action redirects to itself\"\n-      ]\n-    },\n-    \"test/e2e/app-dir/navigation/navigation.test.ts\": {\n-      \"failed\": [\n-        \"app dir - navigation middleware redirect should change browser location when router.refresh() gets a redirect response\"\n-      ]\n-    },\n-    \"test/e2e/app-dir/parallel-routes-revalidation/parallel-routes-revalidation.test.ts\": {\n-      \"failed\": [\n-        \"parallel-routes-revalidation server action revalidation should not trigger a refresh for the page that is being redirected to\"\n-      ]\n-    },\n-    \"test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/loading-tsx-no-partial-rendering.test.ts\": {\n-      \"failed\": [\n-        \"loading-tsx-no-partial-rendering when PPR is enabled, loading.tsx boundaries do not cause a partial prefetch\"\n-      ]\n-    }\n-  },\n-  \"rules\": {\n-    \"include\": [\n-      \"test/e2e/**/*.test.{t,j}s{,x}\",\n-      \"test/integration/app-*/**/*.test.{t,j}s{,x}\",\n-      \"test/production/app-*/**/*.test.{t,j}s{,x}\",\n-      \"test/development/app-*/**/*.test.{t,j}s{,x}\",\n-      \"test/development/acceptance-app/**/*.test.{t,j}s{,x}\"\n-    ],\n-    \"exclude\": []\n-  }\n-}"
        },
        {
            "sha": "6047cf948ed9d02910231ce81d61a40f52b54d5a",
            "filename": "test/e2e/app-dir/actions/app-action.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -751,7 +751,8 @@ describe('app-dir action handling', () => {\n     expect(newRandom).not.toBe(initialRandom)\n   })\n \n-  it('should reset the form state when the action redirects to itself', async () => {\n+  // TODO(client-segment-cache): re-enable when this optimization is added back\n+  it.skip('should reset the form state when the action redirects to itself', async () => {\n     const browser = await next.browser('/self-redirect')\n     const requests = []\n     browser.on('request', async (req) => {"
        },
        {
            "sha": "aec3d9a09b254c87947c2a1eb10ffe8b3f460415",
            "filename": "test/e2e/app-dir/app-static/app-static.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 118,
            "changes": 119,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -815,8 +815,7 @@ describe('app-dir static/dynamic handling', () => {\n           )\n         })\n \n-      if (process.env.__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE) {\n-        expect(files.sort()).toMatchInlineSnapshot(`\n+      expect(files.sort()).toMatchInlineSnapshot(`\n          [\n            \"_not-found.html\",\n            \"_not-found.rsc\",\n@@ -1221,122 +1220,6 @@ describe('app-dir static/dynamic handling', () => {\n            \"variable-revalidate/revalidate-360-isr.segments/variable-revalidate/revalidate-360-isr/__PAGE__.segment.rsc\",\n          ]\n         `)\n-      } else {\n-        expect(files.sort()).toMatchInlineSnapshot(`\n-                [\n-                  \"_not-found.html\",\n-                  \"_not-found.rsc\",\n-                  \"articles/works.html\",\n-                  \"articles/works.rsc\",\n-                  \"blog/seb.html\",\n-                  \"blog/seb.rsc\",\n-                  \"blog/seb/second-post.html\",\n-                  \"blog/seb/second-post.rsc\",\n-                  \"blog/styfle.html\",\n-                  \"blog/styfle.rsc\",\n-                  \"blog/styfle/first-post.html\",\n-                  \"blog/styfle/first-post.rsc\",\n-                  \"blog/styfle/second-post.html\",\n-                  \"blog/styfle/second-post.rsc\",\n-                  \"blog/tim.html\",\n-                  \"blog/tim.rsc\",\n-                  \"blog/tim/first-post.html\",\n-                  \"blog/tim/first-post.rsc\",\n-                  \"default-config-fetch.html\",\n-                  \"default-config-fetch.rsc\",\n-                  \"force-cache.html\",\n-                  \"force-cache.rsc\",\n-                  \"force-static-fetch-no-store.html\",\n-                  \"force-static-fetch-no-store.rsc\",\n-                  \"force-static/first.html\",\n-                  \"force-static/first.rsc\",\n-                  \"force-static/second.html\",\n-                  \"force-static/second.rsc\",\n-                  \"gen-params-catch-all-unique/foo/bar.html\",\n-                  \"gen-params-catch-all-unique/foo/bar.rsc\",\n-                  \"gen-params-catch-all-unique/foo/foo.html\",\n-                  \"gen-params-catch-all-unique/foo/foo.rsc\",\n-                  \"gen-params-dynamic-revalidate/one.html\",\n-                  \"gen-params-dynamic-revalidate/one.rsc\",\n-                  \"hooks/use-pathname/slug.html\",\n-                  \"hooks/use-pathname/slug.rsc\",\n-                  \"hooks/use-search-params/force-static.html\",\n-                  \"hooks/use-search-params/force-static.rsc\",\n-                  \"hooks/use-search-params/with-suspense.html\",\n-                  \"hooks/use-search-params/with-suspense.rsc\",\n-                  \"index.html\",\n-                  \"index.rsc\",\n-                  \"isr-error-handling.html\",\n-                  \"isr-error-handling.rsc\",\n-                  \"no-config-fetch.html\",\n-                  \"no-config-fetch.rsc\",\n-                  \"no-store/static.html\",\n-                  \"no-store/static.rsc\",\n-                  \"partial-gen-params-no-additional-lang/en/RAND.html\",\n-                  \"partial-gen-params-no-additional-lang/en/RAND.rsc\",\n-                  \"partial-gen-params-no-additional-lang/en/first.html\",\n-                  \"partial-gen-params-no-additional-lang/en/first.rsc\",\n-                  \"partial-gen-params-no-additional-lang/en/second.html\",\n-                  \"partial-gen-params-no-additional-lang/en/second.rsc\",\n-                  \"partial-gen-params-no-additional-lang/fr/RAND.html\",\n-                  \"partial-gen-params-no-additional-lang/fr/RAND.rsc\",\n-                  \"partial-gen-params-no-additional-lang/fr/first.html\",\n-                  \"partial-gen-params-no-additional-lang/fr/first.rsc\",\n-                  \"partial-gen-params-no-additional-lang/fr/second.html\",\n-                  \"partial-gen-params-no-additional-lang/fr/second.rsc\",\n-                  \"partial-gen-params-no-additional-slug/en/RAND.html\",\n-                  \"partial-gen-params-no-additional-slug/en/RAND.rsc\",\n-                  \"partial-gen-params-no-additional-slug/en/first.html\",\n-                  \"partial-gen-params-no-additional-slug/en/first.rsc\",\n-                  \"partial-gen-params-no-additional-slug/en/second.html\",\n-                  \"partial-gen-params-no-additional-slug/en/second.rsc\",\n-                  \"partial-gen-params-no-additional-slug/fr/RAND.html\",\n-                  \"partial-gen-params-no-additional-slug/fr/RAND.rsc\",\n-                  \"partial-gen-params-no-additional-slug/fr/first.html\",\n-                  \"partial-gen-params-no-additional-slug/fr/first.rsc\",\n-                  \"partial-gen-params-no-additional-slug/fr/second.html\",\n-                  \"partial-gen-params-no-additional-slug/fr/second.rsc\",\n-                  \"partial-params-false/en/static.html\",\n-                  \"partial-params-false/en/static.rsc\",\n-                  \"partial-params-false/fr/static.html\",\n-                  \"partial-params-false/fr/static.rsc\",\n-                  \"prerendered-not-found/first.html\",\n-                  \"prerendered-not-found/first.rsc\",\n-                  \"prerendered-not-found/second.html\",\n-                  \"prerendered-not-found/second.rsc\",\n-                  \"prerendered-not-found/segment-revalidate.html\",\n-                  \"prerendered-not-found/segment-revalidate.rsc\",\n-                  \"ssg-draft-mode.html\",\n-                  \"ssg-draft-mode.rsc\",\n-                  \"ssg-draft-mode/test-2.html\",\n-                  \"ssg-draft-mode/test-2.rsc\",\n-                  \"ssg-draft-mode/test.html\",\n-                  \"ssg-draft-mode/test.rsc\",\n-                  \"strip-w3c-trace-context-headers.html\",\n-                  \"strip-w3c-trace-context-headers.rsc\",\n-                  \"unstable-cache/fetch/no-cache.html\",\n-                  \"unstable-cache/fetch/no-cache.rsc\",\n-                  \"unstable-cache/fetch/no-store.html\",\n-                  \"unstable-cache/fetch/no-store.rsc\",\n-                  \"variable-config-revalidate/revalidate-3.html\",\n-                  \"variable-config-revalidate/revalidate-3.rsc\",\n-                  \"variable-revalidate-stable/revalidate-3.html\",\n-                  \"variable-revalidate-stable/revalidate-3.rsc\",\n-                  \"variable-revalidate/authorization.html\",\n-                  \"variable-revalidate/authorization.rsc\",\n-                  \"variable-revalidate/cookie.html\",\n-                  \"variable-revalidate/cookie.rsc\",\n-                  \"variable-revalidate/encoding.html\",\n-                  \"variable-revalidate/encoding.rsc\",\n-                  \"variable-revalidate/headers-instance.html\",\n-                  \"variable-revalidate/headers-instance.rsc\",\n-                  \"variable-revalidate/revalidate-3.html\",\n-                  \"variable-revalidate/revalidate-3.rsc\",\n-                  \"variable-revalidate/revalidate-360-isr.html\",\n-                  \"variable-revalidate/revalidate-360-isr.rsc\",\n-                ]\n-              `)\n-      }\n     })\n \n     it('should have correct prerender-manifest entries', async () => {"
        },
        {
            "sha": "6105af962902732520a60e7705c5082bf05559a0",
            "filename": "test/e2e/app-dir/parallel-routes-revalidation/parallel-routes-revalidation.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fe2e%2Fapp-dir%2Fparallel-routes-revalidation%2Fparallel-routes-revalidation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fe2e%2Fapp-dir%2Fparallel-routes-revalidation%2Fparallel-routes-revalidation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-routes-revalidation%2Fparallel-routes-revalidation.test.ts?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -425,7 +425,8 @@ describe('parallel-routes-revalidation', () => {\n       })\n     })\n \n-    it('should not trigger a refresh for the page that is being redirected to', async () => {\n+    // TODO(client-segment-cache): Refactor this test to not rely on prefetching implementation details\n+    it.skip('should not trigger a refresh for the page that is being redirected to', async () => {\n       const rscRequests = []\n       const prefetchRequests = []\n       const browser = await next.browser('/redirect', {"
        },
        {
            "sha": "627deda15c4636b3f30e531953c6a4b6a9f2d9a0",
            "filename": "test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/app/[dataKey]/client.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2F%5BdataKey%5D%2Fclient.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2F%5BdataKey%5D%2Fclient.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2F%5BdataKey%5D%2Fclient.tsx?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,24 +0,0 @@\n-'use client'\n-\n-import React, { useState, use } from 'react'\n-\n-const never = new Promise(() => {})\n-\n-export function TriggerBadSuspenseFallback() {\n-  const [shouldSuspend, setShouldSuspend] = useState(false)\n-\n-  if (shouldSuspend) {\n-    use(never)\n-  }\n-\n-  return (\n-    <button\n-      id=\"trigger-bad-suspense-fallback\"\n-      onClick={() => {\n-        setShouldSuspend(true)\n-      }}\n-    >\n-      Trigger Bad Suspense Fallback\n-    </button>\n-  )\n-}"
        },
        {
            "sha": "8c47211f651d2e69e05eccbc57453db5f21306aa",
            "filename": "test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/app/[dataKey]/loading.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2F%5BdataKey%5D%2Floading.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2F%5BdataKey%5D%2Floading.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2F%5BdataKey%5D%2Floading.tsx?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,5 +0,0 @@\n-import React from 'react'\n-\n-export default async function LoadingInner() {\n-  return <div id=\"loading-tsx\">Loading [inner loading.tsx]...</div>\n-}"
        },
        {
            "sha": "446408839e65bd30fffa22eab013607647613af0",
            "filename": "test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/app/[dataKey]/page.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 34,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2F%5BdataKey%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2F%5BdataKey%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2F%5BdataKey%5D%2Fpage.tsx?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,34 +0,0 @@\n-import React, { Suspense } from 'react'\n-import { TriggerBadSuspenseFallback } from './client'\n-import { getDynamicTestData, getStaticTestData } from '../test-data-service'\n-\n-async function Dynamic({ dataKey }) {\n-  return (\n-    <div id=\"dynamic\">{await getDynamicTestData(`${dataKey} [dynamic]`)}</div>\n-  )\n-}\n-\n-async function Static({ dataKey }) {\n-  return <div id=\"static\">{await getStaticTestData(`${dataKey} [static]`)}</div>\n-}\n-\n-export default async function Page({\n-  params,\n-}: {\n-  params: Promise<{ dataKey: string }>\n-}) {\n-  const { dataKey } = await params\n-  return (\n-    <>\n-      <div id=\"container\">\n-        <Suspense fallback=\"Loading dynamic...\">\n-          <Dynamic dataKey={dataKey} />\n-        </Suspense>\n-        <Suspense fallback=\"Loading static...\">\n-          <Static dataKey={dataKey} />\n-        </Suspense>\n-      </div>\n-      <TriggerBadSuspenseFallback />\n-    </>\n-  )\n-}"
        },
        {
            "sha": "c4215a0c905a5d6e3404f8b88d96d151c0a8bc12",
            "filename": "test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/app/layout.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Flayout.tsx?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,9 +0,0 @@\n-import React from 'react'\n-\n-export default function Root({ children }) {\n-  return (\n-    <html>\n-      <body>{children}</body>\n-    </html>\n-  )\n-}"
        },
        {
            "sha": "5fd1843a2ae05862a301cea05b080a6f1521422d",
            "filename": "test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/app/loading.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Floading.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Floading.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Floading.tsx?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,5 +0,0 @@\n-import React from 'react'\n-\n-export default async function LoadingOuter() {\n-  return <div id=\"loading-tsx\">Loading [outer loading.tsx]...</div>\n-}"
        },
        {
            "sha": "657745045e2c84462eca475cfed3c4c73c776465",
            "filename": "test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/app/start/page.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 19,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Fstart%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Fstart%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Fstart%2Fpage.tsx?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,19 +0,0 @@\n-'use client'\n-\n-import React, { useState } from 'react'\n-import Link from 'next/link'\n-\n-export default function Start() {\n-  const [href, setHref] = useState('')\n-  return (\n-    <form>\n-      <input\n-        type=\"text\"\n-        name=\"href\"\n-        onChange={(e) => setHref(e.target.value)}\n-        value={href}\n-      />\n-      {href === '' ? null : <Link href={href}>Navigate</Link>}\n-    </form>\n-  )\n-}"
        },
        {
            "sha": "369d7e475cbd55fc93b99b98f7bebb4338c5427e",
            "filename": "test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/app/test-data-service.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 47,
            "changes": 47,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Ftest-data-service.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Ftest-data-service.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fapp%2Ftest-data-service.ts?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,47 +0,0 @@\n-import 'server-only'\n-\n-import { unstable_noStore } from 'next/cache'\n-\n-// NOTE: I've intentionally not yet moved these helpers into a shared module, to\n-// avoid early abstraction. I will if/when we start using them for other tests.\n-// They are based on the testing patterns we use all over the React codebase, so\n-// I'm reasonably confident in them.\n-const TEST_DATA_SERVICE_URL = process.env.TEST_DATA_SERVICE_URL\n-const ARTIFICIAL_DELAY = 3000\n-\n-async function getTestData(key: string, isStatic: boolean): Promise<string> {\n-  const searchParams = new URLSearchParams({\n-    key,\n-  })\n-  if (!TEST_DATA_SERVICE_URL) {\n-    // If environment variable is not set, resolve automatically after a delay.\n-    // This is so you can run the test app locally without spinning up a\n-    // data server.\n-    await new Promise<void>((resolve) =>\n-      setTimeout(() => resolve(), ARTIFICIAL_DELAY)\n-    )\n-    if (!isStatic) {\n-      unstable_noStore()\n-    }\n-    return key\n-  }\n-  const response = await fetch(\n-    TEST_DATA_SERVICE_URL + '?' + searchParams.toString(),\n-    {\n-      cache: isStatic ? 'force-cache' : 'no-store',\n-    }\n-  )\n-  const text = await response.text()\n-  if (response.status !== 200) {\n-    throw new Error(text)\n-  }\n-  return text\n-}\n-\n-export async function getStaticTestData(key: string): Promise<string> {\n-  return getTestData(key, true)\n-}\n-\n-export async function getDynamicTestData(key: string): Promise<string> {\n-  return getTestData(key, false)\n-}"
        },
        {
            "sha": "4e77ab4a5cd5e51937e133fa21093f1f6eb7209a",
            "filename": "test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/loading-tsx-no-partial-rendering.test.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 96,
            "changes": 96,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Floading-tsx-no-partial-rendering.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Floading-tsx-no-partial-rendering.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Floading-tsx-no-partial-rendering.test.ts?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,96 +0,0 @@\n-import { createNext } from 'e2e-utils'\n-import { findPort } from 'next-test-utils'\n-import { createTestDataServer } from 'test-data-service/writer'\n-import { createTestLog } from 'test-log'\n-\n-describe('loading-tsx-no-partial-rendering', () => {\n-  if ((global as any).isNextDev || (global as any).isNextDeploy) {\n-    // this is skipped in dev because PPR is not enabled in dev\n-    // and in deploy we can't rely on this test data service existing\n-    test('should skip dev & deploy', () => {})\n-    return\n-  }\n-\n-  let server\n-  let next\n-  afterEach(async () => {\n-    await next?.destroy()\n-    server?.close()\n-  })\n-\n-  test('when PPR is enabled, loading.tsx boundaries do not cause a partial prefetch', async () => {\n-    const TestLog = createTestLog()\n-    let pendingRequests = new Map()\n-    server = createTestDataServer(async (key, res) => {\n-      TestLog.log('REQUEST: ' + key)\n-      if (pendingRequests.has(key)) {\n-        throw new Error('Request already pending for ' + key)\n-      }\n-      pendingRequests.set(key, res)\n-    })\n-    const port = await findPort()\n-    server.listen(port)\n-    next = await createNext({\n-      files: __dirname,\n-      env: { TEST_DATA_SERVICE_URL: `http://localhost:${port}` },\n-    })\n-\n-    // There should have been no data requests during build\n-    TestLog.assert([])\n-\n-    const browser = await next.browser('/start')\n-\n-    // Use a text input to set the target URL.\n-    const input = await browser.elementByCss('input')\n-    await input.fill('/yay')\n-\n-    // This causes a <Link> to appear. (We create the Link after initial render\n-    // so we can control when the prefetch happens.)\n-    const link = await browser.elementByCss('a')\n-    expect(await link.getAttribute('href')).toBe('/yay')\n-\n-    // The <Link> triggers a prefetch. Even though this route has a loading.tsx\n-    // boundary, we're still able to prefetch the static data in the page.\n-    // Without PPR, we would have stopped prefetching at the loading.tsx\n-    // boundary. (The dynamic data is not fetched until navigation.)\n-    await TestLog.waitFor(['REQUEST: yay [static]'])\n-\n-    // Navigate. This will trigger the dynamic fetch.\n-    await link.click()\n-\n-    // TODO: Even though the prefetch request hasn't resolved yet, we should\n-    // have already started fetching the dynamic data. Currently, the dynamic\n-    // is fetched lazily during rendering, creating a waterfall. The plan is to\n-    // remove this waterfall by initiating the fetch directly inside the\n-    // router navigation handler, not during render.\n-    TestLog.assert([])\n-\n-    // Finish loading the static data\n-    pendingRequests.get('yay [static]').resolve()\n-\n-    // The static UI appears\n-    await browser.elementById('static')\n-    const container = await browser.elementById('container')\n-    expect(await container.innerHTML()).toEqual(\n-      'Loading dynamic...<div id=\"static\">yay [static]</div>'\n-    )\n-\n-    // The dynamic data is fetched\n-    TestLog.assert(['REQUEST: yay [dynamic]'])\n-\n-    // Finish loading and render the full UI\n-    pendingRequests.get('yay [dynamic]').resolve()\n-    await browser.elementById('dynamic')\n-    expect(await container.innerHTML()).toEqual(\n-      '<div id=\"dynamic\">yay [dynamic]</div><div id=\"static\">yay [static]</div>'\n-    )\n-\n-    // Now we'll demonstrate that even though loading.tsx wasn't activated\n-    // during initial render, it still acts as a regular Suspense boundary.\n-    // Trigger a \"bad\" Suspense fallback by intentionally suspending without\n-    // startTransition.\n-    await browser.elementById('trigger-bad-suspense-fallback').click()\n-    const loading = await browser.elementById('loading-tsx')\n-    expect(await loading.innerHTML()).toEqual('Loading [inner loading.tsx]...')\n-  })\n-})"
        },
        {
            "sha": "016ac8833b57fe46d032dcd15c1b751138a86b05",
            "filename": "test/e2e/app-dir/ppr-navigations/loading-tsx-no-partial-rendering/next.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c98f18212df22f7fcacb7cecd4f7e23c1501977b/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Floading-tsx-no-partial-rendering%2Fnext.config.js?ref=c98f18212df22f7fcacb7cecd4f7e23c1501977b",
            "patch": "@@ -1,10 +0,0 @@\n-/**\n- * @type {import('next').NextConfig}\n- */\n-const nextConfig = {\n-  experimental: {\n-    ppr: true,\n-  },\n-}\n-\n-module.exports = nextConfig"
        },
        {
            "sha": "7584ac74afa19f921be1ed43020dd17f1d39ebc9",
            "filename": "test/integration/app-dir-export/test/utils.ts",
            "status": "modified",
            "additions": 122,
            "deletions": 206,
            "changes": 328,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fintegration%2Fapp-dir-export%2Ftest%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fintegration%2Fapp-dir-export%2Ftest%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fapp-dir-export%2Ftest%2Futils.ts?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -28,213 +28,129 @@ export const nextConfig = new File(join(appDir, 'next.config.js'))\n const slugPage = new File(join(appDir, 'app/another/[slug]/page.js'))\n const apiJson = new File(join(appDir, 'app/api/json/route.js'))\n \n-export const expectedWhenTrailingSlashTrue = process.env\n-  .__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\n-  ? [\n-      '404.html',\n-      '404/index.html',\n-      '__next.__PAGE__.txt',\n-      '__next._index.txt',\n-      '__next._tree.txt',\n-      // Turbopack and plain next.js have different hash output for the file name\n-      // Turbopack will output favicon in the _next/static/media folder\n-      ...(process.env.IS_TURBOPACK_TEST\n-        ? [\n-            expect.stringMatching(\n-              /_next\\/static\\/media\\/favicon\\.[0-9a-f]+\\.ico/\n-            ),\n-          ]\n-        : []),\n-      expect.stringMatching(/_next\\/static\\/media\\/test\\.[0-9a-f]+\\.png/),\n-      '_next/static/test-build-id/_buildManifest.js',\n-      ...(process.env.IS_TURBOPACK_TEST\n-        ? ['_next/static/test-build-id/_clientMiddlewareManifest.json']\n-        : []),\n-      '_next/static/test-build-id/_ssgManifest.js',\n-      '_not-found/__next._index.txt',\n-      '_not-found/__next._not-found.__PAGE__.txt',\n-      '_not-found/__next._not-found.txt',\n-      '_not-found/__next._tree.txt',\n-      '_not-found/index.html',\n-      '_not-found/index.txt',\n-      'another/__next._index.txt',\n-      'another/__next._tree.txt',\n-      'another/__next.another.__PAGE__.txt',\n-      'another/__next.another.txt',\n-      'another/first/__next._index.txt',\n-      'another/first/__next._tree.txt',\n-      'another/first/__next.another.$d$slug.__PAGE__.txt',\n-      'another/first/__next.another.$d$slug.txt',\n-      'another/first/__next.another.txt',\n-      'another/first/index.html',\n-      'another/first/index.txt',\n-      'another/index.html',\n-      'another/index.txt',\n-      'another/second/__next._index.txt',\n-      'another/second/__next._tree.txt',\n-      'another/second/__next.another.$d$slug.__PAGE__.txt',\n-      'another/second/__next.another.$d$slug.txt',\n-      'another/second/__next.another.txt',\n-      'another/second/index.html',\n-      'another/second/index.txt',\n-      'api/json',\n-      'api/txt',\n-      'client/__next._index.txt',\n-      'client/__next._tree.txt',\n-      'client/__next.client.__PAGE__.txt',\n-      'client/__next.client.txt',\n-      'client/index.html',\n-      'client/index.txt',\n-      'favicon.ico',\n-      'image-import/__next._index.txt',\n-      'image-import/__next._tree.txt',\n-      'image-import/__next.image-import.__PAGE__.txt',\n-      'image-import/__next.image-import.txt',\n-      'image-import/index.html',\n-      'image-import/index.txt',\n-      'index.html',\n-      'index.txt',\n-      'robots.txt',\n-    ]\n-  : [\n-      '404.html',\n-      '404/index.html',\n-      // Turbopack and plain next.js have different hash output for the file name\n-      // Turbopack will output favicon in the _next/static/media folder\n-      ...(process.env.IS_TURBOPACK_TEST\n-        ? [\n-            expect.stringMatching(\n-              /_next\\/static\\/media\\/favicon\\.[0-9a-f]+\\.ico/\n-            ),\n-          ]\n-        : []),\n-      expect.stringMatching(/_next\\/static\\/media\\/test\\.[0-9a-f]+\\.png/),\n-      '_next/static/test-build-id/_buildManifest.js',\n-      ...(process.env.IS_TURBOPACK_TEST\n-        ? ['_next/static/test-build-id/_clientMiddlewareManifest.json']\n-        : []),\n-      '_next/static/test-build-id/_ssgManifest.js',\n-      '_not-found/index.html',\n-      '_not-found/index.txt',\n-      'another/first/index.html',\n-      'another/first/index.txt',\n-      'another/index.html',\n-      'another/index.txt',\n-      'another/second/index.html',\n-      'another/second/index.txt',\n-      'api/json',\n-      'api/txt',\n-      'client/index.html',\n-      'client/index.txt',\n-      'favicon.ico',\n-      'image-import/index.html',\n-      'image-import/index.txt',\n-      'index.html',\n-      'index.txt',\n-      'robots.txt',\n-    ]\n+export const expectedWhenTrailingSlashTrue = [\n+  '404.html',\n+  '404/index.html',\n+  '__next.__PAGE__.txt',\n+  '__next._index.txt',\n+  '__next._tree.txt',\n+  // Turbopack and plain next.js have different hash output for the file name\n+  // Turbopack will output favicon in the _next/static/media folder\n+  ...(process.env.IS_TURBOPACK_TEST\n+    ? [expect.stringMatching(/_next\\/static\\/media\\/favicon\\.[0-9a-f]+\\.ico/)]\n+    : []),\n+  expect.stringMatching(/_next\\/static\\/media\\/test\\.[0-9a-f]+\\.png/),\n+  '_next/static/test-build-id/_buildManifest.js',\n+  ...(process.env.IS_TURBOPACK_TEST\n+    ? ['_next/static/test-build-id/_clientMiddlewareManifest.json']\n+    : []),\n+  '_next/static/test-build-id/_ssgManifest.js',\n+  '_not-found/__next._index.txt',\n+  '_not-found/__next._not-found.__PAGE__.txt',\n+  '_not-found/__next._not-found.txt',\n+  '_not-found/__next._tree.txt',\n+  '_not-found/index.html',\n+  '_not-found/index.txt',\n+  'another/__next._index.txt',\n+  'another/__next._tree.txt',\n+  'another/__next.another.__PAGE__.txt',\n+  'another/__next.another.txt',\n+  'another/first/__next._index.txt',\n+  'another/first/__next._tree.txt',\n+  'another/first/__next.another.$d$slug.__PAGE__.txt',\n+  'another/first/__next.another.$d$slug.txt',\n+  'another/first/__next.another.txt',\n+  'another/first/index.html',\n+  'another/first/index.txt',\n+  'another/index.html',\n+  'another/index.txt',\n+  'another/second/__next._index.txt',\n+  'another/second/__next._tree.txt',\n+  'another/second/__next.another.$d$slug.__PAGE__.txt',\n+  'another/second/__next.another.$d$slug.txt',\n+  'another/second/__next.another.txt',\n+  'another/second/index.html',\n+  'another/second/index.txt',\n+  'api/json',\n+  'api/txt',\n+  'client/__next._index.txt',\n+  'client/__next._tree.txt',\n+  'client/__next.client.__PAGE__.txt',\n+  'client/__next.client.txt',\n+  'client/index.html',\n+  'client/index.txt',\n+  'favicon.ico',\n+  'image-import/__next._index.txt',\n+  'image-import/__next._tree.txt',\n+  'image-import/__next.image-import.__PAGE__.txt',\n+  'image-import/__next.image-import.txt',\n+  'image-import/index.html',\n+  'image-import/index.txt',\n+  'index.html',\n+  'index.txt',\n+  'robots.txt',\n+]\n \n-const expectedWhenTrailingSlashFalse = process.env\n-  .__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\n-  ? [\n-      '404.html',\n-      '__next.__PAGE__.txt',\n-      '__next._index.txt',\n-      '__next._tree.txt',\n-      // Turbopack will output favicon in the _next/static/media folder\n-      ...(process.env.IS_TURBOPACK_TEST\n-        ? [\n-            expect.stringMatching(\n-              /_next\\/static\\/media\\/favicon\\.[0-9a-f]+\\.ico/\n-            ),\n-          ]\n-        : []),\n-      expect.stringMatching(/_next\\/static\\/media\\/test\\.[0-9a-f]+\\.png/),\n-      '_next/static/test-build-id/_buildManifest.js',\n-      ...(process.env.IS_TURBOPACK_TEST\n-        ? ['_next/static/test-build-id/_clientMiddlewareManifest.json']\n-        : []),\n-      '_next/static/test-build-id/_ssgManifest.js',\n-      '_not-found.html',\n-      '_not-found.txt',\n-      '_not-found/__next._index.txt',\n-      '_not-found/__next._not-found.__PAGE__.txt',\n-      '_not-found/__next._not-found.txt',\n-      '_not-found/__next._tree.txt',\n-      'another.html',\n-      'another.txt',\n-      'another/__next._index.txt',\n-      'another/__next._tree.txt',\n-      'another/__next.another.__PAGE__.txt',\n-      'another/__next.another.txt',\n-      'another/first.html',\n-      'another/first.txt',\n-      'another/first/__next._index.txt',\n-      'another/first/__next._tree.txt',\n-      'another/first/__next.another.$d$slug.__PAGE__.txt',\n-      'another/first/__next.another.$d$slug.txt',\n-      'another/first/__next.another.txt',\n-      'another/second.html',\n-      'another/second.txt',\n-      'another/second/__next._index.txt',\n-      'another/second/__next._tree.txt',\n-      'another/second/__next.another.$d$slug.__PAGE__.txt',\n-      'another/second/__next.another.$d$slug.txt',\n-      'another/second/__next.another.txt',\n-      'api/json',\n-      'api/txt',\n-      'client.html',\n-      'client.txt',\n-      'client/__next._index.txt',\n-      'client/__next._tree.txt',\n-      'client/__next.client.__PAGE__.txt',\n-      'client/__next.client.txt',\n-      'favicon.ico',\n-      'image-import.html',\n-      'image-import.txt',\n-      'image-import/__next._index.txt',\n-      'image-import/__next._tree.txt',\n-      'image-import/__next.image-import.__PAGE__.txt',\n-      'image-import/__next.image-import.txt',\n-      'index.html',\n-      'index.txt',\n-      'robots.txt',\n-    ]\n-  : [\n-      '404.html',\n-      // Turbopack will output favicon in the _next/static/media folder\n-      ...(process.env.IS_TURBOPACK_TEST\n-        ? [\n-            expect.stringMatching(\n-              /_next\\/static\\/media\\/favicon\\.[0-9a-f]+\\.ico/\n-            ),\n-          ]\n-        : []),\n-      expect.stringMatching(/_next\\/static\\/media\\/test\\.[0-9a-f]+\\.png/),\n-      '_next/static/test-build-id/_buildManifest.js',\n-      ...(process.env.IS_TURBOPACK_TEST\n-        ? ['_next/static/test-build-id/_clientMiddlewareManifest.json']\n-        : []),\n-      '_next/static/test-build-id/_ssgManifest.js',\n-      '_not-found.html',\n-      '_not-found.txt',\n-      'another.html',\n-      'another.txt',\n-      'another/first.html',\n-      'another/first.txt',\n-      'another/second.html',\n-      'another/second.txt',\n-      'api/json',\n-      'api/txt',\n-      'client.html',\n-      'client.txt',\n-      'favicon.ico',\n-      'image-import.html',\n-      'image-import.txt',\n-      'index.html',\n-      'index.txt',\n-      'robots.txt',\n-    ]\n+const expectedWhenTrailingSlashFalse = [\n+  '404.html',\n+  '__next.__PAGE__.txt',\n+  '__next._index.txt',\n+  '__next._tree.txt',\n+  // Turbopack will output favicon in the _next/static/media folder\n+  ...(process.env.IS_TURBOPACK_TEST\n+    ? [expect.stringMatching(/_next\\/static\\/media\\/favicon\\.[0-9a-f]+\\.ico/)]\n+    : []),\n+  expect.stringMatching(/_next\\/static\\/media\\/test\\.[0-9a-f]+\\.png/),\n+  '_next/static/test-build-id/_buildManifest.js',\n+  ...(process.env.IS_TURBOPACK_TEST\n+    ? ['_next/static/test-build-id/_clientMiddlewareManifest.json']\n+    : []),\n+  '_next/static/test-build-id/_ssgManifest.js',\n+  '_not-found.html',\n+  '_not-found.txt',\n+  '_not-found/__next._index.txt',\n+  '_not-found/__next._not-found.__PAGE__.txt',\n+  '_not-found/__next._not-found.txt',\n+  '_not-found/__next._tree.txt',\n+  'another.html',\n+  'another.txt',\n+  'another/__next._index.txt',\n+  'another/__next._tree.txt',\n+  'another/__next.another.__PAGE__.txt',\n+  'another/__next.another.txt',\n+  'another/first.html',\n+  'another/first.txt',\n+  'another/first/__next._index.txt',\n+  'another/first/__next._tree.txt',\n+  'another/first/__next.another.$d$slug.__PAGE__.txt',\n+  'another/first/__next.another.$d$slug.txt',\n+  'another/first/__next.another.txt',\n+  'another/second.html',\n+  'another/second.txt',\n+  'another/second/__next._index.txt',\n+  'another/second/__next._tree.txt',\n+  'another/second/__next.another.$d$slug.__PAGE__.txt',\n+  'another/second/__next.another.$d$slug.txt',\n+  'another/second/__next.another.txt',\n+  'api/json',\n+  'api/txt',\n+  'client.html',\n+  'client.txt',\n+  'client/__next._index.txt',\n+  'client/__next._tree.txt',\n+  'client/__next.client.__PAGE__.txt',\n+  'client/__next.client.txt',\n+  'favicon.ico',\n+  'image-import.html',\n+  'image-import.txt',\n+  'image-import/__next._index.txt',\n+  'image-import/__next._tree.txt',\n+  'image-import/__next.image-import.__PAGE__.txt',\n+  'image-import/__next.image-import.txt',\n+  'index.html',\n+  'index.txt',\n+  'robots.txt',\n+]\n \n export async function getFiles(cwd = exportDir) {\n   const opts = { cwd, nodir: true }"
        },
        {
            "sha": "a675b495a9affce2fdb348ac160431963d291f2c",
            "filename": "test/lib/next-modes/base.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Flib%2Fnext-modes%2Fbase.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Flib%2Fnext-modes%2Fbase.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-modes%2Fbase.ts?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -409,9 +409,6 @@ export class NextInstance {\n           if (process.env.NEXT_PRIVATE_EXPERIMENTAL_CACHE_COMPONENTS) {\n             process.env.__NEXT_EXPERIMENTAL_CACHE_COMPONENTS = process.env.NEXT_PRIVATE_EXPERIMENTAL_CACHE_COMPONENTS\n           }\n-          if (process.env.NEXT_PRIVATE_EXPERIMENTAL_CLIENT_SEGMENT_CACHE) {\n-            process.env.__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE = process.env.NEXT_PRIVATE_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\n-          }\n         `\n           )\n "
        },
        {
            "sha": "374bf46cbdcf7cffaf99b6089100d88976c486b6",
            "filename": "test/lib/next-modes/next-deploy.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 6,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Flib%2Fnext-modes%2Fnext-deploy.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Flib%2Fnext-modes%2Fnext-deploy.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-modes%2Fnext-deploy.ts?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -111,12 +111,6 @@ export class NextDeployInstance extends NextInstance {\n       )\n     }\n \n-    if (process.env.__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE) {\n-      additionalEnv.push(\n-        `NEXT_PRIVATE_EXPERIMENTAL_CLIENT_SEGMENT_CACHE=${process.env.__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE}`\n-      )\n-    }\n-\n     if (process.env.IS_TURBOPACK_TEST) {\n       additionalEnv.push(`IS_TURBOPACK_TEST=1`)\n     }"
        },
        {
            "sha": "b044721605e9291421f1fe83de885201309a1db3",
            "filename": "test/production/app-dir/build-output-prerender/build-output-prerender.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 109,
            "changes": 109,
            "blob_url": "https://github.com/vercel/next.js/blob/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ab99f9a29b81a0bfda4f2779e0557b6726aae6db/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbuild-output-prerender%2Fbuild-output-prerender.test.ts?ref=ab99f9a29b81a0bfda4f2779e0557b6726aae6db",
            "patch": "@@ -7,9 +7,6 @@ const cacheComponentsEnabled =\n \n const pprEnabled = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n \n-const clientSegmentCacheEnabled =\n-  process.env.__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE === 'true'\n-\n const isRspack = !!process.env.NEXT_RSPACK\n \n describe('build-output-prerender', () => {\n@@ -30,7 +27,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n@@ -42,7 +38,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n@@ -56,7 +51,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n@@ -67,34 +61,11 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n             `)\n           }\n-        } else if (clientSegmentCacheEnabled) {\n-          if (isTurbopack) {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Next.js x.y.z (Turbopack)\n-                - Experiments (use with caution):\n-                   cacheComponents\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n-                   enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n-                   ppr (enabled by \\`experimental.cacheComponents\\`)\n-                   rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n-            `)\n-          } else {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Next.js x.y.z (webpack)\n-                - Experiments (use with caution):\n-                   cacheComponents\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n-                   enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n-                   ppr (enabled by \\`experimental.cacheComponents\\`)\n-                   rdcForNavigations (enabled by \\`experimental.ppr\\`)\"\n-            `)\n-          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -177,7 +148,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -193,7 +163,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -211,7 +180,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -226,7 +194,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -235,36 +202,6 @@ describe('build-output-prerender', () => {\n                    serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n             `)\n           }\n-        } else if (clientSegmentCacheEnabled) {\n-          if (isTurbopack) {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n-                 Next.js x.y.z (Turbopack)\n-                - Experiments (use with caution):\n-                   cacheComponents\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n-                   enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n-                   ppr (enabled by \\`experimental.cacheComponents\\`)\n-                   prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-                   rdcForNavigations (enabled by \\`experimental.ppr\\`)\n-                   serverSourceMaps (enabled by \\`--debug-prerender\\`)\n-                   turbopackMinify (disabled by \\`--debug-prerender\\`)\"\n-            `)\n-          } else {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n-                 Next.js x.y.z (webpack)\n-                - Experiments (use with caution):\n-                   cacheComponents\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n-                   enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n-                   ppr (enabled by \\`experimental.cacheComponents\\`)\n-                   prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-                   rdcForNavigations (enabled by \\`experimental.ppr\\`)\n-                   serverMinification (disabled by \\`--debug-prerender\\`)\n-                   serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n-            `)\n-          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n@@ -357,7 +294,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n@@ -369,7 +305,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`experimental.cacheComponents\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n@@ -382,7 +317,6 @@ describe('build-output-prerender', () => {\n              \" Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n             `)\n@@ -391,25 +325,10 @@ describe('build-output-prerender', () => {\n              \" Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    rdcForNavigations (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\"\n             `)\n           }\n-        } else if (clientSegmentCacheEnabled) {\n-          if (isTurbopack) {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Next.js x.y.z (Turbopack)\n-                - Experiments (use with caution):\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\"\n-            `)\n-          } else {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Next.js x.y.z (webpack)\n-                - Experiments (use with caution):\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\"\n-            `)\n-          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(\n@@ -446,7 +365,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -462,7 +380,6 @@ describe('build-output-prerender', () => {\n                 - Experiments (use with caution):\n                    cacheComponents (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_CACHE_COMPONENTS\\`)\n                    prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -479,7 +396,6 @@ describe('build-output-prerender', () => {\n                  Next.js x.y.z (Turbopack)\n                 - Experiments (use with caution):\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -493,7 +409,6 @@ describe('build-output-prerender', () => {\n                  Next.js x.y.z (webpack)\n                 - Experiments (use with caution):\n                    clientParamParsing (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n                    ppr (enabled by \\`__NEXT_EXPERIMENTAL_PPR\\`)\n                    prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n@@ -502,30 +417,6 @@ describe('build-output-prerender', () => {\n                    serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n             `)\n           }\n-        } else if (clientSegmentCacheEnabled) {\n-          if (isTurbopack) {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n-                 Next.js x.y.z (Turbopack)\n-                - Experiments (use with caution):\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n-                   enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n-                   prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-                   serverSourceMaps (enabled by \\`--debug-prerender\\`)\n-                   turbopackMinify (disabled by \\`--debug-prerender\\`)\"\n-            `)\n-          } else {\n-            expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`\n-             \" Prerendering is running in debug mode. Note: This may affect performance and should not be used for production.\n-                 Next.js x.y.z (webpack)\n-                - Experiments (use with caution):\n-                   clientSegmentCache (enabled by \\`__NEXT_EXPERIMENTAL_CLIENT_SEGMENT_CACHE\\`)\n-                   enablePrerenderSourceMaps (enabled by \\`--debug-prerender\\`)\n-                   prerenderEarlyExit (disabled by \\`--debug-prerender\\`)\n-                   serverMinification (disabled by \\`--debug-prerender\\`)\n-                   serverSourceMaps (enabled by \\`--debug-prerender\\`)\"\n-            `)\n-          }\n         } else {\n           if (isTurbopack) {\n             expect(getPreambleOutput(next.cliOutput)).toMatchInlineSnapshot(`"
        }
    ],
    "stats": {
        "total": 970,
        "additions": 128,
        "deletions": 842
    }
}