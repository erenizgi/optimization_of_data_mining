{
    "author": "devjiwonchoi",
    "message": "Clean up unused code in restart server button (#82409)",
    "sha": "b8b653bb07a978f3e36f0d810b2715e34340daaa",
    "files": [
        {
            "sha": "e5867c8c58be4761713545c1e96f6dd5a880937c",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/error-overlay-toolbar/restart-server-button.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 125,
            "changes": 125,
            "blob_url": "https://github.com/vercel/next.js/blob/1779eb05df8dfc5d875b350fb6bcfb3f9edba6c7/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Ferror-overlay-toolbar%2Frestart-server-button.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1779eb05df8dfc5d875b350fb6bcfb3f9edba6c7/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Ferror-overlay-toolbar%2Frestart-server-button.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Ferror-overlay-toolbar%2Frestart-server-button.tsx?ref=1779eb05df8dfc5d875b350fb6bcfb3f9edba6c7",
            "patch": "@@ -1,125 +0,0 @@\n-import { useEffect } from 'react'\n-import { RefreshClockWise } from '../../../icons/refresh-clock-wise'\n-import {\n-  ACTION_RESTART_SERVER_BUTTON,\n-  type OverlayDispatch,\n-} from '../../../shared'\n-import type { SupportedErrorEvent } from '../../../container/runtime-error/render-error'\n-import { useRestartServer } from './use-restart-server'\n-import { css } from '../../../utils/css'\n-\n-/**\n- * When the Turbopack persistent cache is enabled, and the user reloads on a\n- * specific error and that error persists, we show the restart server button as\n- * an option. This is because some errors are recoverable by clearing the\n- * bundler cache, but we want to provide a shortcut to do this and collect\n- * telemetry on how often this is used.\n- */\n-export function RestartServerButton({ showButton }: { showButton: boolean }) {\n-  const { restartServer, isPending } = useRestartServer()\n-\n-  if (!showButton) {\n-    return null\n-  }\n-\n-  return (\n-    <button\n-      className=\"restart-dev-server-button\"\n-      onClick={() => restartServer({ invalidatePersistentCache: true })}\n-      disabled={isPending}\n-      title=\"Clears the bundler cache and restarts the dev server. Helpful if you are seeing stale errors or changes are not appearing.\"\n-    >\n-      <RefreshClockWise\n-        width={14}\n-        height={14}\n-        style={{\n-          animation: isPending\n-            ? 'refresh-clock-wise-spin 1s linear infinite'\n-            : undefined,\n-        }}\n-      />\n-      Reset Bundler Cache\n-    </button>\n-  )\n-}\n-\n-/**\n- * Sets up a beforeunload listener to show the restart server button\n- * if the developer reloads on a specific error and that error persists with Turbopack + Persistent Cache.\n- */\n-export function usePersistentCacheErrorDetection({\n-  errors,\n-  dispatch,\n-}: {\n-  errors: readonly SupportedErrorEvent[]\n-  dispatch: OverlayDispatch\n-}) {\n-  useEffect(() => {\n-    const isTurbopackWithCache =\n-      process.env.__NEXT_BUNDLER?.toUpperCase() === 'TURBOPACK' &&\n-      process.env.__NEXT_BUNDLER_HAS_PERSISTENT_CACHE\n-    // TODO: Is there a better heuristic here?\n-    const firstError = errors[0]?.error\n-\n-    if (isTurbopackWithCache && firstError) {\n-      const errorKey = `__next_error_overlay:${window.location.pathname}:${firstError.message}`\n-      const showRestartServerButton = sessionStorage.getItem(errorKey) === '1'\n-\n-      dispatch({\n-        type: ACTION_RESTART_SERVER_BUTTON,\n-        showRestartServerButton,\n-      })\n-\n-      const handleBeforeUnload = () => {\n-        sessionStorage.setItem(errorKey, '1')\n-      }\n-\n-      window.addEventListener('beforeunload', handleBeforeUnload)\n-      return () => {\n-        window.removeEventListener('beforeunload', handleBeforeUnload)\n-      }\n-    } else {\n-      dispatch({\n-        type: ACTION_RESTART_SERVER_BUTTON,\n-        showRestartServerButton: false,\n-      })\n-    }\n-  }, [errors, dispatch])\n-}\n-\n-export const RESTART_SERVER_BUTTON_STYLES = css`\n-  .restart-dev-server-button {\n-    display: flex;\n-    justify-content: center;\n-    align-items: center;\n-    gap: 4px;\n-    margin: 0 12px;\n-\n-    height: var(--size-26);\n-    padding: 6px 8px 6px 6px;\n-    background: var(--color-amber-100);\n-    background-clip: padding-box;\n-    border: 1px solid var(--color-gray-alpha-400);\n-    box-shadow: var(--shadow-small);\n-    border-radius: var(--rounded-full);\n-\n-    color: var(--color-amber-900);\n-    font-size: var(--size-12);\n-    font-weight: 500;\n-    line-height: var(--size-16);\n-  }\n-\n-  .restart-dev-server-button:disabled {\n-    opacity: 0.6;\n-    cursor: not-allowed;\n-  }\n-\n-  @keyframes refresh-clock-wise-spin {\n-    from {\n-      transform: rotate(0deg);\n-    }\n-    to {\n-      transform: rotate(360deg);\n-    }\n-  }\n-`"
        },
        {
            "sha": "80a88b45762c63b06ba7c83df018bc38e475a7c9",
            "filename": "packages/next/src/next-devtools/dev-overlay/container/runtime-error/render-error.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcontainer%2Fruntime-error%2Frender-error.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcontainer%2Fruntime-error%2Frender-error.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcontainer%2Fruntime-error%2Frender-error.tsx?ref=b8b653bb07a978f3e36f0d810b2715e34340daaa",
            "patch": "@@ -1,12 +1,11 @@\n-import type { OverlayDispatch, OverlayState } from '../../shared'\n+import type { OverlayState } from '../../shared'\n import type { StackFrame } from '../../../shared/stack-frame'\n \n import { useMemo, useState, useEffect } from 'react'\n import {\n   getErrorByType,\n   type ReadyRuntimeError,\n } from '../../utils/get-error-by-type'\n-import { usePersistentCacheErrorDetection } from '../../components/errors/error-overlay-toolbar/restart-server-button'\n \n export type SupportedErrorEvent = {\n   id: number\n@@ -22,7 +21,6 @@ type Props = {\n   }) => React.ReactNode\n   state: OverlayState\n   isAppDir: boolean\n-  dispatch: OverlayDispatch\n }\n \n export const RenderError = (props: Props) => {\n@@ -36,7 +34,7 @@ export const RenderError = (props: Props) => {\n   }\n }\n \n-const RenderRuntimeError = ({ children, state, isAppDir, dispatch }: Props) => {\n+const RenderRuntimeError = ({ children, state, isAppDir }: Props) => {\n   const { errors } = state\n \n   const [lookups, setLookups] = useState<{\n@@ -65,8 +63,6 @@ const RenderRuntimeError = ({ children, state, isAppDir, dispatch }: Props) => {\n     return [ready, next]\n   }, [errors, lookups])\n \n-  usePersistentCacheErrorDetection({ errors, dispatch })\n-\n   useEffect(() => {\n     if (nextError == null) {\n       return"
        },
        {
            "sha": "a589b702e0b03997aff472791abbc95cc7263b63",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx?ref=b8b653bb07a978f3e36f0d810b2715e34340daaa",
            "patch": "@@ -33,7 +33,7 @@ export function DevOverlay() {\n       <ComponentStyles />\n       <DarkTheme />\n \n-      <RenderError state={state} dispatch={dispatch} isAppDir={true}>\n+      <RenderError state={state} isAppDir={true}>\n         {({ runtimeErrors, totalErrorCount }) => {\n           return (\n             <>"
        },
        {
            "sha": "f9526dec8c983a1204105a396a877b7a9ba273ce",
            "filename": "packages/next/src/next-devtools/dev-overlay/icons/refresh-clock-wise.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 10,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1779eb05df8dfc5d875b350fb6bcfb3f9edba6c7/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Ficons%2Frefresh-clock-wise.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1779eb05df8dfc5d875b350fb6bcfb3f9edba6c7/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Ficons%2Frefresh-clock-wise.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Ficons%2Frefresh-clock-wise.tsx?ref=1779eb05df8dfc5d875b350fb6bcfb3f9edba6c7",
            "patch": "@@ -1,10 +0,0 @@\n-export function RefreshClockWise(props: React.SVGProps<SVGSVGElement>) {\n-  return (\n-    <svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"currentColor\" {...props}>\n-      <path\n-        d=\"M4.30969 8.37891H2.38782C2.9805 10.3647 4.82188 11.8124 7.00012 11.8125C8.81977 11.8124 10.4043 10.8024 11.2228 9.30957L11.5382 8.73438L12.6896 9.36523L12.3741 9.94043L12.1681 10.2891C11.0815 11.993 9.17324 13.1249 7.00012 13.125C4.42207 13.1249 2.21747 11.5322 1.3136 9.27734V11.375H0.00109863V7.72266L0.0147705 7.58984C0.0760304 7.29089 0.340278 7.06641 0.657349 7.06641H4.30969V8.37891ZM7.00012 0.875C9.57685 0.875118 11.7819 2.46569 12.6866 4.71875V2.625H13.9991V6.27734C13.9991 6.63974 13.7053 6.93354 13.3429 6.93359H9.68958V5.62109H11.6115C11.0186 3.6356 9.17813 2.18763 7.00012 2.1875C5.17131 2.18757 3.57959 3.20771 2.76477 4.71289L2.45227 5.29004L1.29797 4.66504L1.61047 4.08789C2.64547 2.17605 4.67052 0.875068 7.00012 0.875Z\"\n-        fill=\"#A35200\"\n-      />\n-    </svg>\n-  )\n-}"
        },
        {
            "sha": "758cddb119578d1f307968d750c5d0516fd6476d",
            "filename": "packages/next/src/next-devtools/dev-overlay/shared.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts?ref=b8b653bb07a978f3e36f0d810b2715e34340daaa",
            "patch": "@@ -52,10 +52,6 @@ export interface OverlayState {\n   readonly staticIndicator: boolean\n   readonly showIndicator: boolean\n   readonly disableDevIndicator: boolean\n-  /** Whether to show the restart server button in the panel UI. Currently\n-   *  only used when Turbopack + Persistent Cache is enabled.\n-   */\n-  readonly showRestartServerButton: boolean\n   readonly debugInfo: DebugInfo\n   readonly routerType: 'pages' | 'app'\n   /** This flag is used to handle the Error Overlay state in the \"old\" overlay.\n@@ -105,7 +101,6 @@ export const ACTION_DEVTOOLS_POSITION = 'devtools-position'\n export const ACTION_DEVTOOLS_PANEL_POSITION = 'devtools-panel-position'\n export const ACTION_DEVTOOLS_PANEL_SIZE = 'devtools-panel-size'\n export const ACTION_DEVTOOLS_SCALE = 'devtools-scale'\n-export const ACTION_RESTART_SERVER_BUTTON = 'restart-server-button'\n \n export const ACTION_DEVTOOLS_CONFIG = 'devtools-config'\n \n@@ -216,11 +211,6 @@ export interface DevToolUpdateRouteStateAction {\n   page: string\n }\n \n-export interface RestartServerButtonAction {\n-  type: typeof ACTION_RESTART_SERVER_BUTTON\n-  showRestartServerButton: boolean\n-}\n-\n export interface DevToolsConfigAction {\n   type: typeof ACTION_DEVTOOLS_CONFIG\n   devToolsConfig: DevToolsConfig\n@@ -248,7 +238,6 @@ export type DispatcherEvent =\n   | DevToolsPanelPositionAction\n   | DevToolsScaleAction\n   | DevToolUpdateRouteStateAction\n-  | RestartServerButtonAction\n   | DevIndicatorSetAction\n   | DevToolsConfigAction\n \n@@ -291,7 +280,6 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   refreshState: { type: 'idle' },\n   versionInfo: { installed: '0.0.0', staleness: 'unknown' },\n   debugInfo: { devtoolsFrontendUrl: undefined },\n-  showRestartServerButton: false,\n   devToolsPosition: 'bottom-left',\n   devToolsPanelPosition: {\n     [STORE_KEY_SHARED_PANEL_LOCATION]: 'bottom-left',\n@@ -479,12 +467,6 @@ export function useErrorOverlayReducer(\n         case ACTION_DEVTOOL_UPDATE_ROUTE_STATE: {\n           return { ...state, page: action.page }\n         }\n-        case ACTION_RESTART_SERVER_BUTTON: {\n-          return {\n-            ...state,\n-            showRestartServerButton: action.showRestartServerButton,\n-          }\n-        }\n         case ACTION_DEVTOOLS_CONFIG: {\n           const {\n             theme,"
        },
        {
            "sha": "12dcd931f0823daac8f425db503d87b890616e17",
            "filename": "packages/next/src/next-devtools/dev-overlay/storybook/use-overlay-reducer.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts?ref=b8b653bb07a978f3e36f0d810b2715e34340daaa",
            "patch": "@@ -21,7 +21,6 @@ import {\n   ACTION_REFRESH,\n   ACTION_RENDERING_INDICATOR_HIDE,\n   ACTION_RENDERING_INDICATOR_SHOW,\n-  ACTION_RESTART_SERVER_BUTTON,\n   ACTION_STATIC_INDICATOR,\n   ACTION_UNHANDLED_ERROR,\n   ACTION_UNHANDLED_REJECTION,\n@@ -82,7 +81,6 @@ export function useStorybookOverlayReducer(initialState?: OverlayState) {\n         case ACTION_REFRESH:\n         case ACTION_RENDERING_INDICATOR_HIDE:\n         case ACTION_RENDERING_INDICATOR_SHOW:\n-        case ACTION_RESTART_SERVER_BUTTON:\n         case ACTION_STATIC_INDICATOR:\n         case ACTION_UNHANDLED_ERROR:\n         case ACTION_UNHANDLED_REJECTION:"
        },
        {
            "sha": "5a5e65b7b956e14a66f496a201181a777fcaf090",
            "filename": "packages/next/src/next-devtools/dev-overlay/styles/component-styles.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b8b653bb07a978f3e36f0d810b2715e34340daaa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx?ref=b8b653bb07a978f3e36f0d810b2715e34340daaa",
            "patch": "@@ -20,7 +20,6 @@ import { DEV_TOOLS_INFO_TURBOPACK_INFO_STYLES } from '../components/errors/dev-t\n import { DEV_TOOLS_INFO_ROUTE_INFO_STYLES } from '../components/errors/dev-tools-indicator/dev-tools-info/route-info'\n import { DEV_TOOLS_INFO_USER_PREFERENCES_STYLES } from '../components/errors/dev-tools-indicator/dev-tools-info/user-preferences'\n import { FADER_STYLES } from '../components/fader'\n-import { RESTART_SERVER_BUTTON_STYLES } from '../components/errors/error-overlay-toolbar/restart-server-button'\n import { CALL_STACK_STYLES } from '../components/call-stack/call-stack'\n import { ISSUE_FEEDBACK_BUTTON_STYLES } from '../components/errors/error-overlay-toolbar/issue-feedback-button'\n import { ERROR_CONTENT_SKELETON_STYLES } from '../container/runtime-error/error-content-skeleton'\n@@ -47,7 +46,6 @@ export function ComponentStyles() {\n         ${containerErrorStyles}\n         ${containerRuntimeErrorStyles}\n         ${versionStaleness}\n-        ${RESTART_SERVER_BUTTON_STYLES}\n         ${DEV_TOOLS_INFO_STYLES}\n         ${DEV_TOOLS_INFO_TURBOPACK_INFO_STYLES}\n         ${DEV_TOOLS_INFO_ROUTE_INFO_STYLES}"
        }
    ],
    "stats": {
        "total": 167,
        "additions": 3,
        "deletions": 164
    }
}