{
    "author": "eps1lon",
    "message": "[dev-overlay] Fix outstanding a11y issues reported by Axe (#80290)\n\nAdds labels to buttons that had no discernible text.\r\n\r\nThe automated tests via `test-storybook` seem to ignore `parameters.a11y.config.rules` so we can't leverage `test-storybook` in CI.\r\nI can't even use `parameters.a11y.test`.\r\n\r\nWe need `parameters.a11y.config.rules` since some of the color-contrast violations are either minor (just slightly below threshold) or false-positives either because our background is misconfigured in automated tests, or background is not detected properly.",
    "sha": "cf0ad333c3799dd0ab6e121d8893b6928bada51e",
    "files": [
        {
            "sha": "72ca7ccec931b81e703134a3940dc40c82e95aba",
            "filename": "packages/next/.storybook/preview.tsx",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2F.storybook%2Fpreview.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2F.storybook%2Fpreview.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2F.storybook%2Fpreview.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -18,6 +18,26 @@ const preview: Preview = {\n   parameters: {\n     a11y: {\n       element: 'nextjs-portal',\n+      config: {\n+        standards: {\n+          ariaAttrs: {\n+            'aria-modal': {\n+              global: true,\n+            },\n+          },\n+        },\n+        rules: [\n+          {\n+            // It's incredibly hard to find a code highlighting theme that works\n+            // for both light and dark themes and passes WCAG color contrast.\n+            // These kind of tests should really only fail when you regress\n+            // on a value below threshold.\n+            id: 'color-contrast',\n+            selector: '.code-frame-lines',\n+            enabled: false,\n+          },\n+        ],\n+      },\n     },\n     controls: {\n       matchers: {"
        },
        {
            "sha": "ba0be9a71eb8415de379464d012a9becc22c268d",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/call-stack-frame/call-stack-frame.stories.tsx",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fcall-stack-frame%2Fcall-stack-frame.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fcall-stack-frame%2Fcall-stack-frame.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fcall-stack-frame%2Fcall-stack-frame.stories.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -9,6 +9,18 @@ const meta: Meta<typeof CallStackFrame> = {\n     backgrounds: {\n       default: 'background-100-dark',\n     },\n+    a11y: {\n+      config: {\n+        rules: [\n+          {\n+            id: 'color-contrast',\n+            // Manual testing shows no violation.\n+            // TODO: We might have setup more explicit backgrounds depending on theme.\n+            enabled: false,\n+          },\n+        ],\n+      },\n+    },\n   },\n   decorators: [withShadowPortal],\n }"
        },
        {
            "sha": "d8ee0b8d17eb2e33ff0adeeeda31d9aa448b0b91",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/call-stack-frame/call-stack-frame.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fcall-stack-frame%2Fcall-stack-frame.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fcall-stack-frame%2Fcall-stack-frame.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fcall-stack-frame%2Fcall-stack-frame.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -23,10 +23,6 @@ export const CallStackFrame: React.FC<{\n       : undefined\n   )\n \n-  // Format method to strip out the webpack layer prefix.\n-  // e.g. (app-pages-browser)/./app/page.tsx -> ./app/page.tsx\n-  const formattedMethod = f.methodName.replace(/^\\([\\w-]+\\)\\//, '')\n-\n   // Formatted file source could be empty. e.g. <anonymous> will be formatted to empty string,\n   // we'll skip rendering the frame in this case.\n   const fileSource = getFrameSource(f)\n@@ -42,9 +38,13 @@ export const CallStackFrame: React.FC<{\n       data-nextjs-call-stack-frame-ignored={frame.ignored}\n     >\n       <div className=\"call-stack-frame-method-name\">\n-        <HotlinkedText text={formattedMethod} />\n+        <HotlinkedText text={f.methodName} />\n         {hasSource && (\n-          <button onClick={open} className=\"open-in-editor-button\">\n+          <button\n+            onClick={open}\n+            className=\"open-in-editor-button\"\n+            aria-label={`Open ${f.methodName} in editor`}\n+          >\n             <ExternalIcon width={16} height={16} />\n           </button>\n         )}"
        },
        {
            "sha": "39b98b507c84568fad5c9de00e88ae558f5491e5",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/call-stack/call-stack.stories.tsx",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fcall-stack%2Fcall-stack.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fcall-stack%2Fcall-stack.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fcall-stack%2Fcall-stack.stories.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -9,6 +9,18 @@ const meta: Meta<typeof CallStack> = {\n     backgrounds: {\n       default: 'background-100-dark',\n     },\n+    a11y: {\n+      config: {\n+        rules: [\n+          {\n+            id: 'color-contrast',\n+            // Manual testing shows no violation.\n+            // TODO: We might have setup more explicit backgrounds depending on theme.\n+            enabled: false,\n+          },\n+        ],\n+      },\n+    },\n   },\n   decorators: [withShadowPortal],\n }"
        },
        {
            "sha": "276505b3d631b9fcf8156d5673f86e819345e5d5",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/dev-tools-indicator/next-logo.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fnext-logo.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fnext-logo.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fnext-logo.stories.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -8,6 +8,7 @@ const meta: Meta<typeof NextLogo> = {\n     layout: 'centered',\n   },\n   args: {\n+    'aria-label': 'Open Next.js DevTools',\n     onClick: () => console.log('Clicked!'),\n   },\n   decorators: [withShadowPortal],"
        },
        {
            "sha": "6e12268226363bccbad0bb659f3db5dbb40cc0b9",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-message/error-message.stories.tsx",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-message%2Ferror-message.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-message%2Ferror-message.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-message%2Ferror-message.stories.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -6,6 +6,21 @@ const meta: Meta<typeof ErrorMessage> = {\n   component: ErrorMessage,\n   parameters: {\n     layout: 'fullscreen',\n+    backgrounds: {\n+      default: 'background-100-light',\n+    },\n+    a11y: {\n+      config: {\n+        rules: [\n+          {\n+            id: 'color-contrast',\n+            // Manual testing shows no violation.\n+            // TODO: We might have setup more explicit backgrounds depending on theme.\n+            enabled: false,\n+          },\n+        ],\n+      },\n+    },\n   },\n   decorators: [withShadowPortal],\n }"
        },
        {
            "sha": "ad9b78c5f5bfd2a44641f6ac5b896681a8f4704a",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/hydration-diff/diff-view.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fhydration-diff%2Fdiff-view.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fhydration-diff%2Fdiff-view.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fhydration-diff%2Fdiff-view.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -50,10 +50,9 @@ import { CollapseIcon } from '../../icons/collapse-icon'\n  */\n export function PseudoHtmlDiff({\n   reactOutputComponentDiff,\n-  ...props\n }: {\n   reactOutputComponentDiff: string\n-} & React.HTMLAttributes<HTMLPreElement>) {\n+}) {\n   const [isDiffCollapsed, toggleCollapseHtml] = useState(true)\n \n   const htmlComponents = useMemo(() => {\n@@ -120,12 +119,14 @@ export function PseudoHtmlDiff({\n       data-nextjs-container-errors-pseudo-html-collapse={isDiffCollapsed}\n     >\n       <button\n+        aria-expanded={!isDiffCollapsed}\n+        aria-label=\"complete Component Stack\"\n         data-nextjs-container-errors-pseudo-html-collapse-button\n         onClick={() => toggleCollapseHtml(!isDiffCollapsed)}\n       >\n         <CollapseIcon collapsed={isDiffCollapsed} />\n       </button>\n-      <pre {...props}>\n+      <pre className=\"nextjs__container_errors__component-stack\">\n         <code>{htmlComponents}</code>\n       </pre>\n     </div>"
        },
        {
            "sha": "c2a4f5f60b042717f48aef14f1696dc906797310",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/terminal/terminal.stories.tsx",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fterminal%2Fterminal.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fterminal%2Fterminal.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fterminal%2Fterminal.stories.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -6,6 +6,18 @@ const meta: Meta<typeof Terminal> = {\n   component: Terminal,\n   parameters: {\n     layout: 'fullscreen',\n+    a11y: {\n+      config: {\n+        rules: [\n+          {\n+            id: 'color-contrast',\n+            // Manual testing shows no violation.\n+            // TODO: We might have setup more explicit backgrounds depending on theme.\n+            enabled: false,\n+          },\n+        ],\n+      },\n+    },\n   },\n   decorators: [withShadowPortal],\n }"
        },
        {
            "sha": "219ffa95883d651da2a6455bbb144ed70b7fcb36",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/container/errors.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -202,7 +202,6 @@ export function Errors({\n \n       {errorDetails.reactOutputComponentDiff ? (\n         <PseudoHtmlDiff\n-          className=\"nextjs__container_errors__component-stack\"\n           reactOutputComponentDiff={errorDetails.reactOutputComponentDiff || ''}\n         />\n       ) : null}"
        },
        {
            "sha": "a99e422fe9c23629dbedb69ee312af360137d601",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cf0ad333c3799dd0ab6e121d8893b6928bada51e/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx?ref=cf0ad333c3799dd0ab6e121d8893b6928bada51e",
            "patch": "@@ -16,6 +16,18 @@ const meta: Meta<typeof DevOverlay> = {\n   component: DevOverlay,\n   parameters: {\n     layout: 'fullscreen',\n+    a11y: {\n+      config: {\n+        rules: [\n+          {\n+            id: 'color-contrast',\n+            // Manual testing shows no violation.\n+            // TODO: We might have setup more explicit backgrounds depending on theme.\n+            enabled: false,\n+          },\n+        ],\n+      },\n+    },\n   },\n }\n "
        }
    ],
    "stats": {
        "total": 104,
        "additions": 94,
        "deletions": 10
    }
}