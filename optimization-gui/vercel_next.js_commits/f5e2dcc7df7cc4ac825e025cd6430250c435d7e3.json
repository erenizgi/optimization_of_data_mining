{
    "author": "wbinnssmith",
    "message": "Update use-cache-unknown-cache-kind.test.ts snapshot for alternate bundler (#76682)\n\nThis adds a snapshot for rspack to this test. It also mentions rspack\ninstead of webpack when failing with build errors.\n\nTest Plan: `pnpm test-start-rspack\ntest/e2e/app-dir/use-cache-unknown-cache-kind/use-cache-unknown-cache-kind.test.ts`",
    "sha": "f5e2dcc7df7cc4ac825e025cd6430250c435d7e3",
    "files": [
        {
            "sha": "5f170ead76c401a6525bcb00f5cef23fd034154d",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e2dcc7df7cc4ac825e025cd6430250c435d7e3/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e2dcc7df7cc4ac825e025cd6430250c435d7e3/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=f5e2dcc7df7cc4ac825e025cd6430250c435d7e3",
            "patch": "@@ -658,5 +658,6 @@\n   \"657\": \"revalidate must be a number for image-cache\",\n   \"658\": \"Pass `Infinity` instead of `false` if you want to cache on the server forever without checking with the origin.\",\n   \"659\": \"SSG should not return an image cache value\",\n-  \"660\": \"Rspack support is only available in Next.js canary.\"\n+  \"660\": \"Rspack support is only available in Next.js canary.\",\n+  \"661\": \"Build failed because of %s errors\"\n }"
        },
        {
            "sha": "5b5fa9c10621a05cd27c2489ba1e21302510d028",
            "filename": "packages/next/src/build/webpack-build/impl.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e2dcc7df7cc4ac825e025cd6430250c435d7e3/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-build%2Fimpl.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e2dcc7df7cc4ac825e025cd6430250c435d7e3/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-build%2Fimpl.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-build%2Fimpl.ts?ref=f5e2dcc7df7cc4ac825e025cd6430250c435d7e3",
            "patch": "@@ -333,7 +333,9 @@ export async function webpackBuildImpl(\n       err.code = 'INVALID_RESOLVE_ALIAS'\n       throw err\n     }\n-    const err = new Error('Build failed because of webpack errors') as NextError\n+    const err = new Error(\n+      `Build failed because of ${process.env.NEXT_RSPACK ? 'rspack' : 'webpack'} errors`\n+    ) as NextError\n     err.code = 'WEBPACK_ERRORS'\n     throw err\n   } else {"
        },
        {
            "sha": "1ed82874773cc19e05a79925ab93c1c845c00142",
            "filename": "test/e2e/app-dir/use-cache-unknown-cache-kind/use-cache-unknown-cache-kind.test.ts",
            "status": "modified",
            "additions": 73,
            "deletions": 29,
            "changes": 102,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e2dcc7df7cc4ac825e025cd6430250c435d7e3/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e2dcc7df7cc4ac825e025cd6430250c435d7e3/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-unknown-cache-kind%2Fuse-cache-unknown-cache-kind.test.ts?ref=f5e2dcc7df7cc4ac825e025cd6430250c435d7e3",
            "patch": "@@ -10,6 +10,8 @@ import {\n import stripAnsi from 'strip-ansi'\n import { createSandbox } from 'development-sandbox'\n \n+const isRspack = process.env.NEXT_RSPACK\n+\n const nextConfigWithCacheHandler: NextConfig = {\n   experimental: {\n     dynamicIO: true,\n@@ -57,26 +59,49 @@ describe('use-cache-unknown-cache-kind', () => {\n               at <unknown> (./app/page.tsx:1:1)\n           \"\n         `)\n+      } else if (isRspack) {\n+        expect(buildOutput).toMatchInlineSnapshot(`\n+         \"\n+         ./app/page.tsx\n+           × Module build failed:\n+           ╰─▶   × Error:   x Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\n+                 │   |\n+                 │    ,-[1:1]\n+                 │  1 | 'use cache: custom'\n+                 │    : ^^^^^^^^^^^^^^^^^^^\n+                 │  2 |\n+                 │  3 | export default async function Page() {\n+                 │  4 |   return <p>hello world</p>\n+                 │    \\`----\n+                 │\n+               \n+         Import trace for requested module:\n+         ./app/page.tsx\n+\n+\n+         > Build failed because of rspack errors\n+         \"\n+        `)\n       } else {\n         expect(buildOutput).toMatchInlineSnapshot(`\n-          \"\n-          ./app/page.tsx\n-          Error:   x Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\n-            | \n-             ,-[1:1]\n-           1 | 'use cache: custom'\n-             : ^^^^^^^^^^^^^^^^^^^\n-           2 | \n-           3 | export default async function Page() {\n-           4 |   return <p>hello world</p>\n-             \\`----\n-\n-          Import trace for requested module:\n-          ./app/page.tsx\n-\n-\n-          > Build failed because of webpack errors\n-          \"\n+         \"\n+         ./app/page.tsx\n+         Error:   x Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\n+           | \n+            ,-[1:1]\n+          1 | 'use cache: custom'\n+            : ^^^^^^^^^^^^^^^^^^^\n+          2 | \n+          3 | export default async function Page() {\n+          4 |   return <p>hello world</p>\n+            \\`----\n+\n+         Import trace for requested module:\n+         ./app/page.tsx\n+\n+\n+         > Build failed because of webpack errors\n+         \"\n         `)\n       }\n     })\n@@ -104,6 +129,10 @@ describe('use-cache-unknown-cache-kind', () => {\n         expect(errorDescription).toMatchInlineSnapshot(\n           `\"Ecmascript file had an error\"`\n         )\n+      } else if (isRspack) {\n+        expect(errorDescription).toMatchInlineSnapshot(\n+          `\"  × Module build failed:\"`\n+        )\n       } else {\n         expect(errorDescription).toMatchInlineSnapshot(\n           `\"Error:   x Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\"`\n@@ -122,19 +151,34 @@ describe('use-cache-unknown-cache-kind', () => {\n \n            Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\"\n           `)\n+      } else if (isRspack) {\n+        expect(errorSource).toMatchInlineSnapshot(`\n+         \"./app/page.tsx\n+           × Module build failed:\n+           ╰─▶   × Error:   x Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\n+                 │   |\n+                 │    ,-[1:1]\n+                 │  1 | 'use cache: custom'\n+                 │    : ^^^^^^^^^^^^^^^^^^^\n+                 │  2 |\n+                 │  3 | export default async function Page() {\n+                 │  4 |   return <p>hello world</p>\n+                 │    \\`----\n+                 │\"\n+        `)\n       } else {\n         expect(errorSource).toMatchInlineSnapshot(`\n-           \"./app/page.tsx\n-           Error:   x Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\n-             | \n-              ,-[1:1]\n-            1 | 'use cache: custom'\n-              : ^^^^^^^^^^^^^^^^^^^\n-            2 | \n-            3 | export default async function Page() {\n-            4 |   return <p>hello world</p>\n-              \\`----\"\n-          `)\n+         \"./app/page.tsx\n+         Error:   x Unknown cache kind \"custom\". Please configure a cache handler for this kind in the \"experimental.cacheHandlers\" object in your Next.js config.\n+           | \n+            ,-[1:1]\n+          1 | 'use cache: custom'\n+            : ^^^^^^^^^^^^^^^^^^^\n+          2 | \n+          3 | export default async function Page() {\n+          4 |   return <p>hello world</p>\n+            \\`----\"\n+        `)\n       }\n     })\n "
        },
        {
            "sha": "cccf98b3c99fb1cb83d6e508b47da5120bf6710e",
            "filename": "test/integration/css-customization/test/index.test.js",
            "status": "modified",
            "additions": 10,
            "deletions": 9,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/f5e2dcc7df7cc4ac825e025cd6430250c435d7e3/test%2Fintegration%2Fcss-customization%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/f5e2dcc7df7cc4ac825e025cd6430250c435d7e3/test%2Fintegration%2Fcss-customization%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss-customization%2Ftest%2Findex.test.js?ref=f5e2dcc7df7cc4ac825e025cd6430250c435d7e3",
            "patch": "@@ -6,6 +6,7 @@ import { nextBuild } from 'next-test-utils'\n import escapeStringRegexp from 'escape-string-regexp'\n \n const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n+const BUILD_FAILURE_RE = /Build failed because of (webpack|rspack) errors/\n \n // Test checks webpack loaders and plugins.\n ;(process.env.TURBOPACK ? describe.skip : describe)('CSS Customization', () => {\n@@ -266,7 +267,7 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n           expect(stderr).toMatch(\n             /A PostCSS Plugin was passed as an array but did not provide its configuration \\('postcss-trolling'\\)/\n           )\n-          expect(stderr).toMatch(/Build failed because of webpack errors/)\n+          expect(stderr).toMatch(BUILD_FAILURE_RE)\n         })\n       })\n \n@@ -286,7 +287,7 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n           expect(stderr).toMatch(\n             /To disable 'postcss-trolling', pass false, otherwise, pass true or a configuration object./\n           )\n-          expect(stderr).toMatch(/Build failed because of webpack errors/)\n+          expect(stderr).toMatch(BUILD_FAILURE_RE)\n         })\n       })\n \n@@ -303,7 +304,7 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n           expect(stderr).toMatch(\n             /A PostCSS Plugin must be provided as a string. Instead, we got: '5'/\n           )\n-          expect(stderr).toMatch(/Build failed because of webpack errors/)\n+          expect(stderr).toMatch(BUILD_FAILURE_RE)\n         })\n       })\n \n@@ -318,7 +319,7 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n           const { stderr } = await nextBuild(appDir, [], { stderr: true })\n \n           expect(stderr).toMatch(/An unknown PostCSS plugin was provided \\(5\\)/)\n-          expect(stderr).toMatch(/Build failed because of webpack errors/)\n+          expect(stderr).toMatch(BUILD_FAILURE_RE)\n         })\n       })\n \n@@ -335,7 +336,7 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n           expect(stderr).toMatch(\n             /Your custom PostCSS configuration must export a `plugins` key./\n           )\n-          expect(stderr).toMatch(/Build failed because of webpack errors/)\n+          expect(stderr).toMatch(BUILD_FAILURE_RE)\n         })\n       })\n \n@@ -352,7 +353,7 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n           expect(stderr).toMatch(\n             /Your custom PostCSS configuration must export a `plugins` key./\n           )\n-          expect(stderr).toMatch(/Build failed because of webpack errors/)\n+          expect(stderr).toMatch(BUILD_FAILURE_RE)\n         })\n       })\n \n@@ -369,7 +370,7 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n           expect(stderr).toMatch(\n             /A PostCSS Plugin was passed as an array but did not provide its configuration \\('postcss-trolling'\\)/\n           )\n-          expect(stderr).toMatch(/Build failed because of webpack errors/)\n+          expect(stderr).toMatch(BUILD_FAILURE_RE)\n         })\n       })\n \n@@ -386,7 +387,7 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n           expect(stderr).toMatch(\n             /A PostCSS Plugin was passed as a function using require\\(\\), but it must be provided as a string/\n           )\n-          expect(stderr).toMatch(/Build failed because of webpack errors/)\n+          expect(stderr).toMatch(BUILD_FAILURE_RE)\n         })\n       })\n \n@@ -403,7 +404,7 @@ const fixturesDir = join(__dirname, '../..', 'css-fixtures')\n           expect(stderr).toMatch(\n             /Your custom PostCSS configuration may not export a function/\n           )\n-          expect(stderr).toMatch(/Build failed because of webpack errors/)\n+          expect(stderr).toMatch(BUILD_FAILURE_RE)\n         })\n       })\n     }"
        }
    ],
    "stats": {
        "total": 128,
        "additions": 88,
        "deletions": 40
    }
}