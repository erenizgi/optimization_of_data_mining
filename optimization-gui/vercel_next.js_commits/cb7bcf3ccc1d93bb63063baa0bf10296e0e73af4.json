{
    "author": "gaojude",
    "message": "[dev-overlay] expandable error message container (#76297)\n\nWhen the error message exceeds 200px in height, we want to collapse the\npart above 200px, and show a button to expand it.\n\n[CleanShot 2025-02-20 at 16.46.16.mp4 <span\nclass=\"graphite__hidden\">(uploaded via Graphite)</span> <img\nclass=\"graphite__hidden\"\nsrc=\"https://app.graphite.dev/api/v1/graphite/video/thumbnail/rKSEEwxbNzdFs9t0yyxN/ad657511-2c09-4180-85db-be7325f45d2f.mp4\"\n/>](https://app.graphite.dev/media/video/rKSEEwxbNzdFs9t0yyxN/ad657511-2c09-4180-85db-be7325f45d2f.mp4)\n\nCloses NDX-743",
    "sha": "cb7bcf3ccc1d93bb63063baa0bf10296e0e73af4",
    "files": [
        {
            "sha": "c8a9a04da0c6307993b057f790ede4b7c598ce07",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/error-message/error-message.stories.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/cb7bcf3ccc1d93bb63063baa0bf10296e0e73af4/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-message%2Ferror-message.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cb7bcf3ccc1d93bb63063baa0bf10296e0e73af4/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-message%2Ferror-message.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-message%2Ferror-message.stories.tsx?ref=cb7bcf3ccc1d93bb63063baa0bf10296e0e73af4",
            "patch": "@@ -34,6 +34,15 @@ export const LongString: Story = {\n   },\n }\n \n+export const SuperLongString: Story = {\n+  args: {\n+    errorMessage:\n+      'Lorem ipsum dolor sit, amet consectetur adipisicing elit. Praesentium molestiae, perspiciatis earum labore repudiandae aliquid atque soluta ullam. Quidem provident non at. Reprehenderit similique harum recusandae id est dolore temporibus!\\n'.repeat(\n+        30\n+      ),\n+  },\n+}\n+\n export const ReactNode: Story = {\n   args: {\n     errorMessage: ("
        },
        {
            "sha": "105b951f10ac34e201b306a2190d02735e84c011",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/error-message/error-message.tsx",
            "status": "modified",
            "additions": 75,
            "deletions": 6,
            "changes": 81,
            "blob_url": "https://github.com/vercel/next.js/blob/cb7bcf3ccc1d93bb63063baa0bf10296e0e73af4/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-message%2Ferror-message.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cb7bcf3ccc1d93bb63063baa0bf10296e0e73af4/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-message%2Ferror-message.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-message%2Ferror-message.tsx?ref=cb7bcf3ccc1d93bb63063baa0bf10296e0e73af4",
            "patch": "@@ -1,3 +1,4 @@\n+import { useState, useRef, useLayoutEffect } from 'react'\n import { noop as css } from '../../../helpers/noop-template'\n \n export type ErrorMessageType = React.ReactNode\n@@ -7,17 +8,47 @@ type ErrorMessageProps = {\n }\n \n export function ErrorMessage({ errorMessage }: ErrorMessageProps) {\n+  const [isExpanded, setIsExpanded] = useState(false)\n+  const [shouldTruncate, setShouldTruncate] = useState(false)\n+  const messageRef = useRef<HTMLParagraphElement>(null)\n+\n+  useLayoutEffect(() => {\n+    if (messageRef.current) {\n+      setShouldTruncate(messageRef.current.scrollHeight > 200)\n+    }\n+  }, [errorMessage])\n+\n   return (\n-    <p\n-      id=\"nextjs__container_errors_desc\"\n-      className=\"nextjs__container_errors_desc\"\n-    >\n-      {errorMessage}\n-    </p>\n+    <div className=\"nextjs__container_errors_wrapper\">\n+      <p\n+        ref={messageRef}\n+        id=\"nextjs__container_errors_desc\"\n+        className={`nextjs__container_errors_desc ${shouldTruncate && !isExpanded ? 'truncated' : ''}`}\n+      >\n+        {errorMessage}\n+      </p>\n+      {shouldTruncate && !isExpanded && (\n+        <>\n+          <div className=\"nextjs__container_errors_gradient_overlay\" />\n+          <button\n+            onClick={() => setIsExpanded(true)}\n+            className=\"nextjs__container_errors_expand_button\"\n+            aria-expanded={isExpanded}\n+            aria-controls=\"nextjs__container_errors_desc\"\n+          >\n+            Show More\n+          </button>\n+        </>\n+      )}\n+    </div>\n   )\n }\n \n export const styles = css`\n+  .nextjs__container_errors_wrapper {\n+    position: relative;\n+  }\n+\n   .nextjs__container_errors_desc {\n     margin: 0;\n     margin-left: var(--size-1);\n@@ -29,4 +60,42 @@ export const styles = css`\n     overflow-wrap: break-word;\n     white-space: pre-wrap;\n   }\n+\n+  .nextjs__container_errors_desc.truncated {\n+    max-height: 200px;\n+    overflow: hidden;\n+  }\n+\n+  .nextjs__container_errors_gradient_overlay {\n+    position: absolute;\n+    bottom: 0;\n+    left: 0;\n+    right: 0;\n+    height: 85px;\n+    background: linear-gradient(\n+      180deg,\n+      rgba(250, 250, 250, 0) 0%,\n+      var(--color-background-200) 100%\n+    );\n+  }\n+\n+  .nextjs__container_errors_expand_button {\n+    position: absolute;\n+    bottom: 10px;\n+    left: 50%;\n+    transform: translateX(-50%);\n+    display: flex;\n+    align-items: center;\n+    padding: 6px 8px;\n+    background: var(--color-background-100);\n+    border: 1px solid var(--color-gray-alpha-400);\n+    border-radius: 999px;\n+    box-shadow:\n+      0px 2px 2px var(--color-gray-alpha-100),\n+      0px 8px 8px -8px var(--color-gray-alpha-100);\n+    font-size: 13px;\n+    cursor: pointer;\n+    color: var(--color-gray-900);\n+    font-weight: 500;\n+  }\n `"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 84,
        "deletions": 6
    }
}