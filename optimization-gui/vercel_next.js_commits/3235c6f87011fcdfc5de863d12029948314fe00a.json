{
    "author": "lukesandberg",
    "message": "[turbopack] Fix a buggy serializer (#79520)\n\nBecause regexes aren't naively serializable, we use a simple alternate representation and then just re-parse them when deserializing.  A trivial bug was introduced in #78251  that has broken deserialization.  Fix that and add a unit test.\n\nMy only defense for such a silly mistake is that this was my first PR ü§¶‚Äç‚ôÇÔ∏è",
    "sha": "3235c6f87011fcdfc5de863d12029948314fe00a",
    "files": [
        {
            "sha": "d8421f96cf26b033305e92e39b399d78733571b6",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/3235c6f87011fcdfc5de863d12029948314fe00a/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/3235c6f87011fcdfc5de863d12029948314fe00a/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=3235c6f87011fcdfc5de863d12029948314fe00a",
            "patch": "@@ -9508,6 +9508,7 @@ dependencies = [\n  \"regex\",\n  \"regress\",\n  \"serde\",\n+ \"serde_json\",\n  \"turbo-tasks\",\n  \"turbo-tasks-build\",\n ]"
        },
        {
            "sha": "4c48ab6c439f8e6f762dfc7d1dcc578af11882fe",
            "filename": "turbopack/crates/turbo-esregex/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/3235c6f87011fcdfc5de863d12029948314fe00a/turbopack%2Fcrates%2Fturbo-esregex%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/3235c6f87011fcdfc5de863d12029948314fe00a/turbopack%2Fcrates%2Fturbo-esregex%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-esregex%2FCargo.toml?ref=3235c6f87011fcdfc5de863d12029948314fe00a",
            "patch": "@@ -9,6 +9,7 @@ anyhow = { workspace = true }\n regex = { workspace = true }\n regress = { workspace = true }\n serde = { workspace = true }\n+serde_json = { workspace = true }\n turbo-tasks = { workspace = true }\n \n [build-dependencies]"
        },
        {
            "sha": "2586bf03e55de134b5ebd1d05b3ef8f09c22db50",
            "filename": "turbopack/crates/turbo-esregex/src/lib.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/3235c6f87011fcdfc5de863d12029948314fe00a/turbopack%2Fcrates%2Fturbo-esregex%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/3235c6f87011fcdfc5de863d12029948314fe00a/turbopack%2Fcrates%2Fturbo-esregex%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-esregex%2Fsrc%2Flib.rs?ref=3235c6f87011fcdfc5de863d12029948314fe00a",
            "patch": "@@ -43,7 +43,7 @@ impl TryFrom<RegexForm> for EsRegex {\n     type Error = anyhow::Error;\n \n     fn try_from(value: RegexForm) -> std::result::Result<Self, Self::Error> {\n-        EsRegex::new(&value.pattern, &value.pattern)\n+        EsRegex::new(&value.pattern, &value.flags)\n     }\n }\n \n@@ -87,7 +87,7 @@ impl EsRegex {\n                 'u' => applied_flags.push('u'),\n                 // sticky search: not relevant for the regex itself\n                 'y' => {}\n-                _ => bail!(\"unsupported flag `{}` in regex\", flag),\n+                _ => bail!(\"unsupported flag `{flag}` in regex: `{pattern}` with flags: `{flags}`\"),\n             }\n         }\n \n@@ -129,6 +129,14 @@ impl EsRegex {\n mod tests {\n     use super::{EsRegex, EsRegexImpl};\n \n+    #[test]\n+    fn round_trip_serialize() {\n+        let regex = EsRegex::new(\"[a-z]\", \"i\").unwrap();\n+        let serialized = serde_json::to_string(&regex).unwrap();\n+        let parsed = serde_json::from_str::<EsRegex>(&serialized).unwrap();\n+        assert_eq!(regex, parsed);\n+    }\n+\n     #[test]\n     fn es_regex_matches_simple() {\n         let regex = EsRegex::new(\"a\", \"\").unwrap();"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 12,
        "deletions": 2
    }
}