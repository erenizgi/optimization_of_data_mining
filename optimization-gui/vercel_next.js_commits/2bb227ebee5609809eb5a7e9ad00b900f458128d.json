{
    "author": "dlehmhus",
    "message": "fix: turbopack loader ipc field mapping (#82112)\n\nCo-authored-by: Dario Lehmhus <dario.lehmhus@ffw.com>",
    "sha": "2bb227ebee5609809eb5a7e9ad00b900f458128d",
    "files": [
        {
            "sha": "888614deda3ba5d744d1a7e5dac131038dba2b12",
            "filename": "test/development/app-dir/turbopack-loader-file-dependencies/app/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fapp%2Flayout.tsx?ref=2bb227ebee5609809eb5a7e9ad00b900f458128d",
            "patch": "@@ -0,0 +1,8 @@\n+import { ReactNode } from 'react'\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "9337b26e7a0c1d8fffce1e7d84d51b4daa6a9935",
            "filename": "test/development/app-dir/turbopack-loader-file-dependencies/app/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fapp%2Fpage.tsx?ref=2bb227ebee5609809eb5a7e9ad00b900f458128d",
            "patch": "@@ -0,0 +1,5 @@\n+import { utilFn } from '../utils/file-to-transform'\n+\n+export default function Page() {\n+  return <p>{utilFn()}</p>\n+}"
        },
        {
            "sha": "2cf8c82029458351de5ce6746a34c5a3cb78182d",
            "filename": "test/development/app-dir/turbopack-loader-file-dependencies/loader.js",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Floader.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Floader.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Floader.js?ref=2bb227ebee5609809eb5a7e9ad00b900f458128d",
            "patch": "@@ -0,0 +1,22 @@\n+const path = require('node:path')\n+\n+const loader = async function (content) {\n+  this.async()\n+\n+  if (!this.resourcePath.endsWith('file-to-transform.ts')) {\n+    return this.callback(null, content)\n+  }\n+\n+  const dependencyFile = './file-dependency.ts'\n+  const context = path.dirname(this.resourcePath)\n+  const resolve = this.getResolve({})\n+  const result = await resolve(context, dependencyFile)\n+  this.addDependency(result)\n+\n+  this.callback(\n+    null,\n+    `export const utilFn = () => 'Generated at ${new Date().toISOString()}';`\n+  )\n+}\n+\n+module.exports = loader"
        },
        {
            "sha": "4ed4ed232afd0cca30dff1afd1786f2fa9487e3c",
            "filename": "test/development/app-dir/turbopack-loader-file-dependencies/next.config.js",
            "status": "added",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fnext.config.js?ref=2bb227ebee5609809eb5a7e9ad00b900f458128d",
            "patch": "@@ -0,0 +1,23 @@\n+const path = require('node:path')\n+\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  turbopack: {\n+    rules: {\n+      '*.ts': {\n+        loaders: [path.resolve(__dirname, './loader.js')],\n+      },\n+    },\n+  },\n+  webpack: (config) => {\n+    config.module.rules.push({\n+      test: /\\.ts$/,\n+      use: [path.resolve(__dirname, './loader.js')],\n+    })\n+    return config\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "78532925b8a497448cf9e30ccbc345d04591ca24",
            "filename": "test/development/app-dir/turbopack-loader-file-dependencies/turbopack-loader-file-dependencies.test.ts",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fturbopack-loader-file-dependencies.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fturbopack-loader-file-dependencies.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Fturbopack-loader-file-dependencies.test.ts?ref=2bb227ebee5609809eb5a7e9ad00b900f458128d",
            "patch": "@@ -0,0 +1,25 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { waitFor } from 'next-test-utils'\n+\n+describe('turbopack-loader-file-dependencies', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should update when the dependency file changes', async () => {\n+    const $ = await next.render$('/')\n+    const initialText = await $('p').text()\n+    expect(initialText).toBeTruthy()\n+\n+    await next.patchFile(\n+      'utils/file-dependency.ts',\n+      'export const magicValue = \"magic-value-2\";'\n+    )\n+\n+    await waitFor(1000)\n+\n+    const $2 = await next.render$('/')\n+    const newText = await $2('p').text()\n+    expect(newText).not.toBe(initialText)\n+  })\n+})"
        },
        {
            "sha": "a0e44359d9db5157af5d1baa03f377ce4f02c290",
            "filename": "test/development/app-dir/turbopack-loader-file-dependencies/utils/file-dependency.ts",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Futils%2Ffile-dependency.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Futils%2Ffile-dependency.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Futils%2Ffile-dependency.ts?ref=2bb227ebee5609809eb5a7e9ad00b900f458128d",
            "patch": "@@ -0,0 +1 @@\n+export const magicValue = 'magic-value'"
        },
        {
            "sha": "287bcf9d232d2674921d03aadac6da4a8751d29c",
            "filename": "test/development/app-dir/turbopack-loader-file-dependencies/utils/file-to-transform.ts",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Futils%2Ffile-to-transform.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb227ebee5609809eb5a7e9ad00b900f458128d/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Futils%2Ffile-to-transform.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fturbopack-loader-file-dependencies%2Futils%2Ffile-to-transform.ts?ref=2bb227ebee5609809eb5a7e9ad00b900f458128d",
            "patch": "@@ -0,0 +1,5 @@\n+import { magicValue } from './file-dependency'\n+\n+export const utilFn = () => {\n+  return magicValue\n+}"
        },
        {
            "sha": "8cacb6e71bac279b304ba6babe4049db8a3990bb",
            "filename": "turbopack/crates/turbopack-node/src/transforms/webpack.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/2bb227ebee5609809eb5a7e9ad00b900f458128d/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2bb227ebee5609809eb5a7e9ad00b900f458128d/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs?ref=2bb227ebee5609809eb5a7e9ad00b900f458128d",
            "patch": "@@ -362,6 +362,7 @@ pub enum InfoMessage {\n     // Sent to inform Turbopack about the dependencies of the task.\n     // All fields are `default` since it is ok for the client to\n     // simply omit instead of sending empty arrays.\n+    #[serde(rename_all = \"camelCase\")]\n     Dependencies {\n         #[serde(default)]\n         env_variables: Vec<RcStr>,"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 90,
        "deletions": 0
    }
}