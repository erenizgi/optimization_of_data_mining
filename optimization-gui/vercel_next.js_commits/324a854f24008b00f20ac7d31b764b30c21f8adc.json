{
    "author": "huozhi",
    "message": "Revert \"[dev-overlay] Fix error dialog resizing logic\" (#77849)\n\nReverts vercel/next.js#77830\n\nThis was breaking the react 18.3 tests, where the toggling stack frames\nis not working in 18.3. Possibly broken by the ref related changes.\n\nx-ref:\nhttps://github.com/vercel/next.js/actions/runs/14274082641/job/40015934515",
    "sha": "324a854f24008b00f20ac7d31b764b30c21f8adc",
    "files": [
        {
            "sha": "fa329e7965003c8df79c3be5602a93cdbeae38db",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/dialog/dialog.tsx",
            "status": "modified",
            "additions": 17,
            "deletions": 1,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fdialog%2Fdialog.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fdialog%2Fdialog.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fdialog%2Fdialog.tsx?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -1,5 +1,6 @@\n import * as React from 'react'\n import { useOnClickOutside } from '../../hooks/use-on-click-outside'\n+import { useMeasureHeight } from '../../hooks/use-measure-height'\n \n export type DialogProps = {\n   children?: React.ReactNode\n@@ -36,6 +37,9 @@ const Dialog: React.FC<DialogProps> = function Dialog({\n       : undefined\n   )\n \n+  const ref = React.useRef<HTMLDivElement | null>(null)\n+  const [height, pristine] = useMeasureHeight(ref)\n+\n   useOnClickOutside(\n     dialogRef.current,\n     CSS_SELECTORS_TO_EXCLUDE_ON_CLICK_OUTSIDE,\n@@ -98,7 +102,19 @@ const Dialog: React.FC<DialogProps> = function Dialog({\n       }}\n       {...props}\n     >\n-      {children}\n+      <div\n+        ref={dialogResizerRef}\n+        data-nextjs-dialog-sizer\n+        // [x] Don't animate on initial load\n+        // [x] No duplicate elements\n+        // [x] Responds to content growth\n+        style={{\n+          height,\n+          transition: pristine ? undefined : 'height 250ms var(--timing-swift)',\n+        }}\n+      >\n+        <div ref={ref}>{children}</div>\n+      </div>\n     </div>\n   )\n }"
        },
        {
            "sha": "c8f13041723504098fd3de5049031b29cd06b6cd",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/dialog/styles.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fdialog%2Fstyles.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fdialog%2Fstyles.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fdialog%2Fstyles.ts?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -3,7 +3,7 @@ const styles = `\n     --next-dialog-radius: var(--rounded-xl);\n     --next-dialog-max-width: 960px;\n     --next-dialog-row-padding: 16px;\n-    --next-dialog-padding: 12px;\n+    --next-dialog-padding-x: 12px;\n     --next-dialog-notch-height: 42px;\n     --next-dialog-border-width: 1px;\n \n@@ -14,7 +14,7 @@ const styles = `\n     max-width: var(--next-dialog-max-width);\n     margin-right: auto;\n     margin-left: auto;\n-    scale: 0.97;\n+    scale: 0.98;\n     opacity: 0;\n     transition-property: scale, opacity;\n     transition-duration: var(--transition-duration);\n@@ -28,7 +28,7 @@ const styles = `\n     [data-nextjs-scroll-fader][data-side=\"top\"] {\n       left: 1px;\n       top: calc(var(--next-dialog-notch-height) + var(--next-dialog-border-width));\n-      width: calc(100% - var(--next-dialog-padding));\n+      width: calc(100% - var(--next-dialog-padding-x));\n       opacity: 0;\n     }\n   }\n@@ -82,7 +82,7 @@ const styles = `\n     display: flex;\n     flex-direction: column;\n     position: relative;\n-    padding: var(--next-dialog-padding);\n+    padding: 16px var(--next-dialog-padding-x);\n   }\n \n   [data-nextjs-dialog-content] > [data-nextjs-dialog-header] {"
        },
        {
            "sha": "c17d0de3088478c3ac5c536c41cc2797aff070c4",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay-layout/error-overlay-layout.test.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.test.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.test.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.test.tsx?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -24,7 +24,6 @@ const renderTestComponent = () => {\n       rendered={true}\n       transitionDurationMs={200}\n       isTurbopack={false}\n-      errorCount={1}\n       versionInfo={{\n         installed: '15.0.0',\n         staleness: 'fresh',"
        },
        {
            "sha": "8032fca364faa26c896b1994d85a94525f4f85ad",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay-layout/error-overlay-layout.tsx",
            "status": "modified",
            "additions": 23,
            "deletions": 50,
            "changes": 73,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.tsx?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -36,7 +36,6 @@ import type { ReadyRuntimeError } from '../../../../utils/get-error-by-type'\n import { EnvironmentNameLabel } from '../environment-name-label/environment-name-label'\n import { useFocusTrap } from '../dev-tools-indicator/utils'\n import { Fader } from '../../fader'\n-import { Resizer } from '../../resizer'\n \n export interface ErrorOverlayLayoutProps extends ErrorBaseProps {\n   errorMessage: ErrorMessageType\n@@ -60,7 +59,6 @@ export function ErrorOverlayLayout({\n   errorType,\n   children,\n   errorCode,\n-  errorCount,\n   error,\n   debugInfo,\n   isBuildError,\n@@ -85,10 +83,6 @@ export function ErrorOverlayLayout({\n     } as React.CSSProperties,\n   }\n \n-  const [animating, setAnimating] = React.useState(\n-    Boolean(transitionDurationMs)\n-  )\n-\n   const faderRef = React.useRef<HTMLDivElement | null>(null)\n   const hasFooter = Boolean(footerMessage || errorCode)\n   const dialogRef = React.useRef<HTMLDivElement | null>(null)\n@@ -101,23 +95,9 @@ export function ErrorOverlayLayout({\n     }\n   }\n \n-  function onTransitionEnd({ propertyName, target }: React.TransitionEvent) {\n-    // We can only measure height after the `scale` transition ends,\n-    // otherwise we will measure height as a multiple of the animating value\n-    // which will give us an incorrect value.\n-    if (propertyName === 'scale' && target === dialogRef.current) {\n-      setAnimating(false)\n-    }\n-  }\n-\n   return (\n     <ErrorOverlayOverlay fixed={isBuildError} {...animationProps}>\n-      <div\n-        data-nextjs-dialog-root\n-        onTransitionEnd={onTransitionEnd}\n-        ref={dialogRef}\n-        {...animationProps}\n-      >\n+      <div data-nextjs-dialog-root ref={dialogRef} {...animationProps}>\n         <ErrorOverlayNav\n           runtimeErrors={runtimeErrors}\n           activeIdx={activeIdx}\n@@ -139,37 +119,30 @@ export function ErrorOverlayLayout({\n             )\n           }\n         >\n-          <Resizer\n-            ref={dialogResizerRef}\n-            measure={!animating}\n-            data-nextjs-dialog-sizer\n-          >\n-            <DialogContent>\n-              <ErrorOverlayDialogHeader>\n-                <div\n-                  className=\"nextjs__container_errors__error_title\"\n-                  // allow assertion in tests before error rating is implemented\n-                  data-nextjs-error-code={errorCode}\n-                >\n-                  <span data-nextjs-error-label-group>\n-                    <ErrorTypeLabel errorType={errorType} />\n-                    {error.environmentName && (\n-                      <EnvironmentNameLabel\n-                        environmentName={error.environmentName}\n-                      />\n-                    )}\n-                  </span>\n-                  <ErrorOverlayToolbar error={error} debugInfo={debugInfo} />\n-                </div>\n-                <ErrorMessage errorMessage={errorMessage} />\n-              </ErrorOverlayDialogHeader>\n-\n-              <ErrorOverlayDialogBody>{children}</ErrorOverlayDialogBody>\n-            </DialogContent>\n-          </Resizer>\n+          <DialogContent>\n+            <ErrorOverlayDialogHeader>\n+              <div\n+                className=\"nextjs__container_errors__error_title\"\n+                // allow assertion in tests before error rating is implemented\n+                data-nextjs-error-code={errorCode}\n+              >\n+                <span data-nextjs-error-label-group>\n+                  <ErrorTypeLabel errorType={errorType} />\n+                  {error.environmentName && (\n+                    <EnvironmentNameLabel\n+                      environmentName={error.environmentName}\n+                    />\n+                  )}\n+                </span>\n+                <ErrorOverlayToolbar error={error} debugInfo={debugInfo} />\n+              </div>\n+              <ErrorMessage errorMessage={errorMessage} />\n+            </ErrorOverlayDialogHeader>\n \n+            <ErrorOverlayDialogBody>{children}</ErrorOverlayDialogBody>\n+          </DialogContent>\n           <ErrorOverlayBottomStack\n-            errorCount={errorCount}\n+            errorCount={runtimeErrors?.length ?? 0}\n             activeIdx={activeIdx ?? 0}\n           />\n         </ErrorOverlayDialog>"
        },
        {
            "sha": "bc0bd5e4dd109512edd7ae807dab8006799f6626",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay/error-overlay.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -13,21 +13,18 @@ export interface ErrorBaseProps {\n   transitionDurationMs: number\n   isTurbopack: boolean\n   versionInfo: OverlayState['versionInfo']\n-  errorCount: number\n }\n \n export function ErrorOverlay({\n   state,\n   runtimeErrors,\n   isErrorOverlayOpen,\n   setIsErrorOverlayOpen,\n-  errorCount,\n }: {\n   state: OverlayState\n   runtimeErrors: ReadyRuntimeError[]\n   isErrorOverlayOpen: boolean\n   setIsErrorOverlayOpen: (value: boolean) => void\n-  errorCount: number\n }) {\n   const isTurbopack = !!process.env.TURBOPACK\n \n@@ -41,7 +38,6 @@ export function ErrorOverlay({\n     transitionDurationMs,\n     isTurbopack,\n     versionInfo: state.versionInfo,\n-    errorCount,\n   }\n \n   if (state.buildError !== null) {"
        },
        {
            "sha": "241393090c17e9e72f1d0b2bee6acc9d664a7e71",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/resizer/index.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 65,
            "changes": 65,
            "blob_url": "https://github.com/vercel/next.js/blob/fd5669dd41c55eece268f1192531923e7fff3f39/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fresizer%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/fd5669dd41c55eece268f1192531923e7fff3f39/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fresizer%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Fresizer%2Findex.tsx?ref=fd5669dd41c55eece268f1192531923e7fff3f39",
            "patch": "@@ -1,65 +0,0 @@\n-import { useEffect, useRef, useState } from 'react'\n-\n-export function Resizer({\n-  children,\n-  measure,\n-  ...props\n-}: {\n-  children: React.ReactNode\n-  measure: boolean\n-} & React.HTMLProps<HTMLDivElement> & { ref?: React.Ref<HTMLDivElement> }) {\n-  const ref = useRef<HTMLDivElement | null>(null)\n-  const [height, measuring] = useMeasureHeight(ref, measure)\n-\n-  return (\n-    <div\n-      {...props}\n-      // [x] Don't animate on initial load\n-      // [x] No duplicate elements\n-      // [x] Responds to content growth\n-      style={{\n-        height: measuring ? 'auto' : height,\n-        transition: 'height 250ms var(--timing-swift)',\n-      }}\n-    >\n-      <div ref={ref}>{children}</div>\n-    </div>\n-  )\n-}\n-\n-function useMeasureHeight(\n-  ref: React.RefObject<HTMLDivElement | null>,\n-  measure: boolean\n-): [number, boolean] {\n-  const [height, setHeight] = useState<number>(0)\n-  const [measuring, setMeasuring] = useState<boolean>(true)\n-\n-  useEffect(() => {\n-    if (!measure) {\n-      return\n-    }\n-\n-    let timerId: number\n-    const el = ref.current\n-\n-    if (!el) {\n-      return\n-    }\n-\n-    const observer = new ResizeObserver(([{ contentRect }]) => {\n-      clearTimeout(timerId)\n-\n-      timerId = window.setTimeout(() => {\n-        setMeasuring(false)\n-      }, 100)\n-\n-      setHeight(contentRect.height)\n-    })\n-\n-    observer.observe(el)\n-    return () => observer.disconnect()\n-    // eslint-disable-next-line react-hooks/exhaustive-deps\n-  }, [measure])\n-\n-  return [height, measuring]\n-}"
        },
        {
            "sha": "2c7928d881ff2cd8a20cbb546cc0c6c92adf5966",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/container/errors.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 1,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -1,4 +1,4 @@\n-import { useState, useMemo, useRef, Suspense } from 'react'\n+import { useState, useMemo, useEffect, useRef, Suspense } from 'react'\n import type { DebugInfo } from '../../types'\n import { Overlay } from '../components/overlay'\n import { RuntimeError } from './runtime-error'\n@@ -89,6 +89,18 @@ export function Errors({\n }: ErrorsProps) {\n   const dialogResizerRef = useRef<HTMLDivElement | null>(null)\n \n+  useEffect(() => {\n+    // Close the error overlay when pressing escape\n+    function handleKeyDown(event: KeyboardEvent) {\n+      if (event.key === 'Escape') {\n+        onClose()\n+      }\n+    }\n+\n+    document.addEventListener('keydown', handleKeyDown)\n+    return () => document.removeEventListener('keydown', handleKeyDown)\n+  }, [onClose])\n+\n   const isLoading = useMemo<boolean>(() => {\n     return runtimeErrors.length < 1\n   }, [runtimeErrors.length])"
        },
        {
            "sha": "27c9de8a9907e2d0f01120c60af7cebdf2c53b42",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -92,8 +92,9 @@ export const Default: Story = {\n           src={imgApp}\n           style={{\n             width: '100%',\n-            height: '100vh',\n+            height: '100%',\n             objectFit: 'contain',\n+            filter: 'invert(1)',\n           }}\n         />\n         <DevOverlay"
        },
        {
            "sha": "96f2e5628e52eb9934d8a0cc4b7c4a408ddd53d9",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.tsx?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -50,7 +50,6 @@ export function DevOverlay({\n               <ErrorOverlay\n                 state={state}\n                 runtimeErrors={runtimeErrors}\n-                errorCount={totalErrorCount}\n                 isErrorOverlayOpen={isErrorOverlayOpen}\n                 setIsErrorOverlayOpen={setIsErrorOverlayOpen}\n               />"
        },
        {
            "sha": "54097e8bd4d6cd3537b2870ba5f05051fa66e76b",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/hooks/use-measure-height.ts",
            "status": "added",
            "additions": 35,
            "deletions": 0,
            "changes": 35,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fhooks%2Fuse-measure-height.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fhooks%2Fuse-measure-height.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fhooks%2Fuse-measure-height.ts?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -0,0 +1,35 @@\n+import { useEffect, useState } from 'react'\n+\n+export function useMeasureHeight(\n+  ref: React.RefObject<HTMLDivElement | null>\n+): [number, boolean] {\n+  const [pristine, setPristine] = useState<boolean>(true)\n+  const [height, setHeight] = useState<number>(0)\n+\n+  useEffect(() => {\n+    const el = ref.current\n+\n+    if (!el) {\n+      return\n+    }\n+\n+    const observer = new ResizeObserver(() => {\n+      const { height: h } = el.getBoundingClientRect()\n+      setHeight((prevHeight) => {\n+        if (prevHeight !== 0) {\n+          setPristine(false)\n+        }\n+        return h\n+      })\n+    })\n+\n+    observer.observe(el)\n+    return () => {\n+      observer.disconnect()\n+      setPristine(true)\n+    }\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, [])\n+\n+  return [height, pristine]\n+}"
        },
        {
            "sha": "24a3acb34176b4c9f653cfbc7d701698a35cdccb",
            "filename": "test/development/acceptance/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/324a854f24008b00f20ac7d31b764b30c21f8adc/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/324a854f24008b00f20ac7d31b764b30c21f8adc/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts?ref=324a854f24008b00f20ac7d31b764b30c21f8adc",
            "patch": "@@ -1161,10 +1161,7 @@ describe('ReactRefreshLogBox', () => {\n       `)\n     }\n \n-    // TODO: fix the broken collapsing in callstack\n-    if (!isReact18) {\n-      await toggleCollapseCallStackFrames(browser)\n-    }\n+    await toggleCollapseCallStackFrames(browser)\n \n     // Expect more than the default amount of frames\n     // The default stackTraceLimit results in max 9 [data-nextjs-call-stack-frame] elements"
        }
    ],
    "stats": {
        "total": 227,
        "additions": 95,
        "deletions": 132
    }
}