{
    "author": "bgub",
    "message": "feat: automatically generate route types (#81396)\n\n## Overview\nGenerates `.next/types/routes.d.ts` file that provides typed route\ndefinitions and global `PageProps`/`LayoutProps` types for App Router\ncomponents, eliminating the need for manual imports and providing full\ntype safety for routing.\n\n## Generated Type Structure\n```typescript\n// Route union types\ntype AppRoutes = \"/\" | \"/blog/[slug]\" | \"/dashboard/[...path]\"\ntype LayoutRoutes = \"/\" | \"/dashboard\" \ntype PageRoutes = never // for pages directory\ntype RedirectRoutes = \"/old-path\"\ntype RewriteRoutes = \"/api/proxy/[...path]\"\n\n// Parameter mapping with full dynamic route support\ntype ParamMap = {\n  \"/\": {}\n  \"/blog/[slug]\": { \"slug\": string }\n  \"/dashboard/[[...path]]\": { \"path\"?: string[] } // optional catch-all\n  \"/api/[...segments]\": { \"segments\": string[] }  // required catch-all\n}\n\n// Parallel route slots for layouts\ntype LayoutSlotMap = {\n  \"/dashboard\": \"analytics\" | \"team\"\n  \"/\": never\n}\n```\n\n## Usage Examples\n```typescript\n// Page component - no imports needed, full parameter typing\nexport default function BlogPost(props: PageProps<'/blog/[slug]'>) {\n  const { slug } = await props.params // slug is typed as string\n  const searchParams = await props.searchParams // Record<string, string | string[] | undefined>\n  return <div>Post: {slug}</div>\n}\n\n// Layout with parallel routes - automatic slot typing\nexport default function DashboardLayout(props: LayoutProps<'/dashboard'>) {\n  return (\n    <div>\n      {props.children}\n      {props.analytics}  {/* Typed parallel route slot */}\n      {props.team}       {/* Typed parallel route slot */}\n    </div>\n  )\n}\n\n// Catch-all routes with array parameters\nexport default function DocsPage(props: PageProps<'/docs/[...path]'>) {\n  const { path } = await props.params // path is typed as string[]\n  return <div>Docs path: {path.join('/')}</div>\n}\n```\n\n## Key Features\n- **Zero imports**: All types are globally available via declaration\nmerging\n- **Route validation**: TypeScript ensures only valid routes can be used\n- **Dynamic route support**: Full typing for `[param]`, `[...param]`,\nand `[[...param]]` patterns\n- **Parameter extraction**: Automatic typing of route parameters based\non file structure\n- **Parallel routes**: Automatic slot typing for layouts with `@slot`\ndirectories\n- **Custom routes**: Support for `redirects` and `rewrites` from\n`next.config.js`\n- **IDE integration**: Full auto-completion for route paths and\nparameters\n\n## Route Discovery\nThe system automatically discovers routes from:\n- **App Router**: `app/` directory structure with `page.tsx` and\n`layout.tsx` files\n- **Pages Router**: `pages/` directory structure (legacy support)\n- **Redirects**: Custom redirects defined in `next.config.js`\n- **Rewrites**: Custom rewrites defined in `next.config.js`\n- **Parallel Routes**: `@slot` directories for layout composition",
    "sha": "03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
    "files": [
        {
            "sha": "f77cf2fcf4ac83002d986466af649e17921f18c6",
            "filename": "packages/create-next-app/templates/app-api/ts/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp-api%2Fts%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp-api%2Fts%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Fapp-api%2Fts%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/basic-features/typescript for more information."
        },
        {
            "sha": "830fb594ca2970a827555c28a253b097367e08d8",
            "filename": "packages/create-next-app/templates/app-empty/ts/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp-empty%2Fts%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp-empty%2Fts%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Fapp-empty%2Fts%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/app/api-reference/config/typescript for more information."
        },
        {
            "sha": "830fb594ca2970a827555c28a253b097367e08d8",
            "filename": "packages/create-next-app/templates/app-tw-empty/ts/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp-tw-empty%2Fts%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp-tw-empty%2Fts%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Fapp-tw-empty%2Fts%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/app/api-reference/config/typescript for more information."
        },
        {
            "sha": "830fb594ca2970a827555c28a253b097367e08d8",
            "filename": "packages/create-next-app/templates/app-tw/ts/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp-tw%2Fts%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp-tw%2Fts%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Fapp-tw%2Fts%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/app/api-reference/config/typescript for more information."
        },
        {
            "sha": "830fb594ca2970a827555c28a253b097367e08d8",
            "filename": "packages/create-next-app/templates/app/ts/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp%2Fts%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fapp%2Fts%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Fapp%2Fts%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/app/api-reference/config/typescript for more information."
        },
        {
            "sha": "254b73c165d9020f2076dc5a74c24bc346e26a2b",
            "filename": "packages/create-next-app/templates/default-empty/ts/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fdefault-empty%2Fts%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fdefault-empty%2Fts%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Fdefault-empty%2Fts%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/pages/api-reference/config/typescript for more information."
        },
        {
            "sha": "254b73c165d9020f2076dc5a74c24bc346e26a2b",
            "filename": "packages/create-next-app/templates/default-tw-empty/ts/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fdefault-tw-empty%2Fts%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fdefault-tw-empty%2Fts%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Fdefault-tw-empty%2Fts%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/pages/api-reference/config/typescript for more information."
        },
        {
            "sha": "254b73c165d9020f2076dc5a74c24bc346e26a2b",
            "filename": "packages/create-next-app/templates/default-tw/ts/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fdefault-tw%2Fts%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fdefault-tw%2Fts%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Fdefault-tw%2Fts%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/pages/api-reference/config/typescript for more information."
        },
        {
            "sha": "254b73c165d9020f2076dc5a74c24bc346e26a2b",
            "filename": "packages/create-next-app/templates/default/ts/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fdefault%2Fts%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fcreate-next-app%2Ftemplates%2Fdefault%2Fts%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Fdefault%2Fts%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/pages/api-reference/config/typescript for more information."
        },
        {
            "sha": "01c39bb4106542f9fe6da585ad39eb80bf999acc",
            "filename": "packages/next/src/bin/next.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -20,6 +20,7 @@ import type { NextLintOptions } from '../cli/next-lint.js'\n import type { NextInfoOptions } from '../cli/next-info.js'\n import type { NextDevOptions } from '../cli/next-dev.js'\n import type { NextBuildOptions } from '../cli/next-build.js'\n+import type { NextTypegenOptions } from '../cli/next-typegen.js'\n \n if (process.env.NEXT_RSPACK) {\n   // silent rspack's schema check\n@@ -382,6 +383,24 @@ program\n     )\n   )\n \n+program\n+  .command('typegen')\n+  .description(\n+    'Generate TypeScript definitions for routes, pages, and layouts without running a full build.'\n+  )\n+  .argument(\n+    '[directory]',\n+    `A directory on which to generate types. ${italic(\n+      'If no directory is provided, the current directory will be used.'\n+    )}`\n+  )\n+  .action((directory: string, options: NextTypegenOptions) =>\n+    import('../cli/next-typegen.js').then((mod) =>\n+      mod.nextTypegen(options, directory)\n+    )\n+  )\n+  .usage('[directory] [options]')\n+\n program\n   .command('experimental-test')\n   .description("
        },
        {
            "sha": "5d00c28e0c9fb7cd3116255dce7e41b2c838f394",
            "filename": "packages/next/src/build/entries.ts",
            "status": "modified",
            "additions": 218,
            "deletions": 0,
            "changes": 218,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -75,6 +75,224 @@ import type { PageExtensions } from './page-extensions-type'\n import type { MappedPages } from './build-context'\n import { PAGE_TYPES } from '../lib/page-types'\n import { isAppPageRoute } from '../lib/is-app-page-route'\n+import { recursiveReadDir } from '../lib/recursive-readdir'\n+import { createValidFileMatcher } from '../server/lib/find-page-file'\n+import { isReservedPage } from './utils'\n+import { isParallelRouteSegment } from '../shared/lib/segment'\n+import { ensureLeadingSlash } from '../shared/lib/page-path/ensure-leading-slash'\n+\n+/**\n+ * Collect app pages and layouts from the app directory\n+ * @param appDir - The app directory path\n+ * @param pageExtensions - The configured page extensions\n+ * @param options - Optional configuration\n+ * @returns Object containing appPaths and layoutPaths arrays\n+ */\n+export async function collectAppFiles(\n+  appDir: string,\n+  pageExtensions: PageExtensions\n+): Promise<{\n+  appPaths: string[]\n+  layoutPaths: string[]\n+}> {\n+  const validFileMatcher = createValidFileMatcher(pageExtensions, appDir)\n+\n+  // Collect both app pages and layouts in a single directory traversal\n+  const allAppFiles = await recursiveReadDir(appDir, {\n+    pathnameFilter: (absolutePath) =>\n+      validFileMatcher.isAppRouterPage(absolutePath) ||\n+      validFileMatcher.isRootNotFound(absolutePath) ||\n+      validFileMatcher.isAppLayoutPage(absolutePath),\n+    ignorePartFilter: (part) => part.startsWith('_'),\n+  })\n+\n+  // Separate app pages from layouts\n+  const appPaths = allAppFiles.filter(\n+    (absolutePath) =>\n+      validFileMatcher.isAppRouterPage(absolutePath) ||\n+      validFileMatcher.isRootNotFound(absolutePath)\n+  )\n+  const layoutPaths = allAppFiles.filter((absolutePath) =>\n+    validFileMatcher.isAppLayoutPage(absolutePath)\n+  )\n+\n+  return { appPaths, layoutPaths }\n+}\n+\n+/**\n+ * Collect pages from the pages directory\n+ * @param pagesDir - The pages directory path\n+ * @param pageExtensions - The configured page extensions\n+ * @returns Array of page file paths\n+ */\n+export async function collectPagesFiles(\n+  pagesDir: string,\n+  pageExtensions: PageExtensions\n+): Promise<string[]> {\n+  return recursiveReadDir(pagesDir, {\n+    pathnameFilter: (absolutePath) => {\n+      const relativePath = absolutePath.replace(pagesDir + '/', '')\n+      return pageExtensions.some((ext) => relativePath.endsWith(`.${ext}`))\n+    },\n+    ignorePartFilter: (part) => part.startsWith('_'),\n+  })\n+}\n+\n+// Types for route processing\n+export type RouteInfo = {\n+  route: string\n+  filePath: string\n+}\n+\n+export type SlotInfo = {\n+  name: string\n+  parent: string\n+}\n+\n+/**\n+ * Create a relative file path from a mapped page path\n+ * @param baseDir - The base directory path\n+ * @param filePath - The mapped file path (with private prefix)\n+ * @param prefix - The directory prefix ('pages' or 'app')\n+ * @returns The relative file path\n+ */\n+export function createRelativeFilePath(\n+  baseDir: string,\n+  filePath: string,\n+  prefix: 'pages' | 'app'\n+): string {\n+  const privatePrefix =\n+    prefix === 'pages' ? 'private-next-pages' : 'private-next-app-dir'\n+  return join(\n+    baseDir,\n+    filePath.replace(new RegExp(`^${privatePrefix}/`), `${prefix}/`)\n+  )\n+}\n+\n+/**\n+ * Process pages routes from mapped pages\n+ * @param mappedPages - The mapped pages object\n+ * @param baseDir - The base directory path\n+ * @returns Object containing pageRoutes and pageApiRoutes\n+ */\n+export function processPageRoutes(\n+  mappedPages: { [page: string]: string },\n+  baseDir: string\n+): {\n+  pageRoutes: RouteInfo[]\n+  pageApiRoutes: RouteInfo[]\n+} {\n+  const pageRoutes: RouteInfo[] = []\n+  const pageApiRoutes: RouteInfo[] = []\n+\n+  for (const [route, filePath] of Object.entries(mappedPages)) {\n+    const relativeFilePath = createRelativeFilePath(baseDir, filePath, 'pages')\n+\n+    if (route.startsWith('/api/')) {\n+      pageApiRoutes.push({\n+        route: normalizePathSep(route),\n+        filePath: relativeFilePath,\n+      })\n+    } else {\n+      // Filter out _app, _error, _document\n+      if (isReservedPage(route)) continue\n+\n+      pageRoutes.push({\n+        route: normalizePathSep(route),\n+        filePath: relativeFilePath,\n+      })\n+    }\n+  }\n+\n+  return { pageRoutes, pageApiRoutes }\n+}\n+\n+/**\n+ * Extract slots from app routes\n+ * @param mappedAppPages - The mapped app pages object\n+ * @returns Array of slot information\n+ */\n+export function extractSlotsFromAppRoutes(mappedAppPages: {\n+  [page: string]: string\n+}): SlotInfo[] {\n+  const slots: SlotInfo[] = []\n+\n+  for (const [route] of Object.entries(mappedAppPages)) {\n+    if (route === '/_not-found/page') continue\n+\n+    const segments = route.split('/')\n+    for (let i = segments.length - 1; i >= 0; i--) {\n+      const segment = segments[i]\n+      if (isParallelRouteSegment(segment)) {\n+        const parentPath = normalizeAppPath(segments.slice(0, i).join('/'))\n+        const slotName = segment.slice(1)\n+\n+        // Check if the slot already exists\n+        if (slots.some((s) => s.name === slotName && s.parent === parentPath))\n+          continue\n+\n+        slots.push({\n+          name: slotName,\n+          parent: parentPath,\n+        })\n+        break\n+      }\n+    }\n+  }\n+\n+  return slots\n+}\n+\n+/**\n+ * Process app routes from mapped app pages\n+ * @param mappedAppPages - The mapped app pages object\n+ * @param baseDir - The base directory path\n+ * @returns Array of route information\n+ */\n+export function processAppRoutes(\n+  mappedAppPages: { [page: string]: string },\n+  baseDir: string\n+): RouteInfo[] {\n+  const appRoutes: RouteInfo[] = []\n+\n+  for (const [route, filePath] of Object.entries(mappedAppPages)) {\n+    if (route === '/_not-found/page') continue\n+\n+    const relativeFilePath = createRelativeFilePath(baseDir, filePath, 'app')\n+\n+    appRoutes.push({\n+      route: normalizeAppPath(normalizePathSep(route)),\n+      filePath: relativeFilePath,\n+    })\n+  }\n+\n+  return appRoutes\n+}\n+\n+/**\n+ * Process layout routes from mapped app layouts\n+ * @param mappedAppLayouts - The mapped app layouts object\n+ * @param baseDir - The base directory path\n+ * @returns Array of layout route information\n+ */\n+export function processLayoutRoutes(\n+  mappedAppLayouts: { [page: string]: string },\n+  baseDir: string\n+): RouteInfo[] {\n+  const layoutRoutes: RouteInfo[] = []\n+\n+  for (const [route, filePath] of Object.entries(mappedAppLayouts)) {\n+    const relativeFilePath = createRelativeFilePath(baseDir, filePath, 'app')\n+    layoutRoutes.push({\n+      route: ensureLeadingSlash(\n+        normalizeAppPath(normalizePathSep(route)).replace(/\\/layout$/, '')\n+      ),\n+      filePath: relativeFilePath,\n+    })\n+  }\n+\n+  return layoutRoutes\n+}\n \n export function sortByPageExts(pageExtensions: PageExtensions) {\n   return (a: string, b: string) => {"
        },
        {
            "sha": "40e2397e539355d93b6356af6bfa6be3b02f2cb5",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 88,
            "deletions": 20,
            "changes": 108,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -108,8 +108,15 @@ import type { EventBuildFeatureUsage } from '../telemetry/events'\n import { Telemetry } from '../telemetry/storage'\n import {\n   createPagesMapping,\n+  collectAppFiles,\n   getStaticInfoIncludingLayouts,\n   sortByPageExts,\n+  processPageRoutes,\n+  processAppRoutes,\n+  processLayoutRoutes,\n+  extractSlotsFromAppRoutes,\n+  type RouteInfo,\n+  type SlotInfo,\n } from './entries'\n import { PAGE_TYPES } from '../lib/page-types'\n import { generateBuildId } from './generate-build-id'\n@@ -211,6 +218,10 @@ import {\n   sortPages,\n   sortSortableRouteObjects,\n } from '../shared/lib/router/utils/sortable-routes'\n+import {\n+  createRouteTypesManifest,\n+  writeRouteTypesManifest,\n+} from '../server/lib/router-utils/route-types-utils'\n \n type Fallback = null | boolean | string\n \n@@ -1113,12 +1124,6 @@ export default async function build(\n         await recursiveDelete(distDir, /^cache/)\n       }\n \n-      // For app directory, we run type checking after build. That's because\n-      // we dynamically generate types for each layout and page in the app\n-      // directory.\n-      if (!appDir && !isCompileMode)\n-        await startTypeChecking(typeCheckingOptions)\n-\n       if (appDir && 'exportPathMap' in config) {\n         Log.error(\n           'The \"exportPathMap\" configuration cannot be used with the \"app\" directory. Please use generateStaticParams() instead.'\n@@ -1206,27 +1211,29 @@ export default async function build(\n       NextBuildContext.mappedPages = mappedPages\n \n       let mappedAppPages: MappedPages | undefined\n+      let mappedAppLayouts: MappedPages | undefined\n       let denormalizedAppPages: string[] | undefined\n \n       if (appDir) {\n         const providedAppPaths: string[] = JSON.parse(\n           process.env.NEXT_PRIVATE_APP_PATHS || '[]'\n         )\n \n-        let appPaths = Boolean(process.env.NEXT_PRIVATE_APP_PATHS)\n-          ? providedAppPaths\n-          : await nextBuildSpan\n-              .traceChild('collect-app-paths')\n-              .traceAsyncFn(() =>\n-                recursiveReadDir(appDir, {\n-                  pathnameFilter: (absolutePath) =>\n-                    validFileMatcher.isAppRouterPage(absolutePath) ||\n-                    // For now we only collect the root /not-found page in the app\n-                    // directory as the 404 fallback\n-                    validFileMatcher.isRootNotFound(absolutePath),\n-                  ignorePartFilter: (part) => part.startsWith('_'),\n-                })\n-              )\n+        let appPaths: string[]\n+        let layoutPaths: string[]\n+\n+        if (Boolean(process.env.NEXT_PRIVATE_APP_PATHS)) {\n+          appPaths = providedAppPaths\n+          layoutPaths = []\n+        } else {\n+          // Collect both app pages and layouts in a single directory traversal\n+          const result = await nextBuildSpan\n+            .traceChild('collect-app-files')\n+            .traceAsyncFn(() => collectAppFiles(appDir, config.pageExtensions))\n+\n+          appPaths = result.appPaths\n+          layoutPaths = result.layoutPaths\n+        }\n \n         mappedAppPages = await nextBuildSpan\n           .traceChild('create-app-mapping')\n@@ -1241,6 +1248,19 @@ export default async function build(\n             })\n           )\n \n+        mappedAppLayouts = await nextBuildSpan\n+          .traceChild('create-app-layouts')\n+          .traceAsyncFn(() =>\n+            createPagesMapping({\n+              pagePaths: layoutPaths,\n+              isDev: false,\n+              pagesType: PAGE_TYPES.APP,\n+              pageExtensions: config.pageExtensions,\n+              pagesDir,\n+              appDir,\n+            })\n+          )\n+\n         NextBuildContext.mappedAppPages = mappedAppPages\n       }\n \n@@ -1289,6 +1309,49 @@ export default async function build(\n         app: appPaths.length > 0 ? appPaths : undefined,\n       }\n \n+      await nextBuildSpan\n+        .traceChild('generate-route-types')\n+        .traceAsyncFn(async () => {\n+          const routeTypesFilePath = path.join(distDir, 'types', 'routes.d.ts')\n+          await fs.mkdir(path.dirname(routeTypesFilePath), { recursive: true })\n+\n+          let pageRoutes: RouteInfo[] = []\n+          let appRoutes: RouteInfo[] = []\n+          let layoutRoutes: RouteInfo[] = []\n+          let slots: SlotInfo[] = []\n+\n+          // Build pages routes\n+          const processedPages = processPageRoutes(mappedPages, dir)\n+          // We combine both page routes and API routes\n+          pageRoutes = [\n+            ...processedPages.pageRoutes,\n+            ...processedPages.pageApiRoutes,\n+          ]\n+\n+          // Build app routes\n+          if (appDir && mappedAppPages) {\n+            slots = extractSlotsFromAppRoutes(mappedAppPages)\n+            appRoutes = processAppRoutes(mappedAppPages, dir)\n+          }\n+\n+          // Build app layouts\n+          if (appDir && mappedAppLayouts) {\n+            layoutRoutes = processLayoutRoutes(mappedAppLayouts, dir)\n+          }\n+\n+          const routeTypesManifest = await createRouteTypesManifest({\n+            dir,\n+            pageRoutes,\n+            appRoutes,\n+            layoutRoutes,\n+            slots,\n+            redirects: config.redirects,\n+            rewrites: config.rewrites,\n+          })\n+\n+          await writeRouteTypesManifest(routeTypesManifest, routeTypesFilePath)\n+        })\n+\n       // Turbopack already handles conflicting app and page routes.\n       if (!isTurbopack) {\n         const numConflictingAppPaths = conflictingAppPagePaths.length\n@@ -1461,6 +1524,11 @@ export default async function build(\n           } satisfies RoutesManifest\n         })\n \n+      // For pages directory, we run type checking after route collection but before build.\n+      if (!appDir && !isCompileMode) {\n+        await startTypeChecking(typeCheckingOptions)\n+      }\n+\n       let clientRouterFilters:\n         | undefined\n         | ReturnType<typeof createClientRouterFilter>"
        },
        {
            "sha": "731981d125993f3891a593f25e35bb082b759cab",
            "filename": "packages/next/src/cli/next-typegen.ts",
            "status": "added",
            "additions": 137,
            "deletions": 0,
            "changes": 137,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fcli%2Fnext-typegen.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fcli%2Fnext-typegen.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcli%2Fnext-typegen.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,137 @@\n+#!/usr/bin/env node\n+\n+import { existsSync } from 'fs'\n+import { join } from 'path'\n+import { mkdir } from 'fs/promises'\n+\n+import loadConfig from '../server/config'\n+import { printAndExit } from '../server/lib/utils'\n+import { PHASE_PRODUCTION_BUILD } from '../shared/lib/constants'\n+import { getProjectDir } from '../lib/get-project-dir'\n+import { findPagesDir } from '../lib/find-pages-dir'\n+import { verifyTypeScriptSetup } from '../lib/verify-typescript-setup'\n+import {\n+  createPagesMapping,\n+  collectAppFiles,\n+  collectPagesFiles,\n+  processPageRoutes,\n+  processAppRoutes,\n+  processLayoutRoutes,\n+  extractSlotsFromAppRoutes,\n+  type RouteInfo,\n+  type SlotInfo,\n+} from '../build/entries'\n+import { PAGE_TYPES } from '../lib/page-types'\n+\n+import {\n+  createRouteTypesManifest,\n+  writeRouteTypesManifest,\n+} from '../server/lib/router-utils/route-types-utils'\n+\n+export type NextTypegenOptions = {\n+  dir?: string\n+}\n+\n+const nextTypegen = async (\n+  _options: NextTypegenOptions,\n+  directory?: string\n+) => {\n+  const baseDir = getProjectDir(directory)\n+\n+  // Check if the provided directory exists\n+  if (!existsSync(baseDir)) {\n+    printAndExit(`> No such directory exists as the project root: ${baseDir}`)\n+  }\n+\n+  const nextConfig = await loadConfig(PHASE_PRODUCTION_BUILD, baseDir)\n+  const distDir = join(baseDir, nextConfig.distDir)\n+  const { pagesDir, appDir } = findPagesDir(baseDir)\n+\n+  await verifyTypeScriptSetup({\n+    dir: baseDir,\n+    distDir: nextConfig.distDir,\n+    intentDirs: [pagesDir, appDir].filter(Boolean) as string[],\n+    typeCheckPreflight: false,\n+    tsconfigPath: nextConfig.typescript.tsconfigPath,\n+    disableStaticImages: nextConfig.images.disableStaticImages,\n+    hasAppDir: !!appDir,\n+    hasPagesDir: !!pagesDir,\n+  })\n+\n+  console.log('Generating route types...')\n+\n+  const routeTypesFilePath = join(distDir, 'types', 'routes.d.ts')\n+  await mkdir(join(distDir, 'types'), { recursive: true })\n+\n+  let pageRoutes: RouteInfo[] = []\n+  let appRoutes: RouteInfo[] = []\n+  let layoutRoutes: RouteInfo[] = []\n+  let slots: SlotInfo[] = []\n+\n+  let _pageApiRoutes: RouteInfo[] = []\n+\n+  let mappedPages: { [page: string]: string } = {}\n+  let mappedAppPages: { [page: string]: string } = {}\n+  let mappedAppLayouts: { [page: string]: string } = {}\n+\n+  // Helper function to reduce createPagesMapping duplication\n+  const createMapping = (pagePaths: string[], pagesType: any) =>\n+    createPagesMapping({\n+      pagePaths,\n+      isDev: false,\n+      pagesType,\n+      pageExtensions: nextConfig.pageExtensions,\n+      pagesDir,\n+      appDir,\n+    })\n+\n+  // Build pages routes\n+  if (pagesDir) {\n+    const pagePaths = await collectPagesFiles(\n+      pagesDir,\n+      nextConfig.pageExtensions\n+    )\n+\n+    mappedPages = await createMapping(pagePaths, PAGE_TYPES.PAGES)\n+\n+    // Process pages routes\n+    const processedPages = processPageRoutes(mappedPages, baseDir)\n+    pageRoutes = processedPages.pageRoutes\n+    _pageApiRoutes = processedPages.pageApiRoutes\n+  }\n+\n+  // Build app routes\n+  if (appDir) {\n+    // Collect both app pages and layouts in a single directory traversal\n+    const { appPaths, layoutPaths } = await collectAppFiles(\n+      appDir,\n+      nextConfig.pageExtensions\n+    )\n+\n+    mappedAppPages = await createMapping(appPaths, PAGE_TYPES.APP)\n+    mappedAppLayouts = await createMapping(layoutPaths, PAGE_TYPES.APP)\n+\n+    // Process app routes and extract slots\n+    slots = extractSlotsFromAppRoutes(mappedAppPages)\n+    appRoutes = processAppRoutes(mappedAppPages, baseDir)\n+\n+    // Process layout routes\n+    layoutRoutes = processLayoutRoutes(mappedAppLayouts, baseDir)\n+  }\n+\n+  const routeTypesManifest = await createRouteTypesManifest({\n+    dir: baseDir,\n+    pageRoutes,\n+    appRoutes,\n+    layoutRoutes,\n+    slots,\n+    redirects: nextConfig.redirects,\n+    rewrites: nextConfig.rewrites,\n+  })\n+\n+  await writeRouteTypesManifest(routeTypesManifest, routeTypesFilePath)\n+\n+  console.log('âœ“ Route types generated successfully')\n+}\n+\n+export { nextTypegen }"
        },
        {
            "sha": "85889a5c0651a89e2ab6618133ba43fc759b9817",
            "filename": "packages/next/src/lib/typescript/writeAppTypeDeclarations.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Flib%2Ftypescript%2FwriteAppTypeDeclarations.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Flib%2Ftypescript%2FwriteAppTypeDeclarations.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Ftypescript%2FwriteAppTypeDeclarations.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -4,11 +4,13 @@ import { promises as fs } from 'fs'\n \n export async function writeAppTypeDeclarations({\n   baseDir,\n+  distDir,\n   imageImportsEnabled,\n   hasPagesDir,\n   hasAppDir,\n }: {\n   baseDir: string\n+  distDir: string\n   imageImportsEnabled: boolean\n   hasPagesDir: boolean\n   hasAppDir: boolean\n@@ -55,6 +57,13 @@ export async function writeAppTypeDeclarations({\n     )\n   }\n \n+  const routeTypesPath = path.posix.join(\n+    distDir.replaceAll(path.win32.sep, path.posix.sep),\n+    'types/routes.d.ts'\n+  )\n+\n+  directives.push(`/// <reference path=\"./${routeTypesPath}\" />`)\n+\n   // Push the notice in.\n   directives.push(\n     '',"
        },
        {
            "sha": "4ca5952bbf9cc2eb59c8b38ed9732e660e6d9935",
            "filename": "packages/next/src/lib/verify-typescript-setup.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Flib%2Fverify-typescript-setup.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Flib%2Fverify-typescript-setup.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fverify-typescript-setup.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -129,6 +129,7 @@ export async function verifyTypeScriptSetup({\n     // Next.js' types:\n     await writeAppTypeDeclarations({\n       baseDir: dir,\n+      distDir,\n       imageImportsEnabled: !disableStaticImages,\n       hasPagesDir,\n       hasAppDir,"
        },
        {
            "sha": "a4504f0e4d08125a9b13c16c06e9524d260ca60a",
            "filename": "packages/next/src/server/lib/find-page-file.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Ffind-page-file.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Ffind-page-file.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Ffind-page-file.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -90,6 +90,9 @@ export function createValidFileMatcher(\n       pageExtensions\n     )}$`\n   )\n+  const leafOnlyLayoutFileRegex = new RegExp(\n+    `(^(layout)|[\\\\\\\\/](layout))\\\\.${getExtensionRegexString(pageExtensions)}$`\n+  )\n   const rootNotFoundFileRegex = new RegExp(\n     `^not-found\\\\.${getExtensionRegexString(pageExtensions)}$`\n   )\n@@ -123,6 +126,10 @@ export function createValidFileMatcher(\n     return leafOnlyPageFileRegex.test(filePath) || isMetadataFile(filePath)\n   }\n \n+  function isAppLayoutPage(filePath: string) {\n+    return leafOnlyLayoutFileRegex.test(filePath)\n+  }\n+\n   function isPageFile(filePath: string) {\n     return validExtensionFileRegex.test(filePath) || isMetadataFile(filePath)\n   }\n@@ -141,6 +148,7 @@ export function createValidFileMatcher(\n   return {\n     isPageFile,\n     isAppRouterPage,\n+    isAppLayoutPage,\n     isMetadataFile,\n     isRootNotFound,\n   }"
        },
        {
            "sha": "d7404a4cec0824ae7305c1f08835c57e52123847",
            "filename": "packages/next/src/server/lib/router-utils/route-types-utils.ts",
            "status": "added",
            "additions": 212,
            "deletions": 0,
            "changes": 212,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Froute-types-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Froute-types-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Froute-types-utils.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,212 @@\n+import path from 'path'\n+import {\n+  getRouteRegex,\n+  type Group,\n+} from '../../../shared/lib/router/utils/route-regex'\n+import type { NextConfigComplete } from '../../config-shared'\n+import { isParallelRouteSegment } from '../../../shared/lib/segment'\n+import fs from 'fs'\n+import { generateRouteTypesFile } from './typegen'\n+import { tryToParsePath } from '../../../lib/try-to-parse-path'\n+\n+interface RouteInfo {\n+  path: string\n+  groups: { [groupName: string]: Group }\n+}\n+\n+export interface RouteTypesManifest {\n+  appRoutes: Record<string, RouteInfo>\n+  pageRoutes: Record<string, RouteInfo>\n+  layoutRoutes: Record<string, RouteInfo & { slots: string[] }>\n+  /** Map of redirect source => RouteInfo */\n+  redirectRoutes: Record<string, RouteInfo>\n+  /** Map of rewrite source => RouteInfo */\n+  rewriteRoutes: Record<string, RouteInfo>\n+}\n+\n+// Convert a custom-route source string (`/blog/:slug`, `/docs/:path*`, ...)\n+// into the bracket-syntax used by other Next.js route helpers so that we can\n+// reuse `getRouteRegex()` to extract groups.\n+export function convertCustomRouteSource(source: string): string {\n+  const parseResult = tryToParsePath(source)\n+\n+  if (parseResult.error || !parseResult.tokens) {\n+    // Fallback to original source if parsing fails\n+    return source.startsWith('/') ? source : '/' + source\n+  }\n+\n+  let result = ''\n+\n+  for (const token of parseResult.tokens) {\n+    if (typeof token === 'string') {\n+      // Literal path segment\n+      result += token\n+    } else {\n+      // Parameter token\n+      const { name, modifier, prefix } = token\n+\n+      // Add the prefix (usually '/')\n+      result += prefix\n+\n+      if (modifier === '*') {\n+        // Catch-all zero or more: :param* -> [[...param]]\n+        result += `[[...${name}]]`\n+      } else if (modifier === '+') {\n+        // Catch-all one or more: :param+ -> [...param]\n+        result += `[...${name}]`\n+      } else if (modifier === '?') {\n+        // Optional catch-all: :param? -> [[...param]]\n+        result += `[[...${name}]]`\n+      } else {\n+        // Standard dynamic segment: :param -> [param]\n+        result += `[${name}]`\n+      }\n+    }\n+  }\n+\n+  // Ensure leading slash\n+  if (!result.startsWith('/')) result = '/' + result\n+  return result\n+}\n+\n+/**\n+ * Extracts route parameters from a route pattern\n+ */\n+export function extractRouteParams(route: string) {\n+  const regex = getRouteRegex(route)\n+  return regex.groups\n+}\n+\n+function isCanonicalRoute(route: string) {\n+  const segments = route.split('/')\n+  for (let i = segments.length - 1; i >= 0; i--) {\n+    const segment = segments[i]\n+\n+    if (\n+      isParallelRouteSegment(segment) ||\n+      segment.startsWith('(.)') ||\n+      segment.startsWith('(..)') ||\n+      segment.startsWith('(...)')\n+    ) {\n+      return false\n+    }\n+  }\n+\n+  return true\n+}\n+\n+/**\n+ * Creates a route types manifest from processed route data\n+ * (used for both build and dev)\n+ */\n+export async function createRouteTypesManifest({\n+  dir,\n+  pageRoutes,\n+  appRoutes,\n+  layoutRoutes,\n+  slots,\n+  redirects,\n+  rewrites,\n+}: {\n+  dir: string\n+  pageRoutes: Array<{ route: string; filePath: string }>\n+  appRoutes: Array<{ route: string; filePath: string }>\n+  layoutRoutes: Array<{ route: string; filePath: string }>\n+  slots: Array<{ name: string; parent: string }>\n+  redirects?: NextConfigComplete['redirects']\n+  rewrites?: NextConfigComplete['rewrites']\n+}): Promise<RouteTypesManifest> {\n+  const manifest: RouteTypesManifest = {\n+    appRoutes: {},\n+    pageRoutes: {},\n+    layoutRoutes: {},\n+    redirectRoutes: {},\n+    rewriteRoutes: {},\n+  }\n+\n+  // Process page routes\n+  for (const { route, filePath } of pageRoutes) {\n+    manifest.pageRoutes[route] = {\n+      path: path.relative(dir, filePath),\n+      groups: extractRouteParams(route),\n+    }\n+  }\n+\n+  // Process layout routes\n+  for (const { route, filePath } of layoutRoutes) {\n+    if (!isCanonicalRoute(route)) continue\n+\n+    manifest.layoutRoutes[route] = {\n+      path: path.relative(dir, filePath),\n+      groups: extractRouteParams(route),\n+      slots: [],\n+    }\n+  }\n+\n+  // Process slots\n+  for (const slot of slots) {\n+    if (manifest.layoutRoutes[slot.parent]) {\n+      manifest.layoutRoutes[slot.parent].slots.push(slot.name)\n+    }\n+  }\n+\n+  // Process app routes\n+  for (const { route, filePath } of appRoutes) {\n+    if (!isCanonicalRoute(route)) continue\n+\n+    manifest.appRoutes[route] = {\n+      path: path.relative(dir, filePath),\n+      groups: extractRouteParams(route),\n+    }\n+  }\n+\n+  // Process redirects\n+  if (typeof redirects === 'function') {\n+    const rd = await redirects()\n+\n+    for (const item of rd) {\n+      const source = convertCustomRouteSource(item.source)\n+\n+      manifest.redirectRoutes[source] = {\n+        path: source,\n+        groups: extractRouteParams(source),\n+      }\n+    }\n+  }\n+\n+  // Process rewrites\n+  if (typeof rewrites === 'function') {\n+    const rw = await rewrites()\n+\n+    const allSources = Array.isArray(rw)\n+      ? rw\n+      : [\n+          ...(rw?.beforeFiles || []),\n+          ...(rw?.afterFiles || []),\n+          ...(rw?.fallback || []),\n+        ]\n+\n+    for (const item of allSources) {\n+      const source = convertCustomRouteSource(item.source)\n+      manifest.rewriteRoutes[source] = {\n+        path: source,\n+        groups: extractRouteParams(source),\n+      }\n+    }\n+  }\n+\n+  return manifest\n+}\n+\n+export async function writeRouteTypesManifest(\n+  manifest: RouteTypesManifest,\n+  filePath: string\n+) {\n+  const dirname = path.dirname(filePath)\n+\n+  if (!fs.existsSync(dirname)) {\n+    await fs.promises.mkdir(dirname, { recursive: true })\n+  }\n+\n+  await fs.promises.writeFile(filePath, generateRouteTypesFile(manifest))\n+}"
        },
        {
            "sha": "20a9c98890155228c77955c24f3e1dd1ff3f0ced",
            "filename": "packages/next/src/server/lib/router-utils/setup-dev-bundler.ts",
            "status": "modified",
            "additions": 104,
            "deletions": 17,
            "changes": 121,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -12,7 +12,6 @@ import type { NextJsHotReloaderInterface } from '../../dev/hot-reloader-types'\n \n import { createDefineEnv } from '../../../build/swc'\n import fs from 'fs'\n-import { mkdir } from 'fs/promises'\n import url from 'url'\n import path from 'path'\n import qs from 'querystring'\n@@ -85,6 +84,12 @@ import { getDefineEnv } from '../../../build/define-env'\n import { TurbopackInternalError } from '../../../shared/lib/turbopack/internal-error'\n import { normalizePath } from '../../../lib/normalize-path'\n import { JSON_CONTENT_TYPE_HEADER } from '../../../lib/constants'\n+import {\n+  createRouteTypesManifest,\n+  writeRouteTypesManifest,\n+} from './route-types-utils'\n+import { isParallelRouteSegment } from '../../../shared/lib/segment'\n+import { ensureLeadingSlash } from '../../../shared/lib/page-path/ensure-leading-slash'\n \n export type SetupOpts = {\n   renderServer: LazyRenderServerInstance\n@@ -167,18 +172,9 @@ async function startWatcher(\n ) {\n   const { nextConfig, appDir, pagesDir, dir, resetFetch } = opts\n   const { useFileSystemPublicRoutes } = nextConfig\n-  const usingTypeScript = await verifyTypeScript(opts)\n \n   const distDir = path.join(opts.dir, opts.nextConfig.distDir)\n \n-  // we ensure the types directory exists here\n-  if (usingTypeScript) {\n-    const distTypesDir = path.join(distDir, 'types')\n-    if (!fs.existsSync(distTypesDir)) {\n-      await mkdir(distTypesDir, { recursive: true })\n-    }\n-  }\n-\n   setGlobal('distDir', distDir)\n   setGlobal('phase', PHASE_DEVELOPMENT_SERVER)\n \n@@ -217,6 +213,20 @@ async function startWatcher(\n \n   // have to write this after starting hot-reloader since that\n   // cleans the dist dir\n+  const distTypesDir = path.join(distDir, 'types')\n+  await writeRouteTypesManifest(\n+    {\n+      appRoutes: {},\n+      pageRoutes: {},\n+      layoutRoutes: {},\n+      redirectRoutes: {},\n+      rewriteRoutes: {},\n+    },\n+    path.join(distTypesDir, 'routes.d.ts')\n+  )\n+\n+  const usingTypeScript = await verifyTypeScript(opts)\n+\n   const routesManifestPath = path.join(distDir, ROUTES_MANIFEST)\n   const routesManifest: DevRoutesManifest = {\n     version: 3,\n@@ -323,6 +333,8 @@ async function startWatcher(\n     let previousClientRouterFilters: any\n     let previousConflictingPagePaths: Set<string> = new Set()\n \n+    const routeTypesFilePath = path.join(distDir, 'types', 'routes.d.ts')\n+\n     wp.on('aggregated', async () => {\n       let middlewareMatchers: MiddlewareMatcher[] | undefined\n       const routedPages: string[] = []\n@@ -333,6 +345,11 @@ async function startWatcher(\n       const appPageFilePaths = new Map<string, string>()\n       const pagesPageFilePaths = new Map<string, string>()\n \n+      const pageRoutes: Array<{ route: string; filePath: string }> = []\n+      const appRoutes: Array<{ route: string; filePath: string }> = []\n+      const layoutRoutes: Array<{ route: string; filePath: string }> = []\n+      const slots: Array<{ name: string; parent: string }> = []\n+\n       let envChange = false\n       let tsconfigChange = false\n       let conflictingPageChange = 0\n@@ -504,14 +521,57 @@ async function startWatcher(\n           if (isRootNotFound) {\n             continue\n           }\n-          if (!isRootNotFound && !validFileMatcher.isAppRouterPage(fileName)) {\n-            continue\n-          }\n+\n           // Ignore files/directories starting with `_` in the app directory\n           if (normalizePathSep(pageName).includes('/_')) {\n             continue\n           }\n \n+          // Record parallel route slots for layout typing\n+          // May run multiple times (e.g. if a parallel route\n+          // has both a layout and a page, and children) but that's fine\n+          const segments = normalizePathSep(pageName).split('/')\n+          for (let i = segments.length - 1; i >= 0; i--) {\n+            const segment = segments[i]\n+            if (isParallelRouteSegment(segment)) {\n+              const parentPath = normalizeAppPath(\n+                segments.slice(0, i).join('/')\n+              )\n+\n+              const slotName = segment.slice(1)\n+              // check if the slot already exists\n+              if (\n+                slots.some(\n+                  (s) => s.name === slotName && s.parent === parentPath\n+                )\n+              )\n+                continue\n+\n+              slots.push({\n+                name: slotName,\n+                parent: parentPath,\n+              })\n+              break\n+            }\n+          }\n+\n+          // Record layouts\n+          if (validFileMatcher.isAppLayoutPage(fileName)) {\n+            layoutRoutes.push({\n+              route: ensureLeadingSlash(\n+                normalizeAppPath(normalizePathSep(pageName)).replace(\n+                  /\\/layout$/,\n+                  ''\n+                )\n+              ),\n+              filePath: fileName,\n+            })\n+          }\n+\n+          if (!validFileMatcher.isAppRouterPage(fileName)) {\n+            continue\n+          }\n+\n           const originalPageName = pageName\n           pageName = normalizeAppPath(pageName).replace(/%5F/g, '_')\n           if (!appPaths[pageName]) {\n@@ -528,6 +588,11 @@ async function startWatcher(\n             appFiles.add(pageName)\n           }\n \n+          appRoutes.push({\n+            route: normalizePathSep(pageName),\n+            filePath: fileName,\n+          })\n+\n           if (routedPages.includes(pageName)) {\n             continue\n           }\n@@ -538,11 +603,19 @@ async function startWatcher(\n             // entries that actually use getStaticProps/getServerSideProps\n             opts.fsChecker.nextDataRoutes.add(pageName)\n           }\n+\n+          pageRoutes.push({\n+            route: normalizePathSep(pageName),\n+            filePath: fileName,\n+          })\n+        }\n+\n+        // Record pages\n+        if (isAppPath) {\n+          appPageFilePaths.set(pageName, fileName)\n+        } else {\n+          pagesPageFilePaths.set(pageName, fileName)\n         }\n-        ;(isAppPath ? appPageFilePaths : pagesPageFilePaths).set(\n-          pageName,\n-          fileName\n-        )\n \n         if (appDir && pageNameSet.has(pageName)) {\n           conflictingAppPagePaths.add(pageName)\n@@ -939,6 +1012,20 @@ async function startWatcher(\n         }\n         prevSortedRoutes = sortedRoutes\n \n+        if (usingTypeScript) {\n+          const routeTypesManifest = await createRouteTypesManifest({\n+            dir,\n+            pageRoutes,\n+            appRoutes,\n+            layoutRoutes,\n+            slots,\n+            redirects: opts.nextConfig.redirects,\n+            rewrites: opts.nextConfig.rewrites,\n+          })\n+\n+          await writeRouteTypesManifest(routeTypesManifest, routeTypesFilePath)\n+        }\n+\n         if (!resolved) {\n           resolve()\n           resolved = true"
        },
        {
            "sha": "7d598757f924d354d1014cf84ff78d339cf4cc7c",
            "filename": "packages/next/src/server/lib/router-utils/typegen.ts",
            "status": "added",
            "additions": 192,
            "deletions": 0,
            "changes": 192,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,192 @@\n+import type { RouteTypesManifest } from './route-types-utils'\n+import { isDynamicRoute } from '../../../shared/lib/router/utils/is-dynamic'\n+\n+function generateRouteTypes(routesManifest: RouteTypesManifest): string {\n+  const appRoutes = Object.keys(routesManifest.appRoutes).sort()\n+  const pageRoutes = Object.keys(routesManifest.pageRoutes).sort()\n+  const layoutRoutes = Object.keys(routesManifest.layoutRoutes).sort()\n+  const redirectRoutes = Object.keys(routesManifest.redirectRoutes).sort()\n+  const rewriteRoutes = Object.keys(routesManifest.rewriteRoutes).sort()\n+\n+  let result = ''\n+\n+  // Generate AppRoutes union type\n+  if (appRoutes.length > 0) {\n+    result += `type AppRoutes = ${appRoutes.map((route) => JSON.stringify(route)).join(' | ')}\\n`\n+  } else {\n+    result += 'type AppRoutes = never\\n'\n+  }\n+\n+  // Generate PageRoutes union type\n+  if (pageRoutes.length > 0) {\n+    result += `type PageRoutes = ${pageRoutes.map((route) => JSON.stringify(route)).join(' | ')}\\n`\n+  } else {\n+    result += 'type PageRoutes = never\\n'\n+  }\n+\n+  // Generate LayoutRoutes union type\n+  if (layoutRoutes.length > 0) {\n+    result += `type LayoutRoutes = ${layoutRoutes.map((route) => JSON.stringify(route)).join(' | ')}\\n`\n+  } else {\n+    result += 'type LayoutRoutes = never\\n'\n+  }\n+\n+  // Generate RedirectRoutes union type\n+  if (redirectRoutes.length > 0) {\n+    result += `type RedirectRoutes = ${redirectRoutes\n+      .map((route) => JSON.stringify(route))\n+      .join(' | ')}\\n`\n+  } else {\n+    result += 'type RedirectRoutes = never\\n'\n+  }\n+\n+  // Generate RewriteRoutes union type\n+  if (rewriteRoutes.length > 0) {\n+    result += `type RewriteRoutes = ${rewriteRoutes\n+      .map((route) => JSON.stringify(route))\n+      .join(' | ')}\\n`\n+  } else {\n+    result += 'type RewriteRoutes = never\\n'\n+  }\n+\n+  result +=\n+    'type Routes = AppRoutes | PageRoutes | LayoutRoutes | RedirectRoutes | RewriteRoutes\\n'\n+\n+  return result\n+}\n+\n+function generateParamTypes(routesManifest: RouteTypesManifest): string {\n+  const allRoutes = {\n+    ...routesManifest.appRoutes,\n+    ...routesManifest.pageRoutes,\n+    ...routesManifest.layoutRoutes,\n+    ...routesManifest.redirectRoutes,\n+    ...routesManifest.rewriteRoutes,\n+  }\n+\n+  let paramTypes = 'interface ParamMap {\\n'\n+\n+  // Sort routes deterministically for consistent output\n+  const sortedRoutes = Object.entries(allRoutes).sort(([a], [b]) =>\n+    a.localeCompare(b)\n+  )\n+\n+  for (const [route, routeInfo] of sortedRoutes) {\n+    const { groups } = routeInfo\n+\n+    // For static routes (no dynamic segments), we can produce an empty parameter map.\n+    if (!isDynamicRoute(route) || Object.keys(groups ?? {}).length === 0) {\n+      paramTypes += `  ${JSON.stringify(route)}: {}\\n`\n+      continue\n+    }\n+\n+    let paramType = '{'\n+\n+    // Process each group based on its properties\n+    for (const [key, group] of Object.entries(groups)) {\n+      const escapedKey = JSON.stringify(key)\n+      if (group.repeat) {\n+        // Catch-all parameters\n+        if (group.optional) {\n+          paramType += ` ${escapedKey}?: string[];`\n+        } else {\n+          paramType += ` ${escapedKey}: string[];`\n+        }\n+      } else {\n+        // Regular parameters\n+        if (group.optional) {\n+          paramType += ` ${escapedKey}?: string;`\n+        } else {\n+          paramType += ` ${escapedKey}: string;`\n+        }\n+      }\n+    }\n+\n+    paramType += ' }'\n+\n+    paramTypes += `  ${JSON.stringify(route)}: ${paramType}\\n`\n+  }\n+\n+  paramTypes += '}\\n'\n+  return paramTypes\n+}\n+\n+function generateLayoutSlotMap(routesManifest: RouteTypesManifest): string {\n+  let slotMap = 'interface LayoutSlotMap {\\n'\n+\n+  // Sort routes deterministically for consistent output\n+  const sortedLayoutRoutes = Object.entries(routesManifest.layoutRoutes).sort(\n+    ([a], [b]) => a.localeCompare(b)\n+  )\n+\n+  for (const [route, routeInfo] of sortedLayoutRoutes) {\n+    if ('slots' in routeInfo) {\n+      const slots = routeInfo.slots.sort()\n+      if (slots.length > 0) {\n+        slotMap += `  ${JSON.stringify(route)}: ${slots.map((slot) => JSON.stringify(slot)).join(' | ')}\\n`\n+      } else {\n+        slotMap += `  ${JSON.stringify(route)}: never\\n`\n+      }\n+    } else {\n+      slotMap += `  ${JSON.stringify(route)}: never\\n`\n+    }\n+  }\n+\n+  slotMap += '}\\n'\n+  return slotMap\n+}\n+\n+export function generateRouteTypesFile(\n+  routesManifest: RouteTypesManifest\n+): string {\n+  const routeTypes = generateRouteTypes(routesManifest)\n+  const paramTypes = generateParamTypes(routesManifest)\n+  const layoutSlotMap = generateLayoutSlotMap(routesManifest)\n+\n+  return `// This file is generated automatically by Next.js\n+// Do not edit this file manually\n+\n+${routeTypes}\n+\n+${paramTypes}\n+\n+export type ParamsOf<Route extends Routes> = ParamMap[Route]\n+\n+${layoutSlotMap}\n+\n+export type { AppRoutes, PageRoutes, LayoutRoutes, RedirectRoutes, RewriteRoutes }\n+\n+declare global {\n+  /**\n+   * Props for Next.js App Router page components\n+   * @example\n+   * \\`\\`\\`tsx\n+   * export default function Page(props: PageProps<'/blog/[slug]'>) {\n+   *   const { slug } = await props.params\n+   *   return <div>Blog post: {slug}</div>\n+   * }\n+   * \\`\\`\\`\n+   */\n+  interface PageProps<AppRoute extends AppRoutes> {\n+    params: Promise<ParamMap[AppRoute]>\n+    searchParams: Promise<Record<string, string | string[] | undefined>>\n+  }\n+  \n+  /**\n+   * Props for Next.js App Router layout components\n+   * @example\n+   * \\`\\`\\`tsx\n+   * export default function Layout(props: LayoutProps<'/dashboard'>) {\n+   *   return <div>{props.children}</div>\n+   * }\n+   * \\`\\`\\`\n+   */\n+  type LayoutProps<LayoutRoute extends LayoutRoutes> = {\n+    params: Promise<ParamMap[LayoutRoute]>\n+    children: React.ReactNode\n+  } & {\n+    [K in LayoutSlotMap[LayoutRoute]]: React.ReactNode\n+  }\n+}\n+`\n+}"
        },
        {
            "sha": "bdc8001867a1ec1faaf7bd250698ca0853ab764d",
            "filename": "test/e2e/app-dir/typed-routes/app/%5Fshop/[[...category]]/page.tsx",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F%255Fshop%2F%5B%5B...category%5D%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F%255Fshop%2F%5B%5B...category%5D%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F%255Fshop%2F%5B%5B...category%5D%5D%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,4 @@\n+export default async function Page(props: PageProps<'/_shop/[[...category]]'>) {\n+  const { category } = await props.params\n+  return <p>shop {category?.join('/')}</p>\n+}"
        },
        {
            "sha": "6b03c3fdef7326902d9cb6a06f23ce09bc25dfbb",
            "filename": "test/e2e/app-dir/typed-routes/app/(logged-in)/layout.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F(logged-in)%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F(logged-in)%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F(logged-in)%2Flayout.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Layout({ children }: LayoutProps<'/'>) {\n+  return <div>{children}</div>\n+}"
        },
        {
            "sha": "853c876c4350433d3b3f42c1553a6a8fbea7f965",
            "filename": "test/e2e/app-dir/typed-routes/app/(logged-in)/project/[slug]/page.tsx",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F(logged-in)%2Fproject%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F(logged-in)%2Fproject%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F(logged-in)%2Fproject%2F%5Bslug%5D%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,4 @@\n+export default async function Page(props: PageProps<'/project/[slug]'>) {\n+  const { slug } = await props.params\n+  return <p>project {slug}</p>\n+}"
        },
        {
            "sha": "fb40728043bae29915e9c6c2d0a492c9251780c0",
            "filename": "test/e2e/app-dir/typed-routes/app/_hidden/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F_hidden%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F_hidden%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2F_hidden%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <div>hidden</div>\n+}"
        },
        {
            "sha": "b4f54c912ac85f130097129f0045b3f6c1cd4d1c",
            "filename": "test/e2e/app-dir/typed-routes/app/dashboard/@analytics/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40analytics%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40analytics%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40analytics%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page(props: PageProps<'/dashboard'>) {\n+  return <p>analytics</p>\n+}"
        },
        {
            "sha": "52c4e67e7def3a4939dbd3481afc2a066a238ad7",
            "filename": "test/e2e/app-dir/typed-routes/app/dashboard/@analytics/settings/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40analytics%2Fsettings%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40analytics%2Fsettings%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40analytics%2Fsettings%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page(props: PageProps<'/dashboard/settings'>) {\n+  return <p>analytics settings</p>\n+}"
        },
        {
            "sha": "b2861bd24abd8fffbcf12c605dcbaff52887ade5",
            "filename": "test/e2e/app-dir/typed-routes/app/dashboard/@team/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40team%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40team%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40team%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page(props: PageProps<'/dashboard'>) {\n+  return <p>team</p>\n+}"
        },
        {
            "sha": "736a198567dc49b5f2c68851f2785db22c56cc7b",
            "filename": "test/e2e/app-dir/typed-routes/app/dashboard/@team/settings/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40team%2Fsettings%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40team%2Fsettings%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2F%40team%2Fsettings%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page(props: PageProps<'/dashboard/settings'>) {\n+  return <p>team settings</p>\n+}"
        },
        {
            "sha": "630e5307e0bff3e6b54ba7ce5fab733906031adb",
            "filename": "test/e2e/app-dir/typed-routes/app/dashboard/layout.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2Flayout.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,12 @@\n+export default async function Layout(props: LayoutProps<'/dashboard'>) {\n+  const { analytics, team, children } = props\n+\n+  return (\n+    <div>\n+      <div>dashboard layout</div>\n+      <div>{analytics}</div>\n+      <div>{team}</div>\n+      <div>{children}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "b4f54c912ac85f130097129f0045b3f6c1cd4d1c",
            "filename": "test/e2e/app-dir/typed-routes/app/dashboard/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page(props: PageProps<'/dashboard'>) {\n+  return <p>analytics</p>\n+}"
        },
        {
            "sha": "0db423a7e6ac38d7da96c368abc766427923dc22",
            "filename": "test/e2e/app-dir/typed-routes/app/dashboard/settings/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2Fsettings%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2Fsettings%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdashboard%2Fsettings%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page(props: PageProps<'/dashboard/settings'>) {\n+  return <p>dashboard settings</p>\n+}"
        },
        {
            "sha": "98aa53d213ec3d79f629d1035d45bd77104c1f0b",
            "filename": "test/e2e/app-dir/typed-routes/app/docs/[...slug]/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdocs%2F%5B...slug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdocs%2F%5B...slug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fdocs%2F%5B...slug%5D%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,5 @@\n+export default async function Page(props: PageProps<'/docs/[...slug]'>) {\n+  const { slug } = await props.params\n+\n+  return <p>docs {slug.join('/')}</p>\n+}"
        },
        {
            "sha": "7a91e13b9c2d674b0e5b68a02d8e52b126e339f5",
            "filename": "test/e2e/app-dir/typed-routes/app/gallery/photo/[id]/page.tsx",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fgallery%2Fphoto%2F%5Bid%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fgallery%2Fphoto%2F%5Bid%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fgallery%2Fphoto%2F%5Bid%5D%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,4 @@\n+export default async function Page(props: PageProps<'/gallery/photo/[id]'>) {\n+  const { id } = await props.params\n+  return <p>photo {id}</p>\n+}"
        },
        {
            "sha": "b1fc39952207d71026fdd4b976b032126efe1899",
            "filename": "test/e2e/app-dir/typed-routes/app/gallery/test/(..)photo/[id]/page.tsx",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fgallery%2Ftest%2F(..)photo%2F%5Bid%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fgallery%2Ftest%2F(..)photo%2F%5Bid%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fgallery%2Ftest%2F(..)photo%2F%5Bid%5D%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,4 @@\n+export default async function Page(props: PageProps<'/gallery/photo/[id]'>) {\n+  const { id } = await props.params\n+  return <p>intercepted photo {id}</p>\n+}"
        },
        {
            "sha": "3650d2edec58fe1b75288b57bb75b391fe6e4b7d",
            "filename": "test/e2e/app-dir/typed-routes/app/layout.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Flayout.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,11 @@\n+import { Suspense } from 'react'\n+\n+export default function Root(props: LayoutProps<'/'>) {\n+  return (\n+    <html>\n+      <body>\n+        <Suspense>{props.children}</Suspense>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/e2e/app-dir/typed-routes/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fpage.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "7fbfbf39345f0340bbaae080c511891cdff13430",
            "filename": "test/e2e/app-dir/typed-routes/app/type-testing.ts",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Ftype-testing.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Ftype-testing.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Ftype-testing.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,4 @@\n+/* eslint-disable @typescript-eslint/no-unused-vars */\n+\n+type ValidPage = PageProps<'/dashboard'>\n+// type InvalidPage = PageProps<'/dasboard'>"
        },
        {
            "sha": "b86b33297d682dbd003fa223d86d82b47854af10",
            "filename": "test/e2e/app-dir/typed-routes/next.config.js",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fnext.config.js?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,42 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  async redirects() {\n+    return [\n+      {\n+        source: '/project/:slug',\n+        destination: '/project/:slug',\n+        permanent: true,\n+      },\n+      {\n+        source: '/blog/:category/:slug*',\n+        destination: '/posts/:category/:slug*',\n+        permanent: false,\n+      },\n+      {\n+        source: '/optional/:param?',\n+        destination: '/fallback',\n+        permanent: false,\n+      },\n+    ]\n+  },\n+  async rewrites() {\n+    return {\n+      beforeFiles: [],\n+      afterFiles: [\n+        {\n+          source: '/docs-old/:path+',\n+          destination: '/docs/:path+',\n+        },\n+        {\n+          source: '/api-legacy/:version/:endpoint*',\n+          destination: '/api/:version/:endpoint*',\n+        },\n+      ],\n+      fallback: [],\n+    }\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "519e595f226f584a863a7ff31fb7fee2a6620056",
            "filename": "test/e2e/app-dir/typed-routes/pages/about.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fpages%2Fabout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fpages%2Fabout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fpages%2Fabout.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function AboutPage() {\n+  return <div>About Page</div>\n+}"
        },
        {
            "sha": "c9b236af032571d14bb7f4ca539a16fc6abca712",
            "filename": "test/e2e/app-dir/typed-routes/pages/users/[id].tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fpages%2Fusers%2F%5Bid%5D.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fpages%2Fusers%2F%5Bid%5D.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fpages%2Fusers%2F%5Bid%5D.tsx?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,11 @@\n+export default function UserPage({ id }: { id: string }) {\n+  return <div>User: {id}</div>\n+}\n+\n+export async function getServerSideProps({ query }: { query: { id: string } }) {\n+  return {\n+    props: {\n+      id: query.id,\n+    },\n+  }\n+}"
        },
        {
            "sha": "faadb1cf30287a7d7bac6653099dc468895657c5",
            "filename": "test/e2e/app-dir/typed-routes/typed-routes.test.ts",
            "status": "added",
            "additions": 80,
            "deletions": 0,
            "changes": 80,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-routes.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-routes.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-routes.test.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -0,0 +1,80 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+const expectedDts = `\n+type AppRoutes = \"/\" | \"/_shop/[[...category]]\" | \"/dashboard\" | \"/dashboard/settings\" | \"/docs/[...slug]\" | \"/gallery/photo/[id]\" | \"/project/[slug]\"\n+type PageRoutes = \"/about\" | \"/users/[id]\"\n+type LayoutRoutes = \"/\" | \"/dashboard\"\n+type RedirectRoutes = \"/blog/[category]/[[...slug]]\" | \"/optional/[[...param]]\" | \"/project/[slug]\"\n+type RewriteRoutes = \"/api-legacy/[version]/[[...endpoint]]\" | \"/docs-old/[...path]\"\n+type Routes = AppRoutes | PageRoutes | LayoutRoutes | RedirectRoutes | RewriteRoutes\n+`\n+\n+describe('typed-routes', () => {\n+  const { next, isNextDev, isNextStart, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  it('should generate route types correctly', async () => {\n+    const dts = await next.readFile('.next/types/routes.d.ts')\n+    expect(dts).toContain(expectedDts)\n+  })\n+\n+  it('should correctly convert custom route patterns from path-to-regexp to bracket syntax', async () => {\n+    const dts = await next.readFile('.next/types/routes.d.ts')\n+\n+    // Test standard dynamic segment: :slug -> [slug]\n+    expect(dts).toContain('\"/project/[slug]\"')\n+\n+    // Test catch-all one-or-more: :path+ -> [...path]\n+    expect(dts).toContain('\"/docs-old/[...path]\"')\n+\n+    // Test catch-all zero-or-more: :slug* -> [[...slug]]\n+    expect(dts).toContain('\"/blog/[category]/[[...slug]]\"')\n+    expect(dts).toContain('\"/api-legacy/[version]/[[...endpoint]]\"')\n+\n+    // Test optional parameter: :param? -> [[...param]]\n+    expect(dts).toContain('\"/optional/[[...param]]\"')\n+  })\n+\n+  if (isNextDev) {\n+    it('should update route types file when routes change', async () => {\n+      // Create a new layout file\n+      await next.patchFile(\n+        'app/new-layout/layout.tsx',\n+        `\n+      export default function NewLayout() {\n+        return <div>New Layout</div>\n+      }\n+    `\n+      )\n+\n+      const routeTypesContent = await next.readFile('.next/types/routes.d.ts')\n+\n+      expect(routeTypesContent).toContain(\n+        'type LayoutRoutes = \"/\" | \"/dashboard\" | \"/new-layout\"'\n+      )\n+    })\n+  }\n+\n+  if (isNextStart) {\n+    it('should throw type errors', async () => {\n+      await next.stop()\n+      await next.patchFile(\n+        'app/type-testing.ts',\n+        `type ValidPage = PageProps<'/dashboard'>\n+type InvalidPage = PageProps<'/dasboard'>`\n+      )\n+\n+      const { cliOutput } = await next.build()\n+\n+      expect(cliOutput).toContain(\n+        `Type '\"/dasboard\"' does not satisfy the constraint 'AppRoutes'.`\n+      )\n+    })\n+  }\n+})"
        },
        {
            "sha": "254b73c165d9020f2076dc5a74c24bc346e26a2b",
            "filename": "test/integration/typescript-app-type-declarations/next-env.d.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fintegration%2Ftypescript-app-type-declarations%2Fnext-env.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Fintegration%2Ftypescript-app-type-declarations%2Fnext-env.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Ftypescript-app-type-declarations%2Fnext-env.d.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -1,5 +1,6 @@\n /// <reference types=\"next\" />\n /// <reference types=\"next/image-types/global\" />\n+/// <reference path=\"./.next/types/routes.d.ts\" />\n \n // NOTE: This file should not be edited\n // see https://nextjs.org/docs/pages/api-reference/config/typescript for more information."
        },
        {
            "sha": "9a3ac75161f20a859f8bc7f91011fb2863695791",
            "filename": "test/unit/write-app-declarations.test.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Funit%2Fwrite-app-declarations.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/03c8e5d0cb5e6ea8f0494197535e060e42b993b0/test%2Funit%2Fwrite-app-declarations.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Funit%2Fwrite-app-declarations.test.ts?ref=03c8e5d0cb5e6ea8f0494197535e060e42b993b0",
            "patch": "@@ -22,6 +22,8 @@ describe('find config', () => {\n       (imageImportsEnabled\n         ? '/// <reference types=\"next/image-types/global\" />' + eol\n         : '') +\n+      '/// <reference path=\"./.next/types/routes.d.ts\" />' +\n+      eol +\n       eol +\n       '// NOTE: This file should not be edited' +\n       eol +\n@@ -32,6 +34,7 @@ describe('find config', () => {\n \n     await writeAppTypeDeclarations({\n       baseDir: fixtureDir,\n+      distDir: '.next',\n       imageImportsEnabled,\n       hasPagesDir: false,\n       hasAppDir: false,\n@@ -47,6 +50,8 @@ describe('find config', () => {\n       (imageImportsEnabled\n         ? '/// <reference types=\"next/image-types/global\" />' + eol\n         : '') +\n+      '/// <reference path=\"./.next/types/routes.d.ts\" />' +\n+      eol +\n       eol +\n       '// NOTE: This file should not be edited' +\n       eol +\n@@ -57,6 +62,7 @@ describe('find config', () => {\n \n     await writeAppTypeDeclarations({\n       baseDir: fixtureDir,\n+      distDir: '.next',\n       imageImportsEnabled,\n       hasPagesDir: false,\n       hasAppDir: false,\n@@ -72,6 +78,8 @@ describe('find config', () => {\n       (imageImportsEnabled\n         ? '/// <reference types=\"next/image-types/global\" />' + eol\n         : '') +\n+      '/// <reference path=\"./.next/types/routes.d.ts\" />' +\n+      eol +\n       eol +\n       '// NOTE: This file should not be edited' +\n       eol +\n@@ -80,6 +88,7 @@ describe('find config', () => {\n \n     await writeAppTypeDeclarations({\n       baseDir: fixtureDir,\n+      distDir: '.next',\n       imageImportsEnabled,\n       hasPagesDir: false,\n       hasAppDir: false,\n@@ -90,6 +99,7 @@ describe('find config', () => {\n   it('should include navigation types if app directory is enabled', async () => {\n     await writeAppTypeDeclarations({\n       baseDir: fixtureDir,\n+      distDir: '.next',\n       imageImportsEnabled,\n       hasPagesDir: false,\n       hasAppDir: true,\n@@ -101,6 +111,7 @@ describe('find config', () => {\n \n     await writeAppTypeDeclarations({\n       baseDir: fixtureDir,\n+      distDir: '.next',\n       imageImportsEnabled,\n       hasPagesDir: true,\n       hasAppDir: true,"
        }
    ],
    "stats": {
        "total": 1257,
        "additions": 1220,
        "deletions": 37
    }
}