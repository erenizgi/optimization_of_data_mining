{
    "author": "bgw",
    "message": "Turbopack: Update `jsonc-parser`, dedupe with SWC (#82343)\n\nI noticed we had two copies of this library.\n\nThere are a few minor API changes (some things that were properties are\nnow methods, \"message\" is now \"kind\"), and I switched our error type\nover to use `RcStr` since it implements `Clone`.",
    "sha": "ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216",
    "files": [
        {
            "sha": "20569deda8a29c1483052a6d7bde57739c00471d",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 4,
            "deletions": 13,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216",
            "patch": "@@ -3475,18 +3475,9 @@ dependencies = [\n \n [[package]]\n name = \"jsonc-parser\"\n-version = \"0.21.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"3a1853e40333206f9a685358046d13ab200169e3ee573019bddf0ede0dc29307\"\n-dependencies = [\n- \"serde_json\",\n-]\n-\n-[[package]]\n-name = \"jsonc-parser\"\n-version = \"0.26.2\"\n+version = \"0.26.3\"\n source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"b558af6b49fd918e970471374e7a798b2c9bbcda624a210ffa3901ee5614bc8e\"\n+checksum = \"1d6d80e6d70e7911a29f3cf3f44f452df85d06f73572b494ca99a2cad3fcf8f4\"\n dependencies = [\n  \"serde_json\",\n ]\n@@ -6978,7 +6969,7 @@ dependencies = [\n  \"dashmap 5.5.3\",\n  \"either\",\n  \"indexmap 2.9.0\",\n- \"jsonc-parser 0.26.2\",\n+ \"jsonc-parser\",\n  \"napi\",\n  \"napi-derive\",\n  \"once_cell\",\n@@ -9347,7 +9338,7 @@ dependencies = [\n  \"futures\",\n  \"include_dir\",\n  \"indexmap 2.9.0\",\n- \"jsonc-parser 0.21.0\",\n+ \"jsonc-parser\",\n  \"mime\",\n  \"notify\",\n  \"parking_lot\","
        },
        {
            "sha": "29701f52578d04388955c1261745eceb2ff6f32b",
            "filename": "turbopack/crates/turbo-tasks-fs/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/turbopack%2Fcrates%2Fturbo-tasks-fs%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/turbopack%2Fcrates%2Fturbo-tasks-fs%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2FCargo.toml?ref=ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216",
            "patch": "@@ -33,7 +33,7 @@ dunce = { workspace = true }\n futures = { workspace = true }\n include_dir = { version = \"0.7.2\", features = [\"nightly\"] }\n indexmap = { workspace = true }\n-jsonc-parser = { version = \"0.21.0\", features = [\"serde\"] }\n+jsonc-parser = { version = \"0.26.3\", features = [\"serde\"] }\n mime = { workspace = true }\n notify = { workspace = true }\n parking_lot = { workspace = true }"
        },
        {
            "sha": "bb3450e4e329a4698117e28d4d623c8471418cab",
            "filename": "turbopack/crates/turbo-tasks-fs/src/json.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 11,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Fjson.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Fjson.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Fjson.rs?ref=ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216",
            "patch": "@@ -1,18 +1,16 @@\n-use std::{\n-    borrow::Cow,\n-    fmt::{Display, Formatter, Write},\n-};\n+use std::fmt::{Display, Formatter, Write};\n \n use anyhow::Result;\n use serde::{Deserialize, Serialize};\n+use turbo_rcstr::RcStr;\n use turbo_tasks::{NonLocalValue, trace::TraceRawVcs};\n \n use crate::{rope::Rope, source_context::get_source_context};\n \n #[derive(Debug, Clone, PartialEq, Eq, Hash, Serialize, Deserialize, TraceRawVcs, NonLocalValue)]\n pub struct UnparsableJson {\n-    pub message: Cow<'static, str>,\n-    pub path: Option<String>,\n+    pub message: RcStr,\n+    pub path: Option<RcStr>,\n     /// The start line and column of the error.\n     /// Line and column is 0-based.\n     pub start_location: Option<(u32, u32)>,\n@@ -34,18 +32,18 @@ fn byte_to_location(pos: usize, text: &str) -> (u32, u32) {\n impl UnparsableJson {\n     pub fn from_jsonc_error(e: jsonc_parser::errors::ParseError, text: &str) -> Self {\n         Self {\n-            message: e.message.clone().into(),\n+            message: RcStr::from(e.kind().to_string()),\n             path: None,\n-            start_location: Some(byte_to_location(e.range.start, text)),\n-            end_location: Some(byte_to_location(e.range.end, text)),\n+            start_location: Some(byte_to_location(e.range().start, text)),\n+            end_location: Some(byte_to_location(e.range().end, text)),\n         }\n     }\n \n     pub fn from_serde_path_to_error(e: serde_path_to_error::Error<serde_json::Error>) -> Self {\n         let inner = e.inner();\n         Self {\n-            message: inner.to_string().into(),\n-            path: Some(e.path().to_string()),\n+            message: RcStr::from(inner.to_string()),\n+            path: Some(RcStr::from(e.path().to_string())),\n             start_location: Some((\n                 inner.line().saturating_sub(1) as u32,\n                 inner.column().saturating_sub(1) as u32,"
        },
        {
            "sha": "f7d195e482293be2678386288763c058749f4179",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216",
            "patch": "@@ -1942,15 +1942,15 @@ impl FileContent {\n                 ) {\n                     Ok(data) => match data {\n                         Some(value) => FileJsonContent::Content(value),\n-                        None => FileJsonContent::unparsable(\n-                            \"text content doesn't contain any json data\",\n-                        ),\n+                        None => FileJsonContent::unparsable(rcstr!(\n+                            \"text content doesn't contain any json data\"\n+                        )),\n                     },\n                     Err(e) => FileJsonContent::Unparsable(Box::new(\n                         UnparsableJson::from_jsonc_error(e, string.as_ref()),\n                     )),\n                 },\n-                Err(_) => FileJsonContent::unparsable(\"binary is not valid utf-8 text\"),\n+                Err(_) => FileJsonContent::unparsable(rcstr!(\"binary is not valid utf-8 text\")),\n             },\n             FileContent::NotFound => FileJsonContent::NotFound,\n         }\n@@ -1969,15 +1969,15 @@ impl FileContent {\n                 ) {\n                     Ok(data) => match data {\n                         Some(value) => FileJsonContent::Content(value),\n-                        None => FileJsonContent::unparsable(\n-                            \"text content doesn't contain any json data\",\n-                        ),\n+                        None => FileJsonContent::unparsable(rcstr!(\n+                            \"text content doesn't contain any json data\"\n+                        )),\n                     },\n                     Err(e) => FileJsonContent::Unparsable(Box::new(\n                         UnparsableJson::from_jsonc_error(e, string.as_ref()),\n                     )),\n                 },\n-                Err(_) => FileJsonContent::unparsable(\"binary is not valid utf-8 text\"),\n+                Err(_) => FileJsonContent::unparsable(rcstr!(\"binary is not valid utf-8 text\")),\n             },\n             FileContent::NotFound => FileJsonContent::NotFound,\n         }\n@@ -2084,16 +2084,16 @@ impl FileJsonContent {\n     }\n }\n impl FileJsonContent {\n-    pub fn unparsable(message: &'static str) -> Self {\n+    pub fn unparsable(message: RcStr) -> Self {\n         FileJsonContent::Unparsable(Box::new(UnparsableJson {\n-            message: Cow::Borrowed(message),\n+            message,\n             path: None,\n             start_location: None,\n             end_location: None,\n         }))\n     }\n \n-    pub fn unparsable_with_message(message: Cow<'static, str>) -> Self {\n+    pub fn unparsable_with_message(message: RcStr) -> Self {\n         FileJsonContent::Unparsable(Box::new(UnparsableJson {\n             message,\n             path: None,"
        },
        {
            "sha": "28a7a9ddf6bd27e441413fdf5604bdb0c30f6e0c",
            "filename": "turbopack/crates/turbopack-core/src/asset.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 7,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fasset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fasset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fasset.rs?ref=ba47a7c3cf3aad10719fe5deae73ebf9ba4a4216",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::Result;\n-use turbo_rcstr::RcStr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{\n     FileContent, FileJsonContent, FileLinesContent, FileSystemPath, LinkContent, LinkType,\n@@ -43,9 +43,10 @@ impl AssetContent {\n         let this = self.await?;\n         match &*this {\n             AssetContent::File(content) => Ok(content.parse_json()),\n-            AssetContent::Redirect { .. } => {\n-                Ok(FileJsonContent::unparsable(\"a redirect can't be parsed as json\").cell())\n-            }\n+            AssetContent::Redirect { .. } => Ok(FileJsonContent::unparsable(rcstr!(\n+                \"a redirect can't be parsed as json\"\n+            ))\n+            .cell()),\n         }\n     }\n \n@@ -81,9 +82,10 @@ impl AssetContent {\n         let this = self.await?;\n         match &*this {\n             AssetContent::File(content) => Ok(content.parse_json_with_comments()),\n-            AssetContent::Redirect { .. } => {\n-                Ok(FileJsonContent::unparsable(\"a redirect can't be parsed as json\").cell())\n-            }\n+            AssetContent::Redirect { .. } => Ok(FileJsonContent::unparsable(rcstr!(\n+                \"a redirect can't be parsed as json\"\n+            ))\n+            .cell()),\n         }\n     }\n "
        }
    ],
    "stats": {
        "total": 77,
        "additions": 34,
        "deletions": 43
    }
}