{
    "author": "bgw",
    "message": "Turbopack: chore: Remove the serde_regex dependency, which wasn't very heavily used (#85578)\n\nIt doesn't seem like it's worth pulling in this dependency anymore. Most of the places we need to serialize a regex, we use `EsRegex`, which handles serialization itself, and is a superset of `Regex`.",
    "sha": "abdbdb71e1609b233ae6837b8b6e5bedda5b2f34",
    "files": [
        {
            "sha": "97481ce0e16cd0b40df6156df48da4b34e99dd48",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/abdbdb71e1609b233ae6837b8b6e5bedda5b2f34/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/abdbdb71e1609b233ae6837b8b6e5bedda5b2f34/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=abdbdb71e1609b233ae6837b8b6e5bedda5b2f34",
            "patch": "@@ -6494,16 +6494,6 @@ dependencies = [\n  \"thiserror 1.0.69\",\n ]\n \n-[[package]]\n-name = \"serde_regex\"\n-version = \"1.1.0\"\n-source = \"registry+https://github.com/rust-lang/crates.io-index\"\n-checksum = \"a8136f1a4ea815d7eac4101cfd0b16dc0cb5e1fe1b8609dfd728058656b7badf\"\n-dependencies = [\n- \"regex\",\n- \"serde\",\n-]\n-\n [[package]]\n name = \"serde_repr\"\n version = \"0.1.20\"\n@@ -9209,7 +9199,6 @@ dependencies = [\n  \"rustc-hash 2.1.1\",\n  \"serde\",\n  \"serde_json\",\n- \"serde_regex\",\n  \"shrink-to-fit\",\n  \"smallvec\",\n  \"thiserror 1.0.69\","
        },
        {
            "sha": "ec75e3d959079e54fe6ba5ff4c31e332144f96ac",
            "filename": "turbopack/crates/turbo-tasks/Cargo.toml",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/abdbdb71e1609b233ae6837b8b6e5bedda5b2f34/turbopack%2Fcrates%2Fturbo-tasks%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/abdbdb71e1609b233ae6837b8b6e5bedda5b2f34/turbopack%2Fcrates%2Fturbo-tasks%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2FCargo.toml?ref=abdbdb71e1609b233ae6837b8b6e5bedda5b2f34",
            "patch": "@@ -39,7 +39,6 @@ regex = { workspace = true }\n rustc-hash = { workspace = true }\n serde = { workspace = true, features = [\"rc\", \"derive\"] }\n serde_json = { workspace = true }\n-serde_regex = \"1.1.0\"\n shrink-to-fit = { workspace=true,features = [\"indexmap\", \"serde_json\", \"smallvec\", \"nightly\"] }\n smallvec = { workspace = true }\n thiserror = { workspace = true }"
        },
        {
            "sha": "a9f2313f4d1f57c6055ec8c599e1a2cbb49bef3a",
            "filename": "turbopack/crates/turbo-tasks/src/primitives.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 25,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/abdbdb71e1609b233ae6837b8b6e5bedda5b2f34/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fprimitives.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/abdbdb71e1609b233ae6837b8b6e5bedda5b2f34/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fprimitives.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fprimitives.rs?ref=abdbdb71e1609b233ae6837b8b6e5bedda5b2f34",
            "patch": "@@ -1,4 +1,4 @@\n-use std::{ops::Deref, time::Duration};\n+use std::time::Duration;\n \n use turbo_rcstr::RcStr;\n use turbo_tasks_macros::primitive as __turbo_tasks_internal_primitive;\n@@ -33,27 +33,3 @@ __turbo_tasks_internal_primitive!(serde_json::Value);\n __turbo_tasks_internal_primitive!(Duration);\n __turbo_tasks_internal_primitive!(Vec<u8>, manual_shrink_to_fit);\n __turbo_tasks_internal_primitive!(Vec<bool>, manual_shrink_to_fit);\n-\n-#[turbo_tasks::value(transparent, eq = \"manual\")]\n-#[derive(Debug, Clone)]\n-pub struct Regex(\n-    #[turbo_tasks(trace_ignore)]\n-    #[serde(with = \"serde_regex\")]\n-    pub regex::Regex,\n-);\n-\n-impl Deref for Regex {\n-    type Target = regex::Regex;\n-\n-    fn deref(&self) -> &Self::Target {\n-        &self.0\n-    }\n-}\n-\n-impl PartialEq for Regex {\n-    fn eq(&self, other: &Regex) -> bool {\n-        // Context: https://github.com/rust-lang/regex/issues/313#issuecomment-269898900\n-        self.0.as_str() == other.0.as_str()\n-    }\n-}\n-impl Eq for Regex {}"
        },
        {
            "sha": "0fd96dc1d3a8d5295463ad576ba5e1ef84219bc9",
            "filename": "turbopack/crates/turbopack/src/module_options/rule_condition.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 6,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/abdbdb71e1609b233ae6837b8b6e5bedda5b2f34/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Frule_condition.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/abdbdb71e1609b233ae6837b8b6e5bedda5b2f34/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Frule_condition.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Frule_condition.rs?ref=abdbdb71e1609b233ae6837b8b6e5bedda5b2f34",
            "patch": "@@ -3,12 +3,12 @@ use std::{\n     mem::{replace, take},\n };\n \n-use anyhow::{Result, bail};\n+use anyhow::Result;\n use either::Either;\n use serde::{Deserialize, Serialize};\n use smallvec::SmallVec;\n use turbo_esregex::EsRegex;\n-use turbo_tasks::{NonLocalValue, ReadRef, ResolvedVc, primitives::Regex, trace::TraceRawVcs};\n+use turbo_tasks::{NonLocalValue, ReadRef, ResolvedVc, trace::TraceRawVcs};\n use turbo_tasks_fs::{FileContent, FileSystemPath, glob::Glob};\n use turbopack_core::{\n     asset::Asset, reference_type::ReferenceType, source::Source, virtual_source::VirtualSource,\n@@ -30,7 +30,6 @@ pub enum RuleCondition {\n     ResourcePathInExactDirectory(FileSystemPath),\n     ContentTypeStartsWith(String),\n     ContentTypeEmpty,\n-    ResourcePathRegex(#[turbo_tasks(trace_ignore)] Regex),\n     ResourcePathEsRegex(#[turbo_tasks(trace_ignore)] ReadRef<EsRegex>),\n     ResourceContentEsRegex(#[turbo_tasks(trace_ignore)] ReadRef<EsRegex>),\n     /// For paths that are within the same filesystem as the `base`, it need to\n@@ -268,9 +267,6 @@ impl RuleCondition {\n                             .map_or(path.path.as_str(), |(_, b)| b);\n                         return Ok(glob.matches(basename));\n                     }\n-                    RuleCondition::ResourcePathRegex(_) => {\n-                        bail!(\"ResourcePathRegex not implemented yet\");\n-                    }\n                     RuleCondition::ResourcePathEsRegex(regex) => {\n                         return Ok(regex.is_match(&path.path));\n                     }"
        }
    ],
    "stats": {
        "total": 46,
        "additions": 3,
        "deletions": 43
    }
}