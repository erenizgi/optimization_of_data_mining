{
    "author": "huozhi",
    "message": "fix: skip collecting metadata for app-error in webpack (#85892)",
    "sha": "1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0",
    "files": [
        {
            "sha": "91ae3343b58ff82db4405aa077ba3bb031b48925",
            "filename": "packages/next/src/build/webpack/loaders/next-app-loader/index.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-app-loader%2Findex.ts?ref=1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0",
            "patch": "@@ -38,6 +38,7 @@ import { PARALLEL_ROUTE_DEFAULT_PATH } from '../../../../client/components/built\n import type { Compilation } from 'webpack'\n import { createAppRouteCode } from './create-app-route-code'\n import { MissingDefaultParallelRouteError } from '../../../../shared/lib/errors/missing-default-parallel-route-error'\n+import { normalizePathSep } from '../../../../shared/lib/page-path/normalize-path-sep'\n \n export type AppLoaderOptions = {\n   name: string\n@@ -87,7 +88,7 @@ const PARALLEL_VIRTUAL_SEGMENT = 'slot$'\n const defaultGlobalErrorPath =\n   'next/dist/client/components/builtin/global-error.js'\n const defaultNotFoundPath = 'next/dist/client/components/builtin/not-found.js'\n-const defaultEmptyStubPath = 'next/dist/client/components/builtin/empty-stub'\n+const defaultEmptyStubPath = 'next/dist/client/components/builtin/empty-stub.js'\n const defaultLayoutPath = 'next/dist/client/components/builtin/layout.js'\n const defaultGlobalNotFoundPath =\n   'next/dist/client/components/builtin/global-not-found.js'\n@@ -176,9 +177,7 @@ async function createTreeCodeFromPath(\n   async function resolveAdjacentParallelSegments(\n     segmentPath: string\n   ): Promise<string[]> {\n-    const absoluteSegmentPath = await resolveDir(\n-      `${appDirPrefix}${segmentPath}`\n-    )\n+    const absoluteSegmentPath = resolveDir(`${appDirPrefix}${segmentPath}`)\n \n     if (!absoluteSegmentPath) {\n       return []\n@@ -232,7 +231,11 @@ async function createTreeCodeFromPath(\n     const routerDirPath = `${appDirPrefix}${segmentPath}`\n     const resolvedRouteDir = resolveDir(routerDirPath)\n \n-    if (resolvedRouteDir) {\n+    if (\n+      resolvedRouteDir &&\n+      // Do not collect metadata for app-error route as it's for generating pure static 500.html\n+      !normalizePathSep(pagePath).endsWith(appErrorPath)\n+    ) {\n       metadata = await createStaticMetadataFromRoute(resolvedRouteDir, {\n         basePath,\n         segment: segmentPath,"
        },
        {
            "sha": "f7466ae8dae5507820b437390b7f56eb72d0bc01",
            "filename": "test/production/app-dir/metadata-base-warning/app/layout.tsx",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fapp%2Flayout.tsx?ref=1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0",
            "patch": "@@ -0,0 +1,19 @@\n+import type { Metadata } from 'next'\n+\n+export const metadata: Metadata = {\n+  title: 'my title',\n+  description: 'my description',\n+  metadataBase: 'https://my-domain.com/',\n+}\n+\n+export default function RootLayout({\n+  children,\n+}: Readonly<{\n+  children: React.ReactNode\n+}>) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "7cbc1d26733614b83dcc25b9cfcd5e06dffb147c",
            "filename": "test/production/app-dir/metadata-base-warning/app/opengraph-image.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fapp%2Fopengraph-image.png",
            "raw_url": "https://github.com/vercel/next.js/raw/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fapp%2Fopengraph-image.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fapp%2Fopengraph-image.png?ref=1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0"
        },
        {
            "sha": "616c1772e0a4d85e8d326864a8e59c12e852e331",
            "filename": "test/production/app-dir/metadata-base-warning/app/page.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fapp%2Fpage.tsx?ref=1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0",
            "patch": "@@ -0,0 +1,7 @@\n+export default function Home() {\n+  return (\n+    <div>\n+      <h1>Hello World</h1>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "9232dff0a0fa18cb4a1092a7954401c552a25223",
            "filename": "test/production/app-dir/metadata-base-warning/metadata-base-warning.test.ts",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fmetadata-base-warning.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fmetadata-base-warning.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fmetadata-base-warning.test.ts?ref=1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0",
            "patch": "@@ -0,0 +1,13 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('metadata-base-warning', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should not warn metadataBase for static image when metadataBase is set', async () => {\n+    expect(next.cliOutput).not.toContain(\n+      'metadataBase property in metadata export is not set for resolving social open graph or twitter images'\n+    )\n+  })\n+})"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/production/app-dir/metadata-base-warning/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-base-warning%2Fnext.config.js?ref=1752d79c59c7f36a3668323bdf6b7eb2ac2ff5b0",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        }
    ],
    "stats": {
        "total": 58,
        "additions": 53,
        "deletions": 5
    }
}