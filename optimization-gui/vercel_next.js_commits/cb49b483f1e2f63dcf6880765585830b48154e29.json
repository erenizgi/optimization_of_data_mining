{
    "author": "lubieowoce",
    "message": "Reland \"Ensure mangling is disabled for dev runtime builds (#75297)\" (#79201)\n\nReapplies #75297\r\n\r\nAlso fixes some rspack tests which didn't await assertions properly so they might have looked like they're passing",
    "sha": "cb49b483f1e2f63dcf6880765585830b48154e29",
    "files": [
        {
            "sha": "52c9033e7823b429e973042c585628877b15f7e9",
            "filename": "contributing/core/vscode-debugger.md",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/cb49b483f1e2f63dcf6880765585830b48154e29/contributing%2Fcore%2Fvscode-debugger.md",
            "raw_url": "https://github.com/vercel/next.js/raw/cb49b483f1e2f63dcf6880765585830b48154e29/contributing%2Fcore%2Fvscode-debugger.md",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/contributing%2Fcore%2Fvscode-debugger.md?ref=cb49b483f1e2f63dcf6880765585830b48154e29",
            "patch": "@@ -24,4 +24,4 @@ To see the changes you make to the Next.js codebase during development, you can\n \n When developing/debugging Next.js, you can set breakpoints anywhere in the `packages/next` source code that will stop the debugger at certain locations so you can examine the behavior. Read more about [breakpoints in the VS Code documentation](https://code.visualstudio.com/docs/nodejs/nodejs-debugging#_breakpoints).\n \n-To ensure that the original names are displayed in the \"Variables\" section, build the Next.js source code with `NEXT_SERVER_EVAL_SOURCE_MAPS=1`. This is automatically applied when using `pnpm dev`.\n+To ensure that the original names are displayed in the \"Variables\" section, build the Next.js source code with `NEXT_SERVER_NO_MANGLE=1`. This is automatically applied when using `pnpm dev`."
        },
        {
            "sha": "372a63330fc9cf9f588ffcfa34d38ea0cd101a12",
            "filename": "packages/next/next-runtime.webpack-config.js",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/cb49b483f1e2f63dcf6880765585830b48154e29/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/cb49b483f1e2f63dcf6880765585830b48154e29/packages%2Fnext%2Fnext-runtime.webpack-config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fnext-runtime.webpack-config.js?ref=cb49b483f1e2f63dcf6880765585830b48154e29",
            "patch": "@@ -1,7 +1,6 @@\n const webpack = require('@rspack/core')\n const path = require('path')\n const { BundleAnalyzerPlugin } = require('webpack-bundle-analyzer')\n-const EvalSourceMapDevToolPlugin = require('./webpack-plugins/eval-source-map-dev-tool-plugin')\n const DevToolsIgnoreListPlugin = require('./webpack-plugins/devtools-ignore-list-plugin')\n \n function shouldIgnorePath(modulePath) {\n@@ -184,20 +183,21 @@ module.exports = ({ dev, turbo, bundleType, experimental, ...rest }) => {\n       }.runtime.${dev ? 'dev' : 'prod'}.js`,\n       libraryTarget: 'commonjs2',\n     },\n-    devtool: process.env.NEXT_SERVER_EVAL_SOURCE_MAPS\n-      ? // We'll use a fork in plugins\n-        false\n-      : 'source-map',\n+    devtool: 'source-map',\n     optimization: {\n       moduleIds: 'named',\n       minimize: true,\n       concatenateModules: true,\n-      minimizer: [new webpack.SwcJsMinimizerRspackPlugin()],\n+      minimizer: [\n+        new webpack.SwcJsMinimizerRspackPlugin({\n+          minimizerOptions: {\n+            mangle: dev || process.env.NEXT_SERVER_NO_MANGLE ? false : true,\n+          },\n+        }),\n+      ],\n     },\n     plugins: [\n-      process.env.NEXT_SERVER_EVAL_SOURCE_MAPS\n-        ? new EvalSourceMapDevToolPlugin({ shouldIgnorePath })\n-        : new DevToolsIgnoreListPlugin({ shouldIgnorePath }),\n+      new DevToolsIgnoreListPlugin({ shouldIgnorePath }),\n       new webpack.DefinePlugin({\n         'typeof window': JSON.stringify('undefined'),\n         'process.env.NEXT_MINIMAL': JSON.stringify('true'),"
        },
        {
            "sha": "7f52bcee42d97794c5019ec101e5ff22fcb60a82",
            "filename": "packages/next/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/cb49b483f1e2f63dcf6880765585830b48154e29/packages%2Fnext%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/cb49b483f1e2f63dcf6880765585830b48154e29/packages%2Fnext%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fpackage.json?ref=cb49b483f1e2f63dcf6880765585830b48154e29",
            "patch": "@@ -80,7 +80,7 @@\n     \"next\": \"./dist/bin/next\"\n   },\n   \"scripts\": {\n-    \"dev\": \"cross-env NEXT_SERVER_EVAL_SOURCE_MAPS=1 taskr\",\n+    \"dev\": \"cross-env NEXT_SERVER_NO_MANGLE=1 taskr\",\n     \"release\": \"taskr release\",\n     \"build\": \"pnpm release\",\n     \"prepublishOnly\": \"cd ../../ && turbo run build\","
        },
        {
            "sha": "ae0e7051dfc9eac7f758be199fb19c94bf8bb722",
            "filename": "packages/next/src/build/webpack/plugins/eval-source-map-dev-tool-plugin.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/cb49b483f1e2f63dcf6880765585830b48154e29/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Feval-source-map-dev-tool-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cb49b483f1e2f63dcf6880765585830b48154e29/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Feval-source-map-dev-tool-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Feval-source-map-dev-tool-plugin.ts?ref=cb49b483f1e2f63dcf6880765585830b48154e29",
            "patch": "@@ -3,7 +3,6 @@\n \tAuthor Tobias Koppers @sokra\n \n   Forked to add support for `ignoreList`.\n-  Keep in sync with packages/next/webpack-plugins/eval-source-map-dev-tool-plugin.js\n */\n import {\n   type webpack,"
        },
        {
            "sha": "bc1d83d9504ed374d84b182ed745b05d7990771e",
            "filename": "packages/next/webpack-plugins/eval-source-map-dev-tool-plugin.js",
            "status": "removed",
            "additions": 0,
            "deletions": 219,
            "changes": 219,
            "blob_url": "https://github.com/vercel/next.js/blob/b304b45e3a6e3e79338568d76e28805e77c03ec9/packages%2Fnext%2Fwebpack-plugins%2Feval-source-map-dev-tool-plugin.js",
            "raw_url": "https://github.com/vercel/next.js/raw/b304b45e3a6e3e79338568d76e28805e77c03ec9/packages%2Fnext%2Fwebpack-plugins%2Feval-source-map-dev-tool-plugin.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fwebpack-plugins%2Feval-source-map-dev-tool-plugin.js?ref=b304b45e3a6e3e79338568d76e28805e77c03ec9",
            "patch": "@@ -1,219 +0,0 @@\n-/*\n-\tMIT License http://www.opensource.org/licenses/mit-license.php\n-\tAuthor Tobias Koppers @sokra\n-\n-  Forked to add support for `ignoreList`.\n-  Keep in sync with packages/next/webpack-plugins/eval-source-map-dev-tool-plugin.js\n-  */\n-// eslint-disable-next-line import/no-extraneous-dependencies -- this is a dev-only file\n-const ConcatenatedModule = require('webpack/lib/optimize/ConcatenatedModule')\n-// eslint-disable-next-line import/no-extraneous-dependencies -- this is a dev-only file\n-const { makePathsAbsolute } = require('webpack/lib/util/identifier')\n-// eslint-disable-next-line import/no-extraneous-dependencies -- this is a dev-only file\n-const ModuleFilenameHelpers = require('webpack/lib/ModuleFilenameHelpers')\n-// eslint-disable-next-line import/no-extraneous-dependencies -- this is a dev-only file\n-const NormalModule = require('webpack/lib/NormalModule')\n-// eslint-disable-next-line import/no-extraneous-dependencies -- this is a dev-only file\n-const RuntimeGlobals = require('webpack/lib/RuntimeGlobals')\n-// eslint-disable-next-line import/no-extraneous-dependencies -- this is a dev-only file\n-const SourceMapDevToolModuleOptionsPlugin = require('webpack/lib/SourceMapDevToolModuleOptionsPlugin')\n-\n-const cache = new WeakMap()\n-const devtoolWarningMessage = `/*\n- * ATTENTION: An \"eval-source-map\" devtool has been used.\n- * This devtool is neither made for production nor for readable output files.\n- * It uses \"eval()\" calls to create a separate source file with attached SourceMaps in the browser devtools.\n- * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)\n- * or disable the default devtool with \"devtool: false\".\n- * If you are looking for production-ready output files, see mode: \"production\" (https://webpack.js.org/configuration/mode/).\n- */\n-`\n-\n-// @ts-expect-error -- can't compare `string` with `number` in `version`Ï\n-\n-// Fork of webpack's EvalSourceMapDevToolPlugin with support for adding `ignoreList`.\n-// https://github.com/webpack/webpack/blob/e237b580e2bda705c5ab39973f786f7c5a7026bc/lib/EvalSourceMapDevToolPlugin.js#L37\n-module.exports = class EvalSourceMapDevToolPlugin {\n-  sourceMapComment\n-  moduleFilenameTemplate\n-  namespace\n-  options\n-  shouldIgnorePath\n-\n-  /**\n-   * @param {SourceMapDevToolPluginOptions|string} inputOptions Options object\n-   */\n-  constructor(inputOptions) {\n-    let options\n-    if (typeof inputOptions === 'string') {\n-      options = {\n-        append: inputOptions,\n-      }\n-    } else {\n-      options = inputOptions\n-    }\n-    this.sourceMapComment =\n-      options.append && typeof options.append !== 'function'\n-        ? options.append\n-        : '//# sourceURL=[module]\\n//# sourceMappingURL=[url]'\n-    this.moduleFilenameTemplate =\n-      options.moduleFilenameTemplate ||\n-      'webpack://[namespace]/[resource-path]?[hash]'\n-    this.namespace = options.namespace || ''\n-    this.options = options\n-\n-    // fork\n-    this.shouldIgnorePath = options.shouldIgnorePath ?? (() => false)\n-  }\n-\n-  /**\n-   * Apply the plugin\n-   * @param compiler the compiler instance\n-   */\n-  apply(compiler) {\n-    const options = this.options\n-    compiler.hooks.compilation.tap(\n-      'NextJSEvalSourceMapDevToolPlugin',\n-      (compilation) => {\n-        const { JavascriptModulesPlugin } = compiler.webpack.javascript\n-        const { RawSource, ConcatSource } = compiler.webpack.sources\n-        const devtoolWarning = new RawSource(devtoolWarningMessage)\n-        const hooks = JavascriptModulesPlugin.getCompilationHooks(compilation)\n-        new SourceMapDevToolModuleOptionsPlugin(options).apply(compilation)\n-        const matchModule = ModuleFilenameHelpers.matchObject.bind(\n-          ModuleFilenameHelpers,\n-          options\n-        )\n-        hooks.renderModuleContent.tap(\n-          'NextJSEvalSourceMapDevToolPlugin',\n-          (source, m, { chunk, runtimeTemplate, chunkGraph }) => {\n-            const cachedSource = cache.get(source)\n-            if (cachedSource !== undefined) {\n-              return cachedSource\n-            }\n-            const result = (r) => {\n-              cache.set(source, r)\n-              return r\n-            }\n-            if (m instanceof NormalModule) {\n-              const module = m\n-              if (!matchModule(module.resource)) {\n-                return result(source)\n-              }\n-            } else if (m instanceof ConcatenatedModule) {\n-              const concatModule = m\n-              if (concatModule.rootModule instanceof NormalModule) {\n-                const module = concatModule.rootModule\n-                if (!matchModule(module.resource)) {\n-                  return result(source)\n-                }\n-              } else {\n-                return result(source)\n-              }\n-            } else {\n-              return result(source)\n-            }\n-            const namespace = compilation.getPath(this.namespace, {\n-              chunk,\n-            })\n-            let sourceMap\n-            let content\n-            if (source.sourceAndMap) {\n-              const sourceAndMap = source.sourceAndMap(options)\n-              sourceMap = sourceAndMap.map\n-              content = sourceAndMap.source\n-            } else {\n-              sourceMap = source.map(options)\n-              content = source.source()\n-            }\n-            if (!sourceMap) {\n-              return result(source)\n-            }\n-\n-            // Clone (flat) the sourcemap to ensure that the mutations below do not persist.\n-            sourceMap = {\n-              ...sourceMap,\n-            }\n-            const context = compiler.options.context\n-            const root = compiler.root\n-            const modules = sourceMap.sources.map((sourceMapSource) => {\n-              if (!sourceMapSource.startsWith('webpack://'))\n-                return sourceMapSource\n-              sourceMapSource = makePathsAbsolute(\n-                context,\n-                sourceMapSource.slice(10),\n-                root\n-              )\n-              const module = compilation.findModule(sourceMapSource)\n-              return module || sourceMapSource\n-            })\n-            let moduleFilenames = modules.map((module) =>\n-              ModuleFilenameHelpers.createFilename(\n-                module,\n-                {\n-                  moduleFilenameTemplate: this.moduleFilenameTemplate,\n-                  namespace,\n-                },\n-                {\n-                  requestShortener: runtimeTemplate.requestShortener,\n-                  chunkGraph,\n-                  hashFunction: compilation.outputOptions.hashFunction,\n-                }\n-              )\n-            )\n-            moduleFilenames = ModuleFilenameHelpers.replaceDuplicates(\n-              moduleFilenames,\n-              (filename, _i, n) => {\n-                for (let j = 0; j < n; j++) filename += '*'\n-                return filename\n-              }\n-            )\n-            sourceMap.sources = moduleFilenames\n-            sourceMap.ignoreList = []\n-            for (let index = 0; index < moduleFilenames.length; index++) {\n-              if (this.shouldIgnorePath(moduleFilenames[index])) {\n-                sourceMap.ignoreList.push(index)\n-              }\n-            }\n-            if (options.noSources) {\n-              sourceMap.sourcesContent = undefined\n-            }\n-            sourceMap.sourceRoot = options.sourceRoot || ''\n-            const moduleId = /** @type {ModuleId} */ chunkGraph.getModuleId(m)\n-            if (moduleId) {\n-              sourceMap.file =\n-                typeof moduleId === 'number' ? `${moduleId}.js` : moduleId\n-            }\n-            const footer = `${this.sourceMapComment.replace(/\\[url\\]/g, `data:application/json;charset=utf-8;base64,${Buffer.from(JSON.stringify(sourceMap), 'utf8').toString('base64')}`)}\\n//# sourceURL=webpack-internal:///${moduleId}\\n` // workaround for chrome bug\n-\n-            return result(\n-              new RawSource(\n-                `eval(${compilation.outputOptions.trustedTypes ? `${RuntimeGlobals.createScript}(${JSON.stringify(content + footer)})` : JSON.stringify(content + footer)});`\n-              )\n-            )\n-          }\n-        )\n-        hooks.inlineInRuntimeBailout.tap(\n-          'EvalDevToolModulePlugin',\n-          () => 'the eval-source-map devtool is used.'\n-        )\n-        hooks.render.tap(\n-          'EvalSourceMapDevToolPlugin',\n-          (source) => new ConcatSource(devtoolWarning, source)\n-        )\n-        hooks.chunkHash.tap('EvalSourceMapDevToolPlugin', (_chunk, hash) => {\n-          hash.update('EvalSourceMapDevToolPlugin')\n-          hash.update('2')\n-        })\n-        if (compilation.outputOptions.trustedTypes) {\n-          compilation.hooks.additionalModuleRuntimeRequirements.tap(\n-            'EvalSourceMapDevToolPlugin',\n-            (_module, set, _context) => {\n-              set.add(RuntimeGlobals.createScript)\n-            }\n-          )\n-        }\n-      }\n-    )\n-  }\n-}"
        },
        {
            "sha": "79e1ec46425ce90b0470d3082f86de9217417c69",
            "filename": "test/development/app-dir/ssr-in-rsc/ssr-in-rsc.test.ts",
            "status": "modified",
            "additions": 61,
            "deletions": 3,
            "changes": 64,
            "blob_url": "https://github.com/vercel/next.js/blob/cb49b483f1e2f63dcf6880765585830b48154e29/test%2Fdevelopment%2Fapp-dir%2Fssr-in-rsc%2Fssr-in-rsc.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cb49b483f1e2f63dcf6880765585830b48154e29/test%2Fdevelopment%2Fapp-dir%2Fssr-in-rsc%2Fssr-in-rsc.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fssr-in-rsc%2Fssr-in-rsc.test.ts?ref=cb49b483f1e2f63dcf6880765585830b48154e29",
            "patch": "@@ -8,9 +8,10 @@ import {\n } from 'next-test-utils'\n \n const isReactExperimental = process.env.__NEXT_EXPERIMENTAL_PPR === 'true'\n-\n const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n \n+const isRspack = process.env.NEXT_RSPACK !== undefined\n+\n describe('react-dom/server in React Server environment', () => {\n   const dependencies = (global as any).isNextDeploy\n     ? // `link` is incompatible with the npm version used when this test is deployed\n@@ -266,7 +267,7 @@ describe('react-dom/server in React Server environment', () => {\n     )\n \n     if (isTurbopack) {\n-      expect(browser).toDisplayRedbox(`\n+      await expect(browser).toDisplayRedbox(`\n        {\n          \"description\": \"Ecmascript file had an error\",\n          \"environmentLabel\": null,\n@@ -278,11 +279,41 @@ describe('react-dom/server in React Server environment', () => {\n          \"stack\": [],\n        }\n       `)\n+    } else if (isRspack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"description\": \"  × Module build failed:\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Build Error\",\n+         \"source\": \"<FIXME-nextjs-internal-source>\n+         × Module build failed:\n+         ╰─▶   × Error:   x You're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\n+               │   | Learn more: https://nextjs.org/docs/app/building-your-application/rendering\n+               │    ,-[1:1]\n+               │  1 | import * as ReactDOMServerEdge from 'react-dom/server'\n+               │    : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+               │  2 | // Fine to drop once React is on ESM\n+               │  3 | import ReactDOMServerEdgeDefault from 'react-dom/server'\n+               │    \\`----\n+               │   x You're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\n+               │   | Learn more: https://nextjs.org/docs/app/building-your-application/rendering\n+               │    ,-[3:1]\n+               │  1 | import * as ReactDOMServerEdge from 'react-dom/server'\n+               │  2 | // Fine to drop once React is on ESM\n+               │  3 | import ReactDOMServerEdgeDefault from 'react-dom/server'\n+               │    : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+               │  4 |\n+               │  5 | export const runtime = 'edge'\n+               │    \\`----\n+               │\",\n+         \"stack\": [],\n+       }\n+      `)\n     } else {\n       // FIXME: the source map of source file path is not correct\n       // Expected: `./app/exports/app-code/react-dom-server-edge-implicit/page.js`\n       // Observed: `./node_modules/.pnpm/next@file+..+next-repo.../page.js?__next_edge_ssr_entry__\n-      expect(browser).toDisplayRedbox(`\n+      await expect(browser).toDisplayRedbox(`\n        {\n          \"description\": \"  x You're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\",\n          \"environmentLabel\": null,\n@@ -397,6 +428,33 @@ describe('react-dom/server in React Server environment', () => {\n        Learn more: https://nextjs.org/docs/app/building-your-application/rendering\",\n        }\n       `)\n+    } else if (isRspack) {\n+      expect(redbox).toMatchInlineSnapshot(`\n+       {\n+         \"description\": \"  × Module build failed:\",\n+         \"source\": \"./app/exports/app-code/react-dom-server-node-implicit/page.js\n+         × Module build failed:\n+         ╰─▶   × Error:   x You're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\n+               │   | Learn more: https://nextjs.org/docs/app/building-your-application/rendering\n+               │    ,-[1:1]\n+               │  1 | import * as ReactDOMServerNode from 'react-dom/server'\n+               │    : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+               │  2 | // Fine to drop once React is on ESM\n+               │  3 | import ReactDOMServerNodeDefault from 'react-dom/server'\n+               │    \\`----\n+               │   x You're importing a component that imports react-dom/server. To fix it, render or return the content directly as a Server Component instead for perf and security.\n+               │   | Learn more: https://nextjs.org/docs/app/building-your-application/rendering\n+               │    ,-[3:1]\n+               │  1 | import * as ReactDOMServerNode from 'react-dom/server'\n+               │  2 | // Fine to drop once React is on ESM\n+               │  3 | import ReactDOMServerNodeDefault from 'react-dom/server'\n+               │    : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+               │  4 |\n+               │  5 | export const runtime = 'nodejs'\n+               │    \\`----\n+               │\",\n+       }\n+      `)\n     } else {\n       expect(redbox).toMatchInlineSnapshot(`\n        {"
        },
        {
            "sha": "bd28b876aad67295b1d80893e5c2fa8fca9f6137",
            "filename": "test/e2e/app-dir/use-cache-segment-configs/use-cache-segment-configs.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cb49b483f1e2f63dcf6880765585830b48154e29/test%2Fe2e%2Fapp-dir%2Fuse-cache-segment-configs%2Fuse-cache-segment-configs.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cb49b483f1e2f63dcf6880765585830b48154e29/test%2Fe2e%2Fapp-dir%2Fuse-cache-segment-configs%2Fuse-cache-segment-configs.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-segment-configs%2Fuse-cache-segment-configs.test.ts?ref=cb49b483f1e2f63dcf6880765585830b48154e29",
            "patch": "@@ -20,7 +20,7 @@ describe('use-cache-segment-configs', () => {\n       await assertHasRedbox(browser)\n \n       if (isTurbopack) {\n-        expect(browser).toDisplayRedbox(`\n+        await expect(browser).toDisplayRedbox(`\n          {\n            \"description\": \"Ecmascript file had an error\",\n            \"environmentLabel\": null,\n@@ -34,7 +34,7 @@ describe('use-cache-segment-configs', () => {\n         `)\n       } else {\n         // FIXME: Fix broken import trace for Webpack loader resource.\n-        expect(browser).toDisplayRedbox(`\n+        await expect(browser).toDisplayRedbox(`\n          {\n            \"description\": \"  x Route segment config \"runtime\" is not compatible with \\`nextConfig.experimental.useCache\\`. Please remove it.\",\n            \"environmentLabel\": null,"
        },
        {
            "sha": "7a222e2991cc0859d0ed3771be18cf3e67933530",
            "filename": "test/lib/add-redbox-matchers.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cb49b483f1e2f63dcf6880765585830b48154e29/test%2Flib%2Fadd-redbox-matchers.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cb49b483f1e2f63dcf6880765585830b48154e29/test%2Flib%2Fadd-redbox-matchers.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fadd-redbox-matchers.ts?ref=cb49b483f1e2f63dcf6880765585830b48154e29",
            "patch": "@@ -142,7 +142,9 @@ async function createErrorSnapshot(\n     const sourceLines = focusedSource.split('\\n')\n     if (\n       sourceLines[0].startsWith('./node_modules/.pnpm/next@file+') ||\n-      sourceLines[0].startsWith('./node_modules/.pnpm/file+')\n+      sourceLines[0].startsWith('./node_modules/.pnpm/file+') ||\n+      // e.g. \"next-app-loader?<SEARCH PARAMS>\" (in rspack, the loader doesn't seem to be prefixed with node_modules)\n+      /^next-[a-zA-Z0-9\\-_]+?-loader\\?/.test(sourceLines[0])\n     ) {\n       focusedSource =\n         `<FIXME-nextjs-internal-source>` +"
        }
    ],
    "stats": {
        "total": 314,
        "additions": 77,
        "deletions": 237
    }
}