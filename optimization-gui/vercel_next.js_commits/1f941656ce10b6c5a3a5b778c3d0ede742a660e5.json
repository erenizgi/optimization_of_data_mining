{
    "author": "lukesandberg",
    "message": "[turbopack] Remove uses of `Value<ReferenceType>` by making `ReferenceType` a TaskInput (#80130)\n\nRemove `Value::new` wrapper for `ReferenceType` parameters\n\n### Why?\n\nThe `Value<>` type is confusing and error prone, lets destroy it!\n\nAs discussed over slack, `turbo_tasks::Value` type always implements `is_resolved` as `true` and `is_transient` as `false` which is incorrect and can enable smuggling transient vcs into turbo tasks. \n\n• https://vercel.slack.com/archives/C03EWR7LGEN/p1743456121241529\n• https://vercel.slack.com/archives/C04NGV98TPS/p1743455453764879",
    "sha": "1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
    "files": [
        {
            "sha": "901c49a4eeb7d4831e51984b65e481be3a34d6c9",
            "filename": "crates/next-api/src/instrumentation.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -75,7 +75,7 @@ impl InstrumentationEndpoint {\n             .asset_context\n             .process(\n                 *self.source,\n-                Value::new(ReferenceType::Entry(EntryReferenceSubType::Instrumentation)),\n+                ReferenceType::Entry(EntryReferenceSubType::Instrumentation),\n             )\n             .module()\n             .to_resolved()"
        },
        {
            "sha": "ab38da341dfff9d843be96845246820701e7861e",
            "filename": "crates/next-api/src/middleware.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -76,7 +76,7 @@ impl MiddlewareEndpoint {\n             .asset_context\n             .process(\n                 *self.source,\n-                Value::new(ReferenceType::Entry(EntryReferenceSubType::Middleware)),\n+                ReferenceType::Entry(EntryReferenceSubType::Middleware),\n             )\n             .module();\n \n@@ -341,7 +341,7 @@ impl MiddlewareEndpoint {\n         self.asset_context\n             .process(\n                 *self.source,\n-                Value::new(ReferenceType::Entry(EntryReferenceSubType::Middleware)),\n+                ReferenceType::Entry(EntryReferenceSubType::Middleware),\n             )\n             .module()\n     }"
        },
        {
            "sha": "38428d27282c7528dc05e775bf848b3251dc7d55",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -876,19 +876,19 @@ impl PageEndpoint {\n \n         let (reference_type, project_root, module_context, edge_module_context) = match this.ty {\n             PageEndpointType::Html | PageEndpointType::SsrOnly => (\n-                Value::new(ReferenceType::Entry(EntryReferenceSubType::Page)),\n+                ReferenceType::Entry(EntryReferenceSubType::Page),\n                 this.pages_project.project().project_path(),\n                 this.pages_project.ssr_module_context(),\n                 this.pages_project.edge_ssr_module_context(),\n             ),\n             PageEndpointType::Data => (\n-                Value::new(ReferenceType::Entry(EntryReferenceSubType::Page)),\n+                ReferenceType::Entry(EntryReferenceSubType::Page),\n                 this.pages_project.project().project_path(),\n                 this.pages_project.ssr_data_module_context(),\n                 this.pages_project.edge_ssr_data_module_context(),\n             ),\n             PageEndpointType::Api => (\n-                Value::new(ReferenceType::Entry(EntryReferenceSubType::PagesApi)),\n+                ReferenceType::Entry(EntryReferenceSubType::PagesApi),\n                 this.pages_project.project().project_path(),\n                 this.pages_project.api_module_context(),\n                 this.pages_project.edge_api_module_context(),"
        },
        {
            "sha": "936064536d1c38c0439efa40a2ed31c3f5700bd2",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1381,7 +1381,7 @@ impl Project {\n         let module = edge_module_context\n             .process(\n                 source,\n-                Value::new(ReferenceType::Entry(EntryReferenceSubType::Middleware)),\n+                ReferenceType::Entry(EntryReferenceSubType::Middleware),\n             )\n             .module();\n "
        },
        {
            "sha": "3f2cf504888b991ef9f3194696b83f2c37aa9d77",
            "filename": "crates/next-api/src/server_actions.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Fserver_actions.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-api%2Fsrc%2Fserver_actions.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fserver_actions.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -19,7 +19,7 @@ use swc_core::{\n     },\n };\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, ResolvedVc, TryFlatJoinIterExt, Value, ValueToString, Vc};\n+use turbo_tasks::{FxIndexMap, ResolvedVc, TryFlatJoinIterExt, ValueToString, Vc};\n use turbo_tasks_fs::{self, File, FileSystemPath, rope::RopeBuilder};\n use turbopack_core::{\n     asset::AssetContent,\n@@ -134,7 +134,7 @@ pub(crate) async fn build_server_actions_loader(\n     let module = asset_context\n         .process(\n             Vc::upcast(source),\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(import_map))),\n+            ReferenceType::Internal(ResolvedVc::cell(import_map)),\n         )\n         .module();\n \n@@ -213,9 +213,7 @@ pub async fn to_rsc_context(\n     let module = asset_context\n         .process(\n             Vc::upcast(source),\n-            Value::new(ReferenceType::EcmaScriptModules(\n-                EcmaScriptModulesReferenceSubType::Undefined,\n-            )),\n+            ReferenceType::EcmaScriptModules(EcmaScriptModulesReferenceSubType::Undefined),\n         )\n         .module()\n         .to_resolved()"
        },
        {
            "sha": "e19b63a7ec99e2f0282ff4b0e591b2f31e0a6d43",
            "filename": "crates/next-core/src/base_loader_tree.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fbase_loader_tree.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fbase_loader_tree.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fbase_loader_tree.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::Result;\n use indoc::formatdoc;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{FxIndexMap, ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::{ModuleAssetContext, transition::Transition};\n use turbopack_core::{\n@@ -74,9 +74,8 @@ impl BaseLoaderTreeBuilder {\n     }\n \n     pub fn process_source(&self, source: Vc<Box<dyn Source>>) -> Vc<Box<dyn Module>> {\n-        let reference_type = Value::new(ReferenceType::EcmaScriptModules(\n-            EcmaScriptModulesReferenceSubType::Undefined,\n-        ));\n+        let reference_type =\n+            ReferenceType::EcmaScriptModules(EcmaScriptModulesReferenceSubType::Undefined);\n \n         self.server_component_transition\n             .process(source, *self.module_asset_context, reference_type)"
        },
        {
            "sha": "8f2f2d087e0e31dda5a131eacd03491c77ba1fd2",
            "filename": "crates/next-core/src/bootstrap.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fbootstrap.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fbootstrap.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fbootstrap.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::{Context, Result, bail};\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{FxIndexMap, ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::{File, FileSystemPath};\n use turbopack_core::{\n     asset::AssetContent,\n@@ -85,9 +85,7 @@ pub async fn bootstrap(\n                     .into(),\n                 ),\n             )),\n-            Value::new(ReferenceType::Internal(\n-                InnerAssets::empty().to_resolved().await?,\n-            )),\n+            ReferenceType::Internal(InnerAssets::empty().to_resolved().await?),\n         )\n         .module()\n         .to_resolved()\n@@ -100,7 +98,7 @@ pub async fn bootstrap(\n     let asset = asset_context\n         .process(\n             bootstrap_asset,\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(inner_assets))),\n+            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module()\n         .to_resolved()"
        },
        {
            "sha": "aafc7e9e098511263664e7321982f9703a058b2f",
            "filename": "crates/next-core/src/middleware.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fmiddleware.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fmiddleware.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fmiddleware.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Value, Vc, fxindexmap};\n+use turbo_tasks::{FxIndexMap, ResolvedVc, Vc, fxindexmap};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{context::AssetContext, module::Module, reference_type::ReferenceType};\n \n@@ -49,7 +49,7 @@ pub async fn get_middleware_module(\n     let module = asset_context\n         .process(\n             source,\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(inner_assets))),\n+            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();\n "
        },
        {
            "sha": "a9468f60e4a802f44bf0b1269dd85b782e2c7746",
            "filename": "crates/next-core/src/next_app/app_page_entry.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_page_entry.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -2,7 +2,7 @@ use std::io::Write;\n \n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, ValueToString, Vc, fxindexmap};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, ValueToString, Vc, fxindexmap};\n use turbo_tasks_fs::{self, File, FileSystemPath, rope::RopeBuilder};\n use turbopack::ModuleAssetContext;\n use turbopack_core::{\n@@ -116,7 +116,7 @@ pub async fn get_app_page_entry(\n     let mut rsc_entry = module_asset_context\n         .process(\n             Vc::upcast(source),\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(inner_assets))),\n+            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();\n \n@@ -196,7 +196,7 @@ async fn wrap_edge_page(\n     let wrapped = asset_context\n         .process(\n             Vc::upcast(source),\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(inner_assets))),\n+            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();\n "
        },
        {
            "sha": "085e75e8aa81e8104ace18919fded78e6658ba69",
            "filename": "crates/next-core/src/next_app/app_route_entry.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_route_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_route_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_route_entry.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc, fxindexmap};\n+use turbo_tasks::{ResolvedVc, ValueToString, Vc, fxindexmap};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack::ModuleAssetContext;\n use turbopack_core::{\n@@ -93,7 +93,7 @@ pub async fn get_app_route_entry(\n     let userland_module = module_asset_context\n         .process(\n             source,\n-            Value::new(ReferenceType::Entry(EntryReferenceSubType::AppRoute)),\n+            ReferenceType::Entry(EntryReferenceSubType::AppRoute),\n         )\n         .module()\n         .to_resolved()\n@@ -106,7 +106,7 @@ pub async fn get_app_route_entry(\n     let mut rsc_entry = module_asset_context\n         .process(\n             Vc::upcast(virtual_source),\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(inner_assets))),\n+            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();\n \n@@ -162,7 +162,7 @@ async fn wrap_edge_route(\n     let wrapped = asset_context\n         .process(\n             Vc::upcast(source),\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(inner_assets))),\n+            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();\n "
        },
        {
            "sha": "85cdab0196f4a8ce2d8b7c16437a25ea62f2922b",
            "filename": "crates/next-core/src/next_app/metadata/image.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fmetadata%2Fimage.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fmetadata%2Fimage.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fmetadata%2Fimage.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -75,9 +75,7 @@ pub async fn dynamic_image_metadata_source(\n     let module = asset_context\n         .process(\n             source,\n-            turbo_tasks::Value::new(ReferenceType::EcmaScriptModules(\n-                EcmaScriptModulesReferenceSubType::Undefined,\n-            )),\n+            ReferenceType::EcmaScriptModules(EcmaScriptModulesReferenceSubType::Undefined),\n         )\n         .module();\n     let exports = &*collect_direct_exports(module).await?;"
        },
        {
            "sha": "ec927de6cb51fa25b9f0843fb7a423f52f58bc0d",
            "filename": "crates/next-core/src/next_client_reference/css_client_reference/css_client_reference_transition.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fcss_client_reference%2Fcss_client_reference_transition.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fcss_client_reference%2Fcss_client_reference_transition.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fcss_client_reference%2Fcss_client_reference_transition.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::{Context, Result};\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbopack::{ModuleAssetContext, css::chunk::CssChunkPlaceable, transition::Transition};\n use turbopack_core::{context::ProcessResult, reference_type::ReferenceType, source::Source};\n \n@@ -25,7 +25,7 @@ impl Transition for NextCssClientReferenceTransition {\n         self: Vc<Self>,\n         source: Vc<Box<dyn Source>>,\n         rsc_module_asset_context: Vc<ModuleAssetContext>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Result<Vc<ProcessResult>> {\n         let module =\n             self.await?"
        },
        {
            "sha": "f42389370c194e43e6df7a0f7f8bd5442d11ba2a",
            "filename": "crates/next-core/src/next_client_reference/ecmascript_client_reference/ecmascript_client_reference_module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -3,7 +3,7 @@ use std::{io::Write, iter::once};\n use anyhow::{Context, Result, bail};\n use indoc::writedoc;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::File;\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -160,10 +160,7 @@ impl EcmascriptClientReferenceModule {\n \n         let proxy_module = self\n             .server_asset_context\n-            .process(\n-                Vc::upcast(proxy_source),\n-                Value::new(ReferenceType::Undefined),\n-            )\n+            .process(Vc::upcast(proxy_source), ReferenceType::Undefined)\n             .module();\n \n         let Some(proxy_module) ="
        },
        {
            "sha": "a9a5784a03a0590416a829aa8d0e8c9b3f5990f9",
            "filename": "crates/next-core/src/next_client_reference/ecmascript_client_reference/ecmascript_client_reference_transition.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_transition.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_transition.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_transition.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::{Result, bail};\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbopack::{ModuleAssetContext, transition::Transition};\n use turbopack_core::{\n     context::ProcessResult,\n@@ -39,9 +39,9 @@ impl Transition for NextEcmascriptClientReferenceTransition {\n         self: Vc<Self>,\n         source: Vc<Box<dyn Source>>,\n         module_asset_context: Vc<ModuleAssetContext>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Result<Vc<ProcessResult>> {\n-        let part = match &*reference_type {\n+        let part = match reference_type {\n             ReferenceType::EcmaScriptModules(EcmaScriptModulesReferenceSubType::ImportPart(\n                 part,\n             )) => Some(part),\n@@ -76,9 +76,7 @@ impl Transition for NextEcmascriptClientReferenceTransition {\n         let client_module = this.client_transition.process(\n             client_source,\n             module_asset_context,\n-            Value::new(ReferenceType::Entry(\n-                EntryReferenceSubType::AppClientComponent,\n-            )),\n+            ReferenceType::Entry(EntryReferenceSubType::AppClientComponent),\n         );\n         let ProcessResult::Module(client_module) = *client_module.await? else {\n             return Ok(ProcessResult::Ignore.cell());\n@@ -87,9 +85,7 @@ impl Transition for NextEcmascriptClientReferenceTransition {\n         let ssr_module = this.ssr_transition.process(\n             source,\n             module_asset_context,\n-            Value::new(ReferenceType::Entry(\n-                EntryReferenceSubType::AppClientComponent,\n-            )),\n+            ReferenceType::Entry(EntryReferenceSubType::AppClientComponent),\n         );\n \n         let ProcessResult::Module(ssr_module) = *ssr_module.await? else {"
        },
        {
            "sha": "9ee71b323a4aadfb0b72698302e1a931c6d2a595",
            "filename": "crates/next-core/src/next_dynamic/dynamic_transition.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 8,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_transition.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_transition.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_dynamic%2Fdynamic_transition.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::{Result, bail};\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbopack::{ModuleAssetContext, transition::Transition};\n use turbopack_core::{\n     context::{AssetContext, ProcessResult},\n@@ -49,16 +49,14 @@ impl Transition for NextDynamicTransition {\n         self: Vc<Self>,\n         source: Vc<Box<dyn Source>>,\n         module_asset_context: Vc<ModuleAssetContext>,\n-        _reference_type: Value<ReferenceType>,\n+        _reference_type: ReferenceType,\n     ) -> Result<Vc<ProcessResult>> {\n         let module_asset_context = self.process_context(module_asset_context);\n         let module = match self.await?.client_transition {\n-            Some(client_transition) => client_transition.process(\n-                source,\n-                module_asset_context,\n-                Value::new(ReferenceType::Undefined),\n-            ),\n-            None => module_asset_context.process(source, Value::new(ReferenceType::Undefined)),\n+            Some(client_transition) => {\n+                client_transition.process(source, module_asset_context, ReferenceType::Undefined)\n+            }\n+            None => module_asset_context.process(source, ReferenceType::Undefined),\n         };\n \n         Ok(match &*module.try_into_module().await? {"
        },
        {
            "sha": "c020fcf05374b9570e053d952cdba7cf172a310a",
            "filename": "crates/next-core/src/next_edge/entry.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fentry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fentry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fentry.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,6 +1,6 @@\n use indoc::formatdoc;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, Vc, fxindexmap};\n+use turbo_tasks::{ResolvedVc, Vc, fxindexmap};\n use turbo_tasks_fs::{File, FileSystemPath};\n use turbopack_core::{\n     asset::AssetContent, context::AssetContext, module::Module, reference_type::ReferenceType,\n@@ -56,7 +56,7 @@ pub async fn wrap_edge_entry(\n     asset_context\n         .process(\n             Vc::upcast(virtual_source),\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(inner_assets))),\n+            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module()\n }"
        },
        {
            "sha": "1f2216e0151bd2f4b1734405901efe77cba7ef5a",
            "filename": "crates/next-core/src/next_font/google/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Fgoogle%2Fmod.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -714,9 +714,7 @@ async fn get_mock_stylesheet(\n                     .into(),\n                 ),\n             )),\n-            Value::new(ReferenceType::Internal(\n-                InnerAssets::empty().to_resolved().await?,\n-            )),\n+            ReferenceType::Internal(InnerAssets::empty().to_resolved().await?),\n         )\n         .module();\n "
        },
        {
            "sha": "6470d8b06cb0e1bd1e60475b5e8da570acfcd536",
            "filename": "crates/next-core/src/next_font/local/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_font%2Flocal%2Fmod.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -77,7 +77,7 @@ impl BeforeResolvePlugin for NextFontLocalResolvePlugin {\n     async fn before_resolve(\n         self: Vc<Self>,\n         lookup_path: Vc<FileSystemPath>,\n-        _reference_type: Value<ReferenceType>,\n+        _reference_type: ReferenceType,\n         request_vc: Vc<Request>,\n     ) -> Result<Vc<ResolveResultOption>> {\n         let this = &*self.await?;"
        },
        {
            "sha": "a66ab69e348223505980f31b90cd16c9796d0a3a",
            "filename": "crates/next-core/src/next_image/module.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_image%2Fmodule.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -50,9 +50,9 @@ impl StructuredImageModuleType {\n                     }\n                     .cell(),\n                 ),\n-                Value::new(ReferenceType::Internal(ResolvedVc::cell(fxindexmap!(\n+                ReferenceType::Internal(ResolvedVc::cell(fxindexmap!(\n                     \"IMAGE\".into() => ResolvedVc::upcast(static_asset)\n-                )))),\n+                ))),\n             )\n             .module())\n     }"
        },
        {
            "sha": "2249ec35dae59817234b07c47382cc78d1c63417",
            "filename": "crates/next-core/src/next_import_map.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1011,7 +1011,7 @@ async fn insert_next_shared_aliases(\n pub async fn get_next_package(context_directory: Vc<FileSystemPath>) -> Result<Vc<FileSystemPath>> {\n     let result = resolve(\n         context_directory,\n-        Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined)),\n+        ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n         Request::parse(Value::new(Pattern::Constant(rcstr!(\"next/package.json\")))),\n         node_cjs_resolve_options(context_directory.root()),\n     );"
        },
        {
            "sha": "9a1d26ca13b24041a27db5f4d5f1f30a859cc634",
            "filename": "crates/next-core/src/next_pages/page_entry.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 11,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_pages%2Fpage_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_pages%2Fpage_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_pages%2Fpage_entry.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -3,7 +3,7 @@ use std::io::Write;\n use anyhow::{Result, bail};\n use serde::Serialize;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Value, Vc, fxindexmap};\n+use turbo_tasks::{FxIndexMap, ResolvedVc, Vc, fxindexmap};\n use turbo_tasks_fs::{File, FileSystemPath, rope::RopeBuilder};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -33,7 +33,7 @@ pub struct PageSsrEntryModule {\n #[turbo_tasks::function]\n pub async fn create_page_ssr_entry_module(\n     pathname: RcStr,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     project_root: Vc<FileSystemPath>,\n     ssr_module_context: Vc<Box<dyn AssetContext>>,\n     source: Vc<Box<dyn Source>>,\n@@ -51,8 +51,6 @@ pub async fn create_page_ssr_entry_module(\n         .to_resolved()\n         .await?;\n \n-    let reference_type = reference_type.into_value();\n-\n     let template_file = match (&reference_type, runtime) {\n         (ReferenceType::Entry(EntryReferenceSubType::Page), _) => {\n             // Load the Page entry file.\n@@ -129,14 +127,14 @@ pub async fn create_page_ssr_entry_module(\n         if reference_type == ReferenceType::Entry(EntryReferenceSubType::Page) {\n             let document_module = process_global_item(\n                 *pages_structure_ref.document,\n-                Value::new(reference_type.clone()),\n+                reference_type.clone(),\n                 ssr_module_context,\n             )\n             .to_resolved()\n             .await?;\n             let app_module = process_global_item(\n                 *pages_structure_ref.app,\n-                Value::new(reference_type.clone()),\n+                reference_type.clone(),\n                 ssr_module_context,\n             )\n             .to_resolved()\n@@ -151,7 +149,7 @@ pub async fn create_page_ssr_entry_module(\n     let mut ssr_module = ssr_module_context\n         .process(\n             source,\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(inner_assets))),\n+            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();\n \n@@ -163,7 +161,7 @@ pub async fn create_page_ssr_entry_module(\n                 ssr_module,\n                 definition_page.clone(),\n                 definition_pathname.clone(),\n-                Value::new(reference_type),\n+                reference_type,\n                 pages_structure,\n                 next_config,\n             );\n@@ -188,7 +186,7 @@ pub async fn create_page_ssr_entry_module(\n #[turbo_tasks::function]\n fn process_global_item(\n     item: Vc<PagesStructureItem>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     module_context: Vc<Box<dyn AssetContext>>,\n ) -> Vc<Box<dyn Module>> {\n     let source = Vc::upcast(FileSource::new(item.file_path()));\n@@ -202,7 +200,7 @@ async fn wrap_edge_page(\n     entry: ResolvedVc<Box<dyn Module>>,\n     page: RcStr,\n     pathname: RcStr,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     pages_structure: Vc<PagesStructure>,\n     next_config: Vc<NextConfig>,\n ) -> Result<Vc<Box<dyn Module>>> {\n@@ -288,7 +286,7 @@ async fn wrap_edge_page(\n     let wrapped = asset_context\n         .process(\n             Vc::upcast(source),\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(inner_assets))),\n+            ReferenceType::Internal(ResolvedVc::cell(inner_assets)),\n         )\n         .module();\n "
        },
        {
            "sha": "61dbda1c2d8106b04da9dc5062135abea7a787f4",
            "filename": "crates/next-core/src/next_server/resolve.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fresolve.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fresolve.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fresolve.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::Result;\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{NonLocalValue, ResolvedVc, Value, Vc, trace::TraceRawVcs};\n+use turbo_tasks::{NonLocalValue, ResolvedVc, Vc, trace::TraceRawVcs};\n use turbo_tasks_fs::{self, FileJsonContent, FileSystemPath, glob::Glob};\n use turbopack_core::{\n     issue::{Issue, IssueExt, IssueSeverity, IssueStage, OptionStyledString, StyledString},\n@@ -79,7 +79,7 @@ impl AfterResolvePlugin for ExternalCjsModulesResolvePlugin {\n         &self,\n         fs_path: ResolvedVc<FileSystemPath>,\n         lookup_path: ResolvedVc<FileSystemPath>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n         request: ResolvedVc<Request>,\n     ) -> Result<Vc<ResolveResultOption>> {\n         let request_value = &*request.await?;"
        },
        {
            "sha": "d7939f5e440d118d403957afe1a31cbab99a2a58",
            "filename": "crates/next-core/src/next_shared/resolve.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fresolve.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fresolve.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fresolve.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -132,7 +132,7 @@ impl BeforeResolvePlugin for InvalidImportResolvePlugin {\n     fn before_resolve(\n         &self,\n         lookup_path: ResolvedVc<FileSystemPath>,\n-        _reference_type: Value<ReferenceType>,\n+        _reference_type: ReferenceType,\n         _request: Vc<Request>,\n     ) -> Vc<ResolveResultOption> {\n         InvalidImportModuleIssue {\n@@ -231,7 +231,7 @@ impl AfterResolvePlugin for NextExternalResolvePlugin {\n         &self,\n         fs_path: Vc<FileSystemPath>,\n         _lookup_path: Vc<FileSystemPath>,\n-        _reference_type: Value<ReferenceType>,\n+        _reference_type: ReferenceType,\n         _request: Vc<Request>,\n     ) -> Result<Vc<ResolveResultOption>> {\n         let path = fs_path.await?.path.to_string();\n@@ -289,7 +289,7 @@ impl AfterResolvePlugin for NextNodeSharedRuntimeResolvePlugin {\n         &self,\n         fs_path: Vc<FileSystemPath>,\n         _lookup_path: Vc<FileSystemPath>,\n-        _reference_type: Value<ReferenceType>,\n+        _reference_type: ReferenceType,\n         _request: Vc<Request>,\n     ) -> Result<Vc<ResolveResultOption>> {\n         let stem = fs_path.file_stem().await?;\n@@ -357,7 +357,7 @@ impl BeforeResolvePlugin for ModuleFeatureReportResolvePlugin {\n     async fn before_resolve(\n         &self,\n         _lookup_path: Vc<FileSystemPath>,\n-        _reference_type: Value<ReferenceType>,\n+        _reference_type: ReferenceType,\n         request: Vc<Request>,\n     ) -> Result<Vc<ResolveResultOption>> {\n         if let Request::Module {\n@@ -413,7 +413,7 @@ impl AfterResolvePlugin for NextSharedRuntimeResolvePlugin {\n         &self,\n         fs_path: Vc<FileSystemPath>,\n         _lookup_path: Vc<FileSystemPath>,\n-        _reference_type: Value<ReferenceType>,\n+        _reference_type: ReferenceType,\n         _request: Vc<Request>,\n     ) -> Result<Vc<ResolveResultOption>> {\n         let raw_fs_path = &*fs_path.await?;"
        },
        {
            "sha": "eafad1f7a19c99b29dfe6838935af7fe7eaa2a21",
            "filename": "crates/next-core/src/next_shared/transforms/swc_ecma_transform_plugins.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fswc_ecma_transform_plugins.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fswc_ecma_transform_plugins.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Ftransforms%2Fswc_ecma_transform_plugins.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -72,12 +72,12 @@ pub async fn get_swc_ecma_transform_rule_impl(\n             let plugin_wasm_module_resolve_result = handle_resolve_error(\n                 resolve(\n                     *project_path,\n-                    Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined)),\n+                    ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n                     request,\n                     resolve_options,\n                 )\n                 .as_raw_module_result(),\n-                Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined)),\n+                ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n                 // TODO proper error location\n                 *project_path,\n                 request,"
        },
        {
            "sha": "503b0e48a920012d4031c3ee77af0ed829fa4305",
            "filename": "crates/next-core/src/next_shared/webpack_rules/babel.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fwebpack_rules%2Fbabel.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fwebpack_rules%2Fbabel.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_shared%2Fwebpack_rules%2Fbabel.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -114,7 +114,7 @@ pub async fn maybe_add_babel_loader(\n pub async fn is_babel_loader_available(project_path: Vc<FileSystemPath>) -> Result<Vc<bool>> {\n     let result = resolve(\n         project_path,\n-        Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined)),\n+        ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n         Request::parse(Value::new(Pattern::Constant(\n             \"babel-loader/package.json\".into(),\n         ))),"
        },
        {
            "sha": "42320b8c73037c16d45f0611afe16be1e34b8ddc",
            "filename": "crates/next-core/src/page_loader.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fpage_loader.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/crates%2Fnext-core%2Fsrc%2Fpage_loader.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fpage_loader.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -2,7 +2,7 @@ use std::io::Write;\n \n use anyhow::{Result, bail};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc, fxindexmap};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc, fxindexmap};\n use turbo_tasks_fs::{\n     self, File, FileContent, FileSystemPath, FileSystemPathOption, rope::RopeBuilder,\n };\n@@ -48,7 +48,7 @@ pub async fn create_page_loader_entry_module(\n     let module = client_context\n         .process(\n             entry_asset,\n-            Value::new(ReferenceType::Entry(EntryReferenceSubType::Page)),\n+            ReferenceType::Entry(EntryReferenceSubType::Page),\n         )\n         .module()\n         .to_resolved()\n@@ -57,9 +57,9 @@ pub async fn create_page_loader_entry_module(\n     let module = client_context\n         .process(\n             virtual_source,\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n+            ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n                 rcstr!(\"PAGE\") => module,\n-            }))),\n+            })),\n         )\n         .module();\n     Ok(module)"
        },
        {
            "sha": "ba60d0e60b67767141a1f88f9ce2ebf94afe41e5",
            "filename": "turbopack/crates/turbopack-browser/src/react_refresh.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Freact_refresh.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Freact_refresh.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Freact_refresh.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::rcstr;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     issue::{Issue, IssueExt, IssueSeverity, IssueStage, OptionStyledString, StyledString},\n@@ -58,7 +58,7 @@ pub async fn assert_can_resolve_react_refresh(\n     for request in [react_refresh_request_in_next(), react_refresh_request()] {\n         let result = turbopack_core::resolve::resolve(\n             *path,\n-            Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined)),\n+            ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n             request,\n             resolve_options,\n         )"
        },
        {
            "sha": "3c1be9b35a20349d1c332a6787ec51bf8d041900",
            "filename": "turbopack/crates/turbopack-cli/src/build/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -282,7 +282,7 @@ async fn build_internal(\n         entry_requests\n             .into_iter()\n             .map(|request_vc| async move {\n-                let ty = Value::new(ReferenceType::Entry(EntryReferenceSubType::Undefined));\n+                let ty = ReferenceType::Entry(EntryReferenceSubType::Undefined);\n                 let request = request_vc.await?;\n                 origin\n                     .resolve_asset(request_vc, origin.resolve_options(ty.clone()), ty)"
        },
        {
            "sha": "9848462acf4aba82785fb4ad24060d19024d3b1f",
            "filename": "turbopack/crates/turbopack-cli/src/dev/web_entry_source.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fweb_entry_source.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fweb_entry_source.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fweb_entry_source.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::{Result, anyhow};\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Value, Vc};\n+use turbo_tasks::{ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Vc};\n use turbo_tasks_env::ProcessEnv;\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_browser::{BrowserChunkingContext, react_refresh::assert_can_resolve_react_refresh};\n@@ -131,7 +131,7 @@ pub async fn create_web_entry_source(\n     let entries = entry_requests\n         .into_iter()\n         .map(|request| async move {\n-            let ty = Value::new(ReferenceType::Entry(EntryReferenceSubType::Web));\n+            let ty = ReferenceType::Entry(EntryReferenceSubType::Web);\n             Ok(origin\n                 .resolve_asset(request, origin.resolve_options(ty.clone()), ty)\n                 .await?"
        },
        {
            "sha": "0df6885bedc5c68964f9dcb1669a0de1bc84edfd",
            "filename": "turbopack/crates/turbopack-core/src/chunk/evaluate.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fevaluate.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fevaluate.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fevaluate.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::{Result, bail};\n-use turbo_tasks::{ResolvedVc, Upcast, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, Upcast, ValueToString, Vc};\n \n use super::ChunkableModule;\n use crate::{\n@@ -42,10 +42,7 @@ async fn to_evaluatable(\n     asset_context: Vc<Box<dyn AssetContext>>,\n ) -> Result<Vc<Box<dyn EvaluatableAsset>>> {\n     let module = asset_context\n-        .process(\n-            asset,\n-            Value::new(ReferenceType::Entry(EntryReferenceSubType::Runtime)),\n-        )\n+        .process(asset, ReferenceType::Entry(EntryReferenceSubType::Runtime))\n         .module();\n     let Some(entry) = Vc::try_resolve_downcast::<Box<dyn EvaluatableAsset>>(module).await? else {\n         bail!("
        },
        {
            "sha": "b5a891e6ee3aca609dfcf7c5a0c44fcfb9f55380",
            "filename": "turbopack/crates/turbopack-core/src/context.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fcontext.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::{Result, bail};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n \n use crate::{\n@@ -69,7 +69,7 @@ pub trait AssetContext {\n     fn resolve_options(\n         self: Vc<Self>,\n         origin_path: Vc<FileSystemPath>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Vc<ResolveOptions>;\n \n     /// Resolves an request to an [ModuleResolveResult].\n@@ -78,21 +78,21 @@ pub trait AssetContext {\n         origin_path: Vc<FileSystemPath>,\n         request: Vc<Request>,\n         resolve_options: Vc<ResolveOptions>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Vc<ModuleResolveResult>;\n \n     /// Process a source into a module.\n     fn process(\n         self: Vc<Self>,\n         asset: Vc<Box<dyn Source>>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Vc<ProcessResult>;\n \n     /// Process an [ResolveResult] into an [ModuleResolveResult].\n     fn process_resolve_result(\n         self: Vc<Self>,\n         result: Vc<ResolveResult>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Vc<ModuleResolveResult>;\n \n     /// Gets a new AssetContext with the transition applied."
        },
        {
            "sha": "2cdbeb2f5f6f0207effefbc1e51bfa4d3d16fd4b",
            "filename": "turbopack/crates/turbopack-core/src/reference_type.rs",
            "status": "modified",
            "additions": 115,
            "deletions": 20,
            "changes": 135,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference_type.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference_type.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference_type.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -2,11 +2,11 @@ use std::fmt::Display;\n \n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{FxIndexMap, ResolvedVc, Vc};\n+use turbo_tasks::{FxIndexMap, NonLocalValue, ResolvedVc, TaskInput, Vc, trace::TraceRawVcs};\n \n use crate::{module::Module, resolve::ModulePart};\n \n-/// Named references to inner assets. Modules can used them to allow to\n+/// Named references to inner assets. Modules can use them to allow to\n /// per-module aliases of some requests to already created module assets.\n ///\n /// Name is usually in UPPER_CASE to make it clear that this is an inner asset.\n@@ -27,22 +27,54 @@ impl InnerAssets {\n // TODO when plugins are supported, replace u8 with a trait that defines the\n // behavior.\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Default, Clone, Hash)]\n+#[derive(\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    serde::Serialize,\n+    serde::Deserialize,\n+    Debug,\n+    Default,\n+    Clone,\n+    Hash,\n+    TaskInput,\n+)]\n pub enum CommonJsReferenceSubType {\n     Custom(u8),\n     #[default]\n     Undefined,\n }\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Clone, Hash)]\n+#[derive(\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    serde::Serialize,\n+    serde::Deserialize,\n+    Debug,\n+    Clone,\n+    Hash,\n+    TaskInput,\n+)]\n pub enum ImportWithType {\n     Json,\n }\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Default, Clone, Hash)]\n+#[derive(\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    serde::Serialize,\n+    serde::Deserialize,\n+    Debug,\n+    Default,\n+    Clone,\n+    Hash,\n+    TaskInput,\n+)]\n pub enum EcmaScriptModulesReferenceSubType {\n     ImportPart(ModulePart),\n     Import,\n@@ -170,8 +202,19 @@ impl ImportContext {\n     }\n }\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Default, Clone, Hash)]\n+#[derive(\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    serde::Serialize,\n+    serde::Deserialize,\n+    Debug,\n+    Default,\n+    Clone,\n+    Hash,\n+    TaskInput,\n+)]\n pub enum CssReferenceSubType {\n     AtImport(Option<ResolvedVc<ImportContext>>),\n     /// Reference from ModuleCssAsset to an imported ModuleCssAsset for retrieving the composed\n@@ -186,8 +229,19 @@ pub enum CssReferenceSubType {\n     Undefined,\n }\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Default, Clone, Hash)]\n+#[derive(\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    serde::Serialize,\n+    serde::Deserialize,\n+    Debug,\n+    Default,\n+    Clone,\n+    Hash,\n+    TaskInput,\n+)]\n pub enum UrlReferenceSubType {\n     EcmaScriptNewUrl,\n     CssUrl,\n@@ -196,15 +250,35 @@ pub enum UrlReferenceSubType {\n     Undefined,\n }\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Clone, Hash)]\n+#[derive(\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    serde::Serialize,\n+    serde::Deserialize,\n+    Debug,\n+    Clone,\n+    Hash,\n+    TaskInput,\n+)]\n pub enum TypeScriptReferenceSubType {\n     Custom(u8),\n     Undefined,\n }\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Clone, Hash)]\n+#[derive(\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    serde::Serialize,\n+    serde::Deserialize,\n+    Debug,\n+    Clone,\n+    Hash,\n+    TaskInput,\n+)]\n pub enum WorkerReferenceSubType {\n     WebWorker,\n     SharedWorker,\n@@ -215,8 +289,18 @@ pub enum WorkerReferenceSubType {\n \n // TODO(sokra) this was next.js specific values. We want to solve this in a\n // different way.\n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Clone, Hash)]\n+#[derive(\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    serde::Serialize,\n+    serde::Deserialize,\n+    Debug,\n+    Clone,\n+    Hash,\n+    TaskInput,\n+)]\n pub enum EntryReferenceSubType {\n     Web,\n     Page,\n@@ -231,8 +315,19 @@ pub enum EntryReferenceSubType {\n     Undefined,\n }\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Debug, Default, Clone, Hash)]\n+#[derive(\n+    PartialEq,\n+    Eq,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    serde::Serialize,\n+    serde::Deserialize,\n+    Debug,\n+    Default,\n+    Clone,\n+    Hash,\n+    TaskInput,\n+)]\n pub enum ReferenceType {\n     CommonJs(CommonJsReferenceSubType),\n     EcmaScriptModules(EcmaScriptModulesReferenceSubType),"
        },
        {
            "sha": "fb5bf1c87692cbbacef3ad30ce4759f83a1f487d",
            "filename": "turbopack/crates/turbopack-core/src/resolve/mod.rs",
            "status": "modified",
            "additions": 12,
            "deletions": 13,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1560,11 +1560,11 @@ pub async fn resolve_raw(\n #[turbo_tasks::function]\n pub async fn resolve(\n     lookup_path: Vc<FileSystemPath>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     request: Vc<Request>,\n     options: Vc<ResolveOptions>,\n ) -> Result<Vc<ResolveResult>> {\n-    resolve_inline(lookup_path, reference_type.into_value(), request, options).await\n+    resolve_inline(lookup_path, reference_type, request, options).await\n }\n \n pub async fn resolve_inline(\n@@ -1584,7 +1584,6 @@ pub async fn resolve_inline(\n         )\n     };\n     async {\n-        let reference_type = Value::new(reference_type);\n         let before_plugins_result =\n             handle_before_resolve_plugins(lookup_path, reference_type.clone(), request, options)\n                 .await?;\n@@ -1611,7 +1610,7 @@ pub async fn resolve_inline(\n pub async fn url_resolve(\n     origin: Vc<Box<dyn ResolveOrigin>>,\n     request: Vc<Request>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     issue_source: Option<IssueSource>,\n     is_optional: bool,\n ) -> Result<Vc<ModuleResolveResult>> {\n@@ -1659,7 +1658,7 @@ pub async fn url_resolve(\n #[tracing::instrument(level = \"trace\", skip_all)]\n async fn handle_before_resolve_plugins(\n     lookup_path: Vc<FileSystemPath>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     request: Vc<Request>,\n     options: Vc<ResolveOptions>,\n ) -> Result<Option<Vc<ResolveResult>>> {\n@@ -1682,15 +1681,15 @@ async fn handle_before_resolve_plugins(\n #[tracing::instrument(level = \"trace\", skip_all)]\n async fn handle_after_resolve_plugins(\n     lookup_path: Vc<FileSystemPath>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     request: Vc<Request>,\n     options: Vc<ResolveOptions>,\n     result: Vc<ResolveResult>,\n ) -> Result<Vc<ResolveResult>> {\n     async fn apply_plugins_to_path(\n         path: Vc<FileSystemPath>,\n         lookup_path: Vc<FileSystemPath>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n         request: Vc<Request>,\n         options: Vc<ResolveOptions>,\n     ) -> Result<Option<Vc<ResolveResult>>> {\n@@ -2990,7 +2989,7 @@ async fn resolve_package_internal_with_imports_field(\n \n pub async fn handle_resolve_error(\n     result: Vc<ModuleResolveResult>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     origin_path: Vc<FileSystemPath>,\n     request: Vc<Request>,\n     resolve_options: Vc<ResolveOptions>,\n@@ -3034,7 +3033,7 @@ pub async fn handle_resolve_error(\n \n pub async fn handle_resolve_source_error(\n     result: Vc<ResolveResult>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     origin_path: Vc<FileSystemPath>,\n     request: Vc<Request>,\n     resolve_options: Vc<ResolveOptions>,\n@@ -3079,7 +3078,7 @@ pub async fn handle_resolve_source_error(\n async fn emit_resolve_error_issue(\n     is_optional: bool,\n     origin_path: Vc<FileSystemPath>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     request: Vc<Request>,\n     resolve_options: Vc<ResolveOptions>,\n     err: anyhow::Error,\n@@ -3093,7 +3092,7 @@ async fn emit_resolve_error_issue(\n     ResolvingIssue {\n         severity,\n         file_path: origin_path.to_resolved().await?,\n-        request_type: format!(\"{} request\", reference_type.into_value()),\n+        request_type: format!(\"{reference_type} request\"),\n         request: request.to_resolved().await?,\n         resolve_options: resolve_options.to_resolved().await?,\n         error_message: Some(format!(\"{}\", PrettyPrintError(&err))),\n@@ -3107,7 +3106,7 @@ async fn emit_resolve_error_issue(\n async fn emit_unresolvable_issue(\n     is_optional: bool,\n     origin_path: Vc<FileSystemPath>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     request: Vc<Request>,\n     resolve_options: Vc<ResolveOptions>,\n     source: Option<IssueSource>,\n@@ -3120,7 +3119,7 @@ async fn emit_unresolvable_issue(\n     ResolvingIssue {\n         severity,\n         file_path: origin_path.to_resolved().await?,\n-        request_type: format!(\"{} request\", reference_type.into_value()),\n+        request_type: format!(\"{reference_type} request\"),\n         request: request.to_resolved().await?,\n         resolve_options: resolve_options.to_resolved().await?,\n         error_message: None,"
        },
        {
            "sha": "55db5c9b8c7872860818a8b1fbe65c086e110839",
            "filename": "turbopack/crates/turbopack-core/src/resolve/origin.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Forigin.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Forigin.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Forigin.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -2,7 +2,7 @@ use std::future::Future;\n \n use anyhow::Result;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Upcast, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Upcast, Vc};\n use turbo_tasks_fs::FileSystemPath;\n \n use super::{ModuleResolveResult, options::ResolveOptions, parse::Request};\n@@ -40,11 +40,11 @@ pub trait ResolveOriginExt: Send {\n         self: Vc<Self>,\n         request: Vc<Request>,\n         options: Vc<ResolveOptions>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> impl Future<Output = Result<Vc<ModuleResolveResult>>> + Send;\n \n     /// Get the resolve options that apply for this origin.\n-    fn resolve_options(self: Vc<Self>, reference_type: Value<ReferenceType>) -> Vc<ResolveOptions>;\n+    fn resolve_options(self: Vc<Self>, reference_type: ReferenceType) -> Vc<ResolveOptions>;\n \n     /// Adds a transition that is used for resolved assets.\n     fn with_transition(self: ResolvedVc<Self>, transition: RcStr) -> Vc<Box<dyn ResolveOrigin>>;\n@@ -58,12 +58,12 @@ where\n         self: Vc<Self>,\n         request: Vc<Request>,\n         options: Vc<ResolveOptions>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> impl Future<Output = Result<Vc<ModuleResolveResult>>> + Send {\n         resolve_asset(Vc::upcast(self), request, options, reference_type)\n     }\n \n-    fn resolve_options(self: Vc<Self>, reference_type: Value<ReferenceType>) -> Vc<ResolveOptions> {\n+    fn resolve_options(self: Vc<Self>, reference_type: ReferenceType) -> Vc<ResolveOptions> {\n         self.asset_context()\n             .resolve_options(self.origin_path(), reference_type)\n     }\n@@ -83,7 +83,7 @@ async fn resolve_asset(\n     resolve_origin: Vc<Box<dyn ResolveOrigin>>,\n     request: Vc<Request>,\n     options: Vc<ResolveOptions>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n ) -> Result<Vc<ModuleResolveResult>> {\n     if let Some(asset) = *resolve_origin.get_inner_asset(request).await? {\n         return Ok(*ModuleResolveResult::module(asset));"
        },
        {
            "sha": "8414ab4974ca6b4ccd40ec368cbce53ad52a40f3",
            "filename": "turbopack/crates/turbopack-core/src/resolve/plugin.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fplugin.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fplugin.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fplugin.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::Result;\n use rustc_hash::FxHashSet;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n \n use crate::{\n@@ -87,7 +87,7 @@ pub trait BeforeResolvePlugin {\n     fn before_resolve(\n         self: Vc<Self>,\n         lookup_path: Vc<FileSystemPath>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n         request: Vc<Request>,\n     ) -> Vc<ResolveResultOption>;\n }\n@@ -104,7 +104,7 @@ pub trait AfterResolvePlugin {\n         self: Vc<Self>,\n         fs_path: Vc<FileSystemPath>,\n         lookup_path: Vc<FileSystemPath>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n         request: Vc<Request>,\n     ) -> Vc<ResolveResultOption>;\n }"
        },
        {
            "sha": "f5cb930fb5745a7e60c8e6ed15bba0d1d3b23e99",
            "filename": "turbopack/crates/turbopack-css/src/module_asset.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 7,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fmodule_asset.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -84,9 +84,7 @@ impl Module for ModuleCssAsset {\n             .copied()\n             .chain(\n                 match *self\n-                    .inner(Value::new(ReferenceType::Css(\n-                        CssReferenceSubType::Internal,\n-                    )))\n+                    .inner(ReferenceType::Css(CssReferenceSubType::Internal))\n                     .try_into_module()\n                     .await?\n                 {\n@@ -160,15 +158,14 @@ struct ModuleCssClasses(FxIndexMap<String, Vec<ModuleCssClass>>);\n #[turbo_tasks::value_impl]\n impl ModuleCssAsset {\n     #[turbo_tasks::function]\n-    pub fn inner(&self, ty: Value<ReferenceType>) -> Vc<ProcessResult> {\n-        self.asset_context\n-            .process(*self.source, Value::new(ty.into_value()))\n+    pub fn inner(&self, ty: ReferenceType) -> Vc<ProcessResult> {\n+        self.asset_context.process(*self.source, ty)\n     }\n \n     #[turbo_tasks::function]\n     async fn classes(self: Vc<Self>) -> Result<Vc<ModuleCssClasses>> {\n         let inner = self\n-            .inner(Value::new(ReferenceType::Css(CssReferenceSubType::Analyze)))\n+            .inner(ReferenceType::Css(CssReferenceSubType::Analyze))\n             .module();\n \n         let inner = Vc::try_resolve_sidecast::<Box<dyn ProcessCss>>(inner)"
        },
        {
            "sha": "c052fb3b4fdb6206ec6b3a96b9fc384f62c8a679",
            "filename": "turbopack/crates/turbopack-css/src/references/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fmod.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -183,7 +183,7 @@ pub fn css_resolve(\n     url_resolve(\n         origin,\n         request,\n-        Value::new(ReferenceType::Css(ty.into_value())),\n+        ReferenceType::Css(ty.into_value()),\n         issue_source,\n         false,\n     )"
        },
        {
            "sha": "bc1e655bd9ffc4c51b56ebb7f30064224599353e",
            "filename": "turbopack/crates/turbopack-css/src/references/url.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Furl.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Furl.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Furl.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -8,7 +8,7 @@ use lightningcss::{\n };\n use rustc_hash::FxHashMap;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbopack_core::{\n     chunk::{ChunkableModuleReference, ChunkingContext},\n     issue::IssueSource,\n@@ -77,7 +77,7 @@ impl ModuleReference for UrlAssetReference {\n         url_resolve(\n             *self.origin,\n             *self.request,\n-            Value::new(ReferenceType::Url(UrlReferenceSubType::CssUrl)),\n+            ReferenceType::Url(UrlReferenceSubType::CssUrl),\n             Some(self.issue_source.clone()),\n             false,\n         )"
        },
        {
            "sha": "7340825dd34ef096acaf807388c0d35b1ddeaa48",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/url.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Furl.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Furl.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Furl.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -6,7 +6,7 @@ use swc_core::{\n };\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n-    NonLocalValue, ResolvedVc, TaskInput, Value, ValueToString, Vc, debug::ValueDebugFormat,\n+    NonLocalValue, ResolvedVc, TaskInput, ValueToString, Vc, debug::ValueDebugFormat,\n     trace::TraceRawVcs,\n };\n use turbopack_core::{\n@@ -106,7 +106,7 @@ impl ModuleReference for UrlAssetReference {\n         url_resolve(\n             *self.origin,\n             *self.request,\n-            Value::new(ReferenceType::Url(UrlReferenceSubType::EcmaScriptNewUrl)),\n+            ReferenceType::Url(UrlReferenceSubType::EcmaScriptNewUrl),\n             Some(self.issue_source.clone()),\n             self.in_try,\n         )"
        },
        {
            "sha": "286910a0097a2bb3b359c24929d979e98b5701cc",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -3507,14 +3507,14 @@ async fn resolve_as_webpack_runtime(\n     request: Vc<Request>,\n     transforms: Vc<EcmascriptInputTransforms>,\n ) -> Result<Vc<WebpackRuntime>> {\n-    let ty = Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined));\n+    let ty = ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined);\n     let options = origin.resolve_options(ty.clone());\n \n     let options = apply_cjs_specific_options(options);\n \n     let resolved = resolve(\n         origin.origin_path().parent().resolve().await?,\n-        Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined)),\n+        ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n         request,\n         options,\n     );"
        },
        {
            "sha": "1bc9ead997931b05d2bbb677c20d1c9b9ea1ff7c",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/typescript.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftypescript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftypescript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Ftypescript.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -85,9 +85,7 @@ impl ModuleReference for TsReferencePathAssetReference {\n                     .asset_context()\n                     .process(\n                         Vc::upcast(FileSource::new(**path)),\n-                        Value::new(ReferenceType::TypeScript(\n-                            TypeScriptReferenceSubType::Undefined,\n-                        )),\n+                        ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined),\n                     )\n                     .module()\n                     .to_resolved()"
        },
        {
            "sha": "e9bd748ffd435fff4d4715514d14fad77d14a5fc",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/worker.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fworker.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fworker.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fworker.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -7,8 +7,7 @@ use swc_core::{\n };\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    NonLocalValue, ResolvedVc, Value, ValueToString, Vc, debug::ValueDebugFormat,\n-    trace::TraceRawVcs,\n+    NonLocalValue, ResolvedVc, ValueToString, Vc, debug::ValueDebugFormat, trace::TraceRawVcs,\n };\n use turbopack_core::{\n     chunk::{ChunkableModule, ChunkableModuleReference, ChunkingContext},\n@@ -61,7 +60,7 @@ impl WorkerAssetReference {\n             *self.origin,\n             *self.request,\n             // TODO support more worker types\n-            Value::new(ReferenceType::Worker(WorkerReferenceSubType::WebWorker)),\n+            ReferenceType::Worker(WorkerReferenceSubType::WebWorker),\n             Some(self.issue_source.clone()),\n             self.in_try,\n         );"
        },
        {
            "sha": "66571cab2185a1dd693363326f0b40bc4222ef79",
            "filename": "turbopack/crates/turbopack-ecmascript/src/static_code.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fstatic_code.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fstatic_code.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fstatic_code.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,5 +1,5 @@\n use anyhow::{Result, bail};\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     code_builder::{Code, CodeBuilder},\n@@ -33,7 +33,7 @@ impl StaticEcmascriptCode {\n         let module = asset_context\n             .process(\n                 Vc::upcast(FileSource::new(*asset_path)),\n-                Value::new(ReferenceType::Runtime),\n+                ReferenceType::Runtime,\n             )\n             .module()\n             .to_resolved()"
        },
        {
            "sha": "2da57e0c9913e881a8b364b605455605b66e70a3",
            "filename": "turbopack/crates/turbopack-ecmascript/src/typescript/mod.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -54,9 +54,10 @@ impl Module for TsConfigModuleAsset {\n         let configs = read_tsconfigs(\n             self.source.content().file_content(),\n             self.source,\n-            apply_cjs_specific_options(self.origin.resolve_options(Value::new(\n-                ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n-            ))),\n+            apply_cjs_specific_options(\n+                self.origin\n+                    .resolve_options(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined)),\n+            ),\n         )\n         .await?;\n         references.extend("
        },
        {
            "sha": "13c2e31a3f05597eb674afe41444a9fd89a4d9e3",
            "filename": "turbopack/crates/turbopack-ecmascript/src/webpack/mod.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fwebpack%2Fmod.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::Result;\n use swc_core::ecma::ast::Lit;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, Value, ValueToString, Vc};\n+use turbo_tasks::{ResolvedVc, ValueToString, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     file_source::FileSource,\n@@ -159,14 +159,14 @@ pub struct WebpackRuntimeAssetReference {\n impl ModuleReference for WebpackRuntimeAssetReference {\n     #[turbo_tasks::function]\n     async fn resolve_reference(&self) -> Result<Vc<ModuleResolveResult>> {\n-        let ty = Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined));\n+        let ty = ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined);\n         let options = self.origin.resolve_options(ty.clone());\n \n         let options = apply_cjs_specific_options(options);\n \n         let resolved = resolve(\n             self.origin.origin_path().parent().resolve().await?,\n-            Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined)),\n+            ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined),\n             *self.request,\n             options,\n         );"
        },
        {
            "sha": "7a8cafe4f9553cf350628ebd9059bbc3a7b1fa0c",
            "filename": "turbopack/crates/turbopack-node/src/evaluate.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Fevaluate.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Fevaluate.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Fevaluate.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -15,7 +15,7 @@ use serde_json::Value as JsonValue;\n use turbo_rcstr::rcstr;\n use turbo_tasks::{\n     Completion, FxIndexMap, NonLocalValue, OperationVc, RawVc, ResolvedVc, TaskInput,\n-    TryJoinIterExt, Value, Vc, apply_effects, duration_span, fxindexmap, mark_finished, prevent_gc,\n+    TryJoinIterExt, Vc, apply_effects, duration_span, fxindexmap, mark_finished, prevent_gc,\n     trace::TraceRawVcs, util::SharedError,\n };\n use turbo_tasks_bytes::{Bytes, Stream};\n@@ -98,9 +98,7 @@ async fn emit_evaluate_pool_assets_operation(\n     let runtime_asset = asset_context\n         .process(\n             Vc::upcast(FileSource::new(embed_file_path(rcstr!(\"ipc/evaluate.ts\")))),\n-            Value::new(ReferenceType::Internal(\n-                InnerAssets::empty().to_resolved().await?,\n-            )),\n+            ReferenceType::Internal(InnerAssets::empty().to_resolved().await?),\n         )\n         .module()\n         .to_resolved()\n@@ -124,10 +122,10 @@ async fn emit_evaluate_pool_assets_operation(\n                     File::from(\"import { run } from 'RUNTIME'; run(() => import('INNER'))\").into(),\n                 ),\n             )),\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n+            ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n                 rcstr!(\"INNER\") => module_asset,\n                 rcstr!(\"RUNTIME\") => runtime_asset\n-            }))),\n+            })),\n         )\n         .module()\n         .to_resolved()\n@@ -137,9 +135,7 @@ async fn emit_evaluate_pool_assets_operation(\n         let globals_module = asset_context\n             .process(\n                 Vc::upcast(FileSource::new(embed_file_path(rcstr!(\"globals.ts\")))),\n-                Value::new(ReferenceType::Internal(\n-                    InnerAssets::empty().to_resolved().await?,\n-                )),\n+                ReferenceType::Internal(InnerAssets::empty().to_resolved().await?),\n             )\n             .module();\n "
        },
        {
            "sha": "bd329507fa4bd4ced79184d74422e946fa15c8be",
            "filename": "turbopack/crates/turbopack-node/src/transforms/postcss.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 9,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fpostcss.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -199,9 +199,7 @@ async fn config_changed(\n     let config_asset = asset_context\n         .process(\n             Vc::upcast(FileSource::new(postcss_config_path)),\n-            Value::new(ReferenceType::Internal(\n-                InnerAssets::empty().to_resolved().await?,\n-            )),\n+            ReferenceType::Internal(InnerAssets::empty().to_resolved().await?),\n         )\n         .module();\n \n@@ -237,9 +235,7 @@ async fn extra_configs_changed(\n                     match *asset_context\n                         .process(\n                             Vc::upcast(FileSource::new(path)),\n-                            Value::new(ReferenceType::Internal(\n-                                InnerAssets::empty().to_resolved().await?,\n-                            )),\n+                            ReferenceType::Internal(InnerAssets::empty().to_resolved().await?),\n                         )\n                         .try_into_module()\n                         .await?\n@@ -403,7 +399,7 @@ async fn postcss_executor(\n     let config_asset = asset_context\n         .process(\n             config_loader_source(project_path, postcss_config_path),\n-            Value::new(ReferenceType::Entry(EntryReferenceSubType::Undefined)),\n+            ReferenceType::Entry(EntryReferenceSubType::Undefined),\n         )\n         .module()\n         .to_resolved()\n@@ -413,9 +409,9 @@ async fn postcss_executor(\n         Vc::upcast(FileSource::new(embed_file_path(rcstr!(\n             \"transforms/postcss.ts\"\n         )))),\n-        Value::new(ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n+        ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n             rcstr!(\"CONFIG\") => config_asset\n-        }))),\n+        })),\n     ))\n }\n "
        },
        {
            "sha": "e8686a49f844e2377365b3491042cba76eb88ac3",
            "filename": "turbopack/crates/turbopack-node/src/transforms/webpack.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 9,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Ftransforms%2Fwebpack.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -191,9 +191,7 @@ async fn webpack_loaders_executor(\n         Vc::upcast(FileSource::new(embed_file_path(rcstr!(\n             \"transforms/webpack-loaders.ts\"\n         )))),\n-        Value::new(ReferenceType::Internal(\n-            InnerAssets::empty().to_resolved().await?,\n-        )),\n+        ReferenceType::Internal(InnerAssets::empty().to_resolved().await?),\n     ))\n }\n \n@@ -576,12 +574,7 @@ impl EvaluateContext for WebpackLoaderContext {\n \n                 let options = apply_webpack_resolve_options(options, webpack_options);\n \n-                let resolved = resolve(\n-                    lookup_path,\n-                    Value::new(ReferenceType::Undefined),\n-                    request,\n-                    options,\n-                );\n+                let resolved = resolve(lookup_path, ReferenceType::Undefined, request, options);\n \n                 let request_str = request.to_string().await?;\n                 let lookup_path_str = lookup_path.to_string().await?;"
        },
        {
            "sha": "4bb93b0dd10deaf5f43d77c340d9c327a05a1b06",
            "filename": "turbopack/crates/turbopack-resolve/src/ecmascript.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fecmascript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fecmascript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fecmascript.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -44,12 +44,12 @@ pub fn get_condition_maps(\n \n pub fn apply_esm_specific_options(\n     options: Vc<ResolveOptions>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n ) -> Vc<ResolveOptions> {\n     apply_esm_specific_options_internal(\n         options,\n         matches!(\n-            reference_type.into_value(),\n+            reference_type,\n             ReferenceType::EcmaScriptModules(EcmaScriptModulesReferenceSubType::ImportWithType(_))\n         ),\n     )\n@@ -94,7 +94,7 @@ pub async fn esm_resolve(\n     is_optional: bool,\n     issue_source: Option<IssueSource>,\n ) -> Result<Vc<ModuleResolveResult>> {\n-    let ty = Value::new(ReferenceType::EcmaScriptModules(ty.into_value()));\n+    let ty = ReferenceType::EcmaScriptModules(ty.into_value());\n     let options = apply_esm_specific_options(origin.resolve_options(ty.clone()), ty.clone())\n         .resolve()\n         .await?;\n@@ -109,7 +109,7 @@ pub async fn cjs_resolve(\n     is_optional: bool,\n ) -> Result<Vc<ModuleResolveResult>> {\n     // TODO pass CommonJsReferenceSubType\n-    let ty = Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined));\n+    let ty = ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined);\n     let options = apply_cjs_specific_options(origin.resolve_options(ty.clone()))\n         .resolve()\n         .await?;\n@@ -124,7 +124,7 @@ pub async fn cjs_resolve_source(\n     is_optional: bool,\n ) -> Result<Vc<ResolveResult>> {\n     // TODO pass CommonJsReferenceSubType\n-    let ty = Value::new(ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined));\n+    let ty = ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined);\n     let options = apply_cjs_specific_options(origin.resolve_options(ty.clone()))\n         .resolve()\n         .await?;\n@@ -151,7 +151,7 @@ async fn specific_resolve(\n     origin: Vc<Box<dyn ResolveOrigin>>,\n     request: Vc<Request>,\n     options: Vc<ResolveOptions>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     is_optional: bool,\n     issue_source: Option<IssueSource>,\n ) -> Result<Vc<ModuleResolveResult>> {"
        },
        {
            "sha": "2877d395b2036b88ca982943e0f71d45f2f99549",
            "filename": "turbopack/crates/turbopack-resolve/src/typescript.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 21,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Ftypescript.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -151,16 +151,16 @@ async fn resolve_extends(\n         Request::Empty => {\n             let request = Request::parse_string(rcstr!(\"./tsconfig\"));\n             Ok(resolve(parent_dir,\n-                Value::new(ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined)), request, resolve_options).first_source())\n+                ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined), request, resolve_options).first_source())\n         }\n \n         // All other types are treated as module imports, and potentially joined with\n         // \"tsconfig.json\". This includes \"relative\" imports like '.' and '..'.\n         _ => {\n-            let mut result = resolve(parent_dir, Value::new(ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined)), request, resolve_options).first_source();\n+            let mut result = resolve(parent_dir, ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined), request, resolve_options).first_source();\n             if result.await?.is_none() {\n                 let request = Request::parse_string(format!(\"{extends}/tsconfig\").into());\n-                result = resolve(parent_dir, Value::new(ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined)), request, resolve_options).first_source();\n+                result = resolve(parent_dir, ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined), request, resolve_options).first_source();\n             }\n             Ok(result)\n         }\n@@ -175,9 +175,7 @@ async fn resolve_extends_rooted_or_relative(\n ) -> Result<Vc<OptionSource>> {\n     let mut result = resolve(\n         lookup_path,\n-        Value::new(ReferenceType::TypeScript(\n-            TypeScriptReferenceSubType::Undefined,\n-        )),\n+        ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined),\n         request,\n         resolve_options,\n     )\n@@ -190,9 +188,7 @@ async fn resolve_extends_rooted_or_relative(\n         let request = Request::parse_string(format!(\"{path}.json\").into());\n         result = resolve(\n             lookup_path,\n-            Value::new(ReferenceType::TypeScript(\n-                TypeScriptReferenceSubType::Undefined,\n-            )),\n+            ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined),\n             request,\n             resolve_options,\n         )\n@@ -387,9 +383,7 @@ pub async fn type_resolve(\n     origin: Vc<Box<dyn ResolveOrigin>>,\n     request: Vc<Request>,\n ) -> Result<Vc<ModuleResolveResult>> {\n-    let ty = Value::new(ReferenceType::TypeScript(\n-        TypeScriptReferenceSubType::Undefined,\n-    ));\n+    let ty = ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined);\n     let context_path = origin.origin_path().parent();\n     let options = origin.resolve_options(ty.clone());\n     let options = apply_typescript_types_options(options);\n@@ -418,9 +412,7 @@ pub async fn type_resolve(\n     let result = if let Some(types_request) = types_request {\n         let result1 = resolve(\n             context_path,\n-            Value::new(ReferenceType::TypeScript(\n-                TypeScriptReferenceSubType::Undefined,\n-            )),\n+            ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined),\n             request,\n             options,\n         );\n@@ -429,19 +421,15 @@ pub async fn type_resolve(\n         } else {\n             resolve(\n                 context_path,\n-                Value::new(ReferenceType::TypeScript(\n-                    TypeScriptReferenceSubType::Undefined,\n-                )),\n+                ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined),\n                 types_request,\n                 options,\n             )\n         }\n     } else {\n         resolve(\n             context_path,\n-            Value::new(ReferenceType::TypeScript(\n-                TypeScriptReferenceSubType::Undefined,\n-            )),\n+            ReferenceType::TypeScript(TypeScriptReferenceSubType::Undefined),\n             request,\n             options,\n         )"
        },
        {
            "sha": "ba1fc3d16339c4873fd4b8205a1cab4ee8ce1c2b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -439,9 +439,7 @@ async fn run_test_operation(prepared_test: ResolvedVc<PreparedTest>) -> Result<V\n     let test_asset = asset_context\n         .process(\n             Vc::upcast(test_source),\n-            Value::new(ReferenceType::Internal(\n-                InnerAssets::empty().to_resolved().await?,\n-            )),\n+            ReferenceType::Internal(InnerAssets::empty().to_resolved().await?),\n         )\n         .module()\n         .to_resolved()\n@@ -450,9 +448,9 @@ async fn run_test_operation(prepared_test: ResolvedVc<PreparedTest>) -> Result<V\n     let jest_entry_asset = asset_context\n         .process(\n             Vc::upcast(jest_entry_source),\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n+            ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n                 rcstr!(\"TESTS\") => test_asset,\n-            }))),\n+            })),\n         )\n         .module();\n "
        },
        {
            "sha": "6680b43f645ae9dc5f586bf39c1c85c09c9bdb0e",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -384,7 +384,7 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n     let entry_module = asset_context\n         .process(\n             Vc::upcast(FileSource::new(entry_asset)),\n-            Value::new(ReferenceType::Entry(EntryReferenceSubType::Undefined)),\n+            ReferenceType::Entry(EntryReferenceSubType::Undefined),\n         )\n         .module();\n "
        },
        {
            "sha": "1827276cc86880aee97e7c98e80961557671fc8a",
            "filename": "turbopack/crates/turbopack-wasm/src/module_asset.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-wasm%2Fsrc%2Fmodule_asset.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::{Context, Result, bail};\n use turbo_rcstr::rcstr;\n-use turbo_tasks::{ResolvedVc, Value, Vc, fxindexmap};\n+use turbo_tasks::{ResolvedVc, Vc, fxindexmap};\n use turbo_tasks_fs::FileSystemPath;\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n@@ -73,9 +73,9 @@ impl WebAssemblyModuleAsset {\n \n         let module = this.asset_context.process(\n             loader_source,\n-            Value::new(ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n+            ReferenceType::Internal(ResolvedVc::cell(fxindexmap! {\n                 rcstr!(\"WASM_PATH\") => ResolvedVc::upcast(RawWebAssemblyModuleAsset::new(*this.source, *this.asset_context).to_resolved().await?),\n-            }))),\n+            })),\n         ).module();\n \n         Ok(module)"
        },
        {
            "sha": "1fafa297252b4107b57c85b94d2ef47bedd507e6",
            "filename": "turbopack/crates/turbopack/benches/node_file_trace.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fbenches%2Fnode_file_trace.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -116,7 +116,7 @@ fn bench_emit(b: &mut Bencher, bench_input: &BenchInput) {\n                     rcstr!(\"node_file_trace\"),\n                 );\n                 let module = module_asset_context\n-                    .process(Vc::upcast(source), Value::new(ReferenceType::Undefined))\n+                    .process(Vc::upcast(source), ReferenceType::Undefined)\n                     .module();\n                 let rebased = RebasedAsset::new(Vc::upcast(module), input_dir, *output_dir)\n                     .to_resolved()"
        },
        {
            "sha": "abd89152bcb665d4750b1c93046ce2064c98a46b",
            "filename": "turbopack/crates/turbopack/examples/turbopack.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fexamples%2Fturbopack.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fexamples%2Fturbopack.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fexamples%2Fturbopack.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -67,7 +67,7 @@ async fn main() -> Result<()> {\n             let module = module_asset_context\n                 .process(\n                     Vc::upcast(source),\n-                    Value::new(turbopack_core::reference_type::ReferenceType::Undefined),\n+                    turbopack_core::reference_type::ReferenceType::Undefined,\n                 )\n                 .module();\n             let rebased = RebasedAsset::new(module, input, output);"
        },
        {
            "sha": "24e1b5469231f6fe286867c2bbf7826d3e829dc6",
            "filename": "turbopack/crates/turbopack/src/lib.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 14,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -420,7 +420,7 @@ impl ModuleAssetContext {\n     async fn process_with_transition_rules(\n         self: Vc<Self>,\n         source: ResolvedVc<Box<dyn Source>>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Result<Vc<ProcessResult>> {\n         let this = self.await?;\n         Ok(\n@@ -440,7 +440,7 @@ impl ModuleAssetContext {\n     async fn process_default(\n         self: Vc<Self>,\n         source: ResolvedVc<Box<dyn Source>>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Result<Vc<ProcessResult>> {\n         process_default(self, source, reference_type, Vec::new()).await\n     }\n@@ -449,14 +449,14 @@ impl ModuleAssetContext {\n async fn process_default(\n     module_asset_context: Vc<ModuleAssetContext>,\n     source: ResolvedVc<Box<dyn Source>>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     processed_rules: Vec<usize>,\n ) -> Result<Vc<ProcessResult>> {\n     let span = tracing::info_span!(\n         \"process module\",\n         name = %source.ident().to_string().await?,\n         layer = Empty,\n-        reference_type = display(&*reference_type)\n+        reference_type = display(&reference_type)\n     );\n     if !span.is_disabled() {\n         // Need to use record, otherwise future is not Send for some reason.\n@@ -476,7 +476,7 @@ async fn process_default(\n async fn process_default_internal(\n     module_asset_context: Vc<ModuleAssetContext>,\n     source: ResolvedVc<Box<dyn Source>>,\n-    reference_type: Value<ReferenceType>,\n+    reference_type: ReferenceType,\n     processed_rules: Vec<usize>,\n ) -> Result<Vc<ProcessResult>> {\n     let ident = source.ident().resolve().await?;\n@@ -487,7 +487,6 @@ async fn process_default_internal(\n         module_asset_context.resolve_options_context(),\n     );\n \n-    let reference_type = reference_type.into_value();\n     let part: Option<ModulePart> = match &reference_type {\n         ReferenceType::EcmaScriptModules(EcmaScriptModulesReferenceSubType::ImportPart(part)) => {\n             Some(part.clone())\n@@ -541,15 +540,15 @@ async fn process_default_internal(\n                                 return Ok(transition.process(\n                                     *current_source,\n                                     module_asset_context,\n-                                    Value::new(reference_type),\n+                                    reference_type,\n                                 ));\n                             } else {\n                                 let mut processed_rules = processed_rules.clone();\n                                 processed_rules.push(i);\n                                 return Box::pin(process_default(\n                                     module_asset_context,\n                                     current_source,\n-                                    Value::new(reference_type),\n+                                    reference_type,\n                                     processed_rules,\n                                 ))\n                                 .await;\n@@ -703,7 +702,7 @@ impl AssetContext for ModuleAssetContext {\n     async fn resolve_options(\n         self: Vc<Self>,\n         origin_path: Vc<FileSystemPath>,\n-        _reference_type: Value<ReferenceType>,\n+        _reference_type: ReferenceType,\n     ) -> Result<Vc<ResolveOptions>> {\n         let this = self.await?;\n         let module_asset_context = if let Some(transition) = this.transition {\n@@ -724,7 +723,7 @@ impl AssetContext for ModuleAssetContext {\n         origin_path: Vc<FileSystemPath>,\n         request: Vc<Request>,\n         resolve_options: Vc<ResolveOptions>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Result<Vc<ModuleResolveResult>> {\n         let context_path = origin_path.parent().resolve().await?;\n \n@@ -753,7 +752,7 @@ impl AssetContext for ModuleAssetContext {\n     async fn process_resolve_result(\n         self: Vc<Self>,\n         result: Vc<ResolveResult>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Result<Vc<ModuleResolveResult>> {\n         let this = self.await?;\n \n@@ -803,7 +802,7 @@ impl AssetContext for ModuleAssetContext {\n                                     // for externals (and otherwise, this causes duplicate\n                                     // CachedExternalModules for both `ImportPart(Evaluation)` and\n                                     // `ImportPart(Export(\"CacheProvider\"))`)\n-                                    let reference_type = Value::new(match &*reference_type {\n+                                    let reference_type = match reference_type {\n                                         ReferenceType::EcmaScriptModules(_) => {\n                                             ReferenceType::EcmaScriptModules(Default::default())\n                                         }\n@@ -817,7 +816,7 @@ impl AssetContext for ModuleAssetContext {\n                                             ReferenceType::Url(Default::default())\n                                         }\n                                         _ => ReferenceType::Undefined,\n-                                    });\n+                                    };\n \n                                     let external_result = externals_context\n                                         .resolve_asset(\n@@ -885,7 +884,7 @@ impl AssetContext for ModuleAssetContext {\n     async fn process(\n         self: Vc<Self>,\n         asset: ResolvedVc<Box<dyn Source>>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Result<Vc<ProcessResult>> {\n         let this = self.await?;\n         if let Some(transition) = this.transition {"
        },
        {
            "sha": "530f7a1a23cd842bd516798e8fd05ee89f46c4eb",
            "filename": "turbopack/crates/turbopack/src/transition/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Ftransition%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Ftransition%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Ftransition%2Fmod.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -4,7 +4,7 @@ use anyhow::Result;\n pub use full_context_transition::FullContextTransition;\n use rustc_hash::FxHashMap;\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Value, ValueDefault, Vc};\n+use turbo_tasks::{ResolvedVc, ValueDefault, Vc};\n use turbopack_core::{\n     compile_time_info::CompileTimeInfo, context::ProcessResult, module::Module,\n     reference_type::ReferenceType, source::Source,\n@@ -96,7 +96,7 @@ pub trait Transition {\n         self: Vc<Self>,\n         asset: Vc<Box<dyn Source>>,\n         module_asset_context: Vc<ModuleAssetContext>,\n-        reference_type: Value<ReferenceType>,\n+        reference_type: ReferenceType,\n     ) -> Result<Vc<ProcessResult>> {\n         let asset = self.process_source(asset);\n         let module_asset_context = self.process_context(module_asset_context);"
        },
        {
            "sha": "949133ed3059a358187175490b47214df4e5312e",
            "filename": "turbopack/crates/turbopack/src/unsupported_sass.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Funsupported_sass.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Funsupported_sass.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Funsupported_sass.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -1,7 +1,7 @@\n //! TODO(WEB-741) Remove this file once Sass is supported.\n \n use anyhow::Result;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n use turbopack_core::{\n     issue::{Issue, IssueExt, IssueSeverity, IssueStage, OptionStyledString, StyledString},\n@@ -39,7 +39,7 @@ impl AfterResolvePlugin for UnsupportedSassResolvePlugin {\n         &self,\n         fs_path: ResolvedVc<FileSystemPath>,\n         lookup_path: ResolvedVc<FileSystemPath>,\n-        _reference_type: Value<ReferenceType>,\n+        _reference_type: ReferenceType,\n         request: ResolvedVc<Request>,\n     ) -> Result<Vc<ResolveResultOption>> {\n         let extension = fs_path.extension().await?;"
        },
        {
            "sha": "555d5597ff43c3c7ce2a4291df42e98d7a38d385",
            "filename": "turbopack/crates/turbopack/tests/node-file-trace.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/1f941656ce10b6c5a3a5b778c3d0ede742a660e5/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs?ref=1f941656ce10b6c5a3a5b778c3d0ede742a660e5",
            "patch": "@@ -327,14 +327,14 @@ async fn node_file_trace_operation(\n     directory: RcStr,\n ) -> Result<Vc<RebasedAsset>> {\n     let workspace_fs: Vc<Box<dyn FileSystem>> = Vc::upcast(DiskFileSystem::new(\n-        \"workspace\".into(),\n+        rcstr!(\"workspace\"),\n         package_root.clone(),\n         vec![],\n     ));\n     let input_dir = workspace_fs.root().to_resolved().await?;\n     let input = input_dir.join(format!(\"tests/{input}\").into());\n \n-    let output_fs = DiskFileSystem::new(\"output\".into(), directory.clone(), vec![]);\n+    let output_fs = DiskFileSystem::new(rcstr!(\"output\"), directory.clone(), vec![]);\n     let output_dir = output_fs.root().to_resolved().await?;\n \n     let source = FileSource::new(input);\n@@ -361,14 +361,14 @@ async fn node_file_trace_operation(\n         ResolveOptionsContext {\n             enable_node_native_modules: true,\n             enable_node_modules: Some(input_dir),\n-            custom_conditions: vec![\"node\".into()],\n+            custom_conditions: vec![rcstr!(\"node\")],\n             ..Default::default()\n         }\n         .cell(),\n         rcstr!(\"test\"),\n     );\n     let module = module_asset_context\n-        .process(Vc::upcast(source), Value::new(ReferenceType::Undefined))\n+        .process(Vc::upcast(source), ReferenceType::Undefined)\n         .module();\n \n     let rebased = RebasedAsset::new(Vc::upcast(module), *input_dir, *output_dir)"
        }
    ],
    "stats": {
        "total": 562,
        "additions": 299,
        "deletions": 263
    }
}