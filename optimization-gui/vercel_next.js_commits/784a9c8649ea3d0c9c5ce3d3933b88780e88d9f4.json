{
    "author": "gnoff",
    "message": "[dynamicIO] log dynamic validation errors consistently in dev (#78575)\n\nIn dev when dynamicIO is enabled we perform a validating prerender to\nlook for code that would be a build error in `next build`. However due\nto the construction of the earlier implementation of this code some\nvalidation messages were being suppressed because they were conveyed as\na thrown error rather than through console.error. This change updates\nthe mechanism by which we raise these issues in dev so they are\nconsistently messaged.\n\nstacked on #78574",
    "sha": "784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4",
    "files": [
        {
            "sha": "e53c12d492107205e08cf024695f14ccb4360265",
            "filename": "packages/next/src/server/app-render/dynamic-rendering.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts?ref=784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4",
            "patch": "@@ -691,8 +691,9 @@ export function throwIfDisallowedEmptyStaticShell(\n   // you need to opt into that by adding a Suspense boundary above the body\n   // to indicate your are ok with fully dynamic rendering.\n   if (dynamicValidation.hasDynamicViewport) {\n-    throw new StaticGenBailoutError(\n+    console.error(\n       `Route \"${route}\" has a \\`generateViewport\\` that depends on Request data (\\`cookies()\\`, etc...) or uncached external data (\\`fetch(...)\\`, etc...) without explicitly allowing fully dynamic rendering. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-viewport`\n     )\n+    throw new StaticGenBailoutError()\n   }\n }"
        },
        {
            "sha": "6b5a117fa7d6936bfa314fce8614c49c4ef5a07a",
            "filename": "test/e2e/app-dir/dynamic-io-errors/dynamic-io-errors.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Fdynamic-io-errors.test.ts?ref=784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4",
            "patch": "@@ -257,10 +257,10 @@ function runTests(options: { withMinification: boolean }) {\n         }\n         const expectError = createExpectError(next.cliOutput)\n \n-        expectError('Error occurred prerendering page \"/\"')\n         expectError(\n           'Route \"/\" has a `generateViewport` that depends on Request data (`cookies()`, etc...) or uncached external data (`fetch(...)`, etc...) without explicitly allowing fully dynamic rendering. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-viewport'\n         )\n+        expectError('Error occurred prerendering page \"/\"')\n       })\n     })\n \n@@ -299,10 +299,10 @@ function runTests(options: { withMinification: boolean }) {\n         }\n         const expectError = createExpectError(next.cliOutput)\n \n-        expectError('Error occurred prerendering page \"/\"')\n         expectError(\n           'Route \"/\" has a `generateViewport` that depends on Request data (`cookies()`, etc...) or uncached external data (`fetch(...)`, etc...) without explicitly allowing fully dynamic rendering. See more info here: https://nextjs.org/docs/messages/next-prerender-dynamic-viewport'\n         )\n+        expectError('Error occurred prerendering page \"/\"')\n       })\n     })\n "
        },
        {
            "sha": "7c50829cc24bf9a348eaed2596f02a0a4f985e6d",
            "filename": "test/e2e/app-dir/dynamic-io-errors/fixtures/dynamic-metadata-dynamic-route/app/page.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fdynamic-metadata-dynamic-route%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fdynamic-metadata-dynamic-route%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io-errors%2Ffixtures%2Fdynamic-metadata-dynamic-route%2Fapp%2Fpage.tsx?ref=784a9c8649ea3d0c9c5ce3d3933b88780e88d9f4",
            "patch": "@@ -9,10 +9,9 @@ export default async function Page() {\n   return (\n     <>\n       <p>\n-        This page is static except for generateMetadata which does some IO. This\n-        is a build error because metadata is not wrapped in a Suspense boundary.\n-        We expect that if you intended for your metadata to be dynamic you will\n-        ensure your page is dynamic too\n+        This page has dynamic content and generateMetadata is also dynamic.\n+        generateMetadata being dynamic in this context is fine because it isn't\n+        the only reason the page is dynamic.\n       </p>\n       <Suspense fallback={<Fallback />}>\n         <Dynamic />"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 7,
        "deletions": 7
    }
}