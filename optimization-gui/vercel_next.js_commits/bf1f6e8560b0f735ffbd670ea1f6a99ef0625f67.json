{
    "author": "devjiwonchoi",
    "message": "[ts-next-plugin] fix: validate metadata node before checking type (#78414)\n\n### What?\n\nReceived error from TS Log:\n\n```txt\nCannot read properties of undefined (reading 'type')\n\nTypeError: Cannot read properties of undefined (reading 'type')\n at hasCorrectType (…/next@15.4.0-canary.3…/next/dist/server/typescript/rules/metadata.js:212:14)\n at Object.getSemanticDiagnosticsForExportDeclaration (…\n```\n\n### Why?\n\n`declaration` can be undefined but was passed via `as` assertion.\n\n### How?\n\nRemove the `as` assertion and correctly validate the `declaration.`",
    "sha": "bf1f6e8560b0f735ffbd670ea1f6a99ef0625f67",
    "files": [
        {
            "sha": "5ba7d066526fc919f91eba817123b7ff16a6e70c",
            "filename": "packages/next/src/server/typescript/rules/metadata.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/bf1f6e8560b0f735ffbd670ea1f6a99ef0625f67/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fmetadata.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bf1f6e8560b0f735ffbd670ea1f6a99ef0625f67/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fmetadata.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fmetadata.ts?ref=bf1f6e8560b0f735ffbd670ea1f6a99ef0625f67",
            "patch": "@@ -206,7 +206,11 @@ const metadata = {\n               }\n             }\n \n-            if (!hasCorrectType(declaration as tsModule.FunctionDeclaration)) {\n+            if (\n+              declaration &&\n+              ts.isFunctionDeclaration(declaration) &&\n+              !hasCorrectType(declaration)\n+            ) {\n               diagnostics.push({\n                 file: source,\n                 category: ts.DiagnosticCategory.Warning,\n@@ -219,7 +223,11 @@ const metadata = {\n           } else {\n             // must be 'metadata' at this point\n             const declaration = symbol.declarations?.[0]\n-            if (!hasCorrectType(declaration as tsModule.VariableDeclaration)) {\n+            if (\n+              declaration &&\n+              ts.isVariableDeclaration(declaration) &&\n+              !hasCorrectType(declaration)\n+            ) {\n               diagnostics.push({\n                 file: source,\n                 category: ts.DiagnosticCategory.Warning,"
        }
    ],
    "stats": {
        "total": 12,
        "additions": 10,
        "deletions": 2
    }
}