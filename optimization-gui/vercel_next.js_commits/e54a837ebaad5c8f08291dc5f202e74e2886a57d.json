{
    "author": "RobPruzan",
    "message": "feat: new detachable panel UI (#81483)\n\nThis PR updates the devtool overlay to use a new detachable panel based\nsystem for rendering content. Each panel can be configured to:\n- drag\n- resize\n- close on click outside\n- have min/max sizes if resizable, size if fixed\n\n\nhttps://github.com/user-attachments/assets/982ecee3-5ef0-424e-8fcc-4c54dfadcb25",
    "sha": "e54a837ebaad5c8f08291dc5f202e74e2886a57d",
    "files": [
        {
            "sha": "17fa7d000c50f9750e004ff70673a5a2734ab1ae",
            "filename": "packages/next/.storybook/main.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2F.storybook%2Fmain.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2F.storybook%2Fmain.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2F.storybook%2Fmain.ts?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -9,6 +9,8 @@ import { fileURLToPath } from 'url'\n function getAbsolutePath(value: string): any {\n   return dirname(require.resolve(join(value, 'package.json')))\n }\n+import { createRequire } from 'module'\n+const require = createRequire(import.meta.url)\n \n const config: StorybookConfig = {\n   stories: ['../src/next-devtools/**/*.stories.tsx'],"
        },
        {
            "sha": "19b50bd42511ec354557dc98bd43f72b0de64b58",
            "filename": "packages/next/src/next-devtools/dev-overlay.browser.tsx",
            "status": "modified",
            "additions": 31,
            "deletions": 6,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -18,9 +18,17 @@ import {\n   ACTION_RENDERING_INDICATOR_HIDE,\n   ACTION_RENDERING_INDICATOR_SHOW,\n   ACTION_DEVTOOL_UPDATE_ROUTE_STATE,\n+  type OverlayState,\n+  type DispatcherEvent,\n } from './dev-overlay/shared'\n \n-import { startTransition, useInsertionEffect } from 'react'\n+import {\n+  createContext,\n+  startTransition,\n+  useContext,\n+  useInsertionEffect,\n+  type ActionDispatch,\n+} from 'react'\n import { createRoot } from 'react-dom/client'\n import { FontStyles } from './dev-overlay/font/font-styles'\n import type { HydrationErrorState } from './shared/hydration-error'\n@@ -208,14 +216,31 @@ function DevOverlayRoot({\n     <>\n       {/* Fonts can only be loaded outside the Shadow DOM. */}\n       <FontStyles />\n-      <DevOverlay\n-        state={state}\n-        dispatch={dispatch}\n-        getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n-      />\n+      <DevOverlayContext\n+        value={{\n+          dispatch,\n+          getSquashedHydrationErrorDetails,\n+          state,\n+        }}\n+      >\n+        <DevOverlay\n+          // we also pass props for legacy UI\n+          dispatch={dispatch}\n+          state={state}\n+          getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n+        />\n+      </DevOverlayContext>\n     </>\n   )\n }\n+export const DevOverlayContext = createContext<{\n+  state: OverlayState & {\n+    routerType: 'pages' | 'app'\n+  }\n+  dispatch: ActionDispatch<[action: DispatcherEvent]>\n+  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n+}>(null!)\n+export const useDevOverlayContext = () => useContext(DevOverlayContext)\n \n let isPagesMounted = false\n let isAppMounted = false"
        },
        {
            "sha": "5f6b5dcc508c15f078d7f17862d92ce79c200484",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.stories.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.stories.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,12 +1,12 @@\n import type { Meta, StoryObj } from '@storybook/react'\n import type { OverlayState } from '../../shared'\n \n-import { DevToolsIndicator } from './devtools-indicator'\n+import { DevToolsIndicatorNew } from './devtools-indicator'\n import { INITIAL_OVERLAY_STATE } from '../../shared'\n import { withShadowPortal } from '../../storybook/with-shadow-portal'\n \n-const meta: Meta<typeof DevToolsIndicator> = {\n-  component: DevToolsIndicator,\n+const meta: Meta<typeof DevToolsIndicatorNew> = {\n+  component: DevToolsIndicatorNew,\n   parameters: {\n     layout: 'centered',\n   },\n@@ -37,7 +37,7 @@ const meta: Meta<typeof DevToolsIndicator> = {\n }\n \n export default meta\n-type Story = StoryObj<typeof DevToolsIndicator>\n+type Story = StoryObj<typeof DevToolsIndicatorNew>\n \n const state: OverlayState = {\n   ...INITIAL_OVERLAY_STATE,"
        },
        {
            "sha": "2f3fd52d619e87dccdcb004a9ebd7cde78911d59",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.tsx",
            "status": "modified",
            "additions": 60,
            "deletions": 48,
            "changes": 108,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,51 +1,36 @@\n import type { CSSProperties } from 'react'\n-import type { OverlayState, OverlayDispatch } from '../../shared'\n \n-import { useState } from 'react'\n-import { NextLogo } from './next-logo'\n+import { NextLogoNew } from './next-logo'\n import { Toast } from '../toast'\n import {\n   MENU_CURVE,\n   MENU_DURATION_MS,\n } from '../errors/dev-tools-indicator/utils'\n import {\n-  ACTION_DEVTOOLS_PANEL_TOGGLE,\n   STORAGE_KEY_POSITION,\n   ACTION_DEVTOOLS_POSITION,\n-  ACTION_DEVTOOLS_PANEL_OPEN,\n-  ACTION_ERROR_OVERLAY_OPEN,\n+  STORE_KEY_SHARED_PANEL_LOCATION,\n+  STORAGE_KEY_PANEL_POSITION_PREFIX,\n+  ACTION_DEVTOOLS_PANEL_POSITION,\n } from '../../shared'\n import { Draggable } from '../errors/dev-tools-indicator/draggable'\n+import { useDevOverlayContext } from '../../../dev-overlay.browser'\n+import { usePanelRouterContext } from '../../menu/context'\n+import type { DevToolsIndicatorPosition } from '../errors/dev-tools-indicator/dev-tools-info/preferences'\n \n export const INDICATOR_PADDING = 20\n \n-export function DevToolsIndicator({\n-  state,\n-  dispatch,\n-  errorCount,\n-  isBuildError,\n-}: {\n-  state: OverlayState\n-  dispatch: OverlayDispatch\n-  errorCount: number\n-  isBuildError: boolean\n-}) {\n-  const [open, setOpen] = useState(false)\n+export function DevToolsIndicatorNew() {\n+  const { state, dispatch } = useDevOverlayContext()\n+  const { panel, setPanel, setSelectedIndex } = usePanelRouterContext()\n+  const updateAllPanelPositions = useUpdateAllPanelPositions()\n \n   const [vertical, horizontal] = state.devToolsPosition.split('-', 2)\n \n-  const enableErrorOverlayMode = () => {\n-    dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n-    // Open the DevTools panel to view as error overlay mode.\n-    dispatch({ type: ACTION_DEVTOOLS_PANEL_OPEN })\n-  }\n-\n-  const toggleDevToolsPanel = () => {\n-    dispatch({ type: ACTION_DEVTOOLS_PANEL_TOGGLE })\n-  }\n-\n   return (\n+    // TODO: why is this called a toast\n     <Toast\n+      id=\"devtools-indicator\"\n       data-nextjs-toast\n       style={\n         {\n@@ -54,42 +39,69 @@ export function DevToolsIndicator({\n           boxShadow: 'none',\n           [vertical]: `${INDICATOR_PADDING}px`,\n           [horizontal]: `${INDICATOR_PADDING}px`,\n-          visibility:\n-            state.isDevToolsPanelOpen || state.isErrorOverlayOpen\n-              ? 'hidden'\n-              : 'visible',\n+          visibility: state.isErrorOverlayOpen ? 'hidden' : 'visible',\n         } as CSSProperties\n       }\n     >\n       <Draggable\n+        // avoids a lot of weird edge cases that would cause jank if the logo and panel were de-synced\n+        disableDrag={panel !== null}\n         padding={INDICATOR_PADDING}\n-        onDragStart={() => setOpen(false)}\n         position={state.devToolsPosition}\n         setPosition={(p) => {\n           dispatch({\n             type: ACTION_DEVTOOLS_POSITION,\n             devToolsPosition: p,\n           })\n           localStorage.setItem(STORAGE_KEY_POSITION, p)\n+\n+          updateAllPanelPositions(p)\n         }}\n       >\n-        {/* Trigger */}\n-        <NextLogo\n-          aria-haspopup=\"menu\"\n-          aria-expanded={open}\n-          aria-controls=\"nextjs-dev-tools-menu\"\n-          aria-label={`${open ? 'Close' : 'Open'} Next.js Dev Tools`}\n-          data-nextjs-dev-tools-button\n-          disabled={state.disableDevIndicator}\n-          issueCount={errorCount}\n-          onTriggerClick={toggleDevToolsPanel}\n-          toggleErrorOverlay={enableErrorOverlayMode}\n-          isDevBuilding={state.buildingIndicator}\n-          isDevRendering={state.renderingIndicator}\n-          isBuildError={isBuildError}\n-          scale={state.scale}\n+        <NextLogoNew\n+          onTriggerClick={() => {\n+            const newPanel =\n+              panel === 'panel-selector' ? null : 'panel-selector'\n+            setPanel(newPanel)\n+            if (!newPanel) {\n+              setSelectedIndex(-1)\n+              return\n+            }\n+          }}\n         />\n       </Draggable>\n     </Toast>\n   )\n }\n+\n+/**\n+ * makes sure we eventually sync the panel to the logo, otherwise\n+ * it will be jarring if the panels start appearing on the other\n+ * side of the logo. This wont teleport the panel because the indicator\n+ * cannot be dragged when any panel is open\n+ */\n+export const useUpdateAllPanelPositions = () => {\n+  const { dispatch } = useDevOverlayContext()\n+  return (position: DevToolsIndicatorPosition) => {\n+    dispatch({\n+      type: ACTION_DEVTOOLS_PANEL_POSITION,\n+      devToolsPanelPosition: position,\n+      key: STORE_KEY_SHARED_PANEL_LOCATION,\n+    })\n+\n+    localStorage.setItem(STORE_KEY_SHARED_PANEL_LOCATION, position)\n+\n+    const panelPositionKeys = Object.keys(localStorage).filter((key) =>\n+      key.startsWith(STORAGE_KEY_PANEL_POSITION_PREFIX)\n+    )\n+\n+    panelPositionKeys.forEach((key) => {\n+      dispatch({\n+        type: ACTION_DEVTOOLS_PANEL_POSITION,\n+        devToolsPanelPosition: position,\n+        key,\n+      })\n+      localStorage.setItem(key, position)\n+    })\n+  }\n+}"
        },
        {
            "sha": "ed2ed7b27b312cf2e4be0a4c0613a21a70eabbd1",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/next-logo.stories.tsx",
            "status": "modified",
            "additions": 15,
            "deletions": 5,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.stories.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,21 +1,31 @@\n import type { Meta, StoryObj } from '@storybook/react'\n-import { NextLogo } from './next-logo'\n+import { NextLogoNew } from './next-logo'\n import { withShadowPortal } from '../../storybook/with-shadow-portal'\n+// TODO(rob): this storybook's configurability is broken intentionally\n+// it will be restored when we wrap it in the storybook context addon https://storybook.js.org/addons/storybook-react-context\n+const StoryBookNextLogo = (\n+  _: {\n+    issueCount: number\n+    isDevBuilding: boolean\n+    isDevRendering: boolean\n+  } & Record<string, unknown>\n+) => {\n+  return <NextLogoNew onTriggerClick={() => {}} />\n+}\n \n-const meta: Meta<typeof NextLogo> = {\n-  component: NextLogo,\n+const meta: Meta<typeof StoryBookNextLogo> = {\n+  component: StoryBookNextLogo,\n   parameters: {\n     layout: 'centered',\n   },\n   args: {\n     'aria-label': 'Open Next.js DevTools',\n-    onClick: () => console.log('Clicked!'),\n   },\n   decorators: [withShadowPortal],\n }\n \n export default meta\n-type Story = StoryObj<typeof NextLogo>\n+type Story = StoryObj<typeof StoryBookNextLogo>\n \n export const NoIssues: Story = {\n   args: {"
        },
        {
            "sha": "e3d0c4b38e916f317cf9b14152f25e50469e26a6",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/next-logo.tsx",
            "status": "modified",
            "additions": 50,
            "deletions": 41,
            "changes": 91,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fnext-logo.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,51 +1,43 @@\n-import type { DevToolsScale } from '../errors/dev-tools-indicator/dev-tools-info/preferences'\n-\n import { useEffect, useRef, useState } from 'react'\n import { useUpdateAnimation } from './hooks/use-update-animation'\n import { useMeasureWidth } from './hooks/use-measure-width'\n import { useMinimumLoadingTimeMultiple } from './hooks/use-minimum-loading-time-multiple'\n import { Cross } from '../../icons/cross'\n import { Warning } from '../../icons/warning'\n import { css } from '../../utils/css'\n-\n-interface Props extends React.ComponentProps<'button'> {\n-  issueCount: number\n-  isDevBuilding: boolean\n-  isDevRendering: boolean\n-  isBuildError: boolean\n-  onTriggerClick: () => void\n-  toggleErrorOverlay: () => void\n-  scale: DevToolsScale\n-}\n+import { useDevOverlayContext } from '../../../dev-overlay.browser'\n+import { useRenderErrorContext } from '../../dev-overlay'\n+import { ACTION_ERROR_OVERLAY_OPEN } from '../../shared'\n+import { usePanelRouterContext } from '../../menu/context'\n+import { BASE_LOGO_SIZE } from '../../utils/indicator-metrics'\n \n const SHORT_DURATION_MS = 150\n \n-export function NextLogo({\n-  disabled,\n-  issueCount,\n-  isDevBuilding,\n-  isDevRendering,\n-  isBuildError,\n+export function NextLogoNew({\n   onTriggerClick,\n-  toggleErrorOverlay,\n-  scale = 1,\n-  ...props\n-}: Props) {\n-  const SIZE = 36 / scale\n-\n-  const hasError = issueCount > 0\n+  ...buttonProps\n+}: { onTriggerClick: () => void } & React.ComponentProps<'button'>) {\n+  const { state, dispatch } = useDevOverlayContext()\n+  const { totalErrorCount } = useRenderErrorContext()\n+  const SIZE = BASE_LOGO_SIZE / state.scale\n+  const { panel, triggerRef, setPanel } = usePanelRouterContext()\n+  const isMenuOpen = panel === 'panel-selector'\n+\n+  const hasError = totalErrorCount > 0\n   const [isErrorExpanded, setIsErrorExpanded] = useState(hasError)\n   const [dismissed, setDismissed] = useState(false)\n-  const newErrorDetected = useUpdateAnimation(issueCount, SHORT_DURATION_MS)\n+  const newErrorDetected = useUpdateAnimation(\n+    totalErrorCount,\n+    SHORT_DURATION_MS\n+  )\n \n-  const triggerRef = useRef<HTMLButtonElement | null>(null)\n   const ref = useRef<HTMLDivElement | null>(null)\n   const measuredWidth = useMeasureWidth(ref)\n \n   const isLoading = useMinimumLoadingTimeMultiple(\n-    isDevBuilding || isDevRendering\n+    state.buildingIndicator || state.renderingIndicator\n   )\n-  const isExpanded = isErrorExpanded || disabled\n+  const isExpanded = isErrorExpanded || state.disableDevIndicator\n   const width = measuredWidth === 0 ? 'auto' : measuredWidth\n \n   useEffect(() => {\n@@ -61,7 +53,10 @@ export function NextLogo({\n           '--duration-short': `${SHORT_DURATION_MS}ms`,\n           // if the indicator is disabled, hide the badge\n           // also allow the \"disabled\" state be dismissed, as long as there are no build errors\n-          display: disabled && (!hasError || dismissed) ? 'none' : 'block',\n+          display:\n+            state.disableDevIndicator && (!hasError || dismissed)\n+              ? 'none'\n+              : 'block',\n         } as React.CSSProperties\n       }\n     >\n@@ -396,58 +391,72 @@ export function NextLogo({\n       >\n         <div ref={ref}>\n           {/* Children */}\n-          {!disabled && (\n+          {!state.disableDevIndicator && (\n             <button\n+              id=\"next-logo\"\n               ref={triggerRef}\n               data-next-mark\n               data-next-mark-loading={isLoading}\n               onClick={onTriggerClick}\n-              {...props}\n+              disabled={state.disableDevIndicator}\n+              aria-haspopup=\"menu\"\n+              aria-expanded={isMenuOpen}\n+              aria-controls=\"nextjs-dev-tools-menu\"\n+              aria-label={`${isMenuOpen ? 'Close' : 'Open'} Next.js Dev Tools`}\n+              data-nextjs-dev-tools-button\n+              {...buttonProps}\n             >\n-              <NextMark isLoading={isLoading} isDevBuilding={isDevBuilding} />\n+              <NextMark\n+                isLoading={isLoading}\n+                isDevBuilding={state.buildingIndicator}\n+              />\n             </button>\n           )}\n           {isExpanded && (\n             <div data-issues>\n               <button\n                 data-issues-open\n                 aria-label=\"Open issues overlay\"\n-                onClick={toggleErrorOverlay}\n+                onClick={() => {\n+                  // wait this is wrong\n+                  dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n+                  setPanel(null)\n+                }}\n               >\n-                {disabled && (\n+                {state.disableDevIndicator && (\n                   <div data-disabled-icon>\n                     <Warning />\n                   </div>\n                 )}\n                 <AnimateCount\n                   // Used the key to force a re-render when the count changes.\n-                  key={issueCount}\n+                  key={totalErrorCount}\n                   animate={newErrorDetected}\n                   data-issues-count-animation\n                 >\n-                  {issueCount}\n+                  {totalErrorCount}\n                 </AnimateCount>{' '}\n                 <div>\n                   Issue\n-                  {issueCount > 1 && (\n+                  {totalErrorCount > 1 && (\n                     <span\n                       aria-hidden\n                       data-issues-count-plural\n                       // This only needs to animate once the count changes from 1 -> 2,\n                       // otherwise it should stay static between re-renders.\n-                      data-animate={newErrorDetected && issueCount === 2}\n+                      data-animate={newErrorDetected && totalErrorCount === 2}\n                     >\n                       s\n                     </span>\n                   )}\n                 </div>\n               </button>\n-              {!isBuildError && (\n+              {!state.buildError && (\n                 <button\n                   data-issues-collapse\n                   aria-label=\"Collapse issues badge\"\n                   onClick={() => {\n-                    if (disabled) {\n+                    if (state.disableDevIndicator) {\n                       setDismissed(true)\n                     } else {\n                       setIsErrorExpanded(false)"
        },
        {
            "sha": "7cd248f6718b2a1de81337faef22f4a7b40e38cb",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-footer.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 86,
            "changes": 86,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-footer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-footer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-footer.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,86 +0,0 @@\n-import type { OverlayState } from '../../shared'\n-\n-import { DevToolsPanelVersionInfo } from './devtools-panel-version-info'\n-import { css } from '../../utils/css'\n-import { RestartServerButton } from '../errors/error-overlay-toolbar/restart-server-button'\n-\n-export function DevToolsPanelFooter({\n-  versionInfo,\n-  isDraggable,\n-  showRestartServerButton,\n-}: {\n-  versionInfo: OverlayState['versionInfo']\n-  isDraggable: boolean\n-  showRestartServerButton: boolean\n-}) {\n-  const bundlerName = (\n-    process.env.__NEXT_BUNDLER || 'WEBPACK'\n-  ).toUpperCase() as 'WEBPACK' | 'TURBOPACK' | 'RSPACK'\n-  return (\n-    <div\n-      data-nextjs-devtools-panel-footer\n-      data-nextjs-devtools-panel-draggable={isDraggable}\n-    >\n-      <div data-nextjs-devtools-panel-footer-tab-group>\n-        <DevToolsPanelVersionInfo versionInfo={versionInfo} />\n-        <div data-nextjs-devtools-panel-footer-tab>\n-          {/* TODO: The details may change, follow up. */}\n-          <span\n-            data-nextjs-devtools-panel-footer-tab-bundler-name={bundlerName}\n-          >\n-            {bundlerName}\n-          </span>\n-          <span data-nextjs-devtools-panel-footer-tab-bundler-status>\n-            enabled\n-          </span>\n-        </div>\n-      </div>\n-      {showRestartServerButton && (\n-        <div data-nextjs-devtools-panel-footer-tab-group>\n-          <RestartServerButton showButton={true} />\n-        </div>\n-      )}\n-    </div>\n-  )\n-}\n-\n-export const DEVTOOLS_PANEL_FOOTER_STYLES = css`\n-  [data-nextjs-devtools-panel-footer] {\n-    background-color: var(--color-background-200);\n-    display: flex;\n-    justify-content: space-between;\n-    align-items: center;\n-    border-top: 1px solid var(--color-gray-400);\n-    border-radius: 0 0 var(--rounded-xl) var(--rounded-xl);\n-    height: auto;\n-  }\n-\n-  [data-nextjs-devtools-panel-footer-tab-group] {\n-    display: flex;\n-    align-items: center;\n-  }\n-\n-  [data-nextjs-devtools-panel-footer-tab] {\n-    display: flex;\n-    align-items: center;\n-    padding: 12px;\n-    gap: 8px;\n-    align-self: stretch;\n-    border-right: 1px solid var(--color-gray-400);\n-\n-    color: var(--color-gray-900);\n-    font-size: 12px;\n-    font-family: var(--font-stack-monospace);\n-  }\n-\n-  [data-nextjs-devtools-panel-footer-tab-bundler-name='TURBOPACK'] {\n-    background: linear-gradient(\n-      to right,\n-      var(--color-turbopack-text-red) 0%,\n-      var(--color-turbopack-text-blue) 100%\n-    );\n-    background-clip: text;\n-    -webkit-background-clip: text;\n-    -webkit-text-fill-color: transparent;\n-  }\n-`"
        },
        {
            "sha": "ade104a5bc61244938d455d3191540025e9cd16f",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/devtools-panel-tab.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 60,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fdevtools-panel-tab.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fdevtools-panel-tab.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fdevtools-panel-tab.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,60 +0,0 @@\n-import type { DevToolsPanelTabType } from '../devtools-panel'\n-import type { Corners, OverlayState } from '../../../shared'\n-import type { DebugInfo } from '../../../../shared/types'\n-import type { ReadyRuntimeError } from '../../../utils/get-error-by-type'\n-import type { HydrationErrorState } from '../../../../shared/hydration-error'\n-\n-import { SettingsTab } from './settings-tab'\n-import { IssuesTab } from './issues-tab/issues-tab'\n-import { SegmentsExplorerTab } from './segments-explorer-tab'\n-\n-export function DevToolsPanelTab({\n-  activeTab,\n-  devToolsPosition,\n-  scale,\n-  routerType,\n-  handlePositionChange,\n-  handleScaleChange,\n-  debugInfo,\n-  runtimeErrors,\n-  getSquashedHydrationErrorDetails,\n-  buildError,\n-  page,\n-}: {\n-  activeTab: DevToolsPanelTabType\n-  devToolsPosition: Corners\n-  routerType: 'app' | 'pages'\n-  scale: number\n-  handlePositionChange: (e: React.ChangeEvent<HTMLSelectElement>) => void\n-  handleScaleChange: (e: React.ChangeEvent<HTMLSelectElement>) => void\n-  debugInfo: DebugInfo\n-  runtimeErrors: ReadyRuntimeError[]\n-  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n-  buildError: OverlayState['buildError']\n-  page: string\n-}) {\n-  switch (activeTab) {\n-    case 'settings':\n-      return (\n-        <SettingsTab\n-          devToolsPosition={devToolsPosition}\n-          scale={scale}\n-          handlePositionChange={handlePositionChange}\n-          handleScaleChange={handleScaleChange}\n-        />\n-      )\n-    case 'route':\n-      return <SegmentsExplorerTab routerType={routerType} page={page} />\n-    case 'issues':\n-      return (\n-        <IssuesTab\n-          debugInfo={debugInfo}\n-          runtimeErrors={runtimeErrors}\n-          getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n-          buildError={buildError}\n-        />\n-      )\n-    default:\n-      return null\n-  }\n-}"
        },
        {
            "sha": "29cde6fb285c4ca2ef29d25ada2e376dc277f051",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-content-layout.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 70,
            "changes": 70,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-content-layout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-content-layout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-content-layout.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,70 +0,0 @@\n-import type { DebugInfo } from '../../../../../shared/types'\n-import type { ErrorType } from '../../../errors/error-type-label/error-type-label'\n-\n-import { ErrorMessage } from '../../../errors/error-message/error-message'\n-import { ErrorOverlayToolbar } from '../../../errors/error-overlay-toolbar/error-overlay-toolbar'\n-import { ErrorTypeLabel } from '../../../errors/error-type-label/error-type-label'\n-import { EnvironmentNameLabel } from '../../../errors/environment-name-label/environment-name-label'\n-import { IssueFeedbackButton } from '../../../errors/error-overlay-toolbar/issue-feedback-button'\n-import { css } from '../../../../utils/css'\n-\n-// This behaves like the ErrorOverlayLayout.\n-export function IssuesTabContentLayout({\n-  error,\n-  errorType,\n-  message,\n-  debugInfo,\n-  children,\n-  errorCode,\n-  environmentName,\n-}: {\n-  error: Error & { environmentName?: string }\n-  errorType: ErrorType\n-  message: string\n-  debugInfo: DebugInfo\n-  children: React.ReactNode\n-\n-  errorCode?: string | null\n-  environmentName?: string\n-}) {\n-  return (\n-    <div data-nextjs-devtools-panel-tab-issues-content-layout>\n-      <div className=\"nextjs-container-errors-header\">\n-        <div\n-          className=\"nextjs__container_errors__error_title\"\n-          // allow assertion in tests before error rating is implemented\n-          data-nextjs-error-code={errorCode}\n-        >\n-          <span data-nextjs-error-label-group>\n-            <ErrorTypeLabel errorType={errorType} />\n-            {environmentName && (\n-              <EnvironmentNameLabel environmentName={environmentName} />\n-            )}\n-          </span>\n-          <ErrorOverlayToolbar\n-            error={error}\n-            debugInfo={debugInfo}\n-            // TODO: Move the button inside and remove the feedback on the footer of the error overlay.\n-            feedbackButton={\n-              errorCode && <IssueFeedbackButton errorCode={errorCode} />\n-            }\n-          />\n-        </div>\n-        <ErrorMessage errorMessage={message} />\n-      </div>\n-      {children}\n-    </div>\n-  )\n-}\n-\n-// The components in this file shares the style with the Error Overlay.\n-export const DEVTOOLS_PANEL_TAB_ISSUES_CONTENT_LAYOUT_STYLES = css`\n-  [data-nextjs-devtools-panel-tab-issues-content-layout] {\n-    flex: 1;\n-    display: flex;\n-    flex-direction: column;\n-    overflow-y: auto;\n-    min-height: 0;\n-    padding: 14px;\n-  }\n-`"
        },
        {
            "sha": "9c8ab83a41f40756fd4557f3698a44740cf7401a",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-content.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 197,
            "changes": 197,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-content.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-content.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-content.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,197 +0,0 @@\n-import type { OverlayState } from '../../../../shared'\n-import type { ReadyRuntimeError } from '../../../../utils/get-error-by-type'\n-\n-import { Suspense, useMemo, useState } from 'react'\n-import { Terminal } from '../../../terminal'\n-import { HotlinkedText } from '../../../hot-linked-text'\n-import { PseudoHtmlDiff } from '../../../../container/runtime-error/component-stack-pseudo-html'\n-import { useFrames } from '../../../../utils/get-error-by-type'\n-import { CodeFrame } from '../../../code-frame/code-frame'\n-import { CallStack } from '../../../call-stack/call-stack'\n-import { NEXTJS_HYDRATION_ERROR_LINK } from '../../../../../shared/react-19-hydration-error'\n-import { ErrorContentSkeleton } from '../../../../container/runtime-error/error-content-skeleton'\n-import { css } from '../../../../utils/css'\n-import { getErrorTextFromBuildErrorMessage } from '../../../../container/build-error'\n-import { IssuesTabContentLayout } from './issues-tab-content-layout'\n-import type { DebugInfo } from '../../../../../shared/types'\n-import type { ErrorType } from '../../../errors/error-type-label/error-type-label'\n-import { IssuesTabEmptyContent } from './issues-tab-empty-content'\n-\n-// This consists of the Build Error, Runtime Error, etc.\n-export function IssuesTabContent({\n-  notes,\n-  buildError,\n-  hydrationWarning,\n-  errorDetails,\n-  activeError,\n-  errorType,\n-  debugInfo,\n-  errorCode,\n-}: {\n-  notes: string | null\n-  buildError: OverlayState['buildError']\n-  hydrationWarning: string | null\n-  errorDetails: {\n-    hydrationWarning: string | null\n-    notes: string | null\n-    reactOutputComponentDiff: string | null\n-  } | null\n-  activeError: ReadyRuntimeError | null\n-  errorType: ErrorType | null\n-  debugInfo: DebugInfo\n-  errorCode: string | null | undefined\n-}) {\n-  if (buildError) {\n-    return <BuildError message={buildError} debugInfo={debugInfo} />\n-  }\n-\n-  return (\n-    <ErrorContent\n-      notes={notes}\n-      hydrationWarning={hydrationWarning}\n-      errorDetails={errorDetails}\n-      activeError={activeError}\n-      errorType={errorType}\n-      debugInfo={debugInfo}\n-      errorCode={errorCode}\n-    />\n-  )\n-}\n-\n-function ErrorContent({\n-  notes,\n-  hydrationWarning,\n-  errorDetails,\n-  activeError,\n-  errorType,\n-  debugInfo,\n-  errorCode,\n-}: {\n-  notes: string | null\n-  hydrationWarning: string | null\n-  errorDetails: {\n-    hydrationWarning: string | null\n-    notes: string | null\n-    reactOutputComponentDiff: string | null\n-  } | null\n-  activeError: ReadyRuntimeError | null\n-  errorType: ErrorType | null\n-  debugInfo: DebugInfo\n-  errorCode: string | null | undefined\n-}) {\n-  if (!activeError || !errorType) {\n-    return <IssuesTabEmptyContent />\n-  }\n-\n-  return (\n-    <IssuesTabContentLayout\n-      error={activeError.error}\n-      errorType={errorType}\n-      message={activeError.error.message}\n-      debugInfo={debugInfo}\n-      errorCode={errorCode}\n-      environmentName={activeError.error.environmentName}\n-    >\n-      <div className=\"error-overlay-notes-container\">\n-        {notes ? (\n-          <>\n-            <p\n-              id=\"nextjs__container_errors__notes\"\n-              className=\"nextjs__container_errors__notes\"\n-            >\n-              {notes}\n-            </p>\n-          </>\n-        ) : null}\n-        {hydrationWarning ? (\n-          <p\n-            id=\"nextjs__container_errors__link\"\n-            className=\"nextjs__container_errors__link\"\n-          >\n-            <HotlinkedText\n-              text={`See more info here: ${NEXTJS_HYDRATION_ERROR_LINK}`}\n-            />\n-          </p>\n-        ) : null}\n-      </div>\n-      {errorDetails?.reactOutputComponentDiff ? (\n-        <PseudoHtmlDiff\n-          reactOutputComponentDiff={errorDetails.reactOutputComponentDiff || ''}\n-        />\n-      ) : null}\n-      <Suspense fallback={<ErrorContentSkeleton />}>\n-        <RuntimeError key={activeError.id.toString()} error={activeError} />\n-      </Suspense>\n-    </IssuesTabContentLayout>\n-  )\n-}\n-\n-/* Ported the content from container/runtime-error/index.tsx */\n-function RuntimeError({ error }: { error: ReadyRuntimeError }) {\n-  const [isIgnoreListOpen, setIsIgnoreListOpen] = useState(false)\n-  const frames = useFrames(error)\n-\n-  const ignoredFramesTally = useMemo(() => {\n-    return frames.reduce((tally, frame) => tally + (frame.ignored ? 1 : 0), 0)\n-  }, [frames])\n-\n-  const firstFrame = useMemo(() => {\n-    const firstFirstPartyFrameIndex = frames.findIndex(\n-      (entry) =>\n-        !entry.ignored &&\n-        Boolean(entry.originalCodeFrame) &&\n-        Boolean(entry.originalStackFrame)\n-    )\n-\n-    return frames[firstFirstPartyFrameIndex] ?? null\n-  }, [frames])\n-\n-  return (\n-    <>\n-      {firstFrame &&\n-        firstFrame.originalStackFrame &&\n-        firstFrame.originalCodeFrame && (\n-          <CodeFrame\n-            stackFrame={firstFrame.originalStackFrame}\n-            codeFrame={firstFrame.originalCodeFrame}\n-          />\n-        )}\n-\n-      {frames.length > 0 && (\n-        <CallStack\n-          frames={frames}\n-          isIgnoreListOpen={isIgnoreListOpen}\n-          onToggleIgnoreList={() => setIsIgnoreListOpen(!isIgnoreListOpen)}\n-          ignoredFramesTally={ignoredFramesTally}\n-        />\n-      )}\n-    </>\n-  )\n-}\n-\n-function BuildError({\n-  message,\n-  debugInfo,\n-}: {\n-  message: string\n-  debugInfo: DebugInfo\n-}) {\n-  const error = new Error(message)\n-  const formattedMessage = useMemo(\n-    () => getErrorTextFromBuildErrorMessage(message) || 'Failed to compile',\n-    [message]\n-  )\n-  return (\n-    <IssuesTabContentLayout\n-      errorType={'Build Error'}\n-      error={error}\n-      message={formattedMessage}\n-      debugInfo={debugInfo}\n-    >\n-      <Terminal content={message} />\n-    </IssuesTabContentLayout>\n-  )\n-}\n-\n-// The components in this file shares the style with the Error Overlay.\n-export const DEVTOOLS_PANEL_TAB_ISSUES_CONTENT_STYLES = css``"
        },
        {
            "sha": "89643c7e4d92a68b19dc47c49d6ab2d963731b47",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-empty-content.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 64,
            "changes": 64,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-empty-content.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-empty-content.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-empty-content.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,64 +0,0 @@\n-import { Warning } from '../../../../icons/warning'\n-import { css } from '../../../../utils/css'\n-\n-export function IssuesTabEmptyContent() {\n-  return (\n-    <div data-nextjs-devtools-panel-tab-issues-empty>\n-      <div data-nextjs-devtools-panel-tab-issues-empty-content>\n-        <div data-nextjs-devtools-panel-tab-issues-empty-icon>\n-          <Warning width={16} height={16} />\n-        </div>\n-        <h3 data-nextjs-devtools-panel-tab-issues-empty-title>\n-          No Issues Found\n-        </h3>\n-        <p data-nextjs-devtools-panel-tab-issues-empty-subtitle>\n-          Issues will appear here when they occur.\n-        </p>\n-      </div>\n-    </div>\n-  )\n-}\n-\n-export const DEVTOOLS_PANEL_TAB_ISSUES_EMPTY_CONTENT_STYLES = css`\n-  [data-nextjs-devtools-panel-tab-issues-empty] {\n-    display: flex;\n-    flex: 1;\n-    padding: 12px;\n-    min-height: 0;\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-empty-content] {\n-    display: flex;\n-    flex-direction: column;\n-    align-items: center;\n-    justify-content: center;\n-    flex: 1;\n-    border: 1px dashed var(--color-gray-alpha-500);\n-    border-radius: 4px;\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-empty-icon] {\n-    margin-bottom: 16px;\n-    padding: 8px;\n-    border: 1px solid var(--color-gray-alpha-400);\n-    border-radius: 6px;\n-\n-    background-color: var(--color-background-100);\n-    display: flex;\n-    align-items: center;\n-    justify-content: center;\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-empty-title] {\n-    color: var(--color-gray-1000);\n-    font-size: 16px;\n-    font-weight: 500;\n-    line-height: var(--line-height-20);\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-empty-subtitle] {\n-    color: var(--color-gray-900);\n-    font-size: 14px;\n-    line-height: var(--line-height-21);\n-  }\n-`"
        },
        {
            "sha": "f75e8d69cf9bb37d26cb83d9d846538b500483ab",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-sidebar-frame-skeleton.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 52,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-sidebar-frame-skeleton.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-sidebar-frame-skeleton.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-sidebar-frame-skeleton.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,52 +0,0 @@\n-import { css } from '../../../../utils/css'\n-\n-export function IssuesTabSidebarFrameSkeleton() {\n-  return (\n-    <>\n-      <div data-nextjs-devtools-panel-tab-issues-sidebar-frame-skeleton-bar=\"1\" />\n-      <div data-nextjs-devtools-panel-tab-issues-sidebar-frame-skeleton-bar=\"2\" />\n-    </>\n-  )\n-}\n-\n-export const DEVTOOLS_PANEL_TAB_ISSUES_SIDEBAR_FRAME_SKELETON_STYLES = css`\n-  [data-nextjs-devtools-panel-tab-issues-sidebar-frame-skeleton-bar] {\n-    height: var(--size-12);\n-    border-radius: 100px;\n-    background: linear-gradient(\n-      90deg,\n-      var(--color-gray-200) 25%,\n-      var(--color-gray-100) 50%,\n-      var(--color-gray-200) 75%\n-    );\n-    background-size: 200% 100%;\n-    animation: skeleton-shimmer 1.5s ease-in-out infinite;\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-sidebar-frame-skeleton-bar='1'] {\n-    width: 75%;\n-    margin-bottom: 8px;\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-sidebar-frame-skeleton-bar='2'] {\n-    width: 36.5%;\n-  }\n-\n-  @keyframes skeleton-shimmer {\n-    0% {\n-      background-position: -200% 0;\n-    }\n-    100% {\n-      background-position: 200% 0;\n-    }\n-  }\n-\n-  /* Respect user's motion preferences */\n-  @media (prefers-reduced-motion: reduce) {\n-    [data-nextjs-devtools-panel-tab-issues-sidebar-frame-skeleton-bar='1'],\n-    [data-nextjs-devtools-panel-tab-issues-sidebar-frame-skeleton-bar='2'] {\n-      animation: none;\n-      background: var(--color-gray-200);\n-    }\n-  }\n-`"
        },
        {
            "sha": "b03cb56494c6af6409b3ef528c1ec711fbad3361",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-sidebar.stories.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 41,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-sidebar.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-sidebar.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-sidebar.stories.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,41 +0,0 @@\n-import type { Meta, StoryObj } from '@storybook/react'\n-import { useState } from 'react'\n-import { IssuesTabSidebar } from './issues-tab-sidebar'\n-import { withShadowPortal } from '../../../../storybook/with-shadow-portal'\n-import { runtimeErrors } from '../../../../storybook/errors'\n-\n-const meta: Meta<typeof IssuesTabSidebar> = {\n-  component: IssuesTabSidebar,\n-  parameters: {\n-    layout: 'centered',\n-  },\n-  decorators: [withShadowPortal],\n-}\n-\n-export default meta\n-type Story = StoryObj<typeof IssuesTabSidebar>\n-\n-const SidebarWrapper = ({\n-  runtimeErrors: errors,\n-  errorType,\n-}: {\n-  runtimeErrors: any[]\n-  errorType: string | null\n-}) => {\n-  const [activeIdx, setActiveIdx] = useState(0)\n-\n-  return (\n-    <IssuesTabSidebar\n-      runtimeErrors={errors}\n-      errorType={errorType}\n-      activeIdx={activeIdx}\n-      setActiveIndex={setActiveIdx}\n-    />\n-  )\n-}\n-\n-export const Default: Story = {\n-  render: () => (\n-    <SidebarWrapper runtimeErrors={runtimeErrors} errorType=\"runtime\" />\n-  ),\n-}"
        },
        {
            "sha": "68990f3fd11630d9287173ff6c6e782f1da3135a",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-sidebar.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 179,
            "changes": 179,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-sidebar.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-sidebar.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab-sidebar.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,179 +0,0 @@\n-import type { ReadyRuntimeError } from '../../../../utils/get-error-by-type'\n-\n-import { Suspense, useMemo, memo } from 'react'\n-\n-import { css } from '../../../../utils/css'\n-import { getFrameSource } from '../../../../../shared/stack-frame'\n-import { useFrames } from '../../../../utils/get-error-by-type'\n-import { getErrorTypeLabel } from '../../../../container/errors'\n-import { IssuesTabSidebarFrameSkeleton } from './issues-tab-sidebar-frame-skeleton'\n-\n-export function IssuesTabSidebar({\n-  runtimeErrors,\n-  activeIdx,\n-  setActiveIndex,\n-}: {\n-  runtimeErrors: ReadyRuntimeError[]\n-  errorType: string | null\n-  activeIdx: number\n-  setActiveIndex: (idx: number) => void\n-}) {\n-  if (runtimeErrors.length === 0) {\n-    return null\n-  }\n-\n-  return (\n-    <aside data-nextjs-devtools-panel-tab-issues-sidebar>\n-      {runtimeErrors.map((runtimeError, idx) => {\n-        const isActive = idx === activeIdx\n-        return (\n-          <IssuesTabSidebarFrame\n-            key={idx}\n-            runtimeError={runtimeError}\n-            idx={idx}\n-            isActive={isActive}\n-            setActiveIndex={setActiveIndex}\n-          />\n-        )\n-      })}\n-    </aside>\n-  )\n-}\n-\n-const IssuesTabSidebarFrameItem = memo(function IssuesTabSidebarFrameItem({\n-  runtimeError,\n-}: {\n-  runtimeError: ReadyRuntimeError\n-}) {\n-  const frames = useFrames(runtimeError)\n-\n-  const firstFrame = useMemo(() => {\n-    const firstFirstPartyFrameIndex = frames.findIndex(\n-      (entry) =>\n-        !entry.ignored &&\n-        Boolean(entry.originalCodeFrame) &&\n-        Boolean(entry.originalStackFrame)\n-    )\n-\n-    return frames[firstFirstPartyFrameIndex] ?? null\n-  }, [frames])\n-\n-  if (!firstFrame?.originalStackFrame) {\n-    return null\n-  }\n-\n-  const errorType = getErrorTypeLabel(runtimeError.error, runtimeError.type)\n-  const frameSource = getFrameSource(firstFrame.originalStackFrame)\n-\n-  return (\n-    <>\n-      <span data-nextjs-devtools-panel-tab-issues-sidebar-frame-error-type>\n-        {errorType}\n-      </span>\n-      <span data-nextjs-devtools-panel-tab-issues-sidebar-frame-source>\n-        {frameSource}\n-      </span>\n-    </>\n-  )\n-})\n-\n-const IssuesTabSidebarFrame = memo(function IssuesTabSidebarFrame({\n-  runtimeError,\n-  idx,\n-  isActive,\n-  setActiveIndex,\n-}: {\n-  runtimeError: ReadyRuntimeError\n-  idx: number\n-  isActive: boolean\n-  setActiveIndex: (idx: number) => void\n-}) {\n-  return (\n-    <button\n-      data-nextjs-devtools-panel-tab-issues-sidebar-frame\n-      data-nextjs-devtools-panel-tab-issues-sidebar-frame-active={isActive}\n-      onClick={() => setActiveIndex(idx)}\n-    >\n-      <Suspense fallback={<IssuesTabSidebarFrameSkeleton />}>\n-        <IssuesTabSidebarFrameItem runtimeError={runtimeError} />\n-      </Suspense>\n-    </button>\n-  )\n-})\n-\n-export const DEVTOOLS_PANEL_TAB_ISSUES_SIDEBAR_STYLES = css`\n-  [data-nextjs-devtools-panel-tab-issues-sidebar] {\n-    display: flex;\n-    flex-direction: column;\n-    gap: 4px;\n-    padding: 8px;\n-    border-right: 1px solid var(--color-gray-400);\n-    overflow-y: auto;\n-    min-height: 0;\n-\n-    @media (max-width: 575px) {\n-      max-width: 112px;\n-    }\n-\n-    @media (min-width: 576px) {\n-      max-width: 138px;\n-      width: 100%;\n-    }\n-\n-    @media (min-width: 768px) {\n-      max-width: 172.5px;\n-      width: 100%;\n-    }\n-\n-    @media (min-width: 992px) {\n-      max-width: 230px;\n-      width: 100%;\n-    }\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-sidebar-frame] {\n-    display: flex;\n-    flex-direction: column;\n-    padding: 10px 8px;\n-    border-radius: var(--rounded-lg);\n-    transition: background-color 0.2s ease-in-out;\n-\n-    &:hover {\n-      background-color: var(--color-gray-200);\n-    }\n-\n-    &:active {\n-      background-color: var(--color-gray-300);\n-    }\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-sidebar-frame-active='true'] {\n-    background-color: var(--color-gray-100);\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-sidebar-frame-error-type] {\n-    display: inline-block;\n-    align-self: flex-start;\n-    color: var(--color-gray-1000);\n-    font-size: var(--size-14);\n-    font-weight: 500;\n-    line-height: var(--size-20);\n-  }\n-\n-  [data-nextjs-devtools-panel-tab-issues-sidebar-frame-source] {\n-    display: inline-block;\n-    align-self: flex-start;\n-    color: var(--color-gray-900);\n-    font-size: var(--size-13);\n-    line-height: var(--size-18);\n-  }\n-\n-  /* Ellipsis for long stack frame source or small devices. */\n-  [data-nextjs-devtools-panel-tab-issues-sidebar-frame-error-type],\n-  [data-nextjs-devtools-panel-tab-issues-sidebar-frame-source] {\n-    overflow: hidden;\n-    text-overflow: ellipsis;\n-    white-space: nowrap;\n-    max-width: 100%;\n-  }\n-`"
        },
        {
            "sha": "e701ac0dae1414c9c6bb5769ae9a2ff610d44151",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 64,
            "changes": 64,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fissues-tab%2Fissues-tab.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,64 +0,0 @@\n-import type { OverlayState } from '../../../../shared'\n-import type { DebugInfo } from '../../../../../shared/types'\n-import type { ReadyRuntimeError } from '../../../../utils/get-error-by-type'\n-import type { HydrationErrorState } from '../../../../../shared/hydration-error'\n-\n-import { IssuesTabSidebar } from './issues-tab-sidebar'\n-import { IssuesTabContent } from './issues-tab-content'\n-import { css } from '../../../../utils/css'\n-import { useActiveRuntimeError } from '../../../../hooks/use-active-runtime-error'\n-\n-export function IssuesTab({\n-  debugInfo,\n-  runtimeErrors,\n-  getSquashedHydrationErrorDetails,\n-  buildError,\n-}: {\n-  debugInfo: DebugInfo\n-  runtimeErrors: ReadyRuntimeError[]\n-  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n-  buildError: OverlayState['buildError']\n-}) {\n-  const {\n-    errorCode,\n-    errorType,\n-    hydrationWarning,\n-    activeError,\n-    activeIdx,\n-    setActiveIndex,\n-    notes,\n-    errorDetails,\n-  } = useActiveRuntimeError({ runtimeErrors, getSquashedHydrationErrorDetails })\n-\n-  return (\n-    <div data-nextjs-devtools-panel-tab-issues>\n-      {buildError ? null : (\n-        <IssuesTabSidebar\n-          runtimeErrors={runtimeErrors}\n-          errorType={errorType}\n-          activeIdx={activeIdx}\n-          setActiveIndex={setActiveIndex}\n-        />\n-      )}\n-\n-      <IssuesTabContent\n-        buildError={buildError}\n-        notes={notes}\n-        hydrationWarning={hydrationWarning}\n-        errorDetails={errorDetails}\n-        activeError={activeError}\n-        errorType={errorType}\n-        debugInfo={debugInfo}\n-        errorCode={errorCode}\n-      />\n-    </div>\n-  )\n-}\n-\n-export const DEVTOOLS_PANEL_TAB_ISSUES_STYLES = css`\n-  [data-nextjs-devtools-panel-tab-issues] {\n-    display: flex;\n-    flex: 1;\n-    min-height: 0;\n-  }\n-`"
        },
        {
            "sha": "6363c57bf3855f406a4fab2e757051d30a9a83e1",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/segments-explorer-tab.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 26,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fsegments-explorer-tab.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fsegments-explorer-tab.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fsegments-explorer-tab.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,26 +0,0 @@\n-const PageSegmentTree = process.env.__NEXT_DEVTOOL_SEGMENT_EXPLORER\n-  ? (\n-      require('../../overview/segment-explorer') as typeof import('../../overview/segment-explorer')\n-    ).PageSegmentTree\n-  : () => null\n-\n-function SegmentsExplorer({\n-  routerType,\n-  page,\n-}: React.HTMLProps<HTMLDivElement> & {\n-  routerType: 'app' | 'pages'\n-  page: string\n-}) {\n-  const isAppRouter = routerType === 'app'\n-  return <PageSegmentTree isAppRouter={isAppRouter} page={page} />\n-}\n-\n-export function SegmentsExplorerTab({\n-  routerType,\n-  page,\n-}: {\n-  routerType: 'app' | 'pages'\n-  page: string\n-}) {\n-  return <SegmentsExplorer routerType={routerType} page={page} />\n-}"
        },
        {
            "sha": "a3d79d7be035b2da93b84f4a1d28a8776ccd358b",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-tab/settings-tab.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 312,
            "changes": 312,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fsettings-tab.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fsettings-tab.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-tab%2Fsettings-tab.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,312 +0,0 @@\n-import type { Corners } from '../../../shared'\n-\n-import { useTheme } from '../hooks/use-theme'\n-import { Select } from '../../select/select'\n-import { STORAGE_KEY_THEME, NEXT_DEV_TOOLS_SCALE } from '../../../shared'\n-import { css } from '../../../utils/css'\n-import LightIcon from '../../../icons/light-icon'\n-import DarkIcon from '../../../icons/dark-icon'\n-import SystemIcon from '../../../icons/system-icon'\n-import EyeIcon from '../../../icons/eye-icon'\n-\n-function ThemeIcon({ theme }: { theme: 'dark' | 'light' | 'system' }) {\n-  switch (theme) {\n-    case 'system':\n-      return <SystemIcon />\n-    case 'dark':\n-      return <DarkIcon />\n-    case 'light':\n-      return <LightIcon />\n-    default:\n-      return null\n-  }\n-}\n-\n-export function SettingsTab({\n-  devToolsPosition,\n-  scale,\n-  handlePositionChange,\n-  handleScaleChange,\n-}: {\n-  devToolsPosition: Corners\n-  scale: number\n-  handlePositionChange: (e: React.ChangeEvent<HTMLSelectElement>) => void\n-  handleScaleChange: (e: React.ChangeEvent<HTMLSelectElement>) => void\n-}) {\n-  const [theme, setTheme] = useTheme()\n-\n-  const handleThemeChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n-    const portal = document.querySelector('nextjs-portal')\n-    if (!portal) return\n-\n-    setTheme(e.target.value)\n-\n-    if (e.target.value === 'system') {\n-      portal.classList.remove('dark')\n-      portal.classList.remove('light')\n-      localStorage.removeItem(STORAGE_KEY_THEME)\n-      return\n-    }\n-\n-    if (e.target.value === 'dark') {\n-      portal.classList.add('dark')\n-      portal.classList.remove('light')\n-      localStorage.setItem(STORAGE_KEY_THEME, 'dark')\n-    } else {\n-      portal.classList.remove('dark')\n-      portal.classList.add('light')\n-      localStorage.setItem(STORAGE_KEY_THEME, 'light')\n-    }\n-  }\n-\n-  function handleRestartDevServer(invalidatePersistentCache: boolean) {\n-    let endpoint = '/__nextjs_restart_dev'\n-\n-    if (invalidatePersistentCache) {\n-      endpoint = '/__nextjs_restart_dev?invalidatePersistentCache'\n-    }\n-\n-    fetch(endpoint, {\n-      method: 'POST',\n-    }).then(() => {\n-      // TODO: poll server status and reload when the server is back up.\n-      // https://github.com/vercel/next.js/pull/80005\n-    })\n-  }\n-\n-  function hide() {\n-    fetch('/__nextjs_disable_dev_indicator', {\n-      method: 'POST',\n-    })\n-  }\n-\n-  return (\n-    <div data-nextjs-devtools-panel-settings>\n-      <div data-nextjs-devtools-panel-settings-section>\n-        <div data-nextjs-devtools-panel-settings-section-header>\n-          <label htmlFor=\"theme\">Theme</label>\n-          <p data-nextjs-devtools-panel-settings-section-description>\n-            Select your theme preference.\n-          </p>\n-        </div>\n-        <Select\n-          id=\"theme\"\n-          name=\"theme\"\n-          prefix={<ThemeIcon theme={theme as 'dark' | 'light' | 'system'} />}\n-          value={theme}\n-          onChange={handleThemeChange}\n-        >\n-          <option value=\"system\">System</option>\n-          <option value=\"light\">Light</option>\n-          <option value=\"dark\">Dark</option>\n-        </Select>\n-      </div>\n-\n-      <div data-nextjs-devtools-panel-settings-section>\n-        <div data-nextjs-devtools-panel-settings-section-header>\n-          <label htmlFor=\"position\">Position</label>\n-          <p data-nextjs-devtools-panel-settings-section-description>\n-            Adjust the placement of your dev tools.\n-          </p>\n-        </div>\n-        <Select\n-          id=\"position\"\n-          name=\"position\"\n-          value={devToolsPosition}\n-          onChange={handlePositionChange}\n-        >\n-          <option value=\"bottom-left\">Bottom Left</option>\n-          <option value=\"bottom-right\">Bottom Right</option>\n-          <option value=\"top-left\">Top Left</option>\n-          <option value=\"top-right\">Top Right</option>\n-        </Select>\n-      </div>\n-\n-      <div data-nextjs-devtools-panel-settings-section>\n-        <div data-nextjs-devtools-panel-settings-section-header>\n-          <label htmlFor=\"size\">Size</label>\n-          <p data-nextjs-devtools-panel-settings-section-description>\n-            Adjust the size of your dev tools.\n-          </p>\n-        </div>\n-        <Select\n-          id=\"size\"\n-          name=\"size\"\n-          value={scale}\n-          onChange={handleScaleChange}\n-        >\n-          {Object.entries(NEXT_DEV_TOOLS_SCALE).map(([key, value]) => {\n-            return (\n-              <option value={value} key={key}>\n-                {key}\n-              </option>\n-            )\n-          })}\n-        </Select>\n-      </div>\n-\n-      <div data-nextjs-devtools-panel-settings-section>\n-        <div data-nextjs-devtools-panel-settings-section-header>\n-          <label id=\"hide-dev-tools\">Hide Dev Tools for this session</label>\n-          <p data-nextjs-devtools-panel-settings-section-description>\n-            Hide Dev Tools until you restart your dev server, or 1 day.\n-          </p>\n-        </div>\n-        <div>\n-          <button\n-            aria-describedby=\"hide-dev-tools\"\n-            name=\"hide-dev-tools\"\n-            data-hide-dev-tools\n-            data-nextjs-devtools-panel-settings-section-action-button\n-            onClick={hide}\n-          >\n-            <EyeIcon />\n-            <span>Hide</span>\n-          </button>\n-        </div>\n-      </div>\n-\n-      <div data-nextjs-devtools-panel-settings-section>\n-        <div data-nextjs-devtools-panel-settings-section-header>\n-          <label>Disable Dev Tools for this project</label>\n-          <p data-nextjs-devtools-panel-settings-section-description>\n-            To disable this UI completely, set{' '}\n-            <code className=\"dev-tools-info-code\">devIndicators: false</code> in\n-            your <code className=\"dev-tools-info-code\">next.config</code> file.\n-          </p>\n-        </div>\n-      </div>\n-\n-      <div data-nextjs-devtools-panel-settings-section>\n-        <div data-nextjs-devtools-panel-settings-section-header>\n-          <label id=\"restart-dev-server\">Restart Dev Server</label>\n-          <p data-nextjs-devtools-panel-settings-section-description>\n-            Restarts the development server without needing to leave the\n-            browser.\n-          </p>\n-        </div>\n-        <div>\n-          <button\n-            aria-describedby=\"restart-dev-server\"\n-            title=\"Restarts the development server without needing to leave the browser.\"\n-            name=\"restart-dev-server\"\n-            data-restart-dev-server\n-            data-nextjs-devtools-panel-settings-section-action-button\n-            onClick={() =>\n-              handleRestartDevServer(/*invalidatePersistentCache*/ false)\n-            }\n-          >\n-            <span>Restart</span>\n-          </button>\n-        </div>\n-      </div>\n-\n-      {process.env.__NEXT_TURBOPACK_PERSISTENT_CACHE ? (\n-        <div data-nextjs-devtools-panel-settings-section>\n-          <div data-nextjs-devtools-panel-settings-section-header>\n-            <label id=\"reset-bundler-cache\">Reset Bundler Cache</label>\n-            <p data-nextjs-devtools-panel-settings-section-description>\n-              Clears the bundler cache and restarts the dev server. Helpful if\n-              you are seeing stale errors or changes are not appearing.\n-            </p>\n-          </div>\n-          <div>\n-            <button\n-              aria-describedby=\"reset-bundler-cache\"\n-              title=\"Clears the bundler cache and restarts the dev server. Helpful if you are seeing stale errors or changes are not appearing.\"\n-              name=\"reset-bundler-cache\"\n-              data-reset-bundler-cache\n-              data-nextjs-devtools-panel-settings-section-action-button\n-              onClick={() =>\n-                handleRestartDevServer(/*invalidatePersistentCache*/ true)\n-              }\n-            >\n-              <span>Reset Cache</span>\n-            </button>\n-          </div>\n-        </div>\n-      ) : null}\n-    </div>\n-  )\n-}\n-\n-export const DEVTOOLS_PANEL_TAB_SETTINGS_STYLES = css`\n-  [data-nextjs-devtools-panel-settings] {\n-    padding: 16px;\n-  }\n-\n-  [data-nextjs-devtools-panel-settings-section]:first-child {\n-    padding-top: 0;\n-  }\n-\n-  [data-nextjs-devtools-panel-settings-section] {\n-    padding: 12px 0;\n-    border-bottom: 1px solid var(--color-gray-400);\n-    display: flex;\n-    justify-content: space-between;\n-    align-items: center;\n-    gap: 24px;\n-  }\n-\n-  [data-nextjs-devtools-panel-settings-section]:last-child {\n-    padding-bottom: 0;\n-    border-bottom: none;\n-  }\n-\n-  [data-nextjs-devtools-panel-settings-section-header] {\n-    margin-bottom: 0;\n-    flex: 1;\n-  }\n-\n-  [data-nextjs-devtools-panel-settings-section-header] label {\n-    font-size: var(--size-14);\n-    font-weight: 500;\n-    color: var(--color-gray-1000);\n-    margin: 0;\n-  }\n-\n-  [data-nextjs-devtools-panel-settings-section-description] {\n-    color: var(--color-gray-900);\n-    font-size: var(--size-14);\n-    margin: 0;\n-  }\n-\n-  [data-nextjs-select],\n-  [data-nextjs-devtools-panel-settings-section-action-button] {\n-    display: flex;\n-    align-items: center;\n-    gap: 8px;\n-    background: var(--color-background-100);\n-    border: 1px solid var(--color-gray-400);\n-    border-radius: var(--rounded-lg);\n-    font-weight: 400;\n-    font-size: var(--size-14);\n-    color: var(--color-gray-1000);\n-    padding: 6px 8px;\n-\n-    &:hover {\n-      background: var(--color-gray-100);\n-    }\n-  }\n-\n-  [data-nextjs-select] {\n-    &:focus-within {\n-      outline: var(--focus-ring);\n-    }\n-\n-    select {\n-      all: unset;\n-    }\n-\n-    option {\n-      color: var(--color-gray-1000);\n-      background: var(--color-background-100);\n-    }\n-  }\n-\n-  :global(.icon) {\n-    width: 18px;\n-    height: 18px;\n-    color: #666;\n-  }\n-`"
        },
        {
            "sha": "60a8f861dd27ce4ea503be8a0962f808a3cc00d5",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-version-info.stories.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 95,
            "changes": 95,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-version-info.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-version-info.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-version-info.stories.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,95 +0,0 @@\n-import type { Meta, StoryObj } from '@storybook/react'\n-import { DevToolsPanelVersionInfo } from './devtools-panel-version-info'\n-import { withShadowPortal } from '../../storybook/with-shadow-portal'\n-\n-const meta: Meta<typeof DevToolsPanelVersionInfo> = {\n-  component: DevToolsPanelVersionInfo,\n-  parameters: {\n-    layout: 'centered',\n-  },\n-  decorators: [withShadowPortal],\n-}\n-\n-export default meta\n-type Story = StoryObj<typeof DevToolsPanelVersionInfo>\n-\n-// Mock version info for different scenarios\n-const mockVersionInfo = {\n-  fresh: {\n-    installed: '15.0.0',\n-    expected: '15.0.0',\n-    staleness: 'fresh' as const,\n-  },\n-  stalePatch: {\n-    installed: '15.0.0',\n-    expected: '15.0.1',\n-    staleness: 'stale-patch' as const,\n-  },\n-  staleMinor: {\n-    installed: '15.0.0',\n-    expected: '15.1.0',\n-    staleness: 'stale-minor' as const,\n-  },\n-  staleMajor: {\n-    installed: '14.0.0',\n-    expected: '15.0.0',\n-    staleness: 'stale-major' as const,\n-  },\n-  stalePrerelease: {\n-    installed: '15.0.0-canary.0',\n-    expected: '15.0.0-canary.1',\n-    staleness: 'stale-prerelease' as const,\n-  },\n-  newerThanNpm: {\n-    installed: '15.0.0-canary.1',\n-    expected: '15.0.0-canary.0',\n-    staleness: 'newer-than-npm' as const,\n-  },\n-  unknown: {\n-    installed: '15.0.0',\n-    expected: '15.0.0',\n-    staleness: 'unknown' as const,\n-  },\n-}\n-\n-export const Fresh: Story = {\n-  args: {\n-    versionInfo: mockVersionInfo.fresh,\n-  },\n-}\n-\n-export const StalePatch: Story = {\n-  args: {\n-    versionInfo: mockVersionInfo.stalePatch,\n-  },\n-}\n-\n-export const StaleMinor: Story = {\n-  args: {\n-    versionInfo: mockVersionInfo.staleMinor,\n-  },\n-}\n-\n-export const StaleMajor: Story = {\n-  args: {\n-    versionInfo: mockVersionInfo.staleMajor,\n-  },\n-}\n-\n-export const StalePrerelease: Story = {\n-  args: {\n-    versionInfo: mockVersionInfo.stalePrerelease,\n-  },\n-}\n-\n-export const NewerThanNpm: Story = {\n-  args: {\n-    versionInfo: mockVersionInfo.newerThanNpm,\n-  },\n-}\n-\n-export const Unknown: Story = {\n-  args: {\n-    versionInfo: mockVersionInfo.unknown,\n-  },\n-}"
        },
        {
            "sha": "c4cdadc323b111cb5b4266eb4289a9c4b07b0bdd",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel-version-info.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 57,
            "changes": 57,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-version-info.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-version-info.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel-version-info.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,57 +0,0 @@\n-import type { OverlayState } from '../../shared'\n-\n-import { EclipseIcon } from '../../icons/eclipse'\n-import { getStaleness } from '../../../shared/version-staleness'\n-import { css } from '../../utils/css'\n-\n-export function DevToolsPanelVersionInfo({\n-  versionInfo,\n-}: {\n-  versionInfo: OverlayState['versionInfo']\n-}) {\n-  const { staleness } = versionInfo\n-  const { text, indicatorClass, title } = getStaleness(versionInfo)\n-  const shouldBeLink = staleness.startsWith('stale')\n-\n-  if (shouldBeLink) {\n-    return (\n-      // TODO: Make it button-like and display radix-ui Tooltip on hover.\n-      <a\n-        data-nextjs-devtools-panel-footer-tab\n-        target=\"_blank\"\n-        rel=\"noopener noreferrer\"\n-        href=\"https://nextjs.org/docs/messages/version-staleness\"\n-        title={title}\n-      >\n-        <EclipseIcon data-nextjs-version-staleness-indicator={indicatorClass} />\n-        <span>{text}</span>\n-      </a>\n-    )\n-  }\n-\n-  return (\n-    <div data-nextjs-devtools-panel-footer-tab title={title}>\n-      <EclipseIcon data-nextjs-version-staleness-indicator={indicatorClass} />\n-      <span>{text}</span>\n-    </div>\n-  )\n-}\n-\n-export const DEVTOOLS_PANEL_VERSION_INFO_STYLES = css`\n-  [data-nextjs-version-staleness-indicator='fresh'] {\n-    fill: var(--color-green-800);\n-    stroke: var(--color-green-300);\n-  }\n-  [data-nextjs-version-staleness-indicator='stale'] {\n-    fill: var(--color-amber-800);\n-    stroke: var(--color-amber-300);\n-  }\n-  [data-nextjs-version-staleness-indicator='outdated'] {\n-    fill: var(--color-red-800);\n-    stroke: var(--color-red-300);\n-  }\n-  [data-nextjs-version-staleness-indicator='unknown'] {\n-    fill: var(--color-gray-800);\n-    stroke: var(--color-gray-300);\n-  }\n-`"
        },
        {
            "sha": "e52e1e34f961201d6a41b5c6b34b8fec74da3765",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel.stories.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 87,
            "changes": 87,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.stories.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,87 +0,0 @@\n-import type { Meta, StoryObj } from '@storybook/react'\n-import type { OverlayState } from '../../shared'\n-\n-import { DevToolsPanel } from './devtools-panel'\n-import { INITIAL_OVERLAY_STATE } from '../../shared'\n-import { withShadowPortal } from '../../storybook/with-shadow-portal'\n-import { runtimeErrors } from '../../storybook/errors'\n-\n-const meta: Meta<typeof DevToolsPanel> = {\n-  component: DevToolsPanel,\n-  parameters: {\n-    layout: 'centered',\n-  },\n-  argTypes: {},\n-  decorators: [withShadowPortal],\n-}\n-\n-export default meta\n-type Story = StoryObj<typeof DevToolsPanel>\n-\n-const state: OverlayState = {\n-  ...INITIAL_OVERLAY_STATE,\n-  routerType: 'app',\n-  isErrorOverlayOpen: false,\n-  isDevToolsPanelOpen: true,\n-  versionInfo: {\n-    installed: '15.0.0',\n-    expected: '15.0.0',\n-    staleness: 'fresh',\n-  },\n-}\n-\n-export const Default: Story = {\n-  args: {\n-    state,\n-    dispatch: () => {},\n-    issueCount: 0,\n-    runtimeErrors: [],\n-    getSquashedHydrationErrorDetails: () => null,\n-  },\n-}\n-\n-export const WithIssues: Story = {\n-  args: {\n-    state,\n-    dispatch: () => {},\n-    issueCount: runtimeErrors.length,\n-    runtimeErrors,\n-    getSquashedHydrationErrorDetails: () => null,\n-  },\n-}\n-\n-export const Turbopack: Story = {\n-  beforeEach: () => {\n-    process.env.__NEXT_BUNDLER = 'Turbopack'\n-\n-    // clean up callback function\n-    return () => {\n-      delete process.env.__NEXT_BUNDLER\n-    }\n-  },\n-  args: {\n-    state,\n-    dispatch: () => {},\n-    issueCount: 0,\n-    runtimeErrors: [],\n-    getSquashedHydrationErrorDetails: () => null,\n-  },\n-}\n-\n-export const Rspack: Story = {\n-  beforeEach: () => {\n-    process.env.__NEXT_BUNDLER = 'Rspack'\n-\n-    // clean up callback function\n-    return () => {\n-      delete process.env.__NEXT_BUNDLER\n-    }\n-  },\n-  args: {\n-    state,\n-    dispatch: () => {},\n-    issueCount: 0,\n-    runtimeErrors: [],\n-    getSquashedHydrationErrorDetails: () => null,\n-  },\n-}"
        },
        {
            "sha": "3ab00ddd1def611fcad7485c3bf913d20d7c248a",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 422,
            "changes": 422,
            "blob_url": "https://github.com/vercel/next.js/blob/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a220665f5ddd4104e42ccb5db3e1166f1970c1b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx?ref=0a220665f5ddd4104e42ccb5db3e1166f1970c1b",
            "patch": "@@ -1,422 +0,0 @@\n-import type { OverlayDispatch, OverlayState, Corners } from '../../shared'\n-import type { ReadyRuntimeError } from '../../utils/get-error-by-type'\n-import type { HydrationErrorState } from '../../../shared/hydration-error'\n-\n-import { useState, useEffect, useRef } from 'react'\n-\n-import { DevToolsPanelFooter } from './devtools-panel-footer'\n-import { DevToolsPanelTab } from './devtools-panel-tab/devtools-panel-tab'\n-import { Dialog, DialogContent, DialogHeader, DialogBody } from '../dialog'\n-import { Overlay } from '../overlay/overlay'\n-import {\n-  ACTION_DEVTOOLS_PANEL_CLOSE,\n-  ACTION_DEVTOOLS_POSITION,\n-  ACTION_DEVTOOLS_SCALE,\n-  STORAGE_KEY_SCALE,\n-  STORAGE_KEY_POSITION,\n-  ACTION_ERROR_OVERLAY_CLOSE,\n-  STORAGE_KEY_ACTIVE_TAB,\n-} from '../../shared'\n-import { css } from '../../utils/css'\n-import { OverlayBackdrop } from '../overlay'\n-import { Draggable } from '../errors/dev-tools-indicator/draggable'\n-import { INDICATOR_PADDING } from '../devtools-indicator/devtools-indicator'\n-import { FullScreenIcon } from '../../icons/fullscreen'\n-import { Cross } from '../../icons/cross'\n-import { MinimizeIcon } from '../../icons/minimize'\n-import { ResizeProvider } from './resize/resize-provider'\n-import { ResizeHandle } from './resize/resize-handle'\n-\n-export type DevToolsPanelTabType = 'issues' | 'route' | 'settings'\n-\n-function useSessionState<T extends string>(\n-  key: string,\n-  initialValue: T\n-): [T, (value: T) => void] {\n-  const [value, setValue] = useState<T>(() => {\n-    if (\n-      typeof window !== 'undefined' &&\n-      typeof sessionStorage !== 'undefined'\n-    ) {\n-      const stored = sessionStorage.getItem(key)\n-      return (stored as T) ?? initialValue\n-    }\n-    return initialValue\n-  })\n-  useEffect(() => {\n-    if (\n-      typeof window !== 'undefined' &&\n-      typeof sessionStorage !== 'undefined'\n-    ) {\n-      sessionStorage.setItem(key, value)\n-    }\n-  }, [key, value])\n-  return [value, setValue]\n-}\n-\n-export function DevToolsPanel({\n-  state,\n-  dispatch,\n-  issueCount,\n-  runtimeErrors,\n-  getSquashedHydrationErrorDetails,\n-}: {\n-  state: OverlayState\n-  dispatch: OverlayDispatch\n-  issueCount: number\n-  runtimeErrors: ReadyRuntimeError[]\n-  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n-}) {\n-  // Initialize active tab from session storage, fallback to 'issues'\n-  const [activeTab, setActiveTab] = useSessionState<DevToolsPanelTabType>(\n-    STORAGE_KEY_ACTIVE_TAB,\n-    'issues'\n-  )\n-\n-  const [isFullscreen, setIsFullscreen] = useState(false)\n-  const [prevIsErrorOverlayOpen, setPrevIsErrorOverlayOpen] = useState(false)\n-  const resizeRef = useRef<HTMLDivElement>(null)\n-\n-  if (state.isErrorOverlayOpen !== prevIsErrorOverlayOpen) {\n-    if (state.isErrorOverlayOpen) {\n-      setIsFullscreen(true)\n-      // We should always show the issues tab initially if we're\n-      // programmatically opening the panel to highlight errors.\n-      setActiveTab('issues')\n-    }\n-    setPrevIsErrorOverlayOpen(state.isErrorOverlayOpen)\n-  }\n-\n-  const [vertical, horizontal] = state.devToolsPosition.split('-', 2)\n-\n-  const onCloseDevToolsPanel = () => {\n-    dispatch({ type: ACTION_DEVTOOLS_PANEL_CLOSE })\n-    dispatch({ type: ACTION_ERROR_OVERLAY_CLOSE })\n-  }\n-\n-  const handlePositionChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n-    dispatch({\n-      type: ACTION_DEVTOOLS_POSITION,\n-      devToolsPosition: e.target.value as Corners,\n-    })\n-    localStorage.setItem(STORAGE_KEY_POSITION, e.target.value)\n-  }\n-\n-  const handleScaleChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n-    dispatch({\n-      type: ACTION_DEVTOOLS_SCALE,\n-      scale: Number(e.target.value),\n-    })\n-    localStorage.setItem(STORAGE_KEY_SCALE, e.target.value)\n-  }\n-\n-  const handleFullscreenToggle = () => {\n-    setIsFullscreen((prev) => !prev)\n-    dispatch({ type: ACTION_ERROR_OVERLAY_CLOSE })\n-  }\n-\n-  return (\n-    <ResizeProvider\n-      value={{\n-        resizeRef,\n-        minWidth: 400,\n-        minHeight: 350,\n-        devToolsPosition: state.devToolsPosition,\n-      }}\n-    >\n-      <Overlay\n-        ref={resizeRef}\n-        data-nextjs-devtools-panel-overlay\n-        style={\n-          !isFullscreen\n-            ? {\n-                [vertical]: `${INDICATOR_PADDING}px`,\n-                [horizontal]: `${INDICATOR_PADDING}px`,\n-                [vertical === 'top' ? 'bottom' : 'top']: 'auto',\n-                [horizontal === 'left' ? 'right' : 'left']: 'auto',\n-              }\n-            : {}\n-        }\n-      >\n-        {/* TODO: Investigate why onCloseDevToolsPanel on Dialog doesn't close when clicked outside. */}\n-        <OverlayBackdrop\n-          data-nextjs-devtools-panel-overlay-backdrop={isFullscreen}\n-          onClick={onCloseDevToolsPanel}\n-        />\n-\n-        <Draggable\n-          data-nextjs-devtools-panel-draggable\n-          padding={INDICATOR_PADDING}\n-          onDragStart={() => {}}\n-          position={state.devToolsPosition}\n-          setPosition={(p) => {\n-            localStorage.setItem(STORAGE_KEY_POSITION, p)\n-            dispatch({\n-              type: ACTION_DEVTOOLS_POSITION,\n-              devToolsPosition: p,\n-            })\n-          }}\n-          dragHandleSelector=\"[data-nextjs-devtools-panel-header], [data-nextjs-devtools-panel-footer]\"\n-          disableDrag={isFullscreen}\n-        >\n-          <>\n-            <Dialog\n-              data-nextjs-devtools-panel-dialog\n-              aria-labelledby=\"nextjs__container_dev_tools_panel_label\"\n-              aria-describedby=\"nextjs__container_dev_tools_panel_desc\"\n-              onClose={onCloseDevToolsPanel}\n-            >\n-              <DialogContent data-nextjs-devtools-panel-dialog-content>\n-                <DialogHeader data-nextjs-devtools-panel-dialog-header>\n-                  <div\n-                    data-nextjs-devtools-panel-header\n-                    data-nextjs-devtools-panel-draggable={!isFullscreen}\n-                  >\n-                    <div data-nextjs-devtools-panel-header-tab-group>\n-                      <button\n-                        data-nextjs-devtools-panel-header-tab={\n-                          activeTab === 'issues'\n-                        }\n-                        onClick={() => setActiveTab('issues')}\n-                      >\n-                        Issues\n-                        {issueCount > 0 ? (\n-                          <span\n-                            data-nextjs-devtools-panel-header-tab-issues-badge\n-                          >\n-                            {issueCount}\n-                          </span>\n-                        ) : null}\n-                      </button>\n-                      <button\n-                        data-nextjs-devtools-panel-header-tab={\n-                          activeTab === 'route'\n-                        }\n-                        onClick={() => setActiveTab('route')}\n-                      >\n-                        Route Info\n-                      </button>\n-                      <button\n-                        data-nextjs-devtools-panel-header-tab={\n-                          activeTab === 'settings'\n-                        }\n-                        onClick={() => setActiveTab('settings')}\n-                      >\n-                        Settings\n-                      </button>\n-                    </div>\n-                    <div data-nextjs-devtools-panel-header-action-button-group>\n-                      <button\n-                        data-nextjs-devtools-panel-header-action-button\n-                        onClick={handleFullscreenToggle}\n-                      >\n-                        {isFullscreen ? (\n-                          <MinimizeIcon width={16} height={16} />\n-                        ) : (\n-                          <FullScreenIcon width={16} height={16} />\n-                        )}\n-                      </button>\n-                      <button\n-                        data-nextjs-devtools-panel-header-action-button\n-                        onClick={onCloseDevToolsPanel}\n-                      >\n-                        <Cross width={16} height={16} />\n-                      </button>\n-                    </div>\n-                  </div>\n-                </DialogHeader>\n-                <DialogBody data-nextjs-devtools-panel-dialog-body>\n-                  <DevToolsPanelTab\n-                    page={state.page}\n-                    activeTab={activeTab}\n-                    devToolsPosition={state.devToolsPosition}\n-                    scale={state.scale}\n-                    routerType={state.routerType}\n-                    handlePositionChange={handlePositionChange}\n-                    handleScaleChange={handleScaleChange}\n-                    debugInfo={state.debugInfo}\n-                    runtimeErrors={runtimeErrors}\n-                    getSquashedHydrationErrorDetails={\n-                      getSquashedHydrationErrorDetails\n-                    }\n-                    buildError={state.buildError}\n-                  />\n-                </DialogBody>\n-              </DialogContent>\n-              <DevToolsPanelFooter\n-                versionInfo={state.versionInfo}\n-                isDraggable={!isFullscreen}\n-                showRestartServerButton={state.showRestartServerButton}\n-              />\n-            </Dialog>\n-\n-            {!isFullscreen && (\n-              <>\n-                <ResizeHandle direction=\"top\" />\n-                <ResizeHandle direction=\"right\" />\n-                <ResizeHandle direction=\"bottom\" />\n-                <ResizeHandle direction=\"left\" />\n-                <ResizeHandle direction=\"top-left\" />\n-                <ResizeHandle direction=\"top-right\" />\n-                <ResizeHandle direction=\"bottom-left\" />\n-                <ResizeHandle direction=\"bottom-right\" />\n-              </>\n-            )}\n-          </>\n-        </Draggable>\n-      </Overlay>\n-    </ResizeProvider>\n-  )\n-}\n-\n-export const DEVTOOLS_PANEL_STYLES = css`\n-  /* TODO: Better override dialog header style. This conflicts with issues tab content. */\n-  [data-nextjs-devtools-panel-dialog-header] {\n-    flex-shrink: 0;\n-    margin-bottom: 0 !important;\n-  }\n-\n-  [data-nextjs-devtools-panel-dialog-content] {\n-    flex: 1;\n-    display: flex;\n-    flex-direction: column;\n-    min-height: 0; // what allows content to overflow\n-  }\n-\n-  [data-nextjs-devtools-panel-dialog-body] {\n-    flex: 1;\n-    overflow: auto;\n-  }\n-\n-  [data-nextjs-devtools-panel-overlay] {\n-    margin: auto;\n-    width: 525px;\n-    height: 375px;\n-  }\n-\n-  [data-nextjs-devtools-panel-overlay-backdrop] {\n-    opacity: 0;\n-    visibility: hidden;\n-  }\n-\n-  [data-nextjs-devtools-panel-overlay-backdrop='true'] {\n-    opacity: 1;\n-    visibility: visible;\n-  }\n-\n-  [data-nextjs-devtools-panel-draggable] {\n-    /* For responsiveness */\n-    width: 100%;\n-    height: 100%;\n-  }\n-\n-  [data-nextjs-devtools-panel-dialog] {\n-    -webkit-font-smoothing: antialiased;\n-    display: flex;\n-    flex-direction: column;\n-    background: var(--color-background-100);\n-    background-clip: padding-box;\n-    border: 1px solid var(--color-gray-400);\n-    border-radius: var(--rounded-xl);\n-    box-shadow: var(--shadow-lg);\n-    position: relative;\n-    width: 100%;\n-    height: 100%;\n-    min-width: 400px;\n-    min-height: 350px;\n-  }\n-\n-  [data-nextjs-devtools-panel-header] {\n-    display: flex;\n-    justify-content: space-between;\n-    align-items: center;\n-    border-bottom: 1px solid var(--color-gray-400);\n-  }\n-\n-  [data-nextjs-devtools-panel-header-tab-group] {\n-    display: flex;\n-    align-items: center;\n-    padding: 8px;\n-    gap: 6px;\n-  }\n-\n-  [data-nextjs-devtools-panel-header-tab] {\n-    display: flex;\n-    align-items: center;\n-    color: var(--color-gray-900);\n-    border-radius: var(--rounded-md-2);\n-    padding: 4px 12px;\n-    font-size: 14px;\n-    font-weight: 500;\n-    transition: background-color 200ms ease;\n-\n-    &:hover {\n-      background-color: var(--color-gray-200);\n-    }\n-\n-    &:active {\n-      background-color: var(--color-gray-300);\n-    }\n-  }\n-\n-  [data-nextjs-devtools-panel-header-tab='true'] {\n-    color: var(--color-gray-1000);\n-    background-color: var(--color-gray-100);\n-  }\n-\n-  [data-nextjs-devtools-panel-header-tab-issues-badge] {\n-    display: flex;\n-    align-items: center;\n-    justify-content: center;\n-    margin-left: 8px;\n-    background-color: var(--color-red-400);\n-    color: var(--color-red-900);\n-    font-size: 11px;\n-    border-radius: var(--rounded-full);\n-    padding: 2px 6px;\n-    width: 20px;\n-    height: 20px;\n-    font-weight: 500;\n-  }\n-\n-  [data-nextjs-devtools-panel-header-action-button-group] {\n-    display: flex;\n-    align-items: center;\n-    gap: 4px;\n-    padding-right: 8px;\n-  }\n-\n-  [data-nextjs-devtools-panel-header-action-button] {\n-    background: transparent;\n-    border: none;\n-    cursor: pointer;\n-    display: flex;\n-    align-items: center;\n-    justify-content: center;\n-    padding: 6px;\n-    color: var(--color-gray-1000);\n-    border-radius: 4px;\n-    transition-property: background-color, color;\n-    transition-duration: 200ms;\n-    transition-timing-function: ease;\n-\n-    &:hover {\n-      background-color: var(--color-gray-200);\n-      color: var(--color-gray-900);\n-    }\n-\n-    &:active {\n-      background-color: var(--color-gray-300);\n-    }\n-  }\n-\n-  [data-nextjs-devtools-panel-draggable='true'] {\n-    cursor: move;\n-    user-select: none;\n-    & > * {\n-      cursor: auto;\n-      /* user-select: auto; follows the parent (parent none -> child none), so reset the direct child to text */\n-      user-select: text;\n-    }\n-  }\n-`"
        },
        {
            "sha": "e1a53d5b717332f72c775518fa40e9163625265a",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/hooks/use-session-state.ts",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fhooks%2Fuse-session-state.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fhooks%2Fuse-session-state.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fhooks%2Fuse-session-state.ts?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,26 @@\n+import { useState, useEffect } from 'react'\n+\n+export function useSessionState<T extends string>(\n+  key: string,\n+  initialValue: T\n+): [T, (value: T) => void] {\n+  const [value, setValue] = useState<T>(() => {\n+    if (\n+      typeof window !== 'undefined' &&\n+      typeof sessionStorage !== 'undefined'\n+    ) {\n+      const stored = sessionStorage.getItem(key)\n+      return (stored as T) ?? initialValue\n+    }\n+    return initialValue\n+  })\n+  useEffect(() => {\n+    if (\n+      typeof window !== 'undefined' &&\n+      typeof sessionStorage !== 'undefined'\n+    ) {\n+      sessionStorage.setItem(key, value)\n+    }\n+  }, [key, value])\n+  return [value, setValue]\n+}"
        },
        {
            "sha": "6fde3bc3d30ed402260b9b73374cb744b8141be0",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/resize/resize-handle.css",
            "status": "modified",
            "additions": 38,
            "deletions": 38,
            "changes": 76,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-handle.css",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-handle.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-handle.css?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -15,19 +15,19 @@\n   /* immediately responsive so we don't need a bespoke curve */\n   transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n   /* todo: better var? */\n-  border: 1px solid var(--color-gray-100);\n+  border: 1px solid var(--color-gray-400);\n }\n \n /* start really fast because we start super hidden initially behind the panel, otherwise feels like an unintended animation delay */\n .resize-container:hover ~ .resize-line {\n-  transition: transform 0.2s cubic-bezier(0.05, 0.9, 0.2, 1); /* Fast start for animate in */\n+  transition: transform 0.25s cubic-bezier(0.23, 1, 0.32, 0.9);\n }\n \n .resize-container.right,\n .resize-container.left {\n   top: 0;\n   height: 100%;\n-  width: 25px;\n+  width: 22px;\n   cursor: ew-resize;\n }\n \n@@ -37,97 +37,97 @@\n .resize-container.top {\n   left: 0;\n   width: 100%;\n-  height: 25px;\n+  height: 22px;\n   cursor: ns-resize;\n }\n \n .resize-container.top {\n-  top: -12px;\n+  top: -7px;\n }\n .resize-container.bottom {\n-  bottom: -12px;\n+  bottom: -7px;\n }\n .resize-container.left {\n-  left: -12px;\n+  left: -7px;\n }\n .resize-container.right {\n-  right: -12px;\n+  right: -7px;\n }\n \n .resize-container.top-left,\n .resize-container.top-right,\n .resize-container.bottom-left,\n .resize-container.bottom-right {\n-  width: 32px;\n-  height: 32px;\n+  width: 26px;\n+  height: 26px;\n   z-index: 15;\n }\n \n .resize-container.top-left {\n-  top: -16px;\n-  left: -16px;\n+  top: -5px;\n+  left: -5px;\n   cursor: nwse-resize;\n }\n .resize-container.top-right {\n-  top: -16px;\n-  right: -16px;\n+  top: -5px;\n+  right: -5px;\n   cursor: nesw-resize;\n }\n .resize-container.bottom-left {\n-  bottom: -16px;\n-  left: -16px;\n+  bottom: -5px;\n+  left: -5px;\n   cursor: nesw-resize;\n }\n .resize-container.bottom-right {\n-  bottom: -16px;\n-  right: -16px;\n+  bottom: -5px;\n+  right: -5px;\n   cursor: nwse-resize;\n }\n \n .resize-line.top,\n .resize-line.bottom {\n-  height: 28px;\n+  height: 18px;\n   width: 100%;\n-  background-color: var(--color-background-100);\n+  background-color: var(--color-background-200);\n }\n \n .resize-line.left,\n .resize-line.right {\n-  width: 28px;\n+  width: 18px;\n   height: 100%;\n-  background-color: var(--color-background-100);\n+  background-color: var(--color-background-200);\n }\n \n .resize-line.top {\n-  top: -12px;\n+  top: -7px;\n   left: calc(-1 * var(--border-left, 2px));\n   width: calc(100% + var(--border-horizontal, 4px));\n-  border-radius: var(--rounded-md) var(--rounded-md) 0 0;\n-  transform: translateY(28px);\n+  border-radius: var(--rounded-lg) var(--rounded-lg) 0 0;\n+  transform: translateY(18px);\n }\n \n .resize-line.bottom {\n-  bottom: -12px;\n+  bottom: -7px;\n   left: calc(-1 * var(--border-left, 2px));\n   width: calc(100% + var(--border-horizontal, 4px));\n-  border-radius: 0 0 var(--rounded-md) var(--rounded-md);\n-  transform: translateY(-28px);\n+  border-radius: 0 0 var(--rounded-lg) var(--rounded-lg);\n+  transform: translateY(-18px);\n }\n \n .resize-line.left {\n   top: calc(-1 * var(--border-top, 2px));\n-  left: -12px;\n+  left: -7px;\n   height: calc(100% + var(--border-vertical, 4px));\n-  border-radius: var(--rounded-md) 0 0 var(--rounded-md);\n-  transform: translateX(28px);\n+  border-radius: var(--rounded-lg) 0 0 var(--rounded-lg);\n+  transform: translateX(18px);\n }\n \n .resize-line.right {\n   top: calc(-1 * var(--border-top, 2px));\n-  right: -12px;\n+  right: -7px;\n   height: calc(100% + var(--border-vertical, 4px));\n-  border-radius: 0 var(--rounded-md) var(--rounded-md) 0;\n-  transform: translateX(-28px);\n+  border-radius: 0 var(--rounded-lg) var(--rounded-lg) 0;\n+  transform: translateX(-18px);\n }\n \n .resize-container.right:hover ~ .resize-line.right,\n@@ -149,14 +149,14 @@\n  * regardless of hover state \n  */\n .resize-container.no-hover.right:hover ~ .resize-line.right {\n-  transform: translateX(-28px);\n+  transform: translateX(-20px);\n }\n .resize-container.no-hover.left:hover ~ .resize-line.left {\n-  transform: translateX(28px);\n+  transform: translateX(20px);\n }\n .resize-container.no-hover.bottom:hover ~ .resize-line.bottom {\n-  transform: translateY(-28px);\n+  transform: translateY(-20px);\n }\n .resize-container.no-hover.top:hover ~ .resize-line.top {\n-  transform: translateY(28px);\n+  transform: translateY(20px);\n }"
        },
        {
            "sha": "47d82ec305cafb079d1f37b816c0668ccdebe756",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/resize/resize-handle.tsx",
            "status": "modified",
            "additions": 62,
            "deletions": 88,
            "changes": 150,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-handle.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-handle.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-handle.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -3,14 +3,20 @@ import type { Corners } from '../../../shared'\n import { useResize, type ResizeDirection } from './resize-provider'\n import './resize-handle.css'\n \n-const STORAGE_KEY_DIMENSIONS = 'nextjs-devtools-dimensions'\n-\n-export const ResizeHandle = ({ direction }: { direction: ResizeDirection }) => {\n+export const ResizeHandle = ({\n+  direction,\n+  position,\n+}: {\n+  direction: ResizeDirection\n+  position: Corners\n+}) => {\n   const {\n     resizeRef,\n     minWidth,\n     minHeight,\n-    devToolsPosition,\n+    maxWidth,\n+    maxHeight,\n+    storageKey,\n     draggingDirection,\n     setDraggingDirection,\n   } = useResize()\n@@ -44,13 +50,13 @@ export const ResizeHandle = ({ direction }: { direction: ResizeDirection }) => {\n     // we block the sides of the corner its in (bottom-left has bottom and left sides blocked from resizing)\n     // because there shouldn't be anywhere to resize, and if the user decides to resize from that point it\n     // would be unhandled/slightly janky (the component would have to re-magnetic-snap after the resize)\n-    if (devToolsPosition.split('-').includes(direction)) return false\n+    if (position.split('-').includes(direction)) return false\n \n     // same logic as above, but the only corner resize that makes\n     // sense is the corner fully exposed (the opposing corner)\n     const isCorner = direction.includes('-')\n     if (isCorner) {\n-      const opposite = getOppositeCorner(devToolsPosition)\n+      const opposite = getOppositeCorner(position)\n       return direction === opposite\n     }\n \n@@ -85,48 +91,44 @@ export const ResizeHandle = ({ direction }: { direction: ResizeDirection }) => {\n \n     const element = resizeRef.current\n     const initialRect = element.getBoundingClientRect()\n-    const initialLeft = element.offsetLeft\n-    const initialTop = element.offsetTop\n     const startX = mouseDownEvent.clientX\n     const startY = mouseDownEvent.clientY\n \n     const handleMouseMove = (mouseMoveEvent: MouseEvent) => {\n       const deltaX = mouseMoveEvent.clientX - startX\n       const deltaY = mouseMoveEvent.clientY - startY\n \n-      const { newWidth, newHeight, newLeft, newTop } = getNewDimensions(\n+      const { newWidth, newHeight } = getNewDimensions(\n         direction,\n         deltaX,\n         deltaY,\n         initialRect,\n-        initialLeft,\n-        initialTop,\n         minWidth,\n-        minHeight\n+        minHeight,\n+        maxWidth,\n+        maxHeight\n       )\n \n-      element.style.width = `${newWidth}px`\n-      element.style.height = `${newHeight}px`\n-\n-      if (direction.includes('left') || direction === 'left') {\n-        element.style.left = `${newLeft}px`\n+      if (newWidth !== undefined) {\n+        element.style.width = `${newWidth}px`\n       }\n-      if (direction.includes('top') || direction === 'top') {\n-        element.style.top = `${newTop}px`\n+      if (newHeight !== undefined) {\n+        element.style.height = `${newHeight}px`\n       }\n     }\n \n     const handleMouseUp = () => {\n       setDraggingDirection(null)\n       document.removeEventListener('mousemove', handleMouseMove)\n       document.removeEventListener('mouseup', handleMouseUp)\n+      if (!resizeRef.current) {\n+        // possible if the user closes during drag\n+        return\n+      }\n \n-      // invariant ref exists\n-      const { width, height } = resizeRef.current!.getBoundingClientRect()\n-      localStorage.setItem(\n-        STORAGE_KEY_DIMENSIONS,\n-        JSON.stringify({ width, height })\n-      )\n+      const { width, height } = resizeRef.current.getBoundingClientRect()\n+\n+      localStorage.setItem(storageKey, JSON.stringify({ width, height }))\n     }\n     document.addEventListener('mousemove', handleMouseMove)\n     document.addEventListener('mouseup', handleMouseUp)\n@@ -176,130 +178,102 @@ const getNewDimensions = (\n   deltaX: number,\n   deltaY: number,\n   initialRect: DOMRect,\n-  initialLeft: number,\n-  initialTop: number,\n   minWidth: number,\n-  minHeight: number\n+  minHeight: number,\n+  maxWidth?: number,\n+  maxHeight?: number\n ) => {\n-  const maxWidth = window.innerWidth * 0.95\n-  const maxHeight = window.innerHeight * 0.95\n+  const effectiveMaxWidth = maxWidth ?? window.innerWidth * 0.95\n+  const effectiveMaxHeight = maxHeight ?? window.innerHeight * 0.95\n \n   switch (direction) {\n     case 'right':\n       return {\n         newWidth: Math.min(\n-          maxWidth,\n+          effectiveMaxWidth,\n           Math.max(minWidth, initialRect.width + deltaX)\n         ),\n         newHeight: initialRect.height,\n-        newLeft: initialLeft,\n-        newTop: initialTop,\n       }\n \n     case 'left': {\n-      const newWidth = Math.min(\n-        maxWidth,\n-        Math.max(minWidth, initialRect.width - deltaX)\n-      )\n-      const widthDiff = newWidth - initialRect.width\n       return {\n-        newWidth,\n+        newWidth: Math.min(\n+          effectiveMaxWidth,\n+          Math.max(minWidth, initialRect.width - deltaX)\n+        ),\n         newHeight: initialRect.height,\n-        newLeft: initialLeft - widthDiff,\n-        newTop: initialTop,\n       }\n     }\n \n     case 'bottom':\n       return {\n         newWidth: initialRect.width,\n         newHeight: Math.min(\n-          maxHeight,\n+          effectiveMaxHeight,\n           Math.max(minHeight, initialRect.height + deltaY)\n         ),\n-        newLeft: initialLeft,\n-        newTop: initialTop,\n       }\n \n     case 'top': {\n-      const newHeight = Math.min(\n-        maxHeight,\n-        Math.max(minHeight, initialRect.height - deltaY)\n-      )\n-      const heightDiff = newHeight - initialRect.height\n       return {\n         newWidth: initialRect.width,\n-        newHeight,\n-        newLeft: initialLeft,\n-        newTop: initialTop - heightDiff,\n+        newHeight: Math.min(\n+          effectiveMaxHeight,\n+          Math.max(minHeight, initialRect.height - deltaY)\n+        ),\n       }\n     }\n \n     case 'top-left': {\n-      const newWidth = Math.min(\n-        maxWidth,\n-        Math.max(minWidth, initialRect.width - deltaX)\n-      )\n-      const newHeight = Math.min(\n-        maxHeight,\n-        Math.max(minHeight, initialRect.height - deltaY)\n-      )\n-      const widthDiff = newWidth - initialRect.width\n-      const heightDiff = newHeight - initialRect.height\n       return {\n-        newWidth,\n-        newHeight,\n-        newLeft: initialLeft - widthDiff,\n-        newTop: initialTop - heightDiff,\n+        newWidth: Math.min(\n+          effectiveMaxWidth,\n+          Math.max(minWidth, initialRect.width - deltaX)\n+        ),\n+        newHeight: Math.min(\n+          effectiveMaxHeight,\n+          Math.max(minHeight, initialRect.height - deltaY)\n+        ),\n       }\n     }\n \n     case 'top-right': {\n-      const newHeight = Math.min(\n-        maxHeight,\n-        Math.max(minHeight, initialRect.height - deltaY)\n-      )\n-      const heightDiff = newHeight - initialRect.height\n       return {\n         newWidth: Math.min(\n-          maxWidth,\n+          effectiveMaxWidth,\n           Math.max(minWidth, initialRect.width + deltaX)\n         ),\n-        newHeight,\n-        newLeft: initialLeft,\n-        newTop: initialTop - heightDiff,\n+        newHeight: Math.min(\n+          effectiveMaxHeight,\n+          Math.max(minHeight, initialRect.height - deltaY)\n+        ),\n       }\n     }\n \n     case 'bottom-left': {\n-      const newWidth = Math.min(\n-        maxWidth,\n-        Math.max(minWidth, initialRect.width - deltaX)\n-      )\n-      const widthDiff = newWidth - initialRect.width\n       return {\n-        newWidth,\n+        newWidth: Math.min(\n+          effectiveMaxWidth,\n+          Math.max(minWidth, initialRect.width - deltaX)\n+        ),\n         newHeight: Math.min(\n-          maxHeight,\n+          effectiveMaxHeight,\n           Math.max(minHeight, initialRect.height + deltaY)\n         ),\n-        newLeft: initialLeft - widthDiff,\n-        newTop: initialTop,\n       }\n     }\n \n     case 'bottom-right':\n       return {\n         newWidth: Math.min(\n-          maxWidth,\n+          effectiveMaxWidth,\n           Math.max(minWidth, initialRect.width + deltaX)\n         ),\n         newHeight: Math.min(\n-          maxHeight,\n+          effectiveMaxHeight,\n           Math.max(minHeight, initialRect.height + deltaY)\n         ),\n-        newLeft: initialLeft,\n-        newTop: initialTop,\n       }\n     default: {\n       direction satisfies never"
        },
        {
            "sha": "bb641e82d4c8c9e9083a71af127d2d55fe86b1e3",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/resize/resize-provider.tsx",
            "status": "modified",
            "additions": 67,
            "deletions": 26,
            "changes": 93,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-provider.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-provider.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-provider.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,12 +1,12 @@\n import {\n   createContext,\n+  useCallback,\n   useContext,\n   useLayoutEffect,\n   useState,\n   type RefObject,\n } from 'react'\n-import type { Corners } from '../../../shared'\n-const STORAGE_KEY_DIMENSIONS = 'nextjs-devtools-dimensions'\n+import { STORE_KEY_SHARED_PANEL_SIZE, type Corners } from '../../../shared'\n \n export type ResizeDirection =\n   | 'top'\n@@ -22,9 +22,11 @@ interface ResizeContextValue {\n   resizeRef: RefObject<HTMLElement | null>\n   minWidth: number\n   minHeight: number\n-  devToolsPosition: Corners\n+  maxWidth?: number\n+  maxHeight?: number\n   draggingDirection: ResizeDirection | null\n   setDraggingDirection: (direction: ResizeDirection | null) => void\n+  storageKey: string\n }\n \n const ResizeContext = createContext<ResizeContextValue>(null!)\n@@ -44,8 +46,8 @@ const constrainDimensions = (params: {\n   }\n }\n \n-const parseResizeLocalStorage = () => {\n-  const savedDimensions = localStorage.getItem(STORAGE_KEY_DIMENSIONS)\n+const parseResizeLocalStorage = (key: string) => {\n+  const savedDimensions = localStorage.getItem(key)\n   if (!savedDimensions) return null\n   try {\n     const parsed = JSON.parse(savedDimensions)\n@@ -59,7 +61,7 @@ const parseResizeLocalStorage = () => {\n     }\n     return null\n   } catch (e) {\n-    localStorage.removeItem(STORAGE_KEY_DIMENSIONS)\n+    localStorage.removeItem(key)\n     return null\n   }\n }\n@@ -69,58 +71,97 @@ interface ResizeProviderProps {\n     resizeRef: RefObject<HTMLElement | null>\n     minWidth?: number\n     minHeight?: number\n+    maxWidth?: number\n+    maxHeight?: number\n     devToolsPosition: Corners\n+    storageKey?: string\n+    initialSize?: { height: number; width: number }\n   }\n   children: React.ReactNode\n }\n \n export const ResizeProvider = ({ value, children }: ResizeProviderProps) => {\n   const minWidth = value.minWidth ?? 100\n   const minHeight = value.minHeight ?? 80\n+  const maxWidth = value.maxWidth\n+  const maxHeight = value.maxHeight\n   const [draggingDirection, setDraggingDirection] =\n     useState<ResizeDirection | null>(null)\n \n+  const storageKey = value.storageKey ?? STORE_KEY_SHARED_PANEL_SIZE\n+\n+  const applyConstrainedDimensions = useCallback(() => {\n+    if (!value.resizeRef.current) return\n+\n+    // this feels weird to read local storage on resize, but we don't\n+    // track the dimensions of the container, and this is better than\n+    // getBoundingClientReact\n+\n+    // an optimization if this is too expensive is to maintain the current\n+    // container size in a ref and update it on resize, which is essentially\n+    // what we're doing here, just dumber\n+    if (draggingDirection !== null) {\n+      // Don't override live resizing operation with stale cached values.\n+      return\n+    }\n+\n+    const dim = parseResizeLocalStorage(storageKey)\n+    if (!dim) {\n+      return\n+    }\n+    const { height, width } = constrainDimensions({\n+      ...dim,\n+      minWidth: minWidth ?? 100,\n+      minHeight: minHeight ?? 80,\n+    })\n+\n+    value.resizeRef.current.style.width = `${width}px`\n+    value.resizeRef.current.style.height = `${height}px`\n+    return true\n+  }, [value.resizeRef, draggingDirection, storageKey, minWidth, minHeight])\n+\n   useLayoutEffect(() => {\n-    const applyConstrainedDimensions = () => {\n-      if (!value.resizeRef.current) return\n-\n-      // this feels weird to read local storage on resize, but we don't\n-      // track the dimensions of the container, and this is better than\n-      // getBoundingClientReact\n-\n-      // an optimization if this is too expensive is to maintain the current\n-      // container size in a ref and update it on resize, which is essentially\n-      // what we're doing here, just dumber\n-      const dim = parseResizeLocalStorage()\n-      if (!dim) {\n-        return\n-      }\n+    const applied = applyConstrainedDimensions()\n+    if (\n+      !applied &&\n+      value.resizeRef.current &&\n+      value.initialSize?.height &&\n+      value.initialSize.width\n+    ) {\n       const { height, width } = constrainDimensions({\n-        ...dim,\n+        height: value.initialSize.height,\n+        width: value.initialSize.width,\n         minWidth: minWidth ?? 100,\n         minHeight: minHeight ?? 80,\n       })\n-\n       value.resizeRef.current.style.width = `${width}px`\n       value.resizeRef.current.style.height = `${height}px`\n     }\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, [])\n \n-    applyConstrainedDimensions()\n-\n+  useLayoutEffect(() => {\n     window.addEventListener('resize', applyConstrainedDimensions)\n     return () =>\n       window.removeEventListener('resize', applyConstrainedDimensions)\n-  }, [value.resizeRef, minWidth, minHeight])\n+  }, [\n+    applyConstrainedDimensions,\n+    value.initialSize?.height,\n+    value.initialSize?.width,\n+    value.resizeRef,\n+  ])\n \n   return (\n     <ResizeContext.Provider\n       value={{\n         resizeRef: value.resizeRef,\n         minWidth,\n         minHeight,\n-        devToolsPosition: value.devToolsPosition,\n+        maxWidth,\n+        maxHeight,\n         draggingDirection,\n         setDraggingDirection,\n+        storageKey,\n       }}\n     >\n       {children}"
        },
        {
            "sha": "04092676b6d0c06d3c6e7e365125245046e8e74c",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-indicator.stories.tsx",
            "status": "modified",
            "additions": 30,
            "deletions": 30,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,11 +1,15 @@\n import type { Meta, StoryObj } from '@storybook/react'\n-import { DevToolsIndicator } from './dev-tools-indicator'\n+import { DevOverlayStoryWrapper } from '../../../storybook/DevOverlayStoryWrapper'\n import { withShadowPortal } from '../../../storybook/with-shadow-portal'\n import type { VersionInfo } from '../../../../../server/dev/parse-version-info'\n-import type { OverlayState } from '../../../shared'\n+import {\n+  getStoredPanelPosition,\n+  STORE_KEY_SHARED_PANEL_LOCATION,\n+  type OverlayState,\n+} from '../../../shared'\n \n-const meta: Meta<typeof DevToolsIndicator> = {\n-  component: DevToolsIndicator,\n+const meta: Meta<typeof DevOverlayStoryWrapper> = {\n+  component: DevOverlayStoryWrapper,\n   parameters: {\n     layout: 'centered',\n   },\n@@ -36,7 +40,7 @@ const meta: Meta<typeof DevToolsIndicator> = {\n }\n \n export default meta\n-type Story = StoryObj<typeof DevToolsIndicator>\n+type Story = StoryObj<typeof DevOverlayStoryWrapper>\n \n // Mock version info for stories\n const mockVersionInfo: VersionInfo = {\n@@ -46,6 +50,9 @@ const mockVersionInfo: VersionInfo = {\n \n const state: OverlayState = {\n   routerType: 'app',\n+  devToolsPanelPosition: {\n+    [STORE_KEY_SHARED_PANEL_LOCATION]: getStoredPanelPosition(),\n+  },\n   nextId: 1,\n   buildError: null,\n   errors: [],\n@@ -59,45 +66,38 @@ const state: OverlayState = {\n   staticIndicator: true,\n   debugInfo: { devtoolsFrontendUrl: undefined },\n   isErrorOverlayOpen: false,\n-  // TODO: This will be handled on the next stackwith proper story.\n-  isDevToolsPanelOpen: false,\n   showRestartServerButton: false,\n   devToolsPosition: 'bottom-left',\n   scale: 1,\n   page: '',\n }\n \n export const StaticRoute: Story = {\n-  args: {\n-    errorCount: 0,\n-    state,\n-    dispatch: () => {},\n-  },\n+  render: () => (\n+    <DevOverlayStoryWrapper initialState={state} runtimeErrors={[]} />\n+  ),\n }\n \n export const DynamicRoute: Story = {\n-  args: {\n-    errorCount: 0,\n-    state: {\n-      ...state,\n-      staticIndicator: false,\n-    },\n-    dispatch: () => {},\n-  },\n+  render: () => (\n+    <DevOverlayStoryWrapper\n+      initialState={{ ...state, staticIndicator: false }}\n+      runtimeErrors={[]}\n+    />\n+  ),\n }\n \n export const SingleError: Story = {\n-  args: {\n-    errorCount: 1,\n-    state,\n-    dispatch: () => {},\n-  },\n+  render: () => (\n+    <DevOverlayStoryWrapper initialState={state} runtimeErrors={[{} as any]} />\n+  ),\n }\n \n export const MultipleErrors: Story = {\n-  args: {\n-    errorCount: 3,\n-    state,\n-    dispatch: () => {},\n-  },\n+  render: () => (\n+    <DevOverlayStoryWrapper\n+      initialState={state}\n+      runtimeErrors={[{}, {}, {}] as any}\n+    />\n+  ),\n }"
        },
        {
            "sha": "a254de86d1d1bb381c24ef9b68d3821d01971138",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -18,7 +18,7 @@ import { UserPreferences } from './dev-tools-info/user-preferences'\n import {\n   MENU_CURVE,\n   MENU_DURATION_MS,\n-  useClickOutside,\n+  useClickOutsideAndEscape,\n   useFocusTrap,\n } from './utils'\n import {\n@@ -77,12 +77,12 @@ export function DevToolsIndicator({\n //////////////////////////////////////////////////////////////////////////////////////\n \n interface C {\n-  closeMenu: () => void\n+  closeMenu?: () => void\n   selectedIndex: number\n   setSelectedIndex: Dispatch<SetStateAction<number>>\n }\n \n-const Context = createContext({} as C)\n+export const MenuContext = createContext({} as C)\n \n const OVERLAYS = {\n   Root: 'root',\n@@ -164,7 +164,7 @@ function DevToolsPopover({\n \n   // Features to make the menu accessible\n   useFocusTrap(menuRef, triggerRef, isMenuOpen)\n-  useClickOutside(menuRef, triggerRef, menuMounted, closeMenu)\n+  useClickOutsideAndEscape(menuRef, triggerRef, menuMounted, closeMenu)\n   useShortcuts(hideShortcut ? { [hideShortcut]: hideDevTools } : {}, triggerRef)\n \n   useEffect(() => {\n@@ -397,7 +397,7 @@ function DevToolsPopover({\n           data-rendered={menuRendered}\n           style={popover}\n         >\n-          <Context.Provider\n+          <MenuContext.Provider\n             value={{\n               closeMenu,\n               selectedIndex,\n@@ -457,7 +457,7 @@ function DevToolsPopover({\n                 />\n               ) : null}\n             </div>\n-          </Context.Provider>\n+          </MenuContext.Provider>\n         </div>\n       )}\n     </Toast>\n@@ -483,7 +483,7 @@ function ChevronRight() {\n   )\n }\n \n-function MenuItem({\n+export function MenuItem({\n   index,\n   label,\n   value,\n@@ -500,13 +500,13 @@ function MenuItem({\n }) {\n   const isInteractive =\n     typeof onClick === 'function' || typeof href === 'string'\n-  const { closeMenu, selectedIndex, setSelectedIndex } = useContext(Context)\n+  const { closeMenu, selectedIndex, setSelectedIndex } = useContext(MenuContext)\n   const selected = selectedIndex === index\n \n   function click() {\n     if (isInteractive) {\n       onClick?.()\n-      closeMenu()\n+      closeMenu?.()\n       if (href) {\n         window.open(href, '_blank', 'noopener, noreferrer')\n       }"
        },
        {
            "sha": "a635147d65969dac135dcc7d29b265669459f103",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/dev-tools-header.tsx",
            "status": "added",
            "additions": 93,
            "deletions": 0,
            "changes": 93,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-header.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-header.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-header.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,93 @@\n+import React, { useLayoutEffect, useRef } from 'react'\n+import { usePanelRouterContext } from '../../../../menu/context'\n+import { css } from '../../../../utils/css'\n+\n+interface DevToolsHeaderProps {\n+  title: React.ReactNode\n+  children?: React.ReactNode\n+}\n+export function DevToolsHeader({\n+  title,\n+  children,\n+  ref,\n+}: DevToolsHeaderProps & { ref?: React.Ref<HTMLDivElement> }) {\n+  const { setPanel } = usePanelRouterContext()\n+  const buttonRef = useRef<HTMLButtonElement>(null)\n+  useLayoutEffect(() => {\n+    buttonRef.current?.focus()\n+  }, [])\n+\n+  return (\n+    <div\n+      style={{\n+        width: '100%',\n+        display: 'flex',\n+        alignItems: 'center',\n+        justifyContent: 'space-between',\n+        padding: '8px 20px',\n+        userSelect: 'none',\n+        WebkitUserSelect: 'none',\n+        borderBottom: '1px solid var(--color-gray-alpha-400)',\n+      }}\n+      ref={ref}\n+    >\n+      <h3\n+        style={{\n+          margin: 0,\n+          fontSize: '14px',\n+          color: 'var(--color-text-primary)',\n+          fontWeight: 'normal',\n+        }}\n+      >\n+        {title}\n+      </h3>\n+      {children}\n+      <button\n+        ref={buttonRef}\n+        id=\"_next-devtools-panel-close\"\n+        className=\"dev-tools-info-close-button\"\n+        onClick={() => {\n+          setPanel('panel-selector')\n+        }}\n+        aria-label=\"Close devtools panel\"\n+        style={{\n+          background: 'none',\n+          border: 'none',\n+          cursor: 'pointer',\n+          padding: '4px',\n+          display: 'flex',\n+          alignItems: 'center',\n+          justifyContent: 'center',\n+          borderRadius: '4px',\n+          color: 'var(--color-gray-900)',\n+        }}\n+      >\n+        <XIcon />\n+      </button>\n+      <style>{css`\n+        .dev-tools-info-close-button:focus-visible {\n+          outline: var(--focus-ring);\n+        }\n+      `}</style>\n+    </div>\n+  )\n+}\n+\n+function XIcon({ size = 22 }: { size?: number }) {\n+  return (\n+    <svg\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      width={size}\n+      height={size}\n+      viewBox=\"0 0 24 24\"\n+      fill=\"none\"\n+      stroke=\"currentColor\"\n+      strokeWidth=\"2\"\n+      strokeLinecap=\"round\"\n+      strokeLinejoin=\"round\"\n+    >\n+      <path d=\"M18 6 6 18\" />\n+      <path d=\"m6 6 12 12\" />\n+    </svg>\n+  )\n+}"
        },
        {
            "sha": "56b69d0c65d4428ccf3fd556b75c50d44b67b4bf",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/dev-tools-info.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-info.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-info.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fdev-tools-info.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,6 +1,11 @@\n import { useRef } from 'react'\n-import { MENU_DURATION_MS, useClickOutside, useFocusTrap } from '../utils'\n+import {\n+  MENU_DURATION_MS,\n+  useClickOutsideAndEscape,\n+  useFocusTrap,\n+} from '../utils'\n import { useDelayedRender } from '../../../../hooks/use-delayed-render'\n+import { css } from '../../../../utils/css'\n \n export interface DevToolsInfoPropsCore {\n   isOpen: boolean\n@@ -37,7 +42,7 @@ export function DevToolsInfo({\n     // Bring focus to close button, so the user can easily close the overlay\n     closeButtonRef.current?.focus()\n   })\n-  useClickOutside(ref, triggerRef, mounted, close)\n+  useClickOutsideAndEscape(ref, triggerRef, mounted, close)\n \n   if (!mounted) {\n     return null\n@@ -84,7 +89,7 @@ export function DevToolsInfo({\n   )\n }\n \n-export const DEV_TOOLS_INFO_STYLES = `\n+export const DEV_TOOLS_INFO_STYLES = css`\n   [data-info-popover] {\n     -webkit-font-smoothing: antialiased;\n     display: flex;\n@@ -135,7 +140,7 @@ export const DEV_TOOLS_INFO_STYLES = `\n   .dev-tools-info-close-button {\n     all: unset;\n     width: 20px;\n-    height: 20px;    \n+    height: 20px;\n     display: flex;\n     align-items: center;\n     justify-content: center;"
        },
        {
            "sha": "0685ed781ba967f2926687ebb29fbb2bad6e31af",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/route-info.tsx",
            "status": "modified",
            "additions": 40,
            "deletions": 17,
            "changes": 57,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Froute-info.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Froute-info.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Froute-info.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,10 +1,12 @@\n-import type { HTMLProps } from 'react'\n-import type { DevToolsInfoPropsCore } from './dev-tools-info'\n+import type { ComponentProps, HTMLProps, RefObject } from 'react'\n import { DevToolsInfo } from './dev-tools-info'\n \n-function StaticRouteContent({ routerType }: { routerType: 'pages' | 'app' }) {\n+function StaticRouteContent({\n+  routerType,\n+  ...props\n+}: { routerType: 'pages' | 'app' } & ComponentProps<'div'>) {\n   return (\n-    <article className=\"dev-tools-info-article\">\n+    <article className=\"dev-tools-info-article\" {...props}>\n       <p className=\"dev-tools-info-paragraph\">\n         The path{' '}\n         <code className=\"dev-tools-info-code\">{window.location.pathname}</code>{' '}\n@@ -37,9 +39,12 @@ function StaticRouteContent({ routerType }: { routerType: 'pages' | 'app' }) {\n   )\n }\n \n-function DynamicRouteContent({ routerType }: { routerType: 'pages' | 'app' }) {\n+function DynamicRouteContent({\n+  routerType,\n+  ...props\n+}: { routerType: 'pages' | 'app' } & ComponentProps<'div'>) {\n   return (\n-    <article className=\"dev-tools-info-article\">\n+    <article className=\"dev-tools-info-article\" {...props}>\n       <p className=\"dev-tools-info-paragraph\">\n         The path{' '}\n         <code className=\"dev-tools-info-code\">{window.location.pathname}</code>{' '}\n@@ -95,7 +100,7 @@ function DynamicRouteContent({ routerType }: { routerType: 'pages' | 'app' }) {\n   )\n }\n \n-const learnMoreLink = {\n+export const learnMoreLink = {\n   pages: {\n     static:\n       'https://nextjs.org/docs/pages/building-your-application/rendering/static-site-generation',\n@@ -110,32 +115,50 @@ const learnMoreLink = {\n   },\n } as const\n \n+export function RouteInfoBody({\n+  routerType,\n+  isStaticRoute,\n+  ...props\n+}: {\n+  routerType: 'pages' | 'app'\n+  isStaticRoute: boolean\n+} & ComponentProps<'div'>) {\n+  return isStaticRoute ? (\n+    <StaticRouteContent routerType={routerType} {...props} />\n+  ) : (\n+    <DynamicRouteContent routerType={routerType} {...props} />\n+  )\n+}\n+\n export function RouteInfo({\n-  routeType,\n+  isOpen,\n+  close,\n   routerType,\n+  routeType,\n+  triggerRef,\n   ...props\n }: {\n-  routeType: 'Static' | 'Dynamic'\n+  isOpen: boolean\n+  close: () => void\n   routerType: 'pages' | 'app'\n-} & DevToolsInfoPropsCore &\n-  HTMLProps<HTMLDivElement>) {\n+  routeType: 'Static' | 'Dynamic'\n+  triggerRef: RefObject<HTMLButtonElement | null>\n+} & HTMLProps<HTMLDivElement>) {\n   const isStaticRoute = routeType === 'Static'\n \n   const learnMore = isStaticRoute\n     ? learnMoreLink[routerType].static\n     : learnMoreLink[routerType].dynamic\n-\n   return (\n     <DevToolsInfo\n       title={`${routeType} Route`}\n       learnMoreLink={learnMore}\n+      close={close}\n+      isOpen={isOpen}\n+      triggerRef={triggerRef}\n       {...props}\n     >\n-      {isStaticRoute ? (\n-        <StaticRouteContent routerType={routerType} />\n-      ) : (\n-        <DynamicRouteContent routerType={routerType} />\n-      )}\n+      <RouteInfoBody routerType={routerType} isStaticRoute={isStaticRoute} />\n     </DevToolsInfo>\n   )\n }"
        },
        {
            "sha": "09464c2f5c54258fde1d7b4180acd9a0df8eed64",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/turbopack-info.tsx",
            "status": "modified",
            "additions": 17,
            "deletions": 9,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fturbopack-info.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fturbopack-info.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fturbopack-info.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -2,16 +2,10 @@ import { DevToolsInfo, type DevToolsInfoPropsCore } from './dev-tools-info'\n import { CopyButton } from '../../../copy-button'\n import type { HTMLProps } from 'react'\n \n-export function TurbopackInfo(\n-  props: DevToolsInfoPropsCore & HTMLProps<HTMLDivElement>\n-) {\n+export function TurbopackInfoBody(props: React.ComponentProps<'div'>) {\n   return (\n-    <DevToolsInfo\n-      title=\"Turbopack\"\n-      learnMoreLink=\"https://nextjs.org/docs/app/api-reference/turbopack\"\n-      {...props}\n-    >\n-      <article className=\"dev-tools-info-article\">\n+    <>\n+      <article className=\"dev-tools-info-article\" {...props}>\n         <p className=\"dev-tools-info-paragraph\">\n           Turbopack is an incremental bundler optimized for JavaScript and\n           TypeScript, written in Rust, and built into Next.js. Turbopack can be\n@@ -96,6 +90,20 @@ export function TurbopackInfo(\n           </pre>\n         </div>\n       </div>\n+    </>\n+  )\n+}\n+\n+export function TurbopackInfo(\n+  props: DevToolsInfoPropsCore & HTMLProps<HTMLDivElement>\n+) {\n+  return (\n+    <DevToolsInfo\n+      title=\"Turbopack\"\n+      learnMoreLink=\"https://nextjs.org/docs/app/api-reference/turbopack\"\n+      {...props}\n+    >\n+      <TurbopackInfoBody />\n     </DevToolsInfo>\n   )\n }"
        },
        {
            "sha": "37e8c13e9927f6209ec8e0fbedd0bbb3cbc19c44",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/user-preferences.tsx",
            "status": "modified",
            "additions": 40,
            "deletions": 9,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -19,25 +19,56 @@ import {\n import { ShortcutRecorder } from './shortcut-recorder'\n \n export function UserPreferences({\n-  setPosition,\n-  position,\n   hide,\n-  scale,\n-  setScale,\n   hideShortcut,\n   setHideShortcut,\n+  setScale,\n+  scale,\n+  position,\n+  setPosition,\n   ...props\n }: {\n+  hide: () => void\n+  hideShortcut: string | null\n+  setHideShortcut: (value: string | null) => void\n   setPosition: (position: DevToolsIndicatorPosition) => void\n   position: DevToolsIndicatorPosition\n   scale: DevToolsScale\n   setScale: (value: DevToolsScale) => void\n+} & DevToolsInfoPropsCore &\n+  Omit<HTMLProps<HTMLDivElement>, 'size'>) {\n+  return (\n+    <DevToolsInfo title=\"Preferences\" {...props}>\n+      <UserPreferencesBody\n+        scale={scale}\n+        position={position}\n+        setPosition={setPosition}\n+        setScale={setScale}\n+        hide={hide}\n+        hideShortcut={hideShortcut}\n+        setHideShortcut={setHideShortcut}\n+      />\n+    </DevToolsInfo>\n+  )\n+}\n+\n+export function UserPreferencesBody({\n+  hide,\n+  hideShortcut,\n+  setHideShortcut,\n+  scale,\n+  setPosition,\n+  setScale,\n+  position,\n+}: {\n   hide: () => void\n   hideShortcut: string | null\n   setHideShortcut: (value: string | null) => void\n-} & DevToolsInfoPropsCore &\n-  Omit<HTMLProps<HTMLDivElement>, 'size'>) {\n-  // derive initial theme from system preference\n+  setPosition: (position: DevToolsIndicatorPosition) => void\n+  position: DevToolsIndicatorPosition\n+  scale: DevToolsScale\n+  setScale: (value: DevToolsScale) => void\n+}) {\n   const [theme, setTheme] = useState(getInitialTheme())\n \n   const handleThemeChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n@@ -90,7 +121,7 @@ export function UserPreferences({\n   }\n \n   return (\n-    <DevToolsInfo title=\"Preferences\" {...props}>\n+    <>\n       <h2 className=\"dev-tools-info-section-title\">General</h2>\n       <div className=\"preferences-container\">\n         <div className=\"preference-section\">\n@@ -257,7 +288,7 @@ export function UserPreferences({\n           </div>\n         </div>\n       ) : null}\n-    </DevToolsInfo>\n+    </>\n   )\n }\n "
        },
        {
            "sha": "efff0afb00056f62c13f1a357ccdf822f34fba74",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/drag-context.tsx",
            "status": "added",
            "additions": 89,
            "deletions": 0,
            "changes": 89,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdrag-context.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdrag-context.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdrag-context.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,89 @@\n+import React, {\n+  createContext,\n+  useCallback,\n+  useContext,\n+  useEffect,\n+  useMemo,\n+  useRef,\n+  type Ref,\n+  type RefObject,\n+} from 'react'\n+\n+interface DragContextValue {\n+  register: (el: HTMLElement) => void\n+  unregister: (el: HTMLElement) => void\n+  handles: Set<HTMLElement>\n+  disabled: boolean\n+}\n+\n+const DragContext = createContext<DragContextValue | null>(null)\n+\n+export function DragProvider({\n+  children,\n+  disabled = false,\n+}: {\n+  children: React.ReactNode\n+  disabled?: boolean\n+}) {\n+  const handlesRef = useRef<Set<HTMLElement>>(new Set())\n+\n+  const register = useCallback((el: HTMLElement) => {\n+    handlesRef.current.add(el)\n+  }, [])\n+\n+  const unregister = useCallback((el: HTMLElement) => {\n+    handlesRef.current.delete(el)\n+  }, [])\n+\n+  const value = useMemo<DragContextValue>(\n+    () => ({ register, unregister, handles: handlesRef.current, disabled }),\n+    [register, unregister, disabled]\n+  )\n+\n+  return <DragContext.Provider value={value}>{children}</DragContext.Provider>\n+}\n+\n+export function useDragContext() {\n+  return useContext(DragContext)\n+}\n+\n+export function DragHandle({\n+  children,\n+  ref,\n+  ...props\n+}: React.HTMLAttributes<HTMLDivElement> & { ref?: Ref<HTMLDivElement> }) {\n+  const internalRef = useRef<HTMLDivElement>(null)\n+  const ctx = useDragContext()\n+\n+  const setRef = useCallback(\n+    (node: HTMLDivElement | null) => {\n+      internalRef.current = node ?? null\n+      if (typeof ref === 'function') {\n+        ref(node)\n+      } else if (ref && typeof ref === 'object') {\n+        ;(ref as RefObject<HTMLDivElement | null>).current = node\n+      }\n+    },\n+    [ref]\n+  )\n+\n+  useEffect(() => {\n+    if (!ctx || !internalRef.current || ctx.disabled) return\n+    const el = internalRef.current\n+    ctx.register(el)\n+    return () => ctx.unregister(el)\n+  }, [ctx])\n+\n+  return (\n+    <div\n+      ref={setRef}\n+      {...props}\n+      style={{\n+        cursor: ctx?.disabled ? 'default' : 'grab',\n+        ...(props.style || {}),\n+      }}\n+    >\n+      {children}\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "f657ab8e4a9c875d625ea96dc76ab9d77b6fc827",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/draggable.tsx",
            "status": "modified",
            "additions": 77,
            "deletions": 43,
            "changes": 120,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdraggable.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdraggable.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdraggable.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,5 +1,6 @@\n import type { Corners } from '../../../shared'\n import { useCallback, useLayoutEffect, useRef } from 'react'\n+import { useDragContext } from './drag-context'\n \n interface Point {\n   x: number\n@@ -19,6 +20,7 @@ export function Draggable({\n   onDragStart,\n   dragHandleSelector,\n   disableDrag = false,\n+  avoidZone,\n   ...props\n }: {\n   children: React.ReactElement\n@@ -28,9 +30,16 @@ export function Draggable({\n   onDragStart?: () => void\n   dragHandleSelector?: string\n   disableDrag?: boolean\n+  style?: React.CSSProperties\n+  avoidZone?: {\n+    square: number\n+    corner: Corners\n+    padding: number\n+  }\n }) {\n   const { ref, animate, ...drag } = useDrag({\n     disabled: disableDrag,\n+    handles: useDragContext()?.handles,\n     threshold: 5,\n     onDragStart,\n     onDragEnd,\n@@ -56,7 +65,6 @@ export function Draggable({\n   }\n \n   function onAnimationEnd({ corner }: Corner) {\n-    // Unset drag translation\n     setTimeout(() => {\n       ref.current?.style.removeProperty('translate')\n       setCurrentCorner(corner)\n@@ -74,7 +82,7 @@ export function Draggable({\n     const min = Math.min(...distances.map((d) => d.distance))\n     const nearest = distances.find((d) => d.distance === min)\n     if (!nearest) {\n-      // Safety fallback\n+      // this should be guarded by an invariant, shouldn't ever happen\n       return { corner: currentCorner, translation: allCorners[currentCorner] }\n     }\n     return {\n@@ -94,49 +102,58 @@ export function Draggable({\n       const isRight = corner.includes('right')\n       const isBottom = corner.includes('bottom')\n \n-      return {\n-        x: isRight\n-          ? window.innerWidth - scrollbarWidth - offset - triggerWidth\n-          : 0,\n-        y: isBottom ? window.innerHeight - offset - triggerHeight : 0,\n+      // Base positions flush against the chosen corner\n+      let x = isRight\n+        ? window.innerWidth - scrollbarWidth - offset - triggerWidth\n+        : 0\n+      let y = isBottom ? window.innerHeight - offset - triggerHeight : 0\n+\n+      // Apply avoidZone offset if this corner is occupied. We only move along\n+      // the vertical axis to keep the panel within the viewport. For bottom\n+      // corners we move the panel up, for top corners we move it down.\n+      if (avoidZone && avoidZone.corner === corner) {\n+        const delta = avoidZone.square + avoidZone.padding\n+        if (isBottom) {\n+          // move up\n+          y -= delta\n+        } else {\n+          // move down\n+          y += delta\n+        }\n       }\n+\n+      return { x, y }\n     }\n \n     const basePosition = getAbsolutePosition(currentCorner)\n \n-    // Calculate all corner positions relative to the current corner\n+    function rel(pos: Point): Point {\n+      return {\n+        x: pos.x - basePosition.x,\n+        y: pos.y - basePosition.y,\n+      }\n+    }\n+\n     return {\n-      'top-left': {\n-        x: 0 - basePosition.x,\n-        y: 0 - basePosition.y,\n-      },\n-      'top-right': {\n-        x:\n-          window.innerWidth -\n-          scrollbarWidth -\n-          offset -\n-          triggerWidth -\n-          basePosition.x,\n-        y: 0 - basePosition.y,\n-      },\n-      'bottom-left': {\n-        x: 0 - basePosition.x,\n-        y: window.innerHeight - offset - triggerHeight - basePosition.y,\n-      },\n-      'bottom-right': {\n-        x:\n-          window.innerWidth -\n-          scrollbarWidth -\n-          offset -\n-          triggerWidth -\n-          basePosition.x,\n-        y: window.innerHeight - offset - triggerHeight - basePosition.y,\n-      },\n+      'top-left': rel(getAbsolutePosition('top-left')),\n+      'top-right': rel(getAbsolutePosition('top-right')),\n+      'bottom-left': rel(getAbsolutePosition('bottom-left')),\n+      'bottom-right': rel(getAbsolutePosition('bottom-right')),\n     }\n   }\n \n   return (\n-    <div {...props} ref={ref} {...drag} style={{ touchAction: 'none' }}>\n+    <div\n+      {...props}\n+      ref={ref}\n+      {...drag}\n+      style={{\n+        touchAction: 'none',\n+        userSelect: 'none',\n+        WebkitUserSelect: 'none',\n+        ...props.style,\n+      }}\n+    >\n       {children}\n     </div>\n   )\n@@ -150,6 +167,7 @@ interface UseDragOptions {\n   onAnimationEnd?: (corner: Corner) => void\n   threshold: number // Minimum movement before drag starts\n   dragHandleSelector?: string\n+  handles?: Set<HTMLElement>\n }\n \n interface Velocity {\n@@ -190,6 +208,8 @@ export function useDrag(options: UseDragOptions) {\n     velocities.current = []\n \n     ref.current?.classList.remove('dev-tools-grabbing')\n+    document.body.style.removeProperty('user-select')\n+    document.body.style.removeProperty('-webkit-user-select')\n   }, [])\n \n   useLayoutEffect(() => {\n@@ -234,18 +254,23 @@ export function useDrag(options: UseDragOptions) {\n   }\n \n   function isValidDragHandle(target: EventTarget | null): boolean {\n-    if (!options.dragHandleSelector || !ref.current || !target) {\n-      return true // If no selector provided, entire element is draggable\n-    }\n+    if (!target || !ref.current) return true\n \n-    const element = target as Element\n-    if (!element.matches) {\n+    if (options.handles && options.handles.size > 0) {\n+      let node: HTMLElement | null = target as HTMLElement\n+      while (node && node !== ref.current) {\n+        if (options.handles.has(node)) return true\n+        node = node.parentElement\n+      }\n       return false\n     }\n \n-    // Check if the target element directly matches the drag handle selector\n-    // This excludes children elements, only allowing drag from the exact element\n-    return element.matches(options.dragHandleSelector)\n+    if (options.dragHandleSelector) {\n+      const element = target as Element\n+      return element.closest(options.dragHandleSelector) !== null\n+    }\n+\n+    return true\n   }\n \n   function onPointerDown(e: React.PointerEvent) {\n@@ -285,6 +310,8 @@ export function useDrag(options: UseDragOptions) {\n         machine.current = { state: 'drag', pointerId: e.pointerId }\n         ref.current?.setPointerCapture(e.pointerId)\n         ref.current?.classList.add('dev-tools-grabbing')\n+        document.body.style.userSelect = 'none'\n+        document.body.style.webkitUserSelect = 'none'\n         options.onDragStart?.()\n       }\n     }\n@@ -328,6 +355,13 @@ export function useDrag(options: UseDragOptions) {\n     options.onDragEnd?.(translation.current, velocity)\n   }\n \n+  if (options.disabled) {\n+    return {\n+      ref,\n+      animate,\n+    }\n+  }\n+\n   return {\n     ref,\n     onPointerDown,"
        },
        {
            "sha": "3afd0727feb4d5fad471481394eb5bc490900db9",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/utils.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 12,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Futils.ts?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,5 +1,10 @@\n import { useEffect } from 'react'\n \n+export const getShadowRoot = () => {\n+  const portal = document.querySelector('nextjs-portal')\n+  return portal?.shadowRoot\n+}\n+\n export function useFocusTrap(\n   rootRef: React.RefObject<HTMLElement | null>,\n   triggerRef: React.RefObject<HTMLButtonElement | null> | null,\n@@ -80,11 +85,12 @@ function getFocusableNodes(node: HTMLElement): [HTMLElement, HTMLElement] | [] {\n \n //////////////////////////////////////////////////////////////////////////////////////\n \n-export function useClickOutside(\n+// TODO: split up escape and click outside logic\n+export function useClickOutsideAndEscape(\n   rootRef: React.RefObject<HTMLElement | null>,\n   triggerRef: React.RefObject<HTMLButtonElement | null>,\n   active: boolean,\n-  close: () => void,\n+  close: (reason: 'escape' | 'outside') => void,\n   ownerDocument?: Document\n ) {\n   useEffect(() => {\n@@ -100,32 +106,42 @@ export function useClickOutside(\n         return\n       }\n \n+      const cushion = 10\n+\n       if (\n         !(rootRef.current?.getBoundingClientRect()\n-          ? event.clientX >= rootRef.current.getBoundingClientRect()!.left &&\n-            event.clientX <= rootRef.current.getBoundingClientRect()!.right &&\n-            event.clientY >= rootRef.current.getBoundingClientRect()!.top &&\n-            event.clientY <= rootRef.current.getBoundingClientRect()!.bottom\n+          ? event.clientX >=\n+              rootRef.current.getBoundingClientRect()!.left - cushion &&\n+            event.clientX <=\n+              rootRef.current.getBoundingClientRect()!.right + cushion &&\n+            event.clientY >=\n+              rootRef.current.getBoundingClientRect()!.top - cushion &&\n+            event.clientY <=\n+              rootRef.current.getBoundingClientRect()!.bottom + cushion\n           : false) &&\n         !(triggerRef.current?.getBoundingClientRect()\n-          ? event.clientX >= triggerRef.current.getBoundingClientRect()!.left &&\n+          ? event.clientX >=\n+              triggerRef.current.getBoundingClientRect()!.left - cushion &&\n             event.clientX <=\n-              triggerRef.current.getBoundingClientRect()!.right &&\n-            event.clientY >= triggerRef.current.getBoundingClientRect()!.top &&\n-            event.clientY <= triggerRef.current.getBoundingClientRect()!.bottom\n+              triggerRef.current.getBoundingClientRect()!.right + cushion &&\n+            event.clientY >=\n+              triggerRef.current.getBoundingClientRect()!.top - cushion &&\n+            event.clientY <=\n+              triggerRef.current.getBoundingClientRect()!.bottom + cushion\n           : false)\n       ) {\n-        close()\n+        close('outside')\n       }\n     }\n \n     function handleKeyDown(event: KeyboardEvent) {\n       if (event.key === 'Escape') {\n-        close()\n+        close('escape')\n       }\n     }\n \n     ownerDocumentEl?.addEventListener('mousedown', handleClickOutside)\n+\n     ownerDocumentEl?.addEventListener('keydown', handleKeyDown)\n \n     return () => {"
        },
        {
            "sha": "d451e401a827a564b931d3af3d34b06b58b9cde2",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/overlay/overlay.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Foverlay%2Foverlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Foverlay%2Foverlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Foverlay%2Foverlay.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,10 +1,11 @@\n+import { css } from '../../../utils/css'\n import { Overlay, type OverlayProps } from '../../overlay/overlay'\n \n export function ErrorOverlayOverlay({ children, ...props }: OverlayProps) {\n   return <Overlay {...props}>{children}</Overlay>\n }\n \n-export const OVERLAY_STYLES = `\n+export const OVERLAY_STYLES = css`\n   [data-nextjs-dialog-overlay] {\n     padding: initial;\n     top: 10vh;"
        },
        {
            "sha": "ed656c049425fd1f977184fb1e8c07399423c142",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overlay/styles.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverlay%2Fstyles.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverlay%2Fstyles.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverlay%2Fstyles.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,4 +1,6 @@\n-const styles = `\n+import { css } from '../../utils/css'\n+\n+const styles = css`\n   [data-nextjs-dialog-overlay] {\n     position: fixed;\n     top: 0;"
        },
        {
            "sha": "ff121645a7252d28de5fa5c779396121759aeb2d",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-boundary-trigger.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-boundary-trigger.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -3,7 +3,7 @@ import { useCallback, useState, useRef, useMemo } from 'react'\n import { Menu } from '@base-ui-components/react/menu'\n import type { SegmentNodeState } from '../../../userspace/app/segment-explorer-node'\n import { normalizeBoundaryFilename } from '../../../../server/app-render/segment-explorer-path'\n-import { useClickOutside } from '../errors/dev-tools-indicator/utils'\n+import { useClickOutsideAndEscape } from '../errors/dev-tools-indicator/utils'\n \n const composeRefs = (...refs: (React.Ref<HTMLButtonElement> | undefined)[]) => {\n   return (node: HTMLButtonElement | null) => {\n@@ -39,7 +39,7 @@ export function SegmentBoundaryTrigger({\n   const popupRef = useRef<HTMLDivElement>(null)\n \n   // Click outside of popup should close the menu\n-  useClickOutside(\n+  useClickOutsideAndEscape(\n     popupRef,\n     triggerRef,\n     isOpen,"
        },
        {
            "sha": "b415e4e39f4266399d087fbc9b3bd3da5090681d",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.css",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.css",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.css?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,10 +1,9 @@\n .segment-explorer-content {\n   font-size: var(--size-14);\n   padding: 0 8px;\n-  width: 700px;\n-  height: 400px;\n-  max-width: calc(100vw - 40px);\n-  max-height: calc(100vh - 240px);\n+  width: 100%;\n+  height: 100%;\n+  overflow: auto;\n }\n \n .segment-explorer-page-route-bar {\n@@ -132,7 +131,6 @@\n .segment-explorer-footer {\n   padding: 8px;\n   border-top: 1px solid var(--color-gray-400);\n-  background-color: var(--color-background-100);\n   user-select: none;\n }\n "
        },
        {
            "sha": "bf8d532e4aabab27456e4fbc6e637ebc362cfdf9",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.tsx",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -118,11 +118,22 @@ export function PageSegmentTree({\n   }, [tree, isAppRouter])\n \n   return (\n-    <div data-nextjs-devtools-panel-segments-explorer>\n+    <div\n+      data-nextjs-devtools-panel-segments-explorer\n+      style={{\n+        display: 'flex',\n+        flexDirection: 'column',\n+        height: '100%',\n+      }}\n+    >\n       {isAppRouter && <PageRouteBar page={page} />}\n       <div\n         className=\"segment-explorer-content\"\n         data-nextjs-devtool-segment-explorer\n+        style={{\n+          flex: '1 1 auto',\n+          overflow: 'auto',\n+        }}\n       >\n         {isAppRouter ? (\n           <PageSegmentTreeLayerPresentation node={tree} level={0} segment=\"\" />"
        },
        {
            "sha": "ef73ed2d2e1a53b958ddf6a558e11999884a0b73",
            "filename": "packages/next/src/next-devtools/dev-overlay/container/errors.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcontainer%2Ferrors.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcontainer%2Ferrors.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcontainer%2Ferrors.stories.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -16,6 +16,7 @@ const meta: Meta<typeof Errors> = {\n export default meta\n type Story = StoryObj<typeof Errors>\n \n+// todo: update the stories to be wrapped in context providers necessary, instead of passing props directly, before they expected props\n export const Default: Story = {\n   args: {\n     getSquashedHydrationErrorDetails: () => null,"
        },
        {
            "sha": "aef13e0a92acd5a65661c69292c8f6f6d9cb958f",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 40,
            "deletions": 19,
            "changes": 59,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -10,6 +10,8 @@ import {\n   storybookDefaultOverlayState,\n   useStorybookOverlayReducer,\n } from './storybook/use-overlay-reducer'\n+import { DevOverlayContext } from '../dev-overlay.browser'\n+import { getSquashedHydrationErrorDetails } from '../userspace/pages/hydration-error-state'\n \n const meta: Meta<typeof DevOverlay> = {\n   component: DevOverlay,\n@@ -39,14 +41,20 @@ function getNoSquashedHydrationErrorDetails() {\n \n const initialState: OverlayState = {\n   ...storybookDefaultOverlayState,\n-  errors,\n+  errors: errors,\n }\n \n export const Default: Story = {\n   render: function DevOverlayStory() {\n     const [state, dispatch] = useStorybookOverlayReducer(initialState)\n     return (\n-      <>\n+      <div\n+        style={{\n+          height: '100vh',\n+          backgroundColor: 'black',\n+        }}\n+      >\n+        {/* TODO: get lots of real hard examples so we have better debug */}\n         <img\n           src={imgApp}\n           style={{\n@@ -55,19 +63,26 @@ export const Default: Story = {\n             objectFit: 'contain',\n           }}\n         />\n-        <DevOverlay\n-          state={state}\n-          dispatch={dispatch}\n-          getSquashedHydrationErrorDetails={\n-            // Testing like App Router where we no longer quash hydration errors\n-            getNoSquashedHydrationErrorDetails\n-          }\n-        />\n-      </>\n+        <DevOverlayContext\n+          value={{\n+            dispatch,\n+            getSquashedHydrationErrorDetails:\n+              getNoSquashedHydrationErrorDetails,\n+            state,\n+          }}\n+        >\n+          <DevOverlay\n+            state={state}\n+            dispatch={dispatch}\n+            getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n+          />\n+        </DevOverlayContext>\n+      </div>\n     )\n   },\n }\n \n+// todo: fix story with \"Context arg provider\" wrapper\n export const WithPanel: Story = {\n   beforeEach: () => {\n     process.env.__NEXT_DEVTOOL_NEW_PANEL_UI = 'true'\n@@ -89,14 +104,20 @@ export const WithPanel: Story = {\n             objectFit: 'contain',\n           }}\n         />\n-        <DevOverlay\n-          state={state}\n-          dispatch={dispatch}\n-          getSquashedHydrationErrorDetails={\n-            // Testing like App Router where we no longer quash hydration errors\n-            getNoSquashedHydrationErrorDetails\n-          }\n-        />\n+        <DevOverlayContext\n+          value={{\n+            dispatch,\n+            getSquashedHydrationErrorDetails:\n+              getNoSquashedHydrationErrorDetails,\n+            state,\n+          }}\n+        >\n+          <DevOverlay\n+            dispatch={dispatch}\n+            getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n+            state={state}\n+          />\n+        </DevOverlayContext>\n       </>\n     )\n   },"
        },
        {
            "sha": "13f7cbef3cd0c08af8ba3de0162d4edbf16126d3",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.tsx",
            "status": "modified",
            "additions": 59,
            "deletions": 63,
            "changes": 122,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -1,12 +1,4 @@\n-import {\n-  ACTION_DEVTOOLS_PANEL_OPEN,\n-  ACTION_ERROR_OVERLAY_OPEN,\n-  type OverlayDispatch,\n-  type OverlayState,\n-} from './shared'\n-\n-import { useState } from 'react'\n-\n+import { createContext, useContext, useRef, useState } from 'react'\n import { ShadowPortal } from './components/shadow-portal'\n import { Base } from './styles/base'\n import { ComponentStyles } from './styles/component-styles'\n@@ -18,8 +10,18 @@ import { RenderError } from './container/runtime-error/render-error'\n import { DarkTheme } from './styles/dark-theme'\n import { useDevToolsScale } from './components/errors/dev-tools-indicator/dev-tools-info/preferences'\n import type { HydrationErrorState } from '../shared/hydration-error'\n-import { DevToolsIndicator as DevToolsIndicatorNew } from './components/devtools-indicator/devtools-indicator'\n-import { DevToolsPanel } from './components/devtools-panel/devtools-panel'\n+import type { ReadyRuntimeError } from './utils/get-error-by-type'\n+import { DevToolsIndicatorNew } from './components/devtools-indicator/devtools-indicator'\n+import { PanelRouter } from './menu/panel-router'\n+import { PanelRouterContext, type PanelStateKind } from './menu/context'\n+import type { OverlayState, OverlayDispatch } from './shared'\n+\n+export const RenderErrorContext = createContext<{\n+  runtimeErrors: ReadyRuntimeError[]\n+  totalErrorCount: number\n+}>(null!)\n+\n+export const useRenderErrorContext = () => useContext(RenderErrorContext)\n \n export function DevOverlay({\n   state,\n@@ -31,23 +33,11 @@ export function DevOverlay({\n   getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n }) {\n   const [scale, setScale] = useDevToolsScale()\n-  const [isPrevBuildError, setIsPrevBuildError] = useState(false)\n-\n+  const [panel, setPanel] = useState<null | PanelStateKind>(null)\n   const isBuildError = state.buildError !== null\n+  const [selectedIndex, setSelectedIndex] = useState(-1)\n \n-  if (\n-    process.env.__NEXT_DEVTOOL_NEW_PANEL_UI &&\n-    isBuildError !== isPrevBuildError\n-  ) {\n-    // If the build error is set, enable the devtools panel as the error overlay mode,\n-    // and the rest actions (close, minimize, fullscreen) can be handled by the user.\n-    if (isBuildError) {\n-      dispatch({ type: ACTION_DEVTOOLS_PANEL_OPEN })\n-      dispatch({ type: ACTION_ERROR_OVERLAY_OPEN })\n-    }\n-    setIsPrevBuildError(isBuildError)\n-  }\n-\n+  const triggerRef = useRef<HTMLButtonElement>(null)\n   return (\n     <ShadowPortal>\n       <CssReset />\n@@ -63,50 +53,56 @@ export function DevOverlay({\n           return (\n             <>\n               {state.showIndicator &&\n-                (process.env.__NEXT_DEVTOOL_NEW_PANEL_UI ? (\n-                  <>\n-                    <DevToolsIndicatorNew\n-                      state={state}\n-                      dispatch={dispatch}\n-                      errorCount={totalErrorCount}\n-                      isBuildError={isBuildError}\n-                    />\n-\n-                    {(state.isDevToolsPanelOpen ||\n-                      state.isErrorOverlayOpen) && (\n-                      <DevToolsPanel\n+              process.env.__NEXT_DEVTOOL_NEW_PANEL_UI ? (\n+                <>\n+                  <RenderErrorContext\n+                    value={{ runtimeErrors, totalErrorCount }}\n+                  >\n+                    <PanelRouterContext\n+                      value={{\n+                        panel,\n+                        setPanel,\n+                        triggerRef,\n+                        selectedIndex,\n+                        setSelectedIndex,\n+                      }}\n+                    >\n+                      <ErrorOverlay\n                         state={state}\n                         dispatch={dispatch}\n-                        issueCount={totalErrorCount}\n-                        runtimeErrors={runtimeErrors}\n                         getSquashedHydrationErrorDetails={\n                           getSquashedHydrationErrorDetails\n                         }\n+                        runtimeErrors={runtimeErrors}\n+                        errorCount={totalErrorCount}\n                       />\n-                    )}\n-                  </>\n-                ) : (\n-                  <>\n-                    <DevToolsIndicator\n-                      scale={scale}\n-                      setScale={setScale}\n-                      state={state}\n-                      dispatch={dispatch}\n-                      errorCount={totalErrorCount}\n-                      isBuildError={isBuildError}\n-                    />\n+                      <PanelRouter />\n+                      <DevToolsIndicatorNew />\n+                    </PanelRouterContext>\n+                  </RenderErrorContext>\n+                </>\n+              ) : (\n+                <>\n+                  <DevToolsIndicator\n+                    scale={scale}\n+                    setScale={setScale}\n+                    state={state}\n+                    dispatch={dispatch}\n+                    errorCount={totalErrorCount}\n+                    isBuildError={isBuildError}\n+                  />\n \n-                    <ErrorOverlay\n-                      state={state}\n-                      dispatch={dispatch}\n-                      getSquashedHydrationErrorDetails={\n-                        getSquashedHydrationErrorDetails\n-                      }\n-                      runtimeErrors={runtimeErrors}\n-                      errorCount={totalErrorCount}\n-                    />\n-                  </>\n-                ))}\n+                  <ErrorOverlay\n+                    state={state}\n+                    dispatch={dispatch}\n+                    getSquashedHydrationErrorDetails={\n+                      getSquashedHydrationErrorDetails\n+                    }\n+                    runtimeErrors={runtimeErrors}\n+                    errorCount={totalErrorCount}\n+                  />\n+                </>\n+              )}\n             </>\n           )\n         }}"
        },
        {
            "sha": "ad1bfd2cfd79f5919c8160542e32b162d948c0c6",
            "filename": "packages/next/src/next-devtools/dev-overlay/hooks/use-shortcuts.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fhooks%2Fuse-shortcuts.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fhooks%2Fuse-shortcuts.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fhooks%2Fuse-shortcuts.ts?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -39,7 +39,9 @@ export function useShortcuts(\n   }, [shortcuts])\n }\n \n-function isFocusedOnElement(rootRef: React.RefObject<HTMLElement | null>) {\n+export function isFocusedOnElement(\n+  rootRef: React.RefObject<HTMLElement | null>\n+) {\n   const el = getActiveElement(rootRef.current)\n \n   if (!el) return false"
        },
        {
            "sha": "815dc30bd8dcbedcad80ce8c337cf710eba1baba",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/context.tsx",
            "status": "added",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fcontext.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fcontext.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fcontext.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,23 @@\n+import {\n+  createContext,\n+  useContext,\n+  type Dispatch,\n+  type SetStateAction,\n+} from 'react'\n+\n+export type PanelStateKind =\n+  | 'preferences'\n+  | 'route-type'\n+  | 'segment-explorer'\n+  | 'panel-selector'\n+  | 'turbo-info'\n+\n+export const PanelRouterContext = createContext<{\n+  panel: PanelStateKind | null\n+  setPanel: Dispatch<SetStateAction<PanelStateKind | null>>\n+  triggerRef: React.RefObject<HTMLButtonElement | null>\n+  selectedIndex: number\n+  setSelectedIndex: Dispatch<SetStateAction<number>>\n+}>(null!)\n+\n+export const usePanelRouterContext = () => useContext(PanelRouterContext)"
        },
        {
            "sha": "5e9cfac284827f679867f58efc7a8e86755f3c13",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/dev-overlay-menu.tsx",
            "status": "added",
            "additions": 313,
            "deletions": 0,
            "changes": 313,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fdev-overlay-menu.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fdev-overlay-menu.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fdev-overlay-menu.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,313 @@\n+import { useDevOverlayContext } from '../../dev-overlay.browser'\n+import { useClickOutsideAndEscape } from '../components/errors/dev-tools-indicator/utils'\n+import { useLayoutEffect, useRef, type CSSProperties } from 'react'\n+import { getIndicatorOffset } from '../utils/indicator-metrics'\n+import { INDICATOR_PADDING } from '../components/devtools-indicator/devtools-indicator'\n+import {\n+  MenuContext,\n+  MenuItem,\n+} from '../components/errors/dev-tools-indicator/dev-tools-indicator'\n+import { usePanelRouterContext } from './context'\n+import { usePanelContext } from './panel-router'\n+\n+export const DevtoolMenu = ({\n+  closeOnClickOutside = true,\n+  items,\n+}: {\n+  closeOnClickOutside?: boolean\n+  items: Array<\n+    | false\n+    | undefined\n+    | null\n+    | {\n+        onClick?: () => void\n+        title?: string\n+        label: string\n+        value: React.ReactNode\n+        attributes?: Record<string, string | boolean>\n+        footer?: boolean\n+      }\n+  >\n+}) => {\n+  const { state } = useDevOverlayContext()\n+  const { setPanel, triggerRef, setSelectedIndex, selectedIndex } =\n+    usePanelRouterContext()\n+  const { mounted } = usePanelContext()\n+\n+  const [vertical, horizontal] = state.devToolsPosition.split('-', 2)\n+\n+  const menuRef = useRef<HTMLDivElement>(null)\n+\n+  useClickOutsideAndEscape(\n+    menuRef,\n+    triggerRef,\n+    closeOnClickOutside && mounted,\n+    (reason) => {\n+      switch (reason) {\n+        case 'escape': {\n+          setPanel(null)\n+          setSelectedIndex(-1)\n+          return\n+        }\n+        case 'outside': {\n+          if (!closeOnClickOutside) {\n+            return\n+          }\n+          setPanel(null)\n+          setSelectedIndex(-1)\n+          return\n+        }\n+        default: {\n+          return null!\n+        }\n+      }\n+    }\n+  )\n+  useLayoutEffect(() => {\n+    menuRef.current?.focus() // allows keydown to be captured\n+    selectMenuItem({\n+      index: selectedIndex === -1 ? 'first' : selectedIndex,\n+      menuRef,\n+      setSelectedIndex,\n+    })\n+    // eslint-disable-next-line react-hooks/exhaustive-deps\n+  }, [])\n+\n+  const indicatorOffset = getIndicatorOffset(state)\n+\n+  const [indicatorVertical, indicatorHorizontal] = state.devToolsPosition.split(\n+    '-',\n+    2\n+  )\n+\n+  const verticalOffset =\n+    vertical === indicatorVertical && horizontal === indicatorHorizontal\n+      ? indicatorOffset\n+      : INDICATOR_PADDING\n+\n+  const positionStyle = {\n+    [vertical]: `${verticalOffset}px`,\n+    [horizontal]: `${INDICATOR_PADDING}px`,\n+    [vertical === 'top' ? 'bottom' : 'top']: 'auto',\n+    [horizontal === 'left' ? 'right' : 'left']: 'auto',\n+  } as CSSProperties\n+  const definedItems = items.filter((item) => !!item)\n+  const itemsAboveFooter = definedItems.filter((item) => !item.footer)\n+  const itemsBelowFooter = definedItems.filter((item) => item.footer)\n+\n+  function onMenuKeydown(e: React.KeyboardEvent<HTMLDivElement | null>) {\n+    e.preventDefault()\n+\n+    const clickableItems = definedItems.filter((item) => item.onClick)\n+    const totalClickableItems = clickableItems.length\n+\n+    switch (e.key) {\n+      case 'ArrowDown':\n+        const next =\n+          selectedIndex >= totalClickableItems - 1 ? 0 : selectedIndex + 1\n+        selectMenuItem({ index: next, menuRef, setSelectedIndex })\n+        break\n+      case 'ArrowUp':\n+        const prev =\n+          selectedIndex <= 0 ? totalClickableItems - 1 : selectedIndex - 1\n+        selectMenuItem({ index: prev, menuRef, setSelectedIndex })\n+        break\n+      case 'Home':\n+        selectMenuItem({ index: 'first', menuRef, setSelectedIndex })\n+        break\n+      case 'End':\n+        selectMenuItem({ index: 'last', menuRef, setSelectedIndex })\n+        break\n+      case 'n':\n+        if (e.ctrlKey) {\n+          const nextCtrl =\n+            selectedIndex >= totalClickableItems - 1 ? 0 : selectedIndex + 1\n+          selectMenuItem({ index: nextCtrl, menuRef, setSelectedIndex })\n+        }\n+        break\n+      case 'p':\n+        if (e.ctrlKey) {\n+          const prevCtrl =\n+            selectedIndex <= 0 ? totalClickableItems - 1 : selectedIndex - 1\n+          selectMenuItem({ index: prevCtrl, menuRef, setSelectedIndex })\n+        }\n+        break\n+      default:\n+        break\n+    }\n+  }\n+\n+  return (\n+    <div\n+      ref={menuRef}\n+      onKeyDown={onMenuKeydown}\n+      id=\"nextjs-dev-tools-menu\"\n+      role=\"menu\"\n+      dir=\"ltr\"\n+      aria-orientation=\"vertical\"\n+      aria-label=\"Next.js Dev Tools Items\"\n+      tabIndex={-1}\n+      style={{\n+        outline: 0,\n+        WebkitFontSmoothing: 'antialiased',\n+        display: 'flex',\n+        flexDirection: 'column',\n+        alignItems: 'flex-start',\n+        background: 'var(--color-background-100)',\n+\n+        backgroundClip: 'padding-box',\n+        boxShadow: 'var(--shadow-menu)',\n+        borderRadius: 'var(--rounded-xl)',\n+        position: 'fixed',\n+        fontFamily: 'var(--font-stack-sans)',\n+        zIndex: 3,\n+        overflow: 'hidden',\n+        opacity: 1,\n+        minWidth: '248px',\n+        transition:\n+          'opacity var(--animate-out-duration-ms) var(--animate-out-timing-function)',\n+        border: '1px solid var(--color-gray-alpha-400)',\n+        ...positionStyle,\n+      }}\n+    >\n+      <MenuContext\n+        value={{\n+          selectedIndex,\n+          setSelectedIndex,\n+        }}\n+      >\n+        <div style={{ padding: '6px', width: '100%' }}>\n+          {itemsAboveFooter.map((item, index) => (\n+            <MenuItem\n+              key={item.label}\n+              title={item.title}\n+              label={item.label}\n+              value={item.value}\n+              onClick={item.onClick}\n+              index={\n+                item.onClick\n+                  ? getAdjustedIndex(itemsAboveFooter, index)\n+                  : undefined\n+              }\n+              {...item.attributes}\n+            />\n+          ))}\n+        </div>\n+        <div className=\"dev-tools-indicator-footer\">\n+          {itemsBelowFooter.map((item, index) => (\n+            <MenuItem\n+              key={item.label}\n+              title={item.title}\n+              label={item.label}\n+              value={item.value}\n+              onClick={item.onClick}\n+              {...item.attributes}\n+              index={\n+                item.onClick\n+                  ? getAdjustedIndex(itemsBelowFooter, index) +\n+                    getClickableItemsCount(itemsAboveFooter)\n+                  : undefined\n+              }\n+            />\n+          ))}\n+        </div>\n+      </MenuContext>\n+    </div>\n+  )\n+}\n+\n+export function getAdjustedIndex(\n+  items: Array<{ onClick?: () => void }>,\n+  targetIndex: number\n+): number {\n+  let adjustedIndex = 0\n+\n+  for (let i = 0; i <= targetIndex && i < items.length; i++) {\n+    if (items[i].onClick) {\n+      if (i === targetIndex) {\n+        return adjustedIndex\n+      }\n+      adjustedIndex++\n+    }\n+  }\n+\n+  return adjustedIndex\n+}\n+\n+export function getClickableItemsCount(\n+  items: Array<{ onClick?: () => void }>\n+): number {\n+  return items.filter((item) => item.onClick).length\n+}\n+\n+export function IssueCount({ children }: { children: number }) {\n+  return (\n+    <span\n+      className=\"dev-tools-indicator-issue-count\"\n+      data-has-issues={children > 0}\n+    >\n+      <span className=\"dev-tools-indicator-issue-count-indicator\" />\n+      {children}\n+    </span>\n+  )\n+}\n+\n+export function ChevronRight() {\n+  return (\n+    <svg\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      width=\"16\"\n+      height=\"16\"\n+      viewBox=\"0 0 16 16\"\n+      fill=\"none\"\n+    >\n+      <path\n+        fill=\"#666\"\n+        fillRule=\"evenodd\"\n+        clipRule=\"evenodd\"\n+        d=\"M5.50011 1.93945L6.03044 2.46978L10.8537 7.293C11.2442 7.68353 11.2442 8.31669 10.8537 8.70722L6.03044 13.5304L5.50011 14.0608L4.43945 13.0001L4.96978 12.4698L9.43945 8.00011L4.96978 3.53044L4.43945 3.00011L5.50011 1.93945Z\"\n+      />\n+    </svg>\n+  )\n+}\n+\n+export function selectMenuItem({\n+  index,\n+  menuRef,\n+  setSelectedIndex,\n+}: {\n+  index: number | 'first' | 'last'\n+  menuRef: React.RefObject<HTMLDivElement | null>\n+  setSelectedIndex: (index: number) => void\n+}) {\n+  if (index === 'first') {\n+    setTimeout(() => {\n+      const all = menuRef.current?.querySelectorAll('[role=\"menuitem\"]')\n+      if (all) {\n+        const firstIndex = all[0].getAttribute('data-index')\n+        selectMenuItem({ index: Number(firstIndex), menuRef, setSelectedIndex })\n+      }\n+    })\n+    return\n+  }\n+\n+  if (index === 'last') {\n+    setTimeout(() => {\n+      const all = menuRef.current?.querySelectorAll('[role=\"menuitem\"]')\n+      if (all) {\n+        const lastIndex = all.length - 1\n+        selectMenuItem({ index: lastIndex, menuRef, setSelectedIndex })\n+      }\n+    })\n+    return\n+  }\n+\n+  const el = menuRef.current?.querySelector(\n+    `[data-index=\"${index}\"]`\n+  ) as HTMLElement\n+\n+  if (el) {\n+    setSelectedIndex(index)\n+    el?.focus()\n+  }\n+}"
        },
        {
            "sha": "6da7f9bcfe262e4ce9cf35346c7df401caac4103",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/panel-router.tsx",
            "status": "added",
            "additions": 354,
            "deletions": 0,
            "changes": 354,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,354 @@\n+import { usePanelRouterContext, type PanelStateKind } from './context'\n+import { ChevronRight, DevtoolMenu, IssueCount } from './dev-overlay-menu'\n+import { DynamicPanel } from '../panel/dynamic-panel'\n+import {\n+  learnMoreLink,\n+  RouteInfoBody,\n+} from '../components/errors/dev-tools-indicator/dev-tools-info/route-info'\n+import { PageSegmentTree } from '../components/overview/segment-explorer'\n+import { TurbopackInfoBody } from '../components/errors/dev-tools-indicator/dev-tools-info/turbopack-info'\n+import { DevToolsHeader } from '../components/errors/dev-tools-indicator/dev-tools-info/dev-tools-header'\n+import { useDelayedRender } from '../hooks/use-delayed-render'\n+import {\n+  getShadowRoot,\n+  MENU_CURVE,\n+  MENU_DURATION_MS,\n+} from '../components/errors/dev-tools-indicator/utils'\n+import { useDevOverlayContext } from '../../dev-overlay.browser'\n+import { createContext, useContext } from 'react'\n+import { useRenderErrorContext } from '../dev-overlay'\n+import {\n+  ACTION_DEV_INDICATOR_SET,\n+  ACTION_DEVTOOLS_POSITION,\n+  ACTION_DEVTOOLS_SCALE,\n+  ACTION_ERROR_OVERLAY_OPEN,\n+} from '../shared'\n+import GearIcon from '../icons/gear-icon'\n+import { UserPreferencesBody } from '../components/errors/dev-tools-indicator/dev-tools-info/user-preferences'\n+import { useHideShortcutStorage } from '../components/errors/dev-tools-indicator/dev-tools-info/preferences'\n+import { useShortcuts } from '../hooks/use-shortcuts'\n+import { useUpdateAllPanelPositions } from '../components/devtools-indicator/devtools-indicator'\n+\n+const MenuPanel = () => {\n+  const { setPanel, setSelectedIndex } = usePanelRouterContext()\n+  const { state, dispatch } = useDevOverlayContext()\n+  const { totalErrorCount } = useRenderErrorContext()\n+  return (\n+    <DevtoolMenu\n+      items={[\n+        totalErrorCount > 0 && {\n+          title: `${totalErrorCount} ${totalErrorCount === 1 ? 'issue' : 'issues'} found. Click to view details in the dev overlay.`,\n+          label: 'Issues',\n+          value: <IssueCount>{totalErrorCount}</IssueCount>,\n+          onClick: () => {\n+            setPanel(null)\n+            setSelectedIndex(-1)\n+            if (totalErrorCount > 0) {\n+              dispatch({\n+                type: ACTION_ERROR_OVERLAY_OPEN,\n+              })\n+            }\n+          },\n+        },\n+        {\n+          title: `Current route is ${state.staticIndicator ? 'static' : 'dynamic'}.`,\n+          label: 'Route',\n+          value: state.staticIndicator ? 'Static' : 'Dynamic',\n+          onClick: () => setPanel('route-type'),\n+          attributes: {\n+            'data-nextjs-route-type': state.staticIndicator\n+              ? 'static'\n+              : 'dynamic',\n+          },\n+        },\n+        !!process.env.TURBOPACK\n+          ? {\n+              title: 'Turbopack is enabled.',\n+              label: 'Turbopack',\n+              value: 'Enabled',\n+            }\n+          : {\n+              title:\n+                'Learn about Turbopack and how to enable it in your application.',\n+              label: 'Try Turbopack',\n+              value: <ChevronRight />,\n+              onClick: () => setPanel('turbo-info'),\n+            },\n+        !!process.env.__NEXT_DEVTOOL_SEGMENT_EXPLORER && {\n+          label: 'Route Info',\n+          value: <ChevronRight />,\n+          onClick: () => setPanel('segment-explorer'),\n+          attributes: {\n+            'data-segment-explorer': true,\n+          },\n+        },\n+        {\n+          label: 'Preferences',\n+          value: <GearIcon />,\n+          onClick: () => setPanel('preferences'),\n+          footer: true,\n+          attributes: {\n+            'data-preferences': true,\n+          },\n+        },\n+      ]}\n+    />\n+  )\n+}\n+\n+// a little hacky but it does the trick\n+const useToggleDevtoolsVisibility = () => {\n+  const { state, dispatch } = useDevOverlayContext()\n+  return () => {\n+    dispatch({\n+      type: ACTION_DEV_INDICATOR_SET,\n+      disabled: !state.disableDevIndicator,\n+    })\n+    const portal = getShadowRoot()\n+    if (portal) {\n+      const menuElement = portal.getElementById('panel-route') as HTMLElement\n+      const indicatorElement = portal.getElementById(\n+        'data-devtools-indicator'\n+      ) as HTMLElement\n+\n+      if (menuElement && menuElement.firstElementChild) {\n+        const firstChild = menuElement.firstElementChild as HTMLElement\n+        const isCurrentlyHidden = firstChild.style.display === 'none'\n+        firstChild.style.display = isCurrentlyHidden ? '' : 'none'\n+      }\n+\n+      if (indicatorElement) {\n+        const isCurrentlyHidden = indicatorElement.style.display === 'none'\n+        indicatorElement.style.display = isCurrentlyHidden ? '' : 'none'\n+      }\n+    }\n+  }\n+}\n+\n+export const PanelRouter = () => {\n+  const { state } = useDevOverlayContext()\n+  const { triggerRef } = usePanelRouterContext()\n+  const toggleDevtools = useToggleDevtoolsVisibility()\n+\n+  const [hideShortcut] = useHideShortcutStorage()\n+  useShortcuts(\n+    hideShortcut ? { [hideShortcut]: toggleDevtools } : {},\n+    triggerRef\n+  )\n+  return (\n+    <>\n+      <PanelRoute name=\"panel-selector\">\n+        <MenuPanel />\n+      </PanelRoute>\n+\n+      <PanelRoute name=\"preferences\">\n+        <DynamicPanel\n+          sharePanelSizeGlobally={false}\n+          sizeConfig={{\n+            kind: 'fixed',\n+            height: 500 / state.scale,\n+            width: 480 + 32,\n+          }}\n+          closeOnClickOutside\n+          header={<DevToolsHeader title=\"Preferences\" />}\n+        >\n+          <UserPreferencesWrapper />\n+        </DynamicPanel>\n+      </PanelRoute>\n+\n+      <PanelRoute name=\"route-type\">\n+        <DynamicPanel\n+          key={state.staticIndicator ? 'static' : 'dynamic'}\n+          sharePanelSizeGlobally={false}\n+          sizeConfig={{\n+            kind: 'fixed',\n+            height: state.staticIndicator\n+              ? 300 / state.scale\n+              : 325 / state.scale,\n+            width: 400 / state.scale,\n+          }}\n+          closeOnClickOutside\n+          header={\n+            <DevToolsHeader\n+              title={`${state.staticIndicator ? 'Static' : 'Dynamic'} Route`}\n+            />\n+          }\n+        >\n+          <div\n+            style={{\n+              padding: '16px',\n+              paddingTop: '8px',\n+            }}\n+          >\n+            <RouteInfoBody\n+              routerType={state.routerType}\n+              isStaticRoute={state.staticIndicator}\n+            />\n+            <InfoFooter\n+              href={\n+                learnMoreLink[state.routerType][\n+                  state.staticIndicator ? 'static' : 'dynamic'\n+                ]\n+              }\n+            />\n+          </div>\n+        </DynamicPanel>\n+      </PanelRoute>\n+\n+      {process.env.__NEXT_DEVTOOL_SEGMENT_EXPLORER && (\n+        <PanelRoute name=\"segment-explorer\">\n+          <DynamicPanel\n+            sharePanelSizeGlobally={false}\n+            sharePanelPositionGlobally={false}\n+            draggable\n+            sizeConfig={{\n+              kind: 'resizable',\n+              maxHeight: '90vh',\n+              maxWidth: '90vw',\n+              minHeight: 200 / state.scale,\n+              minWidth: 250 / state.scale,\n+              initialSize: {\n+                height: 375 / state.scale,\n+                width: 400 / state.scale,\n+              },\n+            }}\n+            header={<DevToolsHeader title=\"Route Info\" />}\n+          >\n+            <PageSegmentTree\n+              isAppRouter={state.routerType === 'app'}\n+              page={state.page}\n+            />\n+          </DynamicPanel>\n+        </PanelRoute>\n+      )}\n+\n+      <PanelRoute name=\"turbo-info\">\n+        <DynamicPanel\n+          sharePanelSizeGlobally={false}\n+          // this size config is really silly, should calculate initial size dynamically\n+          sizeConfig={{\n+            kind: 'fixed',\n+            height: 470 / state.scale,\n+            width: 400 / state.scale,\n+          }}\n+          closeOnClickOutside\n+          header={<DevToolsHeader title=\"Try Turbopack\" />}\n+        >\n+          <div\n+            style={{\n+              padding: '16px',\n+              paddingTop: '8px',\n+            }}\n+          >\n+            <TurbopackInfoBody />\n+            <InfoFooter href=\"https://nextjs.org/docs/app/api-reference/turbopack\" />\n+          </div>\n+        </DynamicPanel>\n+      </PanelRoute>\n+    </>\n+  )\n+}\n+\n+const InfoFooter = ({ href }: { href: string }) => {\n+  return (\n+    <div className=\"dev-tools-info-button-container\">\n+      <a\n+        className=\"dev-tools-info-learn-more-button\"\n+        href={href}\n+        target=\"_blank\"\n+        rel=\"noreferrer noopener\"\n+      >\n+        Learn More\n+      </a>\n+    </div>\n+  )\n+}\n+\n+const UserPreferencesWrapper = () => {\n+  const { dispatch, state } = useDevOverlayContext()\n+  const { setPanel, setSelectedIndex } = usePanelRouterContext()\n+  const updateAllPanelPositions = useUpdateAllPanelPositions()\n+\n+  const [hideShortcut, setHideShortcut] = useHideShortcutStorage()\n+\n+  return (\n+    <div\n+      style={{\n+        padding: '20px',\n+        paddingTop: '8px',\n+      }}\n+    >\n+      <UserPreferencesBody\n+        position={state.devToolsPosition}\n+        scale={state.scale}\n+        setScale={(scale) => {\n+          dispatch({\n+            type: ACTION_DEVTOOLS_SCALE,\n+            scale,\n+          })\n+        }}\n+        setPosition={(devToolsPosition) => {\n+          dispatch({\n+            type: ACTION_DEVTOOLS_POSITION,\n+            devToolsPosition,\n+          })\n+          updateAllPanelPositions(devToolsPosition)\n+        }}\n+        hideShortcut={hideShortcut}\n+        setHideShortcut={setHideShortcut}\n+        hide={() => {\n+          dispatch({\n+            type: ACTION_DEV_INDICATOR_SET,\n+            disabled: true,\n+          })\n+          setSelectedIndex(-1)\n+          setPanel(null)\n+          fetch('/__nextjs_disable_dev_indicator', {\n+            method: 'POST',\n+          })\n+        }}\n+      />\n+    </div>\n+  )\n+}\n+\n+export const usePanelContext = () => useContext(PanelContext)\n+export const PanelContext = createContext<{\n+  name: PanelStateKind\n+  mounted: boolean\n+}>(null!)\n+// this router can be enhanced by Activity and ViewTransition trivially when we want to use them\n+function PanelRoute({\n+  children,\n+  name,\n+}: {\n+  children: React.ReactNode\n+  name: PanelStateKind\n+}) {\n+  const { panel } = usePanelRouterContext()\n+  const { mounted, rendered } = useDelayedRender(name === panel, {\n+    enterDelay: 0,\n+    exitDelay: MENU_DURATION_MS,\n+  })\n+\n+  if (!mounted) return null\n+\n+  return (\n+    <PanelContext\n+      value={{\n+        name,\n+        mounted,\n+      }}\n+    >\n+      <div\n+        id=\"panel-route\"\n+        style={{\n+          opacity: rendered ? 1 : 0,\n+          transition: `opacity ${MENU_DURATION_MS}ms ${MENU_CURVE}`,\n+        }}\n+      >\n+        {children}\n+      </div>\n+    </PanelContext>\n+  )\n+}"
        },
        {
            "sha": "fe6ed3cd2834e66b5df6f7d27c6da27377e90a59",
            "filename": "packages/next/src/next-devtools/dev-overlay/panel/dynamic-panel.tsx",
            "status": "added",
            "additions": 358,
            "deletions": 0,
            "changes": 358,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,358 @@\n+import { useMemo, useRef, useState, useEffect, type CSSProperties } from 'react'\n+import { useDevOverlayContext } from '../../dev-overlay.browser'\n+import { INDICATOR_PADDING } from '../components/devtools-indicator/devtools-indicator'\n+import { ResizeHandle } from '../components/devtools-panel/resize/resize-handle'\n+import { ResizeProvider } from '../components/devtools-panel/resize/resize-provider'\n+import {\n+  DragHandle,\n+  DragProvider,\n+} from '../components/errors/dev-tools-indicator/drag-context'\n+import { Draggable } from '../components/errors/dev-tools-indicator/draggable'\n+import { useClickOutsideAndEscape } from '../components/errors/dev-tools-indicator/utils'\n+import { usePanelRouterContext } from '../menu/context'\n+import { usePanelContext } from '../menu/panel-router'\n+import {\n+  ACTION_DEVTOOLS_PANEL_POSITION,\n+  STORAGE_KEY_PANEL_POSITION_PREFIX,\n+  STORE_KEY_PANEL_SIZE_PREFIX,\n+  STORE_KEY_SHARED_PANEL_LOCATION,\n+  STORE_KEY_SHARED_PANEL_SIZE,\n+} from '../shared'\n+import { getIndicatorOffset } from '../utils/indicator-metrics'\n+\n+function resolveCSSValue(\n+  value: string | number,\n+  dimension: 'width' | 'height' = 'width'\n+): number {\n+  if (typeof value === 'number') return value\n+\n+  // kinda hacky, might be a better way to do this\n+  const temp = document.createElement('div')\n+  temp.style.position = 'absolute'\n+  temp.style.visibility = 'hidden'\n+  if (dimension === 'width') {\n+    temp.style.width = value\n+  } else {\n+    temp.style.height = value\n+  }\n+  document.body.appendChild(temp)\n+  const pixels = dimension === 'width' ? temp.offsetWidth : temp.offsetHeight\n+  document.body.removeChild(temp)\n+  return pixels\n+}\n+\n+function useResolvedDimensions(\n+  minWidth?: string | number,\n+  minHeight?: string | number,\n+  maxWidth?: string | number,\n+  maxHeight?: string | number\n+) {\n+  const [dimensions, setDimensions] = useState(() => ({\n+    minWidth: minWidth ? resolveCSSValue(minWidth, 'width') : undefined,\n+    minHeight: minHeight ? resolveCSSValue(minHeight, 'height') : undefined,\n+    maxWidth: maxWidth ? resolveCSSValue(maxWidth, 'width') : undefined,\n+    maxHeight: maxHeight ? resolveCSSValue(maxHeight, 'height') : undefined,\n+  }))\n+\n+  useEffect(() => {\n+    const updateDimensions = () => {\n+      setDimensions({\n+        minWidth: minWidth ? resolveCSSValue(minWidth, 'width') : undefined,\n+        minHeight: minHeight ? resolveCSSValue(minHeight, 'height') : undefined,\n+        maxWidth: maxWidth ? resolveCSSValue(maxWidth, 'width') : undefined,\n+        maxHeight: maxHeight ? resolveCSSValue(maxHeight, 'height') : undefined,\n+      })\n+    }\n+\n+    window.addEventListener('resize', updateDimensions)\n+    return () => window.removeEventListener('resize', updateDimensions)\n+  }, [minWidth, minHeight, maxWidth, maxHeight])\n+\n+  return dimensions\n+}\n+\n+function getStoredPanelSize(panelName?: string) {\n+  const key = panelName\n+    ? `${STORE_KEY_PANEL_SIZE_PREFIX}_${panelName}`\n+    : STORE_KEY_SHARED_PANEL_SIZE\n+  const defaultSize = { width: 450, height: 350 }\n+  try {\n+    const stored = JSON.parse(localStorage.getItem(key) ?? 'null')\n+    if (!stored) {\n+      return defaultSize\n+    }\n+    if (\n+      typeof stored === 'object' &&\n+      'height' in stored &&\n+      'width' in stored &&\n+      typeof stored.height === 'number' &&\n+      typeof stored.width === 'number'\n+    ) {\n+      return {\n+        width: stored.width as number,\n+        height: stored.height as number,\n+      }\n+    }\n+    return null\n+  } catch {\n+    return null\n+  }\n+}\n+\n+export function DynamicPanel({\n+  header,\n+  children,\n+  draggable = false,\n+  sizeConfig = {\n+    kind: 'resizable',\n+    minWidth: 400,\n+    minHeight: 350,\n+    maxWidth: 1000,\n+    maxHeight: 1000,\n+    initialSize: {\n+      height: 400,\n+      width: 500,\n+    },\n+  },\n+  closeOnClickOutside = false,\n+  sharePanelSizeGlobally = true,\n+  sharePanelPositionGlobally = true,\n+  containerProps,\n+}: {\n+  header: React.ReactNode\n+  children: React.ReactNode\n+  draggable?: boolean\n+  sharePanelSizeGlobally?: boolean\n+  sharePanelPositionGlobally?: boolean\n+  containerProps?: React.HTMLProps<HTMLDivElement>\n+  sizeConfig?:\n+    | {\n+        kind: 'resizable'\n+        minWidth: string | number\n+        minHeight: string | number\n+        maxWidth: string | number\n+        maxHeight: string | number\n+        initialSize: { height: number; width: number }\n+        sides?: Array<'horizontal' | 'vertical' | 'diagonal'>\n+      }\n+    | {\n+        kind: 'fixed'\n+        height: number\n+        width: number\n+      }\n+  closeOnClickOutside?: boolean\n+}) {\n+  const { setPanel } = usePanelRouterContext()\n+  const { name, mounted } = usePanelContext()\n+  const resizeStorageKey = sharePanelSizeGlobally\n+    ? STORE_KEY_SHARED_PANEL_SIZE\n+    : `${STORE_KEY_PANEL_SIZE_PREFIX}_${name}`\n+\n+  const positionStorageKey = sharePanelPositionGlobally\n+    ? STORE_KEY_SHARED_PANEL_LOCATION\n+    : `${STORAGE_KEY_PANEL_POSITION_PREFIX}_${name}`\n+\n+  const { dispatch, state } = useDevOverlayContext()\n+  const devtoolsPanelPosition =\n+    state.devToolsPanelPosition[positionStorageKey] ?? state.devToolsPosition\n+  const [panelVertical, panelHorizontal] = devtoolsPanelPosition.split('-', 2)\n+  const resizeContainerRef = useRef<HTMLDivElement>(null)\n+  const { triggerRef } = usePanelRouterContext()\n+\n+  useClickOutsideAndEscape(\n+    resizeContainerRef,\n+    triggerRef,\n+    mounted,\n+    (reason) => {\n+      switch (reason) {\n+        case 'escape': {\n+          setPanel('panel-selector')\n+          return\n+        }\n+        case 'outside': {\n+          if (closeOnClickOutside) {\n+            setPanel('panel-selector')\n+          }\n+          return\n+        }\n+        default: {\n+          return null!\n+        }\n+      }\n+    }\n+  )\n+\n+  const indicatorOffset = getIndicatorOffset(state)\n+\n+  const [indicatorVertical, indicatorHorizontal] = state.devToolsPosition.split(\n+    '-',\n+    2\n+  )\n+\n+  const verticalOffset =\n+    panelVertical === indicatorVertical &&\n+    panelHorizontal === indicatorHorizontal\n+      ? indicatorOffset\n+      : INDICATOR_PADDING\n+\n+  const positionStyle = {\n+    [panelVertical]: `${verticalOffset}px`,\n+    [panelHorizontal]: `${INDICATOR_PADDING}px`,\n+    [panelVertical === 'top' ? 'bottom' : 'top']: 'auto',\n+    [panelHorizontal === 'left' ? 'right' : 'left']: 'auto',\n+  } as CSSProperties\n+\n+  const isResizable = sizeConfig.kind === 'resizable'\n+\n+  const resolvedDimensions = useResolvedDimensions(\n+    isResizable ? sizeConfig.minWidth : undefined,\n+    isResizable ? sizeConfig.minHeight : undefined,\n+    isResizable ? sizeConfig.maxWidth : undefined,\n+    isResizable ? sizeConfig.maxHeight : undefined\n+  )\n+\n+  const minWidth = resolvedDimensions.minWidth\n+  const minHeight = resolvedDimensions.minHeight\n+  const maxWidth = resolvedDimensions.maxWidth\n+  const maxHeight = resolvedDimensions.maxHeight\n+\n+  const panelSize = useMemo(() => getStoredPanelSize(name), [name])\n+\n+  return (\n+    <ResizeProvider\n+      value={{\n+        resizeRef: resizeContainerRef,\n+        initialSize:\n+          sizeConfig.kind === 'resizable' ? sizeConfig.initialSize : sizeConfig,\n+        minWidth,\n+        minHeight,\n+        maxWidth,\n+        maxHeight,\n+        devToolsPosition: state.devToolsPosition,\n+        storageKey: resizeStorageKey,\n+      }}\n+    >\n+      <div\n+        tabIndex={-1}\n+        ref={resizeContainerRef}\n+        style={{\n+          position: 'fixed',\n+          zIndex: 2147483646,\n+          outline: 'none',\n+          ...positionStyle,\n+          ...(isResizable\n+            ? {\n+                minWidth,\n+                minHeight,\n+                maxWidth,\n+                maxHeight,\n+              }\n+            : {\n+                height: panelSize ? panelSize.height : sizeConfig.height,\n+                width: panelSize ? panelSize.width : sizeConfig.width,\n+              }),\n+        }}\n+      >\n+        <DragProvider disabled={!draggable}>\n+          <Draggable\n+            dragHandleSelector=\".resize-container\"\n+            avoidZone={{\n+              corner: state.devToolsPosition,\n+              square: 25 / state.scale,\n+              padding: INDICATOR_PADDING,\n+            }}\n+            padding={INDICATOR_PADDING}\n+            position={devtoolsPanelPosition}\n+            setPosition={(p) => {\n+              if (sizeConfig.kind === 'resizable') {\n+                localStorage.setItem(positionStorageKey, p)\n+              }\n+              dispatch({\n+                type: ACTION_DEVTOOLS_PANEL_POSITION,\n+                devToolsPanelPosition: p,\n+                key: positionStorageKey,\n+              })\n+            }}\n+            style={{\n+              overflow: 'auto',\n+              width: '100%',\n+              height: '100%',\n+            }}\n+            disableDrag={!draggable}\n+          >\n+            <>\n+              <div\n+                {...containerProps}\n+                style={{\n+                  position: 'relative',\n+                  width: '100%',\n+                  height: '100%',\n+                  border: '1px solid var(--color-gray-alpha-400)',\n+                  borderRadius: 'var(--rounded-xl)',\n+                  background: 'var(--color-background-100)',\n+                  display: 'flex',\n+                  flexDirection: 'column',\n+                  ...containerProps?.style,\n+                }}\n+              >\n+                <DragHandle>{header}</DragHandle>\n+                <div style={{ flex: 1, overflow: 'auto' }}>{children}</div>\n+              </div>\n+              {isResizable && (\n+                <>\n+                  {(!sizeConfig.sides ||\n+                    sizeConfig.sides.includes('vertical')) && (\n+                    <>\n+                      <ResizeHandle\n+                        position={devtoolsPanelPosition}\n+                        direction=\"top\"\n+                      />\n+                      <ResizeHandle\n+                        position={devtoolsPanelPosition}\n+                        direction=\"bottom\"\n+                      />\n+                    </>\n+                  )}\n+                  {(!sizeConfig.sides ||\n+                    sizeConfig.sides.includes('horizontal')) && (\n+                    <>\n+                      <ResizeHandle\n+                        position={devtoolsPanelPosition}\n+                        direction=\"right\"\n+                      />\n+                      <ResizeHandle\n+                        position={devtoolsPanelPosition}\n+                        direction=\"left\"\n+                      />\n+                    </>\n+                  )}\n+                  {(!sizeConfig.sides ||\n+                    sizeConfig.sides.includes('diagonal')) && (\n+                    <>\n+                      <ResizeHandle\n+                        position={devtoolsPanelPosition}\n+                        direction=\"top-left\"\n+                      />\n+                      <ResizeHandle\n+                        position={devtoolsPanelPosition}\n+                        direction=\"top-right\"\n+                      />\n+                      <ResizeHandle\n+                        position={devtoolsPanelPosition}\n+                        direction=\"bottom-left\"\n+                      />\n+                      <ResizeHandle\n+                        position={devtoolsPanelPosition}\n+                        direction=\"bottom-right\"\n+                      />\n+                    </>\n+                  )}\n+                </>\n+              )}\n+            </>\n+          </Draggable>\n+        </DragProvider>\n+      </div>\n+    </ResizeProvider>\n+  )\n+}"
        },
        {
            "sha": "9648c7196a408756072c23918c3da7255d5b8b5d",
            "filename": "packages/next/src/next-devtools/dev-overlay/shared.ts",
            "status": "modified",
            "additions": 79,
            "deletions": 25,
            "changes": 104,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -47,11 +47,12 @@ export interface OverlayState {\n    *  which is viewing the \"Issues Tab\" as a fullscreen.\n    */\n   isErrorOverlayOpen: boolean\n-  isDevToolsPanelOpen: boolean\n   devToolsPosition: Corners\n+  devToolsPanelPosition: Record<DevtoolsPanelName, Corners>\n   scale: number\n   page: string\n }\n+type DevtoolsPanelName = string\n export type OverlayDispatch = React.Dispatch<DispatcherEvent>\n \n export const ACTION_STATIC_INDICATOR = 'static-indicator'\n@@ -64,6 +65,7 @@ export const ACTION_UNHANDLED_ERROR = 'unhandled-error'\n export const ACTION_UNHANDLED_REJECTION = 'unhandled-rejection'\n export const ACTION_DEBUG_INFO = 'debug-info'\n export const ACTION_DEV_INDICATOR = 'dev-indicator'\n+export const ACTION_DEV_INDICATOR_SET = 'dev-indicator-disable'\n \n export const ACTION_ERROR_OVERLAY_OPEN = 'error-overlay-open'\n export const ACTION_ERROR_OVERLAY_CLOSE = 'error-overlay-close'\n@@ -79,11 +81,20 @@ export const ACTION_DEVTOOLS_PANEL_CLOSE = 'devtools-panel-close'\n export const ACTION_DEVTOOLS_PANEL_TOGGLE = 'devtools-panel-toggle'\n \n export const ACTION_DEVTOOLS_POSITION = 'devtools-position'\n+export const ACTION_DEVTOOLS_PANEL_POSITION = 'devtools-panel-position'\n+export const ACTION_DEVTOOLS_PANEL_SIZE = 'devtools-panel-size'\n export const ACTION_DEVTOOLS_SCALE = 'devtools-scale'\n export const ACTION_RESTART_SERVER_BUTTON = 'restart-server-button'\n \n export const STORAGE_KEY_THEME = '__nextjs-dev-tools-theme'\n export const STORAGE_KEY_POSITION = '__nextjs-dev-tools-position'\n+export const STORAGE_KEY_PANEL_POSITION_PREFIX =\n+  '__nextjs-dev-tools-panel-position'\n+export const STORE_KEY_PANEL_SIZE_PREFIX = '__nextjs-dev-tools-panel-size'\n+export const STORE_KEY_SHARED_PANEL_SIZE =\n+  '__nextjs-dev-tools-shared-panel-size'\n+export const STORE_KEY_SHARED_PANEL_LOCATION =\n+  '__nextjs-dev-tools-shared-panel-location'\n export const STORAGE_KEY_SCALE = '__nextjs-dev-tools-scale'\n export const STORAGE_KEY_ACTIVE_TAB = '__nextjs-devtools-active-tab'\n \n@@ -133,6 +144,11 @@ interface DevIndicatorAction {\n   devIndicator: DevIndicatorServerState\n }\n \n+interface DevIndicatorSetAction {\n+  type: typeof ACTION_DEV_INDICATOR_SET\n+  disabled: boolean\n+}\n+\n export interface ErrorOverlayOpenAction {\n   type: typeof ACTION_ERROR_OVERLAY_OPEN\n }\n@@ -157,21 +173,17 @@ export interface RenderingIndicatorHideAction {\n   type: typeof ACTION_RENDERING_INDICATOR_HIDE\n }\n \n-export interface DevToolsPanelOpenAction {\n-  type: typeof ACTION_DEVTOOLS_PANEL_OPEN\n-}\n-export interface DevToolsPanelCloseAction {\n-  type: typeof ACTION_DEVTOOLS_PANEL_CLOSE\n-}\n-export interface DevToolsPanelToggleAction {\n-  type: typeof ACTION_DEVTOOLS_PANEL_TOGGLE\n-}\n-\n export interface DevToolsIndicatorPositionAction {\n   type: typeof ACTION_DEVTOOLS_POSITION\n   devToolsPosition: Corners\n }\n \n+export interface DevToolsPanelPositionAction {\n+  type: typeof ACTION_DEVTOOLS_PANEL_POSITION\n+  key: string\n+  devToolsPanelPosition: Corners\n+}\n+\n export interface DevToolsScaleAction {\n   type: typeof ACTION_DEVTOOLS_SCALE\n   scale: number\n@@ -205,13 +217,12 @@ export type DispatcherEvent =\n   | BuildingIndicatorHideAction\n   | RenderingIndicatorShowAction\n   | RenderingIndicatorHideAction\n-  | DevToolsPanelOpenAction\n-  | DevToolsPanelCloseAction\n-  | DevToolsPanelToggleAction\n   | DevToolsIndicatorPositionAction\n+  | DevToolsPanelPositionAction\n   | DevToolsScaleAction\n   | DevToolUpdateRouteStateAction\n   | RestartServerButtonAction\n+  | DevIndicatorSetAction\n \n const REACT_ERROR_STACK_BOTTOM_FRAME_REGEX =\n   // 1st group: new frame + v8\n@@ -231,6 +242,41 @@ function getStackIgnoringStrictMode(stack: string | undefined) {\n const shouldDisableDevIndicator =\n   process.env.__NEXT_DEV_INDICATOR?.toString() === 'false'\n \n+// TODO: change local storage impl\n+function getStoredPosition(): Corners {\n+  if (typeof localStorage === 'undefined') {\n+    return 'bottom-left' as const\n+  }\n+  const stored = localStorage.getItem(STORAGE_KEY_POSITION)\n+  if (\n+    stored &&\n+    ['top-left', 'top-right', 'bottom-left', 'bottom-right'].includes(stored)\n+  ) {\n+    return stored as Corners\n+  } else {\n+    localStorage.removeItem(STORAGE_KEY_POSITION)\n+  }\n+\n+  // we give priority to local storage over next.config\n+  return (process.env.__NEXT_DEV_INDICATOR_POSITION ?? 'bottom-left') as Corners\n+}\n+\n+export function getStoredPanelPosition() {\n+  if (typeof localStorage === 'undefined') {\n+    return 'bottom-left' as const\n+  }\n+  const stored = localStorage.getItem(STORE_KEY_SHARED_PANEL_LOCATION)\n+  if (\n+    stored &&\n+    ['top-left', 'top-right', 'bottom-left', 'bottom-right'].includes(stored)\n+  ) {\n+    return stored as Corners\n+  } else {\n+    localStorage.removeItem(STORE_KEY_SHARED_PANEL_LOCATION)\n+  }\n+  return 'bottom-left' as const\n+}\n+\n export const INITIAL_OVERLAY_STATE: Omit<\n   OverlayState,\n   'isErrorOverlayOpen' | 'routerType'\n@@ -252,9 +298,12 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   refreshState: { type: 'idle' },\n   versionInfo: { installed: '0.0.0', staleness: 'unknown' },\n   debugInfo: { devtoolsFrontendUrl: undefined },\n-  isDevToolsPanelOpen: false,\n   showRestartServerButton: false,\n-  devToolsPosition: 'bottom-left',\n+  devToolsPosition: getStoredPosition(),\n+  devToolsPanelPosition: {\n+    [STORE_KEY_SHARED_PANEL_LOCATION]: getStoredPanelPosition(),\n+  },\n+\n   scale: NEXT_DEV_TOOLS_SCALE.Medium,\n   page: '',\n }\n@@ -390,6 +439,9 @@ export function useErrorOverlayReducer(\n         case ACTION_VERSION_INFO: {\n           return { ...state, versionInfo: action.versionInfo }\n         }\n+        case ACTION_DEV_INDICATOR_SET: {\n+          return { ...state, disableDevIndicator: action.disabled }\n+        }\n         case ACTION_DEV_INDICATOR: {\n           return {\n             ...state,\n@@ -419,18 +471,20 @@ export function useErrorOverlayReducer(\n         case ACTION_RENDERING_INDICATOR_HIDE: {\n           return { ...state, renderingIndicator: false }\n         }\n-        case ACTION_DEVTOOLS_PANEL_OPEN: {\n-          return { ...state, isDevToolsPanelOpen: true }\n-        }\n-        case ACTION_DEVTOOLS_PANEL_CLOSE: {\n-          return { ...state, isDevToolsPanelOpen: false }\n-        }\n-        case ACTION_DEVTOOLS_PANEL_TOGGLE: {\n-          return { ...state, isDevToolsPanelOpen: !state.isDevToolsPanelOpen }\n-        }\n+\n         case ACTION_DEVTOOLS_POSITION: {\n           return { ...state, devToolsPosition: action.devToolsPosition }\n         }\n+        case ACTION_DEVTOOLS_PANEL_POSITION: {\n+          return {\n+            ...state,\n+            devToolsPanelPosition: {\n+              ...state.devToolsPanelPosition,\n+              [action.key]: action.devToolsPanelPosition,\n+            },\n+          }\n+        }\n+\n         case ACTION_DEVTOOLS_SCALE: {\n           return { ...state, scale: action.scale }\n         }"
        },
        {
            "sha": "6e5e2e056902e7031493994e34e3ff8031b3eb56",
            "filename": "packages/next/src/next-devtools/dev-overlay/storybook/DevOverlayStoryWrapper.tsx",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2FDevOverlayStoryWrapper.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2FDevOverlayStoryWrapper.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2FDevOverlayStoryWrapper.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,34 @@\n+import { DevOverlay } from '../dev-overlay'\n+import { DevOverlayContext } from '../../dev-overlay.browser'\n+import {\n+  useStorybookOverlayReducer,\n+  storybookDefaultOverlayState,\n+} from './use-overlay-reducer'\n+import type { OverlayState } from '../shared'\n+import type { ReadyRuntimeError } from '../utils/get-error-by-type'\n+\n+type WrapperProps = {\n+  initialState?: Partial<OverlayState>\n+  runtimeErrors?: ReadyRuntimeError[]\n+  children?: never\n+}\n+// todo: wrap stories in this so props are configurable\n+export function DevOverlayStoryWrapper({ initialState }: WrapperProps) {\n+  const mergedState: OverlayState = {\n+    ...storybookDefaultOverlayState,\n+    ...initialState,\n+  } as OverlayState\n+\n+  const [state, dispatch] = useStorybookOverlayReducer(mergedState)\n+  return (\n+    <DevOverlayContext\n+      value={{ state, dispatch, getSquashedHydrationErrorDetails: () => null }}\n+    >\n+      <DevOverlay\n+        state={state}\n+        dispatch={dispatch}\n+        getSquashedHydrationErrorDetails={() => null}\n+      />\n+    </DevOverlayContext>\n+  )\n+}"
        },
        {
            "sha": "c3e4c4c027cff06f99a4b9b5890e32d215e6b203",
            "filename": "packages/next/src/next-devtools/dev-overlay/storybook/use-overlay-reducer.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 13,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -9,10 +9,9 @@ import {\n   ACTION_BUILDING_INDICATOR_SHOW,\n   ACTION_DEBUG_INFO,\n   ACTION_DEV_INDICATOR,\n+  ACTION_DEV_INDICATOR_SET,\n   ACTION_DEVTOOL_UPDATE_ROUTE_STATE,\n-  ACTION_DEVTOOLS_PANEL_CLOSE,\n-  ACTION_DEVTOOLS_PANEL_OPEN,\n-  ACTION_DEVTOOLS_PANEL_TOGGLE,\n+  ACTION_DEVTOOLS_PANEL_POSITION,\n   ACTION_DEVTOOLS_POSITION,\n   ACTION_DEVTOOLS_SCALE,\n   ACTION_ERROR_OVERLAY_CLOSE,\n@@ -32,7 +31,7 @@ import {\n export const storybookDefaultOverlayState: OverlayState = {\n   ...INITIAL_OVERLAY_STATE,\n   routerType: 'app',\n-  isErrorOverlayOpen: true,\n+  isErrorOverlayOpen: false,\n   showIndicator: true,\n   versionInfo: {\n     installed: '15.4.0',\n@@ -53,21 +52,24 @@ export function useStorybookOverlayReducer(initialState?: OverlayState) {\n         case ACTION_ERROR_OVERLAY_TOGGLE: {\n           return { ...state, isErrorOverlayOpen: !state.isErrorOverlayOpen }\n         }\n-        case ACTION_DEVTOOLS_PANEL_TOGGLE: {\n-          return { ...state, isDevToolsPanelOpen: !state.isDevToolsPanelOpen }\n-        }\n-        case ACTION_DEVTOOLS_PANEL_CLOSE: {\n-          return { ...state, isDevToolsPanelOpen: false }\n-        }\n-        case ACTION_DEVTOOLS_PANEL_OPEN: {\n-          return { ...state, isDevToolsPanelOpen: true }\n-        }\n         case ACTION_DEVTOOLS_POSITION: {\n           return { ...state, devToolsPosition: action.devToolsPosition }\n         }\n+        case ACTION_DEVTOOLS_PANEL_POSITION: {\n+          return {\n+            ...state,\n+            devToolsPanelPosition: {\n+              ...state.devToolsPanelPosition,\n+              [action.key]: action.devToolsPanelPosition,\n+            },\n+          }\n+        }\n         case ACTION_DEVTOOLS_SCALE: {\n           return { ...state, scale: action.scale }\n         }\n+        case ACTION_DEV_INDICATOR_SET: {\n+          return { ...state, showIndicator: !action.disabled }\n+        }\n         case ACTION_BEFORE_REFRESH:\n         case ACTION_BUILD_ERROR:\n         case ACTION_BUILD_OK:"
        },
        {
            "sha": "5da9845603d2d86f28561a49dce7b4de9f7dfd43",
            "filename": "packages/next/src/next-devtools/dev-overlay/styles/component-styles.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fcomponent-styles.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -22,21 +22,10 @@ import { DEV_TOOLS_INFO_ROUTE_INFO_STYLES } from '../components/errors/dev-tools\n import { DEV_TOOLS_INFO_USER_PREFERENCES_STYLES } from '../components/errors/dev-tools-indicator/dev-tools-info/user-preferences'\n import { FADER_STYLES } from '../components/fader'\n import { RESTART_SERVER_BUTTON_STYLES } from '../components/errors/error-overlay-toolbar/restart-server-button'\n-import { DEVTOOLS_PANEL_STYLES } from '../components/devtools-panel/devtools-panel'\n-import { DEVTOOLS_PANEL_FOOTER_STYLES } from '../components/devtools-panel/devtools-panel-footer'\n-import { DEVTOOLS_PANEL_VERSION_INFO_STYLES } from '../components/devtools-panel/devtools-panel-version-info'\n-import { DEVTOOLS_PANEL_TAB_SETTINGS_STYLES } from '../components/devtools-panel/devtools-panel-tab/settings-tab'\n import { CALL_STACK_STYLES } from '../components/call-stack/call-stack'\n-import { DEVTOOLS_PANEL_TAB_ISSUES_STYLES } from '../components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab'\n-import { DEVTOOLS_PANEL_TAB_ISSUES_SIDEBAR_STYLES } from '../components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-sidebar'\n-import { DEVTOOLS_PANEL_TAB_ISSUES_SIDEBAR_FRAME_SKELETON_STYLES } from '../components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-sidebar-frame-skeleton'\n-import { DEVTOOLS_PANEL_TAB_ISSUES_CONTENT_STYLES } from '../components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-content'\n import { ISSUE_FEEDBACK_BUTTON_STYLES } from '../components/errors/error-overlay-toolbar/issue-feedback-button'\n import { ERROR_CONTENT_SKELETON_STYLES } from '../container/runtime-error/error-content-skeleton'\n-import { DEVTOOLS_PANEL_TAB_ISSUES_CONTENT_LAYOUT_STYLES } from '../components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-content-layout'\n-import { DEVTOOLS_PANEL_TAB_ISSUES_EMPTY_CONTENT_STYLES } from '../components/devtools-panel/devtools-panel-tab/issues-tab/issues-tab-empty-content'\n import { SHORTCUT_RECORDER_STYLES } from '../components/errors/dev-tools-indicator/dev-tools-info/shortcut-recorder'\n-\n export function ComponentStyles() {\n   return (\n     <style>\n@@ -65,16 +54,6 @@ export function ComponentStyles() {\n         ${DEV_TOOLS_INFO_ROUTE_INFO_STYLES}\n         ${DEV_TOOLS_INFO_USER_PREFERENCES_STYLES}\n         ${FADER_STYLES}\n-        ${DEVTOOLS_PANEL_STYLES}\n-        ${DEVTOOLS_PANEL_FOOTER_STYLES}\n-        ${DEVTOOLS_PANEL_VERSION_INFO_STYLES}\n-        ${DEVTOOLS_PANEL_TAB_SETTINGS_STYLES}\n-        ${DEVTOOLS_PANEL_TAB_ISSUES_STYLES}\n-        ${DEVTOOLS_PANEL_TAB_ISSUES_EMPTY_CONTENT_STYLES}\n-        ${DEVTOOLS_PANEL_TAB_ISSUES_SIDEBAR_STYLES}\n-        ${DEVTOOLS_PANEL_TAB_ISSUES_SIDEBAR_FRAME_SKELETON_STYLES}\n-        ${DEVTOOLS_PANEL_TAB_ISSUES_CONTENT_STYLES}\n-        ${DEVTOOLS_PANEL_TAB_ISSUES_CONTENT_LAYOUT_STYLES}\n         ${ISSUE_FEEDBACK_BUTTON_STYLES}\n         ${ERROR_CONTENT_SKELETON_STYLES}\n         ${SHORTCUT_RECORDER_STYLES}"
        },
        {
            "sha": "750981621ea1fd8ca6f518916eddd2045c1a2714",
            "filename": "packages/next/src/next-devtools/dev-overlay/utils/indicator-metrics.ts",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Futils%2Findicator-metrics.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Futils%2Findicator-metrics.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Futils%2Findicator-metrics.ts?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,13 @@\n+import { INDICATOR_PADDING } from '../components/devtools-indicator/devtools-indicator'\n+import type { OverlayState } from '../shared'\n+\n+export const BASE_LOGO_SIZE = 36\n+const INDICATOR_GAP = 9\n+\n+export function getIndicatorSquare(state: OverlayState): number {\n+  return BASE_LOGO_SIZE / state.scale\n+}\n+\n+export function getIndicatorOffset(state: OverlayState): number {\n+  return INDICATOR_PADDING + getIndicatorSquare(state) + INDICATOR_GAP\n+}"
        },
        {
            "sha": "4965832f2c9b0605eaa189b7c7fb11124d24e48a",
            "filename": "test/e2e/app-dir/detachable-panels/app/favicon.ico",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Ffavicon.ico",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Ffavicon.ico",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Ffavicon.ico?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d"
        },
        {
            "sha": "062a0c12bae90a99b5fca560e3234f42c8f98e73",
            "filename": "test/e2e/app-dir/detachable-panels/app/layout.tsx",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Flayout.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,14 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body\n+        style={{\n+          backgroundColor: 'black',\n+          color: 'white',\n+        }}\n+      >\n+        {children}\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "30ef4c17a7c85fe6d118b908ac96f240a61bc1d4",
            "filename": "test/e2e/app-dir/detachable-panels/app/loading.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Floading.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Floading.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Floading.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Loading() {\n+  return <p>Loading...</p>\n+}"
        },
        {
            "sha": "38a5cec73a22b198f8ed755a97a86f6b497364d5",
            "filename": "test/e2e/app-dir/detachable-panels/app/page.tsx",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fapp%2Fpage.tsx?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,6 @@\n+import { headers } from 'next/headers'\n+export default async function PostPage() {\n+  const headersList = await headers()\n+\n+  return <div className=\"\">{JSON.stringify(headersList)}</div>\n+}"
        },
        {
            "sha": "51d0b4cd82c1f1a19c735748f3a4d7081047e2f3",
            "filename": "test/e2e/app-dir/detachable-panels/next.config.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/e54a837ebaad5c8f08291dc5f202e74e2886a57d/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdetachable-panels%2Fnext.config.js?ref=e54a837ebaad5c8f08291dc5f202e74e2886a57d",
            "patch": "@@ -0,0 +1,10 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    devtoolNewPanelUI: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        }
    ],
    "stats": {
        "total": 4487,
        "additions": 2134,
        "deletions": 2353
    }
}