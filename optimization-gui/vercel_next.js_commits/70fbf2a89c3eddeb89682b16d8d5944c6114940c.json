{
    "author": "ztanner",
    "message": "[dev-overlay]: disabling dev indicator should only show errors (#76178)\n\n- If you explicitly disable the indicator, we should only show error\r\nfeedback, and not the popover\r\n- It shouldn't be possible to close the issue count as we're not going\r\nto render the normal indicator\r\n\r\n## Before\r\n![CleanShot 2025-02-18 at 16 29\r\n12@2x](https://github.com/user-attachments/assets/879f7e48-36a0-47f0-999b-1b9748b448b6)\r\n\r\n## After\r\n![CleanShot 2025-02-18 at 16 28\r\n52@2x](https://github.com/user-attachments/assets/7eccbfa7-9f15-45f2-9581-414b1e28f466)\r\n\r\nCloses NDX-853",
    "sha": "70fbf2a89c3eddeb89682b16d8d5944c6114940c",
    "files": [
        {
            "sha": "99ae149fb5294f397089f00138bbd94e48c34f52",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/app/react-dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Fapp%2Freact-dev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Fapp%2Freact-dev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Fapp%2Freact-dev-overlay.stories.tsx?ref=70fbf2a89c3eddeb89682b16d8d5944c6114940c",
            "patch": "@@ -20,6 +20,7 @@ type Story = StoryObj<typeof ReactDevOverlay>\n const state: OverlayState = {\n   nextId: 0,\n   buildError: null,\n+  disableDevIndicator: false,\n   errors: [\n     {\n       id: 1,"
        },
        {
            "sha": "7aa82691b39e9c1b08e98a21674c65c4ee679c36",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/dev-tools-indicator/dev-tools-indicator.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx?ref=70fbf2a89c3eddeb89682b16d8d5944c6114940c",
            "patch": "@@ -55,6 +55,7 @@ const state: OverlayState = {\n   buildError: null,\n   errors: [],\n   refreshState: { type: 'idle' },\n+  disableDevIndicator: false,\n   rootLayoutMissingTags: [],\n   versionInfo: mockVersionInfo,\n   notFound: false,"
        },
        {
            "sha": "74dca45089969787263d2373496fcbd3a399f4d3",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/dev-tools-indicator/dev-tools-indicator.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.tsx?ref=70fbf2a89c3eddeb89682b16d8d5944c6114940c",
            "patch": "@@ -44,6 +44,7 @@ export function DevToolsIndicator({\n         setIsErrorOverlayOpen={setIsErrorOverlayOpen}\n         isTurbopack={!!process.env.TURBOPACK}\n         position={position}\n+        disabled={state.disableDevIndicator}\n       />\n     )\n   )\n@@ -63,13 +64,15 @@ interface C {\n const Context = createContext({} as C)\n \n function DevToolsPopover({\n+  disabled,\n   issueCount,\n   isStaticRoute,\n   isTurbopack,\n   position,\n   hide,\n   setIsErrorOverlayOpen,\n }: {\n+  disabled: boolean\n   issueCount: number\n   isStaticRoute: boolean\n   semver: string | undefined\n@@ -210,6 +213,7 @@ function DevToolsPopover({\n         aria-controls=\"nextjs-dev-tools-menu\"\n         aria-label={`${isMenuOpen ? 'Close' : 'Open'} Next.js Dev Tools`}\n         data-nextjs-dev-tools-button\n+        disabled={disabled}\n         issueCount={issueCount}\n         onTriggerClick={onTriggerClick}\n         onKeyDown={onTriggerKeydown}"
        },
        {
            "sha": "a21959c8255251e2e5f40a6807da0a8cc2608587",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/dev-tools-indicator/internal/next-logo.tsx",
            "status": "modified",
            "additions": 59,
            "deletions": 21,
            "changes": 80,
            "blob_url": "https://github.com/vercel/next.js/blob/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Finternal%2Fnext-logo.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Finternal%2Fnext-logo.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Finternal%2Fnext-logo.tsx?ref=70fbf2a89c3eddeb89682b16d8d5944c6114940c",
            "patch": "@@ -58,6 +58,7 @@ const useAnimated = <T,>(\n \n export const NextLogo = forwardRef(function NextLogo(\n   {\n+    disabled,\n     issueCount,\n     isDevBuilding,\n     isDevRendering,\n@@ -93,6 +94,8 @@ export const NextLogo = forwardRef(function NextLogo(\n         {\n           '--size': `${SIZE}px`,\n           '--duration-short': `${SHORT_DURATION_MS}ms`,\n+          // if the indicator is disabled and there are no errors, hide the badge\n+          display: disabled && !hasError ? 'none' : 'block',\n         } as React.CSSProperties\n       }\n     >\n@@ -118,6 +121,13 @@ export const NextLogo = forwardRef(function NextLogo(\n             }\n           }\n \n+          [data-disabled-icon] {\n+            display: flex;\n+            align-items: center;\n+            justify-content: center;\n+            padding-right: 4px;\n+          }\n+\n           [data-next-badge] {\n             -webkit-font-smoothing: antialiased;\n             width: var(--size);\n@@ -214,7 +224,7 @@ export const NextLogo = forwardRef(function NextLogo(\n             gap: var(--padding);\n             align-items: center;\n             padding-left: 8px;\n-            padding-right: calc(var(--padding) * 2);\n+            padding-right: ${disabled ? '8px' : 'calc(var(--padding) * 2)'};\n             height: 32px;\n             margin: 0 var(--padding);\n             border-radius: 9999px;\n@@ -412,22 +422,29 @@ export const NextLogo = forwardRef(function NextLogo(\n       >\n         <div ref={ref}>\n           {/* Children */}\n-          <button\n-            ref={mergeRefs(triggerRef, propRef)}\n-            data-next-mark\n-            data-next-mark-loading={isLoading}\n-            onClick={onTriggerClick}\n-            {...props}\n-          >\n-            <NextMark isLoading={isLoading} />\n-          </button>\n+          {!disabled && (\n+            <button\n+              ref={mergeRefs(triggerRef, propRef)}\n+              data-next-mark\n+              data-next-mark-loading={isLoading}\n+              onClick={onTriggerClick}\n+              {...props}\n+            >\n+              <NextMark isLoading={isLoading} />\n+            </button>\n+          )}\n           {isErrorExpanded && (\n             <div data-issues>\n               <button\n                 data-issues-open\n                 aria-label=\"Open issues overlay\"\n                 onClick={openErrorOverlay}\n               >\n+                {disabled && (\n+                  <div data-disabled-icon>\n+                    <Warning />\n+                  </div>\n+                )}\n                 <AnimateCount\n                   // Used the key to force a re-render when the count changes.\n                   key={issueCount}\n@@ -445,17 +462,19 @@ export const NextLogo = forwardRef(function NextLogo(\n                   )}\n                 </div>\n               </button>\n-              <button\n-                data-issues-collapse\n-                aria-label=\"Collapse issues badge\"\n-                onClick={() => {\n-                  setIsErrorExpanded(false)\n-                  // Move focus to the trigger to prevent having it stuck on this element\n-                  triggerRef.current?.focus()\n-                }}\n-              >\n-                <Cross data-cross />\n-              </button>\n+              {!disabled && (\n+                <button\n+                  data-issues-collapse\n+                  aria-label=\"Collapse issues badge\"\n+                  onClick={() => {\n+                    setIsErrorExpanded(false)\n+                    // Move focus to the trigger to prevent having it stuck on this element\n+                    triggerRef.current?.focus()\n+                  }}\n+                >\n+                  <Cross data-cross />\n+                </button>\n+              )}\n             </div>\n           )}\n         </div>\n@@ -569,6 +588,25 @@ function NextMark({ isLoading }: { isLoading?: boolean }) {\n   )\n }\n \n+function Warning() {\n+  return (\n+    <svg\n+      width=\"12\"\n+      height=\"12\"\n+      viewBox=\"0 0 12 12\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+    >\n+      <path\n+        fillRule=\"evenodd\"\n+        clipRule=\"evenodd\"\n+        d=\"M3.98071 1.125L1.125 3.98071L1.125 8.01929L3.98071 10.875H8.01929L10.875 8.01929V3.98071L8.01929 1.125H3.98071ZM3.82538 0C3.62647 0 3.4357 0.0790176 3.29505 0.21967L0.21967 3.29505C0.0790176 3.4357 0 3.62647 0 3.82538V8.17462C0 8.37353 0.0790178 8.5643 0.21967 8.70495L3.29505 11.7803C3.4357 11.921 3.62647 12 3.82538 12H8.17462C8.37353 12 8.5643 11.921 8.70495 11.7803L11.7803 8.70495C11.921 8.5643 12 8.37353 12 8.17462V3.82538C12 3.62647 11.921 3.4357 11.7803 3.29505L8.70495 0.21967C8.5643 0.0790177 8.37353 0 8.17462 0H3.82538ZM6.5625 2.8125V3.375V6V6.5625H5.4375V6V3.375V2.8125H6.5625ZM6 9C6.41421 9 6.75 8.66421 6.75 8.25C6.75 7.83579 6.41421 7.5 6 7.5C5.58579 7.5 5.25 7.83579 5.25 8.25C5.25 8.66421 5.58579 9 6 9Z\"\n+        fill=\"#EAEAEA\"\n+      />\n+    </svg>\n+  )\n+}\n+\n export function Cross(props: React.SVGProps<SVGSVGElement>) {\n   return (\n     <svg"
        },
        {
            "sha": "ff21ba63ca6c28a1494fa5cd57c6ab8e280f3352",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/container/runtime-error/render-error.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 9,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcontainer%2Fruntime-error%2Frender-error.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcontainer%2Fruntime-error%2Frender-error.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcontainer%2Fruntime-error%2Frender-error.tsx?ref=70fbf2a89c3eddeb89682b16d8d5944c6114940c",
            "patch": "@@ -109,17 +109,8 @@ const RenderRuntimeError = ({ children, state, isAppDir }: Props) => {\n     }\n   }, [nextError, isAppDir])\n \n-  // Stringify since __NEXT_DEV_INDICATOR can be set to boolean false.\n-  const hasDisabledDevIndicator =\n-    process.env.__NEXT_DEV_INDICATOR?.toString() === 'false'\n   const totalErrorCount = readyErrors.length\n \n-  // Even if the dev indicator is disabled, we should show it\n-  // along with the error overlay when there are errors.\n-  if (hasDisabledDevIndicator && !totalErrorCount) {\n-    return null\n-  }\n-\n   return children({ readyErrors, totalErrorCount })\n }\n "
        },
        {
            "sha": "1f45d3f5abd2d0ae5768712a9fa8503846a48b1b",
            "filename": "packages/next/src/client/components/react-dev-overlay/shared.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/70fbf2a89c3eddeb89682b16d8d5944c6114940c/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fshared.ts?ref=70fbf2a89c3eddeb89682b16d8d5944c6114940c",
            "patch": "@@ -21,6 +21,7 @@ export interface OverlayState {\n   versionInfo: VersionInfo\n   notFound: boolean\n   staticIndicator: boolean\n+  disableDevIndicator: boolean\n   debugInfo: DebugInfo\n }\n \n@@ -106,6 +107,7 @@ export const INITIAL_OVERLAY_STATE: OverlayState = {\n   errors: [],\n   notFound: false,\n   staticIndicator: false,\n+  disableDevIndicator: process.env.__NEXT_DEV_INDICATOR?.toString() === 'false',\n   refreshState: { type: 'idle' },\n   rootLayoutMissingTags: [],\n   versionInfo: { installed: '0.0.0', staleness: 'unknown' },"
        }
    ],
    "stats": {
        "total": 97,
        "additions": 67,
        "deletions": 30
    }
}