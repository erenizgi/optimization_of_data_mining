{
    "author": "lubieowoce",
    "message": "compile-time error for useLinkStatus imports in server components (#77962)\n\nAdds `useLinkStatus` to the list of APIs that can't be imported in\nserver components.",
    "sha": "c0b7f72bb9c8ca7ba6a890f788befd2de9693c7f",
    "files": [
        {
            "sha": "86db7ad4ca6c6b6f90398eebc6b807835a54e936",
            "filename": "crates/next-custom-transforms/src/transforms/react_server_components.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c0b7f72bb9c8ca7ba6a890f788befd2de9693c7f/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c0b7f72bb9c8ca7ba6a890f788befd2de9693c7f/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs?ref=c0b7f72bb9c8ca7ba6a890f788befd2de9693c7f",
            "patch": "@@ -626,6 +626,7 @@ impl ReactServerComponentValidator {\n                         \"ServerInsertedHTMLContext\",\n                     ],\n                 ),\n+                (\"next/link\", vec![\"useLinkStatus\"]),\n             ]),\n             deprecated_apis_mapping: FxHashMap::from_iter([(\"next/server\", vec![\"ImageResponse\"])]),\n "
        },
        {
            "sha": "e45743f0523daf40533d7d609b5e0cff9c43e6f7",
            "filename": "test/development/acceptance-app/server-components.test.ts",
            "status": "modified",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/c0b7f72bb9c8ca7ba6a890f788befd2de9693c7f/test%2Fdevelopment%2Facceptance-app%2Fserver-components.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c0b7f72bb9c8ca7ba6a890f788befd2de9693c7f/test%2Fdevelopment%2Facceptance-app%2Fserver-components.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fserver-components.test.ts?ref=c0b7f72bb9c8ca7ba6a890f788befd2de9693c7f",
            "patch": "@@ -532,4 +532,37 @@ describe('Error Overlay for server components', () => {\n       )\n     })\n   })\n+\n+  describe('Next.js link client hooks called in Server Component', () => {\n+    it.each([['useLinkStatus']])(\n+      'should show error when %s is called',\n+      async (hook: string) => {\n+        await using sandbox = await createSandbox(\n+          next,\n+          new Map([\n+            [\n+              'app/page.js',\n+              outdent`\n+              import { ${hook} } from 'next/link'\n+              export default function Page() {\n+                return \"Hello world\"\n+              }\n+            `,\n+            ],\n+          ])\n+        )\n+        const { session } = sandbox\n+        await session.assertHasRedbox()\n+        // In webpack when the message too long it gets truncated with `  | ` with new lines.\n+        // So we need to check for the first part of the message.\n+        const normalizedSource = await session.getRedboxSource()\n+        expect(normalizedSource).toContain(\n+          `You're importing a component that needs \\`${hook}\\`. This React hook only works in a client component. To fix, mark the file (or its parent) with the \\`\"use client\"\\` directive.`\n+        )\n+        expect(normalizedSource).toContain(\n+          `import { ${hook} } from 'next/link'`\n+        )\n+      }\n+    )\n+  })\n })"
        }
    ],
    "stats": {
        "total": 34,
        "additions": 34,
        "deletions": 0
    }
}