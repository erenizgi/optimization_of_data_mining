{
    "author": "lukesandberg",
    "message": "Deterministically order pages in the `MappedPages`  structure (#86744)\n\nBecause this object was aggregated during an async function the order of keys would be non-deterministic which could lead to non-determinism elsewhere",
    "sha": "1cedd6688f1fb21a4c189eb6e1bc455190b05554",
    "files": [
        {
            "sha": "5235b85b7dbbc0be2c686f3511033267aae55441",
            "filename": "packages/next/src/build/entries.ts",
            "status": "modified",
            "additions": 49,
            "deletions": 44,
            "changes": 93,
            "blob_url": "https://github.com/vercel/next.js/blob/1cedd6688f1fb21a4c189eb6e1bc455190b05554/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1cedd6688f1fb21a4c189eb6e1bc455190b05554/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fentries.ts?ref=1cedd6688f1fb21a4c189eb6e1bc455190b05554",
            "patch": "@@ -461,60 +461,65 @@ export async function createPagesMapping({\n   appDirOnly: boolean\n }): Promise<MappedPages> {\n   const isAppRoute = pagesType === 'app'\n-  const pages: MappedPages = {}\n-  const promises = pagePaths.map<Promise<void>>(async (pagePath) => {\n-    // Do not process .d.ts files as routes\n-    if (pagePath.endsWith('.d.ts') && pageExtensions.includes('ts')) {\n-      return\n-    }\n \n-    let pageKey = getPageFromPath(pagePath, pageExtensions)\n-    if (isAppRoute) {\n-      pageKey = pageKey.replace(/%5F/g, '_')\n-      if (pageKey === UNDERSCORE_NOT_FOUND_ROUTE) {\n-        pageKey = UNDERSCORE_NOT_FOUND_ROUTE_ENTRY\n+  const promises = pagePaths.map<Promise<[string, string] | undefined>>(\n+    async (pagePath) => {\n+      // Do not process .d.ts files as routes\n+      if (pagePath.endsWith('.d.ts') && pageExtensions.includes('ts')) {\n+        return\n       }\n-      if (pageKey === UNDERSCORE_GLOBAL_ERROR_ROUTE) {\n-        pageKey = UNDERSCORE_GLOBAL_ERROR_ROUTE_ENTRY\n+\n+      let pageKey = getPageFromPath(pagePath, pageExtensions)\n+      if (isAppRoute) {\n+        pageKey = pageKey.replace(/%5F/g, '_')\n+        if (pageKey === UNDERSCORE_NOT_FOUND_ROUTE) {\n+          pageKey = UNDERSCORE_NOT_FOUND_ROUTE_ENTRY\n+        }\n+        if (pageKey === UNDERSCORE_GLOBAL_ERROR_ROUTE) {\n+          pageKey = UNDERSCORE_GLOBAL_ERROR_ROUTE_ENTRY\n+        }\n       }\n-    }\n \n-    const normalizedPath = normalizePathSep(\n-      join(\n-        pagesType === 'pages'\n-          ? PAGES_DIR_ALIAS\n-          : pagesType === 'app'\n-            ? APP_DIR_ALIAS\n-            : ROOT_DIR_ALIAS,\n-        pagePath\n+      const normalizedPath = normalizePathSep(\n+        join(\n+          pagesType === 'pages'\n+            ? PAGES_DIR_ALIAS\n+            : pagesType === 'app'\n+              ? APP_DIR_ALIAS\n+              : ROOT_DIR_ALIAS,\n+          pagePath\n+        )\n       )\n-    )\n \n-    let route = pagesType === 'app' ? normalizeMetadataRoute(pageKey) : pageKey\n+      let route =\n+        pagesType === 'app' ? normalizeMetadataRoute(pageKey) : pageKey\n \n-    if (\n-      pagesType === 'app' &&\n-      isMetadataRouteFile(pagePath, pageExtensions, true)\n-    ) {\n-      const filePath = join(appDir!, pagePath)\n-      const staticInfo = await getPageStaticInfo({\n-        nextConfig: {},\n-        pageFilePath: filePath,\n-        isDev,\n-        page: pageKey,\n-        pageType: pagesType,\n-      })\n+      if (\n+        pagesType === 'app' &&\n+        isMetadataRouteFile(pagePath, pageExtensions, true)\n+      ) {\n+        const filePath = join(appDir!, pagePath)\n+        const staticInfo = await getPageStaticInfo({\n+          nextConfig: {},\n+          pageFilePath: filePath,\n+          isDev,\n+          page: pageKey,\n+          pageType: pagesType,\n+        })\n \n-      route = normalizeMetadataPageToRoute(\n-        route,\n-        !!(staticInfo.generateImageMetadata || staticInfo.generateSitemaps)\n-      )\n-    }\n+        route = normalizeMetadataPageToRoute(\n+          route,\n+          !!(staticInfo.generateImageMetadata || staticInfo.generateSitemaps)\n+        )\n+      }\n \n-    pages[route] = normalizedPath\n-  })\n+      return [route, normalizedPath]\n+    }\n+  )\n \n-  await Promise.all(promises)\n+  const pages: MappedPages = Object.fromEntries(\n+    (await Promise.all(promises)).filter((entry) => entry != null)\n+  )\n \n   switch (pagesType) {\n     case PAGE_TYPES.ROOT: {"
        }
    ],
    "stats": {
        "total": 93,
        "additions": 49,
        "deletions": 44
    }
}