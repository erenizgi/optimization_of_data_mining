{
    "author": "bgw",
    "message": "fix(CI): Avoid rebuilding native code in jobs that don't depend on native code (#78944)\n\nThe following jobs do not depend on `build-native`, but don't specify `skipNativeBuild`:\n\n- `lint`\n- `test-devlow`\n- `test-next-swc-wasm`\n- `test-next-swc-napi-wasi` *(currently disabled)*\n- `test-unit` *(does actually appear to depend on native binaries)*\n\nThat means that they still build the native binary, but they don't wait for `build-native` to finish first, so they don't use the cached version (they run before the cache is populated), and instead each spend 5 minutes of CPU time rebuilding the native binary.",
    "sha": "5d85a444c4ee22d7611e20e4adaba324d34d88eb",
    "files": [
        {
            "sha": "3ee4b09685aeffc63d089139e70aa020713e40f0",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/5d85a444c4ee22d7611e20e4adaba324d34d88eb/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/5d85a444c4ee22d7611e20e4adaba324d34d88eb/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=5d85a444c4ee22d7611e20e4adaba324d34d88eb",
            "patch": "@@ -86,6 +86,8 @@ jobs:\n     needs: ['build-next']\n     uses: ./.github/workflows/build_reusable.yml\n     with:\n+      skipNativeBuild: 'yes'\n+      skipNativeInstall: 'yes'\n       afterBuild: |\n         pnpm lint-no-typescript\n         pnpm check-examples\n@@ -213,6 +215,7 @@ jobs:\n     if: ${{ needs.optimize-ci.outputs.skip == 'false' && needs.changes.outputs.docs-only == 'false' }}\n     uses: ./.github/workflows/build_reusable.yml\n     with:\n+      skipNativeBuild: 'yes'\n       stepName: 'test-devlow'\n       afterBuild: |\n         pnpm run --filter=devlow-bench test\n@@ -342,6 +345,8 @@ jobs:\n \n     uses: ./.github/workflows/build_reusable.yml\n     with:\n+      skipNativeBuild: 'yes'\n+      skipNativeInstall: 'yes'\n       afterBuild: |\n         rustup target add wasm32-unknown-unknown\n         curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh\n@@ -371,6 +376,8 @@ jobs:\n \n     uses: ./.github/workflows/build_reusable.yml\n     with:\n+      skipNativeBuild: 'yes'\n+      skipNativeInstall: 'yes'\n       afterBuild: |\n         rustup target add wasm32-wasip1-threads\n         pnpm dlx turbo@${TURBO_VERSION} run build-native-wasi\n@@ -379,7 +386,7 @@ jobs:\n \n   test-unit:\n     name: test unit\n-    needs: ['changes']\n+    needs: ['changes', 'build-next', 'build-native']\n     if: ${{ needs.changes.outputs.docs-only == 'false' }}\n \n     strategy:"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 8,
        "deletions": 1
    }
}