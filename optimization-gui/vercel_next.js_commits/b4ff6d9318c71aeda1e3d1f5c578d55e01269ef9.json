{
    "author": "huozhi",
    "message": "refactor: separate forward browser logs utils (#84151)",
    "sha": "b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
    "files": [
        {
            "sha": "e36d9ebd0610b6ec7c2c537f7ca999c6ce5d9219",
            "filename": "packages/next/src/client/dev/hot-reloader/app/web-socket.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fweb-socket.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fweb-socket.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fweb-socket.ts?ref=b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
            "patch": "@@ -12,10 +12,7 @@ import {\n   processMessage,\n   type StaticIndicatorState,\n } from './hot-reloader-app'\n-import {\n-  isTerminalLoggingEnabled,\n-  logQueue,\n-} from '../../../../next-devtools/userspace/app/forward-logs'\n+import { logQueue } from '../../../../next-devtools/userspace/app/forward-logs'\n import { InvariantError } from '../../../../shared/lib/invariant-error'\n import { WEB_SOCKET_MAX_RECONNECTIONS } from '../../../../lib/constants'\n \n@@ -57,9 +54,7 @@ export function createWebSocket(\n     newWebSocket.binaryType = 'arraybuffer'\n \n     function handleOnline() {\n-      if (isTerminalLoggingEnabled) {\n-        logQueue.onSocketReady(newWebSocket)\n-      }\n+      logQueue.onSocketReady(newWebSocket)\n \n       reconnections = 0\n       window.console.log('[HMR] connected')"
        },
        {
            "sha": "ba021d9cb12c0a1ec14ec9dc93e3b794799782d3",
            "filename": "packages/next/src/client/dev/hot-reloader/pages/websocket.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fwebsocket.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fwebsocket.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fwebsocket.ts?ref=b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
            "patch": "@@ -1,7 +1,4 @@\n-import {\n-  isTerminalLoggingEnabled,\n-  logQueue,\n-} from '../../../../next-devtools/userspace/app/forward-logs'\n+import { logQueue } from '../../../../next-devtools/userspace/app/forward-logs'\n import {\n   HMR_MESSAGE_SENT_TO_BROWSER,\n   type HmrMessageSentToBrowser,\n@@ -35,9 +32,7 @@ export function connectHMR(options: { path: string; assetPrefix: string }) {\n     if (source) source.close()\n \n     function handleOnline() {\n-      if (isTerminalLoggingEnabled) {\n-        logQueue.onSocketReady(source)\n-      }\n+      logQueue.onSocketReady(source)\n       reconnections = 0\n       window.console.log('[HMR] connected')\n     }"
        },
        {
            "sha": "08dfa8a2b57e25388a720843b844aca090a1f24e",
            "filename": "packages/next/src/next-devtools/userspace/app/app-dev-overlay-setup.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 7,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fapp-dev-overlay-setup.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fapp-dev-overlay-setup.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fapp-dev-overlay-setup.ts?ref=b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
            "patch": "@@ -1,13 +1,8 @@\n import { patchConsoleError } from './errors/intercept-console-error'\n import { handleGlobalErrors } from './errors/use-error-handler'\n-import {\n-  initializeDebugLogForwarding,\n-  isTerminalLoggingEnabled,\n-} from './forward-logs'\n+import { initializeDebugLogForwarding } from './forward-logs'\n \n handleGlobalErrors()\n patchConsoleError()\n \n-if (isTerminalLoggingEnabled) {\n-  initializeDebugLogForwarding('app')\n-}\n+initializeDebugLogForwarding('app')"
        },
        {
            "sha": "5d70332b87c9e20ff01eec74f1be9f626b7253ac",
            "filename": "packages/next/src/next-devtools/userspace/app/errors/intercept-console-error.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 4,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fintercept-console-error.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fintercept-console-error.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fintercept-console-error.ts?ref=b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
            "patch": "@@ -2,7 +2,7 @@ import isError from '../../../../lib/is-error'\n import { isNextRouterError } from '../../../../client/components/is-next-router-error'\n import { handleConsoleError } from './use-error-handler'\n import { parseConsoleArgs } from '../../../../client/lib/console'\n-import { forwardErrorLog, isTerminalLoggingEnabled } from '../forward-logs'\n+import { forwardErrorLog } from '../forward-logs'\n \n export const originConsoleError = globalThis.console.error\n \n@@ -37,9 +37,7 @@ export function patchConsoleError() {\n           args\n         )\n       }\n-      if (isTerminalLoggingEnabled) {\n-        forwardErrorLog(args)\n-      }\n+      forwardErrorLog(args)\n \n       originConsoleError.apply(window.console, args)\n     }"
        },
        {
            "sha": "0222f8dbbe7c58e01f301360aded478854915ffb",
            "filename": "packages/next/src/next-devtools/userspace/app/errors/use-error-handler.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 11,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fuse-error-handler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fuse-error-handler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Ferrors%2Fuse-error-handler.ts?ref=b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
            "patch": "@@ -7,11 +7,7 @@ import {\n import isError from '../../../../lib/is-error'\n import { createConsoleError } from '../../../shared/console-error'\n import { coerceError, setOwnerStackIfAvailable } from './stitched-error'\n-import {\n-  forwardUnhandledError,\n-  isTerminalLoggingEnabled,\n-  logUnhandledRejection,\n-} from '../forward-logs'\n+import { forwardUnhandledError, logUnhandledRejection } from '../forward-logs'\n \n const queueMicroTask =\n   globalThis.queueMicrotask || ((cb: () => void) => Promise.resolve().then(cb))\n@@ -100,9 +96,7 @@ function onUnhandledError(event: WindowEventMap['error']): void | boolean {\n     const error = coerceError(thrownValue)\n     setOwnerStackIfAvailable(error)\n     handleClientError(error)\n-    if (isTerminalLoggingEnabled) {\n-      forwardUnhandledError(error)\n-    }\n+    forwardUnhandledError(error)\n   }\n }\n \n@@ -121,9 +115,7 @@ function onUnhandledRejection(ev: WindowEventMap['unhandledrejection']): void {\n     handler(error)\n   }\n \n-  if (isTerminalLoggingEnabled) {\n-    logUnhandledRejection(reason)\n-  }\n+  logUnhandledRejection(reason)\n }\n \n export function handleGlobalErrors() {"
        },
        {
            "sha": "f10ac4b4f6a0c26e20eb75af684ee93dbc318c5b",
            "filename": "packages/next/src/next-devtools/userspace/app/forward-logs-utils.ts",
            "status": "added",
            "additions": 88,
            "deletions": 0,
            "changes": 88,
            "blob_url": "https://github.com/vercel/next.js/blob/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs-utils.ts?ref=b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
            "patch": "@@ -0,0 +1,88 @@\n+import { configure } from 'next/dist/compiled/safe-stable-stringify'\n+import { getTerminalLoggingConfig } from './terminal-logging-config'\n+import { UNDEFINED_MARKER } from '../../shared/forward-logs-shared'\n+\n+const terminalLoggingConfig = getTerminalLoggingConfig()\n+\n+const PROMISE_MARKER = 'Promise {}'\n+const UNAVAILABLE_MARKER = '[Unable to view]'\n+\n+const maximumDepth =\n+  typeof terminalLoggingConfig === 'object' && terminalLoggingConfig.depthLimit\n+    ? terminalLoggingConfig.depthLimit\n+    : 5\n+const maximumBreadth =\n+  typeof terminalLoggingConfig === 'object' && terminalLoggingConfig.edgeLimit\n+    ? terminalLoggingConfig.edgeLimit\n+    : 100\n+\n+const stringify = configure({\n+  maximumDepth,\n+  maximumBreadth,\n+})\n+\n+/**\n+ * allows us to:\n+ * - revive the undefined log in the server as it would look in the browser\n+ * - not read/attempt to serialize promises (next will console error if you do that, and will cause this program to infinitely recurse)\n+ * - if we read a proxy that throws (no way to detect if something is a proxy), explain to the user we can't read this data\n+ */\n+export function preLogSerializationClone<T>(\n+  value: T,\n+  seen = new WeakMap()\n+): any {\n+  if (value === undefined) return UNDEFINED_MARKER\n+  if (value === null || typeof value !== 'object') return value\n+  if (seen.has(value as object)) return seen.get(value as object)\n+\n+  try {\n+    Object.keys(value as object)\n+  } catch {\n+    return UNAVAILABLE_MARKER\n+  }\n+\n+  try {\n+    if (typeof (value as any).then === 'function') return PROMISE_MARKER\n+  } catch {\n+    return UNAVAILABLE_MARKER\n+  }\n+\n+  if (Array.isArray(value)) {\n+    const out: any[] = []\n+    seen.set(value, out)\n+    for (const item of value) {\n+      try {\n+        out.push(preLogSerializationClone(item, seen))\n+      } catch {\n+        out.push(UNAVAILABLE_MARKER)\n+      }\n+    }\n+    return out\n+  }\n+\n+  const proto = Object.getPrototypeOf(value)\n+  if (proto === Object.prototype || proto === null) {\n+    const out: Record<string, unknown> = {}\n+    seen.set(value as object, out)\n+    for (const key of Object.keys(value as object)) {\n+      try {\n+        out[key] = preLogSerializationClone((value as any)[key], seen)\n+      } catch {\n+        out[key] = UNAVAILABLE_MARKER\n+      }\n+    }\n+    return out\n+  }\n+\n+  return Object.prototype.toString.call(value)\n+}\n+\n+// only safe if passed safeClone data\n+export const logStringify = (data: unknown): string => {\n+  try {\n+    const result = stringify(data)\n+    return result ?? `\"${UNAVAILABLE_MARKER}\"`\n+  } catch {\n+    return `\"${UNAVAILABLE_MARKER}\"`\n+  }\n+}"
        },
        {
            "sha": "2d31a9e913b69fcdda3066d180f08592011e579e",
            "filename": "packages/next/src/next-devtools/userspace/app/forward-logs.test.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 15,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.test.ts?ref=b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
            "patch": "@@ -1,10 +1,4 @@\n-import { UNDEFINED_MARKER } from '../../shared/forward-logs-shared'\n-import {\n-  preLogSerializationClone,\n-  PROMISE_MARKER,\n-  UNAVAILABLE_MARKER,\n-  logStringify,\n-} from './forward-logs'\n+import { preLogSerializationClone, logStringify } from './forward-logs-utils'\n \n const safeStringify = (data: unknown) =>\n   logStringify(preLogSerializationClone(data))\n@@ -16,7 +10,9 @@ describe('forward-logs serialization', () => {\n       expect(preLogSerializationClone('hello')).toBe('hello')\n       expect(preLogSerializationClone(true)).toBe(true)\n       expect(preLogSerializationClone(null)).toBe(null)\n-      expect(preLogSerializationClone(undefined)).toBe(UNDEFINED_MARKER)\n+      expect(preLogSerializationClone(undefined)).toBe(\n+        '__next_tagged_undefined'\n+      )\n     })\n \n     it('should handle circular references', () => {\n@@ -29,19 +25,19 @@ describe('forward-logs serialization', () => {\n \n     it('should handle promises', () => {\n       const promise = Promise.resolve(42)\n-      expect(preLogSerializationClone(promise)).toBe(PROMISE_MARKER)\n+      expect(preLogSerializationClone(promise)).toBe('Promise {}')\n     })\n \n     it('should handle arrays', () => {\n       const arr = [1, 'test', undefined, null]\n       const cloned = preLogSerializationClone(arr)\n-      expect(cloned).toEqual([1, 'test', UNDEFINED_MARKER, null])\n+      expect(cloned).toEqual([1, 'test', '__next_tagged_undefined', null])\n     })\n \n     it('should handle plain objects', () => {\n       const obj = { a: 1, b: undefined, c: 'test' }\n       const cloned = preLogSerializationClone(obj)\n-      expect(cloned).toEqual({ a: 1, b: UNDEFINED_MARKER, c: 'test' })\n+      expect(cloned).toEqual({ a: 1, b: '__next_tagged_undefined', c: 'test' })\n     })\n \n     it('should handle objects with getters that throw', () => {\n@@ -54,7 +50,7 @@ describe('forward-logs serialization', () => {\n \n       const cloned = preLogSerializationClone(obj)\n       expect(cloned.normalProp).toBe('works')\n-      expect(cloned.throwingGetter).toBe(UNAVAILABLE_MARKER)\n+      expect(cloned.throwingGetter).toBe('[Unable to view]')\n     })\n \n     it('should handle non-plain objects as toString', () => {\n@@ -80,7 +76,7 @@ describe('forward-logs serialization', () => {\n       const arr = [1, throwingProxy, 'normal']\n       const cloned = preLogSerializationClone(arr)\n \n-      expect(cloned).toEqual([1, UNAVAILABLE_MARKER, 'normal'])\n+      expect(cloned).toEqual([1, '[Unable to view]', 'normal'])\n     })\n   })\n \n@@ -89,7 +85,7 @@ describe('forward-logs serialization', () => {\n       expect(safeStringify(42)).toBe('42')\n       expect(safeStringify('hello')).toBe('\"hello\"')\n       expect(safeStringify(null)).toBe('null')\n-      expect(safeStringify(undefined)).toBe(`\"${UNDEFINED_MARKER}\"`)\n+      expect(safeStringify(undefined)).toBe(`\"__next_tagged_undefined\"`)\n     })\n \n     it('should handle objects with circular references', () => {\n@@ -108,7 +104,7 @@ describe('forward-logs serialization', () => {\n       }\n \n       const result = safeStringify(problematicData)\n-      expect(result).toBe(`\"${UNAVAILABLE_MARKER}\"`)\n+      expect(result).toBe(`\"[Unable to view]\"`)\n     })\n   })\n })"
        },
        {
            "sha": "36a146c903d613cddc973cc7e26279202791ace7",
            "filename": "packages/next/src/next-devtools/userspace/app/forward-logs.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 90,
            "changes": 114,
            "blob_url": "https://github.com/vercel/next.js/blob/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fapp%2Fforward-logs.ts?ref=b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
            "patch": "@@ -1,42 +1,20 @@\n-import { configure } from 'next/dist/compiled/safe-stable-stringify'\n import {\n   getOwnerStack,\n   setOwnerStackIfAvailable,\n } from './errors/stitched-error'\n import { getErrorSource } from '../../../shared/lib/error-source'\n-import {\n-  getTerminalLoggingConfig,\n-  getIsTerminalLoggingEnabled,\n-} from './terminal-logging-config'\n+import { getIsTerminalLoggingEnabled } from './terminal-logging-config'\n import {\n   type ConsoleEntry,\n   type ConsoleErrorEntry,\n   type FormattedErrorEntry,\n   type ClientLogEntry,\n   type LogMethod,\n   patchConsoleMethod,\n-  UNDEFINED_MARKER,\n } from '../../shared/forward-logs-shared'\n+import { preLogSerializationClone, logStringify } from './forward-logs-utils'\n \n-const terminalLoggingConfig = getTerminalLoggingConfig()\n-export const PROMISE_MARKER = 'Promise {}'\n-export const UNAVAILABLE_MARKER = '[Unable to view]'\n-\n-const maximumDepth =\n-  typeof terminalLoggingConfig === 'object' && terminalLoggingConfig.depthLimit\n-    ? terminalLoggingConfig.depthLimit\n-    : 5\n-const maximumBreadth =\n-  typeof terminalLoggingConfig === 'object' && terminalLoggingConfig.edgeLimit\n-    ? terminalLoggingConfig.edgeLimit\n-    : 100\n-\n-const stringify = configure({\n-  maximumDepth,\n-  maximumBreadth,\n-})\n-\n-export const isTerminalLoggingEnabled = getIsTerminalLoggingEnabled()\n+const isTerminalLoggingEnabled = getIsTerminalLoggingEnabled()\n \n const methods: Array<LogMethod> = [\n   'log',\n@@ -52,71 +30,6 @@ const methods: Array<LogMethod> = [\n   'groupEnd',\n   'trace',\n ]\n-/**\n- * allows us to:\n- * - revive the undefined log in the server as it would look in the browser\n- * - not read/attempt to serialize promises (next will console error if you do that, and will cause this program to infinitely recurse)\n- * - if we read a proxy that throws (no way to detect if something is a proxy), explain to the user we can't read this data\n- */\n-export function preLogSerializationClone<T>(\n-  value: T,\n-  seen = new WeakMap()\n-): any {\n-  if (value === undefined) return UNDEFINED_MARKER\n-  if (value === null || typeof value !== 'object') return value\n-  if (seen.has(value as object)) return seen.get(value as object)\n-\n-  try {\n-    Object.keys(value as object)\n-  } catch {\n-    return UNAVAILABLE_MARKER\n-  }\n-\n-  try {\n-    if (typeof (value as any).then === 'function') return PROMISE_MARKER\n-  } catch {\n-    return UNAVAILABLE_MARKER\n-  }\n-\n-  if (Array.isArray(value)) {\n-    const out: any[] = []\n-    seen.set(value, out)\n-    for (const item of value) {\n-      try {\n-        out.push(preLogSerializationClone(item, seen))\n-      } catch {\n-        out.push(UNAVAILABLE_MARKER)\n-      }\n-    }\n-    return out\n-  }\n-\n-  const proto = Object.getPrototypeOf(value)\n-  if (proto === Object.prototype || proto === null) {\n-    const out: Record<string, unknown> = {}\n-    seen.set(value as object, out)\n-    for (const key of Object.keys(value as object)) {\n-      try {\n-        out[key] = preLogSerializationClone((value as any)[key], seen)\n-      } catch {\n-        out[key] = UNAVAILABLE_MARKER\n-      }\n-    }\n-    return out\n-  }\n-\n-  return Object.prototype.toString.call(value)\n-}\n-\n-// only safe if passed safeClone data\n-export const logStringify = (data: unknown): string => {\n-  try {\n-    const result = stringify(data)\n-    return result ?? `\"${UNAVAILABLE_MARKER}\"`\n-  } catch {\n-    return `\"${UNAVAILABLE_MARKER}\"`\n-  }\n-}\n \n const afterThisFrame = (cb: () => void) => {\n   let timeout: ReturnType<typeof setTimeout> | undefined\n@@ -154,6 +67,7 @@ const serializeEntries = (entries: Array<ClientLogEntry>) =>\n     }\n   })\n \n+// Combined state and public API\n export const logQueue: {\n   entries: Array<ClientLogEntry>\n   onSocketReady: (socket: WebSocket) => void\n@@ -208,6 +122,10 @@ export const logQueue: {\n     })\n   },\n   onSocketReady: (socket: WebSocket) => {\n+    if (!isTerminalLoggingEnabled) {\n+      return\n+    }\n+\n     if (socket.readyState !== WebSocket.OPEN) {\n       // invariant\n       return\n@@ -286,6 +204,10 @@ const createLogEntry = (level: LogMethod, args: any[]) => {\n }\n \n export const forwardErrorLog = (args: any[]) => {\n+  if (!isTerminalLoggingEnabled) {\n+    return\n+  }\n+\n   const errorObjects = args.filter((arg) => arg instanceof Error)\n   const first = errorObjects.at(0)\n   if (first) {\n@@ -345,6 +267,10 @@ const stackWithOwners = (error: Error) => {\n }\n \n export function logUnhandledRejection(reason: unknown) {\n+  if (!isTerminalLoggingEnabled) {\n+    return\n+  }\n+\n   if (reason instanceof Error) {\n     createUnhandledRejectionErrorEntry(reason, stackWithOwners(reason))\n     return\n@@ -429,11 +355,19 @@ const isIgnoredLog = (args: any[]) => {\n }\n \n export function forwardUnhandledError(error: Error) {\n+  if (!isTerminalLoggingEnabled) {\n+    return\n+  }\n+\n   createUncaughtErrorEntry(error.name, error.message, stackWithOwners(error))\n }\n \n // TODO: this router check is brittle, we need to update based on the current router the user is using\n export const initializeDebugLogForwarding = (router: 'app' | 'pages'): void => {\n+  if (!isTerminalLoggingEnabled) {\n+    return\n+  }\n+\n   // probably don't need this\n   if (isPatched) {\n     return"
        },
        {
            "sha": "411caace596728f9aa5a3fda83ebc2be399776e1",
            "filename": "packages/next/src/next-devtools/userspace/pages/pages-dev-overlay-setup.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 11,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fpages%2Fpages-dev-overlay-setup.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fpages%2Fpages-dev-overlay-setup.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fuserspace%2Fpages%2Fpages-dev-overlay-setup.tsx?ref=b4ff6d9318c71aeda1e3d1f5c578d55e01269ef9",
            "patch": "@@ -15,7 +15,6 @@ import {\n   forwardUnhandledError,\n   logUnhandledRejection,\n   forwardErrorLog,\n-  isTerminalLoggingEnabled,\n } from '../app/forward-logs'\n \n const usePagesDevOverlayBridge = () => {\n@@ -82,17 +81,15 @@ function nextJsHandleConsoleError(...args: any[]) {\n   storeHydrationErrorStateFromConsoleArgs(...args)\n   // TODO: Surfaces non-errors logged via `console.error`.\n   handleError(maybeError)\n-  if (isTerminalLoggingEnabled) {\n-    forwardErrorLog(args)\n-  }\n+  forwardErrorLog(args)\n   origConsoleError.apply(window.console, args)\n }\n \n function onUnhandledError(event: ErrorEvent) {\n   const error = event?.error\n   handleError(error)\n \n-  if (error && isTerminalLoggingEnabled) {\n+  if (error) {\n     forwardUnhandledError(error as Error)\n   }\n }\n@@ -109,9 +106,7 @@ function onUnhandledRejection(ev: PromiseRejectionEvent) {\n   }\n \n   dispatcher.onUnhandledRejection(reason)\n-  if (isTerminalLoggingEnabled) {\n-    logUnhandledRejection(reason)\n-  }\n+  logUnhandledRejection(reason)\n }\n \n export function register() {\n@@ -124,9 +119,7 @@ export function register() {\n     Error.stackTraceLimit = 50\n   } catch {}\n \n-  if (isTerminalLoggingEnabled) {\n-    initializeDebugLogForwarding('pages')\n-  }\n+  initializeDebugLogForwarding('pages')\n   window.addEventListener('error', onUnhandledError)\n   window.addEventListener('unhandledrejection', onUnhandledRejection)\n   window.console.error = nextJsHandleConsoleError"
        }
    ],
    "stats": {
        "total": 290,
        "additions": 138,
        "deletions": 152
    }
}