{
    "author": "ztanner",
    "message": "docs: remove inaccuracies from use cache: private (#85425)\n\nThere are a lot of things in here that aren't quite fully fleshed out\nyet (eg runtime prefetching) as well as some inaccuracies (eg `use\ncache: private` is not required for runtime prefetching, it's just\nanother thing that _can_ be runtime prefetched).\n\nThis trims the doc down until we can focus on proper guidance.",
    "sha": "b55e52f1bdc70fa00664b322fe691edc06801e71",
    "files": [
        {
            "sha": "b83dd3890310944cf837e2f92e8bb69a38fb3c2d",
            "filename": "docs/01-app/03-api-reference/01-directives/use-cache-private.mdx",
            "status": "modified",
            "additions": 6,
            "deletions": 243,
            "changes": 249,
            "blob_url": "https://github.com/vercel/next.js/blob/b55e52f1bdc70fa00664b322fe691edc06801e71/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache-private.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/b55e52f1bdc70fa00664b322fe691edc06801e71/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache-private.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache-private.mdx?ref=b55e52f1bdc70fa00664b322fe691edc06801e71",
            "patch": "@@ -12,9 +12,9 @@ related:\n     - app/guides/prefetching\n ---\n \n-The `'use cache: private'` directive enables runtime prefetching of personalized content that depends on cookies, headers, or search params.\n+The `'use cache: private'` directive works just like [`use cache`](/docs/app/api-reference/directives/use-cache), but allows you to use runtime APIs like cookies, headers, or search params.\n \n-> **Good to know:** `'use cache: private'` is a variant of [`use cache`](/docs/app/api-reference/directives/use-cache) designed specifically for user-specific content that needs to be prefetchable but should never be stored in server-side cache handlers.\n+> **Good to know:** Unlike `use cache`, private caches are not prerendered statically as they contain personalized data that is not shared between users.\n \n ## Usage\n \n@@ -39,7 +39,7 @@ const nextConfig = {\n export default nextConfig\n ```\n \n-Then add `'use cache: private'` to your function along with a `cacheLife` configuration and export `unstable_prefetch` from your page.\n+Then add `'use cache: private'` to your function along with a `cacheLife` configuration.\n \n ### Basic example\n \n@@ -48,14 +48,6 @@ import { Suspense } from 'react'\n import { cookies } from 'next/headers'\n import { cacheLife, cacheTag } from 'next/cache'\n \n-// REQUIRED: Enable runtime prefetching\n-export const unstable_prefetch = {\n-  mode: 'runtime',\n-  samples: [\n-    { params: { id: '1' }, cookies: [{ name: 'session-id', value: '1' }] },\n-  ],\n-}\n-\n export default async function ProductPage({\n   params,\n }: {\n@@ -102,14 +94,6 @@ import { Suspense } from 'react'\n import { cookies } from 'next/headers'\n import { cacheLife, cacheTag } from 'next/cache'\n \n-// REQUIRED: Enable runtime prefetching\n-export const unstable_prefetch = {\n-  mode: 'runtime',\n-  samples: [\n-    { params: { id: '1' }, cookies: [{ name: 'session-id', value: '1' }] },\n-  ],\n-}\n-\n export default async function ProductPage({ params }) {\n   const { id } = await params\n \n@@ -147,64 +131,6 @@ async function getRecommendations(productId) {\n }\n ```\n \n-> **Note:** Private caches require a `cacheLife` stale time of at least 30 seconds to enable runtime prefetching. Values below 30 seconds are treated as dynamic.\n-\n-## Difference from `use cache`\n-\n-While regular `use cache` is designed for static, shared content that can be cached on the server, `'use cache: private'` is specifically for dynamic, user-specific content that needs to be:\n-\n-1. **Personalized** - varies based on cookies, headers, or search params\n-2. **Prefetchable** - can be loaded before the user navigates to the page\n-3. **Client-only** - never persisted to server-side cache handlers\n-\n-| Feature                            | `use cache`            | `'use cache: private'`              |\n-| ---------------------------------- | ---------------------- | ----------------------------------- |\n-| **Access to `await cookies()`**    | No                     | Yes                                 |\n-| **Access to `await headers()`**    | No                     | Yes                                 |\n-| **Access to `await searchParams`** | No                     | Yes                                 |\n-| **Stored in cache handler**        | Yes (server-side)      | No (client-side only)               |\n-| **Runtime prefetchable**           | N/A (already static)   | Yes (when configured)               |\n-| **Cache scope**                    | Global (shared)        | Per-user (isolated)                 |\n-| **Use case**                       | Static, shared content | Personalized, user-specific content |\n-\n-## How it works\n-\n-### Runtime prefetching\n-\n-When a user hovers over or views a link to a page with `unstable_prefetch = { mode: 'runtime' }`:\n-\n-1. **Static content** is prefetched immediately (layouts, page shell)\n-2. **Private cache functions** are executed with the user's current cookies/headers\n-3. **Results are stored** in the client-side Resume Data Cache\n-4. **Navigation is instant** - both static and personalized content are already loaded\n-\n-> **Good to know:** Without `'use cache: private'`, personalized content cannot be prefetched and must wait until after navigation completes. Runtime prefetching eliminates this delay by executing cache functions with the user's current request context.\n-\n-### Storage behavior\n-\n-Private caches are **never persisted** to server-side cache handlers (like Redis, Vercel Data Cache, etc.). They exist only to:\n-\n-1. Enable runtime prefetching of personalized content\n-2. Store prefetched data in the client-side cache during the session\n-3. Coordinate cache invalidation with tags and stale times\n-\n-This ensures user-specific data is never accidentally shared between users while still enabling fast, prefetched navigation.\n-\n-### Stale time requirements\n-\n-> **Note:** Functions with a `cacheLife` stale time less than 30 seconds will not be runtime prefetched, even when using `'use cache: private'`. This prevents prefetching of rapidly changing data that would likely be stale by navigation time.\n-\n-```tsx\n-// Will be runtime prefetched (stale ≥ 30s)\n-cacheLife({ stale: 60 })\n-\n-// Will be runtime prefetched (stale ≥ 30s)\n-cacheLife({ stale: 30 })\n-\n-// Will NOT be runtime prefetched (stale < 30s)\n-cacheLife({ stale: 10 })\n-```\n-\n ## Request APIs allowed in private caches\n \n The following request-specific APIs can be used inside `'use cache: private'` functions:\n@@ -218,171 +144,8 @@ The following request-specific APIs can be used inside `'use cache: private'` fu\n \n > **Note:** The [`connection()`](https://nextjs.org/docs/app/api-reference/functions/connection) API is prohibited in both `use cache` and `'use cache: private'` as it provides connection-specific information that cannot be safely cached.\n \n-## Nesting rules\n-\n-Private caches have specific nesting rules to prevent user-specific data from leaking into shared caches:\n-\n-- Private caches **can** be nested inside other private caches\n-- Private caches **cannot** be nested inside public caches (`'use cache'`, `'use cache: remote'`)\n-- Public caches **can** be nested inside private caches\n-\n-```tsx\n-// VALID: Private inside private\n-async function outerPrivate() {\n-  'use cache: private'\n-  const result = await innerPrivate()\n-  return result\n-}\n-\n-async function innerPrivate() {\n-  'use cache: private'\n-  return getData()\n-}\n-\n-// INVALID: Private inside public\n-async function outerPublic() {\n-  'use cache'\n-  const result = await innerPrivate() // Error!\n-  return result\n-}\n-\n-async function innerPrivate() {\n-  'use cache: private'\n-  return getData()\n-}\n-```\n-\n-## Examples\n-\n-### Personalized product recommendations\n-\n-This example shows how to cache personalized product recommendations based on a user's session cookie. The recommendations are prefetched at runtime when the user hovers over product links.\n-\n-```tsx filename=\"app/product/[id]/page.tsx\"\n-import { cookies } from 'next/headers'\n-import { cacheLife, cacheTag } from 'next/cache'\n-\n-export const unstable_prefetch = {\n-  mode: 'runtime',\n-  samples: [\n-    { params: { id: '1' }, cookies: [{ name: 'user-id', value: 'user-123' }] },\n-  ],\n-}\n-\n-async function getRecommendations(productId: string) {\n-  'use cache: private'\n-  cacheTag(`recommendations-${productId}`)\n-  cacheLife({ stale: 60 })\n-\n-  const userId = (await cookies()).get('user-id')?.value\n-\n-  // Fetch personalized recommendations based on user's browsing history\n-  const recommendations = await db.recommendations.findMany({\n-    where: { userId, productId },\n-  })\n-\n-  return recommendations\n-}\n-```\n-\n-### User-specific pricing\n-\n-Cache pricing information that varies by user tier, allowing instant navigation to the pricing page with personalized rates already loaded.\n-\n-```tsx filename=\"app/pricing/page.tsx\"\n-import { cookies } from 'next/headers'\n-import { cacheLife } from 'next/cache'\n-\n-export const unstable_prefetch = {\n-  mode: 'runtime',\n-  samples: [{ cookies: [{ name: 'user-tier', value: 'premium' }] }],\n-}\n-\n-async function getPricing() {\n-  'use cache: private'\n-  cacheLife({ stale: 300 }) // 5 minutes\n-\n-  const tier = (await cookies()).get('user-tier')?.value || 'free'\n-\n-  // Return tier-specific pricing\n-  return db.pricing.findMany({ where: { tier } })\n-}\n-```\n-\n-### Localized content based on headers\n-\n-Serve localized content based on the user's `Accept-Language` header, prefetching the correct language variant before navigation.\n-\n-```tsx filename=\"app/page.tsx\"\n-import { headers } from 'next/headers'\n-import { cacheLife, cacheTag } from 'next/cache'\n-\n-export const unstable_prefetch = {\n-  mode: 'runtime',\n-  samples: [{ headers: [{ name: 'accept-language', value: 'en-US' }] }],\n-}\n-\n-async function getLocalizedContent() {\n-  'use cache: private'\n-  cacheTag('content')\n-  cacheLife({ stale: 3600 }) // 1 hour\n-\n-  const headersList = await headers()\n-  const locale = headersList.get('accept-language')?.split(',')[0] || 'en-US'\n-\n-  return db.content.findMany({ where: { locale } })\n-}\n-```\n-\n-### Search results with user preferences\n-\n-Prefetch search results that include user-specific preferences, ensuring personalized search results load instantly.\n-\n-```tsx filename=\"app/search/page.tsx\"\n-import { cookies } from 'next/headers'\n-import { cacheLife } from 'next/cache'\n-\n-export const unstable_prefetch = {\n-  mode: 'runtime',\n-  samples: [\n-    {\n-      searchParams: { q: 'laptop' },\n-      cookies: [{ name: 'preferences', value: 'compact-view' }],\n-    },\n-  ],\n-}\n-\n-async function getSearchResults(query: string) {\n-  'use cache: private'\n-  cacheLife({ stale: 120 }) // 2 minutes\n-\n-  const preferences = (await cookies()).get('preferences')?.value\n-\n-  // Apply user preferences to search results\n-  return searchWithPreferences(query, preferences)\n-}\n-```\n-\n-> **Good to know**:\n->\n-> - Private caches are ephemeral and only exist in the client-side cache for the session duration\n-> - Private cache results are never written to server-side cache handlers\n-> - The `unstable_prefetch` export is required for runtime prefetching to work\n-> - A minimum stale time of 30 seconds is required for private caches to be prefetched\n-> - You can use `cacheTag()` and `revalidateTag()` to invalidate private caches\n-> - Each user gets their own private cache entries based on their cookies/headers\n-\n-## Platform Support\n-\n-| Deployment Option                                                   | Supported |\n-| ------------------------------------------------------------------- | --------- |\n-| [Node.js server](/docs/app/getting-started/deploying#nodejs-server) | Yes       |\n-| [Docker container](/docs/app/getting-started/deploying#docker)      | Yes       |\n-| [Static export](/docs/app/getting-started/deploying#static-export)  | No        |\n-| [Adapters](/docs/app/getting-started/deploying#adapters)            | Yes       |\n-\n ## Version History\n \n-| Version   | Changes                                                       |\n-| --------- | ------------------------------------------------------------- |\n-| `v16.0.0` | `'use cache: private'` introduced as an experimental feature. |\n+| Version   | Changes                                                              |\n+| --------- | -------------------------------------------------------------------- |\n+| `v16.0.0` | `\"use cache: private\"` is enabled with the Cache Components feature. |"
        },
        {
            "sha": "34c1ea5500a106140f07fc4561c8abd8f2257c4c",
            "filename": "docs/01-app/03-api-reference/01-directives/use-cache-remote.mdx",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/b55e52f1bdc70fa00664b322fe691edc06801e71/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache-remote.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/b55e52f1bdc70fa00664b322fe691edc06801e71/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache-remote.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F01-directives%2Fuse-cache-remote.mdx?ref=b55e52f1bdc70fa00664b322fe691edc06801e71",
            "patch": "@@ -554,6 +554,6 @@ function RecommendationsList({ items }) {\n \n ## Version History\n \n-| Version   | Changes                                                      |\n-| --------- | ------------------------------------------------------------ |\n-| `v16.0.0` | `'use cache: remote'` introduced as an experimental feature. |\n+| Version   | Changes                                                             |\n+| --------- | ------------------------------------------------------------------- |\n+| `v16.0.0` | `\"use cache: remote\"` is enabled with the Cache Components feature. |"
        }
    ],
    "stats": {
        "total": 255,
        "additions": 9,
        "deletions": 246
    }
}