{
    "author": "acdlite",
    "message": "Remove Segment from CacheNodeSeedData (#85080)\n\nWe don't need to send the segment as part of the CacheNodeSeedData\nbecause it's already in the FlightRouterState, which it always\naccompanies. Eventually these two types should be unified completely (in\nthe server response, at least).",
    "sha": "899b473ec695b2c9203eb5578f4bec7b0988fd91",
    "files": [
        {
            "sha": "dcd03b95359dca76a91a96fab20dd3b36839f70c",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -892,5 +892,8 @@\n   \"891\": \"Failed to read build paths file \\\"%s\\\": %s\",\n   \"892\": \"Failed to resolve glob pattern \\\"%s\\\": %s\",\n   \"893\": \"The \\\"sassOptions.functions\\\" option is not supported when using Turbopack. Custom Sass functions are only available with webpack. Please remove the \\\"functions\\\" property from your sassOptions in %s.\",\n-  \"894\": \"Param %s not found in childrenRouteParamSegments %s\"\n+  \"894\": \"Param %s not found in childrenRouteParamSegments %s\",\n+  \"895\": \"Invalid React HTML document. Should start with doctype prefix.\",\n+  \"896\": \"oops\",\n+  \"897\": \"Expected HTML document to start with doctype prefix\"\n }"
        },
        {
            "sha": "90e9a632cd5c61120d5458d97a91876319ac0ce5",
            "filename": "packages/next/src/client/components/router-reducer/aliased-prefetch-navigations.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Faliased-prefetch-navigations.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Faliased-prefetch-navigations.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Faliased-prefetch-navigations.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -84,8 +84,8 @@ export function handleAliasedPrefetchEntry(\n     // loading state and not the actual parallel route seed data.\n     if (isRootRender && seedData) {\n       // Fill in the cache with the new loading / rsc data\n-      const rsc = seedData[1]\n-      const loading = seedData[3]\n+      const rsc = seedData[0]\n+      const loading = seedData[2]\n       newCache.loading = loading\n       newCache.rsc = rsc\n \n@@ -153,8 +153,8 @@ export function handleAliasedPrefetchEntry(\n function hasLoadingComponentInSeedData(seedData: CacheNodeSeedData | null) {\n   if (!seedData) return false\n \n-  const parallelRoutes = seedData[2]\n-  const loading = seedData[3]\n+  const parallelRoutes = seedData[1]\n+  const loading = seedData[2]\n \n   if (loading) {\n     return true\n@@ -187,15 +187,15 @@ function fillNewTreeWithOnlyLoadingSegments(\n     const cacheKey = createRouterCacheKey(segmentForParallelRoute)\n \n     const parallelSeedData =\n-      cacheNodeSeedData !== null && cacheNodeSeedData[2][key] !== undefined\n-        ? cacheNodeSeedData[2][key]\n+      cacheNodeSeedData !== null && cacheNodeSeedData[1][key] !== undefined\n+        ? cacheNodeSeedData[1][key]\n         : null\n \n     let newCacheNode: CacheNode\n     if (parallelSeedData !== null) {\n       // New data was sent from the server.\n-      const rsc = parallelSeedData[1]\n-      const loading = parallelSeedData[3]\n+      const rsc = parallelSeedData[0]\n+      const loading = parallelSeedData[2]\n       newCacheNode = {\n         lazyData: null,\n         // copy the layout but null the page segment as that's not meant to be used"
        },
        {
            "sha": "2be5f94048ebd043115b261666b6409d2efa3909",
            "filename": "packages/next/src/client/components/router-reducer/apply-flight-data.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fapply-flight-data.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fapply-flight-data.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fapply-flight-data.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -18,8 +18,8 @@ export function applyFlightData(\n   }\n \n   if (isRootRender) {\n-    const rsc = seedData[1]\n-    const loading = seedData[3]\n+    const rsc = seedData[0]\n+    const loading = seedData[2]\n     cache.loading = loading\n     cache.rsc = rsc\n     // This is a PPR-only field. When PPR is enabled, we shouldn't hit"
        },
        {
            "sha": "ab39896e860c2f9a45a83b8118958f0bb9aea7b7",
            "filename": "packages/next/src/client/components/router-reducer/create-initial-router-state.test.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fcreate-initial-router-state.test.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fcreate-initial-router-state.test.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fcreate-initial-router-state.test.tsx?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -36,7 +36,7 @@ describe('createInitialRouterState', () => {\n \n     const state = createInitialRouterState({\n       navigatedAt,\n-      initialFlightData: [[initialTree, ['', children, {}, null]]],\n+      initialFlightData: [[initialTree, [children, {}, null]]],\n       initialCanonicalUrlParts: initialCanonicalUrl.split('/'),\n       initialRenderedSearch: '',\n       initialParallelRoutes,\n@@ -45,7 +45,7 @@ describe('createInitialRouterState', () => {\n \n     const state2 = createInitialRouterState({\n       navigatedAt,\n-      initialFlightData: [[initialTree, ['', children, {}, null]]],\n+      initialFlightData: [[initialTree, [children, {}, null]]],\n       initialCanonicalUrlParts: initialCanonicalUrl.split('/'),\n       initialRenderedSearch: '',\n       initialParallelRoutes,"
        },
        {
            "sha": "5474acae3a0981b852ea00a6ed66e1e4f93d34bc",
            "filename": "packages/next/src/client/components/router-reducer/create-initial-router-state.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fcreate-initial-router-state.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fcreate-initial-router-state.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fcreate-initial-router-state.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -41,8 +41,8 @@ export function createInitialRouterState({\n   } = normalizedFlightData\n   // For the SSR render, seed data should always be available (we only send back a `null` response\n   // in the case of a `loading` segment, pre-PPR.)\n-  const rsc = initialSeedData?.[1]\n-  const loading = initialSeedData?.[3] ?? null\n+  const rsc = initialSeedData?.[0]\n+  const loading = initialSeedData?.[2] ?? null\n \n   const cache: CacheNode = {\n     lazyData: null,"
        },
        {
            "sha": "8f236251f87fb10a54569fb468740861df44967d",
            "filename": "packages/next/src/client/components/router-reducer/fill-cache-with-new-subtree-data.test.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffill-cache-with-new-subtree-data.test.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffill-cache-with-new-subtree-data.test.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffill-cache-with-new-subtree-data.test.tsx?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -9,14 +9,7 @@ const getFlightData = (): NormalizedFlightData[] => {\n       segmentPath: ['children', 'linking', 'children', 'about'],\n       segment: 'about',\n       tree: ['about', { children: ['', {}] }],\n-      seedData: [\n-        'about',\n-        <h1>SubTreeData Injected!</h1>,\n-        {},\n-        null,\n-        false,\n-        false,\n-      ],\n+      seedData: [<h1>SubTreeData Injected!</h1>, {}, null, false, false],\n       head: null,\n       isHeadPartial: false,\n       isRootRender: false,"
        },
        {
            "sha": "26f92047c8e955ee5cda8faa2aee497e6643216e",
            "filename": "packages/next/src/client/components/router-reducer/fill-cache-with-new-subtree-data.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffill-cache-with-new-subtree-data.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffill-cache-with-new-subtree-data.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffill-cache-with-new-subtree-data.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -58,16 +58,14 @@ function fillCacheHelper(\n           !childCacheNode.lazyData ||\n           childCacheNode === existingChildCacheNode)\n       ) {\n-        const incomingSegment = cacheNodeSeedData[0]\n-        const rsc = cacheNodeSeedData[1]\n-        const loading = cacheNodeSeedData[3]\n+        const rsc = cacheNodeSeedData[0]\n+        const loading = cacheNodeSeedData[2]\n \n         childCacheNode = {\n           lazyData: null,\n           // When `fillLazyItems` is false, we only want to fill the RSC data for the layout,\n           // not the page segment.\n-          rsc:\n-            fillLazyItems || incomingSegment !== PAGE_SEGMENT_KEY ? rsc : null,\n+          rsc: fillLazyItems || segment !== PAGE_SEGMENT_KEY ? rsc : null,\n           prefetchRsc: null,\n           head: null,\n           prefetchHead: null,"
        },
        {
            "sha": "9667fb230084e0a75f1b3dab661382cc894c2e65",
            "filename": "packages/next/src/client/components/router-reducer/fill-lazy-items-till-leaf-with-head.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffill-lazy-items-till-leaf-with-head.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffill-lazy-items-till-leaf-with-head.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Ffill-lazy-items-till-leaf-with-head.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -35,8 +35,8 @@ export function fillLazyItemsTillLeafWithHead(\n     // in the response format, so that we don't have to send the keys twice.\n     // Then the client can convert them into separate representations.\n     const parallelSeedData =\n-      cacheNodeSeedData !== null && cacheNodeSeedData[2][key] !== undefined\n-        ? cacheNodeSeedData[2][key]\n+      cacheNodeSeedData !== null && cacheNodeSeedData[1][key] !== undefined\n+        ? cacheNodeSeedData[1][key]\n         : null\n     if (existingCache) {\n       const existingParallelRoutesCacheNode =\n@@ -47,8 +47,8 @@ export function fillLazyItemsTillLeafWithHead(\n         let newCacheNode: CacheNode\n         if (parallelSeedData !== null) {\n           // New data was sent from the server.\n-          const seedNode = parallelSeedData[1]\n-          const loading = parallelSeedData[3]\n+          const seedNode = parallelSeedData[0]\n+          const loading = parallelSeedData[2]\n           newCacheNode = {\n             lazyData: null,\n             rsc: seedNode,\n@@ -99,8 +99,8 @@ export function fillLazyItemsTillLeafWithHead(\n     let newCacheNode: CacheNode\n     if (parallelSeedData !== null) {\n       // New data was sent from the server.\n-      const seedNode = parallelSeedData[1]\n-      const loading = parallelSeedData[3]\n+      const seedNode = parallelSeedData[0]\n+      const loading = parallelSeedData[2]\n       newCacheNode = {\n         lazyData: null,\n         rsc: seedNode,"
        },
        {
            "sha": "91087f70de46998d90f684e74752bda9f0381c28",
            "filename": "packages/next/src/client/components/router-reducer/invalidate-cache-below-flight-segmentpath.test.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Finvalidate-cache-below-flight-segmentpath.test.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Finvalidate-cache-below-flight-segmentpath.test.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Finvalidate-cache-below-flight-segmentpath.test.tsx?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -11,7 +11,7 @@ const getFlightData = (): NormalizedFlightData[] => {\n       segmentPath: ['children', 'linking', 'children', 'about'],\n       segment: 'about',\n       tree: ['about', { children: ['', {}] }],\n-      seedData: ['about', <h1>About Page!</h1>, {}, null, false, false],\n+      seedData: [<h1>About Page!</h1>, {}, null, false, false],\n       head: null,\n       isHeadPartial: false,\n       isRootRender: false,"
        },
        {
            "sha": "d9c7aca37f3c2c2fdcd72c3595ce330b4a68a388",
            "filename": "packages/next/src/client/components/router-reducer/ppr-navigations.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fppr-navigations.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fppr-navigations.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Fppr-navigations.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -136,7 +136,7 @@ function updateCacheNodeOnNavigation(\n   // Diff the old and new trees to reuse the shared layouts.\n   const oldRouterStateChildren = oldRouterState[1]\n   const newRouterStateChildren = newRouterState[1]\n-  const prefetchDataChildren = prefetchData !== null ? prefetchData[2] : null\n+  const prefetchDataChildren = prefetchData !== null ? prefetchData[1] : null\n \n   if (!didFindRootLayout) {\n     // We're currently traversing the part of the tree that was also part of\n@@ -529,14 +529,14 @@ function createCacheNodeOnNavigation(\n     // There's no existing CacheNode for this segment, but we do have prefetch\n     // data. If the prefetch data is fully static (i.e. does not contain any\n     // dynamic holes), we don't need to request it from the server.\n-    rsc = prefetchData[1]\n-    loading = prefetchData[3]\n+    rsc = prefetchData[0]\n+    loading = prefetchData[2]\n     head = isLeafSegment ? possiblyPartialPrefetchHead : null\n     // Even though we're accessing the data from the prefetch cache, this is\n     // conceptually a new segment, not a reused one. So we should update the\n     // navigatedAt timestamp.\n     cacheNodeNavigatedAt = navigatedAt\n-    const isPrefetchRscPartial = prefetchData[4]\n+    const isPrefetchRscPartial = prefetchData[3]\n     if (\n       // Check if the segment data is partial\n       isPrefetchRscPartial ||\n@@ -577,7 +577,7 @@ function createCacheNodeOnNavigation(\n   // We already have a full segment we can render, so we don't need to request a\n   // new one from the server. Keep traversing down the tree until we reach\n   // something that requires a dynamic request.\n-  const prefetchDataChildren = prefetchData !== null ? prefetchData[2] : null\n+  const prefetchDataChildren = prefetchData !== null ? prefetchData[1] : null\n   const taskChildren = new Map()\n   const existingCacheNodeChildren =\n     existingCacheNode !== undefined ? existingCacheNode.parallelRoutes : null\n@@ -922,7 +922,7 @@ function finishTaskUsingDynamicDataPayload(\n   // The server returned more data than we need to finish the task. Skip over\n   // the extra segments until we reach the leaf task node.\n   const serverChildren = serverRouterState[1]\n-  const dynamicDataChildren = dynamicData[2]\n+  const dynamicDataChildren = dynamicData[1]\n \n   for (const parallelRouteKey in serverRouterState) {\n     const serverRouterStateChild: FlightRouterState =\n@@ -965,7 +965,7 @@ function createPendingCacheNode(\n   scrollableSegmentsResult: Array<FlightSegmentPath>\n ): ReadyCacheNode {\n   const routerStateChildren = routerState[1]\n-  const prefetchDataChildren = prefetchData !== null ? prefetchData[2] : null\n+  const prefetchDataChildren = prefetchData !== null ? prefetchData[1] : null\n \n   const parallelRoutes = new Map()\n   for (let parallelRouteKey in routerStateChildren) {\n@@ -1012,7 +1012,7 @@ function createPendingCacheNode(\n     scrollableSegmentsResult.push(segmentPath)\n   }\n \n-  const maybePrefetchRsc = prefetchData !== null ? prefetchData[1] : null\n+  const maybePrefetchRsc = prefetchData !== null ? prefetchData[0] : null\n   return {\n     lazyData: null,\n     parallelRoutes: parallelRoutes,\n@@ -1030,7 +1030,7 @@ function createPendingCacheNode(\n     // we do for the segment data and head.\n     loading:\n       prefetchData !== null\n-        ? (prefetchData[3] ?? null)\n+        ? (prefetchData[2] ?? null)\n         : // If we don't have a prefetch, then we don't know if there's a loading component.\n           // We'll fulfill it based on the dynamic response, just like `rsc` and `head`.\n           createDeferredRsc<LoadingModuleData>(),\n@@ -1059,7 +1059,7 @@ function finishPendingCacheNode(\n   // data promise to `null` to trigger a lazy fetch during render.\n   const taskStateChildren = taskState[1]\n   const serverStateChildren = serverState[1]\n-  const dataChildren = dynamicData[2]\n+  const dataChildren = dynamicData[1]\n \n   // The router state that we traverse the tree with (taskState) is the same one\n   // that we used to construct the pending Cache Node tree. That way we're sure\n@@ -1120,7 +1120,7 @@ function finishPendingCacheNode(\n   // Use the dynamic data from the server to fulfill the deferred RSC promise\n   // on the Cache Node.\n   const rsc = cacheNode.rsc\n-  const dynamicSegmentData = dynamicData[1]\n+  const dynamicSegmentData = dynamicData[0]\n   if (rsc === null) {\n     // This is a lazy cache node. We can overwrite it. This is only safe\n     // because we know that the LayoutRouter suspends if `rsc` is `null`.\n@@ -1139,7 +1139,7 @@ function finishPendingCacheNode(\n   // Fulfill it using the dynamic response so that we can display the loading boundary.\n   const loading = cacheNode.loading\n   if (isDeferredRsc(loading)) {\n-    const dynamicLoading = dynamicData[3]\n+    const dynamicLoading = dynamicData[2]\n     loading.resolve(dynamicLoading, debugInfo)\n   }\n "
        },
        {
            "sha": "533ac60ff46314f17f66415a3f21621dccf70f1d",
            "filename": "packages/next/src/client/components/router-reducer/reducers/refresh-reducer.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Frefresh-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Frefresh-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Frefresh-reducer.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -108,8 +108,8 @@ export function refreshReducer(\n \n         // Handles case where prefetch only returns the router tree patch without rendered components.\n         if (cacheNodeSeedData !== null) {\n-          const rsc = cacheNodeSeedData[1]\n-          const loading = cacheNodeSeedData[3]\n+          const rsc = cacheNodeSeedData[0]\n+          const loading = cacheNodeSeedData[2]\n           cache.rsc = rsc\n           cache.prefetchRsc = null\n           cache.loading = loading"
        },
        {
            "sha": "39d7b604fbc2f0e36d8120755185fc4de31596cb",
            "filename": "packages/next/src/client/components/router-reducer/reducers/server-action-reducer.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fserver-action-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fserver-action-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fserver-action-reducer.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -375,11 +375,11 @@ export function serverActionReducer(\n \n         // The server sent back RSC data for the server action, so we need to apply it to the cache.\n         if (cacheNodeSeedData !== null) {\n-          const rsc = cacheNodeSeedData[1]\n+          const rsc = cacheNodeSeedData[0]\n           const cache: CacheNode = createEmptyCacheNode()\n           cache.rsc = rsc\n           cache.prefetchRsc = null\n-          cache.loading = cacheNodeSeedData[3]\n+          cache.loading = cacheNodeSeedData[2]\n           fillLazyItemsTillLeafWithHead(\n             navigatedAt,\n             cache,"
        },
        {
            "sha": "1044625a3e06122d5fa61d1c46898b74ea1b5dbe",
            "filename": "packages/next/src/client/components/segment-cache-impl/cache.ts",
            "status": "modified",
            "additions": 36,
            "deletions": 32,
            "changes": 68,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache-impl%2Fcache.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache-impl%2Fcache.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache-impl%2Fcache.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -1989,6 +1989,7 @@ function writeDynamicRenderResponseIntoCache(\n         fetchStrategy,\n         route,\n         staleAt,\n+        flightData.tree,\n         seedData,\n         isResponsePartial,\n         cacheKey,\n@@ -2044,6 +2045,7 @@ function writeSeedDataIntoCache(\n     | FetchStrategy.Full,\n   route: FulfilledRouteCacheEntry,\n   staleAt: number,\n+  flightRouterState: FlightRouterState,\n   seedData: CacheNodeSeedData,\n   isResponsePartial: boolean,\n   cacheKey: SegmentCacheKey,\n@@ -2058,8 +2060,8 @@ function writeSeedDataIntoCache(\n   // want to treat a dynamic response as if it were static. The two examples\n   // where this happens are <Link prefetch={true}> (which implicitly opts\n   // dynamic data into being static) and when prefetching a PPR-disabled route\n-  const rsc = seedData[1]\n-  const loading = seedData[3]\n+  const rsc = seedData[0]\n+  const loading = seedData[2]\n   const isPartial = rsc === null || isResponsePartial\n \n   // We should only write into cache entries that are owned by us. Or create\n@@ -2110,36 +2112,38 @@ function writeSeedDataIntoCache(\n     }\n   }\n   // Recursively write the child data into the cache.\n-  const seedDataChildren = seedData[2]\n-  if (seedDataChildren !== null) {\n-    for (const parallelRouteKey in seedDataChildren) {\n-      const childSeedData = seedDataChildren[parallelRouteKey]\n-      if (childSeedData !== null) {\n-        const childSegment = childSeedData[0]\n-        const childRequestKeyPart = createSegmentRequestKeyPart(childSegment)\n-        const childRequestKey = appendSegmentRequestKeyPart(\n-          requestKey,\n-          parallelRouteKey,\n-          childRequestKeyPart\n-        )\n-        const childCacheKey = appendSegmentCacheKeyPart(\n-          cacheKey,\n-          parallelRouteKey,\n-          createSegmentCacheKeyPart(childRequestKeyPart, childSegment)\n-        )\n-        writeSeedDataIntoCache(\n-          now,\n-          task,\n-          fetchStrategy,\n-          route,\n-          staleAt,\n-          childSeedData,\n-          isResponsePartial,\n-          childCacheKey,\n-          childRequestKey,\n-          entriesOwnedByCurrentTask\n-        )\n-      }\n+  const flightRouterStateChildren = flightRouterState[1]\n+  const seedDataChildren = seedData[1]\n+  for (const parallelRouteKey in flightRouterStateChildren) {\n+    const childFlightRouterState = flightRouterStateChildren[parallelRouteKey]\n+    const childSeedData: CacheNodeSeedData | null | void =\n+      seedDataChildren[parallelRouteKey]\n+    if (childSeedData !== null && childSeedData !== undefined) {\n+      const childSegment = childFlightRouterState[0]\n+      const childRequestKeyPart = createSegmentRequestKeyPart(childSegment)\n+      const childRequestKey = appendSegmentRequestKeyPart(\n+        requestKey,\n+        parallelRouteKey,\n+        childRequestKeyPart\n+      )\n+      const childCacheKey = appendSegmentCacheKeyPart(\n+        cacheKey,\n+        parallelRouteKey,\n+        createSegmentCacheKeyPart(childRequestKeyPart, childSegment)\n+      )\n+      writeSeedDataIntoCache(\n+        now,\n+        task,\n+        fetchStrategy,\n+        route,\n+        staleAt,\n+        childFlightRouterState,\n+        childSeedData,\n+        isResponsePartial,\n+        childCacheKey,\n+        childRequestKey,\n+        entriesOwnedByCurrentTask\n+      )\n     }\n   }\n }"
        },
        {
            "sha": "44a7092656dbd8ab29c097a5f0b56141ed051eb7",
            "filename": "packages/next/src/client/components/segment-cache-impl/navigation.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache-impl%2Fnavigation.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache-impl%2Fnavigation.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fsegment-cache-impl%2Fnavigation.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -399,14 +399,7 @@ function readRenderSnapshotFromCache(\n       null,\n       tree.isRootLayout,\n     ],\n-    seedData: [\n-      segment,\n-      rsc,\n-      childSeedDatas,\n-      loading,\n-      isPartial,\n-      hasRuntimePrefetch,\n-    ],\n+    seedData: [rsc, childSeedDatas, loading, isPartial, hasRuntimePrefetch],\n   }\n }\n "
        },
        {
            "sha": "53d10dff38686221b3d238e7e8533296365c0bf6",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -1278,7 +1278,6 @@ async function getErrorRSCPayload(\n   // For metadata notFound error there's no global not found boundary on top\n   // so we create a not found page with AppRouter\n   const seedData: CacheNodeSeedData = [\n-    initialTree[0],\n     createElement(\n       'html',\n       {"
        },
        {
            "sha": "025a7a32280a861123451761976752d91d99d61b",
            "filename": "packages/next/src/server/app-render/collect-segment-data.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcollect-segment-data.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcollect-segment-data.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcollect-segment-data.tsx?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -254,7 +254,7 @@ function collectSegmentDataImpl(\n   let slotMetadata: { [parallelRouteKey: string]: TreePrefetch } | null = null\n \n   const children = route[1]\n-  const seedDataChildren = seedData !== null ? seedData[2] : null\n+  const seedDataChildren = seedData !== null ? seedData[1] : null\n   for (const parallelRouteKey in children) {\n     const childRoute = children[parallelRouteKey]\n     const childSegment = childRoute[0]\n@@ -281,7 +281,7 @@ function collectSegmentDataImpl(\n     slotMetadata[parallelRouteKey] = childTree\n   }\n \n-  const hasRuntimePrefetch = seedData !== null ? seedData[5] : false\n+  const hasRuntimePrefetch = seedData !== null ? seedData[4] : false\n \n   if (seedData !== null) {\n     // Spawn a task to write the segment data to a new Flight stream.\n@@ -337,8 +337,8 @@ async function renderSegmentPrefetch(\n   // Render the segment data to a stream.\n   // In the future, this is where we can include additional metadata, like the\n   // stale time and cache tags.\n-  const rsc = seedData[1]\n-  const loading = seedData[3]\n+  const rsc = seedData[0]\n+  const loading = seedData[2]\n   const segmentPrefetch: SegmentPrefetch = {\n     buildId,\n     rsc,"
        },
        {
            "sha": "670c1d8bb32cf63833292c6b052b0f39e7d8ebdb",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -415,7 +415,6 @@ async function createComponentTreeInternal(\n   }\n \n   // Resolve the segment param\n-  const actualSegment = segmentParam ? segmentParam.treeSegment : segment\n   const isSegmentViewEnabled = !!ctx.renderOpts.dev\n   const dir =\n     (process.env.NEXT_RUNTIME === 'edge'\n@@ -674,7 +673,6 @@ async function createComponentTreeInternal(\n   // When the segment does not have a layout or page we still have to add the layout router to ensure the path holds the loading component\n   if (!MaybeComponent) {\n     return [\n-      actualSegment,\n       createElement(\n         Fragment,\n         {\n@@ -708,7 +706,6 @@ async function createComponentTreeInternal(\n     experimental.isRoutePPREnabled\n   ) {\n     return [\n-      actualSegment,\n       createElement(\n         Fragment,\n         {\n@@ -812,7 +809,6 @@ async function createComponentTreeInternal(\n         : pageElement\n \n     return [\n-      actualSegment,\n       createElement(\n         Fragment,\n         {\n@@ -1022,7 +1018,6 @@ async function createComponentTreeInternal(\n \n     // For layouts we just render the component\n     return [\n-      actualSegment,\n       wrappedSegmentNode,\n       parallelRouteCacheNodeSeedData,\n       loadingData,"
        },
        {
            "sha": "aa050987ab6938cd78ceb1e66b21f1c569e0ad45",
            "filename": "packages/next/src/shared/lib/app-router-types.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fapp-router-types.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/899b473ec695b2c9203eb5578f4bec7b0988fd91/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fapp-router-types.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fapp-router-types.ts?ref=899b473ec695b2c9203eb5578f4bec7b0988fd91",
            "patch": "@@ -221,7 +221,6 @@ export type FlightSegmentPath =\n  * likely change.\n  */\n export type CacheNodeSeedData = [\n-  segment: Segment,\n   node: React.ReactNode | null,\n   parallelRoutes: {\n     [parallelRouterKey: string]: CacheNodeSeedData | null"
        }
    ],
    "stats": {
        "total": 188,
        "additions": 86,
        "deletions": 102
    }
}