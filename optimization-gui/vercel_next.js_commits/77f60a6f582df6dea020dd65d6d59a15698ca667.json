{
    "author": "unstubbable",
    "message": "Remove obsolete `setReferenceManifestsSingleton` call (#86574)",
    "sha": "77f60a6f582df6dea020dd65d6d59a15698ca667",
    "files": [
        {
            "sha": "9efbd6bfe5316bb6f3675c05b7a0704a77038f15",
            "filename": "packages/next/src/server/app-render/action-handler.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/77f60a6f582df6dea020dd65d6d59a15698ca667/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Faction-handler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/77f60a6f582df6dea020dd65d6d59a15698ca667/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Faction-handler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Faction-handler.ts?ref=77f60a6f582df6dea020dd65d6d59a15698ca667",
            "patch": "@@ -59,6 +59,7 @@ import { InvariantError } from '../../shared/lib/invariant-error'\n import { executeRevalidates } from '../revalidation-utils'\n import { getRequestMeta } from '../request-meta'\n import { setCacheBustingSearchParam } from '../../client/components/router-reducer/set-cache-busting-search-param'\n+import { getServerModuleMap } from './encryption-utils'\n \n function formDataFromSearchQueryString(query: string) {\n   const searchParams = new URLSearchParams(query)\n@@ -503,7 +504,6 @@ export async function handleAction({\n   req,\n   res,\n   ComponentMod,\n-  serverModuleMap,\n   generateFlight,\n   workStore,\n   requestStore,\n@@ -514,7 +514,6 @@ export async function handleAction({\n   req: BaseNextRequest\n   res: BaseNextResponse\n   ComponentMod: AppPageModule\n-  serverModuleMap: ServerModuleMap\n   generateFlight: GenerateFlight\n   workStore: WorkStore\n   requestStore: RequestStore\n@@ -524,6 +523,7 @@ export async function handleAction({\n }): Promise<HandleActionResult> {\n   const contentType = req.headers['content-type']\n   const { serverActionsManifest, page } = ctx.renderOpts\n+  const serverModuleMap = getServerModuleMap()\n \n   const {\n     actionId,"
        },
        {
            "sha": "c5a36409bb2e3dd36109a8da3d4a4db29433fe69",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 16,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/77f60a6f582df6dea020dd65d6d59a15698ca667/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/77f60a6f582df6dea020dd65d6d59a15698ca667/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=77f60a6f582df6dea020dd65d6d59a15698ca667",
            "patch": "@@ -101,10 +101,7 @@ import { makeGetServerInsertedHTML } from './make-get-server-inserted-html'\n import { walkTreeWithFlightRouterState } from './walk-tree-with-flight-router-state'\n import { createComponentTree, getRootParams } from './create-component-tree'\n import { getAssetQueryString } from './get-asset-query-string'\n-import {\n-  getServerModuleMap,\n-  setReferenceManifestsSingleton,\n-} from './encryption-utils'\n+import { getServerModuleMap } from './encryption-utils'\n import {\n   DynamicState,\n   type PostponedState,\n@@ -147,7 +144,6 @@ import {\n   getClientComponentLoaderMetrics,\n   wrapClientComponentLoader,\n } from '../client-component-renderer-logger'\n-import { createServerModuleMap } from './action-utils'\n import { isNodeNextRequest } from '../base-http/helpers'\n import { parseRelativeUrl } from '../../shared/lib/router/utils/parse-relative-url'\n import AppRouter from '../../client/components/app-router'\n@@ -1844,7 +1840,6 @@ async function renderToHTMLOrFlightImpl(\n \n   const {\n     clientReferenceManifest,\n-    serverActionsManifest,\n     ComponentMod,\n     nextFontManifest,\n     serverActions,\n@@ -1971,15 +1966,6 @@ async function renderToHTMLOrFlightImpl(\n \n   assertClientReferenceManifest(clientReferenceManifest)\n \n-  const serverModuleMap = createServerModuleMap({ serverActionsManifest })\n-\n-  setReferenceManifestsSingleton({\n-    page: workStore.page,\n-    clientReferenceManifest,\n-    serverActionsManifest,\n-    serverModuleMap,\n-  })\n-\n   ComponentMod.patchFetch()\n \n   // Pull out the hooks/references from the component.\n@@ -2256,7 +2242,6 @@ async function renderToHTMLOrFlightImpl(\n         req,\n         res,\n         ComponentMod,\n-        serverModuleMap,\n         generateFlight: generateDynamicFlightRenderResult,\n         workStore,\n         requestStore,"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 3,
        "deletions": 18
    }
}