{
    "author": "bgw",
    "message": "chore(CI): Re-run `pnpm install` after `pnpm build` in `build_reusable.yml` (#78720)\n\nApparently there's a chicken-and-egg problem between `pnpm install` and `pnpm build` where some packages depend on `pnpm build` being run first, but `pnpm build` can't run until after `pnpm install`.\n\nRemove this one-off hack in `afterBuild` for `devlow-bench` and document it in `build_reusable.yml`.",
    "sha": "1abba59ac73b626e8999cb9dc557532d6f5fc6f7",
    "files": [
        {
            "sha": "cf33c7d93a0f349fca7a722303bf966baa4d3c42",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1abba59ac73b626e8999cb9dc557532d6f5fc6f7/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/1abba59ac73b626e8999cb9dc557532d6f5fc6f7/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=1abba59ac73b626e8999cb9dc557532d6f5fc6f7",
            "patch": "@@ -214,7 +214,6 @@ jobs:\n     uses: ./.github/workflows/build_reusable.yml\n     with:\n       afterBuild: |\n-        pnpm install\n         ./node_modules/.bin/devlow-bench ./scripts/devlow-bench.mjs \\\n           --datadog=ubuntu-latest-16-core \\\n           ${{ matrix.mode }} \\\n@@ -230,7 +229,6 @@ jobs:\n     with:\n       stepName: 'test-devlow'\n       afterBuild: |\n-        pnpm install\n         pnpm run --filter=devlow-bench test\n     secrets: inherit\n "
        },
        {
            "sha": "87b97a7b2f76283a293223a542b18c9bb1aa4342",
            "filename": ".github/workflows/build_reusable.yml",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/1abba59ac73b626e8999cb9dc557532d6f5fc6f7/.github%2Fworkflows%2Fbuild_reusable.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/1abba59ac73b626e8999cb9dc557532d6f5fc6f7/.github%2Fworkflows%2Fbuild_reusable.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_reusable.yml?ref=1abba59ac73b626e8999cb9dc557532d6f5fc6f7",
            "patch": "@@ -220,6 +220,16 @@ jobs:\n       - run: ANALYZE=1 pnpm build\n         if: ${{ inputs.skipInstallBuild != 'yes' }}\n \n+      # Some packages e.g. `devlow-bench` depend on `pnpm build` to generate\n+      # their `dist` directory. The first run of `pnpm install` will generate\n+      # warnings because these don't exist yet.\n+      #\n+      # We need to run `pnpm install` a _second_ time to fix this. Fortunately,\n+      # this second run is very fast and cheap.\n+      - name: Re-run pnpm install to link built packages into node_modules/.bin\n+        run: pnpm install\n+        if: ${{ inputs.skipInstallBuild != 'yes' }}\n+\n       - run: pnpm playwright install-deps\n         if: ${{ inputs.skipInstallBuild != 'yes' }}\n "
        }
    ],
    "stats": {
        "total": 12,
        "additions": 10,
        "deletions": 2
    }
}