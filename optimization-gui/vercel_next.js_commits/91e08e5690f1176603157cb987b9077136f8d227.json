{
    "author": "bgw",
    "message": "nit(turbo-tasks): Reorder the fields in RawVc::LocalOutput, add more documentation (#78562)\n\nIt seems like `persistence` is the least-read and least-important field of this enum variant, so move it to the end...\n\nAlso added documentation to the `RawVc` enum variants. This stuff is already documented elsewhere, but it's useful to have something here as well.",
    "sha": "91e08e5690f1176603157cb987b9077136f8d227",
    "files": [
        {
            "sha": "95cf05eb830ca415151f4c7a68930ac5cba38485",
            "filename": "turbopack/crates/turbo-tasks/src/manager.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/91e08e5690f1176603157cb987b9077136f8d227/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/91e08e5690f1176603157cb987b9077136f8d227/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fmanager.rs?ref=91e08e5690f1176603157cb987b9077136f8d227",
            "patch": "@@ -843,7 +843,7 @@ impl<B: Backend + 'static> TurboTasks<B> {\n         #[cfg(not(feature = \"tokio_tracing\"))]\n         tokio::task::spawn(future);\n \n-        RawVc::LocalOutput(persistence, execution_id, local_task_id)\n+        RawVc::LocalOutput(execution_id, local_task_id, persistence)\n     }\n \n     fn begin_primary_job(&self) {"
        },
        {
            "sha": "cf04eaad87fa43bf2949ba59ec84693aeb230c5a",
            "filename": "turbopack/crates/turbo-tasks/src/raw_vc.rs",
            "status": "modified",
            "additions": 19,
            "deletions": 6,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/91e08e5690f1176603157cb987b9077136f8d227/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fraw_vc.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/91e08e5690f1176603157cb987b9077136f8d227/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fraw_vc.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fraw_vc.rs?ref=91e08e5690f1176603157cb987b9077136f8d227",
            "patch": "@@ -55,9 +55,22 @@ impl Display for CellId {\n /// [monomorphization]: https://doc.rust-lang.org/book/ch10-01-syntax.html#performance-of-code-using-generics\n #[derive(Debug, Clone, Copy, PartialEq, Eq, Hash, Serialize, Deserialize)]\n pub enum RawVc {\n+    /// The synchronous return value of a task (after argument resolution). This is the\n+    /// representation used by [`OperationVc`][crate::OperationVc].\n     TaskOutput(TaskId),\n+    /// A pointer to a specific [`Vc::cell`][crate::Vc::cell] or `.cell()` call within a task. This\n+    /// is the representation used by [`ResolvedVc`].\n+    ///\n+    /// [`CellId`] contains the [`ValueTypeId`], which can be useful for efficient downcasting.\n     TaskCell(TaskId, CellId),\n-    LocalOutput(TaskPersistence, ExecutionId, LocalTaskId),\n+    /// The synchronous return value of a local task. This is created when a function is called\n+    /// with unresolved arguments or more explicitly with\n+    /// [`#[turbo_tasks::function(local)]`][crate::function].\n+    ///\n+    /// Local outputs are only valid within the context of their parent \"non-local\" task. Turbo\n+    /// Task's APIs are designed to prevent escapes of local [`Vc`]s, but [`ExecutionId`] is used\n+    /// for a fallback runtime assertion.\n+    LocalOutput(ExecutionId, LocalTaskId, TaskPersistence),\n }\n \n impl RawVc {\n@@ -84,7 +97,7 @@ impl RawVc {\n     pub fn is_transient(&self) -> bool {\n         match self {\n             RawVc::TaskOutput(task) | RawVc::TaskCell(task, ..) => task.is_transient(),\n-            RawVc::LocalOutput(persistence, ..) => *persistence == TaskPersistence::Transient,\n+            RawVc::LocalOutput(_, _, persistence) => *persistence == TaskPersistence::Transient,\n         }\n     }\n \n@@ -148,7 +161,7 @@ impl RawVc {\n                         return Err(ResolveTypeError::NoContent);\n                     }\n                 }\n-                RawVc::LocalOutput(_persistence, execution_id, local_task_id) => {\n+                RawVc::LocalOutput(execution_id, local_task_id, ..) => {\n                     current = read_local_output(&*tt, execution_id, local_task_id)\n                         .await\n                         .map_err(|source| ResolveTypeError::TaskError { source })?;\n@@ -185,7 +198,7 @@ impl RawVc {\n                     consistency = ReadConsistency::Eventual;\n                 }\n                 RawVc::TaskCell(_, _) => return Ok(current),\n-                RawVc::LocalOutput(_persistence, execution_id, local_task_id) => {\n+                RawVc::LocalOutput(execution_id, local_task_id, ..) => {\n                     debug_assert_eq!(consistency, ReadConsistency::Eventual);\n                     current = read_local_output(&*tt, execution_id, local_task_id).await?;\n                 }\n@@ -200,7 +213,7 @@ impl RawVc {\n         let mut current = self;\n         loop {\n             match current {\n-                RawVc::LocalOutput(_persistence, execution_id, local_task_id) => {\n+                RawVc::LocalOutput(execution_id, local_task_id, ..) => {\n                     current = read_local_output(&*tt, execution_id, local_task_id).await?;\n                 }\n                 non_local => return Ok(non_local),\n@@ -374,7 +387,7 @@ impl Future for ReadRawVcFuture {\n                             Err(err) => return Poll::Ready(Err(err)),\n                         }\n                     }\n-                    RawVc::LocalOutput(_persistence, execution_id, local_output_id) => {\n+                    RawVc::LocalOutput(execution_id, local_output_id, ..) => {\n                         debug_assert_eq!(this.consistency, ReadConsistency::Eventual);\n                         let read_result = tt.try_read_local_output(execution_id, local_output_id);\n                         match read_result {"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 20,
        "deletions": 7
    }
}