{
    "author": "mischnic",
    "message": "Turbopack: normalize distDir separators (#86697)\n\nCloses #86652\nCloses PACK-6023\n\nPreviously, `dist_dir` contained backslashes on Windows which broke various things (among them, relative paths for the externals symlinks):\n\nhttps://github.com/vercel/next.js/blob/6eed9a05450f2c179b951c97350e305973a09e6f/crates/next-api/src/project.rs#L765",
    "sha": "2cd70dfede8bcb1b72798804d92f9653edde61e6",
    "files": [
        {
            "sha": "18b8ef1d2520371aa04c2cbe877d9d98483b9729",
            "filename": "packages/next/src/build/swc/index.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 7,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/2cd70dfede8bcb1b72798804d92f9653edde61e6/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/2cd70dfede8bcb1b72798804d92f9653edde61e6/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fswc%2Findex.ts?ref=2cd70dfede8bcb1b72798804d92f9653edde61e6",
            "patch": "@@ -488,6 +488,9 @@ function rustifyOptionEnv(\n   }))\n }\n \n+const normalizePathOnWindows = (p: string) =>\n+  path.sep === '\\\\' ? p.replace(/\\\\/g, '/') : p\n+\n // TODO(sokra) Support wasm option.\n function bindingToApi(\n   binding: RawBindings,\n@@ -875,23 +878,35 @@ function bindingToApi(\n       )\n     }\n \n+    // These are relative paths, but might be backslash-separated on Windows\n+    nextConfigSerializable.distDir = normalizePathOnWindows(\n+      nextConfigSerializable.distDir\n+    )\n+    nextConfigSerializable.distDirRoot = normalizePathOnWindows(\n+      nextConfigSerializable.distDirRoot\n+    )\n+\n     // loaderFile is an absolute path, we need it to be relative for turbopack.\n     if (nextConfigSerializable.images.loaderFile) {\n       nextConfigSerializable.images = {\n         ...nextConfigSerializable.images,\n         loaderFile:\n           './' +\n-          path.relative(projectPath, nextConfigSerializable.images.loaderFile),\n+          normalizePathOnWindows(\n+            path.relative(projectPath, nextConfigSerializable.images.loaderFile)\n+          ),\n       }\n     }\n \n     // cacheHandler can be an absolute path, we need it to be relative for turbopack.\n     if (nextConfigSerializable.cacheHandler) {\n       nextConfigSerializable.cacheHandler =\n         './' +\n-        (path.isAbsolute(nextConfigSerializable.cacheHandler)\n-          ? path.relative(projectPath, nextConfigSerializable.cacheHandler)\n-          : nextConfigSerializable.cacheHandler)\n+        normalizePathOnWindows(\n+          path.isAbsolute(nextConfigSerializable.cacheHandler)\n+            ? path.relative(projectPath, nextConfigSerializable.cacheHandler)\n+            : nextConfigSerializable.cacheHandler\n+        )\n     }\n     if (nextConfigSerializable.cacheHandlers) {\n       nextConfigSerializable.cacheHandlers = Object.fromEntries(\n@@ -902,9 +917,11 @@ function bindingToApi(\n           .map(([key, value]) => [\n             key,\n             './' +\n-              (path.isAbsolute(value)\n-                ? path.relative(projectPath, value)\n-                : value),\n+              normalizePathOnWindows(\n+                path.isAbsolute(value)\n+                  ? path.relative(projectPath, value)\n+                  : value\n+              ),\n           ])\n       )\n     }"
        }
    ],
    "stats": {
        "total": 31,
        "additions": 24,
        "deletions": 7
    }
}