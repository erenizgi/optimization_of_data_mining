{
    "author": "unstubbable",
    "message": "[Cache Components] Disable static indicator (#84639)\n\nWhen `experimental.cacheComponents` is enabled, the static indicator in\nthe Next.js DevTools is now disabled.\n\nWith Cache Components enabled, the binary static/dynamic state is no\nlonger accurate since routes are typically partially static and dynamic\n(unless fully opted into dynamic rendering via a Suspense boundary above\nthe body, which is an edge case).\n\nTo avoid confusion, we're removing it for now, when the feature flag is\nenabled. In the future, we will likely provide better tools that will\nallow users to understand which parts of a page are prerendered and\nwhich parts are dynamic.\n\nIn addition, this PR also improves the behavior for fully static App\nRouter pages (without Cache Components). Previously, we would show\n\"Dynamic\" as default, and only flipped to \"Static\" when the request was\nfinished. Now, we're showing a spinner while the page is loading.\n\n![static\nindicator](https://github.com/user-attachments/assets/c720975d-932c-48b0-b705-7c408fdcf51d)\n\ncloses NAR-428",
    "sha": "d60d2350477e11777c760fcdcfeda33e3bcfe49b",
    "files": [
        {
            "sha": "f1c1065048b3d529caaaa5b3af13050add6b9c85",
            "filename": "packages/next/src/client/app-index.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fclient%2Fapp-index.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fclient%2Fapp-index.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-index.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -260,7 +260,7 @@ export function hydrate(\n     const { createWebSocket } =\n       require('./dev/hot-reloader/app/web-socket') as typeof import('./dev/hot-reloader/app/web-socket')\n \n-    staticIndicatorState = { pathname: null, appIsrManifest: {} }\n+    staticIndicatorState = { pathname: null, appIsrManifest: null }\n     webSocket = createWebSocket(assetPrefix, staticIndicatorState)\n   }\n "
        },
        {
            "sha": "02051f1cee907de374efa1d313e9f8a585b4d7d5",
            "filename": "packages/next/src/client/dev/hot-reloader/app/hot-reloader-app.tsx",
            "status": "modified",
            "additions": 21,
            "deletions": 17,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -41,7 +41,7 @@ import { getOrCreateDebugChannelReadableWriterPair } from '../../debug-channel'\n \n export interface StaticIndicatorState {\n   pathname: string | null\n-  appIsrManifest: Record<string, true>\n+  appIsrManifest: Record<string, boolean> | null\n }\n \n let mostRecentCompilationHash: any = null\n@@ -261,18 +261,18 @@ export function processMessage(\n       if (process.env.__NEXT_DEV_INDICATOR) {\n         staticIndicatorState.appIsrManifest = message.data\n \n-        // handle initial status on receiving manifest\n-        // navigation is handled in useEffect for pathname changes\n-        // as we'll receive the updated manifest before usePathname\n-        // triggers for new value\n-        if (\n-          staticIndicatorState.pathname &&\n-          staticIndicatorState.pathname in message.data\n-        ) {\n-          dispatcher.onStaticIndicator(true)\n-        } else {\n-          dispatcher.onStaticIndicator(false)\n-        }\n+        // Handle the initial static indicator status on receiving the ISR\n+        // manifest. Navigation is handled in an effect inside HotReload for\n+        // pathname changes as we'll receive the updated manifest before\n+        // usePathname triggers for a new value.\n+\n+        const isStatic = staticIndicatorState.pathname\n+          ? message.data[staticIndicatorState.pathname]\n+          : undefined\n+\n+        dispatcher.onStaticIndicator(\n+          isStatic === undefined ? 'pending' : isStatic ? 'static' : 'dynamic'\n+        )\n       }\n       break\n     }\n@@ -542,10 +542,14 @@ export default function HotReload({\n \n       staticIndicatorState.pathname = pathname\n \n-      if (pathname && pathname in staticIndicatorState.appIsrManifest) {\n-        dispatcher.onStaticIndicator(true)\n-      } else {\n-        dispatcher.onStaticIndicator(false)\n+      if (staticIndicatorState.appIsrManifest) {\n+        const isStatic = pathname\n+          ? staticIndicatorState.appIsrManifest[pathname]\n+          : undefined\n+\n+        dispatcher.onStaticIndicator(\n+          isStatic === undefined ? 'pending' : isStatic ? 'static' : 'dynamic'\n+        )\n       }\n     }, [pathname, staticIndicatorState])\n   }"
        },
        {
            "sha": "de6a175acebb98036f9d8561fac275e564560c3b",
            "filename": "packages/next/src/client/dev/hot-reloader/pages/hot-reloader-pages.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fhot-reloader-pages.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fhot-reloader-pages.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fhot-reloader-pages.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -265,10 +265,10 @@ export function handleStaticIndicator() {\n       appComponent?.getInitialProps !== appComponent?.origGetInitialProps\n \n     const isPageStatic =\n-      window.location.pathname in isrManifest ||\n+      isrManifest[window.location.pathname] ||\n       (!isDynamicPage && !hasAppGetInitialProps)\n \n-    dispatcher.onStaticIndicator(isPageStatic)\n+    dispatcher.onStaticIndicator(isPageStatic ? 'static' : 'dynamic')\n   }\n }\n "
        },
        {
            "sha": "854508455fd3c62aa9090b952a56b7bec6f4b7ff",
            "filename": "packages/next/src/next-devtools/dev-overlay.browser.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 4,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -55,7 +55,7 @@ export interface Dispatcher {\n   onDebugInfo(debugInfo: DebugInfo): void\n   onBeforeRefresh(): void\n   onRefresh(): void\n-  onStaticIndicator(status: boolean): void\n+  onStaticIndicator(status: 'pending' | 'static' | 'dynamic' | 'disabled'): void\n   onDevIndicator(devIndicator: DevIndicatorServerState): void\n   onDevToolsConfig(config: DevToolsConfig): void\n   onUnhandledError(reason: Error): void\n@@ -147,9 +147,14 @@ export const dispatcher: Dispatcher = {\n       dispatch({ type: ACTION_VERSION_INFO, versionInfo })\n     }\n   ),\n-  onStaticIndicator: createQueuable((dispatch: Dispatch, status: boolean) => {\n-    dispatch({ type: ACTION_STATIC_INDICATOR, staticIndicator: status })\n-  }),\n+  onStaticIndicator: createQueuable(\n+    (\n+      dispatch: Dispatch,\n+      status: 'pending' | 'static' | 'dynamic' | 'disabled'\n+    ) => {\n+      dispatch({ type: ACTION_STATIC_INDICATOR, staticIndicator: status })\n+    }\n+  ),\n   onDebugInfo: createQueuable((dispatch: Dispatch, debugInfo: DebugInfo) => {\n     dispatch({ type: ACTION_DEBUG_INFO, debugInfo })\n   }),"
        },
        {
            "sha": "2f24c85f94bd3ce8b46d69cf9ba6c5c55d3d29bc",
            "filename": "packages/next/src/next-devtools/dev-overlay/icons/loading-icon.tsx",
            "status": "added",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Ficons%2Floading-icon.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Ficons%2Floading-icon.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Ficons%2Floading-icon.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -0,0 +1,31 @@\n+export function LoadingIcon() {\n+  return (\n+    <svg\n+      width=\"20px\"\n+      height=\"20px\"\n+      viewBox=\"0 0 20 20\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+    >\n+      <circle\n+        cx=\"10\"\n+        cy=\"10\"\n+        r=\"7\"\n+        stroke=\"currentColor\"\n+        strokeWidth=\"2\"\n+        strokeLinecap=\"round\"\n+        strokeDasharray=\"32 12\"\n+        opacity=\"0.8\"\n+      >\n+        <animateTransform\n+          attributeName=\"transform\"\n+          type=\"rotate\"\n+          from=\"0 10 10\"\n+          to=\"360 10 10\"\n+          dur=\"1s\"\n+          repeatCount=\"indefinite\"\n+        />\n+      </circle>\n+    </svg>\n+  )\n+}"
        },
        {
            "sha": "6463277eb82340b63de41e8782c647dd5d13da69",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/panel-router.tsx",
            "status": "modified",
            "additions": 51,
            "deletions": 43,
            "changes": 94,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -24,6 +24,7 @@ import {\n   ACTION_ERROR_OVERLAY_OPEN,\n } from '../shared'\n import GearIcon from '../icons/gear-icon'\n+import { LoadingIcon } from '../icons/loading-icon'\n import { UserPreferencesBody } from '../components/errors/dev-tools-indicator/dev-tools-info/user-preferences'\n import { useShortcuts } from '../hooks/use-shortcuts'\n import { useUpdateAllPanelPositions } from '../components/devtools-indicator/devtools-indicator'\n@@ -60,17 +61,24 @@ const MenuPanel = () => {\n             }\n           },\n         },\n-        {\n-          title: `Current route is ${state.staticIndicator ? 'static' : 'dynamic'}.`,\n-          label: 'Route',\n-          value: state.staticIndicator ? 'Static' : 'Dynamic',\n-          onClick: () => setPanel('route-type'),\n-          attributes: {\n-            'data-nextjs-route-type': state.staticIndicator\n-              ? 'static'\n-              : 'dynamic',\n-          },\n-        },\n+        state.staticIndicator === 'disabled'\n+          ? undefined\n+          : state.staticIndicator === 'pending'\n+            ? {\n+                title: 'Loading...',\n+                label: 'Route',\n+                value: <LoadingIcon />,\n+              }\n+            : {\n+                title: `Current route is ${state.staticIndicator}.`,\n+                label: 'Route',\n+                value:\n+                  state.staticIndicator === 'static' ? 'Static' : 'Dynamic',\n+                onClick: () => setPanel('route-type'),\n+                attributes: {\n+                  'data-nextjs-route-type': state.staticIndicator,\n+                },\n+              },\n         !!process.env.TURBOPACK\n           ? {\n               title: 'Turbopack is enabled.',\n@@ -166,39 +174,39 @@ export const PanelRouter = () => {\n         </DynamicPanel>\n       </PanelRoute>\n \n-      <PanelRoute name=\"route-type\">\n-        <DynamicPanel\n-          key={state.staticIndicator ? 'static' : 'dynamic'}\n-          sharePanelSizeGlobally={false}\n-          sizeConfig={{\n-            kind: 'fixed',\n-            height: state.staticIndicator\n-              ? 300 / state.scale\n-              : 325 / state.scale,\n-            width: 400 / state.scale,\n-          }}\n-          closeOnClickOutside\n-          header={\n-            <DevToolsHeader\n-              title={`${state.staticIndicator ? 'Static' : 'Dynamic'} Route`}\n-            />\n-          }\n-        >\n-          <div className=\"panel-content\">\n-            <RouteInfoBody\n-              routerType={state.routerType}\n-              isStaticRoute={state.staticIndicator}\n-            />\n-            <InfoFooter\n-              href={\n-                learnMoreLink[state.routerType][\n-                  state.staticIndicator ? 'static' : 'dynamic'\n-                ]\n+      {state.staticIndicator !== 'disabled' &&\n+        state.staticIndicator !== 'pending' && (\n+          <PanelRoute name=\"route-type\">\n+            <DynamicPanel\n+              key={state.staticIndicator}\n+              sharePanelSizeGlobally={false}\n+              sizeConfig={{\n+                kind: 'fixed',\n+                height:\n+                  state.staticIndicator === 'static'\n+                    ? 300 / state.scale\n+                    : 325 / state.scale,\n+                width: 400 / state.scale,\n+              }}\n+              closeOnClickOutside\n+              header={\n+                <DevToolsHeader\n+                  title={`${state.staticIndicator === 'static' ? 'Static' : 'Dynamic'} Route`}\n+                />\n               }\n-            />\n-          </div>\n-        </DynamicPanel>\n-      </PanelRoute>\n+            >\n+              <div className=\"panel-content\">\n+                <RouteInfoBody\n+                  routerType={state.routerType}\n+                  isStaticRoute={state.staticIndicator === 'static'}\n+                />\n+                <InfoFooter\n+                  href={learnMoreLink[state.routerType][state.staticIndicator]}\n+                />\n+              </div>\n+            </DynamicPanel>\n+          </PanelRoute>\n+        )}\n \n       {isAppRouter && (\n         <PanelRoute name=\"segment-explorer\">"
        },
        {
            "sha": "ca43ae3fd9bc0829d80257201e3e424a710890bf",
            "filename": "packages/next/src/next-devtools/dev-overlay/shared.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -49,7 +49,7 @@ export interface OverlayState {\n   readonly notFound: boolean\n   readonly buildingIndicator: boolean\n   readonly renderingIndicator: boolean\n-  readonly staticIndicator: boolean\n+  readonly staticIndicator: 'pending' | 'static' | 'dynamic' | 'disabled'\n   readonly showIndicator: boolean\n   readonly disableDevIndicator: boolean\n   readonly debugInfo: DebugInfo\n@@ -112,7 +112,7 @@ export const ACTION_DEVTOOL_UPDATE_ROUTE_STATE =\n \n interface StaticIndicatorAction {\n   type: typeof ACTION_STATIC_INDICATOR\n-  staticIndicator: boolean\n+  staticIndicator: 'pending' | 'static' | 'dynamic' | 'disabled'\n }\n \n interface BuildOkAction {\n@@ -263,7 +263,7 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   errors: [],\n   notFound: false,\n   renderingIndicator: false,\n-  staticIndicator: false,\n+  staticIndicator: 'disabled',\n   /* \n     This is set to `true` when we can reliably know\n     whether the indicator is in disabled state or not.  "
        },
        {
            "sha": "6e0540d5976817d63b2963a3832a435b19898874",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 19,
            "deletions": 10,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -1502,6 +1502,7 @@ async function renderToHTMLOrFlightImpl(\n     serverActions,\n     assetPrefix = '',\n     enableTainting,\n+    experimental,\n   } = renderOpts\n \n   // We need to expose the bundled `require` API globally for\n@@ -1566,10 +1567,18 @@ async function renderToHTMLOrFlightImpl(\n     globalThis.__next_chunk_load__ = __next_chunk_load__\n   }\n \n-  if (process.env.NODE_ENV === 'development') {\n-    // reset isr status at start of request\n+  if (\n+    process.env.NODE_ENV === 'development' &&\n+    renderOpts.setIsrStatus &&\n+    !experimental.cacheComponents\n+  ) {\n+    // Reset the ISR status at start of request.\n     const { pathname } = new URL(req.url || '/', 'http://n')\n-    renderOpts.setIsrStatus?.(pathname, false)\n+    renderOpts.setIsrStatus(\n+      pathname,\n+      // Only pages using the Node runtime can use ISR, Edge is always dynamic.\n+      process.env.NEXT_RUNTIME === 'edge' ? false : undefined\n+    )\n   }\n \n   if (\n@@ -1844,19 +1853,19 @@ async function renderToHTMLOrFlightImpl(\n     if (\n       process.env.NODE_ENV === 'development' &&\n       renderOpts.setIsrStatus &&\n+      !experimental.cacheComponents &&\n+      // Only pages using the Node runtime can use ISR, so we only need to\n+      // update the status for those.\n       // The type check here ensures that `req` is correctly typed, and the\n       // environment variable check provides dead code elimination.\n       process.env.NEXT_RUNTIME !== 'edge' &&\n-      isNodeNextRequest(req) &&\n-      !isDevWarmupRequest\n+      isNodeNextRequest(req)\n     ) {\n       const setIsrStatus = renderOpts.setIsrStatus\n       req.originalRequest.on('end', () => {\n-        if (!requestStore.usedDynamic && !workStore.forceDynamic) {\n-          // only node can be ISR so we only need to update the status here\n-          const { pathname } = new URL(req.url || '/', 'http://n')\n-          setIsrStatus(pathname, true)\n-        }\n+        const { pathname } = new URL(req.url || '/', 'http://n')\n+        const isStatic = !requestStore.usedDynamic && !workStore.forceDynamic\n+        setIsrStatus(pathname, isStatic)\n       })\n     }\n "
        },
        {
            "sha": "217760cb650c350c6fdbd6ee6b3d3fc2aa03c857",
            "filename": "packages/next/src/server/app-render/types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -93,7 +93,7 @@ export interface RenderOptsPartial {\n   }\n   isOnDemandRevalidate?: boolean\n   isPossibleServerAction?: boolean\n-  setIsrStatus?: (key: string, value: boolean) => void\n+  setIsrStatus?: (key: string, value: boolean | undefined) => void\n   setReactDebugChannel?: (\n     debugChannel: { readable: ReadableStream<Uint8Array> },\n     htmlRequestId: string,"
        },
        {
            "sha": "eed2d8df90b9c7f8b3c5c74fbf6987a0ab1d220b",
            "filename": "packages/next/src/server/dev/hot-middleware.ts",
            "status": "modified",
            "additions": 50,
            "deletions": 31,
            "changes": 81,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-middleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-middleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-middleware.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -30,6 +30,7 @@ import type { HmrMessageSentToBrowser } from './hot-reloader-types'\n import { HMR_MESSAGE_SENT_TO_BROWSER } from './hot-reloader-types'\n import { devIndicatorServerState } from './dev-indicator-server-state'\n import { createBinaryHmrMessageData } from './messages'\n+import type { NextConfigComplete } from '../config-shared'\n \n function isMiddlewareStats(stats: webpack.Stats) {\n   for (const key of stats.compilation.entrypoints.keys()) {\n@@ -70,31 +71,21 @@ function getStatsForSyncEvent(\n }\n \n export class WebpackHotMiddleware {\n-  private clients = new Set<ws>()\n+  private clientsWithoutRequestId = new Set<ws>()\n   private clientsByRequestId: Map<string, ws> = new Map()\n-\n-  clientLatestStats: { ts: number; stats: webpack.Stats } | null\n-  middlewareLatestStats: { ts: number; stats: webpack.Stats } | null\n-  serverLatestStats: { ts: number; stats: webpack.Stats } | null\n-  closed: boolean\n-  versionInfo: VersionInfo\n-  devtoolsFrontendUrl: string | undefined\n-  devToolsConfig: DevToolsConfig\n+  private closed = false\n+  private clientLatestStats: { ts: number; stats: webpack.Stats } | null = null\n+  private middlewareLatestStats: { ts: number; stats: webpack.Stats } | null =\n+    null\n+  private serverLatestStats: { ts: number; stats: webpack.Stats } | null = null\n \n   constructor(\n     compilers: webpack.Compiler[],\n-    versionInfo: VersionInfo,\n-    devtoolsFrontendUrl: string | undefined,\n-    devToolsConfig: DevToolsConfig\n+    private versionInfo: VersionInfo,\n+    private devtoolsFrontendUrl: string | undefined,\n+    private config: NextConfigComplete,\n+    private devToolsConfig: DevToolsConfig\n   ) {\n-    this.clientLatestStats = null\n-    this.middlewareLatestStats = null\n-    this.serverLatestStats = null\n-    this.closed = false\n-    this.versionInfo = versionInfo\n-    this.devtoolsFrontendUrl = devtoolsFrontendUrl\n-    this.devToolsConfig = devToolsConfig || ({} as DevToolsConfig)\n-\n     compilers[0].hooks.invalid.tap(\n       'webpack-hot-middleware',\n       this.onClientInvalid\n@@ -175,17 +166,17 @@ export class WebpackHotMiddleware {\n   onHMR = (client: ws, requestId: string | null) => {\n     if (this.closed) return\n \n-    this.clients.add(client)\n-\n     if (requestId) {\n       this.clientsByRequestId.set(requestId, client)\n+    } else {\n+      this.clientsWithoutRequestId.add(client)\n     }\n \n     client.addEventListener('close', () => {\n-      this.clients.delete(client)\n-\n       if (requestId) {\n         this.clientsByRequestId.delete(requestId)\n+      } else {\n+        this.clientsWithoutRequestId.delete(client)\n       }\n     })\n \n@@ -259,7 +250,32 @@ export class WebpackHotMiddleware {\n       return\n     }\n \n-    for (const wsClient of this.clients) {\n+    for (const wsClient of [\n+      ...this.clientsWithoutRequestId,\n+      ...this.clientsByRequestId.values(),\n+    ]) {\n+      this.publishToClient(wsClient, message)\n+    }\n+  }\n+\n+  publishToLegacyClients = (message: HmrMessageSentToBrowser) => {\n+    if (this.closed) {\n+      return\n+    }\n+\n+    // Clients with a request ID are inferred App Router clients. If Cache\n+    // Components is not enabled, we consider those legacy clients. Pages\n+    // Router clients are also considered legacy clients. TODO: Maybe mark\n+    // clients as App Router / Pages Router clients explicitly, instead of\n+    // inferring it from the presence of a request ID.\n+\n+    if (!this.config.experimental.cacheComponents) {\n+      for (const wsClient of this.clientsByRequestId.values()) {\n+        this.publishToClient(wsClient, message)\n+      }\n+    }\n+\n+    for (const wsClient of this.clientsWithoutRequestId) {\n       this.publishToClient(wsClient, message)\n     }\n   }\n@@ -273,28 +289,31 @@ export class WebpackHotMiddleware {\n     // https://github.com/webpack/tapable/issues/32#issuecomment-350644466\n     this.closed = true\n \n-    for (const wsClient of this.clients) {\n+    for (const wsClient of [\n+      ...this.clientsWithoutRequestId,\n+      ...this.clientsByRequestId.values(),\n+    ]) {\n       // it's okay to not cleanly close these websocket connections, this is dev\n       wsClient.terminate()\n     }\n \n-    this.clients.clear()\n+    this.clientsWithoutRequestId.clear()\n     this.clientsByRequestId.clear()\n   }\n \n   deleteClient = (client: ws, requestId: string | null) => {\n-    this.clients.delete(client)\n-\n     if (requestId) {\n       this.clientsByRequestId.delete(requestId)\n+    } else {\n+      this.clientsWithoutRequestId.delete(client)\n     }\n   }\n \n   hasClients = () => {\n-    return this.clients.size > 0\n+    return this.clientsWithoutRequestId.size + this.clientsByRequestId.size > 0\n   }\n \n   getClientCount = () => {\n-    return this.clients.size\n+    return this.clientsWithoutRequestId.size + this.clientsByRequestId.size\n   }\n }"
        },
        {
            "sha": "0b93c6217a294e04fd643293e5c7bac3ee60184d",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 62,
            "deletions": 14,
            "changes": 76,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -433,7 +433,7 @@ export async function createHotReloaderTurbopack(\n   let hmrEventHappened = false\n   let hmrHash = 0\n \n-  const clients = new Set<ws>()\n+  const clientsWithoutRequestId = new Set<ws>()\n   const clientsByRequestId = new Map<string, ws>()\n   const clientStates = new WeakMap<ws, ClientState>()\n \n@@ -457,7 +457,10 @@ export async function createHotReloaderTurbopack(\n       }\n     }\n \n-    for (const client of clients) {\n+    for (const client of [\n+      ...clientsWithoutRequestId,\n+      ...clientsByRequestId.values(),\n+    ]) {\n       const state = clientStates.get(client)\n       if (!state) {\n         continue\n@@ -490,7 +493,10 @@ export async function createHotReloaderTurbopack(\n   const sendEnqueuedMessagesDebounce = debounce(sendEnqueuedMessages, 2)\n \n   const sendHmr: SendHmr = (id: string, message: HmrMessageSentToBrowser) => {\n-    for (const client of clients) {\n+    for (const client of [\n+      ...clientsWithoutRequestId,\n+      ...clientsByRequestId.values(),\n+    ]) {\n       clientStates.get(client)?.messages.set(id, message)\n     }\n \n@@ -505,7 +511,10 @@ export async function createHotReloaderTurbopack(\n     payload.diagnostics = []\n     payload.issues = []\n \n-    for (const client of clients) {\n+    for (const client of [\n+      ...clientsWithoutRequestId,\n+      ...clientsByRequestId.values(),\n+    ]) {\n       clientStates.get(client)?.turbopackUpdates.push(payload)\n     }\n \n@@ -667,7 +676,7 @@ export async function createHotReloaderTurbopack(\n         dev: {\n           assetMapper,\n           changeSubscriptions,\n-          clients,\n+          clients: [...clientsWithoutRequestId, ...clientsByRequestId.values()],\n           clientStates,\n           serverFields,\n \n@@ -762,7 +771,8 @@ export async function createHotReloaderTurbopack(\n             projectPath,\n             distDir,\n             sendHmrMessage: (message) => hotReloader.send(message),\n-            getActiveConnectionCount: () => clients.size,\n+            getActiveConnectionCount: () =>\n+              clientsWithoutRequestId.size + clientsByRequestId.size,\n             getDevServerUrl: () => process.env.__NEXT_PRIVATE_ORIGIN,\n           }),\n         ]\n@@ -856,18 +866,26 @@ export async function createHotReloaderTurbopack(\n     // TODO: Figure out if socket type can match the NextJsHotReloaderInterface\n     onHMR(req, socket: Socket, head, onUpgrade) {\n       wsServer.handleUpgrade(req, socket, head, (client) => {\n-        onUpgrade(client)\n         const clientIssues: EntryIssuesMap = new Map()\n         const subscriptions: Map<string, AsyncIterator<any>> = new Map()\n \n-        clients.add(client)\n-\n         const requestId = req.url\n           ? new URL(req.url, 'http://n').searchParams.get('id')\n           : null\n \n+        // Clients with a request ID are inferred App Router clients. If Cache\n+        // Components is not enabled, we consider those legacy clients. Pages\n+        // Router clients are also considered legacy clients. TODO: Maybe mark\n+        // clients as App Router / Pages Router clients explicitly, instead of\n+        // inferring it from the presence of a request ID.\n         if (requestId) {\n           clientsByRequestId.set(requestId, client)\n+          onUpgrade(client, {\n+            isLegacyClient: !nextConfig.experimental.cacheComponents,\n+          })\n+        } else {\n+          clientsWithoutRequestId.add(client)\n+          onUpgrade(client, { isLegacyClient: true })\n         }\n \n         clientStates.set(client, {\n@@ -883,11 +901,12 @@ export async function createHotReloaderTurbopack(\n             subscription.return?.()\n           }\n           clientStates.delete(client)\n-          clients.delete(client)\n \n           if (requestId) {\n             clientsByRequestId.delete(requestId)\n             deleteReactDebugChannel(requestId)\n+          } else {\n+            clientsWithoutRequestId.delete(client)\n           }\n         })\n \n@@ -1066,7 +1085,30 @@ export async function createHotReloaderTurbopack(\n     send(action) {\n       const payload = JSON.stringify(action)\n \n-      for (const client of clients) {\n+      for (const client of [\n+        ...clientsWithoutRequestId,\n+        ...clientsByRequestId.values(),\n+      ]) {\n+        client.send(payload)\n+      }\n+    },\n+\n+    sendToLegacyClients(action) {\n+      const payload = JSON.stringify(action)\n+\n+      // Clients with a request ID are inferred App Router clients. If Cache\n+      // Components is not enabled, we consider those legacy clients. Pages\n+      // Router clients are also considered legacy clients. TODO: Maybe mark\n+      // clients as App Router / Pages Router clients explicitly, instead of\n+      // inferring it from the presence of a request ID.\n+\n+      if (!nextConfig.experimental.cacheComponents) {\n+        for (const client of clientsByRequestId.values()) {\n+          client.send(payload)\n+        }\n+      }\n+\n+      for (const client of clientsWithoutRequestId) {\n         client.send(payload)\n       }\n     },\n@@ -1314,11 +1356,14 @@ export async function createHotReloaderTurbopack(\n         })\n     },\n     close() {\n-      for (const wsClient of clients) {\n+      for (const wsClient of [\n+        ...clientsWithoutRequestId,\n+        ...clientsByRequestId.values(),\n+      ]) {\n         // it's okay to not cleanly close these websocket connections, this is dev\n         wsClient.terminate()\n       }\n-      clients.clear()\n+      clientsWithoutRequestId.clear()\n       clientsByRequestId.clear()\n     },\n   }\n@@ -1370,7 +1415,10 @@ export async function createHotReloaderTurbopack(\n           const errors = new Map<string, CompilationError>()\n           addErrors(errors, currentEntryIssues)\n \n-          for (const client of clients) {\n+          for (const client of [\n+            ...clientsWithoutRequestId,\n+            ...clientsByRequestId.values(),\n+          ]) {\n             const state = clientStates.get(client)\n             if (!state) {\n               continue"
        },
        {
            "sha": "c04d8d899ea04f5842db45523f329961182844ee",
            "filename": "packages/next/src/server/dev/hot-reloader-types.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 2,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-types.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-types.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-types.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -135,7 +135,7 @@ export interface TurbopackConnectedMessage {\n \n export interface AppIsrManifestMessage {\n   type: HMR_MESSAGE_SENT_TO_BROWSER.ISR_MANIFEST\n-  data: Record<string, true>\n+  data: Record<string, boolean>\n }\n \n export interface DevToolsConfigMessage {\n@@ -213,6 +213,11 @@ export interface NextJsHotReloaderInterface {\n   clearHmrServerError(): void\n   start(): Promise<void>\n   send(action: HmrMessageSentToBrowser): void\n+  /**\n+   * Send the given action only to legacy clients, i.e. Pages Router clients,\n+   * and App Router clients that don't have Cache Components enabled.\n+   */\n+  sendToLegacyClients(action: HmrMessageSentToBrowser): void\n   setReactDebugChannel(\n     debugChannel: ReactDebugChannelForBrowser,\n     htmlRequestId: string,\n@@ -223,7 +228,10 @@ export interface NextJsHotReloaderInterface {\n     req: IncomingMessage,\n     _socket: Duplex,\n     head: Buffer,\n-    onUpgrade: (client: { send(data: string): void }) => void\n+    onUpgrade: (\n+      client: { send(data: string): void },\n+      context: { isLegacyClient: boolean }\n+    ) => void\n   ): void\n   invalidate({\n     reloadAfterInvalidation,"
        },
        {
            "sha": "a46fead96f41a8ce1ba7ff3ad07325e226accc05",
            "filename": "packages/next/src/server/dev/hot-reloader-webpack.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 2,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -424,7 +424,10 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n     req: IncomingMessage,\n     _socket: Duplex,\n     head: Buffer,\n-    callback: (client: ws.WebSocket) => void\n+    callback: (\n+      client: ws.WebSocket,\n+      context: { isLegacyClient: boolean }\n+    ) => void\n   ) {\n     wsServer.handleUpgrade(req, req.socket, head, (client) => {\n       const requestId = req.url\n@@ -437,7 +440,16 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n \n       this.webpackHotMiddleware.onHMR(client, requestId)\n       this.onDemandEntries?.onHMR(client, () => this.hmrServerError)\n-      callback(client)\n+\n+      // Clients with a request ID are inferred App Router clients. If Cache\n+      // Components is not enabled, we consider those legacy clients. Pages\n+      // Router clients are also considered legacy clients. TODO: Maybe mark\n+      // clients as App Router / Pages Router clients explicitly, instead of\n+      // inferring it from the presence of a request ID.\n+      const isLegacyClient =\n+        !requestId || !this.config.experimental.cacheComponents\n+\n+      callback(client, { isLegacyClient })\n \n       client.addEventListener('message', async ({ data }) => {\n         data = typeof data !== 'string' ? data.toString() : data\n@@ -1562,6 +1574,7 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n       this.multiCompiler.compilers,\n       this.versionInfo,\n       this.devtoolsFrontendUrl,\n+      this.config,\n       initialDevToolsConfig\n     )\n \n@@ -1704,6 +1717,10 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n     this.webpackHotMiddleware!.publishToClient(client, message)\n   }\n \n+  public sendToLegacyClients(message: HmrMessageSentToBrowser): void {\n+    this.webpackHotMiddleware!.publishToLegacyClients(message)\n+  }\n+\n   public setReactDebugChannel(\n     debugChannel: ReactDebugChannelForBrowser,\n     htmlRequestId: string,"
        },
        {
            "sha": "e0ec8857e83b9a82f066c4e898a1c5c7fa7f0210",
            "filename": "packages/next/src/server/dev/turbopack-utils.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fturbopack-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fturbopack-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fturbopack-utils.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -565,7 +565,7 @@ type HandleEntrypointsHooks = {\n type HandleEntrypointsDevOpts = {\n   assetMapper: AssetMapper\n   changeSubscriptions: ChangeSubscriptions\n-  clients: Set<ws>\n+  clients: Array<ws>\n   clientStates: ClientStateMap\n   serverFields: ServerFields\n "
        },
        {
            "sha": "722db071826982ec95ec4339d6f96eb3cee802c5",
            "filename": "packages/next/src/server/lib/dev-bundler-service.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 6,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fdev-bundler-service.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fdev-bundler-service.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fdev-bundler-service.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -12,7 +12,7 @@ import type { ReactDebugChannelForBrowser } from '../dev/debug-channel'\n  * bundler while in development.\n  */\n export class DevBundlerService {\n-  public appIsrManifestInner: InstanceType<typeof LRUCache<true>>\n+  public appIsrManifestInner: InstanceType<typeof LRUCache<boolean>>\n \n   constructor(\n     private readonly bundler: DevBundler,\n@@ -24,7 +24,7 @@ export class DevBundlerService {\n       function length() {\n         return 16\n       }\n-    ) as any\n+    )\n   }\n \n   public ensurePage: typeof this.bundler.hotReloader.ensurePage = async (\n@@ -86,7 +86,7 @@ export class DevBundlerService {\n   }\n \n   public get appIsrManifest() {\n-    const serializableManifest: Record<string, true> = {}\n+    const serializableManifest: Record<string, boolean> = {}\n \n     for (const [key, value] of this.appIsrManifestInner) {\n       serializableManifest[key] = value\n@@ -95,13 +95,20 @@ export class DevBundlerService {\n     return serializableManifest\n   }\n \n-  public setIsrStatus(key: string, value: boolean) {\n-    if (value === false) {\n+  public setIsrStatus(key: string, value: boolean | undefined) {\n+    if (value === undefined) {\n       this.appIsrManifestInner.remove(key)\n     } else {\n       this.appIsrManifestInner.set(key, value)\n     }\n-    this.bundler?.hotReloader?.send({\n+\n+    // Only send the ISR manifest to legacy clients, i.e. Pages Router clients,\n+    // or App Router clients that have Cache Components disabled. The ISR\n+    // manifest is only used to inform the static indicator, which currently\n+    // does not provide useful information if Cache Components is enabled due to\n+    // its binary nature (i.e. it does not support showing info for partially\n+    // static pages).\n+    this.bundler?.hotReloader?.sendToLegacyClients({\n       type: HMR_MESSAGE_SENT_TO_BROWSER.ISR_MANIFEST,\n       data: this.appIsrManifest,\n     })"
        },
        {
            "sha": "a0e30a9c81a51f4c7b219782c3cb5586408b0a62",
            "filename": "packages/next/src/server/lib/router-server.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 7,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-server.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -801,13 +801,22 @@ export async function initialize(opts: {\n             req,\n             socket,\n             head,\n-            (client) => {\n-              client.send(\n-                JSON.stringify({\n-                  type: HMR_MESSAGE_SENT_TO_BROWSER.ISR_MANIFEST,\n-                  data: devBundlerService?.appIsrManifest || {},\n-                } satisfies AppIsrManifestMessage)\n-              )\n+            (client, { isLegacyClient }) => {\n+              if (isLegacyClient) {\n+                // Only send the ISR manifest to legacy clients, i.e. Pages\n+                // Router clients, or App Router clients that have Cache\n+                // Components disabled. The ISR manifest is only used to inform\n+                // the static indicator, which currently does not provide useful\n+                // information if Cache Components is enabled due to its binary\n+                // nature (i.e. it does not support showing info for partially\n+                // static pages).\n+                client.send(\n+                  JSON.stringify({\n+                    type: HMR_MESSAGE_SENT_TO_BROWSER.ISR_MANIFEST,\n+                    data: devBundlerService?.appIsrManifest || {},\n+                  } satisfies AppIsrManifestMessage)\n+                )\n+              }\n             }\n           )\n         }"
        },
        {
            "sha": "03d61adb9397fb7561da4548c9a3707192c41179",
            "filename": "packages/next/src/server/lib/router-utils/router-server-context.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Frouter-server-context.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Frouter-server-context.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Frouter-server-context.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -37,7 +37,7 @@ export type RouterServerContext = Record<\n     // allow dev server to log with original stack\n     logErrorWithOriginalStack?: (err: unknown, type: string) => void\n     // allow setting ISR status in dev\n-    setIsrStatus?: (key: string, value: boolean) => void\n+    setIsrStatus?: (key: string, value: boolean | undefined) => void\n     setReactDebugChannel?: (\n       debugChannel: { readable: ReadableStream<Uint8Array> },\n       htmlRequestId: string,"
        },
        {
            "sha": "2c400090edae2e394a47859cbd66c192c7e19c64",
            "filename": "packages/next/src/server/lib/router-utils/setup-dev-bundler.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fsetup-dev-bundler.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -127,7 +127,7 @@ export type ServerFields = {\n   interceptionRoutes?: ReturnType<\n     typeof import('./filesystem').buildCustomRoute\n   >[]\n-  setIsrStatus?: (key: string, value: boolean) => void\n+  setIsrStatus?: (key: string, value: boolean | undefined) => void\n   resetFetch?: () => void\n }\n "
        },
        {
            "sha": "c6a1a620f2eca67fae8496266404472b009023f1",
            "filename": "packages/next/src/server/render.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frender.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -257,7 +257,7 @@ export type RenderOptsPartial = {\n   assetQueryString?: string\n   resolvedUrl?: string\n   resolvedAsPath?: string\n-  setIsrStatus?: (key: string, value: boolean) => void\n+  setIsrStatus?: (key: string, value: boolean | undefined) => void\n   clientReferenceManifest?: DeepReadonly<ClientReferenceManifest>\n   nextFontManifest?: DeepReadonly<NextFontManifest>\n   distDir?: string"
        },
        {
            "sha": "11126e4840a3d3e55675b62c1e7bf59fa9391b2f",
            "filename": "test/development/app-dir/dev-indicator/route-type.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fapp-dir%2Fdev-indicator%2Froute-type.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fapp-dir%2Fdev-indicator%2Froute-type.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdev-indicator%2Froute-type.test.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -1,5 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { getRouteTypeFromDevToolsIndicator, retry } from 'next-test-utils'\n+import { assertStaticIndicator, retry } from 'next-test-utils'\n \n describe('app dir dev indicator - route type', () => {\n   const { next } = nextTestSetup({\n@@ -10,7 +10,7 @@ describe('app dir dev indicator - route type', () => {\n     const browser = await next.browser('/')\n \n     await retry(async () => {\n-      expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Static')\n+      await assertStaticIndicator(browser, 'Static')\n     })\n   })\n \n@@ -25,7 +25,7 @@ describe('app dir dev indicator - route type', () => {\n \n     try {\n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+        await assertStaticIndicator(browser, 'Dynamic')\n       })\n     } finally {\n       await next.patchFile('app/page.tsx', origContent)\n@@ -44,7 +44,7 @@ describe('app dir dev indicator - route type', () => {\n \n     try {\n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+        await assertStaticIndicator(browser, 'Dynamic')\n       })\n     } finally {\n       await next.patchFile('app/page.tsx', origContent)\n@@ -56,6 +56,6 @@ describe('app dir dev indicator - route type', () => {\n \n     await browser.waitForElementByCss('#ready')\n \n-    expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+    await assertStaticIndicator(browser, 'Dynamic')\n   })\n })"
        },
        {
            "sha": "ef6849bce549bf8210fc6fb90eaee9f7290ae932",
            "filename": "test/development/dev-indicator/app/app/static-indicator/dynamic/page.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Fstatic-indicator%2Fdynamic%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Fstatic-indicator%2Fdynamic%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Fstatic-indicator%2Fdynamic%2Fpage.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -0,0 +1,9 @@\n+import { connection } from 'next/server'\n+import { setTimeout } from 'timers/promises'\n+\n+export default async function Page() {\n+  await connection()\n+  await setTimeout(100)\n+\n+  return <p>This is a dynamic app router page.</p>\n+}"
        },
        {
            "sha": "58bb1805591560eecaf7f814f29a5f0ddd73c3f0",
            "filename": "test/development/dev-indicator/app/app/static-indicator/static/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Fstatic-indicator%2Fstatic%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Fstatic-indicator%2Fstatic%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Fapp%2Fstatic-indicator%2Fstatic%2Fpage.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>This is a static app router page.</p>\n+}"
        },
        {
            "sha": "4ee00a218505ac95ed8f4b2cb12779643277286d",
            "filename": "test/development/dev-indicator/app/layout.js",
            "status": "removed",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/ab09e87861dce530459b7ccdd42ea2fca6f04fcc/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Flayout.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ab09e87861dce530459b7ccdd42ea2fca6f04fcc/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Flayout.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Flayout.js?ref=ab09e87861dce530459b7ccdd42ea2fca6f04fcc",
            "patch": "@@ -1,7 +0,0 @@\n-export default function RootLayout({ children }) {\n-  return (\n-    <html lang=\"en\">\n-      <body>{children}</body>\n-    </html>\n-  )\n-}"
        },
        {
            "sha": "5f632238aabd01aeb2e2bf0b69c99d0ebf0ee083",
            "filename": "test/development/dev-indicator/app/layout.tsx",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fapp%2Flayout.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -0,0 +1,15 @@\n+import { Suspense } from 'react'\n+import { Nav } from '../components/nav'\n+\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>\n+        <Nav />\n+        <main>\n+          <Suspense fallback={<p>Loading...</p>}>{children}</Suspense>\n+        </main>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "718616586c6d4fceaf9a5f9509037c03e41f051a",
            "filename": "test/development/dev-indicator/components/nav.tsx",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fcomponents%2Fnav.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fcomponents%2Fnav.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fcomponents%2Fnav.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -0,0 +1,26 @@\n+import Link from 'next/link'\n+\n+export function Nav() {\n+  return (\n+    <nav>\n+      <p>\n+        <Link href=\"/app/static-indicator/dynamic\">App Router Dynamic</Link>\n+      </p>\n+      <p>\n+        <Link href=\"/app/static-indicator/static\">App Router Static</Link>\n+      </p>\n+      <p>\n+        <Link href=\"/pages\">Pages Router Static</Link>\n+      </p>\n+      <p>\n+        <Link href=\"/pages/gssp\">Pages Router getServerSideProps</Link>\n+      </p>\n+      <p>\n+        <Link href=\"/pages/pregenerated\">Pages Router getStaticPaths</Link>\n+      </p>\n+      <p>\n+        <Link href=\"/pages/gip\">Pages Router getInitialProps</Link>\n+      </p>\n+    </nav>\n+  )\n+}"
        },
        {
            "sha": "8a00f9a08cc36cacbf6f0176d08bcd70e96b1796",
            "filename": "test/development/dev-indicator/dev-indicator.test.ts",
            "status": "modified",
            "additions": 130,
            "deletions": 29,
            "changes": 159,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fdev-indicator.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fdev-indicator.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fdev-indicator.test.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -1,5 +1,8 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { getRouteTypeFromDevToolsIndicator, retry } from 'next-test-utils'\n+import { assertStaticIndicator, retry } from 'next-test-utils'\n+\n+const withCacheComponents =\n+  process.env.__NEXT_EXPERIMENTAL_CACHE_COMPONENTS === 'true'\n \n describe('dev indicator - route type', () => {\n   const { next } = nextTestSetup({\n@@ -8,111 +11,209 @@ describe('dev indicator - route type', () => {\n \n   describe('getServerSideProps', () => {\n     it('should update when going from dynamic -> static', async () => {\n-      const browser = await next.browser('/gssp')\n+      const browser = await next.browser('/pages/gssp')\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+        await assertStaticIndicator(browser, 'Dynamic')\n       })\n \n       // validate static -> dynamic updates\n-      await browser.elementByCss(\"[href='/']\").click()\n+      await browser.elementByCss(\"[href='/pages']\").click()\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Static')\n+        await assertStaticIndicator(browser, 'Static')\n       })\n     })\n \n     it('should update when going from static -> dynamic', async () => {\n-      const browser = await next.browser('/')\n+      const browser = await next.browser('/pages')\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Static')\n+        await assertStaticIndicator(browser, 'Static')\n       })\n \n       // validate static -> dynamic updates\n-      await browser.elementByCss(\"[href='/gssp']\").click()\n+      await browser.elementByCss(\"[href='/pages/gssp']\").click()\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+        await assertStaticIndicator(browser, 'Dynamic')\n       })\n     })\n \n     it('should be marked dynamic on first load', async () => {\n-      const browser = await next.browser('/gssp')\n+      const browser = await next.browser('/pages/gssp')\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+        await assertStaticIndicator(browser, 'Dynamic')\n       })\n     })\n   })\n \n   describe('getInitialProps', () => {\n     it('should be marked dynamic on first load', async () => {\n-      const browser = await next.browser('/gip')\n+      const browser = await next.browser('/pages/gip')\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+        await assertStaticIndicator(browser, 'Dynamic')\n       })\n     })\n \n     it('should update when going from dynamic -> static', async () => {\n-      const browser = await next.browser('/gip')\n+      const browser = await next.browser('/pages/gip')\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+        await assertStaticIndicator(browser, 'Dynamic')\n       })\n \n-      await browser.elementByCss(\"[href='/']\").click()\n+      await browser.elementByCss(\"[href='/pages']\").click()\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Static')\n+        await assertStaticIndicator(browser, 'Static')\n       })\n     })\n \n     it('should update when going from static -> dynamic', async () => {\n-      const browser = await next.browser('/')\n+      const browser = await next.browser('/pages')\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Static')\n+        await assertStaticIndicator(browser, 'Static')\n       })\n \n-      await browser.elementByCss(\"[href='/gip']\").click()\n+      await browser.elementByCss(\"[href='/pages/gip']\").click()\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+        await assertStaticIndicator(browser, 'Dynamic')\n       })\n     })\n   })\n \n   describe('getStaticPaths', () => {\n     it('should be marked static on first load', async () => {\n-      const browser = await next.browser('/pregenerated')\n+      const browser = await next.browser('/pages/pregenerated')\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Static')\n+        await assertStaticIndicator(browser, 'Static')\n       })\n     })\n \n     it('should update when going from dynamic -> static', async () => {\n-      const browser = await next.browser('/gssp')\n+      const browser = await next.browser('/pages/gssp')\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Dynamic')\n+        await assertStaticIndicator(browser, 'Dynamic')\n       })\n \n-      await browser.elementByCss(\"[href='/pregenerated']\").click()\n+      await browser.elementByCss(\"[href='/pages/pregenerated']\").click()\n \n       await retry(async () => {\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Static')\n+        await assertStaticIndicator(browser, 'Static')\n       })\n     })\n   })\n \n   it('should have route type as static by default for static page', async () => {\n-    const browser = await next.browser('/')\n+    const browser = await next.browser('/pages')\n \n     await retry(async () => {\n-      expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Static')\n+      await assertStaticIndicator(browser, 'Static')\n+    })\n+  })\n+\n+  describe('with App Router', () => {\n+    describe('when loading a dynamic page', () => {\n+      if (withCacheComponents) {\n+        describe('with Cache Components enabled', () => {\n+          it('should not show a static indicator', async () => {\n+            const browser = await next.browser('/app/static-indicator/dynamic')\n+            await assertStaticIndicator(browser, undefined)\n+          })\n+\n+          it('should still show a static indicator when navigating to a Pages Router page', async () => {\n+            const browser = await next.browser('/app/static-indicator/dynamic')\n+            await assertStaticIndicator(browser, undefined)\n+\n+            await browser.elementByCss(\"[href='/pages']\").click()\n+\n+            await retry(async () => {\n+              await assertStaticIndicator(browser, 'Static')\n+            })\n+          })\n+        })\n+      } else {\n+        describe('with Cache Components disabled', () => {\n+          it('should be marked dynamic on first load', async () => {\n+            const browser = await next.browser('/app/static-indicator/dynamic')\n+\n+            await retry(async () => {\n+              await assertStaticIndicator(browser, 'Dynamic')\n+            })\n+          })\n+\n+          it('should update when going from dynamic -> static', async () => {\n+            const browser = await next.browser('/app/static-indicator/dynamic')\n+\n+            await retry(async () => {\n+              await assertStaticIndicator(browser, 'Dynamic')\n+            })\n+\n+            await browser\n+              .elementByCss(\"[href='/app/static-indicator/static']\")\n+              .click()\n+\n+            await retry(async () => {\n+              await assertStaticIndicator(browser, 'Static')\n+            })\n+          })\n+        })\n+      }\n+    })\n+\n+    describe('when loading a static page', () => {\n+      if (withCacheComponents) {\n+        describe('with Cache Components enabled', () => {\n+          it('should not show a static indicator', async () => {\n+            const browser = await next.browser('/app/static-indicator/static')\n+            await assertStaticIndicator(browser, undefined)\n+          })\n+\n+          it('should still show a static indicator when navigating to a Pages Router page', async () => {\n+            const browser = await next.browser('/app/static-indicator/static')\n+            await assertStaticIndicator(browser, undefined)\n+\n+            await browser.elementByCss(\"[href='/pages/gssp']\").click()\n+\n+            await retry(async () => {\n+              await assertStaticIndicator(browser, 'Dynamic')\n+            })\n+          })\n+        })\n+      } else {\n+        describe('with Cache Components disabled', () => {\n+          it('should be marked static on first load', async () => {\n+            const browser = await next.browser('/app/static-indicator/static')\n+\n+            await retry(async () => {\n+              await assertStaticIndicator(browser, 'Static')\n+            })\n+          })\n+\n+          it('should update when going from static -> dynamic', async () => {\n+            const browser = await next.browser('/app/static-indicator/static')\n+\n+            await retry(async () => {\n+              await assertStaticIndicator(browser, 'Static')\n+            })\n+\n+            await browser\n+              .elementByCss(\"[href='/app/static-indicator/dynamic']\")\n+              .click()\n+\n+            await retry(async () => {\n+              await assertStaticIndicator(browser, 'Dynamic')\n+            })\n+          })\n+        })\n+      }\n     })\n   })\n })"
        },
        {
            "sha": "d79c1cd7ac8da9ca6cadb5584c32d980b35ae1ed",
            "filename": "test/development/dev-indicator/pages/_app.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2F_app.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2F_app.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fpages%2F_app.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -0,0 +1,13 @@\n+import type { AppProps } from 'next/app'\n+import { Nav } from '../components/nav'\n+\n+export default function MyApp({ Component, pageProps }: AppProps) {\n+  return (\n+    <>\n+      <Nav />\n+      <main>\n+        <Component {...pageProps} />\n+      </main>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "20de16ace781f2f38f08b937d76e2a957c740625",
            "filename": "test/development/dev-indicator/pages/gssp.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 18,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/ab09e87861dce530459b7ccdd42ea2fca6f04fcc/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fgssp.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ab09e87861dce530459b7ccdd42ea2fca6f04fcc/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fgssp.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fgssp.tsx?ref=ab09e87861dce530459b7ccdd42ea2fca6f04fcc",
            "patch": "@@ -1,18 +0,0 @@\n-import Link from 'next/link'\n-\n-export default function Page() {\n-  return (\n-    <p>\n-      hello world <Link href=\"/pregenerated\">to /pregenerated</Link>{' '}\n-      <Link href=\"/\">to /</Link>\n-    </p>\n-  )\n-}\n-\n-export async function getServerSideProps() {\n-  return {\n-    props: {\n-      static: false,\n-    },\n-  }\n-}"
        },
        {
            "sha": "ef1ba7d9a400ad76d6eb1e6ed1b474f6f2a4f7be",
            "filename": "test/development/dev-indicator/pages/index.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 11,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/ab09e87861dce530459b7ccdd42ea2fca6f04fcc/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ab09e87861dce530459b7ccdd42ea2fca6f04fcc/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Findex.tsx?ref=ab09e87861dce530459b7ccdd42ea2fca6f04fcc",
            "patch": "@@ -1,11 +0,0 @@\n-import Link from 'next/link'\n-\n-export default function Page() {\n-  return (\n-    <p>\n-      hello world <Link href=\"/gssp\">to /gssp</Link>{' '}\n-      <Link href=\"/pregenerated\">to /pregenerated</Link>\n-      <Link href=\"/gip\">to /gip</Link>\n-    </p>\n-  )\n-}"
        },
        {
            "sha": "bd385cd4a4fdc3e0c445b2ac9bc263c813b97cd6",
            "filename": "test/development/dev-indicator/pages/pages/[slug]/index.tsx",
            "status": "renamed",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2F%5Bslug%5D%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2F%5Bslug%5D%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2F%5Bslug%5D%2Findex.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -1,12 +1,5 @@\n-import Link from 'next/link'\n-\n export default function Page({ slug }: { slug: string }) {\n-  return (\n-    <p>\n-      hello world {slug} <Link href=\"/gssp\">to /gssp</Link>\n-      <Link href=\"/\">to /</Link>\n-    </p>\n-  )\n+  return <p>hello world {slug}</p>\n }\n \n export const getStaticPaths = async () => {",
            "previous_filename": "test/development/dev-indicator/pages/[slug]/index.tsx"
        },
        {
            "sha": "f991b46c3261e03988e1c2dc4e835b33de891357",
            "filename": "test/development/dev-indicator/pages/pages/gip.tsx",
            "status": "renamed",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2Fgip.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2Fgip.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2Fgip.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -1,11 +1,5 @@\n-import Link from 'next/link'\n-\n export default function Page() {\n-  return (\n-    <p>\n-      hello world <Link href=\"/\">to /</Link>\n-    </p>\n-  )\n+  return <p>hello world</p>\n }\n \n Page.getInitialProps = async () => {",
            "previous_filename": "test/development/dev-indicator/pages/gip.tsx"
        },
        {
            "sha": "d38a06eab2529a15f3b12dc839b0b933fd37fe9e",
            "filename": "test/development/dev-indicator/pages/pages/gssp.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2Fgssp.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2Fgssp.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2Fgssp.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -0,0 +1,11 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}\n+\n+export async function getServerSideProps() {\n+  return {\n+    props: {\n+      static: false,\n+    },\n+  }\n+}"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/development/dev-indicator/pages/pages/index.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fdev-indicator%2Fpages%2Fpages%2Findex.tsx?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "5bdca48d054d552993987f87c09829092327e975",
            "filename": "test/e2e/app-dir/cache-components-dynamic-imports/cache-components-dynamic-imports.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fe2e%2Fapp-dir%2Fcache-components-dynamic-imports%2Fcache-components-dynamic-imports.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Fe2e%2Fapp-dir%2Fcache-components-dynamic-imports%2Fcache-components-dynamic-imports.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcache-components-dynamic-imports%2Fcache-components-dynamic-imports.test.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -1,10 +1,6 @@\n import * as path from 'path'\n import { nextTestSetup } from 'e2e-utils'\n-import {\n-  assertNoRedbox,\n-  getRouteTypeFromDevToolsIndicator,\n-  retry,\n-} from 'next-test-utils'\n+import { assertNoRedbox, retry } from 'next-test-utils'\n \n describe('async imports in cacheComponents', () => {\n   const { next, isNextStart, isNextDev } = nextTestSetup({\n@@ -65,8 +61,6 @@ describe('async imports in cacheComponents', () => {\n     expect(await browser.elementByCss('body').text()).toBe('hello')\n     if (isNextDev) {\n       await retry(async () => {\n-        // the page should be static\n-        expect(await getRouteTypeFromDevToolsIndicator(browser)).toBe('Static')\n         // we shouldn't get any errors from `spawnDynamicValidationInDev`\n         await assertNoRedbox(browser)\n       })"
        },
        {
            "sha": "2c0271d4407819a681da725c89ba6edbac4f7466",
            "filename": "test/lib/next-test-utils.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 21,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Flib%2Fnext-test-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d60d2350477e11777c760fcdcfeda33e3bcfe49b/test%2Flib%2Fnext-test-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-test-utils.ts?ref=d60d2350477e11777c760fcdcfeda33e3bcfe49b",
            "patch": "@@ -1053,35 +1053,37 @@ export async function assertNoDevToolsIndicator(browser: Playwright) {\n   }\n }\n \n-export async function getRouteTypeFromDevToolsIndicator(\n-  browser: Playwright\n-): Promise<'Static' | 'Dynamic'> {\n+export async function assertStaticIndicator(\n+  browser: Playwright,\n+  expectedRouteType: 'Static' | 'Dynamic' | undefined\n+): Promise<void> {\n   await openDevToolsIndicatorPopover(browser)\n \n-  return browser.eval(() => {\n+  const routeType = await browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n       .find((p) => p.shadowRoot.querySelector('[data-nextjs-toast]'))\n \n-    const root = portal?.shadowRoot\n-\n-    // 'Route\\nStatic' || 'Route\\nDynamic'\n-    const routeTypeText = root?.querySelector(\n-      '[data-nextjs-route-type]'\n-    )?.innerText\n-\n-    if (!routeTypeText) {\n-      throw new Error('No Route Type Text Found')\n-    }\n+    return (\n+      portal?.shadowRoot\n+        // 'Route\\nStatic' || 'Route\\nDynamic'\n+        ?.querySelector('[data-nextjs-route-type]')\n+        ?.innerText.split('\\n')\n+        .pop()\n+    )\n+  })\n \n-    // 'Static' || 'Dynamic'\n-    const routeType = routeTypeText.split('\\n').pop()\n-    if (routeType !== 'Static' && routeType !== 'Dynamic') {\n-      throw new Error(`Invalid Route Type: ${routeType}`)\n+  if (routeType !== expectedRouteType) {\n+    if (expectedRouteType) {\n+      throw new Error(\n+        `Expected static indicator with route type ${expectedRouteType}, found ${routeType} instead.`\n+      )\n+    } else {\n+      throw new Error(\n+        `Expected no static indicator, found ${routeType} instead.`\n+      )\n     }\n-\n-    return routeType as 'Static' | 'Dynamic'\n-  })\n+  }\n }\n \n export function getRedboxHeader(browser: Playwright): Promise<string | null> {"
        }
    ],
    "stats": {
        "total": 813,
        "additions": 553,
        "deletions": 260
    }
}