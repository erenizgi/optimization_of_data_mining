{
    "author": "mischnic",
    "message": "Turbopack: ignore module ids config in dev (#80204)\n\n`deterministic` doesn't work with HMR and causes odd errors.\n\nSo we'll ignore the `turbopack.moduleIds` config in dev\n\nSee https://vercel.slack.com/archives/C03EWR7LGEN/p1748971192561939 as well",
    "sha": "f684e973f1ddbbdc99cdda9a89070d6d228a1dd7",
    "files": [
        {
            "sha": "5d84d9af220a58a44afa4e269869c10b1576b1d9",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 10,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/f684e973f1ddbbdc99cdda9a89070d6d228a1dd7/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f684e973f1ddbbdc99cdda9a89070d6d228a1dd7/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=f684e973f1ddbbdc99cdda9a89070d6d228a1dd7",
            "patch": "@@ -1726,16 +1726,7 @@ impl Project {\n     /// Gets the module id strategy for the project.\n     #[turbo_tasks::function]\n     pub async fn module_ids(self: Vc<Self>) -> Result<Vc<Box<dyn ModuleIdStrategy>>> {\n-        let module_id_strategy =\n-            if let Some(module_id_strategy) = &*self.next_config().module_ids().await? {\n-                *module_id_strategy\n-            } else {\n-                match *self.next_mode().await? {\n-                    NextMode::Development => ModuleIdStrategyConfig::Named,\n-                    NextMode::Build => ModuleIdStrategyConfig::Deterministic,\n-                }\n-            };\n-\n+        let module_id_strategy = *self.next_config().module_ids(self.next_mode()).await?;\n         match module_id_strategy {\n             ModuleIdStrategyConfig::Named => Ok(Vc::upcast(DevModuleIdStrategy::new())),\n             ModuleIdStrategyConfig::Deterministic => {"
        },
        {
            "sha": "f362ceecf0ccc8417fea7693d10a4cd0f8f91789",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 5,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/f684e973f1ddbbdc99cdda9a89070d6d228a1dd7/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/f684e973f1ddbbdc99cdda9a89070d6d228a1dd7/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=f684e973f1ddbbdc99cdda9a89070d6d228a1dd7",
            "patch": "@@ -1559,11 +1559,17 @@ impl NextConfig {\n     }\n \n     #[turbo_tasks::function]\n-    pub fn module_ids(&self) -> Vc<OptionModuleIds> {\n-        let Some(module_ids) = self.turbopack.as_ref().and_then(|t| t.module_ids) else {\n-            return Vc::cell(None);\n-        };\n-        Vc::cell(Some(module_ids))\n+    pub async fn module_ids(&self, mode: Vc<NextMode>) -> Result<Vc<ModuleIds>> {\n+        Ok(match *mode.await? {\n+            // Ignore configuration in development mode, HMR only works with `named`\n+            NextMode::Development => ModuleIds::Named.cell(),\n+            NextMode::Build => self\n+                .turbopack\n+                .as_ref()\n+                .and_then(|t| t.module_ids)\n+                .unwrap_or(ModuleIds::Deterministic)\n+                .cell(),\n+        })\n     }\n \n     #[turbo_tasks::function]"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 12,
        "deletions": 15
    }
}