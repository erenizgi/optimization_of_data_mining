{
    "author": "huozhi",
    "message": "[devtool] fix scrollbar styling (#81814)\n\n* The scrollbar styling was lost before while we enabling the draggable panel. Share that styles between all scrollable content\r\n* Migrate the inline style to css and dynamic css into css variables, so we'll create less dynamic object during rendering.\r\n\r\n<video src=\"https://github.com/user-attachments/assets/df63169f-4846-4c53-91b4-3ca0585dd76d\" width=\"400\">",
    "sha": "d3ed546f49d903738bc09848e90afeefefe3cdfa",
    "files": [
        {
            "sha": "4ed779c64d743239d046c84ab83c70a4d83ce706",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/dialog/dialog.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fdialog.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fdialog.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fdialog.tsx?ref=d3ed546f49d903738bc09848e90afeefefe3cdfa",
            "patch": "@@ -87,6 +87,7 @@ const Dialog: React.FC<DialogProps> = function Dialog({\n       ref={dialogRef}\n       tabIndex={-1}\n       data-nextjs-dialog\n+      data-nextjs-scrollable-content\n       role={role}\n       aria-labelledby={ariaLabelledBy}\n       aria-describedby={ariaDescribedBy}"
        },
        {
            "sha": "60d45e22628904418a807f64b737a7b09108c5a9",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/dialog/styles.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 30,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fstyles.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fstyles.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fstyles.ts?ref=d3ed546f49d903738bc09848e90afeefefe3cdfa",
            "patch": "@@ -41,36 +41,6 @@ export const styles = css`\n     outline: 0;\n   }\n \n-  [data-nextjs-dialog],\n-  [data-nextjs-dialog] * {\n-    &::-webkit-scrollbar {\n-      width: 6px;\n-      height: 6px;\n-      border-radius: 0 0 1rem 1rem;\n-      margin-bottom: 1rem;\n-    }\n-\n-    &::-webkit-scrollbar-button {\n-      display: none;\n-    }\n-\n-    &::-webkit-scrollbar-track {\n-      border-radius: 0 0 1rem 1rem;\n-      background-color: var(--color-background-100);\n-    }\n-\n-    &::-webkit-scrollbar-thumb {\n-      border-radius: 1rem;\n-      background-color: var(--color-gray-500);\n-    }\n-  }\n-\n-  /* Place overflow: hidden on this so we can break out from [data-nextjs-dialog] */\n-  [data-nextjs-dialog-sizer] {\n-    overflow: hidden;\n-    border-radius: inherit;\n-  }\n-\n   [data-nextjs-dialog-backdrop] {\n     opacity: 0;\n     transition: opacity var(--transition-duration) var(--timing-overlay);"
        },
        {
            "sha": "736aae84b69af41fa345699a8ad74f16acf9ad45",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/panel-router.css",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.css",
            "raw_url": "https://github.com/vercel/next.js/raw/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.css?ref=d3ed546f49d903738bc09848e90afeefefe3cdfa",
            "patch": "@@ -0,0 +1,19 @@\n+/* Panel content padding styles */\n+.panel-content {\n+  padding: 16px;\n+  padding-top: 8px;\n+  overflow: hidden;\n+}\n+\n+/* User preferences wrapper styles */\n+.user-preferences-wrapper {\n+  padding: 20px;\n+  padding-top: 8px;\n+  overflow: hidden;\n+}\n+\n+/* Panel route base styles */\n+.panel-route {\n+  opacity: var(--panel-opacity);\n+  transition: var(--panel-transition);\n+}"
        },
        {
            "sha": "bf06161a6157a46706a9d856f8e8c00c3772b3f1",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/panel-router.tsx",
            "status": "modified",
            "additions": 11,
            "deletions": 22,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx?ref=d3ed546f49d903738bc09848e90afeefefe3cdfa",
            "patch": "@@ -29,6 +29,7 @@ import { UserPreferencesBody } from '../components/errors/dev-tools-indicator/de\n import { useHideShortcutStorage } from '../components/errors/dev-tools-indicator/dev-tools-info/preferences'\n import { useShortcuts } from '../hooks/use-shortcuts'\n import { useUpdateAllPanelPositions } from '../components/devtools-indicator/devtools-indicator'\n+import './panel-router.css'\n \n const MenuPanel = () => {\n   const { setPanel, setSelectedIndex } = usePanelRouterContext()\n@@ -189,12 +190,7 @@ export const PanelRouter = () => {\n             />\n           }\n         >\n-          <div\n-            style={{\n-              padding: '16px',\n-              paddingTop: '8px',\n-            }}\n-          >\n+          <div className=\"panel-content\">\n             <RouteInfoBody\n               routerType={state.routerType}\n               isStaticRoute={state.staticIndicator}\n@@ -246,12 +242,7 @@ export const PanelRouter = () => {\n           closeOnClickOutside\n           header={<DevToolsHeader title=\"Try Turbopack\" />}\n         >\n-          <div\n-            style={{\n-              padding: '16px',\n-              paddingTop: '8px',\n-            }}\n-          >\n+          <div className=\"panel-content\">\n             <TurbopackInfoBody />\n             <InfoFooter href=\"https://nextjs.org/docs/app/api-reference/turbopack\" />\n           </div>\n@@ -288,12 +279,7 @@ const UserPreferencesWrapper = ({\n   const updateAllPanelPositions = useUpdateAllPanelPositions()\n \n   return (\n-    <div\n-      style={{\n-        padding: '20px',\n-        paddingTop: '8px',\n-      }}\n-    >\n+    <div className=\"user-preferences-wrapper\">\n       <UserPreferencesBody\n         position={state.devToolsPosition}\n         scale={state.scale}\n@@ -358,10 +344,13 @@ function PanelRoute({\n     >\n       <div\n         id=\"panel-route\"\n-        style={{\n-          opacity: rendered ? 1 : 0,\n-          transition: `opacity ${MENU_DURATION_MS}ms ${MENU_CURVE}`,\n-        }}\n+        className=\"panel-route\"\n+        style={\n+          {\n+            '--panel-opacity': rendered ? 1 : 0,\n+            '--panel-transition': `opacity ${MENU_DURATION_MS}ms ${MENU_CURVE}`,\n+          } as React.CSSProperties\n+        }\n       >\n         {children}\n       </div>"
        },
        {
            "sha": "6e9fb02c1967753f16ff39653788ff0981497f7c",
            "filename": "packages/next/src/next-devtools/dev-overlay/panel/dynamic-panel.css",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.css",
            "raw_url": "https://github.com/vercel/next.js/raw/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.css?ref=d3ed546f49d903738bc09848e90afeefefe3cdfa",
            "patch": "@@ -0,0 +1,34 @@\n+/* Panel container base styles with dynamic positioning and sizing */\n+.dynamic-panel-container {\n+  position: fixed;\n+  z-index: 2147483646;\n+  outline: none;\n+  top: var(--panel-top, auto);\n+  bottom: var(--panel-bottom, auto);\n+  left: var(--panel-left, auto);\n+  right: var(--panel-right, auto);\n+  width: var(--panel-width);\n+  height: var(--panel-height);\n+  min-width: var(--panel-min-width);\n+  min-height: var(--panel-min-height);\n+  max-width: var(--panel-max-width);\n+  max-height: var(--panel-max-height);\n+}\n+\n+/* Panel content container styles */\n+.panel-content-container {\n+  position: relative;\n+  width: 100%;\n+  height: 100%;\n+  border: 1px solid var(--color-gray-alpha-400);\n+  border-radius: var(--rounded-xl);\n+  background: var(--color-background-100);\n+  display: flex;\n+  flex-direction: column;\n+}\n+\n+/* Draggable content area styles */\n+.draggable-content {\n+  flex: 1;\n+  overflow: auto;\n+}"
        },
        {
            "sha": "99551d7e3814591cb3ba0133ac76cb093bd5e9ca",
            "filename": "packages/next/src/next-devtools/dev-overlay/panel/dynamic-panel.tsx",
            "status": "modified",
            "additions": 32,
            "deletions": 26,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.tsx?ref=d3ed546f49d903738bc09848e90afeefefe3cdfa",
            "patch": "@@ -19,6 +19,7 @@ import {\n   STORE_KEY_SHARED_PANEL_SIZE,\n } from '../shared'\n import { getIndicatorOffset } from '../utils/indicator-metrics'\n+import './dynamic-panel.css'\n \n function resolveCSSValue(\n   value: string | number,\n@@ -235,23 +236,30 @@ export function DynamicPanel({\n       <div\n         tabIndex={-1}\n         ref={resizeContainerRef}\n-        style={{\n-          position: 'fixed',\n-          zIndex: 2147483646,\n-          outline: 'none',\n-          ...positionStyle,\n-          ...(isResizable\n-            ? {\n-                minWidth,\n-                minHeight,\n-                maxWidth,\n-                maxHeight,\n-              }\n-            : {\n-                height: panelSize ? panelSize.height : sizeConfig.height,\n-                width: panelSize ? panelSize.width : sizeConfig.width,\n-              }),\n-        }}\n+        className=\"dynamic-panel-container\"\n+        style={\n+          {\n+            '--panel-top': positionStyle.top,\n+            '--panel-bottom': positionStyle.bottom,\n+            '--panel-left': positionStyle.left,\n+            '--panel-right': positionStyle.right,\n+            ...(isResizable\n+              ? {\n+                  '--panel-min-width': minWidth ? `${minWidth}px` : undefined,\n+                  '--panel-min-height': minHeight\n+                    ? `${minHeight}px`\n+                    : undefined,\n+                  '--panel-max-width': maxWidth ? `${maxWidth}px` : undefined,\n+                  '--panel-max-height': maxHeight\n+                    ? `${maxHeight}px`\n+                    : undefined,\n+                }\n+              : {\n+                  '--panel-height': `${panelSize ? panelSize.height : sizeConfig.height}px`,\n+                  '--panel-width': `${panelSize ? panelSize.width : sizeConfig.width}px`,\n+                }),\n+          } as React.CSSProperties & Record<string, string | number | undefined>\n+        }\n       >\n         <DragProvider disabled={!draggable}>\n           <Draggable\n@@ -283,20 +291,18 @@ export function DynamicPanel({\n             <>\n               <div\n                 {...containerProps}\n+                className={`panel-content-container ${containerProps?.className || ''}`}\n                 style={{\n-                  position: 'relative',\n-                  width: '100%',\n-                  height: '100%',\n-                  border: '1px solid var(--color-gray-alpha-400)',\n-                  borderRadius: 'var(--rounded-xl)',\n-                  background: 'var(--color-background-100)',\n-                  display: 'flex',\n-                  flexDirection: 'column',\n                   ...containerProps?.style,\n                 }}\n               >\n                 <DragHandle>{header}</DragHandle>\n-                <div style={{ flex: 1, overflow: 'auto' }}>{children}</div>\n+                <div\n+                  data-nextjs-scrollable-content\n+                  className=\"draggable-content\"\n+                >\n+                  {children}\n+                </div>\n               </div>\n               {isResizable && (\n                 <>"
        },
        {
            "sha": "564b4b44eba1e4c85adf6ec8884b4fca981bdab4",
            "filename": "packages/next/src/next-devtools/global.css",
            "status": "modified",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fglobal.css",
            "raw_url": "https://github.com/vercel/next.js/raw/d3ed546f49d903738bc09848e90afeefefe3cdfa/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fglobal.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fglobal.css?ref=d3ed546f49d903738bc09848e90afeefefe3cdfa",
            "patch": "@@ -10,3 +10,34 @@\n * {\n   -webkit-font-smoothing: antialiased;\n }\n+\n+/* global reset for draggable content scrollbar styles */\n+[data-nextjs-scrollable-content],\n+[data-nextjs-scrollable-content] * {\n+  &::-webkit-scrollbar {\n+    width: 6px;\n+    height: 6px;\n+    border-radius: 0 0 1rem 1rem;\n+    margin-bottom: 1rem;\n+  }\n+\n+  &::-webkit-scrollbar-button {\n+    display: none;\n+  }\n+\n+  &::-webkit-scrollbar-track {\n+    border-radius: 0 0 1rem 1rem;\n+    background-color: var(--color-background-100);\n+  }\n+\n+  &::-webkit-scrollbar-thumb {\n+    border-radius: 1rem;\n+    background-color: var(--color-gray-500);\n+  }\n+}\n+\n+/* Place overflow: hidden on this so we can break out from [data-nextjs-dialog] */\n+[data-nextjs-scrollable-content] {\n+  overflow: hidden;\n+  border-radius: inherit;\n+}"
        }
    ],
    "stats": {
        "total": 206,
        "additions": 128,
        "deletions": 78
    }
}