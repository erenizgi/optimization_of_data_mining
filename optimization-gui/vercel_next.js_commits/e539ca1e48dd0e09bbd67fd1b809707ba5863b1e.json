{
    "author": "huozhi",
    "message": "build: error on different root folder (#83416)",
    "sha": "e539ca1e48dd0e09bbd67fd1b809707ba5863b1e",
    "files": [
        {
            "sha": "9f9220cfd7cf3ead1e165fb4b962b257ff35f49e",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=e539ca1e48dd0e09bbd67fd1b809707ba5863b1e",
            "patch": "@@ -798,5 +798,6 @@\n   \"797\": \"Failed to transpile \\\"%s\\\".\",\n   \"798\": \"expected a result to be returned\",\n   \"799\": \"expected a page response, got %s\",\n-  \"800\": \"`experimental.rdcForNavigations` is enabled, but `experimental.ppr` is not.\"\n+  \"800\": \"`experimental.rdcForNavigations` is enabled, but `experimental.ppr` is not.\",\n+  \"801\": \"> `pages` and `app` directories should be under the same folder\"\n }"
        },
        {
            "sha": "1fcd614f39fe4b59644073283203b6d0c7ffafe8",
            "filename": "packages/next/src/lib/find-pages-dir.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/packages%2Fnext%2Fsrc%2Flib%2Ffind-pages-dir.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/packages%2Fnext%2Fsrc%2Flib%2Ffind-pages-dir.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Ffind-pages-dir.ts?ref=e539ca1e48dd0e09bbd67fd1b809707ba5863b1e",
            "patch": "@@ -25,6 +25,16 @@ export function findPagesDir(dir: string): {\n     )\n   }\n \n+  if (pagesDir && appDir) {\n+    const pagesParent = path.dirname(pagesDir)\n+    const appParent = path.dirname(appDir)\n+    if (pagesParent !== appParent) {\n+      throw new Error(\n+        '> `pages` and `app` directories should be under the same folder'\n+      )\n+    }\n+  }\n+\n   return {\n     pagesDir,\n     appDir,"
        },
        {
            "sha": "2b1c371621800f200f50ecd9af37a20cb7611523",
            "filename": "test/integration/telemetry/test/index.test.js",
            "status": "modified",
            "additions": 0,
            "deletions": 75,
            "changes": 75,
            "blob_url": "https://github.com/vercel/next.js/blob/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fintegration%2Ftelemetry%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fintegration%2Ftelemetry%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Ftelemetry%2Ftest%2Findex.test.js?ref=e539ca1e48dd0e09bbd67fd1b809707ba5863b1e",
            "patch": "@@ -4,10 +4,6 @@ import path from 'path'\n import fs from 'fs-extra'\n import {\n   runNextCommand,\n-  launchApp,\n-  findPort,\n-  killApp,\n-  waitFor,\n   nextBuild,\n   findAllTelemetryEvents,\n } from 'next-test-utils'\n@@ -102,43 +98,6 @@ describe('Telemetry CLI', () => {\n   ;(process.env.TURBOPACK_DEV ? describe.skip : describe)(\n     'production mode',\n     () => {\n-      it('detects isSrcDir dir correctly for `next build`', async () => {\n-        // must clear cache for GSSP imports to be detected correctly\n-        await fs.remove(path.join(appDir, '.next'))\n-        const { stderr } = await runNextCommand(['build', appDir], {\n-          stderr: true,\n-          env: {\n-            NEXT_TELEMETRY_DEBUG: 1,\n-          },\n-        })\n-\n-        expect(stderr).toMatch(/isSrcDir.*?false/)\n-\n-        // Turbopack intentionally does not support these events\n-        if (!process.env.IS_TURBOPACK_TEST) {\n-          expect(stderr).toMatch(/package.*?\"fs\"/)\n-          expect(stderr).toMatch(/package.*?\"path\"/)\n-          expect(stderr).toMatch(/package.*?\"http\"/)\n-          expect(stderr).toMatch(/NEXT_PACKAGE_USED_IN_GET_SERVER_SIDE_PROPS/)\n-        }\n-        await fs.move(\n-          path.join(appDir, 'pages'),\n-          path.join(appDir, 'src/pages')\n-        )\n-        const { stderr: stderr2 } = await runNextCommand(['build', appDir], {\n-          stderr: true,\n-          env: {\n-            NEXT_TELEMETRY_DEBUG: 1,\n-          },\n-        })\n-        await fs.move(\n-          path.join(appDir, 'src/pages'),\n-          path.join(appDir, 'pages')\n-        )\n-\n-        expect(stderr2).toMatch(/isSrcDir.*?true/)\n-      })\n-\n       it('emits event when swc fails to load', async () => {\n         await fs.remove(path.join(appDir, '.next'))\n         const { stderr } = await runNextCommand(['build', appDir], {\n@@ -409,38 +368,4 @@ describe('Telemetry CLI', () => {\n       })\n     }\n   )\n-\n-  it('detects isSrcDir dir correctly for `next dev`', async () => {\n-    let port = await findPort()\n-    let stderr = ''\n-\n-    const handleStderr = (msg) => {\n-      stderr += msg\n-    }\n-    let app = await launchApp(appDir, port, {\n-      onStderr: handleStderr,\n-      env: {\n-        NEXT_TELEMETRY_DEBUG: 1,\n-      },\n-    })\n-    await waitFor(1000)\n-    await killApp(app)\n-    expect(stderr).toMatch(/isSrcDir.*?false/)\n-\n-    await fs.move(path.join(appDir, 'pages'), path.join(appDir, 'src/pages'))\n-    stderr = ''\n-\n-    port = await findPort()\n-    app = await launchApp(appDir, port, {\n-      onStderr: handleStderr,\n-      env: {\n-        NEXT_TELEMETRY_DEBUG: 1,\n-      },\n-    })\n-    await waitFor(1000)\n-    await killApp(app)\n-    await fs.move(path.join(appDir, 'src/pages'), path.join(appDir, 'pages'))\n-\n-    expect(stderr).toMatch(/isSrcDir.*?true/)\n-  })\n })"
        },
        {
            "sha": "8ea99a3b5af6f64b973e7ba8d405d71a6f56c867",
            "filename": "test/production/app-dir/bad-file-structure/bad-file-structure.test.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fbad-file-structure.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fbad-file-structure.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fbad-file-structure.test.ts?ref=e539ca1e48dd0e09bbd67fd1b809707ba5863b1e",
            "patch": "@@ -0,0 +1,18 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('bad-file-structure', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+    skipDeployment: true,\n+    skipStart: true,\n+  })\n+\n+  it('should error for bad file structure', async () => {\n+    await next.build()\n+\n+    const output = next.cliOutput\n+    expect(output).toContain(\n+      '`pages` and `app` directories should be under the same folder'\n+    )\n+  })\n+})"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/production/app-dir/bad-file-structure/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fnext.config.js?ref=e539ca1e48dd0e09bbd67fd1b809707ba5863b1e",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "7e900dc1e8914909c41a9359161c6c9356c95bd7",
            "filename": "test/production/app-dir/bad-file-structure/pages/foo.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fpages%2Ffoo.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fpages%2Ffoo.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fpages%2Ffoo.tsx?ref=e539ca1e48dd0e09bbd67fd1b809707ba5863b1e",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>foo</p>\n+}"
        },
        {
            "sha": "888614deda3ba5d744d1a7e5dac131038dba2b12",
            "filename": "test/production/app-dir/bad-file-structure/src/app/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fsrc%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fsrc%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fsrc%2Fapp%2Flayout.tsx?ref=e539ca1e48dd0e09bbd67fd1b809707ba5863b1e",
            "patch": "@@ -0,0 +1,8 @@\n+import { ReactNode } from 'react'\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "4c4c38c60f2974cfe37d37817bc27b63d5d602c7",
            "filename": "test/production/app-dir/bad-file-structure/src/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fsrc%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/e539ca1e48dd0e09bbd67fd1b809707ba5863b1e/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fsrc%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fbad-file-structure%2Fsrc%2Fapp%2Fpage.tsx?ref=e539ca1e48dd0e09bbd67fd1b809707ba5863b1e",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>index</p>\n+}"
        }
    ],
    "stats": {
        "total": 126,
        "additions": 50,
        "deletions": 76
    }
}