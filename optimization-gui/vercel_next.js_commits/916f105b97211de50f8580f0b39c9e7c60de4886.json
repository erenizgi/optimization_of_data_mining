{
    "author": "ijjk",
    "message": "Update middleware public/static matching (#78325)\n\nThis updates our matcher handling for middleware to ensure we check\nencoded/decoded versions of the pathname since the regex will most often\nnot handle all encoding variations. This matcher change only affects\npublic/static files as pages/API routes doesn't allow mismatching\nencoding.",
    "sha": "916f105b97211de50f8580f0b39c9e7c60de4886",
    "files": [
        {
            "sha": "9f35dea53f9fff9a76da15d8c58a6f4be6938285",
            "filename": "packages/next/src/server/lib/router-utils/resolve-routes.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 1,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fresolve-routes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fresolve-routes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fresolve-routes.ts?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -461,9 +461,23 @@ export function getResolveRoutes(\n \n         if (!opts.minimalMode && route.name === 'middleware') {\n           const match = fsChecker.getMiddlewareMatchers()\n+          let maybeDecodedPathname = parsedUrl.pathname || '/'\n+\n+          try {\n+            maybeDecodedPathname = decodeURIComponent(maybeDecodedPathname)\n+          } catch {\n+            /* non-fatal we can't decode so can't match it */\n+          }\n+\n           if (\n             // @ts-expect-error BaseNextRequest stuff\n-            match?.(parsedUrl.pathname, req, parsedUrl.query)\n+            match?.(parsedUrl.pathname, req, parsedUrl.query) ||\n+            match?.(\n+              maybeDecodedPathname,\n+              // @ts-expect-error BaseNextRequest stuff\n+              req,\n+              parsedUrl.query\n+            )\n           ) {\n             if (ensureMiddleware) {\n               await ensureMiddleware(req.url)"
        },
        {
            "sha": "26111cccc049da9a0e83dc5d0d8e1cb954e901cd",
            "filename": "packages/next/src/server/next-server.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 1,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -1768,7 +1768,20 @@ export default class NextNodeServer extends BaseServer<\n \n     parsedUrl.pathname = pathnameInfo.pathname\n     const normalizedPathname = removeTrailingSlash(parsed.pathname || '')\n-    if (!middleware.match(normalizedPathname, req, parsedUrl.query)) {\n+    let maybeDecodedPathname = normalizedPathname\n+\n+    try {\n+      maybeDecodedPathname = decodeURIComponent(normalizedPathname)\n+    } catch {\n+      /* non-fatal we can't decode so can't match it */\n+    }\n+\n+    if (\n+      !(\n+        middleware.match(normalizedPathname, req, parsedUrl.query) ||\n+        middleware.match(maybeDecodedPathname, req, parsedUrl.query)\n+      )\n+    ) {\n       return handleFinished()\n     }\n "
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/e2e/middleware-static-files/app/app/another/hello/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fanother%2Fhello%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fanother%2Fhello%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fanother%2Fhello%2Fpage.tsx?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/e2e/middleware-static-files/app/app/dynamic/[slug]/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fdynamic%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fdynamic%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fdynamic%2F%5Bslug%5D%2Fpage.tsx?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "718d6fea4835ec2d246af9800eddb7ffb276240c",
            "filename": "test/e2e/middleware-static-files/app/app/favicon.ico",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Ffavicon.ico",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Ffavicon.ico",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Ffavicon.ico?ref=916f105b97211de50f8580f0b39c9e7c60de4886"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/e2e/middleware-static-files/app/app/glob/hello/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fglob%2Fhello%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fglob%2Fhello%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fglob%2Fhello%2Fpage.tsx?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "6b8b4518030f13c93b450657aba1fc2d4e9cf0c6",
            "filename": "test/e2e/middleware-static-files/app/app/layout.tsx",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Flayout.tsx?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,18 @@\n+import type { Metadata } from 'next'\n+\n+export const metadata: Metadata = {\n+  title: 'Create Next App',\n+  description: 'Generated by create next app',\n+}\n+\n+export default function RootLayout({\n+  children,\n+}: Readonly<{\n+  children: React.ReactNode\n+}>) {\n+  return (\n+    <html lang=\"en\">\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "7a5011548102abb7885c76ae2a19d163f8d05153",
            "filename": "test/e2e/middleware-static-files/app/app/page.tsx",
            "status": "added",
            "additions": 103,
            "deletions": 0,
            "changes": 103,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fapp%2Fpage.tsx?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,103 @@\n+import Image from 'next/image'\n+\n+export default function Home() {\n+  return (\n+    <div className=\"grid grid-rows-[20px_1fr_20px] items-center justify-items-center min-h-screen p-8 pb-20 gap-16 sm:p-20 font-[family-name:var(--font-geist-sans)]\">\n+      <main className=\"flex flex-col gap-[32px] row-start-2 items-center sm:items-start\">\n+        <Image\n+          className=\"dark:invert\"\n+          src=\"/next.svg\"\n+          alt=\"Next.js logo\"\n+          width={180}\n+          height={38}\n+          priority\n+        />\n+        <ol className=\"list-inside list-decimal text-sm/6 text-center sm:text-left font-[family-name:var(--font-geist-mono)]\">\n+          <li className=\"mb-2 tracking-[-.01em]\">\n+            Get started by editing{' '}\n+            <code className=\"bg-black/[.05] dark:bg-white/[.06] px-1 py-0.5 rounded font-[family-name:var(--font-geist-mono)] font-semibold\">\n+              app/page.tsx\n+            </code>\n+            .\n+          </li>\n+          <li className=\"tracking-[-.01em]\">\n+            Save and see your changes instantly.\n+          </li>\n+        </ol>\n+\n+        <div className=\"flex gap-4 items-center flex-col sm:flex-row\">\n+          <a\n+            className=\"rounded-full border border-solid border-transparent transition-colors flex items-center justify-center bg-foreground text-background gap-2 hover:bg-[#383838] dark:hover:bg-[#ccc] font-medium text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5 sm:w-auto\"\n+            href=\"https://vercel.com/new?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app\"\n+            target=\"_blank\"\n+            rel=\"noopener noreferrer\"\n+          >\n+            <Image\n+              className=\"dark:invert\"\n+              src=\"/vercel.svg\"\n+              alt=\"Vercel logomark\"\n+              width={20}\n+              height={20}\n+            />\n+            Deploy now\n+          </a>\n+          <a\n+            className=\"rounded-full border border-solid border-black/[.08] dark:border-white/[.145] transition-colors flex items-center justify-center hover:bg-[#f2f2f2] dark:hover:bg-[#1a1a1a] hover:border-transparent font-medium text-sm sm:text-base h-10 sm:h-12 px-4 sm:px-5 w-full sm:w-auto md:w-[158px]\"\n+            href=\"https://nextjs.org/docs?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app\"\n+            target=\"_blank\"\n+            rel=\"noopener noreferrer\"\n+          >\n+            Read our docs\n+          </a>\n+        </div>\n+      </main>\n+      <footer className=\"row-start-3 flex gap-[24px] flex-wrap items-center justify-center\">\n+        <a\n+          className=\"flex items-center gap-2 hover:underline hover:underline-offset-4\"\n+          href=\"https://nextjs.org/learn?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app\"\n+          target=\"_blank\"\n+          rel=\"noopener noreferrer\"\n+        >\n+          <Image\n+            aria-hidden\n+            src=\"/file.svg\"\n+            alt=\"File icon\"\n+            width={16}\n+            height={16}\n+          />\n+          Learn\n+        </a>\n+        <a\n+          className=\"flex items-center gap-2 hover:underline hover:underline-offset-4\"\n+          href=\"https://vercel.com/templates?framework=next.js&utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app\"\n+          target=\"_blank\"\n+          rel=\"noopener noreferrer\"\n+        >\n+          <Image\n+            aria-hidden\n+            src=\"/window.svg\"\n+            alt=\"Window icon\"\n+            width={16}\n+            height={16}\n+          />\n+          Examples\n+        </a>\n+        <a\n+          className=\"flex items-center gap-2 hover:underline hover:underline-offset-4\"\n+          href=\"https://nextjs.org?utm_source=create-next-app&utm_medium=appdir-template-tw&utm_campaign=create-next-app\"\n+          target=\"_blank\"\n+          rel=\"noopener noreferrer\"\n+        >\n+          <Image\n+            aria-hidden\n+            src=\"/globe.svg\"\n+            alt=\"Globe icon\"\n+            width={16}\n+            height={16}\n+          />\n+          Go to nextjs.org â†’\n+        </a>\n+      </footer>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "6a444b3795aec71d1b69d82065f8fd38ff58705a",
            "filename": "test/e2e/middleware-static-files/app/middleware.js",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fmiddleware.js",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fmiddleware.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fmiddleware.js?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,20 @@\n+import { NextResponse } from 'next/server'\n+\n+export const config = {\n+  matcher: [\n+    '/file.svg',\n+    '/vercel copy.svg',\n+    '/another/file.svg',\n+    '/another/hello',\n+    '/dynamic/:path*',\n+    '/glob/:path*',\n+    '/pages-another/hello',\n+    '/pages-dynamic/:path*',\n+    '/pages-glob/:path*',\n+    '/_next/static/css/:path*',\n+  ],\n+}\n+\n+export default function middleware() {\n+  return NextResponse.json({ middleware: true })\n+}"
        },
        {
            "sha": "11bce713475d76c8053b2e03680a45d11c208e19",
            "filename": "test/e2e/middleware-static-files/app/pages/pages-another/hello.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-another%2Fhello.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-another%2Fhello.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-another%2Fhello.tsx?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,9 @@\n+import React from 'react'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <p>pages-another/hello</p>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "11bce713475d76c8053b2e03680a45d11c208e19",
            "filename": "test/e2e/middleware-static-files/app/pages/pages-dynamic/[slug].tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-dynamic%2F%5Bslug%5D.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-dynamic%2F%5Bslug%5D.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-dynamic%2F%5Bslug%5D.tsx?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,9 @@\n+import React from 'react'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <p>pages-another/hello</p>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "5cbb1546d08e270444c218b3738273bfd88560aa",
            "filename": "test/e2e/middleware-static-files/app/pages/pages-glob/hello.module.css",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-glob%2Fhello.module.css",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-glob%2Fhello.module.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-glob%2Fhello.module.css?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,3 @@\n+.text {\n+  color: orange;\n+}"
        },
        {
            "sha": "cf2fff96c90f78f9a9c7fb4ffb7faba3a547c459",
            "filename": "test/e2e/middleware-static-files/app/pages/pages-glob/hello.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-glob%2Fhello.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-glob%2Fhello.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpages%2Fpages-glob%2Fhello.tsx?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,10 @@\n+import React from 'react'\n+import * as styles from './hello.module.css'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <p className={styles['text']}>pages-another/hello</p>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "004145cddf3f9db91b57b9cb596683c8eb420862",
            "filename": "test/e2e/middleware-static-files/app/public/another/file.svg",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fanother%2Ffile.svg",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fanother%2Ffile.svg",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fanother%2Ffile.svg?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1 @@\n+<svg fill=\"none\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z\" clip-rule=\"evenodd\" fill=\"#666\" fill-rule=\"evenodd\"/></svg>\n\\ No newline at end of file"
        },
        {
            "sha": "004145cddf3f9db91b57b9cb596683c8eb420862",
            "filename": "test/e2e/middleware-static-files/app/public/file.svg",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Ffile.svg",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Ffile.svg",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Ffile.svg?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1 @@\n+<svg fill=\"none\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z\" clip-rule=\"evenodd\" fill=\"#666\" fill-rule=\"evenodd\"/></svg>\n\\ No newline at end of file"
        },
        {
            "sha": "004145cddf3f9db91b57b9cb596683c8eb420862",
            "filename": "test/e2e/middleware-static-files/app/public/glob/file.svg",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fglob%2Ffile.svg",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fglob%2Ffile.svg",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fglob%2Ffile.svg?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1 @@\n+<svg fill=\"none\" viewBox=\"0 0 16 16\" xmlns=\"http://www.w3.org/2000/svg\"><path d=\"M14.5 13.5V5.41a1 1 0 0 0-.3-.7L9.8.29A1 1 0 0 0 9.08 0H1.5v13.5A2.5 2.5 0 0 0 4 16h8a2.5 2.5 0 0 0 2.5-2.5m-1.5 0v-7H8v-5H3v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1M9.5 5V2.12L12.38 5zM5.13 5h-.62v1.25h2.12V5zm-.62 3h7.12v1.25H4.5zm.62 3h-.62v1.25h7.12V11z\" clip-rule=\"evenodd\" fill=\"#666\" fill-rule=\"evenodd\"/></svg>\n\\ No newline at end of file"
        },
        {
            "sha": "567f17b0d7c7fb662c16d4357dd74830caf2dccb",
            "filename": "test/e2e/middleware-static-files/app/public/globe.svg",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fglobe.svg",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fglobe.svg",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fglobe.svg?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1 @@\n+<svg fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\"><g clip-path=\"url(#a)\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M10.27 14.1a6.5 6.5 0 0 0 3.67-3.45q-1.24.21-2.7.34-.31 1.83-.97 3.1M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16m.48-1.52a7 7 0 0 1-.96 0H7.5a4 4 0 0 1-.84-1.32q-.38-.89-.63-2.08a40 40 0 0 0 3.92 0q-.25 1.2-.63 2.08a4 4 0 0 1-.84 1.31zm2.94-4.76q1.66-.15 2.95-.43a7 7 0 0 0 0-2.58q-1.3-.27-2.95-.43a18 18 0 0 1 0 3.44m-1.27-3.54a17 17 0 0 1 0 3.64 39 39 0 0 1-4.3 0 17 17 0 0 1 0-3.64 39 39 0 0 1 4.3 0m1.1-1.17q1.45.13 2.69.34a6.5 6.5 0 0 0-3.67-3.44q.65 1.26.98 3.1M8.48 1.5l.01.02q.41.37.84 1.31.38.89.63 2.08a40 40 0 0 0-3.92 0q.25-1.2.63-2.08a4 4 0 0 1 .85-1.32 7 7 0 0 1 .96 0m-2.75.4a6.5 6.5 0 0 0-3.67 3.44 29 29 0 0 1 2.7-.34q.31-1.83.97-3.1M4.58 6.28q-1.66.16-2.95.43a7 7 0 0 0 0 2.58q1.3.27 2.95.43a18 18 0 0 1 0-3.44m.17 4.71q-1.45-.12-2.69-.34a6.5 6.5 0 0 0 3.67 3.44q-.65-1.27-.98-3.1\" fill=\"#666\"/></g><defs><clipPath id=\"a\"><path fill=\"#fff\" d=\"M0 0h16v16H0z\"/></clipPath></defs></svg>\n\\ No newline at end of file"
        },
        {
            "sha": "5174b28c565c285e3e312ec5178be64fbeca8398",
            "filename": "test/e2e/middleware-static-files/app/public/next.svg",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fnext.svg",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fnext.svg",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fnext.svg?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1 @@\n+<svg xmlns=\"http://www.w3.org/2000/svg\" fill=\"none\" viewBox=\"0 0 394 80\"><path fill=\"#000\" d=\"M262 0h68.5v12.7h-27.2v66.6h-13.6V12.7H262V0ZM149 0v12.7H94v20.4h44.3v12.6H94v21h55v12.6H80.5V0h68.7zm34.3 0h-17.8l63.8 79.4h17.9l-32-39.7 32-39.6h-17.9l-23 28.6-23-28.6zm18.3 56.7-9-11-27.1 33.7h17.8l18.3-22.7z\"/><path fill=\"#000\" d=\"M81 79.3 17 0H0v79.3h13.6V17l50.2 62.3H81Zm252.6-.4c-1 0-1.8-.4-2.5-1s-1.1-1.6-1.1-2.6.3-1.8 1-2.5 1.6-1 2.6-1 1.8.3 2.5 1a3.4 3.4 0 0 1 .6 4.3 3.7 3.7 0 0 1-3 1.8zm23.2-33.5h6v23.3c0 2.1-.4 4-1.3 5.5a9.1 9.1 0 0 1-3.8 3.5c-1.6.8-3.5 1.3-5.7 1.3-2 0-3.7-.4-5.3-1s-2.8-1.8-3.7-3.2c-.9-1.3-1.4-3-1.4-5h6c.1.8.3 1.6.7 2.2s1 1.2 1.6 1.5c.7.4 1.5.5 2.4.5 1 0 1.8-.2 2.4-.6a4 4 0 0 0 1.6-1.8c.3-.8.5-1.8.5-3V45.5zm30.9 9.1a4.4 4.4 0 0 0-2-3.3 7.5 7.5 0 0 0-4.3-1.1c-1.3 0-2.4.2-3.3.5-.9.4-1.6 1-2 1.6a3.5 3.5 0 0 0-.3 4c.3.5.7.9 1.3 1.2l1.8 1 2 .5 3.2.8c1.3.3 2.5.7 3.7 1.2a13 13 0 0 1 3.2 1.8 8.1 8.1 0 0 1 3 6.5c0 2-.5 3.7-1.5 5.1a10 10 0 0 1-4.4 3.5c-1.8.8-4.1 1.2-6.8 1.2-2.6 0-4.9-.4-6.8-1.2-2-.8-3.4-2-4.5-3.5a10 10 0 0 1-1.7-5.6h6a5 5 0 0 0 3.5 4.6c1 .4 2.2.6 3.4.6 1.3 0 2.5-.2 3.5-.6 1-.4 1.8-1 2.4-1.7a4 4 0 0 0 .8-2.4c0-.9-.2-1.6-.7-2.2a11 11 0 0 0-2.1-1.4l-3.2-1-3.8-1c-2.8-.7-5-1.7-6.6-3.2a7.2 7.2 0 0 1-2.4-5.7 8 8 0 0 1 1.7-5 10 10 0 0 1 4.3-3.5c2-.8 4-1.2 6.4-1.2 2.3 0 4.4.4 6.2 1.2 1.8.8 3.2 2 4.3 3.4 1 1.4 1.5 3 1.5 5h-5.8z\"/></svg>\n\\ No newline at end of file"
        },
        {
            "sha": "77053960334e2e34dc584dea8019925c3b4ccca9",
            "filename": "test/e2e/middleware-static-files/app/public/vercel copy.svg",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fvercel%20copy.svg",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fvercel%20copy.svg",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fvercel%20copy.svg?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1 @@\n+<svg fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1155 1000\"><path d=\"m577.3 0 577.4 1000H0z\" fill=\"#fff\"/></svg>\n\\ No newline at end of file"
        },
        {
            "sha": "77053960334e2e34dc584dea8019925c3b4ccca9",
            "filename": "test/e2e/middleware-static-files/app/public/vercel.svg",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fvercel.svg",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fvercel.svg",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fvercel.svg?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1 @@\n+<svg fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 1155 1000\"><path d=\"m577.3 0 577.4 1000H0z\" fill=\"#fff\"/></svg>\n\\ No newline at end of file"
        },
        {
            "sha": "b2b2a44f6ebc70c450043c05a002e7a93ba5d651",
            "filename": "test/e2e/middleware-static-files/app/public/window.svg",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fwindow.svg",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fwindow.svg",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Fapp%2Fpublic%2Fwindow.svg?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1 @@\n+<svg fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 16 16\"><path fill-rule=\"evenodd\" clip-rule=\"evenodd\" d=\"M1.5 2.5h13v10a1 1 0 0 1-1 1h-11a1 1 0 0 1-1-1zM0 1h16v11.5a2.5 2.5 0 0 1-2.5 2.5h-11A2.5 2.5 0 0 1 0 12.5zm3.75 4.5a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5M7 4.75a.75.75 0 1 1-1.5 0 .75.75 0 0 1 1.5 0m1.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5\" fill=\"#666\"/></svg>\n\\ No newline at end of file"
        },
        {
            "sha": "66c595822a835648d6d8c2fb35a182f6317bdef3",
            "filename": "test/e2e/middleware-static-files/index.test.ts",
            "status": "added",
            "additions": 82,
            "deletions": 0,
            "changes": 82,
            "blob_url": "https://github.com/vercel/next.js/blob/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/916f105b97211de50f8580f0b39c9e7c60de4886/test%2Fe2e%2Fmiddleware-static-files%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-static-files%2Findex.test.ts?ref=916f105b97211de50f8580f0b39c9e7c60de4886",
            "patch": "@@ -0,0 +1,82 @@\n+/* eslint-env jest */\n+\n+import glob from 'glob'\n+import { join } from 'path'\n+import { createNext, FileRef } from 'e2e-utils'\n+import { isNextStart, NextInstance } from 'e2e-utils'\n+\n+describe('Middleware Runtime', () => {\n+  let next: NextInstance\n+  let testPaths: Array<{ testPath: string }> = [\n+    { testPath: '/file.svg' },\n+    { testPath: '/vercel copy.svg' },\n+    { testPath: '/vercel%20copy.svg' },\n+    { testPath: '/another%2ffile.svg' },\n+    { testPath: '/another/file.svg' },\n+    { testPath: '/another/hello' },\n+    { testPath: '/another%2fhello' },\n+    { testPath: '/glob%2ffile.svg' },\n+    { testPath: '/glob/file.svg' },\n+    { testPath: '/dynamic%2f/first' },\n+    { testPath: '/dynamic/first' },\n+    { testPath: '/glob%2fhello' },\n+    { testPath: '/glob/hello' },\n+    { testPath: '/pages-another/hello' },\n+    { testPath: '/pages-another%2fhello' },\n+    { testPath: '/pages-dynamic%2f/first' },\n+    { testPath: '/pages-dynamic/first' },\n+    { testPath: '/pages-glob%2fhello' },\n+    { testPath: '/pages-glob/hello' },\n+  ]\n+\n+  beforeAll(async () => {\n+    next = await createNext({\n+      files: new FileRef(join(__dirname, 'app')),\n+    })\n+  })\n+  afterAll(async () => {\n+    await next.destroy()\n+  })\n+\n+  it.each(testPaths)(\n+    'should match middleware correctly for $testPath',\n+    async ({ testPath }) => {\n+      const res = await next.fetch(testPath, {\n+        redirect: 'manual',\n+      })\n+\n+      if (res.status === 404) {\n+        expect(await res.text()).toContain('page could not be found')\n+      } else {\n+        expect(await res.json()).toEqual({ middleware: true })\n+      }\n+    }\n+  )\n+\n+  if (isNextStart && !process.env.IS_TURBOPACK_TEST) {\n+    it('should match middleware of _next/static', async () => {\n+      const cssChunks = glob.sync('*.css', {\n+        cwd: join(next.testDir, '.next', 'static', 'css'),\n+      })\n+\n+      if (cssChunks.length < 1) {\n+        throw new Error(`Failed to find CSS chunk`)\n+      }\n+\n+      for (const testPath of [\n+        `/_next/static/css%2f${cssChunks[0]}`,\n+        `/_next/static/css/${cssChunks[0]}`,\n+      ]) {\n+        const res = await next.fetch(testPath, {\n+          redirect: 'manual',\n+        })\n+\n+        if (res.status === 404) {\n+          expect(await res.text()).toContain('page could not be found')\n+        } else {\n+          expect(await res.json()).toEqual({ middleware: true })\n+        }\n+      }\n+    })\n+  }\n+})"
        }
    ],
    "stats": {
        "total": 302,
        "additions": 300,
        "deletions": 2
    }
}