{
    "author": "huozhi",
    "message": "[metadata] remove the default segement check for metadata rendering (#77119)\n\n### What\n\nRemove the default segment checks for metadata rendering. When the\n`default.js` is rendered, it should still have the metadata. It was a\ncondition added due to possible of duplicated metadata, but it's\nresolved by other conditions such as only rendering in child slot, and\nhoisting metadata into rsc head for navigation.",
    "sha": "5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
    "files": [
        {
            "sha": "e28dfeda953dd3b1b199366b479b3c1d9ec70aa3",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 12,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -21,7 +21,6 @@ import type { LoadingModuleData } from '../../shared/lib/app-router-context.shar\n import type { Params } from '../request/params'\n import { workUnitAsyncStorage } from './work-unit-async-storage.external'\n import { OUTLET_BOUNDARY_NAME } from '../../lib/metadata/metadata-constants'\n-import { DEFAULT_SEGMENT_KEY } from '../../shared/lib/segment'\n import type { UseCachePageComponentProps } from '../use-cache/use-cache-wrapper'\n \n /**\n@@ -394,19 +393,12 @@ async function createComponentTreeInternal({\n \n   // Resolve the segment param\n   const actualSegment = segmentParam ? segmentParam.treeSegment : segment\n-\n-  // Only render metadata on the actual SSR'd segment not the `default` segment,\n-  // as it's used as a placeholder for navigation.\n-  const isNotDefaultSegment = actualSegment !== DEFAULT_SEGMENT_KEY\n-\n-  const metadata =\n-    isNotDefaultSegment && StreamingMetadata ? <StreamingMetadata /> : undefined\n+  const metadata = StreamingMetadata ? <StreamingMetadata /> : undefined\n \n   // Use the same condition to render metadataOutlet as metadata\n-  const metadataOutlet =\n-    isNotDefaultSegment && StreamingMetadataOutlet ? (\n-      <StreamingMetadataOutlet />\n-    ) : undefined\n+  const metadataOutlet = StreamingMetadataOutlet ? (\n+    <StreamingMetadataOutlet />\n+  ) : undefined\n \n   const notFoundElement = NotFound ? (\n     <>"
        },
        {
            "sha": "af601aced5059af89d812c79a74d3e13714e4000",
            "filename": "test/e2e/app-dir/metadata-streaming/app/dynamic-api/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fdynamic-api%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fdynamic-api%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fdynamic-api%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -23,7 +23,7 @@ async function SubComponent() {\n \n export async function generateMetadata() {\n   await connection()\n-  await new Promise((resolve) => setTimeout(resolve, 3000))\n+  await new Promise((resolve) => setTimeout(resolve, 800))\n   return {\n     title: `Dynamic api ${Math.random()}`,\n   }"
        },
        {
            "sha": "e355998a4433c4d5dbc1dd3722978a2c5abe0b4a",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/@bar/default.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Fdefault.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'default @bar'\n+}"
        },
        {
            "sha": "1e18e748cf81e93f454e9cd71ce7617948880703",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/@bar/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Flayout.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Layout({ children }) {\n+  return (\n+    <div>\n+      <h2>@bar Layout</h2>\n+      <div id=\"bar-children\">{children}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "eb4a3e2e9df71d0f81f102128ee52511d9c00b22",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/@bar/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'page @bar'\n+}"
        },
        {
            "sha": "bff087a3a98f99941044142b6601e0ffd4150fe7",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/@bar/test-page/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Ftest-page%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Ftest-page%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40bar%2Ftest-page%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'test-page @bar'\n+}"
        },
        {
            "sha": "408576f1876b586e90b61480df9db74ef6568ea8",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/@foo/default.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Fdefault.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'default @foo'\n+}"
        },
        {
            "sha": "05a3bda4f7be80fce7cf6de65a53e33e8c9bab6f",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/@foo/layout.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Flayout.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Layout({ children }) {\n+  return (\n+    <div>\n+      <h2>@foo Layout</h2>\n+      <div id=\"foo-children\">{children}</div>\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "44ab40e2ddfce8edb4eacbe5002a952280294d72",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/@foo/no-bar/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Fno-bar%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Fno-bar%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Fno-bar%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'no-bar @foo'\n+}"
        },
        {
            "sha": "3536981cea3ff4875f8b1ffea941e755e6268832",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/@foo/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'page @foo'\n+}"
        },
        {
            "sha": "8eff01dbe6deca778649eae4eacb6e07e14a0d3c",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/@foo/test-page/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Ftest-page%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Ftest-page%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2F%40foo%2Ftest-page%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'test-page @foo'\n+}"
        },
        {
            "sha": "2b713383cfcdbd4a6f1688b6454267446cedaa71",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/default.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Fdefault.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Fdefault.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Fdefault.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return 'default no-children'\n+}"
        },
        {
            "sha": "907190e027c57c6567c9f6fd9b2e6e25d54e18e3",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/layout.tsx",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Flayout.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,22 @@\n+import { connection } from 'next/server'\n+\n+export default function Layout({ bar, foo, children }) {\n+  return (\n+    <div>\n+      <h1>Parallel Routes Layout - No Children</h1>\n+      <div id=\"foo-slot\">{foo}</div>\n+      <div id=\"bar-slot\">{bar}</div>\n+\n+      {/* hitting default.js */}\n+      {children}\n+    </div>\n+  )\n+}\n+\n+export async function generateMetadata() {\n+  await connection()\n+  await new Promise((resolve) => setTimeout(resolve, 300))\n+  return {\n+    title: 'parallel-routes-default layout title',\n+  }\n+}"
        },
        {
            "sha": "640e2e61603f7c8839555a6cadf2a9211ab7ba55",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/no-bar/page.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Fno-bar%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Fno-bar%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Fno-bar%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,13 @@\n+import { connection } from 'next/server'\n+\n+export default function TestPage() {\n+  return 'test page'\n+}\n+\n+export async function generateMetadata() {\n+  await connection()\n+  await new Promise((resolve) => setTimeout(resolve, 3000))\n+  return {\n+    title: `Dynamic api ${Math.random()}`,\n+  }\n+}"
        },
        {
            "sha": "4fee1a94819fb6caca49c2c9a01dfc21b9a83a86",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes-default/test-page/page.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Ftest-page%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Ftest-page%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes-default%2Ftest-page%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -0,0 +1,13 @@\n+import { connection } from 'next/server'\n+\n+export default function TestPage() {\n+  return 'test page'\n+}\n+\n+export async function generateMetadata() {\n+  await connection()\n+  await new Promise((resolve) => setTimeout(resolve, 1000))\n+  return {\n+    title: `Dynamic api ${Math.random()}`,\n+  }\n+}"
        },
        {
            "sha": "773d8bbaa17198bdef479afa3a9a9dbf65ae577a",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/no-bar/page.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Fno-bar%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Fno-bar%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Fno-bar%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -1,13 +1,20 @@\n+import Link from 'next/link'\n import { connection } from 'next/server'\n \n-export default function TestPage() {\n-  return 'test page'\n+export default function Page() {\n+  return (\n+    <div>\n+      <p>no bar</p>\n+      <Link href=\"/parallel-routes\">Back to /parallel-routes</Link>\n+    </div>\n+  )\n }\n \n export async function generateMetadata() {\n   await connection()\n-  await new Promise((resolve) => setTimeout(resolve, 3000))\n+  await new Promise((resolve) => setTimeout(resolve, 1000))\n   return {\n     title: `Dynamic api ${Math.random()}`,\n+    description: 'no-bar description',\n   }\n }"
        },
        {
            "sha": "4ce809e3634d1c746d8c85c6b4d89658e86710ca",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/page.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -3,15 +3,17 @@ import Link from 'next/link'\n export default function Page() {\n   return (\n     <div>\n-      Hello from Nested{' '}\n+      Hello from Nested <br />\n       <Link href=\"/parallel-routes/test-page\">\n         To /parallel-routes/test-page\n       </Link>\n+      <br />\n       <Link href=\"/parallel-routes/no-bar\">To /parallel-routes/no-bar</Link>\n     </div>\n   )\n }\n \n export const metadata = {\n   title: 'parallel title',\n+  description: 'parallel description',\n }"
        },
        {
            "sha": "4fee1a94819fb6caca49c2c9a01dfc21b9a83a86",
            "filename": "test/e2e/app-dir/metadata-streaming/app/parallel-routes/test-page/page.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Ftest-page%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Ftest-page%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fapp%2Fparallel-routes%2Ftest-page%2Fpage.tsx?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -6,7 +6,7 @@ export default function TestPage() {\n \n export async function generateMetadata() {\n   await connection()\n-  await new Promise((resolve) => setTimeout(resolve, 3000))\n+  await new Promise((resolve) => setTimeout(resolve, 1000))\n   return {\n     title: `Dynamic api ${Math.random()}`,\n   }"
        },
        {
            "sha": "121df695128aed645c4f864c61f30c67304da7a7",
            "filename": "test/e2e/app-dir/metadata-streaming/metadata-streaming.test.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts?ref=5e8119da9f6e468e4ffff6e2ebe5daf2ff82b6f0",
            "patch": "@@ -93,9 +93,11 @@ describe('app-dir - metadata-streaming', () => {\n \n     expect((await browser.elementsByCss('head title')).length).toBe(1)\n     expect((await browser.elementsByCss('body title')).length).toBe(0)\n+    expect(await browser.elementByCss('title').text()).toBe('parallel title')\n \n     const $ = await next.render$('/parallel-routes')\n     expect($('title').length).toBe(1)\n+    expect($('head title').text()).toBe('parallel title')\n \n     // validate behavior remains the same on client navigations\n     await browser.elementByCss('[href=\"/parallel-routes/test-page\"]').click()\n@@ -113,13 +115,29 @@ describe('app-dir - metadata-streaming', () => {\n     const browser = await next.browser('/parallel-routes')\n     await browser.elementByCss('[href=\"/parallel-routes/no-bar\"]').click()\n \n+    // Wait for navigation is finished and metadata is updated\n     await retry(async () => {\n       expect(await browser.elementByCss('title').text()).toContain(\n         'Dynamic api'\n       )\n     })\n \n+    await retry(async () => {\n+      expect((await browser.elementsByCss('title')).length).toBe(1)\n+    })\n+  })\n+\n+  it('should still render metadata if children is not rendered in parallel routes layout', async () => {\n+    const browser = await next.browser('/parallel-routes-default')\n+\n     expect((await browser.elementsByCss('title')).length).toBe(1)\n+    expect(await browser.elementByCss('body title').text()).toBe(\n+      'parallel-routes-default layout title'\n+    )\n+\n+    const $ = await next.render$('/parallel-routes-default')\n+    expect($('title').length).toBe(1)\n+    expect($('body title').text()).toBe('parallel-routes-default layout title')\n   })\n \n   describe('dynamic api', () => {"
        }
    ],
    "stats": {
        "total": 143,
        "additions": 125,
        "deletions": 18
    }
}