{
    "author": "lukesandberg",
    "message": "[turbopack] Add an execution test for the behavior when a module throws an error (#83451)\n\nConfirms that we don't re-evaluate modules after an error\n\nClearing the require.cache allows us to re-evaluate",
    "sha": "a270b00e4c29f1829ed887e459f69a71ef488ea2",
    "files": [
        {
            "sha": "7f927522de7382c45c8948a4388f323310119f6d",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/evaluation-errors/basic/input/index.js",
            "status": "added",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/a270b00e4c29f1829ed887e459f69a71ef488ea2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fevaluation-errors%2Fbasic%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/a270b00e4c29f1829ed887e459f69a71ef488ea2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fevaluation-errors%2Fbasic%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fevaluation-errors%2Fbasic%2Finput%2Findex.js?ref=a270b00e4c29f1829ed887e459f69a71ef488ea2",
            "patch": "@@ -0,0 +1,23 @@\n+it('module evaluation rethrows but does not re-evaluate', async () => {\n+  expect(globalThis.evalCounter).toBeUndefined()\n+  await assertThrowsThrows()\n+  expect(globalThis.evalCounter).toBe(1)\n+  await assertThrowsThrows()\n+  expect(globalThis.evalCounter).toBe(1)\n+\n+  // We do re-evaluate if the module cache is cleared\n+  require.cache[require.resolve('./throws')] = undefined\n+  await assertThrowsThrows()\n+  expect(globalThis.evalCounter).toBe(2)\n+  await assertThrowsThrows()\n+  expect(globalThis.evalCounter).toBe(2)\n+})\n+\n+async function assertThrowsThrows() {\n+  try {\n+    await import('./throws')\n+  } catch (e) {\n+    return e\n+  }\n+  throw new Error('should have thrown')\n+}"
        },
        {
            "sha": "67ecea826d1de797e7c3f4847725eccd0b54b382",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/evaluation-errors/basic/input/throws.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a270b00e4c29f1829ed887e459f69a71ef488ea2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fevaluation-errors%2Fbasic%2Finput%2Fthrows.js",
            "raw_url": "https://github.com/vercel/next.js/raw/a270b00e4c29f1829ed887e459f69a71ef488ea2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fevaluation-errors%2Fbasic%2Finput%2Fthrows.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fevaluation-errors%2Fbasic%2Finput%2Fthrows.js?ref=a270b00e4c29f1829ed887e459f69a71ef488ea2",
            "patch": "@@ -0,0 +1,4 @@\n+globalThis.evalCounter ??= 0\n+globalThis.evalCounter++\n+\n+throw new Error('uh oh')"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 27,
        "deletions": 0
    }
}