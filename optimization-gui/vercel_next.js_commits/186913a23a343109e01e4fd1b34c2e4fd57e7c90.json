{
    "author": "huozhi",
    "message": "[segment explorer] builtin slots style (#80972)\n\nShow builtin slots with a style showing that component is possible for users to customize\r\n\r\n![image](https://github.com/user-attachments/assets/60351baf-ed0b-44fb-8ede-754b79b16dde)\r\n\r\nCloses NEXT-4540",
    "sha": "186913a23a343109e01e4fd1b34c2e4fd57e7c90",
    "files": [
        {
            "sha": "9a9c972f90b7464aa6a3247c9e2ae2c061b299d6",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/overview/segment-explorer.tsx",
            "status": "modified",
            "additions": 58,
            "deletions": 2,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/186913a23a343109e01e4fd1b34c2e4fd57e7c90/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/186913a23a343109e01e4fd1b34c2e4fd57e7c90/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Foverview%2Fsegment-explorer.tsx?ref=186913a23a343109e01e4fd1b34c2e4fd57e7c90",
            "patch": "@@ -2,6 +2,8 @@ import { useSegmentTree, type SegmentTrieNode } from '../../segment-explorer'\n import { css } from '../../utils/css'\n import { cx } from '../../utils/cx'\n \n+const BUILTIN_PREFIX = '__next_builtin__'\n+\n const isFileNode = (node: SegmentTrieNode) => {\n   return !!node.value?.type && !!node.value?.pagePath\n }\n@@ -115,7 +117,10 @@ function PageSegmentTreeLayerPresentation({\n                       return null\n                     }\n                     const filePath = childNode.value.pagePath\n-                    const fileName = filePath.split('/').pop() || ''\n+                    const lastSegment = filePath.split('/').pop() || ''\n+                    const isBuiltin = filePath.startsWith(BUILTIN_PREFIX)\n+                    const fileName = lastSegment.replace(BUILTIN_PREFIX, '')\n+\n                     return (\n                       <span\n                         key={fileChildSegment}\n@@ -124,10 +129,18 @@ function PageSegmentTreeLayerPresentation({\n                         }}\n                         className={cx(\n                           'segment-explorer-file-label',\n-                          `segment-explorer-file-label--${childNode.value.type}`\n+                          `segment-explorer-file-label--${childNode.value.type}`,\n+                          isBuiltin && 'segment-explorer-file-label--builtin'\n                         )}\n                       >\n                         {fileName}\n+                        {isBuiltin && (\n+                          <TooltipSpan\n+                            title={`The default Next.js not found is being shown. You can customize this page by adding your own ${fileName} file to the app/ directory.`}\n+                          >\n+                            <InfoIcon />\n+                          </TooltipSpan>\n+                        )}\n                       </span>\n                     )\n                   })}\n@@ -250,6 +263,17 @@ export const DEV_TOOLS_INFO_RENDER_FILES_STYLES = css`\n     background-color: var(--color-red-300);\n     color: var(--color-red-900);\n   }\n+\n+  .segment-explorer-file-label--builtin {\n+    background-color: transparent;\n+    color: var(--color-gray-900);\n+    border: 1px dashed var(--color-gray-500);\n+  }\n+\n+  .segment-explorer-file-label--builtin svg {\n+    margin-left: 4px;\n+    margin-right: -4px;\n+  }\n `\n \n function openInEditor({ filePath }: { filePath: string }) {\n@@ -265,3 +289,35 @@ function openInEditor({ filePath }: { filePath: string }) {\n     }/__nextjs_launch-editor?${params.toString()}`\n   )\n }\n+\n+function InfoIcon(props: React.SVGProps<SVGSVGElement>) {\n+  return (\n+    <svg\n+      width=\"16\"\n+      height=\"16\"\n+      viewBox=\"0 0 16 16\"\n+      fill=\"none\"\n+      xmlns=\"http://www.w3.org/2000/svg\"\n+      {...props}\n+    >\n+      <path\n+        d=\"M14 8C14 11.3137 11.3137 14 8 14C4.68629 14 2 11.3137 2 8C2 4.68629 4.68629 2 8 2C11.3137 2 14 4.68629 14 8Z\"\n+        fill=\"var(--color-gray-400)\"\n+      />\n+      <path\n+        d=\"M7.75 7C8.30228 7.00001 8.75 7.44772 8.75 8V11.25H7.25V8.5H6.25V7H7.75ZM8 4C8.55228 4 9 4.44772 9 5C9 5.55228 8.55228 6 8 6C7.44772 6 7 5.55228 7 5C7 4.44772 7.44772 4 8 4Z\"\n+        fill=\"var(--color-gray-900)\"\n+      />\n+    </svg>\n+  )\n+}\n+\n+function TooltipSpan({\n+  children,\n+  title,\n+}: {\n+  children: React.ReactNode\n+  title: string\n+}) {\n+  return <span title={title}>{children}</span>\n+}"
        },
        {
            "sha": "e9b5bed17c6d37c50e65230a71938e7cd88886b1",
            "filename": "packages/next/src/server/app-render/app-render.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 1,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/186913a23a343109e01e4fd1b34c2e4fd57e7c90/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/186913a23a343109e01e4fd1b34c2e4fd57e7c90/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fapp-render.tsx?ref=186913a23a343109e01e4fd1b34c2e4fd57e7c90",
            "patch": "@@ -3980,7 +3980,13 @@ const getGlobalErrorStyles = async (\n     if (ctx.renderOpts.devtoolSegmentExplorer && globalErrorModulePath) {\n       const SegmentViewNode = ctx.componentMod.SegmentViewNode\n       globalErrorStyles = (\n-        <SegmentViewNode type=\"global-error\" pagePath={globalErrorModulePath}>\n+        // This will be rendered next to GlobalError component under ErrorBoundary,\n+        // it requires a key to avoid React warning about duplicate keys.\n+        <SegmentViewNode\n+          key=\"ge-svn\"\n+          type=\"global-error\"\n+          pagePath={globalErrorModulePath}\n+        >\n           {globalErrorStyles}\n         </SegmentViewNode>\n       )"
        },
        {
            "sha": "42d35a6b45fef56e5ad31be5b4c28403a52aeb52",
            "filename": "packages/next/src/server/app-render/segment-explorer-path.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/186913a23a343109e01e4fd1b34c2e4fd57e7c90/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fsegment-explorer-path.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/186913a23a343109e01e4fd1b34c2e4fd57e7c90/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fsegment-explorer-path.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fsegment-explorer-path.ts?ref=186913a23a343109e01e4fd1b34c2e4fd57e7c90",
            "patch": "@@ -21,6 +21,8 @@ export function normalizeConventionFilePath(\n   // If it's internal file only keep the filename, strip nextjs internal prefix\n   if (nextInternalPrefixRegex.test(relativePath)) {\n     relativePath = relativePath.replace(nextInternalPrefixRegex, '')\n+    // Add a special prefix to let segment explorer know it's a built-in component\n+    relativePath = `__next_builtin__${relativePath}`\n   }\n \n   return relativePath"
        }
    ],
    "stats": {
        "total": 70,
        "additions": 67,
        "deletions": 3
    }
}