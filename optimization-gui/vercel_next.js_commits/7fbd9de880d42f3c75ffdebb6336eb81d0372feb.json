{
    "author": "huozhi",
    "message": "[mcp] get_routes mcp tool (#85773)",
    "sha": "7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
    "files": [
        {
            "sha": "943ad56abfbfb749c56cbbe43a20cbdf8c35b473",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -781,6 +781,9 @@ export async function createHotReloaderTurbopack(\n           getMcpMiddleware({\n             projectPath,\n             distDir,\n+            nextConfig,\n+            pagesDir: opts.pagesDir,\n+            appDir: opts.appDir,\n             sendHmrMessage: (message) => hotReloader.send(message),\n             getActiveConnectionCount: () =>\n               clientsWithoutHtmlRequestId.size + clientsByHtmlRequestId.size,"
        },
        {
            "sha": "a56f35758cb2400de2ea8e59d6d6ff6a1df59d8f",
            "filename": "packages/next/src/server/dev/hot-reloader-webpack.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -1674,6 +1674,9 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n             getMcpMiddleware({\n               projectPath: this.dir,\n               distDir: this.distDir,\n+              nextConfig: this.config,\n+              pagesDir: this.pagesDir,\n+              appDir: this.appDir,\n               sendHmrMessage: (message) => this.send(message),\n               getActiveConnectionCount: () =>\n                 this.webpackHotMiddleware?.getClientCount() ?? 0,"
        },
        {
            "sha": "c815e388a57535713ea29835d7762fb2931de0b2",
            "filename": "packages/next/src/server/mcp/get-or-create-mcp-server.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Fget-or-create-mcp-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Fget-or-create-mcp-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Fget-or-create-mcp-server.ts?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -4,11 +4,16 @@ import { registerGetErrorsTool } from './tools/get-errors'\n import { registerGetPageMetadataTool } from './tools/get-page-metadata'\n import { registerGetLogsTool } from './tools/get-logs'\n import { registerGetActionByIdTool } from './tools/get-server-action-by-id'\n+import { registerGetRoutesTool } from './tools/get-routes'\n import type { HmrMessageSentToBrowser } from '../dev/hot-reloader-types'\n+import type { NextConfigComplete } from '../config-shared'\n \n export interface McpServerOptions {\n   projectPath: string\n   distDir: string\n+  nextConfig: NextConfigComplete\n+  pagesDir: string | undefined\n+  appDir: string | undefined\n   sendHmrMessage: (message: HmrMessageSentToBrowser) => void\n   getActiveConnectionCount: () => number\n   getDevServerUrl: () => string | undefined\n@@ -23,7 +28,7 @@ export const getOrCreateMcpServer = (options: McpServerOptions) => {\n \n   mcpServer = new McpServer({\n     name: 'Next.js MCP Server',\n-    version: '0.1.0',\n+    version: '0.2.0',\n   })\n \n   registerGetProjectMetadataTool(\n@@ -43,6 +48,12 @@ export const getOrCreateMcpServer = (options: McpServerOptions) => {\n   )\n   registerGetLogsTool(mcpServer, options.distDir)\n   registerGetActionByIdTool(mcpServer, options.distDir)\n+  registerGetRoutesTool(mcpServer, {\n+    projectPath: options.projectPath,\n+    nextConfig: options.nextConfig,\n+    pagesDir: options.pagesDir,\n+    appDir: options.appDir,\n+  })\n \n   return mcpServer\n }"
        },
        {
            "sha": "35f72d2906976d8eb1b438033cd15e6793476a3a",
            "filename": "packages/next/src/server/mcp/tools/get-routes.ts",
            "status": "added",
            "additions": 225,
            "deletions": 0,
            "changes": 225,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Ftools%2Fget-routes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Ftools%2Fget-routes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fmcp%2Ftools%2Fget-routes.ts?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,225 @@\n+/**\n+ * MCP tool for getting all routes that become entry points in a Next.js application.\n+ *\n+ * This tool discovers routes by scanning the filesystem directly. It finds all route\n+ * files in the app/ and pages/ directories and converts them to route paths.\n+ *\n+ * Returns routes grouped by router type:\n+ * - appRouter: App Router pages and route handlers\n+ * - pagesRouter: Pages Router pages and API routes\n+ *\n+ * Dynamic route segments appear as [id], [slug], or [...slug] patterns. This tool\n+ * does NOT expand getStaticParams - it only shows the route patterns as defined in\n+ * the filesystem.\n+ */\n+import type { McpServer } from 'next/dist/compiled/@modelcontextprotocol/sdk/server/mcp'\n+import { mcpTelemetryTracker } from '../mcp-telemetry-tracker'\n+import {\n+  collectAppFiles,\n+  collectPagesFiles,\n+  processAppRoutes,\n+  processPageRoutes,\n+  createPagesMapping,\n+} from '../../../build/entries'\n+import { createValidFileMatcher } from '../../lib/find-page-file'\n+import { PAGE_TYPES } from '../../../lib/page-types'\n+import type { NextConfigComplete } from '../../../server/config-shared'\n+import z from 'next/dist/compiled/zod'\n+\n+interface RouteInfo {\n+  route: string\n+  type: 'app' | 'page' | 'api'\n+}\n+\n+export function registerGetRoutesTool(\n+  server: McpServer,\n+  options: {\n+    projectPath: string\n+    nextConfig: NextConfigComplete\n+    pagesDir: string | undefined\n+    appDir: string | undefined\n+  }\n+) {\n+  server.registerTool(\n+    'get_routes',\n+    {\n+      description:\n+        'Get all routes that will become entry points in the Next.js application by scanning the filesystem. Returns routes grouped by router type (appRouter, pagesRouter). Dynamic segments appear as [param] or [...slug] patterns. API routes are included in their respective routers (e.g., /api/* routes from pages/ are in pagesRouter). Optional parameter: routerType (\"app\" | \"pages\") - filter by specific router type, omit to get all routes.',\n+      inputSchema: {\n+        routerType: z.union([z.literal('app'), z.literal('pages')]).optional(),\n+      },\n+    },\n+    async (request) => {\n+      // Track telemetry\n+      mcpTelemetryTracker.recordToolCall('mcp/get_routes')\n+\n+      try {\n+        const routerType =\n+          request.routerType === 'app' || request.routerType === 'pages'\n+            ? request.routerType\n+            : undefined\n+\n+        const routes: RouteInfo[] = []\n+\n+        const { projectPath, nextConfig, pagesDir, appDir } = options\n+\n+        // Check if we have any directories to scan\n+        if (!pagesDir && !appDir) {\n+          return {\n+            content: [\n+              {\n+                type: 'text',\n+                text: 'No pages or app directory found in the project.',\n+              },\n+            ],\n+          }\n+        }\n+\n+        const isSrcDir =\n+          (pagesDir && pagesDir.includes('/src/')) ||\n+          (appDir && appDir.includes('/src/'))\n+\n+        // Create valid file matcher for filtering\n+        const validFileMatcher = createValidFileMatcher(\n+          nextConfig.pageExtensions,\n+          appDir\n+        )\n+\n+        // Collect and process App Router routes if requested\n+        if (appDir && (!routerType || routerType === 'app')) {\n+          try {\n+            const { appPaths } = await collectAppFiles(appDir, validFileMatcher)\n+\n+            if (appPaths.length > 0) {\n+              const mappedAppPages = await createPagesMapping({\n+                pagePaths: appPaths,\n+                isDev: true,\n+                pagesType: PAGE_TYPES.APP,\n+                pageExtensions: nextConfig.pageExtensions,\n+                pagesDir,\n+                appDir,\n+                appDirOnly: pagesDir ? false : true,\n+              })\n+\n+              const { appRoutes, appRouteHandlers } = processAppRoutes(\n+                mappedAppPages,\n+                validFileMatcher,\n+                projectPath,\n+                isSrcDir || false\n+              )\n+\n+              // Add app page routes\n+              for (const { route } of appRoutes) {\n+                routes.push({\n+                  route,\n+                  type: 'app',\n+                })\n+              }\n+\n+              // Add app route handlers\n+              for (const { route } of appRouteHandlers) {\n+                routes.push({\n+                  route,\n+                  type: 'app',\n+                })\n+              }\n+            }\n+          } catch (error) {\n+            // Error collecting app routes - continue anyway\n+          }\n+        }\n+\n+        // Collect and process Pages Router routes if requested\n+        if (pagesDir && (!routerType || routerType === 'pages')) {\n+          try {\n+            const pagePaths = await collectPagesFiles(\n+              pagesDir,\n+              validFileMatcher\n+            )\n+\n+            if (pagePaths.length > 0) {\n+              const mappedPages = await createPagesMapping({\n+                pagePaths,\n+                isDev: true,\n+                pagesType: PAGE_TYPES.PAGES,\n+                pageExtensions: nextConfig.pageExtensions,\n+                pagesDir,\n+                appDir,\n+                appDirOnly: false,\n+              })\n+\n+              const { pageRoutes, pageApiRoutes } = processPageRoutes(\n+                mappedPages,\n+                projectPath,\n+                isSrcDir || false\n+              )\n+\n+              // Add page routes\n+              for (const { route } of pageRoutes) {\n+                routes.push({\n+                  route,\n+                  type: 'page',\n+                })\n+              }\n+\n+              // Add API routes (always included as part of pages router)\n+              for (const { route } of pageApiRoutes) {\n+                routes.push({\n+                  route,\n+                  type: 'api',\n+                })\n+              }\n+            }\n+          } catch (error) {\n+            // Error collecting pages routes - continue anyway\n+          }\n+        }\n+\n+        if (routes.length === 0) {\n+          return {\n+            content: [\n+              {\n+                type: 'text',\n+                text: 'No routes found in the project.',\n+              },\n+            ],\n+          }\n+        }\n+\n+        // Group routes by router type\n+        const appRoutes = routes\n+          .filter((r) => r.type === 'app')\n+          .map((r) => r.route)\n+          .sort()\n+        const pageRoutes = routes\n+          .filter((r) => r.type === 'page' || r.type === 'api')\n+          .map((r) => r.route)\n+          .sort()\n+\n+        // Format the output with grouped routes\n+        const output = {\n+          appRouter: appRoutes.length > 0 ? appRoutes : undefined,\n+          pagesRouter: pageRoutes.length > 0 ? pageRoutes : undefined,\n+        }\n+\n+        return {\n+          content: [\n+            {\n+              type: 'text',\n+              text: JSON.stringify(output, null, 2),\n+            },\n+          ],\n+        }\n+      } catch (error) {\n+        return {\n+          content: [\n+            {\n+              type: 'text',\n+              text: `Error: ${error instanceof Error ? error.message : String(error)}`,\n+            },\n+          ],\n+        }\n+      }\n+    }\n+  )\n+}"
        },
        {
            "sha": "448659c99f168986a2e9b0068eb46a1978fb1721",
            "filename": "packages/next/src/telemetry/events/build.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Ftelemetry%2Fevents%2Fbuild.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/packages%2Fnext%2Fsrc%2Ftelemetry%2Fevents%2Fbuild.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Ftelemetry%2Fevents%2Fbuild.ts?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -237,6 +237,7 @@ export type McpToolName =\n   | 'mcp/get_logs'\n   | 'mcp/get_page_metadata'\n   | 'mcp/get_project_metadata'\n+  | 'mcp/get_routes'\n   | 'mcp/get_server_action_by_id'\n \n export type EventMcpToolUsage = {"
        },
        {
            "sha": "a2083e625e304c6ef7f5e36dc1f8bb08a3d5d590",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/app/api/users/[id]/route.ts",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fapi%2Fusers%2F%5Bid%5D%2Froute.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fapi%2Fusers%2F%5Bid%5D%2Froute.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fapi%2Fusers%2F%5Bid%5D%2Froute.ts?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,6 @@\n+export async function GET(\n+  request: Request,\n+  { params }: { params: { id: string } }\n+) {\n+  return Response.json({ id: params.id })\n+}"
        },
        {
            "sha": "f36bcb0158ee43783e6daa6be35f5ef9bd32ae2f",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/app/blog/[slug]/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fblog%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fblog%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fblog%2F%5Bslug%5D%2Fpage.tsx?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,3 @@\n+export default function BlogPost({ params }: { params: { slug: string } }) {\n+  return <div>Blog post: {params.slug}</div>\n+}"
        },
        {
            "sha": "f6188bb3e90eee171611937f7432eea91d07e880",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/app/docs/[...slug]/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fdocs%2F%5B...slug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fdocs%2F%5B...slug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fdocs%2F%5B...slug%5D%2Fpage.tsx?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Docs({ params }: { params: { slug: string[] } }) {\n+  return <div>Docs: {params.slug.join('/')}</div>\n+}"
        },
        {
            "sha": "08eaa94fdc8896acfd343a0dbb61c713eec93a55",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/app/layout.tsx",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Flayout.tsx?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,11 @@\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "d9c7f2a8e1de546a49154028d1633583cf84856c",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fpage.tsx?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,3 @@\n+export default function HomePage() {\n+  return <div>Home</div>\n+}"
        },
        {
            "sha": "6fdb1fdd8d5cb09a96e74f2340e2e7b690486a48",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/app/products/[id]/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fproducts%2F%5Bid%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fproducts%2F%5Bid%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fapp%2Fproducts%2F%5Bid%5D%2Fpage.tsx?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Product({ params }: { params: { id: string } }) {\n+  return <div>Product: {params.id}</div>\n+}"
        },
        {
            "sha": "9388ab3c0e9db91ea50ebb4a59ffd8b70cabd836",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/next.config.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fnext.config.js?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,8 @@\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  experimental: {\n+    mcpServer: true,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "03ee4dd54c1ec5d429fb53e0a15109bf382697e4",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/pages/about.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fpages%2Fabout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fpages%2Fabout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fpages%2Fabout.tsx?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,3 @@\n+export default function About() {\n+  return <div>About Page</div>\n+}"
        },
        {
            "sha": "7083522848203e3c91e5296084156ebb30ad65ac",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/pages/api/legacy.ts",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fpages%2Fapi%2Flegacy.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fpages%2Fapi%2Flegacy.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fpages%2Fapi%2Flegacy.ts?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,5 @@\n+import type { NextApiRequest, NextApiResponse } from 'next'\n+\n+export default function handler(req: NextApiRequest, res: NextApiResponse) {\n+  res.status(200).json({ name: 'Legacy API' })\n+}"
        },
        {
            "sha": "f050b7e0b8d889970dd10b1854b4f726c2ad3fa0",
            "filename": "test/development/mcp-server/fixtures/dynamic-routes-app/pages/posts/[id].tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fpages%2Fposts%2F%5Bid%5D.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fpages%2Fposts%2F%5Bid%5D.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Ffixtures%2Fdynamic-routes-app%2Fpages%2Fposts%2F%5Bid%5D.tsx?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,9 @@\n+export default function Post({ id }: { id: string }) {\n+  return <div>Post {id}</div>\n+}\n+\n+export async function getServerSideProps(context: any) {\n+  return {\n+    props: { id: context.params.id },\n+  }\n+}"
        },
        {
            "sha": "e44e05e746906c58f7737eb087373f0ab58c80cb",
            "filename": "test/development/mcp-server/mcp-server-get-routes.test.ts",
            "status": "added",
            "additions": 98,
            "deletions": 0,
            "changes": 98,
            "blob_url": "https://github.com/vercel/next.js/blob/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Fmcp-server-get-routes.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/7fbd9de880d42f3c75ffdebb6336eb81d0372feb/test%2Fdevelopment%2Fmcp-server%2Fmcp-server-get-routes.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fmcp-server%2Fmcp-server-get-routes.test.ts?ref=7fbd9de880d42f3c75ffdebb6336eb81d0372feb",
            "patch": "@@ -0,0 +1,98 @@\n+import path from 'path'\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('get_routes MCP tool', () => {\n+  const { next, skipped } = nextTestSetup({\n+    files: path.join(__dirname, 'fixtures', 'dynamic-routes-app'),\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  async function callGetRoutes(\n+    id: string,\n+    args: Record<string, unknown> = {}\n+  ): Promise<string> {\n+    const response = await fetch(`${next.url}/_next/mcp`, {\n+      method: 'POST',\n+      headers: {\n+        'Content-Type': 'application/json',\n+        Accept: 'application/json, text/event-stream',\n+      },\n+      body: JSON.stringify({\n+        jsonrpc: '2.0',\n+        id,\n+        method: 'tools/call',\n+        params: { name: 'get_routes', arguments: args },\n+      }),\n+    })\n+\n+    const text = await response.text()\n+    const match = text.match(/data: ({.*})/s)\n+    const result = JSON.parse(match![1])\n+    return result.result?.content?.[0]?.text\n+  }\n+\n+  it('should return all routes via MCP get_routes tool without visiting pages', async () => {\n+    // The tool should discover all routes by scanning the filesystem,\n+    // without needing to visit/compile any pages first\n+    const sessionId = 'test-mcp-routes-' + Date.now()\n+    const responseText = await callGetRoutes(sessionId)\n+\n+    expect(responseText).toBeTruthy()\n+    const response = JSON.parse(responseText)\n+\n+    // Snapshot the discovered routes grouped by router type\n+    // Note: Dynamic routes show parameter patterns like [id], [slug], [...slug]\n+    expect(response).toMatchInlineSnapshot(`\n+      {\n+        \"appRouter\": [\n+          \"/\",\n+          \"/api/users/[id]\",\n+          \"/blog/[slug]\",\n+          \"/docs/[...slug]\",\n+          \"/products/[id]\",\n+        ],\n+        \"pagesRouter\": [\n+          \"/about\",\n+          \"/api/legacy\",\n+          \"/posts/[id]\",\n+        ],\n+      }\n+    `)\n+  })\n+\n+  it('should filter routes by routerType parameter', async () => {\n+    // Test app-only filter\n+    const appOnlyResponse = JSON.parse(\n+      await callGetRoutes('test-app-only', { routerType: 'app' })\n+    )\n+    expect(appOnlyResponse).toMatchInlineSnapshot(`\n+      {\n+        \"appRouter\": [\n+          \"/\",\n+          \"/api/users/[id]\",\n+          \"/blog/[slug]\",\n+          \"/docs/[...slug]\",\n+          \"/products/[id]\",\n+        ],\n+      }\n+    `)\n+\n+    // Test pages-only filter\n+    const pagesOnlyResponse = JSON.parse(\n+      await callGetRoutes('test-pages-only', { routerType: 'pages' })\n+    )\n+    expect(pagesOnlyResponse).toMatchInlineSnapshot(`\n+      {\n+        \"pagesRouter\": [\n+          \"/about\",\n+          \"/api/legacy\",\n+          \"/posts/[id]\",\n+        ],\n+      }\n+    `)\n+  })\n+})"
        }
    ],
    "stats": {
        "total": 397,
        "additions": 396,
        "deletions": 1
    }
}