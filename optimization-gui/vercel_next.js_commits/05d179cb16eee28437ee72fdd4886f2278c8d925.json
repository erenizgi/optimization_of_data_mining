{
    "author": "unstubbable",
    "message": "Allow `pnpm build` to be run when offline (#81273)\n\nWhen running `pnpm build` in the Next.js repo without an internet\nconnection, this currently fails while trying to download the AMP\n`validator_wasm.js` file. We can fix this, and thus enable offline\nsupport for `pnpm build`, by moving the download of this file from the\n`precompile` task to the `ncc_amphtml_validator` task. The file is then\ncommitted to `src/compiled/amphtml-validator`, and later copied into\n`dist/compiled/amphtml-validator` as part of the build command, without\nthe need to trigger a request.",
    "sha": "05d179cb16eee28437ee72fdd4886f2278c8d925",
    "files": [
        {
            "sha": "06732bb59e1fc8c0ac8dd88a1179d65db9a494de",
            "filename": "packages/next/src/compiled/amphtml-validator/validator_wasm.js",
            "status": "added",
            "additions": 2672,
            "deletions": 0,
            "changes": 2672,
            "blob_url": "https://github.com/vercel/next.js/blob/05d179cb16eee28437ee72fdd4886f2278c8d925/packages%2Fnext%2Fsrc%2Fcompiled%2Famphtml-validator%2Fvalidator_wasm.js",
            "raw_url": "https://github.com/vercel/next.js/raw/05d179cb16eee28437ee72fdd4886f2278c8d925/packages%2Fnext%2Fsrc%2Fcompiled%2Famphtml-validator%2Fvalidator_wasm.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcompiled%2Famphtml-validator%2Fvalidator_wasm.js?ref=05d179cb16eee28437ee72fdd4886f2278c8d925"
        },
        {
            "sha": "1ad499ecb573c1db1eeb2510072bb064aec6ff50",
            "filename": "packages/next/taskfile.js",
            "status": "modified",
            "additions": 17,
            "deletions": 17,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/05d179cb16eee28437ee72fdd4886f2278c8d925/packages%2Fnext%2Ftaskfile.js",
            "raw_url": "https://github.com/vercel/next.js/raw/05d179cb16eee28437ee72fdd4886f2278c8d925/packages%2Fnext%2Ftaskfile.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftaskfile.js?ref=05d179cb16eee28437ee72fdd4886f2278c8d925",
            "patch": "@@ -676,6 +676,23 @@ export async function ncc_amphtml_validator(task, opts) {\n     .source(relative(__dirname, require.resolve('amphtml-validator')))\n     .ncc({ packageName: 'amphtml-validator', externals })\n     .target('src/compiled/amphtml-validator')\n+\n+  const validatorRes = await fetch(\n+    'https://cdn.ampproject.org/v0/validator_wasm.js'\n+  ).catch((err) => {\n+    throw new Error('Failed to fetch AMP validator', { cause: err })\n+  })\n+\n+  if (!validatorRes.ok) {\n+    throw new Error(\n+      `Failed to get the AMP validator, status: ${validatorRes.status}`\n+    )\n+  }\n+\n+  await fs.writeFile(\n+    join(__dirname, 'src/compiled/amphtml-validator/validator_wasm.js'),\n+    require('buffer').Buffer.from(await validatorRes.arrayBuffer())\n+  )\n }\n \n // eslint-disable-next-line camelcase\n@@ -2244,23 +2261,6 @@ export async function precompile(task, opts) {\n     ['browser_polyfills', 'copy_ncced', 'copy_styled_jsx_assets'],\n     opts\n   )\n-\n-  const validatorRes = await fetch(\n-    'https://cdn.ampproject.org/v0/validator_wasm.js'\n-  ).catch((err) => {\n-    throw new Error('Failed to fetch AMP validator', { cause: err })\n-  })\n-\n-  if (!validatorRes.ok) {\n-    throw new Error(\n-      `Failed to get the AMP validator, status: ${validatorRes.status}`\n-    )\n-  }\n-\n-  await fs.writeFile(\n-    join(__dirname, 'dist/compiled/amphtml-validator/validator_wasm.js'),\n-    require('buffer').Buffer.from(await validatorRes.arrayBuffer())\n-  )\n }\n \n // eslint-disable-next-line camelcase"
        }
    ],
    "stats": {
        "total": 2706,
        "additions": 2689,
        "deletions": 17
    }
}