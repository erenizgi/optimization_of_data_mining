{
    "author": "kdy1",
    "message": "fix(turbopack): Fix config caching for turbopack + React Compiler (#80498)\n\n### What?\n\nModify the caching logic to include the whole filename when compiling with the React Compiler.\n\n### Why?\n\nWhen RC is enabled, we cannot cache the config merely using the extension.",
    "sha": "16cb4c5360a7f27cc3d89c0e03840e26511888f2",
    "files": [
        {
            "sha": "6d5ce1b94d5bb655bb5c2bdea1761b574c50bb82",
            "filename": "packages/next/src/build/babel/loader/get-config.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 7,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/16cb4c5360a7f27cc3d89c0e03840e26511888f2/packages%2Fnext%2Fsrc%2Fbuild%2Fbabel%2Floader%2Fget-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/16cb4c5360a7f27cc3d89c0e03840e26511888f2/packages%2Fnext%2Fsrc%2Fbuild%2Fbabel%2Floader%2Fget-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fbabel%2Floader%2Fget-config.ts?ref=16cb4c5360a7f27cc3d89c0e03840e26511888f2",
            "patch": "@@ -37,27 +37,31 @@ interface CharacteristicsGermaneToCaching {\n   isPageFile: boolean\n   isNextDist: boolean\n   hasModuleExports: boolean\n-  fileExt: string\n+  fileNameOrExt: string\n }\n \n const fileExtensionRegex = /\\.([a-z]+)$/\n function getCacheCharacteristics(\n   loaderOptions: NextBabelLoaderOptions,\n   source: string,\n-  filename: string\n+  filename: string,\n+  transformMode: 'default' | 'standalone'\n ): CharacteristicsGermaneToCaching {\n   const { isServer, pagesDir } = loaderOptions\n   const isPageFile = filename.startsWith(pagesDir)\n   const isNextDist = nextDistPath.test(filename)\n   const hasModuleExports = source.indexOf('module.exports') !== -1\n-  const fileExt = fileExtensionRegex.exec(filename)?.[1] || 'unknown'\n+  const fileNameOrExt =\n+    transformMode === 'default'\n+      ? fileExtensionRegex.exec(filename)?.[1] || 'unknown'\n+      : filename\n \n   return {\n     isServer,\n     isPageFile,\n     isNextDist,\n     hasModuleExports,\n-    fileExt,\n+    fileNameOrExt,\n   }\n }\n \n@@ -436,7 +440,7 @@ async function getFreshConfig(\n  * file attributes and Next.js compiler states: `CharacteristicsGermaneToCaching`.\n  */\n function getCacheKey(cacheCharacteristics: CharacteristicsGermaneToCaching) {\n-  const { isServer, isPageFile, isNextDist, hasModuleExports, fileExt } =\n+  const { isServer, isPageFile, isNextDist, hasModuleExports, fileNameOrExt } =\n     cacheCharacteristics\n \n   const flags =\n@@ -446,7 +450,7 @@ function getCacheKey(cacheCharacteristics: CharacteristicsGermaneToCaching) {\n     (isNextDist ? 0b0100 : 0) |\n     (hasModuleExports ? 0b1000 : 0)\n \n-  return fileExt + flags\n+  return fileNameOrExt + flags\n }\n \n type BabelConfig = any\n@@ -472,7 +476,8 @@ export default async function getConfig(\n   const cacheCharacteristics = getCacheCharacteristics(\n     loaderOptions,\n     source,\n-    filename\n+    filename,\n+    loaderOptions.transformMode\n   )\n \n   if (loaderOptions.transformMode === 'default' && loaderOptions.configFile) {"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 12,
        "deletions": 7
    }
}