{
    "author": "ijjk",
    "message": "Delete un-used prefetch outputs with PPR (#86100)",
    "sha": "40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
    "files": [
        {
            "sha": "22e264f8a794df78d77564a90d4f8327aaa526d8",
            "filename": "packages/next/src/build/generate-routes-manifest.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fbuild%2Fgenerate-routes-manifest.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fbuild%2Fgenerate-routes-manifest.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fgenerate-routes-manifest.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -12,7 +12,6 @@ import {\n } from '../client/components/app-router-headers'\n import {\n   RSC_SUFFIX,\n-  RSC_PREFETCH_SUFFIX,\n   RSC_SEGMENT_SUFFIX,\n   RSC_SEGMENTS_DIR_SUFFIX,\n   NEXT_RESUME_HEADER,\n@@ -123,7 +122,6 @@ export function generateRoutesManifest(\n       didPostponeHeader: NEXT_DID_POSTPONE_HEADER,\n       contentTypeHeader: RSC_CONTENT_TYPE_HEADER,\n       suffix: RSC_SUFFIX,\n-      prefetchSuffix: RSC_PREFETCH_SUFFIX,\n       prefetchSegmentHeader: NEXT_ROUTER_SEGMENT_PREFETCH_HEADER,\n       prefetchSegmentSuffix: RSC_SEGMENT_SUFFIX,\n       prefetchSegmentDirSuffix: RSC_SEGMENTS_DIR_SUFFIX,"
        },
        {
            "sha": "c7d7ae0e85748b8082575ccfdf5363774eea443a",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 64,
            "changes": 70,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -24,7 +24,6 @@ import {\n   PROXY_FILENAME,\n   PAGES_DIR_ALIAS,\n   INSTRUMENTATION_HOOK_FILENAME,\n-  RSC_PREFETCH_SUFFIX,\n   RSC_SUFFIX,\n   PRERENDER_REVALIDATE_HEADER,\n   PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER,\n@@ -200,11 +199,6 @@ import { RenderingMode } from './rendering-mode'\n import { InvariantError } from '../shared/lib/invariant-error'\n import { HTML_LIMITED_BOT_UA_RE_STRING } from '../shared/lib/router/utils/is-bot'\n import type { UseCacheTrackerKey } from './webpack/plugins/telemetry-plugin/use-cache-tracker-utils'\n-import {\n-  buildInversePrefetchSegmentDataRoute,\n-  buildPrefetchSegmentDataRoute,\n-  type PrefetchSegmentDataRoute,\n-} from '../server/lib/router-utils/build-prefetch-segment-data-route'\n \n import { turbopackBuild } from './turbopack-build'\n import { isFileSystemCacheEnabledForBuild } from '../shared/lib/turbopack/utils'\n@@ -228,8 +222,12 @@ import {\n   writeValidatorFile,\n } from '../server/lib/router-utils/route-types-utils'\n import { Lockfile } from './lockfile'\n-import { validateAppPaths } from './validate-app-paths'\n+import {\n+  buildPrefetchSegmentDataRoute,\n+  type PrefetchSegmentDataRoute,\n+} from '../server/lib/router-utils/build-prefetch-segment-data-route'\n import { generateRoutesManifest } from './generate-routes-manifest'\n+import { validateAppPaths } from './validate-app-paths'\n \n type Fallback = null | boolean | string\n \n@@ -456,7 +454,6 @@ export type RoutesManifest = {\n     varyHeader: string\n     prefetchHeader: typeof NEXT_ROUTER_PREFETCH_HEADER\n     suffix: typeof RSC_SUFFIX\n-    prefetchSuffix: typeof RSC_PREFETCH_SUFFIX\n     prefetchSegmentHeader: typeof NEXT_ROUTER_SEGMENT_PREFETCH_HEADER\n     prefetchSegmentDirSuffix: typeof RSC_SEGMENTS_DIR_SUFFIX\n     prefetchSegmentSuffix: typeof RSC_SEGMENT_SUFFIX\n@@ -3212,26 +3209,6 @@ export default async function build(\n                   dataRoute = path.posix.join(`${normalizedRoute}${RSC_SUFFIX}`)\n                 }\n \n-                let prefetchDataRoute: string | null = null\n-                // While we may only write the `.rsc` when the route does not\n-                // have PPR enabled, we still want to generate the route when\n-                // deployed so it doesn't 404. If the app has PPR enabled, we\n-                // should add this key.\n-                if (\n-                  !isAppRouteHandler &&\n-                  isAppPPREnabled &&\n-                  // Don't add a prefetch data route if we have\n-                  // cacheComponents enabled. This is\n-                  // because we don't actually use the prefetch data route in\n-                  // this case. This only applies if we have PPR enabled for\n-                  // this route.\n-                  !(config.cacheComponents && isRoutePPREnabled)\n-                ) {\n-                  prefetchDataRoute = path.posix.join(\n-                    `${normalizedRoute}${RSC_PREFETCH_SUFFIX}`\n-                  )\n-                }\n-\n                 const meta = collectMeta(metadata)\n                 const status =\n                   route.pathname === UNDERSCORE_NOT_FOUND_ROUTE\n@@ -3252,7 +3229,7 @@ export default async function build(\n                   initialExpireSeconds: cacheControl.expire,\n                   srcRoute: page,\n                   dataRoute,\n-                  prefetchDataRoute,\n+                  prefetchDataRoute: undefined,\n                   allowHeader: ALLOWED_HEADERS,\n                 }\n               } else {\n@@ -3326,20 +3303,6 @@ export default async function build(\n                   (r) => r.page === route.pathname\n                 )\n                 if (!isAppRouteHandler && isAppPPREnabled) {\n-                  if (\n-                    // Don't add a prefetch data route if we have\n-                    // cacheComponents enabled. This is\n-                    // because we don't actually use the prefetch data route in\n-                    // this case. This only applies if we have PPR enabled for\n-                    // this route.\n-                    !config.cacheComponents ||\n-                    !isRoutePPREnabled\n-                  ) {\n-                    prefetchDataRoute = path.posix.join(\n-                      `${normalizedRoute}${RSC_PREFETCH_SUFFIX}`\n-                    )\n-                  }\n-\n                   // If the dynamic route wasn't found, then we need to create\n                   // it. This ensures that for each fallback shell there's an\n                   // entry in the app routes manifest which enables routing for\n@@ -3407,27 +3370,6 @@ export default async function build(\n                       builtSegmentDataRoute\n                     )\n                   }\n-                  // If the route has fallback root params, and we don't have\n-                  // any segment paths, we need to write the inverse prefetch\n-                  // segment data route so that it can first rewrite the /_tree\n-                  // request to the prefetch RSC route. We also need to set the\n-                  // `hasFallbackRootParams` flag so that we can simplify the\n-                  // route regex for matching.\n-                  else if (\n-                    route.fallbackRootParams &&\n-                    route.fallbackRootParams.length > 0\n-                  ) {\n-                    dynamicRoute.hasFallbackRootParams = true\n-                    dynamicRoute.prefetchSegmentDataRoutes = [\n-                      buildInversePrefetchSegmentDataRoute(\n-                        dynamicRoute.page,\n-                        // We use the special segment path of `/_tree` because it's\n-                        // the first one sent by the client router so it's the only\n-                        // one we need to rewrite to the regular prefetch RSC route.\n-                        '/_tree'\n-                      ),\n-                    ]\n-                  }\n                 }\n \n                 pageInfos.set(route.pathname, {"
        },
        {
            "sha": "256f3d9201eb5bc6a4a3e13d7b802b6dc56ac7c5",
            "filename": "packages/next/src/export/routes/app-page.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 12,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-page.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-page.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-page.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -12,7 +12,6 @@ import { isDynamicUsageError } from '../helpers/is-dynamic-usage-error'\n import {\n   NEXT_CACHE_TAGS_HEADER,\n   NEXT_META_SUFFIX,\n-  RSC_PREFETCH_SUFFIX,\n   RSC_SUFFIX,\n   RSC_SEGMENTS_DIR_SUFFIX,\n   RSC_SEGMENT_SUFFIX,\n@@ -140,20 +139,11 @@ export async function exportAppPage(\n         throw new Error(`Invariant: failed to get page data for ${path}`)\n       }\n     } else {\n-      // If PPR is enabled, we want to emit a prefetch rsc file for the page\n+      // If PPR is enabled, we want to emit a segment prefetch files\n       // instead of the standard rsc. This is because the standard rsc will\n       // contain the dynamic data. We do this if any routes have PPR enabled so\n       // that the cache read/write is the same.\n-      if (renderOpts.experimental.isRoutePPREnabled) {\n-        // If PPR is enabled, we should emit the flight data as the prefetch\n-        // payload.\n-        // TODO: This will eventually be replaced by the per-segment prefetch\n-        // output below.\n-        fileWriter.append(\n-          htmlFilepath.replace(/\\.html$/, RSC_PREFETCH_SUFFIX),\n-          flightData\n-        )\n-      } else {\n+      if (!renderOpts.experimental.isRoutePPREnabled) {\n         // Writing the RSC payload to a file if we don't have PPR enabled.\n         fileWriter.append(\n           htmlFilepath.replace(/\\.html$/, RSC_SUFFIX),"
        },
        {
            "sha": "4d2f8eecda349915e725da0752a5b190c7b76286",
            "filename": "packages/next/src/lib/constants.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Flib%2Fconstants.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Flib%2Fconstants.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fconstants.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -11,7 +11,6 @@ export const PRERENDER_REVALIDATE_HEADER = 'x-prerender-revalidate'\n export const PRERENDER_REVALIDATE_ONLY_GENERATED_HEADER =\n   'x-prerender-revalidate-if-generated'\n \n-export const RSC_PREFETCH_SUFFIX = '.prefetch.rsc'\n export const RSC_SEGMENTS_DIR_SUFFIX = '.segments'\n export const RSC_SEGMENT_SUFFIX = '.segment.rsc'\n export const RSC_SUFFIX = '.rsc'"
        },
        {
            "sha": "72adf115f9f7435ac3848d15791454c00bb2bce3",
            "filename": "packages/next/src/server/base-server.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -121,7 +121,6 @@ import {\n   isAppPageRouteModule,\n   isAppRouteRouteModule,\n } from './route-modules/checks'\n-import { PrefetchRSCPathnameNormalizer } from './normalizers/request/prefetch-rsc'\n import { NextDataPathnameNormalizer } from './normalizers/request/next-data'\n import { getIsPossibleServerAction } from './lib/server-action-request-meta'\n import { isInterceptionRouteAppPath } from '../shared/lib/router/utils/interception-routes'\n@@ -415,7 +414,6 @@ export default abstract class Server<\n \n   protected readonly normalizers: {\n     readonly rsc: RSCPathnameNormalizer | undefined\n-    readonly prefetchRSC: PrefetchRSCPathnameNormalizer | undefined\n     readonly segmentPrefetchRSC: SegmentPrefixRSCPathnameNormalizer | undefined\n     readonly data: NextDataPathnameNormalizer | undefined\n   }\n@@ -496,10 +494,6 @@ export default abstract class Server<\n         this.enabledDirectories.app && this.minimalMode\n           ? new RSCPathnameNormalizer()\n           : undefined,\n-      prefetchRSC:\n-        this.isAppPPREnabled && this.minimalMode\n-          ? new PrefetchRSCPathnameNormalizer()\n-          : undefined,\n       segmentPrefetchRSC: this.minimalMode\n         ? new SegmentPrefixRSCPathnameNormalizer()\n         : undefined,\n@@ -600,17 +594,6 @@ export default abstract class Server<\n       addRequestMeta(req, 'isRSCRequest', true)\n       addRequestMeta(req, 'isPrefetchRSCRequest', true)\n       addRequestMeta(req, 'segmentPrefetchRSCRequest', segmentPath)\n-    } else if (this.normalizers.prefetchRSC?.match(parsedUrl.pathname)) {\n-      parsedUrl.pathname = this.normalizers.prefetchRSC.normalize(\n-        parsedUrl.pathname,\n-        true\n-      )\n-\n-      // Mark the request as a router prefetch request.\n-      req.headers[RSC_HEADER] = '1'\n-      req.headers[NEXT_ROUTER_PREFETCH_HEADER] = '1'\n-      addRequestMeta(req, 'isRSCRequest', true)\n-      addRequestMeta(req, 'isPrefetchRSCRequest', true)\n     } else if (this.normalizers.rsc?.match(parsedUrl.pathname)) {\n       parsedUrl.pathname = this.normalizers.rsc.normalize(\n         parsedUrl.pathname,\n@@ -1584,12 +1567,6 @@ export default abstract class Server<\n       normalizers.push(this.normalizers.segmentPrefetchRSC)\n     }\n \n-    // We have to put the prefetch normalizer before the RSC normalizer\n-    // because the RSC normalizer will match the prefetch RSC routes too.\n-    if (this.normalizers.prefetchRSC) {\n-      normalizers.push(this.normalizers.prefetchRSC)\n-    }\n-\n     if (this.normalizers.rsc) {\n       normalizers.push(this.normalizers.rsc)\n     }\n@@ -2324,7 +2301,6 @@ export default abstract class Server<\n \n     for (const normalizer of [\n       this.normalizers.segmentPrefetchRSC,\n-      this.normalizers.prefetchRSC,\n       this.normalizers.rsc,\n     ]) {\n       if (normalizer?.match(initPathname)) {"
        },
        {
            "sha": "996ac976723b028fbfc3b1b909a71cc3d16c12f3",
            "filename": "packages/next/src/server/lib/incremental-cache/file-system-cache.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 11,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Ffile-system-cache.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Ffile-system-cache.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fincremental-cache%2Ffile-system-cache.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -17,7 +17,6 @@ import {\n   NEXT_CACHE_TAGS_HEADER,\n   NEXT_DATA_SUFFIX,\n   NEXT_META_SUFFIX,\n-  RSC_PREFETCH_SUFFIX,\n   RSC_SEGMENT_SUFFIX,\n   RSC_SEGMENTS_DIR_SUFFIX,\n   RSC_SUFFIX,\n@@ -231,10 +230,10 @@ export default class FileSystemCache implements CacheHandler {\n             }\n \n             let rscData: Buffer | undefined\n-            if (!ctx.isFallback) {\n+            if (!ctx.isFallback && !ctx.isRoutePPREnabled) {\n               rscData = await this.fs.readFile(\n                 this.getFilePath(\n-                  `${key}${ctx.isRoutePPREnabled ? RSC_PREFETCH_SUFFIX : RSC_SUFFIX}`,\n+                  `${key}${RSC_SUFFIX}`,\n                   IncrementalCacheKind.APP_PAGE\n                 )\n               )\n@@ -396,16 +395,10 @@ export default class FileSystemCache implements CacheHandler {\n       writer.append(htmlPath, data.html)\n \n       // Fallbacks don't generate a data file.\n-      if (!ctx.fetchCache && !ctx.isFallback) {\n+      if (!ctx.fetchCache && !ctx.isFallback && !ctx.isRoutePPREnabled) {\n         writer.append(\n           this.getFilePath(\n-            `${key}${\n-              isAppPath\n-                ? ctx.isRoutePPREnabled\n-                  ? RSC_PREFETCH_SUFFIX\n-                  : RSC_SUFFIX\n-                : NEXT_DATA_SUFFIX\n-            }`,\n+            `${key}${isAppPath ? RSC_SUFFIX : NEXT_DATA_SUFFIX}`,\n             isAppPath\n               ? IncrementalCacheKind.APP_PAGE\n               : IncrementalCacheKind.PAGES"
        },
        {
            "sha": "60f68ba2baacc00626c6ad9026d0e1860b0c9eaa",
            "filename": "packages/next/src/server/lib/router-utils/build-prefetch-segment-data-route.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 23,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fbuild-prefetch-segment-data-route.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fbuild-prefetch-segment-data-route.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fbuild-prefetch-segment-data-route.test.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -1,7 +1,4 @@\n-import {\n-  buildInversePrefetchSegmentDataRoute,\n-  buildPrefetchSegmentDataRoute,\n-} from './build-prefetch-segment-data-route'\n+import { buildPrefetchSegmentDataRoute } from './build-prefetch-segment-data-route'\n \n describe('buildPrefetchSegmentDataRoute', () => {\n   it('should build a prefetch segment data route', () => {\n@@ -21,22 +18,3 @@ describe('buildPrefetchSegmentDataRoute', () => {\n     `)\n   })\n })\n-\n-describe('buildInversePrefetchSegmentDataRoute', () => {\n-  it('should build an inverted prefetch segment data route', () => {\n-    const route = buildInversePrefetchSegmentDataRoute(\n-      '/blog/[...slug]',\n-      '/_tree'\n-    )\n-\n-    expect(route).toMatchInlineSnapshot(`\n-     {\n-       \"destination\": \"/blog/[...slug].prefetch.rsc\",\n-       \"routeKeys\": {\n-         \"nxtPslug\": \"nxtPslug\",\n-       },\n-       \"source\": \"^/blog/(?<nxtPslug>.+?)\\\\.segments/_tree\\\\.segment\\\\.rsc$\",\n-     }\n-    `)\n-  })\n-})"
        },
        {
            "sha": "049e1a4ffc8e8d2d0fae850bcbe15fd5bf42d683",
            "filename": "packages/next/src/server/lib/router-utils/build-prefetch-segment-data-route.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 38,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fbuild-prefetch-segment-data-route.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fbuild-prefetch-segment-data-route.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Fbuild-prefetch-segment-data-route.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -2,7 +2,6 @@ import path from '../../../shared/lib/isomorphic/path'\n import { normalizePagePath } from '../../../shared/lib/page-path/normalize-page-path'\n import { getNamedRouteRegex } from '../../../shared/lib/router/utils/route-regex'\n import {\n-  RSC_PREFETCH_SUFFIX,\n   RSC_SEGMENT_SUFFIX,\n   RSC_SEGMENTS_DIR_SUFFIX,\n } from '../../../lib/constants'\n@@ -40,40 +39,3 @@ export function buildPrefetchSegmentDataRoute(\n     routeKeys,\n   }\n }\n-\n-/**\n- * Builds a prefetch segment data route that is inverted. This means that it's\n- * supposed to rewrite from the previous segment paths route back to the\n- * prefetch RSC route.\n- *\n- * @param page - The page to build the route for.\n- * @param segmentPath - The segment path to build the route for.\n- * @returns The prefetch segment data route.\n- */\n-export function buildInversePrefetchSegmentDataRoute(\n-  page: string,\n-  segmentPath: string\n-): PrefetchSegmentDataRoute {\n-  const pagePath = normalizePagePath(page)\n-\n-  const source = path.posix.join(\n-    `${pagePath}${RSC_SEGMENTS_DIR_SUFFIX}`,\n-    `${segmentPath}${RSC_SEGMENT_SUFFIX}`\n-  )\n-\n-  const { namedRegex, routeKeys } = getNamedRouteRegex(source, {\n-    prefixRouteKeys: true,\n-    includePrefix: true,\n-    includeSuffix: true,\n-    excludeOptionalTrailingSlash: true,\n-    backreferenceDuplicateKeys: true,\n-  })\n-\n-  const destination = path.posix.join(`${pagePath}${RSC_PREFETCH_SUFFIX}`)\n-\n-  return {\n-    source: namedRegex,\n-    destination,\n-    routeKeys,\n-  }\n-}"
        },
        {
            "sha": "c48e745b74b0c10daa7ea44d3d52b1c93543b965",
            "filename": "packages/next/src/server/lib/router-utils/filesystem.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ffilesystem.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ffilesystem.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ffilesystem.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -43,7 +43,6 @@ import {\n import { normalizePathSep } from '../../../shared/lib/page-path/normalize-path-sep'\n import { normalizeMetadataRoute } from '../../../lib/metadata/get-metadata-route'\n import { RSCPathnameNormalizer } from '../../normalizers/request/rsc'\n-import { PrefetchRSCPathnameNormalizer } from '../../normalizers/request/prefetch-rsc'\n import { encodeURIPath } from '../../../shared/lib/encode-uri-path'\n import { isMetadataRouteFile } from '../../../lib/metadata/is-metadata-route'\n \n@@ -425,9 +424,6 @@ export async function setupFsCheck(opts: {\n     // Because we can't know if the app directory is enabled or not at this\n     // stage, we assume that it is.\n     rsc: new RSCPathnameNormalizer(),\n-    prefetchRSC: opts.config.experimental.ppr\n-      ? new PrefetchRSCPathnameNormalizer()\n-      : undefined,\n   }\n \n   return {\n@@ -483,9 +479,7 @@ export async function setupFsCheck(opts: {\n       // Simulate minimal mode requests by normalizing RSC and postponed\n       // requests.\n       if (opts.minimalMode) {\n-        if (normalizers.prefetchRSC?.match(itemPath)) {\n-          itemPath = normalizers.prefetchRSC.normalize(itemPath, true)\n-        } else if (normalizers.rsc.match(itemPath)) {\n+        if (normalizers.rsc.match(itemPath)) {\n           itemPath = normalizers.rsc.normalize(itemPath, true)\n         }\n       }"
        },
        {
            "sha": "849f0050a9eabe7292450f5fca9e8b13b6bdaba3",
            "filename": "packages/next/src/server/normalizers/request/prefetch-rsc.test.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 21,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fnormalizers%2Frequest%2Fprefetch-rsc.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fnormalizers%2Frequest%2Fprefetch-rsc.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnormalizers%2Frequest%2Fprefetch-rsc.test.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -1,21 +0,0 @@\n-import { PrefetchRSCPathnameNormalizer } from './prefetch-rsc'\n-\n-describe('PrefetchRSCPathnameNormalizer', () => {\n-  const normalizer = new PrefetchRSCPathnameNormalizer()\n-\n-  it('should match the prefetch rsc pathname', () => {\n-    expect(normalizer.match('/blog/post.prefetch.rsc')).toBe(true)\n-  })\n-\n-  it('should not match the prefetch rsc pathname with a different suffix', () => {\n-    expect(normalizer.match('/blog/post.prefetch.rsc2')).toBe(false)\n-  })\n-\n-  it('should normalize the prefetch rsc pathname', () => {\n-    expect(normalizer.normalize('/blog/post.prefetch.rsc')).toBe('/blog/post')\n-  })\n-\n-  it('should normalize the prefetch rsc index pathname', () => {\n-    expect(normalizer.normalize('/__index.prefetch.rsc')).toBe('/')\n-  })\n-})"
        },
        {
            "sha": "b7e1da0ac5e986bddbfe408fa974498f8e61d567",
            "filename": "packages/next/src/server/normalizers/request/prefetch-rsc.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 29,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fnormalizers%2Frequest%2Fprefetch-rsc.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/36f50c5a11cdd92953f711fca5fadbbe6033ec8a/packages%2Fnext%2Fsrc%2Fserver%2Fnormalizers%2Frequest%2Fprefetch-rsc.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnormalizers%2Frequest%2Fprefetch-rsc.ts?ref=36f50c5a11cdd92953f711fca5fadbbe6033ec8a",
            "patch": "@@ -1,29 +0,0 @@\n-import type { PathnameNormalizer } from './pathname-normalizer'\n-\n-import { RSC_PREFETCH_SUFFIX } from '../../../lib/constants'\n-import { SuffixPathnameNormalizer } from './suffix'\n-\n-export class PrefetchRSCPathnameNormalizer\n-  extends SuffixPathnameNormalizer\n-  implements PathnameNormalizer\n-{\n-  constructor() {\n-    super(RSC_PREFETCH_SUFFIX)\n-  }\n-\n-  public match(pathname: string): boolean {\n-    if (pathname === '/__index' + RSC_PREFETCH_SUFFIX) {\n-      return true\n-    }\n-\n-    return super.match(pathname)\n-  }\n-\n-  public normalize(pathname: string, matched?: boolean): string {\n-    if (pathname === '/__index' + RSC_PREFETCH_SUFFIX) {\n-      return '/'\n-    }\n-\n-    return super.normalize(pathname, matched)\n-  }\n-}"
        },
        {
            "sha": "69f73b11dcdd912ba3e4c4523af757a7a19327a7",
            "filename": "test/e2e/app-dir/app-static/app-static.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 60,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-static%2Fapp-static.test.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -1394,7 +1394,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/\",\n          },\n          \"/_not-found\": {\n@@ -1420,7 +1419,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialRevalidateSeconds\": false,\n            \"initialStatus\": 404,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/_not-found\",\n          },\n          \"/api/large-data\": {\n@@ -1449,7 +1447,6 @@ describe('app-dir static/dynamic handling', () => {\n              \"x-next-cache-tags\": \"_N_T_/layout,_N_T_/api/layout,_N_T_/api/large-data/layout,_N_T_/api/large-data/route,_N_T_/api/large-data\",\n            },\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/api/large-data\",\n          },\n          \"/articles/works\": {\n@@ -1475,7 +1472,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 1,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/articles/[slug]\",\n          },\n          \"/blog/seb\": {\n@@ -1501,7 +1497,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/blog/[author]\",\n          },\n          \"/blog/seb/second-post\": {\n@@ -1526,7 +1521,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/blog/[author]/[slug]\",\n          },\n          \"/blog/styfle\": {\n@@ -1552,7 +1546,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/blog/[author]\",\n          },\n          \"/blog/styfle/first-post\": {\n@@ -1577,7 +1570,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/blog/[author]/[slug]\",\n          },\n          \"/blog/styfle/second-post\": {\n@@ -1602,7 +1594,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/blog/[author]/[slug]\",\n          },\n          \"/blog/tim\": {\n@@ -1628,7 +1619,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/blog/[author]\",\n          },\n          \"/blog/tim/first-post\": {\n@@ -1653,7 +1643,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/blog/[author]/[slug]\",\n          },\n          \"/default-config-fetch\": {\n@@ -1678,7 +1667,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/default-config-fetch\",\n          },\n          \"/force-cache\": {\n@@ -1704,7 +1692,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/force-cache\",\n          },\n          \"/force-static-fetch-no-store\": {\n@@ -1729,7 +1716,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/force-static-fetch-no-store\",\n          },\n          \"/force-static/first\": {\n@@ -1754,7 +1740,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/force-static/[slug]\",\n          },\n          \"/force-static/second\": {\n@@ -1779,7 +1764,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/force-static/[slug]\",\n          },\n          \"/gen-params-catch-all-unique/foo/bar\": {\n@@ -1804,7 +1788,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/gen-params-catch-all-unique/[...slug]\",\n          },\n          \"/gen-params-catch-all-unique/foo/foo\": {\n@@ -1829,7 +1812,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/gen-params-catch-all-unique/[...slug]\",\n          },\n          \"/gen-params-dynamic-revalidate/one\": {\n@@ -1855,7 +1837,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/gen-params-dynamic-revalidate/[slug]\",\n          },\n          \"/hooks/use-pathname/slug\": {\n@@ -1880,7 +1861,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/hooks/use-pathname/[slug]\",\n          },\n          \"/hooks/use-search-params/force-static\": {\n@@ -1905,7 +1885,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/hooks/use-search-params/force-static\",\n          },\n          \"/hooks/use-search-params/with-suspense\": {\n@@ -1930,7 +1909,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/hooks/use-search-params/with-suspense\",\n          },\n          \"/isr-error-handling\": {\n@@ -1956,7 +1934,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/isr-error-handling\",\n          },\n          \"/no-config-fetch\": {\n@@ -1981,7 +1958,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/no-config-fetch\",\n          },\n          \"/no-store/static\": {\n@@ -2006,7 +1982,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/no-store/static\",\n          },\n          \"/partial-gen-params-no-additional-lang/en/RAND\": {\n@@ -2031,7 +2006,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-lang/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-lang/en/first\": {\n@@ -2056,7 +2030,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-lang/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-lang/en/second\": {\n@@ -2081,7 +2054,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-lang/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-lang/fr/RAND\": {\n@@ -2106,7 +2078,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-lang/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-lang/fr/first\": {\n@@ -2131,7 +2102,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-lang/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-lang/fr/second\": {\n@@ -2156,7 +2126,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-lang/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-slug/en/RAND\": {\n@@ -2181,7 +2150,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-slug/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-slug/en/first\": {\n@@ -2206,7 +2174,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-slug/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-slug/en/second\": {\n@@ -2231,7 +2198,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-slug/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-slug/fr/RAND\": {\n@@ -2256,7 +2222,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-slug/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-slug/fr/first\": {\n@@ -2281,7 +2246,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-slug/[lang]/[slug]\",\n          },\n          \"/partial-gen-params-no-additional-slug/fr/second\": {\n@@ -2306,7 +2270,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-gen-params-no-additional-slug/[lang]/[slug]\",\n          },\n          \"/partial-params-false/en/static\": {\n@@ -2331,7 +2294,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-params-false/[locale]/static\",\n          },\n          \"/partial-params-false/fr/static\": {\n@@ -2356,7 +2318,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/partial-params-false/[locale]/static\",\n          },\n          \"/prerendered-not-found/first\": {\n@@ -2381,7 +2342,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/prerendered-not-found/[slug]\",\n          },\n          \"/prerendered-not-found/second\": {\n@@ -2406,7 +2366,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/prerendered-not-found/[slug]\",\n          },\n          \"/prerendered-not-found/segment-revalidate\": {\n@@ -2432,7 +2391,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/prerendered-not-found/segment-revalidate\",\n          },\n          \"/route-handler/no-store-force-static\": {\n@@ -2462,7 +2420,6 @@ describe('app-dir static/dynamic handling', () => {\n              \"x-next-cache-tags\": \"_N_T_/layout,_N_T_/route-handler/layout,_N_T_/route-handler/no-store-force-static/layout,_N_T_/route-handler/no-store-force-static/route,_N_T_/route-handler/no-store-force-static\",\n            },\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/route-handler/no-store-force-static\",\n          },\n          \"/route-handler/revalidate-360-isr\": {\n@@ -2492,7 +2449,6 @@ describe('app-dir static/dynamic handling', () => {\n              \"x-next-cache-tags\": \"_N_T_/layout,_N_T_/route-handler/layout,_N_T_/route-handler/revalidate-360-isr/layout,_N_T_/route-handler/revalidate-360-isr/route,_N_T_/route-handler/revalidate-360-isr,thankyounext\",\n            },\n            \"initialRevalidateSeconds\": 10,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/route-handler/revalidate-360-isr\",\n          },\n          \"/route-handler/static-cookies\": {\n@@ -2521,7 +2477,6 @@ describe('app-dir static/dynamic handling', () => {\n              \"x-next-cache-tags\": \"_N_T_/layout,_N_T_/route-handler/layout,_N_T_/route-handler/static-cookies/layout,_N_T_/route-handler/static-cookies/route,_N_T_/route-handler/static-cookies\",\n            },\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/route-handler/static-cookies\",\n          },\n          \"/ssg-draft-mode\": {\n@@ -2546,7 +2501,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/ssg-draft-mode/[[...route]]\",\n          },\n          \"/ssg-draft-mode/test\": {\n@@ -2571,7 +2525,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/ssg-draft-mode/[[...route]]\",\n          },\n          \"/ssg-draft-mode/test-2\": {\n@@ -2596,7 +2549,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/ssg-draft-mode/[[...route]]\",\n          },\n          \"/strip-w3c-trace-context-headers\": {\n@@ -2622,7 +2574,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 50,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/strip-w3c-trace-context-headers\",\n          },\n          \"/unstable-cache/fetch/no-cache\": {\n@@ -2647,7 +2598,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/unstable-cache/fetch/no-cache\",\n          },\n          \"/unstable-cache/fetch/no-store\": {\n@@ -2672,7 +2622,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/unstable-cache/fetch/no-store\",\n          },\n          \"/update-tag-test\": {\n@@ -2697,7 +2646,6 @@ describe('app-dir static/dynamic handling', () => {\n              },\n            ],\n            \"initialRevalidateSeconds\": false,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/update-tag-test\",\n          },\n          \"/variable-config-revalidate/revalidate-3\": {\n@@ -2723,7 +2671,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/variable-config-revalidate/revalidate-3\",\n          },\n          \"/variable-revalidate-stable/revalidate-3\": {\n@@ -2749,7 +2696,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/variable-revalidate-stable/revalidate-3\",\n          },\n          \"/variable-revalidate/authorization\": {\n@@ -2775,7 +2721,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/variable-revalidate/authorization\",\n          },\n          \"/variable-revalidate/cookie\": {\n@@ -2801,7 +2746,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/variable-revalidate/cookie\",\n          },\n          \"/variable-revalidate/encoding\": {\n@@ -2827,7 +2771,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/variable-revalidate/encoding\",\n          },\n          \"/variable-revalidate/headers-instance\": {\n@@ -2853,7 +2796,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/variable-revalidate/headers-instance\",\n          },\n          \"/variable-revalidate/revalidate-3\": {\n@@ -2879,7 +2821,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 3,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/variable-revalidate/revalidate-3\",\n          },\n          \"/variable-revalidate/revalidate-360-isr\": {\n@@ -2905,7 +2846,6 @@ describe('app-dir static/dynamic handling', () => {\n            ],\n            \"initialExpireSeconds\": 31536000,\n            \"initialRevalidateSeconds\": 10,\n-           \"prefetchDataRoute\": null,\n            \"srcRoute\": \"/variable-revalidate/revalidate-360-isr\",\n          },\n        }"
        },
        {
            "sha": "6305f2cb28b709a878ade73b6652d3e10fae94f1",
            "filename": "test/e2e/app-dir/not-found/default/default.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fe2e%2Fapp-dir%2Fnot-found%2Fdefault%2Fdefault.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fe2e%2Fapp-dir%2Fnot-found%2Fdefault%2Fdefault.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnot-found%2Fdefault%2Fdefault.test.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -16,9 +16,9 @@ describe('app dir - not-found - default', () => {\n   if (isNextStart) {\n     it('should contain noindex contain in the page', async () => {\n       const html = await next.readFile('.next/server/app/_not-found.html')\n-      const rsc = await next.readFile(\n-        `.next/server/app/_not-found.${isPPREnabled ? 'prefetch.' : ''}rsc`\n-      )\n+      const rsc = isPPREnabled\n+        ? 'noindex'\n+        : await next.readFile(`.next/server/app/_not-found.rsc`)\n \n       expect(html).toContain('noindex')\n       expect(rsc).toContain('noindex')"
        },
        {
            "sha": "8c7c1b73aff14ff496d06d5f3cddac8544820d40",
            "filename": "test/e2e/app-dir/rewrite-headers/rewrite-headers.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fe2e%2Fapp-dir%2Frewrite-headers%2Frewrite-headers.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fe2e%2Fapp-dir%2Frewrite-headers%2Frewrite-headers.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Frewrite-headers%2Frewrite-headers.test.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -411,6 +411,11 @@ const cases: {\n     headers: {\n       rsc: '1',\n       'next-router-prefetch': '1',\n+      ...(process.env.__NEXT_CACHE_COMPONENTS === 'true'\n+        ? {\n+            'next-router-segment-prefetch': '/_tree',\n+          }\n+        : {}),\n     },\n     expected: {\n       'x-nextjs-rewritten-path': '/other',"
        },
        {
            "sha": "8155a42697a9f1a35fdb2215693808716262a0da",
            "filename": "test/integration/custom-routes/test/index.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fintegration%2Fcustom-routes%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fintegration%2Fcustom-routes%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcustom-routes%2Ftest%2Findex.test.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -2437,7 +2437,6 @@ const runTests = (isDev = false) => {\n            \"prefetchSegmentDirSuffix\": \".segments\",\n            \"prefetchSegmentHeader\": \"next-router-segment-prefetch\",\n            \"prefetchSegmentSuffix\": \".segment.rsc\",\n-           \"prefetchSuffix\": \".prefetch.rsc\",\n            \"suffix\": \".rsc\",\n            \"varyHeader\": \"rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch\",\n          },"
        },
        {
            "sha": "91320c485fc25460845e4223c308b1850e812092",
            "filename": "test/integration/dynamic-routing/test/index.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fintegration%2Fdynamic-routing%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fintegration%2Fdynamic-routing%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fdynamic-routing%2Ftest%2Findex.test.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -1485,7 +1485,6 @@ function runTests({ dev }) {\n            \"prefetchSegmentDirSuffix\": \".segments\",\n            \"prefetchSegmentHeader\": \"next-router-segment-prefetch\",\n            \"prefetchSegmentSuffix\": \".segment.rsc\",\n-           \"prefetchSuffix\": \".prefetch.rsc\",\n            \"suffix\": \".rsc\",\n            \"varyHeader\": \"rsc, next-router-state-tree, next-router-prefetch, next-router-segment-prefetch\",\n          },"
        },
        {
            "sha": "22d9fc9eaff586507b446636b8dc588773bf33d2",
            "filename": "test/production/app-dir/parallel-routes-static/index.test.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 9,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fproduction%2Fapp-dir%2Fparallel-routes-static%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fproduction%2Fapp-dir%2Fparallel-routes-static%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fparallel-routes-static%2Findex.test.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -6,19 +6,25 @@ describe('app-dir parallel-routes-static', () => {\n   })\n \n   it('should static generate parallel routes', async () => {\n-    const rscExtension = process.env.__NEXT_CACHE_COMPONENTS\n-      ? '.prefetch.rsc'\n-      : '.rsc'\n+    const rscExtension = '.rsc'\n     expect(await next.hasFile('.next/server/app/nested/foo.html')).toBe(true)\n     expect(await next.hasFile('.next/server/app/nested/foo.meta')).toBe(true)\n-    expect(\n-      await next.hasFile(`.next/server/app/nested/foo${rscExtension}`)\n-    ).toBe(true)\n+\n+    // we do not output '.rsc' statically with cache components\n+    if (!process.env.__NEXT_CACHE_COMPONENTS) {\n+      expect(\n+        await next.hasFile(`.next/server/app/nested/foo${rscExtension}`)\n+      ).toBe(true)\n+    }\n \n     expect(await next.hasFile('.next/server/app/nested/bar.html')).toBe(true)\n     expect(await next.hasFile('.next/server/app/nested/bar.meta')).toBe(true)\n-    expect(\n-      await next.hasFile(`.next/server/app/nested/bar${rscExtension}`)\n-    ).toBe(true)\n+\n+    // we do not output '.rsc' statically with cache components\n+    if (!process.env.__NEXT_CACHE_COMPONENTS) {\n+      expect(\n+        await next.hasFile(`.next/server/app/nested/bar${rscExtension}`)\n+      ).toBe(true)\n+    }\n   })\n })"
        },
        {
            "sha": "22473acdd5c8d0e49cf872cf212005cf9c3bf555",
            "filename": "test/production/standalone-mode/required-server-files/cache-entry-handlers.js",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Fcache-entry-handlers.js",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Fcache-entry-handlers.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Fcache-entry-handlers.js?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -51,10 +51,7 @@ module.exports = (res) => ({\n     }\n \n     // If this is for a prefetch or segment request, then mark it as a miss.\n-    if (\n-      meta.url.endsWith('.prefetch.rsc') ||\n-      meta.url.endsWith('.segment.rsc')\n-    ) {\n+    if (meta.url.endsWith('.segment.rsc')) {\n       res.setHeader('x-nextjs-cache-entry-handler', 'MISS_2')\n       return false\n     }"
        },
        {
            "sha": "3329c96d7a4a7aba534a1bdf74cdf7c3141cbe88",
            "filename": "test/production/standalone-mode/required-server-files/required-server-files-ppr.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 24,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-ppr.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/40dd4ce4f58183111e79f408f6bbf22c7ba24a16/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-ppr.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fstandalone-mode%2Frequired-server-files%2Frequired-server-files-ppr.test.ts?ref=40dd4ce4f58183111e79f408f6bbf22c7ba24a16",
            "patch": "@@ -447,30 +447,6 @@ describe.skip('required server files app router', () => {\n     expect(res.headers.has('x-nextjs-postponed')).toBeFalse()\n   })\n \n-  it('should handle prefetch RSC requests', async () => {\n-    const res = await fetchViaHTTP(\n-      appPort,\n-      '/dyn/first.prefetch.rsc',\n-      undefined,\n-      {\n-        headers: {\n-          'x-matched-path': '/dyn/[slug]',\n-          'x-now-route-matches': createNowRouteMatches({\n-            slug: 'first',\n-          }).toString(),\n-        },\n-      }\n-    )\n-\n-    expect(res.status).toBe(200)\n-    expect(res.headers.get('content-type')).toEqual('text/x-component')\n-    expect(res.headers.has('x-nextjs-postponed')).toBeTrue()\n-\n-    // We expect that because we're performing a prefetch, we should be a miss\n-    // because it isn't handled by the cache handler.\n-    expect(res.headers.get('x-nextjs-cache-entry-handler')).toBe('MISS_2')\n-  })\n-\n   it('should use the postponed state for the RSC requests', async () => {\n     // Let's parse the random number out of the HTML that was generated at build\n     // time. We want to use that value as it's the one that's tied to the"
        }
    ],
    "stats": {
        "total": 372,
        "additions": 38,
        "deletions": 334
    }
}