{
    "author": "icyJoseph",
    "message": "docs: upgrade from 15 to 16 (#85176)\n\nCo-authored-by: Ismael <ismael@vercel.com>\nCo-authored-by: Jiachi Liu <inbox@huozhi.im>",
    "sha": "48bb490d6396a8db09811bf21997ab6c5a38c0b8",
    "files": [
        {
            "sha": "892df99b563778d8f8fe8f99fe4447b7450e01de",
            "filename": "docs/01-app/01-getting-started/18-upgrading.mdx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/48bb490d6396a8db09811bf21997ab6c5a38c0b8/docs%2F01-app%2F01-getting-started%2F18-upgrading.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/48bb490d6396a8db09811bf21997ab6c5a38c0b8/docs%2F01-app%2F01-getting-started%2F18-upgrading.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F01-getting-started%2F18-upgrading.mdx?ref=48bb490d6396a8db09811bf21997ab6c5a38c0b8",
            "patch": "@@ -5,6 +5,7 @@ related:\n   title: Version guides\n   description: See the version guides for in-depth upgrade instructions.\n   links:\n+    - app/guides/upgrading/version-16\n     - app/guides/upgrading/version-15\n     - app/guides/upgrading/version-14\n ---"
        },
        {
            "sha": "bd49ab56d12734dea5d01c53d8af72d8a50f8803",
            "filename": "docs/01-app/02-guides/upgrading/version-16.mdx",
            "status": "added",
            "additions": 1133,
            "deletions": 0,
            "changes": 1133,
            "blob_url": "https://github.com/vercel/next.js/blob/48bb490d6396a8db09811bf21997ab6c5a38c0b8/docs%2F01-app%2F02-guides%2Fupgrading%2Fversion-16.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/48bb490d6396a8db09811bf21997ab6c5a38c0b8/docs%2F01-app%2F02-guides%2Fupgrading%2Fversion-16.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F02-guides%2Fupgrading%2Fversion-16.mdx?ref=48bb490d6396a8db09811bf21997ab6c5a38c0b8",
            "patch": "@@ -0,0 +1,1133 @@\n+---\n+title: How to upgrade to version 16\n+nav_title: Version 16\n+description: Upgrade your Next.js Application from Version 15 to 16.\n+---\n+\n+{/* The content of this doc is shared between the app and pages router. You can use the `<PagesOnly>Content</PagesOnly>` component to add content that is specific to the Pages Router. Any shared content should not be wrapped in a component. */}\n+\n+## Upgrading from 15 to 16\n+\n+### Using AI Agents with Next.js DevTools MCP\n+\n+If you're using an AI coding assistant that supports the [Model Context Protocol (MCP)](https://modelcontextprotocol.io), you can use the **Next.js DevTools MCP** to automate the upgrade process and migration tasks.\n+\n+#### Setup\n+\n+Add the following configuration to your MCP client, example:\n+\n+```json\n+{\n+  \"mcpServers\": {\n+    \"next-devtools\": {\n+      \"command\": \"npx\",\n+      \"args\": [\"-y\", \"next-devtools-mcp@latest\"]\n+    }\n+  }\n+}\n+```\n+\n+For more information, visit the [`next-devtools-mcp`](https://www.npmjs.com/package/next-devtools-mcp) package on npm to configure with your MCP client.\n+\n+> **Note:** Using `next-devtools-mcp@latest` ensures that your MCP client will always use the latest version of the Next.js DevTools MCP server.\n+\n+#### Example Prompts\n+\n+Once configured, you can use natural language prompts to upgrade your Next.js app:\n+\n+**To upgrade to Next.js 16:**\n+\n+Connect to your coding agent and then prompt:\n+\n+```txt\n+Next Devtools, help me upgrade my Next.js app to version 16\n+```\n+\n+**To migrate to Cache Components (after upgrading to v16):**\n+\n+Connect to your coding agent and then prompt:\n+\n+```txt\n+Next Devtools, migrate my Next.js app to cache components\n+```\n+\n+### Using the Codemod\n+\n+To update to Next.js version 16, you can use the `upgrade` [codemod](/docs/app/guides/upgrading/codemods#160):\n+\n+```bash filename=\"Terminal\"\n+npx @next/codemod@canary upgrade latest\n+```\n+\n+The [codemod](/docs/app/guides/upgrading/codemods#160) is able to:\n+\n+- Update `next.config.js` to use the new `turbopack` configuration\n+- Migrate from `next lint` to the ESLint CLI\n+- Migrate from deprecated `middleware` convention to `proxy`\n+- Remove `unstable_` prefix from stabilized APIs\n+- Remove `experimental_ppr` Route Segment Config from pages and layouts\n+\n+If you prefer to do it manually, install the latest Next.js and React versions:\n+\n+```bash filename=\"Terminal\"\n+npm install next@latest react@latest react-dom@latest\n+```\n+\n+If you are using TypeScript, ensure you also upgrade `@types/react` and `@types/react-dom` to their latest versions.\n+\n+## Node.js runtime and browser support\n+\n+| Requirement   | Change / Details                                                   |\n+| ------------- | ------------------------------------------------------------------ |\n+| Node.js 20.9+ | Minimum version now `20.9.0` (LTS); Node.js 18 no longer supported |\n+| TypeScript 5+ | Minimum version now `5.1.0`                                        |\n+| Browsers      | Chrome 111+, Edge 111+, Firefox 111+, Safari 16.4+                 |\n+\n+## Turbopack by default\n+\n+Starting with **Next.js 16**, Turbopack is stable and used by default with `next dev` and `next build`\n+\n+Previously you had to enable Turbopack using `--turbopack`, or `--turbo`.\n+\n+```json filename=\"package.json\"\n+{\n+  \"scripts\": {\n+    \"dev\": \"next dev --turbopack\",\n+    \"build\": \"next build --turbopack\",\n+    \"start\": \"next start\"\n+  }\n+}\n+```\n+\n+This is no longer necessary. You can update your `package.json` scripts:\n+\n+```json filename=\"package.json\"\n+{\n+  \"scripts\": {\n+    \"dev\": \"next dev\",\n+    \"build\": \"next build\",\n+    \"start\": \"next start\"\n+  }\n+}\n+```\n+\n+If your project has a [custom `webpack`](/docs/app/api-reference/config/next-config-js/webpack) configuration and you run `next build` (which now uses Turbopack by default), the build will **fail** to prevent misconfiguration issues.\n+\n+You have a few different ways to address this:\n+\n+- **Use Turbopack anyway:** Run with `next build --turbopack` to build using Turbopack and ignore your `webpack` config.\n+- **Switch to Turbopack fully:** Migrate your `webpack` config to Turbopack-compatible options.\n+- **Keep using Webpack:** Use the `--webpack` flag to opt out of Turbopack and build with Webpack.\n+\n+> **Good to know**: If you see failing builds because a `webpack` configuration was found, but you don't define one yourself, it is likely that a plugin is adding a `webpack` option\n+\n+### Opting out of Turbopack\n+\n+If you need to continue using Webpack, you can opt out with the `--webpack` flag. For example, to use Turbopack in development but Webpack for production builds:\n+\n+```json filename=\"package.json\"\n+{\n+  \"scripts\": {\n+    \"dev\": \"next dev\",\n+    \"build\": \"next build --webpack\",\n+    \"start\": \"next start\"\n+  }\n+}\n+```\n+\n+We recommend using Turbopack for development and production. Submit a comment to this [thread](https://github.com/vercel/next.js/discussions/77721), if you are unable to switch to Turbopack.\n+\n+### Turbopack configuration location\n+\n+The `experimental.turbopack` configuration is out of experimental.\n+\n+```ts filename=\"next.config.ts\"\n+import type { NextConfig } from 'next'\n+\n+// Next.js 15 - experimental.turbopack\n+const nextConfig: NextConfig = {\n+  experimental: {\n+    turbopack: {\n+      // options\n+    },\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+You can use it as a top-level `turbopack` option:\n+\n+```ts filename=\"next.config.ts\"\n+import type { NextConfig } from 'next'\n+\n+// Next.js 16 - turbopack at the top level of nextConfig\n+const nextConfig: NextConfig = {\n+  turbopack: {\n+    // options\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+Make sure to review the `Turbopack` configuration [options](/docs/app/api-reference/config/next-config-js/turbopack). **Next.js 16** introduces various improvements and new options, for example:\n+\n+- [Advanced Webpack loader conditions](/docs/app/api-reference/config/next-config-js/turbopack#advanced-webpack-loader-conditions)\n+- [debugIds](/docs/app/api-reference/config/next-config-js/turbopack#debug-ids)\n+\n+### Resolve alias fallback\n+\n+In some projects, client-side code may import files containing Node.js native modules. This will cause `Module not found: Can't resolve 'fs'` type of errors.\n+\n+When this happens, you should refactor your code so that your client-side bundles do not reference these Node.js native modules.\n+\n+However, in some cases, this might not be possible. In Webpack the `resolve.fallback` option was typically used to **silence** the error. Turbopack offers a similar option, using `turbopack.resolveAlias`. In this case, tell Turbopack to load an empty module when `fs` is requested for the browser.\n+\n+```ts filename=\"next.config.ts\"\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  turbopack: {\n+    resolveAlias: {\n+      fs: {\n+        browser: './empty.ts', // We recommend to fix code imports before using this method\n+      },\n+    },\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+It is preferable to refactor your modules so that client code doesn't ever import from modules using Node.js native modules.\n+\n+### Sass node_modules imports\n+\n+Turbopack fully supports importing Sass files from `node_modules`. Note that while Webpack allowed the legacy tilde (`~`) prefix, Turbopack does not support this syntax.\n+\n+In Webpack:\n+\n+```scss filename=\"styles/globals.scss\"\n+@import '~bootstrap/dist/css/bootstrap.min.css';\n+```\n+\n+In Turbopack:\n+\n+```scss filename=\"styles/globals.scss\"\n+@import 'bootstrap/dist/css/bootstrap.min.css';\n+```\n+\n+If changing the imports is not possible, you can use `turbopack.resolveAlias`. For example:\n+\n+```ts filename=\"next.config.ts\"\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  turbopack: {\n+    resolveAlias: {\n+      '~*': '*',\n+    },\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+### Turbopack File System Caching (beta)\n+\n+Turbopack now supports filesystem caching in development, storing compiler artifacts on disk between runs for significantly faster compile times across restarts.\n+\n+Enable filesystem caching in your configuration:\n+\n+```ts filename=\"next.config.ts\" switcher\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  experimental: {\n+    turbopackFileSystemCacheForDev: true,\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  experimental: {\n+    turbopackFileSystemCacheForDev: true,\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+## Async Request APIs (Breaking change)\n+\n+Version 15 introduced [Async Request APIs](https://nextjs.org/docs/app/guides/upgrading/version-15#async-request-apis-breaking-change) as a breaking change, with **temporary** synchronous compatibility.\n+\n+Starting with **Next.js 16**, synchronous access is fully removed. These APIs can only be accessed asynchronously.\n+\n+- [`cookies`](/docs/app/api-reference/functions/cookies)\n+- [`headers`](/docs/app/api-reference/functions/headers)\n+- [`draftMode`](/docs/app/api-reference/functions/draft-mode)\n+- `params` in [`layout.js`](/docs/app/api-reference/file-conventions/layout), [`page.js`](/docs/app/api-reference/file-conventions/page), [`route.js`](/docs/app/api-reference/file-conventions/route), [`default.js`](/docs/app/api-reference/file-conventions/default), [`opengraph-image`](/docs/app/api-reference/file-conventions/metadata/opengraph-image#opengraph-image), [`twitter-image`](/docs/app/api-reference/file-conventions/metadata/opengraph-image#twitter-image), [`icon`](/docs/app/api-reference/file-conventions/metadata/app-icons#icon), and [`apple-icon`](/docs/app/api-reference/file-conventions/metadata/app-icons#apple-icon).\n+- `searchParams` in [`page.js`](/docs/app/api-reference/file-conventions/page)\n+\n+Use the [codemod](/docs/app/guides/upgrading/codemods#migrate-to-async-dynamic-apis) to migrate to async Dynamic APIs.\n+\n+### Migrating types for async Dynamic APIs\n+\n+To help migrate to async `params` and `searchParams`, you can run [`npx next typegen`](/docs/app/api-reference/cli/next#next-typegen-options) to automatically generate these globally available types helpers:\n+\n+- [`PageProps`](/docs/app/api-reference/file-conventions/page#page-props-helper)\n+- [`LayoutProps`](/docs/app/api-reference/file-conventions/layout#layout-props-helper)\n+- [`RouteContext`](/docs/app/api-reference/file-conventions/route#route-context-helper)\n+\n+> **Good to know**: `typegen` was introduced in Next.js 15.5\n+\n+This simplifies type-safe migration to the new async API pattern, and enables you to update your components with full type safety, for example:\n+\n+```tsx filename=\"/app/blog/[slug]/page.tsx\"\n+export default async function Page(props: PageProps<'/blog/[slug]'>) {\n+  const { slug } = await props.params\n+  const query = await props.searchParams\n+  return <h1>Blog Post: {slug}</h1>\n+}\n+```\n+\n+This approach gives you fully type-safe access to `props.params`, including the `slug`, and to `searchParams`, directly within your page.\n+\n+## Async parameters for icon, and open-graph Image (Breaking change)\n+\n+> The props passed to the image generating functions in `opengraph-image`, `twitter-image`, `icon`, and `apple-icon`, are now Promises.\n+\n+In previous versions, both the `Image` (image generation function), and the `generateImageMetadata` received a `params` object. The `id` returned by `generateImageMetadata` was passed as a string to the image generation function.\n+\n+```js filename=\"app/shop/[slug]/opengraph-image.js\"\n+// Next.js 15 - synchronous params access\n+export function generateImageMetadata({ params }) {\n+  const { slug } = params\n+  return [{ id: '1' }, { id: '2' }]\n+}\n+\n+// Next.js 15 - synchronous params and id access\n+export default function Image({ params, id }) {\n+  const slug = params.slug\n+  const imageId = id // string\n+  // ...\n+}\n+```\n+\n+Starting with **Next.js 16**, to align with the [Async Request APIs](#async-request-apis-breaking-change) change, these are also asynchronous.\n+\n+```js filename=\"app/shop/[slug]/opengraph-image.js\"\n+// Next.js 16 - asynchronous params access\n+export async function generateImageMetadata({ params }) {\n+  const { slug } = await params\n+  return [{ id: '1' }, { id: '2' }]\n+}\n+\n+// Next.js 16 - asynchronous params and id access\n+export default async function Image({ params, id }) {\n+  const { slug } = await params // params now async\n+  const imageId = await id // id is now Promise<string> when using generateImageMetadata\n+  // ...\n+}\n+```\n+\n+## React 19.2\n+\n+The App Router in **Next.js 16** uses the latest React [Canary release](https://react.dev/blog/2023/05/03/react-canaries), which includes the newly released React 19.2 features and other features being incrementally stabilized. Highlights include:\n+\n+- **[View Transitions](https://react.dev/reference/react/ViewTransition)**: Animate elements that update inside a Transition or navigation\n+- **[`useEffectEvent`](https://react.dev/reference/react/useEffectEvent)**: Extract non-reactive logic from Effects into reusable Effect Event functions\n+- **[Activity](https://react.dev/reference/react/Activity)**: Render \"background activity\" by hiding UI with `display: none` while maintaining state and cleaning up Effects\n+\n+Learn more in the [React 19.2 announcement](https://react.dev/blog/2025/10/01/react-19-2).\n+\n+## React Compiler Support\n+\n+Built-in support for the React Compiler is now stable in **Next.js 16** following the React Compiler's 1.0 release. The React Compiler automatically memoizes components, reducing unnecessary re-renders with zero manual code changes.\n+\n+The `reactCompiler` configuration option has been promoted from `experimental` to stable. It is not enabled by default as we continue gathering build performance data across different application types.\n+\n+```ts filename=\"next.config.ts\" switcher\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  reactCompiler: true,\n+}\n+\n+export default nextConfig\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  reactCompiler: true,\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+Install the latest version of the React Compiler plugin:\n+\n+```bash filename=\"Terminal\"\n+npm install babel-plugin-react-compiler@latest\n+```\n+\n+> **Good to know:** Expect compile times in development and during builds to be higher when enabling this option as the React Compiler relies on Babel.\n+\n+## Caching APIs\n+\n+### revalidateTag\n+\n+[`revalidateTag`](/docs/app/api-reference/functions/revalidateTag) has a new function signature. You can pass a [`cacheLife`](/docs/app/api-reference/functions/cacheLife#reference) profile as the second argument.\n+\n+```ts filename=\"app/actions.ts\" switcher\n+'use server'\n+\n+import { revalidateTag } from 'next/cache'\n+\n+export async function updateArticle(articleId: string) {\n+  // Mark article data as stale - article readers see stale data while it revalidates\n+  revalidateTag(`article-${articleId}`, 'max')\n+}\n+```\n+\n+```js filename=\"app/actions.js\" switcher\n+'use server'\n+\n+import { revalidateTag } from 'next/cache'\n+\n+export async function updateArticle(articleId) {\n+  // Mark article data as stale - article readers see stale data while it revalidates\n+  revalidateTag(`article-${articleId}`, 'max')\n+}\n+```\n+\n+Use `revalidateTag` for content where a slight delay in updates is acceptable, such as blog posts, product catalogs, or documentation. Users receive stale content while fresh data loads in the background.\n+\n+### updateTag\n+\n+[`updateTag`](/docs/app/api-reference/functions/updateTag) is a new [Server Actions](/docs/app/getting-started/updating-data#what-are-server-functions)-only API that provides **read-your-writes** semantics, where a user makes a change and the UI immediately shows the change, rather than stale data.\n+\n+It does this by expiring and immediately refreshing data within the same request.\n+\n+```ts filename=\"app/actions.ts\" switcher\n+'use server'\n+\n+import { updateTag } from 'next/cache'\n+\n+export async function updateUserProfile(userId: string, profile: Profile) {\n+  await db.users.update(userId, profile)\n+\n+  // Expire cache and refresh immediately - user sees their changes right away\n+  updateTag(`user-${userId}`)\n+}\n+```\n+\n+```js filename=\"app/actions.js\" switcher\n+'use server'\n+\n+import { updateTag } from 'next/cache'\n+\n+export async function updateUserProfile(userId, profile) {\n+  await db.users.update(userId, profile)\n+\n+  // Expire cache and refresh immediately - user sees their changes right away\n+  updateTag(`user-${userId}`)\n+}\n+```\n+\n+This ensures interactive features reflect changes immediately. Perfect for forms, user settings, and any workflow where users expect to see their updates instantly.\n+\n+Learn more about when to use `updateTag` or `revalidateTag` [here](/docs/app/api-reference/functions/updateTag#when-to-use-updatetag).\n+\n+### refresh\n+\n+[`refresh`](/docs/app/api-reference/functions/refresh) allows you to refresh the client router from within a Server Action.\n+\n+```ts filename=\"app/actions.ts\" switcher\n+'use server'\n+\n+import { refresh } from 'next/cache'\n+\n+export async function markNotificationAsRead(notificationId: string) {\n+  // Update the notification in the database\n+  await db.notifications.markAsRead(notificationId)\n+\n+  // Refresh the notification count displayed in the header\n+  refresh()\n+}\n+```\n+\n+```js filename=\"app/actions.js\" switcher\n+'use server'\n+\n+import { refresh } from 'next/cache'\n+\n+export async function markNotificationAsRead(notificationId) {\n+  // Update the notification in the database\n+  await db.notifications.markAsRead(notificationId)\n+\n+  // Refresh the notification count displayed in the header\n+  refresh()\n+}\n+```\n+\n+Use it when you need to refresh the client router after performing an action.\n+\n+### cacheLife and cacheTag\n+\n+[`cacheLife`](/docs/app/api-reference/functions/cacheLife) and [`cacheTag`](/docs/app/api-reference/functions/cacheTag) are now stable. The `unstable_` prefix is no longer needed.\n+\n+Wherever you had aliased imports like:\n+\n+```ts\n+import {\n+  unstable_cacheLife as cacheLife,\n+  unstable_cacheTag as cacheTag,\n+} from 'next/cache'\n+```\n+\n+You can update your imports to:\n+\n+```ts\n+import { cacheLife, cacheTag } from 'next/cache'\n+```\n+\n+## Enhanced Routing and Navigation\n+\n+**Next.js 16** includes a complete overhaul of the routing and navigation system, making page transitions leaner and faster. This optimizes how Next.js prefetches and caches navigation data:\n+\n+- **Layout deduplication**: When prefetching multiple URLs with a shared layout, the layout is downloaded once.\n+- **Incremental prefetching**: Next.js only prefetches parts not already in cache, rather than entire pages.\n+\n+These changes require **no code modifications** and are designed to improve performance across all apps.\n+\n+However, you may see more individual prefetch requests with much lower total transfer sizes. We believe this is the right trade-off for nearly all applications.\n+\n+If the increased request count causes issues, please let us know by creating an [issue](https://github.com/vercel/next.js/issues) or [discussion](https://github.com/vercel/next.js/discussions) item.\n+\n+## Partial Pre-Rendering (PPR)\n+\n+**Next.js 16** removes the experimental **Partial Pre-Rendering (PPR)** flag and configuration options, including the route level segment `experimental_ppr`.\n+\n+Starting with **Next.js 16**, you can opt into PPR using the [`cacheComponents`](/docs/app/api-reference/config/next-config-js/cacheComponents) configuration.\n+\n+```js filename=\"next.config.js\"\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  cacheComponents: true,\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+PPR in **Next.js 16** works differently than in **Next.js 15** canaries. If you are using PPR today, stay in the current Next.js 15 canary you are using. We will follow up with a guide to migrate to Cache Components.\n+\n+```js filename=\"next.config.js\"\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  // If you are using PPR today\n+  // stay in the current Next.js 15 canary\n+  experimental: {\n+    ppr: true,\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+## `middleware` to `proxy`\n+\n+The `middleware` filename is deprecated, and has been renamed to `proxy` to clarify network boundary and routing focus.\n+\n+The `edge` runtime is **NOT** supported in `proxy`. The `proxy` runtime is `nodejs`, and it cannot be configured. If you want to continue using the `edge` runtime, keep using `middleware`. We will follow up on a minor release with further `edge` runtime instructions.\n+\n+```bash filename=\"Terminal\"\n+# Rename your middleware file\n+mv middleware.ts proxy.ts\n+# or\n+mv middleware.js proxy.js\n+```\n+\n+The named export `middleware` is also deprecated. Rename your function to `proxy`.\n+\n+```ts filename=\"proxy.ts\" switcher\n+export function proxy(request: Request) {}\n+```\n+\n+```js filename=\"proxy.js\" switcher\n+export function proxy(request) {}\n+```\n+\n+We recommend changing the function name to `proxy`, even if you are using a default export.\n+\n+Configuration flags that contained the `middleware` name are also renamed. For example, `skipMiddlewareUrlNormalize` is now `skipProxyUrlNormalize`\n+\n+```ts filename=\"next.config.ts\" switcher\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  skipProxyUrlNormalize: true,\n+}\n+\n+export default nextConfig\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  skipProxyUrlNormalize: true,\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+The version 16 [codemod](/docs/app/guides/upgrading/codemods#160) is able to update these flags too.\n+\n+## `next/image` changes\n+\n+### Local Images with Query Strings (Breaking change)\n+\n+Local image sources with query strings now require `images.localPatterns.search` configuration to prevent enumeration attacks.\n+\n+```tsx filename=\"app/page.tsx\"\n+import Image from 'next/image'\n+\n+export default function Page() {\n+  return <Image src=\"/assets/photo?v=1\" alt=\"Photo\" width=\"100\" height=\"100\" />\n+}\n+```\n+\n+If you need to use query strings with local images, add the pattern to your configuration:\n+\n+```ts filename=\"next.config.ts\" switcher\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  images: {\n+    localPatterns: [\n+      {\n+        pathname: '/assets/**',\n+        search: '?v=1',\n+      },\n+    ],\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  images: {\n+    localPatterns: [\n+      {\n+        pathname: '/assets/**',\n+        search: '?v=1',\n+      },\n+    ],\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+### `minimumCacheTTL` Default (Breaking change)\n+\n+The default value for `images.minimumCacheTTL` has changed from `60 seconds` to `4 hours` (14400 seconds). This reduces revalidation cost for images without cache-control headers.\n+\n+For some Next.js users, image revalidation was happening frequently, often because the upstream source images missed a `cache-control` header. This caused revalidation to happen every `60` seconds, which increased CPU usage and cost.\n+\n+Since most images do not change often, this short interval is not ideal. Setting the default to 4 hours offers a more durable cache by default, while still allowing images to update a few times per day if needed.\n+\n+If you need the previous behavior, change `minimumCacheTTL` to a lower value, for example back to `60` seconds:\n+\n+```ts filename=\"next.config.ts\" switcher\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  images: {\n+    minimumCacheTTL: 60,\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  images: {\n+    minimumCacheTTL: 60,\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+### `imageSizes` Default (Breaking change)\n+\n+The value `16` has been removed from the default `images.imageSizes` array.\n+\n+We have looked at request analytics and found out that very few projects ever serve 16 pixels width images. Removing this setting reduces the size of the `srcset` attribute shipped to the browser by `next/image`.\n+\n+If you need to support 16px images:\n+\n+```ts filename=\"next.config.ts\" switcher\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  images: {\n+    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  images: {\n+    imageSizes: [16, 32, 48, 64, 96, 128, 256, 384],\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+Rather than lack of developer usage, we believe 16 pixels width images have become less common, because `devicePixelRatio: 2` actually fetches a 32px image to prevent blurriness in retina displays.\n+\n+### `qualities` Default (Breaking change)\n+\n+The default value for `images.qualities` has changed from allowing all qualities to only `[75]`.\n+\n+If you need to support multiple quality levels:\n+\n+```ts filename=\"next.config.ts\" switcher\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  images: {\n+    qualities: [50, 75, 100],\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  images: {\n+    qualities: [50, 75, 100],\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+If you specify a `quality` prop not included in the `image.qualities` array, the quality will be coerced to the closest value in `images.qualities`. For example, given the configuration above, a `quality` prop of 80, is coerced to 75.\n+\n+### Local IP Restriction (Breaking change)\n+\n+A new security restriction blocks local IP optimization by default. Set `images.dangerouslyAllowLocalIP` to `true` only for private networks.\n+\n+```ts filename=\"next.config.ts\" switcher\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  images: {\n+    dangerouslyAllowLocalIP: true, // Only for private networks\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  images: {\n+    dangerouslyAllowLocalIP: true, // Only for private networks\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+### Maximum Redirects (Breaking change)\n+\n+The default for `images.maximumRedirects` has changed from unlimited to 3 redirects maximum.\n+\n+```ts filename=\"next.config.ts\" switcher\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  images: {\n+    maximumRedirects: 0, // Disable redirects\n+    // or\n+    maximumRedirects: 5, // Increase for edge cases\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+```js filename=\"next.config.js\" switcher\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  images: {\n+    maximumRedirects: 0, // Disable redirects\n+    // or\n+    maximumRedirects: 5, // Increase for edge cases\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+### `next/legacy/image` Component (deprecated)\n+\n+The `next/legacy/image` component is deprecated. Use `next/image` instead:\n+\n+```tsx\n+// Before\n+import Image from 'next/legacy/image'\n+\n+// After\n+import Image from 'next/image'\n+```\n+\n+### `images.domains` Configuration (deprecated)\n+\n+The `images.domains` config is deprecated.\n+\n+```js filename=\"next.config.js\"\n+// image.domains is deprecated\n+module.exports = {\n+  images: {\n+    domains: ['example.com'],\n+  },\n+}\n+```\n+\n+Use `images.remotePatterns` instead for improved security:\n+\n+```js filename=\"next.config.js\"\n+// Use image.remotePatterns instead\n+module.exports = {\n+  images: {\n+    remotePatterns: [\n+      {\n+        protocol: 'https',\n+        hostname: 'example.com',\n+      },\n+    ],\n+  },\n+}\n+```\n+\n+## Concurrent `dev` and `build`\n+\n+`next dev` and `next build` now use separate output directories, enabling concurrent execution. The `next dev` command outputs to `.next/dev`. This is the new default behavior, controlled by [isolatedDevBuild](/docs/app/api-reference/config/next-config-js/isolatedDevBuild).\n+\n+Additionally, a lockfile mechanism prevents multiple `next dev` or `next build` instances on the same project.\n+\n+Since the development server outputs to `.next/dev`, the [Turbopack tracing command](/docs/app/guides/local-development#turbopack-tracing) should be:\n+\n+```bash\n+npx next internal trace .next/dev/trace-turbopack\n+```\n+\n+## Parallel Routes `default.js` requirement\n+\n+All [parallel route](/docs/app/api-reference/file-conventions/parallel-routes) slots now require explicit `default.js` files. Builds will fail without them.\n+\n+To maintain previous behavior, create a [`default.js`](/docs/app/api-reference/file-conventions/default) file that calls `notFound()` or returns `null`.\n+\n+```tsx filename=\"app/@modal/default.tsx\"\n+import { notFound } from 'next/navigation'\n+\n+export default function Default() {\n+  notFound()\n+}\n+```\n+\n+Or return `null`:\n+\n+```tsx filename=\"app/@modal/default.tsx\"\n+export default function Default() {\n+  return null\n+}\n+```\n+\n+## ESLint Flat Config\n+\n+`@next/eslint-plugin-next` now defaults to ESLint Flat Config format, aligning with ESLint v10 which will drop legacy config support.\n+\n+Make sure to review our API reference for the [`@next/eslint-plugin-next`](/docs/app/api-reference/config/eslint#setup-eslint) plugin.\n+\n+If you're using the legacy `.eslintrc` format, consider migrating to the flat config format. See the [ESLint migration guide](https://eslint.org/docs/latest/use/configure/migration-guide) for details.\n+\n+## Scroll Behavior Override\n+\n+In **previous versions of Next.js**, if you had set `scroll-behavior: smooth` globally on your `<html>` element via CSS, Next.js would override this during SPA route transitions, as follows:\n+\n+1. Temporarily set `scroll-behavior` to `auto`\n+2. Perform the navigation (causing instant scroll to top)\n+3. Restore your original `scroll-behavior` value\n+\n+This ensured that page navigation always felt snappy and instant, even when you had smooth scrolling enabled for in-page navigation. However, this manipulation could be expensive, especially at the start of every navigation.\n+\n+In **Next.js 16**, this behavior has changed. By default, Next.js will **no longer override** your `scroll-behavior` setting during navigation.\n+\n+**If you want Next.js to perform this override** (the previous default behavior), add the `data-scroll-behavior=\"smooth\"` attribute to your `<html>` element:\n+\n+```tsx filename=\"app/layout.tsx\"\n+export default function RootLayout({ children }) {\n+  return (\n+    <html lang=\"en\" data-scroll-behavior=\"smooth\">\n+      <body>{children}</body>\n+    </html>\n+  )\n+}\n+```\n+\n+## Performance Improvements\n+\n+Significant performance optimizations for `next dev` and `next start` commands, along with improved terminal output with clearer formatting, better error messages, and improved performance metrics.\n+\n+**Next.js 16** removes the `size` and `First Load JS` metrics from the `next build` output. We found these to be inaccurate in server-driven architectures using React Server Components. Both our Turbopack and Webpack implementations had issues, and disagreed on how to account for Client Components payload.\n+\n+The most effective way to measure actual route performance is through tools such as [Chrome Lighthouse](https://developer.chrome.com/docs/lighthouse/overview) or Vercel Analytics, which focus on Core Web Vitals and downloaded resource sizes.\n+\n+### `next dev` config load\n+\n+In previous versions the Next config file was loaded twice during development:\n+\n+- When running the `next dev` command\n+- When the `next dev` command started the Next.js server\n+\n+This was inefficient because the `next dev` command doesn't need the config file to start the Next.js server.\n+\n+A consequence of this change is that, when running `next dev` checking if `process.argv` includes `'dev'`, in your Next.js config file, will return `false`.\n+\n+> **Good to know**: The `typegen`, and `build` commands, are still visible in `process.argv`.\n+\n+This is specially important for plugins that trigger side-effects on `next dev`. If that's the case, it might be enough to check if `NODE_ENV` is set to `development`.\n+\n+```js filename=\"next.config.js\"\n+import { startServer } from 'docs-lib/dev-server'\n+\n+const isDev = process.env.NODE_ENV === 'development'\n+\n+if (isDev) {\n+  startServer()\n+}\n+\n+const nextConfig = {\n+  /* Your config options */\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+Alternatively, use the [`phase`](/docs/app/api-reference/config/next-config-js#phase) in which the configuration is loaded.\n+\n+## Build Adapters API (alpha)\n+\n+Following the [Build Adapters RFC](https://github.com/vercel/next.js/discussions/77740), the first alpha version of the Build Adapters API is now available.\n+\n+Build Adapters allow you to create custom adapters that hook into the build process, enabling deployment platforms and custom build integrations to modify Next.js configuration or process build output.\n+\n+```js filename=\"next.config.js\"\n+const nextConfig = {\n+  experimental: {\n+    adapterPath: require.resolve('./my-adapter.js'),\n+  },\n+}\n+\n+module.exports = nextConfig\n+```\n+\n+Share your feedback in the [RFC discussion](https://github.com/vercel/next.js/discussions/77740).\n+\n+## Modern Sass API\n+\n+`sass-loader` has been bumped to v16, which supports [modern Sass syntax](https://sass-lang.com/documentation/js-api/#md:usage) and new features.\n+\n+## Removals\n+\n+These features were previously deprecated and are now removed:\n+\n+### AMP Support\n+\n+AMP adoption has declined significantly, and maintaining this feature adds complexity to the framework. All AMP APIs and configurations have been removed:\n+\n+- `amp` configuration from your Next config file\n+- `next/amp` hook imports and usage (`useAmp`)\n+\n+```tsx\n+// Removed\n+import { useAmp } from 'next/amp'\n+\n+// Removed\n+export const config = { amp: true }\n+```\n+\n+- `export const config = { amp: true }` from pages\n+\n+```js filename=\"next.config.js\"\n+const nextConfig = {\n+  // Removed\n+  amp: {\n+    canonicalBase: 'https://example.com',\n+  },\n+}\n+\n+export default nextConfig\n+```\n+\n+Evaluate if AMP is still necessary for your use case. Most performance benefits can now be achieved through Next.js's built-in optimizations and modern web standards.\n+\n+### `next lint` Command\n+\n+The `next lint` command has been removed. Use Biome or ESLint directly. `next build` no longer runs linting.\n+\n+A codemod is available to automate migration:\n+\n+```bash filename=\"Terminal\"\n+npx @next/codemod@canary next-lint-to-eslint-cli .\n+```\n+\n+The `eslint` option in the Next.js config file is also removed.\n+\n+```js filename=\"next.config.mjs\"\n+/** @type {import('next').NextConfig} */\n+const nextConfig = {\n+  // No longer supported\n+  // eslint: {},\n+}\n+\n+export default nextConfig\n+```\n+\n+### Runtime Configuration\n+\n+`serverRuntimeConfig` and `publicRuntimeConfig` have been removed. Use environment variables instead.\n+\n+**Before (Next.js 15):**\n+\n+```js filename=\"next.config.js\"\n+module.exports = {\n+  serverRuntimeConfig: {\n+    dbUrl: process.env.DATABASE_URL,\n+  },\n+  publicRuntimeConfig: {\n+    apiUrl: '/api',\n+  },\n+}\n+```\n+\n+```tsx filename=\"pages/index.tsx\"\n+import getConfig from 'next/config'\n+\n+export default function Page() {\n+  const { publicRuntimeConfig } = getConfig()\n+  return <p>API URL: {publicRuntimeConfig.apiUrl}</p>\n+}\n+```\n+\n+**After (Next.js 16):**\n+\n+For server-only values, access environment variables directly in Server Components:\n+\n+```tsx filename=\"app/page.tsx\"\n+async function fetchData() {\n+  const dbUrl = process.env.DATABASE_URL\n+  // Use for server-side operations only\n+  return await db.query(dbUrl, 'SELECT * FROM users')\n+}\n+\n+export default async function Page() {\n+  const data = await fetchData()\n+  return <div>{/* render data */}</div>\n+}\n+```\n+\n+> **Good to know**: Use the [taint API](/docs/app/api-reference/config/next-config-js/taint) to prevent accidentally passing sensitive server values to Client Components.\n+\n+For client-accessible values, use the `NEXT_PUBLIC_` prefix:\n+\n+```bash filename=\".env.local\"\n+NEXT_PUBLIC_API_URL=\"/api\"\n+```\n+\n+```tsx filename=\"app/components/client-component.tsx\"\n+'use client'\n+\n+export default function ClientComponent() {\n+  const apiUrl = process.env.NEXT_PUBLIC_API_URL\n+  return <p>API URL: {apiUrl}</p>\n+}\n+```\n+\n+To ensure environment variables are read at runtime (not bundled at build time), use the [`connection()`](/docs/app/api-reference/functions/connection) function before reading from `process.env`:\n+\n+```tsx filename=\"app/page.tsx\"\n+import { connection } from 'next/server'\n+\n+export default async function Page() {\n+  await connection()\n+  const config = process.env.RUNTIME_CONFIG\n+  return <p>{config}</p>\n+}\n+```\n+\n+Learn more about [environment variables](/docs/app/guides/environment-variables).\n+\n+### `devIndicators` Options\n+\n+The following options have been removed from [`devIndicators`](/docs/app/api-reference/config/next-config-js/devIndicators):\n+\n+- `appIsrStatus`\n+- `buildActivity`\n+- `buildActivityPosition`\n+\n+The indicator itself remains available.\n+\n+### `experimental.dynamicIO`\n+\n+The `experimental.dynamicIO` flag has been renamed to `cacheComponents`:\n+\n+Update your Next config file, by removing the `dynamicIO` flag.\n+\n+```js filename=\"next.config.js\"\n+// Next.js 15 - experimental.dynamicIO is now removed\n+module.exports = {\n+  experimental: {\n+    dynamicIO: true,\n+  },\n+}\n+```\n+\n+Add the [`cacheComponents`](/docs/app/api-reference/config/next-config-js/cacheComponents) flag set to true.\n+\n+```js filename=\"next.config.js\"\n+// Next.js 16 - use cacheComponents instead\n+module.exports = {\n+  cacheComponents: true,\n+}\n+```\n+\n+### `unstable_rootParams`\n+\n+The `unstable_rootParams` function has been removed. We are working on an alternative API that we will ship in an upcoming minor release."
        }
    ],
    "stats": {
        "total": 1134,
        "additions": 1134,
        "deletions": 0
    }
}