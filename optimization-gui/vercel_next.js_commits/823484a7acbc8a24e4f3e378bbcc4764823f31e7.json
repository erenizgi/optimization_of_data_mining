{
    "author": "ijjk",
    "message": "Apply env inlining during generate build mode (#76990)\n\nThis brings back the env inlining step separate of compilation used for\nthe [flying shuttle\nexperiment](https://github.com/vercel/next.js/pull/73710) so that when\n`next build --experimental-build-mode=compile` is used we don't inline\nthese values so that these artifacts can be cached/reused independent of\nthe env values. Then `next build --experimental-build-mode=generate` can\nbe used to inline the values and run prerendering to generate finalized\nbuild.",
    "sha": "823484a7acbc8a24e4f3e378bbcc4764823f31e7",
    "files": [
        {
            "sha": "1f77744d49267ca9230e300d51da8b27b8180c17",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -659,5 +659,7 @@\n   \"658\": \"Pass `Infinity` instead of `false` if you want to cache on the server forever without checking with the origin.\",\n   \"659\": \"SSG should not return an image cache value\",\n   \"660\": \"Rspack support is only available in Next.js canary.\",\n-  \"661\": \"Build failed because of %s errors\"\n+  \"661\": \"Build failed because of %s errors\",\n+  \"662\": \"Invariant failed to find webpack runtime chunk\",\n+  \"663\": \"Invariant: client chunk changed but failed to detect hash %s\"\n }"
        },
        {
            "sha": "d2e2774e1bdc3ec5f77e7dd63f3e68a22763e08a",
            "filename": "packages/next/src/build/build-context.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Fbuild-context.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Fbuild-context.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fbuild-context.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -93,4 +93,5 @@ export const NextBuildContext: Partial<{\n   previewModeId: string\n   fetchCacheKeyPrefix?: string\n   allowedRevalidateHeaderKeys?: string[]\n+  isCompileMode?: boolean\n }> = {}"
        },
        {
            "sha": "4506887beef3638274b9a88f1aa0d9664962853d",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -206,6 +206,7 @@ import {\n } from '../server/lib/router-utils/build-prefetch-segment-data-route'\n \n import { turbopackBuild } from './turbopack-build'\n+import { inlineStaticEnv, populateStaticEnv } from '../lib/inline-static-env'\n \n type Fallback = null | boolean | string\n \n@@ -821,6 +822,7 @@ export default async function build(\n ): Promise<void> {\n   const isCompileMode = experimentalBuildMode === 'compile'\n   const isGenerateMode = experimentalBuildMode === 'generate'\n+  NextBuildContext.isCompileMode = isCompileMode\n \n   let loadedConfig: NextConfigComplete | undefined\n   try {\n@@ -880,6 +882,12 @@ export default async function build(\n       )\n       NextBuildContext.buildId = buildId\n \n+      // when using compile mode static env isn't inlined so we\n+      // need to populate in normal runtime env\n+      if (isCompileMode || isGenerateMode) {\n+        populateStaticEnv(config)\n+      }\n+\n       const customRoutes: CustomRoutes = await nextBuildSpan\n         .traceChild('load-custom-routes')\n         .traceAsyncFn(() => loadCustomRoutes(config))\n@@ -2483,6 +2491,20 @@ export default async function build(\n         requiredServerFilesManifest\n       )\n \n+      // we don't need to inline for turbopack build as\n+      // it will handle it's own caching separate of compile\n+      if (isGenerateMode && !turboNextBuild) {\n+        await nextBuildSpan\n+          .traceChild('inline-static-env')\n+          .traceAsyncFn(async () => {\n+            await inlineStaticEnv({\n+              distDir,\n+              config,\n+              buildId,\n+            })\n+          })\n+      }\n+\n       const middlewareManifest: MiddlewareManifest = await readManifest(\n         path.join(distDir, SERVER_DIRECTORY, MIDDLEWARE_MANIFEST)\n       )"
        },
        {
            "sha": "3454975abe0446d2945274d49f8935ea8b825d56",
            "filename": "packages/next/src/build/webpack-build/impl.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-build%2Fimpl.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-build%2Fimpl.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-build%2Fimpl.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -107,6 +107,7 @@ export async function webpackBuildImpl(\n \n   const commonWebpackOptions = {\n     isServer: false,\n+    isCompileMode: NextBuildContext.isCompileMode,\n     buildId: NextBuildContext.buildId!,\n     encryptionKey: NextBuildContext.encryptionKey!,\n     config: config,"
        },
        {
            "sha": "1008921791be9e5e985d645f1e32439d76830b73",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -306,7 +306,9 @@ export default async function getBaseWebpackConfig(\n     clientRouterFilters,\n     fetchCacheKeyPrefix,\n     edgePreviewProps,\n+    isCompileMode,\n   }: {\n+    isCompileMode?: boolean\n     buildId: string\n     encryptionKey: string\n     config: NextConfigComplete\n@@ -1909,6 +1911,7 @@ export default async function getBaseWebpackConfig(\n         isNodeOrEdgeCompilation,\n         isNodeServer,\n         middlewareMatchers,\n+        omitNonDeterministic: isCompileMode,\n       }),\n       isClient &&\n         new ReactLoadablePlugin({"
        },
        {
            "sha": "f7257b99823742c08d7a1ec3c5281cb78c16f727",
            "filename": "packages/next/src/build/webpack/plugins/define-env-plugin.ts",
            "status": "modified",
            "additions": 26,
            "deletions": 1,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -38,6 +38,7 @@ export interface DefineEnvPluginOptions {\n   isNodeOrEdgeCompilation: boolean\n   isNodeServer: boolean\n   middlewareMatchers: MiddlewareMatcher[] | undefined\n+  omitNonDeterministic?: boolean\n }\n \n interface DefineEnv {\n@@ -140,6 +141,7 @@ export function getDefineEnv({\n   isNodeOrEdgeCompilation,\n   isNodeServer,\n   middlewareMatchers,\n+  omitNonDeterministic,\n }: DefineEnvPluginOptions): SerializedDefineEnv {\n   const nextPublicEnv = getNextPublicEnvironmentVariables()\n   const nextConfigEnv = getNextConfigEnv(config)\n@@ -304,7 +306,30 @@ export function getDefineEnv({\n     defineEnv[key] = userDefines[key]\n   }\n \n-  return serializeDefineEnv(defineEnv)\n+  const serializedDefineEnv = serializeDefineEnv(defineEnv)\n+\n+  // we delay inlining these values until after the build\n+  // with flying shuttle enabled so we can update them\n+  // without invalidating entries\n+  if (!dev && omitNonDeterministic) {\n+    // client uses window. instead of leaving process.env\n+    // in case process isn't polyfilled on client already\n+    // since by this point it won't be added by webpack\n+    const safeKey = (key: string) =>\n+      isClient ? `window.${key.split('.').pop()}` : key\n+\n+    for (const key in nextPublicEnv) {\n+      serializedDefineEnv[key] = safeKey(key)\n+    }\n+    for (const key in nextConfigEnv) {\n+      serializedDefineEnv[key] = safeKey(key)\n+    }\n+    for (const key of ['process.env.NEXT_DEPLOYMENT_ID']) {\n+      serializedDefineEnv[key] = safeKey(key)\n+    }\n+  }\n+\n+  return serializedDefineEnv\n }\n \n export function getDefineEnvPlugin(options: DefineEnvPluginOptions) {"
        },
        {
            "sha": "9364a59d0b60280d7922f877ece065c2d0150835",
            "filename": "packages/next/src/lib/inline-static-env.ts",
            "status": "added",
            "additions": 146,
            "deletions": 0,
            "changes": 146,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Flib%2Finline-static-env.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Flib%2Finline-static-env.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Finline-static-env.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -0,0 +1,146 @@\n+import fs from 'fs'\n+import path from 'path'\n+import crypto from 'crypto'\n+import { promisify } from 'util'\n+import globOriginal from 'next/dist/compiled/glob'\n+import {\n+  getNextConfigEnv,\n+  getNextPublicEnvironmentVariables,\n+} from '../build/webpack/plugins/define-env-plugin'\n+import { Sema } from 'next/dist/compiled/async-sema'\n+import type { NextConfigComplete } from '../server/config-shared'\n+import { BUILD_MANIFEST } from '../shared/lib/constants'\n+\n+const glob = promisify(globOriginal)\n+\n+const getStaticEnv = (config: NextConfigComplete) => {\n+  const staticEnv: Record<string, string | undefined> = {\n+    ...getNextPublicEnvironmentVariables(),\n+    ...getNextConfigEnv(config),\n+    'process.env.NEXT_DEPLOYMENT_ID': config.deploymentId || '',\n+  }\n+  return staticEnv\n+}\n+\n+export function populateStaticEnv(config: NextConfigComplete) {\n+  // since inlining comes after static generation we need\n+  // to ensure this value is assigned to process env so it\n+  // can still be accessed\n+  const staticEnv = getStaticEnv(config)\n+  for (const key in staticEnv) {\n+    const innerKey = key.split('.').pop() || ''\n+    if (!process.env[innerKey]) {\n+      process.env[innerKey] = staticEnv[key] || ''\n+    }\n+  }\n+}\n+\n+export async function inlineStaticEnv({\n+  distDir,\n+  config,\n+  buildId,\n+}: {\n+  distDir: string\n+  buildId: string\n+  config: NextConfigComplete\n+}) {\n+  const nextConfigEnv = getNextConfigEnv(config)\n+  const staticEnv = getStaticEnv(config)\n+\n+  const serverDir = path.join(distDir, 'server')\n+  const serverChunks = await glob('**/*.js', {\n+    cwd: serverDir,\n+  })\n+  const clientDir = path.join(distDir, 'static')\n+  const clientChunks = await glob('**/*.js', {\n+    cwd: clientDir,\n+  })\n+  const webpackRuntimeFile = clientChunks.find((item) =>\n+    item.match(/webpack-[a-z0-9]{16}/)\n+  )\n+\n+  if (!webpackRuntimeFile) {\n+    throw new Error(`Invariant failed to find webpack runtime chunk`)\n+  }\n+\n+  const inlineSema = new Sema(8)\n+  const nextConfigEnvKeys = Object.keys(nextConfigEnv).map((item) =>\n+    item.split('process.env.').pop()\n+  )\n+\n+  const builtRegEx = new RegExp(\n+    `[\\\\w]{1,}(\\\\.env)?\\\\.(?:NEXT_PUBLIC_[\\\\w]{1,}${nextConfigEnvKeys.length ? '|' + nextConfigEnvKeys.join('|') : ''})`,\n+    'g'\n+  )\n+  const changedClientFiles: Array<{ file: string; content: string }> = []\n+\n+  for (const [parentDir, files] of [\n+    [serverDir, serverChunks],\n+    [clientDir, clientChunks],\n+  ] as const) {\n+    await Promise.all(\n+      files.map(async (file) => {\n+        await inlineSema.acquire()\n+        const filepath = path.join(parentDir, file)\n+        const content = await fs.promises.readFile(filepath, 'utf8')\n+        const newContent = content.replace(builtRegEx, (match) => {\n+          let normalizedMatch = `process.env.${match.split('.').pop()}`\n+\n+          if (staticEnv[normalizedMatch]) {\n+            return JSON.stringify(staticEnv[normalizedMatch])\n+          }\n+          return match\n+        })\n+\n+        await fs.promises.writeFile(filepath, newContent)\n+\n+        if (content !== newContent && parentDir === clientDir) {\n+          changedClientFiles.push({ file, content: newContent })\n+        }\n+        inlineSema.release()\n+      })\n+    )\n+  }\n+  const hashChanges: Array<{\n+    originalHash: string\n+    newHash: string\n+  }> = []\n+\n+  // hashes need updating for any changed client files\n+  for (const { file, content } of changedClientFiles) {\n+    // hash is 16 chars currently for all client chunks\n+    const originalHash = file.match(/([a-z0-9]{16})\\./)?.[1] || ''\n+\n+    if (!originalHash) {\n+      throw new Error(\n+        `Invariant: client chunk changed but failed to detect hash ${file}`\n+      )\n+    }\n+    const newHash = crypto\n+      .createHash('sha256')\n+      .update(content)\n+      .digest('hex')\n+      .substring(0, 16)\n+\n+    hashChanges.push({ originalHash, newHash })\n+    const filepath = path.join(clientDir, file)\n+    await fs.promises.rename(filepath, filepath.replace(originalHash, newHash))\n+  }\n+\n+  // update build-manifest and webpack-runtime with new hashes\n+  for (const file of [\n+    path.join(distDir, BUILD_MANIFEST),\n+    path.join(distDir, 'static', webpackRuntimeFile),\n+    path.join(distDir, 'static', buildId, '_buildManifest.js'),\n+  ]) {\n+    const content = await fs.promises.readFile(file, 'utf-8')\n+    let newContent = content\n+\n+    for (const { originalHash, newHash } of hashChanges) {\n+      newContent = newContent.replaceAll(originalHash, newHash)\n+    }\n+    if (content !== newContent) {\n+      await fs.promises.writeFile(file, newContent)\n+    }\n+  }\n+}"
        },
        {
            "sha": "38d776dccb852306e3f351086d9363dba3be2216",
            "filename": "packages/next/src/server/base-server.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fbase-server.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -614,6 +614,17 @@ export default abstract class Server<\n       reactMaxHeadersLength: this.nextConfig.reactMaxHeadersLength,\n     }\n \n+    if (process.env.NEXT_RUNTIME !== 'edge') {\n+      const { populateStaticEnv } =\n+        require('../lib/inline-static-env') as typeof import('../lib/inline-static-env')\n+\n+      // when using compile mode static env isn't inlined so we\n+      // need to populate in normal runtime env\n+      if (this.renderOpts.isExperimentalCompile) {\n+        populateStaticEnv(this.nextConfig)\n+      }\n+    }\n+\n     // Initialize next/config with the environment configuration\n     setConfig({\n       serverRuntimeConfig,"
        },
        {
            "sha": "ff776dc1d4008ee60553a7e67439c5cfd126ad3d",
            "filename": "test/e2e/app-dir/app/index.test.ts",
            "status": "modified",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/test%2Fe2e%2Fapp-dir%2Fapp%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/test%2Fe2e%2Fapp-dir%2Fapp%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp%2Findex.test.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -18,6 +18,9 @@ describe('app dir - basic', () => {\n       dependencies: {\n         nanoid: '4.0.1',\n       },\n+      env: {\n+        NEXT_PUBLIC_TEST_ID: Date.now() + '',\n+      },\n     })\n \n   if (isNextStart) {\n@@ -1788,4 +1791,34 @@ describe('app dir - basic', () => {\n       })\n     }\n   })\n+\n+  // this one comes at the end to not change behavior from above\n+  // assertions with compile mode specifically\n+  // consider breaking out into separate fixture if we expand this any more\n+  if (process.env.NEXT_EXPERIMENTAL_COMPILE) {\n+    it('should run generate command correctly', async () => {\n+      await next.stop()\n+\n+      next.buildCommand = `pnpm next build --experimental-build-mode=generate`\n+      await next.start()\n+\n+      let browser = await next.browser('/')\n+\n+      expect(await browser.elementByCss('#my-env').text()).toBe(\n+        next.env.NEXT_PUBLIC_TEST_ID\n+      )\n+      expect(await browser.elementByCss('#my-other-env').text()).toBe(\n+        `${next.env.NEXT_PUBLIC_TEST_ID}-suffix`\n+      )\n+\n+      browser = await next.browser('/dashboard/deployments/123')\n+\n+      expect(await browser.elementByCss('#my-env').text()).toBe(\n+        next.env.NEXT_PUBLIC_TEST_ID\n+      )\n+      expect(await browser.elementByCss('#my-other-env').text()).toBe(\n+        `${next.env.NEXT_PUBLIC_TEST_ID}-suffix`\n+      )\n+    })\n+  }\n })"
        },
        {
            "sha": "54910bd2797a95f4191f908e2987bdfc1b18c28c",
            "filename": "test/lib/e2e-utils/index.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/test%2Flib%2Fe2e-utils%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/test%2Flib%2Fe2e-utils%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fe2e-utils%2Findex.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -272,6 +272,15 @@ export function nextTestSetup(\n       const prop = next[property]\n       return typeof prop === 'function' ? prop.bind(next) : prop\n     },\n+    set: function (_target, key, value) {\n+      if (!next) {\n+        throw new Error(\n+          'next instance is not initialized yet, make sure you call methods on next instance in test body.'\n+        )\n+      }\n+      next[key] = value\n+      return true\n+    },\n   })\n \n   return {"
        },
        {
            "sha": "d7e38b58388f74283f03eadd9054cbba401f7b66",
            "filename": "test/lib/next-modes/base.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/823484a7acbc8a24e4f3e378bbcc4764823f31e7/test%2Flib%2Fnext-modes%2Fbase.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/823484a7acbc8a24e4f3e378bbcc4764823f31e7/test%2Flib%2Fnext-modes%2Fbase.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-modes%2Fbase.ts?ref=823484a7acbc8a24e4f3e378bbcc4764823f31e7",
            "patch": "@@ -65,8 +65,8 @@ export class NextInstance {\n   protected overrideFiles: ResolvedFileConfig\n   protected nextConfig?: NextConfig\n   protected installCommand?: InstallCommand\n-  protected buildCommand?: string\n-  protected buildOptions?: string\n+  public buildCommand?: string\n+  public buildOptions?: string\n   protected startCommand?: string\n   protected startOptions?: string[]\n   protected dependencies?: PackageJson['dependencies'] = {}"
        }
    ],
    "stats": {
        "total": 261,
        "additions": 257,
        "deletions": 4
    }
}