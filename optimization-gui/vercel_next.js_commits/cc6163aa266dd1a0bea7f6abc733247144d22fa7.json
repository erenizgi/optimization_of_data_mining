{
    "author": "lukesandberg",
    "message": "[turbopack] Remove Value::new wrapper for Availabilityinfo parameters (#80132)\n\nRemove Value::new wrapper for Availabilityinfo parameters\n\n### Why?\nThe Value<> type is confusing and error prone, lets destroy it!\n\nAs discussed over slack, turbo_tasks::Value type always implements is_resolved as true and is_transient as false which is incorrect and can enable smuggling transient vcs into turbo tasks.\n\n• https://vercel.slack.com/archives/C03EWR7LGEN/p1743456121241529\n• https://vercel.slack.com/archives/C04NGV98TPS/p1743455453764879",
    "sha": "cc6163aa266dd1a0bea7f6abc733247144d22fa7",
    "files": [
        {
            "sha": "2005ac4f7228d85d4e9c4fcf645b4c4bc911a9c0",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -1256,7 +1256,7 @@ impl AppEndpoint {\n             *client_references,\n             *module_graphs.full,\n             *client_chunking_context,\n-            Value::new(client_shared_availability_info),\n+            client_shared_availability_info,\n             ssr_chunking_context.map(|ctx| *ctx),\n         )\n         .to_resolved()\n@@ -1724,7 +1724,7 @@ impl AppEndpoint {\n                                 .collect(),\n                         ),\n                         module_graph,\n-                        Value::new(AvailabilityInfo::Root),\n+                        AvailabilityInfo::Root,\n                     )\n                     .await?;\n \n@@ -1740,7 +1740,7 @@ impl AppEndpoint {\n                             app_entry.rsc_entry.ident(),\n                             ChunkGroup::Entry(evaluatable_assets.collect()),\n                             module_graph,\n-                            Value::new(availability_info),\n+                            availability_info,\n                         )\n                         .resolve()\n                         .await?,\n@@ -1776,7 +1776,7 @@ impl AppEndpoint {\n                                 // TODO this should be ChunkGroup::Shared\n                                 ChunkGroup::Entry(server_utils),\n                                 module_graph,\n-                                Value::new(current_availability_info),\n+                                current_availability_info,\n                             )\n                             .await?;\n \n@@ -1814,7 +1814,7 @@ impl AppEndpoint {\n                                         server_component.await?.module,\n                                     )]),\n                                     module_graph,\n-                                    Value::new(current_availability_info),\n+                                    current_availability_info,\n                                 )\n                                 .await?;\n \n@@ -1843,7 +1843,7 @@ impl AppEndpoint {\n                                 Vc::cell(evaluatable_assets),\n                                 module_graph,\n                                 current_chunks,\n-                                Value::new(current_availability_info),\n+                                current_availability_info,\n                             )\n                             .to_resolved()\n                             .await?,"
        },
        {
            "sha": "fbaf21ad7ce6792ebc0cde9864249e0527bda453",
            "filename": "crates/next-api/src/dynamic_imports.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fdynamic_imports.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -26,7 +26,7 @@ use next_core::{\n };\n use serde::{Deserialize, Serialize};\n use turbo_tasks::{\n-    FxIndexMap, NonLocalValue, ReadRef, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Value, Vc,\n+    FxIndexMap, NonLocalValue, ReadRef, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Vc,\n     debug::ValueDebugFormat, trace::TraceRawVcs,\n };\n use turbopack_core::{\n@@ -75,11 +75,8 @@ pub(crate) async fn collect_next_dynamic_chunks(\n                 }\n             };\n \n-            let async_loader = chunking_context.async_loader_chunk_item(\n-                *module,\n-                module_graph,\n-                Value::new(availability_info),\n-            );\n+            let async_loader =\n+                chunking_context.async_loader_chunk_item(*module, module_graph, availability_info);\n             let async_chunk_group = async_loader.references().to_resolved().await?;\n \n             let module_id = dynamic_entry"
        },
        {
            "sha": "43186763288434fbc3ae9dd61282cc7354e47b71",
            "filename": "crates/next-api/src/instrumentation.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Finstrumentation.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -125,7 +125,7 @@ impl InstrumentationEndpoint {\n             module.ident(),\n             ChunkGroup::Entry(evaluatable_assets),\n             module_graph,\n-            Value::new(AvailabilityInfo::Root),\n+            AvailabilityInfo::Root,\n         );\n \n         Ok(edge_files)\n@@ -162,7 +162,7 @@ impl InstrumentationEndpoint {\n                 .with_entry(*module),\n                 module_graph,\n                 OutputAssets::empty(),\n-                Value::new(AvailabilityInfo::Root),\n+                AvailabilityInfo::Root,\n             )\n             .await?;\n         Ok(*chunk)"
        },
        {
            "sha": "5b00e228ff9fbeaf3709ca84521db60fd34222b5",
            "filename": "crates/next-api/src/middleware.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fmiddleware.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -127,7 +127,7 @@ impl MiddlewareEndpoint {\n             module.ident(),\n             ChunkGroup::Entry(evaluatable_assets),\n             module_graph,\n-            Value::new(AvailabilityInfo::Root),\n+            AvailabilityInfo::Root,\n         );\n         Ok(edge_files)\n     }\n@@ -163,7 +163,7 @@ impl MiddlewareEndpoint {\n                 .with_entry(*module),\n                 module_graph,\n                 OutputAssets::empty(),\n-                Value::new(AvailabilityInfo::Root),\n+                AvailabilityInfo::Root,\n             )\n             .await?;\n         Ok(*chunk)"
        },
        {
            "sha": "7b5ee20aae287c79b91766188ff60b17638a3730",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -842,7 +842,7 @@ impl PageEndpoint {\n                 AssetIdent::from_path(*this.page.await?.base_path),\n                 ChunkGroup::Entry(evaluatable_assets),\n                 module_graph,\n-                Value::new(AvailabilityInfo::Root),\n+                AvailabilityInfo::Root,\n             );\n \n             Ok(client_chunk_group)\n@@ -1038,7 +1038,7 @@ impl PageEndpoint {\n                             layout.ident(),\n                             ChunkGroup::Shared(layout),\n                             ssr_module_graph,\n-                            Value::new(current_availability_info),\n+                            current_availability_info,\n                         )\n                         .await?;\n \n@@ -1068,7 +1068,7 @@ impl PageEndpoint {\n                     ssr_module.ident(),\n                     ChunkGroup::Entry(evaluatable_assets.collect()),\n                     ssr_module_graph,\n-                    Value::new(current_availability_info),\n+                    current_availability_info,\n                 );\n \n                 Ok(SsrChunk::Edge {\n@@ -1090,7 +1090,7 @@ impl PageEndpoint {\n                         runtime_entries.with_entry(*ssr_module_evaluatable),\n                         ssr_module_graph,\n                         current_chunks,\n-                        Value::new(current_availability_info),\n+                        current_availability_info,\n                     )\n                     .to_resolved()\n                     .await?;"
        },
        {
            "sha": "b26cadfec11b830a981856def67403b7604b9fbc",
            "filename": "crates/next-core/src/next_app/app_client_references_chunks.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_references_chunks.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_references_chunks.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_references_chunks.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -1,9 +1,7 @@\n use anyhow::Result;\n use tracing::Instrument;\n use turbo_rcstr::rcstr;\n-use turbo_tasks::{\n-    FxIndexMap, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, Value, ValueToString, Vc,\n-};\n+use turbo_tasks::{FxIndexMap, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, ValueToString, Vc};\n use turbopack_core::{\n     chunk::{ChunkingContext, availability_info::AvailabilityInfo},\n     module::Module,\n@@ -41,7 +39,7 @@ pub async fn get_app_client_references_chunks(\n     app_client_references: Vc<ClientReferenceGraphResult>,\n     module_graph: Vc<ModuleGraph>,\n     client_chunking_context: Vc<Box<dyn ChunkingContext>>,\n-    client_availability_info: Value<AvailabilityInfo>,\n+    client_availability_info: AvailabilityInfo,\n     ssr_chunking_context: Option<Vc<Box<dyn ChunkingContext>>>,\n ) -> Result<Vc<ClientReferencesChunks>> {\n     async move {\n@@ -161,7 +159,7 @@ pub async fn get_app_client_references_chunks(\n \n             let chunk_group_info = module_graph.chunk_group_info();\n \n-            let mut current_client_availability_info = client_availability_info.into_value();\n+            let mut current_client_availability_info = client_availability_info;\n             let mut current_client_chunks = OutputAssets::empty().to_resolved().await?;\n             let mut current_ssr_availability_info = AvailabilityInfo::Root;\n             let mut current_ssr_chunks = OutputAssets::empty().to_resolved().await?;\n@@ -221,7 +219,7 @@ pub async fn get_app_client_references_chunks(\n                                 entries: ssr_modules,\n                             },\n                             module_graph,\n-                            Value::new(current_ssr_availability_info),\n+                            current_ssr_availability_info,\n                         )\n                     })\n                 } else {\n@@ -259,7 +257,7 @@ pub async fn get_app_client_references_chunks(\n                             entries: client_modules,\n                         },\n                         module_graph,\n-                        Value::new(current_client_availability_info),\n+                        current_client_availability_info,\n                     ))\n                 } else {\n                     None"
        },
        {
            "sha": "13baaae6924ec20f51110171f3fd231583dce482",
            "filename": "crates/next-core/src/next_app/app_client_shared_chunks.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_shared_chunks.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_shared_chunks.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_app%2Fapp_client_shared_chunks.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use tracing::Instrument;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbopack_core::{\n     chunk::{\n         ChunkGroupResult, ChunkingContext, EvaluatableAssets, availability_info::AvailabilityInfo,\n@@ -38,7 +38,7 @@ pub async fn get_app_client_shared_chunk_group(\n                         .collect(),\n                 ),\n                 module_graph,\n-                Value::new(AvailabilityInfo::Root),\n+                AvailabilityInfo::Root,\n             )\n             .resolve()\n             .await"
        },
        {
            "sha": "cfba15e2d892e46616c12bc8eb8e5dceb0d6d138",
            "filename": "turbopack/crates/turbopack-browser/src/chunking_context.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 6,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -524,13 +524,13 @@ impl ChunkingContext for BrowserChunkingContext {\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Result<Vc<ChunkGroupResult>> {\n         let span = tracing::info_span!(\"chunking\", ident = ident.to_string().await?.to_string());\n         async move {\n             let this = self.await?;\n             let modules = chunk_group.entries();\n-            let input_availability_info = availability_info.into_value();\n+            let input_availability_info = availability_info;\n             let MakeChunkGroupResult {\n                 chunks,\n                 availability_info,\n@@ -588,15 +588,14 @@ impl ChunkingContext for BrowserChunkingContext {\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Result<Vc<ChunkGroupResult>> {\n         let span = {\n             let ident = ident.to_string().await?.to_string();\n             tracing::info_span!(\"chunking\", chunking_type = \"evaluated\", ident = ident)\n         };\n         async move {\n             let this = self.await?;\n-            let availability_info = availability_info.into_value();\n \n             let entries = chunk_group.entries();\n \n@@ -665,7 +664,7 @@ impl ChunkingContext for BrowserChunkingContext {\n         _evaluatable_assets: Vc<EvaluatableAssets>,\n         _module_graph: Vc<ModuleGraph>,\n         _extra_chunks: Vc<OutputAssets>,\n-        _availability_info: Value<AvailabilityInfo>,\n+        _availability_info: AvailabilityInfo,\n     ) -> Result<Vc<EntryChunkGroupResult>> {\n         bail!(\"Browser chunking context does not support entry chunk groups\")\n     }\n@@ -680,7 +679,7 @@ impl ChunkingContext for BrowserChunkingContext {\n         self: Vc<Self>,\n         module: Vc<Box<dyn ChunkableModule>>,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Result<Vc<Box<dyn ChunkItem>>> {\n         Ok(if self.await?.manifest_chunks {\n             let manifest_asset ="
        },
        {
            "sha": "310211c12a6b473d0950ce52031959096055c62f",
            "filename": "turbopack/crates/turbopack-cli/src/build/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -439,7 +439,7 @@ async fn build_internal(\n                                         [ResolvedVc::upcast(ecmascript)].into_iter().collect(),\n                                     ),\n                                     module_graph,\n-                                    Value::new(AvailabilityInfo::Root),\n+                                    AvailabilityInfo::Root,\n                                 )\n                                 .await?\n                                 .assets\n@@ -462,7 +462,7 @@ async fn build_internal(\n                                     EvaluatableAssets::one(*ResolvedVc::upcast(ecmascript)),\n                                     module_graph,\n                                     OutputAssets::empty(),\n-                                    Value::new(AvailabilityInfo::Root),\n+                                    AvailabilityInfo::Root,\n                                 )\n                                 .await?\n                                 .asset,"
        },
        {
            "sha": "0c2839f32cef637bd635b962a0eefc39564241fa",
            "filename": "turbopack/crates/turbopack-core/src/chunk/availability_info.rs",
            "status": "modified",
            "additions": 15,
            "deletions": 3,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Favailability_info.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Favailability_info.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Favailability_info.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -1,10 +1,22 @@\n use anyhow::Result;\n-use turbo_tasks::{ResolvedVc, Vc};\n+use serde::{Deserialize, Serialize};\n+use turbo_tasks::{NonLocalValue, ResolvedVc, TaskInput, Vc, trace::TraceRawVcs};\n \n use super::available_modules::{AvailableModules, AvailableModulesSet};\n \n-#[turbo_tasks::value(serialization = \"auto_for_input\")]\n-#[derive(Hash, Clone, Copy, Debug)]\n+#[derive(\n+    Eq,\n+    PartialEq,\n+    Hash,\n+    Clone,\n+    Copy,\n+    Debug,\n+    TaskInput,\n+    TraceRawVcs,\n+    NonLocalValue,\n+    Serialize,\n+    Deserialize,\n+)]\n pub enum AvailabilityInfo {\n     /// Availability of modules is not tracked\n     Untracked,"
        },
        {
            "sha": "fa456a641d08e6e98de32ab550e8d98cb3b27ba4",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunk_group.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunk_group.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunk_group.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunk_group.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -2,7 +2,7 @@ use std::collections::HashSet;\n \n use anyhow::{Context, Result};\n use rustc_hash::FxHashMap;\n-use turbo_tasks::{FxIndexSet, ResolvedVc, TryJoinIterExt, Value, Vc};\n+use turbo_tasks::{FxIndexSet, ResolvedVc, TryJoinIterExt, Vc};\n \n use super::{\n     Chunk, ChunkGroupContent, ChunkItem, ChunkItemWithAsyncModuleInfo, ChunkingContext,\n@@ -105,7 +105,7 @@ pub async fn make_chunk_group(\n         .into_iter()\n         .map(async |module| {\n             chunking_context\n-                .async_loader_chunk_item(*module, module_graph, Value::new(availability_info))\n+                .async_loader_chunk_item(*module, module_graph, availability_info)\n                 .to_resolved()\n                 .await\n         })"
        },
        {
            "sha": "214e7a6676f75fb0d6973734ad50fea4712a5a3f",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking_context.rs",
            "status": "modified",
            "additions": 17,
            "deletions": 22,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -2,7 +2,7 @@ use anyhow::Result;\n use rustc_hash::FxHashMap;\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{NonLocalValue, ResolvedVc, TaskInput, Upcast, Value, Vc, trace::TraceRawVcs};\n+use turbo_tasks::{NonLocalValue, ResolvedVc, TaskInput, Upcast, Vc, trace::TraceRawVcs};\n use turbo_tasks_fs::FileSystemPath;\n use turbo_tasks_hash::DeterministicHash;\n \n@@ -205,7 +205,7 @@ pub trait ChunkingContext {\n         &self,\n         module: Vc<Box<dyn ChunkableModule>>,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<Box<dyn ChunkItem>>;\n     fn async_loader_chunk_item_id(&self, module: Vc<Box<dyn ChunkableModule>>) -> Vc<ModuleId>;\n \n@@ -214,15 +214,15 @@ pub trait ChunkingContext {\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<ChunkGroupResult>;\n \n     fn evaluated_chunk_group(\n         self: Vc<Self>,\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<ChunkGroupResult>;\n \n     /// Generates an output chunk that:\n@@ -235,7 +235,7 @@ pub trait ChunkingContext {\n         evaluatable_assets: Vc<EvaluatableAssets>,\n         module_graph: Vc<ModuleGraph>,\n         extra_chunks: Vc<OutputAssets>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Result<Vc<EntryChunkGroupResult>>;\n \n     async fn chunk_item_id_from_ident(\n@@ -275,7 +275,7 @@ pub trait ChunkingContextExt {\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<OutputAssets>\n     where\n         Self: Send;\n@@ -286,7 +286,7 @@ pub trait ChunkingContextExt {\n         evaluatable_assets: Vc<EvaluatableAssets>,\n         module_graph: Vc<ModuleGraph>,\n         extra_chunks: Vc<OutputAssets>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<Box<dyn OutputAsset>>\n     where\n         Self: Send;\n@@ -316,7 +316,7 @@ pub trait ChunkingContextExt {\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<OutputAssets>\n     where\n         Self: Send;\n@@ -329,12 +329,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n     ) -> Vc<ChunkGroupResult> {\n-        self.chunk_group(\n-            ident,\n-            chunk_group,\n-            module_graph,\n-            Value::new(AvailabilityInfo::Root),\n-        )\n+        self.chunk_group(ident, chunk_group, module_graph, AvailabilityInfo::Root)\n     }\n \n     fn root_chunk_group_assets(\n@@ -351,7 +346,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<OutputAssets> {\n         evaluated_chunk_group_assets(\n             Vc::upcast(self),\n@@ -368,7 +363,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n         evaluatable_assets: Vc<EvaluatableAssets>,\n         module_graph: Vc<ModuleGraph>,\n         extra_chunks: Vc<OutputAssets>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<Box<dyn OutputAsset>> {\n         entry_chunk_group_asset(\n             Vc::upcast(self),\n@@ -392,7 +387,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n             evaluatable_assets,\n             module_graph,\n             extra_chunks,\n-            Value::new(AvailabilityInfo::Root),\n+            AvailabilityInfo::Root,\n         )\n     }\n \n@@ -409,7 +404,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n             evaluatable_assets,\n             module_graph,\n             extra_chunks,\n-            Value::new(AvailabilityInfo::Root),\n+            AvailabilityInfo::Root,\n         )\n     }\n \n@@ -418,7 +413,7 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<OutputAssets> {\n         chunk_group_assets(\n             Vc::upcast(self),\n@@ -449,7 +444,7 @@ async fn evaluated_chunk_group_assets(\n     ident: Vc<AssetIdent>,\n     chunk_group: ChunkGroup,\n     module_graph: Vc<ModuleGraph>,\n-    availability_info: Value<AvailabilityInfo>,\n+    availability_info: AvailabilityInfo,\n ) -> Result<Vc<OutputAssets>> {\n     Ok(*chunking_context\n         .evaluated_chunk_group(ident, chunk_group, module_graph, availability_info)\n@@ -464,7 +459,7 @@ async fn entry_chunk_group_asset(\n     evaluatable_assets: Vc<EvaluatableAssets>,\n     module_graph: Vc<ModuleGraph>,\n     extra_chunks: Vc<OutputAssets>,\n-    availability_info: Value<AvailabilityInfo>,\n+    availability_info: AvailabilityInfo,\n ) -> Result<Vc<Box<dyn OutputAsset>>> {\n     Ok(*chunking_context\n         .entry_chunk_group(\n@@ -484,7 +479,7 @@ async fn chunk_group_assets(\n     ident: Vc<AssetIdent>,\n     chunk_group: ChunkGroup,\n     module_graph: Vc<ModuleGraph>,\n-    availability_info: Value<AvailabilityInfo>,\n+    availability_info: AvailabilityInfo,\n ) -> Result<Vc<OutputAssets>> {\n     Ok(*chunking_context\n         .chunk_group(ident, chunk_group, module_graph, availability_info)"
        },
        {
            "sha": "bb11589f14bb6f8a82a9a511f629797440e071de",
            "filename": "turbopack/crates/turbopack-dev-server/src/html.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhtml.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhtml.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-dev-server%2Fsrc%2Fhtml.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -3,7 +3,7 @@ use mime_guess::mime::TEXT_HTML_UTF_8;\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n-    NonLocalValue, ReadRef, ResolvedVc, TaskInput, TryJoinIterExt, Value, Vc, trace::TraceRawVcs,\n+    NonLocalValue, ReadRef, ResolvedVc, TaskInput, TryJoinIterExt, Vc, trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{File, FileSystemPath};\n use turbo_tasks_hash::{Xxh3Hash64Hasher, encode_hex};\n@@ -159,7 +159,7 @@ impl DevHtmlAsset {\n                                 .collect(),\n                         ),\n                         *module_graph,\n-                        Value::new(AvailabilityInfo::Root),\n+                        AvailabilityInfo::Root,\n                     )\n                 } else {\n                     chunking_context.root_chunk_group_assets("
        },
        {
            "sha": "c76cc0f40ddd2b77f2f2e9f3f3b4f71cb4089aa8",
            "filename": "turbopack/crates/turbopack-ecmascript/src/async_chunk/chunk_item.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fchunk_item.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use indoc::formatdoc;\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc};\n use turbopack_core::{\n     chunk::{\n         ChunkData, ChunkItem, ChunkType, ChunkingContext, ChunkingContextExt, ChunksData,\n@@ -54,7 +54,7 @@ impl AsyncLoaderChunkItem {\n             module.inner.ident(),\n             ChunkGroup::Async(ResolvedVc::upcast(module.inner)),\n             *self.module_graph,\n-            Value::new(module.availability_info),\n+            module.availability_info,\n         ))\n     }\n "
        },
        {
            "sha": "716506dcb3302cf487b5197651aa8108fb8090ce",
            "filename": "turbopack/crates/turbopack-ecmascript/src/async_chunk/module.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fasync_chunk%2Fmodule.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::rcstr;\n-use turbo_tasks::{ResolvedVc, Value, Vc};\n+use turbo_tasks::{ResolvedVc, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{ChunkableModule, ChunkingContext, availability_info::AvailabilityInfo},\n@@ -27,12 +27,12 @@ impl AsyncLoaderModule {\n     pub fn new(\n         module: ResolvedVc<Box<dyn ChunkableModule>>,\n         chunking_context: ResolvedVc<Box<dyn ChunkingContext>>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<Self> {\n         Self::cell(AsyncLoaderModule {\n             inner: module,\n             chunking_context,\n-            availability_info: availability_info.into_value(),\n+            availability_info,\n         })\n     }\n "
        },
        {
            "sha": "c8b5474ae7566c98c4bc96f1471827eeffa188bd",
            "filename": "turbopack/crates/turbopack-ecmascript/src/manifest/chunk_asset.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_asset.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_asset.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fmanifest%2Fchunk_asset.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -1,6 +1,6 @@\n use anyhow::Result;\n use turbo_rcstr::{RcStr, rcstr};\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     chunk::{\n@@ -44,13 +44,13 @@ impl ManifestAsyncModule {\n         module: ResolvedVc<Box<dyn ChunkableModule>>,\n         module_graph: ResolvedVc<ModuleGraph>,\n         chunking_context: ResolvedVc<Box<dyn ChunkingContext>>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Vc<Self> {\n         Self::cell(ManifestAsyncModule {\n             inner: module,\n             module_graph,\n             chunking_context,\n-            availability_info: availability_info.into_value(),\n+            availability_info,\n         })\n     }\n \n@@ -60,7 +60,7 @@ impl ManifestAsyncModule {\n             self.inner.ident(),\n             ChunkGroup::Async(ResolvedVc::upcast(self.inner)),\n             *self.module_graph,\n-            Value::new(self.availability_info),\n+            self.availability_info,\n         )\n     }\n \n@@ -85,7 +85,7 @@ impl ManifestAsyncModule {\n             self.ident(),\n             ChunkGroup::Async(ResolvedVc::upcast(self)),\n             *this.module_graph,\n-            Value::new(this.availability_info),\n+            this.availability_info,\n         ))\n     }\n "
        },
        {
            "sha": "ee1bbc7ca1a74639483dfceea2b6da530b19a85d",
            "filename": "turbopack/crates/turbopack-ecmascript/src/worker_chunk/chunk_item.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fworker_chunk%2Fchunk_item.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -1,7 +1,7 @@\n use anyhow::Result;\n use indoc::formatdoc;\n use turbo_rcstr::rcstr;\n-use turbo_tasks::{ResolvedVc, TryJoinIterExt, Value, Vc};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc};\n use turbopack_core::{\n     chunk::{\n         ChunkData, ChunkItem, ChunkType, ChunkingContext, ChunkingContextExt, ChunksData,\n@@ -40,7 +40,7 @@ impl WorkerLoaderChunkItem {\n             module.inner.ident().with_modifier(rcstr!(\"worker\")),\n             ChunkGroup::Isolated(ResolvedVc::upcast(module.inner)),\n             *self.module_graph,\n-            Value::new(AvailabilityInfo::Root),\n+            AvailabilityInfo::Root,\n         ))\n     }\n "
        },
        {
            "sha": "9b1bff81123bc08e39297115b6a47d15157da49f",
            "filename": "turbopack/crates/turbopack-nodejs/src/chunking_context.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 7,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -345,7 +345,7 @@ impl ChunkingContext for NodeJsChunkingContext {\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Result<Vc<ChunkGroupResult>> {\n         let span = tracing::info_span!(\"chunking\", module = ident.to_string().await?.to_string());\n         async move {\n@@ -357,7 +357,7 @@ impl ChunkingContext for NodeJsChunkingContext {\n                 modules,\n                 module_graph,\n                 ResolvedVc::upcast(self),\n-                availability_info.into_value(),\n+                availability_info,\n             )\n             .await?;\n \n@@ -384,10 +384,8 @@ impl ChunkingContext for NodeJsChunkingContext {\n         evaluatable_assets: Vc<EvaluatableAssets>,\n         module_graph: Vc<ModuleGraph>,\n         extra_chunks: Vc<OutputAssets>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Result<Vc<EntryChunkGroupResult>> {\n-        let availability_info = availability_info.into_value();\n-\n         let evaluatable_assets_ref = evaluatable_assets.await?;\n         let entries = evaluatable_assets_ref\n             .iter()\n@@ -447,7 +445,7 @@ impl ChunkingContext for NodeJsChunkingContext {\n         _ident: Vc<AssetIdent>,\n         _chunk_group: ChunkGroup,\n         _module_graph: Vc<ModuleGraph>,\n-        _availability_info: Value<AvailabilityInfo>,\n+        _availability_info: AvailabilityInfo,\n     ) -> Result<Vc<ChunkGroupResult>> {\n         // TODO(alexkirsz) This method should be part of a separate trait that is\n         // only implemented for client/edge runtimes.\n@@ -464,7 +462,7 @@ impl ChunkingContext for NodeJsChunkingContext {\n         self: Vc<Self>,\n         module: Vc<Box<dyn ChunkableModule>>,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: Value<AvailabilityInfo>,\n+        availability_info: AvailabilityInfo,\n     ) -> Result<Vc<Box<dyn ChunkItem>>> {\n         Ok(if self.await?.manifest_chunks {\n             let manifest_asset ="
        },
        {
            "sha": "bf996b624ece11cba17fac661251907be0665907",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc6163aa266dd1a0bea7f6abc733247144d22fa7/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs?ref=cc6163aa266dd1a0bea7f6abc733247144d22fa7",
            "patch": "@@ -410,7 +410,7 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n                 entry_module.ident(),\n                 ChunkGroup::Entry(all_modules.into_iter().collect()),\n                 module_graph,\n-                Value::new(AvailabilityInfo::Root),\n+                AvailabilityInfo::Root,\n             ),\n             Runtime::NodeJs => {\n                 Vc::cell(vec![\n@@ -434,7 +434,7 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n                             evaluatable_assets,\n                             module_graph,\n                             OutputAssets::empty(),\n-                            Value::new(AvailabilityInfo::Root),\n+                            AvailabilityInfo::Root,\n                         )\n                         .await?\n                         .asset,"
        }
    ],
    "stats": {
        "total": 173,
        "additions": 86,
        "deletions": 87
    }
}