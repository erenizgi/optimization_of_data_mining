{
    "author": "remcohaszing",
    "message": "Add a fallback for the mdx-components file (#59693)\n\n### What?\n\nProvide a fallback for the `mdx-components` file.\n\n### Why?\n\nGiven a user uses the Next.js app directory, and doesn’t have an\n`mdx-components` file;\n1. If the user has `@mdx-js/react` installed, Next.js shows a cryptic\nerror message, stating only client components may use React context.\n2. If the user doesn’t have `@mdx-js/react` installed, Next.js shows a\ncryptic error message, stating `next-mdx-import-source-file` could not\nbe resolved.\n\n### How?\n\nThis fixes 2 by providing a fallback.\n\nI suggest fixing 1, by completely removing all references to\n`@mdx-js/react` from the project.\n\n---------\n\nCo-authored-by: JJ Kasper <jj@jjsweb.site>",
    "sha": "62fa7fa16daffb431741788c29d0c0a02e84cfa6",
    "files": [
        {
            "sha": "bcd6920634b6edb71fd8ef596df3464bf84d837a",
            "filename": "crates/next-core/src/next_import_map.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -858,6 +858,7 @@ async fn insert_next_shared_aliases(\n             request_to_import_mapping(project_path, \"./mdx-components\"),\n             request_to_import_mapping(project_path, \"./src/mdx-components\"),\n             request_to_import_mapping(project_path, \"@mdx-js/react\"),\n+            request_to_import_mapping(project_path, \"@next/mdx/mdx-components.js\"),\n         ],\n     );\n "
        },
        {
            "sha": "14fdf5f6b83fce2bbc09cdd8bc4c76fdfd0b744c",
            "filename": "packages/next-mdx/index.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/packages%2Fnext-mdx%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/packages%2Fnext-mdx%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-mdx%2Findex.js?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -32,6 +32,7 @@ module.exports =\n           'private-next-root-dir/src/mdx-components',\n           'private-next-root-dir/mdx-components',\n           '@mdx-js/react',\n+          require.resolve('./mdx-components.js'),\n         ]\n         config.module.rules.push({\n           test: extension,"
        },
        {
            "sha": "fce77d9e5813ff6b3f223c5174d8d2406d346990",
            "filename": "packages/next-mdx/mdx-components.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/packages%2Fnext-mdx%2Fmdx-components.js",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/packages%2Fnext-mdx%2Fmdx-components.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-mdx%2Fmdx-components.js?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -0,0 +1,5 @@\n+function useMDXComponents() {\n+  return {}\n+}\n+\n+exports.useMDXComponents = useMDXComponents"
        },
        {
            "sha": "0b94bc911b597ec74a993730ea351f4c91b15b30",
            "filename": "packages/next-mdx/readme.md",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/packages%2Fnext-mdx%2Freadme.md",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/packages%2Fnext-mdx%2Freadme.md",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext-mdx%2Freadme.md?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -7,13 +7,13 @@ Use [MDX](https://github.com/mdx-js/mdx) with [Next.js](https://github.com/verce\n For usage with the `app` directory see the section below.\n \n ```\n-npm install @next/mdx @mdx-js/loader @mdx-js/react\n+npm install @next/mdx @mdx-js/loader\n ```\n \n or\n \n ```\n-yarn add @next/mdx @mdx-js/loader @mdx-js/react\n+yarn add @next/mdx @mdx-js/loader\n ```\n \n ## Usage"
        },
        {
            "sha": "e0708c7350ac1494e33767a83f45ba5fc6c437d1",
            "filename": "test/e2e/app-dir/mdx-no-mdx-components/app/client.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fapp%2Fclient.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fapp%2Fclient.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fapp%2Fclient.tsx?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export function Client() {\n+  return <h2>This is a client component</h2>\n+}"
        },
        {
            "sha": "e7077399c03ce1479a655dc647c0545b64531628",
            "filename": "test/e2e/app-dir/mdx-no-mdx-components/app/layout.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fapp%2Flayout.tsx?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -0,0 +1,7 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "dd2cf23f48ca28d9b4a447fd72af3697c28237a3",
            "filename": "test/e2e/app-dir/mdx-no-mdx-components/app/page.mdx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fapp%2Fpage.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fapp%2Fpage.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fapp%2Fpage.mdx?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -0,0 +1,7 @@\n+# Hello World\n+\n+This is MDX!\n+\n+import { Client } from './client'\n+\n+<Client />"
        },
        {
            "sha": "0ec2cf070befb7a1695d75aa45f4eacec9bba1df",
            "filename": "test/e2e/app-dir/mdx-no-mdx-components/mdx.test.ts",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fmdx.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fmdx.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fmdx.test.ts?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -0,0 +1,38 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe(`mdx`, () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+    dependencies: {\n+      '@next/mdx': 'canary',\n+      '@mdx-js/loader': '^2.2.1',\n+    },\n+  })\n+\n+  describe('app directory', () => {\n+    it('should work in initial html', async () => {\n+      const $ = await next.render$('/')\n+      expect($('h1').text()).toBe('Hello World')\n+      expect($('p').text()).toBe('This is MDX!')\n+    })\n+\n+    it('should work using browser', async () => {\n+      const browser = await next.browser('/')\n+      expect(await browser.elementByCss('h1').text()).toBe('Hello World')\n+      expect(await browser.elementByCss('p').text()).toBe('This is MDX!')\n+    })\n+\n+    it('should allow importing client components', async () => {\n+      const $ = await next.render$('/')\n+      expect($('h2').text()).toBe('This is a client component')\n+    })\n+  })\n+\n+  describe('pages directory', () => {\n+    it('should work in initial html', async () => {\n+      const $ = await next.render$('/pages')\n+      expect($('h1').text()).toBe('Hello World')\n+      expect($('p').text()).toBe('This is MDX!')\n+    })\n+  })\n+})"
        },
        {
            "sha": "6ab899aad127a37ffa77cf617098952896ec1a5e",
            "filename": "test/e2e/app-dir/mdx-no-mdx-components/next.config.mjs",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fnext.config.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fnext.config.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fnext.config.mjs?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -0,0 +1,15 @@\n+import nextMDX from '@next/mdx'\n+\n+const withMDX = nextMDX()\n+\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  pageExtensions: ['js', 'jsx', 'ts', 'tsx', 'mdx'],\n+  experimental: {\n+    mdxRs: true,\n+  },\n+}\n+\n+export default withMDX(nextConfig)"
        },
        {
            "sha": "5371f3deebc7514663afd76c03ee2aad534bf57b",
            "filename": "test/e2e/app-dir/mdx-no-mdx-components/pages/pages/index.mdx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fpages%2Fpages%2Findex.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/62fa7fa16daffb431741788c29d0c0a02e84cfa6/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fpages%2Fpages%2Findex.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmdx-no-mdx-components%2Fpages%2Fpages%2Findex.mdx?ref=62fa7fa16daffb431741788c29d0c0a02e84cfa6",
            "patch": "@@ -0,0 +1,3 @@\n+# Hello World\n+\n+This is MDX!"
        }
    ],
    "stats": {
        "total": 86,
        "additions": 84,
        "deletions": 2
    }
}