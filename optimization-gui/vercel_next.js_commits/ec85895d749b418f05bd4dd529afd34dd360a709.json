{
    "author": "wbinnssmith",
    "message": "bundle-analyzer: Show compressed sizes (#87093)",
    "sha": "ec85895d749b418f05bd4dd529afd34dd360a709",
    "files": [
        {
            "sha": "8aa85ceccd67e5a38f3be9130f2e2b2546246dcd",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -9505,6 +9505,7 @@ version = \"0.1.0\"\n dependencies = [\n  \"anyhow\",\n  \"bincode 2.0.1\",\n+ \"flate2\",\n  \"rustc-hash 2.1.1\",\n  \"serde\",\n  \"serde_json\","
        },
        {
            "sha": "274398e34a68061bb0479aef4b37eb4c33ecefe4",
            "filename": "apps/bundle-analyzer/app/page.tsx",
            "status": "modified",
            "additions": 52,
            "deletions": 14,
            "changes": 66,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fapp%2Fpage.tsx?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -1,6 +1,8 @@\n 'use client'\n \n import type React from 'react'\n+import { SizeMode } from '@/lib/treemap-layout'\n+\n import { useEffect, useMemo, useState } from 'react'\n import useSWR from 'swr'\n import { ErrorState } from '@/components/error-state'\n@@ -17,12 +19,17 @@ import { computeActiveEntries, computeModuleDepthMap } from '@/lib/module-graph'\n import { fetchStrict } from '@/lib/utils'\n import { formatBytes } from '@/lib/utils'\n \n+enum Environment {\n+  Client = 'client',\n+  Server = 'server',\n+}\n+\n export default function Home() {\n   const [selectedRoute, setSelectedRoute] = useState<string | null>(null)\n-  const [environmentFilter, setEnvironmentFilter] = useState<\n-    'client' | 'server'\n-  >('client')\n-  const [typeFilter, setTypeFilter] = useState<string[]>(['js', 'css', 'json'])\n+  const [environmentFilter, setEnvironmentFilter] = useState<Environment>(\n+    Environment.Client\n+  )\n+  const [typeFilter, setTypeFilter] = useState(['js', 'css', 'json'])\n   const [selectedSourceIndex, setSelectedSourceIndex] = useState<number | null>(\n     null\n   )\n@@ -69,6 +76,7 @@ export default function Home() {\n     client?: boolean\n   } | null>(null)\n   const [searchQuery, setSearchQuery] = useState('')\n+  const [sizeMode, setSizeMode] = useState(SizeMode.Compressed)\n \n   useEffect(() => {\n     const handleKeyDown = (e: KeyboardEvent) => {\n@@ -100,15 +108,15 @@ export default function Home() {\n   }, [modulesData, analyzeData])\n \n   const filterSource = useMemo(() => {\n-    if (!analyzeData) return undefined\n+    if (!analyzeData) return () => true\n \n     return (sourceIndex: number) => {\n       const flags = analyzeData.getSourceFlags(sourceIndex)\n \n       // Check environment filter\n       const hasEnvironment =\n-        (environmentFilter === 'client' && flags.client) ||\n-        (environmentFilter === 'server' && flags.server)\n+        (environmentFilter === Environment.Client && flags.client) ||\n+        (environmentFilter === Environment.Server && flags.server)\n \n       // Check type filter\n       const hasType =\n@@ -157,25 +165,47 @@ export default function Home() {\n           />\n         </div>\n \n-        <div className=\"basis-2/3 flex justify-end\">\n+        <div className=\"basis-2/3 flex justify-end items-center space-x-4\">\n           {analyzeData && (\n             <>\n               <ToggleGroup\n                 type=\"single\"\n-                className=\"mr-4\"\n+                value={sizeMode}\n+                onValueChange={(value) => {\n+                  if (value) setSizeMode(value as SizeMode)\n+                }}\n+                size=\"sm\"\n+              >\n+                <ToggleGroupItem value={SizeMode.Uncompressed}>\n+                  Uncompressed\n+                </ToggleGroupItem>\n+                <ToggleGroupItem value={SizeMode.Compressed}>\n+                  Compressed\n+                </ToggleGroupItem>\n+              </ToggleGroup>\n+\n+              <ControlDivider />\n+\n+              <ToggleGroup\n+                type=\"single\"\n                 value={environmentFilter}\n                 onValueChange={(value) => {\n-                  if (value) setEnvironmentFilter(value as 'client' | 'server')\n+                  if (value) setEnvironmentFilter(value as Environment)\n                 }}\n                 size=\"sm\"\n               >\n-                <ToggleGroupItem value=\"client\">Client</ToggleGroupItem>\n-                <ToggleGroupItem value=\"server\">Server</ToggleGroupItem>\n+                <ToggleGroupItem value={Environment.Client}>\n+                  Client\n+                </ToggleGroupItem>\n+                <ToggleGroupItem value={Environment.Server}>\n+                  Server\n+                </ToggleGroupItem>\n               </ToggleGroup>\n \n+              <ControlDivider />\n+\n               <ToggleGroup\n                 type=\"multiple\"\n-                className=\"mr-4\"\n                 value={typeFilter}\n                 onValueChange={(value) => {\n                   if (value.length > 0) setTypeFilter(value)\n@@ -188,6 +218,8 @@ export default function Home() {\n                 <ToggleGroupItem value=\"asset\">Asset</ToggleGroupItem>\n               </ToggleGroup>\n \n+              <ControlDivider />\n+\n               <FileSearch value={searchQuery} onChange={setSearchQuery} />\n             </>\n           )}\n@@ -235,6 +267,7 @@ export default function Home() {\n                 onHoveredNodeChange={setHoveredNodeInfo}\n                 searchQuery={searchQuery}\n                 filterSource={filterSource}\n+                sizeMode={sizeMode}\n               />\n             </div>\n \n@@ -252,6 +285,7 @@ export default function Home() {\n               selectedSourceIndex={selectedSourceIndex}\n               moduleDepthMap={moduleDepthMap}\n               environmentFilter={environmentFilter}\n+              filterSource={filterSource}\n             />\n           </>\n         ) : null}\n@@ -266,7 +300,7 @@ export default function Home() {\n                   {hoveredNodeInfo.name}\n                 </span>\n                 <span className=\"ml-2 text-muted-foreground\">\n-                  {formatBytes(hoveredNodeInfo.size)}\n+                  {`${formatBytes(hoveredNodeInfo.size)} ${sizeMode}`}\n                 </span>\n                 {(hoveredNodeInfo.server || hoveredNodeInfo.client) && (\n                   <span className=\"ml-2 inline-flex gap-1\">\n@@ -289,6 +323,10 @@ export default function Home() {\n   )\n }\n \n+function ControlDivider() {\n+  return <span className=\"h-6 w-px bg-muted-foreground/30\" />\n+}\n+\n function getRootSourceIndex(analyzeData: AnalyzeData | undefined): number {\n   if (!analyzeData) return 0\n   const sourceRoots = analyzeData.sourceRoots()"
        },
        {
            "sha": "fd123edcd7d42d7ddb7e05f1f3f62ad5d91c94c0",
            "filename": "apps/bundle-analyzer/components/sidebar.tsx",
            "status": "modified",
            "additions": 153,
            "deletions": 91,
            "changes": 244,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fcomponents%2Fsidebar.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fcomponents%2Fsidebar.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fsidebar.tsx?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -1,6 +1,13 @@\n 'use client'\n \n import type React from 'react'\n+import { CircleHelp } from 'lucide-react'\n+import {\n+  Tooltip,\n+  TooltipContent,\n+  TooltipProvider,\n+  TooltipTrigger,\n+} from './ui/tooltip'\n import { ImportChain } from '@/components/import-chain'\n import { Skeleton } from '@/components/ui/skeleton'\n import { AnalyzeData, ModulesData } from '@/lib/analyze-data'\n@@ -15,6 +22,7 @@ interface SidebarProps {\n   selectedSourceIndex: number | null\n   moduleDepthMap: Map<number, number>\n   environmentFilter: 'client' | 'server'\n+  filterSource?: (sourceIndex: number) => boolean\n   isLoading?: boolean\n }\n \n@@ -34,9 +42,12 @@ export function Sidebar({\n   selectedSourceIndex,\n   moduleDepthMap,\n   environmentFilter,\n+  filterSource,\n   isLoading = false,\n }: SidebarProps) {\n-  if (isLoading) {\n+  filterSource = filterSource ?? (() => true)\n+\n+  if (isLoading || !analyzeData) {\n     return (\n       <div\n         className=\"flex-none bg-muted border-l border-border overflow-y-auto\"\n@@ -56,10 +67,40 @@ export function Sidebar({\n     )\n   }\n \n-  if (!analyzeData) {\n-    return null\n-  }\n+  return (\n+    <div\n+      className=\"flex-none bg-muted border-l border-border overflow-y-auto\"\n+      style={{ width: `${sidebarWidth}%` }}\n+    >\n+      {selectedSourceIndex != null ? (\n+        <SelectionDetails\n+          analyzeData={analyzeData}\n+          modulesData={modulesData}\n+          selectedSourceIndex={selectedSourceIndex}\n+          filterSource={filterSource}\n+          moduleDepthMap={moduleDepthMap}\n+          environmentFilter={environmentFilter}\n+        />\n+      ) : null}\n+    </div>\n+  )\n+}\n \n+function SelectionDetails({\n+  analyzeData,\n+  modulesData,\n+  selectedSourceIndex,\n+  filterSource,\n+  moduleDepthMap,\n+  environmentFilter,\n+}: {\n+  analyzeData: AnalyzeData\n+  modulesData: ModulesData | null\n+  selectedSourceIndex: number\n+  moduleDepthMap: Map<number, number>\n+  environmentFilter: 'client' | 'server'\n+  filterSource: (sourceIndex: number) => boolean\n+}) {\n   const specialModuleType = getSpecialModuleType(\n     analyzeData,\n     selectedSourceIndex\n@@ -76,101 +117,122 @@ export function Sidebar({\n \n   const childModuleCount =\n     hasChildModules && selectedSourceIndex != null\n-      ? analyzeData.getSourceRecursiveModuleCount(selectedSourceIndex)\n+      ? analyzeData.getRecursiveModuleCount(selectedSourceIndex, filterSource)\n       : null\n \n-  return (\n-    <div\n-      className=\"flex-none bg-muted border-l border-border overflow-y-auto\"\n-      style={{ width: `${sidebarWidth}%` }}\n-    >\n-      <div className=\"flex-1 p-3 space-y-8 overflow-y-auto\">\n-        <div className=\"space-y-2\">\n-          <h2 className=\"text-s font-semibold mb-1 text-foreground truncate\">\n-            {selectedSource\n-              ? selectedSource.path || 'All Route Modules'\n-              : 'Unknown Source'}\n-          </h2>\n-          {selectedSourceIndex != null &&\n-          analyzeData.source(selectedSourceIndex) ? (\n-            <div>\n-              <div className=\"text-xs\">\n-                <span>\n-                  {hasChildModules\n-                    ? formatBytes(\n-                        analyzeData.getSourceRecursiveSize(selectedSourceIndex)\n-                      )\n-                    : formatBytes(\n-                        analyzeData.getSourceOutputSize(selectedSourceIndex)\n-                      )}\n-                </span>{' '}\n-                <span className=\"text-muted-foreground\">bundled</span>\n-              </div>\n-              {hasChildModules && childModuleCount != null ? (\n-                <div className=\"text-xs\">\n-                  <span>{childModuleCount} </span>\n-                  <span className=\"text-muted-foreground\">\n-                    {childModuleCount === 1 ? 'module' : 'modules'}\n-                  </span>\n-                </div>\n-              ) : null}\n-            </div>\n-          ) : null}\n-        </div>\n+  const { size, compressedSize } = analyzeData.getRecursiveSizes(\n+    selectedSourceIndex,\n+    filterSource\n+  )\n \n-        {selectedSourceIndex != null &&\n-          analyzeData.source(selectedSourceIndex) &&\n-          (specialModuleType === SpecialModule.POLYFILL_MODULE ||\n-            specialModuleType === SpecialModule.POLYFILL_NOMODULE) && (\n-            <dl>\n-              <div className=\"flex items-center gap-2\">\n-                <dt className=\"inline-flex items-center\">\n-                  <Badge variant=\"polyfill\">Polyfill</Badge>\n-                </dt>\n-                <dd className=\"text-xs text-muted-foreground\">\n-                  Next.js built-in polyfills\n-                </dd>\n-              </div>\n-            </dl>\n-          )}\n+  const chunks =\n+    selectedSourceIndex != null\n+      ? analyzeData.sourceChunks(selectedSourceIndex)\n+      : []\n \n+  return (\n+    <div className=\"flex-1 p-3 space-y-8 overflow-y-auto\">\n+      <div className=\"space-y-2\">\n+        <h2 className=\"text-s font-semibold mb-1 text-foreground truncate\">\n+          {selectedSource?.path || 'All Route Modules'}\n+        </h2>\n         {selectedSourceIndex != null &&\n-          analyzeData.source(selectedSourceIndex) &&\n-          !hasChildModules && (\n+        analyzeData.source(selectedSourceIndex) ? (\n+          <div className=\"text-xs\">\n+            <div>\n+              <span>{formatBytes(size)}</span>{' '}\n+              <span className=\"text-muted-foreground\">uncompressed</span>\n+              <InlineHelpTooltip>\n+                Uncompressed modules may still be minified, tree-shaken, and\n+                dead-code eliminated. They just don't account for general\n+                compression like gzip.\n+              </InlineHelpTooltip>\n+            </div>\n             <>\n-              {modulesData && (\n-                <ImportChain\n-                  key={selectedSourceIndex}\n-                  startFileId={selectedSourceIndex}\n-                  analyzeData={analyzeData}\n-                  modulesData={modulesData}\n-                  depthMap={moduleDepthMap}\n-                  environmentFilter={environmentFilter}\n-                />\n-              )}\n-              {(() => {\n-                const chunks = analyzeData.sourceChunks(selectedSourceIndex)\n-                if (chunks.length > 0) {\n-                  return (\n-                    <div className=\"mt-2\">\n-                      <p className=\"text-xs font-semibold text-foreground\">\n-                        Output Chunks\n-                      </p>\n-                      <ul className=\"text-xs text-muted-foreground font-mono mt-1 space-y-1\">\n-                        {chunks.map((chunk) => (\n-                          <li key={chunk} className=\"break-all\">\n-                            {chunk}\n-                          </li>\n-                        ))}\n-                      </ul>\n-                    </div>\n-                  )\n-                }\n-                return null\n-              })()}\n+              <div>\n+                <span className=\"text-muted-foreground\">About </span>\n+                <span>{formatBytes(compressedSize)}</span>\n+                <span className=\"text-muted-foreground ml-1\">compressed</span>\n+                <InlineHelpTooltip>\n+                  Estimated compressed size. Modules are compressed in isolation\n+                  which may differ from their size in the final chunk.\n+                </InlineHelpTooltip>\n+              </div>\n             </>\n-          )}\n+            {hasChildModules && childModuleCount != null ? (\n+              <div>\n+                <span>{childModuleCount} </span>\n+                <span className=\"text-muted-foreground\">\n+                  {childModuleCount === 1 ? 'module' : 'modules'}\n+                </span>\n+              </div>\n+            ) : null}\n+          </div>\n+        ) : null}\n       </div>\n+\n+      {selectedSourceIndex != null &&\n+        analyzeData.source(selectedSourceIndex) &&\n+        (specialModuleType === SpecialModule.POLYFILL_MODULE ||\n+          specialModuleType === SpecialModule.POLYFILL_NOMODULE) && (\n+          <dl className=\"flex items-center gap-2\">\n+            <dt className=\"inline-flex items-center\">\n+              <Badge variant=\"polyfill\">Polyfill</Badge>\n+            </dt>\n+            <dd className=\"text-xs text-muted-foreground\">\n+              Next.js built-in polyfills\n+            </dd>\n+          </dl>\n+        )}\n+\n+      {selectedSourceIndex != null &&\n+        analyzeData.source(selectedSourceIndex) &&\n+        !hasChildModules && (\n+          <>\n+            {modulesData && (\n+              <ImportChain\n+                startFileId={selectedSourceIndex}\n+                analyzeData={analyzeData}\n+                modulesData={modulesData}\n+                depthMap={moduleDepthMap}\n+                environmentFilter={environmentFilter}\n+              />\n+            )}\n+            {chunks.length > 0 ? (\n+              <div className=\"mt-2\">\n+                <p className=\"text-xs font-semibold text-foreground\">\n+                  Output Chunks\n+                </p>\n+                <ul className=\"text-xs text-muted-foreground font-mono mt-1 space-y-1\">\n+                  {chunks.map((chunk) => (\n+                    <li key={chunk} className=\"break-all\">\n+                      {chunk}\n+                    </li>\n+                  ))}\n+                </ul>\n+              </div>\n+            ) : null}\n+          </>\n+        )}\n     </div>\n   )\n }\n+\n+function InlineHelpTooltip({ children }: { children: React.ReactNode }) {\n+  return (\n+    <TooltipProvider>\n+      <Tooltip>\n+        <TooltipTrigger asChild>\n+          <CircleHelp\n+            size={14}\n+            className=\"inline-block ml-1 text-muted-foreground\"\n+            aria-hidden=\"true\"\n+          />\n+        </TooltipTrigger>\n+        <TooltipContent className=\"max-w-xs\" side=\"top\" align=\"center\">\n+          {children}\n+        </TooltipContent>\n+      </Tooltip>\n+    </TooltipProvider>\n+  )\n+}"
        },
        {
            "sha": "cdd125bca1788f9066bf836d726c45d691a58d0d",
            "filename": "apps/bundle-analyzer/components/treemap-visualizer.tsx",
            "status": "modified",
            "additions": 147,
            "deletions": 37,
            "changes": 184,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fcomponents%2Ftreemap-visualizer.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fcomponents%2Ftreemap-visualizer.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Ftreemap-visualizer.tsx?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -8,6 +8,7 @@ import {\n   computeTreemapLayoutFromAnalyze,\n   type LayoutNode,\n   type LayoutNodeInfo,\n+  SizeMode,\n } from '@/lib/treemap-layout'\n import { SpecialModule } from '@/lib/types'\n import { formatBytes } from '@/lib/utils'\n@@ -27,6 +28,7 @@ interface TreemapVisualizerProps {\n   filterSource?: (sourceIndex: number) => boolean\n   isModulePolyfillChunk?: (sourceIndex: number) => boolean\n   isNoModulePolyfillChunk?: (sourceIndex: number) => boolean\n+  sizeMode?: SizeMode\n }\n \n function getFileColor(node: {\n@@ -70,6 +72,77 @@ function isPolyfill(specialModuleType: SpecialModule | null): boolean {\n   )\n }\n \n+function calculateTitleFontSizes(titleBarHeight: number): {\n+  titleFontSize: number\n+  sizeFontSize: number\n+} {\n+  const titleFontSize = Math.min(10, titleBarHeight * 0.5)\n+  const sizeFontSize = Math.min(9, titleFontSize - 2)\n+  return { titleFontSize, sizeFontSize }\n+}\n+\n+const textWidthCache = new Map<string, number>()\n+const TEXT_WIDTH_CACHE_SIZE = 30_000 // Shouldn't be more than a few megabytes of memory\n+function measureTextCached(\n+  ctx: CanvasRenderingContext2D,\n+  text: string\n+): number {\n+  const cacheKey = `${ctx.font}|${text}`\n+\n+  let width = textWidthCache.get(cacheKey)\n+  if (width !== undefined) {\n+    // Move to end -- update the insertion order for LRU\n+    textWidthCache.delete(cacheKey)\n+    textWidthCache.set(cacheKey, width)\n+    return width\n+  }\n+\n+  width = ctx.measureText(text).width\n+\n+  // LRU-style cache eviction\n+  if (textWidthCache.size >= TEXT_WIDTH_CACHE_SIZE) {\n+    const firstKey = textWidthCache.keys().next().value\n+    if (firstKey !== undefined) {\n+      textWidthCache.delete(firstKey)\n+    }\n+  }\n+\n+  textWidthCache.set(cacheKey, width)\n+  return width\n+}\n+\n+function truncateTextWithEllipsisIfNeeded(\n+  ctx: CanvasRenderingContext2D,\n+  text: string,\n+  maxWidth: number\n+): string {\n+  const ellipsisWidth = measureTextCached(ctx, '...')\n+\n+  if (measureTextCached(ctx, text) <= maxWidth) {\n+    return text\n+  }\n+\n+  let left = 0\n+  let right = text.length\n+  let bestLength = 0\n+\n+  while (left <= right) {\n+    const mid = Math.floor((left + right) / 2)\n+    const truncated = text.slice(0, mid)\n+    // Don't use the cached version since we don't want repeated failures filling it up\n+    const width = ctx.measureText(truncated).width\n+\n+    if (width + ellipsisWidth <= maxWidth) {\n+      bestLength = mid\n+      left = mid + 1\n+    } else {\n+      right = mid - 1\n+    }\n+  }\n+\n+  return bestLength > 0 ? `${text.slice(0, bestLength)}...` : '...'\n+}\n+\n function findNodeAtPosition(\n   node: LayoutNode,\n   x: number,\n@@ -232,7 +305,7 @@ function drawTreemap(\n         ctx.lineTo(rect.x + rect.width, rect.y + titleBarHeight)\n         ctx.stroke()\n \n-        const titleFontSize = Math.max(10, titleBarHeight * 0.5)\n+        const { titleFontSize } = calculateTitleFontSizes(titleBarHeight)\n         ctx.fillStyle = colors.text\n         ctx.font = `600 ${titleFontSize}px sans-serif`\n         ctx.textAlign = 'left'\n@@ -342,7 +415,6 @@ function drawTreemap(\n       ctx.textBaseline = 'middle'\n \n       const maxWidth = rect.width - 8\n-      let displayName = name\n \n       const sizeText = formatBytes(node.size)\n       const fontSize = 12\n@@ -353,17 +425,7 @@ function drawTreemap(\n       const hasSpaceForSize = rect.height > 50\n \n       ctx.font = `${fontSize}px sans-serif`\n-      const nameMetrics = ctx.measureText(displayName)\n-\n-      if (nameMetrics.width > maxWidth) {\n-        while (\n-          displayName.length > 0 &&\n-          ctx.measureText(`${displayName}...`).width > maxWidth\n-        ) {\n-          displayName = displayName.slice(0, -1)\n-        }\n-        displayName += '...'\n-      }\n+      const displayName = truncateTextWithEllipsisIfNeeded(ctx, name, maxWidth)\n \n       if (hasSpaceForSize) {\n         ctx.font = `${fontSize}px sans-serif`\n@@ -426,17 +488,40 @@ function drawTreemap(\n       ctx.lineTo(rect.x + rect.width, rect.y + titleBarHeight)\n       ctx.stroke()\n \n-      const titleFontSize = Math.max(10, titleBarHeight * 0.5)\n-      ctx.fillStyle = colors.text\n-      ctx.font = `600 ${titleFontSize}px sans-serif`\n-      ctx.textAlign = 'left'\n+      const { titleFontSize, sizeFontSize } =\n+        calculateTitleFontSizes(titleBarHeight)\n+      const sizeText = formatBytes(node.size)\n+      const centerY = rect.y + titleBarHeight / 2\n+      const gap = 6\n+\n       ctx.textBaseline = 'middle'\n-      ctx.fillText(\n+\n+      // Measure size text first to reserve space\n+      ctx.font = `${sizeFontSize}px sans-serif`\n+      const sizeWidth = measureTextCached(ctx, sizeText)\n+\n+      const nameX = rect.x + 8\n+      const availableNameWidth = Math.max(0, rect.width - 16 - sizeWidth - gap)\n+      ctx.font = `600 ${titleFontSize}px sans-serif`\n+      const displayName = truncateTextWithEllipsisIfNeeded(\n+        ctx,\n         name,\n-        rect.x + 8,\n-        rect.y + titleBarHeight / 2,\n-        rect.width - 16\n+        availableNameWidth\n       )\n+\n+      ctx.fillStyle = colors.text\n+      ctx.textAlign = 'left'\n+      ctx.fillText(displayName, nameX, centerY, availableNameWidth)\n+\n+      const nameWidth = measureTextCached(ctx, displayName)\n+      const sizeX = nameX + nameWidth + gap\n+\n+      // Only draw size text if it fits within bounds\n+      if (sizeX + sizeWidth <= rect.x + rect.width - 8) {\n+        ctx.font = `${sizeFontSize}px sans-serif`\n+        ctx.fillStyle = colors.textMuted\n+        ctx.fillText(sizeText, sizeX, centerY)\n+      }\n     }\n \n     ctx.globalAlpha = 1.0\n@@ -473,17 +558,39 @@ function drawTreemap(\n       ctx.lineTo(rect.x + rect.width, rect.y + titleBarHeight)\n       ctx.stroke()\n \n-      const titleFontSize = Math.max(10, titleBarHeight * 0.5)\n-      ctx.fillStyle = colors.text\n-      ctx.font = `600 ${titleFontSize}px sans-serif`\n-      ctx.textAlign = 'left'\n+      const { titleFontSize, sizeFontSize } =\n+        calculateTitleFontSizes(titleBarHeight)\n+      const sizeText = formatBytes(node.size)\n+      const centerY = rect.y + titleBarHeight / 2\n+      const gap = 6\n+\n       ctx.textBaseline = 'middle'\n-      ctx.fillText(\n+\n+      ctx.font = `${sizeFontSize}px sans-serif`\n+      const sizeWidth = measureTextCached(ctx, sizeText)\n+\n+      const nameX = rect.x + 8\n+      const availableNameWidth = Math.max(0, rect.width - 16 - sizeWidth - gap)\n+      ctx.font = `600 ${titleFontSize}px sans-serif`\n+      const displayName = truncateTextWithEllipsisIfNeeded(\n+        ctx,\n         name,\n-        rect.x + 8,\n-        rect.y + titleBarHeight / 2,\n-        rect.width - 16\n+        availableNameWidth\n       )\n+\n+      ctx.fillStyle = colors.text\n+      ctx.textAlign = 'left'\n+      ctx.fillText(displayName, nameX, centerY, availableNameWidth)\n+\n+      const nameWidth = measureTextCached(ctx, displayName)\n+      const sizeX = nameX + nameWidth + gap\n+\n+      // Only draw size text if it fits within bounds\n+      if (sizeX + sizeWidth <= rect.x + rect.width - 8) {\n+        ctx.font = `${sizeFontSize}px sans-serif`\n+        ctx.fillStyle = colors.textMuted\n+        ctx.fillText(sizeText, sizeX, centerY)\n+      }\n     }\n \n     ctx.globalAlpha = 1.0\n@@ -604,6 +711,7 @@ export function TreemapVisualizer({\n   onHoveredNodeChangeDelayed,\n   searchQuery = '',\n   filterSource,\n+  sizeMode = SizeMode.Compressed,\n }: TreemapVisualizerProps) {\n   const canvasRef = useRef<HTMLCanvasElement>(null)\n   const containerRef = useRef<HTMLDivElement>(null)\n@@ -708,7 +816,8 @@ export function TreemapVisualizer({\n         width: cssDimensions.width,\n         height: cssDimensions.height,\n       },\n-      filterSource\n+      filterSource,\n+      sizeMode\n     )\n \n     // If we're not at the root, wrap with ancestor title bars\n@@ -731,6 +840,7 @@ export function TreemapVisualizer({\n     cssDimensions.width,\n     cssDimensions.height,\n     filterSource,\n+    sizeMode,\n   ])\n \n   useEffect(() => {\n@@ -917,16 +1027,16 @@ function getThemeColors() {\n   return {\n     text: dark ? '#ffffff' : '#000000',\n     textMuted: dark ? 'rgba(255, 255, 255, 0.6)' : 'rgba(0, 0, 0, 0.6)',\n-    border: dark ? 'rgba(255, 255, 255, 0.2)' : 'rgba(128, 128, 128, 0.2)',\n-    dirBg: dark ? 'rgba(255, 255, 255, 0.05)' : 'rgba(128, 128, 128, 0.1)',\n-    dirBorder: dark ? 'rgba(255, 255, 255, 0.2)' : 'rgba(128, 128, 128, 0.3)',\n-    dirTitleBg: dark ? 'rgba(255, 255, 255, 0.08)' : 'rgba(128, 128, 128, 0.1)',\n+    border: dark ? 'rgba(255, 255, 255, 0.4)' : 'rgba(180, 180, 180, 0.5)',\n+    dirBg: dark ? 'rgba(255, 255, 255, 0.05)' : 'rgba(230, 230, 230, 0.1)',\n+    dirBorder: dark ? 'rgba(255, 255, 255, 0.5)' : 'rgba(180, 180, 180, 0.6)',\n+    dirTitleBg: dark ? 'rgba(255, 255, 255, 0.08)' : 'rgba(230, 230, 230, 0.1)',\n     dirTitleBorder: dark\n-      ? 'rgba(255, 255, 255, 0.15)'\n-      : 'rgba(128, 128, 128, 0.2)',\n+      ? 'rgba(255, 255, 255, 0.4)'\n+      : 'rgba(180, 180, 180, 0.5)',\n     collapsedBg: dark\n       ? 'rgba(128, 128, 128, 0.15)'\n-      : 'rgba(128, 128, 128, 0.2)',\n+      : 'rgba(230, 230, 230, 0.2)',\n     collapsedText: dark\n       ? 'rgba(255, 255, 255, 0.5)'\n       : 'rgba(128, 128, 128, 0.6)',"
        },
        {
            "sha": "01824eec1b366c948ec06b92631f25def11aa9fa",
            "filename": "apps/bundle-analyzer/components/ui/tooltip.tsx",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Ftooltip.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Ftooltip.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fcomponents%2Fui%2Ftooltip.tsx?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -0,0 +1,30 @@\n+'use client'\n+\n+import * as TooltipPrimitive from '@radix-ui/react-tooltip'\n+import * as React from 'react'\n+\n+import { cn } from '@/lib/utils'\n+\n+const TooltipProvider = TooltipPrimitive.Provider\n+const Tooltip = TooltipPrimitive.Root\n+const TooltipTrigger = TooltipPrimitive.Trigger\n+\n+const TooltipContent = React.forwardRef<\n+  React.ElementRef<typeof TooltipPrimitive.Content>,\n+  React.ComponentPropsWithoutRef<typeof TooltipPrimitive.Content>\n+>(({ className, sideOffset = 4, ...props }, ref) => (\n+  <TooltipPrimitive.Portal>\n+    <TooltipPrimitive.Content\n+      ref={ref}\n+      sideOffset={sideOffset}\n+      className={cn(\n+        'z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-xs text-popover-foreground shadow-md outline-none data-[state=closed]:animate-out data-[state=open]:animate-in data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2',\n+        className\n+      )}\n+      {...props}\n+    />\n+  </TooltipPrimitive.Portal>\n+))\n+TooltipContent.displayName = TooltipPrimitive.Content.displayName\n+\n+export { Tooltip, TooltipTrigger, TooltipContent, TooltipProvider }"
        },
        {
            "sha": "d6dd96654b0a400aa6e514d1b94e9ae7662644ac",
            "filename": "apps/bundle-analyzer/lib/analyze-data.ts",
            "status": "modified",
            "additions": 47,
            "deletions": 15,
            "changes": 62,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Flib%2Fanalyze-data.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Flib%2Fanalyze-data.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Flib%2Fanalyze-data.ts?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -18,6 +18,7 @@ export interface AnalyzeChunkPart {\n   source_index: number\n   output_file_index: number\n   size: number\n+  compressed_size: number\n }\n \n export interface AnalyzeOutputFile {\n@@ -336,37 +337,39 @@ export class AnalyzeData {\n     return parentPath + source.path\n   }\n \n-  getSourceOutputSize(index: SourceIndex): number {\n+  getOwnSizes(index: SourceIndex): {\n+    size: number\n+    compressedSize: number\n+  } {\n     const chunkParts = this.sourceChunkParts(index)\n-    let totalSize = 0\n+    let size = 0\n+    let compressedSize = 0\n     for (const chunkPartIndex of chunkParts) {\n       const chunkPart = this.chunkPart(chunkPartIndex)\n       if (chunkPart) {\n-        totalSize += chunkPart.size\n+        size += chunkPart.size\n+        compressedSize += chunkPart.compressed_size\n       }\n     }\n-    return totalSize\n+    return { size, compressedSize }\n   }\n \n-  getSourceRecursiveSize(index: SourceIndex): number {\n-    let totalSize = this.getSourceOutputSize(index)\n-    const children = this.sourceChildren(index)\n-    for (const childIndex of children) {\n-      totalSize += this.getSourceRecursiveSize(childIndex)\n-    }\n-    return totalSize\n-  }\n+  getRecursiveModuleCount(\n+    index: SourceIndex,\n+    filterSource: (sourceIndex: SourceIndex) => boolean\n+  ): number {\n+    const selfVisible = filterSource(index)\n+    const selfCount =\n+      selfVisible && this.sourceChunkParts(index).length > 0 ? 1 : 0\n \n-  getSourceRecursiveModuleCount(index: SourceIndex): number {\n-    const selfCount = this.sourceChunkParts(index).length > 0 ? 1 : 0\n     const children = this.sourceChildren(index)\n     if (children.length === 0) {\n       return selfCount\n     }\n \n     let totalCount = selfCount\n     for (const childIndex of children) {\n-      totalCount += this.getSourceRecursiveModuleCount(childIndex)\n+      totalCount += this.getRecursiveModuleCount(childIndex, filterSource)\n     }\n     return totalCount\n   }\n@@ -388,6 +391,35 @@ export class AnalyzeData {\n     return Array.from(uniqueChunks).sort()\n   }\n \n+  getRecursiveSizes(\n+    index: SourceIndex,\n+    filterSource: (sourceIndex: SourceIndex) => boolean\n+  ): { size: number; compressedSize: number } {\n+    let size = 0\n+    let compressedSize = 0\n+\n+    if (filterSource(index)) {\n+      const { size: ownUncompressedSize, compressedSize: ownCompressedSize } =\n+        this.getOwnSizes(index)\n+      size += ownUncompressedSize\n+      compressedSize += ownCompressedSize\n+    }\n+\n+    for (const childIndex of this.sourceChildren(index)) {\n+      const {\n+        size: childUncompressedSize,\n+        compressedSize: childCompressedSize,\n+      } = this.getRecursiveSizes(childIndex, filterSource)\n+      size += childUncompressedSize\n+      compressedSize += childCompressedSize\n+    }\n+\n+    return {\n+      size,\n+      compressedSize,\n+    }\n+  }\n+\n   getSourceFlags(index: SourceIndex): {\n     client: boolean\n     server: boolean"
        },
        {
            "sha": "6a39d7dc34a7d9a0cd37918e63d05c2206864929",
            "filename": "apps/bundle-analyzer/lib/treemap-layout.ts",
            "status": "modified",
            "additions": 51,
            "deletions": 30,
            "changes": 81,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Flib%2Ftreemap-layout.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Flib%2Ftreemap-layout.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Flib%2Ftreemap-layout.ts?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -35,7 +35,13 @@ export interface LayoutNode extends LayoutNodeInfo {\n \n interface SourceMetadata {\n   filtered: boolean\n-  totalSize: number\n+  size: number\n+  compressedSize: number\n+}\n+\n+export enum SizeMode {\n+  Compressed = 'compressed',\n+  Uncompressed = 'uncompressed',\n }\n \n function precomputeSourceMetadata(\n@@ -45,23 +51,24 @@ function precomputeSourceMetadata(\n   const sourceCount = analyzeData.sourceCount()\n   const metadata: SourceMetadata[] = new Array(sourceCount)\n \n-  // Initialize all entries\n-  for (let i = 0; i < sourceCount; i++) {\n-    metadata[i] = { filtered: true, totalSize: 0 }\n-  }\n-\n-  // Bottom-up pass: compute leaf node data\n   for (let i = sourceCount - 1; i >= 0; i--) {\n     const children = analyzeData.sourceChildren(i)\n-    const ownSize = analyzeData.getSourceOutputSize(i)\n+    const ownSize = analyzeData.getOwnSizes(i)\n \n     if (children.length === 0) {\n-      // Leaf node (file)\n-      metadata[i].totalSize = ownSize\n-      metadata[i].filtered = filterSource ? !filterSource(i) : false\n+      // file\n+      metadata[i] = {\n+        size: ownSize.size,\n+        compressedSize: ownSize.compressedSize,\n+        filtered: filterSource ? !filterSource(i) : false,\n+      }\n     } else {\n-      // Directory - initialize with own size\n-      metadata[i].totalSize = ownSize\n+      // directory\n+      metadata[i] = {\n+        filtered: true,\n+        size: ownSize.size,\n+        compressedSize: ownSize.compressedSize,\n+      }\n     }\n   }\n \n@@ -70,19 +77,22 @@ function precomputeSourceMetadata(\n     const children = analyzeData.sourceChildren(idx)\n     if (children.length === 0) return // Already processed as leaf\n \n-    let totalSize = metadata[idx].totalSize // Start with own size\n+    let totalUncompressedSize = metadata[idx].size\n+    let totalCompressedSize = metadata[idx].compressedSize\n     let hasVisibleChild = false\n \n     for (const childIdx of children) {\n       processDirectory(childIdx) // Process child first\n       if (!metadata[childIdx].filtered) {\n         // Only add size of visible (non-filtered) children\n-        totalSize += metadata[childIdx].totalSize\n+        totalUncompressedSize += metadata[childIdx].size\n+        totalCompressedSize += metadata[childIdx].compressedSize\n         hasVisibleChild = true\n       }\n     }\n \n-    metadata[idx].totalSize = totalSize\n+    metadata[idx].size = totalUncompressedSize\n+    metadata[idx].compressedSize = totalCompressedSize\n     metadata[idx].filtered = !hasVisibleChild // Directory filtered if no visible children\n   }\n \n@@ -102,7 +112,8 @@ function computeTreemapLayoutFromAnalyzeInternal(\n   foldedPath: string,\n   rect: LayoutRect,\n   metadata: SourceMetadata[],\n-  filterSource?: (sourceIndex: SourceIndex) => boolean\n+  filterSource: ((sourceIndex: SourceIndex) => boolean) | undefined,\n+  sizeMode: SizeMode\n ): LayoutNode {\n   const source = analyzeData.source(sourceIndex)\n   if (!source) {\n@@ -111,7 +122,6 @@ function computeTreemapLayoutFromAnalyzeInternal(\n \n   const isDirectory = source.path.endsWith('/') || !source.path\n \n-  // Get children sources\n   const childrenIndices = analyzeData.sourceChildren(sourceIndex)\n \n   // Fold single-child directories\n@@ -129,13 +139,16 @@ function computeTreemapLayoutFromAnalyzeInternal(\n         foldedPath + source.path,\n         rect,\n         metadata,\n-        filterSource\n+        filterSource,\n+        sizeMode\n       )\n     }\n   }\n \n-  // Use precomputed size\n-  const totalSize = metadata[sourceIndex].totalSize\n+  const totalSize =\n+    sizeMode === SizeMode.Compressed\n+      ? metadata[sourceIndex].compressedSize\n+      : metadata[sourceIndex].size\n \n   // If this is a file (no children), create a file node\n   if (!isDirectory || childrenIndices.length === 0) {\n@@ -150,7 +163,9 @@ function computeTreemapLayoutFromAnalyzeInternal(\n     }\n   }\n \n-  // This is a directory with children\n+  const directoryName = foldedPath + source.path || 'All Route Modules'\n+\n+  // Directory with children\n   const titleBarHeight = Math.round(\n     Math.max(12, Math.min(24, rect.height * 0.1))\n   )\n@@ -175,7 +190,7 @@ function computeTreemapLayoutFromAnalyzeInternal(\n     }\n \n     return {\n-      name: foldedPath + source.path,\n+      name: directoryName,\n       size: totalSize,\n       type: 'collapsed-directory',\n       rect,\n@@ -199,8 +214,11 @@ function computeTreemapLayoutFromAnalyzeInternal(\n       continue\n     }\n \n-    // Use precomputed size\n-    const childSize = metadata[childIndex].totalSize\n+    // Use precomputed size based on mode\n+    const childSize =\n+      sizeMode === SizeMode.Compressed\n+        ? metadata[childIndex].compressedSize\n+        : metadata[childIndex].size\n \n     childrenData.push({\n       index: childIndex,\n@@ -210,7 +228,7 @@ function computeTreemapLayoutFromAnalyzeInternal(\n \n   if (childrenData.length === 0) {\n     return {\n-      name: foldedPath + source.path,\n+      name: directoryName,\n       size: totalSize,\n       type: 'directory',\n       rect,\n@@ -235,12 +253,13 @@ function computeTreemapLayoutFromAnalyzeInternal(\n       '',\n       childRects[i],\n       metadata,\n-      filterSource\n+      filterSource,\n+      sizeMode\n     )\n   )\n \n   return {\n-    name: foldedPath + source.path,\n+    name: directoryName,\n     size: totalSize,\n     type: 'directory',\n     rect,\n@@ -256,7 +275,8 @@ export function computeTreemapLayoutFromAnalyze(\n   analyzeData: AnalyzeData,\n   sourceIndex: SourceIndex,\n   rect: LayoutRect,\n-  filterSource?: (sourceIndex: SourceIndex) => boolean\n+  filterSource?: (sourceIndex: SourceIndex) => boolean,\n+  sizeMode: SizeMode = SizeMode.Compressed\n ): LayoutNode {\n   // Precompute metadata once for entire tree\n   const metadata = precomputeSourceMetadata(analyzeData, filterSource)\n@@ -268,6 +288,7 @@ export function computeTreemapLayoutFromAnalyze(\n     '',\n     rect,\n     metadata,\n-    filterSource\n+    filterSource,\n+    sizeMode\n   )\n }"
        },
        {
            "sha": "553c399f1ba2577d8ab73cef206e65ecbf259049",
            "filename": "apps/bundle-analyzer/package.json",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/apps%2Fbundle-analyzer%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/apps%2Fbundle-analyzer%2Fpackage.json?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -11,6 +11,7 @@\n   \"dependencies\": {\n     \"@radix-ui/react-dialog\": \"1.1.4\",\n     \"@radix-ui/react-popover\": \"1.1.4\",\n+    \"@radix-ui/react-tooltip\": \"1.1.4\",\n     \"@radix-ui/react-slot\": \"1.1.1\",\n     \"@radix-ui/react-toggle-group\": \"1.1.1\",\n     \"autoprefixer\": \"^10.4.20\","
        },
        {
            "sha": "fd617edb1cfc393d63d5e92ae75dc00f5dd4b503",
            "filename": "crates/next-api/src/analyze.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/crates%2Fnext-api%2Fsrc%2Fanalyze.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/crates%2Fnext-api%2Fsrc%2Fanalyze.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fanalyze.rs?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -75,6 +75,7 @@ pub struct AnalyzeChunkPart {\n     pub source_index: u32,\n     pub output_file_index: u32,\n     pub size: u32,\n+    pub compressed_size: u32,\n }\n \n #[derive(Serialize)]\n@@ -384,6 +385,7 @@ pub async fn analyze_output_assets(output_assets: Vc<OutputAssets>) -> Result<Vc\n                 source_index,\n                 output_file_index,\n                 size: chunk_part.real_size + chunk_part.unaccounted_size,\n+                compressed_size: chunk_part.get_compressed_size().await?,\n             });\n             builder.add_chunk_part_to_output_file(output_file_index, chunk_part_index);\n             builder.add_chunk_part_to_source(source_index, chunk_part_index);"
        },
        {
            "sha": "243b916c4fb7b5b2c62064e285c2d51180a6fc26",
            "filename": "pnpm-lock.yaml",
            "status": "modified",
            "additions": 256,
            "deletions": 0,
            "changes": 256,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/pnpm-lock.yaml",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/pnpm-lock.yaml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/pnpm-lock.yaml?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -630,6 +630,9 @@ importers:\n       '@radix-ui/react-toggle-group':\n         specifier: 1.1.1\n         version: 1.1.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-tooltip':\n+        specifier: 1.1.4\n+        version: 1.1.4(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n       autoprefixer:\n         specifier: ^10.4.20\n         version: 10.4.21(postcss@8.5.3)\n@@ -4845,6 +4848,9 @@ packages:\n   '@radix-ui/number@1.1.1':\n     resolution: {integrity: sha512-MkKCwxlXTgz6CFoJx3pCwn07GKp36+aZyu/u2Ln2VrA5DcdyCZkASEDBTd8x5whTQQL5CiYf4prXKLcgQdv29g==}\n \n+  '@radix-ui/primitive@1.1.0':\n+    resolution: {integrity: sha512-4Z8dn6Upk0qk4P74xBhZ6Hd/w0mPEzOOLxy4xiPXOXqjF7jZS0VAKk7/x/H6FyY2zCkYJqePf1G5KmkmNJ4RBA==}\n+\n   '@radix-ui/primitive@1.1.1':\n     resolution: {integrity: sha512-SJ31y+Q/zAyShtXJc8x83i9TYdbAfHZ++tUZnvjJJqFjzsdUnKsxPL6IEtBlxKkU7yzer//GQtZSV4GbldL3YA==}\n \n@@ -4864,6 +4870,19 @@ packages:\n       '@types/react-dom':\n         optional: true\n \n+  '@radix-ui/react-arrow@1.1.0':\n+    resolution: {integrity: sha512-FmlW1rCg7hBpEBwFbjHwCW6AmWLQM6g/v0Sn8XbP9NvmSZ2San1FpQeyPtufzOMSIx7Y4dzjlHoifhp+7NkZhw==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+      '@types/react-dom':\n+        optional: true\n+\n   '@radix-ui/react-arrow@1.1.1':\n     resolution: {integrity: sha512-NaVpZfmv8SKeZbn4ijN2V3jlHA9ngBG16VnIIm22nUR0Yk8KUALyBxT3KYEUnNuch9sTE8UTsS3whzBgKOL30w==}\n     peerDependencies:\n@@ -4929,6 +4948,15 @@ packages:\n       '@types/react-dom':\n         optional: true\n \n+  '@radix-ui/react-compose-refs@1.1.0':\n+    resolution: {integrity: sha512-b4inOtiaOnYf9KWyO3jAeeCG6FeyfY6ldiEPanbUjWd+xIk5wZeHa8yVwmrJ2vderhu/BQvzCrJI0lHd+wIiqw==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      react: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+\n   '@radix-ui/react-compose-refs@1.1.1':\n     resolution: {integrity: sha512-Y9VzoRDSJtgFMUCoiZBDVo084VQ5hfpXxVE+NgkdNsjiDBByiImMZKKhxMwCbdHvhlENG6a833CbFkOQvTricw==}\n     peerDependencies:\n@@ -4947,6 +4975,15 @@ packages:\n       '@types/react':\n         optional: true\n \n+  '@radix-ui/react-context@1.1.0':\n+    resolution: {integrity: sha512-OKrckBy+sMEgYM/sMmqmErVn0kZqrHPJze+Ql3DzYsDDp0hl0L62nx/2122/Bvps1qz645jlcu2tD9lrRSdf8A==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      react: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+\n   '@radix-ui/react-context@1.1.1':\n     resolution: {integrity: sha512-UASk9zi+crv9WteK/NU4PLvOoL3OuE6BWVKNF6hPRBtYBDXQ2u5iu3O59zUlJiTVvkyuycnqrztsHVJwcK9K+Q==}\n     peerDependencies:\n@@ -5009,6 +5046,19 @@ packages:\n       '@types/react':\n         optional: true\n \n+  '@radix-ui/react-dismissable-layer@1.1.1':\n+    resolution: {integrity: sha512-QSxg29lfr/xcev6kSz7MAlmDnzbP1eI/Dwn3Tp1ip0KT5CUELsxkekFEMVBEoykI3oV39hKT4TKZzBNMbcTZYQ==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+      '@types/react-dom':\n+        optional: true\n+\n   '@radix-ui/react-dismissable-layer@1.1.11':\n     resolution: {integrity: sha512-Nqcp+t5cTB8BinFkZgXiMJniQH0PsUt2k51FUhbdfeKvc4ACcG2uQniY/8+h1Yv6Kza4Q7lD7PQV0z0oicE0Mg==}\n     peerDependencies:\n@@ -5136,6 +5186,19 @@ packages:\n       '@types/react-dom':\n         optional: true\n \n+  '@radix-ui/react-popper@1.2.0':\n+    resolution: {integrity: sha512-ZnRMshKF43aBxVWPWvbj21+7TQCvhuULWJ4gNIKYpRlQt5xGRhLx66tMp8pya2UkGHTSlhpXwmjqltDYHhw7Vg==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+      '@types/react-dom':\n+        optional: true\n+\n   '@radix-ui/react-popper@1.2.1':\n     resolution: {integrity: sha512-3kn5Me69L+jv82EKRuQCXdYyf1DqHwD2U/sxoNgBGCB7K9TRc3bQamQ+5EPM9EvyPdli0W41sROd+ZU1dTCztw==}\n     peerDependencies:\n@@ -5162,6 +5225,19 @@ packages:\n       '@types/react-dom':\n         optional: true\n \n+  '@radix-ui/react-portal@1.1.2':\n+    resolution: {integrity: sha512-WeDYLGPxJb/5EGBoedyJbT0MpoULmwnIPMJMSldkuiMsBAv7N1cRdsTWZWht9vpPOiN3qyiGAtbK2is47/uMFg==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+      '@types/react-dom':\n+        optional: true\n+\n   '@radix-ui/react-portal@1.1.3':\n     resolution: {integrity: sha512-NciRqhXnGojhT93RPyDaMPfLH3ZSl4jjIFbZQ1b/vxvZEdHsBZ49wP9w8L3HzUQwep01LcWtkUvm0OVB5JAHTw==}\n     peerDependencies:\n@@ -5188,6 +5264,19 @@ packages:\n       '@types/react-dom':\n         optional: true\n \n+  '@radix-ui/react-presence@1.1.1':\n+    resolution: {integrity: sha512-IeFXVi4YS1K0wVZzXNrbaaUvIJ3qdY+/Ih4eHFhWA9SwGR9UDX7Ck8abvL57C4cv3wwMvUE0OG69Qc3NCcTe/A==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+      '@types/react-dom':\n+        optional: true\n+\n   '@radix-ui/react-presence@1.1.2':\n     resolution: {integrity: sha512-18TFr80t5EVgL9x1SwF/YGtfG+l0BS0PRAlCWBDoBEiDQjeKgnNZRVJp/oVBl24sr3Gbfwc/Qpj4OcWTQMsAEg==}\n     peerDependencies:\n@@ -5214,6 +5303,19 @@ packages:\n       '@types/react-dom':\n         optional: true\n \n+  '@radix-ui/react-primitive@2.0.0':\n+    resolution: {integrity: sha512-ZSpFm0/uHa8zTvKBDjLFWLo8dkr4MBsiDLz0g3gMUwqgLHz9rTaRRGYDgvZPtBJgYCBKXkS9fzmoySgr8CO6Cw==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+      '@types/react-dom':\n+        optional: true\n+\n   '@radix-ui/react-primitive@2.0.1':\n     resolution: {integrity: sha512-sHCWTtxwNn3L3fH8qAfnF3WbUZycW93SM1j3NFDzXBiz8D6F5UTTy8G1+WFEaiCdvCVRJWj6N2R4Xq6HdiHmDg==}\n     peerDependencies:\n@@ -5279,6 +5381,15 @@ packages:\n       '@types/react-dom':\n         optional: true\n \n+  '@radix-ui/react-slot@1.1.0':\n+    resolution: {integrity: sha512-FUCf5XMfmW4dtYl69pdS4DbxKy8nj4M7SafBgPllysxmdachynNflAdp/gCsnYWNDnge6tI9onzMp5ARYc1KNw==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      react: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+\n   '@radix-ui/react-slot@1.1.1':\n     resolution: {integrity: sha512-RApLLOcINYJA+dMVbOju7MYv1Mb2EBp2nH4HdDzXTSyaR5optlm6Otrz1euW3HbdOR8UmmFK06TD+A9frYWv+g==}\n     peerDependencies:\n@@ -5336,6 +5447,19 @@ packages:\n       '@types/react-dom':\n         optional: true\n \n+  '@radix-ui/react-tooltip@1.1.4':\n+    resolution: {integrity: sha512-QpObUH/ZlpaO4YgHSaYzrLO2VuO+ZBFFgGzjMUPwtiYnAzzNNDPJeEGRrT7qNOrWm/Jr08M1vlp+vTHtnSQ0Uw==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+      '@types/react-dom':\n+        optional: true\n+\n   '@radix-ui/react-use-callback-ref@1.1.0':\n     resolution: {integrity: sha512-CasTfvsy+frcFkbXtSJ2Zu9JHpN8TYKxkgJGWbjiZhFivxaeW7rMeZt7QELGVLaYVfFMsKHjb7Ak0nMEe+2Vfw==}\n     peerDependencies:\n@@ -5462,6 +5586,19 @@ packages:\n       '@types/react':\n         optional: true\n \n+  '@radix-ui/react-visually-hidden@1.1.0':\n+    resolution: {integrity: sha512-N8MDZqtgCgG5S3aV60INAB475osJousYpZ4cTJ2cFbMpdHS5Y6loLTH8LPtkj2QN0x93J30HT/M3qJXM0+lyeQ==}\n+    peerDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211\n+    peerDependenciesMeta:\n+      '@types/react':\n+        optional: true\n+      '@types/react-dom':\n+        optional: true\n+\n   '@radix-ui/react-visually-hidden@1.2.3':\n     resolution: {integrity: sha512-pzJq12tEaaIhqjbzpCuv/OypJY/BPavOofm+dbab+MHLajy277+1lLm6JFcGgF5eskJ6mquGirhXY2GD/8u8Ug==}\n     peerDependencies:\n@@ -21849,6 +21986,8 @@ snapshots:\n \n   '@radix-ui/number@1.1.1': {}\n \n+  '@radix-ui/primitive@1.1.0': {}\n+\n   '@radix-ui/primitive@1.1.1': {}\n \n   '@radix-ui/primitive@1.1.3': {}\n@@ -21870,6 +22009,15 @@ snapshots:\n       '@types/react': 19.2.2\n       '@types/react-dom': 19.2.1(@types/react@19.2.2)\n \n+  '@radix-ui/react-arrow@1.1.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      '@radix-ui/react-primitive': 2.0.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211)\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1(@types/react@19.2.2)\n+\n   '@radix-ui/react-arrow@1.1.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n@@ -21928,6 +22076,12 @@ snapshots:\n       '@types/react': 19.2.2\n       '@types/react-dom': 19.2.1(@types/react@19.2.2)\n \n+  '@radix-ui/react-compose-refs@1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      react: 19.3.0-canary-b45bb335-20251211\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+\n   '@radix-ui/react-compose-refs@1.1.1(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       react: 19.3.0-canary-b45bb335-20251211\n@@ -21940,6 +22094,12 @@ snapshots:\n     optionalDependencies:\n       '@types/react': 19.2.2\n \n+  '@radix-ui/react-context@1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      react: 19.3.0-canary-b45bb335-20251211\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+\n   '@radix-ui/react-context@1.1.1(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       react: 19.3.0-canary-b45bb335-20251211\n@@ -22008,6 +22168,19 @@ snapshots:\n     optionalDependencies:\n       '@types/react': 19.2.2\n \n+  '@radix-ui/react-dismissable-layer@1.1.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      '@radix-ui/primitive': 1.1.0\n+      '@radix-ui/react-compose-refs': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-primitive': 2.0.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-use-escape-keydown': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211)\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1(@types/react@19.2.2)\n+\n   '@radix-ui/react-dismissable-layer@1.1.11(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       '@radix-ui/primitive': 1.1.3\n@@ -22150,6 +22323,24 @@ snapshots:\n       '@types/react': 19.2.2\n       '@types/react-dom': 19.2.1(@types/react@19.2.2)\n \n+  '@radix-ui/react-popper@1.2.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      '@floating-ui/react-dom': 2.1.5(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-arrow': 1.1.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-compose-refs': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-context': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-primitive': 2.0.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-use-callback-ref': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-use-rect': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-use-size': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/rect': 1.1.0\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211)\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1(@types/react@19.2.2)\n+\n   '@radix-ui/react-popper@1.2.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       '@floating-ui/react-dom': 2.1.5(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n@@ -22186,6 +22377,16 @@ snapshots:\n       '@types/react': 19.2.2\n       '@types/react-dom': 19.2.1(@types/react@19.2.2)\n \n+  '@radix-ui/react-portal@1.1.2(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      '@radix-ui/react-primitive': 2.0.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211)\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1(@types/react@19.2.2)\n+\n   '@radix-ui/react-portal@1.1.3(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       '@radix-ui/react-primitive': 2.0.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n@@ -22206,6 +22407,16 @@ snapshots:\n       '@types/react': 19.2.2\n       '@types/react-dom': 19.2.1(@types/react@19.2.2)\n \n+  '@radix-ui/react-presence@1.1.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      '@radix-ui/react-compose-refs': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-use-layout-effect': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211)\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1(@types/react@19.2.2)\n+\n   '@radix-ui/react-presence@1.1.2(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n@@ -22226,6 +22437,15 @@ snapshots:\n       '@types/react': 19.2.2\n       '@types/react-dom': 19.2.1(@types/react@19.2.2)\n \n+  '@radix-ui/react-primitive@2.0.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      '@radix-ui/react-slot': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211)\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1(@types/react@19.2.2)\n+\n   '@radix-ui/react-primitive@2.0.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       '@radix-ui/react-slot': 1.1.1(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n@@ -22295,6 +22515,13 @@ snapshots:\n       '@types/react': 19.2.2\n       '@types/react-dom': 19.2.1(@types/react@19.2.2)\n \n+  '@radix-ui/react-slot@1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      '@radix-ui/react-compose-refs': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      react: 19.3.0-canary-b45bb335-20251211\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+\n   '@radix-ui/react-slot@1.1.1(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       '@radix-ui/react-compose-refs': 1.1.1(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n@@ -22351,6 +22578,26 @@ snapshots:\n       '@types/react': 19.2.2\n       '@types/react-dom': 19.2.1(@types/react@19.2.2)\n \n+  '@radix-ui/react-tooltip@1.1.4(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      '@radix-ui/primitive': 1.1.0\n+      '@radix-ui/react-compose-refs': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-context': 1.1.1(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-dismissable-layer': 1.1.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-id': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-popper': 1.2.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-portal': 1.1.2(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-presence': 1.1.1(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-primitive': 2.0.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-slot': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-use-controllable-state': 1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)\n+      '@radix-ui/react-visually-hidden': 1.1.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211)\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1(@types/react@19.2.2)\n+\n   '@radix-ui/react-use-callback-ref@1.1.0(@types/react@19.2.2)(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       react: 19.3.0-canary-b45bb335-20251211\n@@ -22445,6 +22692,15 @@ snapshots:\n     optionalDependencies:\n       '@types/react': 19.2.2\n \n+  '@radix-ui/react-visually-hidden@1.1.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n+    dependencies:\n+      '@radix-ui/react-primitive': 2.0.0(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)\n+      react: 19.3.0-canary-b45bb335-20251211\n+      react-dom: 19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211)\n+    optionalDependencies:\n+      '@types/react': 19.2.2\n+      '@types/react-dom': 19.2.1(@types/react@19.2.2)\n+\n   '@radix-ui/react-visually-hidden@1.2.3(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)':\n     dependencies:\n       '@radix-ui/react-primitive': 2.1.3(@types/react-dom@19.2.1(@types/react@19.2.2))(@types/react@19.2.2)(react-dom@19.3.0-canary-b45bb335-20251211(react@19.3.0-canary-b45bb335-20251211))(react@19.3.0-canary-b45bb335-20251211)"
        },
        {
            "sha": "dd9ebbf64bb6d620c78c0e9d4470f7450c9e10cf",
            "filename": "turbopack/crates/turbopack-analyze/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-analyze%2FCargo.toml?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -11,6 +11,7 @@ bench = false\n [dependencies]\n anyhow = { workspace = true }\n bincode = { workspace = true }\n+flate2 = { workspace = true }\n rustc-hash = { workspace = true }\n serde = { workspace = true, features = [\"derive\"] }\n turbo-rcstr = { workspace = true }"
        },
        {
            "sha": "9012bd697da430fe6f69ab18a719b4e0e1f6cfa0",
            "filename": "turbopack/crates/turbopack-analyze/src/compressed_size.rs",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Fcompressed_size.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Fcompressed_size.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Fcompressed_size.rs?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -0,0 +1,17 @@\n+use std::io::Write;\n+\n+use anyhow::Result;\n+use flate2::{Compression, write::DeflateEncoder};\n+use turbo_rcstr::RcStr;\n+\n+/// Compresses an asset's content with default-level (level 6) deflate/gzip.\n+/// Returns the size in bytes in the compressed output\n+pub fn compressed_size_bytes(content: RcStr) -> Result<u32> {\n+    // Use deflate over gzip to prevent individual file headers/footers from\n+    // skewing the size results.\n+    let mut encoder = DeflateEncoder::new(Vec::new(), Compression::default());\n+    encoder.write_all(content.as_ref())?;\n+    let compressed = encoder.finish()?;\n+\n+    Ok(compressed.len() as u32)\n+}"
        },
        {
            "sha": "69d13321b81afb2808dbf92e96d2645d5980ccbc",
            "filename": "turbopack/crates/turbopack-analyze/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Flib.rs?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -1,3 +1,4 @@\n #![feature(arbitrary_self_types_pointers)]\n \n+pub mod compressed_size;\n pub mod split_chunk;"
        },
        {
            "sha": "325c1750b3a12f40c0b1d779dd530f7a949963d5",
            "filename": "turbopack/crates/turbopack-analyze/src/split_chunk.rs",
            "status": "modified",
            "additions": 264,
            "deletions": 128,
            "changes": 392,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Fsplit_chunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Fsplit_chunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-analyze%2Fsrc%2Fsplit_chunk.rs?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -3,14 +3,16 @@ use std::mem::replace;\n use anyhow::Result;\n use bincode::{Decode, Encode};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{FxIndexMap, NonLocalValue, ValueToString, Vc, trace::TraceRawVcs};\n+use turbo_tasks::{FxIndexMap, NonLocalValue, ResolvedVc, ValueToString, Vc, trace::TraceRawVcs};\n use turbo_tasks_fs::{FileContent, FileLine, FileLinesContent, rope::Rope};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     output::OutputAsset,\n-    source_map::{GenerateSourceMap, OriginalToken, SourceMap, SyntheticToken, Token},\n+    source_map::{GenerateSourceMap, OriginalToken, SourceMap, Token},\n };\n \n+use crate::compressed_size::compressed_size_bytes;\n+\n #[derive(Clone, Debug, Eq, NonLocalValue, PartialEq, TraceRawVcs, Encode, Decode)]\n pub struct ChunkPartRange {\n     pub line: u32,\n@@ -23,9 +25,32 @@ pub struct ChunkPart {\n     pub source: RcStr,\n     pub real_size: u32,\n     pub unaccounted_size: u32,\n+    pub lines: ResolvedVc<FileLinesContent>,\n     pub ranges: Vec<ChunkPartRange>,\n }\n \n+impl ChunkPart {\n+    pub async fn get_compressed_size(&self) -> Result<u32> {\n+        let lines = &*self.lines.await?;\n+        let FileLinesContent::Lines(lines) = lines else {\n+            return Ok(0);\n+        };\n+\n+        let mut all_range_content = String::new();\n+        for range in &self.ranges {\n+            append_content_between(\n+                range.line,\n+                range.start_column,\n+                range.line,\n+                range.end_column,\n+                lines,\n+                &mut all_range_content,\n+            );\n+        }\n+        compressed_size_bytes(all_range_content.into())\n+    }\n+}\n+\n #[turbo_tasks::value(transparent)]\n #[derive(Debug)]\n pub struct ChunkParts(Vec<ChunkPart>);\n@@ -42,22 +67,24 @@ pub async fn split_output_asset_into_parts(\n         return Ok(Vc::cell(vec![]));\n     };\n     let content = content.content();\n+    let lines_vc = file_content.lines().to_resolved().await?;\n+\n     let Some(generate_source_map) =\n         Vc::try_resolve_sidecast::<Box<dyn GenerateSourceMap>>(asset).await?\n     else {\n-        return self_mapped(asset, content).await;\n+        return self_mapped(asset, content, lines_vc).await;\n     };\n     let source_map = generate_source_map.generate_source_map().await?;\n     let Some(source_map) = source_map.as_content() else {\n-        return self_mapped(asset, content).await;\n+        return self_mapped(asset, content, lines_vc).await;\n     };\n     let Some(source_map) = SourceMap::new_from_rope(source_map.content())? else {\n-        return unaccounted(asset, content).await;\n+        return unaccounted(asset, content, lines_vc).await;\n     };\n \n-    let lines = file_content.lines().await?;\n+    let lines = lines_vc.await?;\n     let FileLinesContent::Lines(lines) = &*lines else {\n-        return unaccounted(asset, content).await;\n+        return unaccounted(asset, content, lines_vc).await;\n     };\n \n     fn end_of_mapping_column(\n@@ -74,6 +101,7 @@ pub async fn split_output_asset_into_parts(\n             line_end\n         }\n     }\n+\n     fn len_between(\n         start_line: u32,\n         start_column: u32,\n@@ -84,7 +112,8 @@ pub async fn split_output_asset_into_parts(\n         let start_line = start_line.min(lines.len() as u32 - 1);\n         let end_line = end_line.min(lines.len() as u32 - 1);\n         if start_line == end_line {\n-            return end_column - start_column;\n+            // TODO: Figure out why start is larger than end sometimes\n+            return end_column.saturating_sub(start_column);\n         }\n         let mut len = lines[start_line as usize].len() as u32 - start_column + 1;\n         for line in &lines[start_line as usize + 1..end_line as usize] {\n@@ -100,6 +129,7 @@ pub async fn split_output_asset_into_parts(\n         chunk_part_range: ChunkPartRange,\n         size: u32,\n         chunk_parts: &mut FxIndexMap<RcStr, ChunkPart>,\n+        lines: ResolvedVc<FileLinesContent>,\n     ) {\n         let entry = chunk_parts\n             .entry(source)\n@@ -108,14 +138,17 @@ pub async fn split_output_asset_into_parts(\n                 real_size: 0,\n                 unaccounted_size: 0,\n                 ranges: vec![],\n+                lines,\n             });\n         entry.real_size += size;\n         entry.ranges.push(chunk_part_range);\n     }\n+\n     fn add_unaccounted_chunk_part(\n         source: RcStr,\n         unaccounted: u32,\n         chunk_parts: &mut FxIndexMap<RcStr, ChunkPart>,\n+        lines: ResolvedVc<FileLinesContent>,\n     ) {\n         let entry = chunk_parts\n             .entry(source)\n@@ -124,193 +157,296 @@ pub async fn split_output_asset_into_parts(\n                 real_size: 0,\n                 unaccounted_size: 0,\n                 ranges: vec![],\n+                lines,\n             });\n         entry.unaccounted_size += unaccounted;\n     }\n \n+    fn end_current_mapping(\n+        source: RcStr,\n+        current_line: u32,\n+        start_column: u32,\n+        next_line: u32,\n+        next_column: u32,\n+        lines: &[FileLine],\n+        chunk_parts: &mut FxIndexMap<RcStr, ChunkPart>,\n+        lines_vc: ResolvedVc<FileLinesContent>,\n+    ) -> State {\n+        let mapping_end_column = end_of_mapping_column(current_line, next_line, next_column, lines);\n+        let len = mapping_end_column.saturating_sub(start_column);\n+        add_chunk_part_range(\n+            source.clone(),\n+            ChunkPartRange {\n+                line: current_line,\n+                start_column,\n+                end_column: mapping_end_column,\n+            },\n+            len,\n+            chunk_parts,\n+            lines_vc,\n+        );\n+        State::AfterMapping {\n+            source,\n+            generated_line: current_line,\n+            current_generated_column: mapping_end_column,\n+        }\n+    }\n+\n+    fn should_extend_mapping(\n+        state: &State,\n+        new_source: &RcStr,\n+        new_line: u32,\n+        new_column: u32,\n+    ) -> bool {\n+        if let State::InMapping {\n+            source,\n+            generated_line,\n+            end_column,\n+            ..\n+        } = state\n+        {\n+            // Extend if same source and line, and columns are adjacent or overlapping\n+            // end_column <= new_column handles both adjacent (equal) and overlapping cases\n+            source == new_source && *generated_line == new_line && *end_column <= new_column\n+        } else {\n+            false\n+        }\n+    }\n+\n     enum State {\n         StartOfFile,\n         InMapping {\n             source: RcStr,\n-            current_generated_line: u32,\n-            current_generated_column: u32,\n+            generated_line: u32,\n+            start_column: u32,\n+            end_column: u32,\n         },\n         AfterMapping {\n             source: RcStr,\n-            current_generated_line: u32,\n+            generated_line: u32,\n             current_generated_column: u32,\n         },\n     }\n \n     let mut state: State = State::StartOfFile;\n \n-    fn end_current_token(\n-        lines: &[FileLine],\n-        chunk_parts: &mut FxIndexMap<RcStr, ChunkPart>,\n-        state: &mut State,\n-        token: &Token,\n-    ) {\n-        if let State::InMapping {\n-            ref source,\n-            current_generated_line,\n-            current_generated_column,\n-        } = *state\n+    for token in source_map.tokens() {\n+        if let Token::Original(OriginalToken {\n+            original_file,\n+            generated_line,\n+            generated_column,\n+            ..\n+        }) = token\n         {\n-            let (Token::Original(OriginalToken {\n-                generated_line,\n-                generated_column,\n-                ..\n-            })\n-            | Token::Synthetic(SyntheticToken {\n-                generated_line,\n-                generated_column,\n-                ..\n-            })) = *token;\n-            let mapping_end_column = end_of_mapping_column(\n-                current_generated_line,\n-                generated_line,\n-                generated_column,\n-                lines,\n-            );\n-            // TODO: Handle this better\n-            let len = mapping_end_column.saturating_sub(current_generated_column);\n-            add_chunk_part_range(\n-                source.clone(),\n-                ChunkPartRange {\n-                    line: current_generated_line,\n-                    start_column: current_generated_column,\n-                    end_column: mapping_end_column,\n-                },\n-                len,\n-                chunk_parts,\n-            );\n-            *state = State::AfterMapping {\n-                source: source.clone(),\n-                current_generated_line,\n-                current_generated_column: mapping_end_column,\n-            };\n-        }\n-    }\n-\n-    fn start_new_mapping(\n-        lines: &[FileLine],\n-        chunk_parts: &mut FxIndexMap<RcStr, ChunkPart>,\n-        state: &mut State,\n-        original_file: RcStr,\n-        generated_line: u32,\n-        generated_column: u32,\n-    ) {\n-        match replace(\n-            state,\n-            State::InMapping {\n-                source: original_file.clone(),\n-                current_generated_line: generated_line,\n-                current_generated_column: generated_column,\n-            },\n-        ) {\n-            State::InMapping { .. } => {\n-                unreachable!();\n+            // Check if we can extend the current mapping\n+            if should_extend_mapping(&state, &original_file, generated_line, generated_column) {\n+                // Same source and line with adjacent columns - update end to next token position\n+                if let State::InMapping {\n+                    source,\n+                    generated_line: current_line,\n+                    start_column,\n+                    ..\n+                } = state\n+                {\n+                    state = State::InMapping {\n+                        source,\n+                        generated_line: current_line,\n+                        start_column,\n+                        end_column: generated_column,\n+                    };\n+                    continue;\n+                }\n             }\n-            State::AfterMapping {\n+\n+            // End the current mapping if we're in one\n+            if let State::InMapping {\n                 source,\n-                current_generated_line,\n-                current_generated_column,\n-            } => {\n-                let len = len_between(\n-                    current_generated_line,\n-                    current_generated_column,\n+                generated_line: current_line,\n+                start_column,\n+                ..\n+            } = state\n+            {\n+                state = end_current_mapping(\n+                    source,\n+                    current_line,\n+                    start_column,\n                     generated_line,\n                     generated_column,\n                     lines,\n+                    &mut chunk_parts,\n+                    lines_vc,\n                 );\n-                let half = len / 2;\n-                add_unaccounted_chunk_part(source, half, chunk_parts);\n-                add_unaccounted_chunk_part(original_file.clone(), len - half, chunk_parts);\n-            }\n-            State::StartOfFile => {\n-                let len = len_between(0, 0, generated_line, generated_column, lines);\n-                add_unaccounted_chunk_part(original_file.clone(), len, chunk_parts);\n             }\n-        }\n-    }\n \n-    for token in source_map.tokens() {\n-        // First end the previous mapping if we were in one\n-        end_current_token(lines, &mut chunk_parts, &mut state, &token);\n-\n-        if let Token::Original(OriginalToken {\n-            original_file,\n-            generated_line,\n-            generated_column,\n-            ..\n-        }) = token\n-        {\n-            // Start a new mapping and put the unaccounted part in between\n-            // somewhere\n-            start_new_mapping(\n-                lines,\n-                &mut chunk_parts,\n+            // Start a new mapping and put the unaccounted part in between somewhere\n+            // Set end_column to start_column initially; it will be updated when we see the next\n+            // token\n+            match replace(\n                 &mut state,\n-                original_file,\n-                generated_line,\n-                generated_column,\n-            );\n+                State::InMapping {\n+                    source: original_file.clone(),\n+                    generated_line,\n+                    start_column: generated_column,\n+                    end_column: generated_column,\n+                },\n+            ) {\n+                State::InMapping { .. } => {\n+                    unreachable!();\n+                }\n+                State::AfterMapping {\n+                    source,\n+                    generated_line,\n+                    current_generated_column,\n+                } => {\n+                    let len = len_between(\n+                        generated_line,\n+                        current_generated_column,\n+                        generated_line,\n+                        generated_column,\n+                        lines,\n+                    );\n+                    let half = len / 2;\n+                    add_unaccounted_chunk_part(source, half, &mut chunk_parts, lines_vc);\n+                    add_unaccounted_chunk_part(\n+                        original_file.clone(),\n+                        len - half,\n+                        &mut chunk_parts,\n+                        lines_vc,\n+                    );\n+                }\n+                State::StartOfFile => {\n+                    let len = len_between(0, 0, generated_line, generated_column, lines);\n+                    add_unaccounted_chunk_part(\n+                        original_file.clone(),\n+                        len,\n+                        &mut chunk_parts,\n+                        lines_vc,\n+                    );\n+                }\n+            }\n         }\n     }\n     let last_line = lines.len() as u32 - 1;\n     let last_column = lines[last_line as usize].len() as u32;\n-    end_current_token(\n-        lines,\n-        &mut chunk_parts,\n-        &mut state,\n-        &Token::Synthetic(SyntheticToken {\n-            generated_line: last_line,\n-            generated_column: last_column,\n-            guessed_original_file: None,\n-        }),\n-    );\n+\n+    // End the current token at end of file\n+    if let State::InMapping {\n+        ref source,\n+        generated_line,\n+        start_column,\n+        ..\n+    } = state\n+    {\n+        state = end_current_mapping(\n+            source.clone(),\n+            generated_line,\n+            start_column,\n+            last_line,\n+            last_column,\n+            lines,\n+            &mut chunk_parts,\n+            lines_vc,\n+        );\n+    }\n+\n     match state {\n         State::InMapping { .. } => {\n             unreachable!();\n         }\n         State::AfterMapping {\n             source,\n-            current_generated_line,\n+            generated_line,\n             current_generated_column,\n         } => {\n             let len = len_between(\n-                current_generated_line,\n+                generated_line,\n                 current_generated_column,\n                 last_line,\n                 last_column,\n                 lines,\n             );\n-            add_unaccounted_chunk_part(source, len, &mut chunk_parts);\n+            add_unaccounted_chunk_part(source, len, &mut chunk_parts, lines_vc);\n         }\n         State::StartOfFile => {\n-            return unaccounted(asset, content).await;\n+            return unaccounted(asset, content, lines_vc).await;\n         }\n     }\n \n     Ok(Vc::cell(chunk_parts.into_values().collect()))\n }\n \n-async fn self_mapped(asset: Vc<Box<dyn OutputAsset>>, content: &Rope) -> Result<Vc<ChunkParts>> {\n+async fn self_mapped(\n+    asset: Vc<Box<dyn OutputAsset>>,\n+    content: &Rope,\n+    lines: ResolvedVc<FileLinesContent>,\n+) -> Result<Vc<ChunkParts>> {\n     let len = content.len().try_into().unwrap_or(u32::MAX);\n     Ok(Vc::cell(vec![ChunkPart {\n         source: asset.path().to_string().owned().await?,\n         real_size: len,\n         unaccounted_size: 0,\n         ranges: vec![],\n+        lines,\n     }]))\n }\n \n-async fn unaccounted(asset: Vc<Box<dyn OutputAsset>>, content: &Rope) -> Result<Vc<ChunkParts>> {\n+async fn unaccounted(\n+    asset: Vc<Box<dyn OutputAsset>>,\n+    content: &Rope,\n+    lines: ResolvedVc<FileLinesContent>,\n+) -> Result<Vc<ChunkParts>> {\n     let len = content.len().try_into().unwrap_or(u32::MAX);\n     Ok(Vc::cell(vec![ChunkPart {\n         source: asset.path().to_string().owned().await?,\n         real_size: 0,\n         unaccounted_size: len,\n         ranges: vec![],\n+        lines,\n     }]))\n }\n+\n+fn append_content_between(\n+    start_line: u32,\n+    start_column: u32,\n+    end_line: u32,\n+    end_column: u32,\n+    lines: &[FileLine],\n+    out: &mut String,\n+) {\n+    let start_line = start_line.min(lines.len() as u32 - 1);\n+    let end_line = end_line.min(lines.len() as u32 - 1);\n+\n+    let start_column = start_column.min(lines[start_line as usize].len() as u32);\n+    let end_column = if start_line == end_line {\n+        end_column.min(lines[start_line as usize].len() as u32)\n+    } else {\n+        lines[start_line as usize].len() as u32\n+    };\n+\n+    if end_column <= start_column {\n+        return;\n+    }\n+\n+    out.extend(\n+        lines[start_line as usize]\n+            .content\n+            .chars()\n+            .skip(start_column as usize)\n+            .take((end_column - start_column) as usize),\n+    );\n+\n+    if start_line == end_line {\n+        return;\n+    }\n+\n+    for line in &lines[start_line as usize + 1..end_line as usize] {\n+        out.push_str(&line.content);\n+    }\n+\n+    out.extend(\n+        lines[end_line as usize]\n+            .content\n+            .chars()\n+            .take(end_column as usize),\n+    );\n+}"
        },
        {
            "sha": "c71a33cd9b157870303e753cf3ae5edce7647edc",
            "filename": "turbopack/crates/turbopack-analyze/tests/split_chunk.rs",
            "status": "modified",
            "additions": 31,
            "deletions": 28,
            "changes": 59,
            "blob_url": "https://github.com/vercel/next.js/blob/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2Ftests%2Fsplit_chunk.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/ec85895d749b418f05bd4dd529afd34dd360a709/turbopack%2Fcrates%2Fturbopack-analyze%2Ftests%2Fsplit_chunk.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-analyze%2Ftests%2Fsplit_chunk.rs?ref=ec85895d749b418f05bd4dd529afd34dd360a709",
            "patch": "@@ -10,7 +10,7 @@ use turbo_tasks_fs::{\n     File, FileContent, FileSystem, FileSystemPath, VirtualFileSystem, rope::Rope,\n };\n use turbo_tasks_testing::{Registration, register, run_once};\n-use turbopack_analyze::split_chunk::{ChunkPart, ChunkPartRange, split_output_asset_into_parts};\n+use turbopack_analyze::split_chunk::{ChunkPartRange, split_output_asset_into_parts};\n use turbopack_core::{\n     asset::{Asset, AssetContent},\n     code_builder::{Code, CodeBuilder},\n@@ -59,39 +59,42 @@ async fn split_chunk() {\n \n         let parts = split_output_asset_into_parts(asset).await.unwrap();\n \n+        assert_eq!(parts.len(), 2);\n+\n+        assert_eq!(parts[0].source, rcstr!(\"source1.js\"));\n+        assert_eq!(parts[0].real_size, 46);\n+        assert_eq!(parts[0].unaccounted_size, 34);\n         assert_eq!(\n-            &*parts,\n-            &vec![\n-                ChunkPart {\n-                    source: rcstr!(\"source1.js\"),\n-                    real_size: 15,\n-                    unaccounted_size: 51,\n-                    ranges: vec![\n-                        ChunkPartRange {\n-                            line: 2,\n-                            start_column: 0,\n-                            end_column: 12,\n-                        },\n-                        ChunkPartRange {\n-                            line: 3,\n-                            start_column: 0,\n-                            end_column: 3,\n-                        },\n-                    ],\n+            parts[0].ranges,\n+            vec![\n+                ChunkPartRange {\n+                    line: 2,\n+                    start_column: 0,\n+                    end_column: 12\n                 },\n-                ChunkPart {\n-                    source: rcstr!(\"source2.js\"),\n-                    real_size: 31,\n-                    unaccounted_size: 46,\n-                    ranges: vec![ChunkPartRange {\n-                        line: 4,\n-                        start_column: 0,\n-                        end_column: 31,\n-                    }],\n+                ChunkPartRange {\n+                    line: 3,\n+                    start_column: 0,\n+                    end_column: 34\n                 },\n             ]\n         );\n \n+        assert_eq!(parts[1].source, rcstr!(\"source2.js\"));\n+        assert_eq!(parts[1].real_size, 31);\n+        assert_eq!(parts[1].unaccounted_size, 30);\n+        assert_eq!(\n+            parts[1].ranges,\n+            vec![ChunkPartRange {\n+                line: 4,\n+                start_column: 0,\n+                end_column: 31\n+            }]\n+        );\n+\n+        assert_eq!(parts[0].get_compressed_size().await.unwrap(), 43);\n+        assert_eq!(parts[1].get_compressed_size().await.unwrap(), 28);\n+\n         println!(\"{:#?}\", parts);\n         anyhow::Ok(())\n     })"
        }
    ],
    "stats": {
        "total": 1397,
        "additions": 1054,
        "deletions": 343
    }
}