{
    "author": "sokra",
    "message": "Turbopack: include availability hash in the ident of evaluated chunks groups (#84082)\n\n### What?\n\ninclude availability hash in the ident of evaluated chunks groups just like with normal chunk groups",
    "sha": "c0ecece03d5e5f6959200942cf9c8911dbf8adab",
    "files": [
        {
            "sha": "9855556724c1779336baa5a793ee5df2e4c3a1d9",
            "filename": "turbopack/crates/turbopack-browser/src/chunking_context.rs",
            "status": "modified",
            "additions": 17,
            "deletions": 7,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/c0ecece03d5e5f6959200942cf9c8911dbf8adab/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c0ecece03d5e5f6959200942cf9c8911dbf8adab/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs?ref=c0ecece03d5e5f6959200942cf9c8911dbf8adab",
            "patch": "@@ -573,13 +573,13 @@ impl ChunkingContext for BrowserChunkingContext {\n         let span = tracing::info_span!(\"chunking\", name = ident.to_string().await?.to_string());\n         async move {\n             let this = self.await?;\n-            let modules = chunk_group.entries();\n+            let entries = chunk_group.entries();\n             let input_availability_info = availability_info;\n             let MakeChunkGroupResult {\n                 chunks,\n                 availability_info,\n             } = make_chunk_group(\n-                modules,\n+                entries,\n                 module_graph,\n                 ResolvedVc::upcast(self),\n                 input_availability_info,\n@@ -604,11 +604,12 @@ impl ChunkingContext for BrowserChunkingContext {\n                             ident.with_modifier(available_modules.hash().await?.to_string().into());\n                     }\n                 }\n+                let other_assets = Vc::cell(assets.clone());\n                 assets.push(\n                     self.generate_chunk_list_register_chunk(\n                         ident,\n                         EvaluatableAssets::empty(),\n-                        Vc::cell(assets.clone()),\n+                        other_assets,\n                         EcmascriptDevChunkListSource::Dynamic,\n                     )\n                     .to_resolved()\n@@ -632,25 +633,23 @@ impl ChunkingContext for BrowserChunkingContext {\n         ident: Vc<AssetIdent>,\n         chunk_group: ChunkGroup,\n         module_graph: Vc<ModuleGraph>,\n-        availability_info: AvailabilityInfo,\n+        input_availability_info: AvailabilityInfo,\n     ) -> Result<Vc<ChunkGroupResult>> {\n         let span = {\n             let ident = ident.to_string().await?.to_string();\n             tracing::info_span!(\"chunking\", chunking_type = \"evaluated\", ident = ident)\n         };\n         async move {\n             let this = self.await?;\n-\n             let entries = chunk_group.entries();\n-\n             let MakeChunkGroupResult {\n                 chunks,\n                 availability_info,\n             } = make_chunk_group(\n                 entries,\n                 module_graph,\n                 ResolvedVc::upcast(self),\n-                availability_info,\n+                input_availability_info,\n             )\n             .await?;\n \n@@ -673,6 +672,17 @@ impl ChunkingContext for BrowserChunkingContext {\n             );\n \n             if this.enable_hot_module_replacement {\n+                let mut ident = ident;\n+                match input_availability_info {\n+                    AvailabilityInfo::Root => {}\n+                    AvailabilityInfo::Untracked => {\n+                        ident = ident.with_modifier(rcstr!(\"untracked\"));\n+                    }\n+                    AvailabilityInfo::Complete { available_modules } => {\n+                        ident =\n+                            ident.with_modifier(available_modules.hash().await?.to_string().into());\n+                    }\n+                }\n                 assets.push(\n                     self.generate_chunk_list_register_chunk(\n                         ident,"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 17,
        "deletions": 7
    }
}