{
    "author": "unstubbable",
    "message": "Unflake `segment cache (CDN cache busting)` redirect test (#80967)",
    "sha": "bbe2786b5e3d7968380f15c80595a8191afb4a85",
    "files": [
        {
            "sha": "cb35b8952a66ce9e9b924409ac7d00047006172a",
            "filename": "test/e2e/app-dir/segment-cache/router-act.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/bbe2786b5e3d7968380f15c80595a8191afb4a85/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frouter-act.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bbe2786b5e3d7968380f15c80595a8191afb4a85/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frouter-act.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frouter-act.ts?ref=bbe2786b5e3d7968380f15c80595a8191afb4a85",
            "patch": "@@ -375,6 +375,24 @@ Choose a more specific substring to assert on.\n               await browserResponse.finished()\n             }\n           }\n+\n+          if (fulfilled.status === 307 || fulfilled.status === 308) {\n+            // If this was a redirect, give the browser time to follow the\n+            // redirect, before continuing. We do that by waiting for the very\n+            // next request to respond. Otherwise, we might exit early, before\n+            // the request was added to the pending requests set.\n+            await new Promise<void>((resolve) => {\n+              page.once('request', (req) => {\n+                const handleResponse = (res: Playwright.Response) => {\n+                  if (res.url() === req.url()) {\n+                    page.off('response', handleResponse)\n+                    resolve()\n+                  }\n+                }\n+                page.on('response', handleResponse)\n+              })\n+            })\n+          }\n         }\n \n         // After flushing the queue, wait for the microtask queue to be"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 18,
        "deletions": 0
    }
}