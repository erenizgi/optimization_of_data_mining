{
    "author": "timneutkens",
    "message": "Turbopack: Add --turbopack for next start (#77442)\n\nAdds `--turbopack` for `next start` to match `next dev --turbopack` and\n`next build --turbopack`. This is required to boot Turbopack builds\nwhile webpack is still the default because there's some environment\nvariable differences.\n\nInitially wanted to automatically detect Turbopack builds but the\nproblem is that we can write a marker during builds that will tell it's\na Turbopack build but then the environment is not available during\nbootup. So it's a bit of a chicken-egg problem with getting the\nenvironment to know it used Turbopack during build.\n\nWhy is this info needed at runtime? React server components has an\nintegration for every bundler and it needs to load the right version of\nReact for the bundler, that's why it's needed.\n\n<!-- Thanks for opening a PR! Your contribution is much appreciated.\nTo make sure your PR is handled as smoothly as possible we request that\nyou follow the checklist sections below.\nChoose the right checklist for the change(s) that you're making:\n\n## For Contributors\n\n### Improving Documentation\n\n- Run `pnpm prettier-fix` to fix formatting issues before opening the\nPR.\n- Read the Docs Contribution Guide to ensure your contribution follows\nthe docs guidelines:\nhttps://nextjs.org/docs/community/contribution-guide\n\n### Adding or Updating Examples\n\n- The \"examples guidelines\" are followed from our contributing doc\nhttps://github.com/vercel/next.js/blob/canary/contributing/examples/adding-examples.md\n- Make sure the linting passes by running `pnpm build && pnpm lint`. See\nhttps://github.com/vercel/next.js/blob/canary/contributing/repository/linting.md\n\n### Fixing a bug\n\n- Related issues linked using `fixes #number`\n- Tests added. See:\nhttps://github.com/vercel/next.js/blob/canary/contributing/core/testing.md#writing-tests-for-nextjs\n- Errors have a helpful link attached, see\nhttps://github.com/vercel/next.js/blob/canary/contributing.md\n\n### Adding a feature\n\n- Implements an existing feature request or RFC. Make sure the feature\nrequest has been accepted for implementation before opening a PR. (A\ndiscussion must be opened, see\nhttps://github.com/vercel/next.js/discussions/new?category=ideas)\n- Related issues/discussions are linked using `fixes #number`\n- e2e tests added\n(https://github.com/vercel/next.js/blob/canary/contributing/core/testing.md#writing-tests-for-nextjs)\n- Documentation added\n- Telemetry added. In case of a feature if it's used or not.\n- Errors have a helpful link attached, see\nhttps://github.com/vercel/next.js/blob/canary/contributing.md\n\n\n## For Maintainers\n\n- Minimal description (aim for explaining to someone not on the team to\nunderstand the PR)\n- When linking to a Slack thread, you might want to share details of the\nconclusion\n- Link both the Linear (Fixes NEXT-xxx) and the GitHub issues\n- Add review comments if necessary to explain to the reviewer the logic\nbehind a change\n\n### What?\n\n### Why?\n\n### How?\n\nCloses NEXT-\nFixes #\n\n-->",
    "sha": "62ac6d040183d48a5d83d2b197826c0c471caa62",
    "files": [
        {
            "sha": "3fd4af7e93c6364cc42a342f211c5fea0fd1eee9",
            "filename": "packages/next/src/bin/next.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/62ac6d040183d48a5d83d2b197826c0c471caa62/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/62ac6d040183d48a5d83d2b197826c0c471caa62/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts?ref=62ac6d040183d48a5d83d2b197826c0c471caa62",
            "patch": "@@ -129,9 +129,8 @@ program\n   .option('--no-mangling', 'Disables mangling.')\n   .option('--profile', 'Enables production profiling for React.')\n   .option('--experimental-app-only', 'Builds only App Router routes.')\n-  .addOption(new Option('--experimental-turbo').hideHelp())\n-  .addOption(new Option('--turbo').hideHelp())\n-  .addOption(new Option('--turbopack').hideHelp())\n+  .option('--turbo', 'Starts development mode using Turbopack.')\n+  .option('--turbopack', 'Starts development mode using Turbopack.')\n   .addOption(\n     new Option(\n       '--experimental-build-mode [mode]',\n@@ -352,6 +351,8 @@ program\n       'Specify the maximum amount of milliseconds to wait before closing inactive connections.'\n     ).argParser(parseValidPositiveInteger)\n   )\n+  .addOption(new Option('--turbo').hideHelp())\n+  .option('--turbopack', 'Starts development mode using Turbopack.')\n   .action((directory: string, options: NextStartOptions) =>\n     import('../cli/next-start.js').then((mod) =>\n       mod.nextStart(options, directory)"
        },
        {
            "sha": "b433489b76a4c47fd4b96fb925ee4f0137b4f27b",
            "filename": "packages/next/src/cli/next-build.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/62ac6d040183d48a5d83d2b197826c0c471caa62/packages%2Fnext%2Fsrc%2Fcli%2Fnext-build.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/62ac6d040183d48a5d83d2b197826c0c471caa62/packages%2Fnext%2Fsrc%2Fcli%2Fnext-build.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcli%2Fnext-build.ts?ref=62ac6d040183d48a5d83d2b197826c0c471caa62",
            "patch": "@@ -40,9 +40,6 @@ const nextBuild = (options: NextBuildOptions, directory?: string) => {\n     experimentalUploadTrace,\n   } = options\n \n-  const useTurbopack =\n-    options.experimentalTurbo || options.turbo || options.turbopack\n-\n   let traceUploadUrl: string | undefined\n   if (experimentalUploadTrace && !process.env.NEXT_TRACE_UPLOAD_DISABLED) {\n     traceUploadUrl = experimentalUploadTrace\n@@ -75,7 +72,7 @@ const nextBuild = (options: NextBuildOptions, directory?: string) => {\n     printAndExit(`> No such directory exists as the project root: ${dir}`)\n   }\n \n-  if (useTurbopack) {\n+  if (options.turbo || options.turbopack) {\n     process.env.TURBOPACK = '1'\n   }\n "
        },
        {
            "sha": "471b1924066371e987f58f5ef97591e11cd74766",
            "filename": "packages/next/src/cli/next-start.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/62ac6d040183d48a5d83d2b197826c0c471caa62/packages%2Fnext%2Fsrc%2Fcli%2Fnext-start.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/62ac6d040183d48a5d83d2b197826c0c471caa62/packages%2Fnext%2Fsrc%2Fcli%2Fnext-start.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcli%2Fnext-start.ts?ref=62ac6d040183d48a5d83d2b197826c0c471caa62",
            "patch": "@@ -13,6 +13,8 @@ export type NextStartOptions = {\n   port: number\n   hostname?: string\n   keepAliveTimeout?: number\n+  turbo?: boolean\n+  turbopack?: boolean\n }\n \n /**\n@@ -31,6 +33,10 @@ const nextStart = async (options: NextStartOptions, directory?: string) => {\n     printAndExit(getReservedPortExplanation(port), 1)\n   }\n \n+  if (options.turbo || options.turbopack) {\n+    process.env.TURBOPACK = '1'\n+  }\n+\n   await startServer({\n     dir,\n     isDev: false,"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 11,
        "deletions": 7
    }
}