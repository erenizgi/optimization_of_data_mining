{
    "author": "gnoff",
    "message": "Disallow javascript urls in router methods and redirects (#88185)\n\nReact already disallows javascript URLs. This change extends this\nprohibition to Next.js specific APIs that don't serialize to an href on\nan anchor tag. There are workarounds if need be but this is considered a\nbugfix because these URLs are non-routable and the affected APIs were\nnever intended to work with these URLs.\n\nThis replaces prior efforts here:\nhttps://github.com/vercel/next.js/pull/64779/ which attempted to make\nthis capability optional. We decided it was just not supportable and\nsince workarounds exist the burden of upgrading through this bugfix is\nacceptable.\n\n---------\n\nCo-authored-by: Zack Tanner <1939140+ztanner@users.noreply.github.com>",
    "sha": "69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
    "files": [
        {
            "sha": "3523f392adad6783b75e2968990cd76447e44563",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -975,5 +975,6 @@\n   \"974\": \"Failed to find Server Action%s. This request might be from an older or newer deployment.\\\\nRead more: https://nextjs.org/docs/messages/failed-to-find-server-action\",\n   \"975\": \"Failed to find Server Action. This request might be from an older or newer deployment.\\\\nRead more: https://nextjs.org/docs/messages/failed-to-find-server-action\",\n   \"976\": \"Decompressed resume data cache exceeded %s byte limit\",\n-  \"977\": \"maxPostponedStateSize must be a valid number (bytes) or filesize format string (e.g., \\\"5mb\\\")\"\n+  \"977\": \"maxPostponedStateSize must be a valid number (bytes) or filesize format string (e.g., \\\"5mb\\\")\",\n+  \"978\": \"Next.js has blocked a javascript: URL as a security precaution.\"\n }"
        },
        {
            "sha": "3ad19da1222e002371510d272046ef9494ee156f",
            "filename": "packages/next/src/client/app-dir/link.tsx",
            "status": "modified",
            "additions": 32,
            "deletions": 25,
            "changes": 57,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fapp-dir%2Flink.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -239,7 +239,6 @@ function isModifiedEvent(event: React.MouseEvent): boolean {\n function linkClicked(\n   e: React.MouseEvent,\n   href: string,\n-  as: string,\n   linkInstanceRef: React.RefObject<LinkInstance | null>,\n   replace?: boolean,\n   scroll?: boolean,\n@@ -291,7 +290,7 @@ function linkClicked(\n \n     React.startTransition(() => {\n       dispatchNavigateAction(\n-        as || href,\n+        href,\n         replace ? 'replace' : 'push',\n         scroll ?? true,\n         linkInstanceRef.current\n@@ -483,6 +482,9 @@ export default function LinkComponent(\n     })\n   }\n \n+  const resolvedHref = asProp || hrefProp\n+  const formattedHref = formatStringOrUrl(resolvedHref)\n+\n   if (process.env.NODE_ENV !== 'production') {\n     if (props.locale) {\n       warnOnce(\n@@ -491,13 +493,13 @@ export default function LinkComponent(\n     }\n     if (!asProp) {\n       let href: string | undefined\n-      if (typeof hrefProp === 'string') {\n-        href = hrefProp\n+      if (typeof resolvedHref === 'string') {\n+        href = resolvedHref\n       } else if (\n-        typeof hrefProp === 'object' &&\n-        typeof hrefProp.pathname === 'string'\n+        typeof resolvedHref === 'object' &&\n+        typeof resolvedHref.pathname === 'string'\n       ) {\n-        href = hrefProp.pathname\n+        href = resolvedHref.pathname\n       }\n \n       if (href) {\n@@ -514,14 +516,6 @@ export default function LinkComponent(\n     }\n   }\n \n-  const { href, as } = React.useMemo(() => {\n-    const resolvedHref = formatStringOrUrl(hrefProp)\n-    return {\n-      href: resolvedHref,\n-      as: asProp ? formatStringOrUrl(asProp) : resolvedHref,\n-    }\n-  }, [hrefProp, asProp])\n-\n   // This will return the first child, if multiple are provided it will throw an error\n   let child: any\n   if (legacyBehavior) {\n@@ -534,24 +528,24 @@ export default function LinkComponent(\n     if (process.env.NODE_ENV === 'development') {\n       if (onClick) {\n         console.warn(\n-          `\"onClick\" was passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but \"legacyBehavior\" was set. The legacy behavior requires onClick be set on the child of next/link`\n+          `\"onClick\" was passed to <Link> with \\`href\\` of \\`${formattedHref}\\` but \"legacyBehavior\" was set. The legacy behavior requires onClick be set on the child of next/link`\n         )\n       }\n       if (onMouseEnterProp) {\n         console.warn(\n-          `\"onMouseEnter\" was passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but \"legacyBehavior\" was set. The legacy behavior requires onMouseEnter be set on the child of next/link`\n+          `\"onMouseEnter\" was passed to <Link> with \\`href\\` of \\`${formattedHref}\\` but \"legacyBehavior\" was set. The legacy behavior requires onMouseEnter be set on the child of next/link`\n         )\n       }\n       try {\n         child = React.Children.only(children)\n       } catch (err) {\n         if (!children) {\n           throw new Error(\n-            `No children were passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but one child is required https://nextjs.org/docs/messages/link-no-children`\n+            `No children were passed to <Link> with \\`href\\` of \\`${formattedHref}\\` but one child is required https://nextjs.org/docs/messages/link-no-children`\n           )\n         }\n         throw new Error(\n-          `Multiple children were passed to <Link> with \\`href\\` of \\`${hrefProp}\\` but only one child is supported https://nextjs.org/docs/messages/link-multiple-children` +\n+          `Multiple children were passed to <Link> with \\`href\\` of \\`${formattedHref}\\` but only one child is supported https://nextjs.org/docs/messages/link-multiple-children` +\n             (typeof window !== 'undefined'\n               ? \" \\nOpen your browser's console to view the Component stack trace.\"\n               : '')\n@@ -583,7 +577,7 @@ export default function LinkComponent(\n       if (router !== null) {\n         linkInstanceRef.current = mountLinkInstance(\n           element,\n-          href,\n+          formattedHref,\n           router,\n           fetchStrategy,\n           prefetchEnabled,\n@@ -599,7 +593,13 @@ export default function LinkComponent(\n         unmountPrefetchableInstance(element)\n       }\n     },\n-    [prefetchEnabled, href, router, fetchStrategy, setOptimisticLinkStatus]\n+    [\n+      prefetchEnabled,\n+      formattedHref,\n+      router,\n+      fetchStrategy,\n+      setOptimisticLinkStatus,\n+    ]\n   )\n \n   const mergedRef = useMergedRef(observeLinkVisibilityOnMount, childRef)\n@@ -639,7 +639,14 @@ export default function LinkComponent(\n       if (e.defaultPrevented) {\n         return\n       }\n-      linkClicked(e, href, as, linkInstanceRef, replace, scroll, onNavigate)\n+      linkClicked(\n+        e,\n+        formattedHref,\n+        linkInstanceRef,\n+        replace,\n+        scroll,\n+        onNavigate\n+      )\n     },\n     onMouseEnter(e) {\n       if (!legacyBehavior && typeof onMouseEnterProp === 'function') {\n@@ -698,14 +705,14 @@ export default function LinkComponent(\n   }\n \n   // If the url is absolute, we can bypass the logic to prepend the basePath.\n-  if (isAbsoluteUrl(as)) {\n-    childProps.href = as\n+  if (isAbsoluteUrl(formattedHref)) {\n+    childProps.href = formattedHref\n   } else if (\n     !legacyBehavior ||\n     passHref ||\n     (child.type === 'a' && !('href' in child.props))\n   ) {\n-    childProps.href = addBasePath(as)\n+    childProps.href = addBasePath(formattedHref)\n   }\n \n   let link: React.ReactNode"
        },
        {
            "sha": "01ed832c2f09f3b429ffd182aff5d5fe7c691ce9",
            "filename": "packages/next/src/client/components/app-router-instance.ts",
            "status": "modified",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router-instance.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router-instance.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router-instance.ts?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -30,6 +30,7 @@ import type {\n import { setLinkForCurrentNavigation, type LinkInstance } from './links'\n import type { ClientInstrumentationHooks } from '../app-index'\n import type { GlobalErrorComponent } from './builtin/global-error'\n+import { isJavaScriptURLString } from '../lib/javascript-url'\n \n export type DispatchStatePromise = React.Dispatch<ReducerState>\n \n@@ -325,6 +326,11 @@ export const publicAppRouterInstance: AppRouterInstance = {\n     // data in the router reducer state; it writes into a global mutable\n     // cache. So we don't need to dispatch an action.\n     (href: string, options?: PrefetchOptions) => {\n+      if (isJavaScriptURLString(href)) {\n+        throw new Error(\n+          'Next.js has blocked a javascript: URL as a security precaution.'\n+        )\n+      }\n       const actionQueue = getAppRouterActionQueue()\n       const prefetchKind = options?.kind ?? PrefetchKind.AUTO\n \n@@ -360,11 +366,21 @@ export const publicAppRouterInstance: AppRouterInstance = {\n       )\n     },\n   replace: (href: string, options?: NavigateOptions) => {\n+    if (isJavaScriptURLString(href)) {\n+      throw new Error(\n+        'Next.js has blocked a javascript: URL as a security precaution.'\n+      )\n+    }\n     startTransition(() => {\n       dispatchNavigateAction(href, 'replace', options?.scroll ?? true, null)\n     })\n   },\n   push: (href: string, options?: NavigateOptions) => {\n+    if (isJavaScriptURLString(href)) {\n+      throw new Error(\n+        'Next.js has blocked a javascript: URL as a security precaution.'\n+      )\n+    }\n     startTransition(() => {\n       dispatchNavigateAction(href, 'push', options?.scroll ?? true, null)\n     })"
        },
        {
            "sha": "37f72594686840c128f6d08bddc07070c2c08f87",
            "filename": "packages/next/src/client/components/router-reducer/reducers/navigate-reducer.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fnavigate-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fnavigate-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Frouter-reducer%2Freducers%2Fnavigate-reducer.ts?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -18,6 +18,7 @@ import {\n import { NavigationResultTag } from '../../segment-cache/types'\n import { getStaleTimeMs } from '../../segment-cache/cache'\n import { FreshnessPolicy } from '../ppr-navigations'\n+import { isJavaScriptURLString } from '../../../lib/javascript-url'\n \n // These values are set by `define-env-plugin` (based on `nextConfig.experimental.staleTimes`)\n // and default to 5 minutes (static) / 0 seconds (dynamic)\n@@ -34,6 +35,13 @@ export function handleExternalUrl(\n   url: string,\n   pendingPush: boolean\n ) {\n+  if (isJavaScriptURLString(url)) {\n+    console.error(\n+      'Next.js has blocked a javascript: URL as a security precaution.'\n+    )\n+    return handleMutable(state, mutable)\n+  }\n+\n   mutable.mpaNavigation = true\n   mutable.canonicalUrl = url\n   mutable.pendingPush = pendingPush"
        },
        {
            "sha": "82fc4163d15f047bf1ce8e1cdb40899593ca69ec",
            "filename": "packages/next/src/client/lib/javascript-url.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fclient%2Flib%2Fjavascript-url.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fclient%2Flib%2Fjavascript-url.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Flib%2Fjavascript-url.ts?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,18 @@\n+// Adapted from React's sanitizeURL function found here: https://github.com/facebook/react/blob/b565373afd0cc1988497e1107106e851e8cfb261/packages/react-dom-bindings/src/shared/sanitizeURL.js\n+\n+// A javascript: URL can contain leading C0 control or \\u0020 SPACE,\n+// and any newline or tab are filtered out as if they're not part of the URL.\n+// https://url.spec.whatwg.org/#url-parsing\n+// Tab or newline are defined as \\r\\n\\t:\n+// https://infra.spec.whatwg.org/#ascii-tab-or-newline\n+// A C0 control is a code point in the range \\u0000 NULL to \\u001F\n+// INFORMATION SEPARATOR ONE, inclusive:\n+// https://infra.spec.whatwg.org/#c0-control-or-space\n+\n+const isJavaScriptProtocol =\n+  // eslint-disable-next-line no-control-regex\n+  /^[\\u0000-\\u001F ]*j[\\r\\n\\t]*a[\\r\\n\\t]*v[\\r\\n\\t]*a[\\r\\n\\t]*s[\\r\\n\\t]*c[\\r\\n\\t]*r[\\r\\n\\t]*i[\\r\\n\\t]*p[\\r\\n\\t]*t[\\r\\n\\t]*:/i\n+\n+export function isJavaScriptURLString(url: string): boolean {\n+  return isJavaScriptProtocol.test('' + (url as unknown as string))\n+}"
        },
        {
            "sha": "a1de56880c039a2d99e7c33ad128a21dba221fe1",
            "filename": "packages/next/src/shared/lib/router/router.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Frouter.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Frouter.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Frouter.ts?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -44,6 +44,7 @@ import { disableSmoothScrollDuringRouteTransition } from './utils/disable-smooth\n import type { Params } from '../../../server/request/params'\n import { MATCHED_PATH_HEADER } from '../../../lib/constants'\n import { getDeploymentId } from '../deployment-id'\n+import { isJavaScriptURLString } from '../../../client/lib/javascript-url'\n \n let resolveRewrites: typeof import('./utils/resolve-rewrites').default\n if (process.env.__NEXT_HAS_REWRITES) {\n@@ -995,6 +996,14 @@ export default class Router implements BaseRouter {\n    * @param options object you can define `shallow` and other options\n    */\n   push(url: Url, as?: Url, options: TransitionOptions = {}) {\n+    if (\n+      isJavaScriptURLString(url.toString()) ||\n+      (as && isJavaScriptURLString(as.toString()))\n+    ) {\n+      throw new Error(\n+        'Next.js has blocked a javascript: URL as a security precaution.'\n+      )\n+    }\n     if (process.env.__NEXT_SCROLL_RESTORATION) {\n       // TODO: remove in the future when we update history before route change\n       // is complete, as the popstate event should handle this capture.\n@@ -1019,6 +1028,14 @@ export default class Router implements BaseRouter {\n    * @param options object you can define `shallow` and other options\n    */\n   replace(url: Url, as?: Url, options: TransitionOptions = {}) {\n+    if (\n+      isJavaScriptURLString(url.toString()) ||\n+      (as && isJavaScriptURLString(as.toString()))\n+    ) {\n+      throw new Error(\n+        'Next.js has blocked a javascript: URL as a security precaution.'\n+      )\n+    }\n     ;({ url, as } = prepareUrlAs(this, url, as))\n     return this.change('replaceState', url, as, options)\n   }"
        },
        {
            "sha": "e370af1e4618850975f10f175beff3b90c78deba",
            "filename": "test/e2e/app-dir/javascript-urls/app/app/action-redirect-form/page.tsx",
            "status": "added",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Faction-redirect-form%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Faction-redirect-form%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Faction-redirect-form%2Fpage.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,23 @@\n+import { redirect } from 'next/navigation'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../../bad-url'\n+\n+async function handleRedirect() {\n+  'use server'\n+  redirect(DANGEROUS_JAVASCRIPT_URL)\n+}\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <p>\n+        Clicking this button should result in an error where Next.js blocks a\n+        javascript URL through a server action redirect initiated by an onClick\n+        handler\n+      </p>\n+      <form action={handleRedirect}>\n+        <button type=\"submit\">redirect via form action</button>\n+      </form>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "6fb9a129e15f8c6f733d42dc1b5a8acba857cc6a",
            "filename": "test/e2e/app-dir/javascript-urls/app/app/action-redirect-onclick/page.tsx",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Faction-redirect-onclick%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Faction-redirect-onclick%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Faction-redirect-onclick%2Fpage.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,21 @@\n+import { redirect } from 'next/navigation'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../../bad-url'\n+\n+async function handleRedirect() {\n+  'use server'\n+  redirect(DANGEROUS_JAVASCRIPT_URL)\n+}\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <p>\n+        Clicking this button should result in an error where Next.js blocks a\n+        javascript URL through a server action redirect initiated by an onClick\n+        handler\n+      </p>\n+      <button onClick={handleRedirect}>redirect via onclick action</button>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "6876bd038d7b8cc4d6b98105f686715add6799ba",
            "filename": "test/e2e/app-dir/javascript-urls/app/app/link-as/page.tsx",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Flink-as%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Flink-as%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Flink-as%2Fpage.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,18 @@\n+import Link from 'next/link'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../../bad-url'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <p>\n+        Clicking this link should result in an error where React blocks a\n+        javascript URL\n+      </p>\n+      {/* In App Router as supercedes href but functionally it acts just like an href */}\n+      <Link href=\"/\" as={DANGEROUS_JAVASCRIPT_URL}>\n+        Link with javascript URL `as`\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "9a3b4fc88b3960a9e9fe65ea37cf6bb22c921243",
            "filename": "test/e2e/app-dir/javascript-urls/app/app/link-href/page.tsx",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Flink-href%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Flink-href%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Flink-href%2Fpage.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,17 @@\n+import Link from 'next/link'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../../bad-url'\n+\n+export default function Page() {\n+  return (\n+    <>\n+      <p>\n+        Clicking this link should result in an error where React blocks a\n+        javascript URL\n+      </p>\n+      <Link href={DANGEROUS_JAVASCRIPT_URL}>\n+        Link with javascript URL `href`\n+      </Link>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "e1f0ac57b7266e3c840aeb0b393e14cc5a0ae80f",
            "filename": "test/e2e/app-dir/javascript-urls/app/app/router-prefetch/page.tsx",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Frouter-prefetch%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Frouter-prefetch%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Frouter-prefetch%2Fpage.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,20 @@\n+'use client'\n+\n+import { useRouter } from 'next/navigation'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../../bad-url'\n+\n+export default function Page() {\n+  const router = useRouter()\n+  return (\n+    <>\n+      <p>\n+        Clicking this button should result in an error where Next.js blocks a\n+        javascript URL\n+      </p>\n+      <button onClick={() => router.prefetch(DANGEROUS_JAVASCRIPT_URL)}>\n+        prefetch javascript URL\n+      </button>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "7aa075404fb3cec5facf6219d609a0f69e622148",
            "filename": "test/e2e/app-dir/javascript-urls/app/app/router-push/page.tsx",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Frouter-push%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Frouter-push%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Frouter-push%2Fpage.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,20 @@\n+'use client'\n+\n+import { useRouter } from 'next/navigation'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../../bad-url'\n+\n+export default function Page() {\n+  const router = useRouter()\n+  return (\n+    <>\n+      <p>\n+        Clicking this button should result in an error where Next.js blocks a\n+        javascript URL\n+      </p>\n+      <button onClick={() => router.push(DANGEROUS_JAVASCRIPT_URL)}>\n+        push javascript URL\n+      </button>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "c75d03db9896b605534885a866252032e0c28404",
            "filename": "test/e2e/app-dir/javascript-urls/app/app/router-replace/page.tsx",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Frouter-replace%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Frouter-replace%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Frouter-replace%2Fpage.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,20 @@\n+'use client'\n+\n+import { useRouter } from 'next/navigation'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../../bad-url'\n+\n+export default function Page() {\n+  const router = useRouter()\n+  return (\n+    <>\n+      <p>\n+        Clicking this button should result in an error where Next.js blocks a\n+        javascript URL\n+      </p>\n+      <button onClick={() => router.replace(DANGEROUS_JAVASCRIPT_URL)}>\n+        replace javascript URL\n+      </button>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "393610e034b79d862ca19ec44de50a213599ae7a",
            "filename": "test/e2e/app-dir/javascript-urls/app/app/safe/page.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Fsafe%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Fsafe%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fapp%2Fsafe%2Fpage.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,10 @@\n+export default function Page() {\n+  return (\n+    <>\n+      <p id=\"canarv\">\n+        This page is used as a navigation target to ensure SPA navigation\n+        continues to work after pushing/redirecting/linking to a javascript URL.\n+      </p>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "f41a4833f2a67fd590fa07f9941e8d1b15082988",
            "filename": "test/e2e/app-dir/javascript-urls/app/boom/page.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fboom%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fboom%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Fboom%2Fpage.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,10 @@\n+export default function Page() {\n+  return (\n+    <>\n+      <p id=\"pwned\">\n+        If you were redirected here then the dangerous javascript URL was\n+        followed.\n+      </p>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "daaac0afd34bc65fd3382fd81ae11e646c6d78c4",
            "filename": "test/e2e/app-dir/javascript-urls/app/layout.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fapp%2Flayout.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,12 @@\n+import Link from 'next/link'\n+\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>\n+        <main>{children}</main>\n+        <Link href=\"/app/safe\">Safe Page</Link>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "cb5c7ac990789732a6cb16232f26877aa3a56df9",
            "filename": "test/e2e/app-dir/javascript-urls/bad-url.ts",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fbad-url.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fbad-url.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fbad-url.ts?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,3 @@\n+export const DANGEROUS_JAVASCRIPT_URL =\n+  // eslint-disable-next-line no-script-url\n+  \"javascript:window.location.assign('/boom');\""
        },
        {
            "sha": "bf2e84babc58b60246f94b245c17dcb5215f6f11",
            "filename": "test/e2e/app-dir/javascript-urls/javascript-urls.test.ts",
            "status": "added",
            "additions": 389,
            "deletions": 0,
            "changes": 389,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fjavascript-urls.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fjavascript-urls.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fjavascript-urls.test.ts?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,389 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import {\n+  getRedboxDescription,\n+  retry,\n+  waitForNoRedbox,\n+  waitForRedbox,\n+} from 'next-test-utils'\n+import type { Page, Request } from 'playwright'\n+\n+describe('javascript-urls', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  /**\n+   * Creates a beforePageLoad handler that intercepts navigation requests\n+   * and tracks them for later assertion.\n+   */\n+  function createNavigationInterceptor() {\n+    const navigationRequests: Request[] = []\n+\n+    const beforePageLoad = (page: Page) => {\n+      page.on('request', (request) => {\n+        if (request.resourceType() === 'document') {\n+          navigationRequests.push(request)\n+        }\n+      })\n+    }\n+\n+    const getNavigationRequests = () => navigationRequests\n+\n+    return { beforePageLoad, getNavigationRequests }\n+  }\n+\n+  /**\n+   * Helper to test that a javascript: URL is blocked.\n+   * Waits for the security error to appear in logs (confirming the click was processed),\n+   * then asserts no navigation requests were made.\n+   */\n+  async function expectJavascriptUrlBlocked(\n+    browser: Awaited<ReturnType<typeof next.browser>>,\n+    initialUrl: string,\n+    getNavigationRequests: () => Request[]\n+  ) {\n+    const errorMessage =\n+      'has blocked a javascript: URL as a security precaution.'\n+    // Wait for the security error to appear in logs, confirming the click was processed\n+    await retry(async () => {\n+      const logs = await browser.log()\n+      const errors = logs.filter(\n+        (log) => log.source === 'error' && log.message.includes(errorMessage)\n+      )\n+      expect(errors.length).toBeGreaterThan(0)\n+    })\n+\n+    // Verify no navigation requests were made after the initial page load\n+    const navRequests = getNavigationRequests()\n+    const postLoadNavigations = navRequests.filter(\n+      (req) => !req.url().includes(new URL(initialUrl).pathname)\n+    )\n+    expect(postLoadNavigations).toHaveLength(0)\n+\n+    // Verify URL hasn't changed\n+    const finalUrl = await browser.url()\n+    expect(finalUrl).toBe(initialUrl)\n+  }\n+\n+  it('should prevent javascript URLs in link `href`', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/app/link-href', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('a').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/app/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/app/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/app/safe')\n+  })\n+\n+  it('should prevent javascript URLs in link `as`', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/app/link-as', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('a').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/app/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/app/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/app/safe')\n+  })\n+\n+  it('should prevent javascript URLs in route.push', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/app/router-push', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('button').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/app/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/app/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/app/safe')\n+  })\n+\n+  it('should prevent javascript URLs in route.replace', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/app/router-replace', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('button').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/app/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/app/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/app/safe')\n+  })\n+\n+  it('should prevent javascript URLs in route.prefetch', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/app/router-prefetch', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('button').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/app/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/app/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/app/safe')\n+  })\n+\n+  it('should prevent javascript URLs in server action redirect through onClick', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/app/action-redirect-onclick', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('button').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/app/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/app/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/app/safe')\n+  })\n+\n+  it('should prevent javascript URLs in server action redirect through form action', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/app/action-redirect-form', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('button').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/app/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/app/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/app/safe')\n+  })\n+\n+  it('should prevent javascript URLs in pages router Link component', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/pages/link-href', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('a').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    if (isNextDev) {\n+      await waitForRedbox(browser)\n+      expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n+        `\"React has blocked a javascript: URL as a security precaution.\"`\n+      )\n+      browser.keydown('Escape')\n+      await waitForNoRedbox(browser)\n+    }\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/pages/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/pages/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/pages/safe')\n+  })\n+\n+  it('should prevent javascript URLs in pages router Link as prop', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/pages/link-as', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('a').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    if (isNextDev) {\n+      await waitForRedbox(browser)\n+      expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n+        `\"Next.js has blocked a javascript: URL as a security precaution.\"`\n+      )\n+      browser.keydown('Escape')\n+      await waitForNoRedbox(browser)\n+    }\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/pages/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/pages/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/pages/safe')\n+  })\n+\n+  it('should prevent javascript URLs in pages router router.push', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/pages/router-push', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('button').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    if (isNextDev) {\n+      await waitForRedbox(browser)\n+      expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n+        `\"Next.js has blocked a javascript: URL as a security precaution.\"`\n+      )\n+      browser.keydown('Escape')\n+      await waitForNoRedbox(browser)\n+    }\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/pages/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/pages/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/pages/safe')\n+  })\n+\n+  it('should prevent javascript URLs in pages router router.replace', async () => {\n+    const { beforePageLoad, getNavigationRequests } =\n+      createNavigationInterceptor()\n+\n+    const browser = await next.browser('/pages/router-replace', {\n+      pushErrorAsConsoleLog: true,\n+      beforePageLoad,\n+    })\n+    const initialUrl = await browser.url()\n+\n+    await browser.elementByCss('button').click()\n+\n+    await expectJavascriptUrlBlocked(browser, initialUrl, getNavigationRequests)\n+\n+    if (isNextDev) {\n+      await waitForRedbox(browser)\n+      expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n+        `\"Next.js has blocked a javascript: URL as a security precaution.\"`\n+      )\n+      browser.keydown('Escape')\n+      await waitForNoRedbox(browser)\n+    }\n+\n+    // Click the safe page link\n+    await browser.elementByCss('a[href=\"/pages/safe\"]').click()\n+\n+    // Wait for navigation to complete\n+    await browser.waitForCondition(\n+      'window.location.pathname.includes(\"/pages/safe\")'\n+    )\n+\n+    const safePageUrl = await browser.url()\n+    expect(safePageUrl).toContain('/pages/safe')\n+  })\n+})"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/e2e/app-dir/javascript-urls/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fnext.config.js?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "7a15b01608e27f29b3c4c8ef5f403edbc9bb03fd",
            "filename": "test/e2e/app-dir/javascript-urls/pages/pages/link-as.tsx",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-as.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-as.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-as.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,24 @@\n+import Link from 'next/link'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../bad-url'\n+\n+export default function Page() {\n+  return (\n+    <html>\n+      <body>\n+        <main>\n+          <p>\n+            Clicking this link should result in an error where React blocks a\n+            javascript URL\n+          </p>\n+          <Link href=\"/\" as={DANGEROUS_JAVASCRIPT_URL}>\n+            Link with javascript URL `as`\n+          </Link>\n+        </main>\n+        <footer>\n+          <Link href=\"/pages/safe\">Safe Page</Link>\n+        </footer>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "b7252bd5e8650272067cbf98f7c9915bb9ba5de8",
            "filename": "test/e2e/app-dir/javascript-urls/pages/pages/link-href.tsx",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-href.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-href.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Flink-href.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,24 @@\n+import Link from 'next/link'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../bad-url'\n+\n+export default function Page() {\n+  return (\n+    <html>\n+      <body>\n+        <main>\n+          <p>\n+            Clicking this link should result in an error where React blocks a\n+            javascript URL\n+          </p>\n+          <Link href={DANGEROUS_JAVASCRIPT_URL}>\n+            Link with javascript URL `href`\n+          </Link>\n+        </main>\n+        <footer>\n+          <Link href=\"/pages/safe\">Safe Page</Link>\n+        </footer>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "b0f397b5ae1f629a3f0498b673bf72dffe3491fe",
            "filename": "test/e2e/app-dir/javascript-urls/pages/pages/router-push.tsx",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-push.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-push.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-push.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,26 @@\n+import Link from 'next/link'\n+import { useRouter } from 'next/router'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../bad-url'\n+\n+export default function Page() {\n+  const router = useRouter()\n+  return (\n+    <html>\n+      <body>\n+        <main>\n+          <p>\n+            Clicking this button should result in an error where Next.js blocks\n+            a javascript URL\n+          </p>\n+          <button onClick={() => router.push(DANGEROUS_JAVASCRIPT_URL)}>\n+            push javascript URL\n+          </button>\n+        </main>\n+        <footer>\n+          <Link href=\"/pages/safe\">Safe Page</Link>\n+        </footer>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "b917b5d9e66f2d4c1e2878e0783935f941761175",
            "filename": "test/e2e/app-dir/javascript-urls/pages/pages/router-replace.tsx",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-replace.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-replace.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Frouter-replace.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,26 @@\n+import Link from 'next/link'\n+import { useRouter } from 'next/router'\n+\n+import { DANGEROUS_JAVASCRIPT_URL } from '../../bad-url'\n+\n+export default function Page() {\n+  const router = useRouter()\n+  return (\n+    <html>\n+      <body>\n+        <main>\n+          <p>\n+            Clicking this button should result in an error where Next.js blocks\n+            a javascript URL\n+          </p>\n+          <button onClick={() => router.replace(DANGEROUS_JAVASCRIPT_URL)}>\n+            replace javascript URL\n+          </button>\n+        </main>\n+        <footer>\n+          <Link href=\"/pages/safe\">Safe Page</Link>\n+        </footer>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "e074bcd359e823a5482ba458f606c7931e095963",
            "filename": "test/e2e/app-dir/javascript-urls/pages/pages/safe.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Fsafe.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Fsafe.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fjavascript-urls%2Fpages%2Fpages%2Fsafe.tsx?ref=69d9d2909c6ed4e3860c7f58bebdad381f2fb1e1",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Page() {\n+  return (\n+    <p id=\"canarv\">\n+      This page is used as a navigation target to ensure SPA navigation\n+      continues to work after pushing/redirecting/linking to a javascript URL.\n+    </p>\n+  )\n+}"
        }
    ],
    "stats": {
        "total": 796,
        "additions": 770,
        "deletions": 26
    }
}