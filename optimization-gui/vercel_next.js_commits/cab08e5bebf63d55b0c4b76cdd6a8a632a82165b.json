{
    "author": "sokra",
    "message": "Turbopack: handle non-serializable cell content for cell update operation (#86861)\n\n### What?\n\nA `TypedSharedReference` might not be serializable, so we might not be able to serialize the UpdateCellOperation. This avoids the suspend points while we store non-serializable content.",
    "sha": "cab08e5bebf63d55b0c4b76cdd6a8a632a82165b",
    "files": [
        {
            "sha": "56b9f29fa2df4fe79874207cb889d69ece012c91",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/operation/update_cell.rs",
            "status": "modified",
            "additions": 18,
            "deletions": 1,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/cab08e5bebf63d55b0c4b76cdd6a8a632a82165b/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fupdate_cell.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cab08e5bebf63d55b0c4b76cdd6a8a632a82165b/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fupdate_cell.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fupdate_cell.rs?ref=cab08e5bebf63d55b0c4b76cdd6a8a632a82165b",
            "patch": "@@ -165,12 +165,29 @@ impl UpdateCellOperation {\n             in_progress.event.notify(usize::MAX);\n         }\n     }\n+\n+    fn is_serializable(&self) -> bool {\n+        match self {\n+            UpdateCellOperation::InvalidateWhenCellDependency {\n+                is_serializable_cell_content,\n+                ..\n+            } => *is_serializable_cell_content,\n+            UpdateCellOperation::FinalCellChange {\n+                is_serializable_cell_content,\n+                ..\n+            } => *is_serializable_cell_content,\n+            UpdateCellOperation::AggregationUpdate { .. } => true,\n+            UpdateCellOperation::Done => true,\n+        }\n+    }\n }\n \n impl Operation for UpdateCellOperation {\n     fn execute(mut self, ctx: &mut impl ExecuteContext) {\n         loop {\n-            ctx.operation_suspend_point(&self);\n+            if self.is_serializable() {\n+                ctx.operation_suspend_point(&self);\n+            }\n             match self {\n                 UpdateCellOperation::InvalidateWhenCellDependency {\n                     is_serializable_cell_content,"
        }
    ],
    "stats": {
        "total": 19,
        "additions": 18,
        "deletions": 1
    }
}