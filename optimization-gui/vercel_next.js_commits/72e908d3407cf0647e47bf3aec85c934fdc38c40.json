{
    "author": "eps1lon",
    "message": "[dev-overlay] Disable error feedback in UI if `NEXT_TELEMETRY_DISABLED` is set (#76423)",
    "sha": "72e908d3407cf0647e47bf3aec85c934fdc38c40",
    "files": [
        {
            "sha": "38386cdb475e27bf17fc6cb9425a4f4ae0f40414",
            "filename": "packages/next/src/build/webpack/plugins/define-env-plugin.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/72e908d3407cf0647e47bf3aec85c934fdc38c40/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/72e908d3407cf0647e47bf3aec85c934fdc38c40/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fdefine-env-plugin.ts?ref=72e908d3407cf0647e47bf3aec85c934fdc38c40",
            "patch": "@@ -275,6 +275,9 @@ export function getDefineEnv({\n     'process.env.__NEXT_ASSET_PREFIX': config.assetPrefix,\n     'process.env.__NEXT_EXPERIMENTAL_AUTH_INTERRUPTS':\n       !!config.experimental.authInterrupts,\n+    'process.env.__NEXT_TELEMETRY_DISABLED': Boolean(\n+      process.env.NEXT_TELEMETRY_DISABLED\n+    ),\n     ...(isNodeOrEdgeCompilation\n       ? {\n           // Fix bad-actors in the npm ecosystem (e.g. `node-formidable`)"
        },
        {
            "sha": "77bd926dd4b0aeb777d9a5178c6ad5548c902468",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay-footer/error-feedback/error-feedback.tsx",
            "status": "modified",
            "additions": 16,
            "deletions": 3,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/72e908d3407cf0647e47bf3aec85c934fdc38c40/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-footer%2Ferror-feedback%2Ferror-feedback.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/72e908d3407cf0647e47bf3aec85c934fdc38c40/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-footer%2Ferror-feedback%2Ferror-feedback.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-footer%2Ferror-feedback%2Ferror-feedback.tsx?ref=72e908d3407cf0647e47bf3aec85c934fdc38c40",
            "patch": "@@ -11,6 +11,7 @@ export function ErrorFeedback({ errorCode, className }: ErrorFeedbackProps) {\n   const [votedMap, setVotedMap] = useState<Record<string, boolean>>({})\n   const voted = votedMap[errorCode]\n   const hasVoted = voted !== undefined\n+  const disabled = process.env.__NEXT_TELEMETRY_DISABLED\n \n   const handleFeedback = useCallback(\n     async (wasHelpful: boolean) => {\n@@ -63,17 +64,29 @@ export function ErrorFeedback({ errorCode, className }: ErrorFeedbackProps) {\n             </a>\n           </p>\n           <button\n+            aria-disabled={disabled ? 'true' : undefined}\n             aria-label=\"Mark as helpful\"\n-            onClick={() => handleFeedback(true)}\n+            onClick={disabled ? undefined : () => handleFeedback(true)}\n             className={cx('feedback-button', voted === true && 'voted')}\n+            title={\n+              disabled\n+                ? 'Feedback disabled due to setting NEXT_TELEMETRY_DISABLED'\n+                : undefined\n+            }\n             type=\"button\"\n           >\n             <ThumbsUp aria-hidden=\"true\" />\n           </button>\n           <button\n+            aria-disabled={disabled ? 'true' : undefined}\n             aria-label=\"Mark as not helpful\"\n-            onClick={() => handleFeedback(false)}\n+            onClick={disabled ? undefined : () => handleFeedback(false)}\n             className={cx('feedback-button', voted === false && 'voted')}\n+            title={\n+              disabled\n+                ? 'Feedback disabled due to setting NEXT_TELEMETRY_DISABLED'\n+                : undefined\n+            }\n             type=\"button\"\n           >\n             <ThumbsDown\n@@ -130,7 +143,7 @@ export const styles = `\n     }\n   }\n \n-  .feedback-button:disabled {\n+  .feedback-button[aria-disabled='true'] {\n     opacity: 0.7;\n     cursor: not-allowed;\n   }"
        }
    ],
    "stats": {
        "total": 22,
        "additions": 19,
        "deletions": 3
    }
}