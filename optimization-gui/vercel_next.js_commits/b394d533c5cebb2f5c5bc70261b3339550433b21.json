{
    "author": "ztanner",
    "message": "[ci]: update flake detection to only run in Turbopack (#84659)\n\nFlake detection runs changed test(s) 6 times: 3 in Webpack, 3 in\nTurbopack. for the purposes of detecting flakes, and to reduce the\nburden on CI, this runs flake detection only with Turbopack (esp. now\nthat it's enabled by default).",
    "sha": "b394d533c5cebb2f5c5bc70261b3339550433b21",
    "files": [
        {
            "sha": "b81467511b74f9f5ef799fb4ccca2a9c4bddb0a1",
            "filename": "scripts/test-new-tests.mjs",
            "status": "modified",
            "additions": 27,
            "deletions": 27,
            "changes": 54,
            "blob_url": "https://github.com/vercel/next.js/blob/b394d533c5cebb2f5c5bc70261b3339550433b21/scripts%2Ftest-new-tests.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/b394d533c5cebb2f5c5bc70261b3339550433b21/scripts%2Ftest-new-tests.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Ftest-new-tests.mjs?ref=b394d533c5cebb2f5c5bc70261b3339550433b21",
            "patch": "@@ -128,34 +128,19 @@ async function main() {\n     }\n   }\n \n-  for (let i = 0; i < attempts; i++) {\n-    console.log(`\\n\\nRun ${i + 1}/${attempts} for ${testMode} tests (Webpack)`)\n-\n-    // We apply the external tests filter before the process.env so that if\n-    // it's defined in the environment, it overrides the default filter.\n-    // This is required for supporting the experimental tests setup.\n-    const NEXT_EXTERNAL_TESTS_FILTERS = process.env.NEXT_EXTERNAL_TESTS_FILTERS\n-      ? process.env.NEXT_EXTERNAL_TESTS_FILTERS\n-      : testMode === 'deploy'\n-        ? 'test/deploy-tests-manifest.json'\n-        : undefined\n-\n-    if (NEXT_EXTERNAL_TESTS_FILTERS) {\n-      console.log(\n-        `Applying external tests filter: ${NEXT_EXTERNAL_TESTS_FILTERS}`\n-      )\n-    }\n+  // We apply the external tests filter before the process.env so that if\n+  // it's defined in the environment, it overrides the default filter.\n+  // This is required for supporting the experimental tests setup.\n+  const NEXT_EXTERNAL_TESTS_FILTERS = process.env.NEXT_EXTERNAL_TESTS_FILTERS\n+    ? process.env.NEXT_EXTERNAL_TESTS_FILTERS\n+    : testMode === 'deploy'\n+      ? 'test/deploy-tests-manifest.json'\n+      : undefined\n \n-    await execa('node', [...RUN_TESTS_ARGS, ...currentTests], {\n-      ...EXECA_OPTS_STDIO,\n-      env: {\n-        ...process.env,\n-        NEXT_EXTERNAL_TESTS_FILTERS,\n-        NEXT_TEST_MODE: testMode,\n-        NEXT_TEST_VERSION: nextTestVersion,\n-        IS_WEBPACK_TEST: '1',\n-      },\n-    })\n+  if (NEXT_EXTERNAL_TESTS_FILTERS) {\n+    console.log(\n+      `Applying external tests filter: ${NEXT_EXTERNAL_TESTS_FILTERS}`\n+    )\n   }\n \n   if (isFlakeDetectionMode && testMode !== 'deploy') {\n@@ -175,6 +160,21 @@ async function main() {\n         },\n       })\n     }\n+  } else {\n+    for (let i = 0; i < attempts; i++) {\n+      console.log(`\\n\\nRun ${i + 1}/${attempts} for ${testMode} tests`)\n+\n+      await execa('node', [...RUN_TESTS_ARGS, ...currentTests], {\n+        ...EXECA_OPTS_STDIO,\n+        env: {\n+          ...process.env,\n+          NEXT_EXTERNAL_TESTS_FILTERS,\n+          NEXT_TEST_MODE: testMode,\n+          NEXT_TEST_VERSION: nextTestVersion,\n+          IS_WEBPACK_TEST: '1',\n+        },\n+      })\n+    }\n   }\n }\n "
        }
    ],
    "stats": {
        "total": 54,
        "additions": 27,
        "deletions": 27
    }
}