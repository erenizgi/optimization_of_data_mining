{
    "author": "wbinnssmith",
    "message": "Turbopack: Make `turbo-tasks-env` crate Rust 2024 (#79128)\n\nWrapped env setting in `unsafe` blocks.",
    "sha": "5a4dba153defeaa6330d2c23d0934594f2df3383",
    "files": [
        {
            "sha": "e5047a55ff1ce012949f1c47851ad0955edc0605",
            "filename": "turbopack/crates/turbo-tasks-env/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4dba153defeaa6330d2c23d0934594f2df3383/turbopack%2Fcrates%2Fturbo-tasks-env%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4dba153defeaa6330d2c23d0934594f2df3383/turbopack%2Fcrates%2Fturbo-tasks-env%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-env%2FCargo.toml?ref=5a4dba153defeaa6330d2c23d0934594f2df3383",
            "patch": "@@ -3,7 +3,7 @@ name = \"turbo-tasks-env\"\n version = \"0.1.0\"\n description = \"TBD\"\n license = \"MIT\"\n-edition = \"2021\"\n+edition = \"2024\"\n \n [lib]\n bench = false"
        },
        {
            "sha": "3dcec9da4dfc6703918c96e07b12d17d7cc89e9d",
            "filename": "turbopack/crates/turbo-tasks-env/src/command_line.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4dba153defeaa6330d2c23d0934594f2df3383/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fcommand_line.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4dba153defeaa6330d2c23d0934594f2df3383/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fcommand_line.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fcommand_line.rs?ref=5a4dba153defeaa6330d2c23d0934594f2df3383",
            "patch": "@@ -1,7 +1,7 @@\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{mark_session_dependent, FxIndexMap, Vc};\n+use turbo_tasks::{FxIndexMap, Vc, mark_session_dependent};\n \n-use crate::{sorted_env_vars, EnvMap, ProcessEnv, GLOBAL_ENV_LOCK};\n+use crate::{EnvMap, GLOBAL_ENV_LOCK, ProcessEnv, sorted_env_vars};\n \n /// Load the environment variables defined via command line.\n #[turbo_tasks::value]"
        },
        {
            "sha": "b4cb34fea3d26c2d0a0fefb6e6e7f175942c3a58",
            "filename": "turbopack/crates/turbo-tasks-env/src/custom.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4dba153defeaa6330d2c23d0934594f2df3383/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fcustom.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4dba153defeaa6330d2c23d0934594f2df3383/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fcustom.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fcustom.rs?ref=5a4dba153defeaa6330d2c23d0934594f2df3383",
            "patch": "@@ -2,7 +2,7 @@ use anyhow::Result;\n use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, Vc};\n \n-use crate::{case_insensitive_read, EnvMap, ProcessEnv};\n+use crate::{EnvMap, ProcessEnv, case_insensitive_read};\n \n /// Allows providing any custom env values that you'd like, deferring the prior\n /// envs if a key is not overridden."
        },
        {
            "sha": "6b4312313bda6f712851b41f69c4b5a8df7ec511",
            "filename": "turbopack/crates/turbo-tasks-env/src/dotenv.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/5a4dba153defeaa6330d2c23d0934594f2df3383/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fdotenv.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5a4dba153defeaa6330d2c23d0934594f2df3383/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fdotenv.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-env%2Fsrc%2Fdotenv.rs?ref=5a4dba153defeaa6330d2c23d0934594f2df3383",
            "patch": "@@ -1,11 +1,11 @@\n use std::{env, sync::MutexGuard};\n \n-use anyhow::{anyhow, Context, Result};\n+use anyhow::{Context, Result, anyhow};\n use turbo_rcstr::RcStr;\n use turbo_tasks::{FxIndexMap, ReadRef, ResolvedVc, ValueToString, Vc};\n use turbo_tasks_fs::{FileContent, FileSystemPath};\n \n-use crate::{sorted_env_vars, EnvMap, ProcessEnv, GLOBAL_ENV_LOCK};\n+use crate::{EnvMap, GLOBAL_ENV_LOCK, ProcessEnv, sorted_env_vars};\n \n /// Load the environment variables defined via a dotenv file, with an\n /// optional prior state that we can lookup already defined variables\n@@ -95,13 +95,13 @@ fn restore_env(\n ) {\n     for key in from.keys() {\n         if !to.contains_key(key) {\n-            env::remove_var(key);\n+            unsafe { env::remove_var(key) };\n         }\n     }\n     for (key, value) in to {\n         match from.get(key) {\n             Some(v) if v == value => {}\n-            _ => env::set_var(key, value),\n+            _ => unsafe { env::set_var(key, value) },\n         }\n     }\n }"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 8,
        "deletions": 8
    }
}