{
    "author": "ijjk",
    "message": "Update create-release-branch to disable test-new-tests (#82182)\n\nThis updates to disable the `test-new-tests-` jobs for release branches\nas they have a lot of diffs and can stall CI heavily un-necessarily.",
    "sha": "7da877642739d61f30cc6da191f647b7474f9853",
    "files": [
        {
            "sha": "06747ffde9dd6865ba5d60d29fdc297725d91370",
            "filename": ".github/workflows/build_and_test.yml",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/7da877642739d61f30cc6da191f647b7474f9853/.github%2Fworkflows%2Fbuild_and_test.yml",
            "raw_url": "https://github.com/vercel/next.js/raw/7da877642739d61f30cc6da191f647b7474f9853/.github%2Fworkflows%2Fbuild_and_test.yml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/.github%2Fworkflows%2Fbuild_and_test.yml?ref=7da877642739d61f30cc6da191f647b7474f9853",
            "patch": "@@ -544,7 +544,9 @@ jobs:\n   test-new-tests-dev:\n     name: Test new tests for flakes (dev)\n     needs: ['optimize-ci', 'changes', 'build-native', 'build-next']\n+    # test-new-tests-if\n     if: ${{ needs.optimize-ci.outputs.skip == 'false' && needs.changes.outputs.docs-only == 'false' }}\n+    # test-new-tests-end-if\n \n     strategy:\n       fail-fast: false\n@@ -566,7 +568,9 @@ jobs:\n   test-new-tests-start:\n     name: Test new tests for flakes (prod)\n     needs: ['optimize-ci', 'changes', 'build-native', 'build-next']\n+    # test-new-tests-if\n     if: ${{ needs.optimize-ci.outputs.skip == 'false' && needs.changes.outputs.docs-only == 'false' }}\n+    # test-new-tests-end-if\n \n     strategy:\n       fail-fast: false\n@@ -582,14 +586,15 @@ jobs:\n           --group ${{ matrix.group }}\n       stepName: 'test-new-tests-start-${{matrix.group}}'\n       timeout_minutes: 60 # Increase the default timeout as tests are intentionally run multiple times to detect flakes\n-\n     secrets: inherit\n \n   test-new-tests-deploy:\n     name: Test new tests when deployed\n     needs:\n       ['optimize-ci', 'test-prod', 'test-new-tests-dev', 'test-new-tests-start']\n+    # test-new-tests-if\n     if: ${{ needs.optimize-ci.outputs.skip == 'false' }}\n+    # test-new-tests-end-if\n \n     strategy:\n       fail-fast: false"
        },
        {
            "sha": "5424b82b746e250b3bbb5b963f1a4386f5b790a5",
            "filename": "scripts/create-release-branch.js",
            "status": "modified",
            "additions": 11,
            "deletions": 14,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/7da877642739d61f30cc6da191f647b7474f9853/scripts%2Fcreate-release-branch.js",
            "raw_url": "https://github.com/vercel/next.js/raw/7da877642739d61f30cc6da191f647b7474f9853/scripts%2Fcreate-release-branch.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Fcreate-release-branch.js?ref=7da877642739d61f30cc6da191f647b7474f9853",
            "patch": "@@ -2,7 +2,6 @@\n const fs = require('fs')\n const path = require('path')\n const execa = require('execa')\n-const resolveFrom = require('resolve-from')\n \n async function main() {\n   const args = process.argv\n@@ -24,15 +23,6 @@ async function main() {\n     return\n   }\n \n-  const configStorePath = resolveFrom(\n-    path.join(process.cwd(), 'node_modules/release'),\n-    'configstore'\n-  )\n-  const ConfigStore = require(configStorePath)\n-\n-  const config = new ConfigStore('release')\n-  config.set('token', githubToken)\n-\n   await execa(\n     `git remote set-url origin https://nextjs-bot:${githubToken}@github.com/vercel/next.js.git`,\n     { stdio: 'inherit', shell: true }\n@@ -81,12 +71,19 @@ async function main() {\n     'workflows',\n     'build_and_test.yml'\n   )\n-  const buildAndTest = await fs.promises.readFile(buildAndTestPath, 'utf8')\n-  await fs.promises.writeFile(\n-    buildAndTestPath,\n-    buildAndTest.replace(`['canary']`, `['${branchName}']`)\n+  let buildAndTest = await fs.promises.readFile(buildAndTestPath, 'utf8')\n+  buildAndTest = buildAndTest\n+    .replace(`['canary']`, `['${branchName}']`)\n+    .replace(/[\\s]{1,}('test-new-tests-.+',)/g, '')\n+\n+  buildAndTest = buildAndTest.replace(\n+    /(^[ \\t]*)# test-new-tests-if\\n(^[ \\t]*)if:.*\\n(^[ \\t]*)# test-new-tests-end-if/gm,\n+    (_, indent1, indent2, indent3) =>\n+      `${indent1}# test-new-tests-if\\n${indent2}if: false\\n${indent3}# test-new-tests-end-if`\n   )\n \n+  await fs.promises.writeFile(buildAndTestPath, buildAndTest)\n+\n   await execa(`git add .`, {\n     stdio: 'inherit',\n     shell: true,"
        }
    ],
    "stats": {
        "total": 32,
        "additions": 17,
        "deletions": 15
    }
}