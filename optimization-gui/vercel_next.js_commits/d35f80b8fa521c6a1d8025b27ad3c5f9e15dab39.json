{
    "author": "lubieowoce",
    "message": "test: ignore streaming metadata in toBeEmpty assertions (#78456)\n\nSome tests in `rsc-basic` asserts that certain nodes should be empty,\nbut streaming metadata can get in there and break that expectation.\n\n- i switched the test to use a full browser. this is better than\nchecking the raw html, because then react gets rid of any `<template>`\ntags inside the div (which are used for streaming SSR things)\n- we're also now only asserting that the inner text of the node should\nbe empty, which avoids failures because of a `<div hidden>` inserted by\nstreaming metadata. this is a slightly weaker assertion than \"this node\nhas no children at all\" but it should be enough for our purposes here.\n\nalso reverts #78449 and #78424, they were meant for debugging this issue",
    "sha": "d35f80b8fa521c6a1d8025b27ad3c5f9e15dab39",
    "files": [
        {
            "sha": "9dee341b4f45809866c2257e18b7daeb3c63341a",
            "filename": "test/e2e/app-dir/rsc-basic/rsc-basic.test.ts",
            "status": "modified",
            "additions": 18,
            "deletions": 35,
            "changes": 53,
            "blob_url": "https://github.com/vercel/next.js/blob/d35f80b8fa521c6a1d8025b27ad3c5f9e15dab39/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d35f80b8fa521c6a1d8025b27ad3c5f9e15dab39/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts?ref=d35f80b8fa521c6a1d8025b27ad3c5f9e15dab39",
            "patch": "@@ -19,10 +19,6 @@ async function resolveStreamResponse(response: any, onData?: any) {\n   return result\n }\n \n-function stripHTMLComments(html: string): string {\n-  return html.replace(/<!--[\\s\\S]*?-->/g, '')\n-}\n-\n describe('app dir - rsc basics', () => {\n   const { next, isNextDev, isNextStart, isTurbopack } = nextTestSetup({\n     files: __dirname,\n@@ -74,52 +70,39 @@ describe('app dir - rsc basics', () => {\n   })\n \n   it('should correctly render page returning null', async () => {\n-    const homeHTML = await next.render('/return-null/page')\n-    const $ = cheerio.load(homeHTML)\n-    expect(stripHTMLComments($('#return-null-layout').html())).toBeEmpty()\n+    const browser = await next.browser('/return-null/page')\n+    expect(await browser.elementByCss('#return-null-layout').text()).toBeEmpty()\n   })\n \n   it('should correctly render component returning null', async () => {\n-    const homeHTML = await next.render('/return-null/component')\n-    const $ = cheerio.load(homeHTML)\n-    expect(stripHTMLComments($('#return-null-layout').html())).toBeEmpty()\n+    const browser = await next.browser('/return-null/component')\n+    expect(await browser.elementByCss('#return-null-layout').text()).toBeEmpty()\n   })\n \n   it('should correctly render layout returning null', async () => {\n-    const homeHTML = await next.render('/return-null/layout')\n-    const $ = cheerio.load(homeHTML)\n-    expect($('#return-null-layout').html()).toBeEmpty()\n+    const browser = await next.browser('/return-null/layout')\n+    expect(await browser.elementByCss('#return-null-layout').text()).toBeEmpty()\n   })\n \n   it('should correctly render page returning undefined', async () => {\n-    const homeHTML = await next.render('/return-undefined/page')\n-    const $ = cheerio.load(homeHTML)\n-    try {\n-      expect(\n-        stripHTMLComments($('#return-undefined-layout').html())\n-      ).toBeEmpty()\n-    } catch (err) {\n-      const console = require('console')\n-      const sep = '='.repeat(40) + ' PAGE HTML ' + '='.repeat(40)\n-      console.log()\n-      console.log(sep)\n-      console.log($('html').html())\n-      console.log(sep)\n-      console.log()\n-      throw err\n-    }\n+    const browser = await next.browser('/return-undefined/page')\n+    expect(\n+      await browser.elementByCss('#return-undefined-layout').text()\n+    ).toBeEmpty()\n   })\n \n   it('should correctly render component returning undefined', async () => {\n-    const homeHTML = await next.render('/return-undefined/component')\n-    const $ = cheerio.load(homeHTML)\n-    expect(stripHTMLComments($('#return-undefined-layout').html())).toBeEmpty()\n+    const browser = await next.browser('/return-undefined/component')\n+    expect(\n+      await browser.elementByCss('#return-undefined-layout').text()\n+    ).toBeEmpty()\n   })\n \n   it('should correctly render layout returning undefined', async () => {\n-    const homeHTML = await next.render('/return-undefined/layout')\n-    const $ = cheerio.load(homeHTML)\n-    expect($('#return-undefined-layout').html()).toBeEmpty()\n+    const browser = await next.browser('/return-undefined/layout')\n+    expect(\n+      await browser.elementByCss('#return-undefined-layout').text()\n+    ).toBeEmpty()\n   })\n \n   it('should handle named client components imported as page', async () => {"
        }
    ],
    "stats": {
        "total": 53,
        "additions": 18,
        "deletions": 35
    }
}