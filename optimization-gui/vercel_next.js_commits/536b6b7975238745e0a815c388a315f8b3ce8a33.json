{
    "author": "devjiwonchoi",
    "message": "[devtools] save user config inside `.next/cache` (#81807)\n\n### Why?\n\nIt's common for developers to clear `localStorage` during development.\nSince the current DevTools config is saved there, this can hurt the\ndeveloper experience when `localStorage` is cleared for any reason.\n\nTo avoid this, we decided to store the DevTools config in the app’s\ncache directory, which is `{distDir}/cache/`. The content inside this\ndirectory is expected to remain during Next.js’ workflow (i.e., `next\nbuild`) unless it's manually removed.\n\n### How?\n\nAdded the `/__nextjs_devtools_config` endpoint to handle config writing.\nThe client sends a POST request to this endpoint, passing the config\ndata. After the config is successfully written, HMR is triggered to\nupdate the client state accordingly.\n\n---------\n\nCo-authored-by: Jiachi Liu <inbox@huozhi.im>",
    "sha": "536b6b7975238745e0a815c388a315f8b3ce8a33",
    "files": [
        {
            "sha": "5cf50b0c6c16197e84fc01d993ece8d02d1460f9",
            "filename": "packages/next/src/client/dev/hot-reloader/app/hot-reloader-app.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fapp%2Fhot-reloader-app.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -293,6 +293,8 @@ function processMessage(\n       if ('versionInfo' in obj) dispatcher.onVersionInfo(obj.versionInfo)\n       if ('debug' in obj && obj.debug) dispatcher.onDebugInfo(obj.debug)\n       if ('devIndicator' in obj) dispatcher.onDevIndicator(obj.devIndicator)\n+      if ('devToolsConfig' in obj)\n+        dispatcher.onDevToolsConfig(obj.devToolsConfig)\n \n       const hasErrors = Boolean(errors && errors.length)\n       // Compilation with errors (e.g. syntax error or missing modules).\n@@ -440,6 +442,10 @@ function processMessage(\n     case HMR_ACTIONS_SENT_TO_BROWSER.DEV_PAGES_MANIFEST_UPDATE: {\n       return\n     }\n+    case HMR_ACTIONS_SENT_TO_BROWSER.DEVTOOLS_CONFIG: {\n+      dispatcher.onDevToolsConfig(obj.data)\n+      return\n+    }\n     default: {\n       obj satisfies never\n     }"
        },
        {
            "sha": "6b7e49adce86e9ae2a3d356f0796e8c71dca90f0",
            "filename": "packages/next/src/client/dev/hot-reloader/pages/hot-reloader-pages.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fhot-reloader-pages.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fhot-reloader-pages.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fdev%2Fhot-reloader%2Fpages%2Fhot-reloader-pages.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -285,6 +285,8 @@ function processMessage(obj: HMR_ACTION_TYPES) {\n       // Is undefined when it's a 'built' event\n       if ('versionInfo' in obj) dispatcher.onVersionInfo(obj.versionInfo)\n       if ('devIndicator' in obj) dispatcher.onDevIndicator(obj.devIndicator)\n+      if ('devToolsConfig' in obj)\n+        dispatcher.onDevToolsConfig(obj.devToolsConfig)\n \n       const hasErrors = Boolean(errors && errors.length)\n       if (hasErrors) {\n@@ -369,6 +371,9 @@ function processMessage(obj: HMR_ACTION_TYPES) {\n         customHmrEventHandler(obj)\n       }\n       break\n+    case HMR_ACTIONS_SENT_TO_BROWSER.DEVTOOLS_CONFIG:\n+      dispatcher.onDevToolsConfig(obj.data)\n+      break\n     default:\n       obj satisfies never\n   }"
        },
        {
            "sha": "50c7c62183f2269ab76428375d10c4474dad2edb",
            "filename": "packages/next/src/client/page-bootstrap.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fclient%2Fpage-bootstrap.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fclient%2Fpage-bootstrap.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fpage-bootstrap.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -61,6 +61,7 @@ export function pageBootstrap(assetPrefix: string) {\n           case HMR_ACTIONS_SENT_TO_BROWSER.TURBOPACK_MESSAGE:\n           case HMR_ACTIONS_SENT_TO_BROWSER.TURBOPACK_CONNECTED:\n           case HMR_ACTIONS_SENT_TO_BROWSER.ISR_MANIFEST:\n+          case HMR_ACTIONS_SENT_TO_BROWSER.DEVTOOLS_CONFIG:\n             // Most of these action types are handled in\n             // src/client/dev/hot-reloader/pages/hot-reloader-pages.ts\n             break"
        },
        {
            "sha": "637cb1fe2d2f28e1f0a55a6a028dc3e4982be85e",
            "filename": "packages/next/src/next-devtools/dev-overlay.browser.tsx",
            "status": "modified",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay.browser.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -18,6 +18,7 @@ import {\n   ACTION_RENDERING_INDICATOR_HIDE,\n   ACTION_RENDERING_INDICATOR_SHOW,\n   ACTION_DEVTOOL_UPDATE_ROUTE_STATE,\n+  ACTION_DEVTOOLS_CONFIG,\n   type OverlayState,\n   type DispatcherEvent,\n } from './dev-overlay/shared'\n@@ -41,6 +42,7 @@ import {\n   removeSegmentNode,\n } from './dev-overlay/segment-explorer-trie'\n import type { SegmentNodeState } from './userspace/app/segment-explorer-node'\n+import type { DevToolsConfig } from './dev-overlay/shared'\n \n export interface Dispatcher {\n   onBuildOk(): void\n@@ -51,6 +53,7 @@ export interface Dispatcher {\n   onRefresh(): void\n   onStaticIndicator(status: boolean): void\n   onDevIndicator(devIndicator: DevIndicatorServerState): void\n+  onDevToolsConfig(config: DevToolsConfig): void\n   onUnhandledError(reason: Error): void\n   onUnhandledRejection(reason: Error): void\n   openErrorOverlay(): void\n@@ -115,6 +118,11 @@ export const dispatcher: Dispatcher = {\n       dispatch({ type: ACTION_DEV_INDICATOR, devIndicator })\n     }\n   ),\n+  onDevToolsConfig: createQueuable(\n+    (dispatch: Dispatch, devToolsConfig: DevToolsConfig) => {\n+      dispatch({ type: ACTION_DEVTOOLS_CONFIG, devToolsConfig })\n+    }\n+  ),\n   onUnhandledError: createQueuable((dispatch: Dispatch, error: Error) => {\n     dispatch({\n       type: ACTION_UNHANDLED_ERROR,"
        },
        {
            "sha": "ebdd0a9671ce541b65c0ee47158234fdae22c295",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.tsx",
            "status": "modified",
            "additions": 16,
            "deletions": 9,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -1,13 +1,13 @@\n import './devtools-indicator.css'\n import type { CSSProperties } from 'react'\n+import type { DevToolsIndicatorPosition } from '../../shared'\n import { NextLogo } from './next-logo'\n import { Toast } from '../toast'\n import {\n   MENU_CURVE,\n   MENU_DURATION_MS,\n } from '../errors/dev-tools-indicator/utils'\n import {\n-  STORAGE_KEY_POSITION,\n   ACTION_DEVTOOLS_POSITION,\n   STORE_KEY_SHARED_PANEL_LOCATION,\n   STORAGE_KEY_PANEL_POSITION_PREFIX,\n@@ -16,7 +16,7 @@ import {\n import { Draggable } from '../errors/dev-tools-indicator/draggable'\n import { useDevOverlayContext } from '../../../dev-overlay.browser'\n import { usePanelRouterContext } from '../../menu/context'\n-import type { DevToolsIndicatorPosition } from '../errors/dev-tools-indicator/dev-tools-info/preferences'\n+import { saveDevToolsConfig } from '../../utils/save-devtools-config'\n \n export const INDICATOR_PADDING = 20\n \n@@ -51,7 +51,7 @@ export function DevToolsIndicator() {\n             type: ACTION_DEVTOOLS_POSITION,\n             devToolsPosition: p,\n           })\n-          localStorage.setItem(STORAGE_KEY_POSITION, p)\n+          saveDevToolsConfig({ devToolsPosition: p })\n \n           updateAllPanelPositions(p)\n         }}\n@@ -79,27 +79,34 @@ export function DevToolsIndicator() {\n  * cannot be dragged when any panel is open\n  */\n export const useUpdateAllPanelPositions = () => {\n-  const { dispatch } = useDevOverlayContext()\n+  const { state, dispatch } = useDevOverlayContext()\n   return (position: DevToolsIndicatorPosition) => {\n     dispatch({\n       type: ACTION_DEVTOOLS_PANEL_POSITION,\n       devToolsPanelPosition: position,\n       key: STORE_KEY_SHARED_PANEL_LOCATION,\n     })\n \n-    localStorage.setItem(STORE_KEY_SHARED_PANEL_LOCATION, position)\n-\n-    const panelPositionKeys = Object.keys(localStorage).filter((key) =>\n-      key.startsWith(STORAGE_KEY_PANEL_POSITION_PREFIX)\n+    const panelPositionKeys = Object.keys(state.devToolsPanelPosition).filter(\n+      (key) => key.startsWith(STORAGE_KEY_PANEL_POSITION_PREFIX)\n     )\n \n+    const panelPositionPatch: Record<string, DevToolsIndicatorPosition> = {\n+      [STORE_KEY_SHARED_PANEL_LOCATION]: position,\n+    }\n+\n     panelPositionKeys.forEach((key) => {\n       dispatch({\n         type: ACTION_DEVTOOLS_PANEL_POSITION,\n         devToolsPanelPosition: position,\n         key,\n       })\n-      localStorage.setItem(key, position)\n+\n+      panelPositionPatch[key] = position\n+    })\n+\n+    saveDevToolsConfig({\n+      devToolsPanelPosition: panelPositionPatch,\n     })\n   }\n }"
        },
        {
            "sha": "b132944dc520e0db4163de5f38ad6c60a88bbf47",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/hooks/use-theme.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 14,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/907501e8f37e59086a1c086d056becf1952f054e/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fhooks%2Fuse-theme.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/907501e8f37e59086a1c086d056becf1952f054e/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fhooks%2Fuse-theme.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fhooks%2Fuse-theme.ts?ref=907501e8f37e59086a1c086d056becf1952f054e",
            "patch": "@@ -1,14 +0,0 @@\n-import { useState } from 'react'\n-import { STORAGE_KEY_THEME } from '../../../shared'\n-\n-function getInitialTheme() {\n-  if (typeof localStorage === 'undefined') {\n-    return 'system'\n-  }\n-  const theme = localStorage.getItem(STORAGE_KEY_THEME)\n-  return theme === 'dark' || theme === 'light' ? theme : 'system'\n-}\n-\n-export function useTheme() {\n-  return useState(getInitialTheme())\n-}"
        },
        {
            "sha": "517e313e868c5e72747302a9a4d0dddb906d708e",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/resize/resize-handle.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-handle.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-handle.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-handle.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -2,6 +2,7 @@ import { useState, useLayoutEffect } from 'react'\n import type { Corners } from '../../../shared'\n import { useResize, type ResizeDirection } from './resize-provider'\n import './resize-handle.css'\n+import { saveDevToolsConfig } from '../../../utils/save-devtools-config'\n \n export const ResizeHandle = ({\n   direction,\n@@ -127,8 +128,9 @@ export const ResizeHandle = ({\n       }\n \n       const { width, height } = resizeRef.current.getBoundingClientRect()\n-\n-      localStorage.setItem(storageKey, JSON.stringify({ width, height }))\n+      saveDevToolsConfig({\n+        devToolsPanelSize: { [storageKey]: { width, height } },\n+      })\n     }\n     document.addEventListener('mousemove', handleMouseMove)\n     document.addEventListener('mouseup', handleMouseUp)"
        },
        {
            "sha": "c75153cc4ebd1e6ac9afe67a4c30e4fe1fb04cdb",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/resize/resize-provider.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 22,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-provider.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-provider.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fresize%2Fresize-provider.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -46,26 +46,6 @@ const constrainDimensions = (params: {\n   }\n }\n \n-const parseResizeLocalStorage = (key: string) => {\n-  const savedDimensions = localStorage.getItem(key)\n-  if (!savedDimensions) return null\n-  try {\n-    const parsed = JSON.parse(savedDimensions)\n-    if (\n-      typeof parsed === 'object' &&\n-      parsed !== null &&\n-      typeof parsed.width === 'number' &&\n-      typeof parsed.height === 'number'\n-    ) {\n-      return { width: parsed.width, height: parsed.height }\n-    }\n-    return null\n-  } catch (e) {\n-    localStorage.removeItem(key)\n-    return null\n-  }\n-}\n-\n interface ResizeProviderProps {\n   value: {\n     resizeRef: RefObject<HTMLElement | null>\n@@ -74,6 +54,7 @@ interface ResizeProviderProps {\n     maxWidth?: number\n     maxHeight?: number\n     devToolsPosition: Corners\n+    devToolsPanelSize: Record<string, { width: number; height: number }>\n     storageKey?: string\n     initialSize?: { height: number; width: number }\n   }\n@@ -105,7 +86,7 @@ export const ResizeProvider = ({ value, children }: ResizeProviderProps) => {\n       return\n     }\n \n-    const dim = parseResizeLocalStorage(storageKey)\n+    const dim = value.devToolsPanelSize[storageKey]\n     if (!dim) {\n       return\n     }\n@@ -118,7 +99,14 @@ export const ResizeProvider = ({ value, children }: ResizeProviderProps) => {\n     value.resizeRef.current.style.width = `${width}px`\n     value.resizeRef.current.style.height = `${height}px`\n     return true\n-  }, [value.resizeRef, draggingDirection, storageKey, minWidth, minHeight])\n+  }, [\n+    value.resizeRef,\n+    draggingDirection,\n+    storageKey,\n+    minWidth,\n+    minHeight,\n+    value.devToolsPanelSize,\n+  ])\n \n   useLayoutEffect(() => {\n     const applied = applyConstrainedDimensions()"
        },
        {
            "sha": "b79358269b65075ec7616a80346c5735e95c6f07",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/preferences.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 97,
            "changes": 97,
            "blob_url": "https://github.com/vercel/next.js/blob/907501e8f37e59086a1c086d056becf1952f054e/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fpreferences.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/907501e8f37e59086a1c086d056becf1952f054e/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fpreferences.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fpreferences.ts?ref=907501e8f37e59086a1c086d056becf1952f054e",
            "patch": "@@ -1,97 +0,0 @@\n-import { useState } from 'react'\n-import {\n-  NEXT_DEV_TOOLS_SCALE,\n-  STORAGE_KEY_POSITION,\n-  STORAGE_KEY_SCALE,\n-  STORAGE_KEY_THEME,\n-} from '../../../../shared'\n-\n-const INDICATOR_POSITION =\n-  (process.env\n-    .__NEXT_DEV_INDICATOR_POSITION as typeof window.__NEXT_DEV_INDICATOR_POSITION) ||\n-  'bottom-left'\n-\n-export const STORAGE_KEY_HIDE_SHORTCUT = '__nextjs_hide_shortcut'\n-\n-export type DevToolsIndicatorPosition = typeof INDICATOR_POSITION\n-\n-export function getInitialPosition() {\n-  if (\n-    typeof localStorage !== 'undefined' &&\n-    localStorage.getItem(STORAGE_KEY_POSITION)\n-  ) {\n-    return localStorage.getItem(\n-      STORAGE_KEY_POSITION\n-    ) as DevToolsIndicatorPosition\n-  }\n-  return INDICATOR_POSITION\n-}\n-\n-//////////////////////////////////////////////////////////////////////////////////////\n-\n-export type DevToolsScale =\n-  (typeof NEXT_DEV_TOOLS_SCALE)[keyof typeof NEXT_DEV_TOOLS_SCALE]\n-\n-function getInitialScale() {\n-  if (\n-    typeof localStorage !== 'undefined' &&\n-    localStorage.getItem(STORAGE_KEY_SCALE)\n-  ) {\n-    return Number(localStorage.getItem(STORAGE_KEY_SCALE)) as DevToolsScale\n-  }\n-  return NEXT_DEV_TOOLS_SCALE.Medium\n-}\n-\n-export function useDevToolsScale(): [\n-  DevToolsScale,\n-  (value: DevToolsScale) => void,\n-] {\n-  const [scale, setScale] = useState<DevToolsScale>(getInitialScale())\n-\n-  function set(value: DevToolsScale) {\n-    setScale(value)\n-    localStorage.setItem(STORAGE_KEY_SCALE, String(value))\n-  }\n-\n-  return [scale, set]\n-}\n-\n-//////////////////////////////////////////////////////////////////////////////////////\n-\n-export function getInitialTheme() {\n-  if (typeof localStorage === 'undefined') {\n-    return 'system'\n-  }\n-  const theme = localStorage.getItem(STORAGE_KEY_THEME)\n-  return theme === 'dark' || theme === 'light' ? theme : 'system'\n-}\n-\n-//////////////////////////////////////////////////////////////////////////////////////\n-\n-export function getInitialHideShortcut(): string | null {\n-  if (typeof localStorage === 'undefined') {\n-    return null\n-  }\n-  const hideShortcut = localStorage.getItem(STORAGE_KEY_HIDE_SHORTCUT)\n-  return hideShortcut ? hideShortcut : null\n-}\n-\n-export function useHideShortcutStorage(): [\n-  string | null,\n-  (value: string | null) => void,\n-] {\n-  const [hideShortcut, setHideShortcut] = useState<string | null>(\n-    getInitialHideShortcut()\n-  )\n-\n-  function set(value: string | null) {\n-    setHideShortcut(value)\n-    if (value === null) {\n-      localStorage.removeItem(STORAGE_KEY_HIDE_SHORTCUT)\n-    } else {\n-      localStorage.setItem(STORAGE_KEY_HIDE_SHORTCUT, value)\n-    }\n-  }\n-\n-  return [hideShortcut, set]\n-}"
        },
        {
            "sha": "8f971e2463d046fdc4ba01ad523d77b321f20b62",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/user-preferences.tsx",
            "status": "modified",
            "additions": 23,
            "deletions": 19,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -1,25 +1,23 @@\n-import { useState, type HTMLProps } from 'react'\n+import type { HTMLProps } from 'react'\n+import type {\n+  DevToolsIndicatorPosition,\n+  DevToolsScale,\n+} from '../../../../shared'\n+\n import { css } from '../../../../utils/css'\n import EyeIcon from '../../../../icons/eye-icon'\n-import {\n-  NEXT_DEV_TOOLS_SCALE,\n-  STORAGE_KEY_POSITION,\n-  STORAGE_KEY_THEME,\n-} from '../../../../shared'\n+import { NEXT_DEV_TOOLS_SCALE } from '../../../../shared'\n import LightIcon from '../../../../icons/light-icon'\n import DarkIcon from '../../../../icons/dark-icon'\n import SystemIcon from '../../../../icons/system-icon'\n import type { DevToolsInfoPropsCore } from './dev-tools-info'\n import { DevToolsInfo } from './dev-tools-info'\n-import {\n-  getInitialTheme,\n-  type DevToolsIndicatorPosition,\n-  type DevToolsScale,\n-} from './preferences'\n import { ShortcutRecorder } from './shortcut-recorder'\n import { useRestartServer } from '../../error-overlay-toolbar/use-restart-server'\n+import { saveDevToolsConfig } from '../../../../utils/save-devtools-config'\n \n export function UserPreferences({\n+  theme,\n   hide,\n   hideShortcut,\n   setHideShortcut,\n@@ -29,6 +27,7 @@ export function UserPreferences({\n   setPosition,\n   ...props\n }: {\n+  theme: 'dark' | 'light' | 'system'\n   hide: () => void\n   hideShortcut: string | null\n   setHideShortcut: (value: string | null) => void\n@@ -41,6 +40,7 @@ export function UserPreferences({\n   return (\n     <DevToolsInfo title=\"Preferences\" {...props}>\n       <UserPreferencesBody\n+        theme={theme}\n         scale={scale}\n         position={position}\n         setPosition={setPosition}\n@@ -54,6 +54,7 @@ export function UserPreferences({\n }\n \n export function UserPreferencesBody({\n+  theme,\n   hide,\n   hideShortcut,\n   setHideShortcut,\n@@ -62,6 +63,7 @@ export function UserPreferencesBody({\n   setScale,\n   position,\n }: {\n+  theme: 'dark' | 'light' | 'system'\n   hide: () => void\n   hideShortcut: string | null\n   setHideShortcut: (value: string | null) => void\n@@ -71,40 +73,42 @@ export function UserPreferencesBody({\n   setScale: (value: DevToolsScale) => void\n }) {\n   const { restartServer, isPending } = useRestartServer()\n-  const [theme, setTheme] = useState(getInitialTheme())\n \n   const handleThemeChange = (e: React.ChangeEvent<HTMLSelectElement>) => {\n     const portal = document.querySelector('nextjs-portal')\n-    if (!portal) return\n-\n-    setTheme(e.target.value)\n+    if (!portal) {\n+      return\n+    }\n \n     if (e.target.value === 'system') {\n       portal.classList.remove('dark')\n       portal.classList.remove('light')\n-      localStorage.removeItem(STORAGE_KEY_THEME)\n+      saveDevToolsConfig({ theme: 'system' })\n       return\n     }\n \n     if (e.target.value === 'dark') {\n       portal.classList.add('dark')\n       portal.classList.remove('light')\n-      localStorage.setItem(STORAGE_KEY_THEME, 'dark')\n+      saveDevToolsConfig({ theme: 'dark' })\n     } else {\n       portal.classList.remove('dark')\n       portal.classList.add('light')\n-      localStorage.setItem(STORAGE_KEY_THEME, 'light')\n+      saveDevToolsConfig({ theme: 'light' })\n     }\n   }\n \n   function handlePositionChange(e: React.ChangeEvent<HTMLSelectElement>) {\n     setPosition(e.target.value as DevToolsIndicatorPosition)\n-    localStorage.setItem(STORAGE_KEY_POSITION, e.target.value)\n+    saveDevToolsConfig({\n+      devToolsPosition: e.target.value as DevToolsIndicatorPosition,\n+    })\n   }\n \n   function handleSizeChange({ target }: React.ChangeEvent<HTMLSelectElement>) {\n     const value = Number(target.value) as DevToolsScale\n     setScale(value)\n+    saveDevToolsConfig({ scale: value })\n   }\n \n   return ("
        },
        {
            "sha": "17e3524bce84074c801ecf8fe6c7a80915336153",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/shadow-portal.tsx",
            "status": "modified",
            "additions": 13,
            "deletions": 12,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fshadow-portal.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fshadow-portal.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fshadow-portal.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -1,8 +1,9 @@\n import * as React from 'react'\n import { createPortal } from 'react-dom'\n-import { STORAGE_KEY_THEME } from '../shared'\n+import { useDevOverlayContext } from '../../dev-overlay.browser'\n \n export function ShadowPortal({ children }: { children: React.ReactNode }) {\n+  const { state } = useDevOverlayContext()\n   let portalNode = React.useRef<HTMLElement | null>(null)\n   let shadowNode = React.useRef<ShadowRoot | null>(null)\n   let [, forceUpdate] = React.useState<{} | undefined>()\n@@ -14,16 +15,16 @@ export function ShadowPortal({ children }: { children: React.ReactNode }) {\n   React.useEffect(() => {\n     const ownerDocument = document\n     portalNode.current = ownerDocument.querySelector('nextjs-portal')!\n-    // load default color preference from localstorage\n-    if (typeof localStorage !== 'undefined') {\n-      const theme = localStorage.getItem(STORAGE_KEY_THEME)\n-      if (theme === 'dark') {\n-        portalNode.current.classList.add('dark')\n-        portalNode.current.classList.remove('light')\n-      } else if (theme === 'light') {\n-        portalNode.current.classList.remove('dark')\n-        portalNode.current.classList.add('light')\n-      }\n+\n+    if (state.theme === 'dark') {\n+      portalNode.current.classList.add('dark')\n+      portalNode.current.classList.remove('light')\n+    } else if (state.theme === 'light') {\n+      portalNode.current.classList.add('light')\n+      portalNode.current.classList.remove('dark')\n+    } else {\n+      portalNode.current.classList.remove('dark')\n+      portalNode.current.classList.remove('light')\n     }\n \n     // We can only attach but never detach a shadow root.\n@@ -35,7 +36,7 @@ export function ShadowPortal({ children }: { children: React.ReactNode }) {\n       shadowNode.current = portalNode.current.attachShadow({ mode: 'open' })\n     }\n     forceUpdate({})\n-  }, [])\n+  }, [state.theme])\n \n   return shadowNode.current\n     ? createPortal(children, shadowNode.current as any)"
        },
        {
            "sha": "a351c43ba6ba0acd0cbcc758d0524f4e591845d1",
            "filename": "packages/next/src/next-devtools/dev-overlay/menu/panel-router.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 16,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fmenu%2Fpanel-router.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -26,9 +26,9 @@ import {\n } from '../shared'\n import GearIcon from '../icons/gear-icon'\n import { UserPreferencesBody } from '../components/errors/dev-tools-indicator/dev-tools-info/user-preferences'\n-import { useHideShortcutStorage } from '../components/errors/dev-tools-indicator/dev-tools-info/preferences'\n import { useShortcuts } from '../hooks/use-shortcuts'\n import { useUpdateAllPanelPositions } from '../components/devtools-indicator/devtools-indicator'\n+import { saveDevToolsConfig } from '../utils/save-devtools-config'\n import './panel-router.css'\n \n const MenuPanel = () => {\n@@ -143,11 +143,11 @@ export const PanelRouter = () => {\n   const toggleDevtools = useToggleDevtoolsVisibility()\n   const isAppRouter = state.routerType === 'app'\n \n-  const [hideShortcut, setHideShortcut] = useHideShortcutStorage()\n   useShortcuts(\n-    hideShortcut ? { [hideShortcut]: toggleDevtools } : {},\n+    state.hideShortcut ? { [state.hideShortcut]: toggleDevtools } : {},\n     triggerRef\n   )\n+\n   return (\n     <>\n       <PanelRoute name=\"panel-selector\">\n@@ -165,10 +165,7 @@ export const PanelRouter = () => {\n           closeOnClickOutside\n           header={<DevToolsHeader title=\"Preferences\" />}\n         >\n-          <UserPreferencesWrapper\n-            hideShortcut={hideShortcut}\n-            setHideShortcut={setHideShortcut}\n-          />\n+          <UserPreferencesWrapper />\n         </DynamicPanel>\n       </PanelRoute>\n \n@@ -267,20 +264,15 @@ const InfoFooter = ({ href }: { href: string }) => {\n   )\n }\n \n-const UserPreferencesWrapper = ({\n-  hideShortcut,\n-  setHideShortcut,\n-}: {\n-  hideShortcut: string | null\n-  setHideShortcut: (value: string | null) => void\n-}) => {\n+const UserPreferencesWrapper = () => {\n   const { dispatch, state } = useDevOverlayContext()\n   const { setPanel, setSelectedIndex } = usePanelRouterContext()\n   const updateAllPanelPositions = useUpdateAllPanelPositions()\n \n   return (\n     <div className=\"user-preferences-wrapper\">\n       <UserPreferencesBody\n+        theme={state.theme}\n         position={state.devToolsPosition}\n         scale={state.scale}\n         setScale={(scale) => {\n@@ -296,8 +288,10 @@ const UserPreferencesWrapper = ({\n           })\n           updateAllPanelPositions(devToolsPosition)\n         }}\n-        hideShortcut={hideShortcut}\n-        setHideShortcut={setHideShortcut}\n+        hideShortcut={state.hideShortcut}\n+        setHideShortcut={(value) => {\n+          saveDevToolsConfig({ hideShortcut: value })\n+        }}\n         hide={() => {\n           dispatch({\n             type: ACTION_DEV_INDICATOR_SET,"
        },
        {
            "sha": "76c582a697dbbdc8da1b67ccb8befa1ed228482f",
            "filename": "packages/next/src/next-devtools/dev-overlay/panel/dynamic-panel.tsx",
            "status": "modified",
            "additions": 15,
            "deletions": 33,
            "changes": 48,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fpanel%2Fdynamic-panel.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -1,4 +1,4 @@\n-import { useMemo, useRef, useState, useEffect, type CSSProperties } from 'react'\n+import { useRef, useState, useEffect, type CSSProperties } from 'react'\n import { useDevOverlayContext } from '../../dev-overlay.browser'\n import { INDICATOR_PADDING } from '../components/devtools-indicator/devtools-indicator'\n import { ResizeHandle } from '../components/devtools-panel/resize/resize-handle'\n@@ -19,6 +19,7 @@ import {\n   STORE_KEY_SHARED_PANEL_SIZE,\n } from '../shared'\n import { getIndicatorOffset } from '../utils/indicator-metrics'\n+import { saveDevToolsConfig } from '../utils/save-devtools-config'\n import './dynamic-panel.css'\n \n function resolveCSSValue(\n@@ -72,34 +73,6 @@ function useResolvedDimensions(\n   return dimensions\n }\n \n-function getStoredPanelSize(panelName?: string) {\n-  const key = panelName\n-    ? `${STORE_KEY_PANEL_SIZE_PREFIX}_${panelName}`\n-    : STORE_KEY_SHARED_PANEL_SIZE\n-  const defaultSize = { width: 450, height: 350 }\n-  try {\n-    const stored = JSON.parse(localStorage.getItem(key) ?? 'null')\n-    if (!stored) {\n-      return defaultSize\n-    }\n-    if (\n-      typeof stored === 'object' &&\n-      'height' in stored &&\n-      'width' in stored &&\n-      typeof stored.height === 'number' &&\n-      typeof stored.width === 'number'\n-    ) {\n-      return {\n-        width: stored.width as number,\n-        height: stored.height as number,\n-      }\n-    }\n-    return null\n-  } catch {\n-    return null\n-  }\n-}\n-\n export function DynamicPanel({\n   header,\n   children,\n@@ -217,7 +190,10 @@ export function DynamicPanel({\n   const maxWidth = resolvedDimensions.maxWidth\n   const maxHeight = resolvedDimensions.maxHeight\n \n-  const panelSize = useMemo(() => getStoredPanelSize(name), [name])\n+  const panelSizeKey = name\n+    ? `${STORE_KEY_PANEL_SIZE_PREFIX}_${name}`\n+    : STORE_KEY_SHARED_PANEL_SIZE\n+  const panelSize = state.devToolsPanelSize[panelSizeKey]\n \n   return (\n     <ResizeProvider\n@@ -230,6 +206,7 @@ export function DynamicPanel({\n         maxWidth,\n         maxHeight,\n         devToolsPosition: state.devToolsPosition,\n+        devToolsPanelSize: state.devToolsPanelSize,\n         storageKey: resizeStorageKey,\n       }}\n     >\n@@ -272,14 +249,19 @@ export function DynamicPanel({\n             padding={INDICATOR_PADDING}\n             position={devtoolsPanelPosition}\n             setPosition={(p) => {\n-              if (sizeConfig.kind === 'resizable') {\n-                localStorage.setItem(positionStorageKey, p)\n-              }\n               dispatch({\n                 type: ACTION_DEVTOOLS_PANEL_POSITION,\n                 devToolsPanelPosition: p,\n                 key: positionStorageKey,\n               })\n+\n+              if (sizeConfig.kind === 'resizable') {\n+                saveDevToolsConfig({\n+                  devToolsPanelPosition: {\n+                    [positionStorageKey]: p,\n+                  },\n+                })\n+              }\n             }}\n             style={{\n               overflow: 'auto',"
        },
        {
            "sha": "a6f4da1782f6106d3192b03e5dcbc62ce7ee749a",
            "filename": "packages/next/src/next-devtools/dev-overlay/shared.ts",
            "status": "modified",
            "additions": 62,
            "deletions": 39,
            "changes": 101,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -8,7 +8,21 @@ import type { DevIndicatorServerState } from '../../server/dev/dev-indicator-ser\n import { parseStack } from '../../server/lib/parse-stack'\n import { isConsoleError } from '../shared/console-error'\n \n+export type DevToolsConfig = {\n+  theme?: 'light' | 'dark' | 'system'\n+  disableDevIndicator?: boolean\n+  devToolsPosition?: 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n+  devToolsPanelPosition?: Record<\n+    string,\n+    'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n+  >\n+  devToolsPanelSize?: Record<string, { width: number; height: number }>\n+  scale?: number\n+  hideShortcut?: string | null\n+}\n+\n export type Corners = 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n+export type DevToolsIndicatorPosition = Corners\n \n const BASE_SIZE = 16\n \n@@ -18,6 +32,9 @@ export const NEXT_DEV_TOOLS_SCALE = {\n   Large: BASE_SIZE / 18,\n }\n \n+export type DevToolsScale =\n+  (typeof NEXT_DEV_TOOLS_SCALE)[keyof typeof NEXT_DEV_TOOLS_SCALE]\n+\n type FastRefreshState =\n   /** No refresh in progress. */\n   | { type: 'idle' }\n@@ -49,8 +66,14 @@ export interface OverlayState {\n   isErrorOverlayOpen: boolean\n   devToolsPosition: Corners\n   devToolsPanelPosition: Record<DevtoolsPanelName, Corners>\n+  devToolsPanelSize: Record<\n+    DevtoolsPanelName,\n+    { width: number; height: number }\n+  >\n   scale: number\n   page: string\n+  theme: 'light' | 'dark' | 'system'\n+  hideShortcut: string | null\n }\n type DevtoolsPanelName = string\n export type OverlayDispatch = React.Dispatch<DispatcherEvent>\n@@ -86,6 +109,8 @@ export const ACTION_DEVTOOLS_PANEL_SIZE = 'devtools-panel-size'\n export const ACTION_DEVTOOLS_SCALE = 'devtools-scale'\n export const ACTION_RESTART_SERVER_BUTTON = 'restart-server-button'\n \n+export const ACTION_DEVTOOLS_CONFIG = 'devtools-config'\n+\n export const STORAGE_KEY_THEME = '__nextjs-dev-tools-theme'\n export const STORAGE_KEY_POSITION = '__nextjs-dev-tools-position'\n export const STORAGE_KEY_PANEL_POSITION_PREFIX =\n@@ -96,7 +121,6 @@ export const STORE_KEY_SHARED_PANEL_SIZE =\n export const STORE_KEY_SHARED_PANEL_LOCATION =\n   '__nextjs-dev-tools-shared-panel-location'\n export const STORAGE_KEY_SCALE = '__nextjs-dev-tools-scale'\n-export const STORAGE_KEY_ACTIVE_TAB = '__nextjs-devtools-active-tab'\n \n export const ACTION_DEVTOOL_UPDATE_ROUTE_STATE =\n   'segment-explorer-update-route-state'\n@@ -199,6 +223,11 @@ export interface RestartServerButtonAction {\n   showRestartServerButton: boolean\n }\n \n+export interface DevToolsConfigAction {\n+  type: typeof ACTION_DEVTOOLS_CONFIG\n+  devToolsConfig: DevToolsConfig\n+}\n+\n export type DispatcherEvent =\n   | BuildOkAction\n   | BuildErrorAction\n@@ -223,6 +252,7 @@ export type DispatcherEvent =\n   | DevToolUpdateRouteStateAction\n   | RestartServerButtonAction\n   | DevIndicatorSetAction\n+  | DevToolsConfigAction\n \n const REACT_ERROR_STACK_BOTTOM_FRAME_REGEX =\n   // 1st group: new frame + v8\n@@ -242,41 +272,6 @@ function getStackIgnoringStrictMode(stack: string | undefined) {\n const shouldDisableDevIndicator =\n   process.env.__NEXT_DEV_INDICATOR?.toString() === 'false'\n \n-// TODO: change local storage impl\n-function getStoredPosition(): Corners {\n-  if (typeof localStorage === 'undefined') {\n-    return 'bottom-left' as const\n-  }\n-  const stored = localStorage.getItem(STORAGE_KEY_POSITION)\n-  if (\n-    stored &&\n-    ['top-left', 'top-right', 'bottom-left', 'bottom-right'].includes(stored)\n-  ) {\n-    return stored as Corners\n-  } else {\n-    localStorage.removeItem(STORAGE_KEY_POSITION)\n-  }\n-\n-  // we give priority to local storage over next.config\n-  return (process.env.__NEXT_DEV_INDICATOR_POSITION ?? 'bottom-left') as Corners\n-}\n-\n-export function getStoredPanelPosition() {\n-  if (typeof localStorage === 'undefined') {\n-    return 'bottom-left' as const\n-  }\n-  const stored = localStorage.getItem(STORE_KEY_SHARED_PANEL_LOCATION)\n-  if (\n-    stored &&\n-    ['top-left', 'top-right', 'bottom-left', 'bottom-right'].includes(stored)\n-  ) {\n-    return stored as Corners\n-  } else {\n-    localStorage.removeItem(STORE_KEY_SHARED_PANEL_LOCATION)\n-  }\n-  return 'bottom-left' as const\n-}\n-\n export const INITIAL_OVERLAY_STATE: Omit<\n   OverlayState,\n   'isErrorOverlayOpen' | 'routerType'\n@@ -299,13 +294,15 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   versionInfo: { installed: '0.0.0', staleness: 'unknown' },\n   debugInfo: { devtoolsFrontendUrl: undefined },\n   showRestartServerButton: false,\n-  devToolsPosition: getStoredPosition(),\n+  devToolsPosition: 'bottom-left',\n   devToolsPanelPosition: {\n-    [STORE_KEY_SHARED_PANEL_LOCATION]: getStoredPanelPosition(),\n+    [STORE_KEY_SHARED_PANEL_LOCATION]: 'bottom-left',\n   },\n-\n+  devToolsPanelSize: {},\n   scale: NEXT_DEV_TOOLS_SCALE.Medium,\n   page: '',\n+  theme: 'system',\n+  hideShortcut: null,\n }\n \n function getInitialState(\n@@ -497,6 +494,32 @@ export function useErrorOverlayReducer(\n             showRestartServerButton: action.showRestartServerButton,\n           }\n         }\n+        case ACTION_DEVTOOLS_CONFIG: {\n+          const {\n+            theme,\n+            disableDevIndicator,\n+            devToolsPosition,\n+            devToolsPanelPosition,\n+            devToolsPanelSize,\n+            scale,\n+            hideShortcut,\n+          } = action.devToolsConfig\n+\n+          return {\n+            ...state,\n+            theme: theme ?? state.theme,\n+            disableDevIndicator:\n+              disableDevIndicator ?? state.disableDevIndicator,\n+            devToolsPosition: devToolsPosition ?? state.devToolsPosition,\n+            devToolsPanelPosition:\n+              devToolsPanelPosition ?? state.devToolsPanelPosition,\n+            scale: scale ?? state.scale,\n+            devToolsPanelSize: devToolsPanelSize ?? state.devToolsPanelSize,\n+            hideShortcut:\n+              // hideShortcut can be null.\n+              hideShortcut !== undefined ? hideShortcut : state.hideShortcut,\n+          }\n+        }\n         default: {\n           return state\n         }"
        },
        {
            "sha": "423d3b6b4bb8319d5519dfd6bfee5e15765471c1",
            "filename": "packages/next/src/next-devtools/dev-overlay/storybook/use-overlay-reducer.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstorybook%2Fuse-overlay-reducer.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -11,6 +11,7 @@ import {\n   ACTION_DEV_INDICATOR,\n   ACTION_DEV_INDICATOR_SET,\n   ACTION_DEVTOOL_UPDATE_ROUTE_STATE,\n+  ACTION_DEVTOOLS_CONFIG,\n   ACTION_DEVTOOLS_PANEL_POSITION,\n   ACTION_DEVTOOLS_POSITION,\n   ACTION_DEVTOOLS_SCALE,\n@@ -86,6 +87,7 @@ export function useStorybookOverlayReducer(initialState?: OverlayState) {\n         case ACTION_UNHANDLED_ERROR:\n         case ACTION_UNHANDLED_REJECTION:\n         case ACTION_VERSION_INFO:\n+        case ACTION_DEVTOOLS_CONFIG:\n           return state\n         default: {\n           return action satisfies never"
        },
        {
            "sha": "5df16e2798a94feab5e6ed3c57084ffa27f79b01",
            "filename": "packages/next/src/next-devtools/dev-overlay/styles/base.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fbase.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fbase.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fstyles%2Fbase.tsx?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -1,5 +1,5 @@\n import { css } from '../utils/css'\n-import type { DevToolsScale } from '../components/errors/dev-tools-indicator/dev-tools-info/preferences'\n+import type { DevToolsScale } from '../shared'\n \n export function Base({ scale = 1 }: { scale?: DevToolsScale }) {\n   return ("
        },
        {
            "sha": "fc8947f1c820c06683c7e97996e418d3f24dea25",
            "filename": "packages/next/src/next-devtools/dev-overlay/utils/save-devtools-config.ts",
            "status": "added",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Futils%2Fsave-devtools-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Futils%2Fsave-devtools-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Futils%2Fsave-devtools-config.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -0,0 +1,47 @@\n+import type { DevToolsConfig } from '../shared'\n+import { devToolsConfigSchema } from '../../shared/devtools-config-schema'\n+import { deepMerge } from '../../shared/deepmerge'\n+\n+let queuedConfigPatch: DevToolsConfig = {}\n+let timer: ReturnType<typeof setTimeout> | null = null\n+\n+function flushPatch() {\n+  if (Object.keys(queuedConfigPatch).length === 0) {\n+    return\n+  }\n+\n+  const body = JSON.stringify(queuedConfigPatch)\n+  queuedConfigPatch = {}\n+\n+  fetch('/__nextjs_devtools_config', {\n+    method: 'POST',\n+    headers: { 'Content-Type': 'application/json' },\n+    body,\n+    // keepalive in case of fetch interrupted, e.g. navigation or reload\n+    keepalive: true,\n+  }).catch((error) => {\n+    console.warn('[Next.js DevTools] Failed to save config:', {\n+      data: body,\n+      error,\n+    })\n+  })\n+}\n+\n+export function saveDevToolsConfig(patch: DevToolsConfig) {\n+  const validation = devToolsConfigSchema.safeParse(patch)\n+  if (!validation.success) {\n+    console.warn(\n+      '[Next.js DevTools] Invalid config patch:',\n+      validation.error.message\n+    )\n+    return\n+  }\n+\n+  queuedConfigPatch = deepMerge(queuedConfigPatch, patch)\n+\n+  if (timer) {\n+    clearTimeout(timer)\n+  }\n+\n+  timer = setTimeout(flushPatch, 120)\n+}"
        },
        {
            "sha": "7dc87f4c26d592825c99fd4f5cf0d30d6db41810",
            "filename": "packages/next/src/next-devtools/server/devtools-config-middleware.ts",
            "status": "added",
            "additions": 84,
            "deletions": 0,
            "changes": 84,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fserver%2Fdevtools-config-middleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fserver%2Fdevtools-config-middleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fserver%2Fdevtools-config-middleware.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -0,0 +1,84 @@\n+import type { IncomingMessage, ServerResponse } from 'http'\n+import type { DevToolsConfig } from '../dev-overlay/shared'\n+\n+import { existsSync } from 'fs'\n+import { readFile, writeFile, mkdir } from 'fs/promises'\n+import { dirname, join } from 'path'\n+\n+import { middlewareResponse } from './middleware-response'\n+import { devToolsConfigSchema } from '../shared/devtools-config-schema'\n+import { deepMerge } from '../shared/deepmerge'\n+\n+const DEVTOOLS_CONFIG_FILENAME = 'next-devtools-config.json'\n+const DEVTOOLS_CONFIG_MIDDLEWARE_ENDPOINT = '/__nextjs_devtools_config'\n+\n+export function devToolsConfigMiddleware({\n+  distDir,\n+  sendUpdateSignal,\n+}: {\n+  distDir: string\n+  sendUpdateSignal: (data: DevToolsConfig) => void\n+}) {\n+  const configPath = join(distDir, 'cache', DEVTOOLS_CONFIG_FILENAME)\n+\n+  return async function devToolsConfigMiddlewareHandler(\n+    req: IncomingMessage,\n+    res: ServerResponse,\n+    next: () => void\n+  ): Promise<void> {\n+    const { pathname } = new URL(`http://n${req.url}`)\n+\n+    if (pathname !== DEVTOOLS_CONFIG_MIDDLEWARE_ENDPOINT) {\n+      return next()\n+    }\n+\n+    if (req.method !== 'POST') {\n+      return middlewareResponse.methodNotAllowed(res)\n+    }\n+\n+    const currentConfig = await getDevToolsConfig(distDir)\n+\n+    const chunks: Buffer[] = []\n+    for await (const chunk of req) {\n+      chunks.push(Buffer.from(chunk))\n+    }\n+\n+    let body = Buffer.concat(chunks).toString('utf8')\n+    try {\n+      body = JSON.parse(body)\n+    } catch (error) {\n+      console.error('[Next.js DevTools] Invalid config body passed:', error)\n+      return middlewareResponse.badRequest(res)\n+    }\n+\n+    const validation = devToolsConfigSchema.safeParse(body)\n+    if (!validation.success) {\n+      console.error(\n+        '[Next.js DevTools] Invalid config passed:',\n+        validation.error.message\n+      )\n+      return middlewareResponse.badRequest(res)\n+    }\n+\n+    const newConfig = deepMerge(currentConfig, validation.data)\n+    await writeFile(configPath, JSON.stringify(newConfig, null, 2))\n+\n+    sendUpdateSignal(newConfig)\n+\n+    return middlewareResponse.noContent(res)\n+  }\n+}\n+\n+export async function getDevToolsConfig(\n+  distDir: string\n+): Promise<DevToolsConfig> {\n+  const configPath = join(distDir, 'cache', DEVTOOLS_CONFIG_FILENAME)\n+\n+  if (!existsSync(configPath)) {\n+    await mkdir(dirname(configPath), { recursive: true })\n+    await writeFile(configPath, JSON.stringify({}))\n+    return {}\n+  }\n+\n+  return JSON.parse(await readFile(configPath, 'utf8'))\n+}"
        },
        {
            "sha": "a55b9480892806ff2cf0394f12f221a433241f8e",
            "filename": "packages/next/src/next-devtools/shared/deepmerge.ts",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fshared%2Fdeepmerge.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fshared%2Fdeepmerge.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fshared%2Fdeepmerge.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -0,0 +1,33 @@\n+export function deepMerge(target: any, source: any): any {\n+  if (!source || typeof source !== 'object' || Array.isArray(source)) {\n+    return source\n+  }\n+\n+  if (!target || typeof target !== 'object' || Array.isArray(target)) {\n+    return source\n+  }\n+\n+  const result = { ...target }\n+\n+  for (const key in source) {\n+    const sourceValue = source[key]\n+    const targetValue = target[key]\n+\n+    if (sourceValue !== undefined) {\n+      if (\n+        sourceValue &&\n+        typeof sourceValue === 'object' &&\n+        !Array.isArray(sourceValue) &&\n+        targetValue &&\n+        typeof targetValue === 'object' &&\n+        !Array.isArray(targetValue)\n+      ) {\n+        result[key] = deepMerge(targetValue, sourceValue)\n+      } else {\n+        result[key] = sourceValue\n+      }\n+    }\n+  }\n+\n+  return result\n+}"
        },
        {
            "sha": "fc6d4c250480b10ab7b57def8569c1fe477d8c2a",
            "filename": "packages/next/src/next-devtools/shared/devtools-config-schema.ts",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fshared%2Fdevtools-config-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fshared%2Fdevtools-config-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fshared%2Fdevtools-config-schema.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -0,0 +1,21 @@\n+import type { DevToolsConfig } from '../dev-overlay/shared'\n+import { z } from 'next/dist/compiled/zod'\n+\n+export const devToolsConfigSchema: z.ZodType<DevToolsConfig> = z.object({\n+  theme: z.enum(['light', 'dark', 'system']).optional(),\n+  disableDevIndicator: z.boolean().optional(),\n+  devToolsPosition: z\n+    .enum(['top-left', 'top-right', 'bottom-left', 'bottom-right'])\n+    .optional(),\n+  devToolsPanelPosition: z\n+    .record(\n+      z.string(),\n+      z.enum(['top-left', 'top-right', 'bottom-left', 'bottom-right'])\n+    )\n+    .optional(),\n+  devToolsPanelSize: z\n+    .record(z.string(), z.object({ width: z.number(), height: z.number() }))\n+    .optional(),\n+  scale: z.number().optional(),\n+  hideShortcut: z.string().nullable().optional(),\n+})"
        },
        {
            "sha": "2db5ed8e424eb65e5ed3554777f15a86ad4510f5",
            "filename": "packages/next/src/server/dev/hot-middleware.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-middleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-middleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-middleware.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -23,6 +23,7 @@\n // SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.\n import type { webpack } from 'next/dist/compiled/webpack/webpack'\n import type ws from 'next/dist/compiled/ws'\n+import type { DevToolsConfig } from '../../next-devtools/dev-overlay/shared'\n import { isMiddlewareFilename } from '../../build/utils'\n import type { VersionInfo } from './parse-version-info'\n import type { HMR_ACTION_TYPES } from './hot-reloader-types'\n@@ -103,11 +104,13 @@ export class WebpackHotMiddleware {\n   closed: boolean\n   versionInfo: VersionInfo\n   devtoolsFrontendUrl: string | undefined\n+  devToolsConfig: DevToolsConfig\n \n   constructor(\n     compilers: webpack.Compiler[],\n     versionInfo: VersionInfo,\n-    devtoolsFrontendUrl: string | undefined\n+    devtoolsFrontendUrl: string | undefined,\n+    devToolsConfig: DevToolsConfig\n   ) {\n     this.eventStream = new EventStream()\n     this.clientLatestStats = null\n@@ -116,6 +119,7 @@ export class WebpackHotMiddleware {\n     this.closed = false\n     this.versionInfo = versionInfo\n     this.devtoolsFrontendUrl = devtoolsFrontendUrl\n+    this.devToolsConfig = devToolsConfig || ({} as DevToolsConfig)\n \n     compilers[0].hooks.invalid.tap(\n       'webpack-hot-middleware',\n@@ -184,6 +188,10 @@ export class WebpackHotMiddleware {\n     }\n   }\n \n+  public updateDevToolsConfig(newConfig: DevToolsConfig): void {\n+    this.devToolsConfig = newConfig\n+  }\n+\n   /**\n    * To sync we use the most recent stats but also we append middleware\n    * errors. This is because it is possible that middleware fails to compile\n@@ -220,6 +228,7 @@ export class WebpackHotMiddleware {\n           devtoolsFrontendUrl: this.devtoolsFrontendUrl,\n         },\n         devIndicator: devIndicatorServerState,\n+        devToolsConfig: this.devToolsConfig,\n       })\n     }\n   }"
        },
        {
            "sha": "ea0c1db8dc1366535772fdd4e9f7511e529a12f3",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -100,6 +100,10 @@ import { backgroundLogCompilationEvents } from '../../shared/lib/turbopack/compi\n import { getSupportedBrowsers } from '../../build/utils'\n import { receiveBrowserLogsTurbopack } from './browser-logs/receive-logs'\n import { normalizePath } from '../../lib/normalize-path'\n+import {\n+  devToolsConfigMiddleware,\n+  getDevToolsConfig,\n+} from '../../next-devtools/server/devtools-config-middleware'\n \n const wsServer = new ws.Server({ noServer: true })\n const isTestMode = !!(\n@@ -658,6 +662,15 @@ export async function createHotReloaderTurbopack(\n       telemetry: opts.telemetry,\n       turbopackProject: project,\n     }),\n+    devToolsConfigMiddleware({\n+      distDir,\n+      sendUpdateSignal: (data) => {\n+        hotReloader.send({\n+          action: HMR_ACTIONS_SENT_TO_BROWSER.DEVTOOLS_CONFIG,\n+          data,\n+        })\n+      },\n+    }),\n   ]\n \n   const versionInfoPromise = getVersionInfo()\n@@ -867,6 +880,7 @@ export async function createHotReloaderTurbopack(\n \n         ;(async function () {\n           const versionInfo = await versionInfoPromise\n+          const devToolsConfig = await getDevToolsConfig(distDir)\n \n           const sync: SyncAction = {\n             action: HMR_ACTIONS_SENT_TO_BROWSER.SYNC,\n@@ -878,6 +892,7 @@ export async function createHotReloaderTurbopack(\n               devtoolsFrontendUrl,\n             },\n             devIndicator: devIndicatorServerState,\n+            devToolsConfig,\n           }\n \n           sendToClient(client, sync)"
        },
        {
            "sha": "c4309c0ba874fe1d55a4ce7e2f617c4fea11946e",
            "filename": "packages/next/src/server/dev/hot-reloader-types.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-types.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-types.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-types.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -8,6 +8,7 @@ import type { Project, Update as TurbopackUpdate } from '../../build/swc/types'\n import type { VersionInfo } from './parse-version-info'\n import type { DebugInfo } from '../../next-devtools/shared/types'\n import type { DevIndicatorServerState } from './dev-indicator-server-state'\n+import type { DevToolsConfig } from '../../next-devtools/dev-overlay/shared'\n \n export const enum HMR_ACTIONS_SENT_TO_BROWSER {\n   ADDED_PAGE = 'addedPage',\n@@ -26,6 +27,7 @@ export const enum HMR_ACTIONS_SENT_TO_BROWSER {\n   TURBOPACK_CONNECTED = 'turbopack-connected',\n   ISR_MANIFEST = 'isrManifest',\n   DEV_INDICATOR = 'devIndicator',\n+  DEVTOOLS_CONFIG = 'devtoolsConfig',\n }\n \n interface ServerErrorAction {\n@@ -58,6 +60,7 @@ export interface SyncAction {\n   updatedModules?: ReadonlyArray<string>\n   debug?: DebugInfo\n   devIndicator: DevIndicatorServerState\n+  devToolsConfig?: DevToolsConfig\n }\n interface BuiltAction {\n   action: HMR_ACTIONS_SENT_TO_BROWSER.BUILT\n@@ -119,6 +122,11 @@ export interface AppIsrManifestAction {\n   data: Record<string, boolean>\n }\n \n+export interface DevToolsConfigAction {\n+  action: HMR_ACTIONS_SENT_TO_BROWSER.DEVTOOLS_CONFIG\n+  data: DevToolsConfig\n+}\n+\n export type HMR_ACTION_TYPES =\n   | TurbopackMessageAction\n   | TurbopackConnectedAction\n@@ -135,6 +143,7 @@ export type HMR_ACTION_TYPES =\n   | DevPagesManifestUpdateAction\n   | ServerErrorAction\n   | AppIsrManifestAction\n+  | DevToolsConfigAction\n \n export type TurbopackMsgToBrowser =\n   | { type: HMR_ACTIONS_SENT_TO_BROWSER.TURBOPACK_MESSAGE; data: any }"
        },
        {
            "sha": "e42ff3c901ababb6cd7883923f50001aa1b379ac",
            "filename": "packages/next/src/server/dev/hot-reloader-webpack.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 1,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/536b6b7975238745e0a815c388a315f8b3ce8a33/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts?ref=536b6b7975238745e0a815c388a315f8b3ce8a33",
            "patch": "@@ -91,6 +91,10 @@ import getWebpackBundler from '../../shared/lib/get-webpack-bundler'\n import { getRestartDevServerMiddleware } from '../../next-devtools/server/restart-dev-server-middleware'\n import { checkPersistentCacheInvalidationAndCleanup } from '../../build/webpack/cache-invalidation'\n import { receiveBrowserLogsWebpack } from './browser-logs/receive-logs'\n+import {\n+  devToolsConfigMiddleware,\n+  getDevToolsConfig,\n+} from '../../next-devtools/server/devtools-config-middleware'\n \n const MILLISECONDS_IN_NANOSECOND = BigInt(1_000_000)\n \n@@ -815,6 +819,8 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n     // Ensure distDir exists before writing package.json\n     await fs.mkdir(this.distDir, { recursive: true })\n \n+    const initialDevToolsConfig = await getDevToolsConfig(this.distDir)\n+\n     const distPackageJsonPath = join(this.distDir, 'package.json')\n     // Ensure commonjs handling is used for files in the distDir (generally .next)\n     // Files outside of the distDir can be \"type\": \"module\"\n@@ -1553,7 +1559,8 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n     this.webpackHotMiddleware = new WebpackHotMiddleware(\n       this.multiCompiler.compilers,\n       this.versionInfo,\n-      this.devtoolsFrontendUrl\n+      this.devtoolsFrontendUrl,\n+      initialDevToolsConfig\n     )\n \n     let booted = false\n@@ -1608,6 +1615,19 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n             ? getCacheDirectories(this.activeWebpackConfigs)\n             : undefined,\n       }),\n+      devToolsConfigMiddleware({\n+        distDir: this.distDir,\n+        sendUpdateSignal: (data) => {\n+          // Update the in-memory devToolsConfig value\n+          // which will be used for the next onHMR call.\n+          this.webpackHotMiddleware?.updateDevToolsConfig(data)\n+\n+          this.send({\n+            action: HMR_ACTIONS_SENT_TO_BROWSER.DEVTOOLS_CONFIG,\n+            data,\n+          })\n+        },\n+      }),\n     ]\n   }\n "
        }
    ],
    "stats": {
        "total": 682,
        "additions": 416,
        "deletions": 266
    }
}