{
    "author": "ztanner",
    "message": "fix: isRevalidate -> isStaticGeneration in fetch cache / unstable cache (#83858)\n\nWhen fetch/`unstable_cache` are stale during ISR, we leverage `workStore.isRevalidate` to determine if we're in an ISR revalidation scope and if so, we perform a blocking revalidation.\r\n\r\nThis same scenario could happen at build time if the data cache were being leveraged during build (ie with a custom cache handler, or once we enable it in the default Next cache handler). \r\n\r\nThere's no need to distinguish between an ISR revalidation and build time prerender when checking to see if the cache entry needs to perform a blocking revalidate, so this refactors to switch to `isStaticGeneration` instead. This matches what we do in `use cache`: https://github.com/vercel/next.js/blob/1fc18244547263409a82db35edbe5908ba403410/packages/next/src/server/use-cache/use-cache-wrapper.ts#L1418",
    "sha": "e01c16079ed1233042e5dd51615cc7f2ba7d7873",
    "files": [
        {
            "sha": "dc50ed384e2b10e58ba6fcf08beec3e8b070cc68",
            "filename": "packages/next/src/server/lib/patch-fetch.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/e01c16079ed1233042e5dd51615cc7f2ba7d7873/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fpatch-fetch.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e01c16079ed1233042e5dd51615cc7f2ba7d7873/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fpatch-fetch.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fpatch-fetch.ts?ref=e01c16079ed1233042e5dd51615cc7f2ba7d7873",
            "patch": "@@ -935,7 +935,7 @@ export function createPatchedFetcher(\n             if (entry?.value && entry.value.kind === CachedRouteKind.FETCH) {\n               // when stale and is revalidating we wait for fresh data\n               // so the revalidated entry has the updated data\n-              if (workStore.isRevalidate && entry.isStale) {\n+              if (workStore.isStaticGeneration && entry.isStale) {\n                 isForegroundRevalidate = true\n               } else {\n                 if (entry.isStale) {"
        },
        {
            "sha": "b19a1839d0cbed2f963677b4e2af63f164a14641",
            "filename": "packages/next/src/server/web/spec-extension/unstable-cache.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/e01c16079ed1233042e5dd51615cc7f2ba7d7873/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Funstable-cache.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/e01c16079ed1233042e5dd51615cc7f2ba7d7873/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Funstable-cache.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fweb%2Fspec-extension%2Funstable-cache.ts?ref=e01c16079ed1233042e5dd51615cc7f2ba7d7873",
            "patch": "@@ -273,7 +273,7 @@ export function unstable_cache<T extends Callback>(\n \n                   // Attach the empty catch here so we don't get a \"unhandled promise\n                   // rejection\" warning. (Behavior is matched with patch-fetch)\n-                  if (workStore.isRevalidate) {\n+                  if (workStore.isStaticGeneration) {\n                     revalidationPromise.catch(() => {})\n                   }\n \n@@ -282,7 +282,7 @@ export function unstable_cache<T extends Callback>(\n                 }\n \n                 // Check if we need to do foreground revalidation\n-                if (workStore.isRevalidate) {\n+                if (workStore.isStaticGeneration) {\n                   // When the page is revalidating and the cache entry is stale,\n                   // we need to wait for fresh data (blocking revalidate)\n                   return workStore.pendingRevalidates[invocationKey]"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 3,
        "deletions": 3
    }
}