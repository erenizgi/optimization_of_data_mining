{
    "author": "devjiwonchoi",
    "message": "[Breaking] Rename instrumentation onRequestError `context.routeType` from `middleware` to `proxy` (#85006)\n\nFollow up on https://github.com/vercel/next.js/pull/84710,\n`instrumentation` docs had `onRequestError` function's param\n`context.routeType` has value of `'middleware'`. As it's a user-facing\nvalue, update it to `'proxy'`.",
    "sha": "b4080311f4f806c26c71d99fa45687b84777d424",
    "files": [
        {
            "sha": "ffcc3e1ebb8f05b48c9052e257e493c4a20e0157",
            "filename": "docs/01-app/03-api-reference/03-file-conventions/instrumentation.mdx",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/b4080311f4f806c26c71d99fa45687b84777d424/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Finstrumentation.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/b4080311f4f806c26c71d99fa45687b84777d424/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Finstrumentation.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F03-file-conventions%2Finstrumentation.mdx?ref=b4080311f4f806c26c71d99fa45687b84777d424",
            "patch": "@@ -93,7 +93,7 @@ export function onRequestError(\n   context: {\n     routerKind: 'Pages Router' | 'App Router' // the router type\n     routePath: string // the route file path, e.g. /app/blog/[dynamic]\n-    routeType: 'render' | 'route' | 'action' | 'middleware' // the context in which the error occurred\n+    routeType: 'render' | 'route' | 'action' | 'proxy' // the context in which the error occurred\n     renderSource:\n       | 'react-server-components'\n       | 'react-server-components-payload'\n@@ -106,7 +106,7 @@ export function onRequestError(\n \n - `error`: The caught error itself (type is always `Error`), and a `digest` property which is the unique ID of the error.\n - `request`: Read-only request information associated with the error.\n-- `context`: The context in which the error occurred. This can be the type of router (App or Pages Router), and/or (Server Components (`'render'`), Route Handlers (`'route'`), Server Actions (`'action'`), or Middleware (`'middleware'`)).\n+- `context`: The context in which the error occurred. This can be the type of router (App or Pages Router), and/or (Server Components (`'render'`), Route Handlers (`'route'`), Server Actions (`'action'`), or Proxy (`'proxy'`)).\n \n ### Specifying the runtime\n "
        },
        {
            "sha": "7526961fe65bca29c92f5286afb7b8160d2417b1",
            "filename": "packages/next/src/build/templates/middleware.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 6,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/b4080311f4f806c26c71d99fa45687b84777d424/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fmiddleware.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4080311f4f806c26c71d99fa45687b84777d424/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fmiddleware.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fmiddleware.ts?ref=b4080311f4f806c26c71d99fa45687b84777d424",
            "patch": "@@ -24,18 +24,18 @@ if (typeof handler !== 'function') {\n   )\n }\n \n-// Middleware will only sent out the FetchEvent to next server,\n-// so load instrumentation module here and track the error inside middleware module.\n+// Proxy will only sent out the FetchEvent to next server,\n+// so load instrumentation module here and track the error inside proxy module.\n function errorHandledHandler(fn: AdapterOptions['handler']) {\n   return async (...args: Parameters<AdapterOptions['handler']>) => {\n     try {\n       return await fn(...args)\n     } catch (err) {\n       // In development, error the navigation API usage in runtime,\n-      // since it's not allowed to be used in middleware as it's outside of react component tree.\n+      // since it's not allowed to be used in proxy as it's outside of react component tree.\n       if (process.env.NODE_ENV !== 'production') {\n         if (isNextRouterError(err)) {\n-          err.message = `Next.js navigation API is not allowed to be used in Middleware.`\n+          err.message = `Next.js navigation API is not allowed to be used in ${isProxy ? 'Proxy' : 'Middleware'}.`\n           throw err\n         }\n       }\n@@ -51,8 +51,8 @@ function errorHandledHandler(fn: AdapterOptions['handler']) {\n         },\n         {\n           routerKind: 'Pages Router',\n-          routePath: '/middleware',\n-          routeType: 'middleware',\n+          routePath: '/proxy',\n+          routeType: 'proxy',\n           revalidateReason: undefined,\n         }\n       )"
        },
        {
            "sha": "a9ee17a39558a0ebe8c53c24a42c1f0ba05ab092",
            "filename": "packages/next/src/server/instrumentation/types.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/b4080311f4f806c26c71d99fa45687b84777d424/packages%2Fnext%2Fsrc%2Fserver%2Finstrumentation%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b4080311f4f806c26c71d99fa45687b84777d424/packages%2Fnext%2Fsrc%2Fserver%2Finstrumentation%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Finstrumentation%2Ftypes.ts?ref=b4080311f4f806c26c71d99fa45687b84777d424",
            "patch": "@@ -1,7 +1,7 @@\n export type RequestErrorContext = {\n   routerKind: 'Pages Router' | 'App Router'\n   routePath: string // the route file path, e.g. /app/blog/[dynamic]\n-  routeType: 'render' | 'route' | 'action' | 'middleware'\n+  routeType: 'render' | 'route' | 'action' | 'proxy'\n   renderSource?:\n     | 'react-server-components'\n     | 'react-server-components-payload'"
        }
    ],
    "stats": {
        "total": 18,
        "additions": 9,
        "deletions": 9
    }
}