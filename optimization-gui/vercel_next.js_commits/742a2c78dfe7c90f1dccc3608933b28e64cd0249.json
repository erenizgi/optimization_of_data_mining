{
    "author": "lubieowoce",
    "message": "next/root-params (#80255)\n\nImplements accessing root params (params segments that occur above root\nlayouts) via compiler-generated getters from the `next/root-params`\nmodule:\n```tsx\n// app/[lang]/layout.tsx\n// (there is no app/layout.tsx, this is the root layout)\n\nimport { lang } from \"next/root-params\";\n//       ^^^^ coresponds to the [lang] segment above this module\n\nexport default async function RootLayout({ children }) {\n  return (\n    <html lang={await lang()}>\n      <body>{children}</body>\n    </html>\n  );\n}\n\n```\n- This API is only usable within server components (support for using it\nin route handlers will be added in the future). It can be called\nanywhere in the component tree, not just in a page or a layout.\n- It **cannot be used in server actions**, because they're not tied to a\nroute.\n- It will replace `unstable_rootParams`, which will be removed soon. \n\nNote that we can also have multiple root layouts with distinct params,\nlike this:\n```\napp/product/[productId]/layout.tsx\napp/brand/[brandId]/layout.tsx\n```\nIn this case we'll generate getters for both `productId` and `brandId`.\nThey can be called anywhere, but they'll return `undefined` if used in a\nsubtree where a param isn't available.\n\nNote that this PR does not yet generate type declarations for the\ngenerated getters, essentially leaving them typed as `any`. This will be\nhandled in a follow up.\n\n## Implementation notes\n\n### Turbopack\n\nWe collect the root param names when analyzing the folder structure in\n`app_structure.rs`. The set is then passed down (as a Vc) all the way to\n`next_import_map.rs`, where we insert an alias to a virtual\n`next/root-params.js` module. We use a `ImportMapping::Dynamic` to\ngenerate its code lazily in a separate turbo task (which is the only\nplace that actually reads the root params). This avoids invalidating the\nwhole `ResolveOptionsContext` if the root params change.\n\n### Webpack\n\nWe alias `next/root-params` to `next-root-params-loader`, which scans\nthe directory structure manually (i haven't found a good way to re-use\nexisting methods for doing this) and returns the generated module. Each\ndirectory we traverse before finding a root layout is marked as a\n`contextDependency`, which should invalidate the loader's result if new\nfiles are added to any of them or if they get renamed, because it might\nmean that the set of root params changed.",
    "sha": "742a2c78dfe7c90f1dccc3608933b28e64cd0249",
    "files": [
        {
            "sha": "580b4ff700a08bee086302f98b45685b49e0753c",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 19,
            "deletions": 4,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -3,8 +3,9 @@ use next_core::{\n     all_assets_from_entries,\n     app_segment_config::NextSegmentConfig,\n     app_structure::{\n-        AppPageLoaderTree, Entrypoint as AppEntrypoint, Entrypoints as AppEntrypoints,\n-        FileSystemPathVec, MetadataItem, get_entrypoints,\n+        AppPageLoaderTree, CollectedRootParams, Entrypoint as AppEntrypoint,\n+        Entrypoints as AppEntrypoints, FileSystemPathVec, MetadataItem, collect_root_params,\n+        get_entrypoints,\n     },\n     get_edge_resolve_options_context, get_next_package,\n     next_app::{\n@@ -203,6 +204,11 @@ impl AppProject {\n         )\n     }\n \n+    #[turbo_tasks::function]\n+    async fn collected_root_params(self: Vc<Self>) -> Result<Vc<CollectedRootParams>> {\n+        Ok(collect_root_params(self.app_entrypoints()))\n+    }\n+\n     #[turbo_tasks::function]\n     async fn client_module_options_context(self: Vc<Self>) -> Result<Vc<ModuleOptionsContext>> {\n         Ok(get_client_module_options_context(\n@@ -297,6 +303,7 @@ impl AppProject {\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n+            Some(self.collected_root_params()),\n         ))\n     }\n \n@@ -308,6 +315,7 @@ impl AppProject {\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n+            Some(self.collected_root_params()),\n         ))\n     }\n \n@@ -319,6 +327,7 @@ impl AppProject {\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n+            Some(self.collected_root_params()),\n         ))\n     }\n \n@@ -332,6 +341,7 @@ impl AppProject {\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n+            Some(self.collected_root_params()),\n         ))\n     }\n \n@@ -629,6 +639,7 @@ impl AppProject {\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n+            None, // root params are not available in client modules\n         ))\n     }\n \n@@ -640,6 +651,7 @@ impl AppProject {\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n+            None, // root params are not available in client modules\n         ))\n     }\n \n@@ -978,7 +990,9 @@ pub fn app_entry_point_to_route(\n     entrypoint: AppEntrypoint,\n ) -> Vc<Route> {\n     match entrypoint {\n-        AppEntrypoint::AppPage { pages, loader_tree } => Route::AppPage(\n+        AppEntrypoint::AppPage {\n+            pages, loader_tree, ..\n+        } => Route::AppPage(\n             pages\n                 .into_iter()\n                 .map(|page| AppPageRoute {\n@@ -1012,6 +1026,7 @@ pub fn app_entry_point_to_route(\n             page,\n             path,\n             root_layouts,\n+            ..\n         } => Route::AppRoute {\n             original_name: page.to_string().into(),\n             endpoint: ResolvedVc::upcast(\n@@ -1023,7 +1038,7 @@ pub fn app_entry_point_to_route(\n                 .resolved_cell(),\n             ),\n         },\n-        AppEntrypoint::AppMetadata { page, metadata } => Route::AppRoute {\n+        AppEntrypoint::AppMetadata { page, metadata, .. } => Route::AppRoute {\n             original_name: page.to_string().into(),\n             endpoint: ResolvedVc::upcast(\n                 AppEndpoint {"
        },
        {
            "sha": "58e62496a3c3ace884a7cdc0db0a444f0e226f0f",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -548,6 +548,7 @@ impl PagesProject {\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n+            None, // root params are not available in pages dir\n         ))\n     }\n \n@@ -564,6 +565,7 @@ impl PagesProject {\n             self.project().next_mode(),\n             self.project().next_config(),\n             self.project().execution_context(),\n+            None, // root params are not available in pages dir\n         ))\n     }\n "
        },
        {
            "sha": "87204aca42563c466b59a591fef693dd23295590",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -1339,6 +1339,7 @@ impl Project {\n                 self.next_mode(),\n                 self.next_config(),\n                 self.execution_context(),\n+                None, // root params can't be used in middleware\n             ),\n             Layer::new_with_user_friendly_name(\n                 rcstr!(\"middleware-edge\"),\n@@ -1399,6 +1400,7 @@ impl Project {\n                 self.next_mode(),\n                 self.next_config(),\n                 self.execution_context(),\n+                None, // root params can't be used in middleware\n             ),\n             Layer::new_with_user_friendly_name(rcstr!(\"middleware\"), rcstr!(\"Middleware\")),\n         )))\n@@ -1516,6 +1518,7 @@ impl Project {\n                 self.next_mode(),\n                 self.next_config(),\n                 self.execution_context(),\n+                None, // root params can't be used in instrumentation\n             ),\n             Layer::new_with_user_friendly_name(\n                 rcstr!(\"instrumentation\"),\n@@ -1577,6 +1580,7 @@ impl Project {\n                 self.next_mode(),\n                 self.next_config(),\n                 self.execution_context(),\n+                None, // root params can't be used in instrumentation\n             ),\n             Layer::new_with_user_friendly_name(\n                 rcstr!(\"instrumentation-edge\"),"
        },
        {
            "sha": "393b96e86efb5b611f791f5467b632e32c792acf",
            "filename": "crates/next-core/src/app_structure.rs",
            "status": "modified",
            "additions": 99,
            "deletions": 9,
            "changes": 108,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fapp_structure.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fapp_structure.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fapp_structure.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -7,7 +7,7 @@ use serde::{Deserialize, Serialize};\n use tracing::Instrument;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n-    FxIndexMap, NonLocalValue, ResolvedVc, TaskInput, TryJoinIterExt, ValueDefault, Vc,\n+    FxIndexMap, FxIndexSet, NonLocalValue, ResolvedVc, TaskInput, TryJoinIterExt, ValueDefault, Vc,\n     debug::ValueDebugFormat, fxindexmap, trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{DirectoryContent, DirectoryEntry, FileSystemEntryType, FileSystemPath};\n@@ -480,6 +480,18 @@ impl AppPageLoaderTree {\n     }\n }\n \n+#[turbo_tasks::value(transparent)]\n+#[derive(Default)]\n+pub struct RootParamVecOption(Option<Vec<RcStr>>);\n+\n+#[turbo_tasks::value_impl]\n+impl ValueDefault for RootParamVecOption {\n+    #[turbo_tasks::function]\n+    fn value_default() -> Vc<Self> {\n+        Vc::cell(Default::default())\n+    }\n+}\n+\n #[turbo_tasks::value(transparent)]\n pub struct FileSystemPathVec(Vec<FileSystemPath>);\n \n@@ -508,15 +520,18 @@ pub enum Entrypoint {\n     AppPage {\n         pages: Vec<AppPage>,\n         loader_tree: ResolvedVc<AppPageLoaderTree>,\n+        root_params: ResolvedVc<RootParamVecOption>,\n     },\n     AppRoute {\n         page: AppPage,\n         path: FileSystemPath,\n         root_layouts: ResolvedVc<FileSystemPathVec>,\n+        root_params: ResolvedVc<RootParamVecOption>,\n     },\n     AppMetadata {\n         page: AppPage,\n         metadata: MetadataItem,\n+        root_params: ResolvedVc<RootParamVecOption>,\n     },\n }\n \n@@ -528,6 +543,13 @@ impl Entrypoint {\n             Entrypoint::AppMetadata { page, .. } => page,\n         }\n     }\n+    pub fn root_params(&self) -> ResolvedVc<RootParamVecOption> {\n+        match self {\n+            Entrypoint::AppPage { root_params, .. } => *root_params,\n+            Entrypoint::AppRoute { root_params, .. } => *root_params,\n+            Entrypoint::AppMetadata { root_params, .. } => *root_params,\n+        }\n+    }\n }\n \n #[turbo_tasks::value(transparent)]\n@@ -581,13 +603,15 @@ fn add_app_page(\n     result: &mut FxIndexMap<AppPath, Entrypoint>,\n     page: AppPage,\n     loader_tree: ResolvedVc<AppPageLoaderTree>,\n+    root_params: ResolvedVc<RootParamVecOption>,\n ) {\n     let mut e = match result.entry(page.clone().into()) {\n         Entry::Occupied(e) => e,\n         Entry::Vacant(e) => {\n             e.insert(Entrypoint::AppPage {\n                 pages: vec![page],\n                 loader_tree,\n+                root_params,\n             });\n             return;\n         }\n@@ -602,6 +626,7 @@ fn add_app_page(\n         Entrypoint::AppPage {\n             pages: existing_pages,\n             loader_tree: existing_loader_tree,\n+            ..\n         } => {\n             // loader trees should always match for the same path as they are generated by a\n             // turbo tasks function\n@@ -641,6 +666,7 @@ fn add_app_route(\n     page: AppPage,\n     path: FileSystemPath,\n     root_layouts: ResolvedVc<FileSystemPathVec>,\n+    root_params: ResolvedVc<RootParamVecOption>,\n ) {\n     let e = match result.entry(page.clone().into()) {\n         Entry::Occupied(e) => e,\n@@ -649,6 +675,7 @@ fn add_app_route(\n                 page,\n                 path,\n                 root_layouts,\n+                root_params,\n             });\n             return;\n         }\n@@ -683,11 +710,16 @@ fn add_app_metadata_route(\n     result: &mut FxIndexMap<AppPath, Entrypoint>,\n     page: AppPage,\n     metadata: MetadataItem,\n+    root_params: ResolvedVc<RootParamVecOption>,\n ) {\n     let e = match result.entry(page.clone().into()) {\n         Entry::Occupied(e) => e,\n         Entry::Vacant(e) => {\n-            e.insert(Entrypoint::AppMetadata { page, metadata });\n+            e.insert(Entrypoint::AppMetadata {\n+                page,\n+                metadata,\n+                root_params,\n+            });\n             return;\n         }\n     };\n@@ -728,16 +760,34 @@ pub fn get_entrypoints(\n         get_global_metadata(app_dir, page_extensions),\n         is_global_not_found_enabled,\n         Default::default(),\n+        Default::default(),\n     )\n }\n \n+#[turbo_tasks::value(transparent)]\n+pub struct CollectedRootParams(FxIndexSet<RcStr>);\n+\n+#[turbo_tasks::function]\n+pub async fn collect_root_params(\n+    entrypoints: ResolvedVc<Entrypoints>,\n+) -> Result<Vc<CollectedRootParams>> {\n+    let mut collected_root_params = FxIndexSet::<RcStr>::default();\n+    for (_, entrypoint) in entrypoints.await?.iter() {\n+        if let Some(ref root_params) = *entrypoint.root_params().await? {\n+            collected_root_params.extend(root_params.iter().cloned());\n+        }\n+    }\n+    Ok(Vc::cell(collected_root_params))\n+}\n+\n #[turbo_tasks::function]\n fn directory_tree_to_entrypoints(\n     app_dir: FileSystemPath,\n     directory_tree: Vc<DirectoryTree>,\n     global_metadata: Vc<GlobalMetadata>,\n     is_global_not_found_enabled: Vc<bool>,\n     root_layouts: Vc<FileSystemPathVec>,\n+    root_params: Vc<RootParamVecOption>,\n ) -> Vc<Entrypoints> {\n     directory_tree_to_entrypoints_internal(\n         app_dir,\n@@ -747,6 +797,7 @@ fn directory_tree_to_entrypoints(\n         directory_tree,\n         AppPage::new(),\n         root_layouts,\n+        root_params,\n     )\n }\n \n@@ -1166,6 +1217,7 @@ async fn directory_tree_to_entrypoints_internal(\n     directory_tree: Vc<DirectoryTree>,\n     app_page: AppPage,\n     root_layouts: ResolvedVc<FileSystemPathVec>,\n+    root_params: ResolvedVc<RootParamVecOption>,\n ) -> Result<Vc<Entrypoints>> {\n     let span = tracing::info_span!(\"build layout trees\", name = display(&app_page));\n     directory_tree_to_entrypoints_internal_untraced(\n@@ -1176,6 +1228,7 @@ async fn directory_tree_to_entrypoints_internal(\n         directory_tree,\n         app_page,\n         root_layouts,\n+        root_params,\n     )\n     .instrument(span)\n     .await\n@@ -1189,6 +1242,7 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n     directory_tree: Vc<DirectoryTree>,\n     app_page: AppPage,\n     root_layouts: ResolvedVc<FileSystemPathVec>,\n+    root_params: ResolvedVc<RootParamVecOption>,\n ) -> Result<Vc<Entrypoints>> {\n     let mut result = FxIndexMap::default();\n \n@@ -1208,6 +1262,26 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n         root_layouts\n     };\n \n+    // TODO: `root_layouts` is a misnomer, they're just parent layouts\n+    let root_params = if root_params.await?.is_none() && (*root_layouts.await?).len() == 1 {\n+        // found a root layout. the params up-to-and-including this point are the root params\n+        // for all child segments\n+        ResolvedVc::cell(Some(\n+            app_page\n+                .0\n+                .iter()\n+                .filter_map(|segment| match segment {\n+                    PageSegment::Dynamic(param)\n+                    | PageSegment::CatchAll(param)\n+                    | PageSegment::OptionalCatchAll(param) => Some(param.clone()),\n+                    _ => None,\n+                })\n+                .collect::<Vec<RcStr>>(),\n+        ))\n+    } else {\n+        root_params\n+    };\n+\n     if modules.page.is_some() {\n         let app_path = AppPath::from(app_page.clone());\n \n@@ -1226,6 +1300,7 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n             &mut result,\n             app_page.complete(PageType::Page)?,\n             loader_tree.context(\"loader tree should be created for a page/default\")?,\n+            root_params,\n         );\n     }\n \n@@ -1236,6 +1311,7 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n             app_page.complete(PageType::Route)?,\n             route.clone(),\n             root_layouts,\n+            root_params,\n         );\n     }\n \n@@ -1263,6 +1339,7 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n             &mut result,\n             normalize_metadata_route(app_page)?,\n             meta,\n+            root_params,\n         );\n     }\n \n@@ -1283,6 +1360,7 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n                 &mut result,\n                 normalize_metadata_route(app_page)?,\n                 meta.clone(),\n+                root_params,\n             );\n         }\n \n@@ -1398,7 +1476,13 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n                 .clone_push_str(\"_not-found\")?\n                 .complete(PageType::Page)?;\n \n-            add_app_page(app_dir.clone(), &mut result, app_page, not_found_tree);\n+            add_app_page(\n+                app_dir.clone(),\n+                &mut result,\n+                app_page,\n+                not_found_tree,\n+                root_params,\n+            );\n         }\n     }\n \n@@ -1428,6 +1512,7 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n                     *subdirectory,\n                     child_app_page.clone(),\n                     *root_layouts,\n+                    *root_params,\n                 )\n                 .await?;\n \n@@ -1440,11 +1525,7 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n                 let mut loader_trees = Vec::new();\n \n                 for (_, entrypoint) in map.iter() {\n-                    if let Entrypoint::AppPage {\n-                        ref pages,\n-                        loader_tree: _,\n-                    } = *entrypoint\n-                    {\n+                    if let Entrypoint::AppPage { ref pages, .. } = *entrypoint {\n                         for page in pages {\n                             let app_path = AppPath::from(page.clone());\n \n@@ -1473,6 +1554,7 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n                 Entrypoint::AppPage {\n                     pages,\n                     loader_tree: _,\n+                    root_params,\n                 } => {\n                     for page in pages {\n                         let loader_tree = *loader_trees[i].await?;\n@@ -1484,28 +1566,36 @@ async fn directory_tree_to_entrypoints_internal_untraced(\n                             page.clone(),\n                             loader_tree\n                                 .context(\"loader tree should be created for a page/default\")?,\n+                            *root_params,\n                         );\n                     }\n                 }\n                 Entrypoint::AppRoute {\n                     page,\n                     path,\n                     root_layouts,\n+                    root_params,\n                 } => {\n                     add_app_route(\n                         app_dir.clone(),\n                         &mut result,\n                         page.clone(),\n                         path.clone(),\n                         *root_layouts,\n+                        *root_params,\n                     );\n                 }\n-                Entrypoint::AppMetadata { page, metadata } => {\n+                Entrypoint::AppMetadata {\n+                    page,\n+                    metadata,\n+                    root_params,\n+                } => {\n                     add_app_metadata_route(\n                         app_dir.clone(),\n                         &mut result,\n                         page.clone(),\n                         metadata.clone(),\n+                        *root_params,\n                     );\n                 }\n             }"
        },
        {
            "sha": "858744164de44f0756f45a69301543c158cf3d9c",
            "filename": "crates/next-core/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Flib.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -27,6 +27,7 @@ mod next_image;\n mod next_import_map;\n pub mod next_manifests;\n pub mod next_pages;\n+mod next_root_params;\n mod next_route_matcher;\n pub mod next_server;\n pub mod next_server_component;"
        },
        {
            "sha": "9178b505531a82ba28b73cfe4910ab5fd6f92773",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -735,6 +735,7 @@ pub struct ExperimentalConfig {\n     react_compiler: Option<ReactCompilerOptionsOrBoolean>,\n     cache_components: Option<bool>,\n     use_cache: Option<bool>,\n+    root_params: Option<bool>,\n     // ---\n     // UNSUPPORTED\n     // ---\n@@ -1605,6 +1606,16 @@ impl NextConfig {\n         )\n     }\n \n+    #[turbo_tasks::function]\n+    pub fn enable_root_params(&self) -> Vc<bool> {\n+        Vc::cell(\n+            self.experimental\n+                .root_params\n+                // rootParams should be enabled implicitly in cacheComponents.\n+                .unwrap_or(self.experimental.cache_components.unwrap_or(false)),\n+        )\n+    }\n+\n     #[turbo_tasks::function]\n     pub fn cache_kinds(&self) -> Vc<CacheKinds> {\n         let mut cache_kinds = CacheKinds::default();"
        },
        {
            "sha": "87f7580fa1b4b5b6bdf6ef0c4373e420f2859343",
            "filename": "crates/next-core/src/next_edge/context.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -19,6 +19,7 @@ use turbopack_ecmascript::chunk::EcmascriptChunkType;\n use turbopack_node::execution_context::ExecutionContext;\n \n use crate::{\n+    app_structure::CollectedRootParams,\n     mode::NextMode,\n     next_config::NextConfig,\n     next_font::local::NextFontLocalResolvePlugin,\n@@ -84,13 +85,15 @@ pub async fn get_edge_resolve_options_context(\n     mode: Vc<NextMode>,\n     next_config: Vc<NextConfig>,\n     execution_context: Vc<ExecutionContext>,\n+    collected_root_params: Option<Vc<CollectedRootParams>>,\n ) -> Result<Vc<ResolveOptionsContext>> {\n     let next_edge_import_map = get_next_edge_import_map(\n         project_path.clone(),\n         ty.clone(),\n         next_config,\n         mode,\n         execution_context,\n+        collected_root_params,\n     )\n     .to_resolved()\n     .await?;"
        },
        {
            "sha": "a448fb2c9c6f6635a955b8c249e89e13bb6f8cde",
            "filename": "crates/next-core/src/next_import_map.rs",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_import_map.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -1,6 +1,7 @@\n use std::collections::BTreeMap;\n \n use anyhow::{Context, Result};\n+use either::Either;\n use rustc_hash::FxHashMap;\n use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{FxIndexMap, ResolvedVc, Vc, fxindexmap};\n@@ -20,6 +21,7 @@ use turbopack_core::{\n use turbopack_node::execution_context::ExecutionContext;\n \n use crate::{\n+    app_structure::CollectedRootParams,\n     embed_js::{VIRTUAL_PACKAGE_NAME, next_js_fs},\n     mode::NextMode,\n     next_client::context::ClientContextType,\n@@ -29,6 +31,7 @@ use crate::{\n         GOOGLE_FONTS_INTERNAL_PREFIX, NextFontGoogleCssModuleReplacer,\n         NextFontGoogleFontFileReplacer, NextFontGoogleReplacer,\n     },\n+    next_root_params::insert_next_root_params_mapping,\n     next_server::context::ServerContextType,\n     util::NextRuntime,\n };\n@@ -238,6 +241,13 @@ pub async fn get_next_client_import_map(\n             \"next/dist/compiled/client-only\" => \"next/dist/compiled/client-only/index\".to_string(),\n         },\n     );\n+    insert_next_root_params_mapping(\n+        &mut import_map,\n+        next_config.enable_root_params(),\n+        Either::Right(ty.clone()),\n+        None,\n+    )\n+    .await?;\n \n     match ty {\n         ClientContextType::Pages { .. }\n@@ -296,6 +306,7 @@ pub async fn get_next_server_import_map(\n     next_config: Vc<NextConfig>,\n     next_mode: Vc<NextMode>,\n     execution_context: Vc<ExecutionContext>,\n+    collected_root_params: Option<Vc<CollectedRootParams>>,\n ) -> Result<Vc<ImportMap>> {\n     let mut import_map = ImportMap::empty();\n \n@@ -380,6 +391,7 @@ pub async fn get_next_server_import_map(\n         ty,\n         NextRuntime::NodeJs,\n         next_config,\n+        collected_root_params,\n     )\n     .await?;\n \n@@ -394,6 +406,7 @@ pub async fn get_next_edge_import_map(\n     next_config: Vc<NextConfig>,\n     next_mode: Vc<NextMode>,\n     execution_context: Vc<ExecutionContext>,\n+    collected_root_params: Option<Vc<CollectedRootParams>>,\n ) -> Result<Vc<ImportMap>> {\n     let mut import_map = ImportMap::empty();\n \n@@ -495,6 +508,7 @@ pub async fn get_next_edge_import_map(\n         ty.clone(),\n         NextRuntime::Edge,\n         next_config,\n+        collected_root_params,\n     )\n     .await?;\n \n@@ -603,6 +617,7 @@ async fn insert_next_server_special_aliases(\n     ty: ServerContextType,\n     runtime: NextRuntime,\n     next_config: Vc<NextConfig>,\n+    collected_root_params: Option<Vc<CollectedRootParams>>,\n ) -> Result<()> {\n     let external_cjs_if_node = move |context_dir: FileSystemPath, request: &str| match runtime {\n         NextRuntime::Edge => request_to_import_mapping(context_dir, request),\n@@ -717,6 +732,14 @@ async fn insert_next_server_special_aliases(\n         }\n     }\n \n+    insert_next_root_params_mapping(\n+        import_map,\n+        next_config.enable_root_params(),\n+        Either::Left(ty),\n+        collected_root_params,\n+    )\n+    .await?;\n+\n     import_map.insert_exact_alias(\n         \"@vercel/og\",\n         external_cjs_if_node(project_path.clone(), \"next/dist/server/og/image-response\"),"
        },
        {
            "sha": "58bfcf34200e2758dd04b7f4249b5b00b6632628",
            "filename": "crates/next-core/src/next_root_params/mod.rs",
            "status": "added",
            "additions": 244,
            "deletions": 0,
            "changes": 244,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_root_params%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_root_params%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_root_params%2Fmod.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,244 @@\n+use std::iter;\n+\n+use anyhow::{Result, anyhow};\n+use either::Either;\n+use indoc::formatdoc;\n+use itertools::Itertools;\n+use turbo_rcstr::RcStr;\n+use turbo_tasks::{ResolvedVc, Vc};\n+use turbo_tasks_fs::{FileContent, FileSystemPath};\n+use turbopack_core::{\n+    asset::AssetContent,\n+    issue::IssueExt,\n+    resolve::{\n+        ResolveResult,\n+        options::{\n+            ImportMap, ImportMapResult, ImportMapping, ImportMappingReplacement,\n+            ReplacedImportMapping,\n+        },\n+        parse::Request,\n+        pattern::Pattern,\n+    },\n+    virtual_source::VirtualSource,\n+};\n+\n+use crate::{\n+    app_structure::CollectedRootParams, embed_js::next_js_file_path,\n+    next_client::ClientContextType, next_server::ServerContextType,\n+    next_shared::resolve::InvalidImportModuleIssue,\n+};\n+\n+pub async fn insert_next_root_params_mapping(\n+    import_map: &mut ImportMap,\n+    is_root_params_enabled: Vc<bool>,\n+    ty: Either<ServerContextType, ClientContextType>,\n+    collected_root_params: Option<Vc<CollectedRootParams>>,\n+) -> Result<()> {\n+    import_map.insert_exact_alias(\n+        \"next/root-params\",\n+        get_next_root_params_mapping(is_root_params_enabled, ty, collected_root_params)\n+            .to_resolved()\n+            .await?,\n+    );\n+    Ok(())\n+}\n+\n+#[turbo_tasks::function]\n+async fn get_next_root_params_mapping(\n+    is_root_params_enabled: Vc<bool>,\n+    ty: Either<ServerContextType, ClientContextType>,\n+    collected_root_params: Option<Vc<CollectedRootParams>>,\n+) -> Result<Vc<ImportMapping>> {\n+    // This mapping goes into the global resolve options, so we want to avoid invalidating it if\n+    // value of `collected_root_params` changes (which would invalidate everything else compiled\n+    // using those resolve options!).\n+    // We can achieve this by using a dynamic import mapping\n+    // which only reads `collected_root_params` when producing a mapping result. That way, if\n+    // `collected_root_params` changes, the resolve options will remain the same, and\n+    // only the mapping result will be invalidated.\n+    let mapping = ImportMapping::Dynamic(ResolvedVc::upcast(\n+        NextRootParamsMapper::new(is_root_params_enabled, ty, collected_root_params)\n+            .to_resolved()\n+            .await?,\n+    ));\n+    Ok(mapping.cell())\n+}\n+\n+#[turbo_tasks::value]\n+struct NextRootParamsMapper {\n+    is_root_params_enabled: ResolvedVc<bool>,\n+    context_type: Either<ServerContextType, ClientContextType>,\n+    collected_root_params: Option<ResolvedVc<CollectedRootParams>>,\n+}\n+\n+#[turbo_tasks::value_impl]\n+impl NextRootParamsMapper {\n+    #[turbo_tasks::function]\n+    pub fn new(\n+        is_root_params_enabled: ResolvedVc<bool>,\n+        context_type: Either<ServerContextType, ClientContextType>,\n+        collected_root_params: Option<ResolvedVc<CollectedRootParams>>,\n+    ) -> Vc<Self> {\n+        NextRootParamsMapper {\n+            is_root_params_enabled,\n+            context_type,\n+            collected_root_params,\n+        }\n+        .cell()\n+    }\n+\n+    #[turbo_tasks::function]\n+    async fn import_map_result(self: Vc<Self>) -> Result<Vc<ImportMapResult>> {\n+        let this = self.await?;\n+        Ok({\n+            if !(*this.is_root_params_enabled.await?) {\n+                Self::invalid_import_map_result(\n+                    \"'next/root-params' can only be imported when `experimental.rootParams` is \\\n+                     enabled.\"\n+                        .into(),\n+                )\n+            } else {\n+                match &this.context_type {\n+                    Either::Left(server_ty) => match &server_ty {\n+                        ServerContextType::AppRSC { .. } | ServerContextType::AppRoute { .. } => {\n+                            let collected_root_params =\n+                                *this.collected_root_params.ok_or_else(|| {\n+                                    anyhow!(\n+                                        \"Invariant: Root params should have been collected for \\\n+                                         context {:?}. This is a bug in Next.js.\",\n+                                        server_ty.clone()\n+                                    )\n+                                })?;\n+                            Self::valid_import_map_result(collected_root_params)\n+                        }\n+                        ServerContextType::PagesData { .. }\n+                        | ServerContextType::PagesApi { .. }\n+                        | ServerContextType::Instrumentation { .. }\n+                        | ServerContextType::Middleware { .. } => {\n+                            // There's no sensible way to use root params outside of the app\n+                            // directory. TODO: make sure this error is\n+                            // consistent with webpack\n+                            Self::invalid_import_map_result(\n+                                \"'next/root-params' can only be used inside the App Directory.\"\n+                                    .into(),\n+                            )\n+                        }\n+                        _ => {\n+                            // In general, the compiler should prevent importing 'next/root-params'\n+                            // from client modules, but it doesn't catch\n+                            // everything. If an import slips through\n+                            // our validation, make it error.\n+                            Self::invalid_import_map_result(\n+                                \"'next/root-params' cannot be imported from a Client Component \\\n+                                 module. It should only be used from a Server Component.\"\n+                                    .into(),\n+                            )\n+                        }\n+                    },\n+                    Either::Right(_) => {\n+                        // In general, the compiler should prevent importing 'next/root-params' from\n+                        // client modules, but it doesn't catch everything. If an\n+                        // import slips through our validation, make it error.\n+                        Self::invalid_import_map_result(\n+                            \"'next/root-params' cannot be imported from a Client Component \\\n+                             module. It should only be used from a Server Component.\"\n+                                .into(),\n+                        )\n+                    }\n+                }\n+            }\n+        })\n+    }\n+\n+    #[turbo_tasks::function]\n+    async fn valid_import_map_result(\n+        collected_root_params: ResolvedVc<CollectedRootParams>,\n+    ) -> Result<Vc<ImportMapResult>> {\n+        let collected_root_params = collected_root_params.await?;\n+\n+        // Generate a virtual 'next/root-params' module based on the root params we collected.\n+        let module_content =\n+            // If there's no root params, export nothing.\n+            if collected_root_params.is_empty() {\n+                \"export {}\".to_string()\n+            } else {\n+                iter::once(formatdoc!(\n+                    r#\"\n+                        import {{ getRootParam }} from 'next/dist/server/request/root-params';\n+                    \"#,\n+                ))\n+                .chain(collected_root_params.iter().map(|param_name| {\n+                    formatdoc!(\n+                        r#\"\n+                            export function {PARAM_NAME}() {{\n+                                return getRootParam('{PARAM_NAME}');\n+                            }}\n+                        \"#,\n+                        PARAM_NAME = param_name,\n+                    )\n+                }))\n+                .join(\"\\n\")\n+            };\n+\n+        let virtual_source = VirtualSource::new(\n+            next_js_file_path(\"root-params.js\".into()).owned().await?,\n+            AssetContent::file(FileContent::Content(module_content.into()).cell()),\n+        )\n+        .to_resolved()\n+        .await?;\n+\n+        let import_map_result =\n+            ImportMapResult::Result(ResolveResult::source(ResolvedVc::upcast(virtual_source)));\n+        Ok(import_map_result.cell())\n+    }\n+\n+    #[turbo_tasks::function]\n+    async fn invalid_import_map_result(message: RcStr) -> Result<Vc<ImportMapResult>> {\n+        let path: FileSystemPath = next_js_file_path(\"root-params.js\".into()).owned().await?;\n+\n+        // error the compilation.\n+        InvalidImportModuleIssue {\n+            file_path: path.clone(),\n+            messages: vec![message.clone()],\n+            skip_context_message: false,\n+        }\n+        .resolved_cell()\n+        .emit();\n+\n+        // map to a dummy module that rethrows the error at runtime.\n+        let virtual_source = VirtualSource::new(\n+            path.clone(),\n+            AssetContent::file(\n+                FileContent::Content(\n+                    format!(\"throw new Error({})\", serde_json::to_string(&message)?).into(),\n+                )\n+                .cell(),\n+            ),\n+        )\n+        .to_resolved()\n+        .await?;\n+\n+        let import_map_result =\n+            ImportMapResult::Result(ResolveResult::source(ResolvedVc::upcast(virtual_source)));\n+        Ok(import_map_result.cell())\n+    }\n+}\n+\n+#[turbo_tasks::value_impl]\n+impl ImportMappingReplacement for NextRootParamsMapper {\n+    #[turbo_tasks::function]\n+    fn replace(&self, _capture: Vc<Pattern>) -> Vc<ReplacedImportMapping> {\n+        ReplacedImportMapping::Ignore.cell()\n+    }\n+\n+    #[turbo_tasks::function]\n+    async fn result(\n+        self: Vc<Self>,\n+        _lookup_path: FileSystemPath,\n+        _request: Vc<Request>,\n+    ) -> Vc<ImportMapResult> {\n+        // Delegate to an inner function that only depends on `self` --\n+        // we want to return the same cell regardless of the arguments we received here.\n+        self.import_map_result()\n+    }\n+}"
        },
        {
            "sha": "cdbd39e29d9850dff9fab1d0c1567d5392c3ebe0",
            "filename": "crates/next-core/src/next_server/context.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -42,6 +42,7 @@ use super::{\n     transforms::{get_next_server_internal_transforms_rules, get_next_server_transforms_rules},\n };\n use crate::{\n+    app_structure::CollectedRootParams,\n     mode::NextMode,\n     next_build::get_postcss_package_mapping,\n     next_client::RuntimeEntries,\n@@ -129,13 +130,15 @@ pub async fn get_server_resolve_options_context(\n     mode: Vc<NextMode>,\n     next_config: Vc<NextConfig>,\n     execution_context: Vc<ExecutionContext>,\n+    collected_root_params: Option<Vc<CollectedRootParams>>,\n ) -> Result<Vc<ResolveOptionsContext>> {\n     let next_server_import_map = get_next_server_import_map(\n         project_path.clone(),\n         ty.clone(),\n         next_config,\n         mode,\n         execution_context,\n+        collected_root_params,\n     )\n     .to_resolved()\n     .await?;"
        },
        {
            "sha": "21ff8110faf13460a524444aca4481371afd0c06",
            "filename": "crates/next-custom-transforms/src/transforms/react_server_components.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-custom-transforms%2Fsrc%2Ftransforms%2Freact_server_components.rs?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -637,7 +637,11 @@ impl ReactServerComponentValidator {\n                 Atom::from(\"next/router\"),\n             ],\n \n-            invalid_client_imports: vec![Atom::from(\"server-only\"), Atom::from(\"next/headers\")],\n+            invalid_client_imports: vec![\n+                Atom::from(\"server-only\"),\n+                Atom::from(\"next/headers\"),\n+                Atom::from(\"next/root-params\"),\n+            ],\n \n             invalid_client_lib_apis_mapping: FxHashMap::from_iter([\n                 (\"next/server\", vec![\"after\", \"unstable_rootParams\"]),"
        },
        {
            "sha": "ed3dbad606597f02b136d1d64723ee71177f5698",
            "filename": "packages/next/errors.json",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Ferrors.json",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Ferrors.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ferrors.json?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -757,5 +757,12 @@\n   \"756\": \"Route %s not found\",\n   \"757\": \"Unknown styled string type: %s\",\n   \"758\": \"Missing workStore in useDynamicRouteParams\",\n-  \"759\": \"Invariant: missing __PAGE__ segmentPath\"\n+  \"759\": \"Invariant: missing __PAGE__ segmentPath\",\n+  \"760\": \"Route %s used %s inside \\\\`\\\"use cache\\\"\\\\` or \\\\`unstable_cache\\\\`. Support for this API inside cache scopes is planned for a future version of Next.js.\",\n+  \"761\": \"%s must not be used within a client component. Next.js should be preventing it from being included in client components statically, but did not in this case.\",\n+  \"762\": \"Route %s used %s in Pages Router. This API is only available within App Router.\",\n+  \"763\": \"\\\\`unstable_rootParams\\\\` must not be used within a client component. Next.js should be preventing it from being included in client components statically, but did not in this case.\",\n+  \"764\": \"Missing workStore in %s\",\n+  \"765\": \"Route %s used %s inside a Route Handler. Support for this API in Route Handlers is planned for a future version of Next.js.\",\n+  \"766\": \"%s was used inside a Server Action. This is not supported. Functions from 'next/root-params' can only be called in the context of a route.\"\n }"
        },
        {
            "sha": "9127e21e82849d49bee569c1041a3d85edcd734d",
            "filename": "packages/next/package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fpackage.json?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -51,6 +51,8 @@\n     \"amp.d.ts\",\n     \"og.js\",\n     \"og.d.ts\",\n+    \"root-params.js\",\n+    \"root-params.d.ts\",\n     \"types.d.ts\",\n     \"types.js\",\n     \"index.d.ts\","
        },
        {
            "sha": "3290a4e85c23aa2a950cbe8b026e12bde008409a",
            "filename": "packages/next/root-params.d.ts",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Froot-params.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Froot-params.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Froot-params.d.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,2 @@\n+// The actual types need to be generated. Avoid type errors for non-existent exports before that happens.\n+declare module 'next/root-params'"
        },
        {
            "sha": "fc818a4980b40d4eff884ed936774f669ffe0102",
            "filename": "packages/next/root-params.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Froot-params.js",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Froot-params.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Froot-params.js?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,3 @@\n+throw new Error(\n+  \"This module is a placeholder for 'next/root-params' and should be replaced by the compiler. This is a bug in Next.js.\"\n+)"
        },
        {
            "sha": "a570bc51dc2c51cd341d077a316e00f4400a2219",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 90,
            "deletions": 0,
            "changes": 90,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -98,6 +98,8 @@ import { getRspackCore, getRspackReactRefresh } from '../shared/lib/get-rspack'\n import { RspackProfilingPlugin } from './webpack/plugins/rspack-profiling-plugin'\n import getWebpackBundler from '../shared/lib/get-webpack-bundler'\n import type { NextBuildContext } from './build-context'\n+import type { RootParamsLoaderOpts } from './webpack/loaders/next-root-params-loader'\n+import type { InvalidImportLoaderOpts } from './webpack/loaders/next-invalid-import-error-loader'\n \n type ExcludesFalse = <T>(x: T | false) => x is T\n type ClientEntries = {\n@@ -1364,6 +1366,7 @@ export default async function getBaseWebpackConfig(\n         'modularize-import-loader',\n         'next-barrel-loader',\n         'next-error-browser-binary-loader',\n+        'next-root-params-loader',\n       ].reduce(\n         (alias, loader) => {\n           // using multiple aliases to replace `resolveLoader.modules`\n@@ -1543,6 +1546,18 @@ export default async function getBaseWebpackConfig(\n               },\n             ]\n           : []),\n+\n+        ...getNextRootParamsRules({\n+          isRootParamsEnabled:\n+            config.experimental.rootParams ??\n+            // `experimental.dynamicIO` implies `experimental.rootParams`.\n+            config.experimental.cacheComponents ??\n+            false,\n+          isClient,\n+          appDir,\n+          pageExtensions,\n+        }),\n+\n         // TODO: FIXME: do NOT webpack 5 support with this\n         // x-ref: https://github.com/webpack/webpack/issues/11467\n         ...(!config.experimental.fullySpecified\n@@ -2754,3 +2769,78 @@ export default async function getBaseWebpackConfig(\n \n   return webpackConfig\n }\n+\n+function getNextRootParamsRules({\n+  isRootParamsEnabled,\n+  isClient,\n+  appDir,\n+  pageExtensions,\n+}: {\n+  isRootParamsEnabled: boolean\n+  isClient: boolean\n+  appDir: string | undefined\n+  pageExtensions: string[]\n+}): webpack.RuleSetRule[] {\n+  // Match resolved import of 'next/root-params'\n+  const nextRootParamsModule = path.join(NEXT_PROJECT_ROOT, 'root-params.js')\n+\n+  const createInvalidImportRule = (message: string) => {\n+    return {\n+      resource: nextRootParamsModule,\n+      loader: 'next-invalid-import-error-loader',\n+      options: {\n+        message,\n+      } satisfies InvalidImportLoaderOpts,\n+    } satisfies webpack.RuleSetRule\n+  }\n+\n+  // Hard-error if the flag is not enabled, regardless of if we're on the server or on the client.\n+  if (!isRootParamsEnabled) {\n+    return [\n+      createInvalidImportRule(\n+        \"'next/root-params' can only be imported when `experimental.rootParams` is enabled.\"\n+      ),\n+    ]\n+  }\n+\n+  // If there's no app-dir (and thus no layouts), there's no sensible way to use 'next/root-params',\n+  // because we wouldn't generate any getters.\n+  if (!appDir) {\n+    return [\n+      createInvalidImportRule(\n+        \"'next/root-params' can only be used with the App Directory.\"\n+      ),\n+    ]\n+  }\n+\n+  // In general, the compiler should prevent importing 'next/root-params' from client modules, but it doesn't catch everything.\n+  // If an import slips through our validation, make it error.\n+  const invalidClientImportRule = createInvalidImportRule(\n+    \"'next/root-params' cannot be imported from a Client Component module. It should only be used from a Server Component.\"\n+  )\n+\n+  // in the browser compilation we can skip the server rules, because we know all imports will be invalid.\n+  if (isClient) {\n+    return [invalidClientImportRule]\n+  }\n+\n+  return [\n+    {\n+      oneOf: [\n+        {\n+          resource: nextRootParamsModule,\n+          issuerLayer: shouldUseReactServerCondition as (\n+            layer: string\n+          ) => boolean,\n+          loader: 'next-root-params-loader',\n+          options: {\n+            appDir,\n+            pageExtensions,\n+          } satisfies RootParamsLoaderOpts,\n+        },\n+        // if the rule above didn't match, we're in the SSR layer (or something else that isn't server-only).\n+        invalidClientImportRule,\n+      ],\n+    },\n+  ]\n+}"
        },
        {
            "sha": "0d5d76e983a2c3fc8d059e5604fa505264a3a22a",
            "filename": "packages/next/src/build/webpack/loaders/next-invalid-import-error-loader.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 4,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-invalid-import-error-loader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-invalid-import-error-loader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-invalid-import-error-loader.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -1,4 +1,11 @@\n-export default function nextInvalidImportErrorLoader(this: any) {\n-  const { message } = this.getOptions()\n-  throw new Error(message)\n-}\n+import type webpack from 'webpack'\n+\n+export type InvalidImportLoaderOpts = { message: string }\n+\n+const nextInvalidImportErrorLoader: webpack.LoaderDefinitionFunction<InvalidImportLoaderOpts> =\n+  function () {\n+    const { message } = this.getOptions()\n+    throw new Error(message)\n+  }\n+\n+export default nextInvalidImportErrorLoader"
        },
        {
            "sha": "dc2c820b6dc4d0c268765130c9ef03e7955025a4",
            "filename": "packages/next/src/build/webpack/loaders/next-root-params-loader.ts",
            "status": "added",
            "additions": 166,
            "deletions": 0,
            "changes": 166,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-root-params-loader.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-root-params-loader.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Floaders%2Fnext-root-params-loader.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,166 @@\n+import type { webpack } from 'next/dist/compiled/webpack/webpack'\n+import * as path from 'node:path'\n+import * as fs from 'node:fs/promises'\n+import { normalizeAppPath } from '../../../shared/lib/router/utils/app-paths'\n+import { ensureLeadingSlash } from '../../../shared/lib/page-path/ensure-leading-slash'\n+import { getSegmentParam } from '../../../server/app-render/get-segment-param'\n+\n+export type RootParamsLoaderOpts = {\n+  appDir: string\n+  pageExtensions: string[]\n+}\n+\n+type CollectedRootParams = Set<string>\n+\n+const rootParamsLoader: webpack.LoaderDefinitionFunction<RootParamsLoaderOpts> =\n+  async function () {\n+    const { appDir, pageExtensions } = this.getOptions()\n+\n+    const allRootParams = await collectRootParamsFromFileSystem({\n+      appDir,\n+      pageExtensions,\n+    })\n+    // invalidate the result whenever a file/directory is added/removed inside the app dir or its subdirectories,\n+    // because that might mean that a root layout has been moved.\n+    this.addContextDependency(appDir)\n+\n+    // If there's no root params, there's nothing to generate.\n+    if (allRootParams.size === 0) {\n+      return 'export {}'\n+    }\n+\n+    // Generate a getter for each root param we found.\n+    const sortedRootParamNames = Array.from(allRootParams).sort()\n+    const content = [\n+      `import { getRootParam } from 'next/dist/server/request/root-params';`,\n+      ...sortedRootParamNames.map((paramName) => {\n+        return `export function ${paramName}() { return getRootParam('${paramName}'); }`\n+      }),\n+    ].join('\\n')\n+\n+    return content\n+  }\n+\n+export default rootParamsLoader\n+\n+async function collectRootParamsFromFileSystem(\n+  opts: Parameters<typeof findRootLayouts>[0]\n+) {\n+  return collectRootParams({\n+    appDir: opts.appDir,\n+    rootLayoutFilePaths: await findRootLayouts(opts),\n+  })\n+}\n+\n+function collectRootParams({\n+  rootLayoutFilePaths,\n+  appDir,\n+}: {\n+  rootLayoutFilePaths: string[]\n+  appDir: string\n+}): CollectedRootParams {\n+  const allRootParams: CollectedRootParams = new Set()\n+\n+  for (const rootLayoutFilePath of rootLayoutFilePaths) {\n+    const params = getParamsFromLayoutFilePath({\n+      appDir,\n+      layoutFilePath: rootLayoutFilePath,\n+    })\n+    for (const param of params) {\n+      allRootParams.add(param)\n+    }\n+  }\n+\n+  return allRootParams\n+}\n+\n+async function findRootLayouts({\n+  appDir,\n+  pageExtensions,\n+}: {\n+  appDir: string\n+  pageExtensions: string[]\n+}) {\n+  const layoutFilenameRegex = new RegExp(\n+    `^layout\\\\.(?:${pageExtensions.join('|')})$`\n+  )\n+\n+  async function visit(directory: string): Promise<string[]> {\n+    let dir: Awaited<ReturnType<(typeof fs)['readdir']>>\n+    try {\n+      dir = await fs.readdir(directory, { withFileTypes: true })\n+    } catch (err) {\n+      // If the directory was removed before we managed to read it, just ignore it.\n+      if (\n+        err &&\n+        typeof err === 'object' &&\n+        'code' in err &&\n+        err.code === 'ENOENT'\n+      ) {\n+        return []\n+      }\n+\n+      throw err\n+    }\n+\n+    const subdirectories: string[] = []\n+    for (const entry of dir) {\n+      if (entry.isDirectory()) {\n+        // Directories that start with an underscore are excluded from routing, so we shouldn't look for layouts inside.\n+        if (entry.name[0] === '_') {\n+          continue\n+        }\n+        // Parallel routes cannot occur above a layout, so they can't contain a root layout.\n+        if (entry.name[0] === '@') {\n+          continue\n+        }\n+\n+        const absolutePathname = path.join(directory, entry.name)\n+        subdirectories.push(absolutePathname)\n+      } else if (entry.isFile()) {\n+        if (layoutFilenameRegex.test(entry.name)) {\n+          // We found a root layout, so we're not going to recurse into subdirectories,\n+          // meaning that we can skip the rest of the entries.\n+          // Note that we don't need to track any of the subdirectories as dependencies --\n+          // changes in the subdirectories will only become relevant if this root layout is (re)moved,\n+          // in which case the loader will re-run, traverse deeper (because it no longer stops at this root layout)\n+          // and then track those directories as needed.\n+          const rootLayoutPath = path.join(directory, entry.name)\n+          return [rootLayoutPath]\n+        }\n+      }\n+    }\n+\n+    if (subdirectories.length === 0) {\n+      return []\n+    }\n+\n+    const subdirectoryRootLayouts = await Promise.all(\n+      subdirectories.map((subdirectory) => visit(subdirectory))\n+    )\n+    return subdirectoryRootLayouts.flat(1)\n+  }\n+\n+  return visit(appDir)\n+}\n+\n+function getParamsFromLayoutFilePath({\n+  appDir,\n+  layoutFilePath,\n+}: {\n+  appDir: string\n+  layoutFilePath: string\n+}): string[] {\n+  const rootLayoutPath = normalizeAppPath(\n+    ensureLeadingSlash(path.dirname(path.relative(appDir, layoutFilePath)))\n+  )\n+  const segments = rootLayoutPath.split('/')\n+  const paramNames: string[] = []\n+  for (const segment of segments) {\n+    const param = getSegmentParam(segment)\n+    if (param !== null) {\n+      paramNames.push(param.param)\n+    }\n+  }\n+  return paramNames\n+}"
        },
        {
            "sha": "ad16ebf69c4ee845ee1adc8597624ee5395d359b",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -404,6 +404,7 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n         taint: z.boolean().optional(),\n         prerenderEarlyExit: z.boolean().optional(),\n         proxyTimeout: z.number().gte(0).optional(),\n+        rootParams: z.boolean().optional(),\n         routerBFCache: z.boolean().optional(),\n         removeUncaughtErrorAndRejectionListeners: z.boolean().optional(),\n         validateRSCRequestHeaders: z.boolean().optional(),"
        },
        {
            "sha": "0eee820fa0522fa24000d5d36d7baf22c6892fe0",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -775,6 +775,11 @@ export interface ExperimentalConfig {\n    * @default false\n    */\n   optimizeRouterScrolling?: boolean\n+\n+  /**\n+   * Enable accessing root params via the `next/root-params` module.\n+   */\n+  rootParams?: boolean\n }\n \n export type ExportPathMap = {"
        },
        {
            "sha": "207f299b548526385d27e31c6eb403ee92fa61d6",
            "filename": "packages/next/src/server/request/root-params.ts",
            "status": "modified",
            "additions": 165,
            "deletions": 1,
            "changes": 166,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Froot-params.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Froot-params.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Frequest%2Froot-params.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -15,11 +15,12 @@ import {\n } from '../app-render/work-unit-async-storage.external'\n import { makeHangingPromise } from '../dynamic-rendering-utils'\n import type { FallbackRouteParams } from './fallback-params'\n-import type { Params } from './params'\n+import type { Params, ParamValue } from './params'\n import {\n   describeStringPropertyAccess,\n   wellKnownProperties,\n } from '../../shared/lib/utils/reflect-utils'\n+import { actionAsyncStorage } from '../app-render/action-async-storage.external'\n \n interface CacheLifetime {}\n const CachedParams = new WeakMap<CacheLifetime, Promise<Params>>()\n@@ -187,3 +188,166 @@ function makeErroringRootParams(\n \n   return promise\n }\n+\n+/**\n+ * Used for the compiler-generated `next/root-params` module.\n+ * @internal\n+ */\n+export function getRootParam(paramName: string): Promise<ParamValue> {\n+  const apiName = `\\`import('next/root-params').${paramName}()\\``\n+\n+  const workStore = workAsyncStorage.getStore()\n+  if (!workStore) {\n+    throw new InvariantError(`Missing workStore in ${apiName}`)\n+  }\n+\n+  const actionStore = actionAsyncStorage.getStore()\n+  if (actionStore) {\n+    if (actionStore.isAppRoute) {\n+      // TODO(root-params): add support for route handlers\n+      throw new Error(\n+        `Route ${workStore.route} used ${apiName} inside a Route Handler. Support for this API in Route Handlers is planned for a future version of Next.js.`\n+      )\n+    }\n+    if (actionStore.isAction) {\n+      // Actions are not fundamentally tied to a route (even if they're always submitted from some page),\n+      // so root params would be inconsistent if an action is called from multiple roots.\n+      throw new Error(\n+        `${apiName} was used inside a Server Action. This is not supported. Functions from 'next/root-params' can only be called in the context of a route.`\n+      )\n+    }\n+  }\n+\n+  const workUnitStore = workUnitAsyncStorage.getStore()\n+\n+  if (!workUnitStore) {\n+    throw new Error(\n+      `Route ${workStore.route} used ${apiName} in Pages Router. This API is only available within App Router.`\n+    )\n+  }\n+\n+  switch (workUnitStore.type) {\n+    case 'unstable-cache':\n+    case 'private-cache':\n+    case 'cache': {\n+      throw new Error(\n+        `Route ${workStore.route} used ${apiName} inside \\`\"use cache\"\\` or \\`unstable_cache\\`. Support for this API inside cache scopes is planned for a future version of Next.js.`\n+      )\n+    }\n+    case 'prerender':\n+    case 'prerender-client':\n+    case 'prerender-ppr':\n+    case 'prerender-legacy': {\n+      return createPrerenderRootParamPromise(\n+        paramName,\n+        workStore,\n+        workUnitStore,\n+        apiName\n+      )\n+    }\n+    case 'request': {\n+      break\n+    }\n+    default: {\n+      workUnitStore satisfies never\n+    }\n+  }\n+  return Promise.resolve(workUnitStore.rootParams[paramName])\n+}\n+\n+function createPrerenderRootParamPromise(\n+  paramName: string,\n+  workStore: WorkStore,\n+  prerenderStore: PrerenderStore,\n+  apiName: string\n+): Promise<ParamValue> {\n+  switch (prerenderStore.type) {\n+    case 'prerender-client': {\n+      throw new InvariantError(\n+        `${apiName} must not be used within a client component. Next.js should be preventing ${apiName} from being included in client components statically, but did not in this case.`\n+      )\n+    }\n+    case 'prerender':\n+    case 'prerender-legacy':\n+    case 'prerender-ppr':\n+    default:\n+  }\n+\n+  const underlyingParams = prerenderStore.rootParams\n+\n+  switch (prerenderStore.type) {\n+    case 'prerender': {\n+      // We are in a dynamicIO prerender.\n+      // The param is a fallback, so it should be treated as dynamic.\n+      if (\n+        prerenderStore.fallbackRouteParams &&\n+        prerenderStore.fallbackRouteParams.has(paramName)\n+      ) {\n+        return makeHangingPromise<ParamValue>(\n+          prerenderStore.renderSignal,\n+          apiName\n+        )\n+      }\n+      break\n+    }\n+    case 'prerender-ppr': {\n+      // We aren't in a dynamicIO prerender, but the param is a fallback,\n+      // so we need to make an erroring params object which will postpone/error if you access it\n+      if (\n+        prerenderStore.fallbackRouteParams &&\n+        prerenderStore.fallbackRouteParams.has(paramName)\n+      ) {\n+        return makeErroringRootParamPromise(\n+          paramName,\n+          workStore,\n+          prerenderStore,\n+          apiName\n+        )\n+      }\n+      break\n+    }\n+    case 'prerender-legacy': {\n+      // legacy prerenders can't have fallback params\n+      break\n+    }\n+    default: {\n+      prerenderStore satisfies never\n+    }\n+  }\n+\n+  // If the param is not a fallback param, we just return the statically available value.\n+  return Promise.resolve(underlyingParams[paramName])\n+}\n+\n+/** Deliberately async -- we want to create a rejected promise, not error synchronously. */\n+async function makeErroringRootParamPromise(\n+  paramName: string,\n+  workStore: WorkStore,\n+  prerenderStore: PrerenderStorePPR | PrerenderStoreLegacy,\n+  apiName: string\n+): Promise<ParamValue> {\n+  const expression = describeStringPropertyAccess(apiName, paramName)\n+  // In most dynamic APIs, we also throw if `dynamic = \"error\"`.\n+  // However, root params are only dynamic when we're generating a fallback shell,\n+  // and even with `dynamic = \"error\"` we still support generating dynamic fallback shells.\n+  // TODO: remove this comment when dynamicIO is the default since there will be no `dynamic = \"error\"`\n+  switch (prerenderStore.type) {\n+    case 'prerender-ppr': {\n+      return postponeWithTracking(\n+        workStore.route,\n+        expression,\n+        prerenderStore.dynamicTracking\n+      )\n+    }\n+    case 'prerender-legacy': {\n+      return throwToInterruptStaticGeneration(\n+        expression,\n+        workStore,\n+        prerenderStore\n+      )\n+    }\n+    default: {\n+      prerenderStore satisfies never\n+    }\n+  }\n+}"
        },
        {
            "sha": "1cecbaf3c30d7a58b9332733a81360688dd28f9d",
            "filename": "test/development/acceptance-app/fixtures/rsc-build-errors/app/server-with-errors/next-root-params/in-client-await-import/page.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Frsc-build-errors%2Fapp%2Fserver-with-errors%2Fnext-root-params%2Fin-client-await-import%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Frsc-build-errors%2Fapp%2Fserver-with-errors%2Fnext-root-params%2Fin-client-await-import%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Frsc-build-errors%2Fapp%2Fserver-with-errors%2Fnext-root-params%2Fin-client-await-import%2Fpage.js?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,10 @@\n+'use client'\n+// This currently bypasses the compile time import checks from `react_server_components.rs`,\n+// but we should still catch it during import resolution.\n+const { whatever } = await import('next/root-params')\n+\n+console.log({ whatever })\n+\n+export default function Page() {\n+  return null\n+}"
        },
        {
            "sha": "28c578062c95f30118d00256689c898050249a73",
            "filename": "test/development/acceptance-app/fixtures/rsc-build-errors/app/server-with-errors/next-root-params/in-client/page.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Frsc-build-errors%2Fapp%2Fserver-with-errors%2Fnext-root-params%2Fin-client%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Frsc-build-errors%2Fapp%2Fserver-with-errors%2Fnext-root-params%2Fin-client%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Frsc-build-errors%2Fapp%2Fserver-with-errors%2Fnext-root-params%2Fin-client%2Fpage.js?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,8 @@\n+'use client'\n+import { whatever } from 'next/root-params'\n+\n+console.log({ whatever })\n+\n+export default function Page() {\n+  return null\n+}"
        },
        {
            "sha": "3d79d65d3fddffe8b918a5ee5f812f843988f749",
            "filename": "test/development/acceptance-app/fixtures/rsc-build-errors/app/server-with-errors/next-root-params/without-flag/page.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Frsc-build-errors%2Fapp%2Fserver-with-errors%2Fnext-root-params%2Fwithout-flag%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Frsc-build-errors%2Fapp%2Fserver-with-errors%2Fnext-root-params%2Fwithout-flag%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Frsc-build-errors%2Fapp%2Fserver-with-errors%2Fnext-root-params%2Fwithout-flag%2Fpage.js?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,5 @@\n+import { whatever } from 'next/root-params'\n+\n+export default async function Page() {\n+  return <>{await whatever()}</>\n+}"
        },
        {
            "sha": "5104550c4cb466e44fff21483033c4c4267da92a",
            "filename": "test/development/acceptance-app/rsc-build-errors.test.ts",
            "status": "modified",
            "additions": 72,
            "deletions": 0,
            "changes": 72,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance-app%2Frsc-build-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance-app%2Frsc-build-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Frsc-build-errors.test.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -313,6 +313,78 @@ describe('Error overlay - RSC build errors', () => {\n     })\n   })\n \n+  describe('next/root-params', () => {\n+    const isCacheComponentsEnabled =\n+      process.env.__NEXT_EXPERIMENTAL_CACHE_COMPONENTS === 'true'\n+    it(\"importing 'next/root-params' when experimental.rootParams is not enabled\", async () => {\n+      await using sandbox = await createSandbox(\n+        next,\n+        undefined,\n+        `/server-with-errors/next-root-params/without-flag`\n+      )\n+      const { session } = sandbox\n+      await session.assertHasRedbox()\n+      if (!isCacheComponentsEnabled) {\n+        expect(await session.getRedboxSource()).toInclude(\n+          `'next/root-params' can only be imported when \\`experimental.rootParams\\` is enabled.`\n+        )\n+      } else {\n+        // in cacheComponents we auto-enable 'next/root-params', so we should get an error about using a non-existent getter instead.\n+        expect(await session.getRedboxSource()).toInclude(\n+          isTurbopack\n+            ? `Export whatever doesn't exist in target module`\n+            : `Attempted import error: 'whatever' is not exported from 'next/root-params' (imported as 'whatever').`\n+        )\n+      }\n+    })\n+\n+    it(\"importing 'next/root-params' in a client component\", async () => {\n+      await using sandbox = await createSandbox(\n+        next,\n+        // if cacheComponents is not enabled, the import is guarded behind an experimental flag\n+        isCacheComponentsEnabled\n+          ? new Map()\n+          : new Map([\n+              [\n+                'next.config.js',\n+                outdent`\n+                  module.exports = { experimental: { rootParams: true } }\n+                `,\n+              ],\n+            ]),\n+        `/server-with-errors/next-root-params/in-client`\n+      )\n+      const { session } = sandbox\n+      await session.assertHasRedbox()\n+      expect(await session.getRedboxSource()).toInclude(\n+        `You're importing a component that needs \"next/root-params\". That only works in a Server Component but one of its parents is marked with \"use client\", so it's a Client Component.`\n+      )\n+    })\n+\n+    it(\"importing 'next/root-params' in a client component in a way that bypasses import analysis\", async () => {\n+      await using sandbox = await createSandbox(\n+        next,\n+        // if cacheComponents is not enabled, the import is guarded behind an experimental flag\n+        isCacheComponentsEnabled\n+          ? new Map()\n+          : new Map([\n+              [\n+                'next.config.js',\n+                outdent`\n+                  module.exports = { experimental: { rootParams: true } }\n+                `,\n+              ],\n+            ]),\n+        `/server-with-errors/next-root-params/in-client-await-import`\n+      )\n+      const { session } = sandbox\n+      await session.assertHasRedbox()\n+      expect(await session.getRedboxSource()).toInclude(\n+        `'next/root-params' cannot be imported from a Client Component module. It should only be used from a Server Component.`\n+      )\n+    })\n+  })\n+\n   it('should error for invalid undefined module retuning from next dynamic', async () => {\n     await using sandbox = await createSandbox(\n       next,"
        },
        {
            "sha": "33ca2362571d410346ab884b5bce937c8fa97294",
            "filename": "test/development/acceptance/server-component-compiler-errors-in-pages.test.ts",
            "status": "modified",
            "additions": 93,
            "deletions": 0,
            "changes": 93,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Fserver-component-compiler-errors-in-pages.test.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -290,6 +290,99 @@ describe('Error Overlay for server components compiler errors in pages', () => {\n     }\n   })\n \n+  test(\"importing 'next/root-params' in pages\", async () => {\n+    const files = new Map([\n+      ...initialFiles,\n+      [\n+        'components/Comp.js',\n+        outdent`\n+          import { foo } from 'next/root-params'\n+\n+          export default function Page() {\n+            return 'hello world'\n+          }\n+        `,\n+      ],\n+      [\n+        // the import is guarded behind an experimental flag\n+        'next.config.js',\n+        outdent`\n+          module.exports = { experimental: { rootParams: true } }\n+        `,\n+      ],\n+    ])\n+    await using sandbox = await createSandbox(next, files)\n+    const { session } = sandbox\n+\n+    await session.assertHasRedbox()\n+    await expect(session.getRedboxSource()).resolves.toMatch(\n+      /That only works in a Server Component/\n+    )\n+\n+    if (process.env.IS_TURBOPACK_TEST) {\n+      expect(next.normalizeTestDirContent(await session.getRedboxSource()))\n+        .toMatchInlineSnapshot(`\n+       \"./components/Comp.js (1:1)\n+       Ecmascript file had an error\n+       > 1 | import { foo } from 'next/root-params'\n+           | ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+         2 |\n+         3 | export default function Page() {\n+         4 |   return 'hello world'\n+\n+       You're importing a component that needs \"next/root-params\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\n+\n+       Import traces:\n+         Browser:\n+           ./components/Comp.js\n+           ./pages/index.js\n+\n+         SSR:\n+           ./components/Comp.js\n+           ./pages/index.js\"\n+      `)\n+    } else if (isRspack) {\n+      expect(\n+        takeUpToString(\n+          next.normalizeTestDirContent(await session.getRedboxSource()),\n+          '----'\n+        )\n+      ).toMatchInlineSnapshot(`\n+       \"./components/Comp.js\n+          Module build failed:\n+             Error:   x You're importing a component that needs \"next/root-params\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\n+                  |\n+               \n+                   ,-[1:1]\n+                 1 | import { foo } from 'next/root-params'\n+                   : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+                 2 |\n+                 3 | export default function Page() {\n+                 4 |   return 'hello world'\n+                   \\`----\"\n+      `)\n+    } else {\n+      expect(\n+        takeUpToString(\n+          next.normalizeTestDirContent(await session.getRedboxSource()),\n+          'Import trace for requested module:'\n+        )\n+      ).toMatchInlineSnapshot(`\n+       \"./components/Comp.js\n+       Error:   x You're importing a component that needs \"next/root-params\". That only works in a Server Component which is not supported in the pages/ directory. Read more: https://nextjs.org/docs/app/building-your-application/rendering/server-components\n+         |\n+\n+          ,-[1:1]\n+        1 | import { foo } from 'next/root-params'\n+          : ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^\n+        2 | \n+        3 | export default function Page() {\n+        4 |   return 'hello world'\n+          \\`----\"\n+      `)\n+    }\n+  })\n+\n   describe(\"importing 'next/cache' APIs in pages\", () => {\n     test.each([\n       'revalidatePath',"
        },
        {
            "sha": "1ce0c2a801eabaaf7a728649ec9d2b096efb0b70",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/generate-static-params/app/[lang]/[locale]/layout.tsx",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,17 @@\n+import { lang, locale } from 'next/root-params'\n+import { ReactNode } from 'react'\n+\n+export default async function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html lang={`${await lang()}-${await locale()}`}>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}\n+\n+export async function generateStaticParams() {\n+  return [\n+    { lang: 'en', locale: 'us' },\n+    { lang: 'es', locale: 'es' },\n+  ]\n+}"
        },
        {
            "sha": "d75c116266dca1dd40ff3f888cb1dd02c3dc6ffd",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/generate-static-params/app/[lang]/[locale]/other/[slug]/layout.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Layout({ children }) {\n+  return <div>{children}</div>\n+}"
        },
        {
            "sha": "51a350cbc510e1e5e77fbeeccf354f285129a414",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/generate-static-params/app/[lang]/[locale]/other/[slug]/page.tsx",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,24 @@\n+import { lang, locale } from 'next/root-params'\n+import { Suspense } from 'react'\n+\n+export default async function Page({ params }) {\n+  return (\n+    <main>\n+      <p id=\"root-params\">\n+        {JSON.stringify({ lang: await lang(), locale: await locale() })}\n+      </p>\n+      <Suspense fallback=\"...\">\n+        <DynamicParams params={params} />\n+      </Suspense>\n+    </main>\n+  )\n+}\n+\n+async function DynamicParams({\n+  params,\n+}: {\n+  params: Promise<{ [key: string]: string }>\n+}) {\n+  const { slug } = await params\n+  return <p id=\"dynamic-params\">{slug}</p>\n+}"
        },
        {
            "sha": "d75c116266dca1dd40ff3f888cb1dd02c3dc6ffd",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/generate-static-params/app/[lang]/[locale]/other/layout.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Layout({ children }) {\n+  return <div>{children}</div>\n+}"
        },
        {
            "sha": "187b8651110662bfda00b5edb6b3906c2fd2165d",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/generate-static-params/app/[lang]/[locale]/other/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <div>Other Page</div>\n+}"
        },
        {
            "sha": "03a3cb12ff0b27d50423420a6989af2ba4c42a55",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/generate-static-params/app/[lang]/[locale]/page.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,10 @@\n+import { lang, locale } from 'next/root-params'\n+\n+export default async function Page() {\n+  return (\n+    <p>\n+      hello world{' '}\n+      {JSON.stringify({ lang: await lang(), locale: await locale() })}\n+    </p>\n+  )\n+}"
        },
        {
            "sha": "08122de286e65683a78a0bdc06552af3aff7483a",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/generate-static-params/next.config.ts",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fgenerate-static-params%2Fnext.config.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,9 @@\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  experimental: {\n+    cacheComponents: true, // implies `rootParams: true`.\n+  },\n+}\n+\n+export default nextConfig"
        },
        {
            "sha": "9408e24b354912d3317930b15b962f42d84cb459",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/multiple-roots/app/dashboard/[id]/layout.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Fdashboard%2F%5Bid%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Fdashboard%2F%5Bid%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Fdashboard%2F%5Bid%5D%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,13 @@\n+import { ReactNode } from 'react'\n+\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>Dashboard Root: {children}</body>\n+    </html>\n+  )\n+}\n+\n+export async function generateStaticParams() {\n+  return [{ id: '1' }]\n+}"
        },
        {
            "sha": "375d5d6897add5d978d41b12cf1ecaca1a29a2d4",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/multiple-roots/app/dashboard/[id]/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Fdashboard%2F%5Bid%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Fdashboard%2F%5Bid%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Fdashboard%2F%5Bid%5D%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,5 @@\n+import { id } from 'next/root-params'\n+\n+export default async function Page() {\n+  return <p>hello world {JSON.stringify({ id: await id() })}</p>\n+}"
        },
        {
            "sha": "ab9238c0e14de93f25fae266e1368d0b6a65db45",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/multiple-roots/app/landing/layout.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Flanding%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Flanding%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Flanding%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,9 @@\n+import { ReactNode } from 'react'\n+\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>Marketing Root: {children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "375d5d6897add5d978d41b12cf1ecaca1a29a2d4",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/multiple-roots/app/landing/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Flanding%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Flanding%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fapp%2Flanding%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,5 @@\n+import { id } from 'next/root-params'\n+\n+export default async function Page() {\n+  return <p>hello world {JSON.stringify({ id: await id() })}</p>\n+}"
        },
        {
            "sha": "6993a945b3c63e42db97b4b9893ef6088ce4e2f9",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/multiple-roots/next.config.ts",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fmultiple-roots%2Fnext.config.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,9 @@\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  experimental: {\n+    rootParams: true,\n+  },\n+}\n+\n+export default nextConfig"
        },
        {
            "sha": "1d56ad46fca0ee4632d99e5adc7390553add601b",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/[lang]/[locale]/layout.tsx",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,14 @@\n+import { lang, locale } from 'next/root-params'\n+import type { ReactNode } from 'react'\n+\n+export default async function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html lang={`${await lang()}-${await locale()}`}>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}\n+\n+export async function generateStaticParams() {\n+  return [{ lang: 'en', locale: 'us' }]\n+}"
        },
        {
            "sha": "d75c116266dca1dd40ff3f888cb1dd02c3dc6ffd",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/[lang]/[locale]/other/[slug]/layout.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Layout({ children }) {\n+  return <div>{children}</div>\n+}"
        },
        {
            "sha": "d827b8326f6f2dbaade279f593f101ed5d3a6378",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/[lang]/[locale]/other/[slug]/page.tsx",
            "status": "added",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2F%5Bslug%5D%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,30 @@\n+import { lang, locale } from 'next/root-params'\n+import { Suspense } from 'react'\n+\n+export default async function Page({ params }) {\n+  return (\n+    <div>\n+      <p>\n+        root params shouldn't need a suspense a suspense boundary\n+        <span id=\"root-params\">\n+          {JSON.stringify({\n+            lang: await lang(),\n+            locale: await locale(),\n+          })}\n+        </span>\n+      </p>\n+      <p>\n+        in <code>cacheComponents</code>, dynamic params need a suspense boundary\n+        (because we didn't provide a value in <code>generateStaticParams</code>)\n+        <Suspense>\n+          <DynamicSlug params={params} />\n+        </Suspense>\n+      </p>\n+    </div>\n+  )\n+}\n+\n+async function DynamicSlug({ params }) {\n+  const { slug } = await params\n+  return <span id=\"dynamic-params\">{slug}</span>\n+}"
        },
        {
            "sha": "d75c116266dca1dd40ff3f888cb1dd02c3dc6ffd",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/[lang]/[locale]/other/layout.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Layout({ children }) {\n+  return <div>{children}</div>\n+}"
        },
        {
            "sha": "187b8651110662bfda00b5edb6b3906c2fd2165d",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/[lang]/[locale]/other/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fother%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <div>Other Page</div>\n+}"
        },
        {
            "sha": "03a3cb12ff0b27d50423420a6989af2ba4c42a55",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/[lang]/[locale]/page.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,10 @@\n+import { lang, locale } from 'next/root-params'\n+\n+export default async function Page() {\n+  return (\n+    <p>\n+      hello world{' '}\n+      {JSON.stringify({ lang: await lang(), locale: await locale() })}\n+    </p>\n+  )\n+}"
        },
        {
            "sha": "464aceeb4f30ea89237c68e991b6241f25606243",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/[lang]/[locale]/route-handler/route.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Froute-handler%2Froute.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Froute-handler%2Froute.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Froute-handler%2Froute.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,9 @@\n+import { lang, locale } from 'next/root-params'\n+\n+export async function GET() {\n+  return Response.json(\n+    // TODO(root-params): We're missing some wiring to set `requestStore.rootParams`,\n+    // so both of these will currently return undefined\n+    { lang: await lang(), locale: await locale() }\n+  )\n+}"
        },
        {
            "sha": "3843d884c9633d99f2f43609bf65e4d75b8dc3d1",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/[lang]/[locale]/server-action/page.tsx",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fserver-action%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fserver-action%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fserver-action%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,15 @@\n+import { lang } from 'next/root-params'\n+\n+export default function Page() {\n+  return (\n+    <form\n+      action={async () => {\n+        'use server'\n+        // not allowed, should error\n+        await lang()\n+      }}\n+    >\n+      <button type=\"submit\">Submit form</button>\n+    </form>\n+  )\n+}"
        },
        {
            "sha": "8e6036fae691251bb7c850ee22c933840ac683d6",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/catch-all/[...path]/layout.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Fcatch-all%2F%5B...path%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Fcatch-all%2F%5B...path%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Fcatch-all%2F%5B...path%5D%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,13 @@\n+import type { ReactNode } from 'react'\n+\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}\n+\n+export async function generateStaticParams() {\n+  return [{ path: ['foo'] }]\n+}"
        },
        {
            "sha": "26e3128b1ac53a4a0c19a4567a12740f3add2011",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/catch-all/[...path]/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Fcatch-all%2F%5B...path%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Fcatch-all%2F%5B...path%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Fcatch-all%2F%5B...path%5D%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,5 @@\n+import { path } from 'next/root-params'\n+\n+export default async function Page() {\n+  return <p>{JSON.stringify({ path: await path() })}</p>\n+}"
        },
        {
            "sha": "ad95ca0626ec7693c27f12a8353044b50bad82d1",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/optional-catch-all/[[...path]]/layout.tsx",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Foptional-catch-all%2F%5B%5B...path%5D%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Foptional-catch-all%2F%5B%5B...path%5D%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Foptional-catch-all%2F%5B%5B...path%5D%5D%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,13 @@\n+import type { ReactNode } from 'react'\n+\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}\n+\n+export async function generateStaticParams() {\n+  return [{ path: [] }]\n+}"
        },
        {
            "sha": "26e3128b1ac53a4a0c19a4567a12740f3add2011",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/app/optional-catch-all/[[...path]]/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Foptional-catch-all%2F%5B%5B...path%5D%5D%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Foptional-catch-all%2F%5B%5B...path%5D%5D%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fapp%2Foptional-catch-all%2F%5B%5B...path%5D%5D%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,5 @@\n+import { path } from 'next/root-params'\n+\n+export default async function Page() {\n+  return <p>{JSON.stringify({ path: await path() })}</p>\n+}"
        },
        {
            "sha": "6993a945b3c63e42db97b4b9893ef6088ce4e2f9",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/simple/next.config.ts",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fsimple%2Fnext.config.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,9 @@\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  experimental: {\n+    rootParams: true,\n+  },\n+}\n+\n+export default nextConfig"
        },
        {
            "sha": "3a15cf1400fec0e34a197d8554cec1ef32bc532b",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/use-cache-build/app/[lang]/[locale]/layout.tsx",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-build%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-build%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-build%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,16 @@\n+import { ReactNode } from 'react'\n+\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}\n+\n+export async function generateStaticParams() {\n+  return [\n+    { lang: 'en', locale: 'us' },\n+    { lang: 'es', locale: 'es' },\n+  ]\n+}"
        },
        {
            "sha": "04b1b13ba03dfcac80e916460e662ae0d4cfa3ee",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/use-cache-build/app/[lang]/[locale]/use-cache/page.tsx",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-build%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fuse-cache%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-build%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fuse-cache%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-build%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fuse-cache%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,22 @@\n+import { lang, locale } from 'next/root-params'\n+\n+export default async function Page() {\n+  const rootParams = await getCachedParams()\n+  const data = await fetch(\n+    'https://next-data-api-endpoint.vercel.app/api/random'\n+  ).then((res) => res.text())\n+\n+  return (\n+    <p>\n+      <span id=\"param\">\n+        {rootParams.lang} {rootParams.locale}\n+      </span>{' '}\n+      <span id=\"random\">{data}</span>\n+    </p>\n+  )\n+}\n+\n+async function getCachedParams() {\n+  'use cache'\n+  return { lang: await lang(), locale: await locale() }\n+}"
        },
        {
            "sha": "f9ec19251f03ac8d74823c1e4d1195214e9fd1bf",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/use-cache-build/next.config.ts",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-build%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-build%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-build%2Fnext.config.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,10 @@\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  experimental: {\n+    useCache: true,\n+    rootParams: true,\n+  },\n+}\n+\n+export default nextConfig"
        },
        {
            "sha": "3a3c2e2a67e27c3591e3fd809b697e28e4cfec89",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/use-cache-runtime/app/[lang]/[locale]/layout.tsx",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Flayout.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,16 @@\n+import { ReactNode } from 'react'\n+\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}\n+\n+export function generateStaticParams() {\n+  // the param values are not accessed in tests,\n+  // we just need a value here to avoid errors in PPR/cacheComponents\n+  // where we need to provide at least one set of values for root params\n+  return [{ lang: 'foo', locale: 'bar' }]\n+}"
        },
        {
            "sha": "976352d5f58b497df8ef1e3596aa59474073037e",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/use-cache-runtime/app/[lang]/[locale]/unstable_cache/page.tsx",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Funstable_cache%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Funstable_cache%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Funstable_cache%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,34 @@\n+import { Suspense } from 'react'\n+import { lang, locale } from 'next/root-params'\n+import { connection } from 'next/server'\n+import { unstable_cache } from 'next/cache'\n+\n+export default async function Page() {\n+  return (\n+    <Suspense fallback=\"...\">\n+      <Runtime />\n+    </Suspense>\n+  )\n+}\n+\n+async function Runtime() {\n+  await connection()\n+\n+  const rootParams = await getCachedParams()\n+  const data = await fetch(\n+    'https://next-data-api-endpoint.vercel.app/api/random'\n+  ).then((res) => res.text())\n+\n+  return (\n+    <p>\n+      <span id=\"param\">\n+        {rootParams.lang} {rootParams.locale}\n+      </span>{' '}\n+      <span id=\"random\">{data}</span>\n+    </p>\n+  )\n+}\n+\n+const getCachedParams = unstable_cache(async () => {\n+  return { lang: await lang(), locale: await locale() }\n+})"
        },
        {
            "sha": "1652b55a34487888a0dc76a0c091e9d518f9c1c2",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/use-cache-runtime/app/[lang]/[locale]/use-cache/page.tsx",
            "status": "added",
            "additions": 34,
            "deletions": 0,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fuse-cache%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fuse-cache%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fapp%2F%5Blang%5D%2F%5Blocale%5D%2Fuse-cache%2Fpage.tsx?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,34 @@\n+import { lang, locale } from 'next/root-params'\n+import { connection } from 'next/server'\n+import { Suspense } from 'react'\n+\n+export default async function Page() {\n+  return (\n+    <Suspense fallback=\"Loading...\">\n+      <Runtime />\n+    </Suspense>\n+  )\n+}\n+\n+async function Runtime() {\n+  await connection()\n+\n+  const rootParams = await getCachedParams()\n+  const data = await fetch(\n+    'https://next-data-api-endpoint.vercel.app/api/random'\n+  ).then((res) => res.text())\n+\n+  return (\n+    <p>\n+      <span id=\"param\">\n+        {rootParams.lang} {rootParams.locale}\n+      </span>{' '}\n+      <span id=\"random\">{data}</span>\n+    </p>\n+  )\n+}\n+\n+async function getCachedParams() {\n+  'use cache'\n+  return { lang: await lang(), locale: await locale() }\n+}"
        },
        {
            "sha": "f9ec19251f03ac8d74823c1e4d1195214e9fd1bf",
            "filename": "test/e2e/app-dir/app-root-params-getters/fixtures/use-cache-runtime/next.config.ts",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fnext.config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fnext.config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Ffixtures%2Fuse-cache-runtime%2Fnext.config.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,10 @@\n+import type { NextConfig } from 'next'\n+\n+const nextConfig: NextConfig = {\n+  experimental: {\n+    useCache: true,\n+    rootParams: true,\n+  },\n+}\n+\n+export default nextConfig"
        },
        {
            "sha": "9e1eec4a8ffb029798ff9f49f441b97b0ff0c55c",
            "filename": "test/e2e/app-dir/app-root-params-getters/generate-static-params.test.ts",
            "status": "added",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fgenerate-static-params.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fgenerate-static-params.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fgenerate-static-params.test.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,42 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import cheerio from 'cheerio'\n+import { join } from 'path'\n+\n+describe('app-root-param-getters - generateStaticParams', () => {\n+  const { next, isNextDeploy } = nextTestSetup({\n+    files: join(__dirname, 'fixtures', 'generate-static-params'),\n+  })\n+\n+  it('should be statically prerenderable', async () => {\n+    const params = { lang: 'en', locale: 'us' }\n+    const response = await next.fetch(`/${params.lang}/${params.locale}`)\n+    expect(response.status).toBe(200)\n+    if (isNextDeploy) {\n+      expect(response.headers.get('x-vercel-cache')).toBe('PRERENDER')\n+    } else {\n+      expect(response.headers.get('x-nextjs-cache')).toBe('HIT')\n+    }\n+    const $ = cheerio.load(await response.text())\n+    expect($('p').text()).toBe(`hello world ${JSON.stringify(params)}`)\n+  })\n+\n+  it('should be part of the static shell', async () => {\n+    const params = { lang: 'en', locale: 'us' }\n+    const browser = await next.browser(\n+      `/${params.lang}/${params.locale}/other/1`,\n+      {\n+        // prevent streaming (dynamic) content from being inserted into the DOM\n+        disableJavaScript: true,\n+      }\n+    )\n+    expect(await browser.elementByCss('main > p#root-params').text()).toBe(\n+      JSON.stringify(params)\n+    )\n+  })\n+\n+  it('should allow reading root params that were not prerendered', async () => {\n+    const params = { lang: 'sth', locale: 'else' }\n+    const $ = await next.render$(`/${params.lang}/${params.locale}`)\n+    expect($('p').text()).toBe(`hello world ${JSON.stringify(params)}`)\n+  })\n+})"
        },
        {
            "sha": "6cae531ccd77c63e25280797a757b819f86f8ca3",
            "filename": "test/e2e/app-dir/app-root-params-getters/multiple-roots.test.ts",
            "status": "added",
            "additions": 133,
            "deletions": 0,
            "changes": 133,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fmultiple-roots.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fmultiple-roots.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fmultiple-roots.test.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,133 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { join } from 'path'\n+import { createSandbox } from 'development-sandbox'\n+import { outdent } from 'outdent'\n+import { retry } from '../../../lib/next-test-utils'\n+\n+describe('app-root-param-getters - multiple roots', () => {\n+  const { next, isNextDev, isTurbopack } = nextTestSetup({\n+    files: join(__dirname, 'fixtures', 'multiple-roots'),\n+  })\n+\n+  it('should have root params on dashboard pages', async () => {\n+    const $ = await next.render$('/dashboard/1')\n+    expect($('body').text()).toContain('Dashboard Root')\n+    expect($('p').text()).toBe(`hello world ${JSON.stringify({ id: '1' })}`)\n+  })\n+\n+  it('should not have root params on marketing pages', async () => {\n+    const $ = await next.render$('/landing')\n+    expect($('body').text()).toContain('Marketing Root')\n+    expect($('p').text()).toBe('hello world {}')\n+  })\n+\n+  if (isNextDev) {\n+    it('should add getters when new root layouts are added or renamed', async () => {\n+      // Start on the dashboard page, which uses root param getters.\n+      // This forces the bundler to generate 'next/root-params'.\n+      await using sandbox = await createSandbox(next, undefined, `/dashboard/1`)\n+      const { browser, session } = sandbox\n+\n+      expect(await browser.elementByCss('p').text()).toBe(\n+        `hello world ${JSON.stringify({ id: '1' })}`\n+      )\n+\n+      // Add a new root layout with a root param.\n+      // This should make the bundler re-generate 'next/root-params' with a new getter for `stuff`.\n+      const newRootLayoutFiles = new Map([\n+        [\n+          'app/new-root/[stuff]/layout.tsx',\n+          outdent`\n+            export default function Root({ children }) {\n+              return (\n+                <html>\n+                  <body>{children}</body>\n+                </html>\n+              )\n+            }\n+          `,\n+        ],\n+        [\n+          'app/new-root/[stuff]/page.tsx',\n+          // Note that we're also importing the `id` getter just to see if it's still there\n+          // (we expect it to return undefined, because we don't have that param on this route)\n+          outdent`\n+            import { id, stuff } from 'next/root-params'\n+            export default async function Page() {\n+              return (\n+                <p>hello new root: {JSON.stringify({ id: await id(), stuff: await stuff() })}</p>\n+              )\n+            }\n+\n+            export async function generateStaticParams() {\n+              return [{ stuff: '123' }]\n+            }\n+          `,\n+        ],\n+      ])\n+      for (const [filePath, fileContent] of newRootLayoutFiles) {\n+        await session.write(filePath, fileContent)\n+      }\n+\n+      // The page should call the getter and get the correct param value.\n+      await retry(async () => {\n+        const params = { stuff: '123' }\n+        await browser.get(new URL(`/new-root/${params.stuff}`, next.url).href)\n+        expect(await browser.elementByCss('p').text()).toBe(\n+          `hello new root: ${JSON.stringify(params)}`\n+        )\n+      })\n+\n+      // Change the name of the root param\n+      // This should make the bundler re-generate 'next/root-params' again, with `things` instead of `stuff`.\n+      if (isTurbopack) {\n+        // FIXME(turbopack): Something in our routing logic doesn't handle renaming a route param in turbopack mode.\n+        // I haven't found the cause for this, but `DefaultRouteMatcherManager.reload` calls\n+        // `getSortedRoutes(['/dashboard/[id]', '/new-root/[stuff]', '/new-root/[things]'])`\n+        // which makes it error because it looks like we have two overlapping routes.\n+        // I'm not sure why the previous route doesn't get removed and couldn't find a workaround,\n+        // so we're skipping the rest of the test for now.\n+        return\n+      }\n+      await session.renameFolder(\n+        'app/new-root/[stuff]',\n+        'app/new-root/[things]'\n+      )\n+\n+      // The page code we added should now be erroring, because the root param getter is called `things` now\n+      await retry(() => {\n+        expect(next.cliOutput).toContain(\n+          isTurbopack\n+            ? `Export stuff doesn't exist in target module`\n+            : `Attempted import error: 'stuff' is not exported from 'next/root-params' (imported as 'stuff').`\n+        )\n+      })\n+\n+      // Update the page to use the new root param name\n+      await session.write(\n+        'app/new-root/[things]/page.tsx',\n+        outdent`\n+            import { id, things } from 'next/root-params'\n+            export default async function Page() {\n+              return (\n+                <p>hello new root: {JSON.stringify({ id: await id(), things: await things() })}</p>\n+              )\n+            }\n+\n+            export async function generateStaticParams() {\n+              return [{ things: '123' }]\n+            }\n+          `\n+      )\n+\n+      // The page should call the getter and get the correct param value.\n+      await retry(async () => {\n+        const params = { things: '123' }\n+        await browser.get(new URL(`/new-root/${params.things}`, next.url).href)\n+        expect(await browser.elementByCss('p').text()).toBe(\n+          `hello new root: ${JSON.stringify(params)}`\n+        )\n+      })\n+    })\n+  }\n+})"
        },
        {
            "sha": "6bd705fed8fb79f643ad676a70448a8437c5a279",
            "filename": "test/e2e/app-dir/app-root-params-getters/simple.test.ts",
            "status": "added",
            "additions": 154,
            "deletions": 0,
            "changes": 154,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fsimple.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fsimple.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fsimple.test.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,154 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { assertNoRedbox, retry } from 'next-test-utils'\n+import { join } from 'path'\n+import { createSandbox } from 'development-sandbox'\n+import { outdent } from 'outdent'\n+import { createRequestTracker } from '../../../lib/e2e-utils/request-tracker'\n+\n+describe('app-root-param-getters - simple', () => {\n+  const { next, isNextDev, isTurbopack, isNextDeploy } = nextTestSetup({\n+    files: join(__dirname, 'fixtures', 'simple'),\n+  })\n+\n+  it('should allow reading root params', async () => {\n+    const params = { lang: 'en', locale: 'us' }\n+    const $ = await next.render$(`/${params.lang}/${params.locale}`)\n+    expect($('p').text()).toBe(`hello world ${JSON.stringify(params)}`)\n+  })\n+\n+  it('should allow reading root params in nested pages', async () => {\n+    const rootParams = { lang: 'en', locale: 'us' }\n+    const dynamicParams = { slug: '1' }\n+    const $ = await next.render$(\n+      `/${rootParams.lang}/${rootParams.locale}/other/${dynamicParams.slug}`\n+    )\n+    expect($('#dynamic-params').text()).toBe(dynamicParams.slug)\n+    expect($('#root-params').text()).toBe(JSON.stringify(rootParams))\n+  })\n+\n+  it('should allow reading catch-all root params', async () => {\n+    const params = { path: ['foo', 'bar'] }\n+    const $ = await next.render$(`/catch-all/${params.path.join('/')}`)\n+    expect($('p').text()).toBe(JSON.stringify(params))\n+  })\n+\n+  it('should allow reading optional catch-all root params', async () => {\n+    {\n+      const params = { path: undefined }\n+      const $ = await next.render$(`/optional-catch-all`)\n+      expect($('p').text()).toBe(JSON.stringify(params))\n+    }\n+    {\n+      const params = { path: ['foo', 'bar'] }\n+      const $ = await next.render$(\n+        `/optional-catch-all/${params.path.join('/')}`\n+      )\n+      expect($('p').text()).toBe(JSON.stringify(params))\n+    }\n+  })\n+\n+  it('should render the not found page without errors', async () => {\n+    const browser = await next.browser('/')\n+    expect(await browser.elementByCss('h2').text()).toBe(\n+      'This page could not be found.'\n+    )\n+    if (isNextDev) {\n+      await assertNoRedbox(browser)\n+    }\n+  })\n+\n+  if (isNextDev) {\n+    it('should not generate getters for non-root params', async () => {\n+      const rootParams = { lang: 'en', locale: 'us' }\n+      const dynamicParams = { slug: 'foo' }\n+\n+      await using _sandbox = await createSandbox(\n+        next,\n+        new Map([\n+          [\n+            'app/[lang]/[locale]/other/[slug]/page.tsx',\n+            outdent`\n+              import { lang, locale, slug } from 'next/root-params';\n+              export default async function Page() {\n+                return JSON.stringify({ lang: await lang(), locale: await locale(), slug: await slug() });\n+              }\n+            `,\n+          ],\n+        ]),\n+        `/${rootParams.lang}/${rootParams.locale}/other/${dynamicParams.slug}`\n+      )\n+      // Workaround: `createSandbox` stops next and does not restart it, so subsequent tests would fail\n+      afterCurrentTest(() => next.start())\n+\n+      await retry(() => {\n+        expect(next.cliOutput).toContain(\n+          isTurbopack\n+            ? `Export slug doesn't exist in target module`\n+            : `Attempted import error: 'slug' is not exported from 'next/root-params' (imported as 'slug').`\n+        )\n+      })\n+    })\n+  }\n+\n+  it('should error when used in a server action', async () => {\n+    const params = { lang: 'en', locale: 'us' }\n+    const browser = await next.browser(\n+      `/${params.lang}/${params.locale}/server-action`\n+    )\n+    const tracker = createRequestTracker(browser)\n+    const [, response] = await tracker.captureResponse(\n+      async () => {\n+        await browser.elementByCss('button[type=\"submit\"]').click()\n+      },\n+      {\n+        request: {\n+          method: 'POST',\n+          pathname: `/${params.lang}/${params.locale}/server-action`,\n+        },\n+      }\n+    )\n+    expect(response.status()).toBe(500)\n+    if (!isNextDeploy) {\n+      expect(next.cliOutput).toInclude(\n+        \"`import('next/root-params').lang()` was used inside a Server Action. This is not supported. Functions from 'next/root-params' can only be called in the context of a route.\"\n+      )\n+    }\n+  })\n+\n+  // TODO(root-params): add support for route handlers\n+  it('should error when used in a route handler (until we implement it)', async () => {\n+    const params = { lang: 'en', locale: 'us' }\n+    const response = await next.fetch(\n+      `/${params.lang}/${params.locale}/route-handler`\n+    )\n+    expect(response.status).toBe(500)\n+    if (!isNextDeploy) {\n+      expect(next.cliOutput).toInclude(\n+        \"Route /[lang]/[locale]/route-handler used `import('next/root-params').lang()` inside a Route Handler. Support for this API in Route Handlers is planned for a future version of Next.js.\"\n+      )\n+    }\n+  })\n+})\n+\n+/** Run cleanup after the current test. */\n+const createAfterCurrentTest = () => {\n+  type Callback = () => void | Promise<void>\n+  let callbacks: Callback[] = []\n+\n+  afterEach(async () => {\n+    if (!callbacks.length) {\n+      return\n+    }\n+    const currentCallbacks = callbacks\n+    callbacks = []\n+    for (const callback of currentCallbacks) {\n+      await callback()\n+    }\n+  })\n+\n+  return function afterCurrentTest(cb: () => void | Promise<void>) {\n+    callbacks.push(cb)\n+  }\n+}\n+\n+const afterCurrentTest = createAfterCurrentTest()"
        },
        {
            "sha": "3b3dcdf6cfbf3794b515bfbc75e61eebedbcad8f",
            "filename": "test/e2e/app-dir/app-root-params-getters/use-cache.test.ts",
            "status": "added",
            "additions": 92,
            "deletions": 0,
            "changes": 92,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fuse-cache.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fuse-cache.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-root-params-getters%2Fuse-cache.test.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -0,0 +1,92 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { join } from 'path'\n+import { createSandbox } from 'development-sandbox'\n+\n+describe('app-root-param-getters - cache - at runtime', () => {\n+  const { next, isNextDev, skipped } = nextTestSetup({\n+    files: join(__dirname, 'fixtures', 'use-cache-runtime'),\n+    skipStart: true,\n+    // this test asserts on build failure logs, which aren't currently observable in `next.cliOutput`.\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) return\n+\n+  if (isNextDev) {\n+    it('should error when using root params within a \"use cache\" - dev', async () => {\n+      await using sandbox = await createSandbox(\n+        next,\n+        undefined,\n+        '/en/us/use-cache'\n+      )\n+      const { session } = sandbox\n+      await session.assertHasRedbox()\n+      expect(await session.getRedboxDescription()).toInclude(\n+        'Route /[lang]/[locale]/use-cache used `import(\\'next/root-params\\').lang()` inside `\"use cache\"` or `unstable_cache`'\n+      )\n+    })\n+\n+    it('should error when using root params within `unstable_cache` - dev', async () => {\n+      await using sandbox = await createSandbox(\n+        next,\n+        undefined,\n+        '/en/us/unstable_cache'\n+      )\n+      const { session } = sandbox\n+      await session.assertHasRedbox()\n+      expect(await session.getRedboxDescription()).toInclude(\n+        'Route /[lang]/[locale]/unstable_cache used `import(\\'next/root-params\\').lang()` inside `\"use cache\"` or `unstable_cache`'\n+      )\n+    })\n+  } else {\n+    beforeAll(async () => {\n+      try {\n+        await next.start()\n+      } catch (err) {\n+        // if (isPPREnabled) {\n+        //   throw err\n+        // } else {\n+        //   // in PPR/cacheComponents, we expect the build to fail,\n+        //   // so we swallow the error and let the tests assert on the logs\n+        // }\n+      }\n+    })\n+\n+    it('should error when using root params within a \"use cache\" - start', async () => {\n+      await next.render$('/en/us/use-cache')\n+      expect(next.cliOutput).toInclude(\n+        'Error: Route /[lang]/[locale]/use-cache used `import(\\'next/root-params\\').lang()` inside `\"use cache\"` or `unstable_cache`'\n+      )\n+    })\n+\n+    it('should error when using root params within `unstable_cache` - start', async () => {\n+      await next.render$('/en/us/unstable_cache')\n+      expect(next.cliOutput).toInclude(\n+        'Error: Route /[lang]/[locale]/unstable_cache used `import(\\'next/root-params\\').lang()` inside `\"use cache\"` or `unstable_cache`'\n+      )\n+    })\n+  }\n+})\n+\n+describe('app-root-param-getters - cache - at build', () => {\n+  const { next, isNextDev } = nextTestSetup({\n+    files: join(__dirname, 'fixtures', 'use-cache-build'),\n+    skipStart: true,\n+  })\n+\n+  if (isNextDev) {\n+    // we omit these tests in dev because they are duplicates semantically to the runtime fixture tested above\n+    it('noop in dev', () => {})\n+  } else {\n+    it('should error when building a project that uses root params within `\"use cache\"`', async () => {\n+      try {\n+        await next.start()\n+      } catch {\n+        // we expect the build to fail\n+      }\n+      expect(next.cliOutput).toInclude(\n+        'Error: Route /[lang]/[locale]/use-cache used `import(\\'next/root-params\\').lang()` inside `\"use cache\"` or `unstable_cache`'\n+      )\n+    })\n+  }\n+})"
        },
        {
            "sha": "c6308081c55a12c4227daa602dc3096d46a42d49",
            "filename": "test/lib/development-sandbox.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Flib%2Fdevelopment-sandbox.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/742a2c78dfe7c90f1dccc3608933b28e64cd0249/test%2Flib%2Fdevelopment-sandbox.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fdevelopment-sandbox.ts?ref=742a2c78dfe7c90f1dccc3608933b28e64cd0249",
            "patch": "@@ -127,6 +127,9 @@ export async function createSandbox(\n         async remove(filename) {\n           await next.deleteFile(filename)\n         },\n+        async renameFolder(...args: Parameters<(typeof next)['renameFolder']>) {\n+          await next.renameFolder(...args)\n+        },\n         evaluate,\n         async assertHasRedbox() {\n           return assertHasRedbox(browser)"
        }
    ],
    "stats": {
        "total": 1883,
        "additions": 1863,
        "deletions": 20
    }
}