{
    "author": "mischnic",
    "message": "Turbopack: sync NFT context configs (#82781)\n\nKeep Turbopack's NFT resolve options in sync with the NFT unit tests so that we are actually asserting the production behvior.",
    "sha": "c00f7325dbc90bbb304b3d4dce1a588e41d0eb9a",
    "files": [
        {
            "sha": "fcf2bce94a4b17493c6fb8f7255464c6f736dbd4",
            "filename": "turbopack/crates/turbopack/src/lib.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/c00f7325dbc90bbb304b3d4dce1a588e41d0eb9a/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c00f7325dbc90bbb304b3d4dce1a588e41d0eb9a/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs?ref=c00f7325dbc90bbb304b3d4dce1a588e41d0eb9a",
            "patch": "@@ -670,12 +670,13 @@ async fn externals_tracing_module_context(\n     compile_time_info: Vc<CompileTimeInfo>,\n ) -> Result<Vc<ModuleAssetContext>> {\n     let resolve_options = ResolveOptionsContext {\n+        enable_node_native_modules: true,\n         emulate_environment: Some(compile_time_info.await?.environment),\n         loose_errors: true,\n         custom_conditions: match ty {\n-            ExternalType::CommonJs => vec![rcstr!(\"require\")],\n-            ExternalType::EcmaScriptModule => vec![rcstr!(\"import\")],\n-            ExternalType::Url | ExternalType::Global | ExternalType::Script => vec![],\n+            ExternalType::CommonJs => vec![rcstr!(\"require\"), rcstr!(\"node\")],\n+            ExternalType::EcmaScriptModule => vec![rcstr!(\"import\"), rcstr!(\"node\")],\n+            ExternalType::Url | ExternalType::Global | ExternalType::Script => vec![rcstr!(\"node\")],\n         },\n         ..Default::default()\n     };\n@@ -688,11 +689,14 @@ async fn externals_tracing_module_context(\n         // are actually representative of what Turbopack does.\n         ModuleOptionsContext {\n             ecmascript: EcmascriptOptionsContext {\n+                // enable_types should not be enabled here. It gets set automatically when a TS file\n+                // is encountered.\n                 source_maps: SourceMapsType::None,\n                 ..Default::default()\n             },\n             css: CssOptionsContext {\n                 source_maps: SourceMapsType::None,\n+                enable_raw_css: true,\n                 ..Default::default()\n             },\n             // Environment is not passed in order to avoid downleveling JS / CSS for"
        },
        {
            "sha": "a937a1d353bc2ef51e8c859ac4861b58a12b1a28",
            "filename": "turbopack/crates/turbopack/tests/node-file-trace.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 3,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/c00f7325dbc90bbb304b3d4dce1a588e41d0eb9a/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c00f7325dbc90bbb304b3d4dce1a588e41d0eb9a/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Ftests%2Fnode-file-trace.rs?ref=c00f7325dbc90bbb304b3d4dce1a588e41d0eb9a",
            "patch": "@@ -338,9 +338,10 @@ async fn node_file_trace_operation(\n     ));\n     let module_asset_context = ModuleAssetContext::new(\n         Default::default(),\n-        // TODO It's easy to make a mistake here as this should match the config in the\n-        // binary. TODO These test cases should move into the\n-        // `node-file-trace` crate and use the same config.\n+        // TODO These test cases should move into the `node-file-trace` crate and use the same\n+        // config.\n+        // It's easy to make a mistake here as this should match the config in the binary from\n+        // turbopack/crates/turbopack/src/lib.rs\n         CompileTimeInfo::new(environment),\n         ModuleOptionsContext {\n             ecmascript: EcmascriptOptionsContext {"
        }
    ],
    "stats": {
        "total": 17,
        "additions": 11,
        "deletions": 6
    }
}