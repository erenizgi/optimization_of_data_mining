{
    "author": "ijjk",
    "message": "Update PPR cases with adapter config (#83595)\n\nContinues https://github.com/vercel/next.js/pull/82919 from testing\nfixing `fallback` value missing the extension and `/` app route not\nbeing mapping to it's output file correctly. This also adds a test suite\nwith PPR enabled to catch these cases.",
    "sha": "22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a",
    "files": [
        {
            "sha": "527386dfb41efb4df0b538864c89bb20e9b0999e",
            "filename": "packages/next/src/build/adapter/build-complete.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a/packages%2Fnext%2Fsrc%2Fbuild%2Fadapter%2Fbuild-complete.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a/packages%2Fnext%2Fsrc%2Fbuild%2Fadapter%2Fbuild-complete.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fadapter%2Fbuild-complete.ts?ref=22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a",
            "patch": "@@ -795,7 +795,7 @@ export async function handleBuildComplete({\n \n         let filePath = path.join(\n           isAppPage ? appDistDir : pagesDistDir,\n-          `${route}.${isAppPage && !dataRoute ? 'body' : 'html'}`\n+          `${route === '/' ? 'index' : route}.${isAppPage && !dataRoute ? 'body' : 'html'}`\n         )\n \n         // we use the static 404 for notFound: true if available\n@@ -933,7 +933,9 @@ export async function handleBuildComplete({\n               ? {\n                   filePath: path.join(\n                     isAppPage ? appDistDir : pagesDistDir,\n-                    fallback\n+                    // app router dynamic route fallbacks don't have the\n+                    // extension so ensure it's added here\n+                    fallback.endsWith('.html') ? fallback : `${fallback}.html`\n                   ),\n                   initialStatus: fallbackStatus,\n                   initialHeaders: {"
        },
        {
            "sha": "80272d1fbc909ea1d9e0f6a7a47c57ad38ef6d62",
            "filename": "test/production/adapter-config/adapter-config-ppr.test.ts",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a/test%2Fproduction%2Fadapter-config%2Fadapter-config-ppr.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a/test%2Fproduction%2Fadapter-config%2Fadapter-config-ppr.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fadapter-config-ppr.test.ts?ref=22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a",
            "patch": "@@ -0,0 +1,2 @@\n+process.env.TEST_PPR = '1'\n+require('./adapter-config.test')"
        },
        {
            "sha": "ad715d548997982db014531788c62c53e5b2dd85",
            "filename": "test/production/adapter-config/app/page.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a/test%2Fproduction%2Fadapter-config%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a/test%2Fproduction%2Fadapter-config%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fapp%2Fpage.tsx?ref=22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Page() {\n+  return (\n+    <>\n+      <p>/</p>\n+      <p>now: {Date.now()}</p>\n+    </>\n+  )\n+}"
        },
        {
            "sha": "533157c69e1e16d8a0c05a054fb4f98581ffc3e2",
            "filename": "test/production/adapter-config/next.config.mjs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a/test%2Fproduction%2Fadapter-config%2Fnext.config.mjs",
            "raw_url": "https://github.com/vercel/next.js/raw/22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a/test%2Fproduction%2Fadapter-config%2Fnext.config.mjs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fadapter-config%2Fnext.config.mjs?ref=22bd9dec085bcc7bbdd0849169cdc5adfcd3a86a",
            "patch": "@@ -5,6 +5,7 @@ const require = Module.createRequire(import.meta.url)\n const nextConfig = {\n   experimental: {\n     adapterPath: require.resolve('./my-adapter.mjs'),\n+    ppr: Boolean(process.env.TEST_PPR),\n   },\n }\n "
        }
    ],
    "stats": {
        "total": 17,
        "additions": 15,
        "deletions": 2
    }
}