{
    "author": "eps1lon",
    "message": "[test] Use new Redbox matchers in pages/ gssp-ssr-change-reloading (#76788)",
    "sha": "c9d93c45d215d7d095890a7c0424abf3a847be48",
    "files": [
        {
            "sha": "3b2148cc70fd09faf8834afce3b572c128ecfa05",
            "filename": "test/development/basic/gssp-ssr-change-reloading/test/index.test.ts",
            "status": "modified",
            "additions": 33,
            "deletions": 12,
            "changes": 45,
            "blob_url": "https://github.com/vercel/next.js/blob/c9d93c45d215d7d095890a7c0424abf3a847be48/test%2Fdevelopment%2Fbasic%2Fgssp-ssr-change-reloading%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c9d93c45d215d7d095890a7c0424abf3a847be48/test%2Fdevelopment%2Fbasic%2Fgssp-ssr-change-reloading%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Fgssp-ssr-change-reloading%2Ftest%2Findex.test.ts?ref=c9d93c45d215d7d095890a7c0424abf3a847be48",
            "patch": "@@ -3,12 +3,7 @@\n import { join } from 'path'\n import webdriver from 'next-webdriver'\n import { createNext, FileRef } from 'e2e-utils'\n-import {\n-  assertHasRedbox,\n-  assertNoRedbox,\n-  check,\n-  getRedboxHeader,\n-} from 'next-test-utils'\n+import { assertNoRedbox, check } from 'next-test-utils'\n import { NextInstance } from 'e2e-utils'\n \n const installCheckVisible = (browser) => {\n@@ -276,10 +271,22 @@ describe('GS(S)P Server-Side Change Reloading', () => {\n \n     try {\n       await next.patchFile(page, originalContent.replace('props:', 'propss:'))\n-      await assertHasRedbox(browser)\n-      expect(await getRedboxHeader(browser)).toContain(\n-        'Additional keys were returned from'\n-      )\n+\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error: Additional keys were returned from \\`getStaticProps\\`. Properties intended for your component must be nested under the \\`props\\` key, e.g.:\n+\n+       \treturn { props: { title: 'My Title', content: '...' } }\n+\n+       Keys that need to be moved: propss.\n+       Read more: https://nextjs.org/docs/messages/invalid-getstaticprops-value\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Runtime Error\",\n+         \"source\": null,\n+         \"stack\": [],\n+       }\n+      `)\n \n       await next.patchFile(page, originalContent)\n       await assertNoRedbox(browser)\n@@ -306,8 +313,22 @@ describe('GS(S)P Server-Side Change Reloading', () => {\n           'throw new Error(\"custom oops\"); const count'\n         )\n       )\n-      await assertHasRedbox(browser)\n-      expect(await getRedboxHeader(browser)).toContain('custom oops')\n+\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error: custom oops\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Runtime Error\",\n+         \"source\": \"pages/index.js (18:9) @ getStaticProps\n+       > 18 |   throw new Error(\"custom oops\"); const count = 1\n+            |         ^\",\n+         \"stack\": [\n+           \"getStaticProps pages/index.js (18:9)\",\n+         ],\n+       }\n+      `)\n+      expect(next.cliOutput).toMatch(/custom oops/)\n \n       await next.patchFile(page, originalContent)\n       await assertNoRedbox(browser)"
        },
        {
            "sha": "5b996d4b30cdafa6c0031a533087d9ef1641132e",
            "filename": "test/e2e/prerender.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/c9d93c45d215d7d095890a7c0424abf3a847be48/test%2Fe2e%2Fprerender.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c9d93c45d215d7d095890a7c0424abf3a847be48/test%2Fe2e%2Fprerender.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fprerender.test.ts?ref=c9d93c45d215d7d095890a7c0424abf3a847be48",
            "patch": "@@ -1152,28 +1152,6 @@ describe('Prerender', () => {\n         expect(JSON.parse($2('#__NEXT_DATA__').text()).isFallback).toBe(false)\n       })\n \n-      it('should log error in console and browser in development mode', async () => {\n-        const browser = await webdriver(next.url, '/')\n-        expect(await browser.elementByCss('p').text()).toMatch(/hello.*?world/)\n-\n-        await next.patchFile(\n-          'pages/index.js',\n-          (content) => content.replace('// throw new', 'throw new'),\n-          async () => {\n-            // we need to reload the page to trigger getStaticProps\n-            await browser.refresh()\n-\n-            return retry(async () => {\n-              await assertHasRedbox(browser)\n-              const errOverlayContent = await getRedboxHeader(browser)\n-              const errorMsg = /oops from getStaticProps/\n-              expect(next.cliOutput).toMatch(errorMsg)\n-              expect(errOverlayContent).toMatch(errorMsg)\n-            })\n-          }\n-        )\n-      })\n-\n       it('should always call getStaticProps without caching in dev', async () => {\n         const initialRes = await fetchViaHTTP(next.url, '/something')\n         expect(isCachingHeader(initialRes.headers.get('cache-control'))).toBe("
        },
        {
            "sha": "d79b8e1315fc8fe494c03c96fc515783d529d74a",
            "filename": "test/e2e/prerender/pages/index.js",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c9d93c45d215d7d095890a7c0424abf3a847be48/test%2Fe2e%2Fprerender%2Fpages%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c9d93c45d215d7d095890a7c0424abf3a847be48/test%2Fe2e%2Fprerender%2Fpages%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fprerender%2Fpages%2Findex.js?ref=c9d93c45d215d7d095890a7c0424abf3a847be48",
            "patch": "@@ -1,7 +1,6 @@\n import Link from 'next/link'\n \n export async function getStaticProps() {\n-  // throw new Error('oops from getStaticProps')\n   return {\n     props: { world: 'world', time: new Date().getTime() },\n     // bad-prop"
        }
    ],
    "stats": {
        "total": 68,
        "additions": 33,
        "deletions": 35
    }
}