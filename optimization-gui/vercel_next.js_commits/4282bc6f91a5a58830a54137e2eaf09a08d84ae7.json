{
    "author": "lubieowoce",
    "message": "remove BrowserInterface (#78308)\n\nrip. you served a purpose once, but now you're just getting in the way. this improves typesafety quite a bit, because `BrowserInterface` had a whole bunch of random `any`s everywhere\r\n\r\nalso\r\n- removes `evalAsync`. no idea why that was needed, but we're happily using promises in normal eval, so it can be dropped\r\n- adds more safety to `chain`",
    "sha": "4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
    "files": [
        {
            "sha": "cde6cc238d0d5cfe511e93061c23ddce5749c4a0",
            "filename": "test/development/acceptance-app/version-staleness.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fdevelopment%2Facceptance-app%2Fversion-staleness.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fdevelopment%2Facceptance-app%2Fversion-staleness.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fversion-staleness.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -3,9 +3,9 @@ import { createSandbox } from 'development-sandbox'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n import path from 'path'\n import { outdent } from 'outdent'\n-import { BrowserInterface } from 'next-webdriver'\n+import { Playwright } from 'next-webdriver'\n \n-function getStaleness(browser: BrowserInterface) {\n+function getStaleness(browser: Playwright) {\n   return browser\n     .waitForElementByCss('.nextjs-container-build-error-version-status')\n     .text()"
        },
        {
            "sha": "88d9ae5f79d9cb5d34197f46c9e9c6a864c49b6b",
            "filename": "test/development/basic/tailwind-jit.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fdevelopment%2Fbasic%2Ftailwind-jit.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fdevelopment%2Fbasic%2Ftailwind-jit.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fbasic%2Ftailwind-jit.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,5 @@\n import { join } from 'path'\n-import webdriver, { BrowserInterface } from 'next-webdriver'\n+import webdriver, { Playwright } from 'next-webdriver'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n import { check, shouldRunTurboDevTest } from 'next-test-utils'\n \n@@ -27,7 +27,7 @@ describe('TailwindCSS JIT', () => {\n   })\n \n   it('works with JIT enabled', async () => {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n     try {\n       browser = await webdriver(next.url, '/')\n       const text = await browser.elementByCss('.text-6xl').text()"
        },
        {
            "sha": "46b049836bdd901e524d790e20a29f7b0223f632",
            "filename": "test/development/client-dev-overlay/index.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fdevelopment%2Fclient-dev-overlay%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fdevelopment%2Fclient-dev-overlay%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fclient-dev-overlay%2Findex.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,12 +1,12 @@\n import { createNext, FileRef } from 'e2e-utils'\n-import webdriver, { BrowserInterface } from 'next-webdriver'\n+import webdriver, { Playwright } from 'next-webdriver'\n import { NextInstance } from 'e2e-utils'\n import { join } from 'path'\n import { retry } from 'next-test-utils'\n \n describe('client-dev-overlay', () => {\n   let next: NextInstance\n-  let browser: BrowserInterface\n+  let browser: Playwright\n \n   beforeAll(async () => {\n     next = await createNext({\n@@ -25,7 +25,7 @@ describe('client-dev-overlay', () => {\n   })\n   afterAll(() => next.destroy())\n \n-  // The `BrowserInterface.hasElementByCssSelector` cannot be used for elements inside a shadow DOM.\n+  // The `Playwright.hasElementByCssSelector` cannot be used for elements inside a shadow DOM.\n   function elementExistsInNextJSPortalShadowDOM(selector: string) {\n     return browser.eval(\n       `!!document.querySelector('nextjs-portal').shadowRoot.querySelector('${selector}')`"
        },
        {
            "sha": "9f657d63a81a9f5df6c070a6eb5d75bab90f4466",
            "filename": "test/e2e/app-dir/actions/app-action-progressive-enhancement.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action-progressive-enhancement.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action-progressive-enhancement.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action-progressive-enhancement.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,7 +1,6 @@\n /* eslint-disable jest/no-standalone-expect */\n import { nextTestSetup } from 'e2e-utils'\n import { retry } from 'next-test-utils'\n-import type { Response } from 'playwright'\n \n describe('app-dir action progressive enhancement', () => {\n   const { next } = nextTestSetup({\n@@ -17,7 +16,7 @@ describe('app-dir action progressive enhancement', () => {\n     const browser = await next.browser('/server', {\n       disableJavaScript: true,\n       beforePageLoad(page) {\n-        page.on('response', (response: Response) => {\n+        page.on('response', (response) => {\n           const url = new URL(response.url())\n           const status = response.status()\n           if (url.pathname.includes('/server')) {"
        },
        {
            "sha": "e9ec0872cbe1c3369526239f142d23ac65c66bb5",
            "filename": "test/e2e/app-dir/actions/app-action.test.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 20,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Factions%2Fapp-action.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -7,7 +7,7 @@ import {\n   waitFor,\n   getRedboxSource,\n } from 'next-test-utils'\n-import type { Page, Request, Response, Route } from 'playwright'\n+import type { Request, Response } from 'playwright'\n import fs from 'fs-extra'\n import nodeFs from 'fs'\n import { join } from 'path'\n@@ -30,7 +30,7 @@ describe('app-dir action handling', () => {\n     const browser = await next.browser('/rewrite-to-static-first')\n     let actionRequestStatus: number | undefined\n \n-    browser.on('response', async (res: Response) => {\n+    browser.on('response', async (res) => {\n       if (\n         res.url().includes('rewrite-to-static-first') &&\n         res.request().method() === 'POST'\n@@ -100,8 +100,8 @@ describe('app-dir action handling', () => {\n   it('should propagate errors from a `text/plain` response to an error boundary', async () => {\n     const customErrorText = 'Custom error!'\n     const browser = await next.browser('/error-handling', {\n-      beforePageLoad(page: Page) {\n-        page.route('**/error-handling', async (route: Route) => {\n+      beforePageLoad(page) {\n+        page.route('**/error-handling', async (route) => {\n           const requestHeaders = await route.request().allHeaders()\n           if (requestHeaders['next-action']) {\n             await route.fulfill({\n@@ -124,8 +124,8 @@ describe('app-dir action handling', () => {\n   it('should trigger an error boundary for action responses with an invalid content-type', async () => {\n     const customErrorText = 'Custom error!'\n     const browser = await next.browser('/error-handling', {\n-      beforePageLoad(page: Page) {\n-        page.route('**/error-handling', async (route: Route) => {\n+      beforePageLoad(page) {\n+        page.route('**/error-handling', async (route) => {\n           const requestHeaders = await route.request().allHeaders()\n           if (requestHeaders['next-action']) {\n             await route.fulfill({\n@@ -727,7 +727,7 @@ describe('app-dir action handling', () => {\n   it('should reset the form state when the action redirects to itself', async () => {\n     const browser = await next.browser('/self-redirect')\n     const requests = []\n-    browser.on('request', async (req: Request) => {\n+    browser.on('request', async (req) => {\n       const url = new URL(req.url())\n \n       if (url.pathname === '/self-redirect') {\n@@ -820,7 +820,7 @@ describe('app-dir action handling', () => {\n   it('should be possible to catch network errors', async () => {\n     const browser = await next.browser('/catching-error', {\n       beforePageLoad(page) {\n-        page.route('**/catching-error', (route: Route) => {\n+        page.route('**/catching-error', (route) => {\n           if (route.request().method() !== 'POST') {\n             route.fallback()\n             return\n@@ -918,8 +918,8 @@ describe('app-dir action handling', () => {\n     async (runtime) => {\n       let redirectResponseCode\n       const browser = await next.browser(`/delayed-action/${runtime}`, {\n-        beforePageLoad(page: Page) {\n-          page.on('response', async (res: Response) => {\n+        beforePageLoad(page) {\n+          page.on('response', async (res) => {\n             const headers = await res.allHeaders().catch(() => ({}))\n             if (headers['x-action-redirect']) {\n               redirectResponseCode = res.status()\n@@ -1117,7 +1117,7 @@ describe('app-dir action handling', () => {\n         const requests: Request[] = []\n         const responses: Response[] = []\n \n-        browser.on('request', (req: Request) => {\n+        browser.on('request', (req) => {\n           const url = req.url()\n \n           if (\n@@ -1128,7 +1128,7 @@ describe('app-dir action handling', () => {\n           }\n         })\n \n-        browser.on('response', (res: Response) => {\n+        browser.on('response', (res) => {\n           const url = res.url()\n \n           if (\n@@ -1234,7 +1234,7 @@ describe('app-dir action handling', () => {\n         const requests: Request[] = []\n         const responses: Response[] = []\n \n-        browser.on('request', (req: Request) => {\n+        browser.on('request', (req) => {\n           const url = req.url()\n \n           if (\n@@ -1245,7 +1245,7 @@ describe('app-dir action handling', () => {\n           }\n         })\n \n-        browser.on('response', (res: Response) => {\n+        browser.on('response', (res) => {\n           const url = res.url()\n \n           if (\n@@ -1641,14 +1641,14 @@ describe('app-dir action handling', () => {\n \n       const browser = await next.browser('/redirects', {\n         beforePageLoad(page) {\n-          page.on('request', (request: Request) => {\n+          page.on('request', (request) => {\n             const url = new URL(request.url())\n             if (request.method() === 'POST') {\n               postRequests.push(url.pathname)\n             }\n           })\n \n-          page.on('response', (response: Response) => {\n+          page.on('response', (response) => {\n             const url = new URL(response.url())\n             const status = response.status()\n \n@@ -1675,14 +1675,14 @@ describe('app-dir action handling', () => {\n \n       const browser = await next.browser('/redirects', {\n         beforePageLoad(page) {\n-          page.on('request', (request: Request) => {\n+          page.on('request', (request) => {\n             const url = new URL(request.url())\n             if (request.method() === 'POST') {\n               postRequests.push(url.pathname)\n             }\n           })\n \n-          page.on('response', (response: Response) => {\n+          page.on('response', (response) => {\n             const url = new URL(response.url())\n             const status = response.status()\n \n@@ -1769,14 +1769,14 @@ describe('app-dir action handling', () => {\n \n         const browser = await next.browser('/redirects', {\n           beforePageLoad(page) {\n-            page.on('request', (request: Request) => {\n+            page.on('request', (request) => {\n               const url = new URL(request.url())\n               if (request.method() === 'POST') {\n                 postRequests.push(`${url.pathname}${url.search}`)\n               }\n             })\n \n-            page.on('response', (response: Response) => {\n+            page.on('response', (response) => {\n               const url = new URL(response.url())\n               const status = response.status()\n "
        },
        {
            "sha": "9bc1a6e88fbc2d81ab201fb7088b9fc0e71afe24",
            "filename": "test/e2e/app-dir/app-a11y/index.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-a11y%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-a11y%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-a11y%2Findex.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,6 +1,6 @@\n import { nextTestSetup } from 'e2e-utils'\n import { check } from 'next-test-utils'\n-import type { BrowserInterface } from 'next-webdriver'\n+import type { Playwright } from 'next-webdriver'\n \n describe('app a11y features', () => {\n   const { next, skipped } = nextTestSetup({\n@@ -14,7 +14,7 @@ describe('app a11y features', () => {\n   }\n \n   describe('route announcer', () => {\n-    async function getAnnouncerContent(browser: BrowserInterface) {\n+    async function getAnnouncerContent(browser: Playwright) {\n       return browser.eval(\n         `document.getElementsByTagName('next-route-announcer')[0]?.shadowRoot.childNodes[0]?.innerHTML`\n       )"
        },
        {
            "sha": "648fe05ba03ed12c6ea2cfe99651a023b5bf8e2a",
            "filename": "test/e2e/app-dir/app-basepath/index.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-basepath%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-basepath%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-basepath%2Findex.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -110,7 +110,7 @@ describe('app dir - basepath', () => {\n \n       const browser = await next.browser(initialPagePath)\n \n-      browser.on('request', (req: Request) => {\n+      browser.on('request', (req) => {\n         const url = req.url()\n \n         if (\n@@ -121,7 +121,7 @@ describe('app dir - basepath', () => {\n         }\n       })\n \n-      browser.on('response', (res: Response) => {\n+      browser.on('response', (res) => {\n         const url = res.url()\n \n         if (\n@@ -163,15 +163,15 @@ describe('app dir - basepath', () => {\n \n     const browser = await next.browser(initialPagePath)\n \n-    browser.on('request', (req: Request) => {\n+    browser.on('request', (req) => {\n       const url = req.url()\n \n       if (!url.includes('_next')) {\n         requests.push(req)\n       }\n     })\n \n-    browser.on('response', (res: Response) => {\n+    browser.on('response', (res) => {\n       const url = res.url()\n \n       if (!url.includes('_next')) {"
        },
        {
            "sha": "3e208f57d0d55aff992df62c3802cd4d7628ef5e",
            "filename": "test/e2e/app-dir/app-client-cache/client-cache.defaults.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 22,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Fclient-cache.defaults.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Fclient-cache.defaults.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Fclient-cache.defaults.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,6 +1,6 @@\n import { nextTestSetup } from 'e2e-utils'\n import { check, retry } from 'next-test-utils'\n-import { BrowserInterface } from 'next-webdriver'\n+import { Playwright } from 'next-webdriver'\n import {\n   browserConfigWithFixedTime,\n   createRequestsListener,\n@@ -17,10 +17,7 @@ describe('app dir client cache semantics (default semantics)', () => {\n   if (isNextDev) {\n     // dev doesn't support prefetch={true}, so this just performs a basic test to make sure data is reused for 30s\n     it('should return fresh data every navigation', async () => {\n-      let browser = (await next.browser(\n-        '/',\n-        browserConfigWithFixedTime\n-      )) as BrowserInterface\n+      let browser = await next.browser('/', browserConfigWithFixedTime)\n \n       // navigate to prefetch-auto page\n       await browser.elementByCss('[href=\"/1\"]').click()\n@@ -38,13 +35,10 @@ describe('app dir client cache semantics (default semantics)', () => {\n     })\n   } else {\n     describe('prefetch={true}', () => {\n-      let browser: BrowserInterface\n+      let browser: Playwright\n \n       beforeEach(async () => {\n-        browser = (await next.browser(\n-          '/',\n-          browserConfigWithFixedTime\n-        )) as BrowserInterface\n+        browser = await next.browser('/', browserConfigWithFixedTime)\n       })\n \n       it('should prefetch the full page', async () => {\n@@ -143,13 +137,10 @@ describe('app dir client cache semantics (default semantics)', () => {\n       })\n     })\n     describe('prefetch={false}', () => {\n-      let browser: BrowserInterface\n+      let browser: Playwright\n \n       beforeEach(async () => {\n-        browser = (await next.browser(\n-          '/',\n-          browserConfigWithFixedTime\n-        )) as BrowserInterface\n+        browser = await next.browser('/', browserConfigWithFixedTime)\n       })\n       it('should not prefetch the page at all', async () => {\n         const { getRequests } = await createRequestsListener(browser)\n@@ -201,13 +192,10 @@ describe('app dir client cache semantics (default semantics)', () => {\n       })\n     })\n     describe('prefetch={undefined} - default', () => {\n-      let browser: BrowserInterface\n+      let browser: Playwright\n \n       beforeEach(async () => {\n-        browser = (await next.browser(\n-          '/',\n-          browserConfigWithFixedTime\n-        )) as BrowserInterface\n+        browser = await next.browser('/', browserConfigWithFixedTime)\n       })\n \n       it('should prefetch partially a dynamic page', async () => {\n@@ -334,10 +322,10 @@ describe('app dir client cache semantics (default semantics)', () => {\n     })\n \n     it('should renew the initial seeded data after expiration time', async () => {\n-      const browser = (await next.browser(\n+      const browser = await next.browser(\n         '/without-loading/1',\n         browserConfigWithFixedTime\n-      )) as BrowserInterface\n+      )\n \n       const initialNumber = await browser.elementById('random-number').text()\n "
        },
        {
            "sha": "e10b5a998dca6f4cf7d0c2f5a56a8aba3440c1c5",
            "filename": "test/e2e/app-dir/app-client-cache/client-cache.original.test.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 26,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Fclient-cache.original.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Fclient-cache.original.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Fclient-cache.original.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,6 +1,6 @@\n import { nextTestSetup } from 'e2e-utils'\n import { check, retry } from 'next-test-utils'\n-import { BrowserInterface } from 'next-webdriver'\n+import { Playwright } from 'next-webdriver'\n import {\n   browserConfigWithFixedTime,\n   createRequestsListener,\n@@ -21,10 +21,7 @@ describe('app dir client cache semantics (30s/5min)', () => {\n   if (isNextDev) {\n     // dev doesn't support prefetch={true}, so this just performs a basic test to make sure data is reused for 30s\n     it('should renew the 30s cache once the data is revalidated', async () => {\n-      let browser = (await next.browser(\n-        '/',\n-        browserConfigWithFixedTime\n-      )) as BrowserInterface\n+      let browser = await next.browser('/', browserConfigWithFixedTime)\n \n       // navigate to prefetch-auto page\n       await browser.elementByCss('[href=\"/1\"]').click()\n@@ -70,13 +67,10 @@ describe('app dir client cache semantics (30s/5min)', () => {\n     })\n   } else {\n     describe('prefetch={true}', () => {\n-      let browser: BrowserInterface\n+      let browser: Playwright\n \n       beforeEach(async () => {\n-        browser = (await next.browser(\n-          '/',\n-          browserConfigWithFixedTime\n-        )) as BrowserInterface\n+        browser = await next.browser('/', browserConfigWithFixedTime)\n       })\n \n       it('should prefetch the full page', async () => {\n@@ -175,13 +169,10 @@ describe('app dir client cache semantics (30s/5min)', () => {\n       })\n     })\n     describe('prefetch={false}', () => {\n-      let browser: BrowserInterface\n+      let browser: Playwright\n \n       beforeEach(async () => {\n-        browser = (await next.browser(\n-          '/',\n-          browserConfigWithFixedTime\n-        )) as BrowserInterface\n+        browser = await next.browser('/', browserConfigWithFixedTime)\n       })\n       it('should not prefetch the page at all', async () => {\n         const { getRequests } = await createRequestsListener(browser)\n@@ -233,13 +224,10 @@ describe('app dir client cache semantics (30s/5min)', () => {\n       })\n     })\n     describe('prefetch={undefined} - default', () => {\n-      let browser: BrowserInterface\n+      let browser: Playwright\n \n       beforeEach(async () => {\n-        browser = (await next.browser(\n-          '/',\n-          browserConfigWithFixedTime\n-        )) as BrowserInterface\n+        browser = await next.browser('/', browserConfigWithFixedTime)\n       })\n \n       it('should prefetch partially a dynamic page', async () => {\n@@ -439,10 +427,7 @@ describe('app dir client cache semantics (30s/5min)', () => {\n     })\n \n     it('should seed the prefetch cache with the fetched page data', async () => {\n-      const browser = (await next.browser(\n-        '/1',\n-        browserConfigWithFixedTime\n-      )) as BrowserInterface\n+      const browser = await next.browser('/1', browserConfigWithFixedTime)\n \n       const initialNumber = await browser.elementById('random-number').text()\n \n@@ -458,10 +443,10 @@ describe('app dir client cache semantics (30s/5min)', () => {\n     })\n \n     it('should renew the initial seeded data after expiration time', async () => {\n-      const browser = (await next.browser(\n+      const browser = await next.browser(\n         '/without-loading/1',\n         browserConfigWithFixedTime\n-      )) as BrowserInterface\n+      )\n \n       const initialNumber = await browser.elementById('random-number').text()\n "
        },
        {
            "sha": "9dcaf5879785f977f1435321ca12bcdd477bd0d1",
            "filename": "test/e2e/app-dir/app-client-cache/client-cache.parallel-routes.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 6,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Fclient-cache.parallel-routes.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Fclient-cache.parallel-routes.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Fclient-cache.parallel-routes.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,6 +1,6 @@\n import { nextTestSetup } from 'e2e-utils'\n import { check } from 'next-test-utils'\n-import { BrowserInterface } from 'next-webdriver'\n+import { Playwright } from 'next-webdriver'\n import {\n   browserConfigWithFixedTime,\n   createRequestsListener,\n@@ -21,13 +21,10 @@ describe('app dir client cache with parallel routes', () => {\n   }\n \n   describe('prefetch={true}', () => {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n \n     beforeEach(async () => {\n-      browser = (await next.browser(\n-        '/',\n-        browserConfigWithFixedTime\n-      )) as BrowserInterface\n+      browser = await next.browser('/', browserConfigWithFixedTime)\n     })\n \n     it('should prefetch the full page', async () => {"
        },
        {
            "sha": "39e3570df4b51a448a4cd1bc1ec4817004cb4c40",
            "filename": "test/e2e/app-dir/app-client-cache/test-utils.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Ftest-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Ftest-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-client-cache%2Ftest-utils.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,4 @@\n-import { BrowserInterface } from 'next-webdriver'\n-import type { Request } from 'playwright'\n+import { Playwright } from 'next-webdriver'\n \n export const getPathname = (url: string) => {\n   const urlObj = new URL(url)\n@@ -51,13 +50,13 @@ export const fastForwardTo = (ms) => {\n   }\n }\n \n-export const createRequestsListener = async (browser: BrowserInterface) => {\n+export const createRequestsListener = async (browser: Playwright) => {\n   // wait for network idle\n   await browser.waitForIdleNetwork()\n \n   let requests = []\n \n-  browser.on('request', (req: Request) => {\n+  browser.on('request', (req) => {\n     requests.push([req.url(), !!req.headers()['next-router-prefetch']])\n   })\n "
        },
        {
            "sha": "2f9283972d3cdfb9c8c5dc52e5c6a8579ecc9041",
            "filename": "test/e2e/app-dir/app-prefetch-false/app-prefetch-false.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 5,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-prefetch-false%2Fapp-prefetch-false.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-prefetch-false%2Fapp-prefetch-false.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-prefetch-false%2Fapp-prefetch-false.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,20 +1,18 @@\n-import type { Request } from 'playwright'\n-\n import { nextTestSetup } from 'e2e-utils'\n-import type { BrowserInterface } from '../../../lib/browsers/base'\n+import type { Playwright } from 'next-webdriver'\n \n const getPathname = (url: string) => {\n   const urlObj = new URL(url)\n   return urlObj.pathname\n }\n \n-const createRequestsListener = async (browser: BrowserInterface) => {\n+const createRequestsListener = async (browser: Playwright) => {\n   // wait for network idle\n   await browser.waitForIdleNetwork()\n \n   let requests = []\n \n-  browser.on('request', (req: Request) => {\n+  browser.on('request', (req) => {\n     requests.push([req.url(), !!req.headers()['next-router-prefetch']])\n   })\n "
        },
        {
            "sha": "31dba12fc1bed505a29def309b8842e3f0017706",
            "filename": "test/e2e/app-dir/app-prefetch/prefetching.test.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 16,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-prefetch%2Fprefetching.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fapp-prefetch%2Fprefetching.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fapp-prefetch%2Fprefetching.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,6 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n import { check, waitFor, retry } from 'next-test-utils'\n-import type { Page, Request, Route } from 'playwright'\n import { NEXT_RSC_UNION_QUERY } from 'next/dist/client/components/app-router-headers'\n \n const browserConfigWithFixedTime = {\n@@ -112,7 +111,7 @@ describe('app dir - prefetching', () => {\n       requests.push(new URL(req.url()).pathname)\n     })\n \n-    await browser.evalAsync('window.next.router.prefetch(\"/dashboard/123\")')\n+    await browser.eval('window.next.router.prefetch(\"/dashboard/123\")')\n     await browser.waitForIdleNetwork()\n \n     expect(requests).toInclude('/dashboard/123')\n@@ -345,8 +344,8 @@ describe('app dir - prefetching', () => {\n   it('should not unintentionally modify the requested prefetch by escaping the uri encoded query params', async () => {\n     const rscRequests = []\n     const browser = await next.browser('/uri-encoded-prefetch', {\n-      beforePageLoad(page: Page) {\n-        page.on('request', async (req: Request) => {\n+      beforePageLoad(page) {\n+        page.on('request', async (req) => {\n           const url = new URL(req.url())\n           if (url.searchParams.has('_rsc')) {\n             rscRequests.push(url.pathname + url.search)\n@@ -387,8 +386,8 @@ describe('app dir - prefetching', () => {\n     it('should not re-fetch the initial static page if the same page is prefetched with prefetch={true}', async () => {\n       const rscRequests = []\n       const browser = await next.browser('/static-page', {\n-        beforePageLoad(page: Page) {\n-          page.on('request', async (req: Request) => {\n+        beforePageLoad(page) {\n+          page.on('request', async (req) => {\n             const url = new URL(req.url())\n             if (url.pathname === '/static-page' || url.pathname === '/') {\n               const headers = await req.allHeaders()\n@@ -441,8 +440,8 @@ describe('app dir - prefetching', () => {\n     it('should not re-fetch the initial dynamic page if the same page is prefetched with prefetch={true}', async () => {\n       const rscRequests = []\n       const browser = await next.browser('/dynamic-page', {\n-        beforePageLoad(page: Page) {\n-          page.on('request', async (req: Request) => {\n+        beforePageLoad(page) {\n+          page.on('request', async (req) => {\n             const url = new URL(req.url())\n             if (url.pathname === '/dynamic-page' || url.pathname === '/') {\n               const headers = await req.allHeaders()\n@@ -575,8 +574,8 @@ describe('app dir - prefetching', () => {\n     it('should prefetch links in viewport with low priority', async () => {\n       const requests: { priority: string; url: string }[] = []\n       const browser = await next.browser('/', {\n-        beforePageLoad(page: Page) {\n-          page.on('request', async (req: Request) => {\n+        beforePageLoad(page) {\n+          page.on('request', async (req) => {\n             const url = new URL(req.url())\n             const headers = await req.allHeaders()\n             if (headers['rsc']) {\n@@ -600,8 +599,8 @@ describe('app dir - prefetching', () => {\n     it('should prefetch with high priority when navigating to a page without a prefetch entry', async () => {\n       const requests: { priority: string; url: string }[] = []\n       const browser = await next.browser('/prefetch-false/initial', {\n-        beforePageLoad(page: Page) {\n-          page.on('request', async (req: Request) => {\n+        beforePageLoad(page) {\n+          page.on('request', async (req) => {\n             const url = new URL(req.url())\n             const headers = await req.allHeaders()\n             if (headers['rsc']) {\n@@ -628,8 +627,8 @@ describe('app dir - prefetching', () => {\n     it('should have an auto priority for all other fetch operations', async () => {\n       const requests: { priority: string; url: string }[] = []\n       const browser = await next.browser('/', {\n-        beforePageLoad(page: Page) {\n-          page.on('request', async (req: Request) => {\n+        beforePageLoad(page) {\n+          page.on('request', async (req) => {\n             const url = new URL(req.url())\n             const headers = await req.allHeaders()\n             if (headers['rsc']) {\n@@ -659,8 +658,8 @@ describe('app dir - prefetching', () => {\n       let interceptRequests = false\n \n       const browser = await next.browser('/prefetch-race', {\n-        beforePageLoad(page: Page) {\n-          page.route('**/force-dynamic/**', async (route: Route) => {\n+        beforePageLoad(page) {\n+          page.route('**/force-dynamic/**', async (route) => {\n             if (!interceptRequests) {\n               return route.continue()\n             }"
        },
        {
            "sha": "cc5bbee06efc2a70d3781d283587349f6efba42f",
            "filename": "test/e2e/app-dir/autoscroll-with-css-modules/index.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fautoscroll-with-css-modules%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fautoscroll-with-css-modules%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fautoscroll-with-css-modules%2Findex.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -6,12 +6,12 @@ describe('router autoscrolling on navigation with css modules', () => {\n     files: __dirname,\n   })\n \n-  type BrowserInterface = Awaited<ReturnType<(typeof next)['browser']>>\n+  type Playwright = Awaited<ReturnType<(typeof next)['browser']>>\n \n-  const getTopScroll = async (browser: BrowserInterface) =>\n+  const getTopScroll = async (browser: Playwright) =>\n     await browser.eval('document.documentElement.scrollTop')\n \n-  const getLeftScroll = async (browser: BrowserInterface) =>\n+  const getLeftScroll = async (browser: Playwright) =>\n     await browser.eval('document.documentElement.scrollLeft')\n \n   const waitForScrollToComplete = (\n@@ -27,7 +27,7 @@ describe('router autoscrolling on navigation with css modules', () => {\n     }, 'success')\n \n   const scrollTo = async (\n-    browser: BrowserInterface,\n+    browser: Playwright,\n     options: { x: number; y: number }\n   ) => {\n     await browser.eval(`window.scrollTo(${options.x}, ${options.y})`)"
        },
        {
            "sha": "fbc68d0af393f5d95f6b8ed2e532272d9c7bd6eb",
            "filename": "test/e2e/app-dir/dynamic-io/dynamic-io.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fdynamic-io%2Fdynamic-io.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fdynamic-io%2Fdynamic-io.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fdynamic-io%2Fdynamic-io.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,7 +1,7 @@\n /* eslint-disable jest/no-standalone-expect */\n import { nextTestSetup } from 'e2e-utils'\n import { retry } from 'next-test-utils'\n-import { BrowserInterface } from 'next-webdriver'\n+import { Playwright } from 'next-webdriver'\n \n const WITH_PPR = !!process.env.__NEXT_EXPERIMENTAL_PPR\n \n@@ -16,7 +16,7 @@ describe('dynamic-io', () => {\n   }\n \n   if (isNextDev && !WITH_PPR) {\n-    async function hasStaticIndicator(browser: BrowserInterface) {\n+    async function hasStaticIndicator(browser: Playwright) {\n       await browser.elementByCss('[data-nextjs-dev-tools-button]').click()\n \n       return await browser.eval("
        },
        {
            "sha": "2af09ba449bba9f8a4d2e0c2aa94f863287d8d22",
            "filename": "test/e2e/app-dir/metadata-navigation/metadata-navigation.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fmetadata-navigation%2Fmetadata-navigation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fmetadata-navigation%2Fmetadata-navigation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-navigation%2Fmetadata-navigation.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -5,7 +5,6 @@ import {\n   getTitle,\n   retry,\n } from 'next-test-utils'\n-import { Request } from 'playwright'\n \n describe('app dir - metadata navigation', () => {\n   const { next } = nextTestSetup({\n@@ -115,7 +114,7 @@ describe('app dir - metadata navigation', () => {\n       const browser = await next.browser('/server-action/not-found')\n       // collect server action requests\n       let isActionSent = false\n-      browser.on('request', (req: Request) => {\n+      browser.on('request', (req) => {\n         if (\n           req.method() === 'POST' &&\n           req.url().endsWith('/server-action/not-found')"
        },
        {
            "sha": "e8c943086682dcb986572ed22b4924826f766424",
            "filename": "test/e2e/app-dir/navigation/navigation.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fnavigation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fnavigation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnavigation%2Fnavigation.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,6 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n import { retry, waitFor } from 'next-test-utils'\n-import type { Request, Response } from 'playwright'\n \n describe('app dir - navigation', () => {\n   const { next, isNextDev, isNextStart, isNextDeploy } = nextTestSetup({\n@@ -44,7 +43,7 @@ describe('app dir - navigation', () => {\n \n       const browser = await next.browser('/search-params?name=å', {\n         beforePageLoad(page) {\n-          page.on('response', async (res: Response) => {\n+          page.on('response', async (res) => {\n             requests.push({\n               pathname: new URL(res.url()).pathname,\n               ok: res.ok(),\n@@ -497,7 +496,7 @@ describe('app dir - navigation', () => {\n \n           const browser = await next.browser(path, {\n             beforePageLoad(page) {\n-              page.on('request', async (req: Request) => {\n+              page.on('request', async (req) => {\n                 requestedPathnames.push(new URL(req.url()).pathname)\n               })\n             },"
        },
        {
            "sha": "7d8a5fa7741e83111259ff8b58a5c5e116867598",
            "filename": "test/e2e/app-dir/next-form/default/next-form-prefetch.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fnext-form%2Fdefault%2Fnext-form-prefetch.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fnext-form%2Fdefault%2Fnext-form-prefetch.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-form%2Fdefault%2Fnext-form-prefetch.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -4,7 +4,7 @@ import {\n   NEXT_RSC_UNION_QUERY,\n   RSC_HEADER,\n } from 'next/src/client/components/app-router-headers'\n-import type { Route, Page, Request as PlaywrightRequest } from 'playwright'\n+import type { Page, Request as PlaywrightRequest } from 'playwright'\n import { WebdriverOptions } from '../../../../lib/next-webdriver'\n import { retry } from '../../../../lib/next-test-utils'\n \n@@ -20,7 +20,7 @@ _describe('app dir - form prefetching', () => {\n   it(\"should prefetch a loading state for the form's target\", async () => {\n     const interceptor = new RequestInterceptor({\n       pattern: '**/search*',\n-      requestFilter: async (request: PlaywrightRequest) => {\n+      requestFilter: async (request) => {\n         // only capture RSC requests that *aren't* prefetches\n         const headers = await request.allHeaders()\n         const isRSC = headers[RSC_HEADER.toLowerCase()] === '1'\n@@ -66,7 +66,7 @@ _describe('app dir - form prefetching', () => {\n   it('should not prefetch when prefetch is set to false`', async () => {\n     const interceptor = new RequestInterceptor({\n       pattern: '**/search*',\n-      requestFilter: async (request: PlaywrightRequest) => {\n+      requestFilter: async (request) => {\n         // capture all RSC requests, prefetch or not\n         const headers = await request.allHeaders()\n         const isRSC = headers[RSC_HEADER.toLowerCase()] === '1'\n@@ -164,11 +164,11 @@ class RequestInterceptor {\n     this.isEnabled = false\n   }\n \n-  beforePageLoad: BeforePageLoadFn = (page: Page) => {\n+  beforePageLoad: BeforePageLoadFn = (page) => {\n     const { opts } = this\n     page.route(\n       opts.pattern,\n-      async (route: Route, request) => {\n+      async (route, request) => {\n         if (!this.isEnabled) {\n           return route.continue()\n         }"
        },
        {
            "sha": "7638a47c2420edecbdf7ef0f53dcfb99cf7c0505",
            "filename": "test/e2e/app-dir/next-form/default/next-form.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fnext-form%2Fdefault%2Fnext-form.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fnext-form%2Fdefault%2Fnext-form.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fnext-form%2Fdefault%2Fnext-form.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n-import { BrowserInterface } from '../../../../lib/next-webdriver'\n+import { Playwright } from '../../../../lib/next-webdriver'\n \n const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n \n@@ -273,7 +273,7 @@ describe.each(['app', 'pages'])('%s dir - form', (type) => {\n   })\n })\n \n-async function trackMpaNavs(session: BrowserInterface) {\n+async function trackMpaNavs(session: Playwright) {\n   const id = Date.now()\n   await session.eval(`window.__MPA_NAV_ID = ${id}`)\n   return {"
        },
        {
            "sha": "63769d1929bf937d75177c400b7ee2aa4a448e51",
            "filename": "test/e2e/app-dir/parallel-routes-css/parallel-routes-css.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fparallel-routes-css%2Fparallel-routes-css.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fparallel-routes-css%2Fparallel-routes-css.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-routes-css%2Fparallel-routes-css.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,18 +1,18 @@\n import { nextTestSetup } from 'e2e-utils'\n-import type { BrowserInterface } from 'next-webdriver'\n+import type { Playwright } from 'next-webdriver'\n \n describe('parallel-routes-catchall-css', () => {\n   const { next } = nextTestSetup({\n     files: __dirname,\n   })\n \n-  async function getChildrenBackgroundColor(browser: BrowserInterface) {\n+  async function getChildrenBackgroundColor(browser: Playwright) {\n     return browser.eval(\n       `window.getComputedStyle(document.getElementById('main')).backgroundColor`\n     )\n   }\n \n-  async function getSlotBackgroundColor(browser: BrowserInterface) {\n+  async function getSlotBackgroundColor(browser: Playwright) {\n     return browser.eval(\n       `window.getComputedStyle(document.getElementById('slot')).backgroundColor`\n     )"
        },
        {
            "sha": "5e78398f3e25bb29a9666b6db5a4c4ad3c2e0487",
            "filename": "test/e2e/app-dir/parallel-routes-revalidation/parallel-routes-revalidation.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fparallel-routes-revalidation%2Fparallel-routes-revalidation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fparallel-routes-revalidation%2Fparallel-routes-revalidation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fparallel-routes-revalidation%2Fparallel-routes-revalidation.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -246,7 +246,9 @@ describe('parallel-routes-revalidation', () => {\n           })\n         }\n \n-        let initialRandomNumber = await browser.elementById('random-number')\n+        let initialRandomNumber = await browser\n+          .elementById('random-number')\n+          .text()\n         await browser.elementByCss(`[href='${basePath}/login']`).click()\n \n         // interception modal should be visible"
        },
        {
            "sha": "bb4f3e03560174e209b13cd688c8dda326c3c9bf",
            "filename": "test/e2e/app-dir/ppr-incremental/ppr-incremental.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fppr-incremental%2Fppr-incremental.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fppr-incremental%2Fppr-incremental.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-incremental%2Fppr-incremental.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,4 @@\n import { nextTestSetup, isNextDev } from 'e2e-utils'\n-import type { Route as PlaywrightRoute, Page } from 'playwright'\n \n type Route = {\n   route: string\n@@ -154,8 +153,8 @@ describe('ppr-incremental', () => {\n     it('should not trigger a dynamic request for static pages', async () => {\n       let rscRequests = []\n       const browser = await next.browser('/', {\n-        beforePageLoad(page: Page) {\n-          page.route('**/static*', async (route: PlaywrightRoute) => {\n+        beforePageLoad(page) {\n+          page.route('**/static*', async (route) => {\n             const request = route.request()\n             const headers = await request.allHeaders()\n             const url = new URL(request.url())"
        },
        {
            "sha": "79205bc5cbc296a0a3ba125c6c719794af05ac23",
            "filename": "test/e2e/app-dir/ppr-navigations/prefetch-navigation/prefetch-navigation.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Fprefetch-navigation%2Fprefetch-navigation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Fprefetch-navigation%2Fprefetch-navigation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fppr-navigations%2Fprefetch-navigation%2Fprefetch-navigation.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,4 @@\n import { nextTestSetup } from 'e2e-utils'\n-import type { Route, Page } from 'playwright'\n \n describe('prefetch-navigation', () => {\n   const { next, isNextDev } = nextTestSetup({\n@@ -17,8 +16,8 @@ describe('prefetch-navigation', () => {\n       { resolve: () => Promise<void> }\n     >()\n     const browser = await next.browser('/catch-all/1', {\n-      beforePageLoad(page: Page) {\n-        page.route('**/catch-all/**', async (route: Route) => {\n+      beforePageLoad(page) {\n+        page.route('**/catch-all/**', async (route) => {\n           const request = route.request()\n           const headers = await request.allHeaders()\n           const url = new URL(request.url())"
        },
        {
            "sha": "da3dd4cc5e0d00303737be893a4c2e7f92589b78",
            "filename": "test/e2e/app-dir/resource-url-encoding/resource-url-encoding.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fresource-url-encoding%2Fresource-url-encoding.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fresource-url-encoding%2Fresource-url-encoding.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fresource-url-encoding%2Fresource-url-encoding.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,6 @@\n /* eslint-disable jest/no-standalone-expect */\n import { nextTestSetup } from 'e2e-utils'\n+import { ElementHandle } from 'playwright'\n \n describe('scripts', () => {\n   const { next } = nextTestSetup({\n@@ -13,7 +14,9 @@ describe('scripts', () => {\n     async (routerType) => {\n       const browser = await next.browser(routerType === 'app' ? '/' : '/pages')\n       expect(await browser.elementByCss('p').text()).toBe('hello world')\n-      const scripts = await browser.elementsByCss('script')\n+      const scripts = (await browser.elementsByCss(\n+        'script'\n+      )) as ElementHandle<HTMLScriptElement>[]\n       expect(scripts.length).toBeGreaterThan(0)\n       for (const script of scripts) {\n         const src = await script.evaluate((script) => script.src)\n@@ -38,11 +41,13 @@ describe('styles', () => {\n       let body = await browser.elementByCss('body')\n       expect(\n         await body.evaluate((el) =>\n-          getComputedStyle(el).getPropertyValue('background-color')\n+          getComputedStyle(el as Element).getPropertyValue('background-color')\n         )\n       ).toBe('rgb(0, 0, 255)')\n \n-      const stylesheets = await browser.elementsByCss('link[rel=\"stylesheet\"]')\n+      const stylesheets = (await browser.elementsByCss(\n+        'link[rel=\"stylesheet\"]'\n+      )) as ElementHandle<HTMLLinkElement>[]\n       expect(stylesheets.length).toBeGreaterThan(0)\n       for (const stylesheet of stylesheets) {\n         const href = await stylesheet.evaluate((stylesheet) => stylesheet.href)"
        },
        {
            "sha": "e7398c08ed07fed62591792433fffaad777a546f",
            "filename": "test/e2e/app-dir/router-autoscroll/router-autoscroll.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Frouter-autoscroll%2Frouter-autoscroll.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Frouter-autoscroll%2Frouter-autoscroll.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Frouter-autoscroll%2Frouter-autoscroll.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,4 +1,4 @@\n-import webdriver, { type BrowserInterface } from 'next-webdriver'\n+import webdriver, { type Playwright } from 'next-webdriver'\n import { nextTestSetup } from 'e2e-utils'\n import { check, assertNoConsoleErrors, retry } from 'next-test-utils'\n \n@@ -7,14 +7,14 @@ describe('router autoscrolling on navigation', () => {\n     files: __dirname,\n   })\n \n-  const getTopScroll = async (browser: BrowserInterface) =>\n+  const getTopScroll = async (browser: Playwright) =>\n     await browser.eval('document.documentElement.scrollTop')\n \n-  const getLeftScroll = async (browser: BrowserInterface) =>\n+  const getLeftScroll = async (browser: Playwright) =>\n     await browser.eval('document.documentElement.scrollLeft')\n \n   const waitForScrollToComplete = async (\n-    browser: BrowserInterface,\n+    browser: Playwright,\n     options: { x: number; y: number }\n   ) => {\n     await retry(async () => {\n@@ -26,7 +26,7 @@ describe('router autoscrolling on navigation', () => {\n   }\n \n   const scrollTo = async (\n-    browser: BrowserInterface,\n+    browser: Playwright,\n     options: { x: number; y: number }\n   ) => {\n     await browser.eval(`window.scrollTo(${options.x}, ${options.y})`)"
        },
        {
            "sha": "d8ce2f3cd44e2a144c524a5df9ab1e1c9572a8f0",
            "filename": "test/e2e/app-dir/rsc-basic/rsc-basic.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Frsc-basic%2Frsc-basic.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -2,7 +2,6 @@ import path from 'path'\n import { check } from 'next-test-utils'\n import { nextTestSetup } from 'e2e-utils'\n import cheerio from 'cheerio'\n-import { Page } from 'playwright'\n \n // TODO: We should decide on an established pattern for gating test assertions\n // on experimental flags. For example, as a first step we could all the common\n@@ -165,7 +164,7 @@ describe('app dir - rsc basics', () => {\n     const flightRequests: string[] = []\n     let requestsCount = 0\n     const browser = await next.browser('/root', {\n-      beforePageLoad(page: Page) {\n+      beforePageLoad(page) {\n         page.on('request', (request) => {\n           requestsCount++\n           const headers = request.headers()\n@@ -376,7 +375,6 @@ describe('app dir - rsc basics', () => {\n \n     await browser.loadPage(`${next.url}/edge/dynamic/123`, {\n       disableCache: false,\n-      beforePageLoad: null,\n     })\n \n     const dynamicRouteUrl = await browser.url()"
        },
        {
            "sha": "f0445997e27e150c2c3eb32d0cec4b1d3c92bdc5",
            "filename": "test/e2e/app-dir/rsc-query-routing/rsc-query-routing.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Frsc-query-routing%2Frsc-query-routing.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Frsc-query-routing%2Frsc-query-routing.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Frsc-query-routing%2Frsc-query-routing.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,6 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n import { retry } from 'next-test-utils'\n-import { Request } from 'playwright'\n \n describe('rsc-query-routing', () => {\n   const { next } = nextTestSetup({\n@@ -11,7 +10,7 @@ describe('rsc-query-routing', () => {\n     const browser = await next.browser('/redirect')\n \n     const rscRequestUrls: string[] = []\n-    browser.on('request', (req: Request) => {\n+    browser.on('request', (req) => {\n       if (req.url().includes('?_rsc=')) {\n         rscRequestUrls.push(req.url())\n       }\n@@ -35,7 +34,7 @@ describe('rsc-query-routing', () => {\n     const browser = await next.browser('/rewrite')\n \n     const rscRequestUrls: string[] = []\n-    browser.on('request', (req: Request) => {\n+    browser.on('request', (req) => {\n       if (req.url().includes('?_rsc=')) {\n         rscRequestUrls.push(req.url())\n       }"
        },
        {
            "sha": "38488904da7f43b7f7c92459c695672ab4b4c09f",
            "filename": "test/e2e/app-dir/searchparams-reuse-loading/searchparams-reuse-loading.test.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 9,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsearchparams-reuse-loading%2Fsearchparams-reuse-loading.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsearchparams-reuse-loading%2Fsearchparams-reuse-loading.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsearchparams-reuse-loading%2Fsearchparams-reuse-loading.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,6 +1,5 @@\n import { nextTestSetup } from 'e2e-utils'\n import { retry } from 'next-test-utils'\n-import type { Route, Page } from 'playwright'\n \n describe('searchparams-reuse-loading', () => {\n   const { next, isNextDev } = nextTestSetup({\n@@ -181,8 +180,8 @@ describe('searchparams-reuse-loading', () => {\n \n         let interceptRequests = false\n         const browser = await next.browser(path, {\n-          beforePageLoad(page: Page) {\n-            page.route('**/search-params*', async (route: Route) => {\n+          beforePageLoad(page) {\n+            page.route('**/search-params*', async (route) => {\n               if (!interceptRequests) {\n                 return route.continue()\n               }\n@@ -291,8 +290,8 @@ describe('searchparams-reuse-loading', () => {\n \n       let interceptRequests = false\n       const browser = await next.browser('/onclick-navs/version-1', {\n-        beforePageLoad(page: Page) {\n-          page.route('**/search-params*', async (route: Route) => {\n+        beforePageLoad(page) {\n+          page.route('**/search-params*', async (route) => {\n             if (!interceptRequests) {\n               return route.continue()\n             }\n@@ -377,8 +376,8 @@ describe('searchparams-reuse-loading', () => {\n \n       let interceptRequests = false\n       const browser = await next.browser('/onclick-navs/version-2', {\n-        beforePageLoad(page: Page) {\n-          page.route('**/search-params*', async (route: Route) => {\n+        beforePageLoad(page) {\n+          page.route('**/search-params*', async (route) => {\n             if (!interceptRequests) {\n               return route.continue()\n             }\n@@ -463,8 +462,8 @@ describe('searchparams-reuse-loading', () => {\n \n       let interceptRequests = false\n       const browser = await next.browser('/onclick-navs/version-3', {\n-        beforePageLoad(page: Page) {\n-          page.route('**/search-params*', async (route: Route) => {\n+        beforePageLoad(page) {\n+          page.route('**/search-params*', async (route) => {\n             if (!interceptRequests) {\n               return route.continue()\n             }"
        },
        {
            "sha": "63039bb44480b100436af416ad63992496af3beb",
            "filename": "test/e2e/app-dir/segment-cache/basic/segment-cache-basic.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 8,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,4 @@\n import { nextTestSetup } from 'e2e-utils'\n-import type * as Playwright from 'playwright'\n import { createRouterAct } from '../router-act'\n \n describe('segment cache (basic tests)', () => {\n@@ -15,7 +14,7 @@ describe('segment cache (basic tests)', () => {\n   it('navigate before any data has loaded into the prefetch cache', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -58,7 +57,7 @@ describe('segment cache (basic tests)', () => {\n   it('navigate with prefetched data', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -97,7 +96,7 @@ describe('segment cache (basic tests)', () => {\n   it('navigate to page with lazily-generated (not at build time) static param', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/lazily-generated-params', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -134,7 +133,7 @@ describe('segment cache (basic tests)', () => {\n   it('prefetch interception route', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/interception/feed', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -166,7 +165,7 @@ describe('segment cache (basic tests)', () => {\n   it('skips dynamic request if prefetched data is fully static', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/fully-static', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -197,7 +196,7 @@ describe('segment cache (basic tests)', () => {\n   it('skips static layouts during partially static navigation', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/partially-static', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -245,7 +244,7 @@ describe('segment cache (basic tests)', () => {\n   it('refreshes page segments when navigating to the exact same URL as the current location', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/same-page-nav', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })"
        },
        {
            "sha": "30f21002b285f142b3aec13cb3896cd9aaf46b0e",
            "filename": "test/e2e/app-dir/segment-cache/incremental-opt-in/segment-cache-incremental-opt-in.test.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 7,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fincremental-opt-in%2Fsegment-cache-incremental-opt-in.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fincremental-opt-in%2Fsegment-cache-incremental-opt-in.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fincremental-opt-in%2Fsegment-cache-incremental-opt-in.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,4 @@\n import { nextTestSetup } from 'e2e-utils'\n-import type * as Playwright from 'playwright'\n import { createRouterAct } from '../router-act'\n \n describe('segment cache (incremental opt in)', () => {\n@@ -25,9 +24,9 @@ describe('segment cache (incremental opt in)', () => {\n \n     let act\n     const browser = await next.browser('/', {\n-      async beforePageLoad(page: Playwright.Page) {\n+      async beforePageLoad(page) {\n         act = createRouterAct(page)\n-        await page.route('**/*', async (route: Playwright.Route) => {\n+        await page.route('**/*', async (route) => {\n           const request = route.request()\n           const isPrefetch =\n             request.headerValue('rsc') !== null &&\n@@ -99,7 +98,7 @@ describe('segment cache (incremental opt in)', () => {\n     async () => {\n       let act\n       const browser = await next.browser('/mixed-fetch-strategies', {\n-        beforePageLoad(p: Playwright.Page) {\n+        beforePageLoad(p) {\n           act = createRouterAct(p)\n         },\n       })\n@@ -138,7 +137,7 @@ describe('segment cache (incremental opt in)', () => {\n     async () => {\n       let act\n       const browser = await next.browser('/mixed-fetch-strategies', {\n-        beforePageLoad(p: Playwright.Page) {\n+        beforePageLoad(p) {\n           act = createRouterAct(p)\n         },\n       })\n@@ -177,7 +176,7 @@ describe('segment cache (incremental opt in)', () => {\n     async () => {\n       let act\n       const browser = await next.browser('/mixed-fetch-strategies', {\n-        beforePageLoad(p: Playwright.Page) {\n+        beforePageLoad(p) {\n           act = createRouterAct(p)\n         },\n       })\n@@ -238,7 +237,7 @@ describe('segment cache (incremental opt in)', () => {\n \n       let act\n       const browser = await next.browser('/mixed-fetch-strategies', {\n-        beforePageLoad(p: Playwright.Page) {\n+        beforePageLoad(p) {\n           act = createRouterAct(p)\n         },\n       })"
        },
        {
            "sha": "c94beb87f5a8c8bf555d03e35a9ed1fa729eacea",
            "filename": "test/e2e/app-dir/segment-cache/memory-pressure/segment-cache-memory-pressure.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmemory-pressure%2Fsegment-cache-memory-pressure.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmemory-pressure%2Fsegment-cache-memory-pressure.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmemory-pressure%2Fsegment-cache-memory-pressure.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,4 @@\n import { nextTestSetup } from 'e2e-utils'\n-import type * as Playwright from 'playwright'\n import { createRouterAct } from '../router-act'\n \n describe('segment cache memory pressure', () => {\n@@ -15,7 +14,7 @@ describe('segment cache memory pressure', () => {\n   it('evicts least recently used prefetch data once cache size exceeds limit', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/memory-pressure', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })"
        },
        {
            "sha": "84bef9714725d9e12d6dd11507626e5f53d67f8b",
            "filename": "test/e2e/app-dir/segment-cache/mpa-navigations/mpa-navigations.test.ts",
            "status": "modified",
            "additions": 13,
            "deletions": 4,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmpa-navigations%2Fmpa-navigations.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmpa-navigations%2Fmpa-navigations.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fmpa-navigations%2Fmpa-navigations.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -10,21 +10,26 @@ describe('segment cache (MPA navigations)', () => {\n     return\n   }\n \n+  type ElementWithExpando = Element & { __expando?: boolean }\n+\n   it('triggers MPA navigation when navigating to a different root layout', async () => {\n     const browser = await next.browser('/')\n \n     // Set an expando on the html element so we can detect if the page\n     // gets unloaded.\n     const html = await browser.elementByCss('html')\n-    await html.evaluate((el) => (el.__expando = true))\n+\n+    await html.evaluate((el) => ((el as ElementWithExpando).__expando = true))\n \n     // Navigate to a page with a different root layout.\n     const link = await browser.elementByCss(`a[href=\"/foo\"]`)\n     await link.click()\n \n     // The expando should not be present because we did a full-page navigation.\n     const htmlAfterNav = await browser.elementByCss('html')\n-    expect(await htmlAfterNav.evaluate((el) => el.__expando)).toBe(undefined)\n+    expect(\n+      await htmlAfterNav.evaluate((el) => (el as ElementWithExpando).__expando)\n+    ).toBe(undefined)\n   })\n \n   it(\n@@ -41,15 +46,19 @@ describe('segment cache (MPA navigations)', () => {\n       // Set an expando on the html element so we can detect if the page\n       // gets unloaded.\n       const html = await browser.elementByCss('html')\n-      await html.evaluate((el) => (el.__expando = true))\n+      await html.evaluate((el) => ((el as ElementWithExpando).__expando = true))\n \n       // Navigate to a page with a different root layout.\n       const link = await browser.elementByCss(`a[href=\"/bar/inner\"]`)\n       await link.click()\n \n       // The expando should not be present because we did a full-page navigation.\n       const htmlAfterNav = await browser.elementByCss('html')\n-      expect(await htmlAfterNav.evaluate((el) => el.__expando)).toBe(undefined)\n+      expect(\n+        await htmlAfterNav.evaluate(\n+          (el) => (el as ElementWithExpando).__expando\n+        )\n+      ).toBe(undefined)\n     }\n   )\n })"
        },
        {
            "sha": "8170208249da7c9c3500677e2d6f8680f4ded135",
            "filename": "test/e2e/app-dir/segment-cache/revalidation/segment-cache-revalidation.test.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 5,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frevalidation%2Fsegment-cache-revalidation.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frevalidation%2Fsegment-cache-revalidation.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Frevalidation%2Fsegment-cache-revalidation.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,4 @@\n import { isNextDev, isNextDeploy, createNext } from 'e2e-utils'\n-import type * as Playwright from 'playwright'\n import { createRouterAct } from '../router-act'\n import { createTestDataServer } from 'test-data-service/writer'\n import { createTestLog } from 'test-log'\n@@ -53,7 +52,7 @@ describe('segment cache (revalidation)', () => {\n   it('evict client cache when Server Action calls revalidatePath', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -104,7 +103,7 @@ describe('segment cache (revalidation)', () => {\n     // be sufficient.\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -153,7 +152,7 @@ describe('segment cache (revalidation)', () => {\n   it('evict client cache when Server Action calls revalidateTag', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -200,7 +199,7 @@ describe('segment cache (revalidation)', () => {\n   it('re-fetch visible links after a navigation, if needed', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/refetch-on-new-base-tree/a', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })"
        },
        {
            "sha": "2a624ca4a41191ab279103d044518dcfd619f9c7",
            "filename": "test/e2e/app-dir/segment-cache/search-params/segment-cache-search-params.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fsearch-params%2Fsegment-cache-search-params.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fsearch-params%2Fsegment-cache-search-params.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fsearch-params%2Fsegment-cache-search-params.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,4 @@\n import { nextTestSetup } from 'e2e-utils'\n-import type * as Playwright from 'playwright'\n import { createRouterAct } from '../router-act'\n \n describe('segment cache (search params)', () => {\n@@ -15,7 +14,7 @@ describe('segment cache (search params)', () => {\n   it('when fetching with PPR, does not include search params in the cache key', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/search-params', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })\n@@ -71,7 +70,7 @@ describe('segment cache (search params)', () => {\n   it('when fetching without PPR (e.g. prefetch={true}), includes the search params in the cache key', async () => {\n     let act: ReturnType<typeof createRouterAct>\n     const browser = await next.browser('/search-params', {\n-      beforePageLoad(page: Playwright.Page) {\n+      beforePageLoad(page) {\n         act = createRouterAct(page)\n       },\n     })"
        },
        {
            "sha": "ce7b9c0a3ffd5b9c7d989467ec5f9683e98e81aa",
            "filename": "test/e2e/app-dir/use-cache/use-cache.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fuse-cache.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fuse-cache.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache%2Fuse-cache.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -2,7 +2,7 @@ import { nextTestSetup } from 'e2e-utils'\n import { retry, waitFor } from 'next-test-utils'\n import stripAnsi from 'strip-ansi'\n import { format } from 'util'\n-import { BrowserInterface } from 'next-webdriver'\n+import { Playwright } from 'next-webdriver'\n import {\n   createRenderResumeDataCache,\n   RenderResumeDataCache,\n@@ -915,7 +915,7 @@ describe('use-cache', () => {\n   }\n })\n \n-async function getSanitizedLogs(browser: BrowserInterface): Promise<string[]> {\n+async function getSanitizedLogs(browser: Playwright): Promise<string[]> {\n   const logs = await browser.log({ includeArgs: true })\n \n   return logs.map(({ args }) =>"
        },
        {
            "sha": "2aa9163a06db464f585170b3666d03a65fb0a271",
            "filename": "test/e2e/app-dir/view-transitions/view-transitions.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fview-transitions%2Fview-transitions.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fapp-dir%2Fview-transitions%2Fview-transitions.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fview-transitions%2Fview-transitions.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,8 +1,8 @@\n import * as path from 'path'\n import { nextTestSetup } from 'e2e-utils'\n-import { BrowserInterface } from 'next-webdriver'\n+import { Playwright } from 'next-webdriver'\n \n-async function assertNoConsoleErrors(browser: BrowserInterface) {\n+async function assertNoConsoleErrors(browser: Playwright) {\n   const logs = await browser.log()\n   const warningsAndErrors = logs.filter((log) => {\n     return log.source === 'warning' || log.source === 'error'"
        },
        {
            "sha": "b10551a1a22ac3f701a00e111057853ccc85aa2e",
            "filename": "test/e2e/i18n-preferred-locale-detection/i18n-preferred-locale-detection.test.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 2,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fi18n-preferred-locale-detection%2Fi18n-preferred-locale-detection.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fi18n-preferred-locale-detection%2Fi18n-preferred-locale-detection.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fi18n-preferred-locale-detection%2Fi18n-preferred-locale-detection.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,4 +1,3 @@\n-import type { Request } from 'playwright'\n import { join } from 'path'\n import { FileRef, nextTestSetup } from 'e2e-utils'\n \n@@ -13,7 +12,7 @@ describe('i18-preferred-locale-redirect', () => {\n     })\n \n     let requestedPreferredLocalePathCount = 0\n-    browser.on('request', (request: Request) => {\n+    browser.on('request', (request) => {\n       if (new URL(request.url(), 'http://n').pathname === '/id') {\n         requestedPreferredLocalePathCount++\n       }"
        },
        {
            "sha": "dff84317e55de3738823e8ff16c22e68eca76ce1",
            "filename": "test/e2e/ignore-invalid-popstateevent/with-i18n.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fignore-invalid-popstateevent%2Fwith-i18n.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fignore-invalid-popstateevent%2Fwith-i18n.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fignore-invalid-popstateevent%2Fwith-i18n.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -2,11 +2,11 @@ import { join } from 'path'\n import { createNext, FileRef } from 'e2e-utils'\n import { NextInstance } from 'e2e-utils'\n import { check, waitFor } from 'next-test-utils'\n-import webdriver, { BrowserInterface } from 'next-webdriver'\n+import webdriver, { Playwright } from 'next-webdriver'\n \n import type { HistoryState } from 'next/dist/shared/lib/router/router'\n \n-const emitPopsStateEvent = (browser: BrowserInterface, state: HistoryState) =>\n+const emitPopsStateEvent = (browser: Playwright, state: HistoryState) =>\n   browser.eval(\n     `window.dispatchEvent(new PopStateEvent(\"popstate\", { state: ${JSON.stringify(\n       state"
        },
        {
            "sha": "e981eb73e87cb9498beb7d080f4ca5a54d18c464",
            "filename": "test/e2e/ignore-invalid-popstateevent/without-i18n.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fignore-invalid-popstateevent%2Fwithout-i18n.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fignore-invalid-popstateevent%2Fwithout-i18n.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fignore-invalid-popstateevent%2Fwithout-i18n.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -2,11 +2,11 @@ import { join } from 'path'\n import { createNext, FileRef } from 'e2e-utils'\n import { NextInstance } from 'e2e-utils'\n import { check, waitFor } from 'next-test-utils'\n-import webdriver, { BrowserInterface } from 'next-webdriver'\n+import webdriver, { Playwright } from 'next-webdriver'\n \n import type { HistoryState } from 'next/dist/shared/lib/router/router'\n \n-const emitPopsStateEvent = (browser: BrowserInterface, state: HistoryState) =>\n+const emitPopsStateEvent = (browser: Playwright, state: HistoryState) =>\n   browser.eval(\n     `window.dispatchEvent(new PopStateEvent(\"popstate\", { state: ${JSON.stringify(\n       state"
        },
        {
            "sha": "a56c3a3d0d2f3cc5d32e414dd55b4d699ed604c1",
            "filename": "test/e2e/middleware-rewrites/test/index.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fmiddleware-rewrites%2Ftest%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fmiddleware-rewrites%2Ftest%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fmiddleware-rewrites%2Ftest%2Findex.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -7,7 +7,6 @@ import { NextInstance } from 'e2e-utils'\n import { check, fetchViaHTTP, retry } from 'next-test-utils'\n import { createNext, FileRef } from 'e2e-utils'\n import escapeStringRegexp from 'escape-string-regexp'\n-import { Request, Response } from 'playwright'\n \n describe('Middleware Rewrite', () => {\n   let next: NextInstance\n@@ -30,7 +29,7 @@ describe('Middleware Rewrite', () => {\n       if (!(global as any).isNextDev) {\n         let requests = []\n \n-        browser.on('request', (req: Request) => {\n+        browser.on('request', (req) => {\n           requests.push(new URL(req.url()).pathname)\n         })\n \n@@ -369,7 +368,7 @@ describe('Middleware Rewrite', () => {\n         await browser.waitForIdleNetwork()\n         let hasResolvedPrefetch = false\n \n-        browser.on('response', async (res: Response) => {\n+        browser.on('response', async (res) => {\n           const req = res.request()\n           const headers = await req.allHeaders()\n           if ("
        },
        {
            "sha": "a68bf505649555b367f201188cec022af62df901",
            "filename": "test/e2e/next-script/index.test.ts",
            "status": "modified",
            "additions": 11,
            "deletions": 11,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fnext-script%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fe2e%2Fnext-script%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-script%2Findex.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,4 +1,4 @@\n-import webdriver, { BrowserInterface } from 'next-webdriver'\n+import webdriver, { Playwright } from 'next-webdriver'\n import { createNext } from 'e2e-utils'\n import { NextInstance } from 'e2e-utils'\n import { check } from 'next-test-utils'\n@@ -45,7 +45,7 @@ describe('beforeInteractive in document Head', () => {\n   afterAll(() => next.destroy())\n \n   it('Script is injected server-side', async () => {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n \n     try {\n       browser = await webdriver(next.url, '/')\n@@ -101,7 +101,7 @@ describe('beforeInteractive in document body', () => {\n   afterAll(() => next.destroy())\n \n   it('Script is injected server-side', async () => {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n \n     try {\n       browser = await webdriver(next.url, '/')\n@@ -158,7 +158,7 @@ describe('empty strategy in document Head', () => {\n   afterAll(() => next.destroy())\n \n   it('Script is injected server-side', async () => {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n \n     try {\n       browser = await webdriver(next.url, '/')\n@@ -213,7 +213,7 @@ describe('empty strategy in document body', () => {\n   afterAll(() => next.destroy())\n \n   it('Script is injected server-side', async () => {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n \n     try {\n       browser = await webdriver(next.url, '/')\n@@ -256,7 +256,7 @@ describe('empty strategy in document body', () => {\n       afterAll(() => next.destroy())\n \n       it('Partytown snippet is not injected to head if not enabled in configuration', async () => {\n-        let browser: BrowserInterface\n+        let browser: Playwright\n \n         try {\n           browser = await webdriver(next.url, '/')\n@@ -306,7 +306,7 @@ describe('empty strategy in document body', () => {\n       afterAll(() => next.destroy())\n \n       it('Partytown snippets are injected to head if enabled in configuration', async () => {\n-        let browser: BrowserInterface\n+        let browser: Playwright\n \n         try {\n           browser = await webdriver(next.url, '/')\n@@ -331,7 +331,7 @@ describe('empty strategy in document body', () => {\n       })\n \n       it('Worker scripts are modified by Partytown to execute on a worker thread', async () => {\n-        let browser: BrowserInterface\n+        let browser: Playwright\n \n         try {\n           browser = await webdriver(next.url, '/')\n@@ -391,7 +391,7 @@ describe('empty strategy in document body', () => {\n         })\n \n       it('Inline worker script through children is modified by Partytown to execute on a worker thread', async () => {\n-        let browser: BrowserInterface\n+        let browser: Playwright\n \n         next = await createNextApp(\n           `<Script id=\"inline-script\" strategy=\"worker\">{\"document.getElementById('text').textContent += 'abc'\"}</Script>`\n@@ -416,7 +416,7 @@ describe('empty strategy in document body', () => {\n       })\n \n       it('Inline worker script through dangerouslySetInnerHtml is modified by Partytown to execute on a worker thread', async () => {\n-        let browser: BrowserInterface\n+        let browser: Playwright\n \n         next = await createNextApp(\n           `<Script id=\"inline-script\" strategy=\"worker\" dangerouslySetInnerHTML={{__html: \"document.getElementById('text').textContent += 'abcd'\"}}/>`\n@@ -506,7 +506,7 @@ describe('empty strategy in document body', () => {\n       afterAll(() => next.destroy())\n \n       it('Partytown config script is overwritten', async () => {\n-        let browser: BrowserInterface\n+        let browser: Playwright\n \n         try {\n           browser = await webdriver(next.url, '/')"
        },
        {
            "sha": "bd65ae734fcce0b1c55553b9a479ba13b61e7a7e",
            "filename": "test/lib/add-redbox-matchers.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 11,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fadd-redbox-matchers.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fadd-redbox-matchers.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fadd-redbox-matchers.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -11,7 +11,7 @@ import {\n   getRedboxTotalErrorCount,\n   openRedbox,\n } from './next-test-utils'\n-import type { BrowserInterface } from './browsers/base'\n+import type { Playwright } from 'next-webdriver'\n import { NextInstance } from 'e2e-utils'\n \n declare global {\n@@ -72,7 +72,7 @@ interface ErrorSnapshot {\n }\n \n async function createErrorSnapshot(\n-  browser: BrowserInterface,\n+  browser: Playwright,\n   next: NextInstance | null\n ): Promise<ErrorSnapshot> {\n   const [label, environmentLabel, description, source, stack, componentStack] =\n@@ -164,7 +164,7 @@ async function createErrorSnapshot(\n type RedboxSnapshot = ErrorSnapshot | ErrorSnapshot[]\n \n async function createRedboxSnapshot(\n-  browser: BrowserInterface,\n+  browser: Playwright,\n   next: NextInstance | null\n ): Promise<RedboxSnapshot> {\n   const errorTally = await getRedboxTotalErrorCount(browser)\n@@ -196,12 +196,10 @@ async function createRedboxSnapshot(\n expect.extend({\n   async toDisplayRedbox(\n     this: MatcherContext,\n-    browserOrContext:\n-      | BrowserInterface\n-      | { browser: BrowserInterface; next: NextInstance },\n+    browserOrContext: Playwright | { browser: Playwright; next: NextInstance },\n     expectedRedboxSnapshot?: string\n   ) {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n     let next: NextInstance | null\n     if ('browser' in browserOrContext && 'next' in browserOrContext) {\n       browser = browserOrContext.browser\n@@ -247,12 +245,10 @@ expect.extend({\n   },\n   async toDisplayCollapsedRedbox(\n     this: MatcherContext,\n-    browserOrContext:\n-      | BrowserInterface\n-      | { browser: BrowserInterface; next: NextInstance },\n+    browserOrContext: Playwright | { browser: Playwright; next: NextInstance },\n     expectedRedboxSnapshot?: string\n   ) {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n     let next: NextInstance | null\n     if ('browser' in browserOrContext && 'next' in browserOrContext) {\n       browser = browserOrContext.browser"
        },
        {
            "sha": "731cd0526d683d92b9a25588b7b1bfe12af4ea56",
            "filename": "test/lib/browsers/base.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 128,
            "changes": 128,
            "blob_url": "https://github.com/vercel/next.js/blob/1f93d4975029cf591355fec095d7d16eaa1075a7/test%2Flib%2Fbrowsers%2Fbase.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1f93d4975029cf591355fec095d7d16eaa1075a7/test%2Flib%2Fbrowsers%2Fbase.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fbrowsers%2Fbase.ts?ref=1f93d4975029cf591355fec095d7d16eaa1075a7",
            "patch": "@@ -1,128 +0,0 @@\n-export type Event = 'request' | 'response'\n-\n-/**\n- * This is the base Browser interface all browser\n- * classes should build on, it is the bare\n- * methods we aim to support across tests\n- */\n-export abstract class BrowserInterface<TCurrent = any> {\n-  private promise?: Promise<TCurrent>;\n-\n-  // necessary for the type of the function below\n-  readonly [Symbol.toStringTag]: string = 'BrowserInterface'\n-\n-  protected chain<TNext>(\n-    nextCall: (current: TCurrent | undefined) => TNext | Promise<TNext>\n-  ): BrowserInterface<TNext> & Promise<TNext> {\n-    const syncError = new Error('next-browser-base-chain-error')\n-    const promise = Promise.resolve(this.promise)\n-      .then(nextCall)\n-      .catch((reason) => {\n-        if (\n-          reason !== null &&\n-          typeof reason === 'object' &&\n-          'stack' in reason\n-        ) {\n-          const syncCallStack = syncError.stack!.split(syncError.message)[1]\n-          reason.stack += `\\n${syncCallStack}`\n-        }\n-        throw reason\n-      })\n-\n-    function get(target: BrowserInterface<TNext>, p: string | symbol): any {\n-      switch (p) {\n-        case 'promise':\n-          return promise\n-        case 'then':\n-          return promise.then.bind(promise)\n-        case 'catch':\n-          return promise.catch.bind(promise)\n-        case 'finally':\n-          return promise.finally.bind(promise)\n-        default:\n-          return target[p]\n-      }\n-    }\n-\n-    return new Proxy<any>(this, {\n-      get,\n-    })\n-  }\n-\n-  abstract setup(\n-    browserName: string,\n-    locale: string,\n-    javaScriptEnabled: boolean,\n-    ignoreHttpsErrors: boolean,\n-    headless: boolean,\n-    userAgent: string | undefined\n-  ): Promise<void>\n-  abstract close(): Promise<void>\n-\n-  abstract elementsByCss(\n-    selector: string\n-  ): BrowserInterface<any[]> & Promise<any[]>\n-  abstract elementByCss(selector: string): BrowserInterface<any> & Promise<any>\n-  abstract elementById(selector: string): BrowserInterface<any> & Promise<any>\n-  abstract touchStart(): BrowserInterface<any> & Promise<any>\n-  abstract click(): BrowserInterface<any> & Promise<any>\n-  abstract keydown(key: string): BrowserInterface<any> & Promise<any>\n-  abstract keyup(key: string): BrowserInterface<any> & Promise<any>\n-  abstract type(text: string): BrowserInterface<any> & Promise<any>\n-  abstract moveTo(): BrowserInterface<any> & Promise<any>\n-  abstract waitForElementByCss(\n-    selector: string,\n-    timeout?: number\n-  ): BrowserInterface<any> & Promise<any>\n-  abstract waitForCondition(\n-    snippet: string,\n-    timeout?: number\n-  ): BrowserInterface<any> & Promise<any>\n-  /**\n-   * Use browsers `go back` functionality.\n-   */\n-  abstract back(options?: any): BrowserInterface<any> & Promise<any>\n-  /**\n-   * Use browsers `go forward` functionality. Inverse of back.\n-   */\n-  abstract forward(options?: any): BrowserInterface<any> & Promise<any>\n-  abstract refresh(): BrowserInterface<any> & Promise<any>\n-  abstract setDimensions(opts: {\n-    height: number\n-    width: number\n-  }): BrowserInterface<any> & Promise<any>\n-  abstract addCookie(opts: {\n-    name: string\n-    value: string\n-  }): BrowserInterface<any> & Promise<any>\n-  abstract deleteCookies(): BrowserInterface<void> & Promise<void>\n-  abstract on(event: Event, cb: (...args: any[]) => void): void\n-  abstract off(event: Event, cb: (...args: any[]) => void): void\n-  abstract loadPage(\n-    url: string,\n-    options?: {\n-      disableCache?: boolean\n-      cpuThrottleRate?: number\n-      beforePageLoad?: Function\n-      pushErrorAsConsoleLog?: boolean\n-    }\n-  ): Promise<void>\n-  abstract get(url: string): Promise<void>\n-  abstract getValue(): Promise<string>\n-  abstract getAttribute(name: string): Promise<string | null>\n-  abstract eval(snippet: string | Function, ...args: any[]): Promise<any>\n-  abstract evalAsync(snippet: string | Function, ...args: any[]): Promise<any>\n-  abstract text(): Promise<string>\n-  abstract getComputedCss(prop: string): Promise<string>\n-  abstract hasElementByCssSelector(selector: string): Promise<boolean>\n-  abstract log<T extends boolean = false>(options?: {\n-    includeArgs?: T\n-  }): Promise<\n-    T extends true\n-      ? { source: string; message: string; args: unknown[] }[]\n-      : { source: string; message: string }[]\n-  >\n-  abstract websocketFrames(): Promise<any[]>\n-  abstract url(): Promise<string>\n-  abstract waitForIdleNetwork(): Promise<void>\n-}"
        },
        {
            "sha": "7f4b1ec7fc31ddd9b7f365d35a0383b25afdf543",
            "filename": "test/lib/browsers/playwright.ts",
            "status": "modified",
            "additions": 193,
            "deletions": 104,
            "changes": 297,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fbrowsers%2Fplaywright.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fbrowsers%2Fplaywright.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fbrowsers%2Fplaywright.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,4 +1,3 @@\n-import { BrowserInterface, Event } from './base'\n import fs from 'fs-extra'\n import {\n   chromium,\n@@ -10,9 +9,13 @@ import {\n   ElementHandle,\n   devices,\n   Locator,\n+  Request as PlaywrightRequest,\n+  Response as PlaywrightResponse,\n } from 'playwright'\n import path from 'path'\n \n+type EventType = 'request' | 'response'\n+\n type PageLog = { source: string; message: string; args: unknown[] }\n \n let page: Page\n@@ -31,7 +34,7 @@ const defaultTimeout = process.env.NEXT_E2E_TEST_TIMEOUT\n     60 * 1000\n \n // loose global to register teardown functions before quitting the browser instance.\n-// This is due to `quit` can be called anytime outside of BrowserInterface's lifecycle,\n+// This is due to `quit` can be called anytime outside of Playwright's lifecycle,\n // which can create corrupted state by terminating the context.\n // [TODO] global `quit` might need to be removed, instead should introduce per-instance teardown\n const pendingTeardown: Array<() => Promise<void>> = []\n@@ -54,9 +57,9 @@ interface ElementHandleExt extends ElementHandle {\n   text(): Promise<string>\n }\n \n-export class Playwright extends BrowserInterface {\n+export class Playwright<TCurrent = undefined> {\n   private activeTrace?: string\n-  private eventCallbacks: Record<Event, Set<(...args: any[]) => void>> = {\n+  private eventCallbacks: Record<EventType, Set<(...args: any[]) => void>> = {\n     request: new Set(),\n     response: new Set(),\n   }\n@@ -106,7 +109,15 @@ export class Playwright extends BrowserInterface {\n     }\n   }\n \n-  on(event: Event, cb: (...args: any[]) => void) {\n+  on(\n+    event: 'request',\n+    cb: (request: PlaywrightRequest) => void | Promise<void>\n+  ): void\n+  on(\n+    event: 'response',\n+    cb: (request: PlaywrightResponse) => void | Promise<void>\n+  ): void\n+  on(event: EventType, cb: (...args: any[]) => void) {\n     if (!this.eventCallbacks[event]) {\n       throw new Error(\n         `Invalid event passed to browser.on, received ${event}. Valid events are ${Object.keys(\n@@ -116,7 +127,16 @@ export class Playwright extends BrowserInterface {\n     }\n     this.eventCallbacks[event]?.add(cb)\n   }\n-  off(event: Event, cb: (...args: any[]) => void) {\n+\n+  off(\n+    event: 'request',\n+    cb: (request: PlaywrightRequest) => void | Promise<void>\n+  ): void\n+  off(\n+    event: 'response',\n+    cb: (request: PlaywrightResponse) => void | Promise<void>\n+  ): void\n+  off(event: EventType, cb: (...args: any[]) => void) {\n     this.eventCallbacks[event]?.delete(cb)\n   }\n \n@@ -205,10 +225,10 @@ export class Playwright extends BrowserInterface {\n   async loadPage(\n     url: string,\n     opts?: {\n-      disableCache: boolean\n-      cpuThrottleRate: number\n+      disableCache?: boolean\n+      cpuThrottleRate?: number\n       pushErrorAsConsoleLog?: boolean\n-      beforePageLoad?: (...args: any[]) => void\n+      beforePageLoad?: (page: Page) => void\n     }\n   ) {\n     await this.close()\n@@ -295,26 +315,31 @@ export class Playwright extends BrowserInterface {\n     await page.goto(url, { waitUntil: 'load' })\n   }\n \n-  back(options) {\n-    return this.chain(async () => {\n+  back(options?: Parameters<Page['goBack']>[0]) {\n+    // do not preserve the previous chained value, it might be invalid after a navigation.\n+    return this.startChain(async () => {\n       await page.goBack(options)\n     })\n   }\n-  forward(options) {\n-    return this.chain(async () => {\n+  forward(options?: Parameters<Page['goForward']>[0]) {\n+    // do not preserve the previous chained value, it might be invalid after a navigation.\n+    return this.startChain(async () => {\n       await page.goForward(options)\n     })\n   }\n   refresh() {\n-    return this.chain(async () => {\n+    // do not preserve the previous chained value, it's likely to be invalid after a reload.\n+    return this.startChain(async () => {\n       await page.reload()\n     })\n   }\n   setDimensions({ width, height }: { height: number; width: number }) {\n-    return this.chain(() => page.setViewportSize({ width, height }))\n+    return this.startOrPreserveChain(() =>\n+      page.setViewportSize({ width, height })\n+    )\n   }\n   addCookie(opts: { name: string; value: string }) {\n-    return this.chain(async () =>\n+    return this.startOrPreserveChain(async () =>\n       context!.addCookies([\n         {\n           path: '/',\n@@ -325,11 +350,7 @@ export class Playwright extends BrowserInterface {\n     )\n   }\n   deleteCookies() {\n-    return this.chain(async () => context!.clearCookies())\n-  }\n-\n-  focusPage() {\n-    return this.chain(() => page.bringToFront())\n+    return this.startOrPreserveChain(async () => context!.clearCookies())\n   }\n \n   private wrapElement(el: ElementHandle, selector: string): ElementHandleExt {\n@@ -354,69 +375,69 @@ export class Playwright extends BrowserInterface {\n     return this.waitForElementByCss(selector, 5_000)\n   }\n \n-  elementById(sel) {\n-    return this.elementByCss(`#${sel}`)\n+  elementById(id: string) {\n+    return this.elementByCss(`#${id}`)\n   }\n \n-  getValue() {\n-    return this.chain((el: ElementHandleExt) => el.inputValue())\n+  getValue(this: Playwright<ElementHandleExt>) {\n+    return this.continueChain((el) => el.inputValue())\n   }\n \n-  text() {\n-    return this.chain((el: ElementHandleExt) => el.innerText())\n+  text(this: Playwright<ElementHandleExt>) {\n+    return this.continueChain((el) => el.innerText())\n   }\n \n-  type(text) {\n-    return this.chain((el: ElementHandleExt) => el.type(text))\n+  type(this: Playwright<ElementHandleExt>, text: string) {\n+    return this.continueChain(async (el) => {\n+      await el.type(text)\n+      return el\n+    })\n   }\n \n-  moveTo() {\n-    return this.chain((el: ElementHandleExt) => {\n-      return el.hover().then(() => el)\n+  moveTo(this: Playwright<ElementHandleExt>) {\n+    return this.continueChain(async (el) => {\n+      await el.hover()\n+      return el\n     })\n   }\n \n-  async getComputedCss(prop: string) {\n-    return this.chain((el: ElementHandleExt) => {\n-      return el.getComputedCss(prop)\n-    }) as any\n+  async getComputedCss(this: Playwright<ElementHandleExt>, prop: string) {\n+    return this.continueChain((el) => el.getComputedCss(prop))\n   }\n \n-  async getAttribute(attr) {\n-    return this.chain((el: ElementHandleExt) => el.getAttribute(attr))\n+  async getAttribute(this: Playwright<ElementHandleExt>, attr: string) {\n+    return this.continueChain((el) => el.getAttribute(attr))\n   }\n \n   hasElementByCssSelector(selector: string) {\n     return this.eval<boolean>(`!!document.querySelector('${selector}')`)\n   }\n \n   keydown(key: string) {\n-    return this.chain((el: ElementHandleExt) => {\n-      return page.keyboard.down(key).then(() => el)\n-    })\n+    return this.startOrPreserveChain(() => page.keyboard.down(key))\n   }\n \n   keyup(key: string) {\n-    return this.chain((el: ElementHandleExt) => {\n-      return page.keyboard.up(key).then(() => el)\n-    })\n+    return this.startOrPreserveChain(() => page.keyboard.up(key))\n   }\n \n-  click() {\n-    return this.chain((el: ElementHandleExt) => {\n-      return el.click().then(() => el)\n+  click(this: Playwright<ElementHandleExt>) {\n+    return this.continueChain(async (el) => {\n+      await el.click()\n+      return el\n     })\n   }\n \n-  touchStart() {\n-    return this.chain((el: ElementHandleExt) => {\n-      return el.dispatchEvent('touchstart').then(() => el)\n+  touchStart(this: Playwright<ElementHandleExt>) {\n+    return this.continueChain(async (el) => {\n+      await el.dispatchEvent('touchstart')\n+      return el\n     })\n   }\n \n-  elementsByCss(sel) {\n-    return this.chain(() =>\n-      page.$$(sel).then((els) => {\n+  elementsByCss(selector: string) {\n+    return this.startChain(() =>\n+      page.$$(selector).then((els) => {\n         return els.map((el) => {\n           const origGetAttribute = el.getAttribute.bind(el)\n           el.getAttribute = (name) => {\n@@ -430,69 +451,56 @@ export class Playwright extends BrowserInterface {\n     )\n   }\n \n-  waitForElementByCss(selector, timeout = 10_000) {\n-    return this.chain(() => {\n-      return page\n-        .waitForSelector(selector, { timeout, state: 'attached' })\n-        .then(async (el) => {\n-          // it seems selenium waits longer and tests rely on this behavior\n-          // so we wait for the load event fire before returning\n-          await page.waitForLoadState()\n-          return this.wrapElement(el, selector)\n-        })\n+  waitForElementByCss(selector: string, timeout = 10_000) {\n+    return this.startChain(async () => {\n+      const el = await page.waitForSelector(selector, {\n+        timeout,\n+        state: 'attached',\n+      })\n+      // it seems selenium waits longer and tests rely on this behavior\n+      // so we wait for the load event fire before returning\n+      await page.waitForLoadState()\n+      return this.wrapElement(el, selector)\n     })\n   }\n \n-  waitForCondition(condition, timeout) {\n-    return this.chain(() => {\n-      return page.waitForFunction(condition, { timeout })\n+  waitForCondition(snippet: string, timeout?: number) {\n+    return this.startOrPreserveChain(async () => {\n+      await page.waitForFunction(snippet, { timeout })\n     })\n   }\n \n-  eval<T = any>(fn: any, ...args: any[]): Promise<T> {\n-    return this.chain(() =>\n+  // TODO: this should default to unknown, but a lot of tests use and rely on the result being `any`\n+  eval<TFn extends (...args: any[]) => any>(\n+    fn: TFn,\n+    ...args: Parameters<TFn>\n+  ): Playwright<ReturnType<TFn>> & Promise<ReturnType<TFn>>\n+  // TODO: this is ugly, the type parameter is basically a hidden cast\n+  eval<T = any>(fn: string, ...args: any[]): Playwright<T> & Promise<T>\n+  eval<T = any>(\n+    fn: string | ((...args: any[]) => any),\n+    ...args: any[]\n+  ): Playwright<T> & Promise<T>\n+  eval(\n+    fn: string | ((...args: any[]) => any),\n+    ...args: any[]\n+  ): Playwright<any> & Promise<any> {\n+    return this.startChain(async () =>\n       page\n         .evaluate(fn, ...args)\n         .catch((err) => {\n+          // TODO: gross, why are we doing this\n           console.error('eval error:', err)\n-          return null\n+          return null!\n         })\n-        .then(async (val) => {\n+        .finally(async () => {\n           await page.waitForLoadState()\n-          return val as T\n         })\n     )\n   }\n \n-  async evalAsync<T = any>(fn: any) {\n-    if (typeof fn === 'function') {\n-      fn = fn.toString()\n-    }\n-\n-    if (fn.includes(`var callback = arguments[arguments.length - 1]`)) {\n-      fn = `(function() {\n-        return new Promise((resolve, reject) => {\n-          const origFunc = ${fn}\n-          try {\n-            origFunc(resolve)\n-          } catch (err) {\n-            reject(err)\n-          }\n-        })\n-      })()`\n-    }\n-\n-    return page.evaluate<T>(fn).catch(() => null)\n-  }\n-\n-  async log<T extends boolean = false>(options?: {\n-    includeArgs?: T\n-  }): Promise<\n-    T extends true\n-      ? { source: string; message: string; args: unknown[] }[]\n-      : { source: string; message: string }[]\n-  > {\n-    return this.chain(\n+  async log<T extends boolean = false>(options?: { includeArgs?: T }) {\n+    return this.startChain(\n       () =>\n         options?.includeArgs\n           ? Promise.all(pageLogs)\n@@ -508,15 +516,15 @@ export class Playwright extends BrowserInterface {\n   }\n \n   async websocketFrames() {\n-    return this.chain(() => websocketFrames)\n+    return this.startChain(() => websocketFrames)\n   }\n \n   async url() {\n-    return this.chain(() => page.url())\n+    return this.startChain(() => page.url())\n   }\n \n-  async waitForIdleNetwork(): Promise<void> {\n-    return this.chain(() => {\n+  async waitForIdleNetwork() {\n+    return this.startOrPreserveChain(() => {\n       return page.waitForLoadState('networkidle')\n     })\n   }\n@@ -530,4 +538,85 @@ export class Playwright extends BrowserInterface {\n   locateDevToolsIndicator(): Locator {\n     return page.locator('nextjs-portal [data-nextjs-dev-tools-button]')\n   }\n+\n+  /** A call that expects to be chained after a previous call, because it needs its value. */\n+  private continueChain<TNext>(nextCall: (value: TCurrent) => Promise<TNext>) {\n+    return this._chain(true, nextCall)\n+  }\n+\n+  /** Start a chain. If continuing, it overwrites the current chained value. */\n+  private startChain<TNext>(nextCall: () => TNext | Promise<TNext>) {\n+    return this._chain(false, nextCall)\n+  }\n+\n+  /** Either start or continue a chain. If continuing, it preserves the current chained value. */\n+  private startOrPreserveChain(nextCall: () => Promise<void>) {\n+    return this._chain(false, async (value) => {\n+      await nextCall()\n+      return value\n+    })\n+  }\n+\n+  // necessary for the type of the function below\n+  readonly [Symbol.toStringTag]: string = 'Playwright'\n+\n+  private _chain<TNext>(\n+    this: Playwright<TCurrent>,\n+    mustBeChained: boolean,\n+    nextCall: (current: TCurrent) => TNext | Promise<TNext>\n+  ): Playwright<TNext> & Promise<TNext> {\n+    const syncError = new Error('next-browser-base-chain-error')\n+\n+    // If `this` is actually a proxy created by a previous chained call, it'll act like it has a `promise` property.\n+    // (see proxy code below)\n+    type MaybeChained<T> = Playwright<T> & {\n+      promise?: Promise<T>\n+    }\n+    const self = this as MaybeChained<TCurrent>\n+\n+    let currentPromise = self.promise\n+    if (!currentPromise) {\n+      if (mustBeChained) {\n+        // Note that this should also be enforced by the type system\n+        // by adding appropriate `(this: Playwright<PreviousValue>)` type annotations\n+        // to methods that expect to be chained, but tests can bypass this (or not be checked because they use JS)\n+        throw new Error(\n+          'Expected this call to be chained after a previous call'\n+        )\n+      } else {\n+        // We're handling a call that does not expect to be chained after a previous one,\n+        // so it's safe to default the current value to undefined -- we don't need a value to invoke `nextCall`\n+        currentPromise = Promise.resolve(undefined as TCurrent)\n+      }\n+    }\n+\n+    const promise = currentPromise.then(nextCall).catch((reason: unknown) => {\n+      // TODO: only patch the stacktrace if the sync callstack is missing from it\n+      if (reason && typeof reason === 'object' && 'stack' in reason) {\n+        const syncCallStack = syncError.stack!.split(syncError.message)[1]\n+        reason.stack += `\\n${syncCallStack}`\n+      }\n+      throw reason\n+    })\n+\n+    function get(target: Playwright<TCurrent>, p: string | symbol): any {\n+      switch (p) {\n+        case 'promise':\n+          return promise\n+        case 'then':\n+          return promise.then.bind(promise)\n+        case 'catch':\n+          return promise.catch.bind(promise)\n+        case 'finally':\n+          return promise.finally.bind(promise)\n+        default:\n+          return target[p]\n+      }\n+    }\n+\n+    // @ts-expect-error: we're changing `TCurrent` into TNext via proxy hacks\n+    return new Proxy(this, {\n+      get,\n+    })\n+  }\n }"
        },
        {
            "sha": "cdef64581f964626ebaa9ae2c8cdac7ddb8b9a8c",
            "filename": "test/lib/development-sandbox.ts",
            "status": "modified",
            "additions": 34,
            "deletions": 23,
            "changes": 57,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fdevelopment-sandbox.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fdevelopment-sandbox.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fdevelopment-sandbox.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -14,20 +14,21 @@ import {\n } from './next-test-utils'\n import webdriver, { WebdriverOptions } from './next-webdriver'\n import { NextInstance } from './next-modes/base'\n-import { BrowserInterface } from './browsers/base'\n+import { Playwright } from 'next-webdriver'\n \n-export function waitForHydration(browser: BrowserInterface): Promise<void> {\n-  return browser.evalAsync(function () {\n-    var callback = arguments[arguments.length - 1]\n-    if ((window as any).__NEXT_HYDRATED) {\n-      callback()\n-    } else {\n-      var timeout = setTimeout(callback, 30 * 1000)\n-      ;(window as any).__NEXT_HYDRATED_CB = function () {\n-        clearTimeout(timeout)\n-        callback()\n+export async function waitForHydration(browser: Playwright) {\n+  await browser.eval(() => {\n+    return new Promise<void>((resolve) => {\n+      if ((window as any).__NEXT_HYDRATED) {\n+        resolve()\n+      } else {\n+        var timeout = setTimeout(resolve, 30 * 1000)\n+        ;(window as any).__NEXT_HYDRATED_CB = function () {\n+          clearTimeout(timeout)\n+          resolve()\n+        }\n       }\n-    }\n+    })\n   })\n }\n \n@@ -50,6 +51,26 @@ export async function createSandbox(\n     await next.start()\n \n     const browser = await webdriver(next.url, initialUrl, webDriverOptions)\n+\n+    async function evaluate<TFn extends (...args: any[]) => any>(\n+      fn: TFn,\n+      ...args: Parameters<TFn>\n+    ): Promise<ReturnType<TFn>>\n+    async function evaluate(fn: string): Promise<unknown>\n+    async function evaluate(\n+      snippet: string | ((...args: any) => any)\n+    ): Promise<any> {\n+      if (typeof snippet === 'function' || typeof snippet === 'string') {\n+        const result = await browser.eval(snippet)\n+        await waitFor(30)\n+        return result\n+      } else {\n+        throw new Error(\n+          `You must pass a string or function to be evaluated in the browser.`\n+        )\n+      }\n+    }\n+\n     return {\n       browser,\n       session: {\n@@ -106,17 +127,7 @@ export async function createSandbox(\n         async remove(filename) {\n           await next.deleteFile(filename)\n         },\n-        async evaluate(snippet: string | Function) {\n-          if (typeof snippet === 'function' || typeof snippet === 'string') {\n-            const result = await browser.eval(snippet)\n-            await waitFor(30)\n-            return result\n-          } else {\n-            throw new Error(\n-              `You must pass a string or function to be evaluated in the browser.`\n-            )\n-          }\n-        },\n+        evaluate,\n         async assertHasRedbox() {\n           return assertHasRedbox(browser)\n         },"
        },
        {
            "sha": "799377b61af69ed8769b78d9a555f2082a1023f4",
            "filename": "test/lib/next-modes/base.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fnext-modes%2Fbase.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fnext-modes%2Fbase.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-modes%2Fbase.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -11,7 +11,7 @@ import webdriver from '../next-webdriver'\n import { renderViaHTTP, fetchViaHTTP, findPort } from 'next-test-utils'\n import cheerio from 'cheerio'\n import { once } from 'events'\n-import { BrowserInterface } from '../browsers/base'\n+import { Playwright } from 'next-webdriver'\n import escapeStringRegexp from 'escape-string-regexp'\n \n type Event = 'stdout' | 'stderr' | 'error' | 'destroy'\n@@ -656,7 +656,7 @@ export class NextInstance {\n    */\n   public async browser(\n     ...args: Parameters<OmitFirstArgument<typeof webdriver>>\n-  ): Promise<BrowserInterface> {\n+  ): Promise<Playwright> {\n     return webdriver(this.url, ...args)\n   }\n "
        },
        {
            "sha": "4ed504f7d9862abdb956c3a7937e9d4a503e26c2",
            "filename": "test/lib/next-test-utils.ts",
            "status": "modified",
            "additions": 47,
            "deletions": 70,
            "changes": 117,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fnext-test-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fnext-test-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-test-utils.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -26,8 +26,7 @@ import _pkg from 'next/package.json'\n import type { SpawnOptions, ChildProcess } from 'child_process'\n import type { RequestInit, Response } from 'node-fetch'\n import type { NextServer } from 'next/dist/server/next'\n-import { BrowserInterface } from './browsers/base'\n-import { Playwright } from './browsers/playwright'\n+import { Playwright } from 'next-webdriver'\n \n import { getTurbopackFlag, shouldRunTurboDevTest } from './turbo'\n import stripAnsi from 'strip-ansi'\n@@ -829,11 +828,8 @@ export async function retry<T>(\n   throw new Error('Duration cannot be less than 0.')\n }\n \n-export async function assertHasRedbox(browser: BrowserInterface) {\n-  // TODO: Implement for other BrowserInterface implementations\n-  const playwright = browser as Playwright\n-\n-  const redbox = playwright.locateRedbox()\n+export async function assertHasRedbox(browser: Playwright) {\n+  const redbox = browser.locateRedbox()\n   try {\n     await redbox.waitFor({ timeout: 5000 })\n   } catch (errorCause) {\n@@ -855,12 +851,9 @@ export async function assertHasRedbox(browser: BrowserInterface) {\n   }\n }\n \n-export async function assertNoRedbox(browser: BrowserInterface) {\n-  // TODO: Implement for other BrowserInterface implementations\n-  const playwright = browser as Playwright\n-\n+export async function assertNoRedbox(browser: Playwright) {\n   await waitFor(5000)\n-  const redbox = playwright.locateRedbox()\n+  const redbox = browser.locateRedbox()\n \n   if (await redbox.isVisible()) {\n     const [redboxHeader, redboxDescription, redboxSource] = await Promise.all([\n@@ -880,9 +873,7 @@ export async function assertNoRedbox(browser: BrowserInterface) {\n   }\n }\n \n-export async function hasErrorToast(\n-  browser: BrowserInterface\n-): Promise<boolean> {\n+export async function hasErrorToast(browser: Playwright): Promise<boolean> {\n   return Boolean(\n     await browser.eval(() => {\n       const portal = [].slice\n@@ -896,9 +887,7 @@ export async function hasErrorToast(\n   )\n }\n \n-export async function getToastErrorCount(\n-  browser: BrowserInterface\n-): Promise<number> {\n+export async function getToastErrorCount(browser: Playwright): Promise<number> {\n   return parseInt(\n     (await browser.eval(() => {\n       const portal = [].slice\n@@ -908,18 +897,16 @@ export async function getToastErrorCount(\n       const root = portal?.shadowRoot\n       const node = root?.querySelector('[data-issues-count]')\n       return node?.innerText || '0'\n-    })) ?? 0\n+    })) ?? '0'\n   )\n }\n \n /**\n  * Has retried version of {@link hasErrorToast} built-in.\n  * Success implies {@link assertHasRedbox}.\n  */\n-export async function openRedbox(browser: BrowserInterface): Promise<void> {\n-  // TODO: Implement for other BrowserInterface implementations\n-  const playwright = browser as Playwright\n-  const redbox = playwright.locateRedbox()\n+export async function openRedbox(browser: Playwright): Promise<void> {\n+  const redbox = browser.locateRedbox()\n   if (await redbox.isVisible()) {\n     const error = new Error(\n       'Redbox is already open. Use `assertHasRedbox` instead.'\n@@ -939,7 +926,7 @@ export async function openRedbox(browser: BrowserInterface): Promise<void> {\n }\n \n export async function openDevToolsIndicatorPopover(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<void> {\n   const devToolsIndicator = await assertHasDevToolsIndicator(browser)\n \n@@ -952,11 +939,8 @@ export async function openDevToolsIndicatorPopover(\n   }\n }\n \n-export async function assertHasDevToolsIndicator(browser: BrowserInterface) {\n-  // TODO: Implement for other BrowserInterface implementations\n-  const playwright = browser as Playwright\n-\n-  const devToolsIndicator = playwright.locateDevToolsIndicator()\n+export async function assertHasDevToolsIndicator(browser: Playwright) {\n+  const devToolsIndicator = browser.locateDevToolsIndicator()\n   try {\n     await devToolsIndicator.waitFor({ timeout: 5000 })\n   } catch (errorCause) {\n@@ -970,11 +954,8 @@ export async function assertHasDevToolsIndicator(browser: BrowserInterface) {\n   return devToolsIndicator\n }\n \n-export async function assertNoDevToolsIndicator(browser: BrowserInterface) {\n-  // TODO: Implement for other BrowserInterface implementations\n-  const playwright = browser as Playwright\n-\n-  const devToolsIndicator = playwright.locateDevToolsIndicator()\n+export async function assertNoDevToolsIndicator(browser: Playwright) {\n+  const devToolsIndicator = browser.locateDevToolsIndicator()\n \n   if (await devToolsIndicator.isVisible()) {\n     const error = new Error(\n@@ -986,7 +967,7 @@ export async function assertNoDevToolsIndicator(browser: BrowserInterface) {\n }\n \n export async function getRouteTypeFromDevToolsIndicator(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<'Static' | 'Dynamic'> {\n   await openDevToolsIndicatorPopover(browser)\n \n@@ -1016,9 +997,7 @@ export async function getRouteTypeFromDevToolsIndicator(\n   })\n }\n \n-export function getRedboxHeader(\n-  browser: BrowserInterface\n-): Promise<string | null> {\n+export function getRedboxHeader(browser: Playwright): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n@@ -1029,7 +1008,7 @@ export function getRedboxHeader(\n }\n \n export async function getRedboxTotalErrorCount(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<number> {\n   const text = await browser.eval(() => {\n     const portal = [].slice\n@@ -1045,9 +1024,7 @@ export async function getRedboxTotalErrorCount(\n   return parseInt(text || '-1')\n }\n \n-export function getRedboxSource(\n-  browser: BrowserInterface\n-): Promise<string | null> {\n+export function getRedboxSource(browser: Playwright): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n@@ -1064,9 +1041,7 @@ export function getRedboxSource(\n   })\n }\n \n-export function getRedboxTitle(\n-  browser: BrowserInterface\n-): Promise<string | null> {\n+export function getRedboxTitle(browser: Playwright): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n@@ -1080,9 +1055,7 @@ export function getRedboxTitle(\n   })\n }\n \n-export function getRedboxLabel(\n-  browser: BrowserInterface\n-): Promise<string | null> {\n+export function getRedboxLabel(browser: Playwright): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n@@ -1095,7 +1068,7 @@ export function getRedboxLabel(\n }\n \n export function getRedboxEnvironmentLabel(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n@@ -1110,7 +1083,7 @@ export function getRedboxEnvironmentLabel(\n }\n \n export function getRedboxDescription(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n@@ -1124,7 +1097,7 @@ export function getRedboxDescription(\n }\n \n export function getRedboxDescriptionWarning(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n@@ -1138,7 +1111,7 @@ export function getRedboxDescriptionWarning(\n }\n \n export function getRedboxErrorLink(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<string | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n@@ -1151,8 +1124,10 @@ export function getRedboxErrorLink(\n   })\n }\n \n-export function getBrowserBodyText(browser: BrowserInterface) {\n-  return browser.eval('document.getElementsByTagName(\"body\")[0].innerText')\n+export function getBrowserBodyText(browser: Playwright) {\n+  return browser.eval<string>(\n+    'document.getElementsByTagName(\"body\")[0].innerText'\n+  )\n }\n \n export function normalizeRegEx(src: string) {\n@@ -1374,7 +1349,7 @@ export function getSnapshotTestDescribe(variant: TestVariants) {\n  * @returns `null` if there are no frames\n  */\n export async function getRedboxComponentStack(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<string | null> {\n   const componentStackFrameElements = await browser.elementsByCss(\n     '[data-nextjs-container-errors-pseudo-html] code'\n@@ -1390,7 +1365,7 @@ export async function getRedboxComponentStack(\n   return componentStackFrameTexts.join('\\n').trim()\n }\n \n-export async function hasRedboxCallStack(browser: BrowserInterface) {\n+export async function hasRedboxCallStack(browser: Playwright) {\n   return browser.eval(() => {\n     const portal = [].slice\n       .call(document.querySelectorAll('nextjs-portal'))\n@@ -1402,7 +1377,7 @@ export async function hasRedboxCallStack(browser: BrowserInterface) {\n }\n \n export async function getRedboxCallStack(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<string[] | null> {\n   return browser.eval(() => {\n     const portal = [].slice\n@@ -1452,7 +1427,7 @@ export async function getRedboxCallStack(\n }\n \n export async function getRedboxCallStackCollapsed(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<string> {\n   const callStackFrameElements = await browser.elementsByCss(\n     '.nextjs-container-errors-body > [data-nextjs-codeframe] > :first-child, ' +\n@@ -1467,7 +1442,7 @@ export async function getRedboxCallStackCollapsed(\n }\n \n export async function getVersionCheckerText(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<string> {\n   await browser.waitForElementByCss('[data-nextjs-version-checker]', 30000)\n   const versionCheckerElement = await browser.elementByCss(\n@@ -1505,18 +1480,18 @@ export function getUrlFromBackgroundImage(backgroundImage: string) {\n   return matches\n }\n \n-export const getTitle = (browser: BrowserInterface) =>\n+export const getTitle = (browser: Playwright) =>\n   browser.elementByCss('title').text()\n \n async function checkMeta(\n-  browser: BrowserInterface,\n+  browser: Playwright,\n   queryValue: string,\n   expected: RegExp | string | string[] | undefined | null,\n   queryKey: string = 'property',\n   tag: string = 'meta',\n   domAttributeField: string = 'content'\n ) {\n-  const values = await browser.eval(\n+  const values = await browser.eval<(string | null)[]>(\n     `[...document.querySelectorAll('${tag}[${queryKey}=\"${queryValue}\"]')].map((el) => el.getAttribute(\"${domAttributeField}\"))`\n   )\n   if (expected instanceof RegExp) {\n@@ -1536,7 +1511,7 @@ async function checkMeta(\n   }\n }\n \n-export function createDomMatcher(browser: BrowserInterface) {\n+export function createDomMatcher(browser: Playwright) {\n   /**\n    * @param tag - tag name, e.g. 'meta'\n    * @param query - query string, e.g. 'name=\"description\"'\n@@ -1602,7 +1577,7 @@ export function createMultiHtmlMatcher($: ReturnType<typeof cheerio.load>) {\n   }\n }\n \n-export function createMultiDomMatcher(browser: BrowserInterface) {\n+export function createMultiDomMatcher(browser: Playwright) {\n   /**\n    * @param tag - tag name, e.g. 'meta'\n    * @param queryKey - query key, e.g. 'property'\n@@ -1641,13 +1616,13 @@ export function createMultiDomMatcher(browser: BrowserInterface) {\n }\n \n export const checkMetaNameContentPair = (\n-  browser: BrowserInterface,\n+  browser: Playwright,\n   name: string,\n   content: string | string[]\n ) => checkMeta(browser, name, content, 'name')\n \n export const checkLink = (\n-  browser: BrowserInterface,\n+  browser: Playwright,\n   rel: string,\n   content: string | string[]\n ) => checkMeta(browser, rel, content, 'rel', 'link', 'href')\n@@ -1679,7 +1654,7 @@ export async function getStackFramesContent(browser) {\n   return stackFramesContent\n }\n \n-export async function toggleCollapseCallStackFrames(browser: BrowserInterface) {\n+export async function toggleCollapseCallStackFrames(browser: Playwright) {\n   const button = await browser.elementByCss('[data-expand-ignore-button]')\n   const lastExpanded = await button.getAttribute('data-expand-ignore-button')\n   await button.click()\n@@ -1713,7 +1688,7 @@ export function createNowRouteMatches(\n   return urlSearchParams\n }\n \n-export async function assertNoConsoleErrors(browser: BrowserInterface) {\n+export async function assertNoConsoleErrors(browser: Playwright) {\n   const logs = await browser.log()\n   const warningsAndErrors = logs.filter((log) => {\n     return (\n@@ -1730,14 +1705,16 @@ export async function assertNoConsoleErrors(browser: BrowserInterface) {\n }\n \n export async function getHighlightedDiffLines(\n-  browser: BrowserInterface\n+  browser: Playwright\n ): Promise<[string, string][]> {\n   const lines = await browser.elementsByCss(\n     '[data-nextjs-container-errors-pseudo-html--diff]'\n   )\n   return Promise.all(\n     lines.map(async (line) => [\n-      await line.getAttribute('data-nextjs-container-errors-pseudo-html--diff'),\n+      (await line.getAttribute(\n+        'data-nextjs-container-errors-pseudo-html--diff'\n+      ))!,\n       (await line.innerText())[0],\n     ])\n   )"
        },
        {
            "sha": "38883ef8bd341661d97f5d976b3fbc9c43cf5141",
            "filename": "test/lib/next-webdriver.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 34,
            "changes": 66,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fnext-webdriver.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Flib%2Fnext-webdriver.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-webdriver.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,6 +1,9 @@\n import { getFullUrl, waitFor } from 'next-test-utils'\n import os from 'os'\n-import { BrowserInterface } from './browsers/base'\n+import { Playwright } from './browsers/playwright'\n+import { Page } from 'playwright'\n+\n+export type { Playwright }\n \n if (!process.env.TEST_FILE_PATH) {\n   process.env.TEST_FILE_PATH = module.parent!.filename\n@@ -59,7 +62,7 @@ export interface WebdriverOptions {\n    * @param page\n    * @returns\n    */\n-  beforePageLoad?: (page: any) => void\n+  beforePageLoad?: (page: Page) => void\n   /**\n    * browser locale\n    */\n@@ -92,9 +95,7 @@ export default async function webdriver(\n   appPortOrUrl: string | number,\n   url: string,\n   options?: WebdriverOptions\n-): Promise<BrowserInterface> {\n-  let CurrentInterface: new () => BrowserInterface\n-\n+): Promise<Playwright> {\n   const defaultOptions = {\n     waitHydration: true,\n     retryWaitHydration: false,\n@@ -116,10 +117,9 @@ export default async function webdriver(\n   } = options\n \n   const { Playwright, quit } = await import('./browsers/playwright')\n-  CurrentInterface = Playwright\n   browserQuit = quit\n \n-  const browser = new CurrentInterface()\n+  const browser = new Playwright()\n   const browserName = process.env.BROWSER_NAME || 'chrome'\n   await browser.setup(\n     browserName,\n@@ -155,33 +155,33 @@ export default async function webdriver(\n     console.log(`\\n> Waiting hydration for ${fullUrl}\\n`)\n \n     const checkHydrated = async () => {\n-      await browser.evalAsync(function () {\n-        var callback = arguments[arguments.length - 1]\n-\n-        // if it's not a Next.js app return\n-        if (\n-          !document.documentElement.innerHTML.includes('__NEXT_DATA__') &&\n-          // @ts-ignore next exists on window if it's a Next.js page.\n-          typeof ((window as any).next && (window as any).next.version) ===\n-            'undefined'\n-        ) {\n-          console.log('Not a next.js page, resolving hydrate check')\n-          callback()\n-        }\n-\n-        // TODO: should we also ensure router.isReady is true\n-        // by default before resolving?\n-        if ((window as any).__NEXT_HYDRATED) {\n-          console.log('Next.js page already hydrated')\n-          callback()\n-        } else {\n-          var timeout = setTimeout(callback, 10 * 1000)\n-          ;(window as any).__NEXT_HYDRATED_CB = function () {\n-            clearTimeout(timeout)\n-            console.log('Next.js hydrate callback fired')\n+      await browser.eval(() => {\n+        return new Promise<void>((callback) => {\n+          // if it's not a Next.js app return\n+          if (\n+            !document.documentElement.innerHTML.includes('__NEXT_DATA__') &&\n+            // @ts-ignore next exists on window if it's a Next.js page.\n+            typeof ((window as any).next && (window as any).next.version) ===\n+              'undefined'\n+          ) {\n+            console.log('Not a next.js page, resolving hydrate check')\n+            callback()\n+          }\n+\n+          // TODO: should we also ensure router.isReady is true\n+          // by default before resolving?\n+          if ((window as any).__NEXT_HYDRATED) {\n+            console.log('Next.js page already hydrated')\n             callback()\n+          } else {\n+            let timeout = setTimeout(callback, 10 * 1000)\n+            ;(window as any).__NEXT_HYDRATED_CB = function () {\n+              clearTimeout(timeout)\n+              console.log('Next.js hydrate callback fired')\n+              callback()\n+            }\n           }\n-        }\n+        })\n       })\n     }\n \n@@ -209,5 +209,3 @@ export default async function webdriver(\n   }\n   return browser\n }\n-\n-export { BrowserInterface }"
        },
        {
            "sha": "fc0674f79585e1831cd23752743879febfdcaca4",
            "filename": "test/production/app-dir-prefetch-non-iso-url/index.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fproduction%2Fapp-dir-prefetch-non-iso-url%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fproduction%2Fapp-dir-prefetch-non-iso-url%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir-prefetch-non-iso-url%2Findex.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,7 +1,7 @@\n import { createNext, FileRef } from 'e2e-utils'\n import { NextInstance } from 'e2e-utils'\n import { join } from 'path'\n-import { BrowserInterface } from '../../lib/browsers/base'\n+import { Playwright } from 'next-webdriver'\n import webdriver from 'next-webdriver'\n import { check } from 'next-test-utils'\n \n@@ -19,7 +19,7 @@ describe('app-dir-prefetch-non-iso-url', () => {\n   afterAll(() => next.destroy())\n \n   it('should go to iso url', async () => {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n \n     try {\n       browser = await webdriver(next.url, '/')\n@@ -33,7 +33,7 @@ describe('app-dir-prefetch-non-iso-url', () => {\n   })\n \n   it('should go to non-iso url', async () => {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n \n     try {\n       browser = await webdriver(next.url, '/')"
        },
        {
            "sha": "d0611e35bd87b19505e09871dff17c5f4eec70b3",
            "filename": "test/production/bfcache-routing/index.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 7,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fproduction%2Fbfcache-routing%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fproduction%2Fbfcache-routing%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fbfcache-routing%2Findex.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -36,7 +36,7 @@ describe('bfcache-routing', () => {\n     const browser = await webdriver(port, '/index.html', { headless: false })\n \n     // we overwrite the typical waitUntil: 'load' option here as the event is never being triggered if we hit the bfcache\n-    const bfOptions = { waitUntil: 'commit' }\n+    const bfOptions = { waitUntil: 'commit' as const }\n \n     await browser.elementByCss('a[href=\"https://example.vercel.sh\"]').click()\n     await browser.waitForCondition(\n@@ -49,14 +49,14 @@ describe('bfcache-routing', () => {\n       'window.location.origin.includes(\"localhost\")'\n     )\n \n-    let html = await browser.evalAsync('document.documentElement.innerHTML')\n+    let html = await browser.eval<string>('document.documentElement.innerHTML')\n \n     expect(html).toContain('BFCache Test')\n \n-    await browser.evalAsync(`document.querySelector('button').click()`)\n+    await browser.eval(`document.querySelector('button').click()`)\n \n     // we should still be on the test page\n-    html = await browser.evalAsync('document.documentElement.innerHTML')\n+    html = await browser.eval<string>('document.documentElement.innerHTML')\n     expect(html).toContain('BFCache Test')\n \n     await browser.forward(bfOptions)\n@@ -67,13 +67,13 @@ describe('bfcache-routing', () => {\n     )\n \n     // we should be back on the test page with no errors\n-    html = await browser.evalAsync('document.documentElement.innerHTML')\n+    html = await browser.eval<string>('document.documentElement.innerHTML')\n     expect(html).toContain('BFCache Test')\n \n     // After restoring from bfcache, a subsequent mpa navigation to the same URL should work\n-    // We trigger the click via `evalAsync` because when restoring from bfcache, our internal\n+    // We trigger the click via `eval` because when restoring from bfcache, our internal\n     // 'waitForElementByCss' method doesn't think the element is attached to the DOM.\n-    await browser.evalAsync(\n+    await browser.eval(\n       `document.querySelector('a[href=\"https://example.vercel.sh\"]').click()`\n     )\n     await browser.waitForCondition("
        },
        {
            "sha": "0b1e9b43c6581f73a422ded4aef4a02e0eaae937",
            "filename": "test/production/emit-decorator-metadata/index.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fproduction%2Femit-decorator-metadata%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/4282bc6f91a5a58830a54137e2eaf09a08d84ae7/test%2Fproduction%2Femit-decorator-metadata%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Femit-decorator-metadata%2Findex.test.ts?ref=4282bc6f91a5a58830a54137e2eaf09a08d84ae7",
            "patch": "@@ -1,5 +1,5 @@\n import { join } from 'path'\n-import webdriver, { BrowserInterface } from 'next-webdriver'\n+import webdriver, { Playwright } from 'next-webdriver'\n import { createNext } from 'e2e-utils'\n import { NextInstance } from 'e2e-utils'\n import { fetchViaHTTP } from 'next-test-utils'\n@@ -21,7 +21,7 @@ describe('emitDecoratorMetadata SWC option', () => {\n   afterAll(() => next.destroy())\n \n   it('should compile with emitDecoratorMetadata enabled', async () => {\n-    let browser: BrowserInterface\n+    let browser: Playwright\n     try {\n       browser = await webdriver(next.url, '/')\n       const message = await browser.elementByCss('#message').text()"
        }
    ],
    "stats": {
        "total": 1113,
        "additions": 511,
        "deletions": 602
    }
}