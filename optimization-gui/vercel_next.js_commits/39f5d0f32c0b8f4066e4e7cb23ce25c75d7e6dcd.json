{
    "author": "eps1lon",
    "message": "[test] Dedicate suite for React's Server Request performance track (#81312)\n\nWe're testing this here since framework integration via `filterStackTrace` determines what React uses to determine the name of the Performance entry.",
    "sha": "39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd",
    "files": [
        {
            "sha": "9d0bb3d4a05d5f0448e68e667a57181547a552de",
            "filename": "test/development/app-dir/react-performance-track/app/fetch/page.tsx",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Ffetch%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Ffetch%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Ffetch%2Fpage.tsx?ref=39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd",
            "patch": "@@ -0,0 +1,16 @@\n+async function abstraction() {\n+  const response = await fetch(\n+    'https://next-data-api-endpoint.vercel.app/api/random'\n+  )\n+  await response.json()\n+}\n+\n+export default async function FetchPage() {\n+  await abstraction()\n+  const response = await fetch(\n+    'https://next-data-api-endpoint.vercel.app/api/random'\n+  )\n+  await response.json()\n+\n+  return <p>Done</p>\n+}"
        },
        {
            "sha": "00098bb74ebdc4b76dc12aba2316a4af62d4c7f0",
            "filename": "test/development/app-dir/react-performance-track/app/layout.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Flayout.tsx?ref=39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd",
            "patch": "@@ -0,0 +1,10 @@\n+import { ReactNode, Suspense } from 'react'\n+export default function Root({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>\n+        <Suspense>{children}</Suspense>\n+      </body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "53e7cea6fcf6c31cbfb8d118cb9f9d93abefc7cc",
            "filename": "test/development/app-dir/react-performance-track/app/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Fpage.tsx?ref=39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd",
            "patch": "@@ -0,0 +1,5 @@\n+const error = new Error('test')\n+export default function Page() {\n+  console.error(error)\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "87d771c1d100407b161952621e773d8ad201501e",
            "filename": "test/development/app-dir/react-performance-track/app/set-timeout/page.tsx",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Fset-timeout%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Fset-timeout%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fapp%2Fset-timeout%2Fpage.tsx?ref=39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd",
            "patch": "@@ -0,0 +1,12 @@\n+import { setTimeout } from 'timers/promises'\n+\n+async function abstraction(timeoutMS: number) {\n+  await setTimeout(timeoutMS)\n+}\n+\n+export default async function SetTimeoutPage() {\n+  await abstraction(5)\n+  await setTimeout(1000)\n+\n+  return <p>Done</p>\n+}"
        },
        {
            "sha": "04f5f2facffba4fdd2f411a3f62aa7a259d52d0b",
            "filename": "test/development/app-dir/react-performance-track/instrumentation-client.ts",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Finstrumentation-client.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Finstrumentation-client.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Finstrumentation-client.ts?ref=39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd",
            "patch": "@@ -0,0 +1,33 @@\n+export {}\n+\n+declare global {\n+  interface Window {\n+    reactServerRequests: Array<{\n+      name: string\n+      properties: any\n+    }>\n+  }\n+\n+  interface PerformanceEntry {\n+    detail?: any\n+  }\n+}\n+\n+window.reactServerRequests = []\n+\n+// We're trying to mock how the Chrome DevTools performance panel will display\n+// React performance data. React might decide to use console.timeStamp instead\n+// or any other method that will be picked up by the performance panel so this\n+// logic may have to be adjusted when updating React. A change here, doesn't\n+// mean it's a breaking change in React nor Next.js.\n+new PerformanceObserver((entries) => {\n+  for (const entry of entries.getEntries()) {\n+    if (entry.detail?.devtools?.track === 'Server Requests âš›') {\n+      window.reactServerRequests.push({\n+        name: entry.name,\n+        properties: entry.detail.devtools.properties,\n+      })\n+    }\n+  }\n+  console.log(window.reactServerRequests)\n+}).observe({ entryTypes: ['measure'] })"
        },
        {
            "sha": "19eec2e544c0e3a1c1190336c275b61f89321d7e",
            "filename": "test/development/app-dir/react-performance-track/next.config.js",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Fnext.config.js?ref=39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd",
            "patch": "@@ -0,0 +1,9 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  // Some flag to enable react@experimental\n+  experimental: { taint: true },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "b52a7508da3f8127da49e52c86d70f76705834bd",
            "filename": "test/development/app-dir/react-performance-track/react-performance-track.test.ts",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Freact-performance-track.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Freact-performance-track.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Freact-performance-track%2Freact-performance-track.test.ts?ref=39f5d0f32c0b8f4066e4e7cb23ce25c75d7e6dcd",
            "patch": "@@ -0,0 +1,25 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('react-performance-track', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should show setTimeout', async () => {\n+    const browser = await next.browser('/set-timeout')\n+\n+    const track = await browser.eval('window.reactServerRequests')\n+    expect(track).toEqual([\n+      { name: 'setTimeout', properties: [] },\n+      { name: 'setTimeout', properties: [] },\n+    ])\n+  })\n+\n+  it('should show fetch', async () => {\n+    const browser = await next.browser('/fetch')\n+\n+    const track = await browser.eval('window.reactServerRequests')\n+    // FIXME: Should show await fetch and await response.json()\n+    expect(track).toEqual([])\n+  })\n+})"
        }
    ],
    "stats": {
        "total": 110,
        "additions": 110,
        "deletions": 0
    }
}