{
    "author": "sokra",
    "message": "Turbopack: avoid tracking a modification when adding an already existing item (#78726)\n\n### What?\n\nThis makes sure that when trying to \"add\" and item that already exist, we don't flag the task as modified.\n\nThis commonly happens with `Dependent` edges. We just call \"add\" again, not knowing if they already exist.",
    "sha": "fff47d0fbd32a6a55aaae2a55f0fd51e16d60bd9",
    "files": [
        {
            "sha": "9fe9c758bed912a327cb9dfe46995cf705b4645d",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/fff47d0fbd32a6a55aaae2a55f0fd51e16d60bd9/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fff47d0fbd32a6a55aaae2a55f0fd51e16d60bd9/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs?ref=fff47d0fbd32a6a55aaae2a55f0fd51e16d60bd9",
            "patch": "@@ -1501,7 +1501,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n \n         // handle stateful\n         if stateful {\n-            task.insert(CachedDataItem::Stateful { value: () });\n+            let _ = task.add(CachedDataItem::Stateful { value: () });\n         }\n \n         // handle cell counters: update max index and remove cells that are no longer used\n@@ -1938,7 +1938,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n                     .entry(RawVc::TaskCell(collectible.task, collectible.cell))\n                     .or_insert(0) += count;\n             }\n-            task.insert(CachedDataItem::CollectiblesDependent {\n+            let _ = task.add(CachedDataItem::CollectiblesDependent {\n                 collectible_type,\n                 task: reader_id,\n                 value: (),"
        },
        {
            "sha": "7584731bcaaaaaa523aba7dea6bd0e8dfba27ab3",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/operation/mod.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 1,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/fff47d0fbd32a6a55aaae2a55f0fd51e16d60bd9/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/fff47d0fbd32a6a55aaae2a55f0fd51e16d60bd9/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Fmod.rs?ref=fff47d0fbd32a6a55aaae2a55f0fd51e16d60bd9",
            "patch": "@@ -14,7 +14,7 @@ use std::{\n };\n \n use serde::{Deserialize, Serialize};\n-use turbo_tasks::{SessionId, TaskId, TurboTasksBackendApi};\n+use turbo_tasks::{KeyValuePair, SessionId, TaskId, TurboTasksBackendApi};\n \n use crate::{\n     backend::{\n@@ -466,6 +466,9 @@ impl<B: BackingStorage> TaskGuard for TaskGuardImpl<'_, B> {\n         let category = item.category();\n         self.check_access(category);\n         if !self.task_id.is_transient() && item.is_persistent() {\n+            if self.task.contains_key(&item.key()) {\n+                return false;\n+            }\n             self.task.track_modification(category.into_specific());\n         }\n         self.task.add(item)"
        }
    ],
    "stats": {
        "total": 9,
        "additions": 6,
        "deletions": 3
    }
}