{
    "author": "mischnic",
    "message": "Turbopack: clean up some old TODOs (#82364)\n\nI looked through all TODOs if there are any remaining \"todo fix this for prod builds\"-style comments, but there weren't any. But some of them are outdated now",
    "sha": "a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
    "files": [
        {
            "sha": "79b39f35b6f98695908b6304e4aa95ded4e34956",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -66,7 +66,7 @@ use turbopack_core::{\n     },\n     output::{OutputAsset, OutputAssets},\n     raw_output::RawOutput,\n-    reference_type::{CssReferenceSubType, ReferenceType},\n+    reference_type::{CommonJsReferenceSubType, CssReferenceSubType, ReferenceType},\n     resolve::{origin::PlainResolveOrigin, parse::Request, pattern::Pattern},\n     source::Source,\n     virtual_output::VirtualOutputAsset,\n@@ -852,6 +852,7 @@ impl AppProject {\n             Request::parse(Pattern::Constant(rcstr!(\n                 \"next/dist/client/app-next-turbopack.js\"\n             ))),\n+            CommonJsReferenceSubType::Undefined,\n             None,\n             false,\n         )"
        },
        {
            "sha": "da7db70acd49c7d249cabff408eda619209a6399",
            "filename": "crates/next-core/src/next_client/runtime_entry.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fruntime_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fruntime_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fruntime_entry.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -5,6 +5,7 @@ use turbopack_core::{\n     chunk::{EvaluatableAsset, EvaluatableAssetExt, EvaluatableAssets},\n     context::AssetContext,\n     module::Module,\n+    reference_type::CommonJsReferenceSubType,\n     resolve::{origin::PlainResolveOrigin, parse::Request},\n     source::Source,\n };\n@@ -35,6 +36,7 @@ impl RuntimeEntry {\n         let modules = cjs_resolve(\n             Vc::upcast(PlainResolveOrigin::new(asset_context, path.clone())),\n             *request,\n+            CommonJsReferenceSubType::Undefined,\n             None,\n             false,\n         )"
        },
        {
            "sha": "d184c702bbb7042d3b3ec6994615dca04a281923",
            "filename": "turbopack/crates/turbopack-cli-utils/src/runtime_entry.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-cli-utils%2Fsrc%2Fruntime_entry.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-cli-utils%2Fsrc%2Fruntime_entry.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli-utils%2Fsrc%2Fruntime_entry.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -5,6 +5,7 @@ use turbopack_core::{\n     chunk::{EvaluatableAsset, EvaluatableAssetExt, EvaluatableAssets},\n     context::AssetContext,\n     module::Module,\n+    reference_type::CommonJsReferenceSubType,\n     resolve::{origin::PlainResolveOrigin, parse::Request},\n     source::Source,\n };\n@@ -35,6 +36,7 @@ impl RuntimeEntry {\n         let modules = cjs_resolve(\n             Vc::upcast(PlainResolveOrigin::new(asset_context, path.clone())),\n             **request,\n+            CommonJsReferenceSubType::Undefined,\n             None,\n             false,\n         )"
        },
        {
            "sha": "43116c5b7189c5ca3d4b4916317945cdeb9ed6bd",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -2074,7 +2074,7 @@ pub mod tests {\n     impl Asset for MockModule {\n         #[turbo_tasks::function]\n         fn content(&self) -> Vc<AssetContent> {\n-            todo!()\n+            panic!(\"MockModule::content shouldn't be called\")\n         }\n     }\n "
        },
        {
            "sha": "381ad568eeaa0e385d0454872ad04c58c7fe4f73",
            "filename": "turbopack/crates/turbopack-core/src/output.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 3,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Foutput.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Foutput.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Foutput.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -59,6 +59,3 @@ impl OutputAssets {\n /// A set of [OutputAsset]s\n #[turbo_tasks::value(transparent)]\n pub struct OutputAssetsSet(FxIndexSet<ResolvedVc<Box<dyn OutputAsset>>>);\n-\n-// TODO All Vc::try_resolve_downcast::<Box<dyn OutputAsset>> calls should be\n-// removed"
        },
        {
            "sha": "2954179b909009ffd96d1f21b0963ac168f97fd0",
            "filename": "turbopack/crates/turbopack-core/src/source.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -17,5 +17,3 @@ pub struct OptionSource(Option<ResolvedVc<Box<dyn Source>>>);\n \n #[turbo_tasks::value(transparent)]\n pub struct Sources(Vec<ResolvedVc<Box<dyn Source>>>);\n-\n-// TODO All Vc::try_resolve_downcast::<Box<dyn Source>> calls should be removed"
        },
        {
            "sha": "c2a54ef81c6ff95e275107c229ef1dedc5631484",
            "filename": "turbopack/crates/turbopack-css/src/references/compose.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fcompose.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fcompose.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Freferences%2Fcompose.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -38,9 +38,7 @@ impl ModuleReference for CssModuleComposeReference {\n             *self.origin,\n             *self.request,\n             CssReferenceSubType::Compose,\n-            // TODO: add real issue source, currently impossible because `CssClassName` doesn't\n-            // contain the source span\n-            // https://docs.rs/swc_css_modules/0.21.16/swc_css_modules/enum.CssClassName.html\n+            // TODO: add real issue source, currently impossible\n             None,\n         )\n     }"
        },
        {
            "sha": "b654a75eb48f498c7e9c16050216db4d868fbb73",
            "filename": "turbopack/crates/turbopack-ecmascript-plugins/src/transform/emotion.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 9,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript-plugins%2Fsrc%2Ftransform%2Femotion.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript-plugins%2Fsrc%2Ftransform%2Femotion.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-plugins%2Fsrc%2Ftransform%2Femotion.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -102,15 +102,12 @@ impl EmotionTransformer {\n             enabled: Some(true),\n             sourcemap: config.sourcemap,\n             label_format: config.label_format.as_deref().map(From::from),\n-            auto_label: if let Some(auto_label) = config.auto_label.as_ref() {\n-                match auto_label {\n-                    EmotionLabelKind::Always => Some(true),\n-                    EmotionLabelKind::Never => Some(false),\n-                    // [TODO]: this is not correct coerece, need to be fixed\n-                    EmotionLabelKind::DevOnly => None,\n-                }\n-            } else {\n-                None\n+            auto_label: match config.auto_label.as_ref() {\n+                Some(EmotionLabelKind::Always) => Some(true),\n+                Some(EmotionLabelKind::Never) => Some(false),\n+                // [TODO]: this is not correct (doesn't take current mode into account)\n+                Some(EmotionLabelKind::DevOnly) => None,\n+                None => None,\n             },\n             import_map: config.import_map.as_ref().map(|map| {\n                 map.iter()"
        },
        {
            "sha": "b6b77a79676d71ceaf7bd841ee37d6a0bdee5610",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/src/asset_context.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fasset_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fasset_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fasset_context.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -22,7 +22,8 @@ pub async fn get_runtime_asset_context(\n             ),\n             ..Default::default()\n         },\n-        // TODO: Somehow this fails to compile when enabled.\n+        // TODO: This fails when enabled, we cannot insert helpers for the runtime code as this\n+        // happens after bundling.\n         // environment: Some(environment),\n         environment: None,\n         tree_shaking_mode: Some(TreeShakingMode::ReexportsOnly),"
        },
        {
            "sha": "47948bd63b70699d826d829fd862840df5aab085",
            "filename": "turbopack/crates/turbopack-ecmascript-runtime/src/browser_runtime.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fbrowser_runtime.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fbrowser_runtime.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript-runtime%2Fsrc%2Fbrowser_runtime.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -73,7 +73,6 @@ pub async fn get_browser_runtime_code(\n             runtime_backend_code.push(\"browser/runtime/dom/dev-backend-dom.ts\");\n         }\n         (ChunkLoading::Dom, RuntimeType::Production) => {\n-            // TODO\n             runtime_backend_code.push(\"browser/runtime/dom/runtime-backend-dom.ts\");\n         }\n "
        },
        {
            "sha": "c9227b47c23b2b25eba9ee9cf788859c615830ad",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/graph.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -622,7 +622,6 @@ impl EvalContext {\n                 if let Expr::Member(MemberExpr { obj, prop, .. }) = unparen(callee) {\n                     let obj = Box::new(self.eval(obj));\n                     let prop = Box::new(match prop {\n-                        // TODO avoid clone\n                         MemberProp::Ident(i) => i.sym.clone().into(),\n                         MemberProp::PrivateName(_) => {\n                             return JsValue::unknown_empty("
        },
        {
            "sha": "adc0a3183c3ecb6b1d7247f7b2e8df404b06d9d2",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/amd.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Famd.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Famd.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Famd.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -19,6 +19,7 @@ use turbopack_core::{\n     chunk::{ChunkableModuleReference, ChunkingContext},\n     issue::IssueSource,\n     reference::ModuleReference,\n+    reference_type::CommonJsReferenceSubType,\n     resolve::{ModuleResolveResult, origin::ResolveOrigin, parse::Request},\n };\n use turbopack_resolve::ecmascript::cjs_resolve;\n@@ -67,6 +68,7 @@ impl ModuleReference for AmdDefineAssetReference {\n         cjs_resolve(\n             *self.origin,\n             *self.request,\n+            CommonJsReferenceSubType::Undefined,\n             Some(self.issue_source),\n             self.in_try,\n         )\n@@ -176,6 +178,7 @@ impl AmdDefineWithDependenciesCodeGen {\n                             cjs_resolve(\n                                 *self.origin,\n                                 **request,\n+                                CommonJsReferenceSubType::Undefined,\n                                 Some(self.issue_source),\n                                 self.in_try,\n                             ),"
        },
        {
            "sha": "736cbd6204e4b383aba8acc013a13377ebb892df",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/cjs.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fcjs.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -13,6 +13,7 @@ use turbopack_core::{\n     chunk::{ChunkableModuleReference, ChunkingContext},\n     issue::IssueSource,\n     reference::ModuleReference,\n+    reference_type::CommonJsReferenceSubType,\n     resolve::{ModuleResolveResult, origin::ResolveOrigin, parse::Request},\n };\n use turbopack_resolve::ecmascript::cjs_resolve;\n@@ -61,6 +62,7 @@ impl ModuleReference for CjsAssetReference {\n         cjs_resolve(\n             *self.origin,\n             *self.request,\n+            CommonJsReferenceSubType::Undefined,\n             Some(self.issue_source),\n             self.in_try,\n         )\n@@ -112,6 +114,7 @@ impl ModuleReference for CjsRequireAssetReference {\n         cjs_resolve(\n             *self.origin,\n             *self.request,\n+            CommonJsReferenceSubType::Undefined,\n             Some(self.issue_source),\n             self.in_try,\n         )\n@@ -236,6 +239,7 @@ impl ModuleReference for CjsRequireResolveAssetReference {\n         cjs_resolve(\n             *self.origin,\n             *self.request,\n+            CommonJsReferenceSubType::Undefined,\n             Some(self.issue_source),\n             self.in_try,\n         )"
        },
        {
            "sha": "ef7f5e6916b6b8a540a5fc9e95b77e4622fe3282",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/binding.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbinding.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbinding.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbinding.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -92,7 +92,6 @@ impl EsmBinding {\n                         visit_mut_prop,\n                         |prop: &mut Prop| {\n                             if let Prop::Shorthand(ident) = prop {\n-                                // TODO: Merge with the above condition when https://rust-lang.github.io/rfcs/2497-if-let-chains.html lands.\n                                 match &imported_ident {\n                                     ImportedIdent::Module(imported_ident) => {\n                                         *prop = Prop::KeyValue(KeyValueProp {"
        },
        {
            "sha": "c11d07af748537a9dbb24bd6a384ba46fbe5c105",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/mod.rs",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -3039,9 +3039,15 @@ async fn require_resolve_visitor(\n     Ok(if args.len() == 1 {\n         let pat = js_value_to_pattern(&args[0]);\n         let request = Request::parse(pat.clone());\n-        let resolved = cjs_resolve_source(origin, request, None, true)\n-            .resolve()\n-            .await?;\n+        let resolved = cjs_resolve_source(\n+            origin,\n+            request,\n+            CommonJsReferenceSubType::Undefined,\n+            None,\n+            true,\n+        )\n+        .resolve()\n+        .await?;\n         let mut values = resolved\n             .primary_sources()\n             .await?"
        },
        {
            "sha": "bdf49bd5b9dc3535fc573d077aec9fd58a4bb22a",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/require_context.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Frequire_context.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -31,6 +31,7 @@ use turbopack_core::{\n     module::Module,\n     module_graph::ModuleGraph,\n     reference::{ModuleReference, ModuleReferences},\n+    reference_type::CommonJsReferenceSubType,\n     resolve::{ModuleResolveResult, origin::ResolveOrigin, parse::Request},\n     source::Source,\n };\n@@ -196,9 +197,15 @@ impl RequireContextMap {\n             let request = Request::parse(origin_relative.clone().into())\n                 .to_resolved()\n                 .await?;\n-            let result = cjs_resolve(origin, *request, issue_source, is_optional)\n-                .to_resolved()\n-                .await?;\n+            let result = cjs_resolve(\n+                origin,\n+                *request,\n+                CommonJsReferenceSubType::Undefined,\n+                issue_source,\n+                is_optional,\n+            )\n+            .to_resolved()\n+            .await?;\n \n             map.insert(\n                 context_relative.clone(),"
        },
        {
            "sha": "4175e6d0cea950da5661445c89a6604567c6d67e",
            "filename": "turbopack/crates/turbopack-ecmascript/src/typescript/mod.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 2,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftypescript%2Fmod.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -205,7 +205,13 @@ impl CompilerReference {\n impl ModuleReference for CompilerReference {\n     #[turbo_tasks::function]\n     fn resolve_reference(&self) -> Vc<ModuleResolveResult> {\n-        cjs_resolve(*self.origin, *self.request, None, false)\n+        cjs_resolve(\n+            *self.origin,\n+            *self.request,\n+            CommonJsReferenceSubType::Undefined,\n+            None,\n+            false,\n+        )\n     }\n }\n \n@@ -281,7 +287,13 @@ impl TsNodeRequireReference {\n impl ModuleReference for TsNodeRequireReference {\n     #[turbo_tasks::function]\n     fn resolve_reference(&self) -> Vc<ModuleResolveResult> {\n-        cjs_resolve(*self.origin, *self.request, None, false)\n+        cjs_resolve(\n+            *self.origin,\n+            *self.request,\n+            CommonJsReferenceSubType::Undefined,\n+            None,\n+            false,\n+        )\n     }\n }\n "
        },
        {
            "sha": "558290ac78b411df1687078985e61420bdcd0404",
            "filename": "turbopack/crates/turbopack-nodejs/src/chunking_context.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 3,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -484,9 +484,7 @@ impl ChunkingContext for NodeJsChunkingContext {\n         _module_graph: Vc<ModuleGraph>,\n         _availability_info: AvailabilityInfo,\n     ) -> Result<Vc<ChunkGroupResult>> {\n-        // TODO(alexkirsz) This method should be part of a separate trait that is\n-        // only implemented for client/edge runtimes.\n-        bail!(\"the build chunking context does not support evaluated chunk groups\")\n+        bail!(\"the Node.js chunking context does not support evaluated chunk groups\")\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "4d11c186896c3de2ade77978b222ffea1cb995b8",
            "filename": "turbopack/crates/turbopack-resolve/src/ecmascript.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fecmascript.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fecmascript.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-resolve%2Fsrc%2Fecmascript.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -104,11 +104,11 @@ pub async fn esm_resolve(\n pub async fn cjs_resolve(\n     origin: Vc<Box<dyn ResolveOrigin>>,\n     request: Vc<Request>,\n+    ty: CommonJsReferenceSubType,\n     issue_source: Option<IssueSource>,\n     is_optional: bool,\n ) -> Result<Vc<ModuleResolveResult>> {\n-    // TODO pass CommonJsReferenceSubType\n-    let ty = ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined);\n+    let ty = ReferenceType::CommonJs(ty);\n     let options = apply_cjs_specific_options(origin.resolve_options(ty.clone()).await?)\n         .resolve()\n         .await?;\n@@ -119,11 +119,11 @@ pub async fn cjs_resolve(\n pub async fn cjs_resolve_source(\n     origin: ResolvedVc<Box<dyn ResolveOrigin>>,\n     request: ResolvedVc<Request>,\n+    ty: CommonJsReferenceSubType,\n     issue_source: Option<IssueSource>,\n     is_optional: bool,\n ) -> Result<Vc<ResolveResult>> {\n-    // TODO pass CommonJsReferenceSubType\n-    let ty = ReferenceType::CommonJs(CommonJsReferenceSubType::Undefined);\n+    let ty = ReferenceType::CommonJs(ty);\n     let options = apply_cjs_specific_options(origin.resolve_options(ty.clone()).await?)\n         .resolve()\n         .await?;"
        },
        {
            "sha": "2507613e2396773698b39e0d232e5b1e8e3b4ab5",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -560,14 +560,7 @@ async fn walk_asset(\n         diff(path.clone(), asset.content()).await?;\n     }\n \n-    queue.extend(\n-        asset\n-            .references()\n-            .await?\n-            .iter()\n-            .copied()\n-            .flat_map(ResolvedVc::try_downcast::<Box<dyn OutputAsset>>),\n-    );\n+    queue.extend(asset.references().await?.iter().copied());\n \n     Ok(())\n }"
        },
        {
            "sha": "678164f2e6202bb45cb40e55f229bbc157a48780",
            "filename": "turbopack/crates/turbopack/src/lib.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Flib.rs?ref=a388c0a095c72a1ade80ac68a0e3cbcc9b1fdae7",
            "patch": "@@ -12,7 +12,6 @@ pub mod global_module_ids;\n mod graph;\n pub mod module_options;\n pub mod transition;\n-pub(crate) mod unsupported_sass;\n \n use anyhow::{Result, bail};\n use css::{CssModuleAsset, ModuleCssAsset};"
        },
        {
            "sha": "7804c941aad43871fb853f2a2b77ccd733827bf4",
            "filename": "turbopack/crates/turbopack/src/unsupported_sass.rs",
            "status": "removed",
            "additions": 0,
            "deletions": 108,
            "changes": 108,
            "blob_url": "https://github.com/vercel/next.js/blob/5c38caab382517104ff80f94d93275073381cf8f/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Funsupported_sass.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5c38caab382517104ff80f94d93275073381cf8f/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Funsupported_sass.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Funsupported_sass.rs?ref=5c38caab382517104ff80f94d93275073381cf8f",
            "patch": "@@ -1,108 +0,0 @@\n-//! TODO(WEB-741) Remove this file once Sass is supported.\n-\n-use anyhow::Result;\n-use turbo_rcstr::rcstr;\n-use turbo_tasks::{ResolvedVc, Vc};\n-use turbo_tasks_fs::{FileSystemPath, glob::Glob};\n-use turbopack_core::{\n-    issue::{Issue, IssueExt, IssueSeverity, IssueStage, OptionStyledString, StyledString},\n-    reference_type::ReferenceType,\n-    resolve::{\n-        ResolveResultOption,\n-        parse::Request,\n-        plugin::{AfterResolvePlugin, AfterResolvePluginCondition},\n-    },\n-};\n-\n-/// Resolve plugins that warns when importing a sass file.\n-#[turbo_tasks::value]\n-pub(crate) struct UnsupportedSassResolvePlugin {\n-    root: FileSystemPath,\n-}\n-\n-#[turbo_tasks::value_impl]\n-impl UnsupportedSassResolvePlugin {\n-    #[turbo_tasks::function]\n-    pub fn new(root: FileSystemPath) -> Vc<Self> {\n-        UnsupportedSassResolvePlugin { root }.cell()\n-    }\n-}\n-\n-#[turbo_tasks::value_impl]\n-impl AfterResolvePlugin for UnsupportedSassResolvePlugin {\n-    #[turbo_tasks::function]\n-    async fn after_resolve_condition(&self) -> Result<Vc<AfterResolvePluginCondition>> {\n-        Ok(AfterResolvePluginCondition::new(\n-            self.root.root().owned().await?,\n-            Glob::new(rcstr!(\"**/*.{sass,scss}\")),\n-        ))\n-    }\n-\n-    #[turbo_tasks::function]\n-    async fn after_resolve(\n-        &self,\n-        fs_path: FileSystemPath,\n-        lookup_path: FileSystemPath,\n-        _reference_type: ReferenceType,\n-        request: ResolvedVc<Request>,\n-    ) -> Result<Vc<ResolveResultOption>> {\n-        let extension = fs_path.extension();\n-        if [\"sass\", \"scss\"].contains(&extension) {\n-            UnsupportedSassModuleIssue {\n-                file_path: lookup_path,\n-                request,\n-            }\n-            .resolved_cell()\n-            .emit();\n-        }\n-\n-        Ok(ResolveResultOption::none())\n-    }\n-}\n-\n-#[turbo_tasks::value(shared)]\n-struct UnsupportedSassModuleIssue {\n-    // TODO(PACK-4879): The `file_path` is incorrect for this issue and we should supply\n-    // detailed source information.\n-    file_path: FileSystemPath,\n-    request: ResolvedVc<Request>,\n-}\n-\n-#[turbo_tasks::value_impl]\n-impl Issue for UnsupportedSassModuleIssue {\n-    fn severity(&self) -> IssueSeverity {\n-        IssueSeverity::Warning\n-    }\n-\n-    #[turbo_tasks::function]\n-    async fn title(&self) -> Result<Vc<StyledString>> {\n-        Ok(StyledString::Text(\n-            format!(\n-                \"Unsupported Sass request: {}\",\n-                self.request.await?.request().unwrap_or(rcstr!(\"N/A\"))\n-            )\n-            .into(),\n-        )\n-        .cell())\n-    }\n-\n-    #[turbo_tasks::function]\n-    fn file_path(&self) -> Vc<FileSystemPath> {\n-        self.file_path.clone().cell()\n-    }\n-\n-    #[turbo_tasks::function]\n-    fn description(&self) -> Vc<OptionStyledString> {\n-        Vc::cell(Some(\n-            StyledString::Text(rcstr!(\n-                \"Turbopack does not yet support importing Sass modules.\"\n-            ))\n-            .resolved_cell(),\n-        ))\n-    }\n-\n-    #[turbo_tasks::function]\n-    fn stage(&self) -> Vc<IssueStage> {\n-        IssueStage::Unsupported.cell()\n-    }\n-}"
        }
    ],
    "stats": {
        "total": 217,
        "additions": 62,
        "deletions": 155
    }
}