{
    "author": "sokra",
    "message": "Turbopack: Deterministic builds (prerender-manifest, .next/package.json, ./next/postcss.js) (#84081)\n\n### What?\n\n* Make order of routes in prerender manifest deterministic\n* Write the same package.json content to distDir\n* fix output directory for postcss/webpack loaders entrypoint",
    "sha": "be33a9d8cde17773ed7c69d13e5df94223f86f39",
    "files": [
        {
            "sha": "13cd7600f03fe0134ad71bd1574c92447ca7b9cc",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/be33a9d8cde17773ed7c69d13e5df94223f86f39/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/be33a9d8cde17773ed7c69d13e5df94223f86f39/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=be33a9d8cde17773ed7c69d13e5df94223f86f39",
            "patch": "@@ -815,9 +815,9 @@ impl Project {\n         let node_execution_chunking_context = Vc::upcast(\n             NodeJsChunkingContext::builder(\n                 self.project_root_path().owned().await?,\n-                node_root.clone(),\n+                node_root.join(\"build\")?,\n                 self.node_root_to_root_path().owned().await?,\n-                node_root.clone(),\n+                node_root.join(\"build\")?,\n                 node_root.join(\"build/chunks\")?,\n                 node_root.join(\"build/assets\")?,\n                 node_build_environment().to_resolved().await?,"
        },
        {
            "sha": "da9137728e81494e10521a70f1a8a390d285cb85",
            "filename": "packages/next/src/build/index.ts",
            "status": "modified",
            "additions": 6,
            "deletions": 2,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/be33a9d8cde17773ed7c69d13e5df94223f86f39/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/be33a9d8cde17773ed7c69d13e5df94223f86f39/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Findex.ts?ref=be33a9d8cde17773ed7c69d13e5df94223f86f39",
            "patch": "@@ -2818,6 +2818,10 @@ export default async function build(\n             )\n           )\n \n+          const sortedStaticPaths = Array.from(staticPaths.entries()).sort(\n+            ([a], [b]) => a.localeCompare(b)\n+          )\n+\n           const exportApp = (require('../export') as typeof import('../export'))\n             .default as typeof import('../export').default\n \n@@ -2885,7 +2889,7 @@ export default async function build(\n \n               // TODO: output manifest specific to app paths and their\n               // revalidate periods and dynamicParams settings\n-              staticPaths.forEach((routes, originalAppPath) => {\n+              sortedStaticPaths.forEach(([originalAppPath, routes]) => {\n                 const appConfig = appDefaultConfigs.get(originalAppPath)\n                 const isDynamicError = appConfig?.dynamic === 'error'\n \n@@ -3054,7 +3058,7 @@ export default async function build(\n             await fs.unlink(serverBundle)\n           }\n \n-          staticPaths.forEach((prerenderedRoutes, originalAppPath) => {\n+          sortedStaticPaths.forEach(([originalAppPath, prerenderedRoutes]) => {\n             const page = appNormalizedPaths.get(originalAppPath)\n             if (!page) throw new InvariantError('Page not found')\n "
        },
        {
            "sha": "8d5e51706a3fd224ab36e5d86ded1f23c8a89838",
            "filename": "packages/next/src/build/turbopack-build/impl.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 7,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/be33a9d8cde17773ed7c69d13e5df94223f86f39/packages%2Fnext%2Fsrc%2Fbuild%2Fturbopack-build%2Fimpl.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/be33a9d8cde17773ed7c69d13e5df94223f86f39/packages%2Fnext%2Fsrc%2Fbuild%2Fturbopack-build%2Fimpl.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fturbopack-build%2Fimpl.ts?ref=be33a9d8cde17773ed7c69d13e5df94223f86f39",
            "patch": "@@ -104,13 +104,7 @@ export async function turbopackBuild(): Promise<{\n     })\n     await fs.writeFile(\n       path.join(distDir, 'package.json'),\n-      JSON.stringify(\n-        {\n-          type: 'commonjs',\n-        },\n-        null,\n-        2\n-      )\n+      '{\"type\": \"commonjs\"}'\n     )\n \n     // eslint-disable-next-line @typescript-eslint/no-unused-vars"
        }
    ],
    "stats": {
        "total": 20,
        "additions": 9,
        "deletions": 11
    }
}