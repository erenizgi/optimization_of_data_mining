{
    "author": "hayes",
    "message": "[Turbopack] Fix AST traversal for `this` in function default parameters (#83746)",
    "sha": "6a40da0345939fe4f7b1ae519b296a86dd103432",
    "files": [
        {
            "sha": "73f069426c84b7052d5dae2757d888b8c9b175b3",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/graph.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/6a40da0345939fe4f7b1ae519b296a86dd103432/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6a40da0345939fe4f7b1ae519b296a86dd103432/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs?ref=6a40da0345939fe4f7b1ae519b296a86dd103432",
            "patch": "@@ -2075,6 +2075,7 @@ impl VisitAstPath for Analyzer<'_> {\n                     | AstParentKind::ClassDecl(ClassDeclField::Class)\n                     | AstParentKind::ClassExpr(ClassExprField::Class)\n                     | AstParentKind::Function(FunctionField::Body)\n+                    | AstParentKind::Function(FunctionField::Params(_))\n             )\n         }) {\n             // We are in some scope that will rebind this"
        },
        {
            "sha": "582d628c77313b31b5eb10334e247b8269e77496",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/this-in-default-params/input/index.js",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/6a40da0345939fe4f7b1ae519b296a86dd103432/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fthis-in-default-params%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/6a40da0345939fe4f7b1ae519b296a86dd103432/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fthis-in-default-params%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fthis-in-default-params%2Finput%2Findex.js?ref=6a40da0345939fe4f7b1ae519b296a86dd103432",
            "patch": "@@ -0,0 +1,38 @@\n+it('should handle this in default parameters for function declaration', () => {\n+  function withDefault(value = this.prop) {\n+    return value\n+  }\n+\n+  const obj = { prop: 42 }\n+  expect(withDefault.call(obj)).toBe(42)\n+})\n+\n+it('should handle this in default parameters for function expression', () => {\n+  const funcExpr = function (value = this.prop) {\n+    return value\n+  }\n+\n+  const obj = { prop: 55 }\n+  expect(funcExpr.call(obj)).toBe(55)\n+})\n+\n+it('should handle this in default parameters for arrow function', () => {\n+  const obj = {\n+    prop: 77,\n+    test() {\n+      const arrow = (value = this.prop) => value\n+      return arrow()\n+    },\n+  }\n+  expect(obj.test()).toBe(77)\n+})\n+\n+it('should handle this in default parameters for object method', () => {\n+  const obj = {\n+    prop: 100,\n+    method(value = this.prop) {\n+      return value\n+    },\n+  }\n+  expect(obj.method()).toBe(100)\n+})"
        }
    ],
    "stats": {
        "total": 39,
        "additions": 39,
        "deletions": 0
    }
}