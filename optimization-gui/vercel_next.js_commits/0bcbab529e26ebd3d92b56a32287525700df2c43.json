{
    "author": "eps1lon",
    "message": "[dev-overlay] Move error handlers into dispatcher in /app (#79660)\n\nThe dispatcher will later be the bridge between user code and the dev overlay so it should house all logic that communicates with the Dev Overlay frontend.",
    "sha": "0bcbab529e26ebd3d92b56a32287525700df2c43",
    "files": [
        {
            "sha": "e70b148346708caf7e6a66a9fe9aa71bbde55548",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/hot-reloader-client.tsx",
            "status": "modified",
            "additions": 27,
            "deletions": 32,
            "changes": 59,
            "blob_url": "https://github.com/vercel/next.js/blob/0bcbab529e26ebd3d92b56a32287525700df2c43/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0bcbab529e26ebd3d92b56a32287525700df2c43/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fhot-reloader-client.tsx?ref=0bcbab529e26ebd3d92b56a32287525700df2c43",
            "patch": "@@ -1,7 +1,7 @@\n /// <reference types=\"webpack/module.d.ts\" />\n \n import type { ReactNode } from 'react'\n-import { useCallback, useEffect, startTransition, useMemo, useRef } from 'react'\n+import { useEffect, startTransition, useMemo, useRef } from 'react'\n import stripAnsi from 'next/dist/compiled/strip-ansi'\n import formatWebpackMessages from '../utils/format-webpack-messages'\n import { useRouter } from '../../navigation'\n@@ -57,6 +57,8 @@ export interface Dispatcher {\n   onRefresh(): void\n   onStaticIndicator(status: boolean): void\n   onDevIndicator(devIndicator: DevIndicatorServerState): void\n+  onUnhandledError(error: Error): void\n+  onUnhandledRejection(error: Error): void\n }\n \n let mostRecentCompilationHash: any = null\n@@ -511,40 +513,33 @@ export default function HotReload({\n           devIndicator,\n         })\n       },\n+      onUnhandledError(error) {\n+        // Component stack is added to the error in use-error-handler in case there was a hydration error\n+        const componentStack = getComponentStack(error)\n+        const ownerStack = getOwnerStack(error)\n+\n+        dispatch({\n+          type: ACTION_UNHANDLED_ERROR,\n+          reason: error,\n+          frames: parseStack((error.stack || '') + (ownerStack || '')),\n+          componentStackFrames:\n+            typeof componentStack === 'string'\n+              ? parseComponentStack(componentStack)\n+              : undefined,\n+        })\n+      },\n+      onUnhandledRejection(error) {\n+        const ownerStack = getOwnerStack(error)\n+        dispatch({\n+          type: ACTION_UNHANDLED_REJECTION,\n+          reason: error,\n+          frames: parseStack((error.stack || '') + (ownerStack || '')),\n+        })\n+      },\n     }\n   }, [dispatch])\n \n-  const handleOnUnhandledError = useCallback(\n-    (error: Error): void => {\n-      // Component stack is added to the error in use-error-handler in case there was a hydration error\n-      const componentStack = getComponentStack(error)\n-      const ownerStack = getOwnerStack(error)\n-\n-      dispatch({\n-        type: ACTION_UNHANDLED_ERROR,\n-        reason: error,\n-        frames: parseStack((error.stack || '') + (ownerStack || '')),\n-        componentStackFrames:\n-          typeof componentStack === 'string'\n-            ? parseComponentStack(componentStack)\n-            : undefined,\n-      })\n-    },\n-    [dispatch]\n-  )\n-\n-  const handleOnUnhandledRejection = useCallback(\n-    (error: Error): void => {\n-      const ownerStack = getOwnerStack(error)\n-      dispatch({\n-        type: ACTION_UNHANDLED_REJECTION,\n-        reason: error,\n-        frames: parseStack((error.stack || '') + (ownerStack || '')),\n-      })\n-    },\n-    [dispatch]\n-  )\n-  useErrorHandler(handleOnUnhandledError, handleOnUnhandledRejection)\n+  useErrorHandler(dispatcher.onUnhandledError, dispatcher.onUnhandledRejection)\n \n   const webSocketRef = useWebsocket(assetPrefix)\n   useWebsocketPing(webSocketRef)"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 27,
        "deletions": 32
    }
}