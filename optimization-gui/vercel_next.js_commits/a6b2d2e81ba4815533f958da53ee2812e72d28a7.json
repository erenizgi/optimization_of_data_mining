{
    "author": "unstubbable",
    "message": "[test] Add a failing test for cycle serialization in segment prefetches (#88287)",
    "sha": "a6b2d2e81ba4815533f958da53ee2812e72d28a7",
    "files": [
        {
            "sha": "6d1eb7c13a42481c2217d146a52656c5cf37f49e",
            "filename": "test/e2e/app-dir/segment-cache/basic/app/cycle/client.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/a6b2d2e81ba4815533f958da53ee2812e72d28a7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fapp%2Fcycle%2Fclient.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a6b2d2e81ba4815533f958da53ee2812e72d28a7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fapp%2Fcycle%2Fclient.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fapp%2Fcycle%2Fclient.tsx?ref=a6b2d2e81ba4815533f958da53ee2812e72d28a7",
            "patch": "@@ -0,0 +1,9 @@\n+'use client'\n+\n+export function ClientComponent({ testProp }: { testProp: { self: unknown } }) {\n+  return (\n+    <div id=\"cycle-check\">\n+      {testProp.self === testProp ? 'Cycle resolved' : 'Cycle broken'}\n+    </div>\n+  )\n+}"
        },
        {
            "sha": "d22c9847db89e10039e796fd477295cbbaa40037",
            "filename": "test/e2e/app-dir/segment-cache/basic/app/cycle/page.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/a6b2d2e81ba4815533f958da53ee2812e72d28a7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fapp%2Fcycle%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a6b2d2e81ba4815533f958da53ee2812e72d28a7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fapp%2Fcycle%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fapp%2Fcycle%2Fpage.tsx?ref=a6b2d2e81ba4815533f958da53ee2812e72d28a7",
            "patch": "@@ -0,0 +1,8 @@\n+import { ClientComponent } from './client'\n+\n+export default async function Page() {\n+  const cycle = { self: null as unknown }\n+  cycle.self = cycle\n+\n+  return <ClientComponent testProp={cycle} />\n+}"
        },
        {
            "sha": "e52e7b1dcb7fb47484c53828cc54dd261e3cea43",
            "filename": "test/e2e/app-dir/segment-cache/basic/app/page.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/a6b2d2e81ba4815533f958da53ee2812e72d28a7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a6b2d2e81ba4815533f958da53ee2812e72d28a7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fapp%2Fpage.tsx?ref=a6b2d2e81ba4815533f958da53ee2812e72d28a7",
            "patch": "@@ -1,5 +1,14 @@\n import { LinkAccordion } from '../components/link-accordion'\n \n export default function Page() {\n-  return <LinkAccordion href=\"/test\">Go to test page</LinkAccordion>\n+  return (\n+    <>\n+      <p>\n+        <LinkAccordion href=\"/test\">Go to test page</LinkAccordion>\n+      </p>\n+      <p>\n+        <LinkAccordion href=\"/cycle\">Go to cycle page</LinkAccordion>\n+      </p>\n+    </>\n+  )\n }"
        },
        {
            "sha": "f38ff1a755f7cf7889b60aee7c1ac5c5b8d96cae",
            "filename": "test/e2e/app-dir/segment-cache/basic/segment-cache-basic.test.ts",
            "status": "modified",
            "additions": 39,
            "deletions": 0,
            "changes": 39,
            "blob_url": "https://github.com/vercel/next.js/blob/a6b2d2e81ba4815533f958da53ee2812e72d28a7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a6b2d2e81ba4815533f958da53ee2812e72d28a7/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fsegment-cache%2Fbasic%2Fsegment-cache-basic.test.ts?ref=a6b2d2e81ba4815533f958da53ee2812e72d28a7",
            "patch": "@@ -412,4 +412,43 @@ describe('segment cache (basic tests)', () => {\n     const content = await page.textContent()\n     expect(content).toContain('Cache Life Seconds Page')\n   })\n+\n+  // TODO: Requires a fix in React.\n+  it.failing(\n+    'can handle circular references in client component props',\n+    async () => {\n+      let act: ReturnType<typeof createRouterAct>\n+      const browser = await next.browser('/', {\n+        beforePageLoad(page) {\n+          act = createRouterAct(page)\n+        },\n+      })\n+\n+      // Reveal the link to trigger a prefetch.\n+      const link = await act(\n+        async () => {\n+          await browser\n+            .elementByCss('input[data-link-accordion=\"/cycle\"]')\n+            .click()\n+          return browser.elementByCss('a[href=\"/cycle\"]')\n+        },\n+        { includes: 'testProp' }\n+      )\n+\n+      await act(\n+        async () => {\n+          await link.click()\n+\n+          // The page should render immediately because it was prefetched, and it\n+          // should show the resolved cycle text.\n+          expect(await browser.elementById('cycle-check').text()).toBe(\n+            'Cycle resolved'\n+          )\n+        },\n+        // No additional requests were required, because everything was\n+        // prefetched.\n+        'no-requests'\n+      )\n+    }\n+  )\n })"
        }
    ],
    "stats": {
        "total": 67,
        "additions": 66,
        "deletions": 1
    }
}