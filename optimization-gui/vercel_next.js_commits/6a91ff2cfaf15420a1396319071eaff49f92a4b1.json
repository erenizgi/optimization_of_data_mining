{
    "author": "leerob",
    "message": "docs: streaming responses with pages API routes (#79269)",
    "sha": "6a91ff2cfaf15420a1396319071eaff49f92a4b1",
    "files": [
        {
            "sha": "619655b3c23d70935832352f1cc95c6348d04178",
            "filename": "docs/02-pages/03-building-your-application/01-routing/07-api-routes.mdx",
            "status": "modified",
            "additions": 24,
            "deletions": 3,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/6a91ff2cfaf15420a1396319071eaff49f92a4b1/docs%2F02-pages%2F03-building-your-application%2F01-routing%2F07-api-routes.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/6a91ff2cfaf15420a1396319071eaff49f92a4b1/docs%2F02-pages%2F03-building-your-application%2F01-routing%2F07-api-routes.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F02-pages%2F03-building-your-application%2F01-routing%2F07-api-routes.mdx?ref=6a91ff2cfaf15420a1396319071eaff49f92a4b1",
            "patch": "@@ -416,8 +416,29 @@ The `query` objects are as follows:\n   - `pages/api/post/[pid].js` - Will match `/api/post/1`, `/api/post/abc`, etc. But not `/api/post/create`\n   - `pages/api/post/[...slug].js` - Will match `/api/post/1/2`, `/api/post/a/b/c`, etc. But not `/api/post/create`, `/api/post/abc`\n \n-## Edge API Routes\n+## Streaming responses\n \n-If you would like to use API Routes with the Edge Runtime, we recommend incrementally adopting the App Router and using [Route Handlers](/docs/app/building-your-application/routing/route-handlers) instead.\n+While the Pages Router does support streaming responses with API Routes, we recommend incrementally adopting the App Router and using [Route Handlers](/docs/app/building-your-application/routing/route-handlers) if you are on Next.js 14+.\n \n-The Route Handlers function signature is isomorphic, meaning you can use the same function for both Edge and Node.js runtimes.\n+Here's how you can stream a response from an API Route with `writeHead`:\n+\n+```js filename=\"pages/api/hello.js\"\n+import { NextApiRequest, NextApiResponse } from 'next'\n+\n+export default async function handler(\n+  req: NextApiRequest,\n+  res: NextApiResponse\n+) {\n+  res.writeHead(200, {\n+    'Content-Type': 'text/event-stream',\n+    'Cache-Control': \"no-store\",\n+  })\n+  let i = 0\n+  while (i < 10) {\n+    res.write(`data: ${i}\\n\\n`)\n+    i++\n+    await new Promise((resolve) => setTimeout(resolve, 1000))\n+  }\n+  res.end()\n+}\n+```"
        }
    ],
    "stats": {
        "total": 27,
        "additions": 24,
        "deletions": 3
    }
}