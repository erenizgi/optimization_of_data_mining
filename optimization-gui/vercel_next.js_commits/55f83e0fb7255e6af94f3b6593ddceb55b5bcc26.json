{
    "author": "eps1lon",
    "message": "[turbopack] Ensure React Compiler options are based dev vs prod (#84062)\n\nThis is restoring the forking of React Compiler options. We'll need this to enable naming of anonymous functions in dev.\r\n\r\nThe plumbing stretches more files than for Turbopack so I filed this separately.",
    "sha": "55f83e0fb7255e6af94f3b6593ddceb55b5bcc26",
    "files": [
        {
            "sha": "900f14826ec2fd51c31edde8b738d3891a6b5777",
            "filename": "packages/next/src/build/babel/loader/types.d.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/55f83e0fb7255e6af94f3b6593ddceb55b5bcc26/packages%2Fnext%2Fsrc%2Fbuild%2Fbabel%2Floader%2Ftypes.d.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/55f83e0fb7255e6af94f3b6593ddceb55b5bcc26/packages%2Fnext%2Fsrc%2Fbuild%2Fbabel%2Floader%2Ftypes.d.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fbabel%2Floader%2Ftypes.d.ts?ref=55f83e0fb7255e6af94f3b6593ddceb55b5bcc26",
            "patch": "@@ -1,4 +1,5 @@\n import type { webpack } from 'next/dist/compiled/webpack/webpack'\n+import type { JSONValue } from '../../../server/config-shared'\n import type { Span } from '../../../trace'\n \n export interface NextJsLoaderContext extends webpack.LoaderContext<{}> {\n@@ -17,7 +18,7 @@ export interface NextBabelLoaderBaseOptions {\n   /**\n    * Custom plugins to be added to the generated babel options.\n    */\n-  reactCompilerPlugins?: Array<any>\n+  reactCompilerPlugins?: Array<JSONValue>\n \n   /**\n    * Paths that the loader should not apply the react-compiler to."
        },
        {
            "sha": "b92978278cc789fd5ee4e96520a9805665c3f739",
            "filename": "packages/next/src/build/get-babel-loader-config.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 21,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/55f83e0fb7255e6af94f3b6593ddceb55b5bcc26/packages%2Fnext%2Fsrc%2Fbuild%2Fget-babel-loader-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/55f83e0fb7255e6af94f3b6593ddceb55b5bcc26/packages%2Fnext%2Fsrc%2Fbuild%2Fget-babel-loader-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fget-babel-loader-config.ts?ref=55f83e0fb7255e6af94f3b6593ddceb55b5bcc26",
            "patch": "@@ -1,5 +1,5 @@\n import path from 'path'\n-import type { ReactCompilerOptions } from '../server/config-shared'\n+import type { JSONValue, ReactCompilerOptions } from '../server/config-shared'\n import type { NextBabelLoaderOptions } from './babel/loader/types'\n \n function getReactCompiler() {\n@@ -15,27 +15,26 @@ function getReactCompiler() {\n }\n \n const getReactCompilerPlugins = (\n-  options: boolean | ReactCompilerOptions | undefined,\n-  isServer: boolean\n-) => {\n-  if (!options || isServer) {\n+  maybeOptions: boolean | ReactCompilerOptions | undefined,\n+  isServer: boolean,\n+  isDev: boolean\n+): undefined | JSONValue[] => {\n+  if (!maybeOptions || isServer) {\n     return undefined\n   }\n \n-  const compilerOptions = typeof options === 'boolean' ? {} : options\n-  if (options) {\n-    return [\n-      [\n-        getReactCompiler(),\n-        {\n-          // https://react.dev/reference/react-compiler/panicThreshold\n-          panicThreshold: 'none',\n-          ...compilerOptions,\n-        },\n-      ],\n-    ]\n+  const defaultOptions: ReactCompilerOptions = isDev\n+    ? {\n+        // TODO: enable `environment.enableNameAnonymousFunctions`Ã\n+      }\n+    : {}\n+  const options: ReactCompilerOptions =\n+    typeof maybeOptions === 'boolean' ? {} : maybeOptions\n+  const compilerOptions: JSONValue = {\n+    ...defaultOptions,\n+    ...options,\n   }\n-  return undefined\n+  return [[getReactCompiler(), compilerOptions]]\n }\n \n const getBabelLoader = (\n@@ -67,7 +66,8 @@ const getBabelLoader = (\n       hasJsxRuntime: true,\n       reactCompilerPlugins: getReactCompilerPlugins(\n         reactCompilerOptions,\n-        isServer\n+        isServer,\n+        dev\n       ),\n       reactCompilerExclude,\n     }\n@@ -90,11 +90,13 @@ const getReactCompilerLoader = (\n   reactCompilerOptions: boolean | ReactCompilerOptions | undefined,\n   cwd: string,\n   isServer: boolean,\n-  reactCompilerExclude: ((excludePath: string) => boolean) | undefined\n+  reactCompilerExclude: ((excludePath: string) => boolean) | undefined,\n+  isDev: boolean\n ) => {\n   const reactCompilerPlugins = getReactCompilerPlugins(\n     reactCompilerOptions,\n-    isServer\n+    isServer,\n+    isDev\n   )\n   if (!reactCompilerPlugins) {\n     return undefined"
        },
        {
            "sha": "a2eee76e4edf0cf36455ec850519a59647537878",
            "filename": "packages/next/src/build/webpack-config.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/55f83e0fb7255e6af94f3b6593ddceb55b5bcc26/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/55f83e0fb7255e6af94f3b6593ddceb55b5bcc26/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack-config.ts?ref=55f83e0fb7255e6af94f3b6593ddceb55b5bcc26",
            "patch": "@@ -492,7 +492,8 @@ export default async function getBaseWebpackConfig(\n         config.experimental?.reactCompiler,\n         dir,\n         isNodeOrEdgeCompilation,\n-        codeCondition.exclude\n+        codeCondition.exclude,\n+        dev\n       )\n \n   let swcTraceProfilingInitialized = false"
        },
        {
            "sha": "e48fbf2daa6a82ad2e3c88dc7d63fb3d665a600b",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/55f83e0fb7255e6af94f3b6593ddceb55b5bcc26/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/55f83e0fb7255e6af94f3b6593ddceb55b5bcc26/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=55f83e0fb7255e6af94f3b6593ddceb55b5bcc26",
            "patch": "@@ -88,7 +88,7 @@ export interface StyledComponentsConfig {\n   cssProp?: boolean\n }\n \n-type JSONValue =\n+export type JSONValue =\n   | string\n   | number\n   | boolean"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 28,
        "deletions": 24
    }
}