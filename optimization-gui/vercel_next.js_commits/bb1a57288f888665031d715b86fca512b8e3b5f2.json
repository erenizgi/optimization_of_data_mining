{
    "author": "mischnic",
    "message": "Turbopack: inner graph tree shaking (#85973)\n\nAlias \"unused import removal\"\n\nCloses PACK-5782\n\nPerformance:\n\n```\n* 58fe2e2e377d877f51f91f50770310d2bbf20987 - WIP: enable by default\n\npnpm next build --experimental-build-mode=compile > ~/Downloads/log.txt 2>&1  380.01s user 53.74s system 691% cpu 1:02.76 total\npnpm next build --experimental-build-mode=compile > ~/Downloads/log.txt 2>&1  384.99s user 51.00s system 708% cpu 1:01.57 total\npnpm next build --experimental-build-mode=compile > ~/Downloads/log.txt 2>&1  381.52s user 46.86s system 711% cpu 1:00.21 total\n\nvs canary:\n* f6c2d4913233109ea49256e587db9b7ce636a1a5 - Turbopack: add task_id_details feature (#84970)\n\npnpm next build --experimental-build-mode=compile > ~/Downloads/log.txt 2>&1  374.87s user 48.47s system 760% cpu 55.662 total\npnpm next build --experimental-build-mode=compile > ~/Downloads/log.txt 2>&1  379.18s user 50.27s system 700% cpu 1:01.28 total\npnpm next build --experimental-build-mode=compile > ~/Downloads/log.txt 2>&1  370.39s user 45.93s system 726% cpu 57.305 total\npnpm next build --experimental-build-mode=compile > ~/Downloads/log.txt 2>&1  372.70s user 46.24s system 717% cpu 58.364 total\n```",
    "sha": "bb1a57288f888665031d715b86fca512b8e3b5f2",
    "files": [
        {
            "sha": "37082a41b7472629dfd8a64dedf6cf1befa7d7f5",
            "filename": "crates/next-api/src/analyze.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 9,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fanalyze.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fanalyze.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fanalyze.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -430,15 +430,17 @@ pub async fn analyze_module_graphs(module_graphs: Vc<ModuleGraphs>) -> Result<Vc\n     let mut all_async_edges = FxIndexSet::default();\n     for &module_graph in module_graphs.await? {\n         let module_graph = module_graph.read_graphs().await?;\n-        module_graph.traverse_all_edges_unordered(|(parent_node, reference), node| {\n-            all_modules.insert(parent_node);\n-            all_modules.insert(node);\n-            match reference.chunking_type {\n-                ChunkingType::Async => {\n-                    all_async_edges.insert((parent_node, node));\n-                }\n-                _ => {\n-                    all_edges.insert((parent_node, node));\n+        module_graph.traverse_all_edges_unordered(|parent, node| {\n+            if let Some((parent_node, reference)) = parent {\n+                all_modules.insert(parent_node);\n+                all_modules.insert(node);\n+                match reference.chunking_type {\n+                    ChunkingType::Async => {\n+                        all_async_edges.insert((parent_node, node));\n+                    }\n+                    _ => {\n+                        all_edges.insert((parent_node, node));\n+                    }\n                 }\n             }\n             Ok(())"
        },
        {
            "sha": "241bbf946347602fe90a60ba5f62119ce4a23f33",
            "filename": "crates/next-api/src/app.rs",
            "status": "modified",
            "additions": 26,
            "deletions": 3,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fapp.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fapp.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -59,6 +59,7 @@ use turbopack_core::{\n     module::Module,\n     module_graph::{\n         GraphEntries, ModuleGraph, SingleModuleGraph, VisitedModules,\n+        binding_usage_info::compute_binding_usage_info,\n         chunk_group_info::{ChunkGroup, ChunkGroupEntry},\n     },\n     output::{OutputAsset, OutputAssets, OutputAssetsWithReferenced},\n@@ -856,7 +857,8 @@ impl AppProject {\n         has_layout_segments: bool,\n     ) -> Result<Vc<BaseAndFullModuleGraph>> {\n         if *self.project.per_page_module_graph().await? {\n-            let should_trace = self.project.next_mode().await?.is_production();\n+            let next_mode = self.project.next_mode();\n+            let should_trace = next_mode.await?.is_production();\n             let client_shared_entries = client_shared_entries\n                 .await?\n                 .into_iter()\n@@ -949,10 +951,31 @@ impl AppProject {\n                 );\n                 graphs.push(additional_module_graph);\n \n-                let full = ModuleGraph::from_graphs(graphs);\n+                let full_with_unused_references =\n+                    ModuleGraph::from_graphs(graphs).to_resolved().await?;\n+\n+                let full = if *self\n+                    .project\n+                    .next_config()\n+                    .turbopack_remove_unused_imports(next_mode)\n+                    .await?\n+                {\n+                    full_with_unused_references\n+                        .without_unused_references(\n+                            *compute_binding_usage_info(full_with_unused_references, true)\n+                                .resolve_strongly_consistent()\n+                                .await?,\n+                        )\n+                        .to_resolved()\n+                        .await?\n+                } else {\n+                    full_with_unused_references\n+                };\n+\n                 Ok(BaseAndFullModuleGraph {\n                     base: base.to_resolved().await?,\n-                    full: full.to_resolved().await?,\n+                    full_with_unused_references,\n+                    full,\n                 }\n                 .cell())\n             }"
        },
        {
            "sha": "ec8dd755e77ef6161a27f8a517923b69a1002d03",
            "filename": "crates/next-api/src/module_graph.rs",
            "status": "modified",
            "additions": 47,
            "deletions": 43,
            "changes": 90,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fmodule_graph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fmodule_graph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fmodule_graph.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -24,7 +24,7 @@ use turbopack_core::{\n     context::AssetContext,\n     issue::{Issue, IssueExt, IssueSeverity, IssueStage, OptionStyledString, StyledString},\n     module::Module,\n-    module_graph::{GraphTraversalAction, ModuleGraph, SingleModuleGraph},\n+    module_graph::{GraphTraversalAction, ModuleGraph, SingleModuleGraphWithBindingUsage},\n };\n \n use crate::{\n@@ -35,8 +35,9 @@ use crate::{\n \n #[turbo_tasks::value]\n pub struct NextDynamicGraph {\n+    graph: SingleModuleGraphWithBindingUsage,\n     is_single_page: bool,\n-    graph: ResolvedVc<SingleModuleGraph>,\n+\n     /// list of NextDynamicEntryModules\n     data: ResolvedVc<DynamicImportEntries>,\n }\n@@ -51,12 +52,12 @@ impl NextDynamicGraphs {\n         graphs: ResolvedVc<ModuleGraph>,\n         is_single_page: bool,\n     ) -> Result<Vc<Self>> {\n-        let graphs_ref = &graphs.await?.graphs;\n+        let graphs_ref = &graphs.await?;\n         let next_dynamic = async {\n             graphs_ref\n-                .iter()\n+                .iter_graphs()\n                 .map(|graph| {\n-                    NextDynamicGraph::new_with_entries(**graph, is_single_page).to_resolved()\n+                    NextDynamicGraph::new_with_entries(graph, is_single_page).to_resolved()\n                 })\n                 .try_join()\n                 .await\n@@ -129,10 +130,10 @@ pub struct DynamicImportEntriesWithImporter(\n impl NextDynamicGraph {\n     #[turbo_tasks::function]\n     pub async fn new_with_entries(\n-        graph: ResolvedVc<SingleModuleGraph>,\n+        graph: SingleModuleGraphWithBindingUsage,\n         is_single_page: bool,\n     ) -> Result<Vc<Self>> {\n-        let mapped = map_next_dynamic(*graph);\n+        let mapped = map_next_dynamic(*graph.graph);\n \n         Ok(NextDynamicGraph {\n             is_single_page,\n@@ -150,7 +151,7 @@ impl NextDynamicGraph {\n         let span = tracing::info_span!(\"collect next/dynamic imports for endpoint\");\n         async move {\n             let data = &*self.data.await?;\n-            let graph = self.graph.await?;\n+            let graph = self.graph.read().await?;\n \n             #[derive(Clone, PartialEq, Eq)]\n             enum VisitState {\n@@ -159,20 +160,20 @@ impl NextDynamicGraph {\n             }\n \n             let entries = if !self.is_single_page {\n-                if !graph.has_entry_module(entry) {\n+                if !graph.graphs.first().unwrap().has_entry_module(entry) {\n                     // the graph doesn't contain the entry, e.g. for the additional module graph\n                     return Ok(Vc::cell(vec![]));\n                 }\n                 Either::Left(std::iter::once(entry))\n             } else {\n-                Either::Right(graph.entry_modules())\n+                Either::Right(graph.graphs.first().unwrap().entry_modules())\n             };\n \n             let mut result = vec![];\n \n             // module -> the client reference entry (if any)\n             let mut state_map = FxHashMap::default();\n-            graph.read().traverse_edges_from_entries_dfs(\n+            graph.traverse_edges_from_entries_dfs(\n                 entries,\n                 &mut (),\n                 |parent_info, node, _| {\n@@ -231,8 +232,9 @@ impl NextDynamicGraph {\n \n #[turbo_tasks::value]\n pub struct ServerActionsGraph {\n+    graph: SingleModuleGraphWithBindingUsage,\n     is_single_page: bool,\n-    graph: ResolvedVc<SingleModuleGraph>,\n+\n     /// (Layer, RSC or Browser module) -> list of actions\n     data: ResolvedVc<AllModuleActions>,\n }\n@@ -247,12 +249,12 @@ impl ServerActionsGraphs {\n         graphs: ResolvedVc<ModuleGraph>,\n         is_single_page: bool,\n     ) -> Result<Vc<Self>> {\n-        let graphs_ref = &graphs.await?.graphs;\n+        let graphs_ref = &graphs.await?;\n         let server_actions = async {\n             graphs_ref\n-                .iter()\n+                .iter_graphs()\n                 .map(|graph| {\n-                    ServerActionsGraph::new_with_entries(**graph, is_single_page).to_resolved()\n+                    ServerActionsGraph::new_with_entries(graph, is_single_page).to_resolved()\n                 })\n                 .try_join()\n                 .await\n@@ -314,10 +316,10 @@ impl ServerActionsGraphs {\n impl ServerActionsGraph {\n     #[turbo_tasks::function]\n     pub async fn new_with_entries(\n-        graph: ResolvedVc<SingleModuleGraph>,\n+        graph: SingleModuleGraphWithBindingUsage,\n         is_single_page: bool,\n     ) -> Result<Vc<Self>> {\n-        let mapped = map_server_actions(*graph);\n+        let mapped = map_server_actions(*graph.graph);\n \n         Ok(ServerActionsGraph {\n             is_single_page,\n@@ -341,15 +343,15 @@ impl ServerActionsGraph {\n                 Cow::Borrowed(data)\n             } else {\n                 // The graph contains the whole app, traverse and collect all reachable imports.\n-                let graph = self.graph.await?;\n+                let graph = self.graph.read().await?;\n \n-                if !graph.has_entry_module(entry) {\n+                if !graph.graphs.first().unwrap().has_entry_module(entry) {\n                     // the graph doesn't contain the entry, e.g. for the additional module graph\n                     return Ok(Vc::cell(Default::default()));\n                 }\n \n                 let mut result = FxIndexMap::default();\n-                graph.read().traverse_nodes_from_entries_dfs(\n+                graph.traverse_nodes_from_entries_dfs(\n                     vec![entry],\n                     &mut result,\n                     |node, result| {\n@@ -405,7 +407,8 @@ impl ServerActionsGraph {\n #[turbo_tasks::value]\n pub struct ClientReferencesGraph {\n     is_single_page: bool,\n-    graph: ResolvedVc<SingleModuleGraph>,\n+    graph: SingleModuleGraphWithBindingUsage,\n+\n     /// List of client references (modules that entries into the client graph)\n     data: ResolvedVc<ClientReferenceData>,\n }\n@@ -420,12 +423,12 @@ impl ClientReferencesGraphs {\n         graphs: ResolvedVc<ModuleGraph>,\n         is_single_page: bool,\n     ) -> Result<Vc<Self>> {\n-        let graphs_ref = &graphs.await?.graphs;\n+        let graphs_ref = &graphs.await?;\n         let client_references = async {\n             graphs_ref\n-                .iter()\n+                .iter_graphs()\n                 .map(|graph| {\n-                    ClientReferencesGraph::new_with_entries(**graph, is_single_page).to_resolved()\n+                    ClientReferencesGraph::new_with_entries(graph, is_single_page).to_resolved()\n                 })\n                 .try_join()\n                 .await\n@@ -512,10 +515,10 @@ impl ClientReferencesGraphs {\n impl ClientReferencesGraph {\n     #[turbo_tasks::function]\n     pub async fn new_with_entries(\n-        graph: ResolvedVc<SingleModuleGraph>,\n+        graph: SingleModuleGraphWithBindingUsage,\n         is_single_page: bool,\n     ) -> Result<Vc<Self>> {\n-        let mapped = map_client_references(*graph);\n+        let mapped = map_client_references(*graph.graph);\n \n         Ok(Self {\n             is_single_page,\n@@ -533,16 +536,16 @@ impl ClientReferencesGraph {\n         let span = tracing::info_span!(\"collect client references for endpoint\");\n         async move {\n             let data = &*self.data.await?;\n-            let graph = self.graph.await?;\n+            let graph = self.graph.read().await?;\n \n             let entries = if !self.is_single_page {\n-                if !graph.has_entry_module(entry) {\n+                if !graph.graphs.first().unwrap().has_entry_module(entry) {\n                     // the graph doesn't contain the entry, e.g. for the additional module graph\n                     return Ok(ClientReferenceGraphResult::default().cell());\n                 }\n                 Either::Left(std::iter::once(entry))\n             } else {\n-                Either::Right(graph.entry_modules())\n+                Either::Right(graph.graphs.first().unwrap().entry_modules())\n             };\n \n             // Because we care about 'evaluation order' we need to collect client references in the\n@@ -552,7 +555,6 @@ impl ClientReferencesGraph {\n \n             let mut server_components = FxIndexSet::default();\n \n-            let graph = graph.read();\n             // Perform a DFS traversal to find all server components included by this page.\n             graph.traverse_nodes_from_entries_dfs(\n                 entries,\n@@ -761,27 +763,27 @@ struct ModuleNameMap(pub FxModuleNameMap);\n #[tracing::instrument(level = \"info\", name = \"validate pages css imports\", skip_all)]\n #[turbo_tasks::function]\n async fn validate_pages_css_imports_individual(\n-    graph: Vc<SingleModuleGraph>,\n+    graph: SingleModuleGraphWithBindingUsage,\n     is_single_page: bool,\n     entry: Vc<Box<dyn Module>>,\n     app_module: ResolvedVc<Box<dyn Module>>,\n ) -> Result<()> {\n-    let graph = graph.await?;\n+    let graph = graph.read().await?;\n     let entry = entry.to_resolved().await?;\n \n     let entries = if !is_single_page {\n-        if !graph.has_entry_module(entry) {\n+        if !graph.graphs.first().unwrap().has_entry_module(entry) {\n             // the graph doesn't contain the entry, e.g. for the additional module graph\n             return Ok(());\n         }\n         Either::Left(std::iter::once(entry))\n     } else {\n-        Either::Right(graph.entry_modules())\n+        Either::Right(graph.graphs.first().unwrap().entry_modules())\n     };\n \n     let mut candidates = vec![];\n \n-    graph.read().traverse_edges_from_entries_dfs(\n+    graph.traverse_edges_from_entries_dfs(\n         entries,\n         &mut (),\n         |parent_info, node, _| {\n@@ -799,7 +801,8 @@ async fn validate_pages_css_imports_individual(\n                 return Ok(GraphTraversalAction::Continue);\n             }\n \n-            // If the module being imported isn't a global css module, there is nothing to validate.\n+            // If the module being imported isn't a global css module, there is nothing to\n+            // validate.\n             let module_is_global_css =\n                 ResolvedVc::try_downcast_type::<CssModuleAsset>(module).is_some();\n \n@@ -811,14 +814,15 @@ async fn validate_pages_css_imports_individual(\n                 ResolvedVc::try_downcast_type::<ModuleCssAsset>(parent_module).is_some()\n                     || ResolvedVc::try_downcast_type::<CssModuleAsset>(parent_module).is_some();\n \n-            // We also always allow .module css/scss/sass files to import global css files as well.\n+            // We also always allow .module css/scss/sass files to import global css files as\n+            // well.\n             if parent_is_css_module {\n                 return Ok(GraphTraversalAction::Continue);\n             }\n \n-            // If all of the above invariants have been checked, we look to see if the parent module\n-            // is the same as the app module. If it isn't we know it isn't a valid place\n-            // to import global css.\n+            // If all of the above invariants have been checked, we look to see if the parent\n+            // module is the same as the app module. If it isn't we know it\n+            // isn't a valid place to import global css.\n             if parent_module != app_module {\n                 candidates.push(CssGlobalImportIssue::new(parent_module, module))\n             }\n@@ -862,11 +866,11 @@ pub async fn validate_pages_css_imports(\n     entry: Vc<Box<dyn Module>>,\n     app_module: Vc<Box<dyn Module>>,\n ) -> Result<()> {\n-    let graphs = &graph.await?.graphs;\n+    let graphs = &graph.await?;\n     graphs\n-        .iter()\n+        .iter_graphs()\n         .map(|graph| {\n-            validate_pages_css_imports_individual(**graph, is_single_page, entry, app_module)\n+            validate_pages_css_imports_individual(graph, is_single_page, entry, app_module)\n                 .as_side_effect()\n         })\n         .try_join()"
        },
        {
            "sha": "31dfe35da073e94d8027b537418c04d8c50dc704",
            "filename": "crates/next-api/src/pages.rs",
            "status": "modified",
            "additions": 18,
            "deletions": 2,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fpages.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fpages.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -54,6 +54,7 @@ use turbopack_core::{\n     module::Module,\n     module_graph::{\n         GraphEntries, ModuleGraph, SingleModuleGraph, VisitedModules,\n+        binding_usage_info::compute_binding_usage_info,\n         chunk_group_info::{ChunkGroup, ChunkGroupEntry},\n     },\n     output::{OptionOutputAsset, OutputAsset, OutputAssets},\n@@ -726,7 +727,8 @@ impl PageEndpoint {\n         let project = this.pages_project.project();\n \n         if *project.per_page_module_graph().await? {\n-            let should_trace = project.next_mode().await?.is_production();\n+            let next_mode = project.next_mode();\n+            let should_trace = next_mode.await?.is_production();\n             let ssr_chunk_module = self.internal_ssr_chunk_module().await?;\n             // Implements layout segment optimization to compute a graph \"chain\" for document, app,\n             // page\n@@ -755,7 +757,21 @@ impl PageEndpoint {\n             );\n             graphs.push(graph);\n \n-            Ok(ModuleGraph::from_graphs(graphs))\n+            let mut graph = ModuleGraph::from_graphs(graphs);\n+\n+            if *project\n+                .next_config()\n+                .turbopack_remove_unused_imports(next_mode)\n+                .await?\n+            {\n+                graph = graph.without_unused_references(\n+                    *compute_binding_usage_info(graph.to_resolved().await?, true)\n+                        .resolve_strongly_consistent()\n+                        .await?,\n+                );\n+            }\n+\n+            Ok(graph)\n         } else {\n             Ok(*project.whole_app_module_graphs().await?.full)\n         }"
        },
        {
            "sha": "f534698e99dc327d3cf2ca0938dbb32b4a534afe",
            "filename": "crates/next-api/src/project.rs",
            "status": "modified",
            "additions": 87,
            "deletions": 10,
            "changes": 97,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fproject.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fproject.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -59,8 +59,10 @@ use turbopack_core::{\n     module::Module,\n     module_graph::{\n         GraphEntries, ModuleGraph, SingleModuleGraph, VisitedModules,\n+        binding_usage_info::{\n+            BindingUsageInfo, OptionBindingUsageInfo, compute_binding_usage_info,\n+        },\n         chunk_group_info::ChunkGroupEntry,\n-        export_usage::{OptionExportUsageInfo, compute_export_usage_info},\n     },\n     output::{\n         ExpandOutputAssetsInput, ExpandedOutputAssets, OutputAsset, OutputAssets,\n@@ -1165,6 +1167,7 @@ impl Project {\n             environment: self.client_compile_time_info().environment(),\n             module_id_strategy: self.module_ids(),\n             export_usage: self.export_usage(),\n+            unused_references: self.unused_references(),\n             minify: self.next_config().turbo_minify(self.next_mode()),\n             source_maps: self.next_config().client_source_maps(self.next_mode()),\n             no_mangling: self.no_mangling(),\n@@ -1190,6 +1193,7 @@ impl Project {\n             environment: self.server_compile_time_info().environment(),\n             module_id_strategy: self.module_ids(),\n             export_usage: self.export_usage(),\n+            unused_references: self.unused_references(),\n             minify: self.next_config().turbo_minify(self.next_mode()),\n             source_maps: self.next_config().server_source_maps(),\n             no_mangling: self.no_mangling(),\n@@ -1221,6 +1225,7 @@ impl Project {\n             environment: self.edge_compile_time_info().environment(),\n             module_id_strategy: self.module_ids(),\n             export_usage: self.export_usage(),\n+            unused_references: self.unused_references(),\n             turbo_minify: self.next_config().turbo_minify(self.next_mode()),\n             turbo_source_maps: self.next_config().server_source_maps(),\n             no_mangling: self.no_mangling(),\n@@ -1925,20 +1930,50 @@ impl Project {\n         }\n     }\n \n+    /// Compute the used exports and unused imports for each module.\n+    #[turbo_tasks::function]\n+    async fn binding_usage_info(self: Vc<Self>) -> Result<Vc<BindingUsageInfo>> {\n+        let remove_unused_imports = *self\n+            .next_config()\n+            .turbopack_remove_unused_imports(self.next_mode())\n+            .await?;\n+\n+        let module_graphs = self.whole_app_module_graphs().await?;\n+        Ok(*compute_binding_usage_info(\n+            module_graphs.full_with_unused_references,\n+            remove_unused_imports,\n+        )\n+        // As a performance optimization, we resolve strongly consistently\n+        .resolve_strongly_consistent()\n+        .await?)\n+    }\n+\n     /// Compute the used exports for each module.\n     #[turbo_tasks::function]\n-    pub async fn export_usage(self: Vc<Self>) -> Result<Vc<OptionExportUsageInfo>> {\n+    pub async fn export_usage(self: Vc<Self>) -> Result<Vc<OptionBindingUsageInfo>> {\n         if *self\n             .next_config()\n             .turbopack_remove_unused_exports(self.next_mode())\n             .await?\n         {\n-            let module_graphs = self.whole_app_module_graphs().await?;\n             Ok(Vc::cell(Some(\n-                compute_export_usage_info(module_graphs.full)\n-                    // As a performance optimization, we resolve strongly consistently\n-                    .resolve_strongly_consistent()\n-                    .await?,\n+                self.binding_usage_info().to_resolved().await?,\n+            )))\n+        } else {\n+            Ok(Vc::cell(None))\n+        }\n+    }\n+\n+    /// Compute the unused references that were removed (inner graph tree shaking).\n+    #[turbo_tasks::function]\n+    pub async fn unused_references(self: Vc<Self>) -> Result<Vc<OptionBindingUsageInfo>> {\n+        if *self\n+            .next_config()\n+            .turbopack_remove_unused_imports(self.next_mode())\n+            .await?\n+        {\n+            Ok(Vc::cell(Some(\n+                self.binding_usage_info().to_resolved().await?,\n             )))\n         } else {\n             Ok(Vc::cell(None))\n@@ -1963,12 +1998,31 @@ async fn whole_app_module_graph_operation(\n ) -> Result<Vc<BaseAndFullModuleGraph>> {\n     mark_root();\n \n-    let should_trace = project.next_mode().await?.is_production();\n+    let next_mode = project.next_mode();\n+    let should_trace = next_mode.await?.is_production();\n     let base_single_module_graph =\n         SingleModuleGraph::new_with_entries(project.get_all_entries(), should_trace);\n     let base_visited_modules = VisitedModules::from_graph(base_single_module_graph);\n \n     let base = ModuleGraph::from_single_graph(base_single_module_graph);\n+\n+    let turbopack_remove_unused_imports = *project\n+        .next_config()\n+        .turbopack_remove_unused_imports(next_mode)\n+        .await?;\n+\n+    let base = if turbopack_remove_unused_imports {\n+        // TODO suboptimal that we do compute_binding_usage_info twice (once for the base graph\n+        // and later for the full graph)\n+        base.without_unused_references(\n+            *compute_binding_usage_info(base.to_resolved().await?, true)\n+                .resolve_strongly_consistent()\n+                .await?,\n+        )\n+    } else {\n+        base\n+    };\n+\n     let additional_entries = project.get_all_additional_entries(base);\n \n     let additional_module_graph = SingleModuleGraph::new_with_entries_visited(\n@@ -1977,17 +2031,40 @@ async fn whole_app_module_graph_operation(\n         should_trace,\n     );\n \n-    let full = ModuleGraph::from_graphs(vec![base_single_module_graph, additional_module_graph]);\n+    let full_with_unused_references =\n+        ModuleGraph::from_graphs(vec![base_single_module_graph, additional_module_graph])\n+            .to_resolved()\n+            .await?;\n+\n+    let full = if turbopack_remove_unused_imports {\n+        full_with_unused_references\n+            .without_unused_references(\n+                *compute_binding_usage_info(full_with_unused_references, true)\n+                    .resolve_strongly_consistent()\n+                    .await?,\n+            )\n+            .to_resolved()\n+            .await?\n+    } else {\n+        full_with_unused_references\n+    };\n+\n     Ok(BaseAndFullModuleGraph {\n         base: base.to_resolved().await?,\n-        full: full.to_resolved().await?,\n+        full_with_unused_references,\n+        full,\n     }\n     .cell())\n }\n \n #[turbo_tasks::value(shared)]\n pub struct BaseAndFullModuleGraph {\n+    /// The base module graph generated from the entry points.\n     pub base: ResolvedVc<ModuleGraph>,\n+    /// The base graph plus any modules that were generated from additional entries (for which the\n+    /// base graph is needed).\n+    pub full_with_unused_references: ResolvedVc<ModuleGraph>,\n+    /// `full_with_unused_references` but with unused references removed.\n     pub full: ResolvedVc<ModuleGraph>,\n }\n "
        },
        {
            "sha": "2f6ae204dbb6b178e9ff2b4749b17e62278766fb",
            "filename": "crates/next-api/src/webpack_stats.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 6,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fwebpack_stats.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-api%2Fsrc%2Fwebpack_stats.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-api%2Fsrc%2Fwebpack_stats.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -58,12 +58,14 @@ where\n     let asset_reasons = {\n         let module_graph = module_graph.read_graphs().await?;\n         let mut edges = vec![];\n-        module_graph.traverse_all_edges_unordered(|(parent_node, r), current| {\n-            edges.push((\n-                parent_node,\n-                RcStr::from(format!(\"{}: {}\", r.chunking_type, r.export)),\n-                current,\n-            ));\n+        module_graph.traverse_all_edges_unordered(|parent, current| {\n+            if let Some((parent_node, r)) = parent {\n+                edges.push((\n+                    parent_node,\n+                    RcStr::from(format!(\"{}: {}\", r.chunking_type, r.binding_usage.export)),\n+                    current,\n+                ));\n+            }\n             Ok(())\n         })?;\n "
        },
        {
            "sha": "e63720f07e526ae77f785f89a921226a241c497e",
            "filename": "crates/next-core/src/next_client/context.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -25,7 +25,7 @@ use turbopack_core::{\n     compile_time_info::{CompileTimeDefines, CompileTimeInfo, FreeVarReference, FreeVarReferences},\n     environment::{BrowserEnvironment, Environment, ExecutionEnvironment},\n     free_var_references,\n-    module_graph::export_usage::OptionExportUsageInfo,\n+    module_graph::binding_usage_info::OptionBindingUsageInfo,\n     resolve::{parse::Request, pattern::Pattern},\n };\n use turbopack_ecmascript::{AnalyzeMode, TypeofWindow, chunk::EcmascriptChunkType};\n@@ -416,7 +416,8 @@ pub struct ClientChunkingContextOptions {\n     pub asset_prefix: Vc<RcStr>,\n     pub environment: Vc<Environment>,\n     pub module_id_strategy: Vc<Box<dyn ModuleIdStrategy>>,\n-    pub export_usage: Vc<OptionExportUsageInfo>,\n+    pub export_usage: Vc<OptionBindingUsageInfo>,\n+    pub unused_references: Vc<OptionBindingUsageInfo>,\n     pub minify: Vc<bool>,\n     pub source_maps: Vc<SourceMapsType>,\n     pub no_mangling: Vc<bool>,\n@@ -439,6 +440,7 @@ pub async fn get_client_chunking_context(\n         environment,\n         module_id_strategy,\n         export_usage,\n+        unused_references,\n         minify,\n         source_maps,\n         no_mangling,\n@@ -473,6 +475,7 @@ pub async fn get_client_chunking_context(\n     .asset_base_path(Some(asset_prefix))\n     .current_chunk_method(CurrentChunkMethod::DocumentCurrentScript)\n     .export_usage(*export_usage.await?)\n+    .unused_references(*unused_references.await?)\n     .module_id_strategy(module_id_strategy.to_resolved().await?)\n     .debug_ids(*debug_ids.await?)\n     .should_use_absolute_url_references(*should_use_absolute_url_references.await?)"
        },
        {
            "sha": "797e27aaebf4c8dfa24d994f38fd093d7fffc199",
            "filename": "crates/next-core/src/next_client_reference/ecmascript_client_reference/ecmascript_client_reference_module.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fecmascript_client_reference%2Fecmascript_client_reference_module.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -15,7 +15,7 @@ use turbopack_core::{\n     context::AssetContext,\n     ident::AssetIdent,\n     module::Module,\n-    module_graph::{ModuleGraph, export_usage::ModuleExportUsageInfo},\n+    module_graph::{ModuleGraph, binding_usage_info::ModuleExportUsageInfo},\n     output::OutputAssetsReference,\n     reference::{ModuleReference, ModuleReferences},\n     reference_type::ReferenceType,"
        },
        {
            "sha": "8d1adbd249c581972bb9cfddcdfb06e2e910239e",
            "filename": "crates/next-core/src/next_client_reference/visit_client_reference.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fvisit_client_reference.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fvisit_client_reference.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client_reference%2Fvisit_client_reference.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -192,9 +192,9 @@ impl Visit<FindServerEntriesNode> for FindServerEntries {\n \n             let referenced_modules = referenced_modules\n                 .iter()\n-                .flat_map(|(chunking_type, _, modules)| match chunking_type {\n+                .flat_map(|(_, resolved)| match resolved.chunking_type {\n                     ChunkingType::Traced => None,\n-                    _ => Some(modules.iter()),\n+                    _ => Some(resolved.modules.iter()),\n                 })\n                 .flatten()\n                 .map(async |module| {"
        },
        {
            "sha": "ef603e73460d3d165e15817895b9ee92a7422d66",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 23,
            "deletions": 0,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -901,6 +901,8 @@ pub struct ExperimentalConfig {\n     // Whether to enable the global-not-found convention\n     global_not_found: Option<bool>,\n     /// Defaults to false in development mode, true in production mode.\n+    turbopack_remove_unused_imports: Option<bool>,\n+    /// Defaults to false in development mode, true in production mode.\n     turbopack_remove_unused_exports: Option<bool>,\n     /// Devtool option for the segment explorer.\n     devtool_segment_explorer: Option<bool>,\n@@ -1754,6 +1756,27 @@ impl NextConfig {\n         .cell()\n     }\n \n+    #[turbo_tasks::function]\n+    pub async fn turbopack_remove_unused_imports(\n+        self: Vc<Self>,\n+        mode: Vc<NextMode>,\n+    ) -> Result<Vc<bool>> {\n+        let remove_unused_imports = self\n+            .await?\n+            .experimental\n+            .turbopack_remove_unused_imports\n+            .unwrap_or(matches!(*mode.await?, NextMode::Build));\n+\n+        if remove_unused_imports && !*self.turbopack_remove_unused_exports(mode).await? {\n+            bail!(\n+                \"`experimental.turbopackRemoveUnusedImports` cannot be enabled without also \\\n+                 enabling `experimental.turbopackRemoveUnusedExports`\"\n+            );\n+        }\n+\n+        Ok(Vc::cell(remove_unused_imports))\n+    }\n+\n     #[turbo_tasks::function]\n     pub async fn turbopack_remove_unused_exports(&self, mode: Vc<NextMode>) -> Result<Vc<bool>> {\n         Ok(Vc::cell("
        },
        {
            "sha": "2aa302c4f8124108f1c13eb0ecdd920aaf80d3c6",
            "filename": "crates/next-core/src/next_edge/context.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_edge%2Fcontext.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -13,7 +13,7 @@ use turbopack_core::{\n     compile_time_info::{CompileTimeDefines, CompileTimeInfo, FreeVarReference, FreeVarReferences},\n     environment::{EdgeWorkerEnvironment, Environment, ExecutionEnvironment, NodeJsVersion},\n     free_var_references,\n-    module_graph::export_usage::OptionExportUsageInfo,\n+    module_graph::binding_usage_info::OptionBindingUsageInfo,\n };\n use turbopack_ecmascript::chunk::EcmascriptChunkType;\n use turbopack_node::execution_context::ExecutionContext;\n@@ -203,7 +203,8 @@ pub struct EdgeChunkingContextOptions {\n     pub output_root_to_root_path: Vc<RcStr>,\n     pub environment: Vc<Environment>,\n     pub module_id_strategy: Vc<Box<dyn ModuleIdStrategy>>,\n-    pub export_usage: Vc<OptionExportUsageInfo>,\n+    pub export_usage: Vc<OptionBindingUsageInfo>,\n+    pub unused_references: Vc<OptionBindingUsageInfo>,\n     pub turbo_minify: Vc<bool>,\n     pub turbo_source_maps: Vc<SourceMapsType>,\n     pub no_mangling: Vc<bool>,\n@@ -226,6 +227,7 @@ pub async fn get_edge_chunking_context_with_client_assets(\n         environment,\n         module_id_strategy,\n         export_usage,\n+        unused_references,\n         turbo_minify,\n         turbo_source_maps,\n         no_mangling,\n@@ -258,6 +260,7 @@ pub async fn get_edge_chunking_context_with_client_assets(\n     .source_maps(*turbo_source_maps.await?)\n     .module_id_strategy(module_id_strategy.to_resolved().await?)\n     .export_usage(*export_usage.await?)\n+    .unused_references(*unused_references.await?)\n     .nested_async_availability(*nested_async_chunking.await?);\n \n     if !next_mode.is_development() {\n@@ -295,6 +298,7 @@ pub async fn get_edge_chunking_context(\n         environment,\n         module_id_strategy,\n         export_usage,\n+        unused_references,\n         turbo_minify,\n         turbo_source_maps,\n         no_mangling,\n@@ -333,6 +337,7 @@ pub async fn get_edge_chunking_context(\n     .source_maps(*turbo_source_maps.await?)\n     .module_id_strategy(module_id_strategy.to_resolved().await?)\n     .export_usage(*export_usage.await?)\n+    .unused_references(*unused_references.await?)\n     .nested_async_availability(*nested_async_chunking.await?);\n \n     if !next_mode.is_development() {"
        },
        {
            "sha": "e7cf73a4744f4fc55a4a51915f7d3328cb3cdac1",
            "filename": "crates/next-core/src/next_server/context.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 2,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -23,7 +23,7 @@ use turbopack_core::{\n     compile_time_info::{CompileTimeDefines, CompileTimeInfo, FreeVarReferences},\n     environment::{Environment, ExecutionEnvironment, NodeJsEnvironment, NodeJsVersion},\n     free_var_references,\n-    module_graph::export_usage::OptionExportUsageInfo,\n+    module_graph::binding_usage_info::OptionBindingUsageInfo,\n     target::CompileTarget,\n };\n use turbopack_ecmascript::{\n@@ -991,7 +991,8 @@ pub struct ServerChunkingContextOptions {\n     pub node_root_to_root_path: RcStr,\n     pub environment: Vc<Environment>,\n     pub module_id_strategy: Vc<Box<dyn ModuleIdStrategy>>,\n-    pub export_usage: Vc<OptionExportUsageInfo>,\n+    pub export_usage: Vc<OptionBindingUsageInfo>,\n+    pub unused_references: Vc<OptionBindingUsageInfo>,\n     pub minify: Vc<bool>,\n     pub source_maps: Vc<SourceMapsType>,\n     pub no_mangling: Vc<bool>,\n@@ -1015,6 +1016,7 @@ pub async fn get_server_chunking_context_with_client_assets(\n         environment,\n         module_id_strategy,\n         export_usage,\n+        unused_references,\n         minify,\n         source_maps,\n         no_mangling,\n@@ -1051,6 +1053,7 @@ pub async fn get_server_chunking_context_with_client_assets(\n     .source_maps(*source_maps.await?)\n     .module_id_strategy(module_id_strategy.to_resolved().await?)\n     .export_usage(*export_usage.await?)\n+    .unused_references(*unused_references.await?)\n     .file_tracing(next_mode.is_production())\n     .debug_ids(*debug_ids.await?)\n     .nested_async_availability(*nested_async_chunking.await?);\n@@ -1097,6 +1100,7 @@ pub async fn get_server_chunking_context(\n         environment,\n         module_id_strategy,\n         export_usage,\n+        unused_references,\n         minify,\n         source_maps,\n         no_mangling,\n@@ -1133,6 +1137,7 @@ pub async fn get_server_chunking_context(\n     .source_maps(*source_maps.await?)\n     .module_id_strategy(module_id_strategy.to_resolved().await?)\n     .export_usage(*export_usage.await?)\n+    .unused_references(*unused_references.await?)\n     .file_tracing(next_mode.is_production())\n     .debug_ids(*debug_ids.await?)\n     .nested_async_availability(*nested_async_chunking.await?);"
        },
        {
            "sha": "63455fda9e127bc8c5af875f67b79af6e83939dd",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -300,6 +300,7 @@ export const experimentalSchema = {\n   turbopackSourceMaps: z.boolean().optional(),\n   turbopackInputSourceMaps: z.boolean().optional(),\n   turbopackTreeShaking: z.boolean().optional(),\n+  turbopackRemoveUnusedImports: z.boolean().optional(),\n   turbopackRemoveUnusedExports: z.boolean().optional(),\n   turbopackScopeHoisting: z.boolean().optional(),\n   turbopackClientSideNestedAsyncChunking: z.boolean().optional(),"
        },
        {
            "sha": "65f336723a68029070788937897cb7bc44a65ad5",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -452,6 +452,11 @@ export interface ExperimentalConfig {\n    */\n   turbopackTreeShaking?: boolean\n \n+  /**\n+   * Enable removing unused imports for turbopack dev server and build.\n+   */\n+  turbopackRemoveUnusedImports?: boolean\n+\n   /**\n    * Enable removing unused exports for turbopack dev server and build.\n    */"
        },
        {
            "sha": "0facb2f8c269ddfb2edd99e8263b568745136593",
            "filename": "test/production/app-dir/reference-tree-shaking/app/layout.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Fapp%2Flayout.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Fapp%2Flayout.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Fapp%2Flayout.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,8 @@\n+export default function Root({ children }) {\n+  return (\n+    <html>\n+      <head></head>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "6ec167c5c557bde35d374537fe1e0c53f1dd677c",
            "filename": "test/production/app-dir/reference-tree-shaking/app/page.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Fapp%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Fapp%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Fapp%2Fpage.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+import { Server } from '../library/index.js'\n+\n+export default function page() {\n+  return <Server />\n+}"
        },
        {
            "sha": "868cb1aed14dd919f4a87dfb7a1e1023cee8a855",
            "filename": "test/production/app-dir/reference-tree-shaking/library/action.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Faction.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Faction.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Faction.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,8 @@\n+export function Bar() {\n+  async function create() {\n+    'use server'\n+    console.log('Action called')\n+  }\n+\n+  return <button onClick={create}>Bar</button>\n+}"
        },
        {
            "sha": "1040947143a7f756b92c7a43b17ad652bd8dcf20",
            "filename": "test/production/app-dir/reference-tree-shaking/library/client.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Fclient.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Fclient.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Fclient.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export function Foo() {\n+  return 'Client'\n+}"
        },
        {
            "sha": "76170cae37d1bc3e4b590063520abc5d790eb654",
            "filename": "test/production/app-dir/reference-tree-shaking/library/index.js",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,15 @@\n+export function Server() {\n+  return 'This is Server'\n+}\n+\n+import { Foo } from './client.js'\n+// This is unused\n+export function Client() {\n+  return <Foo />\n+}\n+\n+import { Bar } from './action.js'\n+// This is unused\n+export function Action() {\n+  return <Bar />\n+}"
        },
        {
            "sha": "a43829151e1423f0641beb1f114773f1c67fda72",
            "filename": "test/production/app-dir/reference-tree-shaking/library/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Flibrary%2Fpackage.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/production/app-dir/reference-tree-shaking/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Fnext.config.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "e26a9004d399827877e8b7338526db170a835559",
            "filename": "test/production/app-dir/reference-tree-shaking/reference-tree-shaking.test.ts",
            "status": "added",
            "additions": 25,
            "deletions": 0,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Freference-tree-shaking.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Freference-tree-shaking.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Freference-tree-shaking%2Freference-tree-shaking.test.ts?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,25 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('reference-tree-shaking', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('Should apply removeUnusedImports tree shaking to client and server references', async () => {\n+    const res = await next.fetch('/')\n+    expect(await res.text()).toContain('This is Server')\n+\n+    // Only Turbopack applies inner graph tree shaking here\n+    if (process.env.IS_TURBOPACK_TEST) {\n+      const serverReferences = await next.readFile(\n+        '.next/server/server-reference-manifest.json'\n+      )\n+      expect(serverReferences).not.toContain('library/action.js')\n+\n+      const clientReferences = await next.readFile(\n+        '.next/server/app/page_client-reference-manifest.js'\n+      )\n+      expect(clientReferences).not.toContain('library/client.js')\n+    }\n+  })\n+})"
        },
        {
            "sha": "8ebf54889577d30ce350a065fd372a184a711e55",
            "filename": "test/production/remove-unused-imports/app/layout.js",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Fapp%2Flayout.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Fapp%2Flayout.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fremove-unused-imports%2Fapp%2Flayout.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,12 @@\n+import React from 'react'\n+\n+export default function Layout({ children }) {\n+  return (\n+    <html>\n+      <head>\n+        <title>My App</title>\n+      </head>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "31c28a92371d26c7b025c5ba3834a73be9565226",
            "filename": "test/production/remove-unused-imports/app/page.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Fapp%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Fapp%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fremove-unused-imports%2Fapp%2Fpage.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,6 @@\n+'use client'\n+import { used } from '../library'\n+\n+export default function Page() {\n+  return <h1>My Page{used()}</h1>\n+}"
        },
        {
            "sha": "4a33a461f17c2ab329a9701117e4aca0578437bb",
            "filename": "test/production/remove-unused-imports/library/a.js",
            "status": "added",
            "additions": 49,
            "deletions": 0,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Fa.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,49 @@\n+export function a() {\n+  return `This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+This is some big library. This is some big library. This is some big library. This is some big library. This is some big library. This is some big library.\n+`\n+}"
        },
        {
            "sha": "c47675041c4b4dc17137ab88b372e85324451925",
            "filename": "test/production/remove-unused-imports/library/b.js",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Fb.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Fb.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Fb.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,21 @@\n+module.exports.b = function b() {\n+  return `This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. This is a big library. \n+`\n+}"
        },
        {
            "sha": "5ab867e9208bc91df7752b52c38ad567250e6f57",
            "filename": "test/production/remove-unused-imports/library/index.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,8 @@\n+import { b } from './b'\n+export function unused() {\n+  return b()\n+}\n+\n+export function used() {\n+  return 'used'\n+}"
        },
        {
            "sha": "a43829151e1423f0641beb1f114773f1c67fda72",
            "filename": "test/production/remove-unused-imports/library/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fremove-unused-imports%2Flibrary%2Fpackage.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/production/remove-unused-imports/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fremove-unused-imports%2Fnext.config.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "40bb9ec28099085964693951ae74efbc9f395bf1",
            "filename": "test/production/remove-unused-imports/remove-unused-imports.test.ts",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Fremove-unused-imports.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/test%2Fproduction%2Fremove-unused-imports%2Fremove-unused-imports.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fremove-unused-imports%2Fremove-unused-imports.test.ts?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,33 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('remove-unused-imports', () => {\n+  const { next, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  it('should remove unused imports', async () => {\n+    const browser = await next.browser('/')\n+    let scripts = await browser.elementsByCss('script[src]')\n+\n+    expect(\n+      (\n+        await Promise.all(\n+          scripts.map(async (el) => {\n+            const src = await el.getAttribute('src')\n+            const res = await next.fetch(src)\n+            const code = await res.text()\n+            if (code.includes('This is a big library.')) {\n+              return src\n+            }\n+            return false\n+          })\n+        )\n+      ).filter((item) => item)\n+    ).toBeEmpty()\n+  })\n+})"
        },
        {
            "sha": "215b10069f8414a84fb959da6d5c6d9176cd2fa5",
            "filename": "turbopack/crates/turbopack-browser/src/chunking_context.rs",
            "status": "modified",
            "additions": 29,
            "deletions": 5,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -23,10 +23,11 @@ use turbopack_core::{\n     module::Module,\n     module_graph::{\n         ModuleGraph,\n+        binding_usage_info::{BindingUsageInfo, ModuleExportUsage},\n         chunk_group_info::ChunkGroup,\n-        export_usage::{ExportUsageInfo, ModuleExportUsage},\n     },\n     output::{OutputAsset, OutputAssets},\n+    reference::ModuleReference,\n };\n use turbopack_ecmascript::{\n     async_chunk::module::AsyncLoaderModule,\n@@ -168,11 +169,19 @@ impl BrowserChunkingContextBuilder {\n         self\n     }\n \n-    pub fn export_usage(mut self, export_usage: Option<ResolvedVc<ExportUsageInfo>>) -> Self {\n+    pub fn export_usage(mut self, export_usage: Option<ResolvedVc<BindingUsageInfo>>) -> Self {\n         self.chunking_context.export_usage = export_usage;\n         self\n     }\n \n+    pub fn unused_references(\n+        mut self,\n+        unused_references: Option<ResolvedVc<BindingUsageInfo>>,\n+    ) -> Self {\n+        self.chunking_context.unused_references = unused_references;\n+        self\n+    }\n+\n     pub fn debug_ids(mut self, debug_ids: bool) -> Self {\n         self.chunking_context.debug_ids = debug_ids;\n         self\n@@ -291,7 +300,9 @@ pub struct BrowserChunkingContext {\n     /// The module id strategy to use\n     module_id_strategy: ResolvedVc<Box<dyn ModuleIdStrategy>>,\n     /// The module export usage info, if available.\n-    export_usage: Option<ResolvedVc<ExportUsageInfo>>,\n+    export_usage: Option<ResolvedVc<BindingUsageInfo>>,\n+    /// Which references are unused and should be skipped (e.g. during codegen).\n+    unused_references: Option<ResolvedVc<BindingUsageInfo>>,\n     /// The chunking configs\n     chunking_configs: Vec<(ResolvedVc<Box<dyn ChunkType>>, ChunkingConfig)>,\n     /// Whether to use absolute URLs for static assets (e.g. in CSS: `url(\"/absolute/path\")`)\n@@ -340,6 +351,7 @@ impl BrowserChunkingContext {\n                 manifest_chunks: false,\n                 module_id_strategy: ResolvedVc::upcast(DevModuleIdStrategy::new_resolved()),\n                 export_usage: None,\n+                unused_references: None,\n                 chunking_configs: Default::default(),\n                 should_use_absolute_url_references: false,\n             },\n@@ -866,12 +878,24 @@ impl ChunkingContext for BrowserChunkingContext {\n         if let Some(export_usage) = self.await?.export_usage {\n             Ok(export_usage.await?.used_exports(module).await?)\n         } else {\n-            // In development mode, we don't have export usage info, so we assume all exports are\n-            // used.\n             Ok(ModuleExportUsage::all())\n         }\n     }\n \n+    #[turbo_tasks::function]\n+    async fn is_reference_unused(\n+        self: Vc<Self>,\n+        reference: ResolvedVc<Box<dyn ModuleReference>>,\n+    ) -> Result<Vc<bool>> {\n+        if let Some(unused_references) = self.await?.unused_references {\n+            Ok(Vc::cell(\n+                unused_references.await?.is_reference_unused(&reference),\n+            ))\n+        } else {\n+            Ok(Vc::cell(false))\n+        }\n+    }\n+\n     #[turbo_tasks::function]\n     async fn debug_ids_enabled(self: Vc<Self>) -> Result<Vc<bool>> {\n         Ok(Vc::cell(self.await?.debug_ids))"
        },
        {
            "sha": "0fe4e39402cd2ce6ebdcd101b6001a8b654377e6",
            "filename": "turbopack/crates/turbopack-cli/src/build/mod.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 5,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fbuild%2Fmod.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -33,8 +33,8 @@ use turbopack_core::{\n     module::Module,\n     module_graph::{\n         ModuleGraph,\n+        binding_usage_info::compute_binding_usage_info,\n         chunk_group_info::{ChunkGroup, ChunkGroupEntry},\n-        export_usage::compute_export_usage_info,\n     },\n     output::{OutputAsset, OutputAssets, OutputAssetsWithReferenced},\n     reference_type::{EntryReferenceSubType, ReferenceType},\n@@ -305,7 +305,7 @@ async fn build_internal(\n     .instrument(tracing::info_span!(\"resolve entries\"))\n     .await?;\n \n-    let module_graph = ModuleGraph::from_modules(\n+    let mut module_graph = ModuleGraph::from_modules(\n         Vc::cell(vec![ChunkGroupEntry::Entry(entries.clone())]),\n         false,\n     );\n@@ -314,9 +314,10 @@ async fn build_internal(\n             .to_resolved()\n             .await?,\n     );\n-    let export_usage = compute_export_usage_info(module_graph.to_resolved().await?)\n+    let binding_usage = compute_binding_usage_info(module_graph.to_resolved().await?, true)\n         .resolve_strongly_consistent()\n         .await?;\n+    module_graph = module_graph.without_unused_references(*binding_usage);\n \n     let chunking_context: Vc<Box<dyn ChunkingContext>> = match target {\n         Target::Browser => {\n@@ -342,7 +343,8 @@ async fn build_internal(\n             )\n             .source_maps(source_maps_type)\n             .module_id_strategy(module_id_strategy)\n-            .export_usage(Some(export_usage))\n+            .export_usage(Some(binding_usage))\n+            .unused_references(Some(binding_usage))\n             .current_chunk_method(CurrentChunkMethod::DocumentCurrentScript)\n             .minify_type(minify_type);\n \n@@ -391,7 +393,8 @@ async fn build_internal(\n             )\n             .source_maps(source_maps_type)\n             .module_id_strategy(module_id_strategy)\n-            .export_usage(Some(export_usage))\n+            .export_usage(Some(binding_usage))\n+            .unused_references(Some(binding_usage))\n             .minify_type(minify_type);\n \n             match *node_env.await? {"
        },
        {
            "sha": "23672d86fbb29cb30865fec4585b5ed2887c9999",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking_context.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 1,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -14,13 +14,14 @@ use crate::{\n     ident::AssetIdent,\n     module::Module,\n     module_graph::{\n-        ModuleGraph, chunk_group_info::ChunkGroup, export_usage::ModuleExportUsage,\n+        ModuleGraph, binding_usage_info::ModuleExportUsage, chunk_group_info::ChunkGroup,\n         module_batches::BatchingConfig,\n     },\n     output::{\n         ExpandOutputAssetsInput, OutputAsset, OutputAssets, OutputAssetsReferences,\n         OutputAssetsWithReferenced, expand_output_assets,\n     },\n+    reference::ModuleReference,\n };\n \n #[derive(\n@@ -439,6 +440,12 @@ pub trait ChunkingContext {\n         module: Vc<Box<dyn Module>>,\n     ) -> Result<Vc<ModuleExportUsage>>;\n \n+    #[turbo_tasks::function]\n+    async fn is_reference_unused(\n+        self: Vc<Self>,\n+        reference: Vc<Box<dyn ModuleReference>>,\n+    ) -> Result<Vc<bool>>;\n+\n     /// Returns whether debug IDs are enabled for this chunking context.\n     #[turbo_tasks::function]\n     fn debug_ids_enabled(self: Vc<Self>) -> Vc<bool>;"
        },
        {
            "sha": "3339c47e153ed9b42c17ceb8463d6cd93f0ebee3",
            "filename": "turbopack/crates/turbopack-core/src/chunk/mod.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -46,7 +46,7 @@ use crate::{\n     },\n     output::{OutputAssets, OutputAssetsReference},\n     reference::ModuleReference,\n-    resolve::ExportUsage,\n+    resolve::BindingUsage,\n };\n \n /// A module id, which can be a number or string\n@@ -416,8 +416,8 @@ pub trait ChunkableModuleReference: ModuleReference + ValueToString {\n     }\n \n     #[turbo_tasks::function]\n-    fn export_usage(self: Vc<Self>) -> Vc<ExportUsage> {\n-        ExportUsage::all()\n+    fn binding_usage(self: Vc<Self>) -> Vc<BindingUsage> {\n+        BindingUsage::all()\n     }\n }\n "
        },
        {
            "sha": "51c0cb844d278dd7fa8712093af84bd26a544164",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/async_module_info.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 10,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fasync_module_info.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fasync_module_info.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fasync_module_info.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -4,7 +4,7 @@ use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc};\n \n use crate::{\n     module::{Module, Modules},\n-    module_graph::{GraphTraversalAction, ModuleGraph, SingleModuleGraph},\n+    module_graph::{GraphTraversalAction, ModuleGraph, SingleModuleGraphWithBindingUsage},\n };\n \n #[turbo_tasks::value(transparent)]\n@@ -37,25 +37,29 @@ impl AsyncModulesInfo {\n \n #[turbo_tasks::function(operation)]\n pub async fn compute_async_module_info(\n-    graph: ResolvedVc<ModuleGraph>,\n+    graphs: ResolvedVc<ModuleGraph>,\n ) -> Result<Vc<AsyncModulesInfo>> {\n     // Layout segment optimization, we can individually compute the async modules for each graph.\n     let mut result: Vc<AsyncModulesInfo> = Vc::cell(Default::default());\n-    for g in &graph.await?.graphs {\n-        result = compute_async_module_info_single(**g, result);\n+    let graphs = graphs.await?;\n+    for graph in graphs.iter_graphs() {\n+        result = compute_async_module_info_single(graph, result);\n     }\n     Ok(result)\n }\n \n #[turbo_tasks::function]\n async fn compute_async_module_info_single(\n-    graph: Vc<SingleModuleGraph>,\n+    graph: SingleModuleGraphWithBindingUsage,\n     parent_async_modules: Vc<AsyncModulesInfo>,\n ) -> Result<Vc<AsyncModulesInfo>> {\n     let parent_async_modules = parent_async_modules.await?;\n-    let graph = graph.await?;\n+    let graph = graph.read().await?;\n \n     let self_async_modules = graph\n+        .graphs\n+        .first()\n+        .unwrap()\n         .iter_nodes()\n         .map(async |node| Ok((node, *node.is_self_async().await?)))\n         .try_join()\n@@ -73,9 +77,8 @@ async fn compute_async_module_info_single(\n     // modules in the SCC is async.\n \n     let mut async_modules = self_async_modules;\n-    let graph_ref = graph.read();\n-    graph_ref.traverse_edges_from_entries_dfs(\n-        graph.entry_modules(),\n+    graph.traverse_edges_from_entries_dfs(\n+        graph.graphs.first().unwrap().entry_modules(),\n         &mut (),\n         |_, _, _| Ok(GraphTraversalAction::Continue),\n         |parent_info, module, _| {\n@@ -91,7 +94,7 @@ async fn compute_async_module_info_single(\n         },\n     )?;\n \n-    graph_ref.traverse_cycles(\n+    graph.traverse_cycles(\n         |ref_data| ref_data.chunking_type.is_inherit_async(),\n         |cycle| {\n             if cycle.iter().any(|node| async_modules.contains(node)) {"
        },
        {
            "sha": "1bd8209135808d41c031f9befdeb19bbe8243632",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/binding_usage_info.rs",
            "status": "added",
            "additions": 306,
            "deletions": 0,
            "changes": 306,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fbinding_usage_info.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fbinding_usage_info.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fbinding_usage_info.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,306 @@\n+use std::collections::hash_map::Entry;\n+\n+use anyhow::{Result, bail};\n+use auto_hash_map::AutoSet;\n+use rustc_hash::{FxHashMap, FxHashSet};\n+use tracing::Instrument;\n+use turbo_rcstr::RcStr;\n+use turbo_tasks::{ResolvedVc, Vc};\n+\n+use crate::{\n+    module::Module,\n+    module_graph::{GraphEdgeIndex, GraphTraversalAction, ModuleGraph},\n+    reference::ModuleReference,\n+    resolve::{ExportUsage, ImportUsage},\n+};\n+\n+#[turbo_tasks::value]\n+#[derive(Clone, Default, Debug)]\n+pub struct BindingUsageInfo {\n+    unused_references: FxHashSet<ResolvedVc<Box<dyn ModuleReference>>>,\n+    #[turbo_tasks(trace_ignore)]\n+    unused_references_edges: FxHashSet<GraphEdgeIndex>,\n+\n+    used_exports: FxHashMap<ResolvedVc<Box<dyn Module>>, ModuleExportUsageInfo>,\n+    export_circuit_breakers: FxHashSet<ResolvedVc<Box<dyn Module>>>,\n+}\n+\n+#[turbo_tasks::value(transparent)]\n+pub struct OptionBindingUsageInfo(Option<ResolvedVc<BindingUsageInfo>>);\n+\n+#[turbo_tasks::value]\n+pub struct ModuleExportUsage {\n+    pub export_usage: ResolvedVc<ModuleExportUsageInfo>,\n+    // Whether this module exists in an import cycle and has been selected to break the cycle.\n+    pub is_circuit_breaker: bool,\n+}\n+#[turbo_tasks::value_impl]\n+impl ModuleExportUsage {\n+    #[turbo_tasks::function]\n+    pub async fn all() -> Result<Vc<Self>> {\n+        Ok(Self {\n+            export_usage: ModuleExportUsageInfo::all().to_resolved().await?,\n+            is_circuit_breaker: true,\n+        }\n+        .cell())\n+    }\n+}\n+\n+impl BindingUsageInfo {\n+    pub fn is_reference_unused_edge(&self, edge: &GraphEdgeIndex) -> bool {\n+        self.unused_references_edges.contains(edge)\n+    }\n+\n+    pub fn is_reference_unused(&self, reference: &ResolvedVc<Box<dyn ModuleReference>>) -> bool {\n+        self.unused_references.contains(reference)\n+    }\n+\n+    pub async fn used_exports(\n+        &self,\n+        module: ResolvedVc<Box<dyn Module>>,\n+    ) -> Result<Vc<ModuleExportUsage>> {\n+        let is_circuit_breaker = self.export_circuit_breakers.contains(&module);\n+        let Some(exports) = self.used_exports.get(&module) else {\n+            // There are some module that are codegened, but not referenced in the module graph,\n+            let ident = module.ident_string().await?;\n+            if ident.contains(\".wasm_.loader.mjs\") || ident.contains(\"/__nextjs-internal-proxy.\") {\n+                // Both the turbopack-wasm `ModuleChunkItem` and `EcmascriptClientReferenceModule`\n+                // do `self.slightly_different_module().as_chunk_item()`, so the\n+                // module that codegen sees isn't actually in the module graph.\n+                // TODO fix these cases\n+                return Ok(ModuleExportUsage::all());\n+            }\n+\n+            bail!(\"export usage not found for module: {ident:?}\");\n+        };\n+        Ok(ModuleExportUsage {\n+            export_usage: exports.clone().resolved_cell(),\n+            is_circuit_breaker,\n+        }\n+        .cell())\n+    }\n+}\n+\n+#[turbo_tasks::function(operation)]\n+pub async fn compute_binding_usage_info(\n+    graph: ResolvedVc<ModuleGraph>,\n+    remove_unused_imports: bool,\n+) -> Result<Vc<BindingUsageInfo>> {\n+    let span_outer = tracing::info_span!(\n+        \"compute bindung usage info\",\n+        visit_count = tracing::field::Empty,\n+        unused_reference_count = tracing::field::Empty\n+    );\n+    let span = span_outer.clone();\n+\n+    async move {\n+        let mut used_exports = FxHashMap::<_, ModuleExportUsageInfo>::default();\n+        #[cfg(debug_assertions)]\n+        let mut debug_unused_references_name = FxHashSet::<(\n+            ResolvedVc<Box<dyn Module>>,\n+            ExportUsage,\n+            ResolvedVc<Box<dyn Module>>,\n+        )>::default();\n+        let mut unused_references_edges = FxHashSet::default();\n+        let mut unused_references = FxHashSet::default();\n+\n+        if graph.await?.binding_usage.is_some() {\n+            // If the graph already has binding usage info, return it directly. This is\n+            // unfortunately easy to do with\n+            // ```\n+            // fn get_module_graph(){\n+            //   let graph = ....;\n+            //   let graph = graph.without_unused_references(compute_binding_usage_info(graph));\n+            //   return graph\n+            // }\n+            //\n+            // compute_binding_usage_info(get_module_graph())\n+            // ```\n+            panic!(\n+                \"don't run compute_binding_usage_info on a graph after calling \\\n+                 without_unused_references\"\n+            );\n+        }\n+\n+        let graph = graph.read_graphs().await?;\n+\n+        let entries = graph.graphs.iter().flat_map(|g| g.entry_modules());\n+\n+        let visit_count = graph.traverse_edges_fixed_point_with_priority(\n+            entries.map(|m| (m, 0)),\n+            &mut (),\n+            |parent, target, _| {\n+                // Entries are always used\n+                let Some((parent, ref_data, edge)) = parent else {\n+                    used_exports.insert(target, ModuleExportUsageInfo::All);\n+                    return Ok(GraphTraversalAction::Continue);\n+                };\n+\n+                if remove_unused_imports {\n+                    // If the current edge is an unused import, skip it\n+                    match &ref_data.binding_usage.import {\n+                        ImportUsage::Exports(exports) => {\n+                            let source_used_exports = used_exports.get(&parent).unwrap();\n+                            if exports\n+                                .iter()\n+                                .all(|e| !source_used_exports.is_export_used(e))\n+                            {\n+                                #[cfg(debug_assertions)]\n+                                debug_unused_references_name.insert((\n+                                    parent,\n+                                    ref_data.binding_usage.export.clone(),\n+                                    target,\n+                                ));\n+                                unused_references_edges.insert(edge);\n+                                unused_references.insert(ref_data.reference);\n+\n+                                return Ok(GraphTraversalAction::Skip);\n+                            } else {\n+                                #[cfg(debug_assertions)]\n+                                debug_unused_references_name.remove(&(\n+                                    parent,\n+                                    ref_data.binding_usage.export.clone(),\n+                                    target,\n+                                ));\n+                                unused_references_edges.remove(&edge);\n+                                unused_references.remove(&ref_data.reference);\n+                                // Continue, add export\n+                            }\n+                        }\n+                        ImportUsage::SideEffects => {\n+                            #[cfg(debug_assertions)]\n+                            debug_unused_references_name.remove(&(\n+                                parent,\n+                                ref_data.binding_usage.export.clone(),\n+                                target,\n+                            ));\n+                            unused_references_edges.remove(&edge);\n+                            unused_references.remove(&ref_data.reference);\n+                            // Continue, has to always be included\n+                        }\n+                    }\n+                }\n+\n+                let entry = used_exports.entry(target);\n+                let is_first_visit = matches!(entry, Entry::Vacant(_));\n+                if entry.or_default().add(&ref_data.binding_usage.export) || is_first_visit {\n+                    // First visit, or the used exports changed. This can cause more imports to get\n+                    // used downstream.\n+                    Ok(GraphTraversalAction::Continue)\n+                } else {\n+                    Ok(GraphTraversalAction::Skip)\n+                }\n+            },\n+            |_, _| Ok(0),\n+        )?;\n+\n+        // Compute cycles and select modules to be 'circuit breakers'\n+        // A circuit breaker module will need to eagerly export lazy getters for its exports to\n+        // break an evaluation cycle all other modules can export values after defining them\n+        let mut export_circuit_breakers = FxHashSet::default();\n+        graph.traverse_cycles(\n+            |e| e.chunking_type.is_parallel(),\n+            |cycle| {\n+                // To break cycles we need to ensure that no importing module can observe a\n+                // partially populated exports object.\n+\n+                // We could compute this based on the module graph via a DFS from each entry point\n+                // to the cycle.  Whatever node is hit first is an entry point to the cycle.\n+                // (scope hoisting does something similar) and then we would only need to\n+                // mark 'entry' modules (basically the targets of back edges in the export graph) as\n+                // circuit breakers.  For now we just mark everything on the theory that cycles are\n+                // rare.  For vercel-site on 8/22/2025 there were 106 cycles covering 800 modules\n+                // (or 1.2% of all modules).  So with this analysis we could potentially drop 80% of\n+                // the cycle breaker modules.\n+                export_circuit_breakers.extend(cycle.iter().map(|n| **n));\n+                Ok(())\n+            },\n+        )?;\n+\n+        span.record(\"visit_count\", visit_count);\n+        span.record(\"unused_reference_count\", unused_references.len());\n+\n+        #[cfg(debug_assertions)]\n+        {\n+            use once_cell::sync::Lazy;\n+            static PRINT_UNUSED_REFERENCES: Lazy<bool> = Lazy::new(|| {\n+                std::env::var_os(\"TURBOPACK_PRINT_UNUSED_REFERENCES\")\n+                    .is_some_and(|v| v == \"1\" || v == \"true\")\n+            });\n+            if *PRINT_UNUSED_REFERENCES {\n+                use turbo_tasks::TryJoinIterExt;\n+                println!(\n+                    \"unused references: {:#?}\",\n+                    debug_unused_references_name\n+                        .iter()\n+                        .map(async |(s, e, t)| Ok((\n+                            s.ident_string().await?,\n+                            e,\n+                            t.ident_string().await?,\n+                        )))\n+                        .try_join()\n+                        .await?\n+                );\n+            }\n+        }\n+\n+        Ok(BindingUsageInfo {\n+            unused_references,\n+            unused_references_edges,\n+            used_exports,\n+            export_circuit_breakers,\n+        }\n+        .cell())\n+    }\n+    .instrument(span_outer)\n+    .await\n+}\n+\n+#[turbo_tasks::value]\n+#[derive(Default, Clone, Debug)]\n+pub enum ModuleExportUsageInfo {\n+    /// Only the side effects are needed, no exports is used.\n+    #[default]\n+    Evaluation,\n+    Exports(AutoSet<RcStr>),\n+    All,\n+}\n+\n+#[turbo_tasks::value_impl]\n+impl ModuleExportUsageInfo {\n+    #[turbo_tasks::function]\n+    pub fn all() -> Vc<Self> {\n+        ModuleExportUsageInfo::All.cell()\n+    }\n+}\n+\n+impl ModuleExportUsageInfo {\n+    /// Merge the given usage into self. Returns true if Self changed.\n+    pub fn add(&mut self, usage: &ExportUsage) -> bool {\n+        match (&mut *self, usage) {\n+            (Self::All, _) => false,\n+            (_, ExportUsage::All) => {\n+                *self = Self::All;\n+                true\n+            }\n+            (Self::Evaluation, ExportUsage::Named(name)) => {\n+                // Promote evaluation to something more specific\n+                *self = Self::Exports(AutoSet::from_iter([name.clone()]));\n+                true\n+            }\n+            (Self::Exports(l), ExportUsage::Named(r)) => {\n+                // Merge exports\n+                l.insert(r.clone())\n+            }\n+            (_, ExportUsage::Evaluation) => false,\n+        }\n+    }\n+\n+    pub fn is_export_used(&self, export: &RcStr) -> bool {\n+        match self {\n+            Self::All => true,\n+            Self::Evaluation => false,\n+            Self::Exports(exports) => exports.contains(export),\n+        }\n+    }\n+}"
        },
        {
            "sha": "f1a98a13a5b1856d3ec0008605e4fefdf8f61b60",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/chunk_group_info.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fchunk_group_info.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fchunk_group_info.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fchunk_group_info.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -507,7 +507,7 @@ pub async fn compute_chunk_group_info(graph: &ModuleGraphRef) -> Result<Vc<Chunk\n                 })\n                 .collect::<Result<Vec<_>>>()?,\n             &mut module_chunk_groups,\n-            |parent_info: Option<(ResolvedVc<Box<dyn Module>>, &'_ RefData)>,\n+            |parent_info: Option<(ResolvedVc<Box<dyn Module>>, &'_ RefData, _)>,\n              node: ResolvedVc<Box<dyn Module>>,\n              module_chunk_groups: &mut FxHashMap<\n                 ResolvedVc<Box<dyn Module>>,\n@@ -518,7 +518,7 @@ pub async fn compute_chunk_group_info(graph: &ModuleGraphRef) -> Result<Vc<Chunk\n                     Inherit(ResolvedVc<Box<dyn Module>>),\n                     ChunkGroup(It),\n                 }\n-                let chunk_groups = if let Some((parent, ref_data)) = parent_info {\n+                let chunk_groups = if let Some((parent, ref_data, _)) = parent_info {\n                     match &ref_data.chunking_type {\n                         ChunkingType::Parallel { .. } => ChunkGroupInheritance::Inherit(parent),\n                         ChunkingType::Async => ChunkGroupInheritance::ChunkGroup(Either::Left("
        },
        {
            "sha": "1e33facf35e458a7079f5728a13de677776a7228",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/export_usage.rs",
            "status": "removed",
            "additions": 0,
            "deletions": 152,
            "changes": 152,
            "blob_url": "https://github.com/vercel/next.js/blob/4deba0f6ea83a9a4b2ac28eb3e9a38651acfffcd/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fexport_usage.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/4deba0f6ea83a9a4b2ac28eb3e9a38651acfffcd/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fexport_usage.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fexport_usage.rs?ref=4deba0f6ea83a9a4b2ac28eb3e9a38651acfffcd",
            "patch": "@@ -1,152 +0,0 @@\n-//! Intermediate tree shaking that uses global information but not good as the full tree shaking.\n-\n-use anyhow::Result;\n-use auto_hash_map::AutoSet;\n-use rustc_hash::{FxHashMap, FxHashSet};\n-use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, Vc};\n-\n-use crate::{module::Module, module_graph::ModuleGraph, resolve::ExportUsage};\n-\n-#[turbo_tasks::function(operation)]\n-pub async fn compute_export_usage_info(\n-    graph: ResolvedVc<ModuleGraph>,\n-) -> Result<Vc<ExportUsageInfo>> {\n-    let mut used_exports = FxHashMap::<_, ModuleExportUsageInfo>::default();\n-    let graph = graph.read_graphs().await?;\n-    graph.traverse_all_edges_unordered(|(_, ref_data), target| {\n-        let e = used_exports.entry(target).or_default();\n-\n-        e.add(&ref_data.export);\n-\n-        Ok(())\n-    })?;\n-\n-    // Compute cycles and select modules to be 'circuit breakers'\n-    // A circuit breaker module will need to eagerly export lazy getters for its exports to break an\n-    // evaluation cycle all other modules can export values after defining them\n-    let mut circuit_breakers = FxHashSet::default();\n-    graph.traverse_cycles(\n-        |e| e.chunking_type.is_parallel(),\n-        |cycle| {\n-            // To break cycles we need to ensure that no importing module can observe a\n-            // partially populated exports object.\n-\n-            // We could compute this based on the module graph via a DFS from each entry point\n-            // to the cycle.  Whatever node is hit first is an entry point to the cycle.\n-            // (scope hoisting does something similar) and then we would only need to\n-            // mark 'entry' modules (basically the targets of back edges in the export graph) as\n-            // circuit breakers.  For now we just mark everything on the theory that cycles are\n-            // rare.  For vercel-site on 8/22/2025 there were 106 cycles covering 800 modules\n-            // (or 1.2% of all modules).  So with this analysis we could potentially drop 80% of\n-            // the cycle breaker modules.\n-            circuit_breakers.extend(cycle.iter().map(|n| **n));\n-            Ok(())\n-        },\n-    )?;\n-\n-    Ok(ExportUsageInfo {\n-        used_exports,\n-        circuit_breakers,\n-    }\n-    .cell())\n-}\n-\n-#[turbo_tasks::value(transparent)]\n-pub struct OptionExportUsageInfo(Option<ResolvedVc<ExportUsageInfo>>);\n-\n-#[turbo_tasks::value]\n-pub struct ExportUsageInfo {\n-    used_exports: FxHashMap<ResolvedVc<Box<dyn Module>>, ModuleExportUsageInfo>,\n-    circuit_breakers: FxHashSet<ResolvedVc<Box<dyn Module>>>,\n-}\n-\n-#[turbo_tasks::value(shared)]\n-pub struct ModuleExportUsage {\n-    pub export_usage: ResolvedVc<ModuleExportUsageInfo>,\n-    // Whether this module exists in an import cycle and has been selected to break the cycle.\n-    pub is_circuit_breaker: bool,\n-}\n-\n-#[turbo_tasks::value_impl]\n-impl ModuleExportUsage {\n-    #[turbo_tasks::function]\n-    pub async fn all() -> Result<Vc<Self>> {\n-        Ok(Self {\n-            export_usage: ModuleExportUsageInfo::all().to_resolved().await?,\n-            is_circuit_breaker: true,\n-        }\n-        .cell())\n-    }\n-}\n-\n-impl ExportUsageInfo {\n-    pub async fn used_exports(\n-        &self,\n-        module: ResolvedVc<Box<dyn Module>>,\n-    ) -> Result<Vc<ModuleExportUsage>> {\n-        let is_circuit_breaker = self.circuit_breakers.contains(&module);\n-        let export_usage = if let Some(exports) = self.used_exports.get(&module) {\n-            exports.clone().resolved_cell()\n-        } else {\n-            // We exclude template files from tree shaking because they are entrypoints to the\n-            // module graph.\n-            ModuleExportUsageInfo::all().to_resolved().await?\n-        };\n-        Ok(ModuleExportUsage {\n-            export_usage,\n-            is_circuit_breaker,\n-        }\n-        .cell())\n-    }\n-}\n-\n-#[turbo_tasks::value]\n-#[derive(Default, Clone)]\n-pub enum ModuleExportUsageInfo {\n-    /// Only the side effects are needed, no exports is used.\n-    #[default]\n-    Evaluation,\n-    Exports(AutoSet<RcStr>),\n-    All,\n-}\n-\n-#[turbo_tasks::value_impl]\n-impl ModuleExportUsageInfo {\n-    #[turbo_tasks::function]\n-    pub fn all() -> Vc<Self> {\n-        ModuleExportUsageInfo::All.cell()\n-    }\n-}\n-\n-impl ModuleExportUsageInfo {\n-    fn add(&mut self, usage: &ExportUsage) {\n-        match (&mut *self, usage) {\n-            (Self::All, _) => {}\n-            (_, ExportUsage::All) => {\n-                *self = Self::All;\n-            }\n-            (Self::Evaluation, ExportUsage::Named(name)) => {\n-                // Promote evaluation to something more specific\n-                *self = Self::Exports(AutoSet::from_iter([name.clone()]));\n-            }\n-\n-            (Self::Exports(l), ExportUsage::Named(r)) => {\n-                // Merge exports\n-                l.insert(r.clone());\n-            }\n-\n-            (_, ExportUsage::Evaluation) => {\n-                // Ignore evaluation\n-            }\n-        }\n-    }\n-\n-    pub fn is_export_used(&self, export: &RcStr) -> bool {\n-        match self {\n-            Self::All => true,\n-            Self::Evaluation => false,\n-            Self::Exports(exports) => exports.contains(export),\n-        }\n-    }\n-}"
        },
        {
            "sha": "d6f6248a13795833388faac795363b3cb49ed839",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/merged_modules.rs",
            "status": "modified",
            "additions": 14,
            "deletions": 11,
            "changes": 25,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmerged_modules.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmerged_modules.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmerged_modules.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -148,21 +148,22 @@ pub async fn compute_merged_modules(module_graph: Vc<ModuleGraph>) -> Result<Vc<\n                 .map(|e| Ok((*e, -*module_depth.get(e).context(\"Module depth not found\")?)))\n                 .collect::<Result<Vec<_>>>()?,\n             &mut (),\n-            |parent_info: Option<(ResolvedVc<Box<dyn Module>>, &'_ RefData)>,\n+            |parent_info: Option<(ResolvedVc<Box<dyn Module>>, &'_ RefData, _)>,\n              node: ResolvedVc<Box<dyn Module>>,\n              _|\n              -> Result<GraphTraversalAction> {\n                 // On the down traversal, establish which edges are mergeable and set the list\n                 // indices.\n-                let (parent_module, hoisted) = parent_info.map_or((None, false), |(node, ty)| {\n-                    (\n-                        Some(node),\n-                        match &ty.chunking_type {\n-                            ChunkingType::Parallel { hoisted, .. } => *hoisted,\n-                            _ => false,\n-                        },\n-                    )\n-                });\n+                let (parent_module, hoisted) =\n+                    parent_info.map_or((None, false), |(node, ty, _)| {\n+                        (\n+                            Some(node),\n+                            match &ty.chunking_type {\n+                                ChunkingType::Parallel { hoisted, .. } => *hoisted,\n+                                _ => false,\n+                            },\n+                        )\n+                    });\n                 let module = node;\n \n                 Ok(if parent_module.is_some_and(|p| p == module) {\n@@ -490,7 +491,9 @@ pub async fn compute_merged_modules(module_graph: Vc<ModuleGraph>) -> Result<Vc<\n                     // necessarily needed for browser),\n                     exposed_modules_imported.insert(module);\n                 }\n-                if parent_info.is_some_and(|(_, r)| matches!(r.export, ExportUsage::All)) {\n+                if parent_info\n+                    .is_some_and(|(_, r)| matches!(r.binding_usage.export, ExportUsage::All))\n+                {\n                     // This module needs to be exposed:\n                     // - namespace import from another group\n                     exposed_modules_namespace.insert(module);"
        },
        {
            "sha": "ab9c1ca98dc109fb485f3fea6a88c6eb99d5931d",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/mod.rs",
            "status": "modified",
            "additions": 277,
            "deletions": 119,
            "changes": 396,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmod.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -15,7 +15,7 @@ use serde::{Deserialize, Serialize};\n use tracing::{Instrument, Level, Span};\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n-    CollectiblesSource, FxIndexMap, NonLocalValue, ReadRef, ResolvedVc, TryJoinIterExt,\n+    CollectiblesSource, FxIndexMap, NonLocalValue, ReadRef, ResolvedVc, TaskInput, TryJoinIterExt,\n     ValueToString, Vc,\n     debug::ValueDebugFormat,\n     graph::{AdjacencyMap, GraphTraversal, Visit, VisitControlFlow},\n@@ -29,19 +29,20 @@ use crate::{\n     module::Module,\n     module_graph::{\n         async_module_info::{AsyncModulesInfo, compute_async_module_info},\n+        binding_usage_info::BindingUsageInfo,\n         chunk_group_info::{ChunkGroupEntry, ChunkGroupInfo, compute_chunk_group_info},\n         merged_modules::{MergedModuleInfo, compute_merged_modules},\n         module_batches::{ModuleBatchesGraph, compute_module_batches},\n         style_groups::{StyleGroups, StyleGroupsConfig, compute_style_groups},\n         traced_di_graph::TracedDiGraph,\n     },\n-    reference::primary_chunkable_referenced_modules,\n-    resolve::ExportUsage,\n+    reference::{ModuleReference, primary_chunkable_referenced_modules},\n+    resolve::BindingUsage,\n };\n \n pub mod async_module_info;\n+pub mod binding_usage_info;\n pub mod chunk_group_info;\n-pub mod export_usage;\n pub mod merged_modules;\n pub mod module_batch;\n pub(crate) mod module_batches;\n@@ -60,14 +61,36 @@ pub struct GraphNodeIndex {\n     node_idx: NodeIndex,\n }\n impl GraphNodeIndex {\n-    #[inline(always)]\n-    fn graph_idx(&self) -> usize {\n-        self.graph_idx as usize\n+    fn new(graph_idx: u32, node_idx: NodeIndex) -> Self {\n+        Self {\n+            graph_idx,\n+            node_idx,\n+        }\n     }\n }\n \n unsafe impl NonLocalValue for GraphNodeIndex {}\n \n+#[derive(\n+    Debug, Copy, Clone, Eq, PartialOrd, Ord, Hash, PartialEq, Serialize, Deserialize, TraceRawVcs,\n+)]\n+pub struct GraphEdgeIndex {\n+    #[turbo_tasks(trace_ignore)]\n+    graph_idx: u32,\n+    #[turbo_tasks(trace_ignore)]\n+    edge_idx: EdgeIndex,\n+}\n+impl GraphEdgeIndex {\n+    fn new(graph_idx: u32, edge_idx: EdgeIndex) -> Self {\n+        Self {\n+            graph_idx,\n+            edge_idx,\n+        }\n+    }\n+}\n+\n+unsafe impl NonLocalValue for GraphEdgeIndex {}\n+\n #[turbo_tasks::value]\n #[derive(Clone, Debug)]\n pub struct VisitedModules {\n@@ -204,7 +227,8 @@ pub struct SingleModuleGraph {\n )]\n pub struct RefData {\n     pub chunking_type: ChunkingType,\n-    pub export: ExportUsage,\n+    pub binding_usage: BindingUsage,\n+    pub reference: ResolvedVc<Box<dyn ModuleReference>>,\n }\n \n impl SingleModuleGraph {\n@@ -223,14 +247,15 @@ impl SingleModuleGraph {\n             .map(|e| async move {\n                 Ok(SingleModuleGraphBuilderEdge {\n                     to: SingleModuleGraphBuilderNode::new_module(emit_spans, e).await?,\n-                    export: ExportUsage::All,\n+                    binding_usage: BindingUsage::default(),\n+                    reference: None,\n                 })\n             })\n             .try_join()\n             .await?;\n \n         let (children_nodes_iter, visited_nodes) = AdjacencyMap::new()\n-            .skip_duplicates_with_key(|node: &(SingleModuleGraphBuilderNode, ExportUsage)| &node.0)\n+            .skip_duplicates_with_key(|node: &(SingleModuleGraphBuilderNode, _, _)| &node.0)\n             .visit(\n                 root_edges,\n                 SingleModuleGraphBuilder {\n@@ -257,13 +282,16 @@ impl SingleModuleGraph {\n             FxHashMap::with_capacity_and_hasher(node_count, Default::default());\n         {\n             let _span = tracing::info_span!(\"build module graph\").entered();\n-            for (parent, (current, export)) in children_nodes_iter.into_breadth_first_edges() {\n+            for (parent, (current, reference, binding_usage)) in\n+                children_nodes_iter.into_breadth_first_edges()\n+            {\n                 let parent_edge = match parent.map(|v| v.0) {\n                     Some(SingleModuleGraphBuilderNode::Module { module, .. }) => Some((\n                         *modules.get(&module).unwrap(),\n                         RefData {\n                             chunking_type: COMMON_CHUNKING_TYPE,\n-                            export,\n+                            binding_usage,\n+                            reference: reference.unwrap(),\n                         },\n                     )),\n                     Some(SingleModuleGraphBuilderNode::ChunkableReference { .. }) => {\n@@ -404,17 +432,12 @@ impl SingleModuleGraph {\n         self.graph.node_references()\n     }\n \n-    pub fn read(self: &ReadRef<SingleModuleGraph>) -> ModuleGraphRef {\n-        ModuleGraphRef {\n-            graphs: vec![self.clone()],\n-            skip_visited_module_children: true,\n-        }\n-    }\n-\n     fn traverse_cycles<'l>(\n         &'l self,\n         edge_filter: impl Fn(&'l RefData) -> bool,\n         mut visit_cycle: impl FnMut(&[&'l ResolvedVc<Box<dyn Module>>]) -> Result<()>,\n+        graph_idx: u32,\n+        binding_usage: &'l Option<ReadRef<BindingUsageInfo>>,\n     ) -> Result<()> {\n         // see https://en.wikipedia.org/wiki/Tarjan%27s_strongly_connected_components_algorithm\n         // but iteratively instead of recursively\n@@ -454,6 +477,13 @@ impl SingleModuleGraph {\n                         visit_stack.push(VisitStep::AfterVisit(node));\n                         let mut neighbors = self.graph.neighbors(node).detach();\n                         while let Some((edge, succ)) = neighbors.next(&self.graph) {\n+                            if binding_usage.as_ref().is_some_and(|binding_usage| {\n+                                binding_usage\n+                                    .is_reference_unused_edge(&GraphEdgeIndex::new(graph_idx, edge))\n+                            }) {\n+                                continue;\n+                            }\n+\n                             let edge_weight = self.graph.edge_weight(edge).unwrap();\n                             if !edge_filter(edge_weight) {\n                                 continue;\n@@ -724,19 +754,26 @@ impl ImportTracer for ModuleGraphImportTracer {\n #[derive(Clone, Default)]\n pub struct ModuleGraph {\n     pub graphs: Vec<ResolvedVc<SingleModuleGraph>>,\n+\n+    pub binding_usage: Option<ResolvedVc<BindingUsageInfo>>,\n }\n \n #[turbo_tasks::value_impl]\n impl ModuleGraph {\n     #[turbo_tasks::function]\n     pub fn from_graphs(graphs: Vec<ResolvedVc<SingleModuleGraph>>) -> Vc<Self> {\n-        Self { graphs }.cell()\n+        Self {\n+            graphs,\n+            binding_usage: None,\n+        }\n+        .cell()\n     }\n \n     #[turbo_tasks::function]\n     pub fn from_single_graph(graph: ResolvedVc<SingleModuleGraph>) -> Vc<Self> {\n         Self {\n             graphs: vec![graph],\n+            binding_usage: None,\n         }\n         .cell()\n     }\n@@ -804,16 +841,13 @@ impl ModuleGraph {\n         module: ResolvedVc<Box<dyn Module>>,\n     ) -> Result<Vc<AsyncModuleInfo>> {\n         let graph_ref = self.read_graphs().await?;\n-        let graphs = &graph_ref.graphs;\n         let async_modules_info = self.async_module_info().await?;\n \n         let entry = graph_ref.get_entry(module)?;\n-        let referenced_modules = iter_graphs_neighbors_rev(graphs, entry)\n+        let referenced_modules = graph_ref\n+            .iter_graphs_neighbors_rev(entry)\n             .filter(|(edge_idx, _)| {\n-                let ty = graphs[entry.graph_idx()]\n-                    .graph\n-                    .edge_weight(*edge_idx)\n-                    .unwrap();\n+                let ty = graph_ref.get_edge(*edge_idx).unwrap();\n                 ty.chunking_type.is_inherit_async()\n             })\n             .map(|(_, child_idx)| anyhow::Ok(graph_ref.get_node(child_idx)?.module()))\n@@ -826,13 +860,76 @@ impl ModuleGraph {\n \n         Ok(AsyncModuleInfo::new(referenced_modules))\n     }\n+\n+    /// Analyze the module graph and remove unused references (by determining the used exports and\n+    /// removing unused imports).\n+    ///\n+    /// In particular, this removes ChunkableModuleReference-s that list only unused exports in the\n+    /// `import_usage()`\n+    #[turbo_tasks::function]\n+    pub async fn without_unused_references(\n+        self: ResolvedVc<Self>,\n+        binding_usage: ResolvedVc<BindingUsageInfo>,\n+    ) -> Result<Vc<Self>> {\n+        Ok(Self {\n+            graphs: self.await?.graphs.clone(),\n+            binding_usage: Some(binding_usage),\n+        }\n+        .cell())\n+    }\n }\n \n impl ModuleGraph {\n+    /// Reads the ModuleGraph into a ModuleGraphRef, awaiting all underlying graphs.\n     pub async fn read_graphs(self: Vc<ModuleGraph>) -> Result<ModuleGraphRef> {\n+        let this = self.await?;\n         Ok(ModuleGraphRef {\n-            graphs: self.await?.graphs.iter().try_join().await?,\n+            graphs: this.graphs.iter().try_join().await?,\n             skip_visited_module_children: false,\n+            graph_idx_override: None,\n+            binding_usage: if let Some(binding_usage) = this.binding_usage {\n+                Some(binding_usage.await?)\n+            } else {\n+                None\n+            },\n+        })\n+    }\n+\n+    /// Returns the underlying graphs as a list, to be used for individual graph traversals.\n+    pub fn iter_graphs(\n+        self: &ModuleGraph,\n+    ) -> impl Iterator<Item = SingleModuleGraphWithBindingUsage> {\n+        self.graphs\n+            .iter()\n+            .enumerate()\n+            .map(|(graph_idx, graph)| SingleModuleGraphWithBindingUsage {\n+                graph: *graph,\n+                graph_idx: graph_idx as u32,\n+                binding_usage: self.binding_usage,\n+            })\n+    }\n+}\n+\n+#[derive(\n+    Clone, Debug, PartialEq, Eq, Hash, Serialize, Deserialize, TaskInput, TraceRawVcs, NonLocalValue,\n+)]\n+pub struct SingleModuleGraphWithBindingUsage {\n+    pub graph: ResolvedVc<SingleModuleGraph>,\n+    pub graph_idx: u32,\n+    pub binding_usage: Option<ResolvedVc<BindingUsageInfo>>,\n+}\n+\n+impl SingleModuleGraphWithBindingUsage {\n+    pub async fn read(self: &SingleModuleGraphWithBindingUsage) -> Result<ModuleGraphRef> {\n+        Ok(ModuleGraphRef {\n+            graphs: vec![self.graph.await?],\n+            skip_visited_module_children: true,\n+            graph_idx_override: Some(self.graph_idx),\n+            binding_usage: if let Some(binding_usage) = &self.binding_usage {\n+                Some(binding_usage.await?)\n+            } else {\n+                None\n+            },\n         })\n     }\n }\n@@ -844,17 +941,25 @@ pub struct ModuleGraphRef {\n     // Whether to simply ignore SingleModuleGraphNode::VisitedModule during traversals. For single\n     // module graph usecases, this is what you want. For the whole graph, there should be an error.\n     skip_visited_module_children: bool,\n+\n+    pub graph_idx_override: Option<u32>,\n+\n+    pub binding_usage: Option<ReadRef<BindingUsageInfo>>,\n }\n \n impl ModuleGraphRef {\n     fn get_entry(&self, entry: ResolvedVc<Box<dyn Module>>) -> Result<GraphNodeIndex> {\n+        if self.graph_idx_override.is_some() {\n+            debug_assert_eq!(self.graphs.len(), 1,);\n+        }\n+\n         let Some(idx) = self\n             .graphs\n             .iter()\n             .enumerate()\n             .find_map(|(graph_idx, graph)| {\n                 graph.modules.get(&entry).map(|node_idx| GraphNodeIndex {\n-                    graph_idx: u32::try_from(graph_idx).unwrap(),\n+                    graph_idx: self.graph_idx_override.unwrap_or(graph_idx as u32),\n                     node_idx: *node_idx,\n                 })\n             })\n@@ -868,11 +973,27 @@ impl ModuleGraphRef {\n         self.graphs.iter().flat_map(|g| g.entries.iter().cloned())\n     }\n \n-    fn get_node(&self, entry: GraphNodeIndex) -> Result<&SingleModuleGraphNode> {\n-        let graph = &self.graphs[entry.graph_idx()];\n+    fn get_graph(&self, graph_idx: u32) -> &ReadRef<SingleModuleGraph> {\n+        if self.graph_idx_override.is_some() {\n+            self.graphs.first().unwrap()\n+        } else {\n+            &self.graphs[graph_idx as usize]\n+        }\n+    }\n+\n+    fn get_node(&self, node: GraphNodeIndex) -> Result<&SingleModuleGraphNode> {\n+        let graph = self.get_graph(node.graph_idx);\n         graph\n             .graph\n-            .node_weight(entry.node_idx)\n+            .node_weight(node.node_idx)\n+            .context(\"Expected graph node\")\n+    }\n+\n+    fn get_edge(&self, edge: GraphEdgeIndex) -> Result<&RefData> {\n+        let graph = self.get_graph(edge.graph_idx);\n+        graph\n+            .graph\n+            .edge_weight(edge.edge_idx)\n             .context(\"Expected graph node\")\n     }\n \n@@ -884,6 +1005,39 @@ impl ModuleGraphRef {\n         }\n     }\n \n+    /// Iterate the edges of a node REVERSED!\n+    fn iter_graphs_neighbors_rev<'a>(\n+        &'a self,\n+        node: GraphNodeIndex,\n+    ) -> impl Iterator<Item = (GraphEdgeIndex, GraphNodeIndex)> + 'a {\n+        let graph = &*self.get_graph(node.graph_idx).graph;\n+\n+        if cfg!(debug_assertions) {\n+            let node_weight = graph.node_weight(node.node_idx).unwrap();\n+            if let SingleModuleGraphNode::VisitedModule { .. } = node_weight {\n+                panic!(\"iter_graphs_neighbors_rev called on VisitedModule node\");\n+            }\n+        }\n+\n+        let mut walker = graph.neighbors(node.node_idx).detach();\n+        std::iter::from_fn(move || {\n+            while let Some((edge_idx, succ_idx)) = walker.next(graph) {\n+                let edge_idx = GraphEdgeIndex::new(node.graph_idx, edge_idx);\n+                if self\n+                    .binding_usage\n+                    .as_ref()\n+                    .is_some_and(|binding_usage| binding_usage.is_reference_unused_edge(&edge_idx))\n+                {\n+                    // Don't just return None here, that would end the iterator\n+                    continue;\n+                }\n+\n+                return Some((edge_idx, GraphNodeIndex::new(node.graph_idx, succ_idx)));\n+            }\n+            None\n+        })\n+    }\n+\n     /// Returns a map of all modules in the graphs to their identifiers.\n     /// This is primarily useful for debugging.\n     pub async fn get_ids(&self) -> Result<FxHashMap<ResolvedVc<Box<dyn Module>>, ReadRef<RcStr>>> {\n@@ -913,8 +1067,6 @@ impl ModuleGraphRef {\n         visit_preorder: impl Fn(ResolvedVc<Box<dyn Module>>, &mut S) -> Result<GraphTraversalAction>,\n         mut visit_postorder: impl FnMut(ResolvedVc<Box<dyn Module>>, &mut S) -> Result<()>,\n     ) -> Result<()> {\n-        let graphs = &self.graphs;\n-\n         let entries = entries.into_iter().collect::<Vec<_>>();\n \n         enum Pass {\n@@ -946,7 +1098,7 @@ impl ModuleGraphRef {\n                     {\n                         let current = current_node.target_idx().unwrap_or(current);\n                         stack.extend(\n-                            iter_graphs_neighbors_rev(graphs, current)\n+                            self.iter_graphs_neighbors_rev(current)\n                                 .map(|(_, child)| (Pass::ExpandAndVisit, child)),\n                         );\n                     }\n@@ -975,8 +1127,6 @@ impl ModuleGraphRef {\n             ResolvedVc<Box<dyn Module>>,\n         ) -> Result<GraphTraversalAction>,\n     ) -> Result<()> {\n-        let graphs = &self.graphs;\n-\n         let mut queue = VecDeque::from(\n             entries\n                 .into_iter()\n@@ -990,12 +1140,10 @@ impl ModuleGraphRef {\n         while let Some(node) = queue.pop_front() {\n             if visited.insert(node) {\n                 let node_weight = self.get_node(node)?;\n-                let graph = &graphs[node.graph_idx()].graph;\n-                for (edge, succ) in iter_graphs_neighbors_rev(graphs, node) {\n+                for (edge, succ) in self.iter_graphs_neighbors_rev(node) {\n                     let succ_weight = self.get_node(succ)?;\n-                    let edge_weight = graph.edge_weight(edge).unwrap();\n                     let action = visitor(\n-                        Some((node_weight.module(), edge_weight)),\n+                        Some((node_weight.module(), self.get_edge(edge)?)),\n                         succ_weight.module(),\n                     )?;\n                     if !self.should_visit_node(succ_weight) {\n@@ -1030,8 +1178,6 @@ impl ModuleGraphRef {\n             ResolvedVc<Box<dyn Module>>,\n         ) -> GraphTraversalAction,\n     ) -> Result<()> {\n-        let graphs = &self.graphs;\n-\n         let mut stack = entries\n             .into_iter()\n             .map(|e| self.get_entry(e))\n@@ -1043,12 +1189,10 @@ impl ModuleGraphRef {\n         while let Some(node) = stack.pop() {\n             if visited.insert(node) {\n                 let node_weight = self.get_node(node)?;\n-                let graph = &graphs[node.graph_idx()].graph;\n-                for (edge, succ) in iter_graphs_neighbors_rev(graphs, node) {\n+                for (edge, succ) in self.iter_graphs_neighbors_rev(node) {\n                     let succ_weight = self.get_node(succ)?;\n-                    let edge_weight = graph.edge_weight(edge).unwrap();\n                     let action = visitor(\n-                        Some((node_weight.module(), edge_weight)),\n+                        Some((node_weight.module(), self.get_edge(edge)?)),\n                         succ_weight.module(),\n                     );\n                     if !self.should_visit_node(succ_weight) {\n@@ -1076,19 +1220,21 @@ impl ModuleGraphRef {\n     pub fn traverse_all_edges_unordered(\n         &self,\n         mut visitor: impl FnMut(\n-            (ResolvedVc<Box<dyn Module>>, &'_ RefData),\n+            Option<(ResolvedVc<Box<dyn Module>>, &'_ RefData)>,\n             ResolvedVc<Box<dyn Module>>,\n         ) -> Result<()>,\n     ) -> Result<()> {\n-        for graph in &self.graphs {\n-            let graph = &graph.graph;\n-            for edge in graph.edge_references() {\n-                let source = graph.node_weight(edge.source()).unwrap().module();\n-                let target = graph.node_weight(edge.target()).unwrap().module();\n-                visitor((source, edge.weight()), target)?;\n-            }\n-        }\n-        Ok(())\n+        let entries = self.graphs.iter().flat_map(|g| g.entry_modules());\n+\n+        self.traverse_edges_from_entries_dfs(\n+            entries,\n+            &mut (),\n+            |parent, target, _| {\n+                visitor(parent, target)?;\n+                Ok(GraphTraversalAction::Continue)\n+            },\n+            |_, _, _| Ok(()),\n+        )\n     }\n \n     /// Traverses all reachable edges in dfs order. The preorder visitor can be used to\n@@ -1124,17 +1270,18 @@ impl ModuleGraphRef {\n             &mut S,\n         ) -> Result<()>,\n     ) -> Result<()> {\n-        let graphs = &self.graphs;\n-\n         let entries = entries.into_iter().collect::<Vec<_>>();\n \n         enum Pass {\n             Visit,\n             ExpandAndVisit,\n         }\n         #[allow(clippy::type_complexity)] // This is a temporary internal structure\n-        let mut stack: Vec<(Pass, Option<(GraphNodeIndex, EdgeIndex)>, GraphNodeIndex)> =\n-            Vec::with_capacity(entries.len());\n+        let mut stack: Vec<(\n+            Pass,\n+            Option<(GraphNodeIndex, GraphEdgeIndex)>,\n+            GraphNodeIndex,\n+        )> = Vec::with_capacity(entries.len());\n         for entry in entries.into_iter().rev() {\n             stack.push((Pass::ExpandAndVisit, None, self.get_entry(entry)?));\n         }\n@@ -1143,10 +1290,7 @@ impl ModuleGraphRef {\n             let parent_arg = match parent {\n                 Some((parent_node, parent_edge)) => Some((\n                     self.get_node(parent_node)?.module(),\n-                    graphs[parent_node.graph_idx()]\n-                        .graph\n-                        .edge_weight(parent_edge)\n-                        .unwrap(),\n+                    self.get_edge(parent_edge)?,\n                 )),\n                 None => None,\n             };\n@@ -1166,7 +1310,7 @@ impl ModuleGraphRef {\n                         && self.should_visit_node(current_node)\n                     {\n                         let current = current_node.target_idx().unwrap_or(current);\n-                        stack.extend(iter_graphs_neighbors_rev(graphs, current).map(\n+                        stack.extend(self.iter_graphs_neighbors_rev(current).map(\n                             |(edge, child)| (Pass::ExpandAndVisit, Some((current, edge)), child),\n                         ));\n                     }\n@@ -1184,8 +1328,13 @@ impl ModuleGraphRef {\n         edge_filter: impl Fn(&RefData) -> bool,\n         mut visit_cycle: impl FnMut(&[&ResolvedVc<Box<dyn Module>>]) -> Result<()>,\n     ) -> Result<()> {\n-        for graph in &self.graphs {\n-            graph.traverse_cycles(&edge_filter, &mut visit_cycle)?;\n+        for (graph_idx, graph) in self.graphs.iter().enumerate() {\n+            graph.traverse_cycles(\n+                &edge_filter,\n+                &mut visit_cycle,\n+                graph_idx as u32,\n+                &self.binding_usage,\n+            )?;\n         }\n         Ok(())\n     }\n@@ -1216,13 +1365,12 @@ impl ModuleGraphRef {\n         entries: impl IntoIterator<Item = (ResolvedVc<Box<dyn Module>>, P)>,\n         state: &mut S,\n         mut visit: impl FnMut(\n-            Option<(ResolvedVc<Box<dyn Module>>, &'_ RefData)>,\n+            Option<(ResolvedVc<Box<dyn Module>>, &'_ RefData, GraphEdgeIndex)>,\n             ResolvedVc<Box<dyn Module>>,\n             &mut S,\n         ) -> Result<GraphTraversalAction>,\n         priority: impl Fn(ResolvedVc<Box<dyn Module>>, &mut S) -> Result<P>,\n     ) -> Result<usize> {\n-        let graphs = &self.graphs;\n         if self.skip_visited_module_children {\n             panic!(\n                 \"traverse_edges_fixed_point_with_priority musn't be called on individual graphs\"\n@@ -1275,13 +1423,11 @@ impl ModuleGraphRef {\n \n             visit_count += 1;\n \n-            let graph = &graphs[node.graph_idx()].graph;\n-            for (edge, succ) in iter_graphs_neighbors_rev(graphs, node) {\n+            for (edge, succ) in self.iter_graphs_neighbors_rev(node) {\n                 let succ_weight = self.get_node(succ)?;\n \n-                let edge_weight = graph.edge_weight(edge).unwrap();\n                 let action = visit(\n-                    Some((node_weight.module(), edge_weight)),\n+                    Some((node_weight.module(), self.get_edge(edge)?, edge)),\n                     succ_weight.module(),\n                     state,\n                 )?;\n@@ -1300,34 +1446,6 @@ impl ModuleGraphRef {\n     }\n }\n \n-/// Iterate the edges of a node REVERSED!\n-fn iter_graphs_neighbors_rev(\n-    graphs: &[ReadRef<SingleModuleGraph>],\n-    node: GraphNodeIndex,\n-) -> impl Iterator<Item = (EdgeIndex, GraphNodeIndex)> + '_ {\n-    let graph = &*graphs[node.graph_idx()].graph;\n-\n-    if cfg!(debug_assertions) {\n-        let node_weight = graph.node_weight(node.node_idx).unwrap();\n-        if let SingleModuleGraphNode::VisitedModule { .. } = node_weight {\n-            panic!(\"iter_graphs_neighbors_rev called on VisitedModule node\");\n-        }\n-    }\n-\n-    let mut walker = graph.neighbors(node.node_idx).detach();\n-    std::iter::from_fn(move || {\n-        walker.next(graph).map(|(edge_idx, succ_idx)| {\n-            (\n-                edge_idx,\n-                GraphNodeIndex {\n-                    graph_idx: node.graph_idx,\n-                    node_idx: succ_idx,\n-                },\n-            )\n-        })\n-    })\n-}\n-\n #[turbo_tasks::value_impl]\n impl SingleModuleGraph {\n     #[turbo_tasks::function]\n@@ -1468,7 +1586,8 @@ impl SingleModuleGraphBuilderNode {\n }\n struct SingleModuleGraphBuilderEdge {\n     to: SingleModuleGraphBuilderNode,\n-    export: ExportUsage,\n+    binding_usage: BindingUsage,\n+    reference: Option<ResolvedVc<Box<dyn ModuleReference>>>,\n }\n \n /// The chunking type that occurs most often, is handled more efficiently by not creating\n@@ -1486,28 +1605,40 @@ struct SingleModuleGraphBuilder<'a> {\n     /// Whether to walk ChunkingType::Traced references\n     include_traced: bool,\n }\n-impl Visit<(SingleModuleGraphBuilderNode, ExportUsage)> for SingleModuleGraphBuilder<'_> {\n+impl\n+    Visit<(\n+        SingleModuleGraphBuilderNode,\n+        Option<ResolvedVc<Box<dyn ModuleReference>>>,\n+        BindingUsage,\n+    )> for SingleModuleGraphBuilder<'_>\n+{\n     type Edge = SingleModuleGraphBuilderEdge;\n     type EdgesIntoIter = Vec<Self::Edge>;\n     type EdgesFuture = impl Future<Output = Result<Self::EdgesIntoIter>>;\n \n     fn visit(\n         &mut self,\n         edge: Self::Edge,\n-    ) -> VisitControlFlow<(SingleModuleGraphBuilderNode, ExportUsage)> {\n+    ) -> VisitControlFlow<(\n+        SingleModuleGraphBuilderNode,\n+        Option<ResolvedVc<Box<dyn ModuleReference>>>,\n+        BindingUsage,\n+    )> {\n         match edge.to {\n             SingleModuleGraphBuilderNode::Module { .. } => {\n-                VisitControlFlow::Continue((edge.to, edge.export))\n+                VisitControlFlow::Continue((edge.to, edge.reference, edge.binding_usage))\n             }\n             SingleModuleGraphBuilderNode::ChunkableReference { ref ref_data, .. } => {\n                 match &ref_data.chunking_type {\n-                    ChunkingType::Traced => VisitControlFlow::Skip((edge.to, edge.export)),\n-                    _ => VisitControlFlow::Continue((edge.to, edge.export)),\n+                    ChunkingType::Traced => {\n+                        VisitControlFlow::Skip((edge.to, edge.reference, edge.binding_usage))\n+                    }\n+                    _ => VisitControlFlow::Continue((edge.to, edge.reference, edge.binding_usage)),\n                 }\n             }\n             // Module was already visited previously\n             SingleModuleGraphBuilderNode::VisitedModule { .. } => {\n-                VisitControlFlow::Skip((edge.to, edge.export))\n+                VisitControlFlow::Skip((edge.to, edge.reference, edge.binding_usage))\n             }\n         }\n     }\n@@ -1516,14 +1647,21 @@ impl Visit<(SingleModuleGraphBuilderNode, ExportUsage)> for SingleModuleGraphBui\n         &mut self,\n         // The `skip_duplicates_with_key()` above ensures only a single `edges()` call per module\n         // (and not per `(module, export)` pair), so the export must not be read here!\n-        (node, _): &(SingleModuleGraphBuilderNode, ExportUsage),\n+        (node, ..): &(\n+            SingleModuleGraphBuilderNode,\n+            Option<ResolvedVc<Box<dyn ModuleReference>>>,\n+            BindingUsage,\n+        ),\n     ) -> Self::EdgesFuture {\n         // Destructure beforehand to not have to clone the whole node when entering the async block\n         let (module, chunkable_ref_target) = match node {\n             SingleModuleGraphBuilderNode::Module { module, .. } => (Some(*module), None),\n             SingleModuleGraphBuilderNode::ChunkableReference {\n                 target, ref_data, ..\n-            } => (None, Some((*target, ref_data.export.clone()))),\n+            } => (\n+                None,\n+                Some((*target, ref_data.reference, ref_data.binding_usage.clone())),\n+            ),\n             // These are always skipped in `visit()`\n             SingleModuleGraphBuilderNode::VisitedModule { .. } => unreachable!(),\n         };\n@@ -1542,10 +1680,17 @@ impl Visit<(SingleModuleGraphBuilderNode, ExportUsage)> for SingleModuleGraphBui\n                     };\n \n                     refs.iter()\n-                        .flat_map(|(ty, export, modules)| {\n-                            modules.iter().map(|m| (ty.clone(), export.clone(), *m))\n+                        .flat_map(|(reference, resolved)| {\n+                            resolved.modules.iter().map(|m| {\n+                                (\n+                                    *reference,\n+                                    resolved.chunking_type.clone(),\n+                                    resolved.binding_usage.clone(),\n+                                    *m,\n+                                )\n+                            })\n                         })\n-                        .map(async |(ty, export, target)| {\n+                        .map(async |(reference, ty, binding_usage, target)| {\n                             let to = if ty == COMMON_CHUNKING_TYPE {\n                                 if let Some(idx) = visited_modules.get(&target) {\n                                     SingleModuleGraphBuilderNode::new_visited_module(target, *idx)\n@@ -1560,17 +1705,22 @@ impl Visit<(SingleModuleGraphBuilderNode, ExportUsage)> for SingleModuleGraphBui\n                                     target,\n                                     RefData {\n                                         chunking_type: ty,\n-                                        export: export.clone(),\n+                                        binding_usage: binding_usage.clone(),\n+                                        reference,\n                                     },\n                                 )\n                                 .await?\n                             };\n-                            Ok(SingleModuleGraphBuilderEdge { to, export })\n+                            Ok(SingleModuleGraphBuilderEdge {\n+                                to,\n+                                binding_usage,\n+                                reference: Some(reference),\n+                            })\n                         })\n                         .try_join()\n                         .await?\n                 }\n-                (None, Some((chunkable_ref_target, export))) => {\n+                (None, Some((chunkable_ref_target, reference, binding_usage))) => {\n                     vec![SingleModuleGraphBuilderEdge {\n                         to: if let Some(idx) = visited_modules.get(&chunkable_ref_target) {\n                             SingleModuleGraphBuilderNode::new_visited_module(\n@@ -1584,15 +1734,23 @@ impl Visit<(SingleModuleGraphBuilderNode, ExportUsage)> for SingleModuleGraphBui\n                             )\n                             .await?\n                         },\n-                        export,\n+                        binding_usage,\n+                        reference: Some(reference),\n                     }]\n                 }\n                 _ => unreachable!(),\n             })\n         }\n     }\n \n-    fn span(&mut self, (node, _): &(SingleModuleGraphBuilderNode, ExportUsage)) -> tracing::Span {\n+    fn span(\n+        &mut self,\n+        (node, ..): &(\n+            SingleModuleGraphBuilderNode,\n+            Option<ResolvedVc<Box<dyn ModuleReference>>>,\n+            BindingUsage,\n+        ),\n+    ) -> tracing::Span {\n         if !self.emit_spans {\n             return Span::current();\n         }\n@@ -1790,7 +1948,7 @@ pub mod tests {\n                     &mut (),\n                     |parent, target, _| {\n                         visits.push((\n-                            parent.map(|(node, _)| module_to_name.get(&node).unwrap().clone()),\n+                            parent.map(|(node, _, _)| module_to_name.get(&node).unwrap().clone()),\n                             module_to_name.get(&target).unwrap().clone(),\n                         ));\n                         count += 1;"
        },
        {
            "sha": "1d800250ff2d4f65217721670312133a744b6fbe",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/module_batches.rs",
            "status": "modified",
            "additions": 22,
            "deletions": 20,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batches.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batches.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fmodule_batches.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -350,28 +350,30 @@ pub async fn compute_module_batches(\n \n         // Walk the module graph and mark all modules that are boundary modules (referenced from a\n         // different chunk group bitmap)\n-        module_graph.traverse_all_edges_unordered(|(parent, ty), node| {\n-            let std::collections::hash_set::Entry::Vacant(entry) =\n-                pre_batches.boundary_modules.entry(node)\n-            else {\n-                // Already a boundary module, can skip check\n-                return Ok(());\n-            };\n-            if ty.chunking_type.is_parallel() {\n-                let parent_chunk_groups = chunk_group_info\n-                    .module_chunk_groups\n-                    .get(&parent)\n-                    .context(\"all modules need to have chunk group info\")?;\n-                let chunk_groups = chunk_group_info\n-                    .module_chunk_groups\n-                    .get(&node)\n-                    .context(\"all modules need to have chunk group info\")?;\n-                if parent_chunk_groups != chunk_groups {\n-                    // This is a boundary module\n+        module_graph.traverse_all_edges_unordered(|parent, node| {\n+            if let Some((parent, ty)) = parent {\n+                let std::collections::hash_set::Entry::Vacant(entry) =\n+                    pre_batches.boundary_modules.entry(node)\n+                else {\n+                    // Already a boundary module, can skip check\n+                    return Ok(());\n+                };\n+                if ty.chunking_type.is_parallel() {\n+                    let parent_chunk_groups = chunk_group_info\n+                        .module_chunk_groups\n+                        .get(&parent)\n+                        .context(\"all modules need to have chunk group info\")?;\n+                    let chunk_groups = chunk_group_info\n+                        .module_chunk_groups\n+                        .get(&node)\n+                        .context(\"all modules need to have chunk group info\")?;\n+                    if parent_chunk_groups != chunk_groups {\n+                        // This is a boundary module\n+                        entry.insert();\n+                    }\n+                } else {\n                     entry.insert();\n                 }\n-            } else {\n-                entry.insert();\n             }\n             Ok(())\n         })?;"
        },
        {
            "sha": "f34b32bbc571fbbff874c75053ba364562a369ba",
            "filename": "turbopack/crates/turbopack-core/src/reference/mod.rs",
            "status": "modified",
            "additions": 30,
            "deletions": 8,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Freference%2Fmod.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -1,9 +1,11 @@\n use std::collections::HashSet;\n \n use anyhow::Result;\n+use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n use turbo_tasks::{\n-    FxIndexSet, ReadRef, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt, ValueToString, Vc,\n+    FxIndexSet, NonLocalValue, ReadRef, ResolvedVc, TryFlatJoinIterExt, TryJoinIterExt,\n+    ValueToString, Vc, debug::ValueDebugFormat, trace::TraceRawVcs,\n };\n \n use crate::{\n@@ -14,7 +16,7 @@ use crate::{\n         expand_output_assets,\n     },\n     raw_module::RawModule,\n-    resolve::{ExportUsage, ModuleResolveResult, RequestKey},\n+    resolve::{BindingUsage, ExportUsage, ImportUsage, ModuleResolveResult, RequestKey},\n };\n pub mod source_map;\n \n@@ -121,8 +123,12 @@ impl ChunkableModuleReference for SingleChunkableModuleReference {\n     }\n \n     #[turbo_tasks::function]\n-    fn export_usage(&self) -> Vc<ExportUsage> {\n-        *self.export\n+    async fn binding_usage(&self) -> Result<Vc<BindingUsage>> {\n+        Ok(BindingUsage {\n+            import: ImportUsage::SideEffects,\n+            export: self.export.owned().await?,\n+        }\n+        .cell())\n     }\n }\n \n@@ -287,8 +293,17 @@ pub async fn primary_referenced_modules(module: Vc<Box<dyn Module>>) -> Result<V\n     Ok(Vc::cell(modules))\n }\n \n+#[derive(\n+    Clone, Serialize, Deserialize, Eq, PartialEq, ValueDebugFormat, TraceRawVcs, NonLocalValue,\n+)]\n+pub struct ResolvedReference {\n+    pub chunking_type: ChunkingType,\n+    pub binding_usage: BindingUsage,\n+    pub modules: ReadRef<Modules>,\n+}\n+\n #[turbo_tasks::value(transparent)]\n-pub struct ModulesWithRefData(Vec<(ChunkingType, ExportUsage, ReadRef<Modules>)>);\n+pub struct ModulesWithRefData(Vec<(ResolvedVc<Box<dyn ModuleReference>>, ResolvedReference)>);\n \n /// Aggregates all primary [Module]s referenced by an [Module] via [ChunkableModuleReference]s.\n /// This does not include transitively referenced [Module]s, only includes\n@@ -319,9 +334,16 @@ pub async fn primary_chunkable_referenced_modules(\n                     .await?\n                     .primary_modules()\n                     .await?;\n-                let export = reference.export_usage().owned().await?;\n-\n-                return Ok(Some((chunking_type.clone(), export, resolved)));\n+                let binding_usage = reference.binding_usage().owned().await?;\n+\n+                return Ok(Some((\n+                    ResolvedVc::upcast(reference),\n+                    ResolvedReference {\n+                        chunking_type: chunking_type.clone(),\n+                        binding_usage,\n+                        modules: resolved,\n+                    },\n+                )));\n             }\n             Ok(None)\n         })"
        },
        {
            "sha": "6f51f720cc839e2c50056c3fd28d6eb86694ab87",
            "filename": "turbopack/crates/turbopack-core/src/resolve/mod.rs",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -7,6 +7,7 @@ use std::{\n };\n \n use anyhow::{Result, bail};\n+use auto_hash_map::AutoSet;\n use rustc_hash::{FxHashMap, FxHashSet};\n use serde::{Deserialize, Serialize};\n use tracing::{Instrument, Level};\n@@ -103,6 +104,35 @@ impl ModuleResolveResultItem {\n     }\n }\n \n+#[turbo_tasks::value(shared)]\n+#[derive(Clone, Debug, Hash, Default)]\n+pub struct BindingUsage {\n+    pub import: ImportUsage,\n+    pub export: ExportUsage,\n+}\n+\n+#[turbo_tasks::value_impl]\n+impl BindingUsage {\n+    #[turbo_tasks::function]\n+    pub fn all() -> Vc<Self> {\n+        Self::default().cell()\n+    }\n+}\n+\n+#[turbo_tasks::value(shared)]\n+#[derive(Debug, Clone, Default, Hash)]\n+pub enum ImportUsage {\n+    /// This import is used by some side effect in the module (and can't be tree shaken).\n+    #[default]\n+    SideEffects,\n+    /// This import is used only by these specific exports, if all exports are unused, the import\n+    /// can also be removed.\n+    ///\n+    /// (This is only ever set on `ModulePart::Export` references. Side effects are handled via\n+    /// `ModulePart::Evaluation` references, which always have `ImportUsage::SideEffects`.)\n+    Exports(AutoSet<RcStr>),\n+}\n+\n #[turbo_tasks::value]\n #[derive(Debug, Clone, Default, Hash)]\n pub enum ExportUsage {"
        },
        {
            "sha": "192e86d66bf660cc213cbf7242bf9679bb7b0129",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/graph.rs",
            "status": "modified",
            "additions": 145,
            "deletions": 15,
            "changes": 160,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fgraph.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -31,7 +31,7 @@ use super::{\n use crate::{\n     AnalyzeMode, SpecifiedModuleType,\n     analyzer::{WellKnownObjectKind, is_unresolved},\n-    references::constant_value::parse_single_expr_lit,\n+    references::{constant_value::parse_single_expr_lit, for_each_ident_in_pat},\n     utils::{AstPathRange, unparen},\n };\n \n@@ -307,6 +307,30 @@ impl VarMeta {\n     }\n }\n \n+#[derive(Clone, Debug)]\n+pub enum DeclUsage {\n+    SideEffects,\n+    Bindings(FxHashSet<Id>),\n+}\n+impl Default for DeclUsage {\n+    fn default() -> Self {\n+        DeclUsage::Bindings(Default::default())\n+    }\n+}\n+impl DeclUsage {\n+    fn add_usage(&mut self, user: &Id) {\n+        match self {\n+            Self::Bindings(set) => {\n+                set.insert(user.clone());\n+            }\n+            Self::SideEffects => {}\n+        }\n+    }\n+    fn make_side_effects(&mut self) {\n+        *self = Self::SideEffects;\n+    }\n+}\n+\n #[derive(Debug)]\n pub struct VarGraph {\n     pub values: FxHashMap<Id, VarMeta>,\n@@ -315,6 +339,13 @@ pub struct VarGraph {\n     pub free_var_ids: FxHashMap<Atom, Id>,\n \n     pub effects: Vec<Effect>,\n+\n+    // ident -> immediate usage (top level decl)\n+    pub decl_usages: FxHashMap<Id, DeclUsage>,\n+    // import -> immediate usage (top level decl)\n+    pub import_usages: FxHashMap<usize, DeclUsage>,\n+    // export name -> top level decl\n+    pub exports: FxHashMap<Atom, Id>,\n }\n \n impl VarGraph {\n@@ -339,14 +370,17 @@ pub fn create_graph(\n         values: Default::default(),\n         free_var_ids: Default::default(),\n         effects: Default::default(),\n+        decl_usages: Default::default(),\n+        import_usages: Default::default(),\n+        exports: Default::default(),\n     };\n \n     m.visit_with_ast_path(\n         &mut Analyzer {\n             analyze_mode,\n             data: &mut graph,\n-            state: analyzer_state::AnalyzerState::new(),\n             eval_context,\n+            state: Default::default(),\n             effects: Default::default(),\n             hoisted_effects: Default::default(),\n         },\n@@ -873,9 +907,9 @@ struct Analyzer<'a> {\n     state: analyzer_state::AnalyzerState,\n \n     effects: Vec<Effect>,\n-    // Effects collected from hoisted declarations. See https://developer.mozilla.org/en-US/docs/Glossary/Hoisting\n-    // Tracked separately so we can preserve effects from hoisted declarations even when we don't\n-    // collect effects from the declaring context.\n+    /// Effects collected from hoisted declarations. See https://developer.mozilla.org/en-US/docs/Glossary/Hoisting\n+    /// Tracked separately so we can preserve effects from hoisted declarations even when we don't\n+    /// collect effects from the declaring context.\n     hoisted_effects: Vec<Effect>,\n \n     eval_context: &'a EvalContext,\n@@ -956,6 +990,7 @@ mod analyzer_state {\n \n     /// Contains fields of `Analyzer` that should only be modified using helper methods. These are\n     /// intentionally private to the rest of the `Analyzer` implementation.\n+    #[derive(Default)]\n     pub struct AnalyzerState {\n         pat_value: Option<JsValue>,\n         /// Return values of the current function.\n@@ -967,17 +1002,14 @@ mod analyzer_state {\n         early_return_stack: Vec<EarlyReturn>,\n         lexical_stack: Vec<LexicalContext>,\n         var_decl_kind: Option<VarDeclKind>,\n+\n+        cur_top_level_decl_name: Option<Id>,\n     }\n \n     impl AnalyzerState {\n-        pub fn new() -> AnalyzerState {\n-            AnalyzerState {\n-                pat_value: None,\n-                cur_fn_return_values: None,\n-                early_return_stack: Default::default(),\n-                lexical_stack: Default::default(),\n-                var_decl_kind: None,\n-            }\n+        /// Returns the identifier of the current top level declaration.\n+        pub(super) fn cur_top_level_decl_name(&self) -> &Option<Id> {\n+            &self.cur_top_level_decl_name\n         }\n     }\n \n@@ -1273,6 +1305,23 @@ mod analyzer_state {\n             }\n             always_returns\n         }\n+\n+        /// Runs `visitor` with the current top level declaration identifier\n+        pub(super) fn enter_top_level_decl<T>(\n+            &mut self,\n+            name: &Ident,\n+            visitor: impl FnOnce(&mut Self) -> T,\n+        ) -> T {\n+            let is_top_level_fn = self.state.cur_top_level_decl_name.is_none();\n+            if is_top_level_fn {\n+                self.state.cur_top_level_decl_name = Some(name.to_id());\n+            }\n+            let result = visitor(self);\n+            if is_top_level_fn {\n+                self.state.cur_top_level_decl_name = None;\n+            }\n+            result\n+        }\n     }\n }\n \n@@ -1909,9 +1958,12 @@ impl VisitAstPath for Analyzer<'_> {\n         decl: &'ast FnDecl,\n         ast_path: &mut AstNodePath<AstParentNodeRef<'r>>,\n     ) {\n-        let fn_value = self.enter_fn(&*decl.function, |this| {\n-            decl.visit_children_with_ast_path(this, ast_path);\n+        let fn_value = self.enter_top_level_decl(&decl.ident, |this| {\n+            this.enter_fn(&*decl.function, |this| {\n+                decl.visit_children_with_ast_path(this, ast_path);\n+            })\n         });\n+\n         // Take all effects produced by the function and move them to hoisted effects since\n         // function declarations are hoisted.\n         // This accounts for the fact that even with `if (true) { return f} function f() {} ` `f` is\n@@ -2386,6 +2438,17 @@ impl VisitAstPath for Analyzer<'_> {\n         if let Some((esm_reference_index, export)) =\n             self.eval_context.imports.get_binding(&ident.to_id())\n         {\n+            let usage = self\n+                .data\n+                .import_usages\n+                .entry(esm_reference_index)\n+                .or_default();\n+            if let Some(top_level) = self.state.cur_top_level_decl_name() {\n+                usage.add_usage(top_level);\n+            } else {\n+                usage.make_side_effects();\n+            }\n+\n             // Optimization: Look for a MemberExpr to see if we only access a few members from the\n             // module, add those specific effects instead of depending on the entire module.\n             //\n@@ -2432,6 +2495,24 @@ impl VisitAstPath for Analyzer<'_> {\n                 span: ident.span(),\n             })\n         }\n+\n+        if !is_unresolved(ident, self.eval_context.unresolved_mark) {\n+            if let Some(top_level) = self.state.cur_top_level_decl_name() {\n+                if !(ident.sym == top_level.0 && ident.ctxt == top_level.1) {\n+                    self.data\n+                        .decl_usages\n+                        .entry(ident.to_id())\n+                        .or_default()\n+                        .add_usage(top_level);\n+                }\n+            } else {\n+                self.data\n+                    .decl_usages\n+                    .entry(ident.to_id())\n+                    .or_default()\n+                    .make_side_effects();\n+            }\n+        }\n     }\n \n     fn visit_this_expr<'ast: 'r, 'r>(\n@@ -2728,6 +2809,55 @@ impl VisitAstPath for Analyzer<'_> {\n \n         self.effects = prev_effects;\n     }\n+\n+    fn visit_export_decl<'ast: 'r, 'r>(\n+        &mut self,\n+        node: &'ast ExportDecl,\n+        ast_path: &mut swc_core::ecma::visit::AstNodePath<'r>,\n+    ) {\n+        match &node.decl {\n+            Decl::Class(node) => {\n+                self.data\n+                    .exports\n+                    .insert(node.ident.sym.clone(), node.ident.to_id());\n+            }\n+            Decl::Fn(node) => {\n+                self.data\n+                    .exports\n+                    .insert(node.ident.sym.clone(), node.ident.to_id());\n+            }\n+            Decl::Var(node) => {\n+                for VarDeclarator { name, .. } in &node.decls {\n+                    for_each_ident_in_pat(name, &mut |name, ctxt| {\n+                        self.data.exports.insert(name.clone(), (name.clone(), ctxt));\n+                    });\n+                }\n+            }\n+            _ => {}\n+        };\n+        node.visit_children_with_ast_path(self, ast_path);\n+    }\n+\n+    fn visit_export_named_specifier<'ast: 'r, 'r>(\n+        &mut self,\n+        node: &'ast ExportNamedSpecifier,\n+        ast_path: &mut swc_core::ecma::visit::AstNodePath<'r>,\n+    ) {\n+        let export_name = node\n+            .exported\n+            .as_ref()\n+            .unwrap_or(&node.orig)\n+            .atom()\n+            .into_owned();\n+        self.data.exports.insert(\n+            export_name,\n+            match &node.orig {\n+                ModuleExportName::Ident(ident) => ident.to_id(),\n+                ModuleExportName::Str(_) => unreachable!(\"exporting a string should be impossible\"),\n+            },\n+        );\n+        node.visit_children_with_ast_path(self, ast_path);\n+    }\n }\n \n impl Analyzer<'_> {"
        },
        {
            "sha": "366d6fc841cba90d163432f34e49666ad2a0fae2",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/base.rs",
            "status": "modified",
            "additions": 25,
            "deletions": 9,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fbase.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -23,12 +23,12 @@ use turbopack_core::{\n         OptionStyledString, StyledString,\n     },\n     module::Module,\n-    module_graph::export_usage::ModuleExportUsageInfo,\n+    module_graph::binding_usage_info::ModuleExportUsageInfo,\n     reference::ModuleReference,\n     reference_type::{EcmaScriptModulesReferenceSubType, ImportWithType},\n     resolve::{\n-        ExportUsage, ExternalType, ModulePart, ModuleResolveResult, ModuleResolveResultItem,\n-        RequestKey,\n+        BindingUsage, ExportUsage, ExternalType, ImportUsage, ModulePart, ModuleResolveResult,\n+        ModuleResolveResultItem, RequestKey,\n         origin::{ResolveOrigin, ResolveOriginExt},\n         parse::Request,\n     },\n@@ -325,6 +325,7 @@ pub struct EsmAssetReference {\n     pub annotations: ImportAnnotations,\n     pub issue_source: IssueSource,\n     pub export_name: Option<ModulePart>,\n+    pub import_usage: ImportUsage,\n     pub import_externals: bool,\n     pub is_pure_import: bool,\n }\n@@ -346,6 +347,7 @@ impl EsmAssetReference {\n         issue_source: IssueSource,\n         annotations: ImportAnnotations,\n         export_name: Option<ModulePart>,\n+        import_usage: ImportUsage,\n         import_externals: bool,\n     ) -> Self {\n         EsmAssetReference {\n@@ -354,6 +356,7 @@ impl EsmAssetReference {\n             issue_source,\n             annotations,\n             export_name,\n+            import_usage,\n             import_externals,\n             is_pure_import: false,\n         }\n@@ -365,6 +368,7 @@ impl EsmAssetReference {\n         issue_source: IssueSource,\n         annotations: ImportAnnotations,\n         export_name: Option<ModulePart>,\n+        import_usage: ImportUsage,\n         import_externals: bool,\n     ) -> Self {\n         EsmAssetReference {\n@@ -373,6 +377,7 @@ impl EsmAssetReference {\n             issue_source,\n             annotations,\n             export_name,\n+            import_usage,\n             import_externals,\n             is_pure_import: true,\n         }\n@@ -512,12 +517,16 @@ impl ChunkableModuleReference for EsmAssetReference {\n     }\n \n     #[turbo_tasks::function]\n-    fn export_usage(&self) -> Vc<ExportUsage> {\n-        match &self.export_name {\n-            Some(ModulePart::Export(export_name)) => ExportUsage::named(export_name.clone()),\n-            Some(ModulePart::Evaluation) => ExportUsage::evaluation(),\n-            _ => ExportUsage::all(),\n+    fn binding_usage(&self) -> Vc<BindingUsage> {\n+        BindingUsage {\n+            import: self.import_usage.clone(),\n+            export: match &self.export_name {\n+                Some(ModulePart::Export(export_name)) => ExportUsage::Named(export_name.clone()),\n+                Some(ModulePart::Evaluation) => ExportUsage::Evaluation,\n+                _ => ExportUsage::All,\n+            },\n         }\n+        .cell()\n     }\n }\n \n@@ -529,6 +538,13 @@ impl EsmAssetReference {\n     ) -> Result<CodeGeneration> {\n         let this = &*self.await?;\n \n+        if *chunking_context\n+            .is_reference_unused(Vc::upcast(self))\n+            .await?\n+        {\n+            return Ok(CodeGeneration::empty());\n+        }\n+\n         // only chunked references can be imported\n         if this.annotations.chunking_type().is_none_or(|v| v != \"none\") {\n             let import_externals = this.import_externals;\n@@ -571,7 +587,7 @@ impl EsmAssetReference {\n                     }\n \n                     if merged_index.is_some()\n-                        && matches!(*self.export_usage().await?, ExportUsage::Evaluation)\n+                        && matches!(this.export_name, Some(ModulePart::Evaluation))\n                     {\n                         // No need to import, the module was already executed and is available in\n                         // the same scope hoisting group (unless it's a"
        },
        {
            "sha": "c6ab7c90375ed24a6485a9cc6e942c48d202a074",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/esm/export.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fesm%2Fexport.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -21,7 +21,7 @@ use turbopack_core::{\n     ident::AssetIdent,\n     issue::{IssueExt, IssueSeverity, StyledString, analyze::AnalyzeIssue},\n     module::Module,\n-    module_graph::export_usage::ModuleExportUsageInfo,\n+    module_graph::binding_usage_info::ModuleExportUsageInfo,\n     reference::ModuleReference,\n     resolve::ModulePart,\n };"
        },
        {
            "sha": "a9825d231375af583d5ba248852fbdb15e7e69c3",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/mod.rs",
            "status": "modified",
            "additions": 62,
            "deletions": 8,
            "changes": 70,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -42,7 +42,7 @@ use serde::{Deserialize, Serialize};\n use swc_core::{\n     atoms::{Atom, Wtf8Atom, atom},\n     common::{\n-        GLOBALS, Globals, Span, Spanned,\n+        GLOBALS, Globals, Span, Spanned, SyntaxContext,\n         comments::{CommentKind, Comments},\n         errors::{DiagnosticId, HANDLER, Handler},\n         pass::AstNodePath,\n@@ -79,7 +79,7 @@ use turbopack_core::{\n     reference::{ModuleReference, ModuleReferences},\n     reference_type::{CommonJsReferenceSubType, ReferenceType},\n     resolve::{\n-        FindContextFileResult, ModulePart, find_context_file,\n+        FindContextFileResult, ImportUsage, ModulePart, find_context_file,\n         origin::{PlainResolveOrigin, ResolveOrigin, ResolveOriginExt},\n         parse::Request,\n         pattern::Pattern,\n@@ -134,7 +134,7 @@ use crate::{\n     analyzer::{\n         ConstantNumber, ConstantString, JsValueUrlKind, RequireContextValue,\n         builtin::early_replace_builtin,\n-        graph::{ConditionalKind, EffectArg, EvalContext, VarGraph},\n+        graph::{ConditionalKind, DeclUsage, EffectArg, EvalContext, VarGraph},\n         imports::{ImportAnnotations, ImportAttributes, ImportedSymbol, Reexport},\n         parse_require_context,\n         top_level_await::has_top_level_await,\n@@ -745,6 +745,51 @@ async fn analyze_ecmascript_module_internal(\n         })\n     };\n \n+    let mut import_usage =\n+        FxHashMap::with_capacity_and_hasher(var_graph.import_usages.len(), Default::default());\n+    for (reference, usage) in &var_graph.import_usages {\n+        // TODO make this more efficient, i.e. cache the result?\n+        if let DeclUsage::Bindings(ids) = usage {\n+            // compute transitive closure of `ids` over `top_level_mappings`\n+            let mut visited = ids.clone();\n+            let mut stack = ids.iter().collect::<Vec<_>>();\n+            let mut has_global_usage = false;\n+            while let Some(id) = stack.pop() {\n+                match var_graph.decl_usages.get(id) {\n+                    Some(DeclUsage::SideEffects) => {\n+                        has_global_usage = true;\n+                        break;\n+                    }\n+                    Some(DeclUsage::Bindings(callers)) => {\n+                        for caller in callers {\n+                            if visited.insert(caller.clone()) {\n+                                stack.push(caller);\n+                            }\n+                        }\n+                    }\n+                    _ => {}\n+                }\n+            }\n+\n+            // Collect all `visited` declarations which are exported\n+            import_usage.insert(\n+                *reference,\n+                if has_global_usage {\n+                    ImportUsage::SideEffects\n+                } else {\n+                    ImportUsage::Exports(\n+                        var_graph\n+                            .exports\n+                            .iter()\n+                            .filter(|(_, id)| visited.contains(*id))\n+                            .map(|(exported, _)| exported.as_str().into())\n+                            .collect(),\n+                    )\n+                },\n+            );\n+        }\n+    }\n+\n     let span = tracing::trace_span!(\"esm import references\");\n     let import_references = async {\n         let mut import_references = Vec::with_capacity(eval_context.imports.references().len());\n@@ -785,6 +830,7 @@ async fn analyze_ecmascript_module_internal(\n                     )\n                     .then(ModulePart::exports),\n                 },\n+                import_usage.get(&i).cloned().unwrap_or_default(),\n                 import_externals,\n             )\n             .resolved_cell();\n@@ -1416,6 +1462,8 @@ async fn analyze_ecmascript_module_internal(\n                             options.tree_shaking_mode,\n                             Some(TreeShakingMode::ReexportsOnly)\n                         ) {\n+                            // TODO move this logic into Effect creation itself and don't create new\n+                            // references after the fact here.\n                             let original_reference = r.await?;\n                             if original_reference.export_name.is_none()\n                                 && export.is_some()\n@@ -1434,6 +1482,11 @@ async fn analyze_ecmascript_module_internal(\n                                                 original_reference.issue_source,\n                                                 original_reference.annotations.clone(),\n                                                 Some(ModulePart::export(export.clone())),\n+                                                // TODO this is correct, but an overapproximation.\n+                                                // We should have individual import_usage data for\n+                                                // each export. This would be fixed by moving this\n+                                                // logic earlier (see TODO above)\n+                                                original_reference.import_usage.clone(),\n                                                 original_reference.import_externals,\n                                             )\n                                             .resolved_cell()\n@@ -2874,6 +2927,7 @@ async fn handle_free_var_reference(\n                             ) => export.clone().map(ModulePart::export),\n                             None => None,\n                         },\n+                        ImportUsage::SideEffects,\n                         state.import_externals,\n                     )\n                     .resolved_cell())\n@@ -3502,10 +3556,10 @@ fn as_parent_path(ast_path: &AstNodePath<AstParentNodeRef<'_>>) -> Vec<AstParent\n     ast_path.iter().map(|n| n.kind()).collect()\n }\n \n-fn for_each_ident_in_pat(pat: &Pat, f: &mut impl FnMut(RcStr)) {\n+pub(crate) fn for_each_ident_in_pat(pat: &Pat, f: &mut impl FnMut(&Atom, SyntaxContext)) {\n     match pat {\n         Pat::Ident(BindingIdent { id, .. }) => {\n-            f(id.sym.as_str().into());\n+            f(&id.sym, id.ctxt);\n         }\n         Pat::Array(ArrayPat { elems, .. }) => elems.iter().for_each(|e| {\n             if let Some(e) = e {\n@@ -3521,7 +3575,7 @@ fn for_each_ident_in_pat(pat: &Pat, f: &mut impl FnMut(RcStr)) {\n                     for_each_ident_in_pat(value, f);\n                 }\n                 ObjectPatProp::Assign(AssignPatProp { key, .. }) => {\n-                    f(key.sym.as_str().into());\n+                    f(&key.sym, key.ctxt);\n                 }\n                 ObjectPatProp::Rest(RestPat { arg, .. }) => {\n                     for_each_ident_in_pat(arg, f);\n@@ -3654,8 +3708,8 @@ impl VisitAstPath for ModuleReferencesVisitor<'_> {\n                     };\n                     let decls = &*var_decl.decls;\n                     decls.iter().for_each(|VarDeclarator { name, .. }| {\n-                        for_each_ident_in_pat(name, &mut |name| {\n-                            insert_export_binding(name, liveness)\n+                        for_each_ident_in_pat(name, &mut |name, _| {\n+                            insert_export_binding(name.as_str().into(), liveness)\n                         })\n                     });\n                 }"
        },
        {
            "sha": "e91903de6abe85c28b3aec73a215cad6efd07248",
            "filename": "turbopack/crates/turbopack-ecmascript/src/side_effect_optimization/reference.rs",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fside_effect_optimization%2Freference.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -14,7 +14,7 @@ use turbopack_core::{\n     },\n     module::Module,\n     reference::ModuleReference,\n-    resolve::{ExportUsage, ModulePart, ModuleResolveResult},\n+    resolve::{BindingUsage, ExportUsage, ImportUsage, ModulePart, ModuleResolveResult},\n };\n \n use super::{\n@@ -144,8 +144,12 @@ impl ChunkableModuleReference for EcmascriptModulePartReference {\n     }\n \n     #[turbo_tasks::function]\n-    fn export_usage(&self) -> Vc<ExportUsage> {\n-        *self.export_usage\n+    async fn binding_usage(&self) -> Result<Vc<BindingUsage>> {\n+        Ok(BindingUsage {\n+            import: ImportUsage::SideEffects,\n+            export: self.export_usage.owned().await?,\n+        }\n+        .cell())\n     }\n }\n "
        },
        {
            "sha": "40c6822c8f3bc06a204434b7dc77366f137d7a09",
            "filename": "turbopack/crates/turbopack-nodejs/src/chunking_context.rs",
            "status": "modified",
            "additions": 29,
            "deletions": 5,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -18,10 +18,11 @@ use turbopack_core::{\n     module::Module,\n     module_graph::{\n         ModuleGraph,\n+        binding_usage_info::{BindingUsageInfo, ModuleExportUsage},\n         chunk_group_info::ChunkGroup,\n-        export_usage::{ExportUsageInfo, ModuleExportUsage},\n     },\n     output::{OutputAsset, OutputAssets},\n+    reference::ModuleReference,\n };\n use turbopack_ecmascript::{\n     async_chunk::module::AsyncLoaderModule,\n@@ -117,11 +118,19 @@ impl NodeJsChunkingContextBuilder {\n         self\n     }\n \n-    pub fn export_usage(mut self, export_usage: Option<ResolvedVc<ExportUsageInfo>>) -> Self {\n+    pub fn export_usage(mut self, export_usage: Option<ResolvedVc<BindingUsageInfo>>) -> Self {\n         self.chunking_context.export_usage = export_usage;\n         self\n     }\n \n+    pub fn unused_references(\n+        mut self,\n+        unused_references: Option<ResolvedVc<BindingUsageInfo>>,\n+    ) -> Self {\n+        self.chunking_context.unused_references = unused_references;\n+        self\n+    }\n+\n     pub fn chunking_config<T>(mut self, ty: ResolvedVc<T>, chunking_config: ChunkingConfig) -> Self\n     where\n         T: Upcast<Box<dyn ChunkType>>,\n@@ -188,7 +197,9 @@ pub struct NodeJsChunkingContext {\n     /// The strategy to use for generating module ids\n     module_id_strategy: ResolvedVc<Box<dyn ModuleIdStrategy>>,\n     /// The module export usage info, if available.\n-    export_usage: Option<ResolvedVc<ExportUsageInfo>>,\n+    export_usage: Option<ResolvedVc<BindingUsageInfo>>,\n+    /// Which references are unused and should be skipped (e.g. during codegen).\n+    unused_references: Option<ResolvedVc<BindingUsageInfo>>,\n     /// The strategy to use for generating source map source uris\n     source_map_source_type: SourceMapSourceType,\n     /// The chunking configs\n@@ -233,6 +244,7 @@ impl NodeJsChunkingContext {\n                 source_map_source_type: SourceMapSourceType::TurbopackUri,\n                 module_id_strategy: ResolvedVc::upcast(DevModuleIdStrategy::new_resolved()),\n                 export_usage: None,\n+                unused_references: None,\n                 chunking_configs: Default::default(),\n                 debug_ids: false,\n             },\n@@ -613,12 +625,24 @@ impl ChunkingContext for NodeJsChunkingContext {\n         if let Some(export_usage) = self.await?.export_usage {\n             Ok(export_usage.await?.used_exports(module).await?)\n         } else {\n-            // In development mode, we don't have export usage info, so we assume all exports are\n-            // used.\n             Ok(ModuleExportUsage::all())\n         }\n     }\n \n+    #[turbo_tasks::function]\n+    async fn is_reference_unused(\n+        self: Vc<Self>,\n+        reference: ResolvedVc<Box<dyn ModuleReference>>,\n+    ) -> Result<Vc<bool>> {\n+        if let Some(unused_references) = self.await?.unused_references {\n+            Ok(Vc::cell(\n+                unused_references.await?.is_reference_unused(&reference),\n+            ))\n+        } else {\n+            Ok(Vc::cell(false))\n+        }\n+    }\n+\n     #[turbo_tasks::function]\n     fn debug_ids_enabled(&self) -> Vc<bool> {\n         Vc::cell(self.debug_ids)"
        },
        {
            "sha": "39a7625f277eea06545d7606a2846e394634cf34",
            "filename": "turbopack/crates/turbopack-tests/tests/execution.rs",
            "status": "modified",
            "additions": 43,
            "deletions": 19,
            "changes": 62,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -39,7 +39,7 @@ use turbopack_core::{\n     file_source::FileSource,\n     ident::Layer,\n     issue::CollectibleIssuesExt,\n-    module_graph::{ModuleGraph, export_usage::compute_export_usage_info},\n+    module_graph::{ModuleGraph, binding_usage_info::compute_binding_usage_info},\n     reference_type::{InnerAssets, ReferenceType},\n     resolve::{\n         ExternalTraced, ExternalType,\n@@ -239,8 +239,12 @@ async fn run_inner_operation(\n struct TestOptions {\n     #[serde(default = \"default_tree_shaking_mode\")]\n     tree_shaking_mode: Option<TreeShakingMode>,\n-    remove_unused_exports: Option<bool>,\n-    scope_hoisting: Option<bool>,\n+    #[serde(default = \"default_true\")]\n+    remove_unused_imports: bool,\n+    #[serde(default = \"default_true\")]\n+    remove_unused_exports: bool,\n+    #[serde(default = \"default_true\")]\n+    scope_hoisting: bool,\n     #[serde(default)]\n     minify: bool,\n     #[serde(default)]\n@@ -251,12 +255,17 @@ fn default_tree_shaking_mode() -> Option<TreeShakingMode> {\n     Some(TreeShakingMode::ReexportsOnly)\n }\n \n+fn default_true() -> bool {\n+    true\n+}\n+\n impl Default for TestOptions {\n     fn default() -> Self {\n         Self {\n             tree_shaking_mode: default_tree_shaking_mode(),\n-            remove_unused_exports: None,\n-            scope_hoisting: None,\n+            remove_unused_exports: default_true(),\n+            remove_unused_imports: default_true(),\n+            scope_hoisting: default_true(),\n             minify: false,\n             production_chunking: false,\n         }\n@@ -351,7 +360,7 @@ async fn run_test_operation(prepared_test: ResolvedVc<PreparedTest>) -> Result<V\n             compile_time_defines!(\n                 process.turbopack = true,\n                 process.env.TURBOPACK = true,\n-                process.env.NODE_ENV = \"development\",\n+                process.env.NODE_ENV = \"production\",\n             )\n             .resolved_cell(),\n         )\n@@ -395,8 +404,6 @@ async fn run_test_operation(prepared_test: ResolvedVc<PreparedTest>) -> Result<V\n         .resolved_cell(),\n     );\n \n-    let remove_unused_exports = options.remove_unused_exports.unwrap_or(true);\n-\n     let asset_context: Vc<Box<dyn AssetContext>> = Vc::upcast(ModuleAssetContext::new(\n         Default::default(),\n         compile_time_info,\n@@ -469,7 +476,23 @@ async fn run_test_operation(prepared_test: ResolvedVc<PreparedTest>) -> Result<V\n \n     let entries = get_evaluate_entries(jest_entry_asset, asset_context, None);\n \n-    let module_graph = ModuleGraph::from_modules(entries.graph_entries(), false);\n+    let mut module_graph = ModuleGraph::from_modules(entries.graph_entries(), false);\n+\n+    let binding_usage = if options.remove_unused_imports || options.remove_unused_exports {\n+        Some(\n+            compute_binding_usage_info(\n+                module_graph.to_resolved().await?,\n+                options.remove_unused_imports,\n+            )\n+            .resolve_strongly_consistent()\n+            .await?,\n+        )\n+    } else {\n+        None\n+    };\n+    if options.remove_unused_imports {\n+        module_graph = module_graph.without_unused_references(*binding_usage.unwrap());\n+    }\n \n     let mut builder = NodeJsChunkingContext::builder(\n         project_root.clone(),\n@@ -481,23 +504,24 @@ async fn run_test_operation(prepared_test: ResolvedVc<PreparedTest>) -> Result<V\n         env,\n         RuntimeType::Development,\n     )\n-    .module_merging(options.scope_hoisting.unwrap_or(true))\n+    .module_merging(options.scope_hoisting)\n     .minify_type(if options.minify {\n         MinifyType::Minify {\n             mangle: Some(MangleType::OptimalSize),\n         }\n     } else {\n         MinifyType::NoMinify\n     })\n-    .export_usage(if remove_unused_exports {\n-        Some(\n-            compute_export_usage_info(module_graph.to_resolved().await?)\n-                .resolve_strongly_consistent()\n-                .await?,\n-        )\n-    } else {\n-        None\n-    });\n+    .export_usage(\n+        options\n+            .remove_unused_exports\n+            .then(|| binding_usage.unwrap()),\n+    )\n+    .unused_references(\n+        options\n+            .remove_unused_exports\n+            .then(|| binding_usage.unwrap()),\n+    );\n     if options.production_chunking {\n         builder = builder\n             .chunking_config("
        },
        {
            "sha": "c37b700108ef81cdbc7444c6cfa80372c7d36c0f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/comptime/input/index.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fcomptime%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fcomptime%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fcomptime%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -122,7 +122,7 @@ it('should evaluate !process.turbopack', () => {\n })\n \n it('should evaluate NODE_ENV', () => {\n-  if (process.env.NODE_ENV !== 'development') {\n+  if (process.env.NODE_ENV !== 'production') {\n     require('fail')\n     import('fail')\n   }"
        },
        {
            "sha": "55aa5c8b005018b7b4c0194208e6ceca7935ca8b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/basic/comptime/input/next.config.js",
            "status": "removed",
            "additions": 0,
            "deletions": 16,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/4deba0f6ea83a9a4b2ac28eb3e9a38651acfffcd/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fcomptime%2Finput%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/4deba0f6ea83a9a4b2ac28eb3e9a38651acfffcd/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fcomptime%2Finput%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fbasic%2Fcomptime%2Finput%2Fnext.config.js?ref=4deba0f6ea83a9a4b2ac28eb3e9a38651acfffcd",
            "patch": "@@ -1,16 +0,0 @@\n-module.exports = {}\n-\n-function f() {\n-  if (!process.turbopack) {\n-    throw new Error('Turbopack is not enabled')\n-  }\n-  if (process.env.NODE_ENV !== 'development') {\n-    throw new Error('NODE_ENV is not development')\n-  }\n-}\n-\n-f()\n-\n-// if (f.toString().includes(\"process.turbopack\")) {\n-//   throw new Error(\"process.turbopack is not replaced\");\n-// }"
        },
        {
            "sha": "32e4d3f2ddc1d2d346d751a7217a0c4e5a41f4aa",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/basic/input/a.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Fa.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,16 @@\n+import { x } from './library/x.js'\n+import { y } from './library/y.js'\n+\n+y()\n+\n+function helper() {\n+  return x()\n+}\n+\n+export function unused() {\n+  return helper()\n+}\n+\n+export function used() {\n+  return 1234\n+}"
        },
        {
            "sha": "ca24e430e99f3b3b5eb131387de54559b0868dbb",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/basic/input/index.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,8 @@\n+import { used } from './a.js'\n+\n+it('should error when importing an invalid export', () => {\n+  expect(used()).toBe(1234)\n+\n+  expect(globalThis.xBundled).toBeUndefined()\n+  expect(globalThis.yBundled).toBeTruthy()\n+})"
        },
        {
            "sha": "a43829151e1423f0641beb1f114773f1c67fda72",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/basic/input/library/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Flibrary%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Flibrary%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Flibrary%2Fpackage.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "f40886e68b0821b714e219d90f3ffa4196556346",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/basic/input/library/x.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Flibrary%2Fx.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Flibrary%2Fx.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Flibrary%2Fx.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+globalThis.xBundled = true\n+\n+export function x() {}"
        },
        {
            "sha": "6e6356b20c9b764103be4d09e2333dfeaf305342",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/basic/input/library/y.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Flibrary%2Fy.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Flibrary%2Fy.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Finput%2Flibrary%2Fy.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+globalThis.yBundled = true\n+\n+export function y() {}"
        },
        {
            "sha": "bf30b867b72132fe909283a871c7916ee8109fb5",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/basic/options.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Foptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Foptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fbasic%2Foptions.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"scopeHoisting\": false\n+}"
        },
        {
            "sha": "da12508a03ea7d567b03674105c631fd1b0f1cda",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/import-star/input/a.js",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Fa.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,15 @@\n+import * as lib from './library/index.js'\n+\n+lib.y()\n+\n+function helper() {\n+  return lib.x()\n+}\n+\n+export function unused() {\n+  return helper()\n+}\n+\n+export function used() {\n+  return 1234\n+}"
        },
        {
            "sha": "64fae635e810a541fbe3169937c714a911b27d27",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/import-star/input/index.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,11 @@\n+import { used } from './a.js'\n+\n+it('should error when importing an invalid export', () => {\n+  expect(used()).toBe(1234)\n+\n+  // TODO we don't actually want x to be bundled, but currently we can't track this easily.\n+  // See the TODOs in turbopack/crates/turbopack-ecmascript/src/references/mod.rs\n+  expect(globalThis.xBundled).toBeTruthy()\n+\n+  expect(globalThis.yBundled).toBeTruthy()\n+})"
        },
        {
            "sha": "f6df478d10f01b1a25d33cbbb73990decdb55713",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/import-star/input/library/index.js",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,2 @@\n+export { x } from './x.js'\n+export { y } from './y.js'"
        },
        {
            "sha": "a43829151e1423f0641beb1f114773f1c67fda72",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/import-star/input/library/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Fpackage.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "f40886e68b0821b714e219d90f3ffa4196556346",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/import-star/input/library/x.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Fx.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Fx.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Fx.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+globalThis.xBundled = true\n+\n+export function x() {}"
        },
        {
            "sha": "6e6356b20c9b764103be4d09e2333dfeaf305342",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/import-star/input/library/y.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Fy.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Fy.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Finput%2Flibrary%2Fy.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+globalThis.yBundled = true\n+\n+export function y() {}"
        },
        {
            "sha": "bf30b867b72132fe909283a871c7916ee8109fb5",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/import-star/options.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Foptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Foptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Fimport-star%2Foptions.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"scopeHoisting\": false\n+}"
        },
        {
            "sha": "fcda64983c29b44bbd84840960fcf678525a3782",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/rename/input/a.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Fa.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import { x } from './library/x.js'\n+\n+function bar() {\n+  return x()\n+}\n+\n+export { bar as used }"
        },
        {
            "sha": "4a9ecee65963c5a0ff29fe5d0e1f783c5ceda6bc",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/rename/input/index.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import { used } from './a.js'\n+\n+it('should error when importing an invalid export', () => {\n+  used()\n+\n+  expect(globalThis.xBundled).toBeTruthy()\n+})"
        },
        {
            "sha": "a43829151e1423f0641beb1f114773f1c67fda72",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/rename/input/library/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Flibrary%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Flibrary%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Flibrary%2Fpackage.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "f40886e68b0821b714e219d90f3ffa4196556346",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/rename/input/library/x.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Flibrary%2Fx.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Flibrary%2Fx.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Finput%2Flibrary%2Fx.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+globalThis.xBundled = true\n+\n+export function x() {}"
        },
        {
            "sha": "bf30b867b72132fe909283a871c7916ee8109fb5",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/remove-unused-imports/rename/options.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Foptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Foptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fremove-unused-imports%2Frename%2Foptions.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"scopeHoisting\": false\n+}"
        },
        {
            "sha": "9f907a270e983a4de18f9987842f88de33c7c86d",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/export-default-named/input/a.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fa.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+import { x } from './dep?a'\n+\n+export default function abc() {\n+  return x\n+}"
        },
        {
            "sha": "03170b2243ffe5f9b760580e1e6d615f35fbac2f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/export-default-named/input/b.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fb.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fb.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fb.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+import { x } from './dep?b'\n+\n+export default function abc() {\n+  return x\n+}"
        },
        {
            "sha": "2174b7469b8d100d9bb87a7240948e09b0f07a91",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/export-default-named/input/c.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fc.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fc.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fc.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import { x } from './dep?c'\n+\n+export default function abc() {\n+  return x\n+}\n+\n+abc()"
        },
        {
            "sha": "79d8bb4aaf036ef766007f2174a4f77dab929241",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/export-default-named/input/d.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fd.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fd.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fd.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import { x } from './dep?d'\n+\n+export default class def {\n+  method() {\n+    return x\n+  }\n+}"
        },
        {
            "sha": "99375edb7fb43eefc7a483dbae3d6d289c24ecae",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/export-default-named/input/dep.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fdep.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fdep.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fdep.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+export const x = 'x'\n+\n+export default __webpack_exports_info__.x.used"
        },
        {
            "sha": "3e5e10d065813ccb1d0526e83b87bc51d20b7813",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/export-default-named/input/e.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fe.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fe.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Fe.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import { x } from './dep?e'\n+\n+export default class def {\n+  method() {\n+    return x\n+  }\n+}"
        },
        {
            "sha": "eeb7d5d44a658455e282f29898be51b33155b9cf",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/export-default-named/input/f.js",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Ff.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Ff.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Ff.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,9 @@\n+import { x } from './dep?f'\n+\n+export default class def {\n+  method() {\n+    return x\n+  }\n+}\n+\n+new def().method()"
        },
        {
            "sha": "43cc5e3cba55847284612dcd59e73ca992c1292f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/export-default-named/input/index.js",
            "status": "added",
            "additions": 46,
            "deletions": 0,
            "changes": 46,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fexport-default-named%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,46 @@\n+import A from './a'\n+import './b'\n+import './c'\n+import D from './d'\n+import './e'\n+import './f'\n+\n+import a from './dep?a'\n+import b from './dep?b'\n+import c from './dep?c'\n+import d from './dep?d'\n+import e from './dep?e'\n+import f from './dep?f'\n+\n+it('should generate valid code', () => {\n+  expect(A()).toBe('x')\n+  expect(new D().method()).toBe('x')\n+})\n+\n+it('a should be used', () => {\n+  expect(a).toBe(true)\n+})\n+\n+if (process.env.NODE_ENV === 'production') {\n+  it('b should be unused', () => {\n+    expect(b).toBe(false)\n+  })\n+}\n+\n+it('c should be used', () => {\n+  expect(c).toBe(true)\n+})\n+\n+if (process.env.NODE_ENV === 'production') {\n+  it('d should be used', () => {\n+    expect(d).toBe(true)\n+  })\n+\n+  it('e should be unused', () => {\n+    expect(e).toBe(false)\n+  })\n+}\n+\n+it('f should be used', () => {\n+  expect(f).toBe(true)\n+})"
        },
        {
            "sha": "dd0778a84080f21b31fd87915bbe51e7af0553ca",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/a.js",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fa.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,14 @@\n+import B from './b.js'\n+import { A1 } from './dep1'\n+\n+export default class A extends B {\n+  constructor() {\n+    super()\n+  }\n+  test() {\n+    super.test()\n+\n+    this.b = new B()\n+    this.a1 = new A1()\n+  }\n+}"
        },
        {
            "sha": "bad7b2c7ac990ac189a6dd30722a9c6dcdbc0c89",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/b.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fb.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fb.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fb.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,10 @@\n+import A from './a.js'\n+import { A1 } from './dep1'\n+\n+export default class B {\n+  constructor() {}\n+  test() {\n+    this.a = new A()\n+    this.a2 = new A1()\n+  }\n+}"
        },
        {
            "sha": "abf3e64f49032fc876076d1d239027cbccc47db6",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/c.js",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fc.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fc.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fc.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,21 @@\n+import { BaseError, BaseError1, BaseError2, BaseError3 } from './dep2'\n+\n+export class ExtendedError extends BaseError {\n+  constructor(message) {\n+    super(message)\n+  }\n+}\n+export class ExtendedError1 extends BaseError1 {\n+  constructor(message) {\n+    super(message)\n+  }\n+}\n+export class ExtendedError2 extends BaseError2 {\n+  myMethod() {}\n+}\n+export class ExtendedError3 extends BaseError3 {}\n+export class ExtendedError4 extends Error {\n+  constructor(message = 'ExtendedError') {\n+    super(message)\n+  }\n+}"
        },
        {
            "sha": "8125a914b55a2eac3937b8d6b5fb60807c7a6766",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/dep1.js",
            "status": "added",
            "additions": 27,
            "deletions": 0,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fdep1.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fdep1.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fdep1.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,27 @@\n+import { A, B, Z, W } from './dep2'\n+\n+export const A1 = class A1 extends A {\n+  render() {\n+    return new E()\n+  }\n+}\n+\n+class B1 extends B {\n+  render() {\n+    return new D()\n+  }\n+}\n+\n+export class Z1 extends Z {}\n+\n+export class E {}\n+class D {\n+  foo() {\n+    class B2 extends B {}\n+\n+    return B2\n+  }\n+}\n+\n+export const isZ = new Z1() instanceof Z\n+export { W }"
        },
        {
            "sha": "95826195d624f821cc4829f15ac75b2b3b28eab2",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/dep2.js",
            "status": "added",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fdep2.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fdep2.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fdep2.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,52 @@\n+export const A = class A {}\n+export class B {}\n+export class C {}\n+export class Y {}\n+export class Z {}\n+export function mixin1(_class) {\n+  return _class\n+}\n+export function mixin2(_class) {\n+  return _class\n+}\n+export function mixin3(_class) {\n+  return _class\n+}\n+export function mixin4(_class) {\n+  return _class\n+}\n+export function mixin5(_class) {\n+  return _class\n+}\n+export function getField() {\n+  return 'test'\n+}\n+export class BaseError extends Error {}\n+export class BaseError1 extends Error {}\n+export class BaseError2 extends Error {}\n+export class BaseError3 extends Error {}\n+export class W {}\n+export class J {}\n+export class K {}\n+var SuperClass = class {}\n+export { SuperClass }\n+\n+export const exportsInfoForA = __webpack_exports_info__.A.used\n+export const exportsInfoForB = __webpack_exports_info__.B.used\n+export const exportsInfoForC = __webpack_exports_info__.C.used\n+export const exportsInfoForY = __webpack_exports_info__.Y.used\n+export const exportsInfoForZ = __webpack_exports_info__.Z.used\n+export const exportsInfoForW = __webpack_exports_info__.W.used\n+export const exportsInfoForJ = __webpack_exports_info__.J.used\n+export const exportsInfoForK = __webpack_exports_info__.K.used\n+export const exportsInfoForMixin1 = __webpack_exports_info__.mixin1.used\n+export const exportsInfoForMixin2 = __webpack_exports_info__.mixin2.used\n+export const exportsInfoForMixin3 = __webpack_exports_info__.mixin3.used\n+export const exportsInfoForMixin4 = __webpack_exports_info__.mixin4.used\n+export const exportsInfoForMixin5 = __webpack_exports_info__.mixin5.used\n+export const exportsInfoForgetField = __webpack_exports_info__.getField.used\n+export const exportsInfoForBaseError = __webpack_exports_info__.BaseError.used\n+export const exportsInfoForBaseError1 = __webpack_exports_info__.BaseError1.used\n+export const exportsInfoForBaseError2 = __webpack_exports_info__.BaseError2.used\n+export const exportsInfoForBaseError3 = __webpack_exports_info__.BaseError3.used\n+export const exportsInfoForSuperClass = __webpack_exports_info__.SuperClass.used"
        },
        {
            "sha": "7d9ed1459d143a6830281fddb99e6069a8ffc5ca",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/dep3.js",
            "status": "added",
            "additions": 38,
            "deletions": 0,
            "changes": 38,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fdep3.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fdep3.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fdep3.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,38 @@\n+import { mixin1, mixin2, mixin3, getField, A, B, C, Y, mixin4 } from './dep2'\n+\n+export const A1 = class A1 extends A {\n+  render() {\n+    return new E()\n+  }\n+}\n+\n+export const B1 = class B1 extends /*#__PURE__*/ mixin1(B) {\n+  render() {\n+    return new E()\n+  }\n+}\n+\n+export const C1 = class C1 extends mixin2(Y, /*#__PURE__*/ mixin3(C)) {\n+  render() {\n+    return new D()\n+  }\n+}\n+\n+export class Y1 extends /*#__PURE__*/ mixin2(Y) {\n+  constructor() {\n+    super()\n+\n+    this.innerClass = class B2 extends mixin1(B) {}\n+  }\n+\n+  render() {\n+    return new D()\n+  }\n+}\n+\n+export class Bar extends /*#__PURE__*/ mixin4(A) {\n+  [/*#__PURE__*/ getField()] = 12\n+}\n+\n+export class E {}\n+const D = class D {}"
        },
        {
            "sha": "5aa7859d0de749b52ad8f3faaac0ede7ebe6c971",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/index.js",
            "status": "added",
            "additions": 79,
            "deletions": 0,
            "changes": 79,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,79 @@\n+import {\n+  exportsInfoForA,\n+  exportsInfoForB,\n+  exportsInfoForC,\n+  exportsInfoForY,\n+  exportsInfoForZ,\n+  exportsInfoForW,\n+  exportsInfoForJ,\n+  exportsInfoForK,\n+  exportsInfoForMixin1,\n+  exportsInfoForMixin2,\n+  exportsInfoForMixin3,\n+  exportsInfoForMixin4,\n+  exportsInfoForMixin5,\n+  exportsInfoForBaseError,\n+  exportsInfoForBaseError1,\n+  exportsInfoForBaseError2,\n+  exportsInfoForBaseError3,\n+  exportsInfoForSuperClass,\n+} from './dep2'\n+\n+it('should load modules correctly', () => {\n+  require('./module1')\n+  require('./module2')\n+  require('./module3')\n+  require('./module4')\n+  require('./module5')\n+  require('./module6')\n+  require('./module7')\n+  require('./module8')\n+  require('./module9')\n+})\n+\n+if (process.env.NODE_ENV === 'production') {\n+  it('W and J should not be used', () => {\n+    expect(exportsInfoForJ).toBe(false)\n+    expect(exportsInfoForW).toBe(false)\n+  })\n+\n+  it('Keep extends with constructor', () => {\n+    expect(exportsInfoForBaseError).toBe(true)\n+    expect(exportsInfoForBaseError1).toBe(true)\n+    expect(exportsInfoForBaseError2).toBe(false)\n+    expect(exportsInfoForBaseError3).toBe(false)\n+  })\n+}\n+\n+it('A should be used', () => {\n+  expect(exportsInfoForA).toBe(true)\n+})\n+\n+it('B should be used', () => {\n+  expect(exportsInfoForB).toBe(true)\n+})\n+\n+it('K should be used', () => {\n+  expect(exportsInfoForK).toBe(true)\n+})\n+\n+it('Z used, inner graph can not determine const usage', () => {\n+  expect(exportsInfoForZ).toBe(true)\n+})\n+\n+it('SuperClass should be used', () => {\n+  expect(exportsInfoForSuperClass).toBe(true)\n+})\n+\n+it('Pure super expression should be unused, another used', () => {\n+  if (process.env.NODE_ENV === 'production') {\n+    expect(exportsInfoForMixin4).toBe(false)\n+    expect(exportsInfoForMixin5).toBe(false)\n+  }\n+\n+  expect(exportsInfoForMixin1).toBe(true)\n+  expect(exportsInfoForMixin2).toBe(true)\n+  expect(exportsInfoForMixin3).toBe(true)\n+  expect(exportsInfoForC).toBe(true)\n+  expect(exportsInfoForY).toBe(true)\n+})"
        },
        {
            "sha": "8eaece6a2da35d47ae95257ca583c80b88098264",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/module1.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule1.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule1.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule1.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+import { A1 } from './dep1'\n+\n+export default new A1()"
        },
        {
            "sha": "a4d1f40b44e2cc2a60e93457595cd16e7cdca1c9",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/module2.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule2.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule2.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule2.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+import { A1 } from './dep3'\n+\n+export default new A1()"
        },
        {
            "sha": "d42f2fcfb87e863b0489d960d9cf4562d02adaae",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/module3.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule3.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule3.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule3.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+import A from './a.js'\n+let a = new A()\n+a.test()"
        },
        {
            "sha": "edbc69c9cc4586c729c2e56addd2e72a6c9e24df",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/module4.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule4.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule4.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule4.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+import { ExtendedError4 } from './c.js'\n+\n+export default new ExtendedError4()"
        },
        {
            "sha": "df64202495c3f9f611b382ec8aff9fc325b4cdb8",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/module5.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule5.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule5.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule5.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+import { W } from './dep2'\n+\n+class BaseW extends W {}"
        },
        {
            "sha": "1ec776a1f2fdc82d15ca4bdb6b82e7c084d0ea7a",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/module6.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule6.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule6.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule6.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,4 @@\n+import { J } from './dep2'\n+\n+class BaseJ extends J {}\n+class BaseBaseJ extends BaseJ {}"
        },
        {
            "sha": "1150c43c98255a31ff2103057dbfba3da28ca58f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/module7.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule7.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule7.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule7.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,6 @@\n+import { K } from './dep2'\n+\n+class BaseK extends K {}\n+class BaseBaseK extends BaseK {}\n+\n+export default new BaseBaseK()"
        },
        {
            "sha": "737e04b543020e031b4d659fdc43741a04f50bd7",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/module8.js",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule8.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule8.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule8.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,9 @@\n+import { mixin5 } from './dep2'\n+\n+class Bar extends /*#__PURE__*/ mixin5(null) {\n+  static displayName = 'Point'\n+}\n+\n+function test() {\n+  return Bar.displayName\n+}"
        },
        {
            "sha": "bc54ca8fc76d6442402f3536b496c95f58ad3fd6",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/module9.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule9.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule9.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Fmodule9.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,8 @@\n+import { SuperClass } from './dep2'\n+\n+var UnusedClass = class extends SuperClass {\n+    constructor() {\n+      super()\n+    }\n+  },\n+  unusedVariable = new UnusedClass()"
        },
        {
            "sha": "1d0e33a24899341f612912e562fc4bf29890882b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class/input/test.filter.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Ftest.filter.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Ftest.filter.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class%2Finput%2Ftest.filter.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+'use strict'\n+\n+const supportsClassStaticBlock = require('../../../helpers/supportsClassStaticBlock')\n+\n+module.exports = () => supportsClassStaticBlock()"
        },
        {
            "sha": "2791dd11a9d2c2f186a219e0ace04c544ba2dad9",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class2/input/dep-decl.js",
            "status": "added",
            "additions": 188,
            "deletions": 0,
            "changes": 188,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep-decl.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep-decl.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep-decl.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,188 @@\n+import {\n+  A,\n+  B,\n+  getC,\n+  getD,\n+  getE,\n+  getF,\n+  Foo,\n+  Pure,\n+  DateFormatter,\n+  ConditionalExpression,\n+  LogicalExpression,\n+} from './dep2?decl'\n+import {\n+  A3,\n+  B3,\n+  C3,\n+  D3,\n+  E3,\n+  F3,\n+  Pure3,\n+  ConditionalExpression3,\n+  LogicalExpression3,\n+} from './dep3?decl'\n+\n+export class A1 extends A {\n+  render() {\n+    return new A2()\n+  }\n+}\n+\n+export class B1 extends B {\n+  render() {\n+    return new B2()\n+  }\n+}\n+\n+// prettier-ignore\n+export class C1 extends /*#__PURE__*/ getC() {\n+\trender() {\n+\t\treturn new C2();\n+\t}\n+}\n+\n+// prettier-ignore\n+export class D1 extends /*@__PURE__*/ getD() {\n+\trender() {\n+\t\treturn new D2();\n+\t}\n+}\n+\n+export class E1 extends getE() {\n+  render() {\n+    return new E2()\n+  }\n+}\n+\n+export class F1 extends getF() {\n+  render() {\n+    return new F2()\n+  }\n+}\n+\n+function foo(instance) {\n+  return new instance()\n+}\n+\n+class Bar extends Foo {\n+  static prop = 42\n+  static a = foo(this).prop\n+  static b = foo(Bar).prop\n+  static c = foo(super.Bar).prop\n+  static inStatic1\n+  static inStatic2\n+  static inStatic3\n+  static {\n+    this.inStatic1 = new Bar().prop\n+    this.inStatic2 = new super.Bar().prop\n+    this.inStatic3 = new this().prop\n+  }\n+}\n+\n+class BarA extends Foo {\n+  static prop = 42\n+  static a = foo(this).prop\n+}\n+\n+class BarB extends Foo {\n+  static prop = 42\n+  static b = foo(Bar).prop\n+}\n+\n+class BarC extends Foo {\n+  static prop = 42\n+  static c = foo(super.Bar).prop\n+}\n+\n+class BarPA extends Foo {\n+  static prop = 42\n+  static #a = foo(this).prop\n+}\n+\n+class BarPB extends Foo {\n+  static prop = 42\n+  static #b = foo(Bar).prop\n+}\n+\n+class BarPC extends Foo {\n+  static prop = 42\n+  static #c = foo(super.Bar).prop\n+}\n+\n+const ExpressionFoo = class Bar extends Foo {\n+  static prop = 42\n+  static a = foo(this).prop\n+  static b = foo(Bar).prop\n+  static c = foo(super.Bar).prop\n+  static inStatic1\n+  static inStatic2\n+  static inStatic3\n+  static {\n+    this.inStatic1 = new Bar().prop\n+    this.inStatic2 = new super.Bar().prop\n+    this.inStatic3 = new this().prop\n+  }\n+}\n+\n+export class Baz extends Foo {\n+  static prop = 42\n+  static a = foo(this).prop\n+  static b = foo(Bar).prop\n+  static c = foo(super.Bar).prop\n+  static inStatic1\n+  static inStatic2\n+  static inStatic3\n+  static {\n+    this.inStatic1 = new Bar().prop\n+    this.inStatic2 = new super.Bar().prop\n+    this.inStatic3 = new this().prop\n+  }\n+}\n+\n+export default class DefaultBar extends Foo {\n+  static prop = 42\n+  static a = foo(this).prop\n+  static b = foo(Bar).prop\n+  static c = foo(super.Bar).prop\n+  static inStatic1\n+  static inStatic2\n+  static inStatic3\n+  static {\n+    this.inStatic1 = new Bar().prop\n+    this.inStatic2 = new super.Bar().prop\n+    this.inStatic3 = new this().prop\n+  }\n+}\n+\n+export class ExtendsPure extends Pure {\n+  render() {\n+    return new Pure3()\n+  }\n+}\n+\n+export class DateBar extends DateFormatter {\n+  constructor() {\n+    super()\n+  }\n+  render() {}\n+}\n+\n+export class ConditionalExpression1 extends ConditionalExpression {\n+  render() {\n+    return new ConditionalExpression3()\n+  }\n+}\n+\n+export class LogicalExpression1 extends LogicalExpression {\n+  render() {\n+    return new LogicalExpression3()\n+  }\n+}\n+\n+export class A2 extends A3 {}\n+export class B2 extends B3 {}\n+export class C2 extends C3 {}\n+export class D2 extends D3 {}\n+export class E2 extends E3 {}\n+export class F2 extends F3 {}"
        },
        {
            "sha": "5bc27113e7d5c26ca4d91a85cd38a25d0e6d0382",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class2/input/dep-expr.js",
            "status": "added",
            "additions": 83,
            "deletions": 0,
            "changes": 83,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep-expr.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep-expr.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep-expr.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,83 @@\n+import {\n+  A,\n+  B,\n+  DateFormatter,\n+  getC,\n+  getD,\n+  getE,\n+  getF,\n+  Pure,\n+  ConditionalExpression,\n+  LogicalExpression,\n+} from './dep2?expr'\n+import { A3, B3, C3, D3, E3, F3, Pure3 } from './dep3?expr'\n+\n+export const A1 = class extends A {\n+  render() {\n+    return new A2()\n+  }\n+}\n+\n+export const B1 = class extends B {\n+  render() {\n+    return new B2()\n+  }\n+}\n+\n+// prettier-ignore\n+export const C1 = class extends /*#__PURE__*/ getC() {\n+\trender() {\n+\t\treturn new C2();\n+\t}\n+}\n+\n+// prettier-ignore\n+export const D1 = class extends /*@__PURE__*/ getD() {\n+\trender() {\n+\t\treturn new D2();\n+\t}\n+}\n+\n+export const E1 = class extends getE() {\n+  render() {\n+    return new E2()\n+  }\n+}\n+\n+export const F1 = class extends getF() {\n+  render() {\n+    return new F2()\n+  }\n+}\n+\n+export const ExtendsPure = class extends Pure {\n+  render() {\n+    return new Pure3()\n+  }\n+}\n+\n+export class DateBar extends DateFormatter {\n+  constructor() {\n+    super()\n+  }\n+  render() {}\n+}\n+\n+export class ConditionalExpression1 extends ConditionalExpression {\n+  render() {\n+    return new ConditionalExpression3()\n+  }\n+}\n+\n+export class LogicalExpression1 extends LogicalExpression {\n+  render() {\n+    return new LogicalExpression3()\n+  }\n+}\n+\n+export const A2 = class extends A3 {}\n+export const B2 = class extends B3 {}\n+export const C2 = class extends C3 {}\n+export const D2 = class extends D3 {}\n+export const E2 = class extends E3 {}\n+export const F2 = class extends F3 {}"
        },
        {
            "sha": "81a65bf28768b3ed2cb0f2a0e061dfa3495e86c4",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class2/input/dep2.js",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep2.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep2.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep2.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,33 @@\n+export class A {}\n+export class B {}\n+export const getC = () => class C {}\n+export const getD = () => class D {}\n+export const getE = () => class E {}\n+export const getF = () => class F {}\n+export class Foo {\n+  static Bar = Foo\n+}\n+export class Pure {}\n+export class DateFormatter extends Date {\n+  constructor() {\n+    super()\n+    this.date = this.getDate()\n+  }\n+}\n+export class ConditionalExpression extends (true ? A : B) {}\n+export class LogicalExpression extends (A || B) {}\n+\n+export const exportsInfoForA = __webpack_exports_info__.A.used\n+export const exportsInfoForB = __webpack_exports_info__.B.used\n+export const exportsInfoForC = __webpack_exports_info__.getC.used\n+export const exportsInfoForD = __webpack_exports_info__.getD.used\n+export const exportsInfoForE = __webpack_exports_info__.getE.used\n+export const exportsInfoForF = __webpack_exports_info__.getF.used\n+export const exportsInfoForFoo = __webpack_exports_info__.Foo.used\n+export const exportsInfoForPure = __webpack_exports_info__.Pure.used\n+export const exportsInfoForDateFormatter =\n+  __webpack_exports_info__.DateFormatter.used\n+export const exportsInfoForConditionalExpression =\n+  __webpack_exports_info__.ConditionalExpression.used\n+export const exportsInfoForLogicalExpression =\n+  __webpack_exports_info__.LogicalExpression.used"
        },
        {
            "sha": "74377293433fc9e35a4516c7b19bb7c24ac2f18f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class2/input/dep3.js",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep3.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep3.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fdep3.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,9 @@\n+export class A3 {}\n+export class B3 {}\n+export class C3 {}\n+export class D3 {}\n+export class E3 {}\n+export class F3 {}\n+export class Pure3 {}\n+export class ConditionalExpression3 extends (true ? A3 : B3) {}\n+export class LogicalExpression3 extends (A3 || B3) {}"
        },
        {
            "sha": "160cab51b7676f3256ac94d80ba799fdfe5df46f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class2/input/index.js",
            "status": "added",
            "additions": 77,
            "deletions": 0,
            "changes": 77,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,77 @@\n+import {\n+  exportsInfoForA as declA,\n+  exportsInfoForB as declB,\n+  exportsInfoForC as declC,\n+  exportsInfoForD as declD,\n+  exportsInfoForE as declE,\n+  exportsInfoForF as declF,\n+  exportsInfoForFoo as declFoo,\n+  exportsInfoForPure as declPure,\n+  exportsInfoForDateFormatter as declDateFormatter,\n+  exportsInfoForConditionalExpression as declConditionalExpression,\n+  exportsInfoForLogicalExpression as declLogicalExpression,\n+} from './dep2?decl'\n+import {\n+  exportsInfoForA as exprA,\n+  exportsInfoForB as exprB,\n+  exportsInfoForC as exprC,\n+  exportsInfoForD as exprD,\n+  exportsInfoForE as exprE,\n+  exportsInfoForF as exprF,\n+  exportsInfoForPure as exprPure,\n+  exportsInfoForDateFormatter as exprDateFormatter,\n+  exportsInfoForConditionalExpression as exprConditionalExpression,\n+  exportsInfoForLogicalExpression as exprLogicalExpression,\n+} from './dep2?expr'\n+\n+it('should load module correctly', () => {\n+  require('./module-decl')\n+  require('./module-expr')\n+})\n+\n+it('A should be used', () => {\n+  expect(declA).toBe(true)\n+  expect(exprA).toBe(true)\n+})\n+\n+if (process.env.NODE_ENV === 'production') {\n+  it('B should not be used', () => {\n+    expect(declB).toBe(false)\n+    expect(exprB).toBe(false)\n+  })\n+}\n+\n+it('C should be used', () => {\n+  expect(declC).toBe(true)\n+  expect(exprC).toBe(true)\n+})\n+\n+if (process.env.NODE_ENV === 'production') {\n+  it('D should not be used', () => {\n+    expect(declD).toBe(false)\n+    expect(exprD).toBe(false)\n+  })\n+}\n+\n+it('E should be used', () => {\n+  expect(declE).toBe(true)\n+  expect(exprE).toBe(true)\n+})\n+\n+it('F should be used', () => {\n+  if (process.env.NODE_ENV === 'production') {\n+    expect(declPure).toBe(false)\n+    expect(exprPure).toBe(false)\n+    expect(declConditionalExpression).toBe(false)\n+    expect(exprConditionalExpression).toBe(false)\n+    expect(declLogicalExpression).toBe(false)\n+    expect(exprLogicalExpression).toBe(false)\n+  }\n+\n+  // Note: it has side-effects and is not affected by usage of the class\n+  expect(declF).toBe(true)\n+  expect(declFoo).toBe(true)\n+  expect(exprF).toBe(true)\n+  expect(declDateFormatter).toBe(true)\n+  expect(exprDateFormatter).toBe(true)\n+})"
        },
        {
            "sha": "83cf2760e11b650c064b4509653bfed9cb7105a9",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class2/input/module-decl.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fmodule-decl.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fmodule-decl.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fmodule-decl.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,8 @@\n+import { A1, C1, E1, DateBar } from './dep-decl'\n+\n+export default [\n+  new A1().render(),\n+  new C1().render(),\n+  new E1().render(),\n+  new DateBar(),\n+]"
        },
        {
            "sha": "a22edb2f73a14cfdd165745f100259393a9c5364",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class2/input/module-expr.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fmodule-expr.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fmodule-expr.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Fmodule-expr.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,8 @@\n+import { A1, C1, E1, DateBar } from './dep-expr'\n+\n+export default [\n+  new A1().render(),\n+  new C1().render(),\n+  new E1().render(),\n+  new DateBar(),\n+]"
        },
        {
            "sha": "1d0e33a24899341f612912e562fc4bf29890882b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/extend-class2/input/test.filter.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Ftest.filter.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Ftest.filter.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fextend-class2%2Finput%2Ftest.filter.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+'use strict'\n+\n+const supportsClassStaticBlock = require('../../../helpers/supportsClassStaticBlock')\n+\n+module.exports = () => supportsClassStaticBlock()"
        },
        {
            "sha": "161107d89d555ab5b1e4e9527778b2bc06ff0254",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/simple/input/chunk.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Fchunk.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Fchunk.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Fchunk.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1 @@\n+import './inner'"
        },
        {
            "sha": "1a837c82e53cb58222e94d4038ddd8ed0e6d02f0",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/simple/input/index.js",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,24 @@\n+import {\n+  exportUsed,\n+  export2Used,\n+  export3Used,\n+  export4Used,\n+  export5Used,\n+  export6Used,\n+} from './inner'\n+import { f1, pureUsed, fWithDefault } from './module'\n+\n+it('export should be unused when only unused functions use it', () => {\n+  f1()\n+  expect(pureUsed).toBe(42)\n+  expect(fWithDefault()).toBe(42)\n+  if (process.env.NODE_ENV === 'production') {\n+    expect(exportUsed).toBe(false)\n+    expect(export2Used).toBe(true)\n+    expect(export3Used).toBe(true)\n+    expect(export4Used).toBe(true)\n+    expect(export5Used).toBe(true)\n+    expect(export6Used).toBe(true)\n+  }\n+  return import('./chunk')\n+})"
        },
        {
            "sha": "96f7387d48d88e454759c4000c3a50d912fbd100",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/simple/input/inner.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Finner.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Finner.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Finner.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,13 @@\n+export const EXPORT = 42\n+export const EXPORT2 = 42\n+export const EXPORT3 = 42\n+export const EXPORT4 = 42\n+export const EXPORT5 = () => 42\n+export const EXPORT6 = () => 42\n+\n+export const exportUsed = __webpack_exports_info__.EXPORT.used\n+export const export2Used = __webpack_exports_info__.EXPORT2.used\n+export const export3Used = __webpack_exports_info__.EXPORT3.used\n+export const export4Used = __webpack_exports_info__.EXPORT4.used\n+export const export5Used = __webpack_exports_info__.EXPORT5.used\n+export const export6Used = __webpack_exports_info__.EXPORT6.used"
        },
        {
            "sha": "5d74e4de251d75d289a1b5bac8052ea401d03182",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/__skipped__/simple/input/module.js",
            "status": "added",
            "additions": 100,
            "deletions": 0,
            "changes": 100,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2F__skipped__%2Fsimple%2Finput%2Fmodule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,100 @@\n+import { EXPORT, EXPORT2, EXPORT3, EXPORT4, EXPORT5, EXPORT6 } from './inner'\n+\n+export function f1() {\n+  // no using EXPORT\n+}\n+\n+export function f2() {\n+  return EXPORT\n+}\n+\n+function f3() {\n+  return EXPORT\n+}\n+\n+const f4 = function () {\n+  return EXPORT\n+}\n+\n+const f5 = () => {\n+  return EXPORT\n+}\n+\n+let f6 = () => {\n+  return EXPORT\n+}\n+\n+const f7 = () => {\n+  return EXPORT5()\n+}\n+\n+const f8 = () => {\n+  return EXPORT6()\n+}\n+\n+export function g2() {\n+  return f2()\n+}\n+\n+export function g3() {\n+  return f3()\n+}\n+\n+export var g4 = () => f4()\n+\n+export let g5 = () => {\n+  return f5()\n+}\n+\n+function ga6() {\n+  return f6() || gb6()\n+}\n+\n+function gb6() {\n+  return ga6()\n+}\n+\n+export class g7 {\n+  static f() {\n+    return EXPORT\n+  }\n+}\n+\n+export const pure1 = EXPORT\n+export const pure2 = /*#__PURE__*/ f6()\n+const pure3 = /*#__PURE__*/ g5()\n+const pure4 = /*#__PURE__*/ f7(f8())\n+const pure5 =\n+  ('fefef', 1123, /*#__PURE__*/ f2('fwefe'), /*#__PURE__*/ f2('efwefa'))\n+const pure6 = /*#__PURE__*/ f2(/*#__PURE__*/ f2(), /*#__PURE__*/ f2())\n+const pure7 = /*#__PURE__*/ f2(\n+  class {\n+    f() {\n+      return EXPORT\n+    }\n+  }\n+)\n+const pure8 = /*#__PURE__*/ f2(() => EXPORT)\n+export const pureUsed = EXPORT3\n+\n+function x1() {\n+  return EXPORT2\n+}\n+\n+const x2 = function x2() {\n+  return x1()\n+}\n+\n+const x3 = () => {\n+  return x2()\n+}\n+\n+const x4 = x3()\n+\n+export function fWithDefault(r = EXPORT4) {\n+  return r\n+}\n+\n+export default (function () {\n+  return EXPORT\n+})"
        },
        {
            "sha": "161107d89d555ab5b1e4e9527778b2bc06ff0254",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/circular/input/chunk.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Fchunk.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Fchunk.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Fchunk.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1 @@\n+import './inner'"
        },
        {
            "sha": "f78fe94a45156dfc24b3c2b1fc0a81d4b0efffcd",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/circular/input/index.js",
            "status": "added",
            "additions": 12,
            "deletions": 0,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,12 @@\n+import { exportAUsed, exportBUsed, exportCUsed } from './inner'\n+import { y } from './module'\n+\n+it('export should be unused when only unused functions use it', () => {\n+  expect(y('a')).toBe('okBAA')\n+  expect(exportAUsed).toBe(true)\n+  expect(exportBUsed).toBe(true)\n+  if (process.env.NODE_ENV === 'production') {\n+    expect(exportCUsed).toBe(false)\n+  }\n+  return import('./chunk')\n+})"
        },
        {
            "sha": "3eacaa19a0e1772faaa1a72244e38ed4da04197c",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/circular/input/inner.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Finner.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Finner.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Finner.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,13 @@\n+export function A(s) {\n+  return s + 'A'\n+}\n+export function B(s) {\n+  return s + 'B'\n+}\n+export function C(s) {\n+  return s + 'C'\n+}\n+\n+export const exportAUsed = __webpack_exports_info__.A.used\n+export const exportBUsed = __webpack_exports_info__.B.used\n+export const exportCUsed = __webpack_exports_info__.C.used"
        },
        {
            "sha": "72b4588ccd796bea693432d8e9fab5850a76776d",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/circular/input/module.js",
            "status": "added",
            "additions": 36,
            "deletions": 0,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular%2Finput%2Fmodule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,36 @@\n+import { A, B, C } from './inner'\n+\n+function x(type) {\n+  switch (type) {\n+    case 'a':\n+      return withA('b')\n+    case 'b':\n+      return withB('c')\n+    case 'c':\n+      return 'ok'\n+  }\n+}\n+\n+function y(v) {\n+  return withA(v)\n+}\n+\n+function withA(v) {\n+  const value = x(v)\n+\n+  return A(value)\n+}\n+\n+function withB(v) {\n+  const value = x(v)\n+\n+  return B(value)\n+}\n+\n+function withC(v) {\n+  const value = x(v)\n+\n+  return C(value)\n+}\n+\n+export { x, y }"
        },
        {
            "sha": "04daf0736ba237dc792a9570ab350a4d182cb303",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/circular2/input/index.js",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular2%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular2%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular2%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,14 @@\n+import { x, y, z, a, f3 } from './module'\n+\n+it('should be able to handle circular referenced', () => {\n+  expect(x()).toEqual([y, z])\n+  const [_a, b, c, d] = a()\n+  expect(b()).toEqual([a, b, c, d])\n+  expect(c()).toEqual([a, b, c, d])\n+  expect(d()).toEqual([a, b, c, d])\n+  const [f2, f4] = f3()\n+  const [f1, _f3] = f2()\n+  expect(_f3).toBe(f3)\n+  expect(f3()).toEqual(f1())\n+  expect(f2()).toEqual(f4())\n+})"
        },
        {
            "sha": "21d5bee206287b8f865408e22b80a4b360ba3cc1",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/circular2/input/module.js",
            "status": "added",
            "additions": 49,
            "deletions": 0,
            "changes": 49,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular2%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular2%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fcircular2%2Finput%2Fmodule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,49 @@\n+function x() {\n+  return [y, z]\n+}\n+\n+function y() {\n+  return [x, z]\n+}\n+\n+function z() {\n+  return [x, y]\n+}\n+\n+export { x, y, z }\n+\n+function a() {\n+  return [a, b, c, d]\n+}\n+\n+function b() {\n+  return [a, b, c, d]\n+}\n+\n+function c() {\n+  return [a, b, c, d]\n+}\n+\n+function d() {\n+  return [a, b, c, d]\n+}\n+\n+export { a }\n+\n+function f1() {\n+  return [f2, f4]\n+}\n+\n+function f2() {\n+  return [f1, f3]\n+}\n+\n+function f3() {\n+  return [f2, f4]\n+}\n+\n+function f4() {\n+  return [f1, f3]\n+}\n+\n+export { f3 }"
        },
        {
            "sha": "d6cbf59b5e668d777e9fbdd0abb944a0e8305fb5",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/class-dynamic-props/input/index.js",
            "status": "added",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,22 @@\n+it('should not throw when using dynamic properties in unused classes', () => {\n+  require('./unused1')\n+})\n+\n+it('should not throw when using dynamic properties in used classes', () => {\n+  const exports = require('./used1')\n+  const x = new exports.Used()\n+  expect(x.a()).toBe('A')\n+  expect(x.b).toBe('B')\n+  expect(x.c).toBe('C')\n+  expect(exports.Used.d()).toBe('D')\n+  expect(exports.Used.e).toBe('E')\n+  expect(exports.Used.f).toBe('F')\n+  const x2 = new exports.Used2()\n+  expect(x2.a()).toBe('A')\n+  expect(x2.b).toBe('B')\n+  expect(x2.c).toBe('C')\n+  expect(exports.Used2.d()).toBe('D')\n+  expect(exports.Used2.e).toBe('E')\n+  expect(exports.Used2.f).toBe('F')\n+  expect(x2.x).toBe('X')\n+})"
        },
        {
            "sha": "2d6050687e775d7a1eee5c60d4eb3be8acd59e79",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/class-dynamic-props/input/module.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Fmodule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,16 @@\n+export const a = () => 'a'\n+export const A = 'A'\n+export const b = 'b'\n+export const B = 'B'\n+export const c = 'c'\n+export const C = 'C'\n+export const d = () => 'd'\n+export const D = 'D'\n+export const e = 'e'\n+export const E = 'E'\n+export const f = 'f'\n+export const F = 'F'\n+export class X {\n+  x = 'X'\n+}\n+export const y = 'y'"
        },
        {
            "sha": "99f1f3de1b7ec9b9f4054db484d4453ddab1316b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/class-dynamic-props/input/test.filter.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Ftest.filter.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Ftest.filter.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Ftest.filter.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+'use strict'\n+\n+const supportsClassFields = require('../../../helpers/supportsClassFields')\n+\n+module.exports = () => supportsClassFields()"
        },
        {
            "sha": "b678e502fb3c48c3cb96632efab4ccedb5008672",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/class-dynamic-props/input/unused1.js",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Funused1.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Funused1.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Funused1.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,37 @@\n+import { a, b, c, d, e, f, A, B, C, D, E, F, X } from './module'\n+\n+class Unused {\n+  [a()]() {\n+    return A\n+  }\n+  [b] = B\n+  get [c]() {\n+    return C\n+  }\n+  static [d()]() {\n+    return D\n+  }\n+  static [e] = E\n+  static get [f]() {\n+    return F\n+  }\n+}\n+\n+class Unused2 extends X {\n+  [a()]() {\n+    return A\n+  }\n+  [b] = B\n+  get [c]() {\n+    return C\n+  }\n+  static [d()]() {\n+    return D\n+  }\n+  static [e] = E\n+  static get [f]() {\n+    return F\n+  }\n+}\n+\n+export {}"
        },
        {
            "sha": "2c50e8c6cc6571f2c34ae500f39a098c3ca9722d",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/class-dynamic-props/input/used1.js",
            "status": "added",
            "additions": 37,
            "deletions": 0,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Fused1.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Fused1.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fclass-dynamic-props%2Finput%2Fused1.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,37 @@\n+import { a, b, c, d, e, f, A, B, C, D, E, F, X } from './module?1'\n+\n+class Used {\n+  [a()]() {\n+    return A\n+  }\n+  [b] = B\n+  get [c]() {\n+    return C\n+  }\n+  static [d()]() {\n+    return D\n+  }\n+  static [e] = E\n+  static get [f]() {\n+    return F\n+  }\n+}\n+\n+class Used2 extends X {\n+  [a()]() {\n+    return A\n+  }\n+  [b] = B\n+  get [c]() {\n+    return C\n+  }\n+  static [d()]() {\n+    return D\n+  }\n+  static [e] = E\n+  static get [f]() {\n+    return F\n+  }\n+}\n+\n+export { Used, Used2 }"
        },
        {
            "sha": "1de2a3db15fc03da20872237adf27fa8f07242d9",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/no-side-effects/input/index.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+it('should be able to load package without side effects where modules are unused', () => {\n+  require('./module')\n+})"
        },
        {
            "sha": "20d3696fcaf69ab53cb12bc82e8d1d2be11fba62",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/no-side-effects/input/module.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fmodule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+import { a } from './package'\n+\n+export default a"
        },
        {
            "sha": "03ad628b54e8983a58f250320c53966963a2c189",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/no-side-effects/input/package/index.js",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fpackage%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fpackage%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fpackage%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,9 @@\n+import value from './unusedModule'\n+\n+export function a() {\n+  return 42\n+}\n+\n+export function b() {\n+  return value\n+}"
        },
        {
            "sha": "a43829151e1423f0641beb1f114773f1c67fda72",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/no-side-effects/input/package/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fpackage%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fpackage%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fpackage%2Fpackage.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "02f8a32637a0367f1bbed0aac7d8baaf12b8730e",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/no-side-effects/input/package/unusedModule.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fpackage%2FunusedModule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fpackage%2FunusedModule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fno-side-effects%2Finput%2Fpackage%2FunusedModule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1 @@\n+export default 42"
        },
        {
            "sha": "8a32dfc7ca1b15e259367f5f0e04e3c403a7cbbb",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/pure-in-removed/input/import-module.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fpure-in-removed%2Finput%2Fimport-module.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fpure-in-removed%2Finput%2Fimport-module.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fpure-in-removed%2Finput%2Fimport-module.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,11 @@\n+import './module?1'\n+import { getX, getY } from './module?2'\n+import { getX as getX2 } from './module?3'\n+import { getY as getY2 } from './module?4'\n+\n+export function test() {\n+  expect(getX()).toBe(42)\n+  expect(getY()).toBe(42)\n+  expect(getX2()).toBe(42)\n+  expect(getY2()).toBe(42)\n+}"
        },
        {
            "sha": "7c7371e7f13057cc08422a1077420df66044429f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/pure-in-removed/input/index.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fpure-in-removed%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fpure-in-removed%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fpure-in-removed%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+it('should generate correct code when pure expressions are in dead branches', () => {\n+  require('./import-module').test()\n+})"
        },
        {
            "sha": "1d5b0d98097f80468402658727affa578b3d9ebf",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/pure-in-removed/input/module.js",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fpure-in-removed%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fpure-in-removed%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fpure-in-removed%2Finput%2Fmodule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,14 @@\n+function f() {\n+  return 43\n+}\n+\n+if (true) {\n+  var x = /*#__PURE__*/ f() - 1\n+  var y = 42\n+} else {\n+  var x = /*#__PURE__*/ f()\n+  var y = 43\n+}\n+\n+export const getX = () => x,\n+  getY = () => y"
        },
        {
            "sha": "828c4a4c4471ff97e65a11712d6516a27c77f7d1",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/reexport-namespace-and-default/input/index.js",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,18 @@\n+import { exportDefaultUsed as export1 } from './package1/script'\n+import { exportDefaultUsed as export2 } from './package1/script2'\n+import { exportDefaultUsed as export3 } from './package2/script'\n+\n+it('should load module correctly', () => {\n+  require('./module')\n+})\n+\n+if (process.env.NODE_ENV === 'production') {\n+  it('default export should be unused', () => {\n+    expect(export1).toBe(false)\n+    expect(export2).toBe(false)\n+  })\n+}\n+\n+it('default export should be used', () => {\n+  expect(export3).toBe(true)\n+})"
        },
        {
            "sha": "ac85c2a1a6c82dd1fa72adcc6b7d18e0d5759b43",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/reexport-namespace-and-default/input/module.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fmodule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,4 @@\n+import * as script from './package1/script'\n+import script1 from './package2/script'\n+\n+export const mod = script1"
        },
        {
            "sha": "d38d26c2bb8372a3abc31a4be02aa373f3829cf3",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/reexport-namespace-and-default/input/package1/script.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+import mod from './script1'\n+export default mod\n+export * from './script1'\n+\n+export const exportDefaultUsed = __webpack_exports_info__.default.used"
        },
        {
            "sha": "4ed1f0f069ad7db5487083bb932d7adc42cd8c00",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/reexport-namespace-and-default/input/package1/script1.js",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript1.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript1.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript1.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,2 @@\n+export * from './script2'\n+export default 1"
        },
        {
            "sha": "388bf92c96513a925938a1e21fb3631bb39f2780",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/reexport-namespace-and-default/input/package1/script2.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript2.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript2.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript2.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import mod from './script3'\n+export default function () {\n+  return mod\n+}\n+export * from './script3'\n+\n+export const exportDefaultUsed = __webpack_exports_info__.default.used"
        },
        {
            "sha": "b0d35f3a137a785de29c84dca38135f2b4c0cdc5",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/reexport-namespace-and-default/input/package1/script3.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript3.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript3.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage1%2Fscript3.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1 @@\n+export default 1"
        },
        {
            "sha": "d38d26c2bb8372a3abc31a4be02aa373f3829cf3",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/reexport-namespace-and-default/input/package2/script.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage2%2Fscript.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage2%2Fscript.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage2%2Fscript.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+import mod from './script1'\n+export default mod\n+export * from './script1'\n+\n+export const exportDefaultUsed = __webpack_exports_info__.default.used"
        },
        {
            "sha": "b0d35f3a137a785de29c84dca38135f2b4c0cdc5",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/reexport-namespace-and-default/input/package2/script1.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage2%2Fscript1.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage2%2Fscript1.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Freexport-namespace-and-default%2Finput%2Fpackage2%2Fscript1.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1 @@\n+export default 1"
        },
        {
            "sha": "c0c3dda2206fadc1758e08d97f72a82eb1f0b831",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/static-of-class/input/chunk.js",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fchunk.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fchunk.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fchunk.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,2 @@\n+import './other/module-unused'\n+import './other/module-used'"
        },
        {
            "sha": "8f6de57d66aebfaccf1d95c4543b0fa999450f19",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/static-of-class/input/import-module.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fimport-module.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fimport-module.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fimport-module.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import './module-unused'\n+import { NativeClass, TranspiledClass } from './module-used'\n+\n+export function test() {\n+  expect(NativeClass.f()).toBe(42)\n+  expect(TranspiledClass.f()).toBe(42)\n+}"
        },
        {
            "sha": "d7e803df7b059b5545698f0ef3ccdda06920cb96",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/static-of-class/input/index.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,4 @@\n+it('should generate correct code when pure expressions are in dead branches', () => {\n+  require('./import-module').test()\n+  return import('./chunk')\n+})"
        },
        {
            "sha": "8808b8de220df50e2606ac9053da08e0ef7193d1",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/static-of-class/input/module-unused.js",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fmodule-unused.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fmodule-unused.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fmodule-unused.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,18 @@\n+import { x } from './other/module-unused'\n+\n+class NativeClass {\n+  static f() {\n+    return 42\n+  }\n+}\n+\n+var TranspiledClass = /*#__PURE__*/ (function () {\n+  x()\n+  function C() {}\n+  C.f = function () {\n+    return 42\n+  }\n+  return C\n+})()\n+\n+export { NativeClass, TranspiledClass }"
        },
        {
            "sha": "35ea038cf5172c300edc7e3713421f90a1dc5422",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/static-of-class/input/module-used.js",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fmodule-used.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fmodule-used.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fmodule-used.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,18 @@\n+import { x } from './other/module-used'\n+\n+class NativeClass {\n+  static f() {\n+    return 42\n+  }\n+}\n+\n+var TranspiledClass = /*#__PURE__*/ (function () {\n+  x()\n+  function C() {}\n+  C.f = function () {\n+    return 42\n+  }\n+  return C\n+})()\n+\n+export { NativeClass, TranspiledClass }"
        },
        {
            "sha": "055ccd29f75b783f9d2f7e8eb183a8a58de74c1a",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/static-of-class/input/other/module-unused.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fother%2Fmodule-unused.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fother%2Fmodule-unused.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fother%2Fmodule-unused.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1 @@\n+export function x() {}"
        },
        {
            "sha": "055ccd29f75b783f9d2f7e8eb183a8a58de74c1a",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/static-of-class/input/other/module-used.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fother%2Fmodule-used.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fother%2Fmodule-used.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fother%2Fmodule-used.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1 @@\n+export function x() {}"
        },
        {
            "sha": "a43829151e1423f0641beb1f114773f1c67fda72",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/static-of-class/input/other/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fother%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fother%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fstatic-of-class%2Finput%2Fother%2Fpackage.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "fee28d7e80be879fb2819aa9554b211ed578d947",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/switch/input/chunk.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fchunk.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fchunk.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fchunk.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1 @@\n+import './some-module'"
        },
        {
            "sha": "769a37ea034dec90e5a48dc6c7a46d974e1cff43",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/switch/input/import-module.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fimport-module.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fimport-module.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fimport-module.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import doSomething from './module'\n+\n+export function test() {\n+  doSomething({\n+    type: 'inline',\n+  })\n+}"
        },
        {
            "sha": "25ea4677ef1bbc5877ddc19eaa36ab0b5630b6fc",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/switch/input/index.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,4 @@\n+it('should generate correct code when pure expressions are in dead branches', () => {\n+  require('./import-module').test()\n+  return Promise.all([import('./some-module'), import('./chunk')])\n+})"
        },
        {
            "sha": "6603428686c7ff03f37c2f08d3c25619a2de945b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/switch/input/module.js",
            "status": "added",
            "additions": 41,
            "deletions": 0,
            "changes": 41,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fmodule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,41 @@\n+import { Block, Inline, Document } from './some-module'\n+\n+function getType(obj) {\n+  return obj.type\n+}\n+\n+// Local functions\n+function doSomethingWithBlock(obj) {\n+  return Block.doSomething(obj)\n+}\n+\n+function doSomethingWithInline(obj) {\n+  return Inline.doSomething(obj)\n+}\n+\n+function doSomethingWithDocument(obj) {\n+  return Document.doSomething(obj)\n+}\n+\n+// Exported functions\n+function doSomething(obj) {\n+  const type = getType(obj)\n+\n+  switch (type) {\n+    case 'document':\n+      return doSomethingWithDocument(obj)\n+    case 'block':\n+      return doSomethingWithBlock(obj)\n+    case 'inline':\n+      return doSomethingWithInline(obj)\n+    default:\n+      throw new Error()\n+  }\n+}\n+\n+function useDocument(obj) {\n+  return doSomethingWithDocument(obj)\n+}\n+\n+export { useDocument }\n+export default doSomething"
        },
        {
            "sha": "28fe094073d217dda1e184598ec93389586b6538",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/switch/input/some-module.js",
            "status": "added",
            "additions": 13,
            "deletions": 0,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fsome-module.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fsome-module.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Fswitch%2Finput%2Fsome-module.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,13 @@\n+class Block {\n+  static doSomething() {}\n+}\n+\n+class Inline {\n+  static doSomething() {}\n+}\n+\n+class Document {\n+  static doSomething() {}\n+}\n+\n+export { Block, Inline, Document }"
        },
        {
            "sha": "22a4f1119d59fb67917d020a51a11f1237b4690b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/try-globals/input/import-module.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Ftry-globals%2Finput%2Fimport-module.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Ftry-globals%2Finput%2Fimport-module.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Ftry-globals%2Finput%2Fimport-module.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,4 @@\n+import { ok, ok2 } from './module'\n+\n+expect(ok).toBe(true)\n+expect(ok2).toBe(true)"
        },
        {
            "sha": "093b95b279efae5a8025caa2d74d7f4bfaf6cb06",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/try-globals/input/index.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Ftry-globals%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Ftry-globals%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Ftry-globals%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+it('should not threat globals as pure', () => {\n+  require('./import-module')\n+})"
        },
        {
            "sha": "6185744ff5be910bf0b3f91375b3b95a04bcb5dd",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/inner-graph/try-globals/input/module.js",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Ftry-globals%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Ftry-globals%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Finner-graph%2Ftry-globals%2Finput%2Fmodule.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,20 @@\n+try {\n+  var x = NOT_DEFINED\n+  var y = x\n+  var ok = false\n+} catch (e) {\n+  var yep = true\n+  var ok = yep\n+}\n+\n+try {\n+  const b = a\n+  var c = b\n+  const a = 42\n+  var ok2 = false\n+  eval('') // TODO terser has a bug and incorrectly remove this code, eval opts out\n+} catch (e) {\n+  var ok2 = true\n+}\n+\n+export { x, y, c, ok, ok2 }"
        },
        {
            "sha": "d5a74c7e75af6b9761ce83f6058c3e4ef7cba476",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot.rs",
            "status": "modified",
            "additions": 35,
            "deletions": 8,
            "changes": 43,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -47,8 +47,8 @@ use turbopack_core::{\n     module::Module,\n     module_graph::{\n         ModuleGraph,\n+        binding_usage_info::compute_binding_usage_info,\n         chunk_group_info::{ChunkGroup, ChunkGroupEntry},\n-        export_usage::compute_export_usage_info,\n     },\n     output::{OutputAsset, OutputAssets, OutputAssetsReference, OutputAssetsWithReferenced},\n     reference_type::{EntryReferenceSubType, ReferenceType},\n@@ -84,6 +84,8 @@ struct SnapshotOptions {\n     #[serde(default)]\n     tree_shaking_mode: Option<TreeShakingMode>,\n     #[serde(default)]\n+    remove_unused_imports: bool,\n+    #[serde(default)]\n     remove_unused_exports: bool,\n     #[serde(default)]\n     scope_hoisting: bool,\n@@ -119,6 +121,7 @@ impl Default for SnapshotOptions {\n             runtime_type: default_runtime_type(),\n             environment: Default::default(),\n             tree_shaking_mode: None,\n+            remove_unused_imports: false,\n             remove_unused_exports: false,\n             scope_hoisting: false,\n             production_chunking: false,\n@@ -426,20 +429,26 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n         bail!(\"Entry module is not chunkable, so it can't be used to bootstrap the application\")\n     };\n \n-    let module_graph = ModuleGraph::from_modules(\n+    let mut module_graph = ModuleGraph::from_modules(\n         Vc::cell(vec![ChunkGroupEntry::Entry(entry_modules.clone())]),\n         false,\n     );\n \n-    let export_usage = if options.remove_unused_exports {\n+    let binding_usage = if options.remove_unused_imports || options.remove_unused_exports {\n         Some(\n-            compute_export_usage_info(module_graph.to_resolved().await?)\n-                .resolve_strongly_consistent()\n-                .await?,\n+            compute_binding_usage_info(\n+                module_graph.to_resolved().await?,\n+                options.remove_unused_imports,\n+            )\n+            .resolve_strongly_consistent()\n+            .await?,\n         )\n     } else {\n         None\n     };\n+    if options.remove_unused_imports {\n+        module_graph = module_graph.without_unused_references(*binding_usage.unwrap());\n+    }\n \n     let chunk_root_path = project_path.join(\"output\")?;\n     let static_root_path = project_path.join(\"static\")?;\n@@ -463,7 +472,16 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n             )\n             .minify_type(options.minify_type)\n             .module_merging(options.scope_hoisting)\n-            .export_usage(export_usage)\n+            .export_usage(\n+                options\n+                    .remove_unused_exports\n+                    .then(|| binding_usage.unwrap()),\n+            )\n+            .unused_references(\n+                options\n+                    .remove_unused_exports\n+                    .then(|| binding_usage.unwrap()),\n+            )\n             .debug_ids(options.enable_debug_ids)\n             .source_map_source_type(options.source_map_source_type);\n \n@@ -495,7 +513,16 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n             )\n             .minify_type(options.minify_type)\n             .module_merging(options.scope_hoisting)\n-            .export_usage(export_usage)\n+            .export_usage(\n+                options\n+                    .remove_unused_exports\n+                    .then(|| binding_usage.unwrap()),\n+            )\n+            .unused_references(\n+                options\n+                    .remove_unused_exports\n+                    .then(|| binding_usage.unwrap()),\n+            )\n             .debug_ids(options.enable_debug_ids)\n             .source_map_source_type(options.source_map_source_type);\n "
        },
        {
            "sha": "32e4d3f2ddc1d2d346d751a7217a0c4e5a41f4aa",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/a.js",
            "status": "added",
            "additions": 16,
            "deletions": 0,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Fa.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,16 @@\n+import { x } from './library/x.js'\n+import { y } from './library/y.js'\n+\n+y()\n+\n+function helper() {\n+  return x()\n+}\n+\n+export function unused() {\n+  return helper()\n+}\n+\n+export function used() {\n+  return 1234\n+}"
        },
        {
            "sha": "4fcaf44f8acd0e2b2bcda5ce456f30fb18a92dcb",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/index.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Findex.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+import { used } from './a.js'\n+\n+console.log(used)"
        },
        {
            "sha": "3d71439d6e19f3f8c03893cbade28ba91a91c7cf",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/leaf.js",
            "status": "added",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fleaf.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fleaf.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fleaf.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,2 @@\n+export function leafX() {}\n+export function leafY() {}"
        },
        {
            "sha": "a43829151e1423f0641beb1f114773f1c67fda72",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fpackage.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "d5ef4d88ffa2782ca188a24b023e89485691ddb4",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/shared.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fshared.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fshared.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fshared.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,8 @@\n+import { leafX, leafY } from './leaf'\n+\n+export function sharedX() {\n+  leafX()\n+}\n+export function sharedY() {\n+  leafY()\n+}"
        },
        {
            "sha": "bf0434f67e7177799b970c5feef4c760a20221dd",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/x.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fx.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fx.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fx.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import { sharedX } from './shared'\n+\n+globalThis.xBundled = true\n+\n+export function x() {\n+  sharedX()\n+}"
        },
        {
            "sha": "40fa1e2e17a14c20d23f1e790b704c69cf9fcc74",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/y.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fy.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fy.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Finput%2Flibrary%2Fy.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,7 @@\n+import { sharedY } from './shared'\n+\n+globalThis.yBundled = true\n+\n+export function y() {\n+  sharedY()\n+}"
        },
        {
            "sha": "1d95339d37a55644db904e387c1b33727ffb7e56",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/options.json",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foptions.json?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,6 @@\n+{\n+  \"scopeHoisting\": false,\n+  \"removeUnusedImports\": true,\n+  \"removeUnusedExports\": true,\n+  \"treeShakingMode\": \"reexports-only\"\n+}"
        },
        {
            "sha": "f75a298914501dfe4763204c146988cf0a84ac18",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/output/780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js",
            "status": "added",
            "additions": 73,
            "deletions": 0,
            "changes": 73,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2F780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2F780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2F780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,73 @@\n+(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([\"output/780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js\",\n+\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/leaf.js [test] (ecmascript)\", ((__turbopack_context__) => {\n+\"use strict\";\n+\n+function leafX() {}\n+function leafY() {}\n+__turbopack_context__.s([\n+    \"leafY\",\n+    ()=>leafY\n+]);\n+}),\n+\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/shared.js [test] (ecmascript)\", ((__turbopack_context__) => {\n+\"use strict\";\n+\n+var __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$library$2f$leaf$2e$js__$5b$test$5d$__$28$ecmascript$29$__ = __turbopack_context__.i(\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/leaf.js [test] (ecmascript)\");\n+;\n+function sharedX() {\n+    (0, __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$library$2f$leaf$2e$js__$5b$test$5d$__$28$ecmascript$29$__[\"leafX\"])();\n+}\n+function sharedY() {\n+    (0, __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$library$2f$leaf$2e$js__$5b$test$5d$__$28$ecmascript$29$__[\"leafY\"])();\n+}\n+__turbopack_context__.s([\n+    \"sharedY\",\n+    ()=>sharedY\n+]);\n+}),\n+\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/y.js [test] (ecmascript)\", ((__turbopack_context__) => {\n+\"use strict\";\n+\n+var __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$library$2f$shared$2e$js__$5b$test$5d$__$28$ecmascript$29$__ = __turbopack_context__.i(\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/shared.js [test] (ecmascript)\");\n+;\n+globalThis.yBundled = true;\n+function y() {\n+    (0, __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$library$2f$shared$2e$js__$5b$test$5d$__$28$ecmascript$29$__[\"sharedY\"])();\n+}\n+__turbopack_context__.s([\n+    \"y\",\n+    ()=>y\n+]);\n+}),\n+\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/a.js [test] (ecmascript)\", ((__turbopack_context__) => {\n+\"use strict\";\n+\n+var __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$library$2f$y$2e$js__$5b$test$5d$__$28$ecmascript$29$__ = __turbopack_context__.i(\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/y.js [test] (ecmascript)\");\n+;\n+;\n+(0, __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$library$2f$y$2e$js__$5b$test$5d$__$28$ecmascript$29$__[\"y\"])();\n+function helper() {\n+    return (0, __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$library$2f$x$2e$js__$5b$test$5d$__$28$ecmascript$29$__[\"x\"])();\n+}\n+function unused() {\n+    return helper();\n+}\n+function used() {\n+    return 1234;\n+}\n+__turbopack_context__.s([\n+    \"used\",\n+    ()=>used\n+]);\n+}),\n+\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/index.js [test] (ecmascript)\", ((__turbopack_context__) => {\n+\"use strict\";\n+\n+var __TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$a$2e$js__$5b$test$5d$__$28$ecmascript$29$__ = __turbopack_context__.i(\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/a.js [test] (ecmascript)\");\n+;\n+console.log(__TURBOPACK__imported__module__$5b$project$5d2f$turbopack$2f$crates$2f$turbopack$2d$tests$2f$tests$2f$snapshot$2f$remove$2d$unused$2d$imports$2f$exports$2f$input$2f$a$2e$js__$5b$test$5d$__$28$ecmascript$29$__[\"used\"]);\n+__turbopack_context__.s([]);\n+}),\n+]);\n+\n+//# sourceMappingURL=780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js.map\n\\ No newline at end of file"
        },
        {
            "sha": "a0232577eeb946d8a97ddb7dc83c88c8f279a57e",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/output/780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js.map",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2F780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js.map",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2F780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2F780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js.map?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,10 @@\n+{\n+  \"version\": 3,\n+  \"sources\": [],\n+  \"sections\": [\n+    {\"offset\": {\"line\": 4, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/leaf.js\"],\"sourcesContent\":[\"export function leafX() {}\\nexport function leafY() {}\\n\"],\"names\":[],\"mappings\":\"AAAO,SAAS,SAAS;AAClB,SAAS,SAAS\"}},\n+    {\"offset\": {\"line\": 14, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/shared.js\"],\"sourcesContent\":[\"import { leafX, leafY } from './leaf'\\n\\nexport function sharedX() {\\n  leafX()\\n}\\nexport function sharedY() {\\n  leafY()\\n}\\n\"],\"names\":[],\"mappings\":\"AAAA;;AAEO,SAAS;IACd,IAAA,uOAAK;AACP;AACO,SAAS;IACd,IAAA,uOAAK;AACP\"}},\n+    {\"offset\": {\"line\": 30, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/library/y.js\"],\"sourcesContent\":[\"import { sharedY } from './shared'\\n\\nglobalThis.yBundled = true\\n\\nexport function y() {\\n  sharedY()\\n}\\n\"],\"names\":[],\"mappings\":\"AAAA;;AAEA,WAAW,QAAQ,GAAG;AAEf,SAAS;IACd,IAAA,2OAAO;AACT\"}},\n+    {\"offset\": {\"line\": 44, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/a.js\"],\"sourcesContent\":[\"import { x } from './library/x.js'\\nimport { y } from './library/y.js'\\n\\ny()\\n\\nfunction helper() {\\n  return x()\\n}\\n\\nexport function unused() {\\n  return helper()\\n}\\n\\nexport function used() {\\n  return 1234\\n}\\n\"],\"names\":[],\"mappings\":\"AACA;;;AAEA,IAAA,gOAAC;AAED,SAAS;IACP,OAAO,IAAA,gOAAC;AACV;AAEO,SAAS;IACd,OAAO;AACT;AAEO,SAAS;IACd,OAAO;AACT\"}},\n+    {\"offset\": {\"line\": 65, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/index.js\"],\"sourcesContent\":[\"import { used } from './a.js'\\n\\nconsole.log(used)\\n\"],\"names\":[],\"mappings\":\"AAAA;;AAEA,QAAQ,GAAG,CAAC,wNAAI\"}}]\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "db73f3a39158a361585979e726c211271d219a39",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/output/ad3e4_tests_snapshot_remove-unused-imports_exports_input_index_a89415f0.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2Fad3e4_tests_snapshot_remove-unused-imports_exports_input_index_a89415f0.js",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2Fad3e4_tests_snapshot_remove-unused-imports_exports_input_index_a89415f0.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2Fad3e4_tests_snapshot_remove-unused-imports_exports_input_index_a89415f0.js?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+(globalThis.TURBOPACK || (globalThis.TURBOPACK = [])).push([\n+    \"output/ad3e4_tests_snapshot_remove-unused-imports_exports_input_index_a89415f0.js\",\n+    {\"otherChunks\":[\"output/780ce_turbopack-tests_tests_snapshot_remove-unused-imports_exports_input_19985db1._.js\"],\"runtimeModuleIds\":[\"[project]/turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/input/index.js [test] (ecmascript)\"]}\n+]);\n+// Dummy runtime\n\\ No newline at end of file"
        },
        {
            "sha": "c15d7ec00382d3604310ddb8b53cbdb90d9e1942",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/remove-unused-imports/exports/output/bf321_tests_snapshot_remove-unused-imports_exports_input_index_a89415f0.js.map",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2Fbf321_tests_snapshot_remove-unused-imports_exports_input_index_a89415f0.js.map",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2Fbf321_tests_snapshot_remove-unused-imports_exports_input_index_a89415f0.js.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fremove-unused-imports%2Fexports%2Foutput%2Fbf321_tests_snapshot_remove-unused-imports_exports_input_index_a89415f0.js.map?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -0,0 +1,5 @@\n+{\n+  \"version\": 3,\n+  \"sources\": [],\n+  \"sections\": []\n+}\n\\ No newline at end of file"
        },
        {
            "sha": "294d866b4193d203d03b3f87fe572b49a3f11d32",
            "filename": "turbopack/crates/turbopack/src/global_module_ids.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fglobal_module_ids.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/bb1a57288f888665031d715b86fca512b8e3b5f2/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fglobal_module_ids.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fglobal_module_ids.rs?ref=bb1a57288f888665031d715b86fca512b8e3b5f2",
            "patch": "@@ -31,13 +31,13 @@ pub async fn get_global_module_id_strategy(\n         // And additionally, all the modules that are inserted by chunking (i.e. async loaders)\n         let mut async_idents = vec![];\n         module_graph.traverse_all_edges_unordered(|parent, current| {\n-            if let (\n+            if let Some((\n                 _,\n                 &RefData {\n                     chunking_type: ChunkingType::Async,\n                     ..\n                 },\n-            ) = parent\n+            )) = parent\n             {\n                 let module = ResolvedVc::try_sidecast::<Box<dyn ChunkableModule>>(current)\n                     .context(\"expected chunkable module for async reference\")?;"
        }
    ],
    "stats": {
        "total": 3707,
        "additions": 3202,
        "deletions": 505
    }
}