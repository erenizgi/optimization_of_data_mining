{
    "author": "sokra",
    "message": "Turbopack: use batch add to add initial followers (#85624)\n\n### What?\n\nuse batch add to convert children to followers",
    "sha": "5080ce5383fc5eab3cd7e8b0e1c21cef763d6391",
    "files": [
        {
            "sha": "d287b0d40d1235d16968a77ea760e4b118239ddd",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/operation/aggregation_update.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/5080ce5383fc5eab3cd7e8b0e1c21cef763d6391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Faggregation_update.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/5080ce5383fc5eab3cd7e8b0e1c21cef763d6391/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Faggregation_update.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Foperation%2Faggregation_update.rs?ref=5080ce5383fc5eab3cd7e8b0e1c21cef763d6391",
            "patch": "@@ -31,8 +31,8 @@ use crate::{\n         storage::{count, get, get_many, iter_many, remove, update, update_count},\n     },\n     data::{\n-        ActivenessState, AggregationNumber, CachedDataItem, CachedDataItemKey, CollectibleRef,\n-        DirtyContainerCount,\n+        ActivenessState, AggregationNumber, CachedDataItem, CachedDataItemKey, CachedDataItemType,\n+        CollectibleRef, DirtyContainerCount,\n     },\n     utils::swap_retain,\n };\n@@ -2295,12 +2295,12 @@ impl AggregationUpdateQueue {\n                 // When converted from leaf to aggregating node, all children become\n                 // followers\n                 let children: Vec<_> = get_many!(task, Child { task } => task);\n-                for child_id in children {\n-                    task.add_new(CachedDataItem::Follower {\n-                        task: child_id,\n-                        value: 1,\n-                    });\n-                }\n+                task.extend_new(\n+                    CachedDataItemType::Follower,\n+                    children\n+                        .iter()\n+                        .map(|&task| CachedDataItem::Follower { task, value: 1 }),\n+                );\n             }\n \n             if is_aggregating_node(aggregation_number) {"
        }
    ],
    "stats": {
        "total": 16,
        "additions": 8,
        "deletions": 8
    }
}