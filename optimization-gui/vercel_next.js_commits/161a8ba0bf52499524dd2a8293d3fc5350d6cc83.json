{
    "author": "mischnic",
    "message": "Test that there are no server-side CSS chunks (#82471)\n\nA few months ago, this was fixed  for Turbopack. Adding a regression test now",
    "sha": "161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
    "files": [
        {
            "sha": "70415837bf1a25fb0ede2d4afffac6d574fa9179",
            "filename": "test/e2e/app-dir/css-server-chunks/app/client/page.tsx",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fapp%2Fclient%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fapp%2Fclient%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fapp%2Fclient%2Fpage.tsx?ref=161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
            "patch": "@@ -0,0 +1,8 @@\n+'use client'\n+\n+import '../../global.css'\n+import styles from '../../styles.module.css'\n+\n+export default function Page() {\n+  return <div className={styles.foo}>Hello</div>\n+}"
        },
        {
            "sha": "e7077399c03ce1479a655dc647c0545b64531628",
            "filename": "test/e2e/app-dir/css-server-chunks/app/layout.tsx",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fapp%2Flayout.tsx?ref=161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
            "patch": "@@ -0,0 +1,7 @@\n+export default function Root({ children }: { children: React.ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "b30723fe36fccc7382490e3ffc0af99ac1fbacf9",
            "filename": "test/e2e/app-dir/css-server-chunks/app/server/page.tsx",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fapp%2Fserver%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fapp%2Fserver%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fapp%2Fserver%2Fpage.tsx?ref=161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
            "patch": "@@ -0,0 +1,6 @@\n+import '../../global.css'\n+import styles from '../../styles.module.css'\n+\n+export default function Page() {\n+  return <div className={styles.foo}>Hello</div>\n+}"
        },
        {
            "sha": "7b955c0aa03206a16b6bff873f1983f062cb860d",
            "filename": "test/e2e/app-dir/css-server-chunks/css-server-chunks.test.ts",
            "status": "added",
            "additions": 47,
            "deletions": 0,
            "changes": 47,
            "blob_url": "https://github.com/vercel/next.js/blob/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fcss-server-chunks.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fcss-server-chunks.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fcss-server-chunks.test.ts?ref=161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
            "patch": "@@ -0,0 +1,47 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import fs from 'node:fs/promises'\n+import path from 'node:path'\n+\n+describe('css-server-chunks', () => {\n+  const { next, skipped } = nextTestSetup({\n+    files: __dirname,\n+    skipDeployment: true,\n+  })\n+\n+  if (skipped) {\n+    return\n+  }\n+\n+  it('should not write CSS chunks for the server', async () => {\n+    // Fetch all routes to compile them in development\n+    expect((await next.fetch('/client')).status).toBe(200)\n+    expect((await next.fetch('/server')).status).toBe(200)\n+    expect((await next.fetch('/pages')).status).toBe(200)\n+\n+    let clientChunks = (\n+      await fs.readdir(path.join(next.testDir, '.next', 'static'), {\n+        recursive: true,\n+      })\n+    ).filter((f) => f.endsWith('.js') || f.endsWith('.css'))\n+    expect(clientChunks).toEqual(\n+      expect.arrayContaining([expect.stringMatching(/\\.css$/)])\n+    )\n+\n+    let serverChunks = (\n+      await Promise.all(\n+        ['.next/server/app', '.next/server/pages'].map((d) =>\n+          fs.readdir(path.join(next.testDir, d), {\n+            recursive: true,\n+            encoding: 'utf8',\n+          })\n+        )\n+      )\n+    )\n+      .flat()\n+      .filter((f) => f.endsWith('.js') || f.endsWith('.css'))\n+    expect(serverChunks).not.toBeEmpty()\n+    expect(serverChunks).not.toEqual(\n+      expect.arrayContaining([expect.stringMatching(/\\.css$/)])\n+    )\n+  })\n+})"
        },
        {
            "sha": "7cfe2bf44904e7286d1c592b8bd852092ebdc1ac",
            "filename": "test/e2e/app-dir/css-server-chunks/global.css",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fglobal.css",
            "raw_url": "https://github.com/vercel/next.js/raw/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fglobal.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fglobal.css?ref=161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
            "patch": "@@ -0,0 +1,3 @@\n+body {\n+  color: blue;\n+}"
        },
        {
            "sha": "807126e4cf0bf5b1c8c917e6e0148a27331587d1",
            "filename": "test/e2e/app-dir/css-server-chunks/next.config.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fnext.config.js?ref=161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
            "patch": "@@ -0,0 +1,6 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "b1d349b938ecfec756caf9b431388b8ddf2c1b38",
            "filename": "test/e2e/app-dir/css-server-chunks/pages/_app.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fpages%2F_app.js",
            "raw_url": "https://github.com/vercel/next.js/raw/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fpages%2F_app.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fpages%2F_app.js?ref=161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
            "patch": "@@ -0,0 +1,5 @@\n+import '../global.css'\n+\n+export default function App({ Component, pageProps }) {\n+  return <Component {...pageProps} />\n+}"
        },
        {
            "sha": "32d80f013b9e7dd3c1a3e248579011cf7030ef1d",
            "filename": "test/e2e/app-dir/css-server-chunks/pages/pages.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fpages%2Fpages.js",
            "raw_url": "https://github.com/vercel/next.js/raw/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fpages%2Fpages.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fpages%2Fpages.js?ref=161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
            "patch": "@@ -0,0 +1,5 @@\n+import styles from '../styles.module.css'\n+\n+export default function Page() {\n+  return <div className={styles.foo}>Hello</div>\n+}"
        },
        {
            "sha": "a15c877ac01f4146af0d179f365960a37fe4632e",
            "filename": "test/e2e/app-dir/css-server-chunks/styles.module.css",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fstyles.module.css",
            "raw_url": "https://github.com/vercel/next.js/raw/161a8ba0bf52499524dd2a8293d3fc5350d6cc83/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fstyles.module.css",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fcss-server-chunks%2Fstyles.module.css?ref=161a8ba0bf52499524dd2a8293d3fc5350d6cc83",
            "patch": "@@ -0,0 +1,3 @@\n+.foo {\n+  color: red;\n+}"
        }
    ],
    "stats": {
        "total": 90,
        "additions": 90,
        "deletions": 0
    }
}