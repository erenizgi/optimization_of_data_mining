{
    "author": "devjiwonchoi",
    "message": "[dev-overlay] add error env name label (#76003)",
    "sha": "0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
    "files": [
        {
            "sha": "789a7b1a38863c8ce80f0f6fc10a91cff656096f",
            "filename": "packages/next/src/client/components/errors/console-error.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fconsole-error.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fconsole-error.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fconsole-error.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -7,14 +7,23 @@ const consoleTypeSym = Symbol.for('next.console.error.type')\n type UnhandledError = Error & {\n   [digestSym]: 'NEXT_UNHANDLED_ERROR'\n   [consoleTypeSym]: 'string' | 'error'\n+  environmentName: string\n }\n \n-export function createUnhandledError(message: string | Error): UnhandledError {\n+export function createUnhandledError(\n+  message: string | Error,\n+  environmentName?: string | null\n+): UnhandledError {\n   const error = (\n     typeof message === 'string' ? new Error(message) : message\n   ) as UnhandledError\n   error[digestSym] = 'NEXT_UNHANDLED_ERROR'\n   error[consoleTypeSym] = typeof message === 'string' ? 'string' : 'error'\n+\n+  if (environmentName && !error.environmentName) {\n+    error.environmentName = environmentName\n+  }\n+\n   return error\n }\n "
        },
        {
            "sha": "7fa35728e9531943b85b2de8cca1d1836052104f",
            "filename": "packages/next/src/client/components/errors/use-error-handler.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fuse-error-handler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fuse-error-handler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fuse-error-handler.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -2,7 +2,7 @@ import { useEffect } from 'react'\n import { attachHydrationErrorState } from './attach-hydration-error-state'\n import { isNextRouterError } from '../is-next-router-error'\n import { storeHydrationErrorStateFromConsoleArgs } from './hydration-error-info'\n-import { formatConsoleArgs } from '../../lib/console'\n+import { formatConsoleArgs, parseConsoleArgs } from '../../lib/console'\n import isError from '../../../lib/is-error'\n import { createUnhandledError } from './console-error'\n import { enqueueConsecutiveDedupedError } from './enqueue-client-error'\n@@ -27,7 +27,8 @@ export function handleClientError(\n   if (!originError || !isError(originError)) {\n     // If it's not an error, format the args into an error\n     const formattedErrorMessage = formatConsoleArgs(consoleErrorArgs)\n-    error = createUnhandledError(formattedErrorMessage)\n+    const { environmentName } = parseConsoleArgs(consoleErrorArgs)\n+    error = createUnhandledError(formattedErrorMessage, environmentName)\n   } else {\n     error = capturedFromConsole\n       ? createUnhandledError(originError)"
        },
        {
            "sha": "02816adc5f257ab14aa96d5300dad2fb9e6279f3",
            "filename": "packages/next/src/client/components/globals/intercept-console-error.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 32,
            "changes": 34,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fglobals%2Fintercept-console-error.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fglobals%2Fintercept-console-error.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fglobals%2Fintercept-console-error.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -1,6 +1,7 @@\n import isError from '../../../lib/is-error'\n import { isNextRouterError } from '../is-next-router-error'\n import { handleClientError } from '../errors/use-error-handler'\n+import { parseConsoleArgs } from '../../lib/console'\n \n export const originConsoleError = window.console.error\n \n@@ -13,7 +14,7 @@ export function patchConsoleError() {\n   window.console.error = function error(...args: any[]) {\n     let maybeError: unknown\n     if (process.env.NODE_ENV !== 'production') {\n-      const replayedError = matchReplayedError(...args)\n+      const { error: replayedError } = parseConsoleArgs(args)\n       if (replayedError) {\n         maybeError = replayedError\n       } else if (isError(args[0])) {\n@@ -41,34 +42,3 @@ export function patchConsoleError() {\n     }\n   }\n }\n-\n-function matchReplayedError(...args: unknown[]): Error | null {\n-  // See\n-  // https://github.com/facebook/react/blob/65a56d0e99261481c721334a3ec4561d173594cd/packages/react-devtools-shared/src/backend/flight/renderer.js#L88-L93\n-  //\n-  // Logs replayed from the server look like this:\n-  // [\n-  //   \"%c%s%c %o\\n\\n%s\\n\\n%s\\n\",\n-  //   \"background: #e6e6e6; ...\",\n-  //   \" Server \", // can also be e.g. \" Prerender \"\n-  //   \"\",\n-  //   Error\n-  //   \"The above error occurred in the <Page> component.\"\n-  //   ...\n-  // ]\n-  if (\n-    args.length > 3 &&\n-    typeof args[0] === 'string' &&\n-    args[0].startsWith('%c%s%c ') &&\n-    typeof args[1] === 'string' &&\n-    typeof args[2] === 'string' &&\n-    typeof args[3] === 'string'\n-  ) {\n-    const maybeError = args[4]\n-    if (isError(maybeError)) {\n-      return maybeError\n-    }\n-  }\n-\n-  return null\n-}"
        },
        {
            "sha": "932e3c9ac7abda53533701d7967942cf58e00a9f",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/environment-name-label/environment-name-label.stories.tsx",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fenvironment-name-label%2Fenvironment-name-label.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fenvironment-name-label%2Fenvironment-name-label.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fenvironment-name-label%2Fenvironment-name-label.stories.tsx?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -0,0 +1,32 @@\n+import type { Meta, StoryObj } from '@storybook/react'\n+import { EnvironmentNameLabel } from './environment-name-label'\n+import { withShadowPortal } from '../../../storybook/with-shadow-portal'\n+\n+const meta: Meta<typeof EnvironmentNameLabel> = {\n+  component: EnvironmentNameLabel,\n+  parameters: {\n+    layout: 'centered',\n+  },\n+  decorators: [withShadowPortal],\n+}\n+\n+export default meta\n+type Story = StoryObj<typeof EnvironmentNameLabel>\n+\n+export const Server: Story = {\n+  args: {\n+    environmentName: 'Server',\n+  },\n+}\n+\n+export const Prerender: Story = {\n+  args: {\n+    environmentName: 'Prerender',\n+  },\n+}\n+\n+export const Cache: Story = {\n+  args: {\n+    environmentName: 'Cache',\n+  },\n+}"
        },
        {
            "sha": "92109a75d82412ec914fce7f9bef100af3c8d991",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/environment-name-label/environment-name-label.tsx",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fenvironment-name-label%2Fenvironment-name-label.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fenvironment-name-label%2Fenvironment-name-label.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Fenvironment-name-label%2Fenvironment-name-label.tsx?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -0,0 +1,24 @@\n+import { noop as css } from '../../../helpers/noop-template'\n+\n+export function EnvironmentNameLabel({\n+  environmentName,\n+}: {\n+  environmentName: string\n+}) {\n+  return <span data-nextjs-environment-name-label>{environmentName}</span>\n+}\n+\n+export const ENVIRONMENT_NAME_LABEL_STYLES = css`\n+  [data-nextjs-environment-name-label] {\n+    padding: var(--size-0_5) var(--size-1_5);\n+    margin: 0;\n+    /* used --size instead of --rounded because --rounded is missing 6px */\n+    border-radius: var(--size-1_5);\n+    background: var(--color-gray-300);\n+    font-weight: 600;\n+    font-size: var(--size-font-11);\n+    color: var(--color-gray-900);\n+    font-family: var(--font-stack-monospace);\n+    line-height: var(--size-5);\n+  }\n+`"
        },
        {
            "sha": "21b0896cdc65f22dc99a6dcd77d7b7438eb3b92f",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/error-overlay-layout/error-overlay-layout.tsx",
            "status": "modified",
            "additions": 16,
            "deletions": 2,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.tsx?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -33,13 +33,14 @@ import { OVERLAY_STYLES, ErrorOverlayOverlay } from '../overlay/overlay'\n import { ErrorOverlayBottomStack } from '../error-overlay-bottom-stack'\n import type { ErrorBaseProps } from '../error-overlay/error-overlay'\n import type { ReadyRuntimeError } from '../../../../../internal/helpers/get-error-by-type'\n+import { EnvironmentNameLabel } from '../environment-name-label/environment-name-label'\n \n interface ErrorOverlayLayoutProps extends ErrorBaseProps {\n   errorMessage: ErrorMessageType\n   errorType: ErrorType\n   children?: React.ReactNode\n   errorCode?: string\n-  error: Error\n+  error: ReadyRuntimeError['error']\n   debugInfo?: DebugInfo\n   isBuildError?: boolean\n   onClose?: () => void\n@@ -97,7 +98,14 @@ export function ErrorOverlayLayout({\n                 // allow assertion in tests before error rating is implemented\n                 data-nextjs-error-code={errorCode}\n               >\n-                <ErrorTypeLabel errorType={errorType} />\n+                <span data-nextjs-error-label-group>\n+                  <ErrorTypeLabel errorType={errorType} />\n+                  {error.environmentName && (\n+                    <EnvironmentNameLabel\n+                      environmentName={error.environmentName}\n+                    />\n+                  )}\n+                </span>\n                 <ErrorOverlayToolbar error={error} debugInfo={debugInfo} />\n               </div>\n               <ErrorMessage errorMessage={errorMessage} />\n@@ -141,4 +149,10 @@ export const styles = css`\n   ${errorMessageStyles}\n   ${toolbarStyles}\n   ${CALL_STACK_STYLES}\n+\n+  [data-nextjs-error-label-group] {\n+    display: flex;\n+    align-items: center;\n+    gap: var(--size-2);\n+  }\n `"
        },
        {
            "sha": "1a1d88378cdff1e757ee5473037540ced7ee902a",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/components/errors/error-type-label/error-type-label.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-type-label%2Ferror-type-label.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-type-label%2Ferror-type-label.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcomponents%2Ferrors%2Ferror-type-label%2Ferror-type-label.tsx?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -28,7 +28,7 @@ export const styles = css`\n     margin: 0;\n     /* used --size instead of --rounded because --rounded is missing 6px */\n     border-radius: var(--size-1_5);\n-    background: var(--color-red-100);\n+    background: var(--color-red-300);\n     font-weight: 600;\n     font-size: var(--size-font-11);\n     color: var(--color-red-900);"
        },
        {
            "sha": "6e8831e916930ceba709f07c631c10b8f27e92f2",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/container/errors.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcontainer%2Ferrors.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcontainer%2Ferrors.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fcontainer%2Ferrors.tsx?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -53,16 +53,22 @@ function ErrorDescription({\n       ? ''\n       : error.name + ': '\n \n-  // If it's replayed error, display the environment name\n   const environmentName =\n-    'environmentName' in error ? error['environmentName'] : ''\n+    'environmentName' in error ? error.environmentName : ''\n   const envPrefix = environmentName ? `[ ${environmentName} ] ` : ''\n+\n+  // The environment name will be displayed as a label, so remove it\n+  // from the message (e.g. \"[ Server ] hello world\" -> \"hello world\").\n+  let message = error.message\n+  if (message.startsWith(envPrefix)) {\n+    message = message.slice(envPrefix.length)\n+  }\n+\n   return (\n     <>\n-      {envPrefix}\n       {title}\n       <HotlinkedText\n-        text={hydrationWarning || error.message}\n+        text={hydrationWarning || message}\n         matcher={isNextjsLink}\n       />\n     </>"
        },
        {
            "sha": "5aaae5ba598a7ab76ba9959424db76a376544169",
            "filename": "packages/next/src/client/components/react-dev-overlay/_experimental/internal/styles/component-styles.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fstyles%2Fcomponent-styles.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fstyles%2Fcomponent-styles.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2F_experimental%2Finternal%2Fstyles%2Fcomponent-styles.tsx?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -16,13 +16,14 @@ import { CALL_STACK_FRAME_STYLES } from '../components/call-stack-frame/call-sta\n import { styles as devToolsIndicator } from '../components/errors/dev-tools-indicator/styles'\n import { noop as css } from '../helpers/noop-template'\n import { EDITOR_LINK_STYLES } from '../components/terminal/editor-link'\n-\n+import { ENVIRONMENT_NAME_LABEL_STYLES } from '../components/errors/environment-name-label/environment-name-label'\n export function ComponentStyles() {\n   return (\n     <style>\n       {css`\n         ${COPY_BUTTON_STYLES}\n         ${CALL_STACK_FRAME_STYLES}\n+        ${ENVIRONMENT_NAME_LABEL_STYLES}\n         ${overlay}\n         ${toast}\n         ${dialog}"
        },
        {
            "sha": "6f8d4115a3dad3e1bfdfc80fcf4e04367771ca66",
            "filename": "packages/next/src/client/components/react-dev-overlay/internal/container/Errors.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Finternal%2Fcontainer%2FErrors.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Finternal%2Fcontainer%2FErrors.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Finternal%2Fcontainer%2FErrors.tsx?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -84,9 +84,10 @@ function ErrorDescription({\n   const environmentName =\n     'environmentName' in error ? error['environmentName'] : ''\n   const envPrefix = environmentName ? `[ ${environmentName} ] ` : ''\n+  const isMsgMissingEnvPrefix = !error.message.startsWith(envPrefix)\n   return (\n     <>\n-      {envPrefix}\n+      {isMsgMissingEnvPrefix && envPrefix}\n       {title}\n       <HotlinkedText\n         text={hydrationWarning || error.message}"
        },
        {
            "sha": "50ec9eeba6fbc840009874277194fda6562be93b",
            "filename": "packages/next/src/client/components/react-dev-overlay/internal/helpers/get-error-by-type.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Finternal%2Fhelpers%2Fget-error-by-type.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Finternal%2Fhelpers%2Fget-error-by-type.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Finternal%2Fhelpers%2Fget-error-by-type.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -12,7 +12,7 @@ import React from 'react'\n export type ReadyRuntimeError = {\n   id: number\n   runtime: true\n-  error: Error\n+  error: Error & { environmentName?: string }\n   frames: OriginalStackFrame[] | (() => Promise<OriginalStackFrame[]>)\n   componentStackFrames?: ComponentStackFrame[]\n }"
        },
        {
            "sha": "30507e78c6981d488d730e8a38b685366f98d556",
            "filename": "packages/next/src/client/lib/console.ts",
            "status": "modified",
            "additions": 42,
            "deletions": 0,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Flib%2Fconsole.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/packages%2Fnext%2Fsrc%2Fclient%2Flib%2Fconsole.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Flib%2Fconsole.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -1,3 +1,5 @@\n+import isError from '../../lib/is-error'\n+\n function formatObject(arg: unknown, depth: number) {\n   switch (typeof arg) {\n     case 'object':\n@@ -109,3 +111,43 @@ export function formatConsoleArgs(args: unknown[]): string {\n \n   return result\n }\n+\n+export function parseConsoleArgs(args: unknown[]): {\n+  environmentName: string | null\n+  error: Error | null\n+} {\n+  // See\n+  // https://github.com/facebook/react/blob/65a56d0e99261481c721334a3ec4561d173594cd/packages/react-devtools-shared/src/backend/flight/renderer.js#L88-L93\n+  //\n+  // Logs replayed from the server look like this:\n+  // [\n+  //   \"%c%s%c %o\\n\\n%s\\n\\n%s\\n\",\n+  //   \"background: #e6e6e6; ...\",\n+  //   \" Server \", // can also be e.g. \" Prerender \"\n+  //   \"\",\n+  //   Error,\n+  //   \"The above error occurred in the <Page> component.\",\n+  //   ...\n+  // ]\n+  if (\n+    args.length > 3 &&\n+    typeof args[0] === 'string' &&\n+    args[0].startsWith('%c%s%c ') &&\n+    typeof args[1] === 'string' &&\n+    typeof args[2] === 'string' &&\n+    typeof args[3] === 'string'\n+  ) {\n+    const environmentName = args[2]\n+    const maybeError = args[4]\n+\n+    return {\n+      environmentName: environmentName.trim(),\n+      error: isError(maybeError) ? maybeError : null,\n+    }\n+  }\n+\n+  return {\n+    environmentName: null,\n+    error: null,\n+  }\n+}"
        },
        {
            "sha": "bf5597fdcfb9f9bbc8e5e3bfdacdcc2158d4d3d0",
            "filename": "test/development/acceptance-app/dynamic-error.test.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 3,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fdevelopment%2Facceptance-app%2Fdynamic-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fdevelopment%2Facceptance-app%2Fdynamic-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fdynamic-error.test.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -31,8 +31,15 @@ describe('dynamic = \"error\" in devmode', () => {\n     )\n     const { session } = sandbox\n     await session.assertHasRedbox()\n-    expect(await session.getRedboxDescription()).toMatchInlineSnapshot(\n-      `\"[ Server ] Error: Route /server with \\`dynamic = \"error\"\\` couldn't be rendered statically because it used \\`cookies\\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering\"`\n-    )\n+    const description = await session.getRedboxDescription()\n+    if (process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true') {\n+      expect(description).toMatchInlineSnapshot(\n+        `\"Error: Route /server with \\`dynamic = \"error\"\\` couldn't be rendered statically because it used \\`cookies\\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering\"`\n+      )\n+    } else {\n+      expect(description).toMatchInlineSnapshot(\n+        `\"[ Server ] Error: Route /server with \\`dynamic = \"error\"\\` couldn't be rendered statically because it used \\`cookies\\`. See more info here: https://nextjs.org/docs/app/building-your-application/rendering/static-and-dynamic#dynamic-rendering\"`\n+      )\n+    }\n   })\n })"
        },
        {
            "sha": "94c1db4368eef77471062846298e511e0293dd2b",
            "filename": "test/development/app-dir/capture-console-error-owner-stack/capture-console-error-owner-stack.test.ts",
            "status": "modified",
            "additions": 28,
            "deletions": 3,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fdevelopment%2Fapp-dir%2Fcapture-console-error-owner-stack%2Fcapture-console-error-owner-stack.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fdevelopment%2Fapp-dir%2Fcapture-console-error-owner-stack%2Fcapture-console-error-owner-stack.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcapture-console-error-owner-stack%2Fcapture-console-error-owner-stack.test.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -203,8 +203,32 @@ describe('app-dir - capture-console-error-owner-stack', () => {\n \n     const result = await getRedboxResult(browser)\n \n-    if (process.env.TURBOPACK) {\n+    if (process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true') {\n       expect(result).toMatchInlineSnapshot(`\n+         {\n+           \"callStacks\": \"Page\n+         app/rsc/page.js (2:17)\n+         JSON.parse\n+         <anonymous> (0:0)\n+         Page\n+         <anonymous> (0:0)\",\n+           \"count\": 1,\n+           \"description\": \"Error: boom\",\n+           \"source\": \"app/rsc/page.js (2:17) @ Page\n+\n+           1 | export default function Page() {\n+         > 2 |   console.error(new Error('boom'))\n+             |                 ^\n+           3 |   return <p>rsc</p>\n+           4 | }\n+           5 |\",\n+           \"title\": \"Console Error\n+         Server\",\n+         }\n+        `)\n+    } else {\n+      if (process.env.TURBOPACK) {\n+        expect(result).toMatchInlineSnapshot(`\n        {\n          \"callStacks\": \"Page\n        app/rsc/page.js (2:17)\n@@ -225,8 +249,8 @@ describe('app-dir - capture-console-error-owner-stack', () => {\n          \"title\": \"Console Error\",\n        }\n       `)\n-    } else {\n-      expect(result).toMatchInlineSnapshot(`\n+      } else {\n+        expect(result).toMatchInlineSnapshot(`\n        {\n          \"callStacks\": \"Page\n        app/rsc/page.js (2:17)\n@@ -247,6 +271,7 @@ describe('app-dir - capture-console-error-owner-stack', () => {\n          \"title\": \"Console Error\",\n        }\n       `)\n+      }\n     }\n   })\n "
        },
        {
            "sha": "fb8f4249246faaa80c7d2d8d2e9951f9021f679e",
            "filename": "test/development/app-dir/dynamic-io-dev-errors/dynamic-io-dev-errors.test.ts",
            "status": "modified",
            "additions": 30,
            "deletions": 10,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fdevelopment%2Fapp-dir%2Fdynamic-io-dev-errors%2Fdynamic-io-dev-errors.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fdevelopment%2Fapp-dir%2Fdynamic-io-dev-errors%2Fdynamic-io-dev-errors.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdynamic-io-dev-errors%2Fdynamic-io-dev-errors.test.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -19,14 +19,23 @@ describe('Dynamic IO Dev Errors', () => {\n     files: __dirname,\n   })\n \n+  const isNewOverlay =\n+    process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+\n   it('should show a red box error on the SSR render', async () => {\n     const browser = await next.browser('/error')\n \n     await openRedbox(browser)\n \n-    expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n-      `\"[ Server ] Error: Route \"/error\" used \\`Math.random()\\` outside of \\`\"use cache\"\\` and without explicitly calling \\`await connection()\\` beforehand. See more info here: https://nextjs.org/docs/messages/next-prerender-random\"`\n-    )\n+    if (isNewOverlay) {\n+      expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n+        `\"Error: Route \"/error\" used \\`Math.random()\\` outside of \\`\"use cache\"\\` and without explicitly calling \\`await connection()\\` beforehand. See more info here: https://nextjs.org/docs/messages/next-prerender-random\"`\n+      )\n+    } else {\n+      expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n+        `\"[ Server ] Error: Route \"/error\" used \\`Math.random()\\` outside of \\`\"use cache\"\\` and without explicitly calling \\`await connection()\\` beforehand. See more info here: https://nextjs.org/docs/messages/next-prerender-random\"`\n+      )\n+    }\n   })\n \n   it('should show a red box error on client navigations', async () => {\n@@ -39,10 +48,15 @@ describe('Dynamic IO Dev Errors', () => {\n     await browser.elementByCss(\"[href='/error']\").click()\n \n     await openRedbox(browser)\n-\n-    expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n-      `\"[ Server ] Error: Route \"/error\" used \\`Math.random()\\` outside of \\`\"use cache\"\\` and without explicitly calling \\`await connection()\\` beforehand. See more info here: https://nextjs.org/docs/messages/next-prerender-random\"`\n-    )\n+    if (isNewOverlay) {\n+      expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n+        `\"Error: Route \"/error\" used \\`Math.random()\\` outside of \\`\"use cache\"\\` and without explicitly calling \\`await connection()\\` beforehand. See more info here: https://nextjs.org/docs/messages/next-prerender-random\"`\n+      )\n+    } else {\n+      expect(await getRedboxDescription(browser)).toMatchInlineSnapshot(\n+        `\"[ Server ] Error: Route \"/error\" used \\`Math.random()\\` outside of \\`\"use cache\"\\` and without explicitly calling \\`await connection()\\` beforehand. See more info here: https://nextjs.org/docs/messages/next-prerender-random\"`\n+      )\n+    }\n   })\n \n   it('should not log unhandled rejections for persistently thrown top-level errors', async () => {\n@@ -86,9 +100,15 @@ describe('Dynamic IO Dev Errors', () => {\n \n     const description = await getRedboxDescription(browser)\n \n-    expect(description).toMatchInlineSnapshot(\n-      `\"[ Server ] Error: Route \"/no-accessed-data\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. We don't have the exact line number added to error messages yet but you can see which component in the stack below. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\"`\n-    )\n+    if (isNewOverlay) {\n+      expect(description).toMatchInlineSnapshot(\n+        `\"Error: Route \"/no-accessed-data\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. We don't have the exact line number added to error messages yet but you can see which component in the stack below. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\"`\n+      )\n+    } else {\n+      expect(description).toMatchInlineSnapshot(\n+        `\"[ Server ] Error: Route \"/no-accessed-data\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. We don't have the exact line number added to error messages yet but you can see which component in the stack below. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense\"`\n+      )\n+    }\n \n     // Expand the stack frames, since the first frame `Page [Server] <anonymous>` is treated as ignored.\n     // TODO: Remove the filter of anonymous frames when we have a better way to handle them."
        },
        {
            "sha": "7e70971ddbb807a7f328f2923a93aa394a7935ea",
            "filename": "test/development/app-dir/serialize-circular-error/serialize-circular-error.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fdevelopment%2Fapp-dir%2Fserialize-circular-error%2Fserialize-circular-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fdevelopment%2Fapp-dir%2Fserialize-circular-error%2Fserialize-circular-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fserialize-circular-error%2Fserialize-circular-error.test.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -16,9 +16,15 @@ describe('serialize-circular-error', () => {\n \n     const description = await getRedboxDescription(browser)\n     // React cannot serialize thrown objects with circular references\n-    expect(description).toBe(\n-      '[ Server ] Error: An error occurred but serializing the error message failed.'\n-    )\n+    if (process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true') {\n+      expect(description).toBe(\n+        `Error: An error occurred but serializing the error message failed.`\n+      )\n+    } else {\n+      expect(description).toBe(\n+        `[ Server ] Error: An error occurred but serializing the error message failed.`\n+      )\n+    }\n \n     const output = next.cliOutput\n     expect(output).toContain("
        },
        {
            "sha": "11f031a5b121be8ab009ed16df1afa8533bd3551",
            "filename": "test/e2e/app-dir/global-error/basic/index.test.ts",
            "status": "modified",
            "additions": 17,
            "deletions": 6,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fglobal-error%2Fbasic%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fglobal-error%2Fbasic%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fglobal-error%2Fbasic%2Findex.test.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -6,6 +6,9 @@ describe('app dir - global error', () => {\n     files: __dirname,\n   })\n \n+  const isNewOverlay =\n+    process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+\n   it('should trigger error component when an error happens during rendering', async () => {\n     const browser = await next.browser('/client')\n     await browser\n@@ -30,9 +33,13 @@ describe('app dir - global error', () => {\n     if (isNextDev) {\n       await assertHasRedbox(browser)\n       const description = await getRedboxDescription(browser)\n-      expect(description).toMatchInlineSnapshot(\n-        `\"[ Server ] Error: server page error\"`\n-      )\n+      if (isNewOverlay) {\n+        expect(description).toMatchInlineSnapshot(`\"Error: server page error\"`)\n+      } else {\n+        expect(description).toMatchInlineSnapshot(\n+          `\"[ Server ] Error: server page error\"`\n+        )\n+      }\n     }\n     // Show original error message in dev mode, but hide with the react fallback RSC error message in production mode\n     expect(await browser.elementByCss('#error').text()).toBe(\n@@ -74,9 +81,13 @@ describe('app dir - global error', () => {\n     if (isNextDev) {\n       await assertHasRedbox(browser)\n       const description = await getRedboxDescription(browser)\n-      expect(description).toMatchInlineSnapshot(\n-        `\"[ Server ] Error: Metadata error\"`\n-      )\n+      if (isNewOverlay) {\n+        expect(description).toMatchInlineSnapshot(`\"Error: Metadata error\"`)\n+      } else {\n+        expect(description).toMatchInlineSnapshot(\n+          `\"[ Server ] Error: Metadata error\"`\n+        )\n+      }\n     }\n     expect(await browser.elementByCss('h1').text()).toBe('Global Error')\n     expect(await browser.elementByCss('#error').text()).toBe("
        },
        {
            "sha": "60089982f4aa693fe6fd66bc1d351ad1b57d669e",
            "filename": "test/e2e/app-dir/global-error/layout-error/index.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 3,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fglobal-error%2Flayout-error%2Findex.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fglobal-error%2Flayout-error%2Findex.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fglobal-error%2Flayout-error%2Findex.test.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -17,9 +17,13 @@ describe('app dir - global error - layout error', () => {\n     if (isNextDev) {\n       await assertHasRedbox(browser)\n       const description = await getRedboxDescription(browser)\n-      expect(description).toMatchInlineSnapshot(\n-        `\"[ Server ] Error: layout error\"`\n-      )\n+      if (process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true') {\n+        expect(description).toMatchInlineSnapshot(`\"Error: layout error\"`)\n+      } else {\n+        expect(description).toMatchInlineSnapshot(\n+          `\"[ Server ] Error: layout error\"`\n+        )\n+      }\n     }\n \n     expect(await browser.elementByCss('h1').text()).toBe('Global Error')"
        },
        {
            "sha": "f3bc97f9474fb8aaa7aa1392bd45457689dbe2cf",
            "filename": "test/e2e/app-dir/use-cache-close-over-function/use-cache-close-over-function.test.ts",
            "status": "modified",
            "additions": 21,
            "deletions": 2,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fuse-cache-close-over-function%2Fuse-cache-close-over-function.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fuse-cache-close-over-function%2Fuse-cache-close-over-function.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-close-over-function%2Fuse-cache-close-over-function.test.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -18,6 +18,9 @@ describe('use-cache-close-over-function', () => {\n     return\n   }\n \n+  const isNewOverlay =\n+    process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n+\n   if (isNextDev) {\n     it('should show an error toast for client-side usage', async () => {\n       const outputIndex = next.cliOutput.length\n@@ -28,11 +31,19 @@ describe('use-cache-close-over-function', () => {\n       const errorDescription = await getRedboxDescription(browser)\n       const errorSource = await getRedboxSource(browser)\n \n-      expect(errorDescription).toMatchInlineSnapshot(`\n+      if (isNewOverlay) {\n+        expect(errorDescription).toMatchInlineSnapshot(`\n+        \"Error: Functions cannot be passed directly to Client Components unless you explicitly expose it by marking it with \"use server\". Or maybe you meant to call this function rather than return it.\n+          [function fn]\n+           ^^^^^^^^^^^\"\n+      `)\n+      } else {\n+        expect(errorDescription).toMatchInlineSnapshot(`\n         \"[ Prerender ] Error: Functions cannot be passed directly to Client Components unless you explicitly expose it by marking it with \"use server\". Or maybe you meant to call this function rather than return it.\n           [function fn]\n            ^^^^^^^^^^^\"\n       `)\n+      }\n \n       expect(errorSource).toMatchInlineSnapshot(`\n         \"app/client/page.tsx (8:3) @ createCachedFn\n@@ -86,11 +97,19 @@ describe('use-cache-close-over-function', () => {\n       const errorDescription = await getRedboxDescription(browser)\n       const errorSource = await getRedboxSource(browser)\n \n-      expect(errorDescription).toMatchInlineSnapshot(`\n+      if (isNewOverlay) {\n+        expect(errorDescription).toMatchInlineSnapshot(`\n+        \"Error: Functions cannot be passed directly to Client Components unless you explicitly expose it by marking it with \"use server\". Or maybe you meant to call this function rather than return it.\n+          [function fn]\n+           ^^^^^^^^^^^\"\n+      `)\n+      } else {\n+        expect(errorDescription).toMatchInlineSnapshot(`\n         \"[ Prerender ] Error: Functions cannot be passed directly to Client Components unless you explicitly expose it by marking it with \"use server\". Or maybe you meant to call this function rather than return it.\n           [function fn]\n            ^^^^^^^^^^^\"\n       `)\n+      }\n \n       expect(errorSource).toMatchInlineSnapshot(`\n         \"app/server/page.tsx (6:3) @ createCachedFn"
        },
        {
            "sha": "095e522bb7244d911a6ae973699d600fe6fe394c",
            "filename": "test/e2e/app-dir/use-cache-hanging-inputs/use-cache-hanging-inputs.test.ts",
            "status": "modified",
            "additions": 42,
            "deletions": 10,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fuse-cache-hanging-inputs%2Fuse-cache-hanging-inputs.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fuse-cache-hanging-inputs%2Fuse-cache-hanging-inputs.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-hanging-inputs%2Fuse-cache-hanging-inputs.test.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -11,6 +11,8 @@ import {\n import stripAnsi from 'strip-ansi'\n \n const isExperimentalReact = process.env.__NEXT_EXPERIMENTAL_PPR\n+const isNewDevOverlay =\n+  process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true'\n \n const expectedErrorMessage =\n   'Error: Filling a cache during prerender timed out, likely because request-specific arguments such as params, searchParams, cookies() or dynamic data were used inside \"use cache\".'\n@@ -41,7 +43,11 @@ describe('use-cache-hanging-inputs', () => {\n         const errorDescription = await getRedboxDescription(browser)\n         const errorSource = await getRedboxSource(browser)\n \n-        expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+        if (isNewDevOverlay) {\n+          expect(errorDescription).toBe(expectedErrorMessage)\n+        } else {\n+          expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+        }\n \n         const cliOutput = stripAnsi(next.cliOutput.slice(outputIndex))\n \n@@ -100,7 +106,11 @@ describe('use-cache-hanging-inputs', () => {\n         const errorDescription = await getRedboxDescription(browser)\n         const errorSource = await getRedboxSource(browser)\n \n-        expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+        if (isNewDevOverlay) {\n+          expect(errorDescription).toBe(expectedErrorMessage)\n+        } else {\n+          expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+        }\n \n         const cliOutput = stripAnsi(next.cliOutput.slice(outputIndex))\n \n@@ -146,7 +156,11 @@ describe('use-cache-hanging-inputs', () => {\n         const errorDescription = await getRedboxDescription(browser)\n         const errorSource = await getRedboxSource(browser)\n \n-        expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+        if (isNewDevOverlay) {\n+          expect(errorDescription).toBe(expectedErrorMessage)\n+        } else {\n+          expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+        }\n \n         const cliOutput = stripAnsi(next.cliOutput.slice(outputIndex))\n \n@@ -203,14 +217,24 @@ describe('use-cache-hanging-inputs', () => {\n           const expectedErrorMessagePpr =\n             'Error: Route \"/bound-args\": A component accessed data, headers, params, searchParams, or a short-lived cache without a Suspense boundary nor a \"use cache\" above it. We don\\'t have the exact line number added to error messages yet but you can see which component in the stack below. See more info: https://nextjs.org/docs/messages/next-prerender-missing-suspense'\n \n-          expect(errorDescription).toBe(`[ Server ] ${expectedErrorMessagePpr}`)\n+          if (isNewDevOverlay) {\n+            expect(errorDescription).toBe(expectedErrorMessagePpr)\n+          } else {\n+            expect(errorDescription).toBe(\n+              `[ Server ] ${expectedErrorMessagePpr}`\n+            )\n+          }\n \n           expect(cliOutput).toContain(\n             `${expectedErrorMessagePpr}\n     at Page [Server] (<anonymous>)`\n           )\n         } else {\n-          expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+          if (isNewDevOverlay) {\n+            expect(errorDescription).toBe(expectedErrorMessage)\n+          } else {\n+            expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+          }\n \n           if (isTurbopack) {\n             // TODO(veil): For Turbopack, a fix in the React Flight Client, where\n@@ -251,11 +275,19 @@ describe('use-cache-hanging-inputs', () => {\n         const title = await getRedboxTitle(browser)\n         const description = await getRedboxDescription(browser)\n \n-        expect({ count, title, description }).toEqual({\n-          count: 1,\n-          title: 'Unhandled Runtime Error',\n-          description: '[ Cache ] Error: kaputt!',\n-        })\n+        if (isNewDevOverlay) {\n+          expect({ count, title, description }).toEqual({\n+            count: 1,\n+            title: 'Unhandled Runtime Error\\nCache',\n+            description: 'Error: kaputt!',\n+          })\n+        } else {\n+          expect({ count, title, description }).toEqual({\n+            count: 1,\n+            title: 'Unhandled Runtime Error',\n+            description: '[ Cache ] Error: kaputt!',\n+          })\n+        }\n       })\n     })\n   } else {"
        },
        {
            "sha": "4efdc130f951548b88bf16ff4586487f3ba384c7",
            "filename": "test/e2e/app-dir/use-cache-standalone-search-params/use-cache-standalone-search-params.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fuse-cache-standalone-search-params%2Fuse-cache-standalone-search-params.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d/test%2Fe2e%2Fapp-dir%2Fuse-cache-standalone-search-params%2Fuse-cache-standalone-search-params.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-standalone-search-params%2Fuse-cache-standalone-search-params.test.ts?ref=0a4cc0a0629fa0c7fc2132f6ab6d12d230dda47d",
            "patch": "@@ -39,7 +39,11 @@ describe('use-cache-standalone-search-params', () => {\n         const errorSource = await getRedboxSource(browser)\n         const expectedErrorMessage = getExpectedErrorMessage(route)\n \n-        expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+        if (process.env.__NEXT_EXPERIMENTAL_NEW_DEV_OVERLAY === 'true') {\n+          expect(errorDescription).toBe(expectedErrorMessage)\n+        } else {\n+          expect(errorDescription).toBe(`[ Cache ] ${expectedErrorMessage}`)\n+        }\n \n         const cliOutput = stripAnsi(next.cliOutput.slice(outputIndex))\n "
        }
    ],
    "stats": {
        "total": 400,
        "additions": 314,
        "deletions": 86
    }
}