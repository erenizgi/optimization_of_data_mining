{
    "author": "sokra",
    "message": "Turbopack: Log persistent cache store time (#80149)\n\n### What?\r\n\r\nShow info about the time it took to store the persistent cache",
    "sha": "6de962e4638be010b0647c0b07c9effec8698999",
    "files": [
        {
            "sha": "e270b6b3a707880a18d60ccde82896329b1dd1e1",
            "filename": "turbopack/crates/turbo-tasks-backend/src/backend/mod.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/6de962e4638be010b0647c0b07c9effec8698999/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/6de962e4638be010b0647c0b07c9effec8698999/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-backend%2Fsrc%2Fbackend%2Fmod.rs?ref=6de962e4638be010b0647c0b07c9effec8698999",
            "patch": "@@ -31,9 +31,11 @@ use turbo_tasks::{\n         TransientTaskType, TurboTasksExecutionError, TypedCellContent,\n     },\n     event::{Event, EventListener},\n+    message_queue::TimingEvent,\n     registry::{self, get_value_type_global_name},\n     task_statistics::TaskStatisticsApi,\n     trace::TraceRawVcs,\n+    turbo_tasks,\n     util::IdFactoryWithReuse,\n };\n \n@@ -812,6 +814,7 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n     }\n \n     fn snapshot(&self) -> Option<(Instant, bool)> {\n+        let start = Instant::now();\n         debug_assert!(self.should_persist());\n         let mut snapshot_request = self.snapshot_request.lock();\n         snapshot_request.snapshot_requested = true;\n@@ -1043,6 +1046,14 @@ impl<B: BackingStorage> TurboTasksBackendInner<B> {\n             }\n         }\n \n+        if new_items {\n+            let elapsed = start.elapsed();\n+            turbo_tasks().send_compilation_event(Arc::new(TimingEvent::new(\n+                \"Finished writing to persistent cache\".to_string(),\n+                elapsed,\n+            )));\n+        }\n+\n         Some((snapshot_time, new_items))\n     }\n "
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}