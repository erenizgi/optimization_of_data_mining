{
    "author": "unstubbable",
    "message": "[test] Make `Undefined default export` an e2e test suite (#84240)\n\nThis also adds a build-time test, documenting the unhelpful error messages we currently show during prerendering, when an app router file does not have a default export.",
    "sha": "99507d5153d5fce51d889c902160f68e07316c30",
    "files": [
        {
            "sha": "5cc11a91590e4e6f1f7197aa7251a779f51b491f",
            "filename": "test/development/acceptance-app/fixtures/undefined-default-export/app/(group)/specific-path/1/page.js",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/b1f05782a01efde5a7a6f74738784bf67978661f/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F1%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/b1f05782a01efde5a7a6f74738784bf67978661f/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F1%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F1%2Fpage.js?ref=b1f05782a01efde5a7a6f74738784bf67978661f",
            "patch": "@@ -1 +0,0 @@\n-export const a = 123"
        },
        {
            "sha": "5cc11a91590e4e6f1f7197aa7251a779f51b491f",
            "filename": "test/development/acceptance-app/fixtures/undefined-default-export/app/will-not-found/not-found.js",
            "status": "removed",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/b1f05782a01efde5a7a6f74738784bf67978661f/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Fundefined-default-export%2Fapp%2Fwill-not-found%2Fnot-found.js",
            "raw_url": "https://github.com/vercel/next.js/raw/b1f05782a01efde5a7a6f74738784bf67978661f/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Fundefined-default-export%2Fapp%2Fwill-not-found%2Fnot-found.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Ffixtures%2Fundefined-default-export%2Fapp%2Fwill-not-found%2Fnot-found.js?ref=b1f05782a01efde5a7a6f74738784bf67978661f",
            "patch": "@@ -1 +0,0 @@\n-export const a = 123"
        },
        {
            "sha": "1c1f3964b0033d1357a3b1ecb904b213a76e474b",
            "filename": "test/e2e/app-dir/undefined-default-export/app/(group)/specific-path/1/page.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F1%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F1%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F1%2Fpage.js?ref=99507d5153d5fce51d889c902160f68e07316c30",
            "patch": "@@ -0,0 +1,4 @@\n+// Not a default export.\n+export function Component() {\n+  return <div>hello</div>\n+}"
        },
        {
            "sha": "5cc11a91590e4e6f1f7197aa7251a779f51b491f",
            "filename": "test/e2e/app-dir/undefined-default-export/app/(group)/specific-path/2/layout.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F2%2Flayout.js",
            "raw_url": "https://github.com/vercel/next.js/raw/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F2%2Flayout.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F2%2Flayout.js?ref=99507d5153d5fce51d889c902160f68e07316c30",
            "previous_filename": "test/development/acceptance-app/fixtures/undefined-default-export/app/(group)/specific-path/2/layout.js"
        },
        {
            "sha": "6ee683e94022b66f69c3d03652b637c3b6bb2528",
            "filename": "test/e2e/app-dir/undefined-default-export/app/(group)/specific-path/2/page.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F2%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F2%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2F(group)%2Fspecific-path%2F2%2Fpage.js?ref=99507d5153d5fce51d889c902160f68e07316c30",
            "previous_filename": "test/development/acceptance-app/fixtures/undefined-default-export/app/(group)/specific-path/2/page.js"
        },
        {
            "sha": "a3a86a5ca1e12cd18b557ea38532170ea1e49622",
            "filename": "test/e2e/app-dir/undefined-default-export/app/layout.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2Flayout.js",
            "raw_url": "https://github.com/vercel/next.js/raw/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2Flayout.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2Flayout.js?ref=99507d5153d5fce51d889c902160f68e07316c30",
            "previous_filename": "test/development/acceptance-app/fixtures/undefined-default-export/app/layout.js"
        },
        {
            "sha": "bc955938da184869925725d38ee867f2f318d8c1",
            "filename": "test/e2e/app-dir/undefined-default-export/app/will-not-found/not-found.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2Fwill-not-found%2Fnot-found.js",
            "raw_url": "https://github.com/vercel/next.js/raw/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2Fwill-not-found%2Fnot-found.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2Fwill-not-found%2Fnot-found.js?ref=99507d5153d5fce51d889c902160f68e07316c30",
            "patch": "@@ -0,0 +1,4 @@\n+// Not a default export.\n+export function NotFound() {\n+  return <div>not found</div>\n+}"
        },
        {
            "sha": "97ea65b48340c456c3866bbe589b642d6ca978ba",
            "filename": "test/e2e/app-dir/undefined-default-export/app/will-not-found/page.js",
            "status": "renamed",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2Fwill-not-found%2Fpage.js",
            "raw_url": "https://github.com/vercel/next.js/raw/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2Fwill-not-found%2Fpage.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fapp%2Fwill-not-found%2Fpage.js?ref=99507d5153d5fce51d889c902160f68e07316c30",
            "previous_filename": "test/development/acceptance-app/fixtures/undefined-default-export/app/will-not-found/page.js"
        },
        {
            "sha": "58f65ea14f4155e21598378e59f12b9bfa9e672b",
            "filename": "test/e2e/app-dir/undefined-default-export/next.config.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fnext.config.js?ref=99507d5153d5fce51d889c902160f68e07316c30",
            "patch": "@@ -0,0 +1,10 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    prerenderEarlyExit: false,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "b8dd6bc579088e436e8b02b57f80e7e60a414752",
            "filename": "test/e2e/app-dir/undefined-default-export/undefined-default-export.test.ts",
            "status": "renamed",
            "additions": 25,
            "deletions": 7,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fundefined-default-export.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/99507d5153d5fce51d889c902160f68e07316c30/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fundefined-default-export.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fundefined-default-export%2Fundefined-default-export.test.ts?ref=99507d5153d5fce51d889c902160f68e07316c30",
            "patch": "@@ -1,16 +1,13 @@\n import path from 'path'\n-import { FileRef, nextTestSetup } from 'e2e-utils'\n+import { isNextStart, nextTestSetup } from 'e2e-utils'\n \n describe('Undefined default export', () => {\n   const { next, isNextDev } = nextTestSetup({\n-    files: new FileRef(\n-      path.join(__dirname, 'fixtures', 'undefined-default-export')\n-    ),\n+    files: path.join(__dirname),\n+    skipStart: isNextStart,\n+    skipDeployment: true,\n   })\n \n-  // TODO: This is currently always true. It's just here to already indent the\n-  // code, so that git blame is preserved in the subsequent commit, when we're\n-  // moving the file.\n   if (isNextDev) {\n     it('should error if page component does not have default export', async () => {\n       const browser = await next.browser('/specific-path/1')\n@@ -53,5 +50,26 @@ describe('Undefined default export', () => {\n        }\n       `)\n     })\n+  } else {\n+    it('errors the build with unhelpful error messages', async () => {\n+      const { cliOutput, exitCode } = await next.build()\n+\n+      expect(exitCode).toBe(1)\n+\n+      expect(cliOutput).toContain(\n+        `Error occurred prerendering page \"/specific-path/1\". Read more: https://nextjs.org/docs/messages/prerender-error\n+Error: Functions cannot be passed directly to Client Components unless you explicitly expose it by marking it with \"use server\". Or maybe you meant to call this function rather than return it.Module`\n+      )\n+\n+      expect(cliOutput).toContain(\n+        `Error occurred prerendering page \"/specific-path/2\". Read more: https://nextjs.org/docs/messages/prerender-error\n+Error: Element type is invalid: expected a string (for built-in components) or a class/function (for composite components) but got: object.`\n+      )\n+\n+      expect(cliOutput).toContain(\n+        `Error occurred prerendering page \"/will-not-found\". Read more: https://nextjs.org/docs/messages/prerender-error\n+Error: Functions cannot be passed directly to Client Components unless you explicitly expose it by marking it with \"use server\". Or maybe you meant to call this function rather than return it.Module`\n+      )\n+    })\n   }\n })",
            "previous_filename": "test/development/acceptance-app/undefined-default-export.test.ts"
        }
    ],
    "stats": {
        "total": 52,
        "additions": 43,
        "deletions": 9
    }
}