{
    "author": "bgub",
    "message": "feat: add RouteContext type for app router route handlers (#82670)\n\n## Add typed RouteContext for App Router route handlers\n\nThis PR adds type support for route handlers in the App Router by\nintroducing a new `RouteContext` interface. This allows for\nstrongly-typed access to route parameters in API routes.\n\n### Features:\n\n- Adds a new global `RouteContext<AppRouteHandlerRoute>` interface with\ntyped `params` property\n- Adds test cases for various route parameter patterns\n- Updates type tests to verify correct type checking for route handlers\n\nThis enhancement improves the developer experience by providing type\nsafety when accessing route parameters in API route handlers, similar to\nthe existing type support for pages and layouts.",
    "sha": "8f7779727c58135b4e20d1cfacef9a13a9078283",
    "files": [
        {
            "sha": "854f5cb106c8d576c454692845c34e7352481040",
            "filename": "packages/next/src/server/lib/router-utils/typegen.ts",
            "status": "modified",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/8f7779727c58135b4e20d1cfacef9a13a9078283/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8f7779727c58135b4e20d1cfacef9a13a9078283/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Frouter-utils%2Ftypegen.ts?ref=8f7779727c58135b4e20d1cfacef9a13a9078283",
            "patch": "@@ -569,6 +569,20 @@ declare global {\n   } & {\n     [K in LayoutSlotMap[LayoutRoute]]: React.ReactNode\n   }\n+\n+  /**\n+   * Context for Next.js App Router route handlers\n+   * @example\n+   * \\`\\`\\`tsx\n+   * export async function GET(request: NextRequest, context: RouteContext<'/api/users/[id]'>) {\n+   *   const { id } = await context.params\n+   *   return Response.json({ id })\n+   * }\n+   * \\`\\`\\`\n+   */\n+  interface RouteContext<AppRouteHandlerRoute extends AppRouteHandlerRoutes> {\n+    params: Promise<ParamMap[AppRouteHandlerRoute]>\n+  }\n }\n `\n }"
        },
        {
            "sha": "0451715099e8e81f858d5641c604f3fd48ba0fba",
            "filename": "test/e2e/app-dir/typed-routes/app/api/docs/[...slug]/route.ts",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/8f7779727c58135b4e20d1cfacef9a13a9078283/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fapi%2Fdocs%2F%5B...slug%5D%2Froute.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8f7779727c58135b4e20d1cfacef9a13a9078283/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fapi%2Fdocs%2F%5B...slug%5D%2Froute.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fapi%2Fdocs%2F%5B...slug%5D%2Froute.ts?ref=8f7779727c58135b4e20d1cfacef9a13a9078283",
            "patch": "@@ -0,0 +1,9 @@\n+import { NextRequest } from 'next/server'\n+\n+export async function GET(\n+  request: NextRequest,\n+  context: RouteContext<'/api/docs/[...slug]'>\n+) {\n+  const { slug } = await context.params\n+  return Response.json({ slug })\n+}"
        },
        {
            "sha": "e4e9ea9bc65a558ef5895d068407f894a5fa668f",
            "filename": "test/e2e/app-dir/typed-routes/app/api/shop/[[...category]]/route.ts",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/8f7779727c58135b4e20d1cfacef9a13a9078283/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fapi%2Fshop%2F%5B%5B...category%5D%5D%2Froute.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8f7779727c58135b4e20d1cfacef9a13a9078283/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fapi%2Fshop%2F%5B%5B...category%5D%5D%2Froute.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fapi%2Fshop%2F%5B%5B...category%5D%5D%2Froute.ts?ref=8f7779727c58135b4e20d1cfacef9a13a9078283",
            "patch": "@@ -0,0 +1,9 @@\n+import { NextRequest } from 'next/server'\n+\n+export async function GET(\n+  request: NextRequest,\n+  context: RouteContext<'/api/shop/[[...category]]'>\n+) {\n+  const { category } = await context.params\n+  return Response.json({ category })\n+}"
        },
        {
            "sha": "9dd65af11ae5afcff35d8975e3923909d0105a06",
            "filename": "test/e2e/app-dir/typed-routes/app/api/users/[id]/route.ts",
            "status": "added",
            "additions": 18,
            "deletions": 0,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/8f7779727c58135b4e20d1cfacef9a13a9078283/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fapi%2Fusers%2F%5Bid%5D%2Froute.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8f7779727c58135b4e20d1cfacef9a13a9078283/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fapi%2Fusers%2F%5Bid%5D%2Froute.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Fapp%2Fapi%2Fusers%2F%5Bid%5D%2Froute.ts?ref=8f7779727c58135b4e20d1cfacef9a13a9078283",
            "patch": "@@ -0,0 +1,18 @@\n+import { NextRequest } from 'next/server'\n+\n+export async function GET(\n+  request: NextRequest,\n+  context: RouteContext<'/api/users/[id]'>\n+) {\n+  const { id } = await context.params\n+  return Response.json({ id })\n+}\n+\n+export async function POST(\n+  request: NextRequest,\n+  context: RouteContext<'/api/users/[id]'>\n+) {\n+  const { id } = await context.params\n+  const body = await request.json()\n+  return Response.json({ id, ...body })\n+}"
        },
        {
            "sha": "32d1e30d882e72f7d08ff02d05d44dc7563ffa76",
            "filename": "test/e2e/app-dir/typed-routes/typed-routes.test.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 2,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/8f7779727c58135b4e20d1cfacef9a13a9078283/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-routes.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/8f7779727c58135b4e20d1cfacef9a13a9078283/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-routes.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Ftyped-routes%2Ftyped-routes.test.ts?ref=8f7779727c58135b4e20d1cfacef9a13a9078283",
            "patch": "@@ -2,7 +2,7 @@ import { nextTestSetup } from 'e2e-utils'\n \n const expectedDts = `\n type AppRoutes = \"/\" | \"/_shop/[[...category]]\" | \"/dashboard\" | \"/dashboard/settings\" | \"/docs/[...slug]\" | \"/gallery/photo/[id]\" | \"/project/[slug]\"\n-type AppRouteHandlerRoutes = never\n+type AppRouteHandlerRoutes = \"/api/docs/[...slug]\" | \"/api/shop/[[...category]]\" | \"/api/users/[id]\"\n type PageRoutes = \"/about\" | \"/users/[id]\"\n type LayoutRoutes = \"/\" | \"/dashboard\"\n type RedirectRoutes = \"/blog/[category]/[[...slug]]\" | \"/project/[slug]\"\n@@ -59,20 +59,33 @@ describe('typed-routes', () => {\n     })\n   }\n \n+  it('should generate RouteContext type for route handlers', async () => {\n+    const dts = await next.readFile('.next/types/routes.d.ts')\n+    expect(dts).toContain(\n+      'interface RouteContext<AppRouteHandlerRoute extends AppRouteHandlerRoutes>'\n+    )\n+    expect(dts).toContain('params: Promise<ParamMap[AppRouteHandlerRoute]>')\n+  })\n+\n   if (isNextStart) {\n     it('should throw type errors', async () => {\n       await next.stop()\n       await next.patchFile(\n         'app/type-testing.ts',\n         `type ValidPage = PageProps<'/dashboard'>\n-type InvalidPage = PageProps<'/dasboard'>`\n+type InvalidPage = PageProps<'/dasboard'>\n+type ValidRoute = RouteContext<'/api/users/[id]'>\n+type InvalidRoute = RouteContext<'/api/users/invalid'>`\n       )\n \n       const { cliOutput } = await next.build()\n \n       expect(cliOutput).toContain(\n         `Type '\"/dasboard\"' does not satisfy the constraint 'AppRoutes'.`\n       )\n+      expect(cliOutput).toContain(\n+        `Type '\"/api/users/invalid\"' does not satisfy the constraint 'AppRouteHandlerRoutes'.`\n+      )\n     })\n   }\n })"
        }
    ],
    "stats": {
        "total": 67,
        "additions": 65,
        "deletions": 2
    }
}