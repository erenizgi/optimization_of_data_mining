{
    "author": "devjiwonchoi",
    "message": "[dev-overlay] fix: bottom stack count (#76375)\n\n### Why?\n\nThe error overlay's bottom stack count was wrong.\n\n### Before\n\n\nhttps://github.com/user-attachments/assets/24f09416-38a9-4b47-8a59-269e9855f851\n\n### After\n\n\nhttps://github.com/user-attachments/assets/9f0dff66-e40c-4e68-afda-d149d1b8d895\n\nCloses NDX-827\n\n---------\n\nCo-authored-by: Zack Tanner <1939140+ztanner@users.noreply.github.com>",
    "sha": "49c26c7b4b05c988def6806473c9b524d33b8dbd",
    "files": [
        {
            "sha": "f5b3c204a4b3aea32c57b1840ec38f0f035089a7",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay-bottom-stack/index.tsx",
            "status": "modified",
            "additions": 24,
            "deletions": 33,
            "changes": 57,
            "blob_url": "https://github.com/vercel/next.js/blob/49c26c7b4b05c988def6806473c9b524d33b8dbd/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-bottom-stack%2Findex.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/49c26c7b4b05c988def6806473c9b524d33b8dbd/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-bottom-stack%2Findex.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-bottom-stack%2Findex.tsx?ref=49c26c7b4b05c988def6806473c9b524d33b8dbd",
            "patch": "@@ -1,40 +1,31 @@\n export function ErrorOverlayBottomStack({\n-  count,\n+  errorCount,\n   activeIdx,\n }: {\n-  count: number\n+  errorCount: number\n   activeIdx: number\n }) {\n-  let stackCount = '0'\n-\n-  if (count > 1) {\n-    stackCount = '1'\n-  }\n-\n-  if (count > 2) {\n-    stackCount = '2'\n-  }\n-\n-  if (activeIdx === 1) {\n-    stackCount = '1'\n-  }\n-\n-  if (activeIdx > 1) {\n-    stackCount = '0'\n-  }\n-\n+  // If there are more than 2 errors to navigate, the stack count should remain at 2.\n+  const stackCount = Math.min(errorCount - activeIdx - 1, 2)\n   return (\n     <div aria-hidden className=\"error-overlay-bottom-stack\">\n-      <div className=\"stack\" data-stack-count={stackCount}>\n-        <div className=\"layer layer1\">1</div>\n-        <div className=\"layer layer2\">2</div>\n+      <div\n+        className=\"error-overlay-bottom-stack-stack\"\n+        data-stack-count={stackCount}\n+      >\n+        <div className=\"error-overlay-bottom-stack-layer error-overlay-bottom-stack-layer-1\">\n+          1\n+        </div>\n+        <div className=\"error-overlay-bottom-stack-layer error-overlay-bottom-stack-layer-2\">\n+          2\n+        </div>\n       </div>\n     </div>\n   )\n }\n \n export const styles = `\n-  .layer {\n+  .error-overlay-bottom-stack-layer {\n     width: 100%;\n     height: var(--stack-layer-height);\n     position: relative;\n@@ -46,11 +37,11 @@ export const styles = `\n       box-shadow 350ms var(--timing-swift);\n   }\n \n-  .layer1 {\n+  .error-overlay-bottom-stack-layer-1 {\n     width: calc(100% - var(--size-6));\n   }\n \n-  .layer2 {\n+  .error-overlay-bottom-stack-layer-2 {\n     width: calc(100% - var(--size-12));\n     z-index: -1;\n   }\n@@ -63,7 +54,7 @@ export const styles = `\n     overflow: visible;\n   }\n \n-  .stack {\n+  .error-overlay-bottom-stack-stack {\n     --stack-layer-height: 44px;\n     --stack-layer-height-half: calc(var(--stack-layer-height) / 2);\n     --stack-layer-trim: 13px;\n@@ -79,40 +70,40 @@ export const styles = `\n     z-index: -1;\n     max-width: var(--next-dialog-max-width);\n \n-    .layer {\n+    .error-overlay-bottom-stack-layer {\n       grid-area: 1 / 1;\n       /* Hide */\n       translate: 0 calc(var(--stack-layer-height) * -1);\n     }\n \n     &[data-stack-count='1'],\n     &[data-stack-count='2'] {\n-      .layer1 {\n+      .error-overlay-bottom-stack-layer-1 {\n         translate: 0\n           calc(var(--stack-layer-height-half) * -1 - var(--stack-layer-trim));\n       }\n     }\n \n     &[data-stack-count='2'] {\n-      .layer2 {\n+      .error-overlay-bottom-stack-layer-2 {\n         translate: 0 calc(var(--stack-layer-trim) * -1 * 2);\n       }\n     }\n \n     /* Only the bottom stack should have the shadow */\n-    &[data-stack-count='1'] .layer1 {\n+    &[data-stack-count='1'] .error-overlay-bottom-stack-layer-1 {\n       box-shadow: var(--shadow);\n     }\n \n     &[data-stack-count='2'] {\n-      .layer2 {\n+      .error-overlay-bottom-stack-layer-2 {\n         box-shadow: var(--shadow);\n       }\n     }\n   }\n \n   @media (prefers-color-scheme: dark) {\n-    .layer {\n+    .error-overlay-bottom-stack-layer {\n       border-color: var(--color-gray-400);\n     }\n   }"
        },
        {
            "sha": "0266bd9788ee2227ed06e4145a8994fca1bc5db8",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay-layout/error-overlay-layout.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/49c26c7b4b05c988def6806473c9b524d33b8dbd/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/49c26c7b4b05c988def6806473c9b524d33b8dbd/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-layout%2Ferror-overlay-layout.tsx?ref=49c26c7b4b05c988def6806473c9b524d33b8dbd",
            "patch": "@@ -121,7 +121,7 @@ export function ErrorOverlayLayout({\n             </DialogFooter>\n           )}\n           <ErrorOverlayBottomStack\n-            count={runtimeErrors?.length ?? 0}\n+            errorCount={runtimeErrors?.length ?? 0}\n             activeIdx={activeIdx ?? 0}\n           />\n         </ErrorOverlayDialog>"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 25,
        "deletions": 34
    }
}