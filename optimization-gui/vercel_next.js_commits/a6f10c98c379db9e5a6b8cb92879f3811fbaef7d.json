{
    "author": "ijjk",
    "message": "Fix API stripping JSON incorrectly (#82061)\n\nThis ensures we don't normalize unless it's actually a `_next/data`\nrequest.\n\nFixes: https://github.com/vercel/next.js/issues/81936",
    "sha": "a6f10c98c379db9e5a6b8cb92879f3811fbaef7d",
    "files": [
        {
            "sha": "8f59f0cc538ed4bf35f21c0acc074007f101492e",
            "filename": "packages/next/src/shared/lib/page-path/normalize-data-path.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/a6f10c98c379db9e5a6b8cb92879f3811fbaef7d/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fpage-path%2Fnormalize-data-path.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a6f10c98c379db9e5a6b8cb92879f3811fbaef7d/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fpage-path%2Fnormalize-data-path.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Fpage-path%2Fnormalize-data-path.ts?ref=a6f10c98c379db9e5a6b8cb92879f3811fbaef7d",
            "patch": "@@ -1,7 +1,12 @@\n+import { pathHasPrefix } from '../router/utils/path-has-prefix'\n+\n /**\n  * strip _next/data/<build-id>/ prefix and .json suffix\n  */\n export function normalizeDataPath(pathname: string) {\n+  if (!pathHasPrefix(pathname || '/', '/_next/data')) {\n+    return pathname\n+  }\n   pathname = pathname\n     .replace(/\\/_next\\/data\\/[^/]{1,}/, '')\n     .replace(/\\.json$/, '')"
        },
        {
            "sha": "c8650c08e3b02202dc85ac4f5823ce47d0537c40",
            "filename": "test/integration/api-support/test/index.test.js",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/a6f10c98c379db9e5a6b8cb92879f3811fbaef7d/test%2Fintegration%2Fapi-support%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/a6f10c98c379db9e5a6b8cb92879f3811fbaef7d/test%2Fintegration%2Fapi-support%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fapi-support%2Ftest%2Findex.test.js?ref=a6f10c98c379db9e5a6b8cb92879f3811fbaef7d",
            "patch": "@@ -25,6 +25,12 @@ let mode\n let app\n \n function runTests(dev = false) {\n+  it('should not strip .json from API route', async () => {\n+    const res = await fetchViaHTTP(appPort, '/api/hello.json')\n+    expect(res.status).toBe(200)\n+    expect(await res.json()).toEqual({ post: 'hello.json' })\n+  })\n+\n   it('should handle proxying to self correctly', async () => {\n     const res1 = await fetchViaHTTP(appPort, '/api/proxy-self')\n     expect(res1.status).toBe(200)"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}