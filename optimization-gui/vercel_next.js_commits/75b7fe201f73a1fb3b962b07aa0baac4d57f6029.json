{
    "author": "devjiwonchoi",
    "message": "[devtools] add dialog behavior to panel ui (#80355)\n\n### Testing Plan\r\n\r\nOpen Storybook and goto `dev-overlay > With Panel` OR `devtools-panel > Default`\r\n\r\nhttps://github.com/user-attachments/assets/d1b08482-9382-4a1c-906d-a8e9d7c68f66\r\n\r\nCloses NEXT-4516",
    "sha": "75b7fe201f73a1fb3b962b07aa0baac4d57f6029",
    "files": [
        {
            "sha": "f1c0813d3fa128c11ca33ee651dbf7a166279161",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel.stories.tsx",
            "status": "added",
            "additions": 32,
            "deletions": 0,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.stories.tsx?ref=75b7fe201f73a1fb3b962b07aa0baac4d57f6029",
            "patch": "@@ -0,0 +1,32 @@\n+import type { Meta, StoryObj } from '@storybook/react'\n+import type { OverlayState } from '../../shared'\n+\n+import { DevToolsPanel } from './devtools-panel'\n+import { INITIAL_OVERLAY_STATE } from '../../shared'\n+import { withShadowPortal } from '../../storybook/with-shadow-portal'\n+\n+const meta: Meta<typeof DevToolsPanel> = {\n+  component: DevToolsPanel,\n+  parameters: {\n+    layout: 'centered',\n+  },\n+  argTypes: {},\n+  decorators: [withShadowPortal],\n+}\n+\n+export default meta\n+type Story = StoryObj<typeof DevToolsPanel>\n+\n+const state: OverlayState = {\n+  ...INITIAL_OVERLAY_STATE,\n+  routerType: 'app',\n+  isErrorOverlayOpen: false,\n+  isDevToolsPanelOpen: true,\n+}\n+\n+export const Default: Story = {\n+  args: {\n+    state,\n+    dispatch: () => {},\n+  },\n+}"
        },
        {
            "sha": "e647c6b946bb39e71279047741515d1d23c2a96c",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-panel/devtools-panel.tsx",
            "status": "modified",
            "additions": 55,
            "deletions": 5,
            "changes": 60,
            "blob_url": "https://github.com/vercel/next.js/blob/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-panel%2Fdevtools-panel.tsx?ref=75b7fe201f73a1fb3b962b07aa0baac4d57f6029",
            "patch": "@@ -1,12 +1,62 @@\n+import type { OverlayDispatch, OverlayState } from '../../shared'\n+\n+import { Dialog, DialogContent, DialogHeader, DialogBody } from '../dialog'\n+import { Overlay } from '../overlay/overlay'\n+import { ACTION_DEVTOOLS_PANEL_TOGGLE } from '../../shared'\n import { css } from '../../utils/css'\n \n-export function DevToolsPanel() {\n-  // TODO: Remove style; It is to indicate faster in the browser.\n-  return <div data-nextjs-devtools-panel>DevToolsPanel</div>\n+export function DevToolsPanel({\n+  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n+  state,\n+  dispatch,\n+}: {\n+  state: OverlayState\n+  dispatch: OverlayDispatch\n+}) {\n+  const onClose = () => {\n+    dispatch({ type: ACTION_DEVTOOLS_PANEL_TOGGLE })\n+  }\n+\n+  return (\n+    <Overlay data-nextjs-devtools-panel-overlay>\n+      <Dialog\n+        data-nextjs-devtools-panel-dialog\n+        aria-labelledby=\"nextjs__container_dev_tools_panel_label\"\n+        aria-describedby=\"nextjs__container_dev_tools_panel_desc\"\n+        onClose={onClose}\n+      >\n+        <DialogContent>\n+          <DialogHeader></DialogHeader>\n+          <DialogBody></DialogBody>\n+        </DialogContent>\n+      </Dialog>\n+    </Overlay>\n+  )\n }\n \n export const DEVTOOLS_PANEL_STYLES = css`\n-  [data-nextjs-devtools-panel] {\n-    color: black;\n+  [data-nextjs-devtools-panel-overlay] {\n+    padding: initial;\n+    top: 10vh;\n+  }\n+\n+  [data-nextjs-devtools-panel-dialog] {\n+    -webkit-font-smoothing: antialiased;\n+    display: flex;\n+    flex-direction: column;\n+    background: var(--color-background-100);\n+    background-clip: padding-box;\n+    border: 1px solid var(--color-gray-400);\n+    border-radius: var(--rounded-xl);\n+    box-shadow: var(--shadow-lg);\n+    position: relative;\n+    overflow-y: auto;\n+\n+    /* TODO: Remove once the content is filled. */\n+    min-width: 800px;\n+    min-height: 500px;\n+\n+    /* This is handled from dialog/styles.ts */\n+    max-width: var(--next-dialog-max-width);\n   }\n `"
        },
        {
            "sha": "260e86d8a9a57ea0bd3c65ba496e0b4c9d57ff7e",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/dialog/styles.ts",
            "status": "modified",
            "additions": 10,
            "deletions": 7,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fstyles.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fstyles.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdialog%2Fstyles.ts?ref=75b7fe201f73a1fb3b962b07aa0baac4d57f6029",
            "patch": "@@ -1,4 +1,6 @@\n-const styles = `\n+import { css } from '../../utils/css'\n+\n+export const styles = css`\n   [data-nextjs-dialog-root] {\n     --next-dialog-radius: var(--rounded-xl);\n     --next-dialog-max-width: 960px;\n@@ -25,9 +27,11 @@ const styles = `\n       scale: 1;\n     }\n \n-    [data-nextjs-scroll-fader][data-side=\"top\"] {\n+    [data-nextjs-scroll-fader][data-side='top'] {\n       left: 1px;\n-      top: calc(var(--next-dialog-notch-height) + var(--next-dialog-border-width));\n+      top: calc(\n+        var(--next-dialog-notch-height) + var(--next-dialog-border-width)\n+      );\n       width: calc(100% - var(--next-dialog-padding));\n       opacity: 0;\n     }\n@@ -37,7 +41,8 @@ const styles = `\n     outline: 0;\n   }\n \n-  [data-nextjs-dialog], [data-nextjs-dialog] * {\n+  [data-nextjs-dialog],\n+  [data-nextjs-dialog] * {\n     &::-webkit-scrollbar {\n       width: 6px;\n       height: 6px;\n@@ -53,7 +58,7 @@ const styles = `\n       border-radius: 0 0 1rem 1rem;\n       background-color: var(--color-background-100);\n     }\n-      \n+\n     &::-webkit-scrollbar-thumb {\n       border-radius: 1rem;\n       background-color: var(--color-gray-500);\n@@ -123,5 +128,3 @@ const styles = `\n     }\n   }\n `\n-\n-export { styles }"
        },
        {
            "sha": "80d2175a29a494d3d9e3654ed4c66a47c3857132",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 39,
            "deletions": 3,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx?ref=75b7fe201f73a1fb3b962b07aa0baac4d57f6029",
            "patch": "@@ -7,6 +7,7 @@ import imgApp from './app.png'\n import { useReducer } from 'react'\n import { DevOverlay } from './dev-overlay'\n import {\n+  ACTION_DEVTOOLS_PANEL_TOGGLE,\n   ACTION_ERROR_OVERLAY_CLOSE,\n   ACTION_ERROR_OVERLAY_OPEN,\n   ACTION_ERROR_OVERLAY_TOGGLE,\n@@ -93,8 +94,7 @@ const initialState: OverlayState = {\n     installed: '15.2.0',\n     staleness: 'fresh',\n   },\n-  isErrorOverlayOpen: true,\n-  // TODO: This will be handled on the next stack——with proper story.\n+  isErrorOverlayOpen: false,\n   isDevToolsPanelOpen: false,\n }\n \n@@ -111,11 +111,13 @@ function useOverlayReducer() {\n         case ACTION_ERROR_OVERLAY_TOGGLE: {\n           return { ...state, isErrorOverlayOpen: !state.isErrorOverlayOpen }\n         }\n+        case ACTION_DEVTOOLS_PANEL_TOGGLE: {\n+          return { ...state, isDevToolsPanelOpen: !state.isDevToolsPanelOpen }\n+        }\n         default: {\n           return state\n         }\n       }\n-      return state\n     },\n     initialState\n   )\n@@ -150,3 +152,37 @@ export const Default: Story = {\n     )\n   },\n }\n+\n+export const WithPanel: Story = {\n+  beforeEach: () => {\n+    process.env.__NEXT_DEVTOOL_NEW_PANEL_UI = 'true'\n+\n+    // clean up callback function\n+    return () => {\n+      delete process.env.__NEXT_DEVTOOL_NEW_PANEL_UI\n+    }\n+  },\n+  render: function DevOverlayStory() {\n+    const [state, dispatch] = useOverlayReducer()\n+    return (\n+      <>\n+        <img\n+          src={imgApp}\n+          style={{\n+            width: '100%',\n+            height: '100vh',\n+            objectFit: 'contain',\n+          }}\n+        />\n+        <DevOverlay\n+          state={state}\n+          dispatch={dispatch}\n+          getSquashedHydrationErrorDetails={\n+            // Testing like App Router where we no longer quash hydration errors\n+            getNoSquashedHydrationErrorDetails\n+          }\n+        />\n+      </>\n+    )\n+  },\n+}"
        },
        {
            "sha": "03121f9288e0add2453f9d7f490332f9eec999dd",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.tsx",
            "status": "modified",
            "additions": 3,
            "deletions": 1,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/75b7fe201f73a1fb3b962b07aa0baac4d57f6029/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx?ref=75b7fe201f73a1fb3b962b07aa0baac4d57f6029",
            "patch": "@@ -48,7 +48,9 @@ export function DevOverlay({\n                       isBuildError={isBuildError}\n                     />\n \n-                    {state.isDevToolsPanelOpen && <DevToolsPanel />}\n+                    {state.isDevToolsPanelOpen && (\n+                      <DevToolsPanel state={state} dispatch={dispatch} />\n+                    )}\n                   </>\n                 ) : (\n                   <DevToolsIndicator"
        }
    ],
    "stats": {
        "total": 155,
        "additions": 139,
        "deletions": 16
    }
}