{
    "author": "lubieowoce",
    "message": "add unstable_prefetch config to typescript plugin (#83181)\n\nIn #8290 i forgot to update our typescript plugin, so exporting\n`unstable_prefetch` caused it to error.\n\nThis is fixed now:\n<img width=\"871\" height=\"145\" alt=\"Screenshot 2025-08-28 at 17 19 18\"\nsrc=\"https://github.com/user-attachments/assets/ca295029-5a93-483b-8f2b-2f821c452397\"\n/>\n<img width=\"841\" height=\"176\" alt=\"Screenshot 2025-08-28 at 17 19 29\"\nsrc=\"https://github.com/user-attachments/assets/414b18f8-c3c0-46fd-acd0-25b04a85fbd2\"\n/>\nI've also added some type safety to the `options` objects that we\nspecify there to make sure they're in sync with the values they\ndescribe.",
    "sha": "a8c9d07a026a02831af83d874a91f42dc58a8866",
    "files": [
        {
            "sha": "a5109fe4325893119a1ff662ed6dad64f5da1ab6",
            "filename": "packages/next/src/server/typescript/rules/config.ts",
            "status": "modified",
            "additions": 39,
            "deletions": 5,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/a8c9d07a026a02831af83d874a91f42dc58a8866/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fconfig.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a8c9d07a026a02831af83d874a91f42dc58a8866/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fconfig.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fconfig.ts?ref=a8c9d07a026a02831af83d874a91f42dc58a8866",
            "patch": "@@ -12,6 +12,7 @@ import {\n   LEGACY_CONFIG_EXPORT,\n } from '../constant'\n import type tsModule from 'typescript/lib/tsserverlibrary'\n+import type { AppSegmentConfig } from '../../../build/segment-config/app/app-segment-config'\n \n const API_DOCS: Record<\n   string,\n@@ -37,7 +38,7 @@ const API_DOCS: Record<\n         'This errors if any dynamic Hooks or fetches are used. (This is equivalent to `getStaticProps`.)',\n       '\"force-static\"':\n         'This forces caching of all fetches and returns empty values from `cookies`, `headers` and `useSearchParams`.',\n-    },\n+    } satisfies DocsOptionsObject<FullAppSegmentConfig['dynamic']>,\n     link: 'https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#dynamic',\n   },\n   fetchCache: {\n@@ -58,7 +59,7 @@ const API_DOCS: Record<\n         \"This lets you enforce that all data opts into caching. This option makes `fetch()` reject with an error if `cache: 'force-cache'` is provided. It also changes the default to `force-cache`. This error can be discovered early during static builds - or dynamically during Edge rendering.\",\n       '\"force-cache\"':\n         \"This lets you intentionally opt-in to all caching of data. This option forces all fetches to be cache even if the `cache: 'no-store'` option is passed to `fetch()`.\",\n-    },\n+    } satisfies DocsOptionsObject<FullAppSegmentConfig['fetchCache']>,\n     link: 'https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#fetchcache',\n   },\n   preferredRegion: {\n@@ -115,7 +116,7 @@ const API_DOCS: Record<\n       true: 'Allow rendering dynamic params that are not generated by `generateStaticParams`.',\n       false:\n         'Disallow rendering dynamic params that are not generated by `generateStaticParams`.',\n-    },\n+    } satisfies DocsOptionsObject<FullAppSegmentConfig['dynamicParams']>,\n     link: 'https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#dynamicparams',\n     isValid: (value: string) => {\n       return value === 'true' || value === 'false'\n@@ -128,7 +129,9 @@ const API_DOCS: Record<\n       '\"nodejs\"': 'Prefer the Node.js runtime.',\n       '\"edge\"': 'Prefer the Edge runtime.',\n       '\"experimental-edge\"': `@deprecated\\n\\nThis option is no longer experimental. Use \\`edge\\` instead.`,\n-    },\n+    } satisfies DocsOptionsObject<\n+      FullAppSegmentConfig['runtime'] | 'experimental-edge'\n+    >,\n     link: 'https://nextjs.org/docs/app/api-reference/file-conventions/route-segment-config#runtime',\n   },\n   metadata: {\n@@ -152,13 +155,44 @@ const API_DOCS: Record<\n     options: {\n       true: 'Enable PPR for this route',\n       false: 'Disable PPR for this route',\n-    },\n+    } satisfies DocsOptionsObject<FullAppSegmentConfig['experimental_ppr']>,\n     isValid: (value: string) => {\n       return value === 'true' || value === 'false'\n     },\n   },\n+  unstable_prefetch: {\n+    description: `Specifies the default prefetching behavior for this segment. This configuration is currently under development and will change.`,\n+    link: '(docs coming soon)',\n+    options: {\n+      '\"unstable_static\"':\n+        'Only static and cached parts of the page will be prefetched. (default)',\n+      '\"unstable_runtime\"':\n+        'Parts of the page that use route params, search params, or cookies will also be prefetched.',\n+    } satisfies DocsOptionsObject<FullAppSegmentConfig['unstable_prefetch']>,\n+  },\n }\n \n+type FullAppSegmentConfig = Required<AppSegmentConfig>\n+\n+/**\n+ * Maps a type for a config value to a docs object that lists all its values.\n+ * This ensures that all the valid options are listed.\n+ * Note that values that aren't primitives are skipped.\n+ *\n+ * ```\n+ * DocsOptionsObject<0 | false | \"yes\"> = { 0: string, false: string, '\"yes\"': string }\n+ * ```\n+ */\n+type DocsOptionsObject<T> = {\n+  [Value in T as AsObjectKey<Value>]: string\n+}\n+\n+type AsObjectKey<Value> = Value extends string\n+  ? `\"${Value}\"`\n+  : Value extends number | boolean | null | undefined\n+    ? `${Value}`\n+    : never\n+\n function visitEntryConfig(\n   fileName: string,\n   position: number,"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 39,
        "deletions": 5
    }
}