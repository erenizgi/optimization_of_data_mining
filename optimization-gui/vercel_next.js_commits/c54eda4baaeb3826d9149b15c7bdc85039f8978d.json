{
    "author": "lukesandberg",
    "message": "[turbopack] Mark packages as side effect free when local analysis determines that they are. (#86398)\n\nThis implements some simple static analysis to determine if modules are side effect free based on their top level module evaluation items.\n\nThe rules are simple\n * declarations ✅ \n * literals ✅ \n * property access ✅  (potentially controversal but consistent with other bundlers)\n * function calls ❌  (unless part of an builtin allowlist, e.g. `Object.keys`)\n\nimports are obviously the difficult part, for that reason we can evaluate a module to `SideEffectful` `SideEffectFree` or `ModuleEvaluationIsSideEffectFree`.  A later step will leverage a graph analysis step to determine of transitive dependencies of ModuleEvaluationIsSideEffectFree modules are also side effect free and upgrade it.\n\nSo for right now the impact is minor.  There is also an experimental option to disable it in case it causes trouble this can help us debug\n\nI tested the performance on vercel site and as expected it isn't really observable\n\nwith side effect analysis disabled\n```\n~/projects/front/apps/vercel-site (main *)$ hyperfine -p 'rm -rf .next' -w 2 -r 20  'pnpm next build --turbopack --experimental-build-mode=compile'\nBenchmark 1: pnpm next build --turbopack --experimental-build-mode=compile\n  Time (mean ± σ):     48.017 s ±  1.696 s    [User: 319.651 s, System: 44.273 s]\n  Range (min … max):   44.855 s … 50.600 s    20 runs\n```\n\nWith it enabled.\n```\n~/projects/front/apps/vercel-site (main *)$ hyperfine -p 'rm -rf .next' -w 2 -r 20  'pnpm next build --turbopack --experimental-build-mode=compile'\nBenchmark 1: pnpm next build --turbopack --experimental-build-mode=compile\n  Time (mean ± σ):     48.038 s ±  2.337 s    [User: 320.261 s, System: 45.434 s]\n  Range (min … max):   44.156 s … 52.774 s    20 runs\n```\n\nso if there is a regression it is well within the noise.",
    "sha": "c54eda4baaeb3826d9149b15c7bdc85039f8978d",
    "files": [
        {
            "sha": "8f4dd859d993c99c31e1d595d8a0506a110fe4a2",
            "filename": "Cargo.lock",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/Cargo.lock",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/Cargo.lock",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/Cargo.lock?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -9775,6 +9775,7 @@ dependencies = [\n  \"once_cell\",\n  \"parking_lot\",\n  \"petgraph 0.8.3\",\n+ \"phf\",\n  \"regex\",\n  \"rustc-hash 2.1.1\",\n  \"serde\","
        },
        {
            "sha": "3ab39e4dc63245c0a018fcb43428d6d9d74e002e",
            "filename": "crates/next-core/src/next_client/context.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -326,6 +326,7 @@ pub async fn get_client_module_options_context(\n         ecmascript: EcmascriptOptionsContext {\n             enable_typeof_window_inlining: Some(TypeofWindow::Object),\n             source_maps,\n+            infer_module_side_effects: *next_config.turbopack_infer_module_side_effects().await?,\n             ..Default::default()\n         },\n         css: CssOptionsContext {"
        },
        {
            "sha": "3d886995fc7fce18547222663fea696ee487eba5",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -1055,6 +1055,8 @@ pub struct ExperimentalConfig {\n     turbopack_remove_unused_imports: Option<bool>,\n     /// Defaults to false in development mode, true in production mode.\n     turbopack_remove_unused_exports: Option<bool>,\n+    /// Enable local analysis to infer side effect free modules. Defaults to true.\n+    turbopack_infer_module_side_effects: Option<bool>,\n     /// Devtool option for the segment explorer.\n     devtool_segment_explorer: Option<bool>,\n }\n@@ -2028,6 +2030,15 @@ impl NextConfig {\n         ))\n     }\n \n+    #[turbo_tasks::function]\n+    pub fn turbopack_infer_module_side_effects(&self) -> Vc<bool> {\n+        Vc::cell(\n+            self.experimental\n+                .turbopack_infer_module_side_effects\n+                .unwrap_or(true),\n+        )\n+    }\n+\n     #[turbo_tasks::function]\n     pub async fn module_ids(&self, mode: Vc<NextMode>) -> Result<Vc<ModuleIds>> {\n         Ok(match *mode.await? {"
        },
        {
            "sha": "f21fe05e81eb9756a491cafab4f898adda0d76f7",
            "filename": "crates/next-core/src/next_server/context.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -582,6 +582,7 @@ pub async fn get_server_module_options_context(\n             import_externals: *next_config.import_externals().await?,\n             ignore_dynamic_requests: true,\n             source_maps,\n+            infer_module_side_effects: *next_config.turbopack_infer_module_side_effects().await?,\n             ..Default::default()\n         },\n         execution_context: Some(execution_context),"
        },
        {
            "sha": "fc6b77abc0cb1f22036250cf9c811684767b8c7a",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -310,6 +310,7 @@ export const experimentalSchema = {\n   turbopackUseBuiltinBabel: z.boolean().optional(),\n   turbopackUseBuiltinSass: z.boolean().optional(),\n   turbopackModuleIds: z.enum(['named', 'deterministic']).optional(),\n+  turbopackInferModuleSideEffects: z.boolean().optional(),\n   optimizePackageImports: z.array(z.string()).optional(),\n   optimizeServerReact: z.boolean().optional(),\n   clientTraceMetadata: z.array(z.string()).optional(),"
        },
        {
            "sha": "70ae296d9c3905d55e604f04a4a21f4e1ff43b13",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -464,6 +464,15 @@ export interface ExperimentalConfig {\n    */\n   turbopackRemoveUnusedExports?: boolean\n \n+  /**\n+   * Enable local analysis to infer side effect free modules. When enabled, Turbopack will\n+   * analyze module code to determine if it has side effects. This can improve tree shaking\n+   * and bundle size at the cost of some additional analysis.\n+   *\n+   * Defaults to `true`.\n+   */\n+  turbopackInferModuleSideEffects?: boolean\n+\n   /**\n    * Use the system-provided CA roots instead of bundled CA roots for external HTTPS requests\n    * made by Turbopack. Currently this is only used for fetching data from Google Fonts."
        },
        {
            "sha": "4df9deed466c3ce419bc285429ae1ff1a1e2e783",
            "filename": "turbopack/crates/turbopack-core/src/module.rs",
            "status": "modified",
            "additions": 19,
            "deletions": 1,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -1,5 +1,7 @@\n+use bincode::{Decode, Encode};\n+use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n-use turbo_tasks::{ResolvedVc, TaskInput, ValueToString, Vc};\n+use turbo_tasks::{NonLocalValue, ResolvedVc, TaskInput, ValueToString, Vc, trace::TraceRawVcs};\n use turbo_tasks_fs::glob::Glob;\n \n use crate::{asset::Asset, ident::AssetIdent, reference::ModuleReferences, source::OptionSource};\n@@ -11,6 +13,22 @@ pub enum StyleType {\n     GlobalStyle,\n }\n \n+#[derive(\n+    Serialize, Deserialize, Hash, Eq, PartialEq, Debug, NonLocalValue, TraceRawVcs, Encode, Decode,\n+)]\n+pub enum ModuleSideEffects {\n+    /// Analysis determined that the module evaluation is side effect free\n+    /// the module may still be side effectful based on its imports.\n+    ModuleEvaluationIsSideEffectFree,\n+    /// Is known to be side effect free either due to static analysis or some kind of configuration.\n+    /// ```js\n+    /// \"use turbopack no side effects\"\n+    /// ```\n+    SideEffectFree,\n+    // Neither of the above, so we should assume it has side effects.\n+    SideEffectful,\n+}\n+\n /// A module. This usually represents parsed source code, which has references\n /// to other modules.\n #[turbo_tasks::value_trait]"
        },
        {
            "sha": "35cdad2989222b3ab781cbe1389c640f1c2dfe0c",
            "filename": "turbopack/crates/turbopack-core/src/module_graph/side_effect_module_info.rs",
            "status": "added",
            "additions": 128,
            "deletions": 0,
            "changes": 128,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fside_effect_module_info.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fside_effect_module_info.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fmodule_graph%2Fside_effect_module_info.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,128 @@\n+use anyhow::Result;\n+use rustc_hash::{FxHashMap, FxHashSet};\n+use turbo_tasks::{ResolvedVc, TryJoinIterExt, Vc};\n+\n+use crate::{\n+    module::{Module, ModuleSideEffects},\n+    module_graph::{GraphTraversalAction, ModuleGraph, SingleModuleGraphWithBindingUsage},\n+};\n+\n+/// This lists all the modules that are side effect free\n+/// This means they are either declared side effect free by some configuration or they have been\n+/// determined to be side effect free via static analysis of the module evaluation and dependencies.\n+#[turbo_tasks::value(transparent)]\n+pub struct SideEffectFreeModules(FxHashSet<ResolvedVc<Box<dyn Module>>>);\n+\n+/// Computes the set of side effect free modules in the module graph.\n+///\n+/// This leverages the module graph to compute if modules with `ModuleEvalutationIsSideEffectFree`\n+/// status are actually side effectful or not.\n+///\n+/// A current limitation is that the module graph doesn't contain information on how 'late' imports\n+/// are used.  e.g. if there is a dynamic import with side effects in an event handler, we will mark\n+/// the module as side effectful even though it isn't.  To fix this the module graph would need to\n+/// record more information about the nature of the edges.\n+#[turbo_tasks::function]\n+pub async fn compute_side_effect_free_module_info(\n+    graphs: ResolvedVc<ModuleGraph>,\n+) -> Result<Vc<SideEffectFreeModules>> {\n+    // Layout segment optimization, we can individually compute the side effect free modules for\n+    // each graph.\n+    let mut result: Vc<SideEffectFreeModules> = Vc::cell(Default::default());\n+    let graphs = graphs.await?;\n+    for graph in graphs.iter_graphs() {\n+        result = compute_side_effect_free_module_info_single(graph, result);\n+    }\n+    Ok(result)\n+}\n+\n+#[turbo_tasks::function]\n+async fn compute_side_effect_free_module_info_single(\n+    graph: SingleModuleGraphWithBindingUsage,\n+    parent_side_effect_free_modules: Vc<SideEffectFreeModules>,\n+) -> Result<Vc<SideEffectFreeModules>> {\n+    let parent_side_effect_free_modules = parent_side_effect_free_modules.await?;\n+    let graph = graph.read().await?;\n+\n+    let module_side_effects = graph\n+        .enumerate_nodes()\n+        .map(async |(_, node)| {\n+            Ok(match node {\n+                super::SingleModuleGraphNode::Module(module) => {\n+                    // This turbo task always has a cache hit since it is called when building the\n+                    // module graph. we could consider moving this information\n+                    // into to the module graph, but then changes would invalidate the whole graph.\n+                    (*module, *module.side_effects().await?)\n+                }\n+                super::SingleModuleGraphNode::VisitedModule { idx: _, module } => (\n+                    *module,\n+                    if parent_side_effect_free_modules.contains(module) {\n+                        ModuleSideEffects::SideEffectFree\n+                    } else {\n+                        ModuleSideEffects::SideEffectful\n+                    },\n+                ),\n+            })\n+        })\n+        .try_join()\n+        .await?\n+        .into_iter()\n+        .collect::<FxHashMap<_, _>>();\n+\n+    // Modules are categorized as side-effectful, locally side effect free and side effect free.\n+    // So we are really just interested in determining what modules that are locally side effect\n+    // free. logically we want to start at all such modules are determine if their transitive\n+    // dependencies are side effect free.\n+\n+    let mut locally_side_effect_free_modules_that_have_side_effects = FxHashSet::default();\n+    graph.traverse_edges_from_entries_dfs_reversed(\n+        // Start from all the side effectful nodes\n+        module_side_effects.iter().filter_map(|(m, e)| {\n+            if *e == ModuleSideEffects::SideEffectful {\n+                Some(*m)\n+            } else {\n+                None\n+            }\n+        }),\n+        &mut (),\n+        // child is a previously visited module that we know is side effectful\n+        // parent is a module that depends on it.\n+        |child, parent, _s| {\n+            Ok(if child.is_some() {\n+                match module_side_effects.get(&parent).unwrap() {\n+                    ModuleSideEffects::SideEffectful | ModuleSideEffects::SideEffectFree => {\n+                        // We have either already seen this or don't want to follow it\n+                        GraphTraversalAction::Exclude\n+                    }\n+                    ModuleSideEffects::ModuleEvaluationIsSideEffectFree => {\n+                        // this module is side effect free locally but depends on `child` which is\n+                        // effectful so it too is effectful\n+                        locally_side_effect_free_modules_that_have_side_effects.insert(parent);\n+                        GraphTraversalAction::Continue\n+                    }\n+                }\n+            } else {\n+                // entry point, we already determined it was effectful, keep going\n+                GraphTraversalAction::Continue\n+            })\n+        },\n+        |_, _, _| Ok(()),\n+    )?;\n+    let side_effect_free_modules = module_side_effects\n+        .into_iter()\n+        .filter_map(|(m, e)| match e {\n+            ModuleSideEffects::SideEffectful => None,\n+            ModuleSideEffects::SideEffectFree => Some(m),\n+            ModuleSideEffects::ModuleEvaluationIsSideEffectFree => {\n+                if locally_side_effect_free_modules_that_have_side_effects.contains(&m) {\n+                    None\n+                } else {\n+                    Some(m)\n+                }\n+            }\n+        })\n+        .chain(parent_side_effect_free_modules.iter().copied())\n+        .collect::<FxHashSet<_>>();\n+\n+    Ok(Vc::cell(side_effect_free_modules))\n+}"
        },
        {
            "sha": "e47504519b7ed8f8258716f4184592b2472330ef",
            "filename": "turbopack/crates/turbopack-ecmascript/Cargo.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2FCargo.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2FCargo.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2FCargo.toml?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -35,6 +35,7 @@ num-bigint = \"0.4\"\n num-traits = \"0.2.15\"\n once_cell = { workspace = true }\n parking_lot = { workspace = true }\n+phf = { version = \"0.11\", features = [\"macros\"] }\n petgraph = { workspace = true }\n dashmap = { workspace = true }\n regex = { workspace = true }"
        },
        {
            "sha": "cae1bdb0aa0d4b2e7ab27585ca10b4454dafe250",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -41,6 +41,7 @@ pub mod builtin;\n pub mod graph;\n pub mod imports;\n pub mod linker;\n+pub mod side_effects;\n pub mod top_level_await;\n pub mod well_known;\n "
        },
        {
            "sha": "9224d163a1f0b979573266b850e17af44544c560",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/side_effects.rs",
            "status": "added",
            "additions": 2369,
            "deletions": 0,
            "changes": 2369,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fside_effects.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fside_effects.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fside_effects.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,2369 @@\n+//! Side effect analysis for JavaScript/TypeScript programs.\n+//!\n+//! This module provides functionality to determine if a javascript script/module has side effects\n+//! during module evaluation. This is useful for tree-shaking and dead code elimination.\n+//!\n+//! ## What are side effects?\n+//!\n+//! A side effect is any observable behavior that occurs when code is executed:\n+//! - Function calls (unless marked with `/*#__PURE__*/` or otherwise known to be pure)\n+//! - Constructor calls (unless marked with `/*#__PURE__*/`or otherwise known to be pure )\n+//! - Assignments to variables or properties\n+//! - Property mutations\n+//! - Update expressions (`++`, `--`)\n+//! - Delete expressions\n+//!\n+//! ## Conservative Analysis\n+//!\n+//! This analyzer is intentionally conservative. When in doubt, it assumes code\n+//! has side effects. This is safe for tree-shaking purposes as it prevents\n+//! incorrectly removing code that might be needed, and can simply be improved over time.\n+//!\n+//! ## Future Enhancement: Local Variable Mutation Tracking\n+//!\n+//! Currently, all assignments, updates, and property mutations are treated as side effects.\n+//! However, mutations to locally-scoped variables that never escape the module evaluation scope\n+//! could be considered side-effect free. This would handle common patterns like:\n+//!\n+//! ```javascript\n+//! // Currently marked as having side effects, but could be pure:\n+//! const config = {};\n+//! config['a'] = 'a';\n+//! config['b'] = 'b';\n+//! export default config;\n+//! ```\n+//!\n+//! A special case to consider would be CJS exports `module.exports ={}` and `export.foo = ` could\n+//! be considered non-effecful just like `ESM` exports.  If we do that we should also consider\n+//! changing how `require` is handled, currently it is considered to be effectful\n+\n+use phf::{phf_map, phf_set};\n+use swc_core::{\n+    common::{Mark, comments::Comments},\n+    ecma::{\n+        ast::*,\n+        visit::{Visit, VisitWith, noop_visit_type},\n+    },\n+};\n+use turbopack_core::module::ModuleSideEffects;\n+\n+use crate::utils::unparen;\n+\n+/// Macro to check if side effects have been detected and return early if so.\n+/// This makes the early-return pattern more explicit and reduces boilerplate.\n+macro_rules! check_side_effects {\n+    ($self:expr) => {\n+        if $self.has_side_effects {\n+            return;\n+        }\n+    };\n+}\n+\n+/// Known pure built-in functions organized by object (e.g., Math, Object, Array).\n+///\n+/// These are JavaScript built-in functions that are known to be side-effect free.\n+/// This list is conservative and only includes functions that:\n+/// 1. Don't modify global state\n+/// 2. Don't perform I/O\n+/// 3. Are deterministic (given the same inputs, produce the same outputs)\n+///\n+/// Note: Some of these can throw exceptions, but for tree-shaking purposes,\n+/// we consider them pure as they don't have observable side effects beyond exceptions.\n+static KNOWN_PURE_FUNCTIONS: phf::Map<&'static str, phf::Set<&'static str>> = phf_map! {\n+    \"Math\" => phf_set! {\n+        \"abs\", \"acos\", \"acosh\", \"asin\", \"asinh\", \"atan\", \"atan2\", \"atanh\", \"cbrt\", \"ceil\",\n+        \"clz32\", \"cos\", \"cosh\", \"exp\", \"expm1\", \"floor\", \"fround\", \"hypot\", \"imul\", \"log\",\n+        \"log10\", \"log1p\", \"log2\", \"max\", \"min\", \"pow\", \"round\", \"sign\", \"sin\", \"sinh\",\n+        \"sqrt\", \"tan\", \"tanh\", \"trunc\",\n+    },\n+    // String static methods\n+    \"String\" => phf_set! {\n+        \"fromCharCode\", \"fromCodePoint\", \"raw\",\n+    },\n+    // Number static methods\n+    \"Number\" => phf_set! {\n+        \"isFinite\", \"isInteger\", \"isNaN\", \"isSafeInteger\", \"parseFloat\", \"parseInt\",\n+    },\n+    // Object static methods (read-only operations)\n+    \"Object\" => phf_set! {\n+        \"keys\", \"values\", \"entries\", \"hasOwn\", \"getOwnPropertyNames\", \"getOwnPropertySymbols\",\n+        \"getOwnPropertyDescriptor\", \"getOwnPropertyDescriptors\", \"getPrototypeOf\", \"is\",\n+        \"isExtensible\", \"isFrozen\", \"isSealed\",\n+    },\n+    // Array static methods\n+    \"Array\" => phf_set! {\n+        \"isArray\", \"from\", \"of\",\n+    },\n+};\n+\n+/// Known pure global functions that can be called directly (not as methods).\n+///\n+/// These are global functions that are side-effect free when called.\n+/// Structured as phf::Set for O(1) lookup.\n+static KNOWN_PURE_GLOBAL_FUNCTIONS: phf::Set<&'static str> = phf_set! {\n+    \"String\",\n+    \"Number\",\n+    \"Symbol\",\n+    \"Boolean\",\n+    \"isNaN\",\n+    \"isFinite\",\n+    \"parseInt\",\n+    \"parseFloat\",\n+    \"decodeURI\",\n+    \"decodeURIComponent\",\n+};\n+\n+/// Known pure constructors.\n+///\n+/// These constructors create new objects without side effects (no global state modification).\n+/// They are safe to eliminate if their result is unused.\n+static KNOWN_PURE_CONSTRUCTORS: phf::Set<&'static str> = phf_set! {\n+    // Built-in collections\n+    \"Set\",\n+    \"Map\",\n+    \"WeakSet\",\n+    \"WeakMap\",\n+    // Regular expressions\n+    \"RegExp\",\n+    // Data structures\n+    \"Array\",\n+    \"Object\",\n+    // Typed arrays\n+    \"Int8Array\",\n+    \"Uint8Array\",\n+    \"Uint8ClampedArray\",\n+    \"Int16Array\",\n+    \"Uint16Array\",\n+    \"Int32Array\",\n+    \"Uint32Array\",\n+    \"Float32Array\",\n+    \"Float64Array\",\n+    \"BigInt64Array\",\n+    \"BigUint64Array\",\n+    // Other built-ins\n+    \"Date\",\n+    \"Error\",\n+    \"TypeError\",\n+    \"RangeError\",\n+    \"SyntaxError\",\n+    \"ReferenceError\",\n+    \"URIError\",\n+    \"EvalError\",\n+    \"Promise\",\n+    \"ArrayBuffer\",\n+    \"DataView\",\n+    \"URL\",\n+    \"URLSearchParams\",\n+    // Boxes\n+    \"String\",\n+    \"Number\",\n+    \"Symbol\",\n+    \"Boolean\",\n+};\n+\n+// For prototype methods we are not saying that these functions are always side effect free but\n+// rather that we can safely reason about their side effects when called on literal expressions.\n+// We do however assume that these functions are not monkey patched.\n+\n+/// Known pure prototype methods for string literals.\n+///\n+/// These methods don't mutate the string (strings are immutable) and don't have side effects.\n+static KNOWN_PURE_STRING_PROTOTYPE_METHODS: phf::Set<&'static str> = phf_set! {\n+    // Case conversion\n+    \"toLowerCase\",\n+    \"toUpperCase\",\n+    \"toLocaleLowerCase\",\n+    \"toLocaleUpperCase\",\n+    \"charAt\",\n+    \"charCodeAt\",\n+    \"codePointAt\",\n+    \"slice\",\n+    \"substring\",\n+    \"substr\",\n+    \"indexOf\",\n+    \"lastIndexOf\",\n+    \"includes\",\n+    \"startsWith\",\n+    \"endsWith\",\n+    \"search\",\n+    \"match\",\n+    \"matchAll\",\n+    \"trim\",\n+    \"trimStart\",\n+    \"trimEnd\",\n+    \"trimLeft\",\n+    \"trimRight\",\n+    \"repeat\",\n+    \"padStart\",\n+    \"padEnd\",\n+    \"concat\",\n+    \"split\",\n+    \"replace\",\n+    \"replaceAll\",\n+    \"normalize\",\n+    \"localeCompare\",\n+    \"isWellFormed\",\n+    \"toString\",\n+    \"valueOf\",\n+};\n+\n+/// Known pure prototype methods for array literals.\n+static KNOWN_PURE_ARRAY_PROTOTYPE_METHODS: phf::Set<&'static str> = phf_set! {\n+    // Non-mutating iteration\n+    \"map\",\n+    \"filter\",\n+    \"reduce\",\n+    \"reduceRight\",\n+    \"find\",\n+    \"findIndex\",\n+    \"findLast\",\n+    \"findLastIndex\",\n+    \"some\",\n+    \"every\",\n+    \"flat\",\n+    \"flatMap\",\n+    // Access methods\n+    \"at\",\n+    \"slice\",\n+    \"concat\",\n+    \"includes\",\n+    \"indexOf\",\n+    \"lastIndexOf\",\n+    \"join\",\n+    // Conversion\n+    \"toLocaleString\",\n+    \"toReversed\",\n+    \"toSorted\",\n+    \"toSpliced\",\n+    \"with\",\n+};\n+\n+static KNOWN_PURE_OBJECT_PROTOTYPE_METHODS: phf::Set<&'static str> = phf_set! {\n+    \"hasOwnProperty\",\n+    \"propertyIsEnumerable\",\n+    \"toString\",\n+    \"valueOf\",\n+};\n+\n+/// Known pure prototype methods for number literals.\n+static KNOWN_PURE_NUMBER_PROTOTYPE_METHODS: phf::Set<&'static str> = phf_set! {\n+    \"toExponential\", \"toFixed\", \"toPrecision\", \"toLocaleString\",\n+};\n+\n+/// Known pure prototype methods for RegExp literals.\n+///\n+/// Note: While `test()` and `exec()` mutate `lastIndex` on regexes with global/sticky flags,\n+/// for literal regexes this is safe because:\n+/// 1. Literals create fresh objects each time\n+/// 2. The mutation is local to that object\n+/// 3. The mutated state doesn't escape the expression\n+///\n+/// However, to be conservative for tree-shaking, we exclude these methods.\n+static KNOWN_PURE_REGEXP_PROTOTYPE_METHODS: phf::Set<&'static str> = phf_set! {\n+    \"test\", \"exec\",\n+};\n+\n+/// Analyzes a program to determine if it contains side effects at the top level.\n+pub fn compute_module_evaluation_side_effects(\n+    program: &Program,\n+    comments: &dyn Comments,\n+    unresolved_mark: Mark,\n+) -> ModuleSideEffects {\n+    let mut visitor = SideEffectVisitor::new(comments, unresolved_mark);\n+    program.visit_with(&mut visitor);\n+    if visitor.has_side_effects {\n+        ModuleSideEffects::SideEffectful\n+    } else if visitor.has_imports {\n+        ModuleSideEffects::ModuleEvaluationIsSideEffectFree\n+    } else {\n+        ModuleSideEffects::SideEffectFree\n+    }\n+}\n+\n+struct SideEffectVisitor<'a> {\n+    comments: &'a dyn Comments,\n+    unresolved_mark: Mark,\n+    has_side_effects: bool,\n+    will_invoke_fn_exprs: bool,\n+    has_imports: bool,\n+}\n+\n+impl<'a> SideEffectVisitor<'a> {\n+    fn new(comments: &'a dyn Comments, unresolved_mark: Mark) -> Self {\n+        Self {\n+            comments,\n+            unresolved_mark,\n+            has_side_effects: false,\n+            will_invoke_fn_exprs: false,\n+            has_imports: false,\n+        }\n+    }\n+\n+    /// Mark that we've found a side effect and stop further analysis.\n+    fn mark_side_effect(&mut self) {\n+        self.has_side_effects = true;\n+    }\n+\n+    /// Temporarily set `will_invoke_fn_exprs` to the given value, execute the closure,\n+    /// then restore the original value.\n+    ///\n+    /// This is useful when analyzing code that may invoke function expressions passed as\n+    /// arguments (e.g., callbacks to pure functions like `array.map(fn)`).\n+    fn with_will_invoke_fn_exprs<F>(&mut self, value: bool, f: F)\n+    where\n+        F: FnOnce(&mut Self),\n+    {\n+        let old_value = self.will_invoke_fn_exprs;\n+        self.will_invoke_fn_exprs = value;\n+        f(self);\n+        self.will_invoke_fn_exprs = old_value;\n+    }\n+\n+    /// Check if a span has a `/*#__PURE__*/` or `/*@__PURE__*/` annotation.\n+    fn is_pure_annotated(&self, span: swc_core::common::Span) -> bool {\n+        self.comments.has_flag(span.lo, \"PURE\")\n+    }\n+\n+    /// Check if a callee expression is a known pure built-in function.\n+    ///\n+    /// This checks if the callee matches patterns like `Math.abs`, `Object.keys`, etc.\n+    fn is_known_pure_builtin(&self, callee: &Callee) -> bool {\n+        match callee {\n+            Callee::Expr(expr) => self.is_known_pure_builtin_function(expr),\n+            _ => false,\n+        }\n+    }\n+    /// Returns true if this call is to `import()` or `require()`.\n+    /// This is conservative since we don't resolve aliases and also because we don't support things\n+    /// like `require.context` or `import.meta` apis\n+    fn is_require_or_import(&self, callee: &Callee) -> bool {\n+        match callee {\n+            Callee::Expr(expr) => {\n+                let expr = unparen(expr);\n+                if let Expr::Ident(ident) = expr {\n+                    ident.ctxt.outer() == self.unresolved_mark && ident.sym.as_ref() == \"require\"\n+                } else {\n+                    false\n+                }\n+            }\n+\n+            Callee::Import(_) => true,\n+            _ => false,\n+        }\n+    }\n+    /// Check if an expression is a known pure built-in function.\n+    ///\n+    /// This checks for:\n+    /// - Member expressions like `Math.abs`, `Object.keys`, etc.\n+    /// - Global function identifiers like `isNaN`, `parseInt`, etc.\n+    /// - Literal receiver methods like `\"hello\".toLowerCase()`, `[1,2,3].map()`, etc.\n+    ///\n+    /// Only returns true if the base identifier is in the global scope (unresolved).\n+    /// If it's shadowed by a local variable, we cannot assume it's the built-in.\n+    fn is_known_pure_builtin_function(&self, expr: &Expr) -> bool {\n+        match expr {\n+            Expr::Member(member) => {\n+                let receiver = unparen(&member.obj);\n+                match (receiver, &member.prop) {\n+                    // Handle global object methods like Math.abs, Object.keys, etc.\n+                    (Expr::Ident(obj), MemberProp::Ident(prop)) => {\n+                        // Only consider it pure if the base identifier is unresolved (global\n+                        // scope). Check if the identifier's context matches\n+                        // the unresolved mark.\n+                        if obj.ctxt.outer() != self.unresolved_mark {\n+                            // The identifier is in a local scope, might be shadowed\n+                            return false;\n+                        }\n+\n+                        // O(1) lookup: check if the object has the method in our known pure\n+                        // functions\n+                        KNOWN_PURE_FUNCTIONS\n+                            .get(obj.sym.as_ref())\n+                            .map(|methods| methods.contains(prop.sym.as_ref()))\n+                            .unwrap_or(false)\n+                    }\n+                    // Handle literal receiver methods like \"hello\".toLowerCase(), [1,2,3].map(),\n+                    // etc.\n+                    (Expr::Lit(lit), MemberProp::Ident(prop)) => {\n+                        let method_name = prop.sym.as_ref();\n+                        match lit {\n+                            Lit::Str(_) => {\n+                                KNOWN_PURE_STRING_PROTOTYPE_METHODS.contains(method_name)\n+                                    || KNOWN_PURE_OBJECT_PROTOTYPE_METHODS.contains(method_name)\n+                            }\n+                            Lit::Num(_) => {\n+                                KNOWN_PURE_NUMBER_PROTOTYPE_METHODS.contains(method_name)\n+                                    || KNOWN_PURE_OBJECT_PROTOTYPE_METHODS.contains(method_name)\n+                            }\n+                            Lit::Bool(_) => {\n+                                KNOWN_PURE_OBJECT_PROTOTYPE_METHODS.contains(method_name)\n+                            }\n+                            Lit::Regex(_) => {\n+                                KNOWN_PURE_REGEXP_PROTOTYPE_METHODS.contains(method_name)\n+                                    || KNOWN_PURE_OBJECT_PROTOTYPE_METHODS.contains(method_name)\n+                            }\n+                            _ => false,\n+                        }\n+                    }\n+                    // Handle array literal methods like [1,2,3].map()\n+                    // Note: We don't check array elements here - that's handled in visit_expr\n+                    (Expr::Array(_), MemberProp::Ident(prop)) => {\n+                        let method_name = prop.sym.as_ref();\n+                        KNOWN_PURE_ARRAY_PROTOTYPE_METHODS.contains(method_name)\n+                            || KNOWN_PURE_OBJECT_PROTOTYPE_METHODS.contains(method_name)\n+                    }\n+                    (Expr::Object(_), MemberProp::Ident(prop)) => {\n+                        KNOWN_PURE_OBJECT_PROTOTYPE_METHODS.contains(prop.sym.as_ref())\n+                    }\n+                    _ => false,\n+                }\n+            }\n+            Expr::Ident(ident) => {\n+                // Check for global pure functions like isNaN, parseInt, etc.\n+                // Only consider it pure if the identifier is unresolved (global scope).\n+                if ident.ctxt.outer() != self.unresolved_mark {\n+                    return false;\n+                }\n+\n+                // O(1) lookup in the global functions set\n+                KNOWN_PURE_GLOBAL_FUNCTIONS.contains(ident.sym.as_ref())\n+            }\n+            _ => false,\n+        }\n+    }\n+\n+    /// Check if an expression is a known pure constructor.\n+    ///\n+    /// These are built-in constructors that create new objects without side effects.\n+    /// Only returns true if the identifier is in the global scope (unresolved).\n+    /// If it's shadowed by a local variable, we cannot assume it's the built-in constructor.\n+    fn is_known_pure_constructor(&self, expr: &Expr) -> bool {\n+        match expr {\n+            Expr::Ident(ident) => {\n+                // Only consider it pure if the identifier is unresolved (global scope).\n+                // Check if the identifier's context matches the unresolved mark.\n+                if ident.ctxt.outer() != self.unresolved_mark {\n+                    return false;\n+                }\n+\n+                // O(1) lookup in the constructors set\n+                KNOWN_PURE_CONSTRUCTORS.contains(ident.sym.as_ref())\n+            }\n+            _ => false,\n+        }\n+    }\n+}\n+\n+impl<'a> Visit for SideEffectVisitor<'a> {\n+    noop_visit_type!();\n+    // If we've already found side effects, skip further visitation\n+    fn visit_program(&mut self, program: &Program) {\n+        check_side_effects!(self);\n+        program.visit_children_with(self);\n+    }\n+\n+    fn visit_module(&mut self, module: &Module) {\n+        check_side_effects!(self);\n+\n+        // Only check top-level module items\n+        for item in &module.body {\n+            check_side_effects!(self);\n+            item.visit_with(self);\n+        }\n+    }\n+\n+    fn visit_script(&mut self, script: &Script) {\n+        check_side_effects!(self);\n+\n+        // Only check top-level statements\n+        for stmt in &script.body {\n+            check_side_effects!(self);\n+            stmt.visit_with(self);\n+        }\n+    }\n+\n+    // Module declarations (imports/exports) need special handling\n+    fn visit_module_decl(&mut self, decl: &ModuleDecl) {\n+        check_side_effects!(self);\n+\n+        match decl {\n+            // Import statements may have side effects, which could require full graph analysis\n+            // Record that to decide if we can upgrade ModuleEvaluationIsSideEffectFree to\n+            // SideEffectFree\n+            ModuleDecl::Import(_) => {\n+                self.has_imports = true;\n+            }\n+\n+            // Export declarations need to check their contents\n+            ModuleDecl::ExportDecl(export_decl) => {\n+                // Check the declaration being exported\n+                match &export_decl.decl {\n+                    Decl::Fn(_) => {\n+                        // function declarations are pure\n+                    }\n+                    Decl::Class(class_decl) => {\n+                        // Class declarations can have side effects in static blocks, extends or\n+                        // static property initializers.\n+                        class_decl.visit_with(self);\n+                    }\n+                    Decl::Var(var_decl) => {\n+                        // Variable declarations need their initializers checked\n+                        var_decl.visit_with(self);\n+                    }\n+                    _ => {\n+                        // Other declarations should be checked\n+                        export_decl.decl.visit_with(self);\n+                    }\n+                }\n+            }\n+\n+            ModuleDecl::ExportDefaultDecl(export_default_decl) => {\n+                // Check the default export\n+                match &export_default_decl.decl {\n+                    DefaultDecl::Class(cls) => {\n+                        // Class expressions can have side effects in extends clause and static\n+                        // members\n+                        cls.visit_with(self);\n+                    }\n+                    DefaultDecl::Fn(_) => {\n+                        // function declarations are pure\n+                    }\n+                    DefaultDecl::TsInterfaceDecl(_) => {\n+                        // TypeScript interface declarations are pure\n+                    }\n+                }\n+            }\n+\n+            ModuleDecl::ExportDefaultExpr(export_default_expr) => {\n+                // Check the expression being exported\n+                export_default_expr.expr.visit_with(self);\n+            }\n+\n+            // Re-exports have no side effects\n+            ModuleDecl::ExportNamed(e) => {\n+                if e.src.is_some() {\n+                    // reexports are also imports\n+                    self.has_imports = true;\n+                }\n+            }\n+            ModuleDecl::ExportAll(_) => {\n+                // reexports are also imports\n+                self.has_imports = true;\n+            }\n+\n+            // TypeScript-specific exports\n+            ModuleDecl::TsExportAssignment(_) | ModuleDecl::TsNamespaceExport(_) => {}\n+            ModuleDecl::TsImportEquals(e) => {\n+                // The RHS of a ts import equals expression is typically an identifier but it might\n+                // also be a require!\n+                match &e.module_ref {\n+                    TsModuleRef::TsEntityName(_) => {}\n+                    TsModuleRef::TsExternalModuleRef(_) => {\n+                        // This is a `import x = require('y')` call\n+                        self.has_imports = true\n+                    }\n+                }\n+            }\n+        }\n+    }\n+\n+    // Statement-level detection\n+    fn visit_stmt(&mut self, stmt: &Stmt) {\n+        check_side_effects!(self);\n+\n+        match stmt {\n+            // Expression statements need checking\n+            Stmt::Expr(expr_stmt) => {\n+                expr_stmt.visit_with(self);\n+            }\n+            // Variable declarations need checking (initializers might have side effects)\n+            Stmt::Decl(Decl::Var(var_decl)) => {\n+                var_decl.visit_with(self);\n+            }\n+            // Function declarations are side-effect free\n+            Stmt::Decl(Decl::Fn(_)) => {\n+                // Function declarations don't execute, so no side effects\n+            }\n+            // Class declarations can have side effects in extends clause and static members\n+            Stmt::Decl(Decl::Class(class_decl)) => {\n+                class_decl.visit_with(self);\n+            }\n+            // Other declarations\n+            Stmt::Decl(decl) => {\n+                decl.visit_with(self);\n+            }\n+            // For other statement types, be conservative\n+            _ => {\n+                // Most other statement types (if, for, while, etc.) at top level\n+                // would be unusual and potentially have side effects\n+                self.mark_side_effect();\n+            }\n+        }\n+    }\n+\n+    fn visit_var_declarator(&mut self, var_decl: &VarDeclarator) {\n+        check_side_effects!(self);\n+\n+        // Check the pattern (for default values in destructuring)\n+        var_decl.name.visit_with(self);\n+\n+        // Check the initializer\n+        if let Some(init) = &var_decl.init {\n+            init.visit_with(self);\n+        }\n+    }\n+\n+    // Expression-level detection\n+    fn visit_expr(&mut self, expr: &Expr) {\n+        check_side_effects!(self);\n+\n+        match expr {\n+            // Pure expressions\n+            Expr::Lit(_) => {\n+                // Literals are always pure\n+            }\n+            Expr::Ident(_) => {\n+                // Reading identifiers is pure\n+            }\n+            Expr::Arrow(_) | Expr::Fn(_) => {\n+                // Function expressions are pure (don't execute until called)\n+                if self.will_invoke_fn_exprs {\n+                    // assume that any nested function expressions will not be invoked.\n+                    self.with_will_invoke_fn_exprs(false, |this| {\n+                        expr.visit_children_with(this);\n+                    });\n+                }\n+            }\n+            Expr::Class(class_expr) => {\n+                // Class expressions can have side effects in extends clause and static members\n+                class_expr.class.visit_with(self);\n+            }\n+            Expr::Array(arr) => {\n+                // Arrays are pure if their elements are pure\n+                for elem in arr.elems.iter().flatten() {\n+                    elem.visit_with(self);\n+                }\n+            }\n+            Expr::Object(obj) => {\n+                // Objects are pure if their property names and initializers\n+                for prop in &obj.props {\n+                    prop.visit_with(self);\n+                }\n+            }\n+            Expr::Unary(unary) => {\n+                // Most unary operations are pure, but delete is not\n+                if unary.op == UnaryOp::Delete {\n+                    // TODO: allow deletes to module level variables or properties defined on module\n+                    // level variables\n+                    self.mark_side_effect();\n+                } else {\n+                    unary.arg.visit_with(self);\n+                }\n+            }\n+            Expr::Bin(bin) => {\n+                // Binary operations are pure if operands are pure\n+                bin.left.visit_with(self);\n+                bin.right.visit_with(self);\n+            }\n+            Expr::Cond(cond) => {\n+                // Conditional is pure if all parts are pure\n+                cond.test.visit_with(self);\n+                cond.cons.visit_with(self);\n+                cond.alt.visit_with(self);\n+            }\n+            Expr::Member(member) => {\n+                // Member access is pure - just reading a property doesn't cause side effects.\n+                // While getters *could* have side effects, in practice:\n+                // 1. Most code doesn't use getters with side effects (rare pattern)\n+                // 2. Webpack and rolldown treat member access as pure\n+                // 3. Being too conservative here would mark too much code as impure\n+                //\n+                // We check the object and property for side effects (e.g., computed properties)\n+                member.obj.visit_with(self);\n+                member.prop.visit_with(self);\n+            }\n+            Expr::Paren(paren) => {\n+                // Parenthesized expressions inherit purity from inner expr\n+                paren.expr.visit_with(self);\n+            }\n+            Expr::Tpl(tpl) => {\n+                // Template literals are pure if expressions are pure\n+                for expr in &tpl.exprs {\n+                    expr.visit_with(self);\n+                }\n+            }\n+\n+            // Impure expressions (conservative)\n+            Expr::Call(call) => {\n+                // Check for /*#__PURE__*/ annotation or for a well known function\n+                if self.is_pure_annotated(call.span) || self.is_known_pure_builtin(&call.callee) {\n+                    // For known pure builtins, we need to check both:\n+                    // 1. The receiver (e.g., the array in [foo(), 2, 3].map(...))\n+                    // 2. The arguments\n+\n+                    // Check the receiver\n+                    call.callee.visit_with(self);\n+\n+                    // Check all arguments\n+                    // Assume that any function expressions in the arguments will be invoked.\n+                    self.with_will_invoke_fn_exprs(true, |this| {\n+                        call.args.visit_children_with(this);\n+                    });\n+                } else if self.is_require_or_import(&call.callee) {\n+                    self.has_imports = true;\n+                    // It would be weird to have a side effect in a require(...) statement, but not\n+                    // impossible.\n+                    call.args.visit_children_with(self);\n+                } else {\n+                    // Unmarked calls are considered to have side effects\n+                    self.mark_side_effect();\n+                }\n+            }\n+            Expr::New(new) => {\n+                // Check for /*#__PURE__*/ annotation or known pure constructor\n+                if self.is_pure_annotated(new.span) || self.is_known_pure_constructor(&new.callee) {\n+                    // Pure constructor, but still need to check arguments\n+                    self.with_will_invoke_fn_exprs(true, |this| {\n+                        new.args.visit_children_with(this);\n+                    });\n+                } else {\n+                    // Unknown constructor calls are considered to have side effects\n+                    self.mark_side_effect();\n+                }\n+            }\n+            Expr::Assign(_) => {\n+                // Assignments have side effects\n+                // TODO: allow assignments to module level variables\n+                self.mark_side_effect();\n+            }\n+            Expr::Update(_) => {\n+                // Updates (++, --) have side effects\n+                // TODO: allow updates to module level variables\n+                self.mark_side_effect();\n+            }\n+            Expr::Await(e) => {\n+                e.arg.visit_with(self);\n+            }\n+            Expr::Yield(e) => {\n+                e.arg.visit_with(self);\n+            }\n+            Expr::TaggedTpl(tagged_tpl) => {\n+                // Tagged template literals are function calls\n+                // But some are known to be pure, like String.raw\n+                if self.is_known_pure_builtin_function(&tagged_tpl.tag) {\n+                    for arg in &tagged_tpl.tpl.exprs {\n+                        arg.visit_with(self);\n+                    }\n+                } else {\n+                    self.mark_side_effect();\n+                }\n+            }\n+            Expr::OptChain(opt_chain) => {\n+                // Optional chaining can be pure if it's just member access\n+                // But if it's an optional call, it has side effects\n+                opt_chain.base.visit_with(self);\n+            }\n+            Expr::Seq(seq) => {\n+                // Sequence expressions - check each expression\n+                seq.exprs.visit_children_with(self);\n+            }\n+            Expr::SuperProp(super_prop) => {\n+                // Super property access is pure (reading from parent class)\n+                // Check if the property expression has side effects\n+                super_prop.prop.visit_with(self);\n+            }\n+            Expr::MetaProp(_) => {\n+                // Meta properties like import.meta and new.target are pure\n+                // They just read metadata, don't cause side effects\n+            }\n+            Expr::JSXMember(_) | Expr::JSXNamespacedName(_) | Expr::JSXEmpty(_) => {\n+                // JSX member expressions and names are pure (they're just identifiers)\n+            }\n+            Expr::JSXElement(_) | Expr::JSXFragment(_) => {\n+                // JSX elements compile to function calls (React.createElement, etc.)\n+                // These are side effect free but we don't technically know at this point that it is\n+                // react (could be solid or qwik or millionjs).  In any case it doesn't matter too\n+                // much since it is weird to construct jsx at the module scope.\n+                self.mark_side_effect();\n+            }\n+            Expr::PrivateName(_) => {\n+                // Private names are pure (just identifiers)\n+            }\n+\n+            // Be conservative for other expression types and just assume they are effectful\n+            _ => {\n+                self.mark_side_effect();\n+            }\n+        }\n+    }\n+\n+    fn visit_opt_chain_base(&mut self, base: &OptChainBase) {\n+        check_side_effects!(self);\n+\n+        match base {\n+            OptChainBase::Member(member) => {\n+                member.visit_with(self);\n+            }\n+            OptChainBase::Call(_opt_call) => {\n+                // Optional calls are still calls, so impure\n+                // We could maybe support some of these `(foo_enabled? undefined :\n+                // [])?.map(...)` but this seems pretty theoretical\n+                self.mark_side_effect();\n+            }\n+        }\n+    }\n+\n+    fn visit_prop_or_spread(&mut self, prop: &PropOrSpread) {\n+        check_side_effects!(self);\n+\n+        match prop {\n+            PropOrSpread::Spread(spread) => {\n+                spread.expr.visit_with(self);\n+            }\n+            PropOrSpread::Prop(prop) => {\n+                prop.visit_with(self);\n+            }\n+        }\n+    }\n+\n+    fn visit_prop(&mut self, prop: &Prop) {\n+        check_side_effects!(self);\n+\n+        match prop {\n+            Prop::KeyValue(kv) => {\n+                kv.key.visit_with(self);\n+                kv.value.visit_with(self);\n+            }\n+            Prop::Getter(getter) => {\n+                getter.key.visit_with(self);\n+                // Body is not executed at definition time\n+            }\n+            Prop::Setter(setter) => {\n+                setter.key.visit_with(self);\n+                // Body is not executed at definition time\n+            }\n+            Prop::Method(method) => {\n+                method.key.visit_with(self);\n+                // Body is not executed at definition time\n+            }\n+            Prop::Shorthand(_) => {\n+                // Shorthand properties are pure\n+            }\n+            Prop::Assign(_) => {\n+                // Assignment properties (used in object rest/spread patterns)\n+                // are side-effect free at definition\n+            }\n+        }\n+    }\n+\n+    fn visit_prop_name(&mut self, prop_name: &PropName) {\n+        check_side_effects!(self);\n+\n+        match prop_name {\n+            PropName::Computed(computed) => {\n+                // Computed property names need evaluation\n+                computed.expr.visit_with(self);\n+            }\n+            _ => {\n+                // Other property names are pure\n+            }\n+        }\n+    }\n+\n+    fn visit_class(&mut self, class: &Class) {\n+        check_side_effects!(self);\n+\n+        // Check decorators - they execute at definition time\n+        for decorator in &class.decorators {\n+            decorator.visit_with(self);\n+        }\n+\n+        // Check the extends clause - this is evaluated at definition time\n+        if let Some(super_class) = &class.super_class {\n+            super_class.visit_with(self);\n+        }\n+\n+        // Check class body for static members\n+        for member in &class.body {\n+            member.visit_with(self);\n+        }\n+    }\n+\n+    fn visit_class_member(&mut self, member: &ClassMember) {\n+        check_side_effects!(self);\n+\n+        match member {\n+            // Static blocks execute at class definition time\n+            ClassMember::StaticBlock(block) => {\n+                // Static blocks may have side effects because they execute immediately\n+                // Check the statements in the block\n+                for stmt in &block.body.stmts {\n+                    stmt.visit_with(self);\n+                }\n+            }\n+            // Check static properties - they execute at definition time\n+            ClassMember::ClassProp(class_prop) if class_prop.is_static => {\n+                // Check decorators - they execute at definition time\n+                for decorator in &class_prop.decorators {\n+                    decorator.visit_with(self);\n+                }\n+                // Check the property key (for computed properties)\n+                class_prop.key.visit_with(self);\n+                // Check the initializer - static property initializers execute at definition time\n+                if let Some(value) = &class_prop.value {\n+                    value.visit_with(self);\n+                }\n+            }\n+            // Check computed property keys for all members\n+            ClassMember::Method(method) => {\n+                // Check decorators - they execute at definition time\n+                for decorator in &method.function.decorators {\n+                    decorator.visit_with(self);\n+                }\n+                method.key.visit_with(self);\n+                // Method bodies don't execute at definition time\n+            }\n+            ClassMember::Constructor(constructor) => {\n+                constructor.key.visit_with(self);\n+                // Constructor body doesn't execute at definition time\n+            }\n+            ClassMember::PrivateMethod(private_method) => {\n+                // Check decorators - they execute at definition time\n+                for decorator in &private_method.function.decorators {\n+                    decorator.visit_with(self);\n+                }\n+                private_method.key.visit_with(self);\n+                // Method bodies don't execute at definition time\n+            }\n+            ClassMember::ClassProp(class_prop) => {\n+                // Check decorators - they execute at definition time\n+                for decorator in &class_prop.decorators {\n+                    decorator.visit_with(self);\n+                }\n+                // For non-static properties, only check the key\n+                class_prop.key.visit_with(self);\n+                // Instance property initializers don't execute at definition time\n+            }\n+            ClassMember::PrivateProp(private_prop) => {\n+                // Check decorators - they execute at definition time\n+                for decorator in &private_prop.decorators {\n+                    decorator.visit_with(self);\n+                }\n+                private_prop.key.visit_with(self);\n+                // Instance property initializers don't execute at definition time\n+            }\n+            ClassMember::AutoAccessor(auto_accessor) if auto_accessor.is_static => {\n+                // Check decorators - they execute at definition time\n+                for decorator in &auto_accessor.decorators {\n+                    decorator.visit_with(self);\n+                }\n+                // Static auto accessors execute at definition time\n+                auto_accessor.key.visit_with(self);\n+                if let Some(value) = &auto_accessor.value {\n+                    value.visit_with(self);\n+                }\n+            }\n+            ClassMember::AutoAccessor(auto_accessor) => {\n+                // Check decorators - they execute at definition time\n+                for decorator in &auto_accessor.decorators {\n+                    decorator.visit_with(self);\n+                }\n+                // Non-static auto accessors only check the key\n+                auto_accessor.key.visit_with(self);\n+            }\n+            ClassMember::Empty(_) => {\n+                // Empty members are pure\n+            }\n+            ClassMember::TsIndexSignature(_) => {\n+                // TypeScript index signatures are pure\n+            }\n+        }\n+    }\n+\n+    fn visit_decorator(&mut self, _decorator: &Decorator) {\n+        if self.has_side_effects {\n+            return;\n+        }\n+\n+        // Decorators always have side effects because they are function calls\n+        // that execute at class/member definition time, even if they're just\n+        // identifier references (e.g., @decorator is equivalent to calling decorator())\n+        self.mark_side_effect();\n+    }\n+\n+    fn visit_pat(&mut self, pat: &Pat) {\n+        check_side_effects!(self);\n+\n+        match pat {\n+            // Object patterns with default values need checking\n+            Pat::Object(object_pat) => {\n+                for prop in &object_pat.props {\n+                    match prop {\n+                        ObjectPatProp::KeyValue(kv) => {\n+                            // Check the key (for computed properties)\n+                            kv.key.visit_with(self);\n+                            // Recursively check the value pattern\n+                            kv.value.visit_with(self);\n+                        }\n+                        ObjectPatProp::Assign(assign) => {\n+                            // Check the default value if present\n+                            if let Some(value) = &assign.value {\n+                                value.visit_with(self);\n+                            }\n+                        }\n+                        ObjectPatProp::Rest(rest) => {\n+                            // Rest patterns are pure, but check the nested pattern\n+                            rest.arg.visit_with(self);\n+                        }\n+                    }\n+                }\n+            }\n+            // Array patterns with default values need checking\n+            Pat::Array(array_pat) => {\n+                for elem in array_pat.elems.iter().flatten() {\n+                    elem.visit_with(self);\n+                }\n+            }\n+            // Assignment patterns (destructuring with defaults) need checking\n+            Pat::Assign(assign_pat) => {\n+                // Check the default value - this is evaluated if the value is undefined\n+                assign_pat.right.visit_with(self);\n+                // Also check the left side pattern\n+                assign_pat.left.visit_with(self);\n+            }\n+            // Other patterns are pure\n+            _ => {}\n+        }\n+    }\n+}\n+\n+#[cfg(test)]\n+mod tests {\n+    use swc_core::{\n+        common::{FileName, GLOBALS, Mark, SourceMap, comments::SingleThreadedComments, sync::Lrc},\n+        ecma::{\n+            ast::EsVersion,\n+            parser::{EsSyntax, Syntax, parse_file_as_program},\n+            transforms::base::resolver,\n+            visit::VisitMutWith,\n+        },\n+    };\n+\n+    use super::*;\n+\n+    /// Helper function to parse JavaScript code from a string and run the resolver\n+    fn parse_and_check_for_side_effects(code: &str, expected: ModuleSideEffects) {\n+        GLOBALS.set(&Default::default(), || {\n+            let cm = Lrc::new(SourceMap::default());\n+            let fm = cm.new_source_file(Lrc::new(FileName::Anon), code.to_string());\n+\n+            let comments = SingleThreadedComments::default();\n+            let mut errors = vec![];\n+\n+            let mut program = parse_file_as_program(\n+                &fm,\n+                Syntax::Es(EsSyntax {\n+                    jsx: true,\n+                    decorators: true,\n+                    ..Default::default()\n+                }),\n+                EsVersion::latest(),\n+                Some(&comments),\n+                &mut errors,\n+            )\n+            .expect(\"Failed to parse\");\n+\n+            // Run the resolver to mark unresolved identifiers\n+            let unresolved_mark = Mark::new();\n+            let top_level_mark = Mark::new();\n+            program.visit_mut_with(&mut resolver(unresolved_mark, top_level_mark, false));\n+\n+            let actual =\n+                compute_module_evaluation_side_effects(&program, &comments, unresolved_mark);\n+\n+            let msg = match expected {\n+                ModuleSideEffects::ModuleEvaluationIsSideEffectFree => {\n+                    \"Expected code to have no local side effects\"\n+                }\n+                ModuleSideEffects::SideEffectFree => \"Expected code to be side effect free\",\n+                ModuleSideEffects::SideEffectful => \"Expected code to have side effects\",\n+            };\n+            assert_eq!(actual, expected, \"{}:\\n{}\", msg, code);\n+        })\n+    }\n+\n+    /// Generate a test that asserts the given code has the expected side effect status\n+    macro_rules! assert_side_effects {\n+        ($name:ident, $code:expr, $expected:expr) => {\n+            #[test]\n+            fn $name() {\n+                parse_and_check_for_side_effects($code, $expected);\n+            }\n+        };\n+    }\n+\n+    macro_rules! side_effects {\n+        ($name:ident, $code:expr) => {\n+            assert_side_effects!($name, $code, ModuleSideEffects::SideEffectful);\n+        };\n+    }\n+\n+    macro_rules! no_side_effects {\n+        ($name:ident, $code:expr) => {\n+            assert_side_effects!($name, $code, ModuleSideEffects::SideEffectFree);\n+        };\n+    }\n+    macro_rules! module_evaluation_is_side_effect_free {\n+        ($name:ident, $code:expr) => {\n+            assert_side_effects!(\n+                $name,\n+                $code,\n+                ModuleSideEffects::ModuleEvaluationIsSideEffectFree\n+            );\n+        };\n+    }\n+\n+    mod basic_tests {\n+        use super::*;\n+\n+        no_side_effects!(test_empty_program, \"\");\n+\n+        no_side_effects!(test_simple_const_declaration, \"const x = 5;\");\n+\n+        no_side_effects!(test_simple_let_declaration, \"let y = 'string';\");\n+\n+        no_side_effects!(test_array_literal, \"const arr = [1, 2, 3];\");\n+\n+        no_side_effects!(test_object_literal, \"const obj = { a: 1, b: 2 };\");\n+\n+        no_side_effects!(test_function_declaration, \"function foo() { return 1; }\");\n+\n+        no_side_effects!(\n+            test_function_expression,\n+            \"const foo = function() { return 1; };\"\n+        );\n+\n+        no_side_effects!(test_arrow_function, \"const foo = () => 1;\");\n+    }\n+\n+    mod side_effects_tests {\n+        use super::*;\n+\n+        side_effects!(test_console_log, \"console.log('hello');\");\n+\n+        side_effects!(test_function_call, \"foo();\");\n+\n+        side_effects!(test_method_call, \"obj.method();\");\n+\n+        side_effects!(test_assignment, \"x = 5;\");\n+\n+        side_effects!(test_member_assignment, \"obj.prop = 5;\");\n+\n+        side_effects!(test_constructor_call, \"new SideEffect();\");\n+\n+        side_effects!(test_update_expression, \"x++;\");\n+    }\n+\n+    mod pure_expressions_tests {\n+        use super::*;\n+\n+        no_side_effects!(test_binary_expression, \"const x = 1 + 2;\");\n+\n+        no_side_effects!(test_unary_expression, \"const x = -5;\");\n+\n+        no_side_effects!(test_conditional_expression, \"const x = true ? 1 : 2;\");\n+\n+        no_side_effects!(test_template_literal, \"const x = `hello ${world}`;\");\n+\n+        no_side_effects!(test_nested_object, \"const obj = { a: { b: { c: 1 } } };\");\n+\n+        no_side_effects!(test_nested_array, \"const arr = [[1, 2], [3, 4]];\");\n+    }\n+\n+    mod import_export_tests {\n+        use super::*;\n+\n+        module_evaluation_is_side_effect_free!(test_import_statement, \"import x from 'y';\");\n+        module_evaluation_is_side_effect_free!(test_require_statement, \"const x = require('y');\");\n+\n+        no_side_effects!(test_export_statement, \"export default 5;\");\n+\n+        no_side_effects!(test_export_const, \"export const x = 5;\");\n+\n+        side_effects!(\n+            test_export_const_with_side_effect,\n+            \"export const x = foo();\"\n+        );\n+    }\n+\n+    mod mixed_cases_tests {\n+        use super::*;\n+\n+        side_effects!(test_call_in_initializer, \"const x = foo();\");\n+\n+        side_effects!(test_call_in_array, \"const arr = [1, foo(), 3];\");\n+\n+        side_effects!(test_call_in_object, \"const obj = { a: foo() };\");\n+\n+        no_side_effects!(\n+            test_multiple_declarations_pure,\n+            \"const x = 1;\\nconst y = 2;\\nconst z = 3;\"\n+        );\n+\n+        side_effects!(\n+            test_multiple_declarations_with_side_effect,\n+            \"const x = 1;\\nfoo();\\nconst z = 3;\"\n+        );\n+\n+        no_side_effects!(test_class_declaration, \"class Foo {}\");\n+\n+        no_side_effects!(\n+            test_class_with_methods,\n+            \"class Foo { method() { return 1; } }\"\n+        );\n+    }\n+\n+    mod pure_annotations_tests {\n+        use super::*;\n+\n+        no_side_effects!(test_pure_annotation_function_call, \"/*#__PURE__*/ foo();\");\n+\n+        no_side_effects!(test_pure_annotation_with_at, \"/*@__PURE__*/ foo();\");\n+\n+        no_side_effects!(test_pure_annotation_constructor, \"/*#__PURE__*/ new Foo();\");\n+\n+        no_side_effects!(\n+            test_pure_annotation_in_variable,\n+            \"const x = /*#__PURE__*/ foo();\"\n+        );\n+\n+        no_side_effects!(\n+            test_pure_annotation_with_pure_args,\n+            \"/*#__PURE__*/ foo(1, 2, 3);\"\n+        );\n+\n+        // Even with PURE annotation, impure arguments make it impure\n+        side_effects!(\n+            test_pure_annotation_with_impure_args,\n+            \"/*#__PURE__*/ foo(bar());\"\n+        );\n+\n+        // Without annotation, calls are impure\n+        side_effects!(test_without_pure_annotation, \"foo();\");\n+\n+        no_side_effects!(\n+            test_pure_nested_in_object,\n+            \"const obj = { x: /*#__PURE__*/ foo() };\"\n+        );\n+\n+        no_side_effects!(test_pure_in_array, \"const arr = [/*#__PURE__*/ foo()];\");\n+\n+        no_side_effects!(\n+            test_multiple_pure_calls,\n+            \"const x = /*#__PURE__*/ foo();\\nconst y = /*#__PURE__*/ bar();\"\n+        );\n+\n+        side_effects!(\n+            test_mixed_pure_and_impure,\n+            \"const x = /*#__PURE__*/ foo();\\nbar();\\nconst z = /*#__PURE__*/ baz();\"\n+        );\n+    }\n+\n+    mod known_pure_builtins_tests {\n+        use super::*;\n+\n+        no_side_effects!(test_math_abs, \"const x = Math.abs(-5);\");\n+\n+        no_side_effects!(test_math_floor, \"const x = Math.floor(3.14);\");\n+\n+        no_side_effects!(test_math_max, \"const x = Math.max(1, 2, 3);\");\n+\n+        no_side_effects!(test_object_keys, \"const keys = Object.keys(obj);\");\n+\n+        no_side_effects!(test_object_values, \"const values = Object.values(obj);\");\n+\n+        no_side_effects!(test_object_entries, \"const entries = Object.entries(obj);\");\n+\n+        no_side_effects!(test_array_is_array, \"const result = Array.isArray([]);\");\n+\n+        no_side_effects!(\n+            test_string_from_char_code,\n+            \"const char = String.fromCharCode(65);\"\n+        );\n+\n+        no_side_effects!(test_number_is_nan, \"const result = Number.isNaN(x);\");\n+\n+        no_side_effects!(\n+            test_multiple_math_calls,\n+            \"const x = Math.abs(-5);\\nconst y = Math.floor(3.14);\\nconst z = Math.max(x, y);\"\n+        );\n+\n+        // Even pure builtins become impure if arguments are impure\n+        side_effects!(\n+            test_pure_builtin_with_impure_arg,\n+            \"const x = Math.abs(foo());\"\n+        );\n+\n+        no_side_effects!(\n+            test_pure_builtin_in_expression,\n+            \"const x = Math.abs(-5) + Math.floor(3.14);\"\n+        );\n+\n+        side_effects!(\n+            test_mixed_builtin_and_impure,\n+            \"const x = Math.abs(-5);\\nfoo();\\nconst z = Object.keys({});\"\n+        );\n+\n+        // Accessing unknown Math properties is not in our list\n+        side_effects!(test_unknown_math_property, \"const x = Math.random();\");\n+\n+        // Object.assign is NOT pure (it mutates)\n+        side_effects!(test_object_assign, \"Object.assign(target, source);\");\n+\n+        no_side_effects!(test_array_from, \"const arr = Array.from(iterable);\");\n+\n+        no_side_effects!(test_global_is_nan, \"const result = isNaN(value);\");\n+\n+        no_side_effects!(test_global_is_finite, \"const result = isFinite(value);\");\n+\n+        no_side_effects!(test_global_parse_int, \"const num = parseInt('42', 10);\");\n+\n+        no_side_effects!(test_global_parse_float, \"const num = parseFloat('3.14');\");\n+\n+        no_side_effects!(\n+            test_global_decode_uri,\n+            \"const decoded = decodeURI(encoded);\"\n+        );\n+\n+        no_side_effects!(\n+            test_global_decode_uri_component,\n+            \"const decoded = decodeURIComponent(encoded);\"\n+        );\n+\n+        // String() as a function (not constructor) is pure\n+        no_side_effects!(\n+            test_global_string_constructor_as_function,\n+            \"const str = String(123);\"\n+        );\n+\n+        // Number() as a function (not constructor) is pure\n+        no_side_effects!(\n+            test_global_number_constructor_as_function,\n+            \"const num = Number('123');\"\n+        );\n+\n+        // Boolean() as a function (not constructor) is pure\n+        no_side_effects!(\n+            test_global_boolean_constructor_as_function,\n+            \"const bool = Boolean(value);\"\n+        );\n+\n+        // Symbol() as a function is pure\n+        no_side_effects!(\n+            test_global_symbol_constructor_as_function,\n+            \"const sym = Symbol('description');\"\n+        );\n+\n+        // Global pure function with impure argument is impure\n+        side_effects!(\n+            test_global_pure_with_impure_arg,\n+            \"const result = isNaN(foo());\"\n+        );\n+\n+        // isNaN shadowed at top level\n+        side_effects!(\n+            test_shadowed_global_is_nan,\n+            r#\"\n+            const isNaN = () => sideEffect();\n+            const result = isNaN(value);\n+            \"#\n+        );\n+    }\n+\n+    mod edge_cases_tests {\n+        use super::*;\n+\n+        no_side_effects!(test_computed_property, \"const obj = { [key]: value };\");\n+\n+        side_effects!(\n+            test_computed_property_with_call,\n+            \"const obj = { [foo()]: value };\"\n+        );\n+\n+        no_side_effects!(test_spread_in_array, \"const arr = [...other];\");\n+\n+        no_side_effects!(test_spread_in_object, \"const obj = { ...other };\");\n+\n+        no_side_effects!(test_destructuring_assignment, \"const { a, b } = obj;\");\n+\n+        no_side_effects!(test_array_destructuring, \"const [a, b] = arr;\");\n+\n+        no_side_effects!(test_nested_ternary, \"const x = a ? (b ? 1 : 2) : 3;\");\n+\n+        no_side_effects!(test_logical_and, \"const x = a && b;\");\n+\n+        no_side_effects!(test_logical_or, \"const x = a || b;\");\n+\n+        no_side_effects!(test_nullish_coalescing, \"const x = a ?? b;\");\n+\n+        no_side_effects!(test_typeof_operator, \"const x = typeof y;\");\n+\n+        no_side_effects!(test_void_operator, \"const x = void 0;\");\n+\n+        // delete is impure (modifies object)\n+        side_effects!(test_delete_expression, \"delete obj.prop;\");\n+\n+        no_side_effects!(test_sequence_expression_pure, \"const x = (1, 2, 3);\");\n+\n+        side_effects!(test_sequence_expression_impure, \"const x = (foo(), 2, 3);\");\n+\n+        no_side_effects!(test_arrow_with_block, \"const foo = () => { return 1; };\");\n+\n+        no_side_effects!(\n+            test_class_with_constructor,\n+            \"class Foo { constructor() { this.x = 1; } }\"\n+        );\n+\n+        no_side_effects!(test_class_extends, \"class Foo extends Bar {}\");\n+\n+        no_side_effects!(test_async_function, \"async function foo() { return 1; }\");\n+\n+        no_side_effects!(test_generator_function, \"function* foo() { yield 1; }\");\n+\n+        // Tagged templates are function calls, so impure by default\n+        side_effects!(test_tagged_template, \"const x = tag`hello`;\");\n+\n+        // String.raw is known to be pure\n+        no_side_effects!(\n+            test_tagged_template_string_raw,\n+            \"const x = String.raw`hello ${world}`;\"\n+        );\n+\n+        no_side_effects!(test_regex_literal, \"const re = /pattern/g;\");\n+\n+        no_side_effects!(test_bigint_literal, \"const big = 123n;\");\n+\n+        no_side_effects!(test_optional_chaining_pure, \"const x = obj?.prop;\");\n+\n+        // Optional chaining with a call is still a call\n+        side_effects!(test_optional_chaining_call, \"const x = obj?.method();\");\n+\n+        no_side_effects!(\n+            test_multiple_exports_pure,\n+            \"export const a = 1;\\nexport const b = 2;\\nexport const c = 3;\"\n+        );\n+\n+        no_side_effects!(test_export_function, \"export function foo() { return 1; }\");\n+\n+        no_side_effects!(test_export_class, \"export class Foo {}\");\n+\n+        module_evaluation_is_side_effect_free!(test_reexport, \"export { foo } from 'bar';\");\n+\n+        // import() is a function-like expression, we allow it\n+        module_evaluation_is_side_effect_free!(\n+            test_dynamic_import,\n+            \"const mod = import('./module');\"\n+        );\n+\n+        module_evaluation_is_side_effect_free!(\n+            test_dynamic_import_with_await,\n+            \"const mod = await import('./module');\"\n+        );\n+\n+        no_side_effects!(test_export_default_expression, \"export default 1 + 2;\");\n+\n+        side_effects!(\n+            test_export_default_expression_with_side_effect,\n+            \"export default foo();\"\n+        );\n+\n+        no_side_effects!(\n+            test_export_default_function,\n+            \"export default function() { return 1; }\"\n+        );\n+\n+        no_side_effects!(test_export_default_class, \"export default class Foo {}\");\n+\n+        no_side_effects!(\n+            test_export_named_with_pure_builtin,\n+            \"export const result = Math.abs(-5);\"\n+        );\n+\n+        side_effects!(\n+            test_multiple_exports_mixed,\n+            \"export const a = 1;\\nexport const b = foo();\\nexport const c = 3;\"\n+        );\n+    }\n+\n+    mod pure_constructors_tests {\n+        use super::*;\n+\n+        no_side_effects!(test_new_set, \"const s = new Set();\");\n+\n+        no_side_effects!(test_new_map, \"const m = new Map();\");\n+\n+        no_side_effects!(test_new_weakset, \"const ws = new WeakSet();\");\n+\n+        no_side_effects!(test_new_weakmap, \"const wm = new WeakMap();\");\n+\n+        no_side_effects!(test_new_regexp, \"const re = new RegExp('pattern');\");\n+\n+        no_side_effects!(test_new_date, \"const d = new Date();\");\n+\n+        no_side_effects!(test_new_error, \"const e = new Error('message');\");\n+\n+        no_side_effects!(test_new_promise, \"const p = new Promise(() => {});\");\n+        side_effects!(\n+            test_new_promise_effectful,\n+            \"const p = new Promise(() => {console.log('hello')});\"\n+        );\n+\n+        no_side_effects!(test_new_array, \"const arr = new Array(10);\");\n+\n+        no_side_effects!(test_new_object, \"const obj = new Object();\");\n+\n+        no_side_effects!(test_new_typed_array, \"const arr = new Uint8Array(10);\");\n+\n+        no_side_effects!(test_new_url, \"const url = new URL('https://example.com');\");\n+\n+        no_side_effects!(\n+            test_new_url_search_params,\n+            \"const params = new URLSearchParams();\"\n+        );\n+\n+        // Pure constructor with impure arguments is impure\n+        side_effects!(\n+            test_pure_constructor_with_impure_args,\n+            \"const s = new Set([foo()]);\"\n+        );\n+\n+        no_side_effects!(\n+            test_multiple_pure_constructors,\n+            \"const s = new Set();\\nconst m = new Map();\\nconst re = new RegExp('test');\"\n+        );\n+\n+        // Unknown constructors are impure\n+        side_effects!(\n+            test_unknown_constructor,\n+            \"const custom = new CustomClass();\"\n+        );\n+\n+        side_effects!(\n+            test_mixed_constructors,\n+            \"const s = new Set();\\nconst custom = new CustomClass();\\nconst m = new Map();\"\n+        );\n+    }\n+\n+    mod shadowing_detection_tests {\n+        use super::*;\n+\n+        // Math is shadowed by a local variable, so Math.abs is not the built-in\n+        side_effects!(\n+            test_shadowed_math,\n+            r#\"\n+            const Math = { abs: () => console.log('side effect') };\n+            const result = Math.abs(-5);\n+            \"#\n+        );\n+\n+        // Object is shadowed at top level, so Object.keys is not the built-in\n+        side_effects!(\n+            test_shadowed_object,\n+            r#\"\n+            const Object = { keys: () => sideEffect() };\n+            const result = Object.keys({});\n+            \"#\n+        );\n+\n+        // Array is shadowed at top level by a local class\n+        side_effects!(\n+            test_shadowed_array_constructor,\n+            r#\"\n+            const Array = class { constructor() { sideEffect(); } };\n+            const arr = new Array();\n+            \"#\n+        );\n+\n+        // Set is shadowed at top level\n+        side_effects!(\n+            test_shadowed_set_constructor,\n+            r#\"\n+            const Set = class { constructor() { sideEffect(); } };\n+            const s = new Set();\n+            \"#\n+        );\n+\n+        // Map is shadowed in a block scope\n+        side_effects!(\n+            test_shadowed_map_constructor,\n+            r#\"\n+            {\n+                const Map = class { constructor() { sideEffect(); } };\n+                const m = new Map();\n+            }\n+            \"#\n+        );\n+\n+        // Math is NOT shadowed here, so Math.abs is the built-in\n+        no_side_effects!(\n+            test_global_math_not_shadowed,\n+            r#\"\n+            const result = Math.abs(-5);\n+            \"#\n+        );\n+\n+        // Object is NOT shadowed, so Object.keys is the built-in\n+        no_side_effects!(\n+            test_global_object_not_shadowed,\n+            r#\"\n+            const keys = Object.keys({ a: 1, b: 2 });\n+            \"#\n+        );\n+\n+        // Array is NOT shadowed, so new Array() is the built-in\n+        no_side_effects!(\n+            test_global_array_constructor_not_shadowed,\n+            r#\"\n+            const arr = new Array(1, 2, 3);\n+            \"#\n+        );\n+\n+        // If Math is imported (has a non-empty ctxt), it's not the global\n+        side_effects!(\n+            test_shadowed_by_import,\n+            r#\"\n+            import { Math } from './custom-math';\n+            const result = Math.abs(-5);\n+            \"#\n+        );\n+\n+        // Math is shadowed in a block scope at top level\n+        side_effects!(\n+            test_nested_scope_shadowing,\n+            r#\"\n+            {\n+                const Math = { floor: () => sideEffect() };\n+                const result = Math.floor(4.5);\n+            }\n+            \"#\n+        );\n+\n+        // This test shows that function declarations are pure at top level\n+        // even if they have shadowed parameters. The side effect only occurs\n+        // if the function is actually called.\n+        no_side_effects!(\n+            test_parameter_shadowing,\n+            r#\"\n+            function test(RegExp) {\n+                return new RegExp('test');\n+            }\n+            \"#\n+        );\n+\n+        // Number is shadowed by a var declaration\n+        side_effects!(\n+            test_shadowing_with_var,\n+            r#\"\n+            var Number = { isNaN: () => sideEffect() };\n+            const check = Number.isNaN(123);\n+            \"#\n+        );\n+\n+        // RegExp is NOT shadowed, constructor is pure\n+        no_side_effects!(\n+            test_global_regexp_not_shadowed,\n+            r#\"\n+            const re = new RegExp('[a-z]+');\n+            \"#\n+        );\n+    }\n+\n+    mod literal_receiver_methods_tests {\n+        use super::*;\n+\n+        // String literal methods\n+        no_side_effects!(\n+            test_string_literal_to_lower_case,\n+            r#\"const result = \"HELLO\".toLowerCase();\"#\n+        );\n+\n+        no_side_effects!(\n+            test_string_literal_to_upper_case,\n+            r#\"const result = \"hello\".toUpperCase();\"#\n+        );\n+\n+        no_side_effects!(\n+            test_string_literal_slice,\n+            r#\"const result = \"hello world\".slice(0, 5);\"#\n+        );\n+\n+        no_side_effects!(\n+            test_string_literal_split,\n+            r#\"const result = \"a,b,c\".split(',');\"#\n+        );\n+\n+        no_side_effects!(\n+            test_string_literal_trim,\n+            r#\"const result = \"  hello  \".trim();\"#\n+        );\n+\n+        no_side_effects!(\n+            test_string_literal_replace,\n+            r#\"const result = \"hello\".replace('h', 'H');\"#\n+        );\n+\n+        no_side_effects!(\n+            test_string_literal_includes,\n+            r#\"const result = \"hello world\".includes('world');\"#\n+        );\n+\n+        // Array literal methods\n+        no_side_effects!(\n+            test_array_literal_map,\n+            r#\"const result = [1, 2, 3].map(x => x * 2);\"#\n+        );\n+        side_effects!(\n+            test_array_literal_map_with_effectful_callback,\n+            r#\"const result = [1, 2, 3].map(x => {globalThis.something.push(x)});\"#\n+        );\n+\n+        // Number literal methods - need parentheses for number literals\n+        no_side_effects!(\n+            test_number_literal_to_fixed,\n+            r#\"const result = (3.14159).toFixed(2);\"#\n+        );\n+\n+        no_side_effects!(\n+            test_number_literal_to_string,\n+            r#\"const result = (42).toString();\"#\n+        );\n+\n+        no_side_effects!(\n+            test_number_literal_to_exponential,\n+            r#\"const result = (123.456).toExponential(2);\"#\n+        );\n+\n+        // Boolean literal methods\n+        no_side_effects!(\n+            test_boolean_literal_to_string,\n+            r#\"const result = true.toString();\"#\n+        );\n+\n+        no_side_effects!(\n+            test_boolean_literal_value_of,\n+            r#\"const result = false.valueOf();\"#\n+        );\n+\n+        // RegExp literal methods\n+        no_side_effects!(\n+            test_regexp_literal_to_string,\n+            r#\"const result = /[a-z]+/.toString();\"#\n+        );\n+\n+        // Note: test() and exec() technically modify flags on the regex, but that is fine when\n+        // called on a literal.\n+        no_side_effects!(\n+            test_regexp_literal_test,\n+            r#\"const result = /[a-z]+/g.test(\"hello\");\"#\n+        );\n+\n+        no_side_effects!(\n+            test_regexp_literal_exec,\n+            r#\"const result = /(\\d+)/g.exec(\"test123\");\"#\n+        );\n+\n+        // Array literal with impure elements - the array construction itself has side effects\n+        // because foo() is called when creating the array\n+        side_effects!(\n+            test_array_literal_with_impure_elements,\n+            r#\"const result = [foo(), 2, 3].map(x => x * 2);\"#\n+        );\n+\n+        // Array literal with callback that would have side effects when called\n+        // However, callbacks are just function definitions at module load time\n+        // They don't execute until runtime, so this is side-effect free at load time\n+        no_side_effects!(\n+            test_array_literal_map_with_callback,\n+            r#\"const result = [1, 2, 3].map(x => x * 2);\"#\n+        );\n+    }\n+\n+    mod class_expression_side_effects_tests {\n+        use super::*;\n+\n+        // Class with no extends and no static members is pure\n+        no_side_effects!(test_class_no_extends_no_static, \"class Foo {}\");\n+\n+        // Class with pure extends is pure\n+        no_side_effects!(test_class_pure_extends, \"class Foo extends Bar {}\");\n+\n+        // Class with function call in extends clause has side effects\n+        side_effects!(\n+            test_class_extends_with_call,\n+            \"class Foo extends someMixinFunction() {}\"\n+        );\n+\n+        // Class with complex expression in extends clause has side effects\n+        side_effects!(\n+            test_class_extends_with_complex_expr,\n+            \"class Foo extends (Bar || Baz()) {}\"\n+        );\n+\n+        // Class with static property initializer that calls function has side effects\n+        side_effects!(\n+            test_class_static_property_with_call,\n+            r#\"\n+        class Foo {\n+            static foo = someFunction();\n+        }\n+        \"#\n+        );\n+\n+        // Class with static property with pure initializer is pure\n+        no_side_effects!(\n+            test_class_static_property_pure,\n+            r#\"\n+        class Foo {\n+            static foo = 42;\n+        }\n+        \"#\n+        );\n+\n+        // Class with static property with array literal is pure\n+        no_side_effects!(\n+            test_class_static_property_array_literal,\n+            r#\"\n+        class Foo {\n+            static foo = [1, 2, 3];\n+        }\n+        \"#\n+        );\n+\n+        // Class with static block has side effects\n+        side_effects!(\n+            test_class_static_block,\n+            r#\"\n+        class Foo {\n+            static {\n+                console.log(\"hello\");\n+            }\n+        }\n+        \"#\n+        );\n+\n+        no_side_effects!(\n+            test_class_static_block_empty,\n+            r#\"\n+        class Foo {\n+            static {}\n+        }\n+        \"#\n+        );\n+\n+        // Class with instance property is pure (doesn't execute at definition time)\n+        no_side_effects!(\n+            test_class_instance_property_with_call,\n+            r#\"\n+        class Foo {\n+            foo = someFunction();\n+        }\n+        \"#\n+        );\n+\n+        // Class with constructor is pure (doesn't execute at definition time)\n+        no_side_effects!(\n+            test_class_constructor_with_side_effects,\n+            r#\"\n+        class Foo {\n+            constructor() {\n+                console.log(\"constructor\");\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Class with method is pure (doesn't execute at definition time)\n+        no_side_effects!(\n+            test_class_method,\n+            r#\"\n+        class Foo {\n+            method() {\n+                console.log(\"method\");\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Class expression with side effects in extends\n+        side_effects!(\n+            test_class_expr_extends_with_call,\n+            \"const Foo = class extends getMixin() {};\"\n+        );\n+\n+        // Class expression with static property calling function\n+        side_effects!(\n+            test_class_expr_static_with_call,\n+            r#\"\n+        const Foo = class {\n+            static prop = initValue();\n+        };\n+        \"#\n+        );\n+\n+        // Class expression with pure static property\n+        no_side_effects!(\n+            test_class_expr_static_pure,\n+            r#\"\n+        const Foo = class {\n+            static prop = \"hello\";\n+        };\n+        \"#\n+        );\n+\n+        // Export class with side effects\n+        side_effects!(\n+            test_export_class_with_side_effects,\n+            r#\"\n+        export class Foo extends getMixin() {\n+            static prop = init();\n+        }\n+        \"#\n+        );\n+\n+        // Export default class with side effects\n+        side_effects!(\n+            test_export_default_class_with_side_effects,\n+            r#\"\n+        export default class Foo {\n+            static { console.log(\"init\"); }\n+        }\n+        \"#\n+        );\n+\n+        // Export class without side effects\n+        no_side_effects!(\n+            test_export_class_no_side_effects,\n+            r#\"\n+        export class Foo {\n+            method() {\n+                console.log(\"method\");\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Multiple static properties, some pure, some not\n+        side_effects!(\n+            test_class_mixed_static_properties,\n+            r#\"\n+        class Foo {\n+            static a = 1;\n+            static b = impureCall();\n+            static c = 3;\n+        }\n+        \"#\n+        );\n+\n+        // Class with pure static property using known pure built-in\n+        no_side_effects!(\n+            test_class_static_property_pure_builtin,\n+            r#\"\n+        class Foo {\n+            static value = Math.abs(-5);\n+        }\n+        \"#\n+        );\n+\n+        // Class with computed property name that has side effects\n+        side_effects!(\n+            test_class_computed_property_with_call,\n+            r#\"\n+        class Foo {\n+            [computeName()]() {\n+                return 42;\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Class with pure computed property name\n+        no_side_effects!(\n+            test_class_computed_property_pure,\n+            r#\"\n+        class Foo {\n+            ['method']() {\n+                return 42;\n+            }\n+        }\n+        \"#\n+        );\n+    }\n+\n+    mod complex_variable_declarations_tests {\n+        use super::*;\n+\n+        // Simple destructuring without defaults is pure\n+        no_side_effects!(test_destructure_simple, \"const { foo } = obj;\");\n+\n+        // Destructuring with function call in default value has side effects\n+        side_effects!(\n+            test_destructure_default_with_call,\n+            \"const { foo = someFunction() } = obj;\"\n+        );\n+\n+        // Destructuring with pure default value is pure\n+        no_side_effects!(test_destructure_default_pure, \"const { foo = 42 } = obj;\");\n+\n+        // Destructuring with array literal default is pure\n+        no_side_effects!(\n+            test_destructure_default_array_literal,\n+            \"const { foo = ['hello'] } = obj;\"\n+        );\n+\n+        // Destructuring with object literal default is pure\n+        no_side_effects!(\n+            test_destructure_default_object_literal,\n+            \"const { foo = { bar: 'baz' } } = obj;\"\n+        );\n+\n+        // Nested destructuring with default that has side effect\n+        side_effects!(\n+            test_destructure_nested_with_call,\n+            \"const { a: { b = sideEffect() } } = obj;\"\n+        );\n+\n+        // Array destructuring with default that has side effect\n+        side_effects!(\n+            test_array_destructure_default_with_call,\n+            \"const [a, b = getDefault()] = arr;\"\n+        );\n+\n+        // Array destructuring with pure default\n+        no_side_effects!(\n+            test_array_destructure_default_pure,\n+            \"const [a, b = 10] = arr;\"\n+        );\n+\n+        // Multiple variables, one with side effect in default\n+        side_effects!(\n+            test_multiple_destructure_mixed,\n+            \"const { foo = 1, bar = compute() } = obj;\"\n+        );\n+\n+        // Rest pattern is pure\n+        no_side_effects!(test_destructure_rest_pure, \"const { foo, ...rest } = obj;\");\n+\n+        // Complex destructuring with multiple levels\n+        side_effects!(\n+            test_destructure_complex_with_side_effect,\n+            r#\"\n+        const {\n+            a,\n+            b: { c = sideEffect() },\n+            d = [1, 2, 3]\n+        } = obj;\n+        \"#\n+        );\n+\n+        // Complex destructuring all pure\n+        no_side_effects!(\n+            test_destructure_complex_pure,\n+            r#\"\n+        const {\n+            a,\n+            b: { c = 5 },\n+            d = [1, 2, 3]\n+        } = obj;\n+        \"#\n+        );\n+\n+        // Destructuring in export with side effect\n+        side_effects!(\n+            test_export_destructure_with_side_effect,\n+            \"export const { foo = init() } = obj;\"\n+        );\n+\n+        // Destructuring in export without side effect\n+        no_side_effects!(\n+            test_export_destructure_pure,\n+            \"export const { foo = 42 } = obj;\"\n+        );\n+\n+        // Default value with known pure built-in\n+        no_side_effects!(\n+            test_destructure_default_pure_builtin,\n+            \"const { foo = Math.abs(-5) } = obj;\"\n+        );\n+\n+        // Default value with pure annotation\n+        no_side_effects!(\n+            test_destructure_default_pure_annotation,\n+            \"const { foo = /*#__PURE__*/ compute() } = obj;\"\n+        );\n+    }\n+\n+    mod decorator_side_effects_tests {\n+        use super::*;\n+\n+        // Class decorator has side effects (executes at definition time)\n+        side_effects!(\n+            test_class_decorator,\n+            r#\"\n+        @decorator\n+        class Foo {}\n+        \"#\n+        );\n+\n+        // Method decorator has side effects\n+        side_effects!(\n+            test_method_decorator,\n+            r#\"\n+        class Foo {\n+            @decorator\n+            method() {}\n+        }\n+        \"#\n+        );\n+\n+        // Property decorator has side effects\n+        side_effects!(\n+            test_property_decorator,\n+            r#\"\n+        class Foo {\n+            @decorator\n+            prop = 1;\n+        }\n+        \"#\n+        );\n+\n+        // Multiple decorators\n+        side_effects!(\n+            test_multiple_decorators,\n+            r#\"\n+        @decorator1\n+        @decorator2\n+        class Foo {\n+            @propDecorator\n+            prop = 1;\n+\n+            @methodDecorator\n+            method() {}\n+        }\n+        \"#\n+        );\n+\n+        // Decorator with arguments\n+        side_effects!(\n+            test_decorator_with_args,\n+            r#\"\n+        @decorator(config())\n+        class Foo {}\n+        \"#\n+        );\n+    }\n+\n+    mod additional_edge_cases_tests {\n+        use super::*;\n+\n+        // Super property access is pure\n+        no_side_effects!(\n+            test_super_property_pure,\n+            r#\"\n+        class Foo extends Bar {\n+            method() {\n+                return super.parentMethod;\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Super method call has side effects (but only when invoked, not at definition)\n+        no_side_effects!(\n+            test_super_call_in_method,\n+            r#\"\n+        class Foo extends Bar {\n+            method() {\n+                return super.parentMethod();\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // import.meta is pure\n+        no_side_effects!(test_import_meta, \"const url = import.meta.url;\");\n+\n+        // new.target is pure (only valid inside functions/constructors)\n+        no_side_effects!(\n+            test_new_target,\n+            r#\"\n+        function Foo() {\n+            console.log(new.target);\n+        }\n+        \"#\n+        );\n+\n+        // JSX element has side effects (compiles to function calls)\n+        side_effects!(test_jsx_element, \"const el = <div>Hello</div>;\");\n+\n+        // JSX fragment has side effects\n+        side_effects!(test_jsx_fragment, \"const el = <>Hello</>;\");\n+\n+        // Private field access is pure\n+        no_side_effects!(\n+            test_private_field_access,\n+            r#\"\n+        class Foo {\n+            #privateField = 42;\n+            method() {\n+                return this.#privateField;\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Computed super property with side effect\n+        no_side_effects!(\n+            test_super_computed_property_pure,\n+            r#\"\n+        class Foo extends Bar {\n+            method() {\n+                return super['prop'];\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Static block with only pure statements is pure\n+        no_side_effects!(\n+            test_static_block_pure_content,\n+            r#\"\n+        class Foo {\n+            static {\n+                const x = 1;\n+                const y = 2;\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Static block with side effect\n+        side_effects!(\n+            test_static_block_with_side_effect_inside,\n+            r#\"\n+        class Foo {\n+            static {\n+                sideEffect();\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // This binding is pure\n+        no_side_effects!(\n+            test_this_expression,\n+            r#\"\n+        class Foo {\n+            method() {\n+                return this;\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Spread in call arguments (with pure expression)\n+        no_side_effects!(\n+            test_spread_pure_in_call,\n+            \"const result = Math.max(...[1, 2, 3]);\"\n+        );\n+\n+        // Spread in call arguments (with side effect)\n+        side_effects!(\n+            test_spread_with_side_effect,\n+            \"const result = Math.max(...getArray());\"\n+        );\n+\n+        // Complex super expression\n+        no_side_effects!(\n+            test_super_complex_access,\n+            r#\"\n+        class Foo extends Bar {\n+            static method() {\n+                return super.parentMethod;\n+            }\n+        }\n+        \"#\n+        );\n+\n+        // Getter/setter definitions are pure\n+        no_side_effects!(\n+            test_getter_definition,\n+            r#\"\n+        const obj = {\n+            get foo() {\n+                return this._foo;\n+            }\n+        };\n+        \"#\n+        );\n+\n+        // Async function declaration is pure\n+        no_side_effects!(\n+            test_async_function_declaration,\n+            r#\"\n+        async function foo() {\n+            return await something;\n+        }\n+        \"#\n+        );\n+\n+        // Generator function declaration is pure\n+        no_side_effects!(\n+            test_generator_declaration,\n+            r#\"\n+        function* foo() {\n+            yield 1;\n+            yield 2;\n+        }\n+        \"#\n+        );\n+\n+        // Async generator is pure\n+        no_side_effects!(\n+            test_async_generator,\n+            r#\"\n+        async function* foo() {\n+            yield await something;\n+        }\n+        \"#\n+        );\n+\n+        // Using declaration (TC39 proposal) - if supported\n+        // This would need to be handled if the parser supports it\n+\n+        // Nullish coalescing with side effects in right operand\n+        side_effects!(\n+            test_nullish_coalescing_with_side_effect,\n+            \"const x = a ?? sideEffect();\"\n+        );\n+\n+        // Logical OR with side effects\n+        side_effects!(\n+            test_logical_or_with_side_effect,\n+            \"const x = a || sideEffect();\"\n+        );\n+\n+        // Logical AND with side effects\n+        side_effects!(\n+            test_logical_and_with_side_effect,\n+            \"const x = a && sideEffect();\"\n+        );\n+    }\n+\n+    mod common_js_modules_tests {\n+        use super::*;\n+\n+        side_effects!(test_common_js_exports, \"exports.foo = 'a'\");\n+        side_effects!(test_common_js_exports_module, \"module.exports.foo = 'a'\");\n+        side_effects!(test_common_js_exports_assignment, \"module.exports = {}\");\n+    }\n+}"
        },
        {
            "sha": "72562f41e6a9e2f55670962fcbe2fdd97beb234a",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -100,7 +100,7 @@ use turbopack_core::{\n     compile_time_info::CompileTimeInfo,\n     context::AssetContext,\n     ident::AssetIdent,\n-    module::{Module, OptionModule},\n+    module::{Module, ModuleSideEffects, OptionModule},\n     module_graph::ModuleGraph,\n     output::OutputAssetsReference,\n     reference::ModuleReferences,\n@@ -285,6 +285,8 @@ pub struct EcmascriptOptions {\n     pub enable_exports_info_inlining: bool,\n \n     pub inline_helpers: bool,\n+    /// Whether to infer side effect free modules via local analysis. Defaults to true.\n+    pub infer_module_side_effects: bool,\n }\n \n #[turbo_tasks::value]\n@@ -778,7 +780,7 @@ impl Module for EcmascriptModuleAsset {\n         Ok(if *pkg_side_effect_free.await? {\n             pkg_side_effect_free\n         } else {\n-            Vc::cell(self.analyze().await?.has_side_effect_free_directive)\n+            Vc::cell(self.analyze().await?.side_effects == ModuleSideEffects::SideEffectFree)\n         })\n     }\n }"
        },
        {
            "sha": "b4259c3498128fcd8c771c3faa2b6c8a646dd9d7",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/mod.rs",
            "status": "modified",
            "additions": 23,
            "deletions": 9,
            "changes": 32,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -77,7 +77,7 @@ use turbopack_core::{\n     environment::Rendering,\n     error::PrettyPrintError,\n     issue::{IssueExt, IssueSeverity, IssueSource, StyledString, analyze::AnalyzeIssue},\n-    module::Module,\n+    module::{Module, ModuleSideEffects},\n     reference::{ModuleReference, ModuleReferences},\n     reference_type::{CommonJsReferenceSubType, ReferenceType},\n     resolve::{\n@@ -111,7 +111,7 @@ use crate::{\n         },\n         imports::{ImportAnnotations, ImportAttributes, ImportedSymbol, Reexport},\n         linker::link,\n-        parse_require_context,\n+        parse_require_context, side_effects,\n         top_level_await::has_top_level_await,\n         well_known::replace_well_known,\n     },\n@@ -172,7 +172,7 @@ pub struct AnalyzeEcmascriptModuleResult {\n     pub code_generation: ResolvedVc<CodeGens>,\n     pub exports: ResolvedVc<EcmascriptExports>,\n     pub async_module: ResolvedVc<OptionAsyncModule>,\n-    pub has_side_effect_free_directive: bool,\n+    pub side_effects: ModuleSideEffects,\n     /// `true` when the analysis was successful.\n     pub successful: bool,\n     pub source_map: Option<ResolvedVc<Box<dyn GenerateSourceMap>>>,\n@@ -233,7 +233,7 @@ struct AnalyzeEcmascriptModuleResultBuilder {\n     async_module: ResolvedVc<OptionAsyncModule>,\n     successful: bool,\n     source_map: Option<ResolvedVc<Box<dyn GenerateSourceMap>>>,\n-    has_side_effect_free_directive: bool,\n+    side_effects: ModuleSideEffects,\n     #[cfg(debug_assertions)]\n     ident: RcStr,\n }\n@@ -253,7 +253,7 @@ impl AnalyzeEcmascriptModuleResultBuilder {\n             async_module: ResolvedVc::cell(None),\n             successful: false,\n             source_map: None,\n-            has_side_effect_free_directive: false,\n+            side_effects: ModuleSideEffects::SideEffectful,\n             #[cfg(debug_assertions)]\n             ident: Default::default(),\n         }\n@@ -331,8 +331,8 @@ impl AnalyzeEcmascriptModuleResultBuilder {\n     }\n \n     /// Set whether this module is side-effect free according to a user-provided directive.\n-    pub fn set_has_side_effect_free_directive(&mut self, value: bool) {\n-        self.has_side_effect_free_directive = value;\n+    pub fn set_side_effects_mode(&mut self, value: ModuleSideEffects) {\n+        self.side_effects = value;\n     }\n \n     /// Sets whether the analysis was successful.\n@@ -443,7 +443,7 @@ impl AnalyzeEcmascriptModuleResultBuilder {\n                 code_generation: ResolvedVc::cell(code_generation),\n                 exports: self.exports.resolved_cell(),\n                 async_module: self.async_module,\n-                has_side_effect_free_directive: self.has_side_effect_free_directive,\n+                side_effects: self.side_effects,\n                 successful: self.successful,\n                 source_map: self.source_map,\n             },\n@@ -658,7 +658,21 @@ async fn analyze_ecmascript_module_internal(\n         },\n         _ => false,\n     });\n-    analysis.set_has_side_effect_free_directive(has_side_effect_free_directive);\n+    analysis.set_side_effects_mode(if has_side_effect_free_directive {\n+        ModuleSideEffects::SideEffectFree\n+    } else if options.infer_module_side_effects {\n+        // Analyze the AST to infer side effects\n+        GLOBALS.set(globals, || {\n+            side_effects::compute_module_evaluation_side_effects(\n+                program,\n+                comments,\n+                eval_context.unresolved_mark,\n+            )\n+        })\n+    } else {\n+        // If inference is disabled, assume side effects\n+        ModuleSideEffects::SideEffectful\n+    });\n \n     let is_esm = eval_context.is_esm(specified_type);\n     let compile_time_info = compile_time_info_for_module_options("
        },
        {
            "sha": "8f586c46604100dda8da88a4437ad0db5349a5ad",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/graph.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fgraph.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fgraph.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fgraph.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -1699,7 +1699,7 @@ pub(crate) fn find_turbopack_part_id_in_asserts(asserts: &ObjectLit) -> Option<P\n         _ => None,\n     })\n }\n-/// givin a number, return a base54 encoded string\n+/// given a number, return a base54 encoded string\n /// `usize -> [a-zA-Z$_][a-zA-Z$_0-9]*`\n pub(crate) fn encode_base54(init: &mut usize, skip_reserved: bool) -> Atom {\n     static BASE54_CHARS: &[u8; 64] ="
        },
        {
            "sha": "318a6d2037ad8849accb7bcc2f5745beddec2295",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/resolving/no-same-key-alternatives/input/dir/node_modules/the-package/index.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fno-same-key-alternatives%2Finput%2Fdir%2Fnode_modules%2Fthe-package%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fno-same-key-alternatives%2Finput%2Fdir%2Fnode_modules%2Fthe-package%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fno-same-key-alternatives%2Finput%2Fdir%2Fnode_modules%2Fthe-package%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1 @@\n+console.log('some side effect to ensure this is preserved')"
        },
        {
            "sha": "318a6d2037ad8849accb7bcc2f5745beddec2295",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/turbopack/resolving/no-same-key-alternatives/input/node_modules/the-package/index.js",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fno-same-key-alternatives%2Finput%2Fnode_modules%2Fthe-package%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fno-same-key-alternatives%2Finput%2Fnode_modules%2Fthe-package%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fturbopack%2Fresolving%2Fno-same-key-alternatives%2Finput%2Fnode_modules%2Fthe-package%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1 @@\n+console.log('some side effect to ensure this is preserved')"
        },
        {
            "sha": "dc07c80d4ae45012658161044286f2ce25922e88",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/another.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fanother.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fanother.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fanother.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1 @@\n+require('./vendors').UiSelectButton2()"
        },
        {
            "sha": "84ae981479236df637578154aeeed3ecbea4b7ed",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/index.js",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,15 @@\n+// Combined test for issue-13063\n+// Tests that side effects optimization doesn't crash with specific vendor patterns\n+\n+// Test 1: UiSelectButton (from tst_examples_uiform.js)\n+it('should not crash with UiSelectButton', () => {\n+  require('./vendors').UiSelectButton()\n+  require('./vendors').UiSelectButton2()\n+})\n+\n+// Test 2: UiButton (from tst_examples_uitable.js)\n+import { UiButton } from './vendors'\n+\n+it('should not crash with UiButton', () => {\n+  UiButton()\n+})"
        },
        {
            "sha": "ee84dfb6e1abf20cd3f138f13e5e126050385877",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/test.config.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Ftest.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Ftest.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Ftest.config.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,7 @@\n+'use strict'\n+\n+module.exports = {\n+  findBundle() {\n+    return ['./vendors.js', './tst_examples_uiform.js']\n+  },\n+}"
        },
        {
            "sha": "f1bea3f372b97227dd9f5352694fe6a00929c90f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/tst_examples_uiform.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Ftst_examples_uiform.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Ftst_examples_uiform.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Ftst_examples_uiform.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,4 @@\n+it('should not crash', () => {\n+  require('./vendors').UiSelectButton()\n+  require('./vendors').UiSelectButton2()\n+})"
        },
        {
            "sha": "8259b9ce8641114ca25495cb2e9c74db2a70eee9",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/tst_examples_uitable.js",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Ftst_examples_uitable.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Ftst_examples_uitable.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Ftst_examples_uitable.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,5 @@\n+import { UiButton } from './vendors'\n+\n+it('should not crash', () => {\n+  UiButton()\n+})"
        },
        {
            "sha": "245b139419e359bf05c571274253306d76f7c03a",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/vendors/index.js",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,9 @@\n+import uuid from './uuid'\n+import { checkIsNonemptyString } from './types'\n+export { UiSelectButton } from './select'\n+export { UiSelectButton2 } from './select2'\n+\n+export function UiButton() {\n+  checkIsNonemptyString()\n+  uuid()\n+}"
        },
        {
            "sha": "33750df7b3bfb181eebe3fd33c048e2b84468b38",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/vendors/select.js",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Fselect.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Fselect.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Fselect.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,9 @@\n+import uuid from './uuid'\n+import { checkIsNonemptyString } from './types'\n+\n+export function UiSelectButton() {\n+  checkIsNonemptyString()\n+  uuid()\n+}\n+\n+console.log.bind(console)"
        },
        {
            "sha": "dc99086656cb68e7e3e44dd05bcd9916ef8db30b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/vendors/select2.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Fselect2.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Fselect2.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Fselect2.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,7 @@\n+import uuid from './uuid'\n+\n+export function UiSelectButton2() {\n+  uuid()\n+}\n+\n+console.log.bind(console)"
        },
        {
            "sha": "02a236bbb43dee637ed96bcaa4826129f5313bd9",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/vendors/types.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Ftypes.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Ftypes.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Ftypes.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1 @@\n+export function checkIsNonemptyString() {}"
        },
        {
            "sha": "394593f1e0f899e48386ce6e72b007c9ace5b80b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/issue-13063/input/vendors/uuid.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Fuuid.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Fuuid.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fissue-13063%2Finput%2Fvendors%2Fuuid.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1 @@\n+export default function uuid() {}"
        },
        {
            "sha": "140eb58046fe7c6ab5f47e320ae6ddabd59acf46",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-unsorted-modules/input/index.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,11 @@\n+import { b } from 'dep'\n+\n+b.c()\n+\n+import { modules } from 'dep/trackModules.js'\n+\n+it('should not contain side-effect-free modules', () => {\n+  // TODO: webpack can trim 'b'. The issue is that turbopack cannot follow namespace re-exports\n+  // when it is tree shaking exports.\n+  expect(modules).toEqual(['b', 'c'])\n+})"
        },
        {
            "sha": "d1d57639f64ce61d38e96939353ce01557834a72",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-unsorted-modules/input/node_modules/dep/a.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fa.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,3 @@\n+import { track } from './trackModules.js'\n+track('a')\n+export * as b from './b.js'"
        },
        {
            "sha": "dcf40e680c391419e5b9db990122aa229e629243",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-unsorted-modules/input/node_modules/dep/b.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fb.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fb.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fb.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,3 @@\n+import { track } from './trackModules.js'\n+track('b')\n+export * from './c.js'"
        },
        {
            "sha": "101364ffe14bdcea7a9cf2ddd152152f7f102a2a",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-unsorted-modules/input/node_modules/dep/c.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fc.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fc.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fc.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,3 @@\n+import { track } from './trackModules.js'\n+track('c')\n+export function c() {}"
        },
        {
            "sha": "db3b7a125e391d96d406a29ddb93802ee8decd2b",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-unsorted-modules/input/node_modules/dep/index.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,3 @@\n+import { track } from './trackModules.js'\n+track('index')\n+export * from './a.js'"
        },
        {
            "sha": "644d902d8e04414fe34e2934a0761ba5811ce980",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-unsorted-modules/input/node_modules/dep/package.json",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2Fpackage.json?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,6 @@\n+{\n+  \"name\": \"dep\",\n+  \"version\": \"1.0.0\",\n+  \"type\": \"module\",\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "82013d708af9b662667ce9a86db91dab79500308",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-unsorted-modules/input/node_modules/dep/trackModules.js",
            "status": "added",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2FtrackModules.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2FtrackModules.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fnode_modules%2Fdep%2FtrackModules.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,4 @@\n+export const modules = []\n+export function track(name) {\n+  modules.push(name)\n+}"
        },
        {
            "sha": "81f42c81f0c9b7d81d50a809af22932806163710",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-unsorted-modules/input/webpack.config.js",
            "status": "added",
            "additions": 28,
            "deletions": 0,
            "changes": 28,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fwebpack.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fwebpack.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-unsorted-modules%2Finput%2Fwebpack.config.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,28 @@\n+'use strict'\n+\n+/** @typedef {import(\"../../../../\").Compiler} Compiler */\n+/** @typedef {import(\"../../../../\").NormalModule} NormalModule */\n+\n+class ReorderModulesPlugin {\n+  /**\n+   * @param {Compiler} compiler compiler\n+   */\n+  apply(compiler) {\n+    compiler.hooks.compilation.tap('ReorderModulesPlugin', (compilation) => {\n+      compilation.hooks.seal.tap('ReorderModulesPlugin', () => {\n+        const sortedModules = [...compilation.modules].sort((a, _b) =>\n+          /** @type {NormalModule} */\n+          (a).request.includes('b.js') ? -1 : 1\n+        )\n+        compilation.modules = new Set(sortedModules)\n+      })\n+    })\n+  }\n+}\n+\n+module.exports = {\n+  plugins: [new ReorderModulesPlugin()],\n+  optimization: {\n+    sideEffects: true,\n+  },\n+}"
        },
        {
            "sha": "33e13321562c797f2781a75b49733fb4b2ca2aa8",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/index.js",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,14 @@\n+import { log as booleanValueModuleLog } from 'boolean-value-module/tracker'\n+import booleanValueModule from 'boolean-value-module'\n+import { log as globValueModuleLog } from 'glob-value-module/tracker'\n+import globValueModule from 'glob-value-module'\n+\n+it('should handle a boolean', function () {\n+  expect(booleanValueModule).toBe('def')\n+  expect(booleanValueModuleLog).toEqual(['index.js'])\n+})\n+\n+it('should handle globs', function () {\n+  expect(globValueModule).toBe('def')\n+  expect(globValueModuleLog).toEqual(['./src/a.js', 'a.js', 'index.js'])\n+})"
        },
        {
            "sha": "fadd35c13ee8ddd2c8446d261a25ddd86fa4ea4f",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/boolean-value-module/a.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fa.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,8 @@\n+var a = 'a'\n+var b = 'b'\n+var c = 'c'\n+\n+export { a, b, c }\n+\n+import { track } from './tracker'\n+track('a.js')"
        },
        {
            "sha": "8ede6e33b26ec5eca200b530bea8c601e750343c",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/boolean-value-module/b.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fb.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fb.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fb.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,8 @@\n+var x = 'x'\n+var y = 'y'\n+\n+export { x, y }\n+export { z } from './c'\n+\n+import { track } from './tracker'\n+track('b.js')"
        },
        {
            "sha": "db094906539fedd732dd305e865ab4e44e250c51",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/boolean-value-module/c.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fc.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fc.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fc.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,6 @@\n+var z = 'z'\n+\n+export { z }\n+\n+import { track } from './tracker'\n+track('c.js')"
        },
        {
            "sha": "aeab03272075b3faa0fa93dc0e20d3a98e9c56fc",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/boolean-value-module/index.js",
            "status": "added",
            "additions": 7,
            "deletions": 0,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,7 @@\n+export * from './a'\n+export { x, y, z } from './b'\n+\n+import { track } from './tracker'\n+track('index.js')\n+\n+export default 'def'"
        },
        {
            "sha": "a43829151e1423f0641beb1f114773f1c67fda72",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/boolean-value-module/package.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Fpackage.json?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"sideEffects\": false\n+}"
        },
        {
            "sha": "bee17d4179580815f48a08bf2214f7ce441fb870",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/boolean-value-module/tracker.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Ftracker.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Ftracker.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fboolean-value-module%2Ftracker.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,10 @@\n+export function track(file) {\n+  log.push(file)\n+  log.sort()\n+}\n+\n+export var log = []\n+\n+export function reset() {\n+  log.length = 0\n+}"
        },
        {
            "sha": "6541bb4cf2861a5956dbeabf8e4e6c80dd6564f3",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/glob-value-module/a.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fa.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,6 @@\n+var z = 'z'\n+\n+export { z }\n+\n+import { track } from './tracker'\n+track('a.js')"
        },
        {
            "sha": "02b8ac825489c2554b209c67b43ec7d3f0c1e36c",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/glob-value-module/b.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fb.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fb.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fb.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,8 @@\n+var x = 'x'\n+var y = 'y'\n+\n+export { x, y }\n+export { z } from './a'\n+\n+import { track } from './tracker'\n+track('b.js')"
        },
        {
            "sha": "fcd0dca8a461cc7e253b0eea1bc74cb5486757b7",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/glob-value-module/index.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,8 @@\n+import * as a from './a'\n+import * as a2 from './src/a'\n+import * as b from './b'\n+\n+import { track } from './tracker'\n+track('index.js')\n+\n+export default 'def'"
        },
        {
            "sha": "8dba5df5d32578c31ab15af88bcbb9e2e7b54adf",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/glob-value-module/package.json",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fpackage.json?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,5 @@\n+{\n+  \"sideEffects\": [\n+    \"./**/a.js\"\n+  ]\n+}"
        },
        {
            "sha": "6ed91d33b37bfd50ba54e49f51db4d64b8c71b27",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/glob-value-module/src/a.js",
            "status": "added",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fsrc%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fsrc%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Fsrc%2Fa.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,6 @@\n+var a = 'a'\n+\n+export { a }\n+\n+import { track } from '../tracker'\n+track('./src/a.js')"
        },
        {
            "sha": "bee17d4179580815f48a08bf2214f7ce441fb870",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/input/node_modules/glob-value-module/tracker.js",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Ftracker.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Ftracker.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Finput%2Fnode_modules%2Fglob-value-module%2Ftracker.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,10 @@\n+export function track(file) {\n+  log.push(file)\n+  log.sort()\n+}\n+\n+export var log = []\n+\n+export function reset() {\n+  log.length = 0\n+}"
        },
        {
            "sha": "9437f5a817160555acfa2e28572d12038ba4c143",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/side-effects-values/options.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Foptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Foptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Fside-effects-values%2Foptions.json?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"scopeHoisting\": true\n+}"
        },
        {
            "sha": "804f1b9068a547180dbe4ede5fba6a9f69d714bb",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/input/a.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fa.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fa.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fa.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1 @@\n+export const a = 'a'"
        },
        {
            "sha": "b426ac09186e95a02e3f3af5693f0112fbf2b879",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/input/b.js",
            "status": "added",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fb.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fb.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fb.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1 @@\n+export const b = 'b'"
        },
        {
            "sha": "e69de29bb2d1d6434b8b29ae775ad8c2e48c5391",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/input/empty.js",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fempty.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fempty.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fempty.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d"
        },
        {
            "sha": "c550616df17950d45c3002dc8519e3cdbc488242",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/input/index.js",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,21 @@\n+import { a, b } from './module'\n+\n+import empty from './empty'\n+\n+it('should skip over module', () => {\n+  expect(a).toBe('a')\n+  expect(b).toBe('b')\n+\n+  // Check that module.js is optimized away (not loaded directly)\n+  // because it only re-exports from other modules\n+  const modules = Array.from(__turbopack_modules__.keys())\n+\n+  // module.js should be optimized away by tree-shaking\n+  // (it's just a re-export aggregator with no side effects)\n+  // TODO: this is wrong currently since we do not infer the module to be side effect free\n+  expect(modules).toContainEqual(expect.stringMatching(/module\\.js/))\n+\n+  // But a.js and b.js should be loaded directly\n+  expect(modules).toContainEqual(expect.stringMatching(/a\\.js/))\n+  expect(modules).toContainEqual(expect.stringMatching(/b\\.js/))\n+})"
        },
        {
            "sha": "b0f0a93f59ae75d81a92a1c33d1cad734e98dc9a",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/input/module.js",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Finput%2Fmodule.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,3 @@\n+export * from './a'\n+export * from './empty'\n+export * from './b'"
        },
        {
            "sha": "d3aa3230adf56b4c52bf45574cbc1baa8aad0684",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/issues/unexpected export __star__-7996c6.txt",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Fissues%2Funexpected%20export%20__star__-7996c6.txt",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Fissues%2Funexpected%20export%20__star__-7996c6.txt",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Fissues%2Funexpected%20export%20__star__-7996c6.txt?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,10 @@\n+warning - [analysis] /turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/input/empty.js  unexpected export *\n+  \n+  export * used with module [project]/turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/input/empty.js [test] (ecmascript) which has no exports\n+  Typescript only: Did you want to export only types with `export type * from \"...\"`?\n+  Note: Using `export type` is more efficient than `export *` as it won't emit any runtime code.\n+  \n+  Import trace:\n+    test:\n+      ./turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/input/empty.js\n+      ./turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/input/index.js\n\\ No newline at end of file"
        },
        {
            "sha": "bf30b867b72132fe909283a871c7916ee8109fb5",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/type-reexports/options.json",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Foptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Foptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Ftype-reexports%2Foptions.json?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,3 @@\n+{\n+  \"scopeHoisting\": false\n+}"
        },
        {
            "sha": "fb53b9dedd3b409ea93b7db98a2c34454bf95fee",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/url/input/file.png",
            "status": "added",
            "additions": 0,
            "deletions": 0,
            "changes": 0,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Furl%2Finput%2Ffile.png",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Furl%2Finput%2Ffile.png",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Furl%2Finput%2Ffile.png?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d"
        },
        {
            "sha": "b5cfb96c49e0512b65caf52da8b0b5e322acad86",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/url/input/index.js",
            "status": "added",
            "additions": 17,
            "deletions": 0,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Furl%2Finput%2Findex.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Furl%2Finput%2Findex.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Furl%2Finput%2Findex.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,17 @@\n+import { used } from './module'\n+\n+it('should not include unused assets', () => {\n+  expect(used.href).toMatch(/png/)\n+\n+  // Check that modules are loaded/not loaded based on side effects\n+  const modules = Array.from(__turbopack_modules__.keys())\n+\n+  // 'used' should be included (not orphaned)\n+  expect(modules).toContainEqual(expect.stringMatching(/file\\.png\\?used/))\n+\n+  // unused exports should not be included (orphaned by tree-shaking)\n+  // These tree assertions are WRONG, the url modules are included even though they\n+  expect(modules).toContainEqual(expect.stringMatching(/file\\.png\\?default/))\n+  expect(modules).toContainEqual(expect.stringMatching(/file\\.png\\?named/))\n+  expect(modules).toContainEqual(expect.stringMatching(/file\\.png\\?indirect/))\n+})"
        },
        {
            "sha": "bee25d53032ee41983f5d12ef737ddf7f198cee1",
            "filename": "turbopack/crates/turbopack-tests/tests/execution/webpack/side-effects/url/input/module.js",
            "status": "added",
            "additions": 8,
            "deletions": 0,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Furl%2Finput%2Fmodule.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Furl%2Finput%2Fmodule.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fexecution%2Fwebpack%2Fside-effects%2Furl%2Finput%2Fmodule.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -0,0 +1,8 @@\n+export default new URL('file.png?default', import.meta.url)\n+export const named = new URL('file.png?named', import.meta.url)\n+export const indirect = fn\n+export const used = new URL('file.png?used', import.meta.url)\n+\n+function fn() {\n+  return new URL('file.png?indirect', import.meta.url)\n+}"
        },
        {
            "sha": "85ff2ca64dee3054ba510427a3f069776aefce08",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/source_maps/merged-unicode/output/aaf3a_crates_turbopack-tests_tests_snapshot_source_maps_merged-unicode_input_2490dad7._.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fsource_maps%2Fmerged-unicode%2Foutput%2Faaf3a_crates_turbopack-tests_tests_snapshot_source_maps_merged-unicode_input_2490dad7._.js",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fsource_maps%2Fmerged-unicode%2Foutput%2Faaf3a_crates_turbopack-tests_tests_snapshot_source_maps_merged-unicode_input_2490dad7._.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fsource_maps%2Fmerged-unicode%2Foutput%2Faaf3a_crates_turbopack-tests_tests_snapshot_source_maps_merged-unicode_input_2490dad7._.js?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -74,4 +74,4 @@ if (Date.now() > 0) {\n }),\n ]);\n \n-//# sourceMappingURL=aaf3a_crates_turbopack-tests_tests_snapshot_source_maps_merged-unicode_input_2490dad7._.js.map\n+//# sourceMappingURL=aaf3a_crates_turbopack-tests_tests_snapshot_source_maps_merged-unicode_input_2490dad7._.js.map\n\\ No newline at end of file"
        },
        {
            "sha": "c1642a47a17ceffb9ba58919462b92423009c2c4",
            "filename": "turbopack/crates/turbopack/src/module_options/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Fmod.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -210,6 +210,7 @@ impl ModuleOptions {\n                     enable_exports_info_inlining,\n                     source_maps: ecmascript_source_maps,\n                     inline_helpers,\n+                    infer_module_side_effects,\n                     ..\n                 },\n             enable_mdx,\n@@ -285,6 +286,7 @@ impl ModuleOptions {\n             enable_typeof_window_inlining,\n             enable_exports_info_inlining,\n             inline_helpers,\n+            infer_module_side_effects,\n             ..Default::default()\n         };\n         let ecmascript_options_vc = ecmascript_options.resolved_cell();"
        },
        {
            "sha": "591a85b301f5a0aefec9aafbd9a5c57d059292f0",
            "filename": "turbopack/crates/turbopack/src/module_options/module_options_context.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Fmodule_options_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/c54eda4baaeb3826d9149b15c7bdc85039f8978d/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Fmodule_options_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack%2Fsrc%2Fmodule_options%2Fmodule_options_context.rs?ref=c54eda4baaeb3826d9149b15c7bdc85039f8978d",
            "patch": "@@ -252,6 +252,9 @@ pub struct EcmascriptOptionsContext {\n     // TODO should this be a part of Environment instead?\n     pub inline_helpers: bool,\n \n+    /// Whether to infer side effect free modules via local analysis. Defaults to true.\n+    pub infer_module_side_effects: bool,\n+\n     pub placeholder_for_future_extensions: (),\n }\n "
        }
    ],
    "stats": {
        "total": 2878,
        "additions": 2864,
        "deletions": 14
    }
}