{
    "author": "devjiwonchoi",
    "message": "[ts-next-plugin] test: add client-boundary test (#79194)\n\nThis PR added tests for Next.js TypeScript plugins, specific for client-boundary. Updated the readme and removed the legacy fixture.",
    "sha": "53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c",
    "files": [
        {
            "sha": "2eaa52100db573f068bec636a7dc5e9fc89900bd",
            "filename": "test/development/typescript-plugin/README.md",
            "status": "modified",
            "additions": 9,
            "deletions": 3,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2FREADME.md",
            "raw_url": "https://github.com/vercel/next.js/raw/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2FREADME.md",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2FREADME.md?ref=53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c",
            "patch": "@@ -19,8 +19,14 @@ Ensure the current comments still describe the observed behavior.\n `app/error.tsx#Error` and `app/global-error.tsx#GlobalError` have a `reset` prop\n that should be excluded from the serialization check.\n \n+### Client Boundary\n+\n+- `client-boundary/app/non-serializable-action-props.tsx` has examples of Server Action props that can't be serialized, which is allowed.\n+- `client-boundary/app/non-serializable-props.tsx` has examples of props that can't be serialized.\n+- `client-boundary/app/serializable-props.tsx` has examples of props that can be serialized.\n+\n ### Metadata\n \n-- `app/metadata/completion` has examples of metadata and generateMetadata completions.\n-- `app/metadata/missing-type-warning` has examples of metadata and generateMetadata missing type warnings.\n-- `app/metadata/client` has examples of metadata and generateMetadata not allowed in a client component.\n+- `metadata/app/metadata/completion` has examples of metadata and generateMetadata completions.\n+- `metadata/app/metadata/missing-type-warning` has examples of metadata and generateMetadata missing type warnings.\n+- `metadata/app/metadata/client` has examples of metadata and generateMetadata not allowed in a client component."
        },
        {
            "sha": "b4969313507e6cb4de2a2b202f26b9aac5364944",
            "filename": "test/development/typescript-plugin/app/client.tsx",
            "status": "removed",
            "additions": 0,
            "deletions": 22,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/ce0fe2672e46d0755989dccb45968d8128932adf/test%2Fdevelopment%2Ftypescript-plugin%2Fapp%2Fclient.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/ce0fe2672e46d0755989dccb45968d8128932adf/test%2Fdevelopment%2Ftypescript-plugin%2Fapp%2Fclient.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fapp%2Fclient.tsx?ref=ce0fe2672e46d0755989dccb45968d8128932adf",
            "patch": "@@ -1,22 +0,0 @@\n-'use client'\n-\n-class MyClass {}\n-\n-export function ClientComponent({\n-  unknownAction,\n-  //^^^^^^^^^^^ fine because it looks like an action\n-  unknown,\n-  //^^^^^ \"Error(TS71007): Props must be serializable for components in the \"use client\" entry file. \"unknown\" is a function that's not a Server Action. Rename \"unknown\" either to \"action\" or have its name end with \"Action\" e.g. \"unknownAction\" to indicate it is a Server Action. ts(71007)\n-  foo,\n-  //^ \"Error(TS71007): Props must be serializable for components in the \"use client\" entry file, \"foo\" is invalid.ts(71007)\n-  bar,\n-  //^ \"Error(TS71007): Props must be serializable for components in the \"use client\" entry file, \"bar\" is invalid.ts(71007)\n-}: {\n-  unknownAction: () => void\n-  unknown: () => void\n-  foo: new () => Error\n-  bar: MyClass\n-}) {\n-  console.log({ unknown, unknownAction, foo, bar })\n-  return null\n-}"
        },
        {
            "sha": "a36c35e9b624c0884f0e85ebb8f14894c23fad96",
            "filename": "test/development/typescript-plugin/client-boundary/app/non-serializable-action-props.tsx",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-action-props.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-action-props.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-action-props.tsx?ref=53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c",
            "patch": "@@ -0,0 +1,21 @@\n+'use client'\n+\n+class Class {}\n+\n+type ArrowFunctionTypeAlias = () => void\n+\n+export default function ClientComponent({\n+  _arrowFunctionAction,\n+  _arrowFunctionTypeAliasAction,\n+  // Doesn't make sense, but check for loophole\n+  _classAction,\n+  _constructorAction,\n+}: {\n+  _arrowFunctionAction: () => void\n+  _arrowFunctionTypeAliasAction: ArrowFunctionTypeAlias\n+  // Doesn't make sense, but check for loophole\n+  _classAction: Class\n+  _constructorAction: new () => void\n+}) {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "7c79ef538cc17de3e90d604cdc041362872db801",
            "filename": "test/development/typescript-plugin/client-boundary/app/non-serializable-props.tsx",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-props.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-props.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fnon-serializable-props.tsx?ref=53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c",
            "patch": "@@ -0,0 +1,19 @@\n+'use client'\n+\n+class Class {}\n+\n+type ArrowFunctionTypeAlias = () => void\n+\n+export default function ClientComponent({\n+  _arrowFunction,\n+  _arrowFunctionTypeAlias,\n+  _class,\n+  _constructor,\n+}: {\n+  _arrowFunction: () => void\n+  _arrowFunctionTypeAlias: ArrowFunctionTypeAlias\n+  _class: Class\n+  _constructor: new () => void\n+}) {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "8e1a9d3912ed3a9dadbf7a2c2962b893a3df209f",
            "filename": "test/development/typescript-plugin/client-boundary/app/serializable-props.tsx",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fserializable-props.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fserializable-props.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fapp%2Fserializable-props.tsx?ref=53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c",
            "patch": "@@ -0,0 +1,21 @@\n+'use client'\n+\n+export default function ClientComponent({\n+  _string,\n+  _number,\n+  _boolean,\n+  _array,\n+  _object,\n+  _null,\n+  _undefined,\n+}: {\n+  _string: string\n+  _number: number\n+  _boolean: boolean\n+  _array: string[]\n+  _object: { some: string }\n+  _null: null\n+  _undefined: undefined\n+}) {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "b678c5040803bc5146910ed47c777ad99fc66d92",
            "filename": "test/development/typescript-plugin/client-boundary/client-boundary.test.ts",
            "status": "added",
            "additions": 120,
            "deletions": 0,
            "changes": 120,
            "blob_url": "https://github.com/vercel/next.js/blob/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fclient-boundary.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fclient-boundary.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Fclient-boundary.test.ts?ref=53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c",
            "patch": "@@ -0,0 +1,120 @@\n+import type { PluginLanguageService } from '../test-utils'\n+\n+import ts from 'typescript'\n+import { relative, resolve } from 'node:path'\n+import { getPluginLanguageService } from '../test-utils'\n+\n+type PartialDiagnostic = Pick<\n+  ts.Diagnostic,\n+  'code' | 'messageText' | 'start' | 'length'\n+>\n+\n+describe('typescript-plugin - client-boundary', () => {\n+  let languageService: PluginLanguageService\n+\n+  beforeAll(() => {\n+    languageService = getPluginLanguageService(__dirname)\n+  })\n+\n+  it('should not have diagnostics for serializable props', () => {\n+    const tsFile = resolve(__dirname, 'app/serializable-props.tsx')\n+    const totalDiagnostics: Record<string, PartialDiagnostic[]> = {}\n+\n+    // This test expects no diagnostics, but if somehow the test\n+    // detects one and fails, the diagnostics output on the terminal\n+    // is too long and omits the filename, so we filter out only the\n+    // necessary properties for debugging.\n+    totalDiagnostics[relative(__dirname, tsFile)] = languageService\n+      .getSemanticDiagnostics(tsFile)\n+      .map((diagnostic) => ({\n+        code: diagnostic.code,\n+        messageText: diagnostic.messageText,\n+        start: diagnostic.start,\n+        length: diagnostic.length,\n+      }))\n+\n+    expect(totalDiagnostics).toMatchInlineSnapshot(`\n+     {\n+       \"app/serializable-props.tsx\": [],\n+     }\n+    `)\n+  })\n+\n+  it('should not have diagnostics for non-serializable action props', () => {\n+    const tsFile = resolve(__dirname, 'app/non-serializable-action-props.tsx')\n+    const totalDiagnostics: Record<string, PartialDiagnostic[]> = {}\n+\n+    totalDiagnostics[relative(__dirname, tsFile)] = languageService\n+      .getSemanticDiagnostics(tsFile)\n+      .map((diagnostic) => ({\n+        code: diagnostic.code,\n+        messageText: diagnostic.messageText,\n+        start: diagnostic.start,\n+        length: diagnostic.length,\n+      }))\n+\n+    expect(totalDiagnostics).toMatchInlineSnapshot(`\n+     {\n+       \"app/non-serializable-action-props.tsx\": [\n+         {\n+           \"code\": 71007,\n+           \"length\": 12,\n+           \"messageText\": \"Props must be serializable for components in the \"use client\" entry file, \"_classAction\" is invalid.\",\n+           \"start\": 221,\n+         },\n+         {\n+           \"code\": 71007,\n+           \"length\": 18,\n+           \"messageText\": \"Props must be serializable for components in the \"use client\" entry file, \"_constructorAction\" is invalid.\",\n+           \"start\": 237,\n+         },\n+       ],\n+     }\n+    `)\n+  })\n+\n+  it('should have diagnostics for non-serializable props', () => {\n+    const tsFile = resolve(__dirname, 'app/non-serializable-props.tsx')\n+    const totalDiagnostics: Record<string, PartialDiagnostic[]> = {}\n+\n+    totalDiagnostics[relative(__dirname, tsFile)] = languageService\n+      .getSemanticDiagnostics(tsFile)\n+      .map((diagnostic) => ({\n+        code: diagnostic.code,\n+        messageText: diagnostic.messageText,\n+        start: diagnostic.start,\n+        length: diagnostic.length,\n+      }))\n+\n+    expect(totalDiagnostics).toMatchInlineSnapshot(`\n+     {\n+       \"app/non-serializable-props.tsx\": [\n+         {\n+           \"code\": 71007,\n+           \"length\": 14,\n+           \"messageText\": \"Props must be serializable for components in the \"use client\" entry file. \"_arrowFunction\" is a function that's not a Server Action. Rename \"_arrowFunction\" either to \"action\" or have its name end with \"Action\" e.g. \"_arrowFunctionAction\" to indicate it is a Server Action.\",\n+           \"start\": 116,\n+         },\n+         {\n+           \"code\": 71007,\n+           \"length\": 23,\n+           \"messageText\": \"Props must be serializable for components in the \"use client\" entry file. \"_arrowFunctionTypeAlias\" is a function that's not a Server Action. Rename \"_arrowFunctionTypeAlias\" either to \"action\" or have its name end with \"Action\" e.g. \"_arrowFunctionTypeAliasAction\" to indicate it is a Server Action.\",\n+           \"start\": 134,\n+         },\n+         {\n+           \"code\": 71007,\n+           \"length\": 6,\n+           \"messageText\": \"Props must be serializable for components in the \"use client\" entry file, \"_class\" is invalid.\",\n+           \"start\": 161,\n+         },\n+         {\n+           \"code\": 71007,\n+           \"length\": 12,\n+           \"messageText\": \"Props must be serializable for components in the \"use client\" entry file, \"_constructor\" is invalid.\",\n+           \"start\": 171,\n+         },\n+       ],\n+     }\n+    `)\n+  })\n+})"
        },
        {
            "sha": "1d4f624eff7d9cc1f6acd2028a03cb50916f5827",
            "filename": "test/development/typescript-plugin/client-boundary/tsconfig.json",
            "status": "added",
            "additions": 24,
            "deletions": 0,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Ftsconfig.json",
            "raw_url": "https://github.com/vercel/next.js/raw/53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Ftsconfig.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Ftypescript-plugin%2Fclient-boundary%2Ftsconfig.json?ref=53bb899fc4af08c4e9d4dae2d8a1b2d631fe789c",
            "patch": "@@ -0,0 +1,24 @@\n+{\n+  \"compilerOptions\": {\n+    \"target\": \"ES2017\",\n+    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n+    \"allowJs\": true,\n+    \"skipLibCheck\": true,\n+    \"strict\": false,\n+    \"noEmit\": true,\n+    \"incremental\": true,\n+    \"module\": \"esnext\",\n+    \"esModuleInterop\": true,\n+    \"moduleResolution\": \"node\",\n+    \"resolveJsonModule\": true,\n+    \"isolatedModules\": true,\n+    \"jsx\": \"preserve\",\n+    \"plugins\": [\n+      {\n+        \"name\": \"next\"\n+      }\n+    ]\n+  },\n+  \"include\": [\"next-env.d.ts\", \".next/types/**/*.ts\", \"**/*.ts\", \"**/*.tsx\"],\n+  \"exclude\": [\"node_modules\"]\n+}"
        }
    ],
    "stats": {
        "total": 239,
        "additions": 214,
        "deletions": 25
    }
}