{
    "author": "timneutkens",
    "message": "Add test creation instructions to agents.md (#88215)\n\n## Enhance test documentation with best practices and non-interactive\ntest generation\n\n### What?\nExpanded the AGENTS.md documentation with detailed guidance on writing\ntests, including:\n- Added non-interactive test generation instructions for AI agents\n- Documented best practices for writing tests with code examples\n- Provided clear guidance on using `retry()` instead of deprecated\n`check()` or `setTimeout`\n- Added recommendations for using fixture directories over inline file\ndefinitions",
    "sha": "f59cf2e4199272de4bb31aff6420a984dadb63b9",
    "files": [
        {
            "sha": "5a2ededc075e97ffea008579c4650b97da77083a",
            "filename": "AGENTS.md",
            "status": "modified",
            "additions": 62,
            "deletions": 1,
            "changes": 63,
            "blob_url": "https://github.com/vercel/next.js/blob/f59cf2e4199272de4bb31aff6420a984dadb63b9/AGENTS.md",
            "raw_url": "https://github.com/vercel/next.js/raw/f59cf2e4199272de4bb31aff6420a984dadb63b9/AGENTS.md",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/AGENTS.md?ref=f59cf2e4199272de4bb31aff6420a984dadb63b9",
            "patch": "@@ -110,7 +110,68 @@ pnpm test-dev-turbo test/development/\n \n - `pnpm test-unit` - Run unit tests only (fast, no browser)\n - `pnpm testonly <path>` - Run tests without rebuilding (faster iteration)\n-- `pnpm new-test` - Generate a new test file from template\n+- `pnpm new-test` - Generate a new test file from template (interactive)\n+\n+**Generate tests non-interactively (for AI agents):**\n+\n+```bash\n+# Use --args for non-interactive mode\n+# Format: pnpm new-test --args <appDir> <name> <type>\n+# appDir: true/false (is this for app directory?)\n+# name: test name (e.g. \"my-feature\")\n+# type: e2e | production | development | unit\n+\n+pnpm new-test --args true my-feature e2e\n+```\n+\n+## Writing Tests\n+\n+**Test writing expectations:**\n+\n+- **Use `pnpm new-test` to generate new test suites** - it creates proper structure with fixture files\n+\n+- **Use `retry()` from `next-test-utils` instead of `setTimeout` for waiting**\n+\n+  ```typescript\n+  // Good - use retry() for polling/waiting\n+  import { retry } from 'next-test-utils'\n+  await retry(async () => {\n+    const text = await browser.elementByCss('p').text()\n+    expect(text).toBe('expected value')\n+  })\n+\n+  // Bad - don't use setTimeout for waiting\n+  await new Promise((resolve) => setTimeout(resolve, 1000))\n+  ```\n+\n+- **Do NOT use `check()` - it is deprecated. Use `retry()` + `expect()` instead**\n+\n+  ```typescript\n+  // Deprecated - don't use check()\n+  await check(() => browser.elementByCss('p').text(), /expected/)\n+\n+  // Good - use retry() with expect()\n+  await retry(async () => {\n+    const text = await browser.elementByCss('p').text()\n+    expect(text).toMatch(/expected/)\n+  })\n+  ```\n+\n+- **Prefer real fixture directories over inline `files` objects**\n+\n+  ```typescript\n+  // Good - use a real directory with fixture files\n+  const { next } = nextTestSetup({\n+    files: __dirname, // points to directory containing test fixtures\n+  })\n+\n+  // Avoid - inline file definitions are harder to maintain\n+  const { next } = nextTestSetup({\n+    files: {\n+      'app/page.tsx': `export default function Page() { ... }`,\n+    },\n+  })\n+  ```\n \n ## Linting and Types\n "
        }
    ],
    "stats": {
        "total": 63,
        "additions": 62,
        "deletions": 1
    }
}