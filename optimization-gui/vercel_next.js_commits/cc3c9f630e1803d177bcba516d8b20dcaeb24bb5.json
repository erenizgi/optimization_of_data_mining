{
    "author": "mischnic",
    "message": "Turbopack: bail instead of panic (#86470)\n\nEventual consistency strikes again\n\nWe already had the infrastructure here to store a result in the swc visitor.",
    "sha": "cc3c9f630e1803d177bcba516d8b20dcaeb24bb5",
    "files": [
        {
            "sha": "205093d06661d53273cf4dfd6c9615b13a1f9a17",
            "filename": "turbopack/crates/turbopack-ecmascript/src/lib.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/cc3c9f630e1803d177bcba516d8b20dcaeb24bb5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/cc3c9f630e1803d177bcba516d8b20dcaeb24bb5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Flib.rs?ref=cc3c9f630e1803d177bcba516d8b20dcaeb24bb5",
            "patch": "@@ -1316,7 +1316,8 @@ async fn merge_modules(\n             // corresponding export in the module that exports it.\n             if let Some(&module) = self.reverse_module_contexts.get(ctxt) {\n                 let eval_context_exports = self.export_contexts.get(&module).unwrap();\n-                // TODO looking up an Atom in a Map<RcStr, _>\n+                // TODO looking up an Atom in a Map<RcStr, _>, would ideally work without creating a\n+                // RcStr every time.\n                 let sym_rc_str: RcStr = sym.as_str().into();\n                 let (local, local_ctxt) = if let Some((local, local_ctxt)) =\n                     eval_context_exports.get(&sym_rc_str)\n@@ -1329,10 +1330,11 @@ async fn merge_modules(\n                     // generating this variable.\n                     (None, SyntaxContext::empty())\n                 } else {\n-                    panic!(\n+                    self.error = Err(anyhow::anyhow!(\n                         \"Expected to find a local export for {sym} with ctxt {ctxt:#?} in \\\n                          {eval_context_exports:?}\",\n-                    );\n+                    ));\n+                    return;\n                 };\n \n                 let global_ctxt = self.get_context_for(module, local_ctxt);"
        }
    ],
    "stats": {
        "total": 8,
        "additions": 5,
        "deletions": 3
    }
}