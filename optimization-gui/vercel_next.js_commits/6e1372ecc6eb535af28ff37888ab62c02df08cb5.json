{
    "author": "icyJoseph",
    "message": "fix: Add Chrome-ligthouse to htmlLimitedBots (#80656)\n\nCo-authored-by: Jiachi Liu <inbox@huozhi.im>",
    "sha": "6e1372ecc6eb535af28ff37888ab62c02df08cb5",
    "files": [
        {
            "sha": "db4840e01d9621ad7fd940411e5cbecfe421713e",
            "filename": "packages/next/src/shared/lib/router/utils/html-bots.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/6e1372ecc6eb535af28ff37888ab62c02df08cb5/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fhtml-bots.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6e1372ecc6eb535af28ff37888ab62c02df08cb5/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fhtml-bots.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fshared%2Flib%2Frouter%2Futils%2Fhtml-bots.ts?ref=6e1372ecc6eb535af28ff37888ab62c02df08cb5",
            "patch": "@@ -1,4 +1,4 @@\n // This regex contains the bots that we need to do a blocking render for and can't safely stream the response\n // due to how they parse the DOM. For example, they might explicitly check for metadata in the `head` tag, so we can't stream metadata tags after the `head` was sent.\n export const HTML_LIMITED_BOT_UA_RE =\n-  /Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti/i\n+  /Mediapartners-Google|Chrome-Lighthouse|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti/i"
        },
        {
            "sha": "fa57db3c24304065b42dc5a8d866f84585eaf625",
            "filename": "test/e2e/app-dir/metadata-streaming/metadata-streaming.test.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/6e1372ecc6eb535af28ff37888ab62c02df08cb5/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6e1372ecc6eb535af28ff37888ab62c02df08cb5/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fmetadata-streaming%2Fmetadata-streaming.test.ts?ref=6e1372ecc6eb535af28ff37888ab62c02df08cb5",
            "patch": "@@ -182,5 +182,20 @@ describe('app-dir - metadata-streaming', () => {\n       expect($('title').length).toBe(1)\n       expect($('head title').text()).toBe('partial static page')\n     })\n+\n+    it('should still render blocking metadata for Google speed insights bot (special case)', async () => {\n+      const $ = await next.render$(\n+        '/static/partial',\n+        {},\n+        {\n+          headers: {\n+            'user-agent':\n+              'UA Mozilla/5.0 (Linux; Android 7.0; Moto G (4)) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/94.0.4590.2 Mobile Safari/537.36 Chrome-Lighthouse',\n+          },\n+        }\n+      )\n+      expect($('title').length).toBe(1)\n+      expect($('head title').text()).toBe('partial static page')\n+    })\n   })\n })"
        },
        {
            "sha": "2c1cd43284cf2c3fb1592a6f554751ec403d0dcc",
            "filename": "test/production/app-dir/metadata-streaming-config/metadata-streaming-config.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/6e1372ecc6eb535af28ff37888ab62c02df08cb5/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fmetadata-streaming-config.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/6e1372ecc6eb535af28ff37888ab62c02df08cb5/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fmetadata-streaming-config.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fproduction%2Fapp-dir%2Fmetadata-streaming-config%2Fmetadata-streaming-config.test.ts?ref=6e1372ecc6eb535af28ff37888ab62c02df08cb5",
            "patch": "@@ -11,7 +11,7 @@ describe('app-dir - metadata-streaming-config', () => {\n     )\n \n     expect(requiredServerFiles.config.htmlLimitedBots).toMatchInlineSnapshot(\n-      `\"Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti\"`\n+      `\"Mediapartners-Google|Chrome-Lighthouse|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti\"`\n     )\n \n     const prerenderManifest = JSON.parse(\n@@ -38,7 +38,7 @@ describe('app-dir - metadata-streaming-config', () => {\n        \"/ppr\": {\n          \"key\": \"user-agent\",\n          \"type\": \"header\",\n-         \"value\": \"Mediapartners-Google|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti\",\n+         \"value\": \"Mediapartners-Google|Chrome-Lighthouse|Slurp|DuckDuckBot|baiduspider|yandex|sogou|bitlybot|tumblr|vkShare|quora link preview|redditbot|ia_archiver|Bingbot|BingPreview|applebot|facebookexternalhit|facebookcatalog|Twitterbot|LinkedInBot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|Yeti\",\n        },\n      }\n     `)"
        }
    ],
    "stats": {
        "total": 21,
        "additions": 18,
        "deletions": 3
    }
}