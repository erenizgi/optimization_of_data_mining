{
    "author": "devjiwonchoi",
    "message": "fix: devtools initial position should be from next config (#83571)",
    "sha": "25b9f490bbca3feedd0489997f1764a73c1a953e",
    "files": [
        {
            "sha": "af92595fa64fd8420a123341a40a0e62d73464d2",
            "filename": "packages/next/src/next-devtools/dev-overlay/shared.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -251,6 +251,9 @@ function getStackIgnoringStrictMode(stack: string | undefined) {\n const shouldDisableDevIndicator =\n   process.env.__NEXT_DEV_INDICATOR?.toString() === 'false'\n \n+const devToolsInitialPositionFromNextConfig = (process.env\n+  .__NEXT_DEV_INDICATOR_POSITION ?? 'bottom-left') as Corners\n+\n export const INITIAL_OVERLAY_STATE: Omit<\n   OverlayState,\n   'isErrorOverlayOpen' | 'routerType'\n@@ -272,9 +275,9 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   refreshState: { type: 'idle' },\n   versionInfo: { installed: '0.0.0', staleness: 'unknown' },\n   debugInfo: { devtoolsFrontendUrl: undefined },\n-  devToolsPosition: 'bottom-left',\n+  devToolsPosition: devToolsInitialPositionFromNextConfig,\n   devToolsPanelPosition: {\n-    [STORE_KEY_SHARED_PANEL_LOCATION]: 'bottom-left',\n+    [STORE_KEY_SHARED_PANEL_LOCATION]: devToolsInitialPositionFromNextConfig,\n   },\n   devToolsPanelSize: {},\n   scale: NEXT_DEV_TOOLS_SCALE.Medium,"
        },
        {
            "sha": "0b605f1646c61f508d568290872e3541ea582544",
            "filename": "test/development/app-dir/devtools-position/app/layout.tsx",
            "status": "added",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fapp%2Flayout.tsx?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -0,0 +1,9 @@\n+import type { ReactNode } from 'react'\n+\n+export default function RootLayout({ children }: { children: ReactNode }) {\n+  return (\n+    <html>\n+      <body>{children}</body>\n+    </html>\n+  )\n+}"
        },
        {
            "sha": "ff7159d9149feeb1eb8f4b7bbeadb2e26c20b053",
            "filename": "test/development/app-dir/devtools-position/app/page.tsx",
            "status": "added",
            "additions": 3,
            "deletions": 0,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fapp%2Fpage.tsx?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -0,0 +1,3 @@\n+export default function Page() {\n+  return <p>hello world</p>\n+}"
        },
        {
            "sha": "fdc9a2bf9be390634ba92a8047c6c72cef5ccbb0",
            "filename": "test/development/app-dir/devtools-position/bottom-left.test.ts",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fbottom-left.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fbottom-left.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fbottom-left.test.ts?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -0,0 +1,20 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { getDevIndicatorPosition } from './utils'\n+\n+describe('devtools-position-bottom-left', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      devIndicators: {\n+        position: 'bottom-left',\n+      },\n+    },\n+  })\n+\n+  it('should devtools indicator position initially be bottom-left when configured', async () => {\n+    const browser = await next.browser('/')\n+    const style = await getDevIndicatorPosition(browser)\n+    expect(style).toContain('bottom: 20px')\n+    expect(style).toContain('left: 20px')\n+  })\n+})"
        },
        {
            "sha": "3b8a08a656c160610ba44c67d614b456be840580",
            "filename": "test/development/app-dir/devtools-position/bottom-right-position.test.ts",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fbottom-right-position.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fbottom-right-position.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fbottom-right-position.test.ts?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -0,0 +1,20 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { getDevIndicatorPosition } from './utils'\n+\n+describe('devtools-position-bottom-right', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      devIndicators: {\n+        position: 'bottom-right',\n+      },\n+    },\n+  })\n+\n+  it('should devtools indicator position initially be bottom-right when configured', async () => {\n+    const browser = await next.browser('/')\n+    const style = await getDevIndicatorPosition(browser)\n+    expect(style).toContain('bottom: 20px')\n+    expect(style).toContain('right: 20px')\n+  })\n+})"
        },
        {
            "sha": "1a162d305d79409eaae03ba7b496547e6b278e30",
            "filename": "test/development/app-dir/devtools-position/default-position.test.ts",
            "status": "added",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fdefault-position.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fdefault-position.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fdefault-position.test.ts?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -0,0 +1,15 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { getDevIndicatorPosition } from './utils'\n+\n+describe('devtools-position-default', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+  })\n+\n+  it('should devtools indicator position initially be bottom-left by default', async () => {\n+    const browser = await next.browser('/')\n+    const style = await getDevIndicatorPosition(browser)\n+    expect(style).toContain('bottom: 20px')\n+    expect(style).toContain('left: 20px')\n+  })\n+})"
        },
        {
            "sha": "8ddb0ebbca2410ecd20736a7a19fa9f4c742afcd",
            "filename": "test/development/app-dir/devtools-position/position-persistence.test.ts",
            "status": "added",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fposition-persistence.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fposition-persistence.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Fposition-persistence.test.ts?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -0,0 +1,31 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { getDevIndicatorPosition } from './utils'\n+\n+describe('devtools-position-persistence', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      devIndicators: {\n+        position: 'top-right',\n+      },\n+    },\n+  })\n+\n+  it('should maintain devtools indicator position after navigation', async () => {\n+    const browser = await next.browser('/')\n+\n+    let style = await getDevIndicatorPosition(browser)\n+\n+    expect(style).toContain('top: 20px')\n+    expect(style).toContain('right: 20px')\n+\n+    // Navigate and check devtools indicator position is maintained\n+    await browser.refresh()\n+    await browser.waitForIdleNetwork()\n+\n+    style = await getDevIndicatorPosition(browser)\n+\n+    expect(style).toContain('top: 20px')\n+    expect(style).toContain('right: 20px')\n+  })\n+})"
        },
        {
            "sha": "c5cdc1b0538d2c3180d3c4f016d949a72ae7d635",
            "filename": "test/development/app-dir/devtools-position/top-left-position.test.ts",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Ftop-left-position.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Ftop-left-position.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Ftop-left-position.test.ts?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -0,0 +1,20 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { getDevIndicatorPosition } from './utils'\n+\n+describe('devtools-position-top-left', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      devIndicators: {\n+        position: 'top-left',\n+      },\n+    },\n+  })\n+\n+  it('should devtools indicator position initially be top-left when configured', async () => {\n+    const browser = await next.browser('/')\n+    const style = await getDevIndicatorPosition(browser)\n+    expect(style).toContain('top: 20px')\n+    expect(style).toContain('left: 20px')\n+  })\n+})"
        },
        {
            "sha": "82b27c4bae4efa64027c833a9c583c3afacc78e3",
            "filename": "test/development/app-dir/devtools-position/top-right-position.test.ts",
            "status": "added",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Ftop-right-position.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Ftop-right-position.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Ftop-right-position.test.ts?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -0,0 +1,20 @@\n+import { nextTestSetup } from 'e2e-utils'\n+import { getDevIndicatorPosition } from './utils'\n+\n+describe('devtools-position-top-right', () => {\n+  const { next } = nextTestSetup({\n+    files: __dirname,\n+    nextConfig: {\n+      devIndicators: {\n+        position: 'top-right',\n+      },\n+    },\n+  })\n+\n+  it('should devtools indicator position initially be top-right when configured', async () => {\n+    const browser = await next.browser('/')\n+    const style = await getDevIndicatorPosition(browser)\n+    expect(style).toContain('top: 20px')\n+    expect(style).toContain('right: 20px')\n+  })\n+})"
        },
        {
            "sha": "02309d810852a8bd05ce7c5b0d0f01af3d28e5ad",
            "filename": "test/development/app-dir/devtools-position/utils.ts",
            "status": "added",
            "additions": 19,
            "deletions": 0,
            "changes": 19,
            "blob_url": "https://github.com/vercel/next.js/blob/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/25b9f490bbca3feedd0489997f1764a73c1a953e/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fdevtools-position%2Futils.ts?ref=25b9f490bbca3feedd0489997f1764a73c1a953e",
            "patch": "@@ -0,0 +1,19 @@\n+import type { Playwright } from '../../../lib/next-webdriver'\n+import { assertHasDevToolsIndicator } from 'next-test-utils'\n+\n+export async function getDevIndicatorPosition(browser: Playwright) {\n+  // assert before eval() to prevent race condition\n+  await assertHasDevToolsIndicator(browser)\n+\n+  const style = await browser.eval(() => {\n+    return (\n+      [].slice\n+        .call(document.querySelectorAll('nextjs-portal'))\n+        .find((p) => p.shadowRoot.querySelector('[data-nextjs-toast]'))\n+        // portal\n+        ?.shadowRoot?.querySelector('[data-nextjs-toast]')\n+        ?.getAttribute('style') || ''\n+    )\n+  })\n+  return style || ''\n+}"
        }
    ],
    "stats": {
        "total": 164,
        "additions": 162,
        "deletions": 2
    }
}