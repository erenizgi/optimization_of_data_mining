{
    "author": "eps1lon",
    "message": "[test] Use React 19.1 everywhere (#77895)",
    "sha": "1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
    "files": [
        {
            "sha": "04673970a995c1c7ca2ce997b81833100991568d",
            "filename": "examples/reproduction-template/package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/examples%2Freproduction-template%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/examples%2Freproduction-template%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/examples%2Freproduction-template%2Fpackage.json?ref=1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
            "patch": "@@ -7,8 +7,8 @@\n   },\n   \"dependencies\": {\n     \"next\": \"canary\",\n-    \"react\": \"^19.0.0\",\n-    \"react-dom\": \"^19.0.0\"\n+    \"react\": \"19.1.0\",\n+    \"react-dom\": \"19.1.0\"\n   },\n   \"devDependencies\": {\n     \"@types/node\": \"^22\","
        },
        {
            "sha": "ceedc7e2cdbd4df31a82fa8d944c7481777b2987",
            "filename": "packages/create-next-app/templates/index.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/packages%2Fcreate-next-app%2Ftemplates%2Findex.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/packages%2Fcreate-next-app%2Ftemplates%2Findex.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fcreate-next-app%2Ftemplates%2Findex.ts?ref=1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
            "patch": "@@ -13,7 +13,7 @@ import { GetTemplateFileArgs, InstallTemplateArgs } from \"./types\";\n \n // Do not rename or format. sync-react script relies on this line.\n // prettier-ignore\n-const nextjsReactPeerVersion = \"^19.0.0\";\n+const nextjsReactPeerVersion = \"19.1.0\";\n \n /**\n  * Get the file path for a given file in a template, e.g. \"next.config.js\"."
        },
        {
            "sha": "bb71421b18fc961bf64e4806a117d16fb3dbc2af",
            "filename": "run-tests.js",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/run-tests.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/run-tests.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/run-tests.js?ref=1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
            "patch": "@@ -19,7 +19,7 @@ const { getTestFilter } = require('./test/get-test-filter')\n \n // Do not rename or format. sync-react script relies on this line.\n // prettier-ignore\n-const nextjsReactPeerVersion = \"^19.0.0\";\n+const nextjsReactPeerVersion = \"19.1.0\";\n \n let argv = require('yargs/yargs')(process.argv.slice(2))\n   .string('type')"
        },
        {
            "sha": "cf27f3da668eec3fe5af77b7b24979ce084bf5fc",
            "filename": "scripts/sync-react.js",
            "status": "modified",
            "additions": 47,
            "deletions": 27,
            "changes": 74,
            "blob_url": "https://github.com/vercel/next.js/blob/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/scripts%2Fsync-react.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/scripts%2Fsync-react.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/scripts%2Fsync-react.js?ref=1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
            "patch": "@@ -5,6 +5,7 @@ const fsp = require('fs/promises')\n const process = require('process')\n const execa = require('execa')\n const { Octokit } = require('octokit')\n+const SemVer = require('semver')\n const yargs = require('yargs')\n \n /** @type {any} */\n@@ -17,9 +18,13 @@ const pullRequestReviewers = ['eps1lon']\n /**\n  * Set to `null` to automatically sync the React version of Pages Router with App Router React version.\n  * Set to a specific version to override the Pages Router React version e.g. `^19.0.0`.\n+ *\n+ * \"Active\" just refers to our current development practice. While we do support\n+ * React 18 in pages router, we don't focus our development process on it considering\n+ * it does not receive new features.\n  * @type {string | null}\n  */\n-const pagesRouterReact = '^19.0.0'\n+const activePagesRouterReact = '^19.0.0'\n \n const defaultLatestChannel = 'canary'\n const filesReferencingReactPeerDependencyVersion = [\n@@ -176,6 +181,31 @@ async function getChangelogFromGitHub(baseSha, newSha) {\n   return changelog.length > 0 ? changelog.join('\\n') : null\n }\n \n+async function findHighestNPMReactVersion(versionLike) {\n+  const { stdout, stderr } = await execa(\n+    'npm',\n+    ['--silent', 'view', '--json', `react@${versionLike}`, 'version'],\n+    {\n+      // Avoid \"Usage Error: This project is configured to use pnpm\".\n+      cwd: '/tmp',\n+    }\n+  )\n+  if (stderr) {\n+    console.error(stderr)\n+    throw new Error(\n+      `Failed to read highest react@${versionLike} version from npm.`\n+    )\n+  }\n+\n+  const result = JSON.parse(stdout)\n+\n+  return typeof result === 'string'\n+    ? result\n+    : result.sort((a, b) => {\n+        return SemVer.compare(b, a)\n+      })[0]\n+}\n+\n async function main() {\n   const cwd = process.cwd()\n   const errors = []\n@@ -232,19 +262,7 @@ async function main() {\n     // TODO: Fork arguments in GitHub workflow to ensure `--version \"\"` is considered a mistake\n     newVersionStr === ''\n   ) {\n-    const { stdout, stderr } = await execa(\n-      'npm',\n-      ['--silent', 'view', `react@${defaultLatestChannel}`, 'version'],\n-      {\n-        // Avoid \"Usage Error: This project is configured to use pnpm\".\n-        cwd: '/tmp',\n-      }\n-    )\n-    if (stderr) {\n-      console.error(stderr)\n-      throw new Error('Failed to read latest React canary version from npm.')\n-    }\n-    newVersionStr = stdout.trim()\n+    newVersionStr = await findHighestNPMReactVersion(defaultLatestChannel)\n     console.log(\n       `--version was not provided. Using react@${defaultLatestChannel}: ${newVersionStr}`\n     )\n@@ -325,24 +343,28 @@ Or, run this command with no arguments to use the most recently published versio\n     )\n   }\n \n-  const syncPagesRouterReact = pagesRouterReact === null\n-  const pagesRouterReactVersion = syncPagesRouterReact\n+  const syncPagesRouterReact = activePagesRouterReact === null\n+  const newActivePagesRouterReactVersion = syncPagesRouterReact\n     ? newVersionStr\n-    : pagesRouterReact\n+    : activePagesRouterReact\n+  const pagesRouterReactVersion = `^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ${newActivePagesRouterReactVersion}`\n+  const highestPagesRouterReactVersion = await findHighestNPMReactVersion(\n+    pagesRouterReactVersion\n+  )\n   const { sha: baseSha, dateString: baseDateString } = baseVersionInfo\n \n   if (syncPagesRouterReact) {\n     for (const fileName of filesReferencingReactPeerDependencyVersion) {\n       const filePath = path.join(cwd, fileName)\n       const previousSource = await fsp.readFile(filePath, 'utf-8')\n       const updatedSource = previousSource.replace(\n-        `const nextjsReactPeerVersion = \"${baseVersionStr}\";`,\n-        `const nextjsReactPeerVersion = \"${pagesRouterReactVersion}\";`\n+        /const nextjsReactPeerVersion = \"[^\"]+\";/,\n+        `const nextjsReactPeerVersion = \"${highestPagesRouterReactVersion}\";`\n       )\n-      if (pagesRouterReact === null && updatedSource === previousSource) {\n+      if (activePagesRouterReact === null && updatedSource === previousSource) {\n         errors.push(\n           new Error(\n-            `${fileName}: Failed to update ${baseVersionStr} to ${pagesRouterReactVersion}. Is this file still referencing the React peer dependency version?`\n+            `${fileName}: Failed to update ${baseVersionStr} to ${highestPagesRouterReactVersion}. Is this file still referencing the React peer dependency version?`\n           )\n         )\n       } else {\n@@ -356,10 +378,10 @@ Or, run this command with no arguments to use the most recently published versio\n     const packageJson = await fsp.readFile(packageJsonPath, 'utf-8')\n     const manifest = JSON.parse(packageJson)\n     if (manifest.dependencies['react']) {\n-      manifest.dependencies['react'] = pagesRouterReactVersion\n+      manifest.dependencies['react'] = highestPagesRouterReactVersion\n     }\n     if (manifest.dependencies['react-dom']) {\n-      manifest.dependencies['react-dom'] = pagesRouterReactVersion\n+      manifest.dependencies['react-dom'] = highestPagesRouterReactVersion\n     }\n     await fsp.writeFile(\n       packageJsonPath,\n@@ -379,12 +401,10 @@ Or, run this command with no arguments to use the most recently published versio\n     const manifest = JSON.parse(packageJson)\n     // Need to specify last supported RC version to avoid breaking changes.\n     if (manifest.peerDependencies['react']) {\n-      manifest.peerDependencies['react'] =\n-        `^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ${pagesRouterReactVersion}`\n+      manifest.peerDependencies['react'] = pagesRouterReactVersion\n     }\n     if (manifest.peerDependencies['react-dom']) {\n-      manifest.peerDependencies['react-dom'] =\n-        `^18.2.0 || 19.0.0-rc-de68d2f4-20241204 || ${pagesRouterReactVersion}`\n+      manifest.peerDependencies['react-dom'] = pagesRouterReactVersion\n     }\n     await fsp.writeFile(\n       packageJsonPath,"
        },
        {
            "sha": "b60e79da7895779ddf259fbba7f0bcb3040ba6f8",
            "filename": "test/.stats-app/package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2F.stats-app%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2F.stats-app%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2F.stats-app%2Fpackage.json?ref=1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
            "patch": "@@ -4,8 +4,8 @@\n   \"license\": \"MIT\",\n   \"dependencies\": {\n     \"next\": \"latest\",\n-    \"react\": \"^19.0.0\",\n-    \"react-dom\": \"^19.0.0\"\n+    \"react\": \"19.1.0\",\n+    \"react-dom\": \"19.1.0\"\n   },\n   \"engines\": {\n     \"node\": \">=18.18.0\""
        },
        {
            "sha": "ece1a09d0be132b940a5c0ad1cb10a62561eea7a",
            "filename": "test/development/acceptance/hydration-error.test.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts?ref=1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
            "patch": "@@ -11,11 +11,6 @@ describe('Error overlay for hydration errors in Pages router', () => {\n   const { next } = nextTestSetup({\n     files: new FileRef(path.join(__dirname, 'fixtures', 'default-template')),\n     skipStart: true,\n-    // TODO: once Next.js minimal React version is 19.1, remove this override.\n-    dependencies: {\n-      react: isReact18 ? '^18.3.1' : '^19.1.0',\n-      'react-dom': isReact18 ? '^18.3.1' : '^19.1.0',\n-    },\n   })\n \n   it('includes a React docs link when hydration error does occur', async () => {"
        },
        {
            "sha": "ffdd279ec5ebecaf790537b712951d189b3f24de",
            "filename": "test/e2e/next-test/first-time-setup-js/package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2Fe2e%2Fnext-test%2Ffirst-time-setup-js%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2Fe2e%2Fnext-test%2Ffirst-time-setup-js%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-test%2Ffirst-time-setup-js%2Fpackage.json?ref=1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
            "patch": "@@ -8,7 +8,7 @@\n   },\n   \"dependencies\": {\n     \"next\": \"canary\",\n-    \"react\": \"^19.0.0\",\n-    \"react-dom\": \"^19.0.0\"\n+    \"react\": \"19.1.0\",\n+    \"react-dom\": \"19.1.0\"\n   }\n }"
        },
        {
            "sha": "2779abb8cbdeae167431a1fa6d57d0d881889ab6",
            "filename": "test/e2e/next-test/first-time-setup-ts/package.json",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2Fe2e%2Fnext-test%2Ffirst-time-setup-ts%2Fpackage.json",
            "raw_url": "https://github.com/vercel/next.js/raw/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2Fe2e%2Fnext-test%2Ffirst-time-setup-ts%2Fpackage.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fnext-test%2Ffirst-time-setup-ts%2Fpackage.json?ref=1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
            "patch": "@@ -8,8 +8,8 @@\n   },\n   \"dependencies\": {\n     \"next\": \"canary\",\n-    \"react\": \"^19.0.0\",\n-    \"react-dom\": \"^19.0.0\"\n+    \"react\": \"19.1.0\",\n+    \"react-dom\": \"19.1.0\"\n   },\n   \"devDependencies\": {\n     \"@types/react\": \"^18\","
        },
        {
            "sha": "8ff628d0eade5dca090bb3b259d79ce547147f19",
            "filename": "test/lib/next-modes/base.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2Flib%2Fnext-modes%2Fbase.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1ee500b01e0bb24a558a3e853a2ee88a28a1a275/test%2Flib%2Fnext-modes%2Fbase.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Flib%2Fnext-modes%2Fbase.ts?ref=1ee500b01e0bb24a558a3e853a2ee88a28a1a275",
            "patch": "@@ -58,7 +58,7 @@ type OmitFirstArgument<F> = F extends (\n \n // Do not rename or format. sync-react script relies on this line.\n // prettier-ignore\n-const nextjsReactPeerVersion = \"^19.0.0\";\n+const nextjsReactPeerVersion = \"19.1.0\";\n \n export class NextInstance {\n   protected files: ResolvedFileConfig"
        }
    ],
    "stats": {
        "total": 101,
        "additions": 58,
        "deletions": 43
    }
}