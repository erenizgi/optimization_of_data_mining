{
    "author": "unstubbable",
    "message": "[test] Unflake static image test (#84535)\n\n[flakiness\nmetric](https://app.datadoghq.com/ci/test/runs?query=test_level%3Atest%20%40git.repository.id%3A%22github.com%2Fvercel%2Fnext.js%22%20%40test.name%3A%22Static%20Image%20Component%20Tests%20development%20mode%20Should%20allow%20an%20image%20with%20a%20static%20src%20to%20omit%20height%20and%20width%22%20%40test.type%3A%22turbopack%22%20%40test.status%3A%22fail%22&agg_m=count&agg_m_source=base&agg_t=count&currentTab=overview&eventStack=&fromUser=false&index=citest&start=1759057503838&end=1759662303838&paused=false)\n\nI suspect that the test `Should allow an image with a static src to omit\nheight and width` is frequently failing with `waiting for\nlocator('#basic-static') to be visible` because the image is covered by\none of the images with a `fill` prop, which are rendered later in the\npage. This means that the image is not actually visible, even though it\nis in the DOM. Playwright then fails to find it. However, I wasn't able\nto reproduce this locally.\n\nThe fix is to wrap the `fill` images in a relatively positioned div with\na set height, so that they don't cover the other images.\n\n**Before:**\n\n<img width=\"490\" height=\"894\" alt=\"before\"\nsrc=\"https://github.com/user-attachments/assets/7632dc67-a649-42b7-8b62-a9a216632ec2\"\n/>\n\n**After:**\n\n<img width=\"490\" height=\"894\" alt=\"after\"\nsrc=\"https://github.com/user-attachments/assets/2d369e4d-ef08-47cc-bdc4-04ab94afcceb\"\n/>\n\n---------\n\nCo-authored-by: graphite-app[bot] <96075541+graphite-app[bot]@users.noreply.github.com>",
    "sha": "d796c0f20966482d3187923a145dafe9ff30cc08",
    "files": [
        {
            "sha": "76bd9f50f7651f87e30aea36f8d98c0d26409cf0",
            "filename": "test/integration/next-image-new/default/pages/static-img.js",
            "status": "modified",
            "additions": 43,
            "deletions": 15,
            "changes": 58,
            "blob_url": "https://github.com/vercel/next.js/blob/d796c0f20966482d3187923a145dafe9ff30cc08/test%2Fintegration%2Fnext-image-new%2Fdefault%2Fpages%2Fstatic-img.js",
            "raw_url": "https://github.com/vercel/next.js/raw/d796c0f20966482d3187923a145dafe9ff30cc08/test%2Fintegration%2Fnext-image-new%2Fdefault%2Fpages%2Fstatic-img.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fnext-image-new%2Fdefault%2Fpages%2Fstatic-img.js?ref=d796c0f20966482d3187923a145dafe9ff30cc08",
            "patch": "@@ -25,6 +25,16 @@ export const getStaticProps = () => ({\n   props: { testImgProp },\n })\n \n+function FillContainer({ children }) {\n+  // Optimized to accept the square test images. Subtracting 16px to account for\n+  // the default 8px body margin.\n+  return (\n+    <div style={{ position: 'relative', height: 'calc(100vw - 16px)' }}>\n+      {children}\n+    </div>\n+  )\n+}\n+\n const Page = ({ testImgProp }) => {\n   return (\n     <div>\n@@ -74,23 +84,41 @@ const Page = ({ testImgProp }) => {\n       <Image id=\"static-bmp\" src={testBMP} />\n       <Image id=\"static-ico\" src={testICO} />\n       <br />\n-      <Image id=\"static-svg-fill\" src={testSVG} fill />\n-      <Image id=\"static-gif-fill\" src={testGIF} fill />\n-      <Image id=\"static-bmp-fill\" src={testBMP} fill />\n-      <Image id=\"static-ico-fill\" src={testICO} fill />\n+      <FillContainer>\n+        <Image id=\"static-svg-fill\" src={testSVG} fill />\n+      </FillContainer>\n+      <FillContainer>\n+        <Image id=\"static-gif-fill\" src={testGIF} fill />\n+      </FillContainer>\n+      <FillContainer>\n+        <Image id=\"static-bmp-fill\" src={testBMP} fill />\n+      </FillContainer>\n+      <FillContainer>\n+        <Image id=\"static-ico-fill\" src={testICO} fill />\n+      </FillContainer>\n       <br />\n-      <Image id=\"blur-png-fill\" src={testPNG} placeholder=\"blur\" fill />\n-      <Image id=\"blur-jpg-fill\" src={testJPG} placeholder=\"blur\" fill />\n-      <Image id=\"blur-webp-fill\" src={testWEBP} placeholder=\"blur\" fill />\n-      <Image id=\"blur-avif-fill\" src={testAVIF} placeholder=\"blur\" fill />\n+      <FillContainer>\n+        <Image id=\"blur-png-fill\" src={testPNG} placeholder=\"blur\" fill />\n+      </FillContainer>\n+      <FillContainer>\n+        <Image id=\"blur-jpg-fill\" src={testJPG} placeholder=\"blur\" fill />\n+      </FillContainer>\n+      <FillContainer>\n+        <Image id=\"blur-webp-fill\" src={testWEBP} placeholder=\"blur\" fill />\n+      </FillContainer>\n+      <FillContainer>\n+        <Image id=\"blur-avif-fill\" src={testAVIF} placeholder=\"blur\" fill />\n+      </FillContainer>\n       <br />\n-      <Image\n-        id=\"blurdataurl-fill\"\n-        src=\"/test.jpg\"\n-        placeholder=\"blur\"\n-        blurDataURL={blurDataURL}\n-        fill\n-      />\n+      <FillContainer>\n+        <Image\n+          id=\"blurdataurl-fill\"\n+          src=\"/test.jpg\"\n+          placeholder=\"blur\"\n+          blurDataURL={blurDataURL}\n+          fill\n+        />\n+      </FillContainer>\n       <Image\n         id=\"blurdataurl-ratio\"\n         src=\"/test.png\""
        }
    ],
    "stats": {
        "total": 58,
        "additions": 43,
        "deletions": 15
    }
}