{
    "author": "eps1lon",
    "message": "[dev-overlay] Inject `getSquashedHydrationErrorDetails` implementation (#80046)\n\nSame as with `get*Stack` implementation",
    "sha": "0a87d7524624e73ae2adc120d87fba4f4fdf98c0",
    "files": [
        {
            "sha": "80110ed2b04584e5e7e2202013c51a49e858f030",
            "filename": "packages/next/src/client/components/react-dev-overlay/app/app-dev-overlay.tsx",
            "status": "modified",
            "additions": 10,
            "deletions": 1,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fapp%2Fapp-dev-overlay.tsx?ref=0a87d7524624e73ae2adc120d87fba4f4fdf98c0",
            "patch": "@@ -72,6 +72,11 @@ function ReplaySsrOnlyErrors({\n   return null\n }\n \n+function getSquashedHydrationErrorDetails() {\n+  // We don't squash hydration errors in the App Router.\n+  return null\n+}\n+\n export function AppDevOverlay({\n   state,\n   dispatch,\n@@ -99,7 +104,11 @@ export function AppDevOverlay({\n       <>\n         {/* Fonts can only be loaded outside the Shadow DOM. */}\n         <FontStyles />\n-        <DevOverlay state={state} dispatch={dispatch} />\n+        <DevOverlay\n+          state={state}\n+          dispatch={dispatch}\n+          getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n+        />\n       </>\n     </>\n   )"
        },
        {
            "sha": "1529529ce9289d7b998db3ea4208c09c19496e2a",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/hydration-error-state.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhydration-error-state.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhydration-error-state.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhydration-error-state.ts?ref=0a87d7524624e73ae2adc120d87fba4f4fdf98c0",
            "patch": "@@ -8,7 +8,7 @@ import {\n   isErrorMessageWithComponentStackDiff as isReact19HydrationWarning,\n } from '../../react-19-hydration-error'\n \n-type HydrationErrorState = {\n+export type HydrationErrorState = {\n   // Hydration warning template format: <message> <serverContent> <clientContent>\n   warning?: string\n   reactOutputComponentDiff?: string"
        },
        {
            "sha": "5709bd316ad593f5a2c29be97ae80a9bfe04e919",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/pages-dev-overlay.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fpages-dev-overlay.tsx?ref=0a87d7524624e73ae2adc120d87fba4f4fdf98c0",
            "patch": "@@ -2,6 +2,7 @@ import { PagesDevOverlayErrorBoundary } from './pages-dev-overlay-error-boundary\n import { usePagesDevOverlay } from './hooks'\n import { FontStyles } from '../font/font-styles'\n import { DevOverlay } from '../ui/dev-overlay'\n+import { getSquashedHydrationErrorDetails } from './hydration-error-state'\n \n export type ErrorType = 'runtime' | 'build'\n \n@@ -22,7 +23,11 @@ export function PagesDevOverlay({ children }: PagesDevOverlayProps) {\n \n       {/* Fonts can only be loaded outside the Shadow DOM. */}\n       <FontStyles />\n-      <DevOverlay state={state} dispatch={dispatch} />\n+      <DevOverlay\n+        state={state}\n+        dispatch={dispatch}\n+        getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n+      />\n     </>\n   )\n }"
        },
        {
            "sha": "a6593902c3cabf105dc58766bb8e3ab70bd7ac09",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay/error-overlay.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 0,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay%2Ferror-overlay.tsx?ref=0a87d7524624e73ae2adc120d87fba4f4fdf98c0",
            "patch": "@@ -9,6 +9,7 @@ import { BuildError } from '../../../container/build-error'\n import { Errors } from '../../../container/errors'\n import { useDelayedRender } from '../../../hooks/use-delayed-render'\n import type { ReadyRuntimeError } from '../../../../utils/get-error-by-type'\n+import type { HydrationErrorState } from '../../../../pages/hydration-error-state'\n \n const transitionDurationMs = 200\n \n@@ -23,11 +24,13 @@ export interface ErrorBaseProps {\n export function ErrorOverlay({\n   state,\n   dispatch,\n+  getSquashedHydrationErrorDetails,\n   runtimeErrors,\n   errorCount,\n }: {\n   state: OverlayState\n   dispatch: OverlayDispatch\n+  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n   runtimeErrors: ReadyRuntimeError[]\n   errorCount: number\n }) {\n@@ -74,6 +77,7 @@ export function ErrorOverlay({\n     <Errors\n       {...commonProps}\n       debugInfo={state.debugInfo}\n+      getSquashedHydrationErrorDetails={getSquashedHydrationErrorDetails}\n       runtimeErrors={runtimeErrors}\n       onClose={() => {\n         dispatch({ type: ACTION_ERROR_OVERLAY_CLOSE })"
        },
        {
            "sha": "70031ee92ab27fb08f05b3ac8435ef590d3bcc2a",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/container/errors.tsx",
            "status": "modified",
            "additions": 12,
            "deletions": 4,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx?ref=0a87d7524624e73ae2adc120d87fba4f4fdf98c0",
            "patch": "@@ -17,9 +17,10 @@ import {\n } from '../../../react-19-hydration-error'\n import type { ReadyRuntimeError } from '../../utils/get-error-by-type'\n import type { ErrorBaseProps } from '../components/errors/error-overlay/error-overlay'\n-import { getSquashedHydrationErrorDetails } from '../../pages/hydration-error-state'\n+import type { HydrationErrorState } from '../../pages/hydration-error-state'\n \n export interface ErrorsProps extends ErrorBaseProps {\n+  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n   runtimeErrors: ReadyRuntimeError[]\n   debugInfo: DebugInfo\n   onClose: () => void\n@@ -72,7 +73,10 @@ const noErrorDetails = {\n   notes: null,\n   reactOutputComponentDiff: null,\n }\n-function useErrorDetails(error: Error | undefined): {\n+function useErrorDetails(\n+  error: Error | undefined,\n+  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n+): {\n   hydrationWarning: string | null\n   notes: string | null\n   reactOutputComponentDiff: string | null\n@@ -106,10 +110,11 @@ function useErrorDetails(error: Error | undefined): {\n       notes,\n       reactOutputComponentDiff: diff,\n     }\n-  }, [error])\n+  }, [error, getSquashedHydrationErrorDetails])\n }\n \n export function Errors({\n+  getSquashedHydrationErrorDetails,\n   runtimeErrors,\n   debugInfo,\n   onClose,\n@@ -127,7 +132,10 @@ export function Errors({\n     () => runtimeErrors[activeIdx] ?? null,\n     [activeIdx, runtimeErrors]\n   )\n-  const errorDetails = useErrorDetails(activeError?.error)\n+  const errorDetails = useErrorDetails(\n+    activeError?.error,\n+    getSquashedHydrationErrorDetails\n+  )\n \n   if (isLoading) {\n     // TODO: better loading state"
        },
        {
            "sha": "ded4b633acf328861e233295dae143521fde7836",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 12,
            "deletions": 1,
            "changes": 13,
            "blob_url": "https://github.com/vercel/next.js/blob/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.stories.tsx?ref=0a87d7524624e73ae2adc120d87fba4f4fdf98c0",
            "patch": "@@ -102,6 +102,10 @@ function useOverlayReducer() {\n   }, initialState)\n }\n \n+function getNoSquashedHydrationErrorDetails() {\n+  return null\n+}\n+\n export const Default: Story = {\n   render: function DevOverlayStory() {\n     const [state, dispatch] = useOverlayReducer()\n@@ -115,7 +119,14 @@ export const Default: Story = {\n             objectFit: 'contain',\n           }}\n         />\n-        <DevOverlay state={state} dispatch={dispatch} />\n+        <DevOverlay\n+          state={state}\n+          dispatch={dispatch}\n+          getSquashedHydrationErrorDetails={\n+            // Testing like App Router where we no longer quash hydration errors\n+            getNoSquashedHydrationErrorDetails\n+          }\n+        />\n       </>\n     )\n   },"
        },
        {
            "sha": "d5304ccad2e4cf30f6c574f05f5dcc667230e997",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/dev-overlay.tsx",
            "status": "modified",
            "additions": 6,
            "deletions": 0,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/0a87d7524624e73ae2adc120d87fba4f4fdf98c0/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fdev-overlay.tsx?ref=0a87d7524624e73ae2adc120d87fba4f4fdf98c0",
            "patch": "@@ -10,13 +10,16 @@ import { DevToolsIndicator } from './components/errors/dev-tools-indicator/dev-t\n import { RenderError } from './container/runtime-error/render-error'\n import { DarkTheme } from './styles/dark-theme'\n import { useDevToolsScale } from './components/errors/dev-tools-indicator/dev-tools-info/preferences'\n+import type { HydrationErrorState } from '../pages/hydration-error-state'\n \n export function DevOverlay({\n   state,\n   dispatch,\n+  getSquashedHydrationErrorDetails,\n }: {\n   state: OverlayState\n   dispatch: OverlayDispatch\n+  getSquashedHydrationErrorDetails: (error: Error) => HydrationErrorState | null\n }) {\n   const [scale, setScale] = useDevToolsScale()\n   return (\n@@ -46,6 +49,9 @@ export function DevOverlay({\n               <ErrorOverlay\n                 state={state}\n                 dispatch={dispatch}\n+                getSquashedHydrationErrorDetails={\n+                  getSquashedHydrationErrorDetails\n+                }\n                 runtimeErrors={runtimeErrors}\n                 errorCount={totalErrorCount}\n               />"
        }
    ],
    "stats": {
        "total": 59,
        "additions": 51,
        "deletions": 8
    }
}