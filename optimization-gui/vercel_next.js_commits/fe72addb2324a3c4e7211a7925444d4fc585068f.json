{
    "author": "eps1lon",
    "message": "Fix watchmode for `taskr` tasks (#80020)",
    "sha": "fe72addb2324a3c4e7211a7925444d4fc585068f",
    "files": [
        {
            "sha": "ac39ad94122d9d3b2a7c1d94a5bff84530a11ed8",
            "filename": "packages/next/taskfile.js",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/fe72addb2324a3c4e7211a7925444d4fc585068f/packages%2Fnext%2Ftaskfile.js",
            "raw_url": "https://github.com/vercel/next.js/raw/fe72addb2324a3c4e7211a7925444d4fc585068f/packages%2Fnext%2Ftaskfile.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Ftaskfile.js?ref=fe72addb2324a3c4e7211a7925444d4fc585068f",
            "patch": "@@ -2835,11 +2835,21 @@ export async function build(task, opts) {\n }\n \n export async function generate_types(task, opts) {\n-  await execa(\n+  const watchmode = opts.dev\n+  const typesPromise = execa(\n     'pnpm',\n-    ['run', 'types', ...(opts.dev ? ['--watch', '--preserveWatchOutput'] : [])],\n+    [\n+      'run',\n+      'types',\n+      ...(watchmode ? ['--watch', '--preserveWatchOutput'] : []),\n+    ],\n     { stdio: 'inherit' }\n   )\n+  // In watch-mode the process never completes i.e. the Promise never resolve.\n+  // But taskr needs to know that it can start watching the files for the task it has to manually restart.\n+  if (!watchmode) {\n+    await typesPromise\n+  }\n }\n \n export async function check_error_codes(task, opts) {"
        }
    ],
    "stats": {
        "total": 14,
        "additions": 12,
        "deletions": 2
    }
}