{
    "author": "timneutkens",
    "message": "Development: Don't load hot-reloader-webpack when using Turbopack (#83621)\n\n## What?\n\nFollow-up to #83609. hot-reloader-webpack was imported from\nhot-reloader-turbopack, causing it to be loaded even when not used.",
    "sha": "5b1d8f8e589372393cfabf41758466a547b5b46b",
    "files": [
        {
            "sha": "9f53dffb09d9dd2fb280739e1dc075500c1db0fc",
            "filename": "packages/next/src/server/dev/hot-reloader-shared-utils.ts",
            "status": "added",
            "additions": 31,
            "deletions": 0,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/5b1d8f8e589372393cfabf41758466a547b5b46b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-shared-utils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5b1d8f8e589372393cfabf41758466a547b5b46b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-shared-utils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-shared-utils.ts?ref=5b1d8f8e589372393cfabf41758466a547b5b46b",
            "patch": "@@ -0,0 +1,31 @@\n+import { getPathMatch } from '../../shared/lib/router/utils/path-match'\n+import { parseVersionInfo, type VersionInfo } from './parse-version-info'\n+\n+export const matchNextPageBundleRequest = getPathMatch(\n+  '/_next/static/chunks/pages/:path*.js(\\\\.map|)'\n+)\n+export async function getVersionInfo(): Promise<VersionInfo> {\n+  let installed = '0.0.0'\n+\n+  try {\n+    installed = require('next/package.json').version\n+\n+    let res\n+\n+    try {\n+      // use NPM registry regardless user using Yarn\n+      res = await fetch('https://registry.npmjs.org/-/package/next/dist-tags')\n+    } catch {\n+      // ignore fetch errors\n+    }\n+\n+    if (!res || !res.ok) return { installed, staleness: 'unknown' }\n+\n+    const { latest, canary } = await res.json()\n+\n+    return parseVersionInfo({ installed, latest, canary })\n+  } catch (e: any) {\n+    console.error(e)\n+    return { installed, staleness: 'unknown' }\n+  }\n+}"
        },
        {
            "sha": "2253e0369df5690ce5c505e8213a21b5a2c6f7d8",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 4,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/5b1d8f8e589372393cfabf41758466a547b5b46b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5b1d8f8e589372393cfabf41758466a547b5b46b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=5b1d8f8e589372393cfabf41758466a547b5b46b",
            "patch": "@@ -26,10 +26,6 @@ import type {\n } from '../../build/swc/types'\n import { createDefineEnv } from '../../build/swc'\n import * as Log from '../../build/output/log'\n-import {\n-  getVersionInfo,\n-  matchNextPageBundleRequest,\n-} from './hot-reloader-webpack'\n import { BLOCKED_PAGES } from '../../shared/lib/constants'\n import {\n   getOverlayMiddleware,\n@@ -111,6 +107,10 @@ import {\n   deleteReactDebugChannel,\n   setReactDebugChannel,\n } from './debug-channel'\n+import {\n+  getVersionInfo,\n+  matchNextPageBundleRequest,\n+} from './hot-reloader-shared-utils'\n \n const wsServer = new ws.Server({ noServer: true })\n const isTestMode = !!("
        },
        {
            "sha": "6fded5ea30e7c513b7544c622dd993b231ad9502",
            "filename": "packages/next/src/server/dev/hot-reloader-webpack.ts",
            "status": "modified",
            "additions": 4,
            "deletions": 32,
            "changes": 36,
            "blob_url": "https://github.com/vercel/next.js/blob/5b1d8f8e589372393cfabf41758466a547b5b46b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/5b1d8f8e589372393cfabf41758466a547b5b46b/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts?ref=5b1d8f8e589372393cfabf41758466a547b5b46b",
            "patch": "@@ -42,7 +42,6 @@ import {\n   RSC_MODULE_TYPES,\n } from '../../shared/lib/constants'\n import type { __ApiPreviewProps } from '../api-utils'\n-import { getPathMatch } from '../../shared/lib/router/utils/path-match'\n import { findPageFile } from '../lib/find-page-file'\n import {\n   BUILDING,\n@@ -66,7 +65,6 @@ import { getProperError } from '../../lib/is-error'\n import ws from 'next/dist/compiled/ws'\n import { existsSync, promises as fs } from 'fs'\n import type { UnwrapPromise } from '../../lib/coalesced-function'\n-import { parseVersionInfo } from './parse-version-info'\n import type { VersionInfo } from './parse-version-info'\n import { isAPIRoute } from '../../lib/is-api-route'\n import { getRouteLoaderEntry } from '../../build/webpack/loaders/next-route-loader'\n@@ -102,6 +100,10 @@ import {\n   setReactDebugChannel,\n   type ReactDebugChannelForBrowser,\n } from './debug-channel'\n+import {\n+  getVersionInfo,\n+  matchNextPageBundleRequest,\n+} from './hot-reloader-shared-utils'\n \n const MILLISECONDS_IN_NANOSECOND = BigInt(1_000_000)\n \n@@ -163,10 +165,6 @@ function addCorsSupport(req: IncomingMessage, res: ServerResponse) {\n   return { preflight: false }\n }\n \n-export const matchNextPageBundleRequest = getPathMatch(\n-  '/_next/static/chunks/pages/:path*.js(\\\\.map|)'\n-)\n-\n // Iteratively look up the issuer till it ends up at the root\n function findEntryModule(\n   module: webpack.Module,\n@@ -209,32 +207,6 @@ function erroredPages(compilation: webpack.Compilation) {\n   return failedPages\n }\n \n-export async function getVersionInfo(): Promise<VersionInfo> {\n-  let installed = '0.0.0'\n-\n-  try {\n-    installed = require('next/package.json').version\n-\n-    let res\n-\n-    try {\n-      // use NPM registry regardless user using Yarn\n-      res = await fetch('https://registry.npmjs.org/-/package/next/dist-tags')\n-    } catch {\n-      // ignore fetch errors\n-    }\n-\n-    if (!res || !res.ok) return { installed, staleness: 'unknown' }\n-\n-    const { latest, canary } = await res.json()\n-\n-    return parseVersionInfo({ installed, latest, canary })\n-  } catch (e: any) {\n-    console.error(e)\n-    return { installed, staleness: 'unknown' }\n-  }\n-}\n-\n export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n   private hasAmpEntrypoints: boolean\n   private hasAppRouterEntrypoints: boolean"
        }
    ],
    "stats": {
        "total": 75,
        "additions": 39,
        "deletions": 36
    }
}