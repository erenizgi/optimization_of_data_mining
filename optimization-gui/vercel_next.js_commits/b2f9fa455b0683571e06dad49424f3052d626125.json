{
    "author": "acdlite",
    "message": "Fix: Rules of Hooks violation in AppRouter (#80623)\n\nThere's some sketchy logic in AppRouter that (intentionally) violates\nthe rules of hooks by reading an externally mutable condition. The\nrationalization is that it's OK to do this if the result is to\ninfinitely suspend the component.\n\nHowever, the mechanism used to infinitely suspend the component is\n`use(infinitePromise)` â€” this can lead to subtle bugs because even\nthough `use` can be called conditionally, it relies on the assumption\nthat its invocation is idempotent for the same props and state, i.e. you\nmust still follow the rules of React regarding mutability and side\neffects.\n\nIdeally we should refactor this block to not rely on external state at\nall, but in the meantime, we can switch from `use` to `throw` to suspend\nthe component, since `throw` is lower level and isn't modeled as a hook.",
    "sha": "b2f9fa455b0683571e06dad49424f3052d626125",
    "files": [
        {
            "sha": "a5c5757f9f61c697ab38df4947d70c43449f3fa1",
            "filename": "packages/next/src/client/components/app-router.tsx",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/b2f9fa455b0683571e06dad49424f3052d626125/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/b2f9fa455b0683571e06dad49424f3052d626125/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router.tsx?ref=b2f9fa455b0683571e06dad49424f3052d626125",
            "patch": "@@ -1,7 +1,6 @@\n 'use client'\n \n import React, {\n-  use,\n   useEffect,\n   useMemo,\n   startTransition,\n@@ -329,7 +328,10 @@ function Router({\n     // TODO-APP: Should we listen to navigateerror here to catch failed\n     // navigations somehow? And should we call window.stop() if a SPA navigation\n     // should interrupt an MPA one?\n-    use(unresolvedThenable)\n+    // NOTE: This is intentionally using `throw` instead of `use` because we're\n+    // inside an externally mutable condition (pushRef.mpaNavigation), which\n+    // violates the rules of hooks.\n+    throw unresolvedThenable\n   }\n \n   useEffect(() => {"
        }
    ],
    "stats": {
        "total": 6,
        "additions": 4,
        "deletions": 2
    }
}