{
    "author": "eps1lon",
    "message": "[dev-overlay] Stop squashing hydration related errors in App Router (#78140)",
    "sha": "96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
    "files": [
        {
            "sha": "8292fde4c8e09b391c731e04752e7407103acbfa",
            "filename": "packages/next/src/client/components/errors/attach-hydration-error-state.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 82,
            "changes": 82,
            "blob_url": "https://github.com/vercel/next.js/blob/abd0049f99517d1abbac279afc3b2c20014c3b54/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fattach-hydration-error-state.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/abd0049f99517d1abbac279afc3b2c20014c3b54/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fattach-hydration-error-state.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fattach-hydration-error-state.ts?ref=abd0049f99517d1abbac279afc3b2c20014c3b54",
            "patch": "@@ -1,82 +0,0 @@\n-import {\n-  getDefaultHydrationErrorMessage,\n-  getHydrationErrorStackInfo,\n-  isHydrationError,\n-  testReactHydrationWarning,\n-} from '../is-hydration-error'\n-import {\n-  hydrationErrorState,\n-  type HydrationErrorState,\n-} from './hydration-error-info'\n-\n-export function attachHydrationErrorState(error: Error) {\n-  let parsedHydrationErrorState: typeof hydrationErrorState = {}\n-  const isHydrationWarning = testReactHydrationWarning(error.message)\n-  const isHydrationRuntimeError = isHydrationError(error)\n-\n-  // If it's not hydration warnings or errors, skip\n-  if (!(isHydrationRuntimeError || isHydrationWarning)) {\n-    return\n-  }\n-\n-  const { message, diff } = getHydrationErrorStackInfo(error.message)\n-  if (message) {\n-    parsedHydrationErrorState = {\n-      ...((error as any).details as HydrationErrorState),\n-      ...hydrationErrorState,\n-      // If diff is present in error, we don't need to pick up the console logged warning.\n-      // - if hydration error has diff, and is not hydration diff log, then it's a normal hydration error.\n-      // - if hydration error no diff, then leverage the one from the hydration diff log.\n-\n-      warning: (diff && !isHydrationWarning\n-        ? null\n-        : hydrationErrorState.warning) || [\n-        getDefaultHydrationErrorMessage(),\n-        '',\n-        '',\n-      ],\n-      // When it's hydration diff log, do not show notes section.\n-      // This condition is only for the 1st squashed error.\n-      notes: isHydrationWarning ? '' : message,\n-      reactOutputComponentDiff: diff,\n-    }\n-    // Cache the `reactOutputComponentDiff` into hydrationErrorState.\n-    // This is only required for now when we still squashed the hydration diff log into hydration error.\n-    // Once the all error is logged to dev overlay in order, this will go away.\n-    if (!hydrationErrorState.reactOutputComponentDiff && diff) {\n-      hydrationErrorState.reactOutputComponentDiff = diff\n-    }\n-    // If it's hydration runtime error that doesn't contain the diff, combine the diff from the cached hydration diff.\n-    if (\n-      !diff &&\n-      isHydrationRuntimeError &&\n-      hydrationErrorState.reactOutputComponentDiff\n-    ) {\n-      parsedHydrationErrorState.reactOutputComponentDiff =\n-        hydrationErrorState.reactOutputComponentDiff\n-    }\n-  } else {\n-    // Normal runtime error, where it doesn't contain the hydration diff.\n-\n-    // If there's any extra information in the error message to display,\n-    // append it to the error message details property\n-    if (hydrationErrorState.warning) {\n-      // The patched console.error found hydration errors logged by React\n-      // Append the logged warning to the error message\n-      parsedHydrationErrorState = {\n-        ...(error as any).details,\n-        // It contains the warning, component stack, server and client tag names\n-        ...hydrationErrorState,\n-      }\n-    }\n-    // Consume the cached hydration diff.\n-    // This is only required for now when we still squashed the hydration diff log into hydration error.\n-    // Once the all error is logged to dev overlay in order, this will go away.\n-    if (hydrationErrorState.reactOutputComponentDiff) {\n-      parsedHydrationErrorState.reactOutputComponentDiff =\n-        hydrationErrorState.reactOutputComponentDiff\n-    }\n-  }\n-  // If it's a hydration error, store the hydration error state into the error object\n-  ;(error as any).details = parsedHydrationErrorState\n-}"
        },
        {
            "sha": "543d4f928da719ecc5ef4a4374004601ad39d7b2",
            "filename": "packages/next/src/client/components/errors/hydration-error-info.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 123,
            "changes": 123,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fhydration-error-info.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fhydration-error-info.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fhydration-error-info.ts?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -1,5 +1,3 @@\n-import { testReactHydrationWarning } from '../is-hydration-error'\n-\n export type HydrationErrorState = {\n   // Hydration warning template format: <message> <serverContent> <clientContent>\n   warning?: [string, string, string]\n@@ -51,124 +49,3 @@ const isHtmlTagsWarning = (message: string) => htmlTagsWarnings.has(message)\n \n const isTextInTagsMismatchWarning = (msg: string) =>\n   textAndTagsMismatchWarnings.has(msg)\n-\n-/**\n- * Patch console.error to capture hydration errors.\n- * If any of the knownHydrationWarnings are logged, store the message and component stack.\n- * When the hydration runtime error is thrown, the message and component stack are added to the error.\n- * This results in a more helpful error message in the error overlay.\n- */\n-\n-export function storeHydrationErrorStateFromConsoleArgs(...args: any[]) {\n-  let [msg, firstContent, secondContent, ...rest] = args\n-  if (testReactHydrationWarning(msg)) {\n-    // Some hydration warnings has 4 arguments, some has 3, fallback to the last argument\n-    // when the 3rd argument is not the component stack but an empty string\n-    const isReact18 = msg.startsWith('Warning: ')\n-\n-    // For some warnings, there's only 1 argument for template.\n-    // The second argument is the diff or component stack.\n-    if (args.length === 3) {\n-      secondContent = ''\n-    }\n-\n-    const warning: [string, string, string] = [\n-      // remove the last %s from the message\n-      msg,\n-      firstContent,\n-      secondContent,\n-    ]\n-\n-    const lastArg = (rest[rest.length - 1] || '').trim()\n-    if (!isReact18) {\n-      hydrationErrorState.reactOutputComponentDiff = lastArg\n-    } else {\n-      hydrationErrorState.reactOutputComponentDiff =\n-        generateHydrationDiffReact18(msg, firstContent, secondContent, lastArg)\n-    }\n-\n-    hydrationErrorState.warning = warning\n-    hydrationErrorState.serverContent = firstContent\n-    hydrationErrorState.clientContent = secondContent\n-  }\n-}\n-\n-/*\n- * Some hydration errors in React 18 does not have the diff in the error message.\n- * Instead it has the error stack trace which is component stack that we can leverage.\n- * Will parse the diff from the error stack trace\n- *  e.g.\n- *  Warning: Expected server HTML to contain a matching <div> in <p>.\n- *    at div\n- *    at p\n- *    at div\n- *    at div\n- *    at Page\n- *  output:\n- *    <Page>\n- *      <div>\n- *        <p>\n- *  >       <div>\n- *\n- */\n-function generateHydrationDiffReact18(\n-  message: string,\n-  firstContent: string,\n-  secondContent: string,\n-  lastArg: string\n-) {\n-  const componentStack = lastArg\n-  let firstIndex = -1\n-  let secondIndex = -1\n-  const hydrationWarningType = getHydrationWarningType(message)\n-\n-  // at div\\n at Foo\\n at Bar (....)\\n -> [div, Foo]\n-  const components = componentStack\n-    .split('\\n')\n-    // .reverse()\n-    .map((line: string, index: number) => {\n-      // `<space>at <component> (<location>)` -> `at <component> (<location>)`\n-      line = line.trim()\n-      // extract `<space>at <component>` to `<<component>>`\n-      // e.g. `  at Foo` -> `<Foo>`\n-      const [, component, location] = /at (\\w+)( \\((.*)\\))?/.exec(line) || []\n-      // If there's no location then it's user-land stack frame\n-      if (!location) {\n-        if (component === firstContent && firstIndex === -1) {\n-          firstIndex = index\n-        } else if (component === secondContent && secondIndex === -1) {\n-          secondIndex = index\n-        }\n-      }\n-      return location ? '' : component\n-    })\n-    .filter(Boolean)\n-    .reverse()\n-\n-  let diff = ''\n-  for (let i = 0; i < components.length; i++) {\n-    const component = components[i]\n-    const matchFirstContent =\n-      hydrationWarningType === 'tag' && i === components.length - firstIndex - 1\n-    const matchSecondContent =\n-      hydrationWarningType === 'tag' &&\n-      i === components.length - secondIndex - 1\n-    if (matchFirstContent || matchSecondContent) {\n-      const spaces = ' '.repeat(Math.max(i * 2 - 2, 0) + 2)\n-      diff += `> ${spaces}<${component}>\\n`\n-    } else {\n-      const spaces = ' '.repeat(i * 2 + 2)\n-      diff += `${spaces}<${component}>\\n`\n-    }\n-  }\n-  if (hydrationWarningType === 'text') {\n-    const spaces = ' '.repeat(components.length * 2)\n-    diff += `+ ${spaces}\"${firstContent}\"\\n`\n-    diff += `- ${spaces}\"${secondContent}\"\\n`\n-  } else if (hydrationWarningType === 'text-in-tag') {\n-    const spaces = ' '.repeat(components.length * 2)\n-    diff += `> ${spaces}<${secondContent}>\\n`\n-    diff += `>   ${spaces}\"${firstContent}\"\\n`\n-  }\n-  return diff\n-}"
        },
        {
            "sha": "9bbbca6081f4ce57cefc7125a3af90972187fbf8",
            "filename": "packages/next/src/client/components/errors/use-error-handler.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 7,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fuse-error-handler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fuse-error-handler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Ferrors%2Fuse-error-handler.ts?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -1,7 +1,5 @@\n import { useEffect } from 'react'\n-import { attachHydrationErrorState } from './attach-hydration-error-state'\n import { isNextRouterError } from '../is-next-router-error'\n-import { storeHydrationErrorStateFromConsoleArgs } from './hydration-error-info'\n import { formatConsoleArgs, parseConsoleArgs } from '../../lib/console'\n import isError from '../../../lib/is-error'\n import { createConsoleError } from './console-error'\n@@ -33,9 +31,6 @@ export function handleConsoleError(\n   }\n   error = getReactStitchedError(error)\n \n-  storeHydrationErrorStateFromConsoleArgs(...consoleErrorArgs)\n-  attachHydrationErrorState(error)\n-\n   errorQueue.push(error)\n   for (const handler of errorHandlers) {\n     // Delayed the error being passed to React Dev Overlay,\n@@ -57,8 +52,6 @@ export function handleClientError(originError: unknown) {\n   }\n   error = getReactStitchedError(error)\n \n-  attachHydrationErrorState(error)\n-\n   errorQueue.push(error)\n   for (const handler of errorHandlers) {\n     // Delayed the error being passed to React Dev Overlay,"
        },
        {
            "sha": "acb6850f56423f792b137e422a54f9c27510ced8",
            "filename": "packages/next/src/client/components/is-hydration-error.ts",
            "status": "removed",
            "additions": 0,
            "deletions": 100,
            "changes": 100,
            "blob_url": "https://github.com/vercel/next.js/blob/abd0049f99517d1abbac279afc3b2c20014c3b54/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fis-hydration-error.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/abd0049f99517d1abbac279afc3b2c20014c3b54/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fis-hydration-error.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fis-hydration-error.ts?ref=abd0049f99517d1abbac279afc3b2c20014c3b54",
            "patch": "@@ -1,100 +0,0 @@\n-import isError from '../../lib/is-error'\n-\n-const hydrationErrorRegex =\n-  /hydration failed|while hydrating|content does not match|did not match|HTML didn't match|text didn't match/i\n-\n-const reactUnifiedMismatchWarning = `Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:`\n-\n-const reactHydrationStartMessages = [\n-  reactUnifiedMismatchWarning,\n-  `Hydration failed because the server rendered text didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:`,\n-  `A tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used:`,\n-]\n-\n-export const REACT_HYDRATION_ERROR_LINK =\n-  'https://react.dev/link/hydration-mismatch'\n-export const NEXTJS_HYDRATION_ERROR_LINK =\n-  'https://nextjs.org/docs/messages/react-hydration-error'\n-\n-export const getDefaultHydrationErrorMessage = () => {\n-  return reactUnifiedMismatchWarning\n-}\n-\n-export function isHydrationError(error: unknown): boolean {\n-  return isError(error) && hydrationErrorRegex.test(error.message)\n-}\n-\n-export function isReactHydrationErrorMessage(msg: string): boolean {\n-  return reactHydrationStartMessages.some((prefix) => msg.startsWith(prefix))\n-}\n-\n-const hydrationWarningRegexes = [\n-  /^In HTML, (.+?) cannot be a child of <(.+?)>\\.(.*)\\nThis will cause a hydration error\\.(.*)/,\n-  /^In HTML, (.+?) cannot be a descendant of <(.+?)>\\.\\nThis will cause a hydration error\\.(.*)/,\n-  /^In HTML, text nodes cannot be a child of <(.+?)>\\.\\nThis will cause a hydration error\\./,\n-  /^In HTML, whitespace text nodes cannot be a child of <(.+?)>\\. Make sure you don't have any extra whitespace between tags on each line of your source code\\.\\nThis will cause a hydration error\\./,\n-  /^Expected server HTML to contain a matching <(.+?)> in <(.+?)>\\.(.*)/,\n-  /^Did not expect server HTML to contain a <(.+?)> in <(.+?)>\\.(.*)/,\n-  /^Expected server HTML to contain a matching text node for \"(.+?)\" in <(.+?)>\\.(.*)/,\n-  /^Did not expect server HTML to contain the text node \"(.+?)\" in <(.+?)>\\.(.*)/,\n-  /^Text content did not match\\. Server: \"(.+?)\" Client: \"(.+?)\"(.*)/,\n-]\n-\n-export function testReactHydrationWarning(msg: string): boolean {\n-  if (typeof msg !== 'string' || !msg) return false\n-  // React 18 has the `Warning: ` prefix.\n-  // React 19 does not.\n-  if (msg.startsWith('Warning: ')) {\n-    msg = msg.slice('Warning: '.length)\n-  }\n-  return hydrationWarningRegexes.some((regex) => regex.test(msg))\n-}\n-\n-export function getHydrationErrorStackInfo(rawMessage: string): {\n-  message: string | null\n-  diff?: string\n-} {\n-  rawMessage = rawMessage.replace(/^Error: /, '')\n-  rawMessage = rawMessage.replace('Warning: ', '')\n-  const isReactHydrationWarning = testReactHydrationWarning(rawMessage)\n-\n-  if (!isReactHydrationErrorMessage(rawMessage) && !isReactHydrationWarning) {\n-    return {\n-      message: null,\n-      diff: '',\n-    }\n-  }\n-\n-  if (isReactHydrationWarning) {\n-    const [message, diffLog] = rawMessage.split('\\n\\n')\n-    return {\n-      message: message.trim(),\n-      diff: (diffLog || '').trim(),\n-    }\n-  }\n-\n-  const firstLineBreak = rawMessage.indexOf('\\n')\n-  rawMessage = rawMessage.slice(firstLineBreak + 1).trim()\n-\n-  const [message, trailing] = rawMessage.split(`${REACT_HYDRATION_ERROR_LINK}`)\n-  const trimmedMessage = message.trim()\n-  // React built-in hydration diff starts with a newline, checking if length is > 1\n-  if (trailing && trailing.length > 1) {\n-    const diffs: string[] = []\n-    trailing.split('\\n').forEach((line) => {\n-      if (line.trim() === '') return\n-      if (!line.trim().startsWith('at ')) {\n-        diffs.push(line)\n-      }\n-    })\n-\n-    return {\n-      message: trimmedMessage,\n-      diff: diffs.join('\\n'),\n-    }\n-  } else {\n-    return {\n-      message: trimmedMessage,\n-    }\n-  }\n-}"
        },
        {
            "sha": "0f3b75cbb7015d97defe9d51cbb0a6fe07d8f44d",
            "filename": "packages/next/src/client/components/react-19-hydration-error.ts",
            "status": "added",
            "additions": 79,
            "deletions": 0,
            "changes": 79,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-19-hydration-error.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-19-hydration-error.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-19-hydration-error.ts?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -0,0 +1,79 @@\n+export const REACT_HYDRATION_ERROR_LINK =\n+  'https://react.dev/link/hydration-mismatch'\n+export const NEXTJS_HYDRATION_ERROR_LINK =\n+  'https://nextjs.org/docs/messages/react-hydration-error'\n+\n+/**\n+ * Only React 19+ contains component stack diff in the error message\n+ */\n+const errorMessagesWithComponentStackDiff = [\n+  /^In HTML, (.+?) cannot be a child of <(.+?)>\\.(.*)\\nThis will cause a hydration error\\.(.*)/,\n+  /^In HTML, (.+?) cannot be a descendant of <(.+?)>\\.\\nThis will cause a hydration error\\.(.*)/,\n+  /^In HTML, text nodes cannot be a child of <(.+?)>\\.\\nThis will cause a hydration error\\./,\n+  /^In HTML, whitespace text nodes cannot be a child of <(.+?)>\\. Make sure you don't have any extra whitespace between tags on each line of your source code\\.\\nThis will cause a hydration error\\./,\n+]\n+\n+export function isHydrationError(error: Error): boolean {\n+  return (\n+    isErrorMessageWithComponentStackDiff(error.message) ||\n+    /Hydration failed because the server rendered (text|HTML) didn't match the client\\./.test(\n+      error.message\n+    ) ||\n+    /A tree hydrated but some attributes of the server rendered HTML didn't match the client properties./.test(\n+      error.message\n+    )\n+  )\n+}\n+\n+export function isErrorMessageWithComponentStackDiff(msg: string): boolean {\n+  return errorMessagesWithComponentStackDiff.some((regex) => regex.test(msg))\n+}\n+\n+export function getHydrationErrorStackInfo(error: Error): {\n+  message: string | null\n+  notes: string | null\n+  diff: string | null\n+} {\n+  const errorMessage = error.message\n+  if (isErrorMessageWithComponentStackDiff(errorMessage)) {\n+    const [message, diffLog = ''] = errorMessage.split('\\n\\n')\n+    const diff = diffLog.trim()\n+    return {\n+      message: diff === '' ? errorMessage.trim() : message.trim(),\n+      diff,\n+      notes: null,\n+    }\n+  }\n+\n+  const [message, maybeComponentStackDiff] = errorMessage.split(\n+    `${REACT_HYDRATION_ERROR_LINK}`\n+  )\n+  const trimmedMessage = message.trim()\n+  // React built-in hydration diff starts with a newline\n+  if (\n+    maybeComponentStackDiff !== undefined &&\n+    maybeComponentStackDiff.length > 1\n+  ) {\n+    const diffs: string[] = []\n+    maybeComponentStackDiff.split('\\n').forEach((line) => {\n+      if (line.trim() === '') return\n+      if (!line.trim().startsWith('at ')) {\n+        diffs.push(line)\n+      }\n+    })\n+\n+    const [displayedMessage, ...notes] = trimmedMessage.split('\\n\\n')\n+    return {\n+      message: displayedMessage,\n+      diff: diffs.join('\\n'),\n+      notes: notes.join('\\n\\n') || null,\n+    }\n+  } else {\n+    const [displayedMessage, ...notes] = trimmedMessage.split('\\n\\n')\n+    return {\n+      message: displayedMessage,\n+      diff: null,\n+      notes: notes.join('\\n\\n'),\n+    }\n+  }\n+}"
        },
        {
            "sha": "3379eae1b959bd57d5999c145f33afa14e72a669",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/client.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 4,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fclient.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fclient.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fclient.ts?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -1,7 +1,10 @@\n import * as Bus from './bus'\n import { parseStack } from '../utils/parse-stack'\n import { parseComponentStack } from '../utils/parse-component-stack'\n-import { storeHydrationErrorStateFromConsoleArgs } from '../../errors/hydration-error-info'\n+import {\n+  attachHydrationErrorState,\n+  storeHydrationErrorStateFromConsoleArgs,\n+} from './hydration-error-state'\n import {\n   ACTION_BEFORE_REFRESH,\n   ACTION_BUILD_ERROR,\n@@ -14,7 +17,6 @@ import {\n   ACTION_VERSION_INFO,\n } from '../shared'\n import type { VersionInfo } from '../../../../server/dev/parse-version-info'\n-import { attachHydrationErrorState } from '../../errors/attach-hydration-error-state'\n import { getComponentStack, getOwnerStack } from '../../errors/stitched-error'\n import type { DevIndicatorServerState } from '../../../../server/dev/dev-indicator-server-state'\n \n@@ -53,9 +55,10 @@ function handleError(error: unknown) {\n let origConsoleError = console.error\n function nextJsHandleConsoleError(...args: any[]) {\n   // See https://github.com/facebook/react/blob/d50323eb845c5fde0d720cae888bf35dedd05506/packages/react-reconciler/src/ReactFiberErrorLogger.js#L78\n-  const error = process.env.NODE_ENV !== 'production' ? args[1] : args[0]\n+  const maybeError = process.env.NODE_ENV !== 'production' ? args[1] : args[0]\n   storeHydrationErrorStateFromConsoleArgs(...args)\n-  handleError(error)\n+  // TODO: Surfaces non-errors logged via `console.error`.\n+  handleError(maybeError)\n   origConsoleError.apply(window.console, args)\n }\n "
        },
        {
            "sha": "85919f946f085f98fec93f24cf36c6cc6e2fb8c0",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/hydration-error-state.ts",
            "status": "added",
            "additions": 190,
            "deletions": 0,
            "changes": 190,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhydration-error-state.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhydration-error-state.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Fhydration-error-state.ts?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -0,0 +1,190 @@\n+import {\n+  getHydrationWarningType,\n+  isHydrationError as isReact18HydrationError,\n+  isHydrationWarning as isReact18HydrationWarning,\n+} from './react-18-hydration-error-info'\n+import {\n+  isHydrationError as isReact19HydrationError,\n+  isErrorMessageWithComponentStackDiff as isReact19HydrationWarning,\n+} from '../../react-19-hydration-error'\n+\n+type HydrationErrorState = {\n+  // Hydration warning template format: <message> <serverContent> <clientContent>\n+  warning?: string\n+  reactOutputComponentDiff?: string\n+}\n+// We only need this for React 18 or hydration console errors in React 19.\n+// Once we surface console.error in the dev overlay in pages router, we should only\n+// use this for React 18.\n+let hydrationErrorState: HydrationErrorState = {}\n+\n+const squashedHydrationErrorDetails = new WeakMap<Error, HydrationErrorState>()\n+\n+export function getSquashedHydrationErrorDetails(\n+  error: Error\n+): HydrationErrorState | null {\n+  return squashedHydrationErrorDetails.has(error)\n+    ? squashedHydrationErrorDetails.get(error)!\n+    : null\n+}\n+\n+export function attachHydrationErrorState(error: Error) {\n+  if (!isReact18HydrationError(error) && !isReact19HydrationError(error)) {\n+    return\n+  }\n+\n+  let parsedHydrationErrorState: typeof hydrationErrorState = {}\n+\n+  // If there's any extra information in the error message to display,\n+  // append it to the error message details property\n+  if (hydrationErrorState.warning) {\n+    // The patched console.error found hydration errors logged by React\n+    // Append the logged warning to the error message\n+    parsedHydrationErrorState = {\n+      // It contains the warning, component stack, server and client tag names\n+      ...hydrationErrorState,\n+    }\n+\n+    // Consume the cached hydration diff.\n+    // This is only required for now when we still squashed the hydration diff log into hydration error.\n+    // Once the all error is logged to dev overlay in order, this will go away.\n+    if (hydrationErrorState.reactOutputComponentDiff) {\n+      parsedHydrationErrorState.reactOutputComponentDiff =\n+        hydrationErrorState.reactOutputComponentDiff\n+    }\n+\n+    squashedHydrationErrorDetails.set(error, parsedHydrationErrorState)\n+  }\n+}\n+\n+// TODO: Only handle React 18. Once we surface console.error in the dev overlay in pages router,\n+// we can use the same behavior as App Router.\n+export function storeHydrationErrorStateFromConsoleArgs(...args: any[]) {\n+  let [message, firstContent, secondContent, ...rest] = args\n+  if (isReact18HydrationWarning(message)) {\n+    // Some hydration warnings has 4 arguments, some has 3, fallback to the last argument\n+    // when the 3rd argument is not the component stack but an empty string\n+    // For some warnings, there's only 1 argument for template.\n+    // The second argument is the diff or component stack.\n+    if (args.length === 3) {\n+      secondContent = ''\n+    }\n+\n+    const warning = message\n+      .replace(/Warning: /, '')\n+      .replace('%s', firstContent)\n+      .replace('%s', secondContent)\n+      // remove the last %s from the message\n+      .replace(/%s/g, '')\n+\n+    const lastArg = (rest[rest.length - 1] || '').trim()\n+\n+    hydrationErrorState.reactOutputComponentDiff = generateHydrationDiffReact18(\n+      message,\n+      firstContent,\n+      secondContent,\n+      lastArg\n+    )\n+\n+    hydrationErrorState.warning = warning\n+  } else if (isReact19HydrationWarning(message)) {\n+    // Some hydration warnings has 4 arguments, some has 3, fallback to the last argument\n+    // when the 3rd argument is not the component stack but an empty string\n+    // For some warnings, there's only 1 argument for template.\n+    // The second argument is the diff or component stack.\n+    if (args.length === 3) {\n+      secondContent = ''\n+    }\n+\n+    const warning = message\n+      .replace('%s', firstContent)\n+      .replace('%s', secondContent)\n+      // remove the last %s from the message\n+      .replace(/%s/g, '')\n+\n+    const lastArg = (args[args.length - 1] || '').trim()\n+\n+    hydrationErrorState.reactOutputComponentDiff = lastArg\n+    hydrationErrorState.warning = warning\n+  }\n+}\n+\n+/*\n+ * Some hydration errors in React 18 does not have the diff in the error message.\n+ * Instead it has the error stack trace which is component stack that we can leverage.\n+ * Will parse the diff from the error stack trace\n+ *  e.g.\n+ *  Warning: Expected server HTML to contain a matching <div> in <p>.\n+ *    at div\n+ *    at p\n+ *    at div\n+ *    at div\n+ *    at Page\n+ *  output:\n+ *    <Page>\n+ *      <div>\n+ *        <p>\n+ *  >       <div>\n+ *\n+ */\n+function generateHydrationDiffReact18(\n+  message: string,\n+  firstContent: string,\n+  secondContent: string,\n+  lastArg: string\n+) {\n+  const componentStack = lastArg\n+  let firstIndex = -1\n+  let secondIndex = -1\n+  const hydrationWarningType = getHydrationWarningType(message)\n+\n+  // at div\\n at Foo\\n at Bar (....)\\n -> [div, Foo]\n+  const components = componentStack\n+    .split('\\n')\n+    // .reverse()\n+    .map((line: string, index: number) => {\n+      // `<space>at <component> (<location>)` -> `at <component> (<location>)`\n+      line = line.trim()\n+      // extract `<space>at <component>` to `<<component>>`\n+      // e.g. `  at Foo` -> `<Foo>`\n+      const [, component, location] = /at (\\w+)( \\((.*)\\))?/.exec(line) || []\n+      // If there's no location then it's user-land stack frame\n+      if (!location) {\n+        if (component === firstContent && firstIndex === -1) {\n+          firstIndex = index\n+        } else if (component === secondContent && secondIndex === -1) {\n+          secondIndex = index\n+        }\n+      }\n+      return location ? '' : component\n+    })\n+    .filter(Boolean)\n+    .reverse()\n+\n+  let diff = ''\n+  for (let i = 0; i < components.length; i++) {\n+    const component = components[i]\n+    const matchFirstContent =\n+      hydrationWarningType === 'tag' && i === components.length - firstIndex - 1\n+    const matchSecondContent =\n+      hydrationWarningType === 'tag' &&\n+      i === components.length - secondIndex - 1\n+    if (matchFirstContent || matchSecondContent) {\n+      const spaces = ' '.repeat(Math.max(i * 2 - 2, 0) + 2)\n+      diff += `> ${spaces}<${component}>\\n`\n+    } else {\n+      const spaces = ' '.repeat(i * 2 + 2)\n+      diff += `${spaces}<${component}>\\n`\n+    }\n+  }\n+  if (hydrationWarningType === 'text') {\n+    const spaces = ' '.repeat(components.length * 2)\n+    diff += `+ ${spaces}\"${firstContent}\"\\n`\n+    diff += `- ${spaces}\"${secondContent}\"\\n`\n+  } else if (hydrationWarningType === 'text-in-tag') {\n+    const spaces = ' '.repeat(components.length * 2)\n+    diff += `> ${spaces}<${secondContent}>\\n`\n+    diff += `>   ${spaces}\"${firstContent}\"\\n`\n+  }\n+  return diff\n+}"
        },
        {
            "sha": "ad213107aad279924643fe2bb1abf5487dd1f0c0",
            "filename": "packages/next/src/client/components/react-dev-overlay/pages/react-18-hydration-error-info.ts",
            "status": "added",
            "additions": 61,
            "deletions": 0,
            "changes": 61,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Freact-18-hydration-error-info.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Freact-18-hydration-error-info.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fpages%2Freact-18-hydration-error-info.ts?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -0,0 +1,61 @@\n+import isError from '../../../../lib/is-error'\n+\n+export function isHydrationError(error: unknown): boolean {\n+  return (\n+    isError(error) &&\n+    (error.message ===\n+      'Hydration failed because the initial UI does not match what was rendered on the server.' ||\n+      error.message === 'Text content does not match server-rendered HTML.')\n+  )\n+}\n+\n+export function isHydrationWarning(message: unknown): message is string {\n+  return (\n+    isHtmlTagsWarning(message) ||\n+    isTextInTagsMismatchWarning(message) ||\n+    isTextWarning(message)\n+  )\n+}\n+\n+type NullableText = string | null | undefined\n+\n+// https://github.com/facebook/react/blob/main/packages/react-dom/src/__tests__/ReactDOMHydrationDiff-test.js used as a reference\n+const htmlTagsWarnings = new Set([\n+  'Warning: Expected server HTML to contain a matching <%s> in <%s>.%s',\n+  'Warning: Did not expect server HTML to contain a <%s> in <%s>.%s',\n+])\n+const textAndTagsMismatchWarnings = new Set([\n+  'Warning: Expected server HTML to contain a matching text node for \"%s\" in <%s>.%s',\n+  'Warning: Did not expect server HTML to contain the text node \"%s\" in <%s>.%s',\n+])\n+const textWarnings = new Set([\n+  'Warning: Text content did not match. Server: \"%s\" Client: \"%s\"%s',\n+])\n+\n+export const getHydrationWarningType = (\n+  message: NullableText\n+): 'tag' | 'text' | 'text-in-tag' => {\n+  if (typeof message !== 'string') {\n+    // TODO: Doesn't make sense to treat no message as a hydration error message.\n+    // We should bail out somewhere earlier.\n+    return 'text'\n+  }\n+\n+  const normalizedMessage = message.startsWith('Warning: ')\n+    ? message\n+    : `Warning: ${message}`\n+\n+  if (isHtmlTagsWarning(normalizedMessage)) return 'tag'\n+  if (isTextInTagsMismatchWarning(normalizedMessage)) return 'text-in-tag'\n+\n+  return 'text'\n+}\n+\n+const isHtmlTagsWarning = (message: unknown) =>\n+  typeof message === 'string' && htmlTagsWarnings.has(message)\n+\n+const isTextInTagsMismatchWarning = (msg: unknown) =>\n+  typeof msg === 'string' && textAndTagsMismatchWarnings.has(msg)\n+\n+const isTextWarning = (msg: unknown) =>\n+  typeof msg === 'string' && textWarnings.has(msg)"
        },
        {
            "sha": "f1a4b1820591a9de618126c70316bcc4a98d8e2e",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/components/errors/error-overlay-toolbar/docs-link-button.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-toolbar%2Fdocs-link-button.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-toolbar%2Fdocs-link-button.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcomponents%2Ferrors%2Ferror-overlay-toolbar%2Fdocs-link-button.tsx?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -1,7 +1,7 @@\n import {\n   NEXTJS_HYDRATION_ERROR_LINK,\n   REACT_HYDRATION_ERROR_LINK,\n-} from '../../../../../is-hydration-error'\n+} from '../../../../../react-19-hydration-error'\n import { parseUrlFromText } from '../../../utils/parse-url-from-text'\n \n const docsURLAllowlist = ['https://nextjs.org', 'https://react.dev']"
        },
        {
            "sha": "0cb40026e4946106259eac555cd9e6f1dc4f71ed",
            "filename": "packages/next/src/client/components/react-dev-overlay/ui/container/errors.tsx",
            "status": "modified",
            "additions": 68,
            "deletions": 38,
            "changes": 106,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fui%2Fcontainer%2Ferrors.tsx?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -5,7 +5,6 @@ import { RuntimeError } from './runtime-error'\n import { getErrorSource } from '../../../../../shared/lib/error-source'\n import { HotlinkedText } from '../components/hot-linked-text'\n import { PseudoHtmlDiff } from './runtime-error/component-stack-pseudo-html'\n-import type { HydrationErrorState } from '../../../errors/hydration-error-info'\n import {\n   isConsoleError,\n   getConsoleErrorType,\n@@ -15,9 +14,14 @@ import {\n   ErrorOverlayLayout,\n   type ErrorOverlayLayoutProps,\n } from '../components/errors/error-overlay-layout/error-overlay-layout'\n-import { NEXTJS_HYDRATION_ERROR_LINK } from '../../../is-hydration-error'\n+import {\n+  getHydrationErrorStackInfo,\n+  isHydrationError,\n+  NEXTJS_HYDRATION_ERROR_LINK,\n+} from '../../../react-19-hydration-error'\n import type { ReadyRuntimeError } from '../../utils/get-error-by-type'\n import type { ErrorBaseProps } from '../components/errors/error-overlay/error-overlay'\n+import { getSquashedHydrationErrorDetails } from '../../pages/hydration-error-state'\n \n export interface ErrorsProps extends ErrorBaseProps {\n   runtimeErrors: ReadyRuntimeError[]\n@@ -31,23 +35,18 @@ function isNextjsLink(text: string): boolean {\n   return text.startsWith('https://nextjs.org')\n }\n \n-function ErrorDescription({\n-  error,\n-  hydrationWarning,\n-}: {\n-  error: Error\n-  hydrationWarning: string | null\n-}) {\n+function HydrationErrorDescription({ message }: { message: string }) {\n+  return <HotlinkedText text={message} matcher={isNextjsLink} />\n+}\n+\n+function GenericErrorDescription({ error }: { error: Error }) {\n   const unhandledErrorType = isConsoleError(error)\n     ? getConsoleErrorType(error)\n     : null\n   const isConsoleErrorStringMessage = unhandledErrorType === 'string'\n-  // If the error is:\n-  // - hydration warning\n-  // - captured console error or unhandled rejection\n-  // skip displaying the error name\n-  const title =\n-    isConsoleErrorStringMessage || hydrationWarning ? '' : error.name + ': '\n+  // Displaying Error: would be redundant for console.error(message)\n+  // since we already have the label\n+  const title = isConsoleErrorStringMessage ? '' : error.name + ': '\n \n   const environmentName =\n     'environmentName' in error ? error.environmentName : ''\n@@ -63,10 +62,7 @@ function ErrorDescription({\n   return (\n     <>\n       {title}\n-      <HotlinkedText\n-        text={hydrationWarning || message}\n-        matcher={isNextjsLink}\n-      />\n+      <HotlinkedText text={message} matcher={isNextjsLink} />\n     </>\n   )\n }\n@@ -78,6 +74,48 @@ function getErrorType(error: Error): ErrorOverlayLayoutProps['errorType'] {\n   return 'Runtime Error'\n }\n \n+const noErrorDetails = {\n+  hydrationWarning: null,\n+  notes: null,\n+  reactOutputComponentDiff: null,\n+}\n+function useErrorDetails(error: Error | undefined): {\n+  hydrationWarning: string | null\n+  notes: string | null\n+  reactOutputComponentDiff: string | null\n+} {\n+  return useMemo(() => {\n+    if (error === undefined) {\n+      return noErrorDetails\n+    }\n+\n+    const pagesRouterErrorDetails = getSquashedHydrationErrorDetails(error)\n+    if (pagesRouterErrorDetails !== null) {\n+      return {\n+        hydrationWarning: pagesRouterErrorDetails.warning ?? null,\n+        notes: null,\n+        reactOutputComponentDiff:\n+          pagesRouterErrorDetails.reactOutputComponentDiff ?? null,\n+      }\n+    }\n+\n+    if (!isHydrationError(error)) {\n+      return noErrorDetails\n+    }\n+\n+    const { message, notes, diff } = getHydrationErrorStackInfo(error)\n+    if (message === null) {\n+      return noErrorDetails\n+    }\n+\n+    return {\n+      hydrationWarning: message,\n+      notes,\n+      reactOutputComponentDiff: diff,\n+    }\n+  }, [error])\n+}\n+\n export function Errors({\n   runtimeErrors,\n   debugInfo,\n@@ -108,6 +146,7 @@ export function Errors({\n     () => runtimeErrors[activeIdx] ?? null,\n     [activeIdx, runtimeErrors]\n   )\n+  const errorDetails = useErrorDetails(activeError?.error)\n \n   if (isLoading) {\n     // TODO: better loading state\n@@ -123,21 +162,10 @@ export function Errors({\n     getErrorSource(error) || ''\n   )\n   const errorType = getErrorType(error)\n-  const errorDetails: HydrationErrorState = (error as any).details || {}\n-  const notes = errorDetails.notes || ''\n-  const [warningTemplate, serverContent, clientContent] =\n-    errorDetails.warning || [null, '', '']\n-\n-  const hydrationWarning = warningTemplate\n-    ? warningTemplate\n-        .replace('%s', serverContent)\n-        .replace('%s', clientContent)\n-        .replace('%s', '') // remove the %s for stack\n-        .replace(/%s$/, '') // If there's still a %s at the end, remove it\n-        .replace(/^Warning: /, '')\n-        .replace(/^Error: /, '')\n-    : null\n-\n+  // TOOD: May be better to always treat everything past the first blank line as notes\n+  // We're currently only special casing hydration error messages.\n+  const notes = errorDetails.notes\n+  const hydrationWarning = errorDetails.hydrationWarning\n   const errorCode = extractNextErrorCode(error)\n \n   const footerMessage = isServerError\n@@ -149,7 +177,11 @@ export function Errors({\n       errorCode={errorCode}\n       errorType={errorType}\n       errorMessage={\n-        <ErrorDescription error={error} hydrationWarning={hydrationWarning} />\n+        hydrationWarning ? (\n+          <HydrationErrorDescription message={hydrationWarning} />\n+        ) : (\n+          <GenericErrorDescription error={error} />\n+        )\n       }\n       onClose={isServerError ? undefined : onClose}\n       debugInfo={debugInfo}\n@@ -184,9 +216,7 @@ export function Errors({\n         ) : null}\n       </div>\n \n-      {hydrationWarning &&\n-      (activeError.componentStackFrames?.length ||\n-        !!errorDetails.reactOutputComponentDiff) ? (\n+      {errorDetails.reactOutputComponentDiff ? (\n         <PseudoHtmlDiff\n           className=\"nextjs__container_errors__component-stack\"\n           reactOutputComponentDiff={errorDetails.reactOutputComponentDiff || ''}"
        },
        {
            "sha": "575d237ae03c9c35a553db81a5c953e3d60451f9",
            "filename": "test/development/acceptance-app/hydration-error.test.ts",
            "status": "modified",
            "additions": 7,
            "deletions": 81,
            "changes": 88,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -70,7 +70,6 @@ describe('Error overlay for hydration errors in App router', () => {\n     )\n     const { session, browser } = sandbox\n \n-    // TODO(veil): Should be \"rendered text\"\n     await expect(browser).toDisplayCollapsedRedbox(`\n      {\n        \"componentStack\": \"...\n@@ -91,7 +90,7 @@ describe('Error overlay for hydration errors in App router', () => {\n      +                               client\n      -                               server\n                              ...\",\n-       \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n+       \"description\": \"Hydration failed because the server rendered text didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n        \"environmentLabel\": null,\n        \"label\": \"Runtime Error\",\n        \"source\": \"app/page.js (6:7) @ Mismatch\n@@ -229,7 +228,7 @@ describe('Error overlay for hydration errors in App router', () => {\n                                >\n                            ...\n                ...\",\n-         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n+         \"description\": \"A tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Console Error\",\n          \"source\": \"app/layout.js (5:5) @ Root\n@@ -262,7 +261,7 @@ describe('Error overlay for hydration errors in App router', () => {\n                                >\n                            ...\n                ...\",\n-         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n+         \"description\": \"A tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Console Error\",\n          \"source\": \"app/layout.js (5:5) @ Root\n@@ -737,24 +736,7 @@ describe('Error overlay for hydration errors in App router', () => {\n          ],\n        },\n        {\n-         \"componentStack\": \"...\n-         <RenderFromTemplateContext>\n-           <ScrollAndFocusHandler segmentPath={[...]}>\n-             <InnerScrollAndFocusHandler segmentPath={[...]} focusAndScrollRef={{apply:false, ...}}>\n-               <ErrorBoundary errorComponent={undefined} errorStyles={undefined} errorScripts={undefined}>\n-                 <LoadingBoundary loading={null}>\n-                   <HTTPAccessFallbackBoundary notFound={[...]} forbidden={undefined} unauthorized={undefined}>\n-                     <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={[...]} forbidden={undefined} ...>\n-                       <RedirectBoundary>\n-                         <RedirectErrorBoundary router={{...}}>\n-                           <InnerLayoutRouter url=\"/\" tree={[...]} cacheNode={{lazyData:null, ...}} segmentPath={[...]}>\n-                             <ClientPageRoot Component={function Page} searchParams={{}} params={{}}>\n-                               <Page params={Promise} searchParams={Promise}>\n-     >                           <p>\n-     >                             <p>\n-                             ...\",\n-         \"description\": \"In HTML, <p> cannot be a descendant of <p>.\n-     This will cause a hydration error.\",\n+         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\",\n          \"source\": \"app/page.js (6:7) @ Page\n@@ -833,25 +815,7 @@ describe('Error overlay for hydration errors in App router', () => {\n          ],\n        },\n        {\n-         \"componentStack\": \"...\n-         <ScrollAndFocusHandler segmentPath={[...]}>\n-           <InnerScrollAndFocusHandler segmentPath={[...]} focusAndScrollRef={{apply:false, ...}}>\n-             <ErrorBoundary errorComponent={undefined} errorStyles={undefined} errorScripts={undefined}>\n-               <LoadingBoundary loading={null}>\n-                 <HTTPAccessFallbackBoundary notFound={[...]} forbidden={undefined} unauthorized={undefined}>\n-                   <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={[...]} forbidden={undefined} ...>\n-                     <RedirectBoundary>\n-                       <RedirectErrorBoundary router={{...}}>\n-                         <InnerLayoutRouter url=\"/\" tree={[...]} cacheNode={{lazyData:null, ...}} segmentPath={[...]}>\n-                           <ClientPageRoot Component={function Page} searchParams={{}} params={{}}>\n-                             <Page params={Promise} searchParams={Promise}>\n-                               <div>\n-                                 <div>\n-     >                             <p>\n-     >                               <div>\n-                           ...\",\n-         \"description\": \"In HTML, <div> cannot be a descendant of <p>.\n-     This will cause a hydration error.\",\n+         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\",\n          \"source\": \"app/page.js (8:11) @ Page\n@@ -920,24 +884,7 @@ describe('Error overlay for hydration errors in App router', () => {\n          ],\n        },\n        {\n-         \"componentStack\": \"...\n-         <RenderFromTemplateContext>\n-           <ScrollAndFocusHandler segmentPath={[...]}>\n-             <InnerScrollAndFocusHandler segmentPath={[...]} focusAndScrollRef={{apply:false, ...}}>\n-               <ErrorBoundary errorComponent={undefined} errorStyles={undefined} errorScripts={undefined}>\n-                 <LoadingBoundary loading={null}>\n-                   <HTTPAccessFallbackBoundary notFound={[...]} forbidden={undefined} unauthorized={undefined}>\n-                     <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={[...]} forbidden={undefined} ...>\n-                       <RedirectBoundary>\n-                         <RedirectErrorBoundary router={{...}}>\n-                           <InnerLayoutRouter url=\"/\" tree={[...]} cacheNode={{lazyData:null, ...}} segmentPath={[...]}>\n-                             <ClientPageRoot Component={function Page} searchParams={{}} params={{}}>\n-                               <Page params={Promise} searchParams={Promise}>\n-     >                           <div>\n-     >                             <tr>\n-                             ...\",\n-         \"description\": \"In HTML, <tr> cannot be a child of <div>.\n-     This will cause a hydration error.\",\n+         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\",\n          \"source\": \"app/page.js (3:15) @ Page\n@@ -1026,28 +973,7 @@ describe('Error overlay for hydration errors in App router', () => {\n          ],\n        },\n        {\n-         \"componentStack\": \"...\n-         <RenderFromTemplateContext>\n-           <ScrollAndFocusHandler segmentPath={[...]}>\n-             <InnerScrollAndFocusHandler segmentPath={[...]} focusAndScrollRef={{apply:false, ...}}>\n-               <ErrorBoundary errorComponent={undefined} errorStyles={undefined} errorScripts={undefined}>\n-                 <LoadingBoundary loading={null}>\n-                   <HTTPAccessFallbackBoundary notFound={[...]} forbidden={undefined} unauthorized={undefined}>\n-                     <HTTPAccessFallbackErrorBoundary pathname=\"/\" notFound={[...]} forbidden={undefined} ...>\n-                       <RedirectBoundary>\n-                         <RedirectErrorBoundary router={{...}}>\n-                           <InnerLayoutRouter url=\"/\" tree={[...]} cacheNode={{lazyData:null, ...}} segmentPath={[...]}>\n-                             <ClientPageRoot Component={function Page} searchParams={{}} params={{}}>\n-                               <Page params={Promise} searchParams={Promise}>\n-     >                           <p>\n-                                   <span>\n-                                     <span>\n-                                       <span>\n-                                         <span>\n-     >                                     <p>\n-                             ...\",\n-         \"description\": \"In HTML, <p> cannot be a descendant of <p>.\n-     This will cause a hydration error.\",\n+         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\",\n          \"source\": \"app/page.js (5:32) @ Page"
        },
        {
            "sha": "857ba4863599399f54debf3896c11c7a98280e57",
            "filename": "test/development/acceptance/hydration-error.test.ts",
            "status": "modified",
            "additions": 32,
            "deletions": 73,
            "changes": 105,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Fhydration-error.test.ts?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -90,12 +90,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Mismatch>\n-           <div>\n-             <main>\n-       +       \"server\"\n-       -       \"client\"\",\n-           \"description\": \"Text content did not match. Server: \"server\" Client: \"client\"\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -201,10 +196,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Mismatch>\n-       >   <div>\n-       >     <main>\",\n-           \"description\": \"Expected server HTML to contain a matching <main> in <div>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -295,11 +287,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Mismatch>\n-           <div>\n-       >     <div>\n-       >       \"second\"\",\n-           \"description\": \"Expected server HTML to contain a matching text node for \"second\" in <div>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -374,9 +362,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Mismatch>\n-       >   <div>\",\n-           \"description\": \"Did not expect server HTML to contain a <main> in <div>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -447,11 +433,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Mismatch>\n-           <div>\n-       >     <div>\n-       >       \"only\"\",\n-           \"description\": \"Did not expect server HTML to contain the text node \"only\" in <div>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -543,9 +525,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Page>\n-       >   <table>\",\n-           \"description\": \"Expected server HTML to contain a matching <table> in <div>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -556,20 +536,21 @@ describe('Error overlay for hydration errors in Pages router', () => {\n     } else {\n       await expect(browser).toDisplayRedbox(`\n        {\n-         \"componentStack\": \"<Root callbacks={[...]}>\n-           <Head>\n-           <AppContainer>\n-             <Container fn={function fn}>\n-               <PagesDevOverlay>\n-                 <PagesDevOverlayErrorBoundary onError={function usePagesDevOverlay.useCallback[onComponentError]}>\n-                   <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n-                     <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n-                       <Page>\n-       +                 <table>\n-       -                 test\n-                     ...\n-                 ...\",\n-         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n+         \"componentStack\": \"...\n+           <Container fn={function fn}>\n+             <PagesDevOverlay>\n+               <PagesDevOverlayErrorBoundary onError={function usePagesDevOverlay.useCallback[onComponentError]}>\n+                 <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n+                   <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n+                     <Page>\n+                       <table>\n+                         <tbody>\n+                           <tr>\n+       >                     test\n+                   ...\n+               ...\",\n+         \"description\": \"In HTML, text nodes cannot be a child of <tr>.\n+       This will cause a hydration error.\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\",\n          \"source\": \"index.js (3:5) @ Page\n@@ -631,9 +612,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Page>\n-       >   <table>\",\n-           \"description\": \"Expected server HTML to contain a matching <table> in <div>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -653,11 +632,13 @@ describe('Error overlay for hydration errors in Pages router', () => {\n                    <PathnameContextProviderAdapter router={{sdc:{},sbc:{}, ...}} isAutoExport={true}>\n                      <App pageProps={{}} Component={function Page} err={undefined} router={{sdc:{},sbc:{}, ...}}>\n                        <Page>\n-       +                 <table>\n-       -                 {\" 123\"}\n+       >                 <table>\n+       >                   {\" 123\"}\n+                           ...\n                      ...\n                  ...\",\n-         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n+         \"description\": \"In HTML, text nodes cannot be a child of <table>.\n+       This will cause a hydration error.\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\",\n          \"source\": \"index.js (3:5) @ Page\n@@ -728,11 +709,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Mismatch>\n-       >   <div>\n-             <Suspense>\n-       >       <main>\",\n-           \"description\": \"Expected server HTML to contain a matching <main> in <div>.\",\n+           \"description\": \"Error: There was an error while hydrating this Suspense boundary. Switched to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -853,10 +830,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Page>\n-       >   <p>\n-       >     <p>\",\n-           \"description\": \"Expected server HTML to contain a matching <p> in <p>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -952,12 +926,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Page>\n-           <div>\n-             <div>\n-       >       <p>\n-       >         <div>\",\n-           \"description\": \"Expected server HTML to contain a matching <div> in <p>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -1041,10 +1010,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Page>\n-       >   <div>\n-       >     <tr>\",\n-           \"description\": \"Expected server HTML to contain a matching <tr> in <div>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,\n@@ -1138,14 +1104,7 @@ describe('Error overlay for hydration errors in Pages router', () => {\n            \"stack\": [],\n          },\n          {\n-           \"componentStack\": \"<Page>\n-           <p>\n-             <span>\n-               <span>\n-                 <span>\n-       >           <span>\n-       >             <p>\",\n-           \"description\": \"Expected server HTML to contain a matching <p> in <span>.\",\n+           \"description\": \"Error: There was an error while hydrating. Because the error happened outside of a Suspense boundary, the entire root will switch to client rendering.\",\n            \"environmentLabel\": null,\n            \"label\": \"Runtime Error\",\n            \"source\": null,"
        },
        {
            "sha": "cdeb53596cd010b2040916e222cdd5f523fefbb0",
            "filename": "test/development/app-dir/hydration-error-count/hydration-error-count.test.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 37,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/test%2Fdevelopment%2Fapp-dir%2Fhydration-error-count%2Fhydration-error-count.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/96bfee2c81d7d5fbd7d615a91d59fbe947bd6163/test%2Fdevelopment%2Fapp-dir%2Fhydration-error-count%2Fhydration-error-count.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fhydration-error-count%2Fhydration-error-count.test.ts?ref=96bfee2c81d7d5fbd7d615a91d59fbe947bd6163",
            "patch": "@@ -40,24 +40,7 @@ describe('hydration-error-count', () => {\n          ],\n        },\n        {\n-         \"componentStack\": \"...\n-         <OuterLayoutRouter parallelRouterKey=\"children\" template={<RenderFromTemplateContext>}>\n-           <RenderFromTemplateContext>\n-             <ScrollAndFocusHandler segmentPath={[...]}>\n-               <InnerScrollAndFocusHandler segmentPath={[...]} focusAndScrollRef={{apply:false, ...}}>\n-                 <ErrorBoundary errorComponent={undefined} errorStyles={undefined} errorScripts={undefined}>\n-                   <LoadingBoundary loading={null}>\n-                     <HTTPAccessFallbackBoundary notFound={undefined} forbidden={undefined} unauthorized={undefined}>\n-                       <RedirectBoundary>\n-                         <RedirectErrorBoundary router={{...}}>\n-                           <InnerLayoutRouter url=\"/bad-nesting\" tree={[...]} cacheNode={{lazyData:null, ...}} ...>\n-                             <ClientPageRoot Component={function Page} searchParams={{}} params={{}}>\n-                               <Page params={Promise} searchParams={Promise}>\n-     >                           <p>\n-     >                             <p>\n-                             ...\",\n-         \"description\": \"In HTML, <p> cannot be a descendant of <p>.\n-     This will cause a hydration error.\",\n+         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\",\n          \"source\": \"app/bad-nesting/page.tsx (6:7) @ Page\n@@ -94,7 +77,7 @@ describe('hydration-error-count', () => {\n      +                             client\n      -                             server\n                              ...\",\n-       \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n+       \"description\": \"Hydration failed because the server rendered text didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n        \"environmentLabel\": null,\n        \"label\": \"Runtime Error\",\n        \"source\": \"app/html-diff/page.tsx (4:10) @ Page\n@@ -211,24 +194,7 @@ describe('hydration-error-count', () => {\n          ],\n        },\n        {\n-         \"componentStack\": \"...\n-         <OuterLayoutRouter parallelRouterKey=\"children\" template={<RenderFromTemplateContext>}>\n-           <RenderFromTemplateContext>\n-             <ScrollAndFocusHandler segmentPath={[...]}>\n-               <InnerScrollAndFocusHandler segmentPath={[...]} focusAndScrollRef={{apply:false, ...}}>\n-                 <ErrorBoundary errorComponent={undefined} errorStyles={undefined} errorScripts={undefined}>\n-                   <LoadingBoundary loading={null}>\n-                     <HTTPAccessFallbackBoundary notFound={undefined} forbidden={undefined} unauthorized={undefined}>\n-                       <RedirectBoundary>\n-                         <RedirectErrorBoundary router={{...}}>\n-                           <InnerLayoutRouter url=\"/hydration...\" tree={[...]} cacheNode={{lazyData:null, ...}} ...>\n-                             <ClientPageRoot Component={function Page} searchParams={{}} params={{}}>\n-                               <Page params={Promise} searchParams={Promise}>\n-     >                           <p>\n-     >                             <p>\n-                             ...\",\n-         \"description\": \"In HTML, <p> cannot be a descendant of <p>.\n-     This will cause a hydration error.\",\n+         \"description\": \"Hydration failed because the server rendered HTML didn't match the client. As a result this tree will be regenerated on the client. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n          \"label\": \"Runtime Error\",\n          \"source\": \"app/hydration-with-runtime-errors/page.tsx (12:14) @ Page"
        }
    ],
    "stats": {
        "total": 994,
        "additions": 448,
        "deletions": 546
    }
}