{
    "author": "unstubbable",
    "message": "[test] Update snapshots for Rspack + React 18 (#83712)\n\nAfter fixing the workflow config for Rspack in #83677, we're now running\nmore Rspack tests with React 18 on the `canary` branch. A few snapshot\ntests now need to be updated because of that. The special cases are the\nsame as what we already had for Turbopack + React 18.",
    "sha": "b1e2dc2ad52e0447aad9d567074b1ceb56368e4c",
    "files": [
        {
            "sha": "eed2092c027ea820863468b4d9322d974939a343",
            "filename": "test/development/acceptance/ReactRefreshLogBox.test.ts",
            "status": "modified",
            "additions": 55,
            "deletions": 0,
            "changes": 55,
            "blob_url": "https://github.com/vercel/next.js/blob/b1e2dc2ad52e0447aad9d567074b1ceb56368e4c/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b1e2dc2ad52e0447aad9d567074b1ceb56368e4c/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshLogBox.test.ts?ref=b1e2dc2ad52e0447aad9d567074b1ceb56368e4c",
            "patch": "@@ -11,6 +11,7 @@ import path from 'path'\n import { outdent } from 'outdent'\n \n const isReact18 = parseInt(process.env.NEXT_TEST_REACT_VERSION) === 18\n+const isRspack = !!process.env.NEXT_RSPACK\n \n describe('ReactRefreshLogBox', () => {\n   const { isTurbopack, next } = nextTestSetup({\n@@ -286,6 +287,33 @@ describe('ReactRefreshLogBox', () => {\n          },\n        ]\n       `)\n+    } else if (isReact18 && isRspack) {\n+      await expect(browser).toDisplayRedbox(`\n+       [\n+         {\n+           \"description\": \"no\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"FunctionDefault.js (1:51) @ FunctionDefault\n+       > 1 | export default function FunctionDefault() { throw new Error('no'); }\n+           |                                                   ^\",\n+           \"stack\": [\n+             \"FunctionDefault FunctionDefault.js (1:51)\",\n+           ],\n+         },\n+         {\n+           \"description\": \"no\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"FunctionDefault.js (1:51) @ FunctionDefault\n+       > 1 | export default function FunctionDefault() { throw new Error('no'); }\n+           |                                                   ^\",\n+           \"stack\": [\n+             \"FunctionDefault FunctionDefault.js (1:51)\",\n+           ],\n+         },\n+       ]\n+      `)\n     } else {\n       if (isTurbopack) {\n         await expect(browser).toDisplayRedbox(`\n@@ -499,6 +527,33 @@ describe('ReactRefreshLogBox', () => {\n          },\n        ]\n       `)\n+    } else if (isReact18 && isRspack) {\n+      await expect(browser).toDisplayRedbox(`\n+       [\n+         {\n+           \"description\": \"\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"Child.js (4:11) @ ClickCount.render\n+       > 4 |     throw new Error()\n+           |           ^\",\n+           \"stack\": [\n+             \"ClickCount.render Child.js (4:11)\",\n+           ],\n+         },\n+         {\n+           \"description\": \"\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"Child.js (4:11) @ ClickCount.render\n+       > 4 |     throw new Error()\n+           |           ^\",\n+           \"stack\": [\n+             \"ClickCount.render Child.js (4:11)\",\n+           ],\n+         },\n+       ]\n+      `)\n     } else {\n       if (isTurbopack) {\n         await expect(browser).toDisplayRedbox(`"
        },
        {
            "sha": "e7f03e1b3d99c07c69f561e8ab835782b23858b1",
            "filename": "test/development/acceptance/error-recovery.test.ts",
            "status": "modified",
            "additions": 115,
            "deletions": 63,
            "changes": 178,
            "blob_url": "https://github.com/vercel/next.js/blob/b1e2dc2ad52e0447aad9d567074b1ceb56368e4c/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b1e2dc2ad52e0447aad9d567074b1ceb56368e4c/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2Ferror-recovery.test.ts?ref=b1e2dc2ad52e0447aad9d567074b1ceb56368e4c",
            "patch": "@@ -64,14 +64,14 @@ describe('pages/ error recovery', () => {\n          \"label\": \"Build Error\",\n          \"source\": \"./index.js\n          × Module build failed:\n-         ├─▶   ×\n-         │     │   x Unexpected eof\n-         │     │    ,-[<FIXME-project-root>/index.js:1:1]\n-         │     │  1 | export default () => <div/\n-         │     │    \\`----\n-         │     │\n-         │\n-         ╰─▶ Syntax Error\n+         ╰─▶   × Error:   x Expected '>', got '<eof>'\n+               │    ,----\n+               │  1 | export default () => <div/\n+               │    \\`----\n+               │\n+               │\n+               │ Caused by:\n+               │     Syntax Error\n        Import trace for requested module:\n        ./index.js\n        ./pages/index.js\",\n@@ -245,7 +245,7 @@ describe('pages/ error recovery', () => {\n     )\n \n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n-    // Somehow we end up with two in React 18 + Turbopack due to React's attempt to recover from this error.\n+    // Somehow we end up with two in React 18 + Turbopack/Rspack due to React's attempt to recover from this error.\n     if (isReact18 && isTurbopack) {\n       await expect(browser).toDisplayRedbox(`\n        [\n@@ -277,6 +277,33 @@ describe('pages/ error recovery', () => {\n          },\n        ]\n       `)\n+    } else if (isReact18 && isRspack) {\n+      await expect(browser).toDisplayRedbox(`\n+       [\n+         {\n+           \"description\": \"oops\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"child.js (3:9) @ Child\n+       > 3 |   throw new Error('oops')\n+           |         ^\",\n+           \"stack\": [\n+             \"Child child.js (3:9)\",\n+           ],\n+         },\n+         {\n+           \"description\": \"oops\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime Error\",\n+           \"source\": \"child.js (3:9) @ Child\n+       > 3 |   throw new Error('oops')\n+           |         ^\",\n+           \"stack\": [\n+             \"Child child.js (3:9)\",\n+           ],\n+         },\n+       ]\n+      `)\n     } else {\n       if (isTurbopack) {\n         await expect(browser).toDisplayRedbox(`\n@@ -388,20 +415,20 @@ describe('pages/ error recovery', () => {\n          \"label\": \"Build Error\",\n          \"source\": \"./index.js\n          × Module build failed:\n-         ├─▶   ×\n-         │     │   x Expected '{', got 'return'\n-         │     │    ,-[<FIXME-project-root>/index.js:5:1]\n-         │     │  2 |\n-         │     │  3 | class ClassDefault extends React.Component {\n-         │     │  4 |   render()\n-         │     │  5 |     return <h1>Default Export</h1>;\n-         │     │    :     ^^^^^^\n-         │     │  6 |   }\n-         │     │  7 | }\n-         │     │    \\`----\n-         │     │\n-         │\n-         ╰─▶ Syntax Error\n+         ╰─▶   × Error:   x Expected '{', got 'return'\n+               │    ,-[5:1]\n+               │  2 |\n+               │  3 | class ClassDefault extends React.Component {\n+               │  4 |   render()\n+               │  5 |     return <h1>Default Export</h1>;\n+               │    :     ^^^^^^\n+               │  6 |   }\n+               │  7 | }\n+               │    \\`----\n+               │\n+               │\n+               │ Caused by:\n+               │     Syntax Error\n        Import trace for requested module:\n        ./index.js\n        ./pages/index.js\",\n@@ -473,21 +500,21 @@ describe('pages/ error recovery', () => {\n          \"label\": \"Build Error\",\n          \"source\": \"./index.js\n          × Module build failed:\n-         ├─▶   ×\n-         │     │   x Expected '{', got 'throw'\n-         │     │    ,-[<FIXME-project-root>/index.js:5:1]\n-         │     │  2 |\n-         │     │  3 | class ClassDefault extends React.Component {\n-         │     │  4 |   render()\n-         │     │  5 |     throw new Error('nooo');\n-         │     │    :     ^^^^^\n-         │     │  6 |     return <h1>Default Export</h1>;\n-         │     │  7 |   }\n-         │     │  8 | }\n-         │     │    \\`----\n-         │     │\n-         │\n-         ╰─▶ Syntax Error\n+         ╰─▶   × Error:   x Expected '{', got 'throw'\n+               │    ,-[5:1]\n+               │  2 |\n+               │  3 | class ClassDefault extends React.Component {\n+               │  4 |   render()\n+               │  5 |     throw new Error('nooo');\n+               │    :     ^^^^^\n+               │  6 |     return <h1>Default Export</h1>;\n+               │  7 |   }\n+               │  8 | }\n+               │    \\`----\n+               │\n+               │\n+               │ Caused by:\n+               │     Syntax Error\n        Import trace for requested module:\n        ./index.js\n        ./pages/index.js\",\n@@ -673,7 +700,7 @@ describe('pages/ error recovery', () => {\n \n     // TODO(veil): Don't bail in Turbopack for sources outside of the project (https://linear.app/vercel/issue/NDX-944)\n     // We get an error because Foo didn't import React. Fair.\n-    // Somehow we end up with two in React 18 due to React's attempt to recover from this error.\n+    // Somehow we end up with two in React 18 + Turbopack/Rspack due to React's attempt to recover from this error.\n     if (isReact18 && isTurbopack) {\n       await expect(browser).toDisplayRedbox(`\n        [\n@@ -705,6 +732,33 @@ describe('pages/ error recovery', () => {\n          },\n        ]\n       `)\n+    } else if (isReact18 && isRspack) {\n+      await expect(browser).toDisplayRedbox(`\n+       [\n+         {\n+           \"description\": \"React is not defined\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime ReferenceError\",\n+           \"source\": \"Foo.js (3:3) @ Foo\n+       > 3 |   return React.createElement('h1', null, 'Foo');\n+           |   ^\",\n+           \"stack\": [\n+             \"Foo Foo.js (3:3)\",\n+           ],\n+         },\n+         {\n+           \"description\": \"React is not defined\",\n+           \"environmentLabel\": null,\n+           \"label\": \"Runtime ReferenceError\",\n+           \"source\": \"Foo.js (3:3) @ Foo\n+       > 3 |   return React.createElement('h1', null, 'Foo');\n+           |   ^\",\n+           \"stack\": [\n+             \"Foo Foo.js (3:3)\",\n+           ],\n+         },\n+       ]\n+      `)\n     } else {\n       if (isTurbopack) {\n         await expect(browser).toDisplayRedbox(`\n@@ -855,18 +909,17 @@ describe('pages/ error recovery', () => {\n          \"label\": \"Build Error\",\n          \"source\": \"./index.js\n          × Module build failed:\n-         ├─▶   ×\n-         │     │   x Expected '}', got '<eof>'\n-         │     │    ,-[<FIXME-project-root>/index.js:7:1]\n-         │     │  4 |   i++\n-         │     │  5 |   throw Error('no ' + i)\n-         │     │  6 | }, 1000)\n-         │     │  7 | export default function FunctionNamed() {\n-         │     │    :                                         ^\n-         │     │    \\`----\n-         │     │\n-         │\n-         ╰─▶ Syntax Error\n+         ╰─▶   × Error:   x Expected '}', got '<eof>'\n+               │    ,-[7:1]\n+               │  4 |   i++\n+               │  5 |   throw Error('no ' + i)\n+               │  6 | }, 1000)\n+               │  7 | export default function FunctionNamed() {\n+               │    \\`----\n+               │\n+               │\n+               │ Caused by:\n+               │     Syntax Error\n        Import trace for requested module:\n        ./index.js\n        ./pages/index.js\",\n@@ -922,18 +975,17 @@ describe('pages/ error recovery', () => {\n          \"label\": \"Build Error\",\n          \"source\": \"./index.js\n          × Module build failed:\n-         ├─▶   ×\n-         │     │   x Expected '}', got '<eof>'\n-         │     │    ,-[<FIXME-project-root>/index.js:7:1]\n-         │     │  4 |   i++\n-         │     │  5 |   throw Error('no ' + i)\n-         │     │  6 | }, 1000)\n-         │     │  7 | export default function FunctionNamed() {\n-         │     │    :                                         ^\n-         │     │    \\`----\n-         │     │\n-         │\n-         ╰─▶ Syntax Error\n+         ╰─▶   × Error:   x Expected '}', got '<eof>'\n+               │    ,-[7:1]\n+               │  4 |   i++\n+               │  5 |   throw Error('no ' + i)\n+               │  6 | }, 1000)\n+               │  7 | export default function FunctionNamed() {\n+               │    \\`----\n+               │\n+               │\n+               │ Caused by:\n+               │     Syntax Error\n        Import trace for requested module:\n        ./index.js\n        ./pages/index.js\","
        }
    ],
    "stats": {
        "total": 233,
        "additions": 170,
        "deletions": 63
    }
}