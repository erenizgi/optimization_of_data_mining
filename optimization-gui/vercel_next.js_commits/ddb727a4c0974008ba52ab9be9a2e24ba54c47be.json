{
    "author": "timneutkens",
    "message": "Turbopack Build: Fix css-modules test (#79441)\n\n## What?\n\nThe setup already works but the test fails because the urls are relative\nwith Turbopack. I've updated the test.",
    "sha": "ddb727a4c0974008ba52ab9be9a2e24ba54c47be",
    "files": [
        {
            "sha": "f1fde689df62fef2e32685161396cbd287938ac9",
            "filename": "test/integration/css/test/css-modules.test.js",
            "status": "modified",
            "additions": 13,
            "deletions": 7,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/ddb727a4c0974008ba52ab9be9a2e24ba54c47be/test%2Fintegration%2Fcss%2Ftest%2Fcss-modules.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/ddb727a4c0974008ba52ab9be9a2e24ba54c47be/test%2Fintegration%2Fcss%2Ftest%2Fcss-modules.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcss%2Ftest%2Fcss-modules.test.js?ref=ddb727a4c0974008ba52ab9be9a2e24ba54c47be",
            "patch": "@@ -153,20 +153,26 @@ describe('should handle unresolved files gracefully', () => {\n             encoding: 'utf8',\n           })\n           .filter((f) => f.endsWith('.css'))\n+          // Ensure the loop is more deterministic\n+          .sort()\n \n         expect(cssFiles).not.toBeEmpty()\n \n         for (const file of cssFiles) {\n           const content = await readFile(join(cssFolder, file), 'utf8')\n \n-          // if it is the combined global CSS file there are double the expected\n-          // results\n-          const howMany =\n-            content.includes('p{') || content.includes('p,') ? 2 : 1\n+          const svgCount = content.match(/\\(\\/vercel\\.svg/g).length\n+          expect(svgCount === 1 || svgCount === 2).toBe(true)\n \n-          expect(content.match(/\\(\\/vercel\\.svg/g).length).toBe(howMany)\n-          expect(content.match(/\\(\\/_next\\/static\\/media/g).length).toBe(1)\n-          expect(content.match(/\\(https:\\/\\//g).length).toBe(howMany)\n+          if (process.env.IS_TURBOPACK_TEST) {\n+            // With Turbopack these are combined and the path is relative.\n+            const mediaCount = content.match(/\\(\\.\\.\\/media/g).length\n+            expect(mediaCount === 1 || mediaCount === 2).toBe(true)\n+          } else {\n+            expect(content.match(/\\(\\/_next\\/static\\/media/g).length).toBe(1)\n+          }\n+          const httpsCount = content.match(/\\(https:\\/\\//g).length\n+          expect(httpsCount === 1 || httpsCount === 2).toBe(true)\n         }\n       })\n     }"
        },
        {
            "sha": "093379db4d1269cb4f23915e4ec90d4459bd6bc2",
            "filename": "test/turbopack-build-tests-manifest.json",
            "status": "modified",
            "additions": 2,
            "deletions": 3,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/ddb727a4c0974008ba52ab9be9a2e24ba54c47be/test%2Fturbopack-build-tests-manifest.json",
            "raw_url": "https://github.com/vercel/next.js/raw/ddb727a4c0974008ba52ab9be9a2e24ba54c47be/test%2Fturbopack-build-tests-manifest.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fturbopack-build-tests-manifest.json?ref=ddb727a4c0974008ba52ab9be9a2e24ba54c47be",
            "patch": "@@ -10345,11 +10345,10 @@\n       \"Ordering with Global CSS and Modules (prod) production mode useLightnincsss(false) should have the correct color (css ordering)\",\n       \"Ordering with Global CSS and Modules (prod) production mode useLightnincsss(true) should have compiled successfully\",\n       \"Ordering with Global CSS and Modules (prod) production mode useLightnincsss(true) should have the correct color (css ordering)\",\n-      \"should handle unresolved files gracefully production mode should build correctly\"\n-    ],\n-    \"failed\": [\n+      \"should handle unresolved files gracefully production mode should build correctly\",\n       \"should handle unresolved files gracefully production mode should have correct file references in CSS output\"\n     ],\n+    \"failed\": [],\n     \"pending\": [\n       \"Basic CSS Modules Ordering useLightnincsss(false) Development Mode should have correct color on index page (on hover)\",\n       \"Basic CSS Modules Ordering useLightnincsss(false) Development Mode should have correct color on index page (on load)\","
        }
    ],
    "stats": {
        "total": 25,
        "additions": 15,
        "deletions": 10
    }
}