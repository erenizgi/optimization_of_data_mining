{
    "author": "devjiwonchoi",
    "message": "[devtools] port devtools scale to dispatcher (#80537)\n\n### Why?\r\n\r\nSince the DevTools Panel and the DevTools Indicator are decoupled, use the dispatcher to communicate the DevTools scale from the DevTools Panel (Settings tab).",
    "sha": "d89afa76208ba767a7e6ffe4bd169a0adbbf4758",
    "files": [
        {
            "sha": "776ab0d8b4236916a99462b8a9f28cb8df429df2",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx?ref=d89afa76208ba767a7e6ffe4bd169a0adbbf4758",
            "patch": "@@ -1,6 +1,5 @@\n import type { CSSProperties } from 'react'\n import type { OverlayState, OverlayDispatch } from '../../shared'\n-import type { DevToolsScale } from '../errors/dev-tools-indicator/dev-tools-info/preferences'\n \n import { useState } from 'react'\n import { NextLogo } from './next-logo'\n@@ -26,13 +25,11 @@ export function DevToolsIndicator({\n   dispatch,\n   errorCount,\n   isBuildError,\n-  scale,\n }: {\n   state: OverlayState\n   dispatch: OverlayDispatch\n   errorCount: number\n   isBuildError: boolean\n-  scale: DevToolsScale\n }) {\n   const [open, setOpen] = useState(false)\n \n@@ -89,7 +86,7 @@ export function DevToolsIndicator({\n           isDevBuilding={state.buildingIndicator}\n           isDevRendering={state.renderingIndicator}\n           isBuildError={isBuildError}\n-          scale={scale}\n+          scale={state.scale}\n         />\n       </Draggable>\n     </Toast>"
        },
        {
            "sha": "d5b2bc6581de12820abc7b7e6f0dd51e08d953ac",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-indicator.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx?ref=d89afa76208ba767a7e6ffe4bd169a0adbbf4758",
            "patch": "@@ -62,6 +62,7 @@ const state: OverlayState = {\n   // TODO: This will be handled on the next stack——with proper story.\n   isDevToolsPanelOpen: false,\n   devToolsPosition: 'bottom-left',\n+  scale: 1,\n }\n \n export const StaticRoute: Story = {"
        },
        {
            "sha": "bc19e83db3eef4077754d2df8125f38a2b64504c",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/preferences.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 8,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fpreferences.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fpreferences.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fpreferences.ts?ref=d89afa76208ba767a7e6ffe4bd169a0adbbf4758",
            "patch": "@@ -1,5 +1,6 @@\n import { useState } from 'react'\n import {\n+  NEXT_DEV_TOOLS_SCALE,\n   STORAGE_KEY_POSITION,\n   STORAGE_KEY_SCALE,\n   STORAGE_KEY_THEME,\n@@ -26,14 +27,6 @@ export function getInitialPosition() {\n \n //////////////////////////////////////////////////////////////////////////////////////\n \n-const BASE_SIZE = 16\n-\n-export const NEXT_DEV_TOOLS_SCALE = {\n-  Small: BASE_SIZE / 14,\n-  Medium: BASE_SIZE / 16,\n-  Large: BASE_SIZE / 18,\n-} as const\n-\n export type DevToolsScale =\n   (typeof NEXT_DEV_TOOLS_SCALE)[keyof typeof NEXT_DEV_TOOLS_SCALE]\n "
        },
        {
            "sha": "d69fac6e7f6c106acdd01bc7004f8464deb95b7a",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-info/user-preferences.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-info%2Fuser-preferences.tsx?ref=d89afa76208ba767a7e6ffe4bd169a0adbbf4758",
            "patch": "@@ -1,15 +1,18 @@\n import { useState, type HTMLProps } from 'react'\n import { css } from '../../../../utils/css'\n import EyeIcon from '../../../../icons/eye-icon'\n-import { STORAGE_KEY_POSITION, STORAGE_KEY_THEME } from '../../../../shared'\n+import {\n+  NEXT_DEV_TOOLS_SCALE,\n+  STORAGE_KEY_POSITION,\n+  STORAGE_KEY_THEME,\n+} from '../../../../shared'\n import LightIcon from '../../../../icons/light-icon'\n import DarkIcon from '../../../../icons/dark-icon'\n import SystemIcon from '../../../../icons/system-icon'\n import type { DevToolsInfoPropsCore } from './dev-tools-info'\n import { DevToolsInfo } from './dev-tools-info'\n import {\n   getInitialTheme,\n-  NEXT_DEV_TOOLS_SCALE,\n   type DevToolsIndicatorPosition,\n   type DevToolsScale,\n } from './preferences'"
        },
        {
            "sha": "7fa2a6b7abd236f25fa475b80a775586a3801299",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx?ref=d89afa76208ba767a7e6ffe4bd169a0adbbf4758",
            "patch": "@@ -13,6 +13,7 @@ import {\n   ACTION_ERROR_OVERLAY_CLOSE,\n   ACTION_ERROR_OVERLAY_OPEN,\n   ACTION_ERROR_OVERLAY_TOGGLE,\n+  NEXT_DEV_TOOLS_SCALE,\n } from './shared'\n \n const meta: Meta<typeof DevOverlay> = {\n@@ -99,6 +100,7 @@ const initialState: OverlayState = {\n   isErrorOverlayOpen: false,\n   isDevToolsPanelOpen: false,\n   devToolsPosition: 'bottom-left',\n+  scale: NEXT_DEV_TOOLS_SCALE.Medium,\n }\n \n function useOverlayReducer() {"
        },
        {
            "sha": "f484bee4f9a05af5457ef5367418e0139b801bb3",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.tsx",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.tsx?ref=d89afa76208ba767a7e6ffe4bd169a0adbbf4758",
            "patch": "@@ -41,7 +41,6 @@ export function DevOverlay({\n                 (process.env.__NEXT_DEVTOOL_NEW_PANEL_UI ? (\n                   <>\n                     <DevToolsIndicatorNew\n-                      scale={scale}\n                       state={state}\n                       dispatch={dispatch}\n                       errorCount={totalErrorCount}"
        },
        {
            "sha": "92bea8610102a1564711d36aeae52b69a9cd642c",
            "filename": "packages/next/src/next-devtools/dev-overlay/shared.ts",
            "status": "modified",
            "additions": 20,
            "deletions": 0,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d89afa76208ba767a7e6ffe4bd169a0adbbf4758/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts?ref=d89afa76208ba767a7e6ffe4bd169a0adbbf4758",
            "patch": "@@ -10,6 +10,14 @@ import { isConsoleError } from '../shared/console-error'\n \n export type Corners = 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n \n+const BASE_SIZE = 16\n+\n+export const NEXT_DEV_TOOLS_SCALE = {\n+  Small: BASE_SIZE / 14,\n+  Medium: BASE_SIZE / 16,\n+  Large: BASE_SIZE / 18,\n+}\n+\n type FastRefreshState =\n   /** No refresh in progress. */\n   | { type: 'idle' }\n@@ -33,6 +41,7 @@ export interface OverlayState {\n   isErrorOverlayOpen: boolean\n   isDevToolsPanelOpen: boolean\n   devToolsPosition: Corners\n+  scale: number\n }\n export type OverlayDispatch = React.Dispatch<DispatcherEvent>\n \n@@ -61,6 +70,7 @@ export const ACTION_DEVTOOLS_PANEL_CLOSE = 'devtools-panel-close'\n export const ACTION_DEVTOOLS_PANEL_TOGGLE = 'devtools-panel-toggle'\n \n export const ACTION_DEVTOOLS_POSITION = 'devtools-position'\n+export const ACTION_DEVTOOLS_SCALE = 'devtools-scale'\n \n export const STORAGE_KEY_THEME = '__nextjs-dev-tools-theme'\n export const STORAGE_KEY_POSITION = '__nextjs-dev-tools-position'\n@@ -148,6 +158,11 @@ export interface DevToolsIndicatorPositionAction {\n   devToolsPosition: Corners\n }\n \n+export interface DevToolsScaleAction {\n+  type: typeof ACTION_DEVTOOLS_SCALE\n+  scale: number\n+}\n+\n export type DispatcherEvent =\n   | BuildOkAction\n   | BuildErrorAction\n@@ -170,6 +185,7 @@ export type DispatcherEvent =\n   | DevToolsPanelCloseAction\n   | DevToolsPanelToggleAction\n   | DevToolsIndicatorPositionAction\n+  | DevToolsScaleAction\n \n const REACT_ERROR_STACK_BOTTOM_FRAME_REGEX =\n   // 1st group: v8\n@@ -210,6 +226,7 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   debugInfo: { devtoolsFrontendUrl: undefined },\n   isDevToolsPanelOpen: false,\n   devToolsPosition: 'bottom-left',\n+  scale: NEXT_DEV_TOOLS_SCALE.Medium,\n }\n \n function getInitialState(\n@@ -384,6 +401,9 @@ export function useErrorOverlayReducer(\n         case ACTION_DEVTOOLS_POSITION: {\n           return { ...state, devToolsPosition: action.devToolsPosition }\n         }\n+        case ACTION_DEVTOOLS_SCALE: {\n+          return { ...state, scale: action.scale }\n+        }\n         default: {\n           return state\n         }"
        }
    ],
    "stats": {
        "total": 45,
        "additions": 30,
        "deletions": 15
    }
}