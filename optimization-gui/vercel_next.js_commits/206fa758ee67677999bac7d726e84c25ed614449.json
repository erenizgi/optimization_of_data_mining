{
    "author": "mischnic",
    "message": "Turbopack: fix pageExtensions precedence (#84926)\n\nWebpack doesn't use the specified order, it's by length.",
    "sha": "206fa758ee67677999bac7d726e84c25ed614449",
    "files": [
        {
            "sha": "c3aa317d51914fe5d48c92a02afd7cc6ede49160",
            "filename": "crates/next-core/src/next_config.rs",
            "status": "modified",
            "additions": 6,
            "deletions": 1,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/206fa758ee67677999bac7d726e84c25ed614449/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/206fa758ee67677999bac7d726e84c25ed614449/crates%2Fnext-core%2Fsrc%2Fnext_config.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_config.rs?ref=206fa758ee67677999bac7d726e84c25ed614449",
            "patch": "@@ -1388,7 +1388,12 @@ impl NextConfig {\n \n     #[turbo_tasks::function]\n     pub fn page_extensions(&self) -> Vc<Vec<RcStr>> {\n-        Vc::cell(self.page_extensions.clone())\n+        // Sort page extensions by length descending. This mirrors the Webpack behavior in Next.js,\n+        // which just builds a regex alternative, which greedily matches the longest\n+        // extension: https://github.com/vercel/next.js/blob/32476071fe331948d89a35c391eb578aed8de979/packages/next/src/build/entries.ts#L409\n+        let mut extensions = self.page_extensions.clone();\n+        extensions.sort_by_key(|ext| std::cmp::Reverse(ext.len()));\n+        Vc::cell(extensions)\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "8f2f088eb1efae975670166c8862e8b4d412e892",
            "filename": "test/integration/custom-page-extension/next.config.js",
            "status": "modified",
            "additions": 5,
            "deletions": 3,
            "changes": 8,
            "blob_url": "https://github.com/vercel/next.js/blob/206fa758ee67677999bac7d726e84c25ed614449/test%2Fintegration%2Fcustom-page-extension%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/206fa758ee67677999bac7d726e84c25ed614449/test%2Fintegration%2Fcustom-page-extension%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcustom-page-extension%2Fnext.config.js?ref=206fa758ee67677999bac7d726e84c25ed614449",
            "patch": "@@ -1,3 +1,5 @@\n-module.exports = {\n-  pageExtensions: ['page.js'],\n-}\n+module.exports = (phase, { defaultConfig }) => ({\n+  // Append the custom extension to the default page extensions, to ensure that matching precedence\n+  // is by length.\n+  pageExtensions: [...defaultConfig.pageExtensions, 'page.js'],\n+})"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 11,
        "deletions": 4
    }
}