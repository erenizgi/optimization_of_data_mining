{
    "author": "mischnic",
    "message": "Revert Rust upgrade to nightly-2025-04-10 (#78062)\n\nReverts most of #78039, I've kept the applied clippy suggestions though.\r\n\r\nUnfortunately, a rustc ICE crash that was rare before now happens constantly, both when building and inside rust-analyzer, making everything just unusable.",
    "sha": "dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
    "files": [
        {
            "sha": "41eb67abca56986a1f42f5b2f7018d82f9b19a0e",
            "filename": "rust-toolchain.toml",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/rust-toolchain.toml",
            "raw_url": "https://github.com/vercel/next.js/raw/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/rust-toolchain.toml",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/rust-toolchain.toml?ref=dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
            "patch": "@@ -1,4 +1,4 @@\n [toolchain]\n-channel = \"nightly-2025-04-10\"\n+channel = \"nightly-2025-02-12\"\n components = [\"rustfmt\", \"clippy\", \"rust-analyzer\"]\n profile = \"minimal\""
        },
        {
            "sha": "8b996f62c08c53649e91958f00a3c8c440ab11ea",
            "filename": "turbopack/crates/turbo-static/src/main.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-static%2Fsrc%2Fmain.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-static%2Fsrc%2Fmain.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-static%2Fsrc%2Fmain.rs?ref=dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
            "patch": "@@ -194,7 +194,6 @@ fn resolve_concurrency(\n \n     for (ident, references) in dep_tree {\n         for reference in references {\n-            #[allow(clippy::map_entry)] // This doesn't insert into dep_tree, so entry isn't useful\n             if !dep_tree.contains_key(&reference.identifier) {\n                 // this is a task that is not in the task list\n                 // so we can't resolve it"
        },
        {
            "sha": "41998db9992d94aede8f3b74d3859eff8bf98627",
            "filename": "turbopack/crates/turbo-tasks-auto-hash-map/src/lib.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-auto-hash-map%2Fsrc%2Flib.rs?ref=dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
            "patch": "@@ -1,3 +1,5 @@\n+#![feature(hash_extract_if)]\n+\n pub mod map;\n pub mod set;\n "
        },
        {
            "sha": "464f8d3867e951b7e37f9571115ebb7c0b4f8a17",
            "filename": "turbopack/crates/turbo-tasks-fs/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Flib.rs?ref=dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
            "patch": "@@ -1,5 +1,6 @@\n #![allow(clippy::needless_return)] // tokio macro-generated code doesn't respect this\n #![feature(trivial_bounds)]\n+#![feature(hash_extract_if)]\n #![feature(min_specialization)]\n #![feature(iter_advance_by)]\n #![feature(io_error_more)]"
        },
        {
            "sha": "7fb9a0baa30318dcc2cb1252eec9655716490863",
            "filename": "turbopack/crates/turbo-tasks-macros-tests/tests/function/fail_operation_method_self_type.stderr",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_operation_method_self_type.stderr",
            "raw_url": "https://github.com/vercel/next.js/raw/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_operation_method_self_type.stderr",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros-tests%2Ftests%2Ffunction%2Ffail_operation_method_self_type.stderr?ref=dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
            "patch": "@@ -4,15 +4,6 @@ error: methods taking `self` are not supported with `operation`\n 13 |     fn arbitrary_self_type(self: OperationVc<Self>) -> Vc<()> {\n    |                            ^^^^^^^^^^^^^^^^^^^^^^^\n \n-error[E0307]: invalid `self` parameter type: `OperationVc<Foobar>`\n-  --> tests/function/fail_operation_method_self_type.rs:13:34\n-   |\n-13 |     fn arbitrary_self_type(self: OperationVc<Self>) -> Vc<()> {\n-   |                                  ^^^^^^^^^^^^^^^^^\n-   |\n-   = note: type of `self` must be `Self` or some type implementing `Receiver`\n-   = help: consider changing to `self`, `&self`, `&mut self`, or a type implementing `Receiver` such as `self: Box<Self>`, `self: Rc<Self>`, or `self: Arc<Self>`\n-\n error[E0277]: the trait bound `fn(...) -> ... {...::arbitrary_self_type_turbo_tasks_function_inline}: IntoTaskFnWithThis<_, _, _>` is not satisfied\n   --> tests/function/fail_operation_method_self_type.rs:10:1\n    |\n@@ -31,3 +22,12 @@ note: required by a bound in `NativeFunction::new_method`\n    |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ required by this bound in `NativeFunction::new_method`\n    = note: consider using `--verbose` to print the full type name to the console\n    = note: this error originates in the attribute macro `turbo_tasks::value_impl` (in Nightly builds, run with -Z macro-backtrace for more info)\n+\n+error[E0307]: invalid `self` parameter type: `OperationVc<Foobar>`\n+  --> tests/function/fail_operation_method_self_type.rs:13:34\n+   |\n+13 |     fn arbitrary_self_type(self: OperationVc<Self>) -> Vc<()> {\n+   |                                  ^^^^^^^^^^^^^^^^^\n+   |\n+   = note: type of `self` must be `Self` or some type implementing `Receiver`\n+   = help: consider changing to `self`, `&self`, `&mut self`, or a type implementing `Receiver` such as `self: Box<Self>`, `self: Rc<Self>`, or `self: Arc<Self>`"
        },
        {
            "sha": "9f1f3e3ba67e4908447122205bee4740d10a1a27",
            "filename": "turbopack/crates/turbo-tasks-memory/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-memory%2Fsrc%2Flib.rs?ref=dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
            "patch": "@@ -1,3 +1,4 @@\n+#![feature(hash_extract_if)]\n #![feature(type_alias_impl_trait)]\n #![feature(box_patterns)]\n #![feature(int_roundings)]"
        },
        {
            "sha": "35a34f3e3f49376f545088a8bdd6bb157dc671e3",
            "filename": "turbopack/crates/turbo-tasks/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Flib.rs?ref=dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
            "patch": "@@ -29,6 +29,7 @@\n #![feature(trivial_bounds)]\n #![feature(min_specialization)]\n #![feature(try_trait_v2)]\n+#![feature(hash_extract_if)]\n #![deny(unsafe_op_in_unsafe_fn)]\n #![feature(result_flattening)]\n #![feature(error_generic_member_access)]"
        },
        {
            "sha": "81120ec02f420158343fda333734372e357dc557",
            "filename": "turbopack/crates/turbopack-css/src/process.rs",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fprocess.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fprocess.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fprocess.rs?ref=dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
            "patch": "@@ -112,7 +112,6 @@ impl StyleSheetLike<'_, '_> {\n pub struct UnresolvedUrlReferences(pub Vec<(String, ResolvedVc<UrlAssetReference>)>);\n \n #[turbo_tasks::value(shared, serialization = \"none\", eq = \"manual\", cell = \"new\")]\n-#[allow(clippy::large_enum_variant)] // This is a turbo-tasks value\n pub enum ParseCssResult {\n     Ok {\n         code: ResolvedVc<FileContent>,"
        },
        {
            "sha": "672736fca9388d137f223f5a24a939ad1077b03b",
            "filename": "turbopack/crates/turbopack-node/src/lib.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Flib.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Flib.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-node%2Fsrc%2Flib.rs?ref=dedf6d3ad96ecefb8681bd53dcf67ea7d7a3a694",
            "patch": "@@ -1,6 +1,7 @@\n #![feature(min_specialization)]\n #![feature(arbitrary_self_types)]\n #![feature(arbitrary_self_types_pointers)]\n+#![feature(extract_if)]\n \n use std::{iter::once, thread::available_parallelism};\n "
        }
    ],
    "stats": {
        "total": 28,
        "additions": 16,
        "deletions": 12
    }
}