{
    "author": "eps1lon",
    "message": "Allow inspecting dev server on default port with `next dev --inspect` (#85037)\n\nCo-authored-by: graphite-app[bot] <96075541+graphite-app[bot]@users.noreply.github.com>",
    "sha": "1e53071f778ac79f78979e497fad40c13dee759f",
    "files": [
        {
            "sha": "09d06acaf00858e3e43d1ff75201615ed0c76cf9",
            "filename": "docs/01-app/02-guides/debugging.mdx",
            "status": "modified",
            "additions": 15,
            "deletions": 35,
            "changes": 50,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/docs%2F01-app%2F02-guides%2Fdebugging.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/docs%2F01-app%2F02-guides%2Fdebugging.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F02-guides%2Fdebugging.mdx?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -22,7 +22,7 @@ Create a file named `.vscode/launch.json` at the root of your project with the f\n       \"name\": \"Next.js: debug server-side\",\n       \"type\": \"node-terminal\",\n       \"request\": \"launch\",\n-      \"command\": \"npm run dev\"\n+      \"command\": \"npm run dev -- --inspect\"\n     },\n     {\n       \"name\": \"Next.js: debug client-side\",\n@@ -111,23 +111,15 @@ For React-specific debugging, install the [React Developer Tools](https://react.\n \n ### Server-side code\n \n-To debug server-side Next.js code with browser DevTools, you need to pass the [`--inspect`](https://nodejs.org/api/cli.html#cli_inspect_host_port) flag to the underlying Node.js process:\n+To debug server-side Next.js code with browser DevTools, you need to pass the `--inspect` flag:\n \n ```bash filename=\"Terminal\"\n-NODE_OPTIONS='--inspect' next dev\n+next dev --inspect\n ```\n \n-> **Good to know**: Use `NODE_OPTIONS='--inspect=0.0.0.0'` to allow remote debugging access outside localhost, such as when running the app in a Docker container.\n+The value of `--inspect` is passed to the underlying Node.js process. Check out the [`--inspect` docs for advanced use cases](https://nodejs.org/api/cli.html#--inspecthostport).\n \n-If you're using `npm run dev` or `yarn dev` then you should update the `dev` script on your `package.json`:\n-\n-```json filename=\"package.json\"\n-{\n-  \"scripts\": {\n-    \"dev\": \"NODE_OPTIONS='--inspect' next dev\"\n-  }\n-}\n-```\n+> **Good to know**: Use `--inspect=0.0.0.0` to allow remote debugging access outside localhost, such as when running the app in a Docker container.\n \n Launching the Next.js dev server with the `--inspect` flag will look something like this:\n \n@@ -140,22 +132,22 @@ ready - started server on 0.0.0.0:3000, url: http://localhost:3000\n For Chrome:\n \n 1. Open a new tab and visit `chrome://inspect`\n-2. Click **Configure...** to ensure both debugging ports are listed\n-3. Add both `localhost:9229` and `localhost:9230` if they're not already present\n-4. Look for your Next.js application in the **Remote Target** section\n-5. Click **inspect** to open a separate DevTools window\n-6. Go to the **Sources** tab\n+1. Look for your Next.js application in the **Remote Target** section\n+1. Click **inspect** to open a separate DevTools window\n+1. Go to the **Sources** tab\n \n For Firefox:\n \n 1. Open a new tab and visit `about:debugging`\n-2. Click **This Firefox** in the left sidebar\n-3. Under **Remote Targets**, find your Next.js application\n-4. Click **Inspect** to open the debugger\n-5. Go to the **Debugger** tab\n+1. Click **This Firefox** in the left sidebar\n+1. Under **Remote Targets**, find your Next.js application\n+1. Click **Inspect** to open the debugger\n+1. Go to the **Debugger** tab\n \n Debugging server-side code works similarly to client-side debugging. When searching for files (`Ctrl+P`/`âŒ˜+P`), your source files will have paths starting with `webpack://{application-name}/./` (where `{application-name}` will be replaced with the name of your application according to your `package.json` file).\n \n+To use `--inspect-brk` or `--inspect-wait`, you have to specify `NODE_OPTIONS` instead. e.g. `NODE_OPTIONS=--inspect-brk next dev`.\n+\n ### Inspect Server Errors with Browser DevTools\n \n When you encounter an error, inspecting the source code can help trace the root cause of errors.\n@@ -164,19 +156,7 @@ Next.js will display a Node.js icon underneath the Next.js version indicator on\n \n ### Debugging on Windows\n \n-Windows users may run into an issue when using `NODE_OPTIONS='--inspect'` as that syntax is not supported on Windows platforms. To get around this, install the [`cross-env`](https://www.npmjs.com/package/cross-env) package as a development dependency (`-D` with `npm` and `yarn`) and replace the `dev` script with the following.\n-\n-```json filename=\"package.json\"\n-{\n-  \"scripts\": {\n-    \"dev\": \"cross-env NODE_OPTIONS='--inspect' next dev\"\n-  }\n-}\n-```\n-\n-`cross-env` will set the `NODE_OPTIONS` environment variable regardless of which platform you are on (including Mac, Linux, and Windows) and allow you to debug consistently across devices and operating systems.\n-\n-> **Good to know**: Ensure Windows Defender is disabled on your machine. This external service will check _every file read_, which has been reported to greatly increase Fast Refresh time with `next dev`. This is a known issue, not related to Next.js, but it does affect Next.js development.\n+Ensure Windows Defender is disabled on your machine. This external service will check _every file read_, which has been reported to greatly increase Fast Refresh time with `next dev`. This is a known issue, not related to Next.js, but it does affect Next.js development.\n \n ## More information\n "
        },
        {
            "sha": "2b9861853eb548705af26d57c21ca7bb45d3b567",
            "filename": "packages/next/src/bin/next.ts",
            "status": "modified",
            "additions": 35,
            "deletions": 5,
            "changes": 40,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbin%2Fnext.ts?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -2,14 +2,23 @@\n \n import '../server/require-hook'\n \n-import { Argument, Command, Option } from 'next/dist/compiled/commander'\n+import {\n+  Argument,\n+  Command,\n+  InvalidArgumentError,\n+  Option,\n+} from 'next/dist/compiled/commander'\n \n import { warn } from '../build/output/log'\n import semver from 'next/dist/compiled/semver'\n import { bold, cyan, italic } from '../lib/picocolors'\n import { formatCliHelpOutput } from '../lib/format-cli-help-output'\n import { NON_STANDARD_NODE_ENV } from '../lib/constants'\n-import { parseValidPositiveInteger } from '../server/lib/utils'\n+import {\n+  getParsedDebugAddress,\n+  parseValidPositiveInteger,\n+  type DebugAddress,\n+} from '../server/lib/utils'\n import {\n   SUPPORTED_TEST_RUNNERS_LIST,\n   type NextTestOptions,\n@@ -57,8 +66,6 @@ class NextRootCommand extends Command {\n   createCommand(name: string) {\n     const command = new Command(name)\n \n-    command.addOption(new Option('--inspect').hideHelp())\n-\n     command.hook('preAction', (event) => {\n       const commandName = event.name()\n       const defaultEnv = commandName === 'dev' ? 'development' : 'production'\n@@ -81,7 +88,7 @@ class NextRootCommand extends Command {\n       ;(process.env as any).NODE_ENV = process.env.NODE_ENV || defaultEnv\n       ;(process.env as any).NEXT_RUNTIME = 'nodejs'\n \n-      if (event.getOptionValue('inspect') === true) {\n+      if (commandName !== 'dev' && event.getOptionValue('inspect') === true) {\n         console.error(\n           `\\`--inspect\\` flag is deprecated. Use env variable NODE_OPTIONS instead: NODE_OPTIONS='--inspect' next ${commandName}`\n         )\n@@ -93,6 +100,22 @@ class NextRootCommand extends Command {\n   }\n }\n \n+function parseValidInspectAddress(value: string): DebugAddress {\n+  const address = getParsedDebugAddress(value)\n+\n+  if (Number.isNaN(address.port)) {\n+    throw new InvalidArgumentError(\n+      'The given value is not a valid inspect address. ' +\n+        'Did you mean to pass an app path?\\n' +\n+        `Try switching the order of the arguments or set the default address explicitly e.g.\\n` +\n+        `next dev ${value} --inspect\\n` +\n+        `next dev --inspect= ${value}`\n+    )\n+  }\n+\n+  return address\n+}\n+\n const program = new NextRootCommand()\n \n program\n@@ -162,6 +185,7 @@ program\n     if (options.experimentalNextConfigStripTypes) {\n       process.env.__NEXT_NODE_NATIVE_TS_LOADER_ENABLED = 'true'\n     }\n+\n     // ensure process exits after build completes so open handles/connections\n     // don't cause process to hang\n     return import('../cli/next-build.js').then((mod) =>\n@@ -181,6 +205,12 @@ program\n       'If no directory is provided, the current directory will be used.'\n     )}`\n   )\n+  .addOption(\n+    new Option(\n+      '--inspect [[host:]port]',\n+      'Allows inspecting server-side code. See https://nextjs.org/docs/app/guides/debugging#server-side-code'\n+    ).argParser(parseValidInspectAddress)\n+  )\n   .option('--turbo', 'Starts development mode using Turbopack.')\n   .option('--turbopack', 'Starts development mode using Turbopack.')\n   .option('--webpack', 'Starts development mode using webpack.')"
        },
        {
            "sha": "43408c87c764fb055f8e7564d15ee2649a9600e6",
            "filename": "packages/next/src/cli/next-dev.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 5,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fcli%2Fnext-dev.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fcli%2Fnext-dev.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fcli%2Fnext-dev.ts?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -7,10 +7,11 @@ import {\n   getNodeDebugType,\n   getParsedDebugAddress,\n   getMaxOldSpaceSize,\n-  getParsedNodeOptionsWithoutInspect,\n   printAndExit,\n   formatNodeOptions,\n   formatDebugAddress,\n+  getParsedNodeOptions,\n+  type DebugAddress,\n } from '../server/lib/utils'\n import * as Log from '../build/output/log'\n import { getProjectDir } from '../lib/get-project-dir'\n@@ -46,6 +47,8 @@ import {\n \n export type NextDevOptions = {\n   disableSourceMaps: boolean\n+  // Commander is not putting `--inspect` through the arg parser\n+  inspect?: DebugAddress | true\n   turbo?: boolean\n   turbopack?: boolean\n   webpack?: boolean\n@@ -259,8 +262,7 @@ const nextDev = async (\n       let resolved = false\n       const defaultEnv = (initialEnv || process.env) as typeof process.env\n \n-      const nodeOptions = getParsedNodeOptionsWithoutInspect()\n-      const nodeDebugType = getNodeDebugType()\n+      const nodeOptions = getParsedNodeOptions()\n \n       let maxOldSpaceSize: string | number | undefined = getMaxOldSpaceSize()\n       if (!maxOldSpaceSize && !process.env.NEXT_DISABLE_MEM_OVERRIDE) {\n@@ -280,10 +282,22 @@ const nextDev = async (\n         nodeOptions['enable-source-maps'] = true\n       }\n \n-      if (nodeDebugType) {\n-        const address = getParsedDebugAddress()\n+      const nodeDebugType = getNodeDebugType(nodeOptions)\n+      const originalAddress =\n+        nodeDebugType === undefined ? undefined : nodeOptions[nodeDebugType]\n+      delete nodeOptions.inspect\n+      delete nodeOptions['inspect-brk']\n+      delete nodeOptions['inspect_brk']\n+      if (nodeDebugType !== undefined) {\n+        const address = getParsedDebugAddress(originalAddress)\n         address.port = address.port === 0 ? 0 : address.port + 1\n         nodeOptions[nodeDebugType] = formatDebugAddress(address)\n+      } else if (options.inspect) {\n+        const address: DebugAddress =\n+          options.inspect === true\n+            ? getParsedDebugAddress(true)\n+            : options.inspect\n+        nodeOptions.inspect = formatDebugAddress(address)\n       }\n \n       child = fork(startServerPath, {"
        },
        {
            "sha": "f8706109d627746453d2099c00ede9d7e2f9a4c8",
            "filename": "packages/next/src/lib/worker.ts",
            "status": "modified",
            "additions": 19,
            "deletions": 12,
            "changes": 31,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Flib%2Fworker.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Flib%2Fworker.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fworker.ts?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -6,7 +6,8 @@ import {\n   formatNodeOptions,\n   getNodeDebugType,\n   getParsedDebugAddress,\n-  getParsedNodeOptionsWithoutInspect,\n+  getParsedNodeOptions,\n+  type DebugAddress,\n } from '../server/lib/utils'\n \n type FarmOptions = NonNullable<ConstructorParameters<typeof JestWorker>[1]>\n@@ -78,19 +79,25 @@ export class Worker {\n       this.close()\n     })\n \n-    const nodeOptions = getParsedNodeOptionsWithoutInspect()\n-\n+    const nodeOptions = getParsedNodeOptions()\n+    const originalOptions = { ...nodeOptions }\n+    delete nodeOptions.inspect\n+    delete nodeOptions['inspect-brk']\n+    delete nodeOptions['inspect_brk']\n     if (debuggerPortOffset !== -1) {\n-      const nodeDebugType = getNodeDebugType()\n+      const nodeDebugType = getNodeDebugType(originalOptions)\n       if (nodeDebugType) {\n-        const address = getParsedDebugAddress()\n-        address.port =\n-          address.port === 0\n-            ? 0\n-            : address.port +\n-              // current process runs on `address.port`\n-              1 +\n-              debuggerPortOffset\n+        const debuggerAddress = getParsedDebugAddress(\n+          originalOptions[nodeDebugType]\n+        )\n+        const address: DebugAddress = {\n+          host: debuggerAddress.host,\n+          // current process runs on `address.port`\n+          port:\n+            debuggerAddress.port === 0\n+              ? 0\n+              : debuggerAddress.port + 1 + debuggerPortOffset,\n+        }\n         nodeOptions[nodeDebugType] = formatDebugAddress(address)\n       }\n     }"
        },
        {
            "sha": "7036ff0c88bb87cf9828d896732f95e6500090dc",
            "filename": "packages/next/src/server/dev/hot-reloader-turbopack.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-turbopack.ts?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -78,7 +78,7 @@ import { generateEncryptionKeyBase64 } from '../app-render/encryption-utils-serv\n import { isAppPageRouteDefinition } from '../route-definitions/app-page-route-definition'\n import { normalizeAppPath } from '../../shared/lib/router/utils/app-paths'\n import type { ModernSourceMapPayload } from '../lib/source-maps'\n-import { getNodeDebugType } from '../lib/utils'\n+import { getNodeDebugType, getParsedNodeOptions } from '../lib/utils'\n import { isMetadataRouteFile } from '../../lib/metadata/is-metadata-route'\n import { setBundlerFindSourceMapImplementation } from '../patch-error-inspect'\n import { getNextErrorFeedbackMiddleware } from '../../next-devtools/server/get-next-error-feedback-middleware'\n@@ -810,7 +810,8 @@ export async function createHotReloaderTurbopack(\n   }\n \n   let devtoolsFrontendUrl: string | undefined\n-  const nodeDebugType = getNodeDebugType()\n+  const nodeOptions = getParsedNodeOptions()\n+  const nodeDebugType = getNodeDebugType(nodeOptions)\n   if (nodeDebugType) {\n     const debugPort = process.debugPort\n     let debugInfo"
        },
        {
            "sha": "1d8061ad1c0f8fcb7e057fa751cf32b4e88559cb",
            "filename": "packages/next/src/server/dev/hot-reloader-webpack.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 2,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fdev%2Fhot-reloader-webpack.ts?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -81,7 +81,7 @@ import type { HmrMessageSentToBrowser } from './hot-reloader-types'\n import type { WebpackError } from 'webpack'\n import { PAGE_TYPES } from '../../lib/page-types'\n import { FAST_REFRESH_RUNTIME_RELOAD } from './messages'\n-import { getNodeDebugType } from '../lib/utils'\n+import { getNodeDebugType, getParsedNodeOptions } from '../lib/utils'\n import { getNextErrorFeedbackMiddleware } from '../../next-devtools/server/get-next-error-feedback-middleware'\n import { getDevOverlayFontMiddleware } from '../../next-devtools/server/font/get-dev-overlay-font-middleware'\n import { getDisableDevIndicatorMiddleware } from '../../next-devtools/server/dev-indicator-middleware'\n@@ -860,7 +860,8 @@ export default class HotReloaderWebpack implements NextJsHotReloaderInterface {\n \n     this.versionInfo = await this.tracedGetVersionInfo(startSpan)\n \n-    const nodeDebugType = getNodeDebugType()\n+    const nodeOptions = getParsedNodeOptions()\n+    const nodeDebugType = getNodeDebugType(nodeOptions)\n     if (nodeDebugType && !this.devtoolsFrontendUrl) {\n       const debugPort = process.debugPort\n       let debugInfo"
        },
        {
            "sha": "a76380968a3eab4df72c242e8f5613d9f3335087",
            "filename": "packages/next/src/server/lib/app-info-log.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 2,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fapp-info-log.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fapp-info-log.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fapp-info-log.ts?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -1,4 +1,5 @@\n import { loadEnvConfig } from '@next/env'\n+import * as inspector from 'inspector'\n import * as Log from '../../build/output/log'\n import { bold, purple, strikethrough } from '../../lib/picocolors'\n import {\n@@ -50,10 +51,19 @@ export function logStartInfo({\n     )}${versionSuffix}`\n   )\n   if (appUrl) {\n-    Log.bootstrap(`- Local:        ${appUrl}`)\n+    Log.bootstrap(`- Local:         ${appUrl}`)\n   }\n   if (networkUrl) {\n-    Log.bootstrap(`- Network:      ${networkUrl}`)\n+    Log.bootstrap(`- Network:       ${networkUrl}`)\n+  }\n+  const inspectorUrl = inspector.url()\n+  if (inspectorUrl) {\n+    // Could also parse this port from the inspector URL.\n+    // process.debugPort will always be defined even if the process is not being inspected.\n+    // The full URL seems noisy as far as I can tell.\n+    // Node.js will print the full URL anyway.\n+    const debugPort = process.debugPort\n+    Log.bootstrap(`- Debugger port: ${debugPort}`)\n   }\n   if (envInfo?.length) Log.bootstrap(`- Environments: ${envInfo.join(', ')}`)\n "
        },
        {
            "sha": "a593e52d2c8ffd2385c565cf11aabb69d09d209c",
            "filename": "packages/next/src/server/lib/start-server.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 19,
            "changes": 20,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fstart-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fstart-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Fstart-server.ts?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -22,12 +22,7 @@ import { exec } from 'child_process'\n import Watchpack from 'next/dist/compiled/watchpack'\n import * as Log from '../../build/output/log'\n import setupDebug from 'next/dist/compiled/debug'\n-import {\n-  RESTART_EXIT_CODE,\n-  getFormattedDebugAddress,\n-  getNodeDebugType,\n-  isDebugAddressEphemeral,\n-} from './utils'\n+import { RESTART_EXIT_CODE } from './utils'\n import { formatHostname } from './format-hostname'\n import { initialize } from './router-server'\n import { CONFIG_FILES } from '../../shared/lib/constants'\n@@ -305,8 +300,6 @@ export async function startServer(\n \n   await new Promise<void>((resolve) => {\n     server.on('listening', async () => {\n-      const nodeDebugType = getNodeDebugType()\n-\n       const addr = server.address()\n       const actualHostname = formatHostname(\n         typeof addr === 'object'\n@@ -346,17 +339,6 @@ export async function startServer(\n \n       const appUrl = `${protocol}://${formattedHostname}:${port}`\n \n-      if (nodeDebugType) {\n-        const formattedDebugAddress = getFormattedDebugAddress()\n-        const isEphemeral = isDebugAddressEphemeral()\n-        Log.info(\n-          `the --${nodeDebugType} option was detected` +\n-            (isEphemeral\n-              ? ''\n-              : `, the Next.js router server should be inspected at ${formattedDebugAddress}.`)\n-        )\n-      }\n-\n       // Store the selected port to:\n       // - expose it to render workers\n       // - re-use it for automatic dev server restarts with a randomly selected port"
        },
        {
            "sha": "cac551cd3b091ecebcd2d1b6925f805c868fbc5f",
            "filename": "packages/next/src/server/lib/utils.test.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 2,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Futils.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Futils.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Futils.test.ts?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -3,6 +3,7 @@ import {\n   getParsedDebugAddress,\n   formatNodeOptions,\n   tokenizeArgs,\n+  getParsedNodeOptions,\n } from './utils'\n \n const originalNodeOptions = process.env.NODE_OPTIONS\n@@ -56,13 +57,15 @@ describe('formatNodeOptions', () => {\n describe('getParsedDebugAddress', () => {\n   it('supports the flag with an equal sign', () => {\n     process.env.NODE_OPTIONS = '--inspect=1234'\n-    const result = getParsedDebugAddress()\n+    const nodeOptions = getParsedNodeOptions()\n+    const result = getParsedDebugAddress(nodeOptions.inspect)\n     expect(result).toEqual({ host: undefined, port: 1234 })\n   })\n \n   it('supports the flag without an equal sign', () => {\n     process.env.NODE_OPTIONS = '--inspect 1234'\n-    const result = getParsedDebugAddress()\n+    const nodeOptions = getParsedNodeOptions()\n+    const result = getParsedDebugAddress(nodeOptions.inspect)\n     expect(result).toEqual({ host: undefined, port: 1234 })\n   })\n })"
        },
        {
            "sha": "189a025e302212b893c58e2a7842c11f15b1b4b0",
            "filename": "packages/next/src/server/lib/utils.ts",
            "status": "modified",
            "additions": 24,
            "deletions": 37,
            "changes": 61,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Flib%2Futils.ts?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -11,7 +11,9 @@ export function printAndExit(message: string, code = 1) {\n   return process.exit(code)\n }\n \n-const parseNodeArgs = (args: string[]) => {\n+export type NodeOptions = Record<string, string | boolean | undefined>\n+\n+const parseNodeArgs = (args: string[]): NodeOptions => {\n   const { values, tokens } = parseArgs({ args, strict: false, tokens: true })\n \n   // For the `NODE_OPTIONS`, we support arguments with values without the `=`\n@@ -127,7 +129,7 @@ export const getNodeOptionsArgs = () => {\n /**\n  * The debug address is in the form of `[host:]port`. The host is optional.\n  */\n-type DebugAddress = {\n+export interface DebugAddress {\n   host: string | undefined\n   port: number\n }\n@@ -147,17 +149,9 @@ export const formatDebugAddress = ({ host, port }: DebugAddress): string => {\n  *\n  * @returns An object with the host and port of the debug address.\n  */\n-export const getParsedDebugAddress = (): DebugAddress => {\n-  const args = getNodeOptionsArgs()\n-  if (args.length === 0) return { host: undefined, port: 9229 }\n-\n-  const parsed = parseNodeArgs(args)\n-\n-  // We expect to find the debug port in one of these options. The first one\n-  // found will be used.\n-  const address =\n-    parsed.inspect ?? parsed['inspect-brk'] ?? parsed['inspect_brk']\n-\n+export const getParsedDebugAddress = (\n+  address: string | boolean | undefined\n+): DebugAddress => {\n   if (!address || typeof address !== 'string') {\n     return { host: undefined, port: 9229 }\n   }\n@@ -171,22 +165,6 @@ export const getParsedDebugAddress = (): DebugAddress => {\n   return { host: undefined, port: parseInt(address, 10) }\n }\n \n-/**\n- * Checks if the debug address from `NODE_OPTIONS` specifies to use a random port (e.g., the port set to 0).\n- *\n- * @returns A boolean indicating whether or not the debug address is assigned to a random port.\n- */\n-export const isDebugAddressEphemeral = () => getParsedDebugAddress()?.port === 0\n-\n-/**\n- * Get the debug address from the `NODE_OPTIONS` environment variable and format\n- * it into a string.\n- *\n- * @returns A string with the formatted debug address.\n- */\n-export const getFormattedDebugAddress = () =>\n-  formatDebugAddress(getParsedDebugAddress())\n-\n /**\n  * Stringify the arguments to be used in a command line. It will ignore any\n  * argument that has a value of `undefined`.\n@@ -219,6 +197,16 @@ export function formatNodeOptions(\n     .join(' ')\n }\n \n+export function getParsedNodeOptions(): Record<\n+  string,\n+  string | boolean | undefined\n+> {\n+  const args = [...process.execArgv, ...getNodeOptionsArgs()]\n+  if (args.length === 0) return {}\n+\n+  return parseNodeArgs(args)\n+}\n+\n /**\n  * Get the node options from the `NODE_OPTIONS` environment variable and parse\n  * them into an object without the inspect options.\n@@ -273,14 +261,13 @@ export type NodeInspectType = 'inspect' | 'inspect-brk' | undefined\n /**\n  * Get the debug type from the `NODE_OPTIONS` environment variable.\n  */\n-export function getNodeDebugType(): NodeInspectType {\n-  const args = [...process.execArgv, ...getNodeOptionsArgs()]\n-  if (args.length === 0) return\n-\n-  const parsed = parseNodeArgs(args)\n-\n-  if (parsed.inspect) return 'inspect'\n-  if (parsed['inspect-brk'] || parsed['inspect_brk']) return 'inspect-brk'\n+export function getNodeDebugType(nodeOptions: NodeOptions): NodeInspectType {\n+  if (nodeOptions.inspect) {\n+    return 'inspect'\n+  }\n+  if (nodeOptions['inspect-brk'] || nodeOptions['inspect_brk']) {\n+    return 'inspect-brk'\n+  }\n }\n \n /**"
        },
        {
            "sha": "e8ce1f0035620667e4d3358ec1049f74191a4f6b",
            "filename": "test/integration/cli/test/index.test.js",
            "status": "modified",
            "additions": 80,
            "deletions": 4,
            "changes": 84,
            "blob_url": "https://github.com/vercel/next.js/blob/1e53071f778ac79f78979e497fad40c13dee759f/test%2Fintegration%2Fcli%2Ftest%2Findex.test.js",
            "raw_url": "https://github.com/vercel/next.js/raw/1e53071f778ac79f78979e497fad40c13dee759f/test%2Fintegration%2Fcli%2Ftest%2Findex.test.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fintegration%2Fcli%2Ftest%2Findex.test.js?ref=1e53071f778ac79f78979e497fad40c13dee759f",
            "patch": "@@ -561,11 +561,87 @@ describe('CLI Usage', () => {\n       )\n       try {\n         await check(() => output, new RegExp(`http://localhost:${port}`))\n+        await check(() => output, /- Debugger port:\\s+\\d+/)\n+        await check(() => errOutput, /Debugger listening on/)\n+        expect(errOutput).not.toContain('address already in use')\n+      } finally {\n+        await killApp(app)\n+      }\n+    })\n+\n+    test('--inspect', async () => {\n+      const port = await findPort()\n+      let output = ''\n+      let errOutput = ''\n+      const app = await runNextCommandDev(\n+        [dirBasic, '--port', port, '--inspect'],\n+        undefined,\n+        {\n+          onStdout(msg) {\n+            output += stripAnsi(msg)\n+          },\n+          onStderr(msg) {\n+            errOutput += stripAnsi(msg)\n+          },\n+        }\n+      )\n+      try {\n+        await check(() => output, new RegExp(`http://localhost:${port}`))\n+        await check(() => output, /- Debugger port:\\s+9229/)\n+        await check(() => errOutput, /Debugger listening on/)\n+        expect(errOutput).not.toContain('address already in use')\n+      } finally {\n+        await killApp(app)\n+      }\n+    })\n+\n+    test('--inspect 0', async () => {\n+      const port = await findPort()\n+      let output = ''\n+      let errOutput = ''\n+      const app = await runNextCommandDev(\n+        [dirBasic, '--port', port, '--inspect', '0'],\n+        undefined,\n+        {\n+          onStdout(msg) {\n+            output += stripAnsi(msg)\n+          },\n+          onStderr(msg) {\n+            errOutput += stripAnsi(msg)\n+          },\n+        }\n+      )\n+      try {\n+        await check(() => output, new RegExp(`http://localhost:${port}`))\n+        await check(() => output, /- Debugger port:\\s+\\d+/)\n+        await check(() => errOutput, /Debugger listening on/)\n+        expect(errOutput).not.toContain('address already in use')\n+      } finally {\n+        await killApp(app)\n+      }\n+    })\n+\n+    test('--inspect [port]', async () => {\n+      const port = await findPort()\n+      let output = ''\n+      let errOutput = ''\n+      const app = await runNextCommandDev(\n+        [dirBasic, '--port', port, '--inspect', '9230'],\n+        undefined,\n+        {\n+          onStdout(msg) {\n+            output += stripAnsi(msg)\n+          },\n+          onStderr(msg) {\n+            errOutput += stripAnsi(msg)\n+          },\n+        }\n+      )\n+      try {\n+        await check(() => output, new RegExp(`http://localhost:${port}`))\n+        await check(() => output, /- Debugger port:\\s+9230/)\n         await check(() => errOutput, /Debugger listening on/)\n         expect(errOutput).not.toContain('address already in use')\n-        expect(output).toContain(\n-          'the --inspect option was detected, the Next.js router server should be inspected at'\n-        )\n       } finally {\n         await killApp(app)\n       }\n@@ -590,11 +666,11 @@ describe('CLI Usage', () => {\n       )\n       try {\n         await check(() => output, new RegExp(`http://localhost:${port}`))\n+        await check(() => output, /- Debugger port:\\s+\\d+/)\n         await check(() => errOutput, /Debugger listening on/)\n         expect(errOutput).not.toContain('address already in use')\n         expect(errOutput).toContain('Debugger listening on')\n         console.log(output)\n-        expect(output).toContain('the --inspect option was detected')\n       } finally {\n         await killApp(app)\n       }"
        }
    ],
    "stats": {
        "total": 341,
        "additions": 216,
        "deletions": 125
    }
}