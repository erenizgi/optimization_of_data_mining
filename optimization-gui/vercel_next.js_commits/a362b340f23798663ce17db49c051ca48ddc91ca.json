{
    "author": "devjiwonchoi",
    "message": "[devtools] port devtools-indicator position to dispatcher (#80536)\n\n### Why?\r\n\r\nSince the DevTools Panel and the DevTools Indicator are decoupled, use the dispatcher to communicate the indicator position from the DevTools Panel (Settings tab).",
    "sha": "a362b340f23798663ce17db49c051ca48ddc91ca",
    "files": [
        {
            "sha": "ec4524dc4588d723ae943c1bcfd8d0c086b1d6d7",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/devtools-indicator/devtools-indicator.tsx",
            "status": "modified",
            "additions": 7,
            "deletions": 5,
            "changes": 12,
            "blob_url": "https://github.com/vercel/next.js/blob/a362b340f23798663ce17db49c051ca48ddc91ca/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a362b340f23798663ce17db49c051ca48ddc91ca/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Fdevtools-indicator%2Fdevtools-indicator.tsx?ref=a362b340f23798663ce17db49c051ca48ddc91ca",
            "patch": "@@ -15,8 +15,8 @@ import {\n   ACTION_ERROR_OVERLAY_CLOSE,\n   STORAGE_KEY_POSITION,\n   ACTION_DEVTOOLS_PANEL_CLOSE,\n+  ACTION_DEVTOOLS_POSITION,\n } from '../../shared'\n-import { getInitialPosition } from '../errors/dev-tools-indicator/dev-tools-info/preferences'\n import { Draggable } from '../errors/dev-tools-indicator/draggable'\n \n const INDICATOR_PADDING = 20\n@@ -35,9 +35,8 @@ export function DevToolsIndicator({\n   scale: DevToolsScale\n }) {\n   const [open, setOpen] = useState(false)\n-  const [position, setPosition] = useState(getInitialPosition())\n \n-  const [vertical, horizontal] = position.split('-', 2)\n+  const [vertical, horizontal] = state.devToolsPosition.split('-', 2)\n \n   const toggleErrorOverlay = () => {\n     dispatch({ type: ACTION_DEVTOOLS_PANEL_CLOSE })\n@@ -66,10 +65,13 @@ export function DevToolsIndicator({\n       <Draggable\n         padding={INDICATOR_PADDING}\n         onDragStart={() => setOpen(false)}\n-        position={position}\n+        position={state.devToolsPosition}\n         setPosition={(p) => {\n+          dispatch({\n+            type: ACTION_DEVTOOLS_POSITION,\n+            devToolsPosition: p,\n+          })\n           localStorage.setItem(STORAGE_KEY_POSITION, p)\n-          setPosition(p)\n         }}\n       >\n         {/* Trigger */}"
        },
        {
            "sha": "d698c5bbdf013f3f30bf8596fba53e5d04286311",
            "filename": "packages/next/src/next-devtools/dev-overlay/components/errors/dev-tools-indicator/dev-tools-indicator.stories.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/a362b340f23798663ce17db49c051ca48ddc91ca/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a362b340f23798663ce17db49c051ca48ddc91ca/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fcomponents%2Ferrors%2Fdev-tools-indicator%2Fdev-tools-indicator.stories.tsx?ref=a362b340f23798663ce17db49c051ca48ddc91ca",
            "patch": "@@ -61,6 +61,7 @@ const state: OverlayState = {\n   isErrorOverlayOpen: false,\n   // TODO: This will be handled on the next stack——with proper story.\n   isDevToolsPanelOpen: false,\n+  devToolsPosition: 'bottom-left',\n }\n \n export const StaticRoute: Story = {"
        },
        {
            "sha": "91939660efe1f2651026f58486ef0f11a5ad4fb2",
            "filename": "packages/next/src/next-devtools/dev-overlay/dev-overlay.stories.tsx",
            "status": "modified",
            "additions": 9,
            "deletions": 0,
            "changes": 9,
            "blob_url": "https://github.com/vercel/next.js/blob/a362b340f23798663ce17db49c051ca48ddc91ca/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/a362b340f23798663ce17db49c051ca48ddc91ca/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fdev-overlay.stories.tsx?ref=a362b340f23798663ce17db49c051ca48ddc91ca",
            "patch": "@@ -7,6 +7,8 @@ import imgApp from './app.png'\n import { useReducer } from 'react'\n import { DevOverlay } from './dev-overlay'\n import {\n+  ACTION_DEVTOOLS_POSITION,\n+  ACTION_DEVTOOLS_PANEL_CLOSE,\n   ACTION_DEVTOOLS_PANEL_TOGGLE,\n   ACTION_ERROR_OVERLAY_CLOSE,\n   ACTION_ERROR_OVERLAY_OPEN,\n@@ -96,6 +98,7 @@ const initialState: OverlayState = {\n   },\n   isErrorOverlayOpen: false,\n   isDevToolsPanelOpen: false,\n+  devToolsPosition: 'bottom-left',\n }\n \n function useOverlayReducer() {\n@@ -114,6 +117,12 @@ function useOverlayReducer() {\n         case ACTION_DEVTOOLS_PANEL_TOGGLE: {\n           return { ...state, isDevToolsPanelOpen: !state.isDevToolsPanelOpen }\n         }\n+        case ACTION_DEVTOOLS_PANEL_CLOSE: {\n+          return { ...state, isDevToolsPanelOpen: false }\n+        }\n+        case ACTION_DEVTOOLS_POSITION: {\n+          return { ...state, devToolsPosition: action.devToolsPosition }\n+        }\n         default: {\n           return state\n         }"
        },
        {
            "sha": "b5604e1417649e40bd8ac47aa0500fc9478c9bfc",
            "filename": "packages/next/src/next-devtools/dev-overlay/shared.ts",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/a362b340f23798663ce17db49c051ca48ddc91ca/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/a362b340f23798663ce17db49c051ca48ddc91ca/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fnext-devtools%2Fdev-overlay%2Fshared.ts?ref=a362b340f23798663ce17db49c051ca48ddc91ca",
            "patch": "@@ -8,6 +8,8 @@ import type { DevIndicatorServerState } from '../../server/dev/dev-indicator-ser\n import { parseStack } from '../../server/lib/parse-stack'\n import { isConsoleError } from '../shared/console-error'\n \n+export type Corners = 'top-left' | 'top-right' | 'bottom-left' | 'bottom-right'\n+\n type FastRefreshState =\n   /** No refresh in progress. */\n   | { type: 'idle' }\n@@ -30,6 +32,7 @@ export interface OverlayState {\n   routerType: 'pages' | 'app'\n   isErrorOverlayOpen: boolean\n   isDevToolsPanelOpen: boolean\n+  devToolsPosition: Corners\n }\n export type OverlayDispatch = React.Dispatch<DispatcherEvent>\n \n@@ -57,6 +60,8 @@ export const ACTION_DEVTOOLS_PANEL_OPEN = 'devtools-panel-open'\n export const ACTION_DEVTOOLS_PANEL_CLOSE = 'devtools-panel-close'\n export const ACTION_DEVTOOLS_PANEL_TOGGLE = 'devtools-panel-toggle'\n \n+export const ACTION_DEVTOOLS_POSITION = 'devtools-position'\n+\n export const STORAGE_KEY_THEME = '__nextjs-dev-tools-theme'\n export const STORAGE_KEY_POSITION = '__nextjs-dev-tools-position'\n export const STORAGE_KEY_SCALE = '__nextjs-dev-tools-scale'\n@@ -138,6 +143,11 @@ export interface DevToolsPanelToggleAction {\n   type: typeof ACTION_DEVTOOLS_PANEL_TOGGLE\n }\n \n+export interface DevToolsIndicatorPositionAction {\n+  type: typeof ACTION_DEVTOOLS_POSITION\n+  devToolsPosition: Corners\n+}\n+\n export type DispatcherEvent =\n   | BuildOkAction\n   | BuildErrorAction\n@@ -159,6 +169,7 @@ export type DispatcherEvent =\n   | DevToolsPanelOpenAction\n   | DevToolsPanelCloseAction\n   | DevToolsPanelToggleAction\n+  | DevToolsIndicatorPositionAction\n \n const REACT_ERROR_STACK_BOTTOM_FRAME_REGEX =\n   // 1st group: v8\n@@ -198,6 +209,7 @@ export const INITIAL_OVERLAY_STATE: Omit<\n   versionInfo: { installed: '0.0.0', staleness: 'unknown' },\n   debugInfo: { devtoolsFrontendUrl: undefined },\n   isDevToolsPanelOpen: false,\n+  devToolsPosition: 'bottom-left',\n }\n \n function getInitialState(\n@@ -369,6 +381,9 @@ export function useErrorOverlayReducer(\n         case ACTION_DEVTOOLS_PANEL_TOGGLE: {\n           return { ...state, isDevToolsPanelOpen: !state.isDevToolsPanelOpen }\n         }\n+        case ACTION_DEVTOOLS_POSITION: {\n+          return { ...state, devToolsPosition: action.devToolsPosition }\n+        }\n         default: {\n           return state\n         }"
        }
    ],
    "stats": {
        "total": 37,
        "additions": 32,
        "deletions": 5
    }
}