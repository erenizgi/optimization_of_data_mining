{
    "author": "acdlite",
    "message": "Uninstall existing uncaughtException listeners to prevent the process from crashing (#78042)\n\nThis broadens the scope of the `removeUnhandledRejectionListeners` flag\nto also remove `uncaughtException` listeners.\n\nThe motivation is the same: uncaught exceptions in one part of the page\nshould not prevent the rest of the page from rendering.\n\nSee https://github.com/vercel/next.js/pull/77997 for more context.\n\nI renamed the experimental flag to\n`removeUncaughtErrorAndRejectionListeners` to better reflect increased\nscope but the name isn't really that important since at this stage we\njust need to try out the behavior; it isn't documented anywhere.",
    "sha": "9cac73ca5e75197591339bbac60a1da93353cdde",
    "files": [
        {
            "sha": "6db12ca87290e53c008f9e76a64c30870f5886cd",
            "filename": "packages/next/src/server/config-schema.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/9cac73ca5e75197591339bbac60a1da93353cdde/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9cac73ca5e75197591339bbac60a1da93353cdde/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-schema.ts?ref=9cac73ca5e75197591339bbac60a1da93353cdde",
            "patch": "@@ -390,7 +390,7 @@ export const configSchema: zod.ZodType<NextConfig> = z.lazy(() =>\n         prerenderEarlyExit: z.boolean().optional(),\n         proxyTimeout: z.number().gte(0).optional(),\n         routerBFCache: z.boolean().optional(),\n-        removeUnhandledRejectionListeners: z.boolean().optional(),\n+        removeUncaughtErrorAndRejectionListeners: z.boolean().optional(),\n         scrollRestoration: z.boolean().optional(),\n         sri: z\n           .object({"
        },
        {
            "sha": "fc8c63442106ba3f07cfed9ac61090ee97a1a2ff",
            "filename": "packages/next/src/server/config-shared.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 5,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/9cac73ca5e75197591339bbac60a1da93353cdde/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9cac73ca5e75197591339bbac60a1da93353cdde/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fconfig-shared.ts?ref=9cac73ca5e75197591339bbac60a1da93353cdde",
            "patch": "@@ -510,14 +510,14 @@ export interface ExperimentalConfig {\n   routerBFCache?: boolean\n \n   /**\n-   * Uninstalls all \"unhandledRejection\" listeners from the global process so\n-   * that we can override the behavior, which in some runtimes is to exit the\n-   * process on an unhandled rejection.\n+   * Uninstalls all \"unhandledRejection\" and \"uncaughtException\" listeners from\n+   * the global process so that we can override the behavior, which in some\n+   * runtimes is to exit the process.\n    *\n    * This is experimental until we've considered the impact in various\n    * deployment environments.\n    */\n-  removeUnhandledRejectionListeners?: boolean\n+  removeUncaughtErrorAndRejectionListeners?: boolean\n \n   serverActions?: {\n     /**\n@@ -1312,7 +1312,7 @@ export const defaultConfig: NextConfig = {\n     useEarlyImport: false,\n     viewTransition: false,\n     routerBFCache: false,\n-    removeUnhandledRejectionListeners: false,\n+    removeUncaughtErrorAndRejectionListeners: false,\n     staleTimes: {\n       dynamic: 0,\n       static: 300,"
        },
        {
            "sha": "a08e2db8b9eba007c2a907b0489b599f41437af1",
            "filename": "packages/next/src/server/next-server.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 8,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/9cac73ca5e75197591339bbac60a1da93353cdde/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/9cac73ca5e75197591339bbac60a1da93353cdde/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fnext-server.ts?ref=9cac73ca5e75197591339bbac60a1da93353cdde",
            "patch": "@@ -161,7 +161,7 @@ function getMiddlewareMatcher(\n }\n \n function installProcessErrorHandlers(\n-  shouldRemoveUnhandledRejectionListeners: boolean\n+  shouldRemoveUncaughtErrorAndRejectionListeners: boolean\n ) {\n   // The conventional wisdom of Node.js and other runtimes is to treat\n   // unhandled errors as fatal and exit the process.\n@@ -199,11 +199,12 @@ function installProcessErrorHandlers(\n   // So, we're going to intentionally override the default error handling\n   // behavior of the outer JS runtime to be more forgiving\n \n-  // Remove any existing \"unhandledRejection\" handlers. This is gated behind\n-  // an experimental flag until we've considered the impact in various\n-  // deployment environments. It's possible this may always need to\n+  // Remove any existing \"unhandledRejection\" and \"uncaughtException\" handlers.\n+  // This is gated behind an experimental flag until we've considered the impact\n+  // in various deployment environments. It's possible this may always need to\n   // be configurable.\n-  if (shouldRemoveUnhandledRejectionListeners) {\n+  if (shouldRemoveUncaughtErrorAndRejectionListeners) {\n+    process.removeAllListeners('uncaughtException')\n     process.removeAllListeners('unhandledRejection')\n   }\n \n@@ -370,10 +371,10 @@ export default class NextNodeServer extends BaseServer<\n       populateStaticEnv(this.nextConfig)\n     }\n \n-    const shouldRemoveUnhandledRejectionListeners = Boolean(\n-      options.conf.experimental?.removeUnhandledRejectionListeners\n+    const shouldRemoveUncaughtErrorAndRejectionListeners = Boolean(\n+      options.conf.experimental?.removeUncaughtErrorAndRejectionListeners\n     )\n-    installProcessErrorHandlers(shouldRemoveUnhandledRejectionListeners)\n+    installProcessErrorHandlers(shouldRemoveUncaughtErrorAndRejectionListeners)\n   }\n \n   public async unstable_preloadEntries(): Promise<void> {"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 15,
        "deletions": 14
    }
}