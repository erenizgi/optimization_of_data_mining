{
    "author": "eps1lon",
    "message": "[test] Use new Redbox matchers in pages/ ReactRefreshRegression (#76743)",
    "sha": "b84952f0432e6f7853d3a7f1011de0b5efdf7e57",
    "files": [
        {
            "sha": "aa3e044bda653b3405e3628a5e5bfed543c7356f",
            "filename": "test/development/acceptance/ReactRefreshRegression.test.ts",
            "status": "modified",
            "additions": 34,
            "deletions": 10,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/b84952f0432e6f7853d3a7f1011de0b5efdf7e57/test%2Fdevelopment%2Facceptance%2FReactRefreshRegression.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/b84952f0432e6f7853d3a7f1011de0b5efdf7e57/test%2Fdevelopment%2Facceptance%2FReactRefreshRegression.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance%2FReactRefreshRegression.test.ts?ref=b84952f0432e6f7853d3a7f1011de0b5efdf7e57",
            "patch": "@@ -6,7 +6,7 @@ import { outdent } from 'outdent'\n import path from 'path'\n \n describe('ReactRefreshRegression', () => {\n-  const { next } = nextTestSetup({\n+  const { isTurbopack, next } = nextTestSetup({\n     files: new FileRef(path.join(__dirname, 'fixtures', 'default-template')),\n     skipStart: true,\n     dependencies: {\n@@ -268,7 +268,7 @@ describe('ReactRefreshRegression', () => {\n   // https://github.com/vercel/next.js/issues/11504\n   test('shows an overlay for a server-side error', async () => {\n     await using sandbox = await createSandbox(next)\n-    const { session } = sandbox\n+    const { browser, session } = sandbox\n \n     await session.patch(\n       'pages/index.js',\n@@ -281,14 +281,38 @@ describe('ReactRefreshRegression', () => {\n     )\n     expect(didNotReload).toBe(false)\n \n-    await session.assertHasRedbox()\n-\n-    const source = await session.getRedboxSource()\n-    expect(source.split(/\\r?\\n/g).slice(2).join('\\n').replace(/^\\n+/, ''))\n-      .toMatchInlineSnapshot(`\n-     \"> 1 | export default function () { throw new Error('boom'); }\n-         |                                    ^\"\n-    `)\n+    if (isTurbopack) {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error: boom\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Runtime Error\",\n+         \"source\": \"pages/index.js (1:36) @\n+       {default export}\n+       > 1 | export default function () { throw new Error('boom'); }\n+           |                                    ^\",\n+         \"stack\": [\n+           \"{default export} pages/index.js (1:36)\",\n+         ],\n+       }\n+      `)\n+    } else {\n+      await expect(browser).toDisplayRedbox(`\n+       {\n+         \"count\": 1,\n+         \"description\": \"Error: boom\",\n+         \"environmentLabel\": null,\n+         \"label\": \"Runtime Error\",\n+         \"source\": \"pages/index.js (1:36) @ default\n+       > 1 | export default function () { throw new Error('boom'); }\n+           |                                    ^\",\n+         \"stack\": [\n+           \"default pages/index.js (1:36)\",\n+         ],\n+       }\n+      `)\n+    }\n   })\n \n   // https://github.com/vercel/next.js/issues/13574"
        }
    ],
    "stats": {
        "total": 44,
        "additions": 34,
        "deletions": 10
    }
}