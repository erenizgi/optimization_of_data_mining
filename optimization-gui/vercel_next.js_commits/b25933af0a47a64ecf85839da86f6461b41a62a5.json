{
    "author": "mischnic",
    "message": "Turbopack: trace module.createRequire (#84335)\n\nOnly `module.createRequire(import.meta.url)` for now, but that seems to be the most popular use anyway.",
    "sha": "b25933af0a47a64ecf85839da86f6461b41a62a5",
    "files": [
        {
            "sha": "04d528de24c4e21526f5f4a1616785338567d28f",
            "filename": "turbopack/crates/turbopack-core/src/resolve/mod.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fresolve%2Fmod.rs?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -143,7 +143,7 @@ impl ExportUsage {\n }\n \n #[turbo_tasks::value(shared)]\n-#[derive(Clone)]\n+#[derive(Clone, Debug)]\n pub struct ModuleResolveResult {\n     pub primary: SliceMap<RequestKey, ModuleResolveResultItem>,\n     /// Affecting sources are other files that influence the resolve result.  For example,"
        },
        {
            "sha": "6b2334dabea335f9cd0af80198af93ad2bebdac5",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/mod.rs",
            "status": "modified",
            "additions": 30,
            "deletions": 0,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fmod.rs?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -1784,6 +1784,10 @@ impl JsValue {\n                         \"url\",\n                         \"The Node.js url module: https://nodejs.org/api/url.html\",\n                     ),\n+                    WellKnownObjectKind::ModuleModule | WellKnownObjectKind::ModuleModuleDefault => (\n+                        \"module\",\n+                        \"The Node.js `module` module: https://nodejs.org/api/module.html\",\n+                    ),\n                     WellKnownObjectKind::ChildProcess | WellKnownObjectKind::ChildProcessDefault => (\n                         \"child_process\",\n                         \"The Node.js child_process module: https://nodejs.org/api/child_process.html\",\n@@ -1886,6 +1890,10 @@ impl JsValue {\n                         \"url.pathToFileURL\".to_string(),\n                         \"The Node.js url.pathToFileURL method: https://nodejs.org/api/url.html#urlpathtofileurlpath\",\n                     ),\n+                    WellKnownFunctionKind::CreateRequire => (\n+                        \"module.createRequire\".to_string(),\n+                        \"The Node.js module.createRequire method: https://nodejs.org/api/module.html#modulecreaterequirefilename\",\n+                    ),\n                     WellKnownFunctionKind::ChildProcessSpawnMethod(name) => (\n                         format!(\"child_process.{name}\"),\n                         \"A process spawning method from the Node.js child_process module: https://nodejs.org/api/child_process.html\",\n@@ -3456,6 +3464,8 @@ pub enum WellKnownObjectKind {\n     FsModulePromises,\n     FsExtraModule,\n     FsExtraModuleDefault,\n+    ModuleModule,\n+    ModuleModuleDefault,\n     UrlModule,\n     UrlModuleDefault,\n     ChildProcess,\n@@ -3596,6 +3606,7 @@ pub enum WellKnownFunctionKind {\n     Define,\n     FsReadMethod(Atom),\n     PathToFileUrl,\n+    CreateRequire,\n     ChildProcessSpawnMethod(Atom),\n     ChildProcessFork,\n     OsArch,\n@@ -3684,6 +3695,25 @@ pub mod test_utils {\n                 }\n                 _ => v.into_unknown(true, \"import() non constant\"),\n             },\n+            JsValue::Call(\n+                _,\n+                box JsValue::WellKnownFunction(WellKnownFunctionKind::CreateRequire),\n+                ref args,\n+            ) => {\n+                if let [\n+                    JsValue::Member(\n+                        _,\n+                        box JsValue::WellKnownObject(WellKnownObjectKind::ImportMeta),\n+                        box JsValue::Constant(ConstantValue::Str(prop)),\n+                    ),\n+                ] = &args[..]\n+                    && prop.as_str() == \"url\"\n+                {\n+                    JsValue::WellKnownFunction(WellKnownFunctionKind::Require)\n+                } else {\n+                    v.into_unknown(true, \"createRequire() non constant\")\n+                }\n+            }\n             JsValue::Call(\n                 _,\n                 box JsValue::WellKnownFunction(WellKnownFunctionKind::RequireResolve),"
        },
        {
            "sha": "e23a2a96cf56b5d98fdc27213249160b3a3fdd5a",
            "filename": "turbopack/crates/turbopack-ecmascript/src/analyzer/well_known.rs",
            "status": "modified",
            "additions": 22,
            "deletions": 0,
            "changes": 22,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fwell_known.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fwell_known.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fanalyzer%2Fwell_known.rs?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -603,6 +603,9 @@ async fn well_known_object_member(\n         WellKnownObjectKind::FsExtraModule | WellKnownObjectKind::FsExtraModuleDefault => {\n             fs_extra_module_member(kind, prop)\n         }\n+        WellKnownObjectKind::ModuleModule | WellKnownObjectKind::ModuleModuleDefault => {\n+            module_module_member(kind, prop)\n+        }\n         WellKnownObjectKind::UrlModule | WellKnownObjectKind::UrlModuleDefault => {\n             url_module_member(kind, prop)\n         }\n@@ -735,6 +738,25 @@ fn fs_extra_module_member(kind: WellKnownObjectKind, prop: JsValue) -> JsValue {\n     )\n }\n \n+fn module_module_member(kind: WellKnownObjectKind, prop: JsValue) -> JsValue {\n+    match (kind, prop.as_str()) {\n+        (.., Some(\"createRequire\")) => {\n+            JsValue::WellKnownFunction(WellKnownFunctionKind::CreateRequire)\n+        }\n+        (WellKnownObjectKind::ModuleModule, Some(\"default\")) => {\n+            JsValue::WellKnownObject(WellKnownObjectKind::ModuleModuleDefault)\n+        }\n+        _ => JsValue::unknown(\n+            JsValue::member(\n+                Box::new(JsValue::WellKnownObject(WellKnownObjectKind::ModuleModule)),\n+                Box::new(prop),\n+            ),\n+            true,\n+            \"unsupported property on Node.js `module` module\",\n+        ),\n+    }\n+}\n+\n fn url_module_member(kind: WellKnownObjectKind, prop: JsValue) -> JsValue {\n     match (kind, prop.as_str()) {\n         (.., Some(\"pathToFileURL\")) => {"
        },
        {
            "sha": "c585ef3026c117372b9065d6acda1371870a1250",
            "filename": "turbopack/crates/turbopack-ecmascript/src/references/mod.rs",
            "status": "modified",
            "additions": 21,
            "deletions": 2,
            "changes": 23,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Freferences%2Fmod.rs?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -3053,6 +3053,26 @@ async fn value_visitor_inner(\n                 \"require.context() static analysis is currently limited\",\n             )\n         }\n+        JsValue::Call(\n+            _,\n+            box JsValue::WellKnownFunction(WellKnownFunctionKind::CreateRequire),\n+            ref args,\n+        ) => {\n+            // Only support `createRequire(import.meta.url)` for now\n+            if let [\n+                JsValue::Member(\n+                    _,\n+                    box JsValue::WellKnownObject(WellKnownObjectKind::ImportMeta),\n+                    box JsValue::Constant(super::analyzer::ConstantValue::Str(prop)),\n+                ),\n+            ] = &args[..]\n+                && prop.as_str() == \"url\"\n+            {\n+                JsValue::WellKnownFunction(WellKnownFunctionKind::Require)\n+            } else {\n+                v.into_unknown(true, \"createRequire() non constant\")\n+            }\n+        }\n         JsValue::New(\n             _,\n             box JsValue::WellKnownFunction(WellKnownFunctionKind::URLConstructor),\n@@ -3068,10 +3088,9 @@ async fn value_visitor_inner(\n             ] = &args[..]\n             {\n                 if prop.as_str() == \"url\" {\n-                    // TODO avoid clone\n                     JsValue::Url(url.clone(), JsValueUrlKind::Relative)\n                 } else {\n-                    v.into_unknown(true, \"new non constant\")\n+                    v.into_unknown(true, \"new URL() non constant\")\n                 }\n             } else {\n                 v.into_unknown(true, \"new non constant\")"
        },
        {
            "sha": "bb43c74c7298a5b1b8b8834d709f7171e5313f59",
            "filename": "turbopack/crates/turbopack-ecmascript/src/utils.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Futils.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Futils.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Futils.rs?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -201,6 +201,8 @@ pub fn module_value_to_well_known_object(module_value: &ModuleValue) -> Option<J\n         }\n         \"node:os\" | \"os\" => JsValue::WellKnownObject(WellKnownObjectKind::OsModule),\n         \"node:process\" | \"process\" => JsValue::WellKnownObject(WellKnownObjectKind::NodeProcess),\n+        \"node:url\" | \"url\" => JsValue::WellKnownObject(WellKnownObjectKind::UrlModule),\n+        \"node:module\" | \"module\" => JsValue::WellKnownObject(WellKnownObjectKind::ModuleModule),\n         \"node-pre-gyp\" | \"@mapbox/node-pre-gyp\" => {\n             JsValue::WellKnownObject(WellKnownObjectKind::NodePreGyp)\n         }"
        },
        {
            "sha": "617623f29559898e998e7a9dcefc811df47ad385",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/createRequire/graph-effects.snapshot",
            "status": "added",
            "additions": 1151,
            "deletions": 0,
            "changes": 1151,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fgraph-effects.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fgraph-effects.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fgraph-effects.snapshot?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -0,0 +1,1151 @@\n+[\n+    FreeVar {\n+        var: \"require\",\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    1,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Callee,\n+            ),\n+            Callee(\n+                Expr,\n+            ),\n+            Expr(\n+                Ident,\n+            ),\n+        ],\n+        span: 64..71,\n+    },\n+    Call {\n+        func: FreeVar(\n+            \"require\",\n+        ),\n+        args: [\n+            Value(\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"module\",\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    1,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 64..81,\n+        in_try: false,\n+        new: false,\n+    },\n+    Member {\n+        obj: Module(\n+            ModuleValue {\n+                module: \"node:module\",\n+                annotations: ImportAnnotations {\n+                    map: {},\n+                },\n+            },\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"createRequire\",\n+                ),\n+            ),\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    2,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Callee,\n+            ),\n+            Callee(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+        ],\n+        span: 99..122,\n+    },\n+    ImportedBinding {\n+        esm_reference_index: 1,\n+        export: Some(\n+            \"createRequire\",\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    2,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Callee,\n+            ),\n+            Callee(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+            MemberExpr(\n+                Obj,\n+            ),\n+        ],\n+        span: 99..122,\n+    },\n+    Member {\n+        obj: WellKnownObject(\n+            ImportMeta,\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"url\",\n+                ),\n+            ),\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    2,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Args(\n+                    0,\n+                ),\n+            ),\n+            ExprOrSpread(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+        ],\n+        span: 123..138,\n+    },\n+    ImportMeta {\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    2,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Args(\n+                    0,\n+                ),\n+            ),\n+            ExprOrSpread(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+            MemberExpr(\n+                Obj,\n+            ),\n+            Expr(\n+                MetaProp,\n+            ),\n+        ],\n+        span: 123..134,\n+    },\n+    MemberCall {\n+        obj: Module(\n+            ModuleValue {\n+                module: \"node:module\",\n+                annotations: ImportAnnotations {\n+                    map: {},\n+                },\n+            },\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"createRequire\",\n+                ),\n+            ),\n+        ),\n+        args: [\n+            Value(\n+                Member(\n+                    3,\n+                    WellKnownObject(\n+                        ImportMeta,\n+                    ),\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"url\",\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    2,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 99..139,\n+        in_try: false,\n+        new: false,\n+    },\n+    Call {\n+        func: Variable(\n+            (\n+                \"req_ok1\",\n+                #2,\n+            ),\n+        ),\n+        args: [\n+            Value(\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"./file1\",\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    3,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Expr,\n+            ),\n+            ExprStmt(\n+                Expr,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 140..158,\n+        in_try: false,\n+        new: false,\n+    },\n+    Member {\n+        obj: Variable(\n+            (\n+                \"moduleRequire\",\n+                #2,\n+            ),\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"createRequire\",\n+                ),\n+            ),\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    4,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Callee,\n+            ),\n+            Callee(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+        ],\n+        span: 176..203,\n+    },\n+    Member {\n+        obj: WellKnownObject(\n+            ImportMeta,\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"url\",\n+                ),\n+            ),\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    4,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Args(\n+                    0,\n+                ),\n+            ),\n+            ExprOrSpread(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+        ],\n+        span: 204..219,\n+    },\n+    ImportMeta {\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    4,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Args(\n+                    0,\n+                ),\n+            ),\n+            ExprOrSpread(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+            MemberExpr(\n+                Obj,\n+            ),\n+            Expr(\n+                MetaProp,\n+            ),\n+        ],\n+        span: 204..215,\n+    },\n+    MemberCall {\n+        obj: Variable(\n+            (\n+                \"moduleRequire\",\n+                #2,\n+            ),\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"createRequire\",\n+                ),\n+            ),\n+        ),\n+        args: [\n+            Value(\n+                Member(\n+                    3,\n+                    WellKnownObject(\n+                        ImportMeta,\n+                    ),\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"url\",\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    4,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 176..220,\n+        in_try: false,\n+        new: false,\n+    },\n+    Call {\n+        func: Variable(\n+            (\n+                \"req_ok2\",\n+                #2,\n+            ),\n+        ),\n+        args: [\n+            Value(\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"./file2\",\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    5,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Expr,\n+            ),\n+            ExprStmt(\n+                Expr,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 221..239,\n+        in_try: false,\n+        new: false,\n+    },\n+    Member {\n+        obj: Variable(\n+            (\n+                \"moduleRequire\",\n+                #2,\n+            ),\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"createRequire\",\n+                ),\n+            ),\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    6,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Callee,\n+            ),\n+            Callee(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+        ],\n+        span: 257..284,\n+    },\n+    FreeVar {\n+        var: \"__filename\",\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    6,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Args(\n+                    0,\n+                ),\n+            ),\n+            ExprOrSpread(\n+                Expr,\n+            ),\n+            Expr(\n+                Ident,\n+            ),\n+        ],\n+        span: 285..295,\n+    },\n+    MemberCall {\n+        obj: Variable(\n+            (\n+                \"moduleRequire\",\n+                #2,\n+            ),\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"createRequire\",\n+                ),\n+            ),\n+        ),\n+        args: [\n+            Value(\n+                FreeVar(\n+                    \"__filename\",\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    6,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 257..296,\n+        in_try: false,\n+        new: false,\n+    },\n+    Call {\n+        func: Variable(\n+            (\n+                \"req_ok3\",\n+                #2,\n+            ),\n+        ),\n+        args: [\n+            Value(\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"./file3\",\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    7,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Expr,\n+            ),\n+            ExprStmt(\n+                Expr,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 297..315,\n+        in_try: false,\n+        new: false,\n+    },\n+    Member {\n+        obj: Variable(\n+            (\n+                \"moduleRequire\",\n+                #2,\n+            ),\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"createRequire\",\n+                ),\n+            ),\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    8,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Callee,\n+            ),\n+            Callee(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+        ],\n+        span: 335..362,\n+    },\n+    Member {\n+        obj: FreeVar(\n+            \"globalThis\",\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"foo\",\n+                ),\n+            ),\n+        ),\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    8,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Args(\n+                    0,\n+                ),\n+            ),\n+            ExprOrSpread(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+        ],\n+        span: 363..377,\n+    },\n+    FreeVar {\n+        var: \"globalThis\",\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    8,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+            CallExpr(\n+                Args(\n+                    0,\n+                ),\n+            ),\n+            ExprOrSpread(\n+                Expr,\n+            ),\n+            Expr(\n+                Member,\n+            ),\n+            MemberExpr(\n+                Obj,\n+            ),\n+            Expr(\n+                Ident,\n+            ),\n+        ],\n+        span: 363..373,\n+    },\n+    MemberCall {\n+        obj: Variable(\n+            (\n+                \"moduleRequire\",\n+                #2,\n+            ),\n+        ),\n+        prop: Constant(\n+            Str(\n+                Atom(\n+                    \"createRequire\",\n+                ),\n+            ),\n+        ),\n+        args: [\n+            Value(\n+                Member(\n+                    3,\n+                    FreeVar(\n+                        \"globalThis\",\n+                    ),\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"foo\",\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    8,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Decl,\n+            ),\n+            Decl(\n+                Var,\n+            ),\n+            VarDecl(\n+                Decls(\n+                    0,\n+                ),\n+            ),\n+            VarDeclarator(\n+                Init,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 335..378,\n+        in_try: false,\n+        new: false,\n+    },\n+    Call {\n+        func: Variable(\n+            (\n+                \"req_fail1\",\n+                #2,\n+            ),\n+        ),\n+        args: [\n+            Value(\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"./file4\",\n+                        ),\n+                    ),\n+                ),\n+            ),\n+        ],\n+        ast_path: [\n+            Program(\n+                Module,\n+            ),\n+            Module(\n+                Body(\n+                    9,\n+                ),\n+            ),\n+            ModuleItem(\n+                Stmt,\n+            ),\n+            Stmt(\n+                Expr,\n+            ),\n+            ExprStmt(\n+                Expr,\n+            ),\n+            Expr(\n+                Call,\n+            ),\n+        ],\n+        span: 379..399,\n+        in_try: false,\n+        new: false,\n+    },\n+]"
        },
        {
            "sha": "eae57e8620f0221c87206e3dbef31774eaee18e1",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/createRequire/graph-explained.snapshot",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fgraph-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fgraph-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fgraph-explained.snapshot?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -0,0 +1,11 @@\n+moduleRequire (const after eval) = FreeVar(require)(\"module\")\n+\n+req_fail1 (const after eval) = moduleRequire[\"createRequire\"](FreeVar(globalThis)[\"foo\"])\n+\n+req_ok1 (const after eval) = module<node:module, {}>[\"createRequire\"](import.meta*0*[\"url\"])\n+- *0* import.meta: The import.meta object\n+\n+req_ok2 (const after eval) = moduleRequire[\"createRequire\"](import.meta*0*[\"url\"])\n+- *0* import.meta: The import.meta object\n+\n+req_ok3 (const after eval) = moduleRequire[\"createRequire\"](FreeVar(__filename))"
        },
        {
            "sha": "5c8932dd312cf405875ff5ce3c8a855447ae073a",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/createRequire/graph.snapshot",
            "status": "added",
            "additions": 148,
            "deletions": 0,
            "changes": 148,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fgraph.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fgraph.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fgraph.snapshot?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -0,0 +1,148 @@\n+[\n+    (\n+        \"moduleRequire\",\n+        Call(\n+            3,\n+            FreeVar(\n+                \"require\",\n+            ),\n+            [\n+                Constant(\n+                    Str(\n+                        Atom(\n+                            \"module\",\n+                        ),\n+                    ),\n+                ),\n+            ],\n+        ),\n+    ),\n+    (\n+        \"req_fail1\",\n+        MemberCall(\n+            6,\n+            Variable(\n+                (\n+                    \"moduleRequire\",\n+                    #2,\n+                ),\n+            ),\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"createRequire\",\n+                    ),\n+                ),\n+            ),\n+            [\n+                Member(\n+                    3,\n+                    FreeVar(\n+                        \"globalThis\",\n+                    ),\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"foo\",\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+            ],\n+        ),\n+    ),\n+    (\n+        \"req_ok1\",\n+        MemberCall(\n+            6,\n+            Module(\n+                ModuleValue {\n+                    module: \"node:module\",\n+                    annotations: ImportAnnotations {\n+                        map: {},\n+                    },\n+                },\n+            ),\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"createRequire\",\n+                    ),\n+                ),\n+            ),\n+            [\n+                Member(\n+                    3,\n+                    WellKnownObject(\n+                        ImportMeta,\n+                    ),\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"url\",\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+            ],\n+        ),\n+    ),\n+    (\n+        \"req_ok2\",\n+        MemberCall(\n+            6,\n+            Variable(\n+                (\n+                    \"moduleRequire\",\n+                    #2,\n+                ),\n+            ),\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"createRequire\",\n+                    ),\n+                ),\n+            ),\n+            [\n+                Member(\n+                    3,\n+                    WellKnownObject(\n+                        ImportMeta,\n+                    ),\n+                    Constant(\n+                        Str(\n+                            Atom(\n+                                \"url\",\n+                            ),\n+                        ),\n+                    ),\n+                ),\n+            ],\n+        ),\n+    ),\n+    (\n+        \"req_ok3\",\n+        MemberCall(\n+            4,\n+            Variable(\n+                (\n+                    \"moduleRequire\",\n+                    #2,\n+                ),\n+            ),\n+            Constant(\n+                Str(\n+                    Atom(\n+                        \"createRequire\",\n+                    ),\n+                ),\n+            ),\n+            [\n+                FreeVar(\n+                    \"__filename\",\n+                ),\n+            ],\n+        ),\n+    ),\n+]"
        },
        {
            "sha": "81bc6755681e944df87dc0a1955f28b7ea97afdc",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/createRequire/input.js",
            "status": "added",
            "additions": 14,
            "deletions": 0,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Finput.js",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Finput.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Finput.js?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -0,0 +1,14 @@\n+import * as moduleEsm from 'node:module'\n+const moduleRequire = require('module')\n+\n+const req_ok1 = moduleEsm.createRequire(import.meta.url)\n+req_ok1('./file1')\n+\n+const req_ok2 = moduleRequire.createRequire(import.meta.url)\n+req_ok2('./file2')\n+\n+const req_ok3 = moduleRequire.createRequire(__filename)\n+req_ok3('./file3')\n+\n+const req_fail1 = moduleRequire.createRequire(globalThis.foo)\n+req_fail1('./file4')"
        },
        {
            "sha": "972aa0f6311bc91bd42abd8b99df4c6a2463cd1f",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/createRequire/resolved-effects.snapshot",
            "status": "added",
            "additions": 52,
            "deletions": 0,
            "changes": 52,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fresolved-effects.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fresolved-effects.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fresolved-effects.snapshot?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -0,0 +1,52 @@\n+0 -> 1 free var = FreeVar(require)\n+\n+0 -> 2 call = require*0*(\"module\")\n+- *0* require: The require method from CommonJS\n+\n+0 -> 7 member call = module*0*[\"createRequire\"](import.meta*1*[\"url\"])\n+- *0* module: The Node.js `module` module: https://nodejs.org/api/module.html\n+- *1* import.meta: The import.meta object\n+\n+0 -> 8 call = require*0*(\"./file1\")\n+- *0* require: The require method from CommonJS\n+\n+0 -> 12 member call = module*0*[\"createRequire\"](import.meta*1*[\"url\"])\n+- *0* module: The Node.js `module` module: https://nodejs.org/api/module.html\n+- *1* import.meta: The import.meta object\n+\n+0 -> 13 call = require*0*(\"./file2\")\n+- *0* require: The require method from CommonJS\n+\n+0 -> 15 free var = FreeVar(__filename)\n+\n+0 -> 16 member call = module*0*[\"createRequire\"](\"__filename\")\n+- *0* module: The Node.js `module` module: https://nodejs.org/api/module.html\n+\n+0 -> 17 call = ???*0*(\"./file3\")\n+- *0* module.createRequire*1*(\"__filename\")\n+  ⚠️  createRequire() non constant\n+  ⚠️  This value might have side effects\n+- *1* module.createRequire: The Node.js module.createRequire method: https://nodejs.org/api/module.html#modulecreaterequirefilename\n+\n+0 -> 20 free var = FreeVar(globalThis)\n+\n+0 -> 21 member call = module*0*[\"createRequire\"](???*1*)\n+- *0* module: The Node.js `module` module: https://nodejs.org/api/module.html\n+- *1* ???*2*[\"foo\"]\n+  ⚠️  unknown object\n+  ⚠️  This value might have side effects\n+- *2* FreeVar(globalThis)\n+  ⚠️  unknown global\n+  ⚠️  This value might have side effects\n+\n+0 -> 22 call = ???*0*(\"./file4\")\n+- *0* module.createRequire*1*(???*2*)\n+  ⚠️  createRequire() non constant\n+  ⚠️  This value might have side effects\n+- *1* module.createRequire: The Node.js module.createRequire method: https://nodejs.org/api/module.html#modulecreaterequirefilename\n+- *2* ???*3*[\"foo\"]\n+  ⚠️  unknown object\n+  ⚠️  This value might have side effects\n+- *3* FreeVar(globalThis)\n+  ⚠️  unknown global\n+  ⚠️  This value might have side effects"
        },
        {
            "sha": "a0dd880d2ad116e594ba26967c30e927dfefae6e",
            "filename": "turbopack/crates/turbopack-ecmascript/tests/analyzer/graph/createRequire/resolved-explained.snapshot",
            "status": "added",
            "additions": 26,
            "deletions": 0,
            "changes": 26,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fresolved-explained.snapshot",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fresolved-explained.snapshot",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Ftests%2Fanalyzer%2Fgraph%2FcreateRequire%2Fresolved-explained.snapshot?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -0,0 +1,26 @@\n+moduleRequire = module*0*\n+- *0* module: The Node.js `module` module: https://nodejs.org/api/module.html\n+\n+req_fail1 = ???*0*\n+- *0* module.createRequire*1*(???*2*)\n+  ⚠️  createRequire() non constant\n+  ⚠️  This value might have side effects\n+- *1* module.createRequire: The Node.js module.createRequire method: https://nodejs.org/api/module.html#modulecreaterequirefilename\n+- *2* ???*3*[\"foo\"]\n+  ⚠️  unknown object\n+  ⚠️  This value might have side effects\n+- *3* FreeVar(globalThis)\n+  ⚠️  unknown global\n+  ⚠️  This value might have side effects\n+\n+req_ok1 = require*0*\n+- *0* require: The require method from CommonJS\n+\n+req_ok2 = require*0*\n+- *0* require: The require method from CommonJS\n+\n+req_ok3 = ???*0*\n+- *0* module.createRequire*1*(\"__filename\")\n+  ⚠️  createRequire() non constant\n+  ⚠️  This value might have side effects\n+- *1* module.createRequire: The Node.js module.createRequire method: https://nodejs.org/api/module.html#modulecreaterequirefilename"
        },
        {
            "sha": "39c5e0c561696ee29dda44974f033cd2218335a5",
            "filename": "turbopack/crates/turbopack-tracing/tests/unit.rs",
            "status": "modified",
            "additions": 13,
            "deletions": 34,
            "changes": 47,
            "blob_url": "https://github.com/vercel/next.js/blob/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-tracing%2Ftests%2Funit.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/b25933af0a47a64ecf85839da86f6461b41a62a5/turbopack%2Fcrates%2Fturbopack-tracing%2Ftests%2Funit.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tracing%2Ftests%2Funit.rs?ref=b25933af0a47a64ecf85839da86f6461b41a62a5",
            "patch": "@@ -22,15 +22,14 @@ use turbopack::{\n     },\n };\n use turbopack_core::{\n-    chunk::ChunkingType,\n     compile_time_info::CompileTimeInfo,\n     context::AssetContext,\n     environment::{Environment, ExecutionEnvironment, NodeJsEnvironment},\n     file_source::FileSource,\n     ident::Layer,\n     module::Module,\n     output::OutputAsset,\n-    reference::{all_assets_from_entries, primary_chunkable_referenced_modules},\n+    reference::all_assets_from_entries,\n     reference_type::ReferenceType,\n     traced_asset::TracedAsset,\n };\n@@ -66,10 +65,10 @@ static ALLOC: turbo_tasks_malloc::TurboMalloc = turbo_tasks_malloc::TurboMalloc;\n #[case::asset_fs_inlining_multi(\"asset-fs-inlining-multi\")]\n #[case::asset_fs_logical(\"asset-fs-logical\")]\n // #[case::asset_graceful_fs(\"asset-graceful-fs\")]\n-// #[case::asset_node_require(\"asset-node-require\")]\n+#[case::asset_node_require(\"asset-node-require\")]\n #[case::asset_package_json(\"asset-package-json\")]\n // #[case::asset_symlink(\"asset-symlink\")]\n-// #[case::basic_analysis_require(\"basic-analysis-require\")]\n+#[case::basic_analysis_require(\"basic-analysis-require\")]\n // #[case::browser_remappings(\"browser-remappings\")]\n // #[case::browser_remappings_disabled(\"browser-remappings-disabled\")]\n // #[case::browser_remappings_false(\"browser-remappings-false\")]\n@@ -85,9 +84,9 @@ static ALLOC: turbo_tasks_malloc::TurboMalloc = turbo_tasks_malloc::TurboMalloc;\n // #[case::dirname_emit(\"dirname-emit\")]\n // #[case::dirname_emit_concat(\"dirname-emit-concat\")]\n #[case::dirname_len(\"dirname-len\")]\n-// #[case::dot_dot(\"dot-dot\")]\n-// #[case::esm_dynamic_import(\"esm-dynamic-import\")]\n-// #[case::esm_export_wildcard(\"esm-export-wildcard\")]\n+#[case::dot_dot(\"dot-dot\")]\n+#[case::esm_dynamic_import(\"esm-dynamic-import\")]\n+#[case::esm_export_wildcard(\"esm-export-wildcard\")]\n // #[case::esm_paths(\"esm-paths\")]\n // #[case::esm_paths_trailer(\"esm-paths-trailer\")]\n // #[case::exports(\"exports\")]\n@@ -111,7 +110,7 @@ static ALLOC: turbo_tasks_malloc::TurboMalloc = turbo_tasks_malloc::TurboMalloc;\n // #[case::jsx_input(\"jsx-input\")]\n // #[case::microtime_node_gyp(\"microtime-node-gyp\")]\n // #[case::mixed_esm_cjs(\"mixed-esm-cjs\")]\n-// #[case::module_create_require(\"module-create-require\")]\n+#[case::module_create_require(\"module-create-require\")]\n // #[case::module_register(\"module-register\")]\n // #[case::module_require(\"module-require\")]\n // #[case::module_sync_condition_cjs(\"module-sync-condition-cjs\")]\n@@ -234,27 +233,11 @@ async fn node_file_trace_operation(package_root: RcStr, input: RcStr) -> Result<\n         .process(Vc::upcast(source), ReferenceType::Undefined)\n         .module();\n \n-    // We treat the entry as bundled code, so start with the references.\n-    let assets = primary_chunkable_referenced_modules(module, true)\n-        .await?\n-        .iter()\n-        .flat_map(|(ty, _, modules)| {\n-            if *ty == ChunkingType::Traced {\n-                Some(modules.into_iter())\n-            } else {\n-                None\n-            }\n-        })\n-        .flatten()\n-        .map(async |m| {\n-            Ok(ResolvedVc::upcast(\n-                TracedAsset::new(**m).to_resolved().await?,\n-            ))\n-        })\n-        .try_join()\n-        .await?;\n-\n-    let mut paths = to_list(assets).await?;\n+    // We treat the entry as an external\n+    let mut paths = to_list(vec![ResolvedVc::upcast(\n+        TracedAsset::new(module).to_resolved().await?,\n+    )])\n+    .await?;\n     paths.push(module.ident().path().await?.path.clone());\n \n     Ok(Vc::cell(paths))\n@@ -301,10 +284,7 @@ fn node_file_trace(input_path: &str) -> Result<()> {\n                 .map(|s| s.to_string())\n                 .collect::<FxIndexSet<_>>();\n \n-            // println!(\n-            //     \"issues: {:#?}\",\n-            //     op.peek_issues_with_path().await?.get_plain_issues().await?\n-            // );\n+            // println!(\"issues: {:#?}\", op.peek_issues().get_plain_issues().await?);\n \n             let reference = std::fs::read_to_string(reference)?;\n             // crude JS -> JSON conversion\n@@ -315,7 +295,6 @@ fn node_file_trace(input_path: &str) -> Result<()> {\n                 .replace('\\'', \"\\\"\");\n             let reference = serde_json::from_str::<Vec<String>>(&reference)?\n                 .into_iter()\n-                .filter(|m| m != \"package.json\")\n                 .collect::<FxIndexSet<_>>();\n \n             if reference == list {"
        }
    ],
    "stats": {
        "total": 1528,
        "additions": 1491,
        "deletions": 37
    }
}