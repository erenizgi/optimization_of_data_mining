{
    "author": "ztanner",
    "message": "refactor: remove isRevalidate from work store (#83859)\n\nWith the refactor in #83858 there's no longer a reason to distinguish\nbetween `isRevalidate` and `isStaticGeneration` and most likely doing so\nwould be a bug, as you'd likely want to apply the same handling to build\ntime generation that you would during a later regeneration.\n\nThis PR removes `isRevalidate` from the `WorkStore`.",
    "sha": "d054cac6e28a22ed817c200dbfe144c035bb809f",
    "files": [
        {
            "sha": "399b3b55240ea284025402b66961930e0db33309",
            "filename": "packages/next/src/build/static-paths/app.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fbuild%2Fstatic-paths%2Fapp.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fbuild%2Fstatic-paths%2Fapp.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fstatic-paths%2Fapp.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -828,7 +828,6 @@ export async function buildAppStaticPaths({\n       incrementalCache,\n       cacheLifeProfiles,\n       supportsDynamicResponse: true,\n-      isRevalidate: false,\n       experimental: {\n         cacheComponents,\n         authInterrupts,"
        },
        {
            "sha": "a02284a14ea35ea895dcdd11c58ac303ab10622e",
            "filename": "packages/next/src/build/templates/app-page.ts",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-page.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -539,7 +539,6 @@ export async function handler(\n                 )\n               : `${process.cwd()}/${routeModule.relativeProjectDir}`,\n           isDraftMode,\n-          isRevalidate: isSSG && !postponed && !isDynamicRSCRequest,\n           botType,\n           isOnDemandRevalidate,\n           isPossibleServerAction,\n@@ -566,7 +565,6 @@ export async function handler(\n                 nextExport: true,\n                 supportsDynamicResponse: false,\n                 isStaticGeneration: true,\n-                isRevalidate: true,\n                 isDebugDynamicAccesses: isDebugDynamicAccesses,\n               }\n             : {}),\n@@ -612,7 +610,6 @@ export async function handler(\n       if (isDebugStaticShell || isDebugDynamicAccesses) {\n         context.renderOpts.nextExport = true\n         context.renderOpts.supportsDynamicResponse = false\n-        context.renderOpts.isRevalidate = true\n         context.renderOpts.isDebugDynamicAccesses = isDebugDynamicAccesses\n       }\n \n@@ -1417,7 +1414,7 @@ export async function handler(\n           routePath: srcPage,\n           routeType: 'render',\n           revalidateReason: getRevalidateReason({\n-            isRevalidate: isSSG,\n+            isStaticGeneration: isSSG,\n             isOnDemandRevalidate,\n           }),\n         },"
        },
        {
            "sha": "92f463f147bb616b3e2178b289ff797d999d765e",
            "filename": "packages/next/src/build/templates/app-route.ts",
            "status": "modified",
            "additions": 3,
            "deletions": 4,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-route.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-route.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fapp-route.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -162,7 +162,7 @@ export async function handler(\n   // page and it is not being resumed from a postponed render and\n   // it is not a dynamic RSC request then it is a revalidation\n   // request.\n-  const isRevalidate = isIsr && !supportsDynamicResponse\n+  const isStaticGeneration = isIsr && !supportsDynamicResponse\n \n   // Before rendering (which initializes component tree modules), we have to\n   // set the reference manifests to our global store so Server Action's\n@@ -193,7 +193,6 @@ export async function handler(\n       supportsDynamicResponse,\n       incrementalCache: getRequestMeta(req, 'incrementalCache'),\n       cacheLifeProfiles: nextConfig.experimental?.cacheLife,\n-      isRevalidate,\n       waitUntil: ctx.waitUntil,\n       onClose: (cb) => {\n         res.on('close', cb)\n@@ -358,7 +357,7 @@ export async function handler(\n                 routePath: srcPage,\n                 routeType: 'route',\n                 revalidateReason: getRevalidateReason({\n-                  isRevalidate,\n+                  isStaticGeneration,\n                   isOnDemandRevalidate,\n                 }),\n               },\n@@ -473,7 +472,7 @@ export async function handler(\n         routePath: normalizedSrcPage,\n         routeType: 'route',\n         revalidateReason: getRevalidateReason({\n-          isRevalidate,\n+          isStaticGeneration,\n           isOnDemandRevalidate,\n         }),\n       })"
        },
        {
            "sha": "b2467c32bbc17ae477f1bbf17a5707f89760c1ab",
            "filename": "packages/next/src/build/templates/edge-ssr-app.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr-app.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr-app.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Ftemplates%2Fedge-ssr-app.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -138,7 +138,6 @@ async function requestHandler(\n       dir: pageRouteModule.relativeProjectDir,\n       botType,\n       isDraftMode: false,\n-      isRevalidate: false,\n       isOnDemandRevalidate,\n       isPossibleServerAction,\n       assetPrefix: nextConfig.assetPrefix,"
        },
        {
            "sha": "7f9cf86a24d27b2df37778c1b47a32af4966c7d1",
            "filename": "packages/next/src/client/components/handle-isr-error.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fhandle-isr-error.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fhandle-isr-error.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fhandle-isr-error.tsx?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -11,7 +11,7 @@ const workAsyncStorage =\n export function HandleISRError({ error }: { error: any }) {\n   if (workAsyncStorage) {\n     const store = workAsyncStorage.getStore()\n-    if (store?.isRevalidate || store?.isStaticGeneration) {\n+    if (store?.isStaticGeneration) {\n       if (error) {\n         console.error(error)\n       }"
        },
        {
            "sha": "212bff1e8c7a7b7e338be30690a2ffc4fa4b427c",
            "filename": "packages/next/src/export/routes/app-route.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 5,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-route.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-route.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Froutes%2Fapp-route.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -20,7 +20,6 @@ import type {\n   MockedResponse,\n } from '../../server/lib/mock-request'\n import { isDynamicUsageError } from '../helpers/is-dynamic-usage-error'\n-import { hasNextSupport } from '../../server/ci-info'\n import { isStaticGenEnabled } from '../../server/route-modules/app-route/helpers/is-static-gen-enabled'\n import type { ExperimentalConfig } from '../../server/config-shared'\n import { isMetadataRoute } from '../../lib/metadata/is-metadata-route'\n@@ -94,10 +93,6 @@ export async function exportAppRoute(\n     },\n   }\n \n-  if (hasNextSupport) {\n-    context.renderOpts.isRevalidate = true\n-  }\n-\n   try {\n     const userland = module.userland\n     // we don't bail from the static optimization for"
        },
        {
            "sha": "2a7f0d265aa0d0af9048760a480865c655874509",
            "filename": "packages/next/src/export/worker.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 4,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fexport%2Fworker.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fexport%2Fworker.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fexport%2Fworker.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -282,10 +282,6 @@ async function exportPageImpl(\n     renderResumeDataCache,\n   }\n \n-  if (hasNextSupport) {\n-    renderOpts.isRevalidate = true\n-  }\n-\n   // Handle App Pages\n   if (isAppDir) {\n     const sharedContext: AppSharedContext = { buildId }"
        },
        {
            "sha": "1f6132f9e6f85b65e34e157f46869f47f445b640",
            "filename": "packages/next/src/server/app-render/types.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 1,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Ftypes.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -99,7 +99,6 @@ export interface RenderOptsPartial {\n     htmlRequestId: string,\n     requestId: string\n   ) => void\n-  isRevalidate?: boolean\n   nextExport?: boolean\n   nextConfigOutput?: 'standalone' | 'export'\n   onInstrumentationRequestError?: ServerOnInstrumentationRequestError"
        },
        {
            "sha": "27e310a1d4c2e2b7eec0d8e7cdf2c11893ec8b0a",
            "filename": "packages/next/src/server/app-render/work-async-storage.external.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fwork-async-storage.external.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fwork-async-storage.external.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fwork-async-storage.external.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -38,8 +38,6 @@ export interface WorkStore {\n    */\n   readonly hasReadableErrorStacks?: boolean\n \n-  readonly isRevalidate?: boolean\n-\n   forceDynamic?: boolean\n   fetchCache?: AppSegmentConfig['fetchCache']\n "
        },
        {
            "sha": "5dcc7defaa1e7ab60f564846980276e953f46e2d",
            "filename": "packages/next/src/server/async-storage/work-store.ts",
            "status": "modified",
            "additions": 0,
            "deletions": 2,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Fasync-storage%2Fwork-store.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Fasync-storage%2Fwork-store.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fasync-storage%2Fwork-store.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -54,7 +54,6 @@ export type WorkStoreContext = {\n     | 'assetPrefix'\n     | 'supportsDynamicResponse'\n     | 'shouldWaitOnAllReady'\n-    | 'isRevalidate'\n     | 'nextExport'\n     | 'isDraftMode'\n     | 'isDebugDynamicAccesses'\n@@ -125,7 +124,6 @@ export function createWorkStore({\n       // so that it can access the fs cache without mocks\n       renderOpts.incrementalCache || (globalThis as any).__incrementalCache,\n     cacheLifeProfiles: renderOpts.cacheLifeProfiles,\n-    isRevalidate: renderOpts.isRevalidate,\n     isBuildTimePrerendering: renderOpts.nextExport,\n     hasReadableErrorStacks: renderOpts.hasReadableErrorStacks,\n     fetchCache: renderOpts.fetchCache,"
        },
        {
            "sha": "b9c1ad8692fff77502995132786036c1ff1860c0",
            "filename": "packages/next/src/server/instrumentation/utils.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Finstrumentation%2Futils.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Finstrumentation%2Futils.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Finstrumentation%2Futils.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -1,11 +1,11 @@\n export function getRevalidateReason(params: {\n   isOnDemandRevalidate?: boolean\n-  isRevalidate?: boolean\n+  isStaticGeneration?: boolean\n }): 'on-demand' | 'stale' | undefined {\n   if (params.isOnDemandRevalidate) {\n     return 'on-demand'\n   }\n-  if (params.isRevalidate) {\n+  if (params.isStaticGeneration) {\n     return 'stale'\n   }\n   return undefined"
        },
        {
            "sha": "686fcc80b3dea956fbb346c9e2a3185435327273",
            "filename": "packages/next/src/server/route-modules/pages/pages-handler.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages%2Fpages-handler.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/d054cac6e28a22ed817c200dbfe144c035bb809f/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages%2Fpages-handler.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Froute-modules%2Fpages%2Fpages-handler.ts?ref=d054cac6e28a22ed817c200dbfe144c035bb809f",
            "patch": "@@ -427,7 +427,7 @@ export const getHandler = ({\n                     routePath: srcPage,\n                     routeType: 'render',\n                     revalidateReason: getRevalidateReason({\n-                      isRevalidate: hasStaticProps,\n+                      isStaticGeneration: hasStaticProps,\n                       isOnDemandRevalidate,\n                     }),\n                   },\n@@ -755,7 +755,7 @@ export const getHandler = ({\n             routePath: srcPage,\n             routeType: 'render',\n             revalidateReason: getRevalidateReason({\n-              isRevalidate: hasStaticProps,\n+              isStaticGeneration: hasStaticProps,\n               isOnDemandRevalidate,\n             }),\n           },"
        }
    ],
    "stats": {
        "total": 38,
        "additions": 9,
        "deletions": 29
    }
}