{
    "author": "sokra",
    "message": "Turbopack: use mmap advise to help the OS preloading (#84379)\n\n### What?\n\nHelp the OS to prefetch file ranges",
    "sha": "3eb23fe90933d1c365d9396d2517699215f545f8",
    "files": [
        {
            "sha": "2233880f397d799191e4bb02867782b541fc8689",
            "filename": "turbopack/crates/turbo-persistence/src/static_sorted_file.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/3eb23fe90933d1c365d9396d2517699215f545f8/turbopack%2Fcrates%2Fturbo-persistence%2Fsrc%2Fstatic_sorted_file.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/3eb23fe90933d1c365d9396d2517699215f545f8/turbopack%2Fcrates%2Fturbo-persistence%2Fsrc%2Fstatic_sorted_file.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-persistence%2Fsrc%2Fstatic_sorted_file.rs?ref=3eb23fe90933d1c365d9396d2517699215f545f8",
            "patch": "@@ -109,6 +109,11 @@ impl StaticSortedFile {\n         let mmap = unsafe { Mmap::map(&File::open(&path)?)? };\n         #[cfg(unix)]\n         mmap.advise(memmap2::Advice::Random)?;\n+        #[cfg(unix)]\n+        {\n+            let offset = meta.block_offsets_start(mmap.len());\n+            let _ = mmap.advise_range(memmap2::Advice::Sequential, offset, mmap.len() - offset);\n+        }\n         let file = Self { meta, mmap };\n         Ok(file)\n     }\n@@ -397,6 +402,12 @@ impl StaticSortedFile {\n                 self.meta.blocks_start()\n             );\n         }\n+        #[cfg(unix)]\n+        let _ = self.mmap.advise_range(\n+            memmap2::Advice::Sequential,\n+            block_start,\n+            block_end - block_start,\n+        );\n         let uncompressed_length = (&self.mmap[block_start..block_start + 4]).read_u32::<BE>()?;\n         let block = &self.mmap[block_start + 4..block_end];\n         Ok((uncompressed_length, block))"
        }
    ],
    "stats": {
        "total": 11,
        "additions": 11,
        "deletions": 0
    }
}