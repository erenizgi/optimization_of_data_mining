{
    "author": "bgw",
    "message": "Turbopack: Add #[automatically_derived] to proc macros (#88281)\n\nhttps://doc.rust-lang.org/reference/attributes/derive.html#r-attributes.derive.automatically_derived\n\nWe discussed this during our morning team meeting. I had an LLM write this.  \n  \nThis does not identify any new dead code.",
    "sha": "0390641e3d31665c5f54af15a59a073773dc956e",
    "files": [
        {
            "sha": "2e274c3196a9f7adf2e01617d39c831d6975f473",
            "filename": "turbopack/crates/turbo-tasks-macros/src/derive/deterministic_hash_macro.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fdeterministic_hash_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fdeterministic_hash_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fdeterministic_hash_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -24,6 +24,7 @@ pub fn derive_deterministic_hash(input: TokenStream) -> TokenStream {\n     };\n \n     quote! {\n+        #[automatically_derived]\n         impl turbo_tasks_hash::DeterministicHash for #ident {\n             fn deterministic_hash<H: turbo_tasks_hash::DeterministicHasher>(&self, __state__: &mut H) {\n                 #discriminant"
        },
        {
            "sha": "e16cf22b2664024f9b5314bed0377581fbe24240",
            "filename": "turbopack/crates/turbo-tasks-macros/src/derive/key_value_pair_macro.rs",
            "status": "modified",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fkey_value_pair_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fkey_value_pair_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fkey_value_pair_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -163,6 +163,7 @@ pub fn derive_key_value_pair(input: TokenStream) -> TokenStream {\n         .collect::<Vec<_>>();\n \n     quote! {\n+        #[automatically_derived]\n         impl turbo_tasks::KeyValuePair for #ident {\n             type Type = #type_name;\n             type Key = #key_name;\n@@ -282,6 +283,7 @@ pub fn derive_key_value_pair(input: TokenStream) -> TokenStream {\n             )*\n         }\n \n+        #[automatically_derived]\n         impl #key_name {\n             pub fn ty(&self) -> #type_name {\n                 match self {\n@@ -292,6 +294,7 @@ pub fn derive_key_value_pair(input: TokenStream) -> TokenStream {\n             }\n         }\n \n+        #[automatically_derived]\n         impl #value_name {\n             pub fn as_ref(&self) -> #value_ref_name<'_> {\n                 match self {\n@@ -321,6 +324,7 @@ pub fn derive_key_value_pair(input: TokenStream) -> TokenStream {\n             )*\n         }\n \n+        #[automatically_derived]\n         impl #storage_name {\n             pub fn new(ty: #type_name) -> Self {\n                 match ty {\n@@ -501,6 +505,7 @@ pub fn derive_key_value_pair(input: TokenStream) -> TokenStream {\n             )*\n         }\n \n+        #[automatically_derived]\n         impl<'l> Iterator for #iter_name<'l> {\n             type Item = (#key_name, #value_ref_name<'l>);\n "
        },
        {
            "sha": "c97a73ffed3a06238dfadf45d06b37b348e29287",
            "filename": "turbopack/crates/turbo-tasks-macros/src/derive/non_local_value_macro.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fnon_local_value_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fnon_local_value_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fnon_local_value_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -17,6 +17,7 @@ pub fn derive_non_local_value(input: TokenStream) -> TokenStream {\n \n     let (impl_generics, ty_generics, where_clause) = derive_input.generics.split_for_impl();\n     quote! {\n+        #[automatically_derived]\n         unsafe impl #impl_generics turbo_tasks::NonLocalValue\n             for #ident #ty_generics #where_clause {}\n         #assertions"
        },
        {
            "sha": "4a3a90866cdb6cc726445e6e5131fed841f02611",
            "filename": "turbopack/crates/turbo-tasks-macros/src/derive/operation_value_macro.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Foperation_value_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Foperation_value_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Foperation_value_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -17,6 +17,7 @@ pub fn derive_operation_value(input: TokenStream) -> TokenStream {\n \n     let (impl_generics, ty_generics, where_clause) = derive_input.generics.split_for_impl();\n     quote! {\n+        #[automatically_derived]\n         unsafe impl #impl_generics turbo_tasks::OperationValue\n             for #ident #ty_generics #where_clause {}\n         #assertions"
        },
        {
            "sha": "bba2261e051d65facf13c86d4a9bb40697aa8cef",
            "filename": "turbopack/crates/turbo-tasks-macros/src/derive/task_input_macro.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Ftask_input_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Ftask_input_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Ftask_input_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -150,6 +150,7 @@ pub fn derive_task_input(input: TokenStream) -> TokenStream {\n         .collect();\n \n     quote! {\n+        #[automatically_derived]\n         #[turbo_tasks::macro_helpers::async_trait]\n         impl #generics turbo_tasks::TaskInput for #ident #generics\n         where"
        },
        {
            "sha": "168e40a19b51d3b20a7177234b06eb8f8f1a6bf5",
            "filename": "turbopack/crates/turbo-tasks-macros/src/derive/trace_raw_vcs_macro.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Ftrace_raw_vcs_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Ftrace_raw_vcs_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Ftrace_raw_vcs_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -23,6 +23,7 @@ pub fn derive_trace_raw_vcs(input: TokenStream) -> TokenStream {\n \n     let trace_items = match_expansion(&derive_input, &trace_named, &trace_unnamed, &trace_unit);\n     quote! {\n+        #[automatically_derived]\n         impl #impl_generics turbo_tasks::trace::TraceRawVcs for #ident #ty_generics #where_clause {\n             fn trace_raw_vcs(&self, __context__: &mut turbo_tasks::trace::TraceRawVcsContext) {\n                 #trace_items"
        },
        {
            "sha": "d44c8aa808c0779a948d11cdcf822cafb1a752a5",
            "filename": "turbopack/crates/turbo-tasks-macros/src/derive/value_debug_format_macro.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fvalue_debug_format_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fvalue_debug_format_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fderive%2Fvalue_debug_format_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -34,6 +34,7 @@ pub fn derive_value_debug_format(input: TokenStream) -> TokenStream {\n         match_expansion(&derive_input, &format_named, &format_unnamed, &format_unit);\n \n     quote! {\n+        #[automatically_derived]\n         impl #impl_generics turbo_tasks::debug::ValueDebugFormat for #ident #ty_generics #where_clause {\n             fn value_debug_format<'a>(&'a self, depth: usize) -> turbo_tasks::debug::ValueDebugFormatString<'a> {\n                 turbo_tasks::debug::ValueDebugFormatString::Async("
        },
        {
            "sha": "44439b6b97ecceec5f63c698536baa138a67d609",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_impl_macro.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 0,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_impl_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -332,7 +332,9 @@ pub fn value_impl(args: TokenStream, input: TokenStream) -> TokenStream {\n             // NOTE(alexkirsz) We can't have a general `turbo_tasks::Upcast<Box<dyn Trait>> for T where T: Trait` because\n             // rustc complains: error[E0210]: type parameter `T` must be covered by another type when it appears before\n             // the first local type (`dyn Trait`).\n+            #[automatically_derived]\n             unsafe impl #impl_generics turbo_tasks::Upcast<::std::boxed::Box<dyn #trait_path>> for #ty #where_clause {}\n+            #[automatically_derived]\n             unsafe impl #impl_generics turbo_tasks::UpcastStrict<::std::boxed::Box<dyn #trait_path>> for #ty #where_clause {}\n \n             impl #impl_generics #trait_path for #ty #where_clause {"
        },
        {
            "sha": "34063874bc894968252bb85f036293e25c300b74",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_macro.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -427,6 +427,7 @@ pub fn value_type_and_register(\n \n         turbo_tasks::macro_helpers::inventory_submit!{turbo_tasks::macro_helpers::CollectableValueType(&#value_type_ident)}\n \n+        #[automatically_derived]\n         unsafe impl #impl_generics turbo_tasks::VcValueType for #ty #where_clause {\n             type Read = #read;\n             type CellMode = #cell_mode;"
        },
        {
            "sha": "4d4c5b40f3c1383d0d818bc1212cce17ba0392bd",
            "filename": "turbopack/crates/turbo-tasks-macros/src/value_trait_macro.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/0390641e3d31665c5f54af15a59a073773dc956e/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-macros%2Fsrc%2Fvalue_trait_macro.rs?ref=0390641e3d31665c5f54af15a59a073773dc956e",
            "patch": "@@ -267,8 +267,11 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n \n     let value_debug_impl = if debug {\n         quote! {\n+            #[automatically_derived]\n             unsafe impl turbo_tasks::Dynamic<Box<dyn turbo_tasks::debug::ValueDebug>> for Box<dyn #trait_ident> {}\n+            #[automatically_derived]\n             unsafe impl turbo_tasks::Upcast<Box<dyn turbo_tasks::debug::ValueDebug>> for Box<dyn #trait_ident> {}\n+            #[automatically_derived]\n             unsafe impl turbo_tasks::UpcastStrict<Box<dyn turbo_tasks::debug::ValueDebug>> for Box<dyn #trait_ident> {}\n         }\n     } else {\n@@ -313,6 +316,7 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n             turbo_tasks::macro_helpers::CollectableTrait(&#trait_type_ident)\n         }\n \n+        #[automatically_derived]\n         impl turbo_tasks::VcValueTrait for Box<dyn #trait_ident> {\n             type ValueTrait = dyn #trait_ident;\n \n@@ -333,9 +337,12 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n             }\n         }\n \n+        #[automatically_derived]\n         unsafe impl turbo_tasks::Dynamic<Box<dyn #trait_ident>> for Box<dyn #trait_ident> {}\n+        #[automatically_derived]\n         unsafe impl turbo_tasks::Upcast<Box<dyn #trait_ident>> for Box<dyn #trait_ident> {}\n \n+        #[automatically_derived]\n         impl<T> #trait_ident for T\n         where\n             T: turbo_tasks::Dynamic<Box<dyn #trait_ident>> + #(#supertraits +)* #(#extended_supertraits +)*,\n@@ -344,8 +351,11 @@ pub fn value_trait(args: TokenStream, input: TokenStream) -> TokenStream {\n         }\n \n         #(\n+            #[automatically_derived]\n             unsafe impl turbo_tasks::Dynamic<Box<dyn #supertraits>> for Box<dyn #trait_ident> {}\n+            #[automatically_derived]\n             unsafe impl turbo_tasks::Upcast<Box<dyn #supertraits>> for Box<dyn #trait_ident> {}\n+            #[automatically_derived]\n             unsafe impl turbo_tasks::UpcastStrict<Box<dyn #supertraits>> for Box<dyn #trait_ident> {\n             }\n         )*"
        }
    ],
    "stats": {
        "total": 24,
        "additions": 24,
        "deletions": 0
    }
}