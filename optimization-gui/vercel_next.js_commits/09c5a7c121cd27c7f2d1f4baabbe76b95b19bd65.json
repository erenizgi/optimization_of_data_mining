{
    "author": "devjiwonchoi",
    "message": "docs: add `next.config.ts` Node.js native resolver (#83561)\n\nThis PR adds docs for using Node.js native TS resolver for\n`next.config.ts`. It states:\n\n- Supports Node.js native TS resolver\n- Why use it\n- How to use it\n- Restrictions\n- Why use `next.config.mts`\n\nI didn't mention how much it's faster compared to the legacy resolver\n(~68% faster in the hello world app -\n[link](https://github.com/vercel/next.js/pull/83240)) because the\nexperience may vary for users.\n\n---------\n\nCo-authored-by: Joseph <joseph.chamochumbi@vercel.com>\nCo-authored-by: Abdón Rodríguez <a@abdonrd.com>",
    "sha": "09c5a7c121cd27c7f2d1f4baabbe76b95b19bd65",
    "files": [
        {
            "sha": "f81e55f52c113f50854d3139e20b484bb095429d",
            "filename": "docs/01-app/03-api-reference/05-config/02-typescript.mdx",
            "status": "modified",
            "additions": 39,
            "deletions": 3,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/09c5a7c121cd27c7f2d1f4baabbe76b95b19bd65/docs%2F01-app%2F03-api-reference%2F05-config%2F02-typescript.mdx",
            "raw_url": "https://github.com/vercel/next.js/raw/09c5a7c121cd27c7f2d1f4baabbe76b95b19bd65/docs%2F01-app%2F03-api-reference%2F05-config%2F02-typescript.mdx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/docs%2F01-app%2F03-api-reference%2F05-config%2F02-typescript.mdx?ref=09c5a7c121cd27c7f2d1f4baabbe76b95b19bd65",
            "patch": "@@ -82,7 +82,7 @@ Next.js generates global helpers for App Router route types. These are available\n \n ## Examples\n \n-### Type checking `next.config.ts`\n+### Type Checking Next.js Configuration Files\n \n You can use TypeScript and import types in your Next.js configuration by using `next.config.ts`.\n \n@@ -96,7 +96,7 @@ const nextConfig: NextConfig = {\n export default nextConfig\n ```\n \n-> **Good to know**: Module resolution in `next.config.ts` is currently limited to `CommonJS`. This may cause incompatibilities with ESM only packages being loaded in `next.config.ts`.\n+Module resolution in `next.config.ts` is currently limited to CommonJS. However, ECMAScript Modules (ESM) syntax is available when [using Node.js native TypeScript resolver](#using-nodejs-native-typescript-resolver-for-nextconfigts) for Node.js v22.10.0 and higher.\n \n When using the `next.config.js` file, you can add some type checking in your IDE using JSDoc as below:\n \n@@ -111,6 +111,42 @@ const nextConfig = {\n module.exports = nextConfig\n ```\n \n+### Using Node.js Native TypeScript Resolver for `next.config.ts`\n+\n+> **Note**: Available on Node.js v22.10.0+ and only when the feature is enabled. Next.js does not enable it.\n+\n+Next.js detects the [Node.js native TypeScript resolver](https://nodejs.org/api/typescript.html) via [`process.features.typescript`](https://nodejs.org/api/process.html#processfeaturestypescript), added in **v22.10.0**. When present, `next.config.ts` can use native ESM, including top‑level `await` and dynamic `import()`. This mechanism inherits the capabilities and limitations of Node's resolver.\n+\n+In Node.js versions **v22.18.0+**, `process.features.typescript` is enabled by default. For versions between **v22.10.0** and **22.17.x**, opt in with `NODE_OPTIONS=--experimental-transform-types`:\n+\n+```bash filename=\"Terminal\"\n+NODE_OPTIONS=--experimental-transform-types next <command>\n+```\n+\n+#### For CommonJS Projects (Default)\n+\n+Although `next.config.ts` supports native ESM syntax on CommonJS projects, Node.js will still assume `next.config.ts` is a CommonJS file by default, resulting in Node.js reparsing the file as ESM when module syntax is detected. Therefore, we recommend using the `next.config.mts` file for CommonJS projects to explicitly indicate it's an ESM module:\n+\n+```ts filename=\"next.config.mts\"\n+import type { NextConfig } from 'next'\n+\n+// Top-level await and dynamic import are supported\n+const flags = await import('./flags.js').then((m) => m.default ?? m)\n+\n+const nextConfig: NextConfig = {\n+  /* config options here */\n+  typedRoutes: Boolean(flags?.typedRoutes),\n+}\n+\n+export default nextConfig\n+```\n+\n+#### For ESM Projects\n+\n+When `\"type\"` is set to `\"module\"` in `package.json`, your project uses ESM. Learn more about this setting [in the Node.js docs](https://nodejs.org/api/packages.html#type). In this case, you can write `next.config.ts` directly with ESM syntax.\n+\n+> **Good to know**: When using `\"type\": \"module\"` in your `package.json`, all `.js` and `.ts` files in your project are treated as ESM modules by default. You may need to rename files with CommonJS syntax to `.cjs` or `.cts` extensions if needed.\n+\n ### Statically Typed Links\n \n Next.js can statically type links to prevent typos and other errors when using `next/link`, improving type safety when navigating between pages.\n@@ -479,7 +515,7 @@ When you need to declare custom types, you might be tempted to modify `next-env.\n \n | Version   | Changes                                                                                                                              |\n | --------- | ------------------------------------------------------------------------------------------------------------------------------------ |\n-| `v15.0.0` | [`next.config.ts`](#type-checking-nextconfigts) support added for TypeScript projects.                                               |\n+| `v15.0.0` | [`next.config.ts`](#type-checking-nextjs-configuration-files) support added for TypeScript projects.                                 |\n | `v13.2.0` | Statically typed links are available in beta.                                                                                        |\n | `v12.0.0` | [SWC](/docs/architecture/nextjs-compiler) is now used by default to compile TypeScript and TSX for faster builds.                    |\n | `v10.2.1` | [Incremental type checking](https://www.typescriptlang.org/tsconfig#incremental) support added when enabled in your `tsconfig.json`. |"
        }
    ],
    "stats": {
        "total": 42,
        "additions": 39,
        "deletions": 3
    }
}