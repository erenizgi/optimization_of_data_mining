{
    "author": "bgw",
    "message": "Turbopack: Add a flag to the fs watch fuzzer to print missing but expected invalidations (#82131)\n\nThis can be useful in figuring what should've been invalidated, but wasn't.\n\n`strace` can be used for figuring out what files/directories were actually modified.",
    "sha": "aae25a1deafa061523e66f7e91c69ff2d944e449",
    "files": [
        {
            "sha": "21fa2f1418a58db3086a93d45d8ce7e94067008a",
            "filename": "turbopack/crates/turbo-tasks-fuzz/src/main.rs",
            "status": "modified",
            "additions": 15,
            "deletions": 0,
            "changes": 15,
            "blob_url": "https://github.com/vercel/next.js/blob/aae25a1deafa061523e66f7e91c69ff2d944e449/turbopack%2Fcrates%2Fturbo-tasks-fuzz%2Fsrc%2Fmain.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/aae25a1deafa061523e66f7e91c69ff2d944e449/turbopack%2Fcrates%2Fturbo-tasks-fuzz%2Fsrc%2Fmain.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fuzz%2Fsrc%2Fmain.rs?ref=aae25a1deafa061523e66f7e91c69ff2d944e449",
            "patch": "@@ -50,6 +50,8 @@ struct FsWatcher {\n     file_modifications: u32,\n     #[arg(long, default_value_t = 2)]\n     directory_modifications: u32,\n+    #[arg(long)]\n+    print_missing_invalidations: bool,\n }\n \n #[tokio::main]\n@@ -135,6 +137,19 @@ async fn fuzz_fs_watcher(args: FsWatcher) -> anyhow::Result<()> {\n                     modified_file_paths.len(),\n                     invalidations.len()\n                 );\n+                if args.print_missing_invalidations {\n+                    let absolute_path_invalidations = invalidations\n+                        .iter()\n+                        .map(|relative_path| fs_root.join(relative_path))\n+                        .collect::<FxHashSet<PathBuf>>();\n+                    let mut missing = modified_file_paths\n+                        .difference(&absolute_path_invalidations)\n+                        .collect::<Vec<_>>();\n+                    missing.sort_unstable();\n+                    for path in &missing {\n+                        println!(\"  missing {path:?}\");\n+                    }\n+                }\n                 invalidations.clear();\n             }\n         }"
        }
    ],
    "stats": {
        "total": 15,
        "additions": 15,
        "deletions": 0
    }
}