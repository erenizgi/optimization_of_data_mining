{
    "author": "lukesandberg",
    "message": "[turbopack] Support relative paths in turbopack source maps. (#85146)\n\n### What\n\nAdd an option to turbopack to render sourcemap relative file paths in source maps\n\nFor now this is unused since it requires some support in next to be added in #85576\n\n### Why\nThis will be useful for server source maps because it enables node and other runtimes to automatically format file paths to be working directory relative when printing errors to the console which many terminal emulators support to make clickable.\n\n\n### TIL\n\nMy initial approach for this was to set the `sourceRoot` option to avoid prepending the same string onto nearly every source uri.  However, the spec on this sourcemap feature is garbage.  Intuitively i thought it worked like `<base href=...>` where relative uris would 'resolve' against it, but no, it is just a string concatenation feature. sigh.",
    "sha": "2704e8bd54f79eac5cac80769d34d4d38b56f08d",
    "files": [
        {
            "sha": "f6a0496f86600b658998277adf40033a8607842b",
            "filename": "crates/next-core/src/mode.rs",
            "status": "modified",
            "additions": 1,
            "deletions": 4,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/crates%2Fnext-core%2Fsrc%2Fmode.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/crates%2Fnext-core%2Fsrc%2Fmode.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fmode.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -58,10 +58,7 @@ impl NextMode {\n     }\n \n     pub fn is_production(&self) -> bool {\n-        match self {\n-            NextMode::Development => false,\n-            NextMode::Build => true,\n-        }\n+        !self.is_development()\n     }\n \n     pub fn runtime_type(&self) -> RuntimeType {"
        },
        {
            "sha": "42d135ee5d9764de3a952adb0f78608a10b18db1",
            "filename": "crates/next-core/src/next_client/context.rs",
            "status": "modified",
            "additions": 3,
            "deletions": 3,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_client%2Fcontext.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -19,8 +19,8 @@ use turbopack_browser::{\n };\n use turbopack_core::{\n     chunk::{\n-        ChunkingConfig, ChunkingContext, MangleType, MinifyType, SourceMapsType,\n-        module_id_strategies::ModuleIdStrategy,\n+        ChunkingConfig, ChunkingContext, MangleType, MinifyType, SourceMapSourceType,\n+        SourceMapsType, module_id_strategies::ModuleIdStrategy,\n     },\n     compile_time_info::{CompileTimeDefines, CompileTimeInfo, FreeVarReference, FreeVarReferences},\n     environment::{BrowserEnvironment, Environment, ExecutionEnvironment},\n@@ -489,7 +489,7 @@ pub async fn get_client_chunking_context(\n     if next_mode.is_development() {\n         builder = builder\n             .hot_module_replacement()\n-            .use_file_source_map_uris()\n+            .source_map_source_type(SourceMapSourceType::AbsoluteFileUri)\n             .dynamic_chunk_content_loading(true);\n     } else {\n         builder = builder"
        },
        {
            "sha": "bb308e6cb315377ee9d0c5f2c1702049f11ac1cd",
            "filename": "crates/next-core/src/next_server/context.rs",
            "status": "modified",
            "additions": 10,
            "deletions": 4,
            "changes": 14,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/crates%2Fnext-core%2Fsrc%2Fnext_server%2Fcontext.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -16,7 +16,7 @@ use turbopack::{\n };\n use turbopack_core::{\n     chunk::{\n-        ChunkingConfig, MangleType, MinifyType, SourceMapsType,\n+        ChunkingConfig, MangleType, MinifyType, SourceMapSourceType, SourceMapsType,\n         module_id_strategies::ModuleIdStrategy,\n     },\n     compile_time_defines,\n@@ -1060,9 +1060,13 @@ pub async fn get_server_chunking_context_with_client_assets(\n     .file_tracing(next_mode.is_production())\n     .debug_ids(*debug_ids.await?);\n \n-    if next_mode.is_development() {\n-        builder = builder.use_file_source_map_uris();\n+    builder = builder.source_map_source_type(if next_mode.is_development() {\n+        SourceMapSourceType::AbsoluteFileUri\n     } else {\n+        // TODO(lukesandberg): switch to relative once next is compatible.\n+        SourceMapSourceType::TurbopackUri\n+    });\n+    if next_mode.is_production() {\n         builder = builder\n             .chunking_config(\n                 Vc::<EcmascriptChunkType>::default().to_resolved().await?,\n@@ -1142,9 +1146,11 @@ pub async fn get_server_chunking_context(\n     .debug_ids(*debug_ids.await?);\n \n     if next_mode.is_development() {\n-        builder = builder.use_file_source_map_uris()\n+        builder = builder.source_map_source_type(SourceMapSourceType::AbsoluteFileUri);\n     } else {\n         builder = builder\n+            // TODO(lukesandberg): switch to relative once next is compatible.\n+            .source_map_source_type(SourceMapSourceType::TurbopackUri)\n             .chunking_config(\n                 Vc::<EcmascriptChunkType>::default().to_resolved().await?,\n                 ChunkingConfig {"
        },
        {
            "sha": "3feaa2f101c226fde6c058a6ee9f4baf8d9b0687",
            "filename": "turbopack/crates/turbo-tasks-fs/src/util.rs",
            "status": "modified",
            "additions": 11,
            "deletions": 22,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Futil.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Futil.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks-fs%2Fsrc%2Futil.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -1,6 +1,6 @@\n use std::{\n     io::{self, ErrorKind},\n-    path::Path,\n+    path::{Path, PathBuf},\n };\n \n use anyhow::{Context, Result, anyhow};\n@@ -19,10 +19,7 @@ pub fn extract_disk_access<T>(value: io::Result<T>, path: &Path) -> Result<Optio\n     }\n }\n \n-#[cfg(not(target_os = \"windows\"))]\n pub async fn uri_from_file(root: FileSystemPath, path: Option<&str>) -> Result<String> {\n-    use turbo_unix_path::sys_to_unix;\n-\n     let root_fs = root.fs;\n     let root_fs = &*ResolvedVc::try_downcast_type::<DiskFileSystem>(root_fs)\n         .context(\"Expected root to have a DiskFileSystem\")?\n@@ -33,32 +30,26 @@ pub async fn uri_from_file(root: FileSystemPath, path: Option<&str>) -> Result<S\n         None => root,\n     };\n \n-    let sys_path = root_fs.to_sys_path(&path);\n+    Ok(uri_from_path_buf(root_fs.to_sys_path(&path)))\n+}\n+\n+#[cfg(not(target_os = \"windows\"))]\n+pub fn uri_from_path_buf(sys_path: PathBuf) -> String {\n+    use turbo_unix_path::sys_to_unix;\n     let sys_path = sys_path.to_string_lossy();\n \n-    Ok(format!(\n+    format!(\n         \"file://{}\",\n         sys_to_unix(&sys_path)\n             .split('/')\n             .map(|s| urlencoding::encode(s))\n             .collect::<Vec<_>>()\n             .join(\"/\")\n-    ))\n+    )\n }\n \n #[cfg(target_os = \"windows\")]\n-pub async fn uri_from_file(root: FileSystemPath, path: Option<&str>) -> Result<String> {\n-    let root_fs = root.fs;\n-    let root_fs = &*ResolvedVc::try_downcast_type::<DiskFileSystem>(root_fs)\n-        .context(\"Expected root to have a DiskFileSystem\")?\n-        .await?;\n-\n-    let sys_path = match path {\n-        Some(path) => root.join(path.into())?,\n-        None => root,\n-    };\n-    let sys_path = root_fs.to_sys_path(&sys_path);\n-\n+pub fn uri_from_path_buf(sys_path: PathBuf) -> String {\n     let raw_path = sys_path.to_string_lossy().to_string();\n     let normalized_path = raw_path.replace('\\\\', \"/\");\n \n@@ -70,7 +61,5 @@ pub async fn uri_from_file(root: FileSystemPath, path: Option<&str>) -> Result<S\n         .collect::<Vec<_>>()\n         .join(\"/\");\n \n-    let uri = format!(\"file:///{}\", encoded_path);\n-\n-    Ok(uri)\n+    format!(\"file:///{}\", encoded_path)\n }"
        },
        {
            "sha": "02b2a9b45517ade19b342293699821da7ec0bd95",
            "filename": "turbopack/crates/turbopack-browser/src/chunking_context.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-browser%2Fsrc%2Fchunking_context.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -13,7 +13,7 @@ use turbopack_core::{\n     chunk::{\n         Chunk, ChunkGroupResult, ChunkItem, ChunkType, ChunkableModule, ChunkingConfig,\n         ChunkingConfigs, ChunkingContext, EntryChunkGroupResult, EvaluatableAsset,\n-        EvaluatableAssets, MinifyType, ModuleId, SourceMapsType,\n+        EvaluatableAssets, MinifyType, ModuleId, SourceMapSourceType, SourceMapsType,\n         availability_info::AvailabilityInfo,\n         chunk_group::{MakeChunkGroupResult, make_chunk_group},\n         module_id_strategies::{DevModuleIdStrategy, ModuleIdStrategy},\n@@ -91,8 +91,8 @@ impl BrowserChunkingContextBuilder {\n         self\n     }\n \n-    pub fn use_file_source_map_uris(mut self) -> Self {\n-        self.chunking_context.should_use_file_source_map_uris = true;\n+    pub fn source_map_source_type(mut self, source_map_source_type: SourceMapSourceType) -> Self {\n+        self.chunking_context.source_map_source_type = source_map_source_type;\n         self\n     }\n \n@@ -229,8 +229,8 @@ pub struct BrowserChunkingContext {\n     name: Option<RcStr>,\n     /// The root path of the project\n     root_path: FileSystemPath,\n-    /// Whether to write file sources as file:// paths in source maps\n-    should_use_file_source_map_uris: bool,\n+    /// The strategy to use for generating source map source uris\n+    source_map_source_type: SourceMapSourceType,\n     /// This path is used to compute the url to request chunks from\n     output_root: FileSystemPath,\n     /// The relative path from the output_root to the root_path.\n@@ -311,7 +311,7 @@ impl BrowserChunkingContext {\n                 client_root,\n                 client_roots: Default::default(),\n                 chunk_root_path,\n-                should_use_file_source_map_uris: false,\n+                source_map_source_type: SourceMapSourceType::TurbopackUri,\n                 asset_root_path,\n                 asset_root_paths: Default::default(),\n                 chunk_base_path: None,\n@@ -617,8 +617,8 @@ impl ChunkingContext for BrowserChunkingContext {\n     }\n \n     #[turbo_tasks::function]\n-    fn should_use_file_source_map_uris(&self) -> Vc<bool> {\n-        Vc::cell(self.should_use_file_source_map_uris)\n+    fn source_map_source_type(&self) -> Vc<SourceMapSourceType> {\n+        self.source_map_source_type.cell()\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "0646860763fc3a7722850080e9c06437a7172a8b",
            "filename": "turbopack/crates/turbopack-cli/src/dev/web_entry_source.rs",
            "status": "modified",
            "additions": 4,
            "deletions": 2,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fweb_entry_source.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fweb_entry_source.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-cli%2Fsrc%2Fdev%2Fweb_entry_source.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -6,7 +6,9 @@ use turbo_tasks_fs::FileSystemPath;\n use turbopack_browser::{BrowserChunkingContext, react_refresh::assert_can_resolve_react_refresh};\n use turbopack_cli_utils::runtime_entry::{RuntimeEntries, RuntimeEntry};\n use turbopack_core::{\n-    chunk::{ChunkableModule, ChunkingContext, EvaluatableAsset, SourceMapsType},\n+    chunk::{\n+        ChunkableModule, ChunkingContext, EvaluatableAsset, SourceMapSourceType, SourceMapsType,\n+    },\n     environment::Environment,\n     file_source::FileSource,\n     module::Module,\n@@ -51,7 +53,7 @@ pub async fn get_client_chunking_context(\n             RuntimeType::Development,\n         )\n         .hot_module_replacement()\n-        .use_file_source_map_uris()\n+        .source_map_source_type(SourceMapSourceType::AbsoluteFileUri)\n         .dynamic_chunk_content_loading(true)\n         .build(),\n     ))"
        },
        {
            "sha": "9b13a6906067d5f98e2bb6f8ddfb2882e06a8041",
            "filename": "turbopack/crates/turbopack-core/src/chunk/chunking_context.rs",
            "status": "modified",
            "additions": 64,
            "deletions": 2,
            "changes": 66,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fchunking_context.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -1,4 +1,4 @@\n-use anyhow::Result;\n+use anyhow::{Result, bail};\n use rustc_hash::FxHashMap;\n use serde::{Deserialize, Serialize};\n use turbo_rcstr::RcStr;\n@@ -133,13 +133,22 @@ pub struct ChunkingConfig {\n #[turbo_tasks::value(transparent)]\n pub struct ChunkingConfigs(FxHashMap<ResolvedVc<Box<dyn ChunkType>>, ChunkingConfig>);\n \n+#[turbo_tasks::value(shared)]\n+#[derive(Debug, Clone, Copy, Hash, TaskInput, Default)]\n+pub enum SourceMapSourceType {\n+    AbsoluteFileUri,\n+    RelativeUri,\n+    #[default]\n+    TurbopackUri,\n+}\n+\n /// A context for the chunking that influences the way chunks are created\n #[turbo_tasks::value_trait]\n pub trait ChunkingContext {\n     #[turbo_tasks::function]\n     fn name(self: Vc<Self>) -> Vc<RcStr>;\n     #[turbo_tasks::function]\n-    fn should_use_file_source_map_uris(self: Vc<Self>) -> Vc<bool>;\n+    fn source_map_source_type(self: Vc<Self>) -> Vc<SourceMapSourceType>;\n     /// The root path of the project\n     #[turbo_tasks::function]\n     fn root_path(self: Vc<Self>) -> Vc<FileSystemPath>;\n@@ -385,6 +394,13 @@ pub trait ChunkingContextExt {\n     ) -> Vc<OutputAssetsWithReferenced>\n     where\n         Self: Send;\n+\n+    /// Computes the relative path from the chunk output root to the project root.\n+    ///\n+    /// This is used to compute relative paths for source maps in certain configurations.\n+    fn relative_path_from_chunk_root_to_project_root(self: Vc<Self>) -> Vc<RcStr>\n+    where\n+        Self: Send;\n }\n \n impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingContextExt for T {\n@@ -499,6 +515,52 @@ impl<T: ChunkingContext + Send + Upcast<Box<dyn ChunkingContext>>> ChunkingConte\n             availability_info,\n         )\n     }\n+\n+    fn relative_path_from_chunk_root_to_project_root(self: Vc<Self>) -> Vc<RcStr> {\n+        relative_path_from_chunk_root_to_project_root(Vc::upcast_non_strict(self))\n+    }\n+}\n+\n+#[turbo_tasks::function]\n+async fn relative_path_from_chunk_root_to_project_root(\n+    chunking_context: Vc<Box<dyn ChunkingContext>>,\n+) -> Result<Vc<RcStr>> {\n+    // Example,\n+    //   project root: /project/root\n+    //   output root: /project/root/dist\n+    //   chunk root path: /project/root/dist/ssr/chunks\n+    //   output_root_to_chunk_root: ../\n+    //\n+    // Example2,\n+    //   project root: /project/root\n+    //   output root: /project/out\n+    //   chunk root path: /project/out/ssr/chunks\n+    //   output_root_to_chunk_root: ../root\n+    //\n+    // From that we want to return  ../../../root to get from a path in `chunks` to a path in the\n+    // project root.\n+\n+    let chunk_root_path = chunking_context.chunk_root_path().await?;\n+    let output_root = chunking_context.output_root().await?;\n+    let chunk_to_output_root = chunk_root_path.get_relative_path_to(&output_root);\n+    let Some(chunk_to_output_root) = chunk_to_output_root else {\n+        bail!(\n+            \"expected chunk_root_path: {chunk_root_path} to be inside of output_root: \\\n+             {output_root}\",\n+            chunk_root_path = chunk_root_path.value_to_string().await?,\n+            output_root = output_root.value_to_string().await?\n+        );\n+    };\n+    let output_root_to_chunk_root_path = chunking_context.output_root_to_root_path().await?;\n+\n+    // Note we cannot use `normalize_path` here since it rejects paths that start with `../`\n+    Ok(Vc::cell(\n+        format!(\n+            \"{}/{}\",\n+            chunk_to_output_root, output_root_to_chunk_root_path\n+        )\n+        .into(),\n+    ))\n }\n \n #[turbo_tasks::function]"
        },
        {
            "sha": "53861abd936e0baf18cc20e6a3aeb0631a83e7fd",
            "filename": "turbopack/crates/turbopack-core/src/chunk/mod.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fchunk%2Fmod.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -29,7 +29,8 @@ pub use self::{\n     },\n     chunking_context::{\n         ChunkGroupResult, ChunkGroupType, ChunkingConfig, ChunkingConfigs, ChunkingContext,\n-        ChunkingContextExt, EntryChunkGroupResult, MangleType, MinifyType, SourceMapsType,\n+        ChunkingContextExt, EntryChunkGroupResult, MangleType, MinifyType, SourceMapSourceType,\n+        SourceMapsType,\n     },\n     data::{ChunkData, ChunkDataOption, ChunksData},\n     evaluate::{EvaluatableAsset, EvaluatableAssetExt, EvaluatableAssets},"
        },
        {
            "sha": "d955eaf43c09a71d6e7f1ff84f6d188b37523fc8",
            "filename": "turbopack/crates/turbopack-core/src/source_map/utils.rs",
            "status": "modified",
            "additions": 72,
            "deletions": 18,
            "changes": 90,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Futils.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Futils.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-core%2Fsrc%2Fsource_map%2Futils.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -6,9 +6,10 @@ use once_cell::sync::Lazy;\n use regex::Regex;\n use serde::{Deserialize, Serialize};\n use serde_json::value::RawValue;\n+use turbo_rcstr::RcStr;\n use turbo_tasks::{ResolvedVc, ValueToString};\n use turbo_tasks_fs::{\n-    DiskFileSystem, FileContent, FileSystemPath, rope::Rope, util::uri_from_file,\n+    DiskFileSystem, FileContent, FileSystemPath, rope::Rope, util::uri_from_path_buf,\n };\n use url::Url;\n \n@@ -71,6 +72,7 @@ struct SourceMapJson {\n     ignore_list: Option<Box<RawValue>>,\n \n     // A somewhat widespread non-standard extension\n+    #[serde(skip_serializing_if = \"Option::is_none\")]\n     debug_id: Option<Box<RawValue>>,\n \n     #[serde(skip_serializing_if = \"Option::is_none\")]\n@@ -224,12 +226,18 @@ fn unencoded_str_to_raw_value(unencoded: &str) -> Box<RawValue> {\n     .expect(\"serde_json::to_string should produce valid JSON\")\n }\n \n-/// Turns `turbopack:///[project]` references in sourcemap sources into absolute `file://` uris. This\n-/// is useful for debugging environments.\n-pub async fn fileify_source_map(\n+/// Helper function to transform turbopack:/// file references in a sourcemap.\n+/// Handles parsing the sourcemap, resolving the filesystem, applying transformations, and\n+/// serializing back.\n+/// The transform function is given the source string as found in the sourcemap (i.e. a URI).\n+async fn transform_relative_files<F>(\n     map: Option<&Rope>,\n-    context_path: FileSystemPath,\n-) -> Result<Option<Rope>> {\n+    context_path: &FileSystemPath,\n+    mut transform: F,\n+) -> Result<Option<Rope>>\n+where\n+    F: FnMut(&DiskFileSystem, &str) -> Result<String>,\n+{\n     let Some(map) = map else {\n         return Ok(None);\n     };\n@@ -243,29 +251,75 @@ pub async fn fileify_source_map(\n     let context_fs = &*ResolvedVc::try_downcast_type::<DiskFileSystem>(context_fs)\n         .context(\"Expected the chunking context to have a DiskFileSystem\")?\n         .await?;\n+\n     let prefix = format!(\"{}///[{}]/\", SOURCE_URL_PROTOCOL, context_fs.name());\n \n-    let transform_source = async |src: &mut Option<String>| {\n-        if let Some(src) = src\n-            && let Some(src_rest) = src.strip_prefix(&prefix)\n-        {\n-            *src = uri_from_file(context_path.clone(), Some(src_rest)).await?;\n+    let mut apply_transform = |src: &mut String| -> Result<()> {\n+        if let Some(src_rest) = src.strip_prefix(&prefix) {\n+            *src = transform(context_fs, src_rest)?;\n         }\n-        anyhow::Ok(())\n+        Ok(())\n     };\n \n-    for src in map.sources.iter_mut().flatten() {\n-        transform_source(src).await?;\n+    for src in map.sources.iter_mut().flatten().flatten() {\n+        apply_transform(src)?;\n     }\n     for section in map.sections.iter_mut().flatten() {\n-        for src in section.map.sources.iter_mut().flatten() {\n-            transform_source(src).await?;\n+        for src in section.map.sources.iter_mut().flatten().flatten() {\n+            apply_transform(src)?;\n         }\n     }\n \n-    let map = Rope::from(serde_json::to_vec(&map)?);\n+    Ok(Some(Rope::from(serde_json::to_vec(&map)?)))\n+}\n \n-    Ok(Some(map))\n+/// Turns `turbopack:///[project]` references in sourcemap sources into absolute `file://` uris. This\n+/// is useful for debugging environments.\n+pub async fn absolute_fileify_source_map(\n+    map: Option<&Rope>,\n+    context_path: FileSystemPath,\n+) -> Result<Option<Rope>> {\n+    transform_relative_files(map, &context_path, |context_fs, src_rest| {\n+        let path = context_path.join(src_rest)?;\n+\n+        Ok(uri_from_path_buf(context_fs.to_sys_path(&path)))\n+    })\n+    .await\n+}\n+\n+fn uri_encode_path(path: &str) -> String {\n+    path.split('/')\n+        .map(|s| urlencoding::encode(s))\n+        .collect::<Vec<_>>()\n+        .join(\"/\")\n+}\n+/// Turns `turbopack:///[project]` references in sourcemap sources into relative './' prefixed uris.\n+/// This is useful in server environments and especially build environments.\n+pub async fn relative_fileify_source_map(\n+    map: Option<&Rope>,\n+    context_path: FileSystemPath,\n+    relative_path_to_output_root: RcStr,\n+) -> Result<Option<Rope>> {\n+    let relative_path_to_output_root = relative_path_to_output_root\n+        .split('/')\n+        .map(|s| urlencoding::encode(s))\n+        .collect::<Vec<_>>()\n+        .join(\"/\");\n+    transform_relative_files(map, &context_path, |_context_fs, src_rest| {\n+        // NOTE: we just include the relative path prefix here instead of using `sourceRoot`\n+        // since the spec on sourceRoot is broken.\n+\n+        // TODO(bgw): this shouldn't be necessary to uri encode since the strings we get out of the\n+        // source map should already be uri encoded, however in the case of the turbopack scheme in\n+        // particular we are inconsistent so be defensive here.\n+        let src_rest = uri_encode_path(src_rest);\n+        if relative_path_to_output_root.is_empty() {\n+            Ok(src_rest.to_string())\n+        } else {\n+            Ok(format!(\"{relative_path_to_output_root}/{src_rest}\",))\n+        }\n+    })\n+    .await\n }\n \n #[cfg(test)]"
        },
        {
            "sha": "baa71427f1757c58513165ca77e7d13da0748fa5",
            "filename": "turbopack/crates/turbopack-css/src/chunk/mod.rs",
            "status": "modified",
            "additions": 27,
            "deletions": 15,
            "changes": 42,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-css%2Fsrc%2Fchunk%2Fmod.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -18,8 +18,8 @@ use turbopack_core::{\n     chunk::{\n         AsyncModuleInfo, Chunk, ChunkItem, ChunkItemBatchGroup, ChunkItemExt,\n         ChunkItemOrBatchWithAsyncModuleInfo, ChunkItemWithAsyncModuleInfo, ChunkType,\n-        ChunkableModule, ChunkingContext, MinifyType, OutputChunk, OutputChunkRuntimeInfo,\n-        round_chunk_item_size,\n+        ChunkableModule, ChunkingContext, ChunkingContextExt, MinifyType, OutputChunk,\n+        OutputChunkRuntimeInfo, SourceMapSourceType, round_chunk_item_size,\n     },\n     code_builder::{Code, CodeBuilder},\n     ident::AssetIdent,\n@@ -32,7 +32,10 @@ use turbopack_core::{\n     output::{OutputAsset, OutputAssets},\n     reference_type::ImportContext,\n     server_fs::ServerFileSystem,\n-    source_map::{GenerateSourceMap, OptionStringifiedSourceMap, utils::fileify_source_map},\n+    source_map::{\n+        GenerateSourceMap, OptionStringifiedSourceMap,\n+        utils::{absolute_fileify_source_map, relative_fileify_source_map},\n+    },\n };\n \n use self::{single_item_chunk::chunk::SingleItemCssChunk, source_map::CssChunkSourceMapAsset};\n@@ -96,18 +99,27 @@ impl CssChunk {\n \n             let close = write_import_context(&mut body, content.import_context).await?;\n \n-            let source_map = if *self\n-                .chunking_context()\n-                .should_use_file_source_map_uris()\n-                .await?\n-            {\n-                fileify_source_map(\n-                    content.source_map.as_ref(),\n-                    self.chunking_context().root_path().owned().await?,\n-                )\n-                .await?\n-            } else {\n-                content.source_map.clone()\n+            let chunking_context = self.chunking_context();\n+            let source_map = match *chunking_context.source_map_source_type().await? {\n+                SourceMapSourceType::AbsoluteFileUri => {\n+                    absolute_fileify_source_map(\n+                        content.source_map.as_ref(),\n+                        chunking_context.root_path().owned().await?,\n+                    )\n+                    .await?\n+                }\n+                SourceMapSourceType::RelativeUri => {\n+                    relative_fileify_source_map(\n+                        content.source_map.as_ref(),\n+                        chunking_context.root_path().owned().await?,\n+                        chunking_context\n+                            .relative_path_from_chunk_root_to_project_root()\n+                            .owned()\n+                            .await?,\n+                    )\n+                    .await?\n+                }\n+                SourceMapSourceType::TurbopackUri => content.source_map.clone(),\n             };\n \n             body.push_source(&content.inner_code, source_map);"
        },
        {
            "sha": "a6e9705a272d20de09426993dfc0a55e57e77acb",
            "filename": "turbopack/crates/turbopack-ecmascript/src/chunk/item.rs",
            "status": "modified",
            "additions": 52,
            "deletions": 12,
            "changes": 64,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Fchunk%2Fitem.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -3,18 +3,21 @@ use std::io::Write;\n use anyhow::{Result, bail};\n use serde::{Deserialize, Serialize};\n use smallvec::SmallVec;\n-use turbo_rcstr::rcstr;\n+use turbo_rcstr::{RcStr, rcstr};\n use turbo_tasks::{\n     NonLocalValue, ResolvedVc, TaskInput, TryJoinIterExt, Upcast, ValueToString, Vc,\n     trace::TraceRawVcs,\n };\n use turbo_tasks_fs::{FileSystemPath, rope::Rope};\n use turbopack_core::{\n-    chunk::{AsyncModuleInfo, ChunkItem, ChunkItemWithAsyncModuleInfo, ChunkingContext, ModuleId},\n+    chunk::{\n+        AsyncModuleInfo, ChunkItem, ChunkItemWithAsyncModuleInfo, ChunkingContext,\n+        ChunkingContextExt, ModuleId, SourceMapSourceType,\n+    },\n     code_builder::{Code, CodeBuilder},\n     error::PrettyPrintError,\n     issue::{IssueExt, IssueSeverity, StyledString, code_gen::CodeGenerationIssue},\n-    source_map::utils::fileify_source_map,\n+    source_map::utils::{absolute_fileify_source_map, relative_fileify_source_map},\n };\n \n use crate::{\n@@ -24,14 +27,34 @@ use crate::{\n     utils::StringifyJs,\n };\n \n+#[derive(\n+    Debug,\n+    Clone,\n+    PartialEq,\n+    Eq,\n+    Hash,\n+    Serialize,\n+    Deserialize,\n+    TraceRawVcs,\n+    TaskInput,\n+    NonLocalValue,\n+    Default,\n+)]\n+pub enum RewriteSourcePath {\n+    AbsoluteFilePath(FileSystemPath),\n+    RelativeFilePath(FileSystemPath, RcStr),\n+    #[default]\n+    None,\n+}\n+\n #[turbo_tasks::value(shared)]\n #[derive(Default, Clone)]\n pub struct EcmascriptChunkItemContent {\n     pub inner_code: Rope,\n     pub source_map: Option<Rope>,\n     pub additional_ids: SmallVec<[ResolvedVc<ModuleId>; 1]>,\n     pub options: EcmascriptChunkItemOptions,\n-    pub rewrite_source_path: Option<FileSystemPath>,\n+    pub rewrite_source_path: RewriteSourcePath,\n     pub placeholder_for_future_extensions: (),\n }\n \n@@ -53,10 +76,18 @@ impl EcmascriptChunkItemContent {\n         let strict = content.strict;\n \n         Ok(EcmascriptChunkItemContent {\n-            rewrite_source_path: if *chunking_context.should_use_file_source_map_uris().await? {\n-                Some(chunking_context.root_path().owned().await?)\n-            } else {\n-                None\n+            rewrite_source_path: match *chunking_context.source_map_source_type().await? {\n+                SourceMapSourceType::AbsoluteFileUri => {\n+                    RewriteSourcePath::AbsoluteFilePath(chunking_context.root_path().owned().await?)\n+                }\n+                SourceMapSourceType::RelativeUri => RewriteSourcePath::RelativeFilePath(\n+                    chunking_context.root_path().owned().await?,\n+                    chunking_context\n+                        .relative_path_from_chunk_root_to_project_root()\n+                        .owned()\n+                        .await?,\n+                ),\n+                SourceMapSourceType::TurbopackUri => RewriteSourcePath::None,\n             },\n             inner_code: content.inner_code.clone(),\n             source_map: content.source_map.clone(),\n@@ -112,10 +143,19 @@ impl EcmascriptChunkItemContent {\n             )?;\n         }\n \n-        let source_map = if let Some(rewrite_source_path) = &self.rewrite_source_path {\n-            fileify_source_map(self.source_map.as_ref(), rewrite_source_path.clone()).await?\n-        } else {\n-            self.source_map.clone()\n+        let source_map = match &self.rewrite_source_path {\n+            RewriteSourcePath::AbsoluteFilePath(path) => {\n+                absolute_fileify_source_map(self.source_map.as_ref(), path.clone()).await?\n+            }\n+            RewriteSourcePath::RelativeFilePath(path, relative_path) => {\n+                relative_fileify_source_map(\n+                    self.source_map.as_ref(),\n+                    path.clone(),\n+                    relative_path.clone(),\n+                )\n+                .await?\n+            }\n+            RewriteSourcePath::None => self.source_map.clone(),\n         };\n \n         code.push_source(&self.inner_code, source_map);"
        },
        {
            "sha": "0f212054ab23e314e73e533075bb0878664cbaa6",
            "filename": "turbopack/crates/turbopack-ecmascript/src/tree_shake/chunk_item.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fchunk_item.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fchunk_item.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-ecmascript%2Fsrc%2Ftree_shake%2Fchunk_item.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -13,7 +13,7 @@ use crate::{\n     EcmascriptAnalyzableExt,\n     chunk::{\n         EcmascriptChunkItem, EcmascriptChunkItemContent, EcmascriptChunkItemOptions,\n-        EcmascriptChunkPlaceable, EcmascriptChunkType,\n+        EcmascriptChunkPlaceable, EcmascriptChunkType, item::RewriteSourcePath,\n     },\n     references::async_module::AsyncModuleOptions,\n     runtime_functions::{TURBOPACK_EXPORT_NAMESPACE, TURBOPACK_IMPORT},\n@@ -166,7 +166,7 @@ impl EcmascriptChunkItem for SideEffectsModuleChunkItem {\n         Ok(EcmascriptChunkItemContent {\n             inner_code: code,\n             source_map: None,\n-            rewrite_source_path: None,\n+            rewrite_source_path: RewriteSourcePath::None,\n             options: EcmascriptChunkItemOptions {\n                 strict: true,\n                 async_module: if has_top_level_await {"
        },
        {
            "sha": "31cf20a84b4ea5ebf67df81adebe2442213c8ad6",
            "filename": "turbopack/crates/turbopack-nodejs/src/chunking_context.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 8,
            "changes": 16,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-nodejs%2Fsrc%2Fchunking_context.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -8,7 +8,7 @@ use turbopack_core::{\n     chunk::{\n         Chunk, ChunkGroupResult, ChunkItem, ChunkType, ChunkableModule, ChunkingConfig,\n         ChunkingConfigs, ChunkingContext, EntryChunkGroupResult, EvaluatableAssets, MinifyType,\n-        ModuleId, SourceMapsType,\n+        ModuleId, SourceMapSourceType, SourceMapsType,\n         availability_info::AvailabilityInfo,\n         chunk_group::{MakeChunkGroupResult, make_chunk_group},\n         module_id_strategies::{DevModuleIdStrategy, ModuleIdStrategy},\n@@ -99,8 +99,8 @@ impl NodeJsChunkingContextBuilder {\n         self\n     }\n \n-    pub fn use_file_source_map_uris(mut self) -> Self {\n-        self.chunking_context.should_use_file_source_map_uris = true;\n+    pub fn source_map_source_type(mut self, source_map_source_type: SourceMapSourceType) -> Self {\n+        self.chunking_context.source_map_source_type = source_map_source_type;\n         self\n     }\n \n@@ -182,8 +182,8 @@ pub struct NodeJsChunkingContext {\n     module_id_strategy: ResolvedVc<Box<dyn ModuleIdStrategy>>,\n     /// The module export usage info, if available.\n     export_usage: Option<ResolvedVc<ExportUsageInfo>>,\n-    /// Whether to use file:// uris for source map sources\n-    should_use_file_source_map_uris: bool,\n+    /// The strategy to use for generating source map source uris\n+    source_map_source_type: SourceMapSourceType,\n     /// The chunking configs\n     chunking_configs: Vec<(ResolvedVc<Box<dyn ChunkType>>, ChunkingConfig)>,\n     /// Enable debug IDs for chunks and source maps.\n@@ -222,7 +222,7 @@ impl NodeJsChunkingContext {\n                 minify_type: MinifyType::NoMinify,\n                 source_maps_type: SourceMapsType::Full,\n                 manifest_chunks: false,\n-                should_use_file_source_map_uris: false,\n+                source_map_source_type: SourceMapSourceType::TurbopackUri,\n                 module_id_strategy: ResolvedVc::upcast(DevModuleIdStrategy::new_resolved()),\n                 export_usage: None,\n                 chunking_configs: Default::default(),\n@@ -387,8 +387,8 @@ impl ChunkingContext for NodeJsChunkingContext {\n     }\n \n     #[turbo_tasks::function]\n-    fn should_use_file_source_map_uris(&self) -> Vc<bool> {\n-        Vc::cell(self.should_use_file_source_map_uris)\n+    fn source_map_source_type(&self) -> Vc<SourceMapSourceType> {\n+        self.source_map_source_type.cell()\n     }\n \n     #[turbo_tasks::function]"
        },
        {
            "sha": "09b68e5e5c4ea8354ce6cc14cf7a5f142d99b4a9",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot.rs",
            "status": "modified",
            "additions": 8,
            "deletions": 3,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot.rs?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -33,7 +33,7 @@ use turbopack_core::{\n     asset::Asset,\n     chunk::{\n         ChunkingConfig, ChunkingContext, ChunkingContextExt, EvaluatableAsset, EvaluatableAssetExt,\n-        EvaluatableAssets, MinifyType, availability_info::AvailabilityInfo,\n+        EvaluatableAssets, MinifyType, SourceMapSourceType, availability_info::AvailabilityInfo,\n     },\n     compile_time_defines,\n     compile_time_info::{CompileTimeDefineValue, CompileTimeInfo, DefinableNameSegment},\n@@ -91,6 +91,8 @@ struct SnapshotOptions {\n     production_chunking: bool,\n     #[serde(default)]\n     enable_debug_ids: bool,\n+    #[serde(default)]\n+    source_map_source_type: SourceMapSourceType,\n }\n \n #[derive(Debug, Deserialize, Default)]\n@@ -121,6 +123,7 @@ impl Default for SnapshotOptions {\n             scope_hoisting: false,\n             production_chunking: false,\n             enable_debug_ids: false,\n+            source_map_source_type: SourceMapSourceType::default(),\n         }\n     }\n }\n@@ -460,7 +463,8 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n             .minify_type(options.minify_type)\n             .module_merging(options.scope_hoisting)\n             .export_usage(export_usage)\n-            .debug_ids(options.enable_debug_ids);\n+            .debug_ids(options.enable_debug_ids)\n+            .source_map_source_type(options.source_map_source_type);\n \n             if options.production_chunking {\n                 builder = builder.chunking_config(\n@@ -489,7 +493,8 @@ async fn run_test_operation(resource: RcStr) -> Result<Vc<FileSystemPath>> {\n             .minify_type(options.minify_type)\n             .module_merging(options.scope_hoisting)\n             .export_usage(export_usage)\n-            .debug_ids(options.enable_debug_ids);\n+            .debug_ids(options.enable_debug_ids)\n+            .source_map_source_type(options.source_map_source_type);\n \n             if options.production_chunking {\n                 builder = builder.chunking_config("
        },
        {
            "sha": "a1b371cb3b60c64a246bb74d0a3952006d5af0f7",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/debug-ids/node/options.json",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdebug-ids%2Fnode%2Foptions.json",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdebug-ids%2Fnode%2Foptions.json",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdebug-ids%2Fnode%2Foptions.json?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -3,5 +3,6 @@\n   \"runtimeType\": \"Development\",\n   \"minifyType\": \"NoMinify\",\n   \"environment\": \"NodeJs\",\n-  \"enableDebugIds\": true\n+  \"enableDebugIds\": true,\n+  \"sourceMapSourceType\": \"RelativeUri\"\n }"
        },
        {
            "sha": "bb66d25fc986d221dbab60bb59605eb17cb9b28a",
            "filename": "turbopack/crates/turbopack-tests/tests/snapshot/debug-ids/node/output/aaf3a_crates_turbopack-tests_tests_snapshot_debug-ids_node_input_index_b515b56f.js.map",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdebug-ids%2Fnode%2Foutput%2Faaf3a_crates_turbopack-tests_tests_snapshot_debug-ids_node_input_index_b515b56f.js.map",
            "raw_url": "https://github.com/vercel/next.js/raw/2704e8bd54f79eac5cac80769d34d4d38b56f08d/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdebug-ids%2Fnode%2Foutput%2Faaf3a_crates_turbopack-tests_tests_snapshot_debug-ids_node_input_index_b515b56f.js.map",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbopack-tests%2Ftests%2Fsnapshot%2Fdebug-ids%2Fnode%2Foutput%2Faaf3a_crates_turbopack-tests_tests_snapshot_debug-ids_node_input_index_b515b56f.js.map?ref=2704e8bd54f79eac5cac80769d34d4d38b56f08d",
            "patch": "@@ -3,5 +3,5 @@\n   \"sources\": [],\n   \"debugId\": \"3d97c2d1-90e5-a3ef-c710-5c78b21b3b3a\",\n   \"sections\": [\n-    {\"offset\": {\"line\": 4, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"turbopack:///[project]/turbopack/crates/turbopack-tests/tests/snapshot/debug-ids/node/input/index.js\"],\"sourcesContent\":[\"console.log('Hello World')\\n\"],\"names\":[],\"mappings\":\"AAAA,QAAQ,GAAG,CAAC\"}}]\n+    {\"offset\": {\"line\": 4, \"column\": 0}, \"map\": {\"version\":3,\"sources\":[\"../../../../../../../../turbopack/crates/turbopack-tests/tests/snapshot/debug-ids/node/input/index.js\"],\"sourcesContent\":[\"console.log('Hello World')\\n\"],\"names\":[],\"mappings\":\"AAAA,QAAQ,GAAG,CAAC\"}}]\n }\n\\ No newline at end of file"
        }
    ],
    "stats": {
        "total": 381,
        "additions": 275,
        "deletions": 106
    }
}