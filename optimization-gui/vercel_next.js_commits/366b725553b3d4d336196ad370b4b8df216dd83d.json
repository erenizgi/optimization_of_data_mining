{
    "author": "devjiwonchoi",
    "message": "[ts-next-plugin] fix: use `getSourceFile` instead of `fileExists` to check file existence (#77863)\n\n### Why?\n\nThe Next.js TypeScript plugin was doing a workaround for updating the\nvirtual file with `deleteFile()` then `createFile()` since\n`updateFile()` failed even though `env.sys.fileExists()` passed.\n\nIt is because the system was created based on the FS system via\n`createFSBackedSystem()`, which falls back to read from the actual file\nsystem if the file doesn't exist on the current virtual file system.\n\n\nhttps://github.com/microsoft/TypeScript-Website/blob/9d447358e4fc67c881202fb40115cd8adf70daad/packages/typescript-vfs/src/index.ts#L544\n\n![CleanShot 2025-04-05 at 17 39\n35@2x](https://github.com/user-attachments/assets/96b3ec2e-3b6d-407d-877f-bdd3224b156b)\n\n### How?\n\nUse `getSourceFile()` to check if the file actually exists. This is\nwhat`@typescript/vfs` uses to check before running the `updateFile()`.\n\n\nhttps://github.com/microsoft/TypeScript-Website/blob/9d447358e4fc67c881202fb40115cd8adf70daad/packages/typescript-vfs/src/index.ts#L83-L87",
    "sha": "366b725553b3d4d336196ad370b4b8df216dd83d",
    "files": [
        {
            "sha": "7f4b52708aa801f5438995955f2c0ef2067b81fc",
            "filename": "packages/next/src/server/typescript/rules/metadata.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 5,
            "changes": 7,
            "blob_url": "https://github.com/vercel/next.js/blob/366b725553b3d4d336196ad370b4b8df216dd83d/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fmetadata.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/366b725553b3d4d336196ad370b4b8df216dd83d/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fmetadata.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Ftypescript%2Frules%2Fmetadata.ts?ref=366b725553b3d4d336196ad370b4b8df216dd83d",
            "patch": "@@ -86,12 +86,9 @@ function updateVirtualFileWithType(\n     sourceText.slice(nodeEnd) +\n     TYPE_IMPORT\n \n-  if (virtualTsEnv.sys.fileExists(fileName)) {\n+  if (virtualTsEnv.getSourceFile(fileName)) {\n     log('Updating file: ' + fileName)\n-    // FIXME: updateFile() breaks as the file doesn't exists, which is weird.\n-    // virtualTsEnv.updateFile(fileName, newSource)\n-    virtualTsEnv.deleteFile(fileName)\n-    virtualTsEnv.createFile(fileName, newSource)\n+    virtualTsEnv.updateFile(fileName, newSource)\n   } else {\n     log('Creating file: ' + fileName)\n     virtualTsEnv.createFile(fileName, newSource)"
        }
    ],
    "stats": {
        "total": 7,
        "additions": 2,
        "deletions": 5
    }
}