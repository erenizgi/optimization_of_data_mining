{
    "author": "gaojude",
    "message": "Fix: Allow dynamic rendering when root layout is wrapped in Suspense (#82378)\n\nThe prelude is empty when the entire app is suspended during prerender.\nTypically this indicates a lack of suspense boundary in the app, which\ncreates no static shell, thus throwing error. However, if the root\nlayout itself is dynamic but wrapped under a suspense, we need special\nlogic in this PR to detect that.",
    "sha": "cc5e9e67006b24b808217a34528dff3455905ee3",
    "files": [
        {
            "sha": "6594ef4afc5cec25b9c4691fc3886b1ed055eb15",
            "filename": "packages/next/src/client/components/app-router.tsx",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Fapp-router.tsx?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -44,6 +44,7 @@ import { isRedirectError, RedirectType } from './redirect-error'\n import { pingVisibleLinks } from './links'\n import RootErrorBoundary from './errors/root-error-boundary'\n import DefaultGlobalError from './builtin/global-error'\n+import { RootLayoutBoundary } from '../../lib/framework/boundary-components'\n \n const globalMutable: {\n   pendingMpaPath?: string\n@@ -482,7 +483,10 @@ function Router({\n   let content = (\n     <RedirectBoundary>\n       {head}\n-      {cache.rsc}\n+      {/* RootLayoutBoundary enables detection of Suspense boundaries around the root layout.\n+          When users wrap their layout in <Suspense>, this creates the component stack pattern\n+          \"Suspense -> RootLayoutBoundary\" which dynamic-rendering.ts uses to allow dynamic rendering. */}\n+      <RootLayoutBoundary>{cache.rsc}</RootLayoutBoundary>\n       <AppRouterAnnouncer tree={tree} />\n     </RedirectBoundary>\n   )"
        },
        {
            "sha": "605b5b0a841f491299c0d537abea3cdb3597e1be",
            "filename": "packages/next/src/lib/framework/boundary-components.tsx",
            "status": "renamed",
            "additions": 17,
            "deletions": 13,
            "changes": 30,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Flib%2Fframework%2Fboundary-components.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Flib%2Fframework%2Fboundary-components.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fframework%2Fboundary-components.tsx?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -1,32 +1,29 @@\n 'use client'\n \n+import type { ReactNode } from 'react'\n import {\n   METADATA_BOUNDARY_NAME,\n   VIEWPORT_BOUNDARY_NAME,\n   OUTLET_BOUNDARY_NAME,\n-} from '../../../lib/metadata/metadata-constants'\n+  ROOT_LAYOUT_BOUNDARY_NAME,\n+} from './boundary-constants'\n \n // We use a namespace object to allow us to recover the name of the function\n // at runtime even when production bundling/minification is used.\n const NameSpace = {\n-  [METADATA_BOUNDARY_NAME]: function ({\n-    children,\n-  }: {\n-    children: React.ReactNode\n-  }) {\n+  [METADATA_BOUNDARY_NAME]: function ({ children }: { children: ReactNode }) {\n     return children\n   },\n-  [VIEWPORT_BOUNDARY_NAME]: function ({\n-    children,\n-  }: {\n-    children: React.ReactNode\n-  }) {\n+  [VIEWPORT_BOUNDARY_NAME]: function ({ children }: { children: ReactNode }) {\n     return children\n   },\n-  [OUTLET_BOUNDARY_NAME]: function ({\n+  [OUTLET_BOUNDARY_NAME]: function ({ children }: { children: ReactNode }) {\n+    return children\n+  },\n+  [ROOT_LAYOUT_BOUNDARY_NAME]: function ({\n     children,\n   }: {\n-    children: React.ReactNode\n+    children: ReactNode\n   }) {\n     return children\n   },\n@@ -46,3 +43,10 @@ export const OutletBoundary =\n   // We use slice(0) to trick the bundler into not inlining/minifying the function\n   // so it retains the name inferred from the namespace object\n   NameSpace[OUTLET_BOUNDARY_NAME.slice(0) as typeof OUTLET_BOUNDARY_NAME]\n+\n+export const RootLayoutBoundary =\n+  // We use slice(0) to trick the bundler into not inlining/minifying the function\n+  // so it retains the name inferred from the namespace object\n+  NameSpace[\n+    ROOT_LAYOUT_BOUNDARY_NAME.slice(0) as typeof ROOT_LAYOUT_BOUNDARY_NAME\n+  ]",
            "previous_filename": "packages/next/src/client/components/metadata/metadata-boundary.tsx"
        },
        {
            "sha": "49bf395bd97feddfb6e061c0754c34aee624111c",
            "filename": "packages/next/src/lib/framework/boundary-constants.tsx",
            "status": "renamed",
            "additions": 1,
            "deletions": 0,
            "changes": 1,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Flib%2Fframework%2Fboundary-constants.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Flib%2Fframework%2Fboundary-constants.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fframework%2Fboundary-constants.tsx?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -1,3 +1,4 @@\n export const METADATA_BOUNDARY_NAME = '__next_metadata_boundary__'\n export const VIEWPORT_BOUNDARY_NAME = '__next_viewport_boundary__'\n export const OUTLET_BOUNDARY_NAME = '__next_outlet_boundary__'\n+export const ROOT_LAYOUT_BOUNDARY_NAME = '__next_root_layout_boundary__'",
            "previous_filename": "packages/next/src/lib/metadata/metadata-constants.tsx"
        },
        {
            "sha": "99e2b4fff65a16d550f50f5f4fbb315be544ebf8",
            "filename": "packages/next/src/lib/metadata/metadata.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fmetadata.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fmetadata.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Flib%2Fmetadata%2Fmetadata.tsx?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -37,7 +37,7 @@ import type { WorkStore } from '../../server/app-render/work-async-storage.exter\n import {\n   METADATA_BOUNDARY_NAME,\n   VIEWPORT_BOUNDARY_NAME,\n-} from './metadata-constants'\n+} from '../framework/boundary-constants'\n import { AsyncMetadataOutlet } from '../../client/components/metadata/async-metadata'\n import { isPostpone } from '../../server/lib/router-utils/is-postpone'\n import { createServerSearchParamsForMetadata } from '../../server/request/search-params'"
        },
        {
            "sha": "fe579cc870492221f6b655d262c6d51af48181a2",
            "filename": "packages/next/src/server/app-render/create-component-tree.tsx",
            "status": "modified",
            "additions": 1,
            "deletions": 1,
            "changes": 2,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fcreate-component-tree.tsx?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -20,7 +20,7 @@ import { StaticGenBailoutError } from '../../client/components/static-generation\n import type { LoadingModuleData } from '../../shared/lib/app-router-context.shared-runtime'\n import type { Params } from '../request/params'\n import { workUnitAsyncStorage } from './work-unit-async-storage.external'\n-import { OUTLET_BOUNDARY_NAME } from '../../lib/metadata/metadata-constants'\n+import { OUTLET_BOUNDARY_NAME } from '../../lib/framework/boundary-constants'\n import type {\n   UseCacheLayoutComponentProps,\n   UseCachePageComponentProps,"
        },
        {
            "sha": "a1b65d01684888a97c3842d64989b8b11702893e",
            "filename": "packages/next/src/server/app-render/dynamic-rendering.ts",
            "status": "modified",
            "additions": 31,
            "deletions": 6,
            "changes": 37,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fdynamic-rendering.ts?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -40,7 +40,8 @@ import {\n   METADATA_BOUNDARY_NAME,\n   VIEWPORT_BOUNDARY_NAME,\n   OUTLET_BOUNDARY_NAME,\n-} from '../../lib/metadata/metadata-constants'\n+  ROOT_LAYOUT_BOUNDARY_NAME,\n+} from '../../lib/framework/boundary-constants'\n import { scheduleOnNextTick } from '../../lib/scheduler'\n import { BailoutToCSRError } from '../../shared/lib/lazy-dynamic/bailout-to-csr'\n import { InvariantError } from '../../shared/lib/invariant-error'\n@@ -637,8 +638,27 @@ export function useDynamicRouteParams(expression: string) {\n }\n \n const hasSuspenseRegex = /\\n\\s+at Suspense \\(<anonymous>\\)/\n-const hasSuspenseAfterBodyOrHtmlRegex =\n-  /\\n\\s+at (?:body|html) \\(<anonymous>\\)[\\s\\S]*?\\n\\s+at Suspense \\(<anonymous>\\)/\n+\n+// Common implicit body tags that React will treat as body when placed directly in html\n+const bodyAndImplicitTags =\n+  'body|div|main|section|article|aside|header|footer|nav|form|p|span|h1|h2|h3|h4|h5|h6'\n+\n+// Detects when RootLayoutBoundary (our framework marker component) appears\n+// after Suspense in the component stack, indicating the root layout is wrapped\n+// within a Suspense boundary. Ensures no body/html/implicit-body components are in between.\n+//\n+// Example matches:\n+//   at Suspense (<anonymous>)\n+//   at __next_root_layout_boundary__ (<anonymous>)\n+//\n+// Or with other components in between (but not body/html/implicit-body):\n+//   at Suspense (<anonymous>)\n+//   at SomeComponent (<anonymous>)\n+//   at __next_root_layout_boundary__ (<anonymous>)\n+const hasSuspenseBeforeRootLayoutWithoutBodyOrImplicitBodyRegex = new RegExp(\n+  `\\\\n\\\\s+at Suspense \\\\(<anonymous>\\\\)(?:(?!\\\\n\\\\s+at (?:${bodyAndImplicitTags}) \\\\(<anonymous>\\\\))[\\\\s\\\\S])*?\\\\n\\\\s+at ${ROOT_LAYOUT_BOUNDARY_NAME} \\\\([^\\\\n]*\\\\)`\n+)\n+\n const hasMetadataRegex = new RegExp(\n   `\\\\n\\\\s+at ${METADATA_BOUNDARY_NAME}[\\\\n\\\\s]`\n )\n@@ -662,9 +682,14 @@ export function trackAllowedDynamicAccess(\n   } else if (hasViewportRegex.test(componentStack)) {\n     dynamicValidation.hasDynamicViewport = true\n     return\n-  } else if (hasSuspenseAfterBodyOrHtmlRegex.test(componentStack)) {\n-    // This prerender has a Suspense boundary above the body which\n-    // effectively opts the page into allowing 100% dynamic rendering\n+  } else if (\n+    hasSuspenseBeforeRootLayoutWithoutBodyOrImplicitBodyRegex.test(\n+      componentStack\n+    )\n+  ) {\n+    // For Suspense within body, the prelude wouldn't be empty so it wouldn't violate the empty static shells rule.\n+    // But if you have Suspense above body, the prelude is empty but we allow that because having Suspense\n+    // is an explicit signal from the user that they acknowledge the empty shell and want dynamic rendering.\n     dynamicValidation.hasAllowedDynamic = true\n     dynamicValidation.hasSuspenseAboveBody = true\n     return"
        },
        {
            "sha": "89954bc8139cb16beaa787bd13ba6d5b8d5724f8",
            "filename": "packages/next/src/server/app-render/entry-base.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fserver%2Fapp-render%2Fentry-base.ts?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -36,7 +36,8 @@ export {\n   MetadataBoundary,\n   ViewportBoundary,\n   OutletBoundary,\n-} from '../../client/components/metadata/metadata-boundary'\n+  RootLayoutBoundary,\n+} from '../../lib/framework/boundary-components'\n \n export { preloadStyle, preloadFont, preconnect } from './rsc/preloads'\n export { Postpone } from './rsc/postpone'"
        },
        {
            "sha": "3d6b19b8e5aa304fef63ab897baf0b36b917462c",
            "filename": "test/development/acceptance-app/hydration-error.test.ts",
            "status": "modified",
            "additions": 37,
            "deletions": 33,
            "changes": 70,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Facceptance-app%2Fhydration-error.test.ts?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -223,16 +223,17 @@ describe('Error overlay for hydration errors in App router', () => {\n                      <RedirectBoundary>\n                        <RedirectErrorBoundary router={{...}}>\n                          <Head>\n-                         <SegmentViewNode type=\"layout\" pagePath=\"layout.js\">\n-                           <SegmentTrieNode>\n-                           <script>\n-                           <script>\n-                           <script>\n-                           <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n-                             <Root params={Promise}>\n-                               <html\n-       -                         className=\"server-html\"\n-                               >\n+                         <__next_root_layout_boundary__>\n+                           <SegmentViewNode type=\"layout\" pagePath=\"layout.js\">\n+                             <SegmentTrieNode>\n+                             <script>\n+                             <script>\n+                             <script>\n+                             <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n+                               <Root params={Promise}>\n+                                 <html\n+       -                           className=\"server-html\"\n+                                 >\n                          ...\",\n          \"description\": \"A tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n@@ -259,13 +260,14 @@ describe('Error overlay for hydration errors in App router', () => {\n                      <RedirectBoundary>\n                        <RedirectErrorBoundary router={{...}}>\n                          <Head>\n-                         <SegmentViewNode type=\"layout\" pagePath=\"layout.js\">\n-                           <SegmentTrieNode>\n-                           <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n-                             <Root params={Promise}>\n-                               <html\n-       -                         className=\"server-html\"\n-                               >\n+                         <__next_root_layout_boundary__>\n+                           <SegmentViewNode type=\"layout\" pagePath=\"layout.js\">\n+                             <SegmentTrieNode>\n+                             <ClientSegmentRoot Component={function Root} slots={{...}} params={{}}>\n+                               <Root params={Promise}>\n+                                 <html\n+       -                           className=\"server-html\"\n+                                 >\n                          ...\",\n          \"description\": \"A tree hydrated but some attributes of the server rendered HTML didn't match the client properties. This won't be patched up. This can happen if a SSR-ed Client Component used:\",\n          \"environmentLabel\": null,\n@@ -1099,15 +1101,16 @@ describe('Error overlay for hydration errors in App router', () => {\n                      <RedirectBoundary>\n                        <RedirectErrorBoundary router={{...}}>\n                          <Head>\n-                         <SegmentViewNode type=\"layout\" pagePath=\"layout.js\">\n-                           <SegmentTrieNode>\n-                           <script>\n-                           <script>\n-                           <Layout>\n-       >                     <html>\n-                               <body>\n-                               <Script src=\"https://ex...\" strategy=\"beforeInte...\">\n-       >                         <script nonce={undefined} dangerouslySetInnerHTML={{__html:\"(self.__ne...\"}}>\n+                         <__next_root_layout_boundary__>\n+                           <SegmentViewNode type=\"layout\" pagePath=\"layout.js\">\n+                             <SegmentTrieNode>\n+                             <script>\n+                             <script>\n+                             <Layout>\n+       >                       <html>\n+                                 <body>\n+                                 <Script src=\"https://ex...\" strategy=\"beforeInte...\">\n+       >                           <script nonce={undefined} dangerouslySetInnerHTML={{__html:\"(self.__ne...\"}}>\n                          ...\",\n            \"description\": \"In HTML, <script> cannot be a child of <html>.\n        This will cause a hydration error.\",\n@@ -1161,13 +1164,14 @@ describe('Error overlay for hydration errors in App router', () => {\n                      <RedirectBoundary>\n                        <RedirectErrorBoundary router={{...}}>\n                          <Head>\n-                         <SegmentViewNode type=\"layout\" pagePath=\"layout.js\">\n-                           <SegmentTrieNode>\n-                           <Layout>\n-       >                     <html>\n-                               <body>\n-                               <Script src=\"https://ex...\" strategy=\"beforeInte...\">\n-       >                         <script nonce={undefined} dangerouslySetInnerHTML={{__html:\"(self.__ne...\"}}>\n+                         <__next_root_layout_boundary__>\n+                           <SegmentViewNode type=\"layout\" pagePath=\"layout.js\">\n+                             <SegmentTrieNode>\n+                             <Layout>\n+       >                       <html>\n+                                 <body>\n+                                 <Script src=\"https://ex...\" strategy=\"beforeInte...\">\n+       >                           <script nonce={undefined} dangerouslySetInnerHTML={{__html:\"(self.__ne...\"}}>\n                          ...\",\n            \"description\": \"In HTML, <script> cannot be a child of <html>.\n        This will cause a hydration error.\","
        },
        {
            "sha": "e18c47cac01663fdddd9c2987537c27a95cba574",
            "filename": "test/e2e/app-dir/root-suspense-dynamic/fixtures/default/app/dynamic-wrapper.tsx",
            "status": "added",
            "additions": 10,
            "deletions": 0,
            "changes": 10,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Fdynamic-wrapper.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Fdynamic-wrapper.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Fdynamic-wrapper.tsx?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -0,0 +1,10 @@\n+import { headers } from 'next/headers'\n+\n+export default async function DynamicWrapper({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  await headers()\n+  return <div>{children}</div>\n+}"
        },
        {
            "sha": "9ab2427c7dc47dbdfe47ad3f5b3390f7d45b5d8a",
            "filename": "test/e2e/app-dir/root-suspense-dynamic/fixtures/default/app/layout.tsx",
            "status": "added",
            "additions": 21,
            "deletions": 0,
            "changes": 21,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Flayout.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Flayout.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Flayout.tsx?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -0,0 +1,21 @@\n+import { Suspense } from 'react'\n+import DynamicWrapper from './dynamic-wrapper'\n+import { SimpleWrapper } from './simple-wrapper'\n+\n+export default function RootLayout({\n+  children,\n+}: {\n+  children: React.ReactNode\n+}) {\n+  return (\n+    <SimpleWrapper>\n+      <Suspense>\n+        <html>\n+          <body>\n+            <DynamicWrapper>{children}</DynamicWrapper>\n+          </body>\n+        </html>\n+      </Suspense>\n+    </SimpleWrapper>\n+  )\n+}"
        },
        {
            "sha": "4002a0ef56c51e8e0dae3852794af90db75ad162",
            "filename": "test/e2e/app-dir/root-suspense-dynamic/fixtures/default/app/page.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Fpage.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Fpage.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Fpage.tsx?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -0,0 +1,5 @@\n+import React from 'react'\n+\n+export default function HomePage() {\n+  return <p>Hello World</p>\n+}"
        },
        {
            "sha": "e7c9ec51d346ad3b22ae4914a145748837658618",
            "filename": "test/e2e/app-dir/root-suspense-dynamic/fixtures/default/app/simple-wrapper.tsx",
            "status": "added",
            "additions": 5,
            "deletions": 0,
            "changes": 5,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Fsimple-wrapper.tsx",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Fsimple-wrapper.tsx",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fapp%2Fsimple-wrapper.tsx?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -0,0 +1,5 @@\n+'use client'\n+\n+export const SimpleWrapper = ({ children }: { children: React.ReactNode }) => {\n+  return children\n+}"
        },
        {
            "sha": "c6a1a739da691ce298d81591884380ff7063f424",
            "filename": "test/e2e/app-dir/root-suspense-dynamic/fixtures/default/next.config.js",
            "status": "added",
            "additions": 11,
            "deletions": 0,
            "changes": 11,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fnext.config.js",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fnext.config.js",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Ffixtures%2Fdefault%2Fnext.config.js?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -0,0 +1,11 @@\n+/**\n+ * @type {import('next').NextConfig}\n+ */\n+const nextConfig = {\n+  experimental: {\n+    cacheComponents: true,\n+    enablePrerenderSourceMaps: false,\n+  },\n+}\n+\n+module.exports = nextConfig"
        },
        {
            "sha": "187cb40d6820449376a298df7cc060b21a44d014",
            "filename": "test/e2e/app-dir/root-suspense-dynamic/root-suspense-dynamic.test.ts",
            "status": "added",
            "additions": 33,
            "deletions": 0,
            "changes": 33,
            "blob_url": "https://github.com/vercel/next.js/blob/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Froot-suspense-dynamic.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/cc5e9e67006b24b808217a34528dff3455905ee3/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Froot-suspense-dynamic.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Froot-suspense-dynamic%2Froot-suspense-dynamic.test.ts?ref=cc5e9e67006b24b808217a34528dff3455905ee3",
            "patch": "@@ -0,0 +1,33 @@\n+import { nextTestSetup } from 'e2e-utils'\n+\n+describe('Root Suspense Dynamic Rendering', () => {\n+  const { next, isNextStart } = nextTestSetup({\n+    files: __dirname + '/fixtures/default',\n+    skipDeployment: true,\n+  })\n+\n+  // TODO: remove when there is a test for isNextDev === false\n+  it('placeholder to satisfy at least one test when isNextDev is false', async () => {\n+    expect(true).toBe(true)\n+  })\n+\n+  if (isNextStart) {\n+    it('should handle dynamic content wrapped in Suspense above HTML structure', async () => {\n+      try {\n+        // Should render the page successfully\n+        const $ = await next.render$('/')\n+        expect($('body').text()).toContain('Hello World')\n+      } catch (error) {\n+        throw new Error(\n+          'Expected build to succeed for Suspense wrapping dynamic content above HTML',\n+          { cause: error }\n+        )\n+      }\n+    })\n+\n+    it('should correctly mark route as dynamic', async () => {\n+      // The route should be marked as dynamic (ƒ) not static (○)\n+      expect(next.cliOutput).toContain('ƒ /')\n+    })\n+  }\n+})"
        }
    ],
    "stats": {
        "total": 236,
        "additions": 180,
        "deletions": 56
    }
}