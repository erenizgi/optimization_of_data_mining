{
    "author": "bgw",
    "message": "Turbopack: chore: Remove some dead MagicAny serialization code from turbo_tasks::value (#85577)\n\nNoticed this was dead while I was looking through how we might integrate bincode.\n\nWe only ever use `any_serialization` and not `magic_serialization`. In theory, `magic_serialization` is slightly better because it can include the type name in the error message.\n\nIf we go through with the bincode stuff, I'll replace `any_serialization` and the `MagicAny` serialization with something that doesn't depend on `erased-serde`.",
    "sha": "137dbec701dee2b6b09d2d97b0f98665b6a148d5",
    "files": [
        {
            "sha": "c97188ebb1c0354aab3e5f8b2541c396e494536c",
            "filename": "turbopack/crates/turbo-tasks/src/value_type.rs",
            "status": "modified",
            "additions": 2,
            "deletions": 27,
            "changes": 29,
            "blob_url": "https://github.com/vercel/next.js/blob/137dbec701dee2b6b09d2d97b0f98665b6a148d5/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvalue_type.rs",
            "raw_url": "https://github.com/vercel/next.js/raw/137dbec701dee2b6b09d2d97b0f98665b6a148d5/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvalue_type.rs",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/turbopack%2Fcrates%2Fturbo-tasks%2Fsrc%2Fvalue_type.rs?ref=137dbec701dee2b6b09d2d97b0f98665b6a148d5",
            "patch": "@@ -2,24 +2,18 @@ use std::{\n     any::{Any, type_name},\n     fmt::{self, Debug, Display, Formatter},\n     hash::Hash,\n-    sync::Arc,\n };\n \n use auto_hash_map::{AutoMap, AutoSet};\n use serde::{Deserialize, Serialize};\n use tracing::Span;\n \n use crate::{\n-    RawVc, VcValueType,\n-    id::TraitTypeId,\n-    macro_helpers::NativeFunction,\n-    magic_any::{AnyDeserializeSeed, MagicAny, MagicAnyDeserializeSeed},\n-    registry,\n-    task::shared_reference::TypedSharedReference,\n+    RawVc, VcValueType, id::TraitTypeId, macro_helpers::NativeFunction,\n+    magic_any::AnyDeserializeSeed, registry, task::shared_reference::TypedSharedReference,\n     vc::VcCellMode,\n };\n \n-type MagicSerializationFn = fn(&dyn MagicAny) -> &dyn erased_serde::Serialize;\n type AnySerializationFn = fn(&(dyn Any + Sync + Send)) -> &dyn erased_serde::Serialize;\n type RawCellFactoryFn = fn(TypedSharedReference) -> RawVc;\n \n@@ -43,7 +37,6 @@ pub struct ValueType {\n     trait_methods: AutoMap<&'static TraitMethod, &'static NativeFunction>,\n \n     /// Functors for serialization\n-    magic_serialization: Option<(MagicSerializationFn, MagicAnyDeserializeSeed)>,\n     any_serialization: Option<(AnySerializationFn, AnyDeserializeSeed)>,\n \n     /// An implementation of\n@@ -113,7 +106,6 @@ impl ValueType {\n             global_name,\n             traits: AutoSet::new(),\n             trait_methods: AutoMap::new(),\n-            magic_serialization: None,\n             any_serialization: None,\n             raw_cell: <T::CellMode as VcCellMode<T>>::raw_cell,\n         }\n@@ -130,24 +122,11 @@ impl ValueType {\n             global_name,\n             traits: AutoSet::new(),\n             trait_methods: AutoMap::new(),\n-            magic_serialization: None,\n             any_serialization: Some((any_as_serialize::<T>, AnyDeserializeSeed::new::<T>())),\n             raw_cell: <T::CellMode as VcCellMode<T>>::raw_cell,\n         }\n     }\n \n-    pub fn magic_as_serializable<'a>(\n-        &self,\n-        arc: &'a Arc<dyn MagicAny>,\n-    ) -> Option<&'a dyn erased_serde::Serialize> {\n-        if let Some(s) = self.magic_serialization {\n-            let r: &dyn MagicAny = arc;\n-            Some((s.0)(r))\n-        } else {\n-            None\n-        }\n-    }\n-\n     pub fn any_as_serializable<'a>(\n         &self,\n         arc: &'a triomphe::Arc<dyn Any + Sync + Send>,\n@@ -163,10 +142,6 @@ impl ValueType {\n         self.any_serialization.is_some()\n     }\n \n-    pub fn get_magic_deserialize_seed(&self) -> Option<MagicAnyDeserializeSeed> {\n-        self.magic_serialization.map(|s| s.1)\n-    }\n-\n     pub fn get_any_deserialize_seed(&self) -> Option<AnyDeserializeSeed> {\n         self.any_serialization.map(|s| s.1)\n     }"
        }
    ],
    "stats": {
        "total": 29,
        "additions": 2,
        "deletions": 27
    }
}