{
    "author": "eps1lon",
    "message": "[dev-overlay] Fix off-by-one column sourcemapping in Webpack (#76152)",
    "sha": "afa34e933452874b13d480986925cbe595b87cf8",
    "files": [
        {
            "sha": "89ad209ce3e437d2b91a5699c23e655c01f9cf85",
            "filename": "packages/next/src/build/webpack/plugins/wellknown-errors-plugin/parseNotFoundError.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 1,
            "changes": 3,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fwellknown-errors-plugin%2FparseNotFoundError.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fwellknown-errors-plugin%2FparseNotFoundError.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fbuild%2Fwebpack%2Fplugins%2Fwellknown-errors-plugin%2FparseNotFoundError.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -76,7 +76,8 @@ async function getSourceFrame(\n           file: fileName,\n           methodName: '',\n           lineNumber: loc.start.line,\n-          column: loc.start.column,\n+          // loc is 0-based but columns in stack frames are 1-based.\n+          column: (loc.start.column ?? 0) + 1,\n         },\n       })\n "
        },
        {
            "sha": "788c39b5e7c886dc567651999fa57c72baffc961",
            "filename": "packages/next/src/client/components/react-dev-overlay/server/middleware-turbopack.ts",
            "status": "modified",
            "additions": 5,
            "deletions": 1,
            "changes": 6,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-turbopack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-turbopack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-turbopack.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -232,6 +232,9 @@ function findApplicableSourceMapPayload(\n   }\n }\n \n+/**\n+ * @returns 1-based lines and 0-based columns\n+ */\n async function nativeTraceSource(\n   frame: TurbopackStackFrame\n ): Promise<{ frame: IgnorableStackFrame; source: string | null } | undefined> {\n@@ -264,7 +267,8 @@ async function nativeTraceSource(\n     try {\n       const originalPosition = consumer.originalPositionFor({\n         line: frame.line ?? 1,\n-        column: frame.column ?? 1,\n+        // 0-based columns out requires 0-based columns in.\n+        column: (frame.column ?? 1) - 1,\n       })\n \n       if (originalPosition.source === null) {"
        },
        {
            "sha": "2b055a065fcd95993514e7fca23d917a51c3ee24",
            "filename": "packages/next/src/client/components/react-dev-overlay/server/middleware-webpack.ts",
            "status": "modified",
            "additions": 8,
            "deletions": 9,
            "changes": 17,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-webpack.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-webpack.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/packages%2Fnext%2Fsrc%2Fclient%2Fcomponents%2Freact-dev-overlay%2Fserver%2Fmiddleware-webpack.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -90,9 +90,12 @@ function getSourcePath(source: string) {\n   return source.replace(/^(webpack:\\/\\/\\/|webpack:\\/\\/|webpack:\\/\\/_N_E\\/)/, '')\n }\n \n+/**\n+ * @returns 1-based lines and 0-based columns\n+ */\n async function findOriginalSourcePositionAndContent(\n   sourceMap: RawSourceMap,\n-  position: { line: number; column: number | null }\n+  position: { lineNumber: number | null; column: number | null }\n ): Promise<SourceAttributes | null> {\n   let consumer: BasicSourceMapConsumer\n   try {\n@@ -106,8 +109,9 @@ async function findOriginalSourcePositionAndContent(\n \n   try {\n     const sourcePosition = consumer.originalPositionFor({\n-      line: position.line,\n-      column: position.column ?? 0,\n+      line: position.lineNumber ?? 1,\n+      // 0-based columns out requires 0-based columns in.\n+      column: (position.column ?? 1) - 1,\n     })\n \n     if (!sourcePosition.source) {\n@@ -191,7 +195,6 @@ export async function createOriginalStackFrame({\n   frame: StackFrame\n   errorMessage?: string\n }): Promise<OriginalStackFrameResponse | null> {\n-  const { lineNumber, column } = frame\n   const moduleNotFound = findModuleNotFoundFromError(errorMessage)\n   const result = await (() => {\n     if (moduleNotFound) {\n@@ -205,11 +208,7 @@ export async function createOriginalStackFrame({\n         source.compilation\n       )\n     }\n-    // This returns 1-based lines and 0-based columns\n-    return findOriginalSourcePositionAndContent(source.sourceMap, {\n-      line: lineNumber ?? 1,\n-      column,\n-    })\n+    return findOriginalSourcePositionAndContent(source.sourceMap, frame)\n   })()\n \n   if (!result) {"
        },
        {
            "sha": "8c90e308f9dd83f25a2d98b7fb8a2f368c8094ec",
            "filename": "test/development/app-dir/capture-console-error-owner-stack/capture-console-error-owner-stack.test.ts",
            "status": "modified",
            "additions": 23,
            "deletions": 73,
            "changes": 96,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fcapture-console-error-owner-stack%2Fcapture-console-error-owner-stack.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fcapture-console-error-owner-stack%2Fcapture-console-error-owner-stack.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fcapture-console-error-owner-stack%2Fcapture-console-error-owner-stack.test.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -41,54 +41,28 @@ describe('app-dir - capture-console-error-owner-stack', () => {\n \n     const result = await getRedboxResult(browser)\n \n-    // TODO(veil): Inconsistent cursor position for the \"Page\" frame\n-    if (process.env.TURBOPACK) {\n-      expect(result).toMatchInlineSnapshot(`\n-       {\n-         \"callStacks\": \"onClick\n-       app/browser/event/page.js (7:17)\n-       button\n-       <anonymous> (0:0)\n-       Page\n-       app/browser/event/page.js (5:5)\",\n-         \"count\": 1,\n-         \"description\": \"trigger an console <error>\",\n-         \"source\": \"app/browser/event/page.js (7:17) @ onClick\n-\n-          5 |     <button\n-          6 |       onClick={() => {\n-       >  7 |         console.error('trigger an console <%s>', 'error')\n-            |                 ^\n-          8 |       }}\n-          9 |     >\n-         10 |       click to error\",\n-         \"title\": \"Console Error\",\n-       }\n-      `)\n-    } else {\n-      expect(result).toMatchInlineSnapshot(`\n-       {\n-         \"callStacks\": \"onClick\n-       app/browser/event/page.js (7:17)\n-       button\n-       <anonymous> (0:0)\n-       Page\n-       app/browser/event/page.js (5:6)\",\n-         \"count\": 1,\n-         \"description\": \"trigger an console <error>\",\n-         \"source\": \"app/browser/event/page.js (7:17) @ onClick\n-\n-          5 |     <button\n-          6 |       onClick={() => {\n-       >  7 |         console.error('trigger an console <%s>', 'error')\n-            |                 ^\n-          8 |       }}\n-          9 |     >\n-         10 |       click to error\",\n-         \"title\": \"Console Error\",\n-       }\n-      `)\n-    }\n+    expect(result).toMatchInlineSnapshot(`\n+     {\n+       \"callStacks\": \"onClick\n+     app/browser/event/page.js (7:17)\n+     button\n+     <anonymous> (0:0)\n+     Page\n+     app/browser/event/page.js (5:5)\",\n+       \"count\": 1,\n+       \"description\": \"trigger an console <error>\",\n+       \"source\": \"app/browser/event/page.js (7:17) @ onClick\n+\n+        5 |     <button\n+        6 |       onClick={() => {\n+     >  7 |         console.error('trigger an console <%s>', 'error')\n+          |                 ^\n+        8 |       }}\n+        9 |     >\n+       10 |       click to error\",\n+       \"title\": \"Console Error\",\n+     }\n+    `)\n   })\n \n   it('should capture browser console error in render and dedupe if necessary', async () => {\n@@ -227,30 +201,7 @@ describe('app-dir - capture-console-error-owner-stack', () => {\n          }\n         `)\n     } else {\n-      if (process.env.TURBOPACK) {\n-        expect(result).toMatchInlineSnapshot(`\n-       {\n-         \"callStacks\": \"Page\n-       app/rsc/page.js (2:17)\n-       JSON.parse\n-       <anonymous> (0:0)\n-       Page\n-       <anonymous> (0:0)\",\n-         \"count\": 1,\n-         \"description\": \"[ Server ] Error: boom\",\n-         \"source\": \"app/rsc/page.js (2:17) @ Page\n-\n-         1 | export default function Page() {\n-       > 2 |   console.error(new Error('boom'))\n-           |                 ^\n-         3 |   return <p>rsc</p>\n-         4 | }\n-         5 |\",\n-         \"title\": \"Console Error\",\n-       }\n-      `)\n-      } else {\n-        expect(result).toMatchInlineSnapshot(`\n+      expect(result).toMatchInlineSnapshot(`\n        {\n          \"callStacks\": \"Page\n        app/rsc/page.js (2:17)\n@@ -271,7 +222,6 @@ describe('app-dir - capture-console-error-owner-stack', () => {\n          \"title\": \"Console Error\",\n        }\n       `)\n-      }\n     }\n   })\n "
        },
        {
            "sha": "b28fad87cc7a883deb9988ac2982e45299639a74",
            "filename": "test/development/app-dir/error-overlay/error-ignored-frames/error-ignored-frames.test.ts",
            "status": "modified",
            "additions": 22,
            "deletions": 22,
            "changes": 44,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Ferror-overlay%2Ferror-ignored-frames%2Ferror-ignored-frames.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Ferror-overlay%2Ferror-ignored-frames%2Ferror-ignored-frames.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Ferror-overlay%2Ferror-ignored-frames%2Ferror-ignored-frames.test.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -6,7 +6,7 @@ import {\n } from 'next-test-utils'\n \n describe('error-ignored-frames', () => {\n-  const { next } = nextTestSetup({\n+  const { isTurbopack, next } = nextTestSetup({\n     files: __dirname,\n   })\n \n@@ -30,7 +30,7 @@ describe('error-ignored-frames', () => {\n     await toggleCollapseCallStackFrames(browser)\n \n     const expendedStack = await getStackFramesContent(browser)\n-    if (process.env.TURBOPACK) {\n+    if (isTurbopack) {\n       expect(expendedStack).toMatchInlineSnapshot(`\n        \"at Page (app/page.tsx (2:9))\n        at resolveErrorDev ()\n@@ -50,11 +50,11 @@ describe('error-ignored-frames', () => {\n        at processFullStringRow ()\n        at processFullBinaryRow ()\n        at progress ()\n-       at InnerLayoutRouter (../src/client/components/layout-router.tsx (408:6))\n-       at OuterLayoutRouter (../src/client/components/layout-router.tsx (607:20))\n-       at Router (../src/client/components/app-router.tsx (633:8))\n-       at AppRouter (../src/client/components/app-router.tsx (679:8))\n-       at ServerRoot (../src/client/app-index.tsx (201:6))\"\n+       at InnerLayoutRouter (../src/client/components/layout-router.tsx (408:5))\n+       at OuterLayoutRouter (../src/client/components/layout-router.tsx (607:19))\n+       at Router (../src/client/components/app-router.tsx (633:7))\n+       at AppRouter (../src/client/components/app-router.tsx (679:7))\n+       at ServerRoot (../src/client/app-index.tsx (201:5))\"\n       `)\n     }\n   })\n@@ -71,7 +71,7 @@ describe('error-ignored-frames', () => {\n     await toggleCollapseCallStackFrames(browser)\n \n     const expendedStack = await getStackFramesContent(browser)\n-    if (process.env.TURBOPACK) {\n+    if (isTurbopack) {\n       expect(expendedStack).toMatchInlineSnapshot(`\n        \"at Page (app/client/page.tsx (4:9))\n        at ClientPageRoot ()\n@@ -82,10 +82,10 @@ describe('error-ignored-frames', () => {\n     } else {\n       expect(expendedStack).toMatchInlineSnapshot(`\n        \"at Page (app/client/page.tsx (4:9))\n-       at ClientPageRoot (../src/client/components/client-page.tsx (60:13))\n-       at Router (../src/client/components/app-router.tsx (633:8))\n-       at AppRouter (../src/client/components/app-router.tsx (679:8))\n-       at ServerRoot (../src/client/app-index.tsx (201:6))\"\n+       at ClientPageRoot (../src/client/components/client-page.tsx (60:12))\n+       at Router (../src/client/components/app-router.tsx (633:7))\n+       at AppRouter (../src/client/components/app-router.tsx (679:7))\n+       at ServerRoot (../src/client/app-index.tsx (201:5))\"\n       `)\n     }\n   })\n@@ -95,26 +95,26 @@ describe('error-ignored-frames', () => {\n     await assertHasRedbox(browser)\n \n     const defaultStack = await getStackFramesContent(browser)\n-    if (process.env.TURBOPACK) {\n+    if (isTurbopack) {\n       expect(defaultStack).toMatchInlineSnapshot(`\n        \"at <unknown> (app/interleaved/page.tsx (7:11))\n        at Page (app/interleaved/page.tsx (6:35))\"\n       `)\n     } else {\n       expect(defaultStack).toMatchInlineSnapshot(`\n        \"at eval (app/interleaved/page.tsx (7:11))\n-       at Page (app/interleaved/page.tsx (6:37))\"\n+       at Page (app/interleaved/page.tsx (6:36))\"\n       `)\n     }\n \n     await toggleCollapseCallStackFrames(browser)\n \n     const expendedStack = await getStackFramesContent(browser)\n-    if (process.env.TURBOPACK) {\n+    if (isTurbopack) {\n       expect(expendedStack).toMatchInlineSnapshot(`\n        \"at <unknown> (app/interleaved/page.tsx (7:11))\n-       at invokeCallback ()\n        at Page (app/interleaved/page.tsx (6:35))\n+       at invokeCallback ()\n        at ClientPageRoot ()\n        at Router ()\n        at AppRouter ()\n@@ -124,11 +124,11 @@ describe('error-ignored-frames', () => {\n       expect(expendedStack).toMatchInlineSnapshot(`\n        \"at eval (app/interleaved/page.tsx (7:11))\n        at invokeCallback (node_modules/interleave/index.js (2:1))\n-       at Page (app/interleaved/page.tsx (6:37))\n-       at ClientPageRoot (../src/client/components/client-page.tsx (60:13))\n-       at Router (../src/client/components/app-router.tsx (633:8))\n-       at AppRouter (../src/client/components/app-router.tsx (679:8))\n-       at ServerRoot (../src/client/app-index.tsx (201:6))\"\n+       at Page (app/interleaved/page.tsx (6:36))\n+       at ClientPageRoot (../src/client/components/client-page.tsx (60:12))\n+       at Router (../src/client/components/app-router.tsx (633:7))\n+       at AppRouter (../src/client/components/app-router.tsx (679:7))\n+       at ServerRoot (../src/client/app-index.tsx (201:5))\"\n       `)\n     }\n   })\n@@ -145,7 +145,7 @@ describe('error-ignored-frames', () => {\n     await toggleCollapseCallStackFrames(browser)\n \n     const expendedStack = await getStackFramesContent(browser)\n-    if (process.env.TURBOPACK) {\n+    if (isTurbopack) {\n       expect(expendedStack).toMatchInlineSnapshot(`\n        \"at Page (pages/pages.tsx (2:9))\n        at react-stack-bottom-frame ()"
        },
        {
            "sha": "80872cdcbc5f46c792cb1442170b4e33bc7c3672",
            "filename": "test/development/app-dir/owner-stack-invalid-element-type/owner-stack-invalid-element-type.test.ts",
            "status": "modified",
            "additions": 46,
            "deletions": 101,
            "changes": 147,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-invalid-element-type%2Fowner-stack-invalid-element-type.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-invalid-element-type%2Fowner-stack-invalid-element-type.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-invalid-element-type%2Fowner-stack-invalid-element-type.test.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -17,41 +17,22 @@ describe('app-dir - owner-stack-invalid-element-type', () => {\n     const source = await getRedboxSource(browser)\n \n     const stackFramesContent = await getStackFramesContent(browser)\n-    if (process.env.TURBOPACK) {\n-      expect(stackFramesContent).toMatchInlineSnapshot(`\n-         \"at BrowserOnly (app/browser/browser-only.js (8:7))\n-         at Inner (app/browser/page.js (11:10))\n-         at Page (app/browser/page.js (15:10))\"\n-        `)\n-      expect(source).toMatchInlineSnapshot(`\n-          \"app/browser/browser-only.js (8:7) @ BrowserOnly\n-\n-             6 |   return (\n-             7 |     <div>\n-          >  8 |       <Foo />\n-               |       ^\n-             9 |     </div>\n-            10 |   )\n-            11 | }\"\n-        `)\n-    } else {\n-      expect(stackFramesContent).toMatchInlineSnapshot(`\n-         \"at BrowserOnly (app/browser/browser-only.js (8:8))\n-         at Inner (app/browser/page.js (11:11))\n-         at Page (app/browser/page.js (15:11))\"\n-        `)\n-      expect(source).toMatchInlineSnapshot(`\n-         \"app/browser/browser-only.js (8:8) @ BrowserOnly\n-\n-            6 |   return (\n-            7 |     <div>\n-         >  8 |       <Foo />\n-              |        ^\n-            9 |     </div>\n-           10 |   )\n-           11 | }\"\n-        `)\n-    }\n+    expect(stackFramesContent).toMatchInlineSnapshot(`\n+     \"at BrowserOnly (app/browser/browser-only.js (8:7))\n+     at Inner (app/browser/page.js (11:10))\n+     at Page (app/browser/page.js (15:10))\"\n+    `)\n+    expect(source).toMatchInlineSnapshot(`\n+     \"app/browser/browser-only.js (8:7) @ BrowserOnly\n+\n+        6 |   return (\n+        7 |     <div>\n+     >  8 |       <Foo />\n+          |       ^\n+        9 |     </div>\n+       10 |   )\n+       11 | }\"\n+    `)\n   })\n \n   it('should catch invalid element from a rsc component', async () => {\n@@ -61,39 +42,21 @@ describe('app-dir - owner-stack-invalid-element-type', () => {\n     const stackFramesContent = await getStackFramesContent(browser)\n     const source = await getRedboxSource(browser)\n \n-    if (process.env.TURBOPACK) {\n-      expect(stackFramesContent).toMatchInlineSnapshot(`\n-         \"at Inner (app/rsc/page.js (5:11))\n-         at Page (app/rsc/page.js (11:8))\"\n-        `)\n-      expect(source).toMatchInlineSnapshot(`\n-          \"app/rsc/page.js (5:11) @ Inner\n-\n-            3 | // Intermediate component for testing owner stack\n-            4 | function Inner() {\n-          > 5 |   return <Foo />\n-              |           ^\n-            6 | }\n-            7 |\n-            8 | export default function Page() {\"\n-        `)\n-    } else {\n-      expect(stackFramesContent).toMatchInlineSnapshot(`\n-         \"at Inner (app/rsc/page.js (5:11))\n-         at Page (app/rsc/page.js (11:8))\"\n-        `)\n-      expect(source).toMatchInlineSnapshot(`\n-         \"app/rsc/page.js (5:11) @ Inner\n-\n-           3 | // Intermediate component for testing owner stack\n-           4 | function Inner() {\n-         > 5 |   return <Foo />\n-             |           ^\n-           6 | }\n-           7 |\n-           8 | export default function Page() {\"\n-        `)\n-    }\n+    expect(stackFramesContent).toMatchInlineSnapshot(`\n+     \"at Inner (app/rsc/page.js (5:10))\n+     at Page (app/rsc/page.js (11:7))\"\n+    `)\n+    expect(source).toMatchInlineSnapshot(`\n+     \"app/rsc/page.js (5:10) @ Inner\n+\n+       3 | // Intermediate component for testing owner stack\n+       4 | function Inner() {\n+     > 5 |   return <Foo />\n+         |          ^\n+       6 | }\n+       7 |\n+       8 | export default function Page() {\"\n+    `)\n   })\n \n   it('should catch invalid element from on ssr client component', async () => {\n@@ -103,38 +66,20 @@ describe('app-dir - owner-stack-invalid-element-type', () => {\n \n     const stackFramesContent = await getStackFramesContent(browser)\n     const source = await getRedboxSource(browser)\n-    if (process.env.TURBOPACK) {\n-      expect(stackFramesContent).toMatchInlineSnapshot(`\n-         \"at Inner (app/ssr/page.js (7:10))\n-         at Page (app/ssr/page.js (13:7))\"\n-        `)\n-      expect(source).toMatchInlineSnapshot(`\n-          \"app/ssr/page.js (7:10) @ Inner\n-\n-             5 | // Intermediate component for testing owner stack\n-             6 | function Inner() {\n-          >  7 |   return <Foo />\n-               |          ^\n-             8 | }\n-             9 |\n-            10 | export default function Page() {\"\n-        `)\n-    } else {\n-      expect(stackFramesContent).toMatchInlineSnapshot(`\n-         \"at Inner (app/ssr/page.js (7:11))\n-         at Page (app/ssr/page.js (13:8))\"\n-        `)\n-      expect(source).toMatchInlineSnapshot(`\n-         \"app/ssr/page.js (7:11) @ Inner\n-\n-            5 | // Intermediate component for testing owner stack\n-            6 | function Inner() {\n-         >  7 |   return <Foo />\n-              |           ^\n-            8 | }\n-            9 |\n-           10 | export default function Page() {\"\n-        `)\n-    }\n+    expect(stackFramesContent).toMatchInlineSnapshot(`\n+     \"at Inner (app/ssr/page.js (7:10))\n+     at Page (app/ssr/page.js (13:7))\"\n+    `)\n+    expect(source).toMatchInlineSnapshot(`\n+     \"app/ssr/page.js (7:10) @ Inner\n+\n+        5 | // Intermediate component for testing owner stack\n+        6 | function Inner() {\n+     >  7 |   return <Foo />\n+          |          ^\n+        8 | }\n+        9 |\n+       10 | export default function Page() {\"\n+    `)\n   })\n })"
        },
        {
            "sha": "f5636e9cfbeac9ceb9b48e2d14c62f3d8692007f",
            "filename": "test/development/app-dir/owner-stack-react-missing-key-prop/owner-stack-react-missing-key-prop.test.ts",
            "status": "modified",
            "additions": 12,
            "deletions": 12,
            "changes": 24,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-react-missing-key-prop%2Fowner-stack-react-missing-key-prop.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-react-missing-key-prop%2Fowner-stack-react-missing-key-prop.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fowner-stack-react-missing-key-prop%2Fowner-stack-react-missing-key-prop.test.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -6,7 +6,7 @@ import {\n } from 'next-test-utils'\n \n describe('app-dir - owner-stack-react-missing-key-prop', () => {\n-  const { next } = nextTestSetup({\n+  const { isTurbopack, next } = nextTestSetup({\n     files: __dirname,\n   })\n \n@@ -17,36 +17,36 @@ describe('app-dir - owner-stack-react-missing-key-prop', () => {\n     const stackFramesContent = await getStackFramesContent(browser)\n     const source = await getRedboxSource(browser)\n \n-    if (process.env.TURBOPACK) {\n+    if (isTurbopack) {\n       expect(stackFramesContent).toMatchInlineSnapshot(`\n          \"at span ()\n-         at <anonymous> (app/rsc/page.tsx (7:10))\n+         at <anonymous> (app/rsc/page.tsx (7:9))\n          at Page (app/rsc/page.tsx (6:13))\"\n         `)\n       expect(source).toMatchInlineSnapshot(`\n-         \"app/rsc/page.tsx (7:10) @ <anonymous>\n+         \"app/rsc/page.tsx (7:9) @ <anonymous>\n \n             5 |     <div>\n             6 |       {list.map((item, index) => (\n          >  7 |         <span>{item}</span>\n-              |          ^\n+              |         ^\n             8 |       ))}\n             9 |     </div>\n            10 |   )\"\n         `)\n     } else {\n       expect(stackFramesContent).toMatchInlineSnapshot(`\n          \"at span ()\n-         at eval (app/rsc/page.tsx (7:10))\n+         at eval (app/rsc/page.tsx (7:9))\n          at Page (app/rsc/page.tsx (6:13))\"\n         `)\n       expect(source).toMatchInlineSnapshot(`\n-          \"app/rsc/page.tsx (7:10) @ eval\n+          \"app/rsc/page.tsx (7:9) @ eval\n \n              5 |     <div>\n              6 |       {list.map((item, index) => (\n           >  7 |         <span>{item}</span>\n-               |          ^\n+               |         ^\n              8 |       ))}\n              9 |     </div>\n             10 |   )\"\n@@ -60,7 +60,7 @@ describe('app-dir - owner-stack-react-missing-key-prop', () => {\n \n     const stackFramesContent = await getStackFramesContent(browser)\n     const source = await getRedboxSource(browser)\n-    if (process.env.TURBOPACK) {\n+    if (isTurbopack) {\n       expect(stackFramesContent).toMatchInlineSnapshot(`\n          \"at p ()\n          at <unknown> (app/ssr/page.tsx (9:9))\n@@ -81,17 +81,17 @@ describe('app-dir - owner-stack-react-missing-key-prop', () => {\n     } else {\n       expect(stackFramesContent).toMatchInlineSnapshot(`\n          \"at p ()\n-         at eval (app/ssr/page.tsx (9:10))\n+         at eval (app/ssr/page.tsx (9:9))\n          at Array.map ()\n          at Page (app/ssr/page.tsx (8:13))\"\n         `)\n       expect(source).toMatchInlineSnapshot(`\n-          \"app/ssr/page.tsx (9:10) @ eval\n+          \"app/ssr/page.tsx (9:9) @ eval\n \n              7 |     <div>\n              8 |       {list.map((item, index) => (\n           >  9 |         <p>{item}</p>\n-               |          ^\n+               |         ^\n             10 |       ))}\n             11 |     </div>\n             12 |   )\""
        },
        {
            "sha": "a5b32c6db475bbf226f3bd5fa2820b8069cfc3aa",
            "filename": "test/development/app-dir/owner-stack/owner-stack.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 18,
            "changes": 27,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fowner-stack%2Fowner-stack.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fowner-stack%2Fowner-stack.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fowner-stack%2Fowner-stack.test.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -47,7 +47,7 @@ async function getStackFramesContent(browser) {\n }\n \n describe('app-dir - owner-stack', () => {\n-  const { isTurbopack, next } = nextTestSetup({\n+  const { next } = nextTestSetup({\n     files: __dirname,\n   })\n \n@@ -168,23 +168,14 @@ describe('app-dir - owner-stack', () => {\n     await openRedbox(browser)\n \n     const stackFramesContent = await getStackFramesContent(browser)\n-    if (isTurbopack) {\n-      expect(stackFramesContent).toMatchInlineSnapshot(`\n-       \"at useThrowError (app/browser/caught/page.js (34:11))\n-       at useErrorHook (app/browser/caught/page.js (39:3))\n-       at Thrower (app/browser/caught/page.js (29:3))\n-       at Inner (app/browser/caught/page.js (23:7))\n-       at Page (app/browser/caught/page.js (43:10))\"\n-      `)\n-    } else {\n-      expect(stackFramesContent).toMatchInlineSnapshot(`\n-       \"at useThrowError (app/browser/caught/page.js (34:11))\n-       at useErrorHook (app/browser/caught/page.js (39:3))\n-       at Thrower (app/browser/caught/page.js (29:3))\n-       at Inner (app/browser/caught/page.js (23:8))\n-       at Page (app/browser/caught/page.js (43:11))\"\n-      `)\n-    }\n+\n+    expect(stackFramesContent).toMatchInlineSnapshot(`\n+     \"at useThrowError (app/browser/caught/page.js (34:11))\n+     at useErrorHook (app/browser/caught/page.js (39:3))\n+     at Thrower (app/browser/caught/page.js (29:3))\n+     at Inner (app/browser/caught/page.js (23:7))\n+     at Page (app/browser/caught/page.js (43:10))\"\n+    `)\n \n     expect(normalizeStackTrace(errorLog)).toMatchInlineSnapshot(`\n       \"%o"
        },
        {
            "sha": "01b35fd841d0c5307745d22b199a9eb51eb99a35",
            "filename": "test/development/app-dir/server-navigation-error/server-navigation-error.test.ts",
            "status": "modified",
            "additions": 9,
            "deletions": 9,
            "changes": 18,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fserver-navigation-error%2Fserver-navigation-error.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/test%2Fdevelopment%2Fapp-dir%2Fserver-navigation-error%2Fserver-navigation-error.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fdevelopment%2Fapp-dir%2Fserver-navigation-error%2Fserver-navigation-error.test.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -6,7 +6,7 @@ import {\n } from 'next-test-utils'\n \n describe('server-navigation-error', () => {\n-  const { next } = nextTestSetup({\n+  const { isTurbopack, next } = nextTestSetup({\n     files: __dirname,\n   })\n \n@@ -18,7 +18,7 @@ describe('server-navigation-error', () => {\n         `Next.js navigation API is not allowed to be used in Pages Router.`\n       )\n       const source = await getRedboxSource(browser)\n-      if (process.env.TURBOPACK) {\n+      if (isTurbopack) {\n         expect(source).toMatchInlineSnapshot(`\n           \"pages/pages/redirect.tsx (4:10) @ Page\n \n@@ -31,12 +31,12 @@ describe('server-navigation-error', () => {\n         `)\n       } else {\n         expect(source).toMatchInlineSnapshot(`\n-          \"pages/pages/redirect.tsx (4:12) @ Page\n+          \"pages/pages/redirect.tsx (4:11) @ Page\n \n             2 |\n             3 | export default function Page() {\n           > 4 |   redirect('/')\n-              |            ^\n+              |           ^\n             5 | }\n             6 |\"\n         `)\n@@ -50,7 +50,7 @@ describe('server-navigation-error', () => {\n         `Next.js navigation API is not allowed to be used in Pages Router.`\n       )\n       const source = await getRedboxSource(browser)\n-      if (process.env.TURBOPACK) {\n+      if (isTurbopack) {\n         expect(source).toMatchInlineSnapshot(`\n           \"pages/pages/not-found.tsx (4:10) @ Page\n \n@@ -86,7 +86,7 @@ describe('server-navigation-error', () => {\n         `Next.js navigation API is not allowed to be used in Middleware.`\n       )\n       const source = await getRedboxSource(browser)\n-      if (process.env.TURBOPACK) {\n+      if (isTurbopack) {\n         expect(source).toMatchInlineSnapshot(`\n           \"middleware.ts (8:12) @ middleware\n \n@@ -100,12 +100,12 @@ describe('server-navigation-error', () => {\n         `)\n       } else {\n         expect(source).toMatchInlineSnapshot(`\n-          \"middleware.ts (8:14) @ middleware\n+          \"middleware.ts (8:13) @ middleware\n \n              6 |     notFound()\n              7 |   } else if (req.nextUrl.pathname === '/middleware/redirect') {\n           >  8 |     redirect('/')\n-               |              ^\n+               |             ^\n              9 |   }\n             10 | }\n             11 |\"\n@@ -121,7 +121,7 @@ describe('server-navigation-error', () => {\n       )\n       const source = await getRedboxSource(browser)\n \n-      if (process.env.TURBOPACK) {\n+      if (isTurbopack) {\n         expect(source).toMatchInlineSnapshot(`\n           \"middleware.ts (6:12) @ middleware\n "
        },
        {
            "sha": "eaa43589569ab2143b1b6353366cee2d5fe98e8d",
            "filename": "test/e2e/app-dir/use-cache-standalone-search-params/use-cache-standalone-search-params.test.ts",
            "status": "modified",
            "additions": 2,
            "deletions": 2,
            "changes": 4,
            "blob_url": "https://github.com/vercel/next.js/blob/afa34e933452874b13d480986925cbe595b87cf8/test%2Fe2e%2Fapp-dir%2Fuse-cache-standalone-search-params%2Fuse-cache-standalone-search-params.test.ts",
            "raw_url": "https://github.com/vercel/next.js/raw/afa34e933452874b13d480986925cbe595b87cf8/test%2Fe2e%2Fapp-dir%2Fuse-cache-standalone-search-params%2Fuse-cache-standalone-search-params.test.ts",
            "contents_url": "https://api.github.com/repos/vercel/next.js/contents/test%2Fe2e%2Fapp-dir%2Fuse-cache-standalone-search-params%2Fuse-cache-standalone-search-params.test.ts?ref=afa34e933452874b13d480986925cbe595b87cf8",
            "patch": "@@ -56,12 +56,12 @@ describe('use-cache-standalone-search-params', () => {\n     at Page (file:/`)\n         } else {\n           expect(errorSource).toMatchInlineSnapshot(`\n-           \"app/search-params-used/page.tsx (8:18) @ Page\n+           \"app/search-params-used/page.tsx (8:17) @ Page\n \n               6 |   searchParams: Promise<{ [key: string]: string | string[] | undefined }>\n               7 | }) {\n            >  8 |   const param = (await searchParams).foo\n-                |                  ^\n+                |                 ^\n               9 |\n              10 |   return <p>param: {param}</p>\n              11 | }\""
        }
    ],
    "stats": {
        "total": 386,
        "additions": 138,
        "deletions": 248
    }
}